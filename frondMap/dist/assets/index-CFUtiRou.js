var _q=e=>{throw TypeError(e)};var ZM=(e,t,r)=>t.has(e)||_q("Cannot "+r);var Et=(e,t,r)=>(ZM(e,t,"read from private field"),r?r.call(e):t.get(e)),Wn=(e,t,r)=>t.has(e)?_q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),pn=(e,t,r,n)=>(ZM(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Vi=(e,t,r)=>(ZM(e,t,"access private method"),r);var qC=(e,t,r,n)=>({set _(s){pn(e,t,s,r)},get _(){return Et(e,t,n)}});function MX(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var $c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ps(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Wme(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var DX={exports:{}},Mk={},LX={exports:{}},as={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h2=Symbol.for("react.element"),Kme=Symbol.for("react.portal"),Zme=Symbol.for("react.fragment"),Xme=Symbol.for("react.strict_mode"),Yme=Symbol.for("react.profiler"),Jme=Symbol.for("react.provider"),Qme=Symbol.for("react.context"),ege=Symbol.for("react.forward_ref"),tge=Symbol.for("react.suspense"),rge=Symbol.for("react.memo"),nge=Symbol.for("react.lazy"),xq=Symbol.iterator;function ige(e){return e===null||typeof e!="object"?null:(e=xq&&e[xq]||e["@@iterator"],typeof e=="function"?e:null)}var FX={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},zX=Object.assign,BX={};function Yb(e,t,r){this.props=e,this.context=t,this.refs=BX,this.updater=r||FX}Yb.prototype.isReactComponent={};Yb.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Yb.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function $X(){}$X.prototype=Yb.prototype;function A4(e,t,r){this.props=e,this.context=t,this.refs=BX,this.updater=r||FX}var C4=A4.prototype=new $X;C4.constructor=A4;zX(C4,Yb.prototype);C4.isPureReactComponent=!0;var bq=Array.isArray,UX=Object.prototype.hasOwnProperty,j4={current:null},VX={key:!0,ref:!0,__self:!0,__source:!0};function qX(e,t,r){var n,s={},o=null,d=null;if(t!=null)for(n in t.ref!==void 0&&(d=t.ref),t.key!==void 0&&(o=""+t.key),t)UX.call(t,n)&&!VX.hasOwnProperty(n)&&(s[n]=t[n]);var i=arguments.length-2;if(i===1)s.children=r;else if(1<i){for(var m=Array(i),y=0;y<i;y++)m[y]=arguments[y+2];s.children=m}if(e&&e.defaultProps)for(n in i=e.defaultProps,i)s[n]===void 0&&(s[n]=i[n]);return{$$typeof:h2,type:e,key:o,ref:d,props:s,_owner:j4.current}}function sge(e,t){return{$$typeof:h2,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function P4(e){return typeof e=="object"&&e!==null&&e.$$typeof===h2}function age(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var wq=/\/+/g;function XM(e,t){return typeof e=="object"&&e!==null&&e.key!=null?age(""+e.key):t.toString(36)}function $j(e,t,r,n,s){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(o){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case h2:case Kme:d=!0}}if(d)return d=e,s=s(d),e=n===""?"."+XM(d,0):n,bq(s)?(r="",e!=null&&(r=e.replace(wq,"$&/")+"/"),$j(s,t,r,"",function(y){return y})):s!=null&&(P4(s)&&(s=sge(s,r+(!s.key||d&&d.key===s.key?"":(""+s.key).replace(wq,"$&/")+"/")+e)),t.push(s)),1;if(d=0,n=n===""?".":n+":",bq(e))for(var i=0;i<e.length;i++){o=e[i];var m=n+XM(o,i);d+=$j(o,t,r,m,s)}else if(m=ige(e),typeof m=="function")for(e=m.call(e),i=0;!(o=e.next()).done;)o=o.value,m=n+XM(o,i++),d+=$j(o,t,r,m,s);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return d}function HC(e,t,r){if(e==null)return e;var n=[],s=0;return $j(e,n,"","",function(o){return t.call(r,o,s++)}),n}function oge(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var gc={current:null},Uj={transition:null},lge={ReactCurrentDispatcher:gc,ReactCurrentBatchConfig:Uj,ReactCurrentOwner:j4};function HX(){throw Error("act(...) is not supported in production builds of React.")}as.Children={map:HC,forEach:function(e,t,r){HC(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return HC(e,function(){t++}),t},toArray:function(e){return HC(e,function(t){return t})||[]},only:function(e){if(!P4(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};as.Component=Yb;as.Fragment=Zme;as.Profiler=Yme;as.PureComponent=A4;as.StrictMode=Xme;as.Suspense=tge;as.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lge;as.act=HX;as.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=zX({},e.props),s=e.key,o=e.ref,d=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,d=j4.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(m in t)UX.call(t,m)&&!VX.hasOwnProperty(m)&&(n[m]=t[m]===void 0&&i!==void 0?i[m]:t[m])}var m=arguments.length-2;if(m===1)n.children=r;else if(1<m){i=Array(m);for(var y=0;y<m;y++)i[y]=arguments[y+2];n.children=i}return{$$typeof:h2,type:e.type,key:s,ref:o,props:n,_owner:d}};as.createContext=function(e){return e={$$typeof:Qme,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Jme,_context:e},e.Consumer=e};as.createElement=qX;as.createFactory=function(e){var t=qX.bind(null,e);return t.type=e,t};as.createRef=function(){return{current:null}};as.forwardRef=function(e){return{$$typeof:ege,render:e}};as.isValidElement=P4;as.lazy=function(e){return{$$typeof:nge,_payload:{_status:-1,_result:e},_init:oge}};as.memo=function(e,t){return{$$typeof:rge,type:e,compare:t===void 0?null:t}};as.startTransition=function(e){var t=Uj.transition;Uj.transition={};try{e()}finally{Uj.transition=t}};as.unstable_act=HX;as.useCallback=function(e,t){return gc.current.useCallback(e,t)};as.useContext=function(e){return gc.current.useContext(e)};as.useDebugValue=function(){};as.useDeferredValue=function(e){return gc.current.useDeferredValue(e)};as.useEffect=function(e,t){return gc.current.useEffect(e,t)};as.useId=function(){return gc.current.useId()};as.useImperativeHandle=function(e,t,r){return gc.current.useImperativeHandle(e,t,r)};as.useInsertionEffect=function(e,t){return gc.current.useInsertionEffect(e,t)};as.useLayoutEffect=function(e,t){return gc.current.useLayoutEffect(e,t)};as.useMemo=function(e,t){return gc.current.useMemo(e,t)};as.useReducer=function(e,t,r){return gc.current.useReducer(e,t,r)};as.useRef=function(e){return gc.current.useRef(e)};as.useState=function(e){return gc.current.useState(e)};as.useSyncExternalStore=function(e,t,r){return gc.current.useSyncExternalStore(e,t,r)};as.useTransition=function(){return gc.current.useTransition()};as.version="18.3.1";LX.exports=as;var V=LX.exports;const Ve=Ps(V),O4=MX({__proto__:null,default:Ve},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cge=V,uge=Symbol.for("react.element"),dge=Symbol.for("react.fragment"),hge=Object.prototype.hasOwnProperty,fge=cge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pge={key:!0,ref:!0,__self:!0,__source:!0};function GX(e,t,r){var n,s={},o=null,d=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(d=t.ref);for(n in t)hge.call(t,n)&&!pge.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:uge,type:e,key:o,ref:d,props:s,_owner:fge.current}}Mk.Fragment=dge;Mk.jsx=GX;Mk.jsxs=GX;DX.exports=Mk;var h=DX.exports,WX={exports:{}},Eu={},KX={exports:{}},ZX={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(xe,me){var Ce=xe.length;xe.push(me);e:for(;0<Ce;){var ge=Ce-1>>>1,pe=xe[ge];if(0<s(pe,me))xe[ge]=me,xe[Ce]=pe,Ce=ge;else break e}}function r(xe){return xe.length===0?null:xe[0]}function n(xe){if(xe.length===0)return null;var me=xe[0],Ce=xe.pop();if(Ce!==me){xe[0]=Ce;e:for(var ge=0,pe=xe.length,Oe=pe>>>1;ge<Oe;){var Xe=2*(ge+1)-1,We=xe[Xe],$e=Xe+1,Ke=xe[$e];if(0>s(We,Ce))$e<pe&&0>s(Ke,We)?(xe[ge]=Ke,xe[$e]=Ce,ge=$e):(xe[ge]=We,xe[Xe]=Ce,ge=Xe);else if($e<pe&&0>s(Ke,Ce))xe[ge]=Ke,xe[$e]=Ce,ge=$e;else break e}}return me}function s(xe,me){var Ce=xe.sortIndex-me.sortIndex;return Ce!==0?Ce:xe.id-me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var d=Date,i=d.now();e.unstable_now=function(){return d.now()-i}}var m=[],y=[],S=1,w=null,T=3,A=!1,O=!1,P=!1,N=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(xe){for(var me=r(y);me!==null;){if(me.callback===null)n(y);else if(me.startTime<=xe)n(y),me.sortIndex=me.expirationTime,t(m,me);else break;me=r(y)}}function B(xe){if(P=!1,F(xe),!O)if(r(m)!==null)O=!0,Se($);else{var me=r(y);me!==null&&Ae(B,me.startTime-xe)}}function $(xe,me){O=!1,P&&(P=!1,R(te),te=-1),A=!0;var Ce=T;try{for(F(me),w=r(m);w!==null&&(!(w.expirationTime>me)||xe&&!re());){var ge=w.callback;if(typeof ge=="function"){w.callback=null,T=w.priorityLevel;var pe=ge(w.expirationTime<=me);me=e.unstable_now(),typeof pe=="function"?w.callback=pe:w===r(m)&&n(m),F(me)}else n(m);w=r(m)}if(w!==null)var Oe=!0;else{var Xe=r(y);Xe!==null&&Ae(B,Xe.startTime-me),Oe=!1}return Oe}finally{w=null,T=Ce,A=!1}}var W=!1,K=null,te=-1,ne=5,ae=-1;function re(){return!(e.unstable_now()-ae<ne)}function ee(){if(K!==null){var xe=e.unstable_now();ae=xe;var me=!0;try{me=K(!0,xe)}finally{me?ie():(W=!1,K=null)}}else W=!1}var ie;if(typeof M=="function")ie=function(){M(ee)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,be=de.port2;de.port1.onmessage=ee,ie=function(){be.postMessage(null)}}else ie=function(){N(ee,0)};function Se(xe){K=xe,W||(W=!0,ie())}function Ae(xe,me){te=N(function(){xe(e.unstable_now())},me)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(xe){xe.callback=null},e.unstable_continueExecution=function(){O||A||(O=!0,Se($))},e.unstable_forceFrameRate=function(xe){0>xe||125<xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<xe?Math.floor(1e3/xe):5},e.unstable_getCurrentPriorityLevel=function(){return T},e.unstable_getFirstCallbackNode=function(){return r(m)},e.unstable_next=function(xe){switch(T){case 1:case 2:case 3:var me=3;break;default:me=T}var Ce=T;T=me;try{return xe()}finally{T=Ce}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(xe,me){switch(xe){case 1:case 2:case 3:case 4:case 5:break;default:xe=3}var Ce=T;T=xe;try{return me()}finally{T=Ce}},e.unstable_scheduleCallback=function(xe,me,Ce){var ge=e.unstable_now();switch(typeof Ce=="object"&&Ce!==null?(Ce=Ce.delay,Ce=typeof Ce=="number"&&0<Ce?ge+Ce:ge):Ce=ge,xe){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Ce+pe,xe={id:S++,callback:me,priorityLevel:xe,startTime:Ce,expirationTime:pe,sortIndex:-1},Ce>ge?(xe.sortIndex=Ce,t(y,xe),r(m)===null&&xe===r(y)&&(P?(R(te),te=-1):P=!0,Ae(B,Ce-ge))):(xe.sortIndex=pe,t(m,xe),O||A||(O=!0,Se($))),xe},e.unstable_shouldYield=re,e.unstable_wrapCallback=function(xe){var me=T;return function(){var Ce=T;T=me;try{return xe.apply(this,arguments)}finally{T=Ce}}}})(ZX);KX.exports=ZX;var mge=KX.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gge=V,bu=mge;function Fr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var XX=new Set,VE={};function Hv(e,t){Q0(e,t),Q0(e+"Capture",t)}function Q0(e,t){for(VE[e]=t,e=0;e<t.length;e++)XX.add(t[e])}var tp=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),IL=Object.prototype.hasOwnProperty,yge=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Sq={},Eq={};function vge(e){return IL.call(Eq,e)?!0:IL.call(Sq,e)?!1:yge.test(e)?Eq[e]=!0:(Sq[e]=!0,!1)}function _ge(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function xge(e,t,r,n){if(t===null||typeof t>"u"||_ge(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function yc(e,t,r,n,s,o,d){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=d}var jl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){jl[e]=new yc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];jl[t]=new yc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){jl[e]=new yc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){jl[e]=new yc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){jl[e]=new yc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){jl[e]=new yc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){jl[e]=new yc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){jl[e]=new yc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){jl[e]=new yc(e,5,!1,e.toLowerCase(),null,!1,!1)});var k4=/[\-:]([a-z])/g;function N4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(k4,N4);jl[t]=new yc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(k4,N4);jl[t]=new yc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(k4,N4);jl[t]=new yc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){jl[e]=new yc(e,1,!1,e.toLowerCase(),null,!1,!1)});jl.xlinkHref=new yc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){jl[e]=new yc(e,1,!1,e.toLowerCase(),null,!0,!0)});function I4(e,t,r,n){var s=jl.hasOwnProperty(t)?jl[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(xge(t,r,s,n)&&(r=null),n||s===null?vge(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var fp=gge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,GC=Symbol.for("react.element"),r0=Symbol.for("react.portal"),n0=Symbol.for("react.fragment"),R4=Symbol.for("react.strict_mode"),RL=Symbol.for("react.profiler"),YX=Symbol.for("react.provider"),JX=Symbol.for("react.context"),M4=Symbol.for("react.forward_ref"),ML=Symbol.for("react.suspense"),DL=Symbol.for("react.suspense_list"),D4=Symbol.for("react.memo"),Sm=Symbol.for("react.lazy"),QX=Symbol.for("react.offscreen"),Tq=Symbol.iterator;function kS(e){return e===null||typeof e!="object"?null:(e=Tq&&e[Tq]||e["@@iterator"],typeof e=="function"?e:null)}var $a=Object.assign,YM;function iE(e){if(YM===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);YM=t&&t[1]||""}return`
`+YM+e}var JM=!1;function QM(e,t){if(!e||JM)return"";JM=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(y){var n=y}Reflect.construct(e,[],t)}else{try{t.call()}catch(y){n=y}e.call(t.prototype)}else{try{throw Error()}catch(y){n=y}e()}}catch(y){if(y&&n&&typeof y.stack=="string"){for(var s=y.stack.split(`
`),o=n.stack.split(`
`),d=s.length-1,i=o.length-1;1<=d&&0<=i&&s[d]!==o[i];)i--;for(;1<=d&&0<=i;d--,i--)if(s[d]!==o[i]){if(d!==1||i!==1)do if(d--,i--,0>i||s[d]!==o[i]){var m=`
`+s[d].replace(" at new "," at ");return e.displayName&&m.includes("<anonymous>")&&(m=m.replace("<anonymous>",e.displayName)),m}while(1<=d&&0<=i);break}}}finally{JM=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?iE(e):""}function bge(e){switch(e.tag){case 5:return iE(e.type);case 16:return iE("Lazy");case 13:return iE("Suspense");case 19:return iE("SuspenseList");case 0:case 2:case 15:return e=QM(e.type,!1),e;case 11:return e=QM(e.type.render,!1),e;case 1:return e=QM(e.type,!0),e;default:return""}}function LL(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case n0:return"Fragment";case r0:return"Portal";case RL:return"Profiler";case R4:return"StrictMode";case ML:return"Suspense";case DL:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case JX:return(e.displayName||"Context")+".Consumer";case YX:return(e._context.displayName||"Context")+".Provider";case M4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case D4:return t=e.displayName||null,t!==null?t:LL(e.type)||"Memo";case Sm:t=e._payload,e=e._init;try{return LL(e(t))}catch{}}return null}function wge(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return LL(t);case 8:return t===R4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function lg(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function eY(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Sge(e){var t=eY(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(d){n=""+d,o.call(this,d)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(d){n=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function WC(e){e._valueTracker||(e._valueTracker=Sge(e))}function tY(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=eY(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function gP(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function FL(e,t){var r=t.checked;return $a({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function Aq(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=lg(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function rY(e,t){t=t.checked,t!=null&&I4(e,"checked",t,!1)}function zL(e,t){rY(e,t);var r=lg(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?BL(e,t.type,r):t.hasOwnProperty("defaultValue")&&BL(e,t.type,lg(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Cq(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function BL(e,t,r){(t!=="number"||gP(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var sE=Array.isArray;function S0(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+lg(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function $L(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Fr(91));return $a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function jq(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Fr(92));if(sE(r)){if(1<r.length)throw Error(Fr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:lg(r)}}function nY(e,t){var r=lg(t.value),n=lg(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function Pq(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function iY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function UL(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?iY(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var KC,sY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(KC=KC||document.createElement("div"),KC.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=KC.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function qE(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var xE={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ege=["Webkit","ms","Moz","O"];Object.keys(xE).forEach(function(e){Ege.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),xE[t]=xE[e]})});function aY(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||xE.hasOwnProperty(e)&&xE[e]?(""+t).trim():t+"px"}function oY(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=aY(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var Tge=$a({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function VL(e,t){if(t){if(Tge[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Fr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Fr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Fr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Fr(62))}}function qL(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var HL=null;function L4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var GL=null,E0=null,T0=null;function Oq(e){if(e=m2(e)){if(typeof GL!="function")throw Error(Fr(280));var t=e.stateNode;t&&(t=Bk(t),GL(e.stateNode,e.type,t))}}function lY(e){E0?T0?T0.push(e):T0=[e]:E0=e}function cY(){if(E0){var e=E0,t=T0;if(T0=E0=null,Oq(e),t)for(e=0;e<t.length;e++)Oq(t[e])}}function uY(e,t){return e(t)}function dY(){}var eD=!1;function hY(e,t,r){if(eD)return e(t,r);eD=!0;try{return uY(e,t,r)}finally{eD=!1,(E0!==null||T0!==null)&&(dY(),cY())}}function HE(e,t){var r=e.stateNode;if(r===null)return null;var n=Bk(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Fr(231,t,typeof r));return r}var WL=!1;if(tp)try{var NS={};Object.defineProperty(NS,"passive",{get:function(){WL=!0}}),window.addEventListener("test",NS,NS),window.removeEventListener("test",NS,NS)}catch{WL=!1}function Age(e,t,r,n,s,o,d,i,m){var y=Array.prototype.slice.call(arguments,3);try{t.apply(r,y)}catch(S){this.onError(S)}}var bE=!1,yP=null,vP=!1,KL=null,Cge={onError:function(e){bE=!0,yP=e}};function jge(e,t,r,n,s,o,d,i,m){bE=!1,yP=null,Age.apply(Cge,arguments)}function Pge(e,t,r,n,s,o,d,i,m){if(jge.apply(this,arguments),bE){if(bE){var y=yP;bE=!1,yP=null}else throw Error(Fr(198));vP||(vP=!0,KL=y)}}function Gv(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function fY(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function kq(e){if(Gv(e)!==e)throw Error(Fr(188))}function Oge(e){var t=e.alternate;if(!t){if(t=Gv(e),t===null)throw Error(Fr(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var o=s.alternate;if(o===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===r)return kq(s),e;if(o===n)return kq(s),t;o=o.sibling}throw Error(Fr(188))}if(r.return!==n.return)r=s,n=o;else{for(var d=!1,i=s.child;i;){if(i===r){d=!0,r=s,n=o;break}if(i===n){d=!0,n=s,r=o;break}i=i.sibling}if(!d){for(i=o.child;i;){if(i===r){d=!0,r=o,n=s;break}if(i===n){d=!0,n=o,r=s;break}i=i.sibling}if(!d)throw Error(Fr(189))}}if(r.alternate!==n)throw Error(Fr(190))}if(r.tag!==3)throw Error(Fr(188));return r.stateNode.current===r?e:t}function pY(e){return e=Oge(e),e!==null?mY(e):null}function mY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=mY(e);if(t!==null)return t;e=e.sibling}return null}var gY=bu.unstable_scheduleCallback,Nq=bu.unstable_cancelCallback,kge=bu.unstable_shouldYield,Nge=bu.unstable_requestPaint,go=bu.unstable_now,Ige=bu.unstable_getCurrentPriorityLevel,F4=bu.unstable_ImmediatePriority,yY=bu.unstable_UserBlockingPriority,_P=bu.unstable_NormalPriority,Rge=bu.unstable_LowPriority,vY=bu.unstable_IdlePriority,Dk=null,Mh=null;function Mge(e){if(Mh&&typeof Mh.onCommitFiberRoot=="function")try{Mh.onCommitFiberRoot(Dk,e,void 0,(e.current.flags&128)===128)}catch{}}var Bd=Math.clz32?Math.clz32:Fge,Dge=Math.log,Lge=Math.LN2;function Fge(e){return e>>>=0,e===0?32:31-(Dge(e)/Lge|0)|0}var ZC=64,XC=4194304;function aE(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function xP(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,o=e.pingedLanes,d=r&268435455;if(d!==0){var i=d&~s;i!==0?n=aE(i):(o&=d,o!==0&&(n=aE(o)))}else d=r&~s,d!==0?n=aE(d):o!==0&&(n=aE(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,o=t&-t,s>=o||s===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Bd(t),s=1<<r,n|=e[r],t&=~s;return n}function zge(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bge(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,o=e.pendingLanes;0<o;){var d=31-Bd(o),i=1<<d,m=s[d];m===-1?(!(i&r)||i&n)&&(s[d]=zge(i,t)):m<=t&&(e.expiredLanes|=i),o&=~i}}function ZL(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function _Y(){var e=ZC;return ZC<<=1,!(ZC&4194240)&&(ZC=64),e}function tD(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function f2(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Bd(t),e[t]=r}function $ge(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-Bd(r),o=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~o}}function z4(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Bd(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var qs=0;function xY(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var bY,B4,wY,SY,EY,XL=!1,YC=[],Zm=null,Xm=null,Ym=null,GE=new Map,WE=new Map,jm=[],Uge="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Iq(e,t){switch(e){case"focusin":case"focusout":Zm=null;break;case"dragenter":case"dragleave":Xm=null;break;case"mouseover":case"mouseout":Ym=null;break;case"pointerover":case"pointerout":GE.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":WE.delete(t.pointerId)}}function IS(e,t,r,n,s,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[s]},t!==null&&(t=m2(t),t!==null&&B4(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function Vge(e,t,r,n,s){switch(t){case"focusin":return Zm=IS(Zm,e,t,r,n,s),!0;case"dragenter":return Xm=IS(Xm,e,t,r,n,s),!0;case"mouseover":return Ym=IS(Ym,e,t,r,n,s),!0;case"pointerover":var o=s.pointerId;return GE.set(o,IS(GE.get(o)||null,e,t,r,n,s)),!0;case"gotpointercapture":return o=s.pointerId,WE.set(o,IS(WE.get(o)||null,e,t,r,n,s)),!0}return!1}function TY(e){var t=Zy(e.target);if(t!==null){var r=Gv(t);if(r!==null){if(t=r.tag,t===13){if(t=fY(r),t!==null){e.blockedOn=t,EY(e.priority,function(){wY(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Vj(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=YL(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);HL=n,r.target.dispatchEvent(n),HL=null}else return t=m2(r),t!==null&&B4(t),e.blockedOn=r,!1;t.shift()}return!0}function Rq(e,t,r){Vj(e)&&r.delete(t)}function qge(){XL=!1,Zm!==null&&Vj(Zm)&&(Zm=null),Xm!==null&&Vj(Xm)&&(Xm=null),Ym!==null&&Vj(Ym)&&(Ym=null),GE.forEach(Rq),WE.forEach(Rq)}function RS(e,t){e.blockedOn===t&&(e.blockedOn=null,XL||(XL=!0,bu.unstable_scheduleCallback(bu.unstable_NormalPriority,qge)))}function KE(e){function t(s){return RS(s,e)}if(0<YC.length){RS(YC[0],e);for(var r=1;r<YC.length;r++){var n=YC[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Zm!==null&&RS(Zm,e),Xm!==null&&RS(Xm,e),Ym!==null&&RS(Ym,e),GE.forEach(t),WE.forEach(t),r=0;r<jm.length;r++)n=jm[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<jm.length&&(r=jm[0],r.blockedOn===null);)TY(r),r.blockedOn===null&&jm.shift()}var A0=fp.ReactCurrentBatchConfig,bP=!0;function Hge(e,t,r,n){var s=qs,o=A0.transition;A0.transition=null;try{qs=1,$4(e,t,r,n)}finally{qs=s,A0.transition=o}}function Gge(e,t,r,n){var s=qs,o=A0.transition;A0.transition=null;try{qs=4,$4(e,t,r,n)}finally{qs=s,A0.transition=o}}function $4(e,t,r,n){if(bP){var s=YL(e,t,r,n);if(s===null)dD(e,t,n,wP,r),Iq(e,n);else if(Vge(s,e,t,r,n))n.stopPropagation();else if(Iq(e,n),t&4&&-1<Uge.indexOf(e)){for(;s!==null;){var o=m2(s);if(o!==null&&bY(o),o=YL(e,t,r,n),o===null&&dD(e,t,n,wP,r),o===s)break;s=o}s!==null&&n.stopPropagation()}else dD(e,t,n,null,r)}}var wP=null;function YL(e,t,r,n){if(wP=null,e=L4(n),e=Zy(e),e!==null)if(t=Gv(e),t===null)e=null;else if(r=t.tag,r===13){if(e=fY(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return wP=e,null}function AY(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ige()){case F4:return 1;case yY:return 4;case _P:case Rge:return 16;case vY:return 536870912;default:return 16}default:return 16}}var qm=null,U4=null,qj=null;function CY(){if(qj)return qj;var e,t=U4,r=t.length,n,s="value"in qm?qm.value:qm.textContent,o=s.length;for(e=0;e<r&&t[e]===s[e];e++);var d=r-e;for(n=1;n<=d&&t[r-n]===s[o-n];n++);return qj=s.slice(e,1<n?1-n:void 0)}function Hj(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function JC(){return!0}function Mq(){return!1}function Tu(e){function t(r,n,s,o,d){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=o,this.target=d,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(r=e[i],this[i]=r?r(o):o[i]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?JC:Mq,this.isPropagationStopped=Mq,this}return $a(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=JC)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=JC)},persist:function(){},isPersistent:JC}),t}var Jb={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},V4=Tu(Jb),p2=$a({},Jb,{view:0,detail:0}),Wge=Tu(p2),rD,nD,MS,Lk=$a({},p2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:q4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==MS&&(MS&&e.type==="mousemove"?(rD=e.screenX-MS.screenX,nD=e.screenY-MS.screenY):nD=rD=0,MS=e),rD)},movementY:function(e){return"movementY"in e?e.movementY:nD}}),Dq=Tu(Lk),Kge=$a({},Lk,{dataTransfer:0}),Zge=Tu(Kge),Xge=$a({},p2,{relatedTarget:0}),iD=Tu(Xge),Yge=$a({},Jb,{animationName:0,elapsedTime:0,pseudoElement:0}),Jge=Tu(Yge),Qge=$a({},Jb,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),eye=Tu(Qge),tye=$a({},Jb,{data:0}),Lq=Tu(tye),rye={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nye={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iye={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sye(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=iye[e])?!!t[e]:!1}function q4(){return sye}var aye=$a({},p2,{key:function(e){if(e.key){var t=rye[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Hj(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?nye[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:q4,charCode:function(e){return e.type==="keypress"?Hj(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Hj(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),oye=Tu(aye),lye=$a({},Lk,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fq=Tu(lye),cye=$a({},p2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:q4}),uye=Tu(cye),dye=$a({},Jb,{propertyName:0,elapsedTime:0,pseudoElement:0}),hye=Tu(dye),fye=$a({},Lk,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),pye=Tu(fye),mye=[9,13,27,32],H4=tp&&"CompositionEvent"in window,wE=null;tp&&"documentMode"in document&&(wE=document.documentMode);var gye=tp&&"TextEvent"in window&&!wE,jY=tp&&(!H4||wE&&8<wE&&11>=wE),zq=" ",Bq=!1;function PY(e,t){switch(e){case"keyup":return mye.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OY(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var i0=!1;function yye(e,t){switch(e){case"compositionend":return OY(t);case"keypress":return t.which!==32?null:(Bq=!0,zq);case"textInput":return e=t.data,e===zq&&Bq?null:e;default:return null}}function vye(e,t){if(i0)return e==="compositionend"||!H4&&PY(e,t)?(e=CY(),qj=U4=qm=null,i0=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jY&&t.locale!=="ko"?null:t.data;default:return null}}var _ye={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $q(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!_ye[e.type]:t==="textarea"}function kY(e,t,r,n){lY(n),t=SP(t,"onChange"),0<t.length&&(r=new V4("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var SE=null,ZE=null;function xye(e){UY(e,0)}function Fk(e){var t=o0(e);if(tY(t))return e}function bye(e,t){if(e==="change")return t}var NY=!1;if(tp){var sD;if(tp){var aD="oninput"in document;if(!aD){var Uq=document.createElement("div");Uq.setAttribute("oninput","return;"),aD=typeof Uq.oninput=="function"}sD=aD}else sD=!1;NY=sD&&(!document.documentMode||9<document.documentMode)}function Vq(){SE&&(SE.detachEvent("onpropertychange",IY),ZE=SE=null)}function IY(e){if(e.propertyName==="value"&&Fk(ZE)){var t=[];kY(t,ZE,e,L4(e)),hY(xye,t)}}function wye(e,t,r){e==="focusin"?(Vq(),SE=t,ZE=r,SE.attachEvent("onpropertychange",IY)):e==="focusout"&&Vq()}function Sye(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Fk(ZE)}function Eye(e,t){if(e==="click")return Fk(t)}function Tye(e,t){if(e==="input"||e==="change")return Fk(t)}function Aye(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var qd=typeof Object.is=="function"?Object.is:Aye;function XE(e,t){if(qd(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!IL.call(t,s)||!qd(e[s],t[s]))return!1}return!0}function qq(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Hq(e,t){var r=qq(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=qq(r)}}function RY(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?RY(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function MY(){for(var e=window,t=gP();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=gP(e.document)}return t}function G4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Cye(e){var t=MY(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&RY(r.ownerDocument.documentElement,r)){if(n!==null&&G4(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,o=Math.min(n.start,s);n=n.end===void 0?o:Math.min(n.end,s),!e.extend&&o>n&&(s=n,n=o,o=s),s=Hq(r,o);var d=Hq(r,n);s&&d&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(d.node,d.offset)):(t.setEnd(d.node,d.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var jye=tp&&"documentMode"in document&&11>=document.documentMode,s0=null,JL=null,EE=null,QL=!1;function Gq(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;QL||s0==null||s0!==gP(n)||(n=s0,"selectionStart"in n&&G4(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),EE&&XE(EE,n)||(EE=n,n=SP(JL,"onSelect"),0<n.length&&(t=new V4("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=s0)))}function QC(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var a0={animationend:QC("Animation","AnimationEnd"),animationiteration:QC("Animation","AnimationIteration"),animationstart:QC("Animation","AnimationStart"),transitionend:QC("Transition","TransitionEnd")},oD={},DY={};tp&&(DY=document.createElement("div").style,"AnimationEvent"in window||(delete a0.animationend.animation,delete a0.animationiteration.animation,delete a0.animationstart.animation),"TransitionEvent"in window||delete a0.transitionend.transition);function zk(e){if(oD[e])return oD[e];if(!a0[e])return e;var t=a0[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in DY)return oD[e]=t[r];return e}var LY=zk("animationend"),FY=zk("animationiteration"),zY=zk("animationstart"),BY=zk("transitionend"),$Y=new Map,Wq="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yg(e,t){$Y.set(e,t),Hv(t,[e])}for(var lD=0;lD<Wq.length;lD++){var cD=Wq[lD],Pye=cD.toLowerCase(),Oye=cD[0].toUpperCase()+cD.slice(1);yg(Pye,"on"+Oye)}yg(LY,"onAnimationEnd");yg(FY,"onAnimationIteration");yg(zY,"onAnimationStart");yg("dblclick","onDoubleClick");yg("focusin","onFocus");yg("focusout","onBlur");yg(BY,"onTransitionEnd");Q0("onMouseEnter",["mouseout","mouseover"]);Q0("onMouseLeave",["mouseout","mouseover"]);Q0("onPointerEnter",["pointerout","pointerover"]);Q0("onPointerLeave",["pointerout","pointerover"]);Hv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hv("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kye=new Set("cancel close invalid load scroll toggle".split(" ").concat(oE));function Kq(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Pge(n,t,void 0,e),e.currentTarget=null}function UY(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var d=n.length-1;0<=d;d--){var i=n[d],m=i.instance,y=i.currentTarget;if(i=i.listener,m!==o&&s.isPropagationStopped())break e;Kq(s,i,y),o=m}else for(d=0;d<n.length;d++){if(i=n[d],m=i.instance,y=i.currentTarget,i=i.listener,m!==o&&s.isPropagationStopped())break e;Kq(s,i,y),o=m}}}if(vP)throw e=KL,vP=!1,KL=null,e}function ha(e,t){var r=t[i3];r===void 0&&(r=t[i3]=new Set);var n=e+"__bubble";r.has(n)||(VY(t,e,2,!1),r.add(n))}function uD(e,t,r){var n=0;t&&(n|=4),VY(r,e,n,t)}var ej="_reactListening"+Math.random().toString(36).slice(2);function YE(e){if(!e[ej]){e[ej]=!0,XX.forEach(function(r){r!=="selectionchange"&&(kye.has(r)||uD(r,!1,e),uD(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ej]||(t[ej]=!0,uD("selectionchange",!1,t))}}function VY(e,t,r,n){switch(AY(t)){case 1:var s=Hge;break;case 4:s=Gge;break;default:s=$4}r=s.bind(null,t,r,e),s=void 0,!WL||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function dD(e,t,r,n,s){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var d=n.tag;if(d===3||d===4){var i=n.stateNode.containerInfo;if(i===s||i.nodeType===8&&i.parentNode===s)break;if(d===4)for(d=n.return;d!==null;){var m=d.tag;if((m===3||m===4)&&(m=d.stateNode.containerInfo,m===s||m.nodeType===8&&m.parentNode===s))return;d=d.return}for(;i!==null;){if(d=Zy(i),d===null)return;if(m=d.tag,m===5||m===6){n=o=d;continue e}i=i.parentNode}}n=n.return}hY(function(){var y=o,S=L4(r),w=[];e:{var T=$Y.get(e);if(T!==void 0){var A=V4,O=e;switch(e){case"keypress":if(Hj(r)===0)break e;case"keydown":case"keyup":A=oye;break;case"focusin":O="focus",A=iD;break;case"focusout":O="blur",A=iD;break;case"beforeblur":case"afterblur":A=iD;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=Dq;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=Zge;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=uye;break;case LY:case FY:case zY:A=Jge;break;case BY:A=hye;break;case"scroll":A=Wge;break;case"wheel":A=pye;break;case"copy":case"cut":case"paste":A=eye;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=Fq}var P=(t&4)!==0,N=!P&&e==="scroll",R=P?T!==null?T+"Capture":null:T;P=[];for(var M=y,F;M!==null;){F=M;var B=F.stateNode;if(F.tag===5&&B!==null&&(F=B,R!==null&&(B=HE(M,R),B!=null&&P.push(JE(M,B,F)))),N)break;M=M.return}0<P.length&&(T=new A(T,O,null,r,S),w.push({event:T,listeners:P}))}}if(!(t&7)){e:{if(T=e==="mouseover"||e==="pointerover",A=e==="mouseout"||e==="pointerout",T&&r!==HL&&(O=r.relatedTarget||r.fromElement)&&(Zy(O)||O[rp]))break e;if((A||T)&&(T=S.window===S?S:(T=S.ownerDocument)?T.defaultView||T.parentWindow:window,A?(O=r.relatedTarget||r.toElement,A=y,O=O?Zy(O):null,O!==null&&(N=Gv(O),O!==N||O.tag!==5&&O.tag!==6)&&(O=null)):(A=null,O=y),A!==O)){if(P=Dq,B="onMouseLeave",R="onMouseEnter",M="mouse",(e==="pointerout"||e==="pointerover")&&(P=Fq,B="onPointerLeave",R="onPointerEnter",M="pointer"),N=A==null?T:o0(A),F=O==null?T:o0(O),T=new P(B,M+"leave",A,r,S),T.target=N,T.relatedTarget=F,B=null,Zy(S)===y&&(P=new P(R,M+"enter",O,r,S),P.target=F,P.relatedTarget=N,B=P),N=B,A&&O)t:{for(P=A,R=O,M=0,F=P;F;F=Rx(F))M++;for(F=0,B=R;B;B=Rx(B))F++;for(;0<M-F;)P=Rx(P),M--;for(;0<F-M;)R=Rx(R),F--;for(;M--;){if(P===R||R!==null&&P===R.alternate)break t;P=Rx(P),R=Rx(R)}P=null}else P=null;A!==null&&Zq(w,T,A,P,!1),O!==null&&N!==null&&Zq(w,N,O,P,!0)}}e:{if(T=y?o0(y):window,A=T.nodeName&&T.nodeName.toLowerCase(),A==="select"||A==="input"&&T.type==="file")var $=bye;else if($q(T))if(NY)$=Tye;else{$=Sye;var W=wye}else(A=T.nodeName)&&A.toLowerCase()==="input"&&(T.type==="checkbox"||T.type==="radio")&&($=Eye);if($&&($=$(e,y))){kY(w,$,r,S);break e}W&&W(e,T,y),e==="focusout"&&(W=T._wrapperState)&&W.controlled&&T.type==="number"&&BL(T,"number",T.value)}switch(W=y?o0(y):window,e){case"focusin":($q(W)||W.contentEditable==="true")&&(s0=W,JL=y,EE=null);break;case"focusout":EE=JL=s0=null;break;case"mousedown":QL=!0;break;case"contextmenu":case"mouseup":case"dragend":QL=!1,Gq(w,r,S);break;case"selectionchange":if(jye)break;case"keydown":case"keyup":Gq(w,r,S)}var K;if(H4)e:{switch(e){case"compositionstart":var te="onCompositionStart";break e;case"compositionend":te="onCompositionEnd";break e;case"compositionupdate":te="onCompositionUpdate";break e}te=void 0}else i0?PY(e,r)&&(te="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(te="onCompositionStart");te&&(jY&&r.locale!=="ko"&&(i0||te!=="onCompositionStart"?te==="onCompositionEnd"&&i0&&(K=CY()):(qm=S,U4="value"in qm?qm.value:qm.textContent,i0=!0)),W=SP(y,te),0<W.length&&(te=new Lq(te,e,null,r,S),w.push({event:te,listeners:W}),K?te.data=K:(K=OY(r),K!==null&&(te.data=K)))),(K=gye?yye(e,r):vye(e,r))&&(y=SP(y,"onBeforeInput"),0<y.length&&(S=new Lq("onBeforeInput","beforeinput",null,r,S),w.push({event:S,listeners:y}),S.data=K))}UY(w,t)})}function JE(e,t,r){return{instance:e,listener:t,currentTarget:r}}function SP(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=HE(e,r),o!=null&&n.unshift(JE(e,o,s)),o=HE(e,t),o!=null&&n.push(JE(e,o,s))),e=e.return}return n}function Rx(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Zq(e,t,r,n,s){for(var o=t._reactName,d=[];r!==null&&r!==n;){var i=r,m=i.alternate,y=i.stateNode;if(m!==null&&m===n)break;i.tag===5&&y!==null&&(i=y,s?(m=HE(r,o),m!=null&&d.unshift(JE(r,m,i))):s||(m=HE(r,o),m!=null&&d.push(JE(r,m,i)))),r=r.return}d.length!==0&&e.push({event:t,listeners:d})}var Nye=/\r\n?/g,Iye=/\u0000|\uFFFD/g;function Xq(e){return(typeof e=="string"?e:""+e).replace(Nye,`
`).replace(Iye,"")}function tj(e,t,r){if(t=Xq(t),Xq(e)!==t&&r)throw Error(Fr(425))}function EP(){}var e3=null,t3=null;function r3(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var n3=typeof setTimeout=="function"?setTimeout:void 0,Rye=typeof clearTimeout=="function"?clearTimeout:void 0,Yq=typeof Promise=="function"?Promise:void 0,Mye=typeof queueMicrotask=="function"?queueMicrotask:typeof Yq<"u"?function(e){return Yq.resolve(null).then(e).catch(Dye)}:n3;function Dye(e){setTimeout(function(){throw e})}function hD(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),KE(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);KE(t)}function Jm(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Jq(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Qb=Math.random().toString(36).slice(2),Sh="__reactFiber$"+Qb,QE="__reactProps$"+Qb,rp="__reactContainer$"+Qb,i3="__reactEvents$"+Qb,Lye="__reactListeners$"+Qb,Fye="__reactHandles$"+Qb;function Zy(e){var t=e[Sh];if(t)return t;for(var r=e.parentNode;r;){if(t=r[rp]||r[Sh]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Jq(e);e!==null;){if(r=e[Sh])return r;e=Jq(e)}return t}e=r,r=e.parentNode}return null}function m2(e){return e=e[Sh]||e[rp],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function o0(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Fr(33))}function Bk(e){return e[QE]||null}var s3=[],l0=-1;function vg(e){return{current:e}}function ma(e){0>l0||(e.current=s3[l0],s3[l0]=null,l0--)}function ia(e,t){l0++,s3[l0]=e.current,e.current=t}var cg={},Ul=vg(cg),Hc=vg(!1),xv=cg;function eb(e,t){var r=e.type.contextTypes;if(!r)return cg;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in r)s[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Gc(e){return e=e.childContextTypes,e!=null}function TP(){ma(Hc),ma(Ul)}function Qq(e,t,r){if(Ul.current!==cg)throw Error(Fr(168));ia(Ul,t),ia(Hc,r)}function qY(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(Fr(108,wge(e)||"Unknown",s));return $a({},r,n)}function AP(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cg,xv=Ul.current,ia(Ul,e),ia(Hc,Hc.current),!0}function e9(e,t,r){var n=e.stateNode;if(!n)throw Error(Fr(169));r?(e=qY(e,t,xv),n.__reactInternalMemoizedMergedChildContext=e,ma(Hc),ma(Ul),ia(Ul,e)):ma(Hc),ia(Hc,r)}var Df=null,$k=!1,fD=!1;function HY(e){Df===null?Df=[e]:Df.push(e)}function zye(e){$k=!0,HY(e)}function _g(){if(!fD&&Df!==null){fD=!0;var e=0,t=qs;try{var r=Df;for(qs=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Df=null,$k=!1}catch(s){throw Df!==null&&(Df=Df.slice(e+1)),gY(F4,_g),s}finally{qs=t,fD=!1}}return null}var c0=[],u0=0,CP=null,jP=0,zu=[],Bu=0,bv=null,$f=1,Uf="";function Ly(e,t){c0[u0++]=jP,c0[u0++]=CP,CP=e,jP=t}function GY(e,t,r){zu[Bu++]=$f,zu[Bu++]=Uf,zu[Bu++]=bv,bv=e;var n=$f;e=Uf;var s=32-Bd(n)-1;n&=~(1<<s),r+=1;var o=32-Bd(t)+s;if(30<o){var d=s-s%5;o=(n&(1<<d)-1).toString(32),n>>=d,s-=d,$f=1<<32-Bd(t)+s|r<<s|n,Uf=o+e}else $f=1<<o|r<<s|n,Uf=e}function W4(e){e.return!==null&&(Ly(e,1),GY(e,1,0))}function K4(e){for(;e===CP;)CP=c0[--u0],c0[u0]=null,jP=c0[--u0],c0[u0]=null;for(;e===bv;)bv=zu[--Bu],zu[Bu]=null,Uf=zu[--Bu],zu[Bu]=null,$f=zu[--Bu],zu[Bu]=null}var gu=null,mu=null,Ta=!1,Md=null;function WY(e,t){var r=qu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function t9(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,gu=e,mu=Jm(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,gu=e,mu=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=bv!==null?{id:$f,overflow:Uf}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=qu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,gu=e,mu=null,!0):!1;default:return!1}}function a3(e){return(e.mode&1)!==0&&(e.flags&128)===0}function o3(e){if(Ta){var t=mu;if(t){var r=t;if(!t9(e,t)){if(a3(e))throw Error(Fr(418));t=Jm(r.nextSibling);var n=gu;t&&t9(e,t)?WY(n,r):(e.flags=e.flags&-4097|2,Ta=!1,gu=e)}}else{if(a3(e))throw Error(Fr(418));e.flags=e.flags&-4097|2,Ta=!1,gu=e}}}function r9(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;gu=e}function rj(e){if(e!==gu)return!1;if(!Ta)return r9(e),Ta=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!r3(e.type,e.memoizedProps)),t&&(t=mu)){if(a3(e))throw KY(),Error(Fr(418));for(;t;)WY(e,t),t=Jm(t.nextSibling)}if(r9(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Fr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){mu=Jm(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}mu=null}}else mu=gu?Jm(e.stateNode.nextSibling):null;return!0}function KY(){for(var e=mu;e;)e=Jm(e.nextSibling)}function tb(){mu=gu=null,Ta=!1}function Z4(e){Md===null?Md=[e]:Md.push(e)}var Bye=fp.ReactCurrentBatchConfig;function DS(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Fr(309));var n=r.stateNode}if(!n)throw Error(Fr(147,e));var s=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(d){var i=s.refs;d===null?delete i[o]:i[o]=d},t._stringRef=o,t)}if(typeof e!="string")throw Error(Fr(284));if(!r._owner)throw Error(Fr(290,e))}return e}function nj(e,t){throw e=Object.prototype.toString.call(t),Error(Fr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function n9(e){var t=e._init;return t(e._payload)}function ZY(e){function t(R,M){if(e){var F=R.deletions;F===null?(R.deletions=[M],R.flags|=16):F.push(M)}}function r(R,M){if(!e)return null;for(;M!==null;)t(R,M),M=M.sibling;return null}function n(R,M){for(R=new Map;M!==null;)M.key!==null?R.set(M.key,M):R.set(M.index,M),M=M.sibling;return R}function s(R,M){return R=rg(R,M),R.index=0,R.sibling=null,R}function o(R,M,F){return R.index=F,e?(F=R.alternate,F!==null?(F=F.index,F<M?(R.flags|=2,M):F):(R.flags|=2,M)):(R.flags|=1048576,M)}function d(R){return e&&R.alternate===null&&(R.flags|=2),R}function i(R,M,F,B){return M===null||M.tag!==6?(M=xD(F,R.mode,B),M.return=R,M):(M=s(M,F),M.return=R,M)}function m(R,M,F,B){var $=F.type;return $===n0?S(R,M,F.props.children,B,F.key):M!==null&&(M.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Sm&&n9($)===M.type)?(B=s(M,F.props),B.ref=DS(R,M,F),B.return=R,B):(B=Jj(F.type,F.key,F.props,null,R.mode,B),B.ref=DS(R,M,F),B.return=R,B)}function y(R,M,F,B){return M===null||M.tag!==4||M.stateNode.containerInfo!==F.containerInfo||M.stateNode.implementation!==F.implementation?(M=bD(F,R.mode,B),M.return=R,M):(M=s(M,F.children||[]),M.return=R,M)}function S(R,M,F,B,$){return M===null||M.tag!==7?(M=gv(F,R.mode,B,$),M.return=R,M):(M=s(M,F),M.return=R,M)}function w(R,M,F){if(typeof M=="string"&&M!==""||typeof M=="number")return M=xD(""+M,R.mode,F),M.return=R,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case GC:return F=Jj(M.type,M.key,M.props,null,R.mode,F),F.ref=DS(R,null,M),F.return=R,F;case r0:return M=bD(M,R.mode,F),M.return=R,M;case Sm:var B=M._init;return w(R,B(M._payload),F)}if(sE(M)||kS(M))return M=gv(M,R.mode,F,null),M.return=R,M;nj(R,M)}return null}function T(R,M,F,B){var $=M!==null?M.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return $!==null?null:i(R,M,""+F,B);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case GC:return F.key===$?m(R,M,F,B):null;case r0:return F.key===$?y(R,M,F,B):null;case Sm:return $=F._init,T(R,M,$(F._payload),B)}if(sE(F)||kS(F))return $!==null?null:S(R,M,F,B,null);nj(R,F)}return null}function A(R,M,F,B,$){if(typeof B=="string"&&B!==""||typeof B=="number")return R=R.get(F)||null,i(M,R,""+B,$);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case GC:return R=R.get(B.key===null?F:B.key)||null,m(M,R,B,$);case r0:return R=R.get(B.key===null?F:B.key)||null,y(M,R,B,$);case Sm:var W=B._init;return A(R,M,F,W(B._payload),$)}if(sE(B)||kS(B))return R=R.get(F)||null,S(M,R,B,$,null);nj(M,B)}return null}function O(R,M,F,B){for(var $=null,W=null,K=M,te=M=0,ne=null;K!==null&&te<F.length;te++){K.index>te?(ne=K,K=null):ne=K.sibling;var ae=T(R,K,F[te],B);if(ae===null){K===null&&(K=ne);break}e&&K&&ae.alternate===null&&t(R,K),M=o(ae,M,te),W===null?$=ae:W.sibling=ae,W=ae,K=ne}if(te===F.length)return r(R,K),Ta&&Ly(R,te),$;if(K===null){for(;te<F.length;te++)K=w(R,F[te],B),K!==null&&(M=o(K,M,te),W===null?$=K:W.sibling=K,W=K);return Ta&&Ly(R,te),$}for(K=n(R,K);te<F.length;te++)ne=A(K,R,te,F[te],B),ne!==null&&(e&&ne.alternate!==null&&K.delete(ne.key===null?te:ne.key),M=o(ne,M,te),W===null?$=ne:W.sibling=ne,W=ne);return e&&K.forEach(function(re){return t(R,re)}),Ta&&Ly(R,te),$}function P(R,M,F,B){var $=kS(F);if(typeof $!="function")throw Error(Fr(150));if(F=$.call(F),F==null)throw Error(Fr(151));for(var W=$=null,K=M,te=M=0,ne=null,ae=F.next();K!==null&&!ae.done;te++,ae=F.next()){K.index>te?(ne=K,K=null):ne=K.sibling;var re=T(R,K,ae.value,B);if(re===null){K===null&&(K=ne);break}e&&K&&re.alternate===null&&t(R,K),M=o(re,M,te),W===null?$=re:W.sibling=re,W=re,K=ne}if(ae.done)return r(R,K),Ta&&Ly(R,te),$;if(K===null){for(;!ae.done;te++,ae=F.next())ae=w(R,ae.value,B),ae!==null&&(M=o(ae,M,te),W===null?$=ae:W.sibling=ae,W=ae);return Ta&&Ly(R,te),$}for(K=n(R,K);!ae.done;te++,ae=F.next())ae=A(K,R,te,ae.value,B),ae!==null&&(e&&ae.alternate!==null&&K.delete(ae.key===null?te:ae.key),M=o(ae,M,te),W===null?$=ae:W.sibling=ae,W=ae);return e&&K.forEach(function(ee){return t(R,ee)}),Ta&&Ly(R,te),$}function N(R,M,F,B){if(typeof F=="object"&&F!==null&&F.type===n0&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case GC:e:{for(var $=F.key,W=M;W!==null;){if(W.key===$){if($=F.type,$===n0){if(W.tag===7){r(R,W.sibling),M=s(W,F.props.children),M.return=R,R=M;break e}}else if(W.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Sm&&n9($)===W.type){r(R,W.sibling),M=s(W,F.props),M.ref=DS(R,W,F),M.return=R,R=M;break e}r(R,W);break}else t(R,W);W=W.sibling}F.type===n0?(M=gv(F.props.children,R.mode,B,F.key),M.return=R,R=M):(B=Jj(F.type,F.key,F.props,null,R.mode,B),B.ref=DS(R,M,F),B.return=R,R=B)}return d(R);case r0:e:{for(W=F.key;M!==null;){if(M.key===W)if(M.tag===4&&M.stateNode.containerInfo===F.containerInfo&&M.stateNode.implementation===F.implementation){r(R,M.sibling),M=s(M,F.children||[]),M.return=R,R=M;break e}else{r(R,M);break}else t(R,M);M=M.sibling}M=bD(F,R.mode,B),M.return=R,R=M}return d(R);case Sm:return W=F._init,N(R,M,W(F._payload),B)}if(sE(F))return O(R,M,F,B);if(kS(F))return P(R,M,F,B);nj(R,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,M!==null&&M.tag===6?(r(R,M.sibling),M=s(M,F),M.return=R,R=M):(r(R,M),M=xD(F,R.mode,B),M.return=R,R=M),d(R)):r(R,M)}return N}var rb=ZY(!0),XY=ZY(!1),PP=vg(null),OP=null,d0=null,X4=null;function Y4(){X4=d0=OP=null}function J4(e){var t=PP.current;ma(PP),e._currentValue=t}function l3(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function C0(e,t){OP=e,X4=d0=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Uc=!0),e.firstContext=null)}function Zu(e){var t=e._currentValue;if(X4!==e)if(e={context:e,memoizedValue:t,next:null},d0===null){if(OP===null)throw Error(Fr(308));d0=e,OP.dependencies={lanes:0,firstContext:e}}else d0=d0.next=e;return t}var Xy=null;function Q4(e){Xy===null?Xy=[e]:Xy.push(e)}function YY(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,Q4(t)):(r.next=s.next,s.next=r),t.interleaved=r,np(e,n)}function np(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Em=!1;function eB(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JY(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Zf(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Qm(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ss&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,np(e,r)}return s=n.interleaved,s===null?(t.next=t,Q4(n)):(t.next=s.next,s.next=t),n.interleaved=t,np(e,r)}function Gj(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,z4(e,r)}}function i9(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var d={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?s=o=d:o=o.next=d,r=r.next}while(r!==null);o===null?s=o=t:o=o.next=t}else s=o=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function kP(e,t,r,n){var s=e.updateQueue;Em=!1;var o=s.firstBaseUpdate,d=s.lastBaseUpdate,i=s.shared.pending;if(i!==null){s.shared.pending=null;var m=i,y=m.next;m.next=null,d===null?o=y:d.next=y,d=m;var S=e.alternate;S!==null&&(S=S.updateQueue,i=S.lastBaseUpdate,i!==d&&(i===null?S.firstBaseUpdate=y:i.next=y,S.lastBaseUpdate=m))}if(o!==null){var w=s.baseState;d=0,S=y=m=null,i=o;do{var T=i.lane,A=i.eventTime;if((n&T)===T){S!==null&&(S=S.next={eventTime:A,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var O=e,P=i;switch(T=t,A=r,P.tag){case 1:if(O=P.payload,typeof O=="function"){w=O.call(A,w,T);break e}w=O;break e;case 3:O.flags=O.flags&-65537|128;case 0:if(O=P.payload,T=typeof O=="function"?O.call(A,w,T):O,T==null)break e;w=$a({},w,T);break e;case 2:Em=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,T=s.effects,T===null?s.effects=[i]:T.push(i))}else A={eventTime:A,lane:T,tag:i.tag,payload:i.payload,callback:i.callback,next:null},S===null?(y=S=A,m=w):S=S.next=A,d|=T;if(i=i.next,i===null){if(i=s.shared.pending,i===null)break;T=i,i=T.next,T.next=null,s.lastBaseUpdate=T,s.shared.pending=null}}while(!0);if(S===null&&(m=w),s.baseState=m,s.firstBaseUpdate=y,s.lastBaseUpdate=S,t=s.shared.interleaved,t!==null){s=t;do d|=s.lane,s=s.next;while(s!==t)}else o===null&&(s.shared.lanes=0);Sv|=d,e.lanes=d,e.memoizedState=w}}function s9(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(Fr(191,s));s.call(n)}}}var g2={},Dh=vg(g2),eT=vg(g2),tT=vg(g2);function Yy(e){if(e===g2)throw Error(Fr(174));return e}function tB(e,t){switch(ia(tT,t),ia(eT,e),ia(Dh,g2),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:UL(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=UL(t,e)}ma(Dh),ia(Dh,t)}function nb(){ma(Dh),ma(eT),ma(tT)}function QY(e){Yy(tT.current);var t=Yy(Dh.current),r=UL(t,e.type);t!==r&&(ia(eT,e),ia(Dh,r))}function rB(e){eT.current===e&&(ma(Dh),ma(eT))}var Da=vg(0);function NP(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var pD=[];function nB(){for(var e=0;e<pD.length;e++)pD[e]._workInProgressVersionPrimary=null;pD.length=0}var Wj=fp.ReactCurrentDispatcher,mD=fp.ReactCurrentBatchConfig,wv=0,Ba=null,Zo=null,ul=null,IP=!1,TE=!1,rT=0,$ye=0;function Dl(){throw Error(Fr(321))}function iB(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!qd(e[r],t[r]))return!1;return!0}function sB(e,t,r,n,s,o){if(wv=o,Ba=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Wj.current=e===null||e.memoizedState===null?Hye:Gye,e=r(n,s),TE){o=0;do{if(TE=!1,rT=0,25<=o)throw Error(Fr(301));o+=1,ul=Zo=null,t.updateQueue=null,Wj.current=Wye,e=r(n,s)}while(TE)}if(Wj.current=RP,t=Zo!==null&&Zo.next!==null,wv=0,ul=Zo=Ba=null,IP=!1,t)throw Error(Fr(300));return e}function aB(){var e=rT!==0;return rT=0,e}function yh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ul===null?Ba.memoizedState=ul=e:ul=ul.next=e,ul}function Xu(){if(Zo===null){var e=Ba.alternate;e=e!==null?e.memoizedState:null}else e=Zo.next;var t=ul===null?Ba.memoizedState:ul.next;if(t!==null)ul=t,Zo=e;else{if(e===null)throw Error(Fr(310));Zo=e,e={memoizedState:Zo.memoizedState,baseState:Zo.baseState,baseQueue:Zo.baseQueue,queue:Zo.queue,next:null},ul===null?Ba.memoizedState=ul=e:ul=ul.next=e}return ul}function nT(e,t){return typeof t=="function"?t(e):t}function gD(e){var t=Xu(),r=t.queue;if(r===null)throw Error(Fr(311));r.lastRenderedReducer=e;var n=Zo,s=n.baseQueue,o=r.pending;if(o!==null){if(s!==null){var d=s.next;s.next=o.next,o.next=d}n.baseQueue=s=o,r.pending=null}if(s!==null){o=s.next,n=n.baseState;var i=d=null,m=null,y=o;do{var S=y.lane;if((wv&S)===S)m!==null&&(m=m.next={lane:0,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null}),n=y.hasEagerState?y.eagerState:e(n,y.action);else{var w={lane:S,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null};m===null?(i=m=w,d=n):m=m.next=w,Ba.lanes|=S,Sv|=S}y=y.next}while(y!==null&&y!==o);m===null?d=n:m.next=i,qd(n,t.memoizedState)||(Uc=!0),t.memoizedState=n,t.baseState=d,t.baseQueue=m,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do o=s.lane,Ba.lanes|=o,Sv|=o,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function yD(e){var t=Xu(),r=t.queue;if(r===null)throw Error(Fr(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,o=t.memoizedState;if(s!==null){r.pending=null;var d=s=s.next;do o=e(o,d.action),d=d.next;while(d!==s);qd(o,t.memoizedState)||(Uc=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function eJ(){}function tJ(e,t){var r=Ba,n=Xu(),s=t(),o=!qd(n.memoizedState,s);if(o&&(n.memoizedState=s,Uc=!0),n=n.queue,oB(iJ.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||ul!==null&&ul.memoizedState.tag&1){if(r.flags|=2048,iT(9,nJ.bind(null,r,n,s,t),void 0,null),hl===null)throw Error(Fr(349));wv&30||rJ(r,t,s)}return s}function rJ(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ba.updateQueue,t===null?(t={lastEffect:null,stores:null},Ba.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function nJ(e,t,r,n){t.value=r,t.getSnapshot=n,sJ(t)&&aJ(e)}function iJ(e,t,r){return r(function(){sJ(t)&&aJ(e)})}function sJ(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!qd(e,r)}catch{return!0}}function aJ(e){var t=np(e,1);t!==null&&$d(t,e,1,-1)}function a9(e){var t=yh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:nT,lastRenderedState:e},t.queue=e,e=e.dispatch=qye.bind(null,Ba,e),[t.memoizedState,e]}function iT(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Ba.updateQueue,t===null?(t={lastEffect:null,stores:null},Ba.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function oJ(){return Xu().memoizedState}function Kj(e,t,r,n){var s=yh();Ba.flags|=e,s.memoizedState=iT(1|t,r,void 0,n===void 0?null:n)}function Uk(e,t,r,n){var s=Xu();n=n===void 0?null:n;var o=void 0;if(Zo!==null){var d=Zo.memoizedState;if(o=d.destroy,n!==null&&iB(n,d.deps)){s.memoizedState=iT(t,r,o,n);return}}Ba.flags|=e,s.memoizedState=iT(1|t,r,o,n)}function o9(e,t){return Kj(8390656,8,e,t)}function oB(e,t){return Uk(2048,8,e,t)}function lJ(e,t){return Uk(4,2,e,t)}function cJ(e,t){return Uk(4,4,e,t)}function uJ(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function dJ(e,t,r){return r=r!=null?r.concat([e]):null,Uk(4,4,uJ.bind(null,t,e),r)}function lB(){}function hJ(e,t){var r=Xu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&iB(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function fJ(e,t){var r=Xu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&iB(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function pJ(e,t,r){return wv&21?(qd(r,t)||(r=_Y(),Ba.lanes|=r,Sv|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Uc=!0),e.memoizedState=r)}function Uye(e,t){var r=qs;qs=r!==0&&4>r?r:4,e(!0);var n=mD.transition;mD.transition={};try{e(!1),t()}finally{qs=r,mD.transition=n}}function mJ(){return Xu().memoizedState}function Vye(e,t,r){var n=tg(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},gJ(e))yJ(t,r);else if(r=YY(e,t,r,n),r!==null){var s=mc();$d(r,e,n,s),vJ(r,t,n)}}function qye(e,t,r){var n=tg(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(gJ(e))yJ(t,s);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var d=t.lastRenderedState,i=o(d,r);if(s.hasEagerState=!0,s.eagerState=i,qd(i,d)){var m=t.interleaved;m===null?(s.next=s,Q4(t)):(s.next=m.next,m.next=s),t.interleaved=s;return}}catch{}finally{}r=YY(e,t,s,n),r!==null&&(s=mc(),$d(r,e,n,s),vJ(r,t,n))}}function gJ(e){var t=e.alternate;return e===Ba||t!==null&&t===Ba}function yJ(e,t){TE=IP=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function vJ(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,z4(e,r)}}var RP={readContext:Zu,useCallback:Dl,useContext:Dl,useEffect:Dl,useImperativeHandle:Dl,useInsertionEffect:Dl,useLayoutEffect:Dl,useMemo:Dl,useReducer:Dl,useRef:Dl,useState:Dl,useDebugValue:Dl,useDeferredValue:Dl,useTransition:Dl,useMutableSource:Dl,useSyncExternalStore:Dl,useId:Dl,unstable_isNewReconciler:!1},Hye={readContext:Zu,useCallback:function(e,t){return yh().memoizedState=[e,t===void 0?null:t],e},useContext:Zu,useEffect:o9,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Kj(4194308,4,uJ.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Kj(4194308,4,e,t)},useInsertionEffect:function(e,t){return Kj(4,2,e,t)},useMemo:function(e,t){var r=yh();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=yh();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Vye.bind(null,Ba,e),[n.memoizedState,e]},useRef:function(e){var t=yh();return e={current:e},t.memoizedState=e},useState:a9,useDebugValue:lB,useDeferredValue:function(e){return yh().memoizedState=e},useTransition:function(){var e=a9(!1),t=e[0];return e=Uye.bind(null,e[1]),yh().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Ba,s=yh();if(Ta){if(r===void 0)throw Error(Fr(407));r=r()}else{if(r=t(),hl===null)throw Error(Fr(349));wv&30||rJ(n,t,r)}s.memoizedState=r;var o={value:r,getSnapshot:t};return s.queue=o,o9(iJ.bind(null,n,o,e),[e]),n.flags|=2048,iT(9,nJ.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=yh(),t=hl.identifierPrefix;if(Ta){var r=Uf,n=$f;r=(n&~(1<<32-Bd(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=rT++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=$ye++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Gye={readContext:Zu,useCallback:hJ,useContext:Zu,useEffect:oB,useImperativeHandle:dJ,useInsertionEffect:lJ,useLayoutEffect:cJ,useMemo:fJ,useReducer:gD,useRef:oJ,useState:function(){return gD(nT)},useDebugValue:lB,useDeferredValue:function(e){var t=Xu();return pJ(t,Zo.memoizedState,e)},useTransition:function(){var e=gD(nT)[0],t=Xu().memoizedState;return[e,t]},useMutableSource:eJ,useSyncExternalStore:tJ,useId:mJ,unstable_isNewReconciler:!1},Wye={readContext:Zu,useCallback:hJ,useContext:Zu,useEffect:oB,useImperativeHandle:dJ,useInsertionEffect:lJ,useLayoutEffect:cJ,useMemo:fJ,useReducer:yD,useRef:oJ,useState:function(){return yD(nT)},useDebugValue:lB,useDeferredValue:function(e){var t=Xu();return Zo===null?t.memoizedState=e:pJ(t,Zo.memoizedState,e)},useTransition:function(){var e=yD(nT)[0],t=Xu().memoizedState;return[e,t]},useMutableSource:eJ,useSyncExternalStore:tJ,useId:mJ,unstable_isNewReconciler:!1};function Cd(e,t){if(e&&e.defaultProps){t=$a({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function c3(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:$a({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Vk={isMounted:function(e){return(e=e._reactInternals)?Gv(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=mc(),s=tg(e),o=Zf(n,s);o.payload=t,r!=null&&(o.callback=r),t=Qm(e,o,s),t!==null&&($d(t,e,s,n),Gj(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=mc(),s=tg(e),o=Zf(n,s);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=Qm(e,o,s),t!==null&&($d(t,e,s,n),Gj(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=mc(),n=tg(e),s=Zf(r,n);s.tag=2,t!=null&&(s.callback=t),t=Qm(e,s,n),t!==null&&($d(t,e,n,r),Gj(t,e,n))}};function l9(e,t,r,n,s,o,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,d):t.prototype&&t.prototype.isPureReactComponent?!XE(r,n)||!XE(s,o):!0}function _J(e,t,r){var n=!1,s=cg,o=t.contextType;return typeof o=="object"&&o!==null?o=Zu(o):(s=Gc(t)?xv:Ul.current,n=t.contextTypes,o=(n=n!=null)?eb(e,s):cg),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Vk,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=o),t}function c9(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Vk.enqueueReplaceState(t,t.state,null)}function u3(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},eB(e);var o=t.contextType;typeof o=="object"&&o!==null?s.context=Zu(o):(o=Gc(t)?xv:Ul.current,s.context=eb(e,o)),s.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(c3(e,t,o,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&Vk.enqueueReplaceState(s,s.state,null),kP(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function ib(e,t){try{var r="",n=t;do r+=bge(n),n=n.return;while(n);var s=r}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:s,digest:null}}function vD(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function d3(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Kye=typeof WeakMap=="function"?WeakMap:Map;function xJ(e,t,r){r=Zf(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){DP||(DP=!0,b3=n),d3(e,t)},r}function bJ(e,t,r){r=Zf(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){d3(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){d3(e,t),typeof n!="function"&&(eg===null?eg=new Set([this]):eg.add(this));var d=t.stack;this.componentDidCatch(t.value,{componentStack:d!==null?d:""})}),r}function u9(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Kye;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=lve.bind(null,e,t,r),t.then(e,e))}function d9(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function h9(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Zf(-1,1),t.tag=2,Qm(r,t,1))),r.lanes|=1),e)}var Zye=fp.ReactCurrentOwner,Uc=!1;function oc(e,t,r,n){t.child=e===null?XY(t,null,r,n):rb(t,e.child,r,n)}function f9(e,t,r,n,s){r=r.render;var o=t.ref;return C0(t,s),n=sB(e,t,r,n,o,s),r=aB(),e!==null&&!Uc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,ip(e,t,s)):(Ta&&r&&W4(t),t.flags|=1,oc(e,t,n,s),t.child)}function p9(e,t,r,n,s){if(e===null){var o=r.type;return typeof o=="function"&&!gB(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,wJ(e,t,o,n,s)):(e=Jj(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&s)){var d=o.memoizedProps;if(r=r.compare,r=r!==null?r:XE,r(d,n)&&e.ref===t.ref)return ip(e,t,s)}return t.flags|=1,e=rg(o,n),e.ref=t.ref,e.return=t,t.child=e}function wJ(e,t,r,n,s){if(e!==null){var o=e.memoizedProps;if(XE(o,n)&&e.ref===t.ref)if(Uc=!1,t.pendingProps=n=o,(e.lanes&s)!==0)e.flags&131072&&(Uc=!0);else return t.lanes=e.lanes,ip(e,t,s)}return h3(e,t,r,n,s)}function SJ(e,t,r){var n=t.pendingProps,s=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ia(f0,ou),ou|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ia(f0,ou),ou|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,ia(f0,ou),ou|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,ia(f0,ou),ou|=n;return oc(e,t,s,r),t.child}function EJ(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function h3(e,t,r,n,s){var o=Gc(r)?xv:Ul.current;return o=eb(t,o),C0(t,s),r=sB(e,t,r,n,o,s),n=aB(),e!==null&&!Uc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,ip(e,t,s)):(Ta&&n&&W4(t),t.flags|=1,oc(e,t,r,s),t.child)}function m9(e,t,r,n,s){if(Gc(r)){var o=!0;AP(t)}else o=!1;if(C0(t,s),t.stateNode===null)Zj(e,t),_J(t,r,n),u3(t,r,n,s),n=!0;else if(e===null){var d=t.stateNode,i=t.memoizedProps;d.props=i;var m=d.context,y=r.contextType;typeof y=="object"&&y!==null?y=Zu(y):(y=Gc(r)?xv:Ul.current,y=eb(t,y));var S=r.getDerivedStateFromProps,w=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function";w||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(i!==n||m!==y)&&c9(t,d,n,y),Em=!1;var T=t.memoizedState;d.state=T,kP(t,n,d,s),m=t.memoizedState,i!==n||T!==m||Hc.current||Em?(typeof S=="function"&&(c3(t,r,S,n),m=t.memoizedState),(i=Em||l9(t,r,i,n,T,m,y))?(w||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=m),d.props=n,d.state=m,d.context=y,n=i):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{d=t.stateNode,JY(e,t),i=t.memoizedProps,y=t.type===t.elementType?i:Cd(t.type,i),d.props=y,w=t.pendingProps,T=d.context,m=r.contextType,typeof m=="object"&&m!==null?m=Zu(m):(m=Gc(r)?xv:Ul.current,m=eb(t,m));var A=r.getDerivedStateFromProps;(S=typeof A=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(i!==w||T!==m)&&c9(t,d,n,m),Em=!1,T=t.memoizedState,d.state=T,kP(t,n,d,s);var O=t.memoizedState;i!==w||T!==O||Hc.current||Em?(typeof A=="function"&&(c3(t,r,A,n),O=t.memoizedState),(y=Em||l9(t,r,y,n,T,O,m)||!1)?(S||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,O,m),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,O,m)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=O),d.props=n,d.state=O,d.context=m,n=y):(typeof d.componentDidUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),n=!1)}return f3(e,t,r,n,o,s)}function f3(e,t,r,n,s,o){EJ(e,t);var d=(t.flags&128)!==0;if(!n&&!d)return s&&e9(t,r,!1),ip(e,t,o);n=t.stateNode,Zye.current=t;var i=d&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&d?(t.child=rb(t,e.child,null,o),t.child=rb(t,null,i,o)):oc(e,t,i,o),t.memoizedState=n.state,s&&e9(t,r,!0),t.child}function TJ(e){var t=e.stateNode;t.pendingContext?Qq(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Qq(e,t.context,!1),tB(e,t.containerInfo)}function g9(e,t,r,n,s){return tb(),Z4(s),t.flags|=256,oc(e,t,r,n),t.child}var p3={dehydrated:null,treeContext:null,retryLane:0};function m3(e){return{baseLanes:e,cachePool:null,transitions:null}}function AJ(e,t,r){var n=t.pendingProps,s=Da.current,o=!1,d=(t.flags&128)!==0,i;if((i=d)||(i=e!==null&&e.memoizedState===null?!1:(s&2)!==0),i?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),ia(Da,s&1),e===null)return o3(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(d=n.children,e=n.fallback,o?(n=t.mode,o=t.child,d={mode:"hidden",children:d},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=d):o=Gk(d,n,0,null),e=gv(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=m3(r),t.memoizedState=p3,e):cB(t,d));if(s=e.memoizedState,s!==null&&(i=s.dehydrated,i!==null))return Xye(e,t,d,n,i,s,r);if(o){o=n.fallback,d=t.mode,s=e.child,i=s.sibling;var m={mode:"hidden",children:n.children};return!(d&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=m,t.deletions=null):(n=rg(s,m),n.subtreeFlags=s.subtreeFlags&14680064),i!==null?o=rg(i,o):(o=gv(o,d,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,d=e.child.memoizedState,d=d===null?m3(r):{baseLanes:d.baseLanes|r,cachePool:null,transitions:d.transitions},o.memoizedState=d,o.childLanes=e.childLanes&~r,t.memoizedState=p3,n}return o=e.child,e=o.sibling,n=rg(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function cB(e,t){return t=Gk({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function ij(e,t,r,n){return n!==null&&Z4(n),rb(t,e.child,null,r),e=cB(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Xye(e,t,r,n,s,o,d){if(r)return t.flags&256?(t.flags&=-257,n=vD(Error(Fr(422))),ij(e,t,d,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,s=t.mode,n=Gk({mode:"visible",children:n.children},s,0,null),o=gv(o,s,d,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&rb(t,e.child,null,d),t.child.memoizedState=m3(d),t.memoizedState=p3,o);if(!(t.mode&1))return ij(e,t,d,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var i=n.dgst;return n=i,o=Error(Fr(419)),n=vD(o,n,void 0),ij(e,t,d,n)}if(i=(d&e.childLanes)!==0,Uc||i){if(n=hl,n!==null){switch(d&-d){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|d)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,np(e,s),$d(n,e,s,-1))}return mB(),n=vD(Error(Fr(421))),ij(e,t,d,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=cve.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,mu=Jm(s.nextSibling),gu=t,Ta=!0,Md=null,e!==null&&(zu[Bu++]=$f,zu[Bu++]=Uf,zu[Bu++]=bv,$f=e.id,Uf=e.overflow,bv=t),t=cB(t,n.children),t.flags|=4096,t)}function y9(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),l3(e.return,t,r)}function _D(e,t,r,n,s){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=s)}function CJ(e,t,r){var n=t.pendingProps,s=n.revealOrder,o=n.tail;if(oc(e,t,n.children,r),n=Da.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&y9(e,r,t);else if(e.tag===19)y9(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ia(Da,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&NP(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),_D(t,!1,s,r,o);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&NP(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}_D(t,!0,r,null,o);break;case"together":_D(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Zj(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ip(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Sv|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Fr(153));if(t.child!==null){for(e=t.child,r=rg(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=rg(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Yye(e,t,r){switch(t.tag){case 3:TJ(t),tb();break;case 5:QY(t);break;case 1:Gc(t.type)&&AP(t);break;case 4:tB(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;ia(PP,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(ia(Da,Da.current&1),t.flags|=128,null):r&t.child.childLanes?AJ(e,t,r):(ia(Da,Da.current&1),e=ip(e,t,r),e!==null?e.sibling:null);ia(Da,Da.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return CJ(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ia(Da,Da.current),n)break;return null;case 22:case 23:return t.lanes=0,SJ(e,t,r)}return ip(e,t,r)}var jJ,g3,PJ,OJ;jJ=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};g3=function(){};PJ=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,Yy(Dh.current);var o=null;switch(r){case"input":s=FL(e,s),n=FL(e,n),o=[];break;case"select":s=$a({},s,{value:void 0}),n=$a({},n,{value:void 0}),o=[];break;case"textarea":s=$L(e,s),n=$L(e,n),o=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=EP)}VL(r,n);var d;r=null;for(y in s)if(!n.hasOwnProperty(y)&&s.hasOwnProperty(y)&&s[y]!=null)if(y==="style"){var i=s[y];for(d in i)i.hasOwnProperty(d)&&(r||(r={}),r[d]="")}else y!=="dangerouslySetInnerHTML"&&y!=="children"&&y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(VE.hasOwnProperty(y)?o||(o=[]):(o=o||[]).push(y,null));for(y in n){var m=n[y];if(i=s!=null?s[y]:void 0,n.hasOwnProperty(y)&&m!==i&&(m!=null||i!=null))if(y==="style")if(i){for(d in i)!i.hasOwnProperty(d)||m&&m.hasOwnProperty(d)||(r||(r={}),r[d]="");for(d in m)m.hasOwnProperty(d)&&i[d]!==m[d]&&(r||(r={}),r[d]=m[d])}else r||(o||(o=[]),o.push(y,r)),r=m;else y==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,i=i?i.__html:void 0,m!=null&&i!==m&&(o=o||[]).push(y,m)):y==="children"?typeof m!="string"&&typeof m!="number"||(o=o||[]).push(y,""+m):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&(VE.hasOwnProperty(y)?(m!=null&&y==="onScroll"&&ha("scroll",e),o||i===m||(o=[])):(o=o||[]).push(y,m))}r&&(o=o||[]).push("style",r);var y=o;(t.updateQueue=y)&&(t.flags|=4)}};OJ=function(e,t,r,n){r!==n&&(t.flags|=4)};function LS(e,t){if(!Ta)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Ll(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Jye(e,t,r){var n=t.pendingProps;switch(K4(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ll(t),null;case 1:return Gc(t.type)&&TP(),Ll(t),null;case 3:return n=t.stateNode,nb(),ma(Hc),ma(Ul),nB(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(rj(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Md!==null&&(E3(Md),Md=null))),g3(e,t),Ll(t),null;case 5:rB(t);var s=Yy(tT.current);if(r=t.type,e!==null&&t.stateNode!=null)PJ(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Fr(166));return Ll(t),null}if(e=Yy(Dh.current),rj(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[Sh]=t,n[QE]=o,e=(t.mode&1)!==0,r){case"dialog":ha("cancel",n),ha("close",n);break;case"iframe":case"object":case"embed":ha("load",n);break;case"video":case"audio":for(s=0;s<oE.length;s++)ha(oE[s],n);break;case"source":ha("error",n);break;case"img":case"image":case"link":ha("error",n),ha("load",n);break;case"details":ha("toggle",n);break;case"input":Aq(n,o),ha("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},ha("invalid",n);break;case"textarea":jq(n,o),ha("invalid",n)}VL(r,o),s=null;for(var d in o)if(o.hasOwnProperty(d)){var i=o[d];d==="children"?typeof i=="string"?n.textContent!==i&&(o.suppressHydrationWarning!==!0&&tj(n.textContent,i,e),s=["children",i]):typeof i=="number"&&n.textContent!==""+i&&(o.suppressHydrationWarning!==!0&&tj(n.textContent,i,e),s=["children",""+i]):VE.hasOwnProperty(d)&&i!=null&&d==="onScroll"&&ha("scroll",n)}switch(r){case"input":WC(n),Cq(n,o,!0);break;case"textarea":WC(n),Pq(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=EP)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{d=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=iY(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=d.createElement(r,{is:n.is}):(e=d.createElement(r),r==="select"&&(d=e,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):e=d.createElementNS(e,r),e[Sh]=t,e[QE]=n,jJ(e,t,!1,!1),t.stateNode=e;e:{switch(d=qL(r,n),r){case"dialog":ha("cancel",e),ha("close",e),s=n;break;case"iframe":case"object":case"embed":ha("load",e),s=n;break;case"video":case"audio":for(s=0;s<oE.length;s++)ha(oE[s],e);s=n;break;case"source":ha("error",e),s=n;break;case"img":case"image":case"link":ha("error",e),ha("load",e),s=n;break;case"details":ha("toggle",e),s=n;break;case"input":Aq(e,n),s=FL(e,n),ha("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=$a({},n,{value:void 0}),ha("invalid",e);break;case"textarea":jq(e,n),s=$L(e,n),ha("invalid",e);break;default:s=n}VL(r,s),i=s;for(o in i)if(i.hasOwnProperty(o)){var m=i[o];o==="style"?oY(e,m):o==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,m!=null&&sY(e,m)):o==="children"?typeof m=="string"?(r!=="textarea"||m!=="")&&qE(e,m):typeof m=="number"&&qE(e,""+m):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(VE.hasOwnProperty(o)?m!=null&&o==="onScroll"&&ha("scroll",e):m!=null&&I4(e,o,m,d))}switch(r){case"input":WC(e),Cq(e,n,!1);break;case"textarea":WC(e),Pq(e);break;case"option":n.value!=null&&e.setAttribute("value",""+lg(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?S0(e,!!n.multiple,o,!1):n.defaultValue!=null&&S0(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=EP)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ll(t),null;case 6:if(e&&t.stateNode!=null)OJ(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Fr(166));if(r=Yy(tT.current),Yy(Dh.current),rj(t)){if(n=t.stateNode,r=t.memoizedProps,n[Sh]=t,(o=n.nodeValue!==r)&&(e=gu,e!==null))switch(e.tag){case 3:tj(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&tj(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Sh]=t,t.stateNode=n}return Ll(t),null;case 13:if(ma(Da),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ta&&mu!==null&&t.mode&1&&!(t.flags&128))KY(),tb(),t.flags|=98560,o=!1;else if(o=rj(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(Fr(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Fr(317));o[Sh]=t}else tb(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ll(t),o=!1}else Md!==null&&(E3(Md),Md=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Da.current&1?Qo===0&&(Qo=3):mB())),t.updateQueue!==null&&(t.flags|=4),Ll(t),null);case 4:return nb(),g3(e,t),e===null&&YE(t.stateNode.containerInfo),Ll(t),null;case 10:return J4(t.type._context),Ll(t),null;case 17:return Gc(t.type)&&TP(),Ll(t),null;case 19:if(ma(Da),o=t.memoizedState,o===null)return Ll(t),null;if(n=(t.flags&128)!==0,d=o.rendering,d===null)if(n)LS(o,!1);else{if(Qo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(d=NP(e),d!==null){for(t.flags|=128,LS(o,!1),n=d.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,d=o.alternate,d===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=d.childLanes,o.lanes=d.lanes,o.child=d.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=d.memoizedProps,o.memoizedState=d.memoizedState,o.updateQueue=d.updateQueue,o.type=d.type,e=d.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ia(Da,Da.current&1|2),t.child}e=e.sibling}o.tail!==null&&go()>sb&&(t.flags|=128,n=!0,LS(o,!1),t.lanes=4194304)}else{if(!n)if(e=NP(d),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),LS(o,!0),o.tail===null&&o.tailMode==="hidden"&&!d.alternate&&!Ta)return Ll(t),null}else 2*go()-o.renderingStartTime>sb&&r!==1073741824&&(t.flags|=128,n=!0,LS(o,!1),t.lanes=4194304);o.isBackwards?(d.sibling=t.child,t.child=d):(r=o.last,r!==null?r.sibling=d:t.child=d,o.last=d)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=go(),t.sibling=null,r=Da.current,ia(Da,n?r&1|2:r&1),t):(Ll(t),null);case 22:case 23:return pB(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?ou&1073741824&&(Ll(t),t.subtreeFlags&6&&(t.flags|=8192)):Ll(t),null;case 24:return null;case 25:return null}throw Error(Fr(156,t.tag))}function Qye(e,t){switch(K4(t),t.tag){case 1:return Gc(t.type)&&TP(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return nb(),ma(Hc),ma(Ul),nB(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return rB(t),null;case 13:if(ma(Da),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Fr(340));tb()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ma(Da),null;case 4:return nb(),null;case 10:return J4(t.type._context),null;case 22:case 23:return pB(),null;case 24:return null;default:return null}}var sj=!1,Bl=!1,eve=typeof WeakSet=="function"?WeakSet:Set,Sn=null;function h0(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){eo(e,t,n)}else r.current=null}function y3(e,t,r){try{r()}catch(n){eo(e,t,n)}}var v9=!1;function tve(e,t){if(e3=bP,e=MY(),G4(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var d=0,i=-1,m=-1,y=0,S=0,w=e,T=null;t:for(;;){for(var A;w!==r||s!==0&&w.nodeType!==3||(i=d+s),w!==o||n!==0&&w.nodeType!==3||(m=d+n),w.nodeType===3&&(d+=w.nodeValue.length),(A=w.firstChild)!==null;)T=w,w=A;for(;;){if(w===e)break t;if(T===r&&++y===s&&(i=d),T===o&&++S===n&&(m=d),(A=w.nextSibling)!==null)break;w=T,T=w.parentNode}w=A}r=i===-1||m===-1?null:{start:i,end:m}}else r=null}r=r||{start:0,end:0}}else r=null;for(t3={focusedElem:e,selectionRange:r},bP=!1,Sn=t;Sn!==null;)if(t=Sn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Sn=e;else for(;Sn!==null;){t=Sn;try{var O=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(O!==null){var P=O.memoizedProps,N=O.memoizedState,R=t.stateNode,M=R.getSnapshotBeforeUpdate(t.elementType===t.type?P:Cd(t.type,P),N);R.__reactInternalSnapshotBeforeUpdate=M}break;case 3:var F=t.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Fr(163))}}catch(B){eo(t,t.return,B)}if(e=t.sibling,e!==null){e.return=t.return,Sn=e;break}Sn=t.return}return O=v9,v9=!1,O}function AE(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var o=s.destroy;s.destroy=void 0,o!==void 0&&y3(t,r,o)}s=s.next}while(s!==n)}}function qk(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function v3(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function kJ(e){var t=e.alternate;t!==null&&(e.alternate=null,kJ(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Sh],delete t[QE],delete t[i3],delete t[Lye],delete t[Fye])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function NJ(e){return e.tag===5||e.tag===3||e.tag===4}function _9(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||NJ(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function _3(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=EP));else if(n!==4&&(e=e.child,e!==null))for(_3(e,t,r),e=e.sibling;e!==null;)_3(e,t,r),e=e.sibling}function x3(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(x3(e,t,r),e=e.sibling;e!==null;)x3(e,t,r),e=e.sibling}var El=null,kd=!1;function hm(e,t,r){for(r=r.child;r!==null;)IJ(e,t,r),r=r.sibling}function IJ(e,t,r){if(Mh&&typeof Mh.onCommitFiberUnmount=="function")try{Mh.onCommitFiberUnmount(Dk,r)}catch{}switch(r.tag){case 5:Bl||h0(r,t);case 6:var n=El,s=kd;El=null,hm(e,t,r),El=n,kd=s,El!==null&&(kd?(e=El,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):El.removeChild(r.stateNode));break;case 18:El!==null&&(kd?(e=El,r=r.stateNode,e.nodeType===8?hD(e.parentNode,r):e.nodeType===1&&hD(e,r),KE(e)):hD(El,r.stateNode));break;case 4:n=El,s=kd,El=r.stateNode.containerInfo,kd=!0,hm(e,t,r),El=n,kd=s;break;case 0:case 11:case 14:case 15:if(!Bl&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var o=s,d=o.destroy;o=o.tag,d!==void 0&&(o&2||o&4)&&y3(r,t,d),s=s.next}while(s!==n)}hm(e,t,r);break;case 1:if(!Bl&&(h0(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(i){eo(r,t,i)}hm(e,t,r);break;case 21:hm(e,t,r);break;case 22:r.mode&1?(Bl=(n=Bl)||r.memoizedState!==null,hm(e,t,r),Bl=n):hm(e,t,r);break;default:hm(e,t,r)}}function x9(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new eve),t.forEach(function(n){var s=uve.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function bd(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var o=e,d=t,i=d;e:for(;i!==null;){switch(i.tag){case 5:El=i.stateNode,kd=!1;break e;case 3:El=i.stateNode.containerInfo,kd=!0;break e;case 4:El=i.stateNode.containerInfo,kd=!0;break e}i=i.return}if(El===null)throw Error(Fr(160));IJ(o,d,s),El=null,kd=!1;var m=s.alternate;m!==null&&(m.return=null),s.return=null}catch(y){eo(s,t,y)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)RJ(t,e),t=t.sibling}function RJ(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(bd(t,e),mh(e),n&4){try{AE(3,e,e.return),qk(3,e)}catch(P){eo(e,e.return,P)}try{AE(5,e,e.return)}catch(P){eo(e,e.return,P)}}break;case 1:bd(t,e),mh(e),n&512&&r!==null&&h0(r,r.return);break;case 5:if(bd(t,e),mh(e),n&512&&r!==null&&h0(r,r.return),e.flags&32){var s=e.stateNode;try{qE(s,"")}catch(P){eo(e,e.return,P)}}if(n&4&&(s=e.stateNode,s!=null)){var o=e.memoizedProps,d=r!==null?r.memoizedProps:o,i=e.type,m=e.updateQueue;if(e.updateQueue=null,m!==null)try{i==="input"&&o.type==="radio"&&o.name!=null&&rY(s,o),qL(i,d);var y=qL(i,o);for(d=0;d<m.length;d+=2){var S=m[d],w=m[d+1];S==="style"?oY(s,w):S==="dangerouslySetInnerHTML"?sY(s,w):S==="children"?qE(s,w):I4(s,S,w,y)}switch(i){case"input":zL(s,o);break;case"textarea":nY(s,o);break;case"select":var T=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var A=o.value;A!=null?S0(s,!!o.multiple,A,!1):T!==!!o.multiple&&(o.defaultValue!=null?S0(s,!!o.multiple,o.defaultValue,!0):S0(s,!!o.multiple,o.multiple?[]:"",!1))}s[QE]=o}catch(P){eo(e,e.return,P)}}break;case 6:if(bd(t,e),mh(e),n&4){if(e.stateNode===null)throw Error(Fr(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(P){eo(e,e.return,P)}}break;case 3:if(bd(t,e),mh(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{KE(t.containerInfo)}catch(P){eo(e,e.return,P)}break;case 4:bd(t,e),mh(e);break;case 13:bd(t,e),mh(e),s=e.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(hB=go())),n&4&&x9(e);break;case 22:if(S=r!==null&&r.memoizedState!==null,e.mode&1?(Bl=(y=Bl)||S,bd(t,e),Bl=y):bd(t,e),mh(e),n&8192){if(y=e.memoizedState!==null,(e.stateNode.isHidden=y)&&!S&&e.mode&1)for(Sn=e,S=e.child;S!==null;){for(w=Sn=S;Sn!==null;){switch(T=Sn,A=T.child,T.tag){case 0:case 11:case 14:case 15:AE(4,T,T.return);break;case 1:h0(T,T.return);var O=T.stateNode;if(typeof O.componentWillUnmount=="function"){n=T,r=T.return;try{t=n,O.props=t.memoizedProps,O.state=t.memoizedState,O.componentWillUnmount()}catch(P){eo(n,r,P)}}break;case 5:h0(T,T.return);break;case 22:if(T.memoizedState!==null){w9(w);continue}}A!==null?(A.return=T,Sn=A):w9(w)}S=S.sibling}e:for(S=null,w=e;;){if(w.tag===5){if(S===null){S=w;try{s=w.stateNode,y?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(i=w.stateNode,m=w.memoizedProps.style,d=m!=null&&m.hasOwnProperty("display")?m.display:null,i.style.display=aY("display",d))}catch(P){eo(e,e.return,P)}}}else if(w.tag===6){if(S===null)try{w.stateNode.nodeValue=y?"":w.memoizedProps}catch(P){eo(e,e.return,P)}}else if((w.tag!==22&&w.tag!==23||w.memoizedState===null||w===e)&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===e)break e;for(;w.sibling===null;){if(w.return===null||w.return===e)break e;S===w&&(S=null),w=w.return}S===w&&(S=null),w.sibling.return=w.return,w=w.sibling}}break;case 19:bd(t,e),mh(e),n&4&&x9(e);break;case 21:break;default:bd(t,e),mh(e)}}function mh(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(NJ(r)){var n=r;break e}r=r.return}throw Error(Fr(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(qE(s,""),n.flags&=-33);var o=_9(e);x3(e,o,s);break;case 3:case 4:var d=n.stateNode.containerInfo,i=_9(e);_3(e,i,d);break;default:throw Error(Fr(161))}}catch(m){eo(e,e.return,m)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function rve(e,t,r){Sn=e,MJ(e)}function MJ(e,t,r){for(var n=(e.mode&1)!==0;Sn!==null;){var s=Sn,o=s.child;if(s.tag===22&&n){var d=s.memoizedState!==null||sj;if(!d){var i=s.alternate,m=i!==null&&i.memoizedState!==null||Bl;i=sj;var y=Bl;if(sj=d,(Bl=m)&&!y)for(Sn=s;Sn!==null;)d=Sn,m=d.child,d.tag===22&&d.memoizedState!==null?S9(s):m!==null?(m.return=d,Sn=m):S9(s);for(;o!==null;)Sn=o,MJ(o),o=o.sibling;Sn=s,sj=i,Bl=y}b9(e)}else s.subtreeFlags&8772&&o!==null?(o.return=s,Sn=o):b9(e)}}function b9(e){for(;Sn!==null;){var t=Sn;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Bl||qk(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Bl)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:Cd(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&s9(t,o,n);break;case 3:var d=t.updateQueue;if(d!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}s9(t,d,r)}break;case 5:var i=t.stateNode;if(r===null&&t.flags&4){r=i;var m=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":m.autoFocus&&r.focus();break;case"img":m.src&&(r.src=m.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var y=t.alternate;if(y!==null){var S=y.memoizedState;if(S!==null){var w=S.dehydrated;w!==null&&KE(w)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Fr(163))}Bl||t.flags&512&&v3(t)}catch(T){eo(t,t.return,T)}}if(t===e){Sn=null;break}if(r=t.sibling,r!==null){r.return=t.return,Sn=r;break}Sn=t.return}}function w9(e){for(;Sn!==null;){var t=Sn;if(t===e){Sn=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Sn=r;break}Sn=t.return}}function S9(e){for(;Sn!==null;){var t=Sn;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{qk(4,t)}catch(m){eo(t,r,m)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(m){eo(t,s,m)}}var o=t.return;try{v3(t)}catch(m){eo(t,o,m)}break;case 5:var d=t.return;try{v3(t)}catch(m){eo(t,d,m)}}}catch(m){eo(t,t.return,m)}if(t===e){Sn=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Sn=i;break}Sn=t.return}}var nve=Math.ceil,MP=fp.ReactCurrentDispatcher,uB=fp.ReactCurrentOwner,Wu=fp.ReactCurrentBatchConfig,Ss=0,hl=null,Ro=null,Al=0,ou=0,f0=vg(0),Qo=0,sT=null,Sv=0,Hk=0,dB=0,CE=null,zc=null,hB=0,sb=1/0,Rf=null,DP=!1,b3=null,eg=null,aj=!1,Hm=null,LP=0,jE=0,w3=null,Xj=-1,Yj=0;function mc(){return Ss&6?go():Xj!==-1?Xj:Xj=go()}function tg(e){return e.mode&1?Ss&2&&Al!==0?Al&-Al:Bye.transition!==null?(Yj===0&&(Yj=_Y()),Yj):(e=qs,e!==0||(e=window.event,e=e===void 0?16:AY(e.type)),e):1}function $d(e,t,r,n){if(50<jE)throw jE=0,w3=null,Error(Fr(185));f2(e,r,n),(!(Ss&2)||e!==hl)&&(e===hl&&(!(Ss&2)&&(Hk|=r),Qo===4&&Pm(e,Al)),Wc(e,n),r===1&&Ss===0&&!(t.mode&1)&&(sb=go()+500,$k&&_g()))}function Wc(e,t){var r=e.callbackNode;Bge(e,t);var n=xP(e,e===hl?Al:0);if(n===0)r!==null&&Nq(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&Nq(r),t===1)e.tag===0?zye(E9.bind(null,e)):HY(E9.bind(null,e)),Mye(function(){!(Ss&6)&&_g()}),r=null;else{switch(xY(n)){case 1:r=F4;break;case 4:r=yY;break;case 16:r=_P;break;case 536870912:r=vY;break;default:r=_P}r=VJ(r,DJ.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function DJ(e,t){if(Xj=-1,Yj=0,Ss&6)throw Error(Fr(327));var r=e.callbackNode;if(j0()&&e.callbackNode!==r)return null;var n=xP(e,e===hl?Al:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=FP(e,n);else{t=n;var s=Ss;Ss|=2;var o=FJ();(hl!==e||Al!==t)&&(Rf=null,sb=go()+500,mv(e,t));do try{ave();break}catch(i){LJ(e,i)}while(!0);Y4(),MP.current=o,Ss=s,Ro!==null?t=0:(hl=null,Al=0,t=Qo)}if(t!==0){if(t===2&&(s=ZL(e),s!==0&&(n=s,t=S3(e,s))),t===1)throw r=sT,mv(e,0),Pm(e,n),Wc(e,go()),r;if(t===6)Pm(e,n);else{if(s=e.current.alternate,!(n&30)&&!ive(s)&&(t=FP(e,n),t===2&&(o=ZL(e),o!==0&&(n=o,t=S3(e,o))),t===1))throw r=sT,mv(e,0),Pm(e,n),Wc(e,go()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(Fr(345));case 2:Fy(e,zc,Rf);break;case 3:if(Pm(e,n),(n&130023424)===n&&(t=hB+500-go(),10<t)){if(xP(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){mc(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=n3(Fy.bind(null,e,zc,Rf),t);break}Fy(e,zc,Rf);break;case 4:if(Pm(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var d=31-Bd(n);o=1<<d,d=t[d],d>s&&(s=d),n&=~o}if(n=s,n=go()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*nve(n/1960))-n,10<n){e.timeoutHandle=n3(Fy.bind(null,e,zc,Rf),n);break}Fy(e,zc,Rf);break;case 5:Fy(e,zc,Rf);break;default:throw Error(Fr(329))}}}return Wc(e,go()),e.callbackNode===r?DJ.bind(null,e):null}function S3(e,t){var r=CE;return e.current.memoizedState.isDehydrated&&(mv(e,t).flags|=256),e=FP(e,t),e!==2&&(t=zc,zc=r,t!==null&&E3(t)),e}function E3(e){zc===null?zc=e:zc.push.apply(zc,e)}function ive(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],o=s.getSnapshot;s=s.value;try{if(!qd(o(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Pm(e,t){for(t&=~dB,t&=~Hk,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Bd(t),n=1<<r;e[r]=-1,t&=~n}}function E9(e){if(Ss&6)throw Error(Fr(327));j0();var t=xP(e,0);if(!(t&1))return Wc(e,go()),null;var r=FP(e,t);if(e.tag!==0&&r===2){var n=ZL(e);n!==0&&(t=n,r=S3(e,n))}if(r===1)throw r=sT,mv(e,0),Pm(e,t),Wc(e,go()),r;if(r===6)throw Error(Fr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Fy(e,zc,Rf),Wc(e,go()),null}function fB(e,t){var r=Ss;Ss|=1;try{return e(t)}finally{Ss=r,Ss===0&&(sb=go()+500,$k&&_g())}}function Ev(e){Hm!==null&&Hm.tag===0&&!(Ss&6)&&j0();var t=Ss;Ss|=1;var r=Wu.transition,n=qs;try{if(Wu.transition=null,qs=1,e)return e()}finally{qs=n,Wu.transition=r,Ss=t,!(Ss&6)&&_g()}}function pB(){ou=f0.current,ma(f0)}function mv(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Rye(r)),Ro!==null)for(r=Ro.return;r!==null;){var n=r;switch(K4(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&TP();break;case 3:nb(),ma(Hc),ma(Ul),nB();break;case 5:rB(n);break;case 4:nb();break;case 13:ma(Da);break;case 19:ma(Da);break;case 10:J4(n.type._context);break;case 22:case 23:pB()}r=r.return}if(hl=e,Ro=e=rg(e.current,null),Al=ou=t,Qo=0,sT=null,dB=Hk=Sv=0,zc=CE=null,Xy!==null){for(t=0;t<Xy.length;t++)if(r=Xy[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,o=r.pending;if(o!==null){var d=o.next;o.next=s,n.next=d}r.pending=n}Xy=null}return e}function LJ(e,t){do{var r=Ro;try{if(Y4(),Wj.current=RP,IP){for(var n=Ba.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}IP=!1}if(wv=0,ul=Zo=Ba=null,TE=!1,rT=0,uB.current=null,r===null||r.return===null){Qo=1,sT=t,Ro=null;break}e:{var o=e,d=r.return,i=r,m=t;if(t=Al,i.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){var y=m,S=i,w=S.tag;if(!(S.mode&1)&&(w===0||w===11||w===15)){var T=S.alternate;T?(S.updateQueue=T.updateQueue,S.memoizedState=T.memoizedState,S.lanes=T.lanes):(S.updateQueue=null,S.memoizedState=null)}var A=d9(d);if(A!==null){A.flags&=-257,h9(A,d,i,o,t),A.mode&1&&u9(o,y,t),t=A,m=y;var O=t.updateQueue;if(O===null){var P=new Set;P.add(m),t.updateQueue=P}else O.add(m);break e}else{if(!(t&1)){u9(o,y,t),mB();break e}m=Error(Fr(426))}}else if(Ta&&i.mode&1){var N=d9(d);if(N!==null){!(N.flags&65536)&&(N.flags|=256),h9(N,d,i,o,t),Z4(ib(m,i));break e}}o=m=ib(m,i),Qo!==4&&(Qo=2),CE===null?CE=[o]:CE.push(o),o=d;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var R=xJ(o,m,t);i9(o,R);break e;case 1:i=m;var M=o.type,F=o.stateNode;if(!(o.flags&128)&&(typeof M.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(eg===null||!eg.has(F)))){o.flags|=65536,t&=-t,o.lanes|=t;var B=bJ(o,i,t);i9(o,B);break e}}o=o.return}while(o!==null)}BJ(r)}catch($){t=$,Ro===r&&r!==null&&(Ro=r=r.return);continue}break}while(!0)}function FJ(){var e=MP.current;return MP.current=RP,e===null?RP:e}function mB(){(Qo===0||Qo===3||Qo===2)&&(Qo=4),hl===null||!(Sv&268435455)&&!(Hk&268435455)||Pm(hl,Al)}function FP(e,t){var r=Ss;Ss|=2;var n=FJ();(hl!==e||Al!==t)&&(Rf=null,mv(e,t));do try{sve();break}catch(s){LJ(e,s)}while(!0);if(Y4(),Ss=r,MP.current=n,Ro!==null)throw Error(Fr(261));return hl=null,Al=0,Qo}function sve(){for(;Ro!==null;)zJ(Ro)}function ave(){for(;Ro!==null&&!kge();)zJ(Ro)}function zJ(e){var t=UJ(e.alternate,e,ou);e.memoizedProps=e.pendingProps,t===null?BJ(e):Ro=t,uB.current=null}function BJ(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Qye(r,t),r!==null){r.flags&=32767,Ro=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Qo=6,Ro=null;return}}else if(r=Jye(r,t,ou),r!==null){Ro=r;return}if(t=t.sibling,t!==null){Ro=t;return}Ro=t=e}while(t!==null);Qo===0&&(Qo=5)}function Fy(e,t,r){var n=qs,s=Wu.transition;try{Wu.transition=null,qs=1,ove(e,t,r,n)}finally{Wu.transition=s,qs=n}return null}function ove(e,t,r,n){do j0();while(Hm!==null);if(Ss&6)throw Error(Fr(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Fr(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if($ge(e,o),e===hl&&(Ro=hl=null,Al=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||aj||(aj=!0,VJ(_P,function(){return j0(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=Wu.transition,Wu.transition=null;var d=qs;qs=1;var i=Ss;Ss|=4,uB.current=null,tve(e,r),RJ(r,e),Cye(t3),bP=!!e3,t3=e3=null,e.current=r,rve(r),Nge(),Ss=i,qs=d,Wu.transition=o}else e.current=r;if(aj&&(aj=!1,Hm=e,LP=s),o=e.pendingLanes,o===0&&(eg=null),Mge(r.stateNode),Wc(e,go()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(DP)throw DP=!1,e=b3,b3=null,e;return LP&1&&e.tag!==0&&j0(),o=e.pendingLanes,o&1?e===w3?jE++:(jE=0,w3=e):jE=0,_g(),null}function j0(){if(Hm!==null){var e=xY(LP),t=Wu.transition,r=qs;try{if(Wu.transition=null,qs=16>e?16:e,Hm===null)var n=!1;else{if(e=Hm,Hm=null,LP=0,Ss&6)throw Error(Fr(331));var s=Ss;for(Ss|=4,Sn=e.current;Sn!==null;){var o=Sn,d=o.child;if(Sn.flags&16){var i=o.deletions;if(i!==null){for(var m=0;m<i.length;m++){var y=i[m];for(Sn=y;Sn!==null;){var S=Sn;switch(S.tag){case 0:case 11:case 15:AE(8,S,o)}var w=S.child;if(w!==null)w.return=S,Sn=w;else for(;Sn!==null;){S=Sn;var T=S.sibling,A=S.return;if(kJ(S),S===y){Sn=null;break}if(T!==null){T.return=A,Sn=T;break}Sn=A}}}var O=o.alternate;if(O!==null){var P=O.child;if(P!==null){O.child=null;do{var N=P.sibling;P.sibling=null,P=N}while(P!==null)}}Sn=o}}if(o.subtreeFlags&2064&&d!==null)d.return=o,Sn=d;else e:for(;Sn!==null;){if(o=Sn,o.flags&2048)switch(o.tag){case 0:case 11:case 15:AE(9,o,o.return)}var R=o.sibling;if(R!==null){R.return=o.return,Sn=R;break e}Sn=o.return}}var M=e.current;for(Sn=M;Sn!==null;){d=Sn;var F=d.child;if(d.subtreeFlags&2064&&F!==null)F.return=d,Sn=F;else e:for(d=M;Sn!==null;){if(i=Sn,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:qk(9,i)}}catch($){eo(i,i.return,$)}if(i===d){Sn=null;break e}var B=i.sibling;if(B!==null){B.return=i.return,Sn=B;break e}Sn=i.return}}if(Ss=s,_g(),Mh&&typeof Mh.onPostCommitFiberRoot=="function")try{Mh.onPostCommitFiberRoot(Dk,e)}catch{}n=!0}return n}finally{qs=r,Wu.transition=t}}return!1}function T9(e,t,r){t=ib(r,t),t=xJ(e,t,1),e=Qm(e,t,1),t=mc(),e!==null&&(f2(e,1,t),Wc(e,t))}function eo(e,t,r){if(e.tag===3)T9(e,e,r);else for(;t!==null;){if(t.tag===3){T9(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(eg===null||!eg.has(n))){e=ib(r,e),e=bJ(t,e,1),t=Qm(t,e,1),e=mc(),t!==null&&(f2(t,1,e),Wc(t,e));break}}t=t.return}}function lve(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=mc(),e.pingedLanes|=e.suspendedLanes&r,hl===e&&(Al&r)===r&&(Qo===4||Qo===3&&(Al&130023424)===Al&&500>go()-hB?mv(e,0):dB|=r),Wc(e,t)}function $J(e,t){t===0&&(e.mode&1?(t=XC,XC<<=1,!(XC&130023424)&&(XC=4194304)):t=1);var r=mc();e=np(e,t),e!==null&&(f2(e,t,r),Wc(e,r))}function cve(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),$J(e,r)}function uve(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Fr(314))}n!==null&&n.delete(t),$J(e,r)}var UJ;UJ=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Hc.current)Uc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Uc=!1,Yye(e,t,r);Uc=!!(e.flags&131072)}else Uc=!1,Ta&&t.flags&1048576&&GY(t,jP,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Zj(e,t),e=t.pendingProps;var s=eb(t,Ul.current);C0(t,r),s=sB(null,t,n,e,s,r);var o=aB();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Gc(n)?(o=!0,AP(t)):o=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,eB(t),s.updater=Vk,t.stateNode=s,s._reactInternals=t,u3(t,n,e,r),t=f3(null,t,n,!0,o,r)):(t.tag=0,Ta&&o&&W4(t),oc(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Zj(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=hve(n),e=Cd(n,e),s){case 0:t=h3(null,t,n,e,r);break e;case 1:t=m9(null,t,n,e,r);break e;case 11:t=f9(null,t,n,e,r);break e;case 14:t=p9(null,t,n,Cd(n.type,e),r);break e}throw Error(Fr(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Cd(n,s),h3(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Cd(n,s),m9(e,t,n,s,r);case 3:e:{if(TJ(t),e===null)throw Error(Fr(387));n=t.pendingProps,o=t.memoizedState,s=o.element,JY(e,t),kP(t,n,null,r);var d=t.memoizedState;if(n=d.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){s=ib(Error(Fr(423)),t),t=g9(e,t,n,r,s);break e}else if(n!==s){s=ib(Error(Fr(424)),t),t=g9(e,t,n,r,s);break e}else for(mu=Jm(t.stateNode.containerInfo.firstChild),gu=t,Ta=!0,Md=null,r=XY(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(tb(),n===s){t=ip(e,t,r);break e}oc(e,t,n,r)}t=t.child}return t;case 5:return QY(t),e===null&&o3(t),n=t.type,s=t.pendingProps,o=e!==null?e.memoizedProps:null,d=s.children,r3(n,s)?d=null:o!==null&&r3(n,o)&&(t.flags|=32),EJ(e,t),oc(e,t,d,r),t.child;case 6:return e===null&&o3(t),null;case 13:return AJ(e,t,r);case 4:return tB(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=rb(t,null,n,r):oc(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Cd(n,s),f9(e,t,n,s,r);case 7:return oc(e,t,t.pendingProps,r),t.child;case 8:return oc(e,t,t.pendingProps.children,r),t.child;case 12:return oc(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,o=t.memoizedProps,d=s.value,ia(PP,n._currentValue),n._currentValue=d,o!==null)if(qd(o.value,d)){if(o.children===s.children&&!Hc.current){t=ip(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var i=o.dependencies;if(i!==null){d=o.child;for(var m=i.firstContext;m!==null;){if(m.context===n){if(o.tag===1){m=Zf(-1,r&-r),m.tag=2;var y=o.updateQueue;if(y!==null){y=y.shared;var S=y.pending;S===null?m.next=m:(m.next=S.next,S.next=m),y.pending=m}}o.lanes|=r,m=o.alternate,m!==null&&(m.lanes|=r),l3(o.return,r,t),i.lanes|=r;break}m=m.next}}else if(o.tag===10)d=o.type===t.type?null:o.child;else if(o.tag===18){if(d=o.return,d===null)throw Error(Fr(341));d.lanes|=r,i=d.alternate,i!==null&&(i.lanes|=r),l3(d,r,t),d=o.sibling}else d=o.child;if(d!==null)d.return=o;else for(d=o;d!==null;){if(d===t){d=null;break}if(o=d.sibling,o!==null){o.return=d.return,d=o;break}d=d.return}o=d}oc(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,C0(t,r),s=Zu(s),n=n(s),t.flags|=1,oc(e,t,n,r),t.child;case 14:return n=t.type,s=Cd(n,t.pendingProps),s=Cd(n.type,s),p9(e,t,n,s,r);case 15:return wJ(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Cd(n,s),Zj(e,t),t.tag=1,Gc(n)?(e=!0,AP(t)):e=!1,C0(t,r),_J(t,n,s),u3(t,n,s,r),f3(null,t,n,!0,e,r);case 19:return CJ(e,t,r);case 22:return SJ(e,t,r)}throw Error(Fr(156,t.tag))};function VJ(e,t){return gY(e,t)}function dve(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qu(e,t,r,n){return new dve(e,t,r,n)}function gB(e){return e=e.prototype,!(!e||!e.isReactComponent)}function hve(e){if(typeof e=="function")return gB(e)?1:0;if(e!=null){if(e=e.$$typeof,e===M4)return 11;if(e===D4)return 14}return 2}function rg(e,t){var r=e.alternate;return r===null?(r=qu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Jj(e,t,r,n,s,o){var d=2;if(n=e,typeof e=="function")gB(e)&&(d=1);else if(typeof e=="string")d=5;else e:switch(e){case n0:return gv(r.children,s,o,t);case R4:d=8,s|=8;break;case RL:return e=qu(12,r,t,s|2),e.elementType=RL,e.lanes=o,e;case ML:return e=qu(13,r,t,s),e.elementType=ML,e.lanes=o,e;case DL:return e=qu(19,r,t,s),e.elementType=DL,e.lanes=o,e;case QX:return Gk(r,s,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case YX:d=10;break e;case JX:d=9;break e;case M4:d=11;break e;case D4:d=14;break e;case Sm:d=16,n=null;break e}throw Error(Fr(130,e==null?e:typeof e,""))}return t=qu(d,r,t,s),t.elementType=e,t.type=n,t.lanes=o,t}function gv(e,t,r,n){return e=qu(7,e,n,t),e.lanes=r,e}function Gk(e,t,r,n){return e=qu(22,e,n,t),e.elementType=QX,e.lanes=r,e.stateNode={isHidden:!1},e}function xD(e,t,r){return e=qu(6,e,null,t),e.lanes=r,e}function bD(e,t,r){return t=qu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function fve(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tD(0),this.expirationTimes=tD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tD(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function yB(e,t,r,n,s,o,d,i,m){return e=new fve(e,t,r,i,m),t===1?(t=1,o===!0&&(t|=8)):t=0,o=qu(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},eB(o),e}function pve(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r0,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function qJ(e){if(!e)return cg;e=e._reactInternals;e:{if(Gv(e)!==e||e.tag!==1)throw Error(Fr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Gc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Fr(171))}if(e.tag===1){var r=e.type;if(Gc(r))return qY(e,r,t)}return t}function HJ(e,t,r,n,s,o,d,i,m){return e=yB(r,n,!0,e,s,o,d,i,m),e.context=qJ(null),r=e.current,n=mc(),s=tg(r),o=Zf(n,s),o.callback=t??null,Qm(r,o,s),e.current.lanes=s,f2(e,s,n),Wc(e,n),e}function Wk(e,t,r,n){var s=t.current,o=mc(),d=tg(s);return r=qJ(r),t.context===null?t.context=r:t.pendingContext=r,t=Zf(o,d),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Qm(s,t,d),e!==null&&($d(e,s,d,o),Gj(e,s,d)),d}function zP(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function A9(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function vB(e,t){A9(e,t),(e=e.alternate)&&A9(e,t)}function mve(){return null}var GJ=typeof reportError=="function"?reportError:function(e){console.error(e)};function _B(e){this._internalRoot=e}Kk.prototype.render=_B.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Fr(409));Wk(e,t,null,null)};Kk.prototype.unmount=_B.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ev(function(){Wk(null,e,null,null)}),t[rp]=null}};function Kk(e){this._internalRoot=e}Kk.prototype.unstable_scheduleHydration=function(e){if(e){var t=SY();e={blockedOn:null,target:e,priority:t};for(var r=0;r<jm.length&&t!==0&&t<jm[r].priority;r++);jm.splice(r,0,e),r===0&&TY(e)}};function xB(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Zk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function C9(){}function gve(e,t,r,n,s){if(s){if(typeof n=="function"){var o=n;n=function(){var y=zP(d);o.call(y)}}var d=HJ(t,n,e,0,null,!1,!1,"",C9);return e._reactRootContainer=d,e[rp]=d.current,YE(e.nodeType===8?e.parentNode:e),Ev(),d}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var i=n;n=function(){var y=zP(m);i.call(y)}}var m=yB(e,0,!1,null,null,!1,!1,"",C9);return e._reactRootContainer=m,e[rp]=m.current,YE(e.nodeType===8?e.parentNode:e),Ev(function(){Wk(t,m,r,n)}),m}function Xk(e,t,r,n,s){var o=r._reactRootContainer;if(o){var d=o;if(typeof s=="function"){var i=s;s=function(){var m=zP(d);i.call(m)}}Wk(t,d,e,s)}else d=gve(r,t,e,s,n);return zP(d)}bY=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=aE(t.pendingLanes);r!==0&&(z4(t,r|1),Wc(t,go()),!(Ss&6)&&(sb=go()+500,_g()))}break;case 13:Ev(function(){var n=np(e,1);if(n!==null){var s=mc();$d(n,e,1,s)}}),vB(e,1)}};B4=function(e){if(e.tag===13){var t=np(e,134217728);if(t!==null){var r=mc();$d(t,e,134217728,r)}vB(e,134217728)}};wY=function(e){if(e.tag===13){var t=tg(e),r=np(e,t);if(r!==null){var n=mc();$d(r,e,t,n)}vB(e,t)}};SY=function(){return qs};EY=function(e,t){var r=qs;try{return qs=e,t()}finally{qs=r}};GL=function(e,t,r){switch(t){case"input":if(zL(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=Bk(n);if(!s)throw Error(Fr(90));tY(n),zL(n,s)}}}break;case"textarea":nY(e,r);break;case"select":t=r.value,t!=null&&S0(e,!!r.multiple,t,!1)}};uY=fB;dY=Ev;var yve={usingClientEntryPoint:!1,Events:[m2,o0,Bk,lY,cY,fB]},FS={findFiberByHostInstance:Zy,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},vve={bundleType:FS.bundleType,version:FS.version,rendererPackageName:FS.rendererPackageName,rendererConfig:FS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:fp.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=pY(e),e===null?null:e.stateNode},findFiberByHostInstance:FS.findFiberByHostInstance||mve,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var oj=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!oj.isDisabled&&oj.supportsFiber)try{Dk=oj.inject(vve),Mh=oj}catch{}}Eu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yve;Eu.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xB(t))throw Error(Fr(200));return pve(e,t,null,r)};Eu.createRoot=function(e,t){if(!xB(e))throw Error(Fr(299));var r=!1,n="",s=GJ;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=yB(e,1,!1,null,null,r,!1,n,s),e[rp]=t.current,YE(e.nodeType===8?e.parentNode:e),new _B(t)};Eu.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Fr(188)):(e=Object.keys(e).join(","),Error(Fr(268,e)));return e=pY(t),e=e===null?null:e.stateNode,e};Eu.flushSync=function(e){return Ev(e)};Eu.hydrate=function(e,t,r){if(!Zk(t))throw Error(Fr(200));return Xk(null,e,t,!0,r)};Eu.hydrateRoot=function(e,t,r){if(!xB(e))throw Error(Fr(405));var n=r!=null&&r.hydratedSources||null,s=!1,o="",d=GJ;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(d=r.onRecoverableError)),t=HJ(t,null,e,1,r??null,s,!1,o,d),e[rp]=t.current,YE(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new Kk(t)};Eu.render=function(e,t,r){if(!Zk(t))throw Error(Fr(200));return Xk(null,e,t,!1,r)};Eu.unmountComponentAtNode=function(e){if(!Zk(e))throw Error(Fr(40));return e._reactRootContainer?(Ev(function(){Xk(null,null,e,!1,function(){e._reactRootContainer=null,e[rp]=null})}),!0):!1};Eu.unstable_batchedUpdates=fB;Eu.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!Zk(r))throw Error(Fr(200));if(e==null||e._reactInternals===void 0)throw Error(Fr(38));return Xk(e,t,r,!1,n)};Eu.version="18.3.1-next-f1338f8080-20240426";function WJ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(WJ)}catch(e){console.error(e)}}WJ(),WX.exports=Eu;var xg=WX.exports;const KJ=Ps(xg);var ZJ,j9=xg;ZJ=j9.createRoot,j9.hydrateRoot;const _ve=1,xve=1e6;let wD=0;function bve(){return wD=(wD+1)%Number.MAX_SAFE_INTEGER,wD.toString()}const SD=new Map,P9=e=>{if(SD.has(e))return;const t=setTimeout(()=>{SD.delete(e),PE({type:"REMOVE_TOAST",toastId:e})},xve);SD.set(e,t)},wve=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,_ve)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?P9(r):e.toasts.forEach(n=>{P9(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},Qj=[];let eP={toasts:[]};function PE(e){eP=wve(eP,e),Qj.forEach(t=>{t(eP)})}function ko({...e}){const t=bve(),r=s=>PE({type:"UPDATE_TOAST",toast:{...s,id:t}}),n=()=>PE({type:"DISMISS_TOAST",toastId:t});return PE({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:s=>{s||n()}}}),{id:t,dismiss:n,update:r}}function Ii(){const[e,t]=V.useState(eP);return V.useEffect(()=>(Qj.push(t),()=>{const r=Qj.indexOf(t);r>-1&&Qj.splice(r,1)}),[e]),{...e,toast:ko,dismiss:r=>PE({type:"DISMISS_TOAST",toastId:r})}}function Ir(e,t,{checkForDefaultPrevented:r=!0}={}){return function(s){if(e==null||e(s),r===!1||!s.defaultPrevented)return t==null?void 0:t(s)}}function O9(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Yk(...e){return t=>{let r=!1;const n=e.map(s=>{const o=O9(s,t);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let s=0;s<n.length;s++){const o=n[s];typeof o=="function"?o():O9(e[s],null)}}}}function $n(...e){return V.useCallback(Yk(...e),e)}function Sve(e,t){const r=V.createContext(t),n=o=>{const{children:d,...i}=o,m=V.useMemo(()=>i,Object.values(i));return h.jsx(r.Provider,{value:m,children:d})};n.displayName=e+"Provider";function s(o){const d=V.useContext(r);if(d)return d;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return[n,s]}function Fo(e,t=[]){let r=[];function n(o,d){const i=V.createContext(d),m=r.length;r=[...r,d];const y=w=>{var R;const{scope:T,children:A,...O}=w,P=((R=T==null?void 0:T[e])==null?void 0:R[m])||i,N=V.useMemo(()=>O,Object.values(O));return h.jsx(P.Provider,{value:N,children:A})};y.displayName=o+"Provider";function S(w,T){var P;const A=((P=T==null?void 0:T[e])==null?void 0:P[m])||i,O=V.useContext(A);if(O)return O;if(d!==void 0)return d;throw new Error(`\`${w}\` must be used within \`${o}\``)}return[y,S]}const s=()=>{const o=r.map(d=>V.createContext(d));return function(i){const m=(i==null?void 0:i[e])||o;return V.useMemo(()=>({[`__scope${e}`]:{...i,[e]:m}}),[i,m])}};return s.scopeName=e,[n,Eve(s,...t)]}function Eve(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const d=n.reduce((i,{useScope:m,scopeName:y})=>{const w=m(o)[`__scope${y}`];return{...i,...w}},{});return V.useMemo(()=>({[`__scope${t.scopeName}`]:d}),[d])}};return r.scopeName=t.scopeName,r}function ug(e){const t=Tve(e),r=V.forwardRef((n,s)=>{const{children:o,...d}=n,i=V.Children.toArray(o),m=i.find(Ave);if(m){const y=m.props.children,S=i.map(w=>w===m?V.Children.count(y)>1?V.Children.only(null):V.isValidElement(y)?y.props.children:null:w);return h.jsx(t,{...d,ref:s,children:V.isValidElement(y)?V.cloneElement(y,void 0,S):null})}return h.jsx(t,{...d,ref:s,children:o})});return r.displayName=`${e}.Slot`,r}var Wv=ug("Slot");function Tve(e){const t=V.forwardRef((r,n)=>{const{children:s,...o}=r;if(V.isValidElement(s)){const d=jve(s),i=Cve(o,s.props);return s.type!==V.Fragment&&(i.ref=n?Yk(n,d):d),V.cloneElement(s,i)}return V.Children.count(s)>1?V.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var XJ=Symbol("radix.slottable");function YJ(e){const t=({children:r})=>h.jsx(h.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=XJ,t}function Ave(e){return V.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===XJ}function Cve(e,t){const r={...t};for(const n in t){const s=e[n],o=t[n];/^on[A-Z]/.test(n)?s&&o?r[n]=(...i)=>{const m=o(...i);return s(...i),m}:s&&(r[n]=s):n==="style"?r[n]={...s,...o}:n==="className"&&(r[n]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}function jve(e){var n,s;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(s=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function y2(e){const t=e+"CollectionProvider",[r,n]=Fo(t),[s,o]=r(t,{collectionRef:{current:null},itemMap:new Map}),d=P=>{const{scope:N,children:R}=P,M=Ve.useRef(null),F=Ve.useRef(new Map).current;return h.jsx(s,{scope:N,itemMap:F,collectionRef:M,children:R})};d.displayName=t;const i=e+"CollectionSlot",m=ug(i),y=Ve.forwardRef((P,N)=>{const{scope:R,children:M}=P,F=o(i,R),B=$n(N,F.collectionRef);return h.jsx(m,{ref:B,children:M})});y.displayName=i;const S=e+"CollectionItemSlot",w="data-radix-collection-item",T=ug(S),A=Ve.forwardRef((P,N)=>{const{scope:R,children:M,...F}=P,B=Ve.useRef(null),$=$n(N,B),W=o(S,R);return Ve.useEffect(()=>(W.itemMap.set(B,{ref:B,...F}),()=>void W.itemMap.delete(B))),h.jsx(T,{[w]:"",ref:$,children:M})});A.displayName=S;function O(P){const N=o(e+"CollectionConsumer",P);return Ve.useCallback(()=>{const M=N.collectionRef.current;if(!M)return[];const F=Array.from(M.querySelectorAll(`[${w}]`));return Array.from(N.itemMap.values()).sort((W,K)=>F.indexOf(W.ref.current)-F.indexOf(K.ref.current))},[N.collectionRef,N.itemMap])}return[{Provider:d,Slot:y,ItemSlot:A},O,n]}var Pve=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],on=Pve.reduce((e,t)=>{const r=ug(`Primitive.${t}`),n=V.forwardRef((s,o)=>{const{asChild:d,...i}=s,m=d?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(m,{...i,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function bB(e,t){e&&xg.flushSync(()=>e.dispatchEvent(t))}function no(e){const t=V.useRef(e);return V.useEffect(()=>{t.current=e}),V.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function Ove(e,t=globalThis==null?void 0:globalThis.document){const r=no(e);V.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var kve="DismissableLayer",T3="dismissableLayer.update",Nve="dismissableLayer.pointerDownOutside",Ive="dismissableLayer.focusOutside",k9,JJ=V.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Kv=V.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:d,onDismiss:i,...m}=e,y=V.useContext(JJ),[S,w]=V.useState(null),T=(S==null?void 0:S.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,A]=V.useState({}),O=$n(t,K=>w(K)),P=Array.from(y.layers),[N]=[...y.layersWithOutsidePointerEventsDisabled].slice(-1),R=P.indexOf(N),M=S?P.indexOf(S):-1,F=y.layersWithOutsidePointerEventsDisabled.size>0,B=M>=R,$=Mve(K=>{const te=K.target,ne=[...y.branches].some(ae=>ae.contains(te));!B||ne||(s==null||s(K),d==null||d(K),K.defaultPrevented||i==null||i())},T),W=Dve(K=>{const te=K.target;[...y.branches].some(ae=>ae.contains(te))||(o==null||o(K),d==null||d(K),K.defaultPrevented||i==null||i())},T);return Ove(K=>{M===y.layers.size-1&&(n==null||n(K),!K.defaultPrevented&&i&&(K.preventDefault(),i()))},T),V.useEffect(()=>{if(S)return r&&(y.layersWithOutsidePointerEventsDisabled.size===0&&(k9=T.body.style.pointerEvents,T.body.style.pointerEvents="none"),y.layersWithOutsidePointerEventsDisabled.add(S)),y.layers.add(S),N9(),()=>{r&&y.layersWithOutsidePointerEventsDisabled.size===1&&(T.body.style.pointerEvents=k9)}},[S,T,r,y]),V.useEffect(()=>()=>{S&&(y.layers.delete(S),y.layersWithOutsidePointerEventsDisabled.delete(S),N9())},[S,y]),V.useEffect(()=>{const K=()=>A({});return document.addEventListener(T3,K),()=>document.removeEventListener(T3,K)},[]),h.jsx(on.div,{...m,ref:O,style:{pointerEvents:F?B?"auto":"none":void 0,...e.style},onFocusCapture:Ir(e.onFocusCapture,W.onFocusCapture),onBlurCapture:Ir(e.onBlurCapture,W.onBlurCapture),onPointerDownCapture:Ir(e.onPointerDownCapture,$.onPointerDownCapture)})});Kv.displayName=kve;var Rve="DismissableLayerBranch",QJ=V.forwardRef((e,t)=>{const r=V.useContext(JJ),n=V.useRef(null),s=$n(t,n);return V.useEffect(()=>{const o=n.current;if(o)return r.branches.add(o),()=>{r.branches.delete(o)}},[r.branches]),h.jsx(on.div,{...e,ref:s})});QJ.displayName=Rve;function Mve(e,t=globalThis==null?void 0:globalThis.document){const r=no(e),n=V.useRef(!1),s=V.useRef(()=>{});return V.useEffect(()=>{const o=i=>{if(i.target&&!n.current){let m=function(){eQ(Nve,r,y,{discrete:!0})};const y={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=m,t.addEventListener("click",s.current,{once:!0})):m()}else t.removeEventListener("click",s.current);n.current=!1},d=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(d),t.removeEventListener("pointerdown",o),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function Dve(e,t=globalThis==null?void 0:globalThis.document){const r=no(e),n=V.useRef(!1);return V.useEffect(()=>{const s=o=>{o.target&&!n.current&&eQ(Ive,r,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function N9(){const e=new CustomEvent(T3);document.dispatchEvent(e)}function eQ(e,t,r,{discrete:n}){const s=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?bB(s,o):s.dispatchEvent(o)}var Lve=Kv,Fve=QJ,io=globalThis!=null&&globalThis.document?V.useLayoutEffect:()=>{},zve="Portal",ew=V.forwardRef((e,t)=>{var i;const{container:r,...n}=e,[s,o]=V.useState(!1);io(()=>o(!0),[]);const d=r||s&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return d?KJ.createPortal(h.jsx(on.div,{...n,ref:t}),d):null});ew.displayName=zve;function Bve(e,t){return V.useReducer((r,n)=>t[r][n]??r,e)}var zo=e=>{const{present:t,children:r}=e,n=$ve(t),s=typeof r=="function"?r({present:n.isPresent}):V.Children.only(r),o=$n(n.ref,Uve(s));return typeof r=="function"||n.isPresent?V.cloneElement(s,{ref:o}):null};zo.displayName="Presence";function $ve(e){const[t,r]=V.useState(),n=V.useRef(null),s=V.useRef(e),o=V.useRef("none"),d=e?"mounted":"unmounted",[i,m]=Bve(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return V.useEffect(()=>{const y=lj(n.current);o.current=i==="mounted"?y:"none"},[i]),io(()=>{const y=n.current,S=s.current;if(S!==e){const T=o.current,A=lj(y);e?m("MOUNT"):A==="none"||(y==null?void 0:y.display)==="none"?m("UNMOUNT"):m(S&&T!==A?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,m]),io(()=>{if(t){let y;const S=t.ownerDocument.defaultView??window,w=A=>{const P=lj(n.current).includes(A.animationName);if(A.target===t&&P&&(m("ANIMATION_END"),!s.current)){const N=t.style.animationFillMode;t.style.animationFillMode="forwards",y=S.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=N)})}},T=A=>{A.target===t&&(o.current=lj(n.current))};return t.addEventListener("animationstart",T),t.addEventListener("animationcancel",w),t.addEventListener("animationend",w),()=>{S.clearTimeout(y),t.removeEventListener("animationstart",T),t.removeEventListener("animationcancel",w),t.removeEventListener("animationend",w)}}else m("ANIMATION_END")},[t,m]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:V.useCallback(y=>{n.current=y?getComputedStyle(y):null,r(y)},[])}}function lj(e){return(e==null?void 0:e.animationName)||"none"}function Uve(e){var n,s;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(s=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Vve=O4[" useInsertionEffect ".trim().toString()]||io;function Zc({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[s,o,d]=qve({defaultProp:t,onChange:r}),i=e!==void 0,m=i?e:s;{const S=V.useRef(e!==void 0);V.useEffect(()=>{const w=S.current;w!==i&&console.warn(`${n} is changing from ${w?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),S.current=i},[i,n])}const y=V.useCallback(S=>{var w;if(i){const T=Hve(S)?S(e):S;T!==e&&((w=d.current)==null||w.call(d,T))}else o(S)},[i,e,o,d]);return[m,y]}function qve({defaultProp:e,onChange:t}){const[r,n]=V.useState(e),s=V.useRef(r),o=V.useRef(t);return Vve(()=>{o.current=t},[t]),V.useEffect(()=>{var d;s.current!==r&&((d=o.current)==null||d.call(o,r),s.current=r)},[r,s]),[r,n,o]}function Hve(e){return typeof e=="function"}var tQ=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Gve="VisuallyHidden",Jk=V.forwardRef((e,t)=>h.jsx(on.span,{...e,ref:t,style:{...tQ,...e.style}}));Jk.displayName=Gve;var Wve=Jk,wB="ToastProvider",[SB,Kve,Zve]=y2("Toast"),[rQ,Zit]=Fo("Toast",[Zve]),[Xve,Qk]=rQ(wB),nQ=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:d}=e,[i,m]=V.useState(null),[y,S]=V.useState(0),w=V.useRef(!1),T=V.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${wB}\`. Expected non-empty \`string\`.`),h.jsx(SB.Provider,{scope:t,children:h.jsx(Xve,{scope:t,label:r,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:y,viewport:i,onViewportChange:m,onToastAdd:V.useCallback(()=>S(A=>A+1),[]),onToastRemove:V.useCallback(()=>S(A=>A-1),[]),isFocusedToastEscapeKeyDownRef:w,isClosePausedRef:T,children:d})})};nQ.displayName=wB;var iQ="ToastViewport",Yve=["F8"],A3="toast.viewportPause",C3="toast.viewportResume",sQ=V.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Yve,label:s="Notifications ({hotkey})",...o}=e,d=Qk(iQ,r),i=Kve(r),m=V.useRef(null),y=V.useRef(null),S=V.useRef(null),w=V.useRef(null),T=$n(t,w,d.onViewportChange),A=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),O=d.toastCount>0;V.useEffect(()=>{const N=R=>{var F;n.length!==0&&n.every(B=>R[B]||R.code===B)&&((F=w.current)==null||F.focus())};return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[n]),V.useEffect(()=>{const N=m.current,R=w.current;if(O&&N&&R){const M=()=>{if(!d.isClosePausedRef.current){const W=new CustomEvent(A3);R.dispatchEvent(W),d.isClosePausedRef.current=!0}},F=()=>{if(d.isClosePausedRef.current){const W=new CustomEvent(C3);R.dispatchEvent(W),d.isClosePausedRef.current=!1}},B=W=>{!N.contains(W.relatedTarget)&&F()},$=()=>{N.contains(document.activeElement)||F()};return N.addEventListener("focusin",M),N.addEventListener("focusout",B),N.addEventListener("pointermove",M),N.addEventListener("pointerleave",$),window.addEventListener("blur",M),window.addEventListener("focus",F),()=>{N.removeEventListener("focusin",M),N.removeEventListener("focusout",B),N.removeEventListener("pointermove",M),N.removeEventListener("pointerleave",$),window.removeEventListener("blur",M),window.removeEventListener("focus",F)}}},[O,d.isClosePausedRef]);const P=V.useCallback(({tabbingDirection:N})=>{const M=i().map(F=>{const B=F.ref.current,$=[B,...u_e(B)];return N==="forwards"?$:$.reverse()});return(N==="forwards"?M.reverse():M).flat()},[i]);return V.useEffect(()=>{const N=w.current;if(N){const R=M=>{var $,W,K;const F=M.altKey||M.ctrlKey||M.metaKey;if(M.key==="Tab"&&!F){const te=document.activeElement,ne=M.shiftKey;if(M.target===N&&ne){($=y.current)==null||$.focus();return}const ee=P({tabbingDirection:ne?"backwards":"forwards"}),ie=ee.findIndex(de=>de===te);ED(ee.slice(ie+1))?M.preventDefault():ne?(W=y.current)==null||W.focus():(K=S.current)==null||K.focus()}};return N.addEventListener("keydown",R),()=>N.removeEventListener("keydown",R)}},[i,P]),h.jsxs(Fve,{ref:m,role:"region","aria-label":s.replace("{hotkey}",A),tabIndex:-1,style:{pointerEvents:O?void 0:"none"},children:[O&&h.jsx(j3,{ref:y,onFocusFromOutsideViewport:()=>{const N=P({tabbingDirection:"forwards"});ED(N)}}),h.jsx(SB.Slot,{scope:r,children:h.jsx(on.ol,{tabIndex:-1,...o,ref:T})}),O&&h.jsx(j3,{ref:S,onFocusFromOutsideViewport:()=>{const N=P({tabbingDirection:"backwards"});ED(N)}})]})});sQ.displayName=iQ;var aQ="ToastFocusProxy",j3=V.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=e,o=Qk(aQ,r);return h.jsx(Jk,{"aria-hidden":!0,tabIndex:0,...s,ref:t,style:{position:"fixed"},onFocus:d=>{var y;const i=d.relatedTarget;!((y=o.viewport)!=null&&y.contains(i))&&n()}})});j3.displayName=aQ;var v2="Toast",Jve="toast.swipeStart",Qve="toast.swipeMove",e_e="toast.swipeCancel",t_e="toast.swipeEnd",oQ=V.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:o,...d}=e,[i,m]=Zc({prop:n,defaultProp:s??!0,onChange:o,caller:v2});return h.jsx(zo,{present:r||i,children:h.jsx(i_e,{open:i,...d,ref:t,onClose:()=>m(!1),onPause:no(e.onPause),onResume:no(e.onResume),onSwipeStart:Ir(e.onSwipeStart,y=>{y.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ir(e.onSwipeMove,y=>{const{x:S,y:w}=y.detail.delta;y.currentTarget.setAttribute("data-swipe","move"),y.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${S}px`),y.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${w}px`)}),onSwipeCancel:Ir(e.onSwipeCancel,y=>{y.currentTarget.setAttribute("data-swipe","cancel"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),y.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),y.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ir(e.onSwipeEnd,y=>{const{x:S,y:w}=y.detail.delta;y.currentTarget.setAttribute("data-swipe","end"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),y.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${S}px`),y.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${w}px`),m(!1)})})})});oQ.displayName=v2;var[r_e,n_e]=rQ(v2,{onClose(){}}),i_e=V.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:o,onClose:d,onEscapeKeyDown:i,onPause:m,onResume:y,onSwipeStart:S,onSwipeMove:w,onSwipeCancel:T,onSwipeEnd:A,...O}=e,P=Qk(v2,r),[N,R]=V.useState(null),M=$n(t,de=>R(de)),F=V.useRef(null),B=V.useRef(null),$=s||P.duration,W=V.useRef(0),K=V.useRef($),te=V.useRef(0),{onToastAdd:ne,onToastRemove:ae}=P,re=no(()=>{var be;(N==null?void 0:N.contains(document.activeElement))&&((be=P.viewport)==null||be.focus()),d()}),ee=V.useCallback(de=>{!de||de===1/0||(window.clearTimeout(te.current),W.current=new Date().getTime(),te.current=window.setTimeout(re,de))},[re]);V.useEffect(()=>{const de=P.viewport;if(de){const be=()=>{ee(K.current),y==null||y()},Se=()=>{const Ae=new Date().getTime()-W.current;K.current=K.current-Ae,window.clearTimeout(te.current),m==null||m()};return de.addEventListener(A3,Se),de.addEventListener(C3,be),()=>{de.removeEventListener(A3,Se),de.removeEventListener(C3,be)}}},[P.viewport,$,m,y,ee]),V.useEffect(()=>{o&&!P.isClosePausedRef.current&&ee($)},[o,$,P.isClosePausedRef,ee]),V.useEffect(()=>(ne(),()=>ae()),[ne,ae]);const ie=V.useMemo(()=>N?pQ(N):null,[N]);return P.viewport?h.jsxs(h.Fragment,{children:[ie&&h.jsx(s_e,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:ie}),h.jsx(r_e,{scope:r,onClose:re,children:xg.createPortal(h.jsx(SB.ItemSlot,{scope:r,children:h.jsx(Lve,{asChild:!0,onEscapeKeyDown:Ir(i,()=>{P.isFocusedToastEscapeKeyDownRef.current||re(),P.isFocusedToastEscapeKeyDownRef.current=!1}),children:h.jsx(on.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":P.swipeDirection,...O,ref:M,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Ir(e.onKeyDown,de=>{de.key==="Escape"&&(i==null||i(de.nativeEvent),de.nativeEvent.defaultPrevented||(P.isFocusedToastEscapeKeyDownRef.current=!0,re()))}),onPointerDown:Ir(e.onPointerDown,de=>{de.button===0&&(F.current={x:de.clientX,y:de.clientY})}),onPointerMove:Ir(e.onPointerMove,de=>{if(!F.current)return;const be=de.clientX-F.current.x,Se=de.clientY-F.current.y,Ae=!!B.current,xe=["left","right"].includes(P.swipeDirection),me=["left","up"].includes(P.swipeDirection)?Math.min:Math.max,Ce=xe?me(0,be):0,ge=xe?0:me(0,Se),pe=de.pointerType==="touch"?10:2,Oe={x:Ce,y:ge},Xe={originalEvent:de,delta:Oe};Ae?(B.current=Oe,cj(Qve,w,Xe,{discrete:!1})):I9(Oe,P.swipeDirection,pe)?(B.current=Oe,cj(Jve,S,Xe,{discrete:!1}),de.target.setPointerCapture(de.pointerId)):(Math.abs(be)>pe||Math.abs(Se)>pe)&&(F.current=null)}),onPointerUp:Ir(e.onPointerUp,de=>{const be=B.current,Se=de.target;if(Se.hasPointerCapture(de.pointerId)&&Se.releasePointerCapture(de.pointerId),B.current=null,F.current=null,be){const Ae=de.currentTarget,xe={originalEvent:de,delta:be};I9(be,P.swipeDirection,P.swipeThreshold)?cj(t_e,A,xe,{discrete:!0}):cj(e_e,T,xe,{discrete:!0}),Ae.addEventListener("click",me=>me.preventDefault(),{once:!0})}})})})}),P.viewport)})]}):null}),s_e=e=>{const{__scopeToast:t,children:r,...n}=e,s=Qk(v2,t),[o,d]=V.useState(!1),[i,m]=V.useState(!1);return l_e(()=>d(!0)),V.useEffect(()=>{const y=window.setTimeout(()=>m(!0),1e3);return()=>window.clearTimeout(y)},[]),i?null:h.jsx(ew,{asChild:!0,children:h.jsx(Jk,{...n,children:o&&h.jsxs(h.Fragment,{children:[s.label," ",r]})})})},a_e="ToastTitle",lQ=V.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return h.jsx(on.div,{...n,ref:t})});lQ.displayName=a_e;var o_e="ToastDescription",cQ=V.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return h.jsx(on.div,{...n,ref:t})});cQ.displayName=o_e;var uQ="ToastAction",dQ=V.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?h.jsx(fQ,{altText:r,asChild:!0,children:h.jsx(EB,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${uQ}\`. Expected non-empty \`string\`.`),null)});dQ.displayName=uQ;var hQ="ToastClose",EB=V.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,s=n_e(hQ,r);return h.jsx(fQ,{asChild:!0,children:h.jsx(on.button,{type:"button",...n,ref:t,onClick:Ir(e.onClick,s.onClose)})})});EB.displayName=hQ;var fQ=V.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...s}=e;return h.jsx(on.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:t})});function pQ(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),c_e(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",o=n.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const d=n.dataset.radixToastAnnounceAlt;d&&t.push(d)}else t.push(...pQ(n))}}),t}function cj(e,t,r,{discrete:n}){const s=r.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?bB(s,o):s.dispatchEvent(o)}var I9=(e,t,r=0)=>{const n=Math.abs(e.x),s=Math.abs(e.y),o=n>s;return t==="left"||t==="right"?o&&n>r:!o&&s>r};function l_e(e=()=>{}){const t=no(e);io(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function c_e(e){return e.nodeType===e.ELEMENT_NODE}function u_e(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function ED(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var d_e=nQ,mQ=sQ,gQ=oQ,yQ=lQ,vQ=cQ,_Q=dQ,xQ=EB;function bQ(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=bQ(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Ni(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=bQ(e))&&(n&&(n+=" "),n+=t);return n}const R9=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,M9=Ni,Zv=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return M9(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:s,defaultVariants:o}=t,d=Object.keys(s).map(y=>{const S=r==null?void 0:r[y],w=o==null?void 0:o[y];if(S===null)return null;const T=R9(S)||R9(w);return s[y][T]}),i=r&&Object.entries(r).reduce((y,S)=>{let[w,T]=S;return T===void 0||(y[w]=T),y},{}),m=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((y,S)=>{let{class:w,className:T,...A}=S;return Object.entries(A).every(O=>{let[P,N]=O;return Array.isArray(N)?N.includes({...o,...i}[P]):{...o,...i}[P]===N})?[...y,w,T]:y},[]);return M9(e,d,m,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h_e=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),wQ=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var f_e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_e=V.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:o,iconNode:d,...i},m)=>V.createElement("svg",{ref:m,...f_e,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:wQ("lucide",s),...i},[...d.map(([y,S])=>V.createElement(y,S)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=(e,t)=>{const r=V.forwardRef(({className:n,...s},o)=>V.createElement(p_e,{ref:o,iconNode:t,className:wQ(`lucide-${h_e(e)}`,n),...s}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SQ=Ur("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EQ=Ur("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m_e=Ur("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_e=Ur("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TQ=Ur("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_e=Ur("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=Ur("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_e=Ur("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __e=Ur("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=Ur("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_e=Ur("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_e=Ur("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_e=Ur("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=Ur("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Ur("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eN=Ur("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tN=Ur("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S_e=Ur("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rN=Ur("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_e=Ur("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BP=Ur("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_e=Ur("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $P=Ur("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AQ=Ur("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P3=Ur("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xv=Ur("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A_e=Ur("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_e=Ur("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UP=Ur("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_e=Ur("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nN=Ur("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TB=Ur("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D9=Ur("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=Ur("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ab=Ur("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=Ur("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tP=Ur("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p0=Ur("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yv=Ur("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VP=Ur("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CQ=Ur("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L9=Ur("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P_e=Ur("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O_e=Ur("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O3=Ur("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k_e=Ur("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jQ=Ur("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=Ur("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_e=Ur("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F9=Ur("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PQ=Ur("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=Ur("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OQ=Ur("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I_e=Ur("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R_e=Ur("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kQ=Ur("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Om=Ur("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qP=Ur("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M_e=Ur("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hu=Ur("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D_e=Ur("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L_e=Ur("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tw=Ur("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F_e=Ur("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ap=Ur("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z_e=Ur("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B_e=Ur("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k3=Ur("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pp=Ur("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $_e=Ur("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dd=Ur("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iN=Ur("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lc=Ur("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=Ur("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _2=Ur("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=Ur("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=Ur("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z9=Ur("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=Ur("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=Ur("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NQ=Ur("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=Ur("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IQ=Ur("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OE=Ur("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=Ur("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=Ur("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ob=Ur("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U_e=Ur("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wu=Ur("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),jB="-",V_e=e=>{const t=H_e(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:d=>{const i=d.split(jB);return i[0]===""&&i.length!==1&&i.shift(),RQ(i,t)||q_e(d)},getConflictingClassGroupIds:(d,i)=>{const m=r[d]||[];return i&&n[d]?[...m,...n[d]]:m}}},RQ=(e,t)=>{var d;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),s=n?RQ(e.slice(1),n):void 0;if(s)return s;if(t.validators.length===0)return;const o=e.join(jB);return(d=t.validators.find(({validator:i})=>i(o)))==null?void 0:d.classGroupId},B9=/^\[(.+)\]$/,q_e=e=>{if(B9.test(e)){const t=B9.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},H_e=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return W_e(Object.entries(e.classGroups),r).forEach(([o,d])=>{N3(d,n,o,t)}),n},N3=(e,t,r,n)=>{e.forEach(s=>{if(typeof s=="string"){const o=s===""?t:$9(t,s);o.classGroupId=r;return}if(typeof s=="function"){if(G_e(s)){N3(s(n),t,r,n);return}t.validators.push({validator:s,classGroupId:r});return}Object.entries(s).forEach(([o,d])=>{N3(d,$9(t,o),r,n)})})},$9=(e,t)=>{let r=e;return t.split(jB).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},G_e=e=>e.isThemeGetter,W_e=(e,t)=>t?e.map(([r,n])=>{const s=n.map(o=>typeof o=="string"?t+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([d,i])=>[t+d,i])):o);return[r,s]}):e,K_e=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const s=(o,d)=>{r.set(o,d),t++,t>e&&(t=0,n=r,r=new Map)};return{get(o){let d=r.get(o);if(d!==void 0)return d;if((d=n.get(o))!==void 0)return s(o,d),d},set(o,d){r.has(o)?r.set(o,d):s(o,d)}}},MQ="!",Z_e=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,s=t[0],o=t.length,d=i=>{const m=[];let y=0,S=0,w;for(let N=0;N<i.length;N++){let R=i[N];if(y===0){if(R===s&&(n||i.slice(N,N+o)===t)){m.push(i.slice(S,N)),S=N+o;continue}if(R==="/"){w=N;continue}}R==="["?y++:R==="]"&&y--}const T=m.length===0?i:i.substring(S),A=T.startsWith(MQ),O=A?T.substring(1):T,P=w&&w>S?w-S:void 0;return{modifiers:m,hasImportantModifier:A,baseClassName:O,maybePostfixModifierPosition:P}};return r?i=>r({className:i,parseClassName:d}):d},X_e=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},Y_e=e=>({cache:K_e(e.cacheSize),parseClassName:Z_e(e),...V_e(e)}),J_e=/\s+/,Q_e=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:s}=t,o=[],d=e.trim().split(J_e);let i="";for(let m=d.length-1;m>=0;m-=1){const y=d[m],{modifiers:S,hasImportantModifier:w,baseClassName:T,maybePostfixModifierPosition:A}=r(y);let O=!!A,P=n(O?T.substring(0,A):T);if(!P){if(!O){i=y+(i.length>0?" "+i:i);continue}if(P=n(T),!P){i=y+(i.length>0?" "+i:i);continue}O=!1}const N=X_e(S).join(":"),R=w?N+MQ:N,M=R+P;if(o.includes(M))continue;o.push(M);const F=s(P,O);for(let B=0;B<F.length;++B){const $=F[B];o.push(R+$)}i=y+(i.length>0?" "+i:i)}return i};function exe(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=DQ(t))&&(n&&(n+=" "),n+=r);return n}const DQ=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=DQ(e[n]))&&(r&&(r+=" "),r+=t);return r};function txe(e,...t){let r,n,s,o=d;function d(m){const y=t.reduce((S,w)=>w(S),e());return r=Y_e(y),n=r.cache.get,s=r.cache.set,o=i,i(m)}function i(m){const y=n(m);if(y)return y;const S=Q_e(m,r);return s(m,S),S}return function(){return o(exe.apply(null,arguments))}}const da=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},LQ=/^\[(?:([a-z-]+):)?(.+)\]$/i,rxe=/^\d+\/\d+$/,nxe=new Set(["px","full","screen"]),ixe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,sxe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,axe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,oxe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,lxe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Pf=e=>O0(e)||nxe.has(e)||rxe.test(e),fm=e=>rw(e,"length",gxe),O0=e=>!!e&&!Number.isNaN(Number(e)),TD=e=>rw(e,"number",O0),zS=e=>!!e&&Number.isInteger(Number(e)),cxe=e=>e.endsWith("%")&&O0(e.slice(0,-1)),$i=e=>LQ.test(e),pm=e=>ixe.test(e),uxe=new Set(["length","size","percentage"]),dxe=e=>rw(e,uxe,FQ),hxe=e=>rw(e,"position",FQ),fxe=new Set(["image","url"]),pxe=e=>rw(e,fxe,vxe),mxe=e=>rw(e,"",yxe),BS=()=>!0,rw=(e,t,r)=>{const n=LQ.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},gxe=e=>sxe.test(e)&&!axe.test(e),FQ=()=>!1,yxe=e=>oxe.test(e),vxe=e=>lxe.test(e),_xe=()=>{const e=da("colors"),t=da("spacing"),r=da("blur"),n=da("brightness"),s=da("borderColor"),o=da("borderRadius"),d=da("borderSpacing"),i=da("borderWidth"),m=da("contrast"),y=da("grayscale"),S=da("hueRotate"),w=da("invert"),T=da("gap"),A=da("gradientColorStops"),O=da("gradientColorStopPositions"),P=da("inset"),N=da("margin"),R=da("opacity"),M=da("padding"),F=da("saturate"),B=da("scale"),$=da("sepia"),W=da("skew"),K=da("space"),te=da("translate"),ne=()=>["auto","contain","none"],ae=()=>["auto","hidden","clip","visible","scroll"],re=()=>["auto",$i,t],ee=()=>[$i,t],ie=()=>["",Pf,fm],de=()=>["auto",O0,$i],be=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Se=()=>["solid","dashed","dotted","double","none"],Ae=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],xe=()=>["start","end","center","between","around","evenly","stretch"],me=()=>["","0",$i],Ce=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ge=()=>[O0,$i];return{cacheSize:500,separator:":",theme:{colors:[BS],spacing:[Pf,fm],blur:["none","",pm,$i],brightness:ge(),borderColor:[e],borderRadius:["none","","full",pm,$i],borderSpacing:ee(),borderWidth:ie(),contrast:ge(),grayscale:me(),hueRotate:ge(),invert:me(),gap:ee(),gradientColorStops:[e],gradientColorStopPositions:[cxe,fm],inset:re(),margin:re(),opacity:ge(),padding:ee(),saturate:ge(),scale:ge(),sepia:me(),skew:ge(),space:ee(),translate:ee()},classGroups:{aspect:[{aspect:["auto","square","video",$i]}],container:["container"],columns:[{columns:[pm]}],"break-after":[{"break-after":Ce()}],"break-before":[{"break-before":Ce()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...be(),$i]}],overflow:[{overflow:ae()}],"overflow-x":[{"overflow-x":ae()}],"overflow-y":[{"overflow-y":ae()}],overscroll:[{overscroll:ne()}],"overscroll-x":[{"overscroll-x":ne()}],"overscroll-y":[{"overscroll-y":ne()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[P]}],"inset-x":[{"inset-x":[P]}],"inset-y":[{"inset-y":[P]}],start:[{start:[P]}],end:[{end:[P]}],top:[{top:[P]}],right:[{right:[P]}],bottom:[{bottom:[P]}],left:[{left:[P]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",zS,$i]}],basis:[{basis:re()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",$i]}],grow:[{grow:me()}],shrink:[{shrink:me()}],order:[{order:["first","last","none",zS,$i]}],"grid-cols":[{"grid-cols":[BS]}],"col-start-end":[{col:["auto",{span:["full",zS,$i]},$i]}],"col-start":[{"col-start":de()}],"col-end":[{"col-end":de()}],"grid-rows":[{"grid-rows":[BS]}],"row-start-end":[{row:["auto",{span:[zS,$i]},$i]}],"row-start":[{"row-start":de()}],"row-end":[{"row-end":de()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",$i]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",$i]}],gap:[{gap:[T]}],"gap-x":[{"gap-x":[T]}],"gap-y":[{"gap-y":[T]}],"justify-content":[{justify:["normal",...xe()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...xe(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...xe(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[M]}],px:[{px:[M]}],py:[{py:[M]}],ps:[{ps:[M]}],pe:[{pe:[M]}],pt:[{pt:[M]}],pr:[{pr:[M]}],pb:[{pb:[M]}],pl:[{pl:[M]}],m:[{m:[N]}],mx:[{mx:[N]}],my:[{my:[N]}],ms:[{ms:[N]}],me:[{me:[N]}],mt:[{mt:[N]}],mr:[{mr:[N]}],mb:[{mb:[N]}],ml:[{ml:[N]}],"space-x":[{"space-x":[K]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[K]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",$i,t]}],"min-w":[{"min-w":[$i,t,"min","max","fit"]}],"max-w":[{"max-w":[$i,t,"none","full","min","max","fit","prose",{screen:[pm]},pm]}],h:[{h:[$i,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[$i,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[$i,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[$i,t,"auto","min","max","fit"]}],"font-size":[{text:["base",pm,fm]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",TD]}],"font-family":[{font:[BS]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",$i]}],"line-clamp":[{"line-clamp":["none",O0,TD]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Pf,$i]}],"list-image":[{"list-image":["none",$i]}],"list-style-type":[{list:["none","disc","decimal",$i]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[R]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[R]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Se(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Pf,fm]}],"underline-offset":[{"underline-offset":["auto",Pf,$i]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ee()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",$i]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",$i]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[R]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...be(),hxe]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",dxe]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},pxe]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[O]}],"gradient-via-pos":[{via:[O]}],"gradient-to-pos":[{to:[O]}],"gradient-from":[{from:[A]}],"gradient-via":[{via:[A]}],"gradient-to":[{to:[A]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[R]}],"border-style":[{border:[...Se(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[R]}],"divide-style":[{divide:Se()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...Se()]}],"outline-offset":[{"outline-offset":[Pf,$i]}],"outline-w":[{outline:[Pf,fm]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[R]}],"ring-offset-w":[{"ring-offset":[Pf,fm]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",pm,mxe]}],"shadow-color":[{shadow:[BS]}],opacity:[{opacity:[R]}],"mix-blend":[{"mix-blend":[...Ae(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ae()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[m]}],"drop-shadow":[{"drop-shadow":["","none",pm,$i]}],grayscale:[{grayscale:[y]}],"hue-rotate":[{"hue-rotate":[S]}],invert:[{invert:[w]}],saturate:[{saturate:[F]}],sepia:[{sepia:[$]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[m]}],"backdrop-grayscale":[{"backdrop-grayscale":[y]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[S]}],"backdrop-invert":[{"backdrop-invert":[w]}],"backdrop-opacity":[{"backdrop-opacity":[R]}],"backdrop-saturate":[{"backdrop-saturate":[F]}],"backdrop-sepia":[{"backdrop-sepia":[$]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[d]}],"border-spacing-x":[{"border-spacing-x":[d]}],"border-spacing-y":[{"border-spacing-y":[d]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",$i]}],duration:[{duration:ge()}],ease:[{ease:["linear","in","out","in-out",$i]}],delay:[{delay:ge()}],animate:[{animate:["none","spin","ping","pulse","bounce",$i]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[B]}],"scale-x":[{"scale-x":[B]}],"scale-y":[{"scale-y":[B]}],rotate:[{rotate:[zS,$i]}],"translate-x":[{"translate-x":[te]}],"translate-y":[{"translate-y":[te]}],"skew-x":[{"skew-x":[W]}],"skew-y":[{"skew-y":[W]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",$i]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",$i]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ee()}],"scroll-mx":[{"scroll-mx":ee()}],"scroll-my":[{"scroll-my":ee()}],"scroll-ms":[{"scroll-ms":ee()}],"scroll-me":[{"scroll-me":ee()}],"scroll-mt":[{"scroll-mt":ee()}],"scroll-mr":[{"scroll-mr":ee()}],"scroll-mb":[{"scroll-mb":ee()}],"scroll-ml":[{"scroll-ml":ee()}],"scroll-p":[{"scroll-p":ee()}],"scroll-px":[{"scroll-px":ee()}],"scroll-py":[{"scroll-py":ee()}],"scroll-ps":[{"scroll-ps":ee()}],"scroll-pe":[{"scroll-pe":ee()}],"scroll-pt":[{"scroll-pt":ee()}],"scroll-pr":[{"scroll-pr":ee()}],"scroll-pb":[{"scroll-pb":ee()}],"scroll-pl":[{"scroll-pl":ee()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",$i]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Pf,fm,TD]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},xxe=txe(_xe);function fr(...e){return xxe(Ni(e))}const bxe=d_e,zQ=V.forwardRef(({className:e,...t},r)=>h.jsx(mQ,{ref:r,className:fr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));zQ.displayName=mQ.displayName;const wxe=Zv("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),BQ=V.forwardRef(({className:e,variant:t,...r},n)=>h.jsx(gQ,{ref:n,className:fr(wxe({variant:t}),e),...r}));BQ.displayName=gQ.displayName;const Sxe=V.forwardRef(({className:e,...t},r)=>h.jsx(_Q,{ref:r,className:fr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));Sxe.displayName=_Q.displayName;const $Q=V.forwardRef(({className:e,...t},r)=>h.jsx(xQ,{ref:r,className:fr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:h.jsx(wu,{className:"h-4 w-4"})}));$Q.displayName=xQ.displayName;const UQ=V.forwardRef(({className:e,...t},r)=>h.jsx(yQ,{ref:r,className:fr("text-sm font-semibold",e),...t}));UQ.displayName=yQ.displayName;const VQ=V.forwardRef(({className:e,...t},r)=>h.jsx(vQ,{ref:r,className:fr("text-sm opacity-90",e),...t}));VQ.displayName=vQ.displayName;function Exe(){const{toasts:e}=Ii();return h.jsxs(bxe,{children:[e.map(function({id:t,title:r,description:n,action:s,...o}){return h.jsxs(BQ,{...o,children:[h.jsxs("div",{className:"grid gap-1",children:[r&&h.jsx(UQ,{children:r}),n&&h.jsx(VQ,{children:n})]}),s,h.jsx($Q,{})]},t)}),h.jsx(zQ,{})]})}var U9=["light","dark"],Txe="(prefers-color-scheme: dark)",Axe=V.createContext(void 0),Cxe={setTheme:e=>{},themes:[]},jxe=()=>{var e;return(e=V.useContext(Axe))!=null?e:Cxe};V.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:s,defaultTheme:o,value:d,attrs:i,nonce:m})=>{let y=o==="system",S=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(O=>`'${O}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,w=s?U9.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",T=(O,P=!1,N=!0)=>{let R=d?d[O]:O,M=P?O+"|| ''":`'${R}'`,F="";return s&&N&&!P&&U9.includes(O)&&(F+=`d.style.colorScheme = '${O}';`),r==="class"?P||R?F+=`c.add(${M})`:F+="null":R&&(F+=`d[s](n,${M})`),F},A=e?`!function(){${S}${T(e)}}()`:n?`!function(){try{${S}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${y})){var t='${Txe}',m=window.matchMedia(t);if(m.media!==t||m.matches){${T("dark")}}else{${T("light")}}}else if(e){${d?`var x=${JSON.stringify(d)};`:""}${T(d?"x[e]":"e",!0)}}${y?"":"else{"+T(o,!1,!1)+"}"}${w}}catch(e){}}()`:`!function(){try{${S}var e=localStorage.getItem('${t}');if(e){${d?`var x=${JSON.stringify(d)};`:""}${T(d?"x[e]":"e",!0)}}else{${T(o,!1,!1)};}${w}}catch(t){}}();`;return V.createElement("script",{nonce:m,dangerouslySetInnerHTML:{__html:A}})});var Pxe=e=>{switch(e){case"success":return Nxe;case"info":return Rxe;case"warning":return Ixe;case"error":return Mxe;default:return null}},Oxe=Array(12).fill(0),kxe=({visible:e,className:t})=>Ve.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Ve.createElement("div",{className:"sonner-spinner"},Oxe.map((r,n)=>Ve.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),Nxe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ixe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Rxe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Mxe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Dxe=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ve.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ve.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Lxe=()=>{let[e,t]=Ve.useState(document.hidden);return Ve.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},I3=1,Fxe=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,s=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:I3++,o=this.toasts.find(i=>i.id===s),d=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),o?this.toasts=this.toasts.map(i=>i.id===s?(this.publish({...i,...e,id:s,title:r}),{...i,...e,id:s,dismissible:d,title:r}):i):this.addToast({title:r,...n,dismissible:d,id:s}),s},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),s=r!==void 0,o,d=n.then(async m=>{if(o=["resolve",m],Ve.isValidElement(m))s=!1,this.create({id:r,type:"default",message:m});else if(Bxe(m)&&!m.ok){s=!1;let y=typeof t.error=="function"?await t.error(`HTTP error! status: ${m.status}`):t.error,S=typeof t.description=="function"?await t.description(`HTTP error! status: ${m.status}`):t.description;this.create({id:r,type:"error",message:y,description:S})}else if(t.success!==void 0){s=!1;let y=typeof t.success=="function"?await t.success(m):t.success,S=typeof t.description=="function"?await t.description(m):t.description;this.create({id:r,type:"success",message:y,description:S})}}).catch(async m=>{if(o=["reject",m],t.error!==void 0){s=!1;let y=typeof t.error=="function"?await t.error(m):t.error,S=typeof t.description=="function"?await t.description(m):t.description;this.create({id:r,type:"error",message:y,description:S})}}).finally(()=>{var m;s&&(this.dismiss(r),r=void 0),(m=t.finally)==null||m.call(t)}),i=()=>new Promise((m,y)=>d.then(()=>o[0]==="reject"?y(o[1]):m(o[1])).catch(y));return typeof r!="string"&&typeof r!="number"?{unwrap:i}:Object.assign(r,{unwrap:i})},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||I3++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Fc=new Fxe,zxe=(e,t)=>{let r=(t==null?void 0:t.id)||I3++;return Fc.addToast({title:e,...t,id:r}),r},Bxe=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",$xe=zxe,Uxe=()=>Fc.toasts,Vxe=()=>Fc.getActiveToasts(),Nr=Object.assign($xe,{success:Fc.success,info:Fc.info,warning:Fc.warning,error:Fc.error,custom:Fc.custom,message:Fc.message,promise:Fc.promise,dismiss:Fc.dismiss,loading:Fc.loading},{getHistory:Uxe,getToasts:Vxe});function qxe(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}qxe(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function uj(e){return e.label!==void 0}var Hxe=3,Gxe="32px",Wxe="16px",V9=4e3,Kxe=356,Zxe=14,Xxe=20,Yxe=200;function wd(...e){return e.filter(Boolean).join(" ")}function Jxe(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var Qxe=e=>{var t,r,n,s,o,d,i,m,y,S,w;let{invert:T,toast:A,unstyled:O,interacting:P,setHeights:N,visibleToasts:R,heights:M,index:F,toasts:B,expanded:$,removeToast:W,defaultRichColors:K,closeButton:te,style:ne,cancelButtonStyle:ae,actionButtonStyle:re,className:ee="",descriptionClassName:ie="",duration:de,position:be,gap:Se,loadingIcon:Ae,expandByDefault:xe,classNames:me,icons:Ce,closeButtonAriaLabel:ge="Close toast",pauseWhenPageIsHidden:pe}=e,[Oe,Xe]=Ve.useState(null),[We,$e]=Ve.useState(null),[Ke,Le]=Ve.useState(!1),[ke,st]=Ve.useState(!1),[_t,Be]=Ve.useState(!1),[Dt,It]=Ve.useState(!1),[ir,Dr]=Ve.useState(!1),[Rr,jt]=Ve.useState(0),[zt,Je]=Ve.useState(0),pt=Ve.useRef(A.duration||de||V9),rt=Ve.useRef(null),Kt=Ve.useRef(null),Ut=F===0,Ht=F+1<=R,Cr=A.type,un=A.dismissible!==!1,hn=A.className||"",Kn=A.descriptionClassName||"",Gn=Ve.useMemo(()=>M.findIndex(Ln=>Ln.toastId===A.id)||0,[M,A.id]),Mi=Ve.useMemo(()=>{var Ln;return(Ln=A.closeButton)!=null?Ln:te},[A.closeButton,te]),Pa=Ve.useMemo(()=>A.duration||de||V9,[A.duration,de]),_s=Ve.useRef(0),mi=Ve.useRef(0),Ua=Ve.useRef(0),Va=Ve.useRef(null),[Bo,qa]=be.split("-"),Ha=Ve.useMemo(()=>M.reduce((Ln,Fi,ps)=>ps>=Gn?Ln:Ln+Fi.height,0),[M,Gn]),Li=Lxe(),Ws=A.invert||T,nl=Cr==="loading";mi.current=Ve.useMemo(()=>Gn*Se+Ha,[Gn,Ha]),Ve.useEffect(()=>{pt.current=Pa},[Pa]),Ve.useEffect(()=>{Le(!0)},[]),Ve.useEffect(()=>{let Ln=Kt.current;if(Ln){let Fi=Ln.getBoundingClientRect().height;return Je(Fi),N(ps=>[{toastId:A.id,height:Fi,position:A.position},...ps]),()=>N(ps=>ps.filter(Ga=>Ga.toastId!==A.id))}},[N,A.id]),Ve.useLayoutEffect(()=>{if(!Ke)return;let Ln=Kt.current,Fi=Ln.style.height;Ln.style.height="auto";let ps=Ln.getBoundingClientRect().height;Ln.style.height=Fi,Je(ps),N(Ga=>Ga.find(at=>at.toastId===A.id)?Ga.map(at=>at.toastId===A.id?{...at,height:ps}:at):[{toastId:A.id,height:ps,position:A.position},...Ga])},[Ke,A.title,A.description,N,A.id]);let _a=Ve.useCallback(()=>{st(!0),jt(mi.current),N(Ln=>Ln.filter(Fi=>Fi.toastId!==A.id)),setTimeout(()=>{W(A)},Yxe)},[A,W,N,mi]);Ve.useEffect(()=>{if(A.promise&&Cr==="loading"||A.duration===1/0||A.type==="loading")return;let Ln;return $||P||pe&&Li?(()=>{if(Ua.current<_s.current){let Fi=new Date().getTime()-_s.current;pt.current=pt.current-Fi}Ua.current=new Date().getTime()})():pt.current!==1/0&&(_s.current=new Date().getTime(),Ln=setTimeout(()=>{var Fi;(Fi=A.onAutoClose)==null||Fi.call(A,A),_a()},pt.current)),()=>clearTimeout(Ln)},[$,P,A,Cr,pe,Li,_a]),Ve.useEffect(()=>{A.delete&&_a()},[_a,A.delete]);function so(){var Ln,Fi,ps;return Ce!=null&&Ce.loading?Ve.createElement("div",{className:wd(me==null?void 0:me.loader,(Ln=A==null?void 0:A.classNames)==null?void 0:Ln.loader,"sonner-loader"),"data-visible":Cr==="loading"},Ce.loading):Ae?Ve.createElement("div",{className:wd(me==null?void 0:me.loader,(Fi=A==null?void 0:A.classNames)==null?void 0:Fi.loader,"sonner-loader"),"data-visible":Cr==="loading"},Ae):Ve.createElement(kxe,{className:wd(me==null?void 0:me.loader,(ps=A==null?void 0:A.classNames)==null?void 0:ps.loader),visible:Cr==="loading"})}return Ve.createElement("li",{tabIndex:0,ref:Kt,className:wd(ee,hn,me==null?void 0:me.toast,(t=A==null?void 0:A.classNames)==null?void 0:t.toast,me==null?void 0:me.default,me==null?void 0:me[Cr],(r=A==null?void 0:A.classNames)==null?void 0:r[Cr]),"data-sonner-toast":"","data-rich-colors":(n=A.richColors)!=null?n:K,"data-styled":!(A.jsx||A.unstyled||O),"data-mounted":Ke,"data-promise":!!A.promise,"data-swiped":ir,"data-removed":ke,"data-visible":Ht,"data-y-position":Bo,"data-x-position":qa,"data-index":F,"data-front":Ut,"data-swiping":_t,"data-dismissible":un,"data-type":Cr,"data-invert":Ws,"data-swipe-out":Dt,"data-swipe-direction":We,"data-expanded":!!($||xe&&Ke),style:{"--index":F,"--toasts-before":F,"--z-index":B.length-F,"--offset":`${ke?Rr:mi.current}px`,"--initial-height":xe?"auto":`${zt}px`,...ne,...A.style},onDragEnd:()=>{Be(!1),Xe(null),Va.current=null},onPointerDown:Ln=>{nl||!un||(rt.current=new Date,jt(mi.current),Ln.target.setPointerCapture(Ln.pointerId),Ln.target.tagName!=="BUTTON"&&(Be(!0),Va.current={x:Ln.clientX,y:Ln.clientY}))},onPointerUp:()=>{var Ln,Fi,ps,Ga;if(Dt||!un)return;Va.current=null;let at=Number(((Ln=Kt.current)==null?void 0:Ln.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),gn=Number(((Fi=Kt.current)==null?void 0:Fi.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ks=new Date().getTime()-((ps=rt.current)==null?void 0:ps.getTime()),Oa=Oe==="x"?at:gn,vn=Math.abs(Oa)/Ks;if(Math.abs(Oa)>=Xxe||vn>.11){jt(mi.current),(Ga=A.onDismiss)==null||Ga.call(A,A),$e(Oe==="x"?at>0?"right":"left":gn>0?"down":"up"),_a(),It(!0),Dr(!1);return}Be(!1),Xe(null)},onPointerMove:Ln=>{var Fi,ps,Ga,at;if(!Va.current||!un||((Fi=window.getSelection())==null?void 0:Fi.toString().length)>0)return;let gn=Ln.clientY-Va.current.y,Ks=Ln.clientX-Va.current.x,Oa=(ps=e.swipeDirections)!=null?ps:Jxe(be);!Oe&&(Math.abs(Ks)>1||Math.abs(gn)>1)&&Xe(Math.abs(Ks)>Math.abs(gn)?"x":"y");let vn={x:0,y:0};Oe==="y"?(Oa.includes("top")||Oa.includes("bottom"))&&(Oa.includes("top")&&gn<0||Oa.includes("bottom")&&gn>0)&&(vn.y=gn):Oe==="x"&&(Oa.includes("left")||Oa.includes("right"))&&(Oa.includes("left")&&Ks<0||Oa.includes("right")&&Ks>0)&&(vn.x=Ks),(Math.abs(vn.x)>0||Math.abs(vn.y)>0)&&Dr(!0),(Ga=Kt.current)==null||Ga.style.setProperty("--swipe-amount-x",`${vn.x}px`),(at=Kt.current)==null||at.style.setProperty("--swipe-amount-y",`${vn.y}px`)}},Mi&&!A.jsx?Ve.createElement("button",{"aria-label":ge,"data-disabled":nl,"data-close-button":!0,onClick:nl||!un?()=>{}:()=>{var Ln;_a(),(Ln=A.onDismiss)==null||Ln.call(A,A)},className:wd(me==null?void 0:me.closeButton,(s=A==null?void 0:A.classNames)==null?void 0:s.closeButton)},(o=Ce==null?void 0:Ce.close)!=null?o:Dxe):null,A.jsx||V.isValidElement(A.title)?A.jsx?A.jsx:typeof A.title=="function"?A.title():A.title:Ve.createElement(Ve.Fragment,null,Cr||A.icon||A.promise?Ve.createElement("div",{"data-icon":"",className:wd(me==null?void 0:me.icon,(d=A==null?void 0:A.classNames)==null?void 0:d.icon)},A.promise||A.type==="loading"&&!A.icon?A.icon||so():null,A.type!=="loading"?A.icon||(Ce==null?void 0:Ce[Cr])||Pxe(Cr):null):null,Ve.createElement("div",{"data-content":"",className:wd(me==null?void 0:me.content,(i=A==null?void 0:A.classNames)==null?void 0:i.content)},Ve.createElement("div",{"data-title":"",className:wd(me==null?void 0:me.title,(m=A==null?void 0:A.classNames)==null?void 0:m.title)},typeof A.title=="function"?A.title():A.title),A.description?Ve.createElement("div",{"data-description":"",className:wd(ie,Kn,me==null?void 0:me.description,(y=A==null?void 0:A.classNames)==null?void 0:y.description)},typeof A.description=="function"?A.description():A.description):null),V.isValidElement(A.cancel)?A.cancel:A.cancel&&uj(A.cancel)?Ve.createElement("button",{"data-button":!0,"data-cancel":!0,style:A.cancelButtonStyle||ae,onClick:Ln=>{var Fi,ps;uj(A.cancel)&&un&&((ps=(Fi=A.cancel).onClick)==null||ps.call(Fi,Ln),_a())},className:wd(me==null?void 0:me.cancelButton,(S=A==null?void 0:A.classNames)==null?void 0:S.cancelButton)},A.cancel.label):null,V.isValidElement(A.action)?A.action:A.action&&uj(A.action)?Ve.createElement("button",{"data-button":!0,"data-action":!0,style:A.actionButtonStyle||re,onClick:Ln=>{var Fi,ps;uj(A.action)&&((ps=(Fi=A.action).onClick)==null||ps.call(Fi,Ln),!Ln.defaultPrevented&&_a())},className:wd(me==null?void 0:me.actionButton,(w=A==null?void 0:A.classNames)==null?void 0:w.actionButton)},A.action.label):null))};function q9(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function e0e(e,t){let r={};return[e,t].forEach((n,s)=>{let o=s===1,d=o?"--mobile-offset":"--offset",i=o?Wxe:Gxe;function m(y){["top","right","bottom","left"].forEach(S=>{r[`${d}-${S}`]=typeof y=="number"?`${y}px`:y})}typeof n=="number"||typeof n=="string"?m(n):typeof n=="object"?["top","right","bottom","left"].forEach(y=>{n[y]===void 0?r[`${d}-${y}`]=i:r[`${d}-${y}`]=typeof n[y]=="number"?`${n[y]}px`:n[y]}):m(i)}),r}var t0e=V.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:s=["altKey","KeyT"],expand:o,closeButton:d,className:i,offset:m,mobileOffset:y,theme:S="light",richColors:w,duration:T,style:A,visibleToasts:O=Hxe,toastOptions:P,dir:N=q9(),gap:R=Zxe,loadingIcon:M,icons:F,containerAriaLabel:B="Notifications",pauseWhenPageIsHidden:$}=e,[W,K]=Ve.useState([]),te=Ve.useMemo(()=>Array.from(new Set([n].concat(W.filter(pe=>pe.position).map(pe=>pe.position)))),[W,n]),[ne,ae]=Ve.useState([]),[re,ee]=Ve.useState(!1),[ie,de]=Ve.useState(!1),[be,Se]=Ve.useState(S!=="system"?S:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ae=Ve.useRef(null),xe=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),me=Ve.useRef(null),Ce=Ve.useRef(!1),ge=Ve.useCallback(pe=>{K(Oe=>{var Xe;return(Xe=Oe.find(We=>We.id===pe.id))!=null&&Xe.delete||Fc.dismiss(pe.id),Oe.filter(({id:We})=>We!==pe.id)})},[]);return Ve.useEffect(()=>Fc.subscribe(pe=>{if(pe.dismiss){K(Oe=>Oe.map(Xe=>Xe.id===pe.id?{...Xe,delete:!0}:Xe));return}setTimeout(()=>{KJ.flushSync(()=>{K(Oe=>{let Xe=Oe.findIndex(We=>We.id===pe.id);return Xe!==-1?[...Oe.slice(0,Xe),{...Oe[Xe],...pe},...Oe.slice(Xe+1)]:[pe,...Oe]})})})}),[]),Ve.useEffect(()=>{if(S!=="system"){Se(S);return}if(S==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Se("dark"):Se("light")),typeof window>"u")return;let pe=window.matchMedia("(prefers-color-scheme: dark)");try{pe.addEventListener("change",({matches:Oe})=>{Se(Oe?"dark":"light")})}catch{pe.addListener(({matches:Xe})=>{try{Se(Xe?"dark":"light")}catch(We){console.error(We)}})}},[S]),Ve.useEffect(()=>{W.length<=1&&ee(!1)},[W]),Ve.useEffect(()=>{let pe=Oe=>{var Xe,We;s.every($e=>Oe[$e]||Oe.code===$e)&&(ee(!0),(Xe=Ae.current)==null||Xe.focus()),Oe.code==="Escape"&&(document.activeElement===Ae.current||(We=Ae.current)!=null&&We.contains(document.activeElement))&&ee(!1)};return document.addEventListener("keydown",pe),()=>document.removeEventListener("keydown",pe)},[s]),Ve.useEffect(()=>{if(Ae.current)return()=>{me.current&&(me.current.focus({preventScroll:!0}),me.current=null,Ce.current=!1)}},[Ae.current]),Ve.createElement("section",{ref:t,"aria-label":`${B} ${xe}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},te.map((pe,Oe)=>{var Xe;let[We,$e]=pe.split("-");return W.length?Ve.createElement("ol",{key:pe,dir:N==="auto"?q9():N,tabIndex:-1,ref:Ae,className:i,"data-sonner-toaster":!0,"data-theme":be,"data-y-position":We,"data-lifted":re&&W.length>1&&!o,"data-x-position":$e,style:{"--front-toast-height":`${((Xe=ne[0])==null?void 0:Xe.height)||0}px`,"--width":`${Kxe}px`,"--gap":`${R}px`,...A,...e0e(m,y)},onBlur:Ke=>{Ce.current&&!Ke.currentTarget.contains(Ke.relatedTarget)&&(Ce.current=!1,me.current&&(me.current.focus({preventScroll:!0}),me.current=null))},onFocus:Ke=>{Ke.target instanceof HTMLElement&&Ke.target.dataset.dismissible==="false"||Ce.current||(Ce.current=!0,me.current=Ke.relatedTarget)},onMouseEnter:()=>ee(!0),onMouseMove:()=>ee(!0),onMouseLeave:()=>{ie||ee(!1)},onDragEnd:()=>ee(!1),onPointerDown:Ke=>{Ke.target instanceof HTMLElement&&Ke.target.dataset.dismissible==="false"||de(!0)},onPointerUp:()=>de(!1)},W.filter(Ke=>!Ke.position&&Oe===0||Ke.position===pe).map((Ke,Le)=>{var ke,st;return Ve.createElement(Qxe,{key:Ke.id,icons:F,index:Le,toast:Ke,defaultRichColors:w,duration:(ke=P==null?void 0:P.duration)!=null?ke:T,className:P==null?void 0:P.className,descriptionClassName:P==null?void 0:P.descriptionClassName,invert:r,visibleToasts:O,closeButton:(st=P==null?void 0:P.closeButton)!=null?st:d,interacting:ie,position:pe,style:P==null?void 0:P.style,unstyled:P==null?void 0:P.unstyled,classNames:P==null?void 0:P.classNames,cancelButtonStyle:P==null?void 0:P.cancelButtonStyle,actionButtonStyle:P==null?void 0:P.actionButtonStyle,removeToast:ge,toasts:W.filter(_t=>_t.position==Ke.position),heights:ne.filter(_t=>_t.position==Ke.position),setHeights:ae,expandByDefault:o,gap:R,loadingIcon:M,expanded:re,pauseWhenPageIsHidden:$,swipeDirections:e.swipeDirections})})):null}))});const r0e=({...e})=>{const{theme:t="system"}=jxe();return h.jsx(t0e,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var n0e=O4[" useId ".trim().toString()]||(()=>{}),i0e=0;function yu(e){const[t,r]=V.useState(n0e());return io(()=>{r(n=>n??String(i0e++))},[e]),t?`radix-${t}`:""}const s0e=["top","right","bottom","left"],dg=Math.min,uu=Math.max,HP=Math.round,dj=Math.floor,Fh=e=>({x:e,y:e}),a0e={left:"right",right:"left",bottom:"top",top:"bottom"},o0e={start:"end",end:"start"};function R3(e,t,r){return uu(e,dg(t,r))}function op(e,t){return typeof e=="function"?e(t):e}function lp(e){return e.split("-")[0]}function nw(e){return e.split("-")[1]}function PB(e){return e==="x"?"y":"x"}function OB(e){return e==="y"?"height":"width"}const l0e=new Set(["top","bottom"]);function Ch(e){return l0e.has(lp(e))?"y":"x"}function kB(e){return PB(Ch(e))}function c0e(e,t,r){r===void 0&&(r=!1);const n=nw(e),s=kB(e),o=OB(s);let d=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(d=GP(d)),[d,GP(d)]}function u0e(e){const t=GP(e);return[M3(e),t,M3(t)]}function M3(e){return e.replace(/start|end/g,t=>o0e[t])}const H9=["left","right"],G9=["right","left"],d0e=["top","bottom"],h0e=["bottom","top"];function f0e(e,t,r){switch(e){case"top":case"bottom":return r?t?G9:H9:t?H9:G9;case"left":case"right":return t?d0e:h0e;default:return[]}}function p0e(e,t,r,n){const s=nw(e);let o=f0e(lp(e),r==="start",n);return s&&(o=o.map(d=>d+"-"+s),t&&(o=o.concat(o.map(M3)))),o}function GP(e){return e.replace(/left|right|bottom|top/g,t=>a0e[t])}function m0e(e){return{top:0,right:0,bottom:0,left:0,...e}}function qQ(e){return typeof e!="number"?m0e(e):{top:e,right:e,bottom:e,left:e}}function WP(e){const{x:t,y:r,width:n,height:s}=e;return{width:n,height:s,top:r,left:t,right:t+n,bottom:r+s,x:t,y:r}}function W9(e,t,r){let{reference:n,floating:s}=e;const o=Ch(t),d=kB(t),i=OB(d),m=lp(t),y=o==="y",S=n.x+n.width/2-s.width/2,w=n.y+n.height/2-s.height/2,T=n[i]/2-s[i]/2;let A;switch(m){case"top":A={x:S,y:n.y-s.height};break;case"bottom":A={x:S,y:n.y+n.height};break;case"right":A={x:n.x+n.width,y:w};break;case"left":A={x:n.x-s.width,y:w};break;default:A={x:n.x,y:n.y}}switch(nw(t)){case"start":A[d]-=T*(r&&y?-1:1);break;case"end":A[d]+=T*(r&&y?-1:1);break}return A}const g0e=async(e,t,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:o=[],platform:d}=r,i=o.filter(Boolean),m=await(d.isRTL==null?void 0:d.isRTL(t));let y=await d.getElementRects({reference:e,floating:t,strategy:s}),{x:S,y:w}=W9(y,n,m),T=n,A={},O=0;for(let P=0;P<i.length;P++){const{name:N,fn:R}=i[P],{x:M,y:F,data:B,reset:$}=await R({x:S,y:w,initialPlacement:n,placement:T,strategy:s,middlewareData:A,rects:y,platform:d,elements:{reference:e,floating:t}});S=M??S,w=F??w,A={...A,[N]:{...A[N],...B}},$&&O<=50&&(O++,typeof $=="object"&&($.placement&&(T=$.placement),$.rects&&(y=$.rects===!0?await d.getElementRects({reference:e,floating:t,strategy:s}):$.rects),{x:S,y:w}=W9(y,T,m)),P=-1)}return{x:S,y:w,placement:T,strategy:s,middlewareData:A}};async function lT(e,t){var r;t===void 0&&(t={});const{x:n,y:s,platform:o,rects:d,elements:i,strategy:m}=e,{boundary:y="clippingAncestors",rootBoundary:S="viewport",elementContext:w="floating",altBoundary:T=!1,padding:A=0}=op(t,e),O=qQ(A),N=i[T?w==="floating"?"reference":"floating":w],R=WP(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(N)))==null||r?N:N.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(i.floating)),boundary:y,rootBoundary:S,strategy:m})),M=w==="floating"?{x:n,y:s,width:d.floating.width,height:d.floating.height}:d.reference,F=await(o.getOffsetParent==null?void 0:o.getOffsetParent(i.floating)),B=await(o.isElement==null?void 0:o.isElement(F))?await(o.getScale==null?void 0:o.getScale(F))||{x:1,y:1}:{x:1,y:1},$=WP(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:M,offsetParent:F,strategy:m}):M);return{top:(R.top-$.top+O.top)/B.y,bottom:($.bottom-R.bottom+O.bottom)/B.y,left:(R.left-$.left+O.left)/B.x,right:($.right-R.right+O.right)/B.x}}const y0e=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:s,rects:o,platform:d,elements:i,middlewareData:m}=t,{element:y,padding:S=0}=op(e,t)||{};if(y==null)return{};const w=qQ(S),T={x:r,y:n},A=kB(s),O=OB(A),P=await d.getDimensions(y),N=A==="y",R=N?"top":"left",M=N?"bottom":"right",F=N?"clientHeight":"clientWidth",B=o.reference[O]+o.reference[A]-T[A]-o.floating[O],$=T[A]-o.reference[A],W=await(d.getOffsetParent==null?void 0:d.getOffsetParent(y));let K=W?W[F]:0;(!K||!await(d.isElement==null?void 0:d.isElement(W)))&&(K=i.floating[F]||o.floating[O]);const te=B/2-$/2,ne=K/2-P[O]/2-1,ae=dg(w[R],ne),re=dg(w[M],ne),ee=ae,ie=K-P[O]-re,de=K/2-P[O]/2+te,be=R3(ee,de,ie),Se=!m.arrow&&nw(s)!=null&&de!==be&&o.reference[O]/2-(de<ee?ae:re)-P[O]/2<0,Ae=Se?de<ee?de-ee:de-ie:0;return{[A]:T[A]+Ae,data:{[A]:be,centerOffset:de-be-Ae,...Se&&{alignmentOffset:Ae}},reset:Se}}}),v0e=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:s,middlewareData:o,rects:d,initialPlacement:i,platform:m,elements:y}=t,{mainAxis:S=!0,crossAxis:w=!0,fallbackPlacements:T,fallbackStrategy:A="bestFit",fallbackAxisSideDirection:O="none",flipAlignment:P=!0,...N}=op(e,t);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const R=lp(s),M=Ch(i),F=lp(i)===i,B=await(m.isRTL==null?void 0:m.isRTL(y.floating)),$=T||(F||!P?[GP(i)]:u0e(i)),W=O!=="none";!T&&W&&$.push(...p0e(i,P,O,B));const K=[i,...$],te=await lT(t,N),ne=[];let ae=((n=o.flip)==null?void 0:n.overflows)||[];if(S&&ne.push(te[R]),w){const de=c0e(s,d,B);ne.push(te[de[0]],te[de[1]])}if(ae=[...ae,{placement:s,overflows:ne}],!ne.every(de=>de<=0)){var re,ee;const de=(((re=o.flip)==null?void 0:re.index)||0)+1,be=K[de];if(be&&(!(w==="alignment"?M!==Ch(be):!1)||ae.every(xe=>xe.overflows[0]>0&&Ch(xe.placement)===M)))return{data:{index:de,overflows:ae},reset:{placement:be}};let Se=(ee=ae.filter(Ae=>Ae.overflows[0]<=0).sort((Ae,xe)=>Ae.overflows[1]-xe.overflows[1])[0])==null?void 0:ee.placement;if(!Se)switch(A){case"bestFit":{var ie;const Ae=(ie=ae.filter(xe=>{if(W){const me=Ch(xe.placement);return me===M||me==="y"}return!0}).map(xe=>[xe.placement,xe.overflows.filter(me=>me>0).reduce((me,Ce)=>me+Ce,0)]).sort((xe,me)=>xe[1]-me[1])[0])==null?void 0:ie[0];Ae&&(Se=Ae);break}case"initialPlacement":Se=i;break}if(s!==Se)return{reset:{placement:Se}}}return{}}}};function K9(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Z9(e){return s0e.some(t=>e[t]>=0)}const _0e=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...s}=op(e,t);switch(n){case"referenceHidden":{const o=await lT(t,{...s,elementContext:"reference"}),d=K9(o,r.reference);return{data:{referenceHiddenOffsets:d,referenceHidden:Z9(d)}}}case"escaped":{const o=await lT(t,{...s,altBoundary:!0}),d=K9(o,r.floating);return{data:{escapedOffsets:d,escaped:Z9(d)}}}default:return{}}}}},HQ=new Set(["left","top"]);async function x0e(e,t){const{placement:r,platform:n,elements:s}=e,o=await(n.isRTL==null?void 0:n.isRTL(s.floating)),d=lp(r),i=nw(r),m=Ch(r)==="y",y=HQ.has(d)?-1:1,S=o&&m?-1:1,w=op(t,e);let{mainAxis:T,crossAxis:A,alignmentAxis:O}=typeof w=="number"?{mainAxis:w,crossAxis:0,alignmentAxis:null}:{mainAxis:w.mainAxis||0,crossAxis:w.crossAxis||0,alignmentAxis:w.alignmentAxis};return i&&typeof O=="number"&&(A=i==="end"?O*-1:O),m?{x:A*S,y:T*y}:{x:T*y,y:A*S}}const b0e=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:s,y:o,placement:d,middlewareData:i}=t,m=await x0e(t,e);return d===((r=i.offset)==null?void 0:r.placement)&&(n=i.arrow)!=null&&n.alignmentOffset?{}:{x:s+m.x,y:o+m.y,data:{...m,placement:d}}}}},w0e=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:s}=t,{mainAxis:o=!0,crossAxis:d=!1,limiter:i={fn:N=>{let{x:R,y:M}=N;return{x:R,y:M}}},...m}=op(e,t),y={x:r,y:n},S=await lT(t,m),w=Ch(lp(s)),T=PB(w);let A=y[T],O=y[w];if(o){const N=T==="y"?"top":"left",R=T==="y"?"bottom":"right",M=A+S[N],F=A-S[R];A=R3(M,A,F)}if(d){const N=w==="y"?"top":"left",R=w==="y"?"bottom":"right",M=O+S[N],F=O-S[R];O=R3(M,O,F)}const P=i.fn({...t,[T]:A,[w]:O});return{...P,data:{x:P.x-r,y:P.y-n,enabled:{[T]:o,[w]:d}}}}}},S0e=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:s,rects:o,middlewareData:d}=t,{offset:i=0,mainAxis:m=!0,crossAxis:y=!0}=op(e,t),S={x:r,y:n},w=Ch(s),T=PB(w);let A=S[T],O=S[w];const P=op(i,t),N=typeof P=="number"?{mainAxis:P,crossAxis:0}:{mainAxis:0,crossAxis:0,...P};if(m){const F=T==="y"?"height":"width",B=o.reference[T]-o.floating[F]+N.mainAxis,$=o.reference[T]+o.reference[F]-N.mainAxis;A<B?A=B:A>$&&(A=$)}if(y){var R,M;const F=T==="y"?"width":"height",B=HQ.has(lp(s)),$=o.reference[w]-o.floating[F]+(B&&((R=d.offset)==null?void 0:R[w])||0)+(B?0:N.crossAxis),W=o.reference[w]+o.reference[F]+(B?0:((M=d.offset)==null?void 0:M[w])||0)-(B?N.crossAxis:0);O<$?O=$:O>W&&(O=W)}return{[T]:A,[w]:O}}}},E0e=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:s,rects:o,platform:d,elements:i}=t,{apply:m=()=>{},...y}=op(e,t),S=await lT(t,y),w=lp(s),T=nw(s),A=Ch(s)==="y",{width:O,height:P}=o.floating;let N,R;w==="top"||w==="bottom"?(N=w,R=T===(await(d.isRTL==null?void 0:d.isRTL(i.floating))?"start":"end")?"left":"right"):(R=w,N=T==="end"?"top":"bottom");const M=P-S.top-S.bottom,F=O-S.left-S.right,B=dg(P-S[N],M),$=dg(O-S[R],F),W=!t.middlewareData.shift;let K=B,te=$;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(te=F),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(K=M),W&&!T){const ae=uu(S.left,0),re=uu(S.right,0),ee=uu(S.top,0),ie=uu(S.bottom,0);A?te=O-2*(ae!==0||re!==0?ae+re:uu(S.left,S.right)):K=P-2*(ee!==0||ie!==0?ee+ie:uu(S.top,S.bottom))}await m({...t,availableWidth:te,availableHeight:K});const ne=await d.getDimensions(i.floating);return O!==ne.width||P!==ne.height?{reset:{rects:!0}}:{}}}};function sN(){return typeof window<"u"}function iw(e){return GQ(e)?(e.nodeName||"").toLowerCase():"#document"}function vu(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Jh(e){var t;return(t=(GQ(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function GQ(e){return sN()?e instanceof Node||e instanceof vu(e).Node:!1}function Hd(e){return sN()?e instanceof Element||e instanceof vu(e).Element:!1}function Vh(e){return sN()?e instanceof HTMLElement||e instanceof vu(e).HTMLElement:!1}function X9(e){return!sN()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof vu(e).ShadowRoot}const T0e=new Set(["inline","contents"]);function x2(e){const{overflow:t,overflowX:r,overflowY:n,display:s}=Gd(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!T0e.has(s)}const A0e=new Set(["table","td","th"]);function C0e(e){return A0e.has(iw(e))}const j0e=[":popover-open",":modal"];function aN(e){return j0e.some(t=>{try{return e.matches(t)}catch{return!1}})}const P0e=["transform","translate","scale","rotate","perspective"],O0e=["transform","translate","scale","rotate","perspective","filter"],k0e=["paint","layout","strict","content"];function NB(e){const t=IB(),r=Hd(e)?Gd(e):e;return P0e.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||O0e.some(n=>(r.willChange||"").includes(n))||k0e.some(n=>(r.contain||"").includes(n))}function N0e(e){let t=hg(e);for(;Vh(t)&&!lb(t);){if(NB(t))return t;if(aN(t))return null;t=hg(t)}return null}function IB(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const I0e=new Set(["html","body","#document"]);function lb(e){return I0e.has(iw(e))}function Gd(e){return vu(e).getComputedStyle(e)}function oN(e){return Hd(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function hg(e){if(iw(e)==="html")return e;const t=e.assignedSlot||e.parentNode||X9(e)&&e.host||Jh(e);return X9(t)?t.host:t}function WQ(e){const t=hg(e);return lb(t)?e.ownerDocument?e.ownerDocument.body:e.body:Vh(t)&&x2(t)?t:WQ(t)}function cT(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const s=WQ(e),o=s===((n=e.ownerDocument)==null?void 0:n.body),d=vu(s);if(o){const i=D3(d);return t.concat(d,d.visualViewport||[],x2(s)?s:[],i&&r?cT(i):[])}return t.concat(s,cT(s,[],r))}function D3(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function KQ(e){const t=Gd(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const s=Vh(e),o=s?e.offsetWidth:r,d=s?e.offsetHeight:n,i=HP(r)!==o||HP(n)!==d;return i&&(r=o,n=d),{width:r,height:n,$:i}}function RB(e){return Hd(e)?e:e.contextElement}function k0(e){const t=RB(e);if(!Vh(t))return Fh(1);const r=t.getBoundingClientRect(),{width:n,height:s,$:o}=KQ(t);let d=(o?HP(r.width):r.width)/n,i=(o?HP(r.height):r.height)/s;return(!d||!Number.isFinite(d))&&(d=1),(!i||!Number.isFinite(i))&&(i=1),{x:d,y:i}}const R0e=Fh(0);function ZQ(e){const t=vu(e);return!IB()||!t.visualViewport?R0e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function M0e(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==vu(e)?!1:t}function Tv(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const s=e.getBoundingClientRect(),o=RB(e);let d=Fh(1);t&&(n?Hd(n)&&(d=k0(n)):d=k0(e));const i=M0e(o,r,n)?ZQ(o):Fh(0);let m=(s.left+i.x)/d.x,y=(s.top+i.y)/d.y,S=s.width/d.x,w=s.height/d.y;if(o){const T=vu(o),A=n&&Hd(n)?vu(n):n;let O=T,P=D3(O);for(;P&&n&&A!==O;){const N=k0(P),R=P.getBoundingClientRect(),M=Gd(P),F=R.left+(P.clientLeft+parseFloat(M.paddingLeft))*N.x,B=R.top+(P.clientTop+parseFloat(M.paddingTop))*N.y;m*=N.x,y*=N.y,S*=N.x,w*=N.y,m+=F,y+=B,O=vu(P),P=D3(O)}}return WP({width:S,height:w,x:m,y})}function MB(e,t){const r=oN(e).scrollLeft;return t?t.left+r:Tv(Jh(e)).left+r}function XQ(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-(r?0:MB(e,n)),o=n.top+t.scrollTop;return{x:s,y:o}}function D0e(e){let{elements:t,rect:r,offsetParent:n,strategy:s}=e;const o=s==="fixed",d=Jh(n),i=t?aN(t.floating):!1;if(n===d||i&&o)return r;let m={scrollLeft:0,scrollTop:0},y=Fh(1);const S=Fh(0),w=Vh(n);if((w||!w&&!o)&&((iw(n)!=="body"||x2(d))&&(m=oN(n)),Vh(n))){const A=Tv(n);y=k0(n),S.x=A.x+n.clientLeft,S.y=A.y+n.clientTop}const T=d&&!w&&!o?XQ(d,m,!0):Fh(0);return{width:r.width*y.x,height:r.height*y.y,x:r.x*y.x-m.scrollLeft*y.x+S.x+T.x,y:r.y*y.y-m.scrollTop*y.y+S.y+T.y}}function L0e(e){return Array.from(e.getClientRects())}function F0e(e){const t=Jh(e),r=oN(e),n=e.ownerDocument.body,s=uu(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),o=uu(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let d=-r.scrollLeft+MB(e);const i=-r.scrollTop;return Gd(n).direction==="rtl"&&(d+=uu(t.clientWidth,n.clientWidth)-s),{width:s,height:o,x:d,y:i}}function z0e(e,t){const r=vu(e),n=Jh(e),s=r.visualViewport;let o=n.clientWidth,d=n.clientHeight,i=0,m=0;if(s){o=s.width,d=s.height;const y=IB();(!y||y&&t==="fixed")&&(i=s.offsetLeft,m=s.offsetTop)}return{width:o,height:d,x:i,y:m}}const B0e=new Set(["absolute","fixed"]);function $0e(e,t){const r=Tv(e,!0,t==="fixed"),n=r.top+e.clientTop,s=r.left+e.clientLeft,o=Vh(e)?k0(e):Fh(1),d=e.clientWidth*o.x,i=e.clientHeight*o.y,m=s*o.x,y=n*o.y;return{width:d,height:i,x:m,y}}function Y9(e,t,r){let n;if(t==="viewport")n=z0e(e,r);else if(t==="document")n=F0e(Jh(e));else if(Hd(t))n=$0e(t,r);else{const s=ZQ(e);n={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return WP(n)}function YQ(e,t){const r=hg(e);return r===t||!Hd(r)||lb(r)?!1:Gd(r).position==="fixed"||YQ(r,t)}function U0e(e,t){const r=t.get(e);if(r)return r;let n=cT(e,[],!1).filter(i=>Hd(i)&&iw(i)!=="body"),s=null;const o=Gd(e).position==="fixed";let d=o?hg(e):e;for(;Hd(d)&&!lb(d);){const i=Gd(d),m=NB(d);!m&&i.position==="fixed"&&(s=null),(o?!m&&!s:!m&&i.position==="static"&&!!s&&B0e.has(s.position)||x2(d)&&!m&&YQ(e,d))?n=n.filter(S=>S!==d):s=i,d=hg(d)}return t.set(e,n),n}function V0e(e){let{element:t,boundary:r,rootBoundary:n,strategy:s}=e;const d=[...r==="clippingAncestors"?aN(t)?[]:U0e(t,this._c):[].concat(r),n],i=d[0],m=d.reduce((y,S)=>{const w=Y9(t,S,s);return y.top=uu(w.top,y.top),y.right=dg(w.right,y.right),y.bottom=dg(w.bottom,y.bottom),y.left=uu(w.left,y.left),y},Y9(t,i,s));return{width:m.right-m.left,height:m.bottom-m.top,x:m.left,y:m.top}}function q0e(e){const{width:t,height:r}=KQ(e);return{width:t,height:r}}function H0e(e,t,r){const n=Vh(t),s=Jh(t),o=r==="fixed",d=Tv(e,!0,o,t);let i={scrollLeft:0,scrollTop:0};const m=Fh(0);function y(){m.x=MB(s)}if(n||!n&&!o)if((iw(t)!=="body"||x2(s))&&(i=oN(t)),n){const A=Tv(t,!0,o,t);m.x=A.x+t.clientLeft,m.y=A.y+t.clientTop}else s&&y();o&&!n&&s&&y();const S=s&&!n&&!o?XQ(s,i):Fh(0),w=d.left+i.scrollLeft-m.x-S.x,T=d.top+i.scrollTop-m.y-S.y;return{x:w,y:T,width:d.width,height:d.height}}function AD(e){return Gd(e).position==="static"}function J9(e,t){if(!Vh(e)||Gd(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Jh(e)===r&&(r=r.ownerDocument.body),r}function JQ(e,t){const r=vu(e);if(aN(e))return r;if(!Vh(e)){let s=hg(e);for(;s&&!lb(s);){if(Hd(s)&&!AD(s))return s;s=hg(s)}return r}let n=J9(e,t);for(;n&&C0e(n)&&AD(n);)n=J9(n,t);return n&&lb(n)&&AD(n)&&!NB(n)?r:n||N0e(e)||r}const G0e=async function(e){const t=this.getOffsetParent||JQ,r=this.getDimensions,n=await r(e.floating);return{reference:H0e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function W0e(e){return Gd(e).direction==="rtl"}const K0e={convertOffsetParentRelativeRectToViewportRelativeRect:D0e,getDocumentElement:Jh,getClippingRect:V0e,getOffsetParent:JQ,getElementRects:G0e,getClientRects:L0e,getDimensions:q0e,getScale:k0,isElement:Hd,isRTL:W0e};function QQ(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Z0e(e,t){let r=null,n;const s=Jh(e);function o(){var i;clearTimeout(n),(i=r)==null||i.disconnect(),r=null}function d(i,m){i===void 0&&(i=!1),m===void 0&&(m=1),o();const y=e.getBoundingClientRect(),{left:S,top:w,width:T,height:A}=y;if(i||t(),!T||!A)return;const O=dj(w),P=dj(s.clientWidth-(S+T)),N=dj(s.clientHeight-(w+A)),R=dj(S),F={rootMargin:-O+"px "+-P+"px "+-N+"px "+-R+"px",threshold:uu(0,dg(1,m))||1};let B=!0;function $(W){const K=W[0].intersectionRatio;if(K!==m){if(!B)return d();K?d(!1,K):n=setTimeout(()=>{d(!1,1e-7)},1e3)}K===1&&!QQ(y,e.getBoundingClientRect())&&d(),B=!1}try{r=new IntersectionObserver($,{...F,root:s.ownerDocument})}catch{r=new IntersectionObserver($,F)}r.observe(e)}return d(!0),o}function X0e(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:d=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:m=!1}=n,y=RB(e),S=s||o?[...y?cT(y):[],...cT(t)]:[];S.forEach(R=>{s&&R.addEventListener("scroll",r,{passive:!0}),o&&R.addEventListener("resize",r)});const w=y&&i?Z0e(y,r):null;let T=-1,A=null;d&&(A=new ResizeObserver(R=>{let[M]=R;M&&M.target===y&&A&&(A.unobserve(t),cancelAnimationFrame(T),T=requestAnimationFrame(()=>{var F;(F=A)==null||F.observe(t)})),r()}),y&&!m&&A.observe(y),A.observe(t));let O,P=m?Tv(e):null;m&&N();function N(){const R=Tv(e);P&&!QQ(P,R)&&r(),P=R,O=requestAnimationFrame(N)}return r(),()=>{var R;S.forEach(M=>{s&&M.removeEventListener("scroll",r),o&&M.removeEventListener("resize",r)}),w==null||w(),(R=A)==null||R.disconnect(),A=null,m&&cancelAnimationFrame(O)}}const Y0e=b0e,J0e=w0e,Q0e=v0e,ebe=E0e,tbe=_0e,Q9=y0e,rbe=S0e,nbe=(e,t,r)=>{const n=new Map,s={platform:K0e,...r},o={...s.platform,_c:n};return g0e(e,t,{...s,platform:o})};var ibe=typeof document<"u",sbe=function(){},rP=ibe?V.useLayoutEffect:sbe;function KP(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,s;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!KP(e[n],t[n]))return!1;return!0}if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,s[n]))return!1;for(n=r;n--!==0;){const o=s[n];if(!(o==="_owner"&&e.$$typeof)&&!KP(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function eee(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function eH(e,t){const r=eee(e);return Math.round(t*r)/r}function CD(e){const t=V.useRef(e);return rP(()=>{t.current=e}),t}function abe(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:d}={},transform:i=!0,whileElementsMounted:m,open:y}=e,[S,w]=V.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[T,A]=V.useState(n);KP(T,n)||A(n);const[O,P]=V.useState(null),[N,R]=V.useState(null),M=V.useCallback(xe=>{xe!==W.current&&(W.current=xe,P(xe))},[]),F=V.useCallback(xe=>{xe!==K.current&&(K.current=xe,R(xe))},[]),B=o||O,$=d||N,W=V.useRef(null),K=V.useRef(null),te=V.useRef(S),ne=m!=null,ae=CD(m),re=CD(s),ee=CD(y),ie=V.useCallback(()=>{if(!W.current||!K.current)return;const xe={placement:t,strategy:r,middleware:T};re.current&&(xe.platform=re.current),nbe(W.current,K.current,xe).then(me=>{const Ce={...me,isPositioned:ee.current!==!1};de.current&&!KP(te.current,Ce)&&(te.current=Ce,xg.flushSync(()=>{w(Ce)}))})},[T,t,r,re,ee]);rP(()=>{y===!1&&te.current.isPositioned&&(te.current.isPositioned=!1,w(xe=>({...xe,isPositioned:!1})))},[y]);const de=V.useRef(!1);rP(()=>(de.current=!0,()=>{de.current=!1}),[]),rP(()=>{if(B&&(W.current=B),$&&(K.current=$),B&&$){if(ae.current)return ae.current(B,$,ie);ie()}},[B,$,ie,ae,ne]);const be=V.useMemo(()=>({reference:W,floating:K,setReference:M,setFloating:F}),[M,F]),Se=V.useMemo(()=>({reference:B,floating:$}),[B,$]),Ae=V.useMemo(()=>{const xe={position:r,left:0,top:0};if(!Se.floating)return xe;const me=eH(Se.floating,S.x),Ce=eH(Se.floating,S.y);return i?{...xe,transform:"translate("+me+"px, "+Ce+"px)",...eee(Se.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:me,top:Ce}},[r,i,Se.floating,S.x,S.y]);return V.useMemo(()=>({...S,update:ie,refs:be,elements:Se,floatingStyles:Ae}),[S,ie,be,Se,Ae])}const obe=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:s}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?Q9({element:n.current,padding:s}).fn(r):{}:n?Q9({element:n,padding:s}).fn(r):{}}}},lbe=(e,t)=>({...Y0e(e),options:[e,t]}),cbe=(e,t)=>({...J0e(e),options:[e,t]}),ube=(e,t)=>({...rbe(e),options:[e,t]}),dbe=(e,t)=>({...Q0e(e),options:[e,t]}),hbe=(e,t)=>({...ebe(e),options:[e,t]}),fbe=(e,t)=>({...tbe(e),options:[e,t]}),pbe=(e,t)=>({...obe(e),options:[e,t]});var mbe="Arrow",tee=V.forwardRef((e,t)=>{const{children:r,width:n=10,height:s=5,...o}=e;return h.jsx(on.svg,{...o,ref:t,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});tee.displayName=mbe;var gbe=tee;function b2(e){const[t,r]=V.useState(void 0);return io(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let d,i;if("borderBoxSize"in o){const m=o.borderBoxSize,y=Array.isArray(m)?m[0]:m;d=y.inlineSize,i=y.blockSize}else d=e.offsetWidth,i=e.offsetHeight;r({width:d,height:i})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var DB="Popper",[ree,bg]=Fo(DB),[ybe,nee]=ree(DB),iee=e=>{const{__scopePopper:t,children:r}=e,[n,s]=V.useState(null);return h.jsx(ybe,{scope:t,anchor:n,onAnchorChange:s,children:r})};iee.displayName=DB;var see="PopperAnchor",aee=V.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...s}=e,o=nee(see,r),d=V.useRef(null),i=$n(t,d);return V.useEffect(()=>{o.onAnchorChange((n==null?void 0:n.current)||d.current)}),n?null:h.jsx(on.div,{...s,ref:i})});aee.displayName=see;var LB="PopperContent",[vbe,_be]=ree(LB),oee=V.forwardRef((e,t)=>{var Ke,Le,ke,st,_t,Be;const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:o="center",alignOffset:d=0,arrowPadding:i=0,avoidCollisions:m=!0,collisionBoundary:y=[],collisionPadding:S=0,sticky:w="partial",hideWhenDetached:T=!1,updatePositionStrategy:A="optimized",onPlaced:O,...P}=e,N=nee(LB,r),[R,M]=V.useState(null),F=$n(t,Dt=>M(Dt)),[B,$]=V.useState(null),W=b2(B),K=(W==null?void 0:W.width)??0,te=(W==null?void 0:W.height)??0,ne=n+(o!=="center"?"-"+o:""),ae=typeof S=="number"?S:{top:0,right:0,bottom:0,left:0,...S},re=Array.isArray(y)?y:[y],ee=re.length>0,ie={padding:ae,boundary:re.filter(bbe),altBoundary:ee},{refs:de,floatingStyles:be,placement:Se,isPositioned:Ae,middlewareData:xe}=abe({strategy:"fixed",placement:ne,whileElementsMounted:(...Dt)=>X0e(...Dt,{animationFrame:A==="always"}),elements:{reference:N.anchor},middleware:[lbe({mainAxis:s+te,alignmentAxis:d}),m&&cbe({mainAxis:!0,crossAxis:!1,limiter:w==="partial"?ube():void 0,...ie}),m&&dbe({...ie}),hbe({...ie,apply:({elements:Dt,rects:It,availableWidth:ir,availableHeight:Dr})=>{const{width:Rr,height:jt}=It.reference,zt=Dt.floating.style;zt.setProperty("--radix-popper-available-width",`${ir}px`),zt.setProperty("--radix-popper-available-height",`${Dr}px`),zt.setProperty("--radix-popper-anchor-width",`${Rr}px`),zt.setProperty("--radix-popper-anchor-height",`${jt}px`)}}),B&&pbe({element:B,padding:i}),wbe({arrowWidth:K,arrowHeight:te}),T&&fbe({strategy:"referenceHidden",...ie})]}),[me,Ce]=uee(Se),ge=no(O);io(()=>{Ae&&(ge==null||ge())},[Ae,ge]);const pe=(Ke=xe.arrow)==null?void 0:Ke.x,Oe=(Le=xe.arrow)==null?void 0:Le.y,Xe=((ke=xe.arrow)==null?void 0:ke.centerOffset)!==0,[We,$e]=V.useState();return io(()=>{R&&$e(window.getComputedStyle(R).zIndex)},[R]),h.jsx("div",{ref:de.setFloating,"data-radix-popper-content-wrapper":"",style:{...be,transform:Ae?be.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:We,"--radix-popper-transform-origin":[(st=xe.transformOrigin)==null?void 0:st.x,(_t=xe.transformOrigin)==null?void 0:_t.y].join(" "),...((Be=xe.hide)==null?void 0:Be.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:h.jsx(vbe,{scope:r,placedSide:me,onArrowChange:$,arrowX:pe,arrowY:Oe,shouldHideArrow:Xe,children:h.jsx(on.div,{"data-side":me,"data-align":Ce,...P,ref:F,style:{...P.style,animation:Ae?void 0:"none"}})})})});oee.displayName=LB;var lee="PopperArrow",xbe={top:"bottom",right:"left",bottom:"top",left:"right"},cee=V.forwardRef(function(t,r){const{__scopePopper:n,...s}=t,o=_be(lee,n),d=xbe[o.placedSide];return h.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[d]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:h.jsx(gbe,{...s,ref:r,style:{...s.style,display:"block"}})})});cee.displayName=lee;function bbe(e){return e!==null}var wbe=e=>({name:"transformOrigin",options:e,fn(t){var N,R,M;const{placement:r,rects:n,middlewareData:s}=t,d=((N=s.arrow)==null?void 0:N.centerOffset)!==0,i=d?0:e.arrowWidth,m=d?0:e.arrowHeight,[y,S]=uee(r),w={start:"0%",center:"50%",end:"100%"}[S],T=(((R=s.arrow)==null?void 0:R.x)??0)+i/2,A=(((M=s.arrow)==null?void 0:M.y)??0)+m/2;let O="",P="";return y==="bottom"?(O=d?w:`${T}px`,P=`${-m}px`):y==="top"?(O=d?w:`${T}px`,P=`${n.floating.height+m}px`):y==="right"?(O=`${-m}px`,P=d?w:`${A}px`):y==="left"&&(O=`${n.floating.width+m}px`,P=d?w:`${A}px`),{data:{x:O,y:P}}}});function uee(e){const[t,r="center"]=e.split("-");return[t,r]}var lN=iee,w2=aee,cN=oee,uN=cee,[dN,Xit]=Fo("Tooltip",[bg]),hN=bg(),dee="TooltipProvider",Sbe=700,L3="tooltip.open",[Ebe,FB]=dN(dee),hee=e=>{const{__scopeTooltip:t,delayDuration:r=Sbe,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:o}=e,d=V.useRef(!0),i=V.useRef(!1),m=V.useRef(0);return V.useEffect(()=>{const y=m.current;return()=>window.clearTimeout(y)},[]),h.jsx(Ebe,{scope:t,isOpenDelayedRef:d,delayDuration:r,onOpen:V.useCallback(()=>{window.clearTimeout(m.current),d.current=!1},[]),onClose:V.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>d.current=!0,n)},[n]),isPointerInTransitRef:i,onPointerInTransitChange:V.useCallback(y=>{i.current=y},[]),disableHoverableContent:s,children:o})};hee.displayName=dee;var uT="Tooltip",[Tbe,fN]=dN(uT),fee=e=>{const{__scopeTooltip:t,children:r,open:n,defaultOpen:s,onOpenChange:o,disableHoverableContent:d,delayDuration:i}=e,m=FB(uT,e.__scopeTooltip),y=hN(t),[S,w]=V.useState(null),T=yu(),A=V.useRef(0),O=d??m.disableHoverableContent,P=i??m.delayDuration,N=V.useRef(!1),[R,M]=Zc({prop:n,defaultProp:s??!1,onChange:K=>{K?(m.onOpen(),document.dispatchEvent(new CustomEvent(L3))):m.onClose(),o==null||o(K)},caller:uT}),F=V.useMemo(()=>R?N.current?"delayed-open":"instant-open":"closed",[R]),B=V.useCallback(()=>{window.clearTimeout(A.current),A.current=0,N.current=!1,M(!0)},[M]),$=V.useCallback(()=>{window.clearTimeout(A.current),A.current=0,M(!1)},[M]),W=V.useCallback(()=>{window.clearTimeout(A.current),A.current=window.setTimeout(()=>{N.current=!0,M(!0),A.current=0},P)},[P,M]);return V.useEffect(()=>()=>{A.current&&(window.clearTimeout(A.current),A.current=0)},[]),h.jsx(lN,{...y,children:h.jsx(Tbe,{scope:t,contentId:T,open:R,stateAttribute:F,trigger:S,onTriggerChange:w,onTriggerEnter:V.useCallback(()=>{m.isOpenDelayedRef.current?W():B()},[m.isOpenDelayedRef,W,B]),onTriggerLeave:V.useCallback(()=>{O?$():(window.clearTimeout(A.current),A.current=0)},[$,O]),onOpen:B,onClose:$,disableHoverableContent:O,children:r})})};fee.displayName=uT;var F3="TooltipTrigger",pee=V.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,s=fN(F3,r),o=FB(F3,r),d=hN(r),i=V.useRef(null),m=$n(t,i,s.onTriggerChange),y=V.useRef(!1),S=V.useRef(!1),w=V.useCallback(()=>y.current=!1,[]);return V.useEffect(()=>()=>document.removeEventListener("pointerup",w),[w]),h.jsx(w2,{asChild:!0,...d,children:h.jsx(on.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:m,onPointerMove:Ir(e.onPointerMove,T=>{T.pointerType!=="touch"&&!S.current&&!o.isPointerInTransitRef.current&&(s.onTriggerEnter(),S.current=!0)}),onPointerLeave:Ir(e.onPointerLeave,()=>{s.onTriggerLeave(),S.current=!1}),onPointerDown:Ir(e.onPointerDown,()=>{s.open&&s.onClose(),y.current=!0,document.addEventListener("pointerup",w,{once:!0})}),onFocus:Ir(e.onFocus,()=>{y.current||s.onOpen()}),onBlur:Ir(e.onBlur,s.onClose),onClick:Ir(e.onClick,s.onClose)})})});pee.displayName=F3;var Abe="TooltipPortal",[Yit,Cbe]=dN(Abe,{forceMount:void 0}),cb="TooltipContent",mee=V.forwardRef((e,t)=>{const r=Cbe(cb,e.__scopeTooltip),{forceMount:n=r.forceMount,side:s="top",...o}=e,d=fN(cb,e.__scopeTooltip);return h.jsx(zo,{present:n||d.open,children:d.disableHoverableContent?h.jsx(gee,{side:s,...o,ref:t}):h.jsx(jbe,{side:s,...o,ref:t})})}),jbe=V.forwardRef((e,t)=>{const r=fN(cb,e.__scopeTooltip),n=FB(cb,e.__scopeTooltip),s=V.useRef(null),o=$n(t,s),[d,i]=V.useState(null),{trigger:m,onClose:y}=r,S=s.current,{onPointerInTransitChange:w}=n,T=V.useCallback(()=>{i(null),w(!1)},[w]),A=V.useCallback((O,P)=>{const N=O.currentTarget,R={x:O.clientX,y:O.clientY},M=Ibe(R,N.getBoundingClientRect()),F=Rbe(R,M),B=Mbe(P.getBoundingClientRect()),$=Lbe([...F,...B]);i($),w(!0)},[w]);return V.useEffect(()=>()=>T(),[T]),V.useEffect(()=>{if(m&&S){const O=N=>A(N,S),P=N=>A(N,m);return m.addEventListener("pointerleave",O),S.addEventListener("pointerleave",P),()=>{m.removeEventListener("pointerleave",O),S.removeEventListener("pointerleave",P)}}},[m,S,A,T]),V.useEffect(()=>{if(d){const O=P=>{const N=P.target,R={x:P.clientX,y:P.clientY},M=(m==null?void 0:m.contains(N))||(S==null?void 0:S.contains(N)),F=!Dbe(R,d);M?T():F&&(T(),y())};return document.addEventListener("pointermove",O),()=>document.removeEventListener("pointermove",O)}},[m,S,d,y,T]),h.jsx(gee,{...e,ref:o})}),[Pbe,Obe]=dN(uT,{isInside:!1}),kbe=YJ("TooltipContent"),gee=V.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":s,onEscapeKeyDown:o,onPointerDownOutside:d,...i}=e,m=fN(cb,r),y=hN(r),{onClose:S}=m;return V.useEffect(()=>(document.addEventListener(L3,S),()=>document.removeEventListener(L3,S)),[S]),V.useEffect(()=>{if(m.trigger){const w=T=>{const A=T.target;A!=null&&A.contains(m.trigger)&&S()};return window.addEventListener("scroll",w,{capture:!0}),()=>window.removeEventListener("scroll",w,{capture:!0})}},[m.trigger,S]),h.jsx(Kv,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:d,onFocusOutside:w=>w.preventDefault(),onDismiss:S,children:h.jsxs(cN,{"data-state":m.stateAttribute,...y,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[h.jsx(kbe,{children:n}),h.jsx(Pbe,{scope:r,isInside:!0,children:h.jsx(Wve,{id:m.contentId,role:"tooltip",children:s||n})})]})})});mee.displayName=cb;var yee="TooltipArrow",Nbe=V.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,s=hN(r);return Obe(yee,r).isInside?null:h.jsx(uN,{...s,...n,ref:t})});Nbe.displayName=yee;function Ibe(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),o=Math.abs(t.left-e.x);switch(Math.min(r,n,s,o)){case o:return"left";case s:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Rbe(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function Mbe(e){const{top:t,right:r,bottom:n,left:s}=e;return[{x:s,y:t},{x:r,y:t},{x:r,y:n},{x:s,y:n}]}function Dbe(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,d=t.length-1;o<t.length;d=o++){const i=t[o],m=t[d],y=i.x,S=i.y,w=m.x,T=m.y;S>n!=T>n&&r<(w-y)*(n-S)/(T-S)+y&&(s=!s)}return s}function Lbe(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Fbe(t)}function Fbe(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const s=e[n];for(;t.length>=2;){const o=t[t.length-1],d=t[t.length-2];if((o.x-d.x)*(s.y-d.y)>=(o.y-d.y)*(s.x-d.x))t.pop();else break}t.push(s)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const s=e[n];for(;r.length>=2;){const o=r[r.length-1],d=r[r.length-2];if((o.x-d.x)*(s.y-d.y)>=(o.y-d.y)*(s.x-d.x))r.pop();else break}r.push(s)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var zbe=hee,Bbe=fee,$be=pee,vee=mee;const _ee=zbe,Ube=Bbe,Vbe=$be,xee=V.forwardRef(({className:e,sideOffset:t=4,...r},n)=>h.jsx(vee,{ref:n,sideOffset:t,className:fr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));xee.displayName=vee.displayName;var sw=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Av=typeof window>"u"||"Deno"in globalThis;function lc(){}function qbe(e,t){return typeof e=="function"?e(t):e}function z3(e){return typeof e=="number"&&e>=0&&e!==1/0}function bee(e,t){return Math.max(e+(t||0)-Date.now(),0)}function ng(e,t){return typeof e=="function"?e(t):e}function Fu(e,t){return typeof e=="function"?e(t):e}function tH(e,t){const{type:r="all",exact:n,fetchStatus:s,predicate:o,queryKey:d,stale:i}=e;if(d){if(n){if(t.queryHash!==zB(d,t.options))return!1}else if(!dT(t.queryKey,d))return!1}if(r!=="all"){const m=t.isActive();if(r==="active"&&!m||r==="inactive"&&m)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||s&&s!==t.state.fetchStatus||o&&!o(t))}function rH(e,t){const{exact:r,status:n,predicate:s,mutationKey:o}=e;if(o){if(!t.options.mutationKey)return!1;if(r){if(Cv(t.options.mutationKey)!==Cv(o))return!1}else if(!dT(t.options.mutationKey,o))return!1}return!(n&&t.state.status!==n||s&&!s(t))}function zB(e,t){return((t==null?void 0:t.queryKeyHashFn)||Cv)(e)}function Cv(e){return JSON.stringify(e,(t,r)=>B3(r)?Object.keys(r).sort().reduce((n,s)=>(n[s]=r[s],n),{}):r)}function dT(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>dT(e[r],t[r])):!1}function wee(e,t){if(e===t)return e;const r=nH(e)&&nH(t);if(r||B3(e)&&B3(t)){const n=r?e:Object.keys(e),s=n.length,o=r?t:Object.keys(t),d=o.length,i=r?[]:{},m=new Set(n);let y=0;for(let S=0;S<d;S++){const w=r?S:o[S];(!r&&m.has(w)||r)&&e[w]===void 0&&t[w]===void 0?(i[w]=void 0,y++):(i[w]=wee(e[w],t[w]),i[w]===e[w]&&e[w]!==void 0&&y++)}return s===d&&y===s?e:i}return t}function ZP(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function nH(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function B3(e){if(!iH(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!iH(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function iH(e){return Object.prototype.toString.call(e)==="[object Object]"}function Hbe(e){return new Promise(t=>{setTimeout(t,e)})}function $3(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?wee(e,t):t}function Gbe(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function Wbe(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var BB=Symbol();function See(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===BB?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Eee(e,t){return typeof e=="function"?e(...t):!!e}var av,Rm,$0,TX,Kbe=(TX=class extends sw{constructor(){super();Wn(this,av);Wn(this,Rm);Wn(this,$0);pn(this,$0,t=>{if(!Av&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){Et(this,Rm)||this.setEventListener(Et(this,$0))}onUnsubscribe(){var t;this.hasListeners()||((t=Et(this,Rm))==null||t.call(this),pn(this,Rm,void 0))}setEventListener(t){var r;pn(this,$0,t),(r=Et(this,Rm))==null||r.call(this),pn(this,Rm,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){Et(this,av)!==t&&(pn(this,av,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof Et(this,av)=="boolean"?Et(this,av):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},av=new WeakMap,Rm=new WeakMap,$0=new WeakMap,TX),$B=new Kbe,U0,Mm,V0,AX,Zbe=(AX=class extends sw{constructor(){super();Wn(this,U0,!0);Wn(this,Mm);Wn(this,V0);pn(this,V0,t=>{if(!Av&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){Et(this,Mm)||this.setEventListener(Et(this,V0))}onUnsubscribe(){var t;this.hasListeners()||((t=Et(this,Mm))==null||t.call(this),pn(this,Mm,void 0))}setEventListener(t){var r;pn(this,V0,t),(r=Et(this,Mm))==null||r.call(this),pn(this,Mm,t(this.setOnline.bind(this)))}setOnline(t){Et(this,U0)!==t&&(pn(this,U0,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return Et(this,U0)}},U0=new WeakMap,Mm=new WeakMap,V0=new WeakMap,AX),XP=new Zbe;function U3(){let e,t;const r=new Promise((s,o)=>{e=s,t=o});r.status="pending",r.catch(()=>{});function n(s){Object.assign(r,s),delete r.resolve,delete r.reject}return r.resolve=s=>{n({status:"fulfilled",value:s}),e(s)},r.reject=s=>{n({status:"rejected",reason:s}),t(s)},r}function Xbe(e){return Math.min(1e3*2**e,3e4)}function Tee(e){return(e??"online")==="online"?XP.isOnline():!0}var Aee=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function jD(e){return e instanceof Aee}function Cee(e){let t=!1,r=0,n=!1,s;const o=U3(),d=P=>{var N;n||(T(new Aee(P)),(N=e.abort)==null||N.call(e))},i=()=>{t=!0},m=()=>{t=!1},y=()=>$B.isFocused()&&(e.networkMode==="always"||XP.isOnline())&&e.canRun(),S=()=>Tee(e.networkMode)&&e.canRun(),w=P=>{var N;n||(n=!0,(N=e.onSuccess)==null||N.call(e,P),s==null||s(),o.resolve(P))},T=P=>{var N;n||(n=!0,(N=e.onError)==null||N.call(e,P),s==null||s(),o.reject(P))},A=()=>new Promise(P=>{var N;s=R=>{(n||y())&&P(R)},(N=e.onPause)==null||N.call(e)}).then(()=>{var P;s=void 0,n||(P=e.onContinue)==null||P.call(e)}),O=()=>{if(n)return;let P;const N=r===0?e.initialPromise:void 0;try{P=N??e.fn()}catch(R){P=Promise.reject(R)}Promise.resolve(P).then(w).catch(R=>{var W;if(n)return;const M=e.retry??(Av?0:3),F=e.retryDelay??Xbe,B=typeof F=="function"?F(r,R):F,$=M===!0||typeof M=="number"&&r<M||typeof M=="function"&&M(r,R);if(t||!$){T(R);return}r++,(W=e.onFail)==null||W.call(e,r,R),Hbe(B).then(()=>y()?void 0:A()).then(()=>{t?T(R):O()})})};return{promise:o,cancel:d,continue:()=>(s==null||s(),o),cancelRetry:i,continueRetry:m,canStart:S,start:()=>(S()?O():A().then(O),o)}}var Ybe=e=>setTimeout(e,0);function Jbe(){let e=[],t=0,r=i=>{i()},n=i=>{i()},s=Ybe;const o=i=>{t?e.push(i):s(()=>{r(i)})},d=()=>{const i=e;e=[],i.length&&s(()=>{n(()=>{i.forEach(m=>{r(m)})})})};return{batch:i=>{let m;t++;try{m=i()}finally{t--,t||d()}return m},batchCalls:i=>(...m)=>{o(()=>{i(...m)})},schedule:o,setNotifyFunction:i=>{r=i},setBatchNotifyFunction:i=>{n=i},setScheduler:i=>{s=i}}}var Xo=Jbe(),ov,CX,jee=(CX=class{constructor(){Wn(this,ov)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),z3(this.gcTime)&&pn(this,ov,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Av?1/0:5*60*1e3))}clearGcTimeout(){Et(this,ov)&&(clearTimeout(Et(this,ov)),pn(this,ov,void 0))}},ov=new WeakMap,CX),q0,lv,Lu,cv,Fl,l2,uv,Pd,If,jX,Qbe=(jX=class extends jee{constructor(t){super();Wn(this,Pd);Wn(this,q0);Wn(this,lv);Wn(this,Lu);Wn(this,cv);Wn(this,Fl);Wn(this,l2);Wn(this,uv);pn(this,uv,!1),pn(this,l2,t.defaultOptions),this.setOptions(t.options),this.observers=[],pn(this,cv,t.client),pn(this,Lu,Et(this,cv).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,pn(this,q0,ewe(this.options)),this.state=t.state??Et(this,q0),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Et(this,Fl))==null?void 0:t.promise}setOptions(t){this.options={...Et(this,l2),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Et(this,Lu).remove(this)}setData(t,r){const n=$3(this.state.data,t,this.options);return Vi(this,Pd,If).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){Vi(this,Pd,If).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,s;const r=(n=Et(this,Fl))==null?void 0:n.promise;return(s=Et(this,Fl))==null||s.cancel(t),r?r.then(lc).catch(lc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Et(this,q0))}isActive(){return this.observers.some(t=>Fu(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===BB||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>ng(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!bee(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=Et(this,Fl))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=Et(this,Fl))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Et(this,Lu).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(Et(this,Fl)&&(Et(this,uv)?Et(this,Fl).cancel({revert:!0}):Et(this,Fl).cancelRetry()),this.scheduleGc()),Et(this,Lu).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Vi(this,Pd,If).call(this,{type:"invalidate"})}fetch(t,r){var y,S,w;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(Et(this,Fl))return Et(this,Fl).continueRetry(),Et(this,Fl).promise}if(t&&this.setOptions(t),!this.options.queryFn){const T=this.observers.find(A=>A.options.queryFn);T&&this.setOptions(T.options)}const n=new AbortController,s=T=>{Object.defineProperty(T,"signal",{enumerable:!0,get:()=>(pn(this,uv,!0),n.signal)})},o=()=>{const T=See(this.options,r),O=(()=>{const P={client:Et(this,cv),queryKey:this.queryKey,meta:this.meta};return s(P),P})();return pn(this,uv,!1),this.options.persister?this.options.persister(T,O,this):T(O)},i=(()=>{const T={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:Et(this,cv),state:this.state,fetchFn:o};return s(T),T})();(y=this.options.behavior)==null||y.onFetch(i,this),pn(this,lv,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((S=i.fetchOptions)==null?void 0:S.meta))&&Vi(this,Pd,If).call(this,{type:"fetch",meta:(w=i.fetchOptions)==null?void 0:w.meta});const m=T=>{var A,O,P,N;jD(T)&&T.silent||Vi(this,Pd,If).call(this,{type:"error",error:T}),jD(T)||((O=(A=Et(this,Lu).config).onError)==null||O.call(A,T,this),(N=(P=Et(this,Lu).config).onSettled)==null||N.call(P,this.state.data,T,this)),this.scheduleGc()};return pn(this,Fl,Cee({initialPromise:r==null?void 0:r.initialPromise,fn:i.fetchFn,abort:n.abort.bind(n),onSuccess:T=>{var A,O,P,N;if(T===void 0){m(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(T)}catch(R){m(R);return}(O=(A=Et(this,Lu).config).onSuccess)==null||O.call(A,T,this),(N=(P=Et(this,Lu).config).onSettled)==null||N.call(P,T,this.state.error,this),this.scheduleGc()},onError:m,onFail:(T,A)=>{Vi(this,Pd,If).call(this,{type:"failed",failureCount:T,error:A})},onPause:()=>{Vi(this,Pd,If).call(this,{type:"pause"})},onContinue:()=>{Vi(this,Pd,If).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0})),Et(this,Fl).start()}},q0=new WeakMap,lv=new WeakMap,Lu=new WeakMap,cv=new WeakMap,Fl=new WeakMap,l2=new WeakMap,uv=new WeakMap,Pd=new WeakSet,If=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...Pee(n.data,this.options),fetchMeta:t.meta??null};case"success":return pn(this,lv,void 0),{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=t.error;return jD(s)&&s.revert&&Et(this,lv)?{...Et(this,lv),fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),Xo.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),Et(this,Lu).notify({query:this,type:"updated",action:t})})},jX);function Pee(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Tee(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function ewe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var xh,PX,twe=(PX=class extends sw{constructor(t={}){super();Wn(this,xh);this.config=t,pn(this,xh,new Map)}build(t,r,n){const s=r.queryKey,o=r.queryHash??zB(s,r);let d=this.get(o);return d||(d=new Qbe({client:t,queryKey:s,queryHash:o,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(s)}),this.add(d)),d}add(t){Et(this,xh).has(t.queryHash)||(Et(this,xh).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=Et(this,xh).get(t.queryHash);r&&(t.destroy(),r===t&&Et(this,xh).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Xo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Et(this,xh).get(t)}getAll(){return[...Et(this,xh).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>tH(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>tH(t,n)):r}notify(t){Xo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){Xo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Xo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},xh=new WeakMap,PX),bh,sc,dv,wh,ym,OX,rwe=(OX=class extends jee{constructor(t){super();Wn(this,wh);Wn(this,bh);Wn(this,sc);Wn(this,dv);this.mutationId=t.mutationId,pn(this,sc,t.mutationCache),pn(this,bh,[]),this.state=t.state||Oee(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Et(this,bh).includes(t)||(Et(this,bh).push(t),this.clearGcTimeout(),Et(this,sc).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){pn(this,bh,Et(this,bh).filter(r=>r!==t)),this.scheduleGc(),Et(this,sc).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Et(this,bh).length||(this.state.status==="pending"?this.scheduleGc():Et(this,sc).remove(this))}continue(){var t;return((t=Et(this,dv))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var o,d,i,m,y,S,w,T,A,O,P,N,R,M,F,B,$,W,K,te;const r=()=>{Vi(this,wh,ym).call(this,{type:"continue"})};pn(this,dv,Cee({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(ne,ae)=>{Vi(this,wh,ym).call(this,{type:"failed",failureCount:ne,error:ae})},onPause:()=>{Vi(this,wh,ym).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Et(this,sc).canRun(this)}));const n=this.state.status==="pending",s=!Et(this,dv).canStart();try{if(n)r();else{Vi(this,wh,ym).call(this,{type:"pending",variables:t,isPaused:s}),await((d=(o=Et(this,sc).config).onMutate)==null?void 0:d.call(o,t,this));const ae=await((m=(i=this.options).onMutate)==null?void 0:m.call(i,t));ae!==this.state.context&&Vi(this,wh,ym).call(this,{type:"pending",context:ae,variables:t,isPaused:s})}const ne=await Et(this,dv).start();return await((S=(y=Et(this,sc).config).onSuccess)==null?void 0:S.call(y,ne,t,this.state.context,this)),await((T=(w=this.options).onSuccess)==null?void 0:T.call(w,ne,t,this.state.context)),await((O=(A=Et(this,sc).config).onSettled)==null?void 0:O.call(A,ne,null,this.state.variables,this.state.context,this)),await((N=(P=this.options).onSettled)==null?void 0:N.call(P,ne,null,t,this.state.context)),Vi(this,wh,ym).call(this,{type:"success",data:ne}),ne}catch(ne){try{throw await((M=(R=Et(this,sc).config).onError)==null?void 0:M.call(R,ne,t,this.state.context,this)),await((B=(F=this.options).onError)==null?void 0:B.call(F,ne,t,this.state.context)),await((W=($=Et(this,sc).config).onSettled)==null?void 0:W.call($,void 0,ne,this.state.variables,this.state.context,this)),await((te=(K=this.options).onSettled)==null?void 0:te.call(K,void 0,ne,t,this.state.context)),ne}finally{Vi(this,wh,ym).call(this,{type:"error",error:ne})}}finally{Et(this,sc).runNext(this)}}},bh=new WeakMap,sc=new WeakMap,dv=new WeakMap,wh=new WeakSet,ym=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Xo.batch(()=>{Et(this,bh).forEach(n=>{n.onMutationUpdate(t)}),Et(this,sc).notify({mutation:this,type:"updated",action:t})})},OX);function Oee(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ff,Od,c2,kX,nwe=(kX=class extends sw{constructor(t={}){super();Wn(this,Ff);Wn(this,Od);Wn(this,c2);this.config=t,pn(this,Ff,new Set),pn(this,Od,new Map),pn(this,c2,0)}build(t,r,n){const s=new rwe({mutationCache:this,mutationId:++qC(this,c2)._,options:t.defaultMutationOptions(r),state:n});return this.add(s),s}add(t){Et(this,Ff).add(t);const r=hj(t);if(typeof r=="string"){const n=Et(this,Od).get(r);n?n.push(t):Et(this,Od).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(Et(this,Ff).delete(t)){const r=hj(t);if(typeof r=="string"){const n=Et(this,Od).get(r);if(n)if(n.length>1){const s=n.indexOf(t);s!==-1&&n.splice(s,1)}else n[0]===t&&Et(this,Od).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=hj(t);if(typeof r=="string"){const n=Et(this,Od).get(r),s=n==null?void 0:n.find(o=>o.state.status==="pending");return!s||s===t}else return!0}runNext(t){var n;const r=hj(t);if(typeof r=="string"){const s=(n=Et(this,Od).get(r))==null?void 0:n.find(o=>o!==t&&o.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Xo.batch(()=>{Et(this,Ff).forEach(t=>{this.notify({type:"removed",mutation:t})}),Et(this,Ff).clear(),Et(this,Od).clear()})}getAll(){return Array.from(Et(this,Ff))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>rH(r,n))}findAll(t={}){return this.getAll().filter(r=>rH(t,r))}notify(t){Xo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return Xo.batch(()=>Promise.all(t.map(r=>r.continue().catch(lc))))}},Ff=new WeakMap,Od=new WeakMap,c2=new WeakMap,kX);function hj(e){var t;return(t=e.options.scope)==null?void 0:t.id}function sH(e){return{onFetch:(t,r)=>{var S,w,T,A,O;const n=t.options,s=(T=(w=(S=t.fetchOptions)==null?void 0:S.meta)==null?void 0:w.fetchMore)==null?void 0:T.direction,o=((A=t.state.data)==null?void 0:A.pages)||[],d=((O=t.state.data)==null?void 0:O.pageParams)||[];let i={pages:[],pageParams:[]},m=0;const y=async()=>{let P=!1;const N=F=>{Object.defineProperty(F,"signal",{enumerable:!0,get:()=>(t.signal.aborted?P=!0:t.signal.addEventListener("abort",()=>{P=!0}),t.signal)})},R=See(t.options,t.fetchOptions),M=async(F,B,$)=>{if(P)return Promise.reject();if(B==null&&F.pages.length)return Promise.resolve(F);const K=(()=>{const re={client:t.client,queryKey:t.queryKey,pageParam:B,direction:$?"backward":"forward",meta:t.options.meta};return N(re),re})(),te=await R(K),{maxPages:ne}=t.options,ae=$?Wbe:Gbe;return{pages:ae(F.pages,te,ne),pageParams:ae(F.pageParams,B,ne)}};if(s&&o.length){const F=s==="backward",B=F?iwe:aH,$={pages:o,pageParams:d},W=B(n,$);i=await M($,W,F)}else{const F=e??o.length;do{const B=m===0?d[0]??n.initialPageParam:aH(n,i);if(m>0&&B==null)break;i=await M(i,B),m++}while(m<F)}return i};t.options.persister?t.fetchFn=()=>{var P,N;return(N=(P=t.options).persister)==null?void 0:N.call(P,y,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=y}}}function aH(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function iwe(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var Ja,Dm,Lm,H0,G0,Fm,W0,K0,NX,swe=(NX=class{constructor(e={}){Wn(this,Ja);Wn(this,Dm);Wn(this,Lm);Wn(this,H0);Wn(this,G0);Wn(this,Fm);Wn(this,W0);Wn(this,K0);pn(this,Ja,e.queryCache||new twe),pn(this,Dm,e.mutationCache||new nwe),pn(this,Lm,e.defaultOptions||{}),pn(this,H0,new Map),pn(this,G0,new Map),pn(this,Fm,0)}mount(){qC(this,Fm)._++,Et(this,Fm)===1&&(pn(this,W0,$B.subscribe(async e=>{e&&(await this.resumePausedMutations(),Et(this,Ja).onFocus())})),pn(this,K0,XP.subscribe(async e=>{e&&(await this.resumePausedMutations(),Et(this,Ja).onOnline())})))}unmount(){var e,t;qC(this,Fm)._--,Et(this,Fm)===0&&((e=Et(this,W0))==null||e.call(this),pn(this,W0,void 0),(t=Et(this,K0))==null||t.call(this),pn(this,K0,void 0))}isFetching(e){return Et(this,Ja).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Et(this,Dm).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Et(this,Ja).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Et(this,Ja).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(ng(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return Et(this,Ja).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),s=Et(this,Ja).get(n.queryHash),o=s==null?void 0:s.state.data,d=qbe(t,o);if(d!==void 0)return Et(this,Ja).build(this,n).setData(d,{...r,manual:!0})}setQueriesData(e,t,r){return Xo.batch(()=>Et(this,Ja).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Et(this,Ja).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=Et(this,Ja);Xo.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Et(this,Ja);return Xo.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=Xo.batch(()=>Et(this,Ja).findAll(e).map(s=>s.cancel(r)));return Promise.all(n).then(lc).catch(lc)}invalidateQueries(e,t={}){return Xo.batch(()=>(Et(this,Ja).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=Xo.batch(()=>Et(this,Ja).findAll(e).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let o=s.fetch(void 0,r);return r.throwOnError||(o=o.catch(lc)),s.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(n).then(lc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Et(this,Ja).build(this,t);return r.isStaleByTime(ng(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(lc).catch(lc)}fetchInfiniteQuery(e){return e.behavior=sH(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(lc).catch(lc)}ensureInfiniteQueryData(e){return e.behavior=sH(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return XP.isOnline()?Et(this,Dm).resumePausedMutations():Promise.resolve()}getQueryCache(){return Et(this,Ja)}getMutationCache(){return Et(this,Dm)}getDefaultOptions(){return Et(this,Lm)}setDefaultOptions(e){pn(this,Lm,e)}setQueryDefaults(e,t){Et(this,H0).set(Cv(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Et(this,H0).values()],r={};return t.forEach(n=>{dT(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){Et(this,G0).set(Cv(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Et(this,G0).values()],r={};return t.forEach(n=>{dT(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Et(this,Lm).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=zB(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===BB&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Et(this,Lm).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Et(this,Ja).clear(),Et(this,Dm).clear()}},Ja=new WeakMap,Dm=new WeakMap,Lm=new WeakMap,H0=new WeakMap,G0=new WeakMap,Fm=new WeakMap,W0=new WeakMap,K0=new WeakMap,NX),Rc,fs,u2,ac,hv,Z0,zm,Bm,d2,X0,Y0,fv,pv,$m,J0,Bs,cE,V3,q3,H3,G3,W3,K3,Z3,kee,IX,awe=(IX=class extends sw{constructor(t,r){super();Wn(this,Bs);Wn(this,Rc);Wn(this,fs);Wn(this,u2);Wn(this,ac);Wn(this,hv);Wn(this,Z0);Wn(this,zm);Wn(this,Bm);Wn(this,d2);Wn(this,X0);Wn(this,Y0);Wn(this,fv);Wn(this,pv);Wn(this,$m);Wn(this,J0,new Set);this.options=r,pn(this,Rc,t),pn(this,Bm,null),pn(this,zm,U3()),this.options.experimental_prefetchInRender||Et(this,zm).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Et(this,fs).addObserver(this),oH(Et(this,fs),this.options)?Vi(this,Bs,cE).call(this):this.updateResult(),Vi(this,Bs,G3).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return X3(Et(this,fs),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return X3(Et(this,fs),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Vi(this,Bs,W3).call(this),Vi(this,Bs,K3).call(this),Et(this,fs).removeObserver(this)}setOptions(t){const r=this.options,n=Et(this,fs);if(this.options=Et(this,Rc).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Fu(this.options.enabled,Et(this,fs))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Vi(this,Bs,Z3).call(this),Et(this,fs).setOptions(this.options),r._defaulted&&!ZP(this.options,r)&&Et(this,Rc).getQueryCache().notify({type:"observerOptionsUpdated",query:Et(this,fs),observer:this});const s=this.hasListeners();s&&lH(Et(this,fs),n,this.options,r)&&Vi(this,Bs,cE).call(this),this.updateResult(),s&&(Et(this,fs)!==n||Fu(this.options.enabled,Et(this,fs))!==Fu(r.enabled,Et(this,fs))||ng(this.options.staleTime,Et(this,fs))!==ng(r.staleTime,Et(this,fs)))&&Vi(this,Bs,V3).call(this);const o=Vi(this,Bs,q3).call(this);s&&(Et(this,fs)!==n||Fu(this.options.enabled,Et(this,fs))!==Fu(r.enabled,Et(this,fs))||o!==Et(this,$m))&&Vi(this,Bs,H3).call(this,o)}getOptimisticResult(t){const r=Et(this,Rc).getQueryCache().build(Et(this,Rc),t),n=this.createResult(r,t);return lwe(this,n)&&(pn(this,ac,n),pn(this,Z0,this.options),pn(this,hv,Et(this,fs).state)),n}getCurrentResult(){return Et(this,ac)}trackResult(t,r){return new Proxy(t,{get:(n,s)=>(this.trackProp(s),r==null||r(s),Reflect.get(n,s))})}trackProp(t){Et(this,J0).add(t)}getCurrentQuery(){return Et(this,fs)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=Et(this,Rc).defaultQueryOptions(t),n=Et(this,Rc).getQueryCache().build(Et(this,Rc),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return Vi(this,Bs,cE).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),Et(this,ac)))}createResult(t,r){var ne;const n=Et(this,fs),s=this.options,o=Et(this,ac),d=Et(this,hv),i=Et(this,Z0),y=t!==n?t.state:Et(this,u2),{state:S}=t;let w={...S},T=!1,A;if(r._optimisticResults){const ae=this.hasListeners(),re=!ae&&oH(t,r),ee=ae&&lH(t,n,r,s);(re||ee)&&(w={...w,...Pee(S.data,t.options)}),r._optimisticResults==="isRestoring"&&(w.fetchStatus="idle")}let{error:O,errorUpdatedAt:P,status:N}=w;A=w.data;let R=!1;if(r.placeholderData!==void 0&&A===void 0&&N==="pending"){let ae;o!=null&&o.isPlaceholderData&&r.placeholderData===(i==null?void 0:i.placeholderData)?(ae=o.data,R=!0):ae=typeof r.placeholderData=="function"?r.placeholderData((ne=Et(this,Y0))==null?void 0:ne.state.data,Et(this,Y0)):r.placeholderData,ae!==void 0&&(N="success",A=$3(o==null?void 0:o.data,ae,r),T=!0)}if(r.select&&A!==void 0&&!R)if(o&&A===(d==null?void 0:d.data)&&r.select===Et(this,d2))A=Et(this,X0);else try{pn(this,d2,r.select),A=r.select(A),A=$3(o==null?void 0:o.data,A,r),pn(this,X0,A),pn(this,Bm,null)}catch(ae){pn(this,Bm,ae)}Et(this,Bm)&&(O=Et(this,Bm),A=Et(this,X0),P=Date.now(),N="error");const M=w.fetchStatus==="fetching",F=N==="pending",B=N==="error",$=F&&M,W=A!==void 0,te={status:N,fetchStatus:w.fetchStatus,isPending:F,isSuccess:N==="success",isError:B,isInitialLoading:$,isLoading:$,data:A,dataUpdatedAt:w.dataUpdatedAt,error:O,errorUpdatedAt:P,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>y.dataUpdateCount||w.errorUpdateCount>y.errorUpdateCount,isFetching:M,isRefetching:M&&!F,isLoadingError:B&&!W,isPaused:w.fetchStatus==="paused",isPlaceholderData:T,isRefetchError:B&&W,isStale:UB(t,r),refetch:this.refetch,promise:Et(this,zm),isEnabled:Fu(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const ae=ie=>{te.status==="error"?ie.reject(te.error):te.data!==void 0&&ie.resolve(te.data)},re=()=>{const ie=pn(this,zm,te.promise=U3());ae(ie)},ee=Et(this,zm);switch(ee.status){case"pending":t.queryHash===n.queryHash&&ae(ee);break;case"fulfilled":(te.status==="error"||te.data!==ee.value)&&re();break;case"rejected":(te.status!=="error"||te.error!==ee.reason)&&re();break}}return te}updateResult(){const t=Et(this,ac),r=this.createResult(Et(this,fs),this.options);if(pn(this,hv,Et(this,fs).state),pn(this,Z0,this.options),Et(this,hv).data!==void 0&&pn(this,Y0,Et(this,fs)),ZP(r,t))return;pn(this,ac,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:s}=this.options,o=typeof s=="function"?s():s;if(o==="all"||!o&&!Et(this,J0).size)return!0;const d=new Set(o??Et(this,J0));return this.options.throwOnError&&d.add("error"),Object.keys(Et(this,ac)).some(i=>{const m=i;return Et(this,ac)[m]!==t[m]&&d.has(m)})};Vi(this,Bs,kee).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Vi(this,Bs,G3).call(this)}},Rc=new WeakMap,fs=new WeakMap,u2=new WeakMap,ac=new WeakMap,hv=new WeakMap,Z0=new WeakMap,zm=new WeakMap,Bm=new WeakMap,d2=new WeakMap,X0=new WeakMap,Y0=new WeakMap,fv=new WeakMap,pv=new WeakMap,$m=new WeakMap,J0=new WeakMap,Bs=new WeakSet,cE=function(t){Vi(this,Bs,Z3).call(this);let r=Et(this,fs).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(lc)),r},V3=function(){Vi(this,Bs,W3).call(this);const t=ng(this.options.staleTime,Et(this,fs));if(Av||Et(this,ac).isStale||!z3(t))return;const n=bee(Et(this,ac).dataUpdatedAt,t)+1;pn(this,fv,setTimeout(()=>{Et(this,ac).isStale||this.updateResult()},n))},q3=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Et(this,fs)):this.options.refetchInterval)??!1},H3=function(t){Vi(this,Bs,K3).call(this),pn(this,$m,t),!(Av||Fu(this.options.enabled,Et(this,fs))===!1||!z3(Et(this,$m))||Et(this,$m)===0)&&pn(this,pv,setInterval(()=>{(this.options.refetchIntervalInBackground||$B.isFocused())&&Vi(this,Bs,cE).call(this)},Et(this,$m)))},G3=function(){Vi(this,Bs,V3).call(this),Vi(this,Bs,H3).call(this,Vi(this,Bs,q3).call(this))},W3=function(){Et(this,fv)&&(clearTimeout(Et(this,fv)),pn(this,fv,void 0))},K3=function(){Et(this,pv)&&(clearInterval(Et(this,pv)),pn(this,pv,void 0))},Z3=function(){const t=Et(this,Rc).getQueryCache().build(Et(this,Rc),this.options);if(t===Et(this,fs))return;const r=Et(this,fs);pn(this,fs,t),pn(this,u2,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},kee=function(t){Xo.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(Et(this,ac))}),Et(this,Rc).getQueryCache().notify({query:Et(this,fs),type:"observerResultsUpdated"})})},IX);function owe(e,t){return Fu(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function oH(e,t){return owe(e,t)||e.state.data!==void 0&&X3(e,t,t.refetchOnMount)}function X3(e,t,r){if(Fu(t.enabled,e)!==!1&&ng(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&UB(e,t)}return!1}function lH(e,t,r,n){return(e!==t||Fu(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&UB(e,r)}function UB(e,t){return Fu(t.enabled,e)!==!1&&e.isStaleByTime(ng(t.staleTime,e))}function lwe(e,t){return!ZP(e.getCurrentResult(),t)}var Um,Vm,Mc,zf,ep,nP,Y3,RX,cwe=(RX=class extends sw{constructor(r,n){super();Wn(this,ep);Wn(this,Um);Wn(this,Vm);Wn(this,Mc);Wn(this,zf);pn(this,Um,r),this.setOptions(n),this.bindMethods(),Vi(this,ep,nP).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var s;const n=this.options;this.options=Et(this,Um).defaultMutationOptions(r),ZP(this.options,n)||Et(this,Um).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Et(this,Mc),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&Cv(n.mutationKey)!==Cv(this.options.mutationKey)?this.reset():((s=Et(this,Mc))==null?void 0:s.state.status)==="pending"&&Et(this,Mc).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=Et(this,Mc))==null||r.removeObserver(this)}onMutationUpdate(r){Vi(this,ep,nP).call(this),Vi(this,ep,Y3).call(this,r)}getCurrentResult(){return Et(this,Vm)}reset(){var r;(r=Et(this,Mc))==null||r.removeObserver(this),pn(this,Mc,void 0),Vi(this,ep,nP).call(this),Vi(this,ep,Y3).call(this)}mutate(r,n){var s;return pn(this,zf,n),(s=Et(this,Mc))==null||s.removeObserver(this),pn(this,Mc,Et(this,Um).getMutationCache().build(Et(this,Um),this.options)),Et(this,Mc).addObserver(this),Et(this,Mc).execute(r)}},Um=new WeakMap,Vm=new WeakMap,Mc=new WeakMap,zf=new WeakMap,ep=new WeakSet,nP=function(){var n;const r=((n=Et(this,Mc))==null?void 0:n.state)??Oee();pn(this,Vm,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},Y3=function(r){Xo.batch(()=>{var n,s,o,d,i,m,y,S;if(Et(this,zf)&&this.hasListeners()){const w=Et(this,Vm).variables,T=Et(this,Vm).context;(r==null?void 0:r.type)==="success"?((s=(n=Et(this,zf)).onSuccess)==null||s.call(n,r.data,w,T),(d=(o=Et(this,zf)).onSettled)==null||d.call(o,r.data,null,w,T)):(r==null?void 0:r.type)==="error"&&((m=(i=Et(this,zf)).onError)==null||m.call(i,r.error,w,T),(S=(y=Et(this,zf)).onSettled)==null||S.call(y,void 0,r.error,w,T))}this.listeners.forEach(w=>{w(Et(this,Vm))})})},RX),Nee=V.createContext(void 0),Ri=e=>{const t=V.useContext(Nee);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},uwe=({client:e,children:t})=>(V.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),h.jsx(Nee.Provider,{value:e,children:t})),Iee=V.createContext(!1),dwe=()=>V.useContext(Iee);Iee.Provider;function hwe(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var fwe=V.createContext(hwe()),pwe=()=>V.useContext(fwe),mwe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},gwe=e=>{V.useEffect(()=>{e.clearReset()},[e])},ywe=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(s&&e.data===void 0||Eee(r,[e.error,n])),vwe=e=>{if(e.suspense){const t=n=>n==="static"?n:Math.max(n??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...n)=>t(r(...n)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},_we=(e,t)=>e.isLoading&&e.isFetching&&!t,xwe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,cH=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function bwe(e,t,r){var w,T,A,O,P;const n=dwe(),s=pwe(),o=Ri(),d=o.defaultQueryOptions(e);(T=(w=o.getDefaultOptions().queries)==null?void 0:w._experimental_beforeQuery)==null||T.call(w,d),d._optimisticResults=n?"isRestoring":"optimistic",vwe(d),mwe(d,s),gwe(s);const i=!o.getQueryCache().get(d.queryHash),[m]=V.useState(()=>new t(o,d)),y=m.getOptimisticResult(d),S=!n&&e.subscribed!==!1;if(V.useSyncExternalStore(V.useCallback(N=>{const R=S?m.subscribe(Xo.batchCalls(N)):lc;return m.updateResult(),R},[m,S]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),V.useEffect(()=>{m.setOptions(d)},[d,m]),xwe(d,y))throw cH(d,m,s);if(ywe({result:y,errorResetBoundary:s,throwOnError:d.throwOnError,query:o.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw y.error;if((O=(A=o.getDefaultOptions().queries)==null?void 0:A._experimental_afterQuery)==null||O.call(A,d,y),d.experimental_prefetchInRender&&!Av&&_we(y,n)){const N=i?cH(d,m,s):(P=o.getQueryCache().get(d.queryHash))==null?void 0:P.promise;N==null||N.catch(lc).finally(()=>{m.updateResult()})}return d.notifyOnChangeProps?y:m.trackResult(y)}function ci(e,t){return bwe(e,awe)}function Gi(e,t){const r=Ri(),[n]=V.useState(()=>new cwe(r,e));V.useEffect(()=>{n.setOptions(e)},[n,e]);const s=V.useSyncExternalStore(V.useCallback(d=>n.subscribe(Xo.batchCalls(d)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),o=V.useCallback((d,i)=>{n.mutate(d,i).catch(lc)},[n]);if(s.error&&Eee(n.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:o,mutateAsync:s.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hT(){return hT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hT.apply(this,arguments)}var Gm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Gm||(Gm={}));const uH="popstate";function wwe(e){e===void 0&&(e={});function t(n,s){let{pathname:o,search:d,hash:i}=n.location;return J3("",{pathname:o,search:d,hash:i},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:YP(s)}return Ewe(t,r,null,e)}function vo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Ree(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Swe(){return Math.random().toString(36).substr(2,8)}function dH(e,t){return{usr:e.state,key:e.key,idx:t}}function J3(e,t,r,n){return r===void 0&&(r=null),hT({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?aw(t):t,{state:r,key:t&&t.key||n||Swe()})}function YP(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function aw(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Ewe(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:o=!1}=n,d=s.history,i=Gm.Pop,m=null,y=S();y==null&&(y=0,d.replaceState(hT({},d.state,{idx:y}),""));function S(){return(d.state||{idx:null}).idx}function w(){i=Gm.Pop;let N=S(),R=N==null?null:N-y;y=N,m&&m({action:i,location:P.location,delta:R})}function T(N,R){i=Gm.Push;let M=J3(P.location,N,R);y=S()+1;let F=dH(M,y),B=P.createHref(M);try{d.pushState(F,"",B)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;s.location.assign(B)}o&&m&&m({action:i,location:P.location,delta:1})}function A(N,R){i=Gm.Replace;let M=J3(P.location,N,R);y=S();let F=dH(M,y),B=P.createHref(M);d.replaceState(F,"",B),o&&m&&m({action:i,location:P.location,delta:0})}function O(N){let R=s.location.origin!=="null"?s.location.origin:s.location.href,M=typeof N=="string"?N:YP(N);return M=M.replace(/ $/,"%20"),vo(R,"No window.location.(origin|href) available to create URL for href: "+M),new URL(M,R)}let P={get action(){return i},get location(){return e(s,d)},listen(N){if(m)throw new Error("A history only accepts one active listener");return s.addEventListener(uH,w),m=N,()=>{s.removeEventListener(uH,w),m=null}},createHref(N){return t(s,N)},createURL:O,encodeLocation(N){let R=O(N);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:T,replace:A,go(N){return d.go(N)}};return P}var hH;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(hH||(hH={}));function Twe(e,t,r){return r===void 0&&(r="/"),Awe(e,t,r,!1)}function Awe(e,t,r,n){let s=typeof t=="string"?aw(t):t,o=VB(s.pathname||"/",r);if(o==null)return null;let d=Mee(e);Cwe(d);let i=null;for(let m=0;i==null&&m<d.length;++m){let y=Fwe(o);i=Dwe(d[m],y,n)}return i}function Mee(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(o,d,i)=>{let m={relativePath:i===void 0?o.path||"":i,caseSensitive:o.caseSensitive===!0,childrenIndex:d,route:o};m.relativePath.startsWith("/")&&(vo(m.relativePath.startsWith(n),'Absolute route path "'+m.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),m.relativePath=m.relativePath.slice(n.length));let y=ig([n,m.relativePath]),S=r.concat(m);o.children&&o.children.length>0&&(vo(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+y+'".')),Mee(o.children,t,S,y)),!(o.path==null&&!o.index)&&t.push({path:y,score:Rwe(y,o.index),routesMeta:S})};return e.forEach((o,d)=>{var i;if(o.path===""||!((i=o.path)!=null&&i.includes("?")))s(o,d);else for(let m of Dee(o.path))s(o,d,m)}),t}function Dee(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return s?[o,""]:[o];let d=Dee(n.join("/")),i=[];return i.push(...d.map(m=>m===""?o:[o,m].join("/"))),s&&i.push(...d),i.map(m=>e.startsWith("/")&&m===""?"/":m)}function Cwe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Mwe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const jwe=/^:[\w-]+$/,Pwe=3,Owe=2,kwe=1,Nwe=10,Iwe=-2,fH=e=>e==="*";function Rwe(e,t){let r=e.split("/"),n=r.length;return r.some(fH)&&(n+=Iwe),t&&(n+=Owe),r.filter(s=>!fH(s)).reduce((s,o)=>s+(jwe.test(o)?Pwe:o===""?kwe:Nwe),n)}function Mwe(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function Dwe(e,t,r){let{routesMeta:n}=e,s={},o="/",d=[];for(let i=0;i<n.length;++i){let m=n[i],y=i===n.length-1,S=o==="/"?t:t.slice(o.length)||"/",w=pH({path:m.relativePath,caseSensitive:m.caseSensitive,end:y},S),T=m.route;if(!w&&y&&r&&!n[n.length-1].route.index&&(w=pH({path:m.relativePath,caseSensitive:m.caseSensitive,end:!1},S)),!w)return null;Object.assign(s,w.params),d.push({params:s,pathname:ig([o,w.pathname]),pathnameBase:Uwe(ig([o,w.pathnameBase])),route:T}),w.pathnameBase!=="/"&&(o=ig([o,w.pathnameBase]))}return d}function pH(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=Lwe(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let o=s[0],d=o.replace(/(.)\/+$/,"$1"),i=s.slice(1);return{params:n.reduce((y,S,w)=>{let{paramName:T,isOptional:A}=S;if(T==="*"){let P=i[w]||"";d=o.slice(0,o.length-P.length).replace(/(.)\/+$/,"$1")}const O=i[w];return A&&!O?y[T]=void 0:y[T]=(O||"").replace(/%2F/g,"/"),y},{}),pathname:o,pathnameBase:d,pattern:e}}function Lwe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Ree(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,i,m)=>(n.push({paramName:i,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function Fwe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Ree(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function VB(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function zwe(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?aw(e):e;return{pathname:r?r.startsWith("/")?r:Bwe(r,t):t,search:Vwe(n),hash:qwe(s)}}function Bwe(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function PD(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function $we(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function qB(e,t){let r=$we(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function HB(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=aw(e):(s=hT({},e),vo(!s.pathname||!s.pathname.includes("?"),PD("?","pathname","search",s)),vo(!s.pathname||!s.pathname.includes("#"),PD("#","pathname","hash",s)),vo(!s.search||!s.search.includes("#"),PD("#","search","hash",s)));let o=e===""||s.pathname==="",d=o?"/":s.pathname,i;if(d==null)i=r;else{let w=t.length-1;if(!n&&d.startsWith("..")){let T=d.split("/");for(;T[0]==="..";)T.shift(),w-=1;s.pathname=T.join("/")}i=w>=0?t[w]:"/"}let m=zwe(s,i),y=d&&d!=="/"&&d.endsWith("/"),S=(o||d===".")&&r.endsWith("/");return!m.pathname.endsWith("/")&&(y||S)&&(m.pathname+="/"),m}const ig=e=>e.join("/").replace(/\/\/+/g,"/"),Uwe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Vwe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,qwe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Hwe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Lee=["post","put","patch","delete"];new Set(Lee);const Gwe=["get",...Lee];new Set(Gwe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fT(){return fT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fT.apply(this,arguments)}const GB=V.createContext(null),Wwe=V.createContext(null),wg=V.createContext(null),pN=V.createContext(null),mp=V.createContext({outlet:null,matches:[],isDataRoute:!1}),Fee=V.createContext(null);function Kwe(e,t){let{relative:r}=t===void 0?{}:t;ow()||vo(!1);let{basename:n,navigator:s}=V.useContext(wg),{hash:o,pathname:d,search:i}=$ee(e,{relative:r}),m=d;return n!=="/"&&(m=d==="/"?n:ig([n,d])),s.createHref({pathname:m,search:i,hash:o})}function ow(){return V.useContext(pN)!=null}function Qh(){return ow()||vo(!1),V.useContext(pN).location}function zee(e){V.useContext(wg).static||V.useLayoutEffect(e)}function Ju(){let{isDataRoute:e}=V.useContext(mp);return e?o1e():Zwe()}function Zwe(){ow()||vo(!1);let e=V.useContext(GB),{basename:t,future:r,navigator:n}=V.useContext(wg),{matches:s}=V.useContext(mp),{pathname:o}=Qh(),d=JSON.stringify(qB(s,r.v7_relativeSplatPath)),i=V.useRef(!1);return zee(()=>{i.current=!0}),V.useCallback(function(y,S){if(S===void 0&&(S={}),!i.current)return;if(typeof y=="number"){n.go(y);return}let w=HB(y,JSON.parse(d),o,S.relative==="path");e==null&&t!=="/"&&(w.pathname=w.pathname==="/"?t:ig([t,w.pathname])),(S.replace?n.replace:n.push)(w,S.state,S)},[t,n,d,o,e])}function Bee(){let{matches:e}=V.useContext(mp),t=e[e.length-1];return t?t.params:{}}function $ee(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=V.useContext(wg),{matches:s}=V.useContext(mp),{pathname:o}=Qh(),d=JSON.stringify(qB(s,n.v7_relativeSplatPath));return V.useMemo(()=>HB(e,JSON.parse(d),o,r==="path"),[e,d,o,r])}function Xwe(e,t){return Ywe(e,t)}function Ywe(e,t,r,n){ow()||vo(!1);let{navigator:s}=V.useContext(wg),{matches:o}=V.useContext(mp),d=o[o.length-1],i=d?d.params:{};d&&d.pathname;let m=d?d.pathnameBase:"/";d&&d.route;let y=Qh(),S;if(t){var w;let N=typeof t=="string"?aw(t):t;m==="/"||(w=N.pathname)!=null&&w.startsWith(m)||vo(!1),S=N}else S=y;let T=S.pathname||"/",A=T;if(m!=="/"){let N=m.replace(/^\//,"").split("/");A="/"+T.replace(/^\//,"").split("/").slice(N.length).join("/")}let O=Twe(e,{pathname:A}),P=r1e(O&&O.map(N=>Object.assign({},N,{params:Object.assign({},i,N.params),pathname:ig([m,s.encodeLocation?s.encodeLocation(N.pathname).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?m:ig([m,s.encodeLocation?s.encodeLocation(N.pathnameBase).pathname:N.pathnameBase])})),o,r,n);return t&&P?V.createElement(pN.Provider,{value:{location:fT({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:Gm.Pop}},P):P}function Jwe(){let e=a1e(),t=Hwe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},t),r?V.createElement("pre",{style:s},r):null,null)}const Qwe=V.createElement(Jwe,null);class e1e extends V.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?V.createElement(mp.Provider,{value:this.props.routeContext},V.createElement(Fee.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function t1e(e){let{routeContext:t,match:r,children:n}=e,s=V.useContext(GB);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),V.createElement(mp.Provider,{value:t},n)}function r1e(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let d=e,i=(s=r)==null?void 0:s.errors;if(i!=null){let S=d.findIndex(w=>w.route.id&&(i==null?void 0:i[w.route.id])!==void 0);S>=0||vo(!1),d=d.slice(0,Math.min(d.length,S+1))}let m=!1,y=-1;if(r&&n&&n.v7_partialHydration)for(let S=0;S<d.length;S++){let w=d[S];if((w.route.HydrateFallback||w.route.hydrateFallbackElement)&&(y=S),w.route.id){let{loaderData:T,errors:A}=r,O=w.route.loader&&T[w.route.id]===void 0&&(!A||A[w.route.id]===void 0);if(w.route.lazy||O){m=!0,y>=0?d=d.slice(0,y+1):d=[d[0]];break}}}return d.reduceRight((S,w,T)=>{let A,O=!1,P=null,N=null;r&&(A=i&&w.route.id?i[w.route.id]:void 0,P=w.route.errorElement||Qwe,m&&(y<0&&T===0?(O=!0,N=null):y===T&&(O=!0,N=w.route.hydrateFallbackElement||null)));let R=t.concat(d.slice(0,T+1)),M=()=>{let F;return A?F=P:O?F=N:w.route.Component?F=V.createElement(w.route.Component,null):w.route.element?F=w.route.element:F=S,V.createElement(t1e,{match:w,routeContext:{outlet:S,matches:R,isDataRoute:r!=null},children:F})};return r&&(w.route.ErrorBoundary||w.route.errorElement||T===0)?V.createElement(e1e,{location:r.location,revalidation:r.revalidation,component:P,error:A,children:M(),routeContext:{outlet:null,matches:R,isDataRoute:!0}}):M()},null)}var Uee=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Uee||{}),JP=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(JP||{});function n1e(e){let t=V.useContext(GB);return t||vo(!1),t}function i1e(e){let t=V.useContext(Wwe);return t||vo(!1),t}function s1e(e){let t=V.useContext(mp);return t||vo(!1),t}function Vee(e){let t=s1e(),r=t.matches[t.matches.length-1];return r.route.id||vo(!1),r.route.id}function a1e(){var e;let t=V.useContext(Fee),r=i1e(JP.UseRouteError),n=Vee(JP.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function o1e(){let{router:e}=n1e(Uee.UseNavigateStable),t=Vee(JP.UseNavigateStable),r=V.useRef(!1);return zee(()=>{r.current=!0}),V.useCallback(function(s,o){o===void 0&&(o={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,fT({fromRouteId:t},o)))},[e,t])}function l1e(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function c1e(e){let{to:t,replace:r,state:n,relative:s}=e;ow()||vo(!1);let{future:o,static:d}=V.useContext(wg),{matches:i}=V.useContext(mp),{pathname:m}=Qh(),y=Ju(),S=HB(t,qB(i,o.v7_relativeSplatPath),m,s==="path"),w=JSON.stringify(S);return V.useEffect(()=>y(JSON.parse(w),{replace:r,state:n,relative:s}),[y,w,s,r,n]),null}function Sa(e){vo(!1)}function u1e(e){let{basename:t="/",children:r=null,location:n,navigationType:s=Gm.Pop,navigator:o,static:d=!1,future:i}=e;ow()&&vo(!1);let m=t.replace(/^\/*/,"/"),y=V.useMemo(()=>({basename:m,navigator:o,static:d,future:fT({v7_relativeSplatPath:!1},i)}),[m,i,o,d]);typeof n=="string"&&(n=aw(n));let{pathname:S="/",search:w="",hash:T="",state:A=null,key:O="default"}=n,P=V.useMemo(()=>{let N=VB(S,m);return N==null?null:{location:{pathname:N,search:w,hash:T,state:A,key:O},navigationType:s}},[m,S,w,T,A,O,s]);return P==null?null:V.createElement(wg.Provider,{value:y},V.createElement(pN.Provider,{children:r,value:P}))}function d1e(e){let{children:t,location:r}=e;return Xwe(Q3(t),r)}new Promise(()=>{});function Q3(e,t){t===void 0&&(t=[]);let r=[];return V.Children.forEach(e,(n,s)=>{if(!V.isValidElement(n))return;let o=[...t,s];if(n.type===V.Fragment){r.push.apply(r,Q3(n.props.children,o));return}n.type!==Sa&&vo(!1),!n.props.index||!n.props.children||vo(!1);let d={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(d.children=Q3(n.props.children,o)),r.push(d)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function eF(){return eF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eF.apply(this,arguments)}function h1e(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function f1e(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function p1e(e,t){return e.button===0&&(!t||t==="_self")&&!f1e(e)}const m1e=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],g1e="6";try{window.__reactRouterVersion=g1e}catch{}const y1e="startTransition",mH=O4[y1e];function v1e(e){let{basename:t,children:r,future:n,window:s}=e,o=V.useRef();o.current==null&&(o.current=wwe({window:s,v5Compat:!0}));let d=o.current,[i,m]=V.useState({action:d.action,location:d.location}),{v7_startTransition:y}=n||{},S=V.useCallback(w=>{y&&mH?mH(()=>m(w)):m(w)},[m,y]);return V.useLayoutEffect(()=>d.listen(S),[d,S]),V.useEffect(()=>l1e(n),[n]),V.createElement(u1e,{basename:t,children:r,location:i.location,navigationType:i.action,navigator:d,future:n})}const _1e=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",x1e=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Hi=V.forwardRef(function(t,r){let{onClick:n,relative:s,reloadDocument:o,replace:d,state:i,target:m,to:y,preventScrollReset:S,viewTransition:w}=t,T=h1e(t,m1e),{basename:A}=V.useContext(wg),O,P=!1;if(typeof y=="string"&&x1e.test(y)&&(O=y,_1e))try{let F=new URL(window.location.href),B=y.startsWith("//")?new URL(F.protocol+y):new URL(y),$=VB(B.pathname,A);B.origin===F.origin&&$!=null?y=$+B.search+B.hash:P=!0}catch{}let N=Kwe(y,{relative:s}),R=b1e(y,{replace:d,state:i,target:m,preventScrollReset:S,relative:s,viewTransition:w});function M(F){n&&n(F),F.defaultPrevented||R(F)}return V.createElement("a",eF({},T,{href:O||N,onClick:P||o?n:M,ref:r,target:m}))});var gH;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(gH||(gH={}));var yH;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(yH||(yH={}));function b1e(e,t){let{target:r,replace:n,state:s,preventScrollReset:o,relative:d,viewTransition:i}=t===void 0?{}:t,m=Ju(),y=Qh(),S=$ee(e,{relative:d});return V.useCallback(w=>{if(p1e(w,r)){w.preventDefault();let T=n!==void 0?n:YP(y)===YP(S);m(e,{replace:T,state:s,preventScrollReset:o,relative:d,viewTransition:i})}},[y,m,S,n,s,r,e,o,d,i])}var tF=function(e,t){return tF=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},tF(e,t)};function qee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");tF(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var $u=function(){return $u=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},$u.apply(this,arguments)};function Sg(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Hee(e,t,r,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(d=e[i])&&(o=(s<3?d(o):s>3?d(t,r,o):d(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function Gee(e,t){return function(r,n){t(r,n,e)}}function Wee(e,t,r,n,s,o){function d(R){if(R!==void 0&&typeof R!="function")throw new TypeError("Function expected");return R}for(var i=n.kind,m=i==="getter"?"get":i==="setter"?"set":"value",y=!t&&e?n.static?e:e.prototype:null,S=t||(y?Object.getOwnPropertyDescriptor(y,n.name):{}),w,T=!1,A=r.length-1;A>=0;A--){var O={};for(var P in n)O[P]=P==="access"?{}:n[P];for(var P in n.access)O.access[P]=n.access[P];O.addInitializer=function(R){if(T)throw new TypeError("Cannot add initializers after decoration has completed");o.push(d(R||null))};var N=(0,r[A])(i==="accessor"?{get:S.get,set:S.set}:S[m],O);if(i==="accessor"){if(N===void 0)continue;if(N===null||typeof N!="object")throw new TypeError("Object expected");(w=d(N.get))&&(S.get=w),(w=d(N.set))&&(S.set=w),(w=d(N.init))&&s.unshift(w)}else(w=d(N))&&(i==="field"?s.unshift(w):S[m]=w)}y&&Object.defineProperty(y,n.name,S),T=!0}function Kee(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}function Zee(e){return typeof e=="symbol"?e:"".concat(e)}function Xee(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function Yee(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function kn(e,t,r,n){function s(o){return o instanceof r?o:new r(function(d){d(o)})}return new(r||(r=Promise))(function(o,d){function i(S){try{y(n.next(S))}catch(w){d(w)}}function m(S){try{y(n.throw(S))}catch(w){d(w)}}function y(S){S.done?o(S.value):s(S.value).then(i,m)}y((n=n.apply(e,t||[])).next())})}function Jee(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,d=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return d.next=i(0),d.throw=i(1),d.return=i(2),typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function i(y){return function(S){return m([y,S])}}function m(y){if(n)throw new TypeError("Generator is already executing.");for(;d&&(d=0,y[0]&&(r=0)),r;)try{if(n=1,s&&(o=y[0]&2?s.return:y[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,y[1])).done)return o;switch(s=0,o&&(y=[y[0]&2,o.value]),y[0]){case 0:case 1:o=y;break;case 4:return r.label++,{value:y[1],done:!1};case 5:r.label++,s=y[1],y=[0];continue;case 7:y=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){r=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){r.label=y[1];break}if(y[0]===6&&r.label<o[1]){r.label=o[1],o=y;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(y);break}o[2]&&r.ops.pop(),r.trys.pop();continue}y=t.call(e,r)}catch(S){y=[6,S],s=0}finally{n=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var mN=Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function Qee(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&mN(t,e,r)}function QP(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function WB(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,o=[],d;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(i){d={error:i}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(d)throw d.error}}return o}function ete(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(WB(arguments[t]));return e}function tte(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var o=arguments[t],d=0,i=o.length;d<i;d++,s++)n[s]=o[d];return n}function KB(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function ub(e){return this instanceof ub?(this.v=e,this):new ub(e)}function rte(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",d),s[Symbol.asyncIterator]=function(){return this},s;function d(A){return function(O){return Promise.resolve(O).then(A,w)}}function i(A,O){n[A]&&(s[A]=function(P){return new Promise(function(N,R){o.push([A,P,N,R])>1||m(A,P)})},O&&(s[A]=O(s[A])))}function m(A,O){try{y(n[A](O))}catch(P){T(o[0][3],P)}}function y(A){A.value instanceof ub?Promise.resolve(A.value.v).then(S,w):T(o[0][2],A)}function S(A){m("next",A)}function w(A){m("throw",A)}function T(A,O){A(O),o.shift(),o.length&&m(o[0][0],o[0][1])}}function nte(e){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,o){t[s]=e[s]?function(d){return(r=!r)?{value:ub(e[s](d)),done:!1}:o?o(d):d}:o}}function ite(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof QP=="function"?QP(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(d){return new Promise(function(i,m){d=e[o](d),s(i,m,d.done,d.value)})}}function s(o,d,i,m){Promise.resolve(m).then(function(y){o({value:y,done:i})},d)}}function ste(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var w1e=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},rF=function(e){return rF=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},rF(e)};function ate(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=rF(e),n=0;n<r.length;n++)r[n]!=="default"&&mN(t,e,r[n]);return w1e(t,e),t}function ote(e){return e&&e.__esModule?e:{default:e}}function lte(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function cte(e,t,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r}function ute(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function dte(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(o){return Promise.reject(o)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var S1e=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function hte(e){function t(o){e.error=e.hasError?new S1e(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function s(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(s);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(s,function(d){return t(d),s()})}else n|=1}catch(d){t(d)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return s()}function fte(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,s,o,d){return n?t?".jsx":".js":s&&(!o||!d)?r:s+o+"."+d.toLowerCase()+"js"}):e}const E1e={__extends:qee,__assign:$u,__rest:Sg,__decorate:Hee,__param:Gee,__esDecorate:Wee,__runInitializers:Kee,__propKey:Zee,__setFunctionName:Xee,__metadata:Yee,__awaiter:kn,__generator:Jee,__createBinding:mN,__exportStar:Qee,__values:QP,__read:WB,__spread:ete,__spreadArrays:tte,__spreadArray:KB,__await:ub,__asyncGenerator:rte,__asyncDelegator:nte,__asyncValues:ite,__makeTemplateObject:ste,__importStar:ate,__importDefault:ote,__classPrivateFieldGet:lte,__classPrivateFieldSet:cte,__classPrivateFieldIn:ute,__addDisposableResource:dte,__disposeResources:hte,__rewriteRelativeImportExtension:fte},T1e=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:dte,get __assign(){return $u},__asyncDelegator:nte,__asyncGenerator:rte,__asyncValues:ite,__await:ub,__awaiter:kn,__classPrivateFieldGet:lte,__classPrivateFieldIn:ute,__classPrivateFieldSet:cte,__createBinding:mN,__decorate:Hee,__disposeResources:hte,__esDecorate:Wee,__exportStar:Qee,__extends:qee,__generator:Jee,__importDefault:ote,__importStar:ate,__makeTemplateObject:ste,__metadata:Yee,__param:Gee,__propKey:Zee,__read:WB,__rest:Sg,__rewriteRelativeImportExtension:fte,__runInitializers:Kee,__setFunctionName:Xee,__spread:ete,__spreadArray:KB,__spreadArrays:tte,__values:QP,default:E1e},Symbol.toStringTag,{value:"Module"})),A1e=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class gN extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class pte extends gN{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class nF extends gN{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class iF extends gN{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var eO;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(eO||(eO={}));class C1e{constructor(t,{headers:r={},customFetch:n,region:s=eO.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=A1e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return kn(this,arguments,void 0,function*(r,n={}){var s;let o,d;try{const{headers:i,method:m,body:y,signal:S,timeout:w}=n;let T={},{region:A}=n;A||(A=this.region);const O=new URL(`${this.url}/${r}`);A&&A!=="any"&&(T["x-region"]=A,O.searchParams.set("forceFunctionRegion",A));let P;y&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&y instanceof Blob||y instanceof ArrayBuffer?(T["Content-Type"]="application/octet-stream",P=y):typeof y=="string"?(T["Content-Type"]="text/plain",P=y):typeof FormData<"u"&&y instanceof FormData?P=y:(T["Content-Type"]="application/json",P=JSON.stringify(y)):P=y;let N=S;w&&(d=new AbortController,o=setTimeout(()=>d.abort(),w),S?(N=d.signal,S.addEventListener("abort",()=>d.abort())):N=d.signal);const R=yield this.fetch(O.toString(),{method:m||"POST",headers:Object.assign(Object.assign(Object.assign({},T),this.headers),i),body:P,signal:N}).catch($=>{throw new pte($)}),M=R.headers.get("x-relay-error");if(M&&M==="true")throw new nF(R);if(!R.ok)throw new iF(R);let F=((s=R.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),B;return F==="application/json"?B=yield R.json():F==="application/octet-stream"||F==="application/pdf"?B=yield R.blob():F==="text/event-stream"?B=R:F==="multipart/form-data"?B=yield R.formData():B=yield R.text(),{data:B,error:null,response:R}}catch(i){return{data:null,error:i,response:i instanceof iF||i instanceof nF?i.context:void 0}}finally{o&&clearTimeout(o)}})}}var dc={};const lw=Wme(T1e);var fj={},pj={},mj={},gj={},yj={},vj={},vH;function mte(){if(vH)return vj;vH=1,Object.defineProperty(vj,"__esModule",{value:!0});class e extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return vj.default=e,vj}var _H;function gte(){if(_H)return yj;_H=1,Object.defineProperty(yj,"__esModule",{value:!0});const t=lw.__importDefault(mte());class r{constructor(s){var o,d;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(o=s.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=s.signal,this.isMaybeSingle=(d=s.isMaybeSingle)!==null&&d!==void 0?d:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,o){return this.headers=new Headers(this.headers),this.headers.set(s,o),this}then(s,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const d=this.fetch;let i=d(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var y,S,w,T;let A=null,O=null,P=null,N=m.status,R=m.statusText;if(m.ok){if(this.method!=="HEAD"){const $=await m.text();$===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((y=this.headers.get("Accept"))===null||y===void 0)&&y.includes("application/vnd.pgrst.plan+text"))?O=$:O=JSON.parse($))}const F=(S=this.headers.get("Prefer"))===null||S===void 0?void 0:S.match(/count=(exact|planned|estimated)/),B=(w=m.headers.get("content-range"))===null||w===void 0?void 0:w.split("/");F&&B&&B.length>1&&(P=parseInt(B[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(O)&&(O.length>1?(A={code:"PGRST116",details:`Results contain ${O.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},O=null,P=null,N=406,R="Not Acceptable"):O.length===1?O=O[0]:O=null)}else{const F=await m.text();try{A=JSON.parse(F),Array.isArray(A)&&m.status===404&&(O=[],A=null,N=200,R="OK")}catch{m.status===404&&F===""?(N=204,R="No Content"):A={message:F}}if(A&&this.isMaybeSingle&&(!((T=A==null?void 0:A.details)===null||T===void 0)&&T.includes("0 rows"))&&(A=null,N=200,R="OK"),A&&this.shouldThrowOnError)throw new t.default(A)}return{error:A,data:O,count:P,status:N,statusText:R}});return this.shouldThrowOnError||(i=i.catch(m=>{var y,S,w,T,A,O;let P="";const N=m==null?void 0:m.cause;if(N){const R=(y=N==null?void 0:N.message)!==null&&y!==void 0?y:"",M=(S=N==null?void 0:N.code)!==null&&S!==void 0?S:"";P=`${(w=m==null?void 0:m.name)!==null&&w!==void 0?w:"FetchError"}: ${m==null?void 0:m.message}`,P+=`

Caused by: ${(T=N==null?void 0:N.name)!==null&&T!==void 0?T:"Error"}: ${R}`,M&&(P+=` (${M})`),N!=null&&N.stack&&(P+=`
${N.stack}`)}else P=(A=m==null?void 0:m.stack)!==null&&A!==void 0?A:"";return{error:{message:`${(O=m==null?void 0:m.name)!==null&&O!==void 0?O:"FetchError"}: ${m==null?void 0:m.message}`,details:P,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),i.then(s,o)}returns(){return this}overrideTypes(){return this}}return yj.default=r,yj}var xH;function yte(){if(xH)return gj;xH=1,Object.defineProperty(gj,"__esModule",{value:!0});const t=lw.__importDefault(gte());class r extends t.default{select(s){let o=!1;const d=(s??"*").split("").map(i=>/\s/.test(i)&&!o?"":(i==='"'&&(o=!o),i)).join("");return this.url.searchParams.set("select",d),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:o=!0,nullsFirst:d,foreignTable:i,referencedTable:m=i}={}){const y=m?`${m}.order`:"order",S=this.url.searchParams.get(y);return this.url.searchParams.set(y,`${S?`${S},`:""}${s}.${o?"asc":"desc"}${d===void 0?"":d?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:o,referencedTable:d=o}={}){const i=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(i,`${s}`),this}range(s,o,{foreignTable:d,referencedTable:i=d}={}){const m=typeof i>"u"?"offset":`${i}.offset`,y=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(m,`${s}`),this.url.searchParams.set(y,`${o-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:o=!1,settings:d=!1,buffers:i=!1,wal:m=!1,format:y="text"}={}){var S;const w=[s?"analyze":null,o?"verbose":null,d?"settings":null,i?"buffers":null,m?"wal":null].filter(Boolean).join("|"),T=(S=this.headers.get("Accept"))!==null&&S!==void 0?S:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${y}; for="${T}"; options=${w};`),y==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return gj.default=r,gj}var bH;function ZB(){if(bH)return mj;bH=1,Object.defineProperty(mj,"__esModule",{value:!0});const t=lw.__importDefault(yte()),r=new RegExp("[,()]");class n extends t.default{eq(o,d){return this.url.searchParams.append(o,`eq.${d}`),this}neq(o,d){return this.url.searchParams.append(o,`neq.${d}`),this}gt(o,d){return this.url.searchParams.append(o,`gt.${d}`),this}gte(o,d){return this.url.searchParams.append(o,`gte.${d}`),this}lt(o,d){return this.url.searchParams.append(o,`lt.${d}`),this}lte(o,d){return this.url.searchParams.append(o,`lte.${d}`),this}like(o,d){return this.url.searchParams.append(o,`like.${d}`),this}likeAllOf(o,d){return this.url.searchParams.append(o,`like(all).{${d.join(",")}}`),this}likeAnyOf(o,d){return this.url.searchParams.append(o,`like(any).{${d.join(",")}}`),this}ilike(o,d){return this.url.searchParams.append(o,`ilike.${d}`),this}ilikeAllOf(o,d){return this.url.searchParams.append(o,`ilike(all).{${d.join(",")}}`),this}ilikeAnyOf(o,d){return this.url.searchParams.append(o,`ilike(any).{${d.join(",")}}`),this}regexMatch(o,d){return this.url.searchParams.append(o,`match.${d}`),this}regexIMatch(o,d){return this.url.searchParams.append(o,`imatch.${d}`),this}is(o,d){return this.url.searchParams.append(o,`is.${d}`),this}isDistinct(o,d){return this.url.searchParams.append(o,`isdistinct.${d}`),this}in(o,d){const i=Array.from(new Set(d)).map(m=>typeof m=="string"&&r.test(m)?`"${m}"`:`${m}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,d){return typeof d=="string"?this.url.searchParams.append(o,`cs.${d}`):Array.isArray(d)?this.url.searchParams.append(o,`cs.{${d.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(d)}`),this}containedBy(o,d){return typeof d=="string"?this.url.searchParams.append(o,`cd.${d}`):Array.isArray(d)?this.url.searchParams.append(o,`cd.{${d.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(d)}`),this}rangeGt(o,d){return this.url.searchParams.append(o,`sr.${d}`),this}rangeGte(o,d){return this.url.searchParams.append(o,`nxl.${d}`),this}rangeLt(o,d){return this.url.searchParams.append(o,`sl.${d}`),this}rangeLte(o,d){return this.url.searchParams.append(o,`nxr.${d}`),this}rangeAdjacent(o,d){return this.url.searchParams.append(o,`adj.${d}`),this}overlaps(o,d){return typeof d=="string"?this.url.searchParams.append(o,`ov.${d}`):this.url.searchParams.append(o,`ov.{${d.join(",")}}`),this}textSearch(o,d,{config:i,type:m}={}){let y="";m==="plain"?y="pl":m==="phrase"?y="ph":m==="websearch"&&(y="w");const S=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${y}fts${S}.${d}`),this}match(o){return Object.entries(o).forEach(([d,i])=>{this.url.searchParams.append(d,`eq.${i}`)}),this}not(o,d,i){return this.url.searchParams.append(o,`not.${d}.${i}`),this}or(o,{foreignTable:d,referencedTable:i=d}={}){const m=i?`${i}.or`:"or";return this.url.searchParams.append(m,`(${o})`),this}filter(o,d,i){return this.url.searchParams.append(o,`${d}.${i}`),this}}return mj.default=n,mj}var wH;function vte(){if(wH)return pj;wH=1,Object.defineProperty(pj,"__esModule",{value:!0});const t=lw.__importDefault(ZB());class r{constructor(s,{headers:o={},schema:d,fetch:i}){this.url=s,this.headers=new Headers(o),this.schema=d,this.fetch=i}select(s,o){const{head:d=!1,count:i}=o??{},m=d?"HEAD":"GET";let y=!1;const S=(s??"*").split("").map(w=>/\s/.test(w)&&!y?"":(w==='"'&&(y=!y),w)).join("");return this.url.searchParams.set("select",S),i&&this.headers.append("Prefer",`count=${i}`),new t.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:o,defaultToNull:d=!0}={}){var i;const m="POST";if(o&&this.headers.append("Prefer",`count=${o}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const y=s.reduce((S,w)=>S.concat(Object.keys(w)),[]);if(y.length>0){const S=[...new Set(y)].map(w=>`"${w}"`);this.url.searchParams.set("columns",S.join(","))}}return new t.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(s,{onConflict:o,ignoreDuplicates:d=!1,count:i,defaultToNull:m=!0}={}){var y;const S="POST";if(this.headers.append("Prefer",`resolution=${d?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),i&&this.headers.append("Prefer",`count=${i}`),m||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const w=s.reduce((T,A)=>T.concat(Object.keys(A)),[]);if(w.length>0){const T=[...new Set(w)].map(A=>`"${A}"`);this.url.searchParams.set("columns",T.join(","))}}return new t.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}update(s,{count:o}={}){var d;const i="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}delete({count:s}={}){var o;const d="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new t.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return pj.default=r,pj}var SH;function j1e(){if(SH)return fj;SH=1,Object.defineProperty(fj,"__esModule",{value:!0});const e=lw,t=e.__importDefault(vte()),r=e.__importDefault(ZB());class n{constructor(o,{headers:d={},schema:i,fetch:m}={}){this.url=o,this.headers=new Headers(d),this.schemaName=i,this.fetch=m}from(o){if(!o||typeof o!="string"||o.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const d=new URL(`${this.url}/${o}`);return new t.default(d,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new n(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,d={},{head:i=!1,get:m=!1,count:y}={}){var S;let w;const T=new URL(`${this.url}/rpc/${o}`);let A;i||m?(w=i?"HEAD":"GET",Object.entries(d).filter(([P,N])=>N!==void 0).map(([P,N])=>[P,Array.isArray(N)?`{${N.join(",")}}`:`${N}`]).forEach(([P,N])=>{T.searchParams.append(P,N)})):(w="POST",A=d);const O=new Headers(this.headers);return y&&O.set("Prefer",`count=${y}`),new r.default({method:w,url:T,headers:O,schema:this.schemaName,body:A,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}}return fj.default=n,fj}Object.defineProperty(dc,"__esModule",{value:!0});var _te=dc.PostgrestError=Pte=dc.PostgrestBuilder=Cte=dc.PostgrestTransformBuilder=Tte=dc.PostgrestFilterBuilder=Ste=dc.PostgrestQueryBuilder=bte=dc.PostgrestClient=void 0;const cw=lw,xte=cw.__importDefault(j1e());var bte=dc.PostgrestClient=xte.default;const wte=cw.__importDefault(vte());var Ste=dc.PostgrestQueryBuilder=wte.default;const Ete=cw.__importDefault(ZB());var Tte=dc.PostgrestFilterBuilder=Ete.default;const Ate=cw.__importDefault(yte());var Cte=dc.PostgrestTransformBuilder=Ate.default;const jte=cw.__importDefault(gte());var Pte=dc.PostgrestBuilder=jte.default;const Ote=cw.__importDefault(mte());_te=dc.PostgrestError=Ote.default;var kte=dc.default={PostgrestClient:xte.default,PostgrestQueryBuilder:wte.default,PostgrestFilterBuilder:Ete.default,PostgrestTransformBuilder:Ate.default,PostgrestBuilder:jte.default,PostgrestError:Ote.default};const P1e=MX({__proto__:null,get PostgrestBuilder(){return Pte},get PostgrestClient(){return bte},get PostgrestError(){return _te},get PostgrestFilterBuilder(){return Tte},get PostgrestQueryBuilder(){return Ste},get PostgrestTransformBuilder(){return Cte},default:kte},[dc]),{PostgrestClient:O1e,PostgrestQueryBuilder:Qit,PostgrestFilterBuilder:est,PostgrestTransformBuilder:tst,PostgrestBuilder:rst,PostgrestError:k1e}=kte||P1e;class Nte{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const N1e="2.84.0",I1e=`realtime-js/${N1e}`,Ite="1.0.0",R1e="2.0.0",EH=Ite,sF=1e4,M1e=1e3,D1e=100;var Gy;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Gy||(Gy={}));var Wo;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Wo||(Wo={}));var Nd;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Nd||(Nd={}));var aF;(function(e){e.websocket="websocket"})(aF||(aF={}));var Wy;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Wy||(Wy={}));class L1e{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n,s,o;const d=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",m=(n=t.join_ref)!==null&&n!==void 0?n:"",y=t.payload.event,S=(o=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&o!==void 0?o:new ArrayBuffer(0),w=this.USER_BROADCAST_PUSH_META_LENGTH+m.length+i.length+d.length+y.length,T=new ArrayBuffer(this.HEADER_LENGTH+w);let A=new DataView(T),O=0;A.setUint8(O++,this.KINDS.userBroadcastPush),A.setUint8(O++,m.length),A.setUint8(O++,i.length),A.setUint8(O++,d.length),A.setUint8(O++,y.length),A.setUint8(O++,this.BINARY_ENCODING),Array.from(m,N=>A.setUint8(O++,N.charCodeAt(0))),Array.from(i,N=>A.setUint8(O++,N.charCodeAt(0))),Array.from(d,N=>A.setUint8(O++,N.charCodeAt(0))),Array.from(y,N=>A.setUint8(O++,N.charCodeAt(0)));var P=new Uint8Array(T.byteLength+S.byteLength);return P.set(new Uint8Array(T),0),P.set(new Uint8Array(S),T.byteLength),P.buffer}_encodeJsonUserBroadcastPush(t){var r,n,s,o;const d=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",m=(n=t.join_ref)!==null&&n!==void 0?n:"",y=t.payload.event,S=(o=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&o!==void 0?o:{},T=new TextEncoder().encode(JSON.stringify(S)).buffer,A=this.USER_BROADCAST_PUSH_META_LENGTH+m.length+i.length+d.length+y.length,O=new ArrayBuffer(this.HEADER_LENGTH+A);let P=new DataView(O),N=0;P.setUint8(N++,this.KINDS.userBroadcastPush),P.setUint8(N++,m.length),P.setUint8(N++,i.length),P.setUint8(N++,d.length),P.setUint8(N++,y.length),P.setUint8(N++,this.JSON_ENCODING),Array.from(m,M=>P.setUint8(N++,M.charCodeAt(0))),Array.from(i,M=>P.setUint8(N++,M.charCodeAt(0))),Array.from(d,M=>P.setUint8(N++,M.charCodeAt(0))),Array.from(y,M=>P.setUint8(N++,M.charCodeAt(0)));var R=new Uint8Array(O.byteLength+T.byteLength);return R.set(new Uint8Array(O),0),R.set(new Uint8Array(T),O.byteLength),R.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[s,o,d,i,m]=n;return r({join_ref:s,ref:o,topic:d,event:i,payload:m})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,s)}}_decodeUserBroadcast(t,r,n){const s=r.getUint8(1),o=r.getUint8(2),d=r.getUint8(3),i=r.getUint8(4);let m=this.HEADER_LENGTH+4;const y=n.decode(t.slice(m,m+s));m=m+s;const S=n.decode(t.slice(m,m+o));m=m+o;const w=n.decode(t.slice(m,m+d));m=m+d;const T=t.slice(m,t.byteLength),A=i===this.JSON_ENCODING?JSON.parse(n.decode(T)):T,O={type:this.BROADCAST_EVENT,event:S,payload:A};return d>0&&(O.meta=JSON.parse(w)),{join_ref:null,ref:null,topic:y,event:this.BROADCAST_EVENT,payload:O}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}}class Rte{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ta;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(ta||(ta={}));const TH=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((o,d)=>(o[d]=F1e(d,e,t,s),o),{}):{}},F1e=(e,t,r,n)=>{const s=t.find(i=>i.name===e),o=s==null?void 0:s.type,d=r[e];return o&&!n.includes(o)?Mte(o,d):oF(d)},Mte=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return U1e(t,r)}switch(e){case ta.bool:return z1e(t);case ta.float4:case ta.float8:case ta.int2:case ta.int4:case ta.int8:case ta.numeric:case ta.oid:return B1e(t);case ta.json:case ta.jsonb:return $1e(t);case ta.timestamp:return V1e(t);case ta.abstime:case ta.date:case ta.daterange:case ta.int4range:case ta.int8range:case ta.money:case ta.reltime:case ta.text:case ta.time:case ta.timestamptz:case ta.timetz:case ta.tsrange:case ta.tstzrange:return oF(t);default:return oF(t)}},oF=e=>e,z1e=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},B1e=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},$1e=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},U1e=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let o;const d=e.slice(1,r);try{o=JSON.parse("["+d+"]")}catch{o=d?d.split(","):[]}return o.map(i=>Mte(t,i))}return e},V1e=e=>typeof e=="string"?e.replace(" ","T"):e,Dte=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class OD{constructor(t,r,n={},s=sF){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var lF;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(lF||(lF={}));class N0{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:d,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=N0.syncState(this.state,s,o,d),this.pendingDiffs.forEach(m=>{this.state=N0.syncDiff(this.state,m,o,d)}),this.pendingDiffs=[],i()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:d,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=N0.syncDiff(this.state,s,o,d),i())}),this.onJoin((s,o,d)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:d})}),this.onLeave((s,o,d)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const o=this.cloneDeep(t),d=this.transformState(r),i={},m={};return this.map(o,(y,S)=>{d[y]||(m[y]=S)}),this.map(d,(y,S)=>{const w=o[y];if(w){const T=S.map(N=>N.presence_ref),A=w.map(N=>N.presence_ref),O=S.filter(N=>A.indexOf(N.presence_ref)<0),P=w.filter(N=>T.indexOf(N.presence_ref)<0);O.length>0&&(i[y]=O),P.length>0&&(m[y]=P)}else i[y]=S}),this.syncDiff(o,{joins:i,leaves:m},n,s)}static syncDiff(t,r,n,s){const{joins:o,leaves:d}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(i,m)=>{var y;const S=(y=t[i])!==null&&y!==void 0?y:[];if(t[i]=this.cloneDeep(m),S.length>0){const w=t[i].map(A=>A.presence_ref),T=S.filter(A=>w.indexOf(A.presence_ref)<0);t[i].unshift(...T)}n(i,S,m)}),this.map(d,(i,m)=>{let y=t[i];if(!y)return;const S=m.map(w=>w.presence_ref);y=y.filter(w=>S.indexOf(w.presence_ref)<0),t[i]=y,s(i,y,m),y.length===0&&delete t[i]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var cF;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(cF||(cF={}));var I0;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(I0||(I0={}));var _h;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(_h||(_h={}));class yN{constructor(t,r={config:{}},n){var s,o;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=Wo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new OD(this,Nd.join,this.params,this.timeout),this.rejoinTimer=new Rte(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Wo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Wo.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Wo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Wo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Wo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Nd.reply,{},(d,i)=>{this._trigger(this._replyEventName(i),d)}),this.presence=new N0(this),this.broadcastEndpointURL=Dte(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Wo.closed){const{config:{broadcast:d,presence:i,private:m}}=this.params,y=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(A=>A.filter))!==null&&s!==void 0?s:[],S=!!this.bindings[I0.PRESENCE]&&this.bindings[I0.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,w={},T={broadcast:d,presence:Object.assign(Object.assign({},i),{enabled:S}),postgres_changes:y,private:m};this.socket.accessTokenValue&&(w.access_token=this.socket.accessTokenValue),this._onError(A=>t==null?void 0:t(_h.CHANNEL_ERROR,A)),this._onClose(()=>t==null?void 0:t(_h.CLOSED)),this.updateJoinPayload(Object.assign({config:T},w)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:A})=>{var O;if(this.socket.setAuth(),A===void 0){t==null||t(_h.SUBSCRIBED);return}else{const P=this.bindings.postgres_changes,N=(O=P==null?void 0:P.length)!==null&&O!==void 0?O:0,R=[];for(let M=0;M<N;M++){const F=P[M],{filter:{event:B,schema:$,table:W,filter:K}}=F,te=A&&A[M];if(te&&te.event===B&&te.schema===$&&te.table===W&&te.filter===K)R.push(Object.assign(Object.assign({},F),{id:te.id}));else{this.unsubscribe(),this.state=Wo.errored,t==null||t(_h.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=R,t&&t(_h.SUBSCRIBED);return}}).receive("error",A=>{this.state=Wo.errored,t==null||t(_h.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(A).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(_h.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===Wo.joined&&t===I0.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var s;const o=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const d={method:"POST",headers:{Authorization:o,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(i.status===202)return{success:!0};let m=i.statusText;try{const y=await i.json();m=y.error||y.message||m}catch{}return Promise.reject(new Error(m))}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:d}=t,m={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:d,private:this.private}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,m,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=y.body)===null||s===void 0?void 0:s.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var d,i,m;const y=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((m=(i=(d=this.params)===null||d===void 0?void 0:d.config)===null||i===void 0?void 0:i.broadcast)===null||m===void 0)&&m.ack)&&o("ok"),y.receive("ok",()=>o("ok")),y.receive("error",()=>o("error")),y.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Wo.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Nd.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new OD(this,Nd.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Wo.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),d=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(o),d}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new OD(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>D1e){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,o;const d=t.toLocaleLowerCase(),{close:i,error:m,leave:y,join:S}=Nd;if(n&&[i,m,y,S].indexOf(d)>=0&&n!==this._joinRef())return;let T=this._onMessage(d,r,n);if(r&&!T)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(A=>{var O,P,N;return((O=A.filter)===null||O===void 0?void 0:O.event)==="*"||((N=(P=A.filter)===null||P===void 0?void 0:P.event)===null||N===void 0?void 0:N.toLocaleLowerCase())===d}).map(A=>A.callback(T,n)):(o=this.bindings[d])===null||o===void 0||o.filter(A=>{var O,P,N,R,M,F;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in A){const B=A.id,$=(O=A.filter)===null||O===void 0?void 0:O.event;return B&&((P=r.ids)===null||P===void 0?void 0:P.includes(B))&&($==="*"||($==null?void 0:$.toLocaleLowerCase())===((N=r.data)===null||N===void 0?void 0:N.type.toLocaleLowerCase()))}else{const B=(M=(R=A==null?void 0:A.filter)===null||R===void 0?void 0:R.event)===null||M===void 0?void 0:M.toLocaleLowerCase();return B==="*"||B===((F=r==null?void 0:r.event)===null||F===void 0?void 0:F.toLocaleLowerCase())}else return A.type.toLocaleLowerCase()===d}).map(A=>{if(typeof T=="object"&&"ids"in T){const O=T.data,{schema:P,table:N,commit_timestamp:R,type:M,errors:F}=O;T=Object.assign(Object.assign({},{schema:P,table:N,commit_timestamp:R,eventType:M,new:{},old:{},errors:F}),this._getPayloadRecords(O))}A.callback(T,n)})}_isClosed(){return this.state===Wo.closed}_isJoined(){return this.state===Wo.joined}_isJoining(){return this.state===Wo.joining}_isLeaving(){return this.state===Wo.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),o={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&yN.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Nd.close,{},t)}_onError(t){this._on(Nd.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Wo.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=TH(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=TH(t.columns,t.old_record)),r}}const kD=()=>{},_j={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},q1e=[1e3,2e3,5e3,1e4],H1e=1e4,G1e=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Lte{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=sF,this.transport=null,this.heartbeatIntervalMs=_j.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=kD,this.ref=0,this.reconnectTimer=null,this.vsn=EH,this.logger=kD,this.conn=null,this.sendBuffer=[],this.serializer=new L1e,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...o)=>s(...o):(...o)=>fetch(...o),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${aF.websocket}`,this.httpEndpoint=Dte(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Nte.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Gy.connecting:return Wy.Connecting;case Gy.open:return Wy.Open;case Gy.closing:return Wy.Closing;default:return Wy.Closed}}isConnected(){return this.connectionState()===Wy.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new yN(`realtime:${t}`,r,this);return this.channels.push(o),o}}push(t){const{topic:r,event:n,payload:s,ref:o}=t,d=()=>{this.encode(t,i=>{var m;(m=this.conn)===null||m===void 0||m.send(i)})};this.log("push",`${r} ${n} (${o})`,s),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(M1e,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},_j.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(y){this.log("error","error in heartbeat callback",y)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:o,ref:d}=r,i=d?`(${d})`:"",m=o.status||"";this.log("receive",`${m} ${n} ${s} ${i}`.trim(),o),this.channels.filter(y=>y._isMember(n)).forEach(y=>y._trigger(s,o,d)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Gy.open||this.conn.readyState===Gy.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Nd.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([G1e],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const s={access_token:r,version:I1e};r&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(Nd.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Rte(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},_j.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,o,d,i,m,y,S,w,T,A;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:sF,this.heartbeatIntervalMs=(s=t==null?void 0:t.heartbeatIntervalMs)!==null&&s!==void 0?s:_j.HEARTBEAT_INTERVAL,this.worker=(o=t==null?void 0:t.worker)!==null&&o!==void 0?o:!1,this.accessToken=(d=t==null?void 0:t.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(i=t==null?void 0:t.heartbeatCallback)!==null&&i!==void 0?i:kD,this.vsn=(m=t==null?void 0:t.vsn)!==null&&m!==void 0?m:EH,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(y=t==null?void 0:t.reconnectAfterMs)!==null&&y!==void 0?y:O=>q1e[O-1]||H1e,this.vsn){case Ite:this.encode=(S=t==null?void 0:t.encode)!==null&&S!==void 0?S:(O,P)=>P(JSON.stringify(O)),this.decode=(w=t==null?void 0:t.decode)!==null&&w!==void 0?w:(O,P)=>P(JSON.parse(O));break;case R1e:this.encode=(T=t==null?void 0:t.encode)!==null&&T!==void 0?T:this.serializer.encode.bind(this.serializer),this.decode=(A=t==null?void 0:t.decode)!==null&&A!==void 0?A:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class XB extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Ma(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class W1e extends XB{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class uF extends XB{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}const YB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),K1e=()=>Response,dF=e=>{if(Array.isArray(e))return e.map(r=>dF(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[s]=dF(n)}),t},Z1e=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},ND=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},X1e=(e,t,r)=>kn(void 0,void 0,void 0,function*(){const n=yield K1e();e instanceof n&&!(r!=null&&r.noResolveJson)?e.json().then(s=>{const o=e.status||500,d=(s==null?void 0:s.statusCode)||o+"";t(new W1e(ND(s),o,d))}).catch(s=>{t(new uF(ND(s),s))}):t(new uF(ND(e),e))}),Y1e=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?s:(Z1e(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,t!=null&&t.duplex&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r))};function S2(e,t,r,n,s,o){return kn(this,void 0,void 0,function*(){return new Promise((d,i)=>{e(r,Y1e(t,n,s,o)).then(m=>{if(!m.ok)throw m;return n!=null&&n.noResolveJson?m:m.json()}).then(m=>d(m)).catch(m=>X1e(m,i,n))})})}function pT(e,t,r,n){return kn(this,void 0,void 0,function*(){return S2(e,"GET",t,r,n)})}function jd(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return S2(e,"POST",t,n,s,r)})}function hF(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return S2(e,"PUT",t,n,s,r)})}function J1e(e,t,r,n){return kn(this,void 0,void 0,function*(){return S2(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function JB(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return S2(e,"DELETE",t,n,s,r)})}class Q1e{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return kn(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ma(t))return{data:null,error:t};throw t}})}}var Fte;class eSe{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r,this[Fte]="BlobDownloadBuilder",this.promise=null}asStream(){return new Q1e(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.getPromise().then(t,r)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return kn(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ma(t))return{data:null,error:t};throw t}})}}Fte=Symbol.toStringTag;const tSe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},AH={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class rSe{constructor(t,r={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=YB(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,s){return kn(this,void 0,void 0,function*(){try{let o;const d=Object.assign(Object.assign({},AH),s);let i=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(d.upsert)});const m=d.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",d.cacheControl),m&&o.append("metadata",this.encodeMetadata(m)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.has("cacheControl")||o.append("cacheControl",d.cacheControl),m&&!o.has("metadata")&&o.append("metadata",this.encodeMetadata(m))):(o=n,i["cache-control"]=`max-age=${d.cacheControl}`,i["content-type"]=d.contentType,m&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(m))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!d.duplex&&(d.duplex="half")),s!=null&&s.headers&&(i=Object.assign(Object.assign({},i),s.headers));const y=this._removeEmptyFolders(r),S=this._getFinalPath(y),w=yield(t=="PUT"?hF:jd)(this.fetch,`${this.url}/object/${S}`,o,Object.assign({headers:i},d!=null&&d.duplex?{duplex:d.duplex}:{}));return{data:{path:y,id:w.Id,fullPath:w.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Ma(o))return{data:null,error:o};throw o}})}upload(t,r,n){return kn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,s){return kn(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),d=this._getFinalPath(o),i=new URL(this.url+`/object/upload/sign/${d}`);i.searchParams.set("token",r);try{let m;const y=Object.assign({upsert:AH.upsert},s),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(y.upsert)});typeof Blob<"u"&&n instanceof Blob?(m=new FormData,m.append("cacheControl",y.cacheControl),m.append("",n)):typeof FormData<"u"&&n instanceof FormData?(m=n,m.append("cacheControl",y.cacheControl)):(m=n,S["cache-control"]=`max-age=${y.cacheControl}`,S["content-type"]=y.contentType);const w=yield hF(this.fetch,i.toString(),m,{headers:S});return{data:{path:o,fullPath:w.Key},error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(Ma(m))return{data:null,error:m};throw m}})}createSignedUploadUrl(t,r){return kn(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const s=Object.assign({},this.headers);r!=null&&r.upsert&&(s["x-upsert"]="true");const o=yield jd(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),d=new URL(this.url+o.url),i=d.searchParams.get("token");if(!i)throw new XB("No token returned by API");return{data:{signedUrl:d.toString(),path:t,token:i},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ma(n))return{data:null,error:n};throw n}})}update(t,r,n){return kn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return kn(this,void 0,void 0,function*(){try{return{data:yield jd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ma(s))return{data:null,error:s};throw s}})}copy(t,r,n){return kn(this,void 0,void 0,function*(){try{return{data:{path:(yield jd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ma(s))return{data:null,error:s};throw s}})}createSignedUrl(t,r,n){return kn(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),o=yield jd(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const d=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${d}`)},{data:o,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ma(s))return{data:null,error:s};throw s}})}createSignedUrls(t,r,n){return kn(this,void 0,void 0,function*(){try{const s=yield jd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(d=>Object.assign(Object.assign({},d),{signedUrl:d.signedURL?encodeURI(`${this.url}${d.signedURL}${o}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ma(s))return{data:null,error:s};throw s}})}download(t,r){const s=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),d=o?`?${o}`:"",i=this._getFinalPath(t),m=()=>pT(this.fetch,`${this.url}/${s}/${i}${d}`,{headers:this.headers,noResolveJson:!0});return new eSe(m,this.shouldThrowOnError)}info(t){return kn(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield pT(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:dF(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ma(n))return{data:null,error:n};throw n}})}exists(t){return kn(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield J1e(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ma(n)&&n instanceof uF){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),s=[],o=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";o!==""&&s.push(o);const i=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",m=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});m!==""&&s.push(m);let y=s.join("&");return y!==""&&(y=`?${y}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${y}`)}}}remove(t){return kn(this,void 0,void 0,function*(){try{return{data:yield JB(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}list(t,r,n){return kn(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},tSe),r),{prefix:t||""});return{data:yield jd(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ma(s))return{data:null,error:s};throw s}})}listV2(t,r){return kn(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield jd(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ma(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const zte="2.84.0",Bte={"X-Client-Info":`storage-js/${zte}`};class nSe{constructor(t,r={},n,s){this.shouldThrowOnError=!1;const o=new URL(t);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bte),r),this.fetch=YB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return kn(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(t);return{data:yield pT(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}getBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield pT(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}createBucket(t){return kn(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield jd(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ma(s))return{data:null,error:s};throw s}})}updateBucket(t,r){return kn(this,void 0,void 0,function*(){try{return{data:yield hF(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ma(n))return{data:null,error:n};throw n}})}emptyBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield jd(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}deleteBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield JB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(t){const r={};return t&&("limit"in t&&(r.limit=String(t.limit)),"offset"in t&&(r.offset=String(t.offset)),t.search&&(r.search=t.search),t.sortColumn&&(r.sortColumn=t.sortColumn),t.sortOrder&&(r.sortOrder=t.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class iSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bte),r),this.fetch=YB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield jd(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}listBuckets(t){return kn(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),s=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield pT(this.fetch,s,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}deleteBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield JB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ma(r))return{data:null,error:r};throw r}})}}const QB={"X-Client-Info":`storage-js/${zte}`,"Content-Type":"application/json"};class $te extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function hu(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class ID extends $te{constructor(t,r,n){super(t),this.name="StorageVectorsApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class sSe extends $te{constructor(t,r){super(t),this.name="StorageVectorsUnknownError",this.originalError=r}}var CH;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(CH||(CH={}));const e5=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),aSe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},jH=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),oSe=(e,t,r)=>kn(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const s=e.status||500,o=e;if(typeof o.json=="function")o.json().then(d=>{const i=(d==null?void 0:d.statusCode)||(d==null?void 0:d.code)||s+"";t(new ID(jH(d),s,i))}).catch(()=>{const d=s+"",i=o.statusText||`HTTP ${s} error`;t(new ID(i,s,d))});else{const d=s+"",i=o.statusText||`HTTP ${s} error`;t(new ID(i,s,d))}}else t(new sSe(jH(e),e))}),lSe=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(aSe(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),r)):s};function cSe(e,t,r,n,s,o){return kn(this,void 0,void 0,function*(){return new Promise((d,i)=>{e(r,lSe(t,n,s,o)).then(m=>{if(!m.ok)throw m;if(n!=null&&n.noResolveJson)return m;const y=m.headers.get("content-type");return!y||!y.includes("application/json")?{}:m.json()}).then(m=>d(m)).catch(m=>oSe(m,i,n))})})}function fu(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return cSe(e,"POST",t,n,s,r)})}class uSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},QB),r),this.fetch=e5(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return kn(this,void 0,void 0,function*(){try{return{data:(yield fu(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}getIndex(t,r){return kn(this,void 0,void 0,function*(){try{return{data:yield fu(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(hu(n))return{data:null,error:n};throw n}})}listIndexes(t){return kn(this,void 0,void 0,function*(){try{return{data:yield fu(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}deleteIndex(t,r){return kn(this,void 0,void 0,function*(){try{return{data:(yield fu(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(hu(n))return{data:null,error:n};throw n}})}}class dSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},QB),r),this.fetch=e5(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return kn(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield fu(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}getVectors(t){return kn(this,void 0,void 0,function*(){try{return{data:yield fu(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}listVectors(t){return kn(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield fu(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}queryVectors(t){return kn(this,void 0,void 0,function*(){try{return{data:yield fu(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}deleteVectors(t){return kn(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield fu(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}}class hSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},QB),r),this.fetch=e5(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:(yield fu(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}getBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield fu(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}listBuckets(){return kn(this,arguments,void 0,function*(t={}){try{return{data:yield fu(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}deleteBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:(yield fu(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(hu(r))return{data:null,error:r};throw r}})}}class fSe extends hSe{constructor(t,r={}){super(t,r.headers||{},r.fetch)}from(t){return new pSe(this.url,this.headers,t,this.fetch)}}class pSe extends uSe{constructor(t,r,n,s){super(t,r,s),this.vectorBucketName=n}createIndex(t){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return kn(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return kn(this,arguments,void 0,function*(r={}){return t.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return kn(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return kn(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new mSe(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class mSe extends dSe{constructor(t,r,n,s,o){super(t,r,o),this.vectorBucketName=n,this.indexName=s}putVectors(t){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return kn(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return kn(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return kn(this,arguments,void 0,function*(r={}){return t.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return kn(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return kn(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class gSe extends nSe{constructor(t,r={},n,s){super(t,r,n,s)}from(t){return new rSe(this.url,this.headers,t,this.fetch)}get vectors(){return new fSe(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new iSe(this.url+"/iceberg",this.headers,this.fetch)}}const ySe="2.84.0";let uE="";typeof Deno<"u"?uE="deno":typeof document<"u"?uE="web":typeof navigator<"u"&&navigator.product==="ReactNative"?uE="react-native":uE="node";const vSe={"X-Client-Info":`supabase-js-${uE}/${ySe}`},_Se={headers:vSe},xSe={schema:"public"},bSe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wSe={},SSe=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),ESe=()=>Headers,TSe=(e,t,r)=>{const n=SSe(r),s=ESe();return async(o,d)=>{var i;const m=(i=await t())!==null&&i!==void 0?i:e;let y=new s(d==null?void 0:d.headers);return y.has("apikey")||y.set("apikey",e),y.has("Authorization")||y.set("Authorization",`Bearer ${m}`),n(o,Object.assign(Object.assign({},d),{headers:y}))}};function ASe(e){return e.endsWith("/")?e:e+"/"}function CSe(e,t){var r,n;const{db:s,auth:o,realtime:d,global:i}=e,{db:m,auth:y,realtime:S,global:w}=t,T={db:Object.assign(Object.assign({},m),s),auth:Object.assign(Object.assign({},y),o),realtime:Object.assign(Object.assign({},S),d),storage:{},global:Object.assign(Object.assign(Object.assign({},w),i),{headers:Object.assign(Object.assign({},(r=w==null?void 0:w.headers)!==null&&r!==void 0?r:{}),(n=i==null?void 0:i.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?T.accessToken=e.accessToken:delete T.accessToken,T}function jSe(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ASe(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Ute="2.84.0",Jx=30*1e3,fF=3,RD=fF*Jx,PSe="http://localhost:9999",OSe="supabase.auth.token",kSe={"X-Client-Info":`gotrue-js/${Ute}`},pF="X-Supabase-Api-Version",Vte={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},NSe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ISe=10*60*1e3;class db extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function In(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class qte extends db{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function Hte(e){return In(e)&&e.name==="AuthApiError"}class km extends db{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class gp extends db{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class Ic extends gp{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Gte(e){return In(e)&&e.name==="AuthSessionMissingError"}class zy extends gp{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class dE extends gp{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class hE extends gp{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Wte(e){return In(e)&&e.name==="AuthImplicitGrantRedirectError"}class mF extends gp{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tO extends gp{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function iP(e){return In(e)&&e.name==="AuthRetryableFetchError"}class gF extends gp{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class rO extends gp{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const nO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),PH=` 	
\r=`.split(""),RSe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<PH.length;t+=1)e[PH[t].charCodeAt(0)]=-2;for(let t=0;t<nO.length;t+=1)e[nO[t].charCodeAt(0)]=t;return e})();function OH(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(nO[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(nO[n]),t.queuedBits-=6}}function Kte(e,t,r){const n=RSe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function kH(e){const t=[],r=d=>{t.push(String.fromCodePoint(d))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=d=>{LSe(d,n,r)};for(let d=0;d<e.length;d+=1)Kte(e.charCodeAt(d),s,o);return t.join("")}function MSe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function DSe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}MSe(n,t)}}function LSe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function R0(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)Kte(e.charCodeAt(s),r,n);return new Uint8Array(t)}function FSe(e){const t=[];return DSe(e,r=>t.push(r)),new Uint8Array(t)}function Jy(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>OH(s,r,n)),OH(null,r,n),t.join("")}function zSe(e){return Math.round(Date.now()/1e3)+e}function BSe(){return Symbol("auth-callback")}const wl=()=>typeof window<"u"&&typeof document<"u",Ny={tested:!1,writable:!1},Zte=()=>{if(!wl())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ny.tested)return Ny.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Ny.tested=!0,Ny.writable=!0}catch{Ny.tested=!0,Ny.writable=!1}return Ny.writable};function $Se(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,o)=>{t[o]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const Xte=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),USe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Qx=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Iy=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},mm=async(e,t)=>{await e.removeItem(t)};class vN{constructor(){this.promise=new vN.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}vN.promiseConstructor=Promise;function MD(e){const t=e.split(".");if(t.length!==3)throw new rO("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!NSe.test(t[n]))throw new rO("JWT not in base64url format");return{header:JSON.parse(kH(t[0])),payload:JSON.parse(kH(t[1])),signature:R0(t[2]),raw:{header:t[0],payload:t[1]}}}async function VSe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function qSe(e,t){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const d=await e(o);if(!t(o,null,d)){n(d);return}}catch(d){if(!t(o,d)){s(d);return}}})()})}function HSe(e){return("0"+e.toString(16)).substr(-2)}function GSe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let o=0;o<56;o++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,HSe).join("")}async function WSe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function KSe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await WSe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Mx(e,t,r=!1){const n=GSe();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await Qx(e,`${t}-code-verifier`,s);const o=await KSe(n);return[o,n===o?"plain":"s256"]}const ZSe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function XSe(e){const t=e.headers.get(pF);if(!t||!t.match(ZSe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function YSe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function JSe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const QSe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Dx(e){if(!QSe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function DD(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function eEe(e,t){return new Proxy(e,{get:(r,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const o=n.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,s)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,s)}})}function NH(e){return JSON.parse(JSON.stringify(e))}const By=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tEe=[502,503,504];async function IH(e){var t;if(!USe(e))throw new tO(By(e),0);if(tEe.includes(e.status))throw new tO(By(e),e.status);let r;try{r=await e.json()}catch(o){throw new km(By(o),o)}let n;const s=XSe(e);if(s&&s.getTime()>=Vte["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new gF(By(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Ic}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((o,d)=>o&&typeof d=="string",!0))throw new gF(By(r),e.status,r.weak_password.reasons);throw new qte(By(r),e.status||500,n)}const rEe=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function li(e,t,r,n){var s;const o=Object.assign({},n==null?void 0:n.headers);o[pF]||(o[pF]=Vte["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const d=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(d.redirect_to=n.redirectTo);const i=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",m=await nEe(e,t,r+i,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(m):{data:Object.assign({},m),error:null}}async function nEe(e,t,r,n,s,o){const d=rEe(t,n,s,o);let i;try{i=await e(r,Object.assign({},d))}catch(m){throw console.error(m),new tO(By(m),0)}if(i.ok||await IH(i),n!=null&&n.noResolveJson)return i;try{return await i.json()}catch(m){await IH(m)}}function Ed(e){var t;let r=null;aEe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=zSe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function RH(e){const t=Ed(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Nm(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function iEe(e){return{data:e,error:null}}function sEe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o}=e,d=Sg(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o},m=Object.assign({},d);return{data:{properties:i,user:m},error:null}}function MH(e){return e}function aEe(e){return e.access_token&&e.refresh_token&&e.expires_in}const sP=["global","local","others"];class Yte{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=Xte(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=sP[0]){if(sP.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${sP.join(", ")}`);try{return await li(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(In(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await li(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Nm})}catch(n){if(In(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=Sg(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await li(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:sEe,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(In(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await li(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Nm})}catch(r){if(In(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,o,d,i,m;try{const y={nextPage:null,lastPage:0,total:0},S=await li(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:MH});if(S.error)throw S.error;const w=await S.json(),T=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,A=(m=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&m!==void 0?m:[];return A.length>0&&(A.forEach(O=>{const P=parseInt(O.split(";")[0].split("=")[1].substring(0,1)),N=JSON.parse(O.split(";")[1].split("=")[1]);y[`${N}Page`]=P}),y.total=parseInt(T)),{data:Object.assign(Object.assign({},w),y),error:null}}catch(y){if(In(y))return{data:{users:[]},error:y};throw y}}async getUserById(t){Dx(t);try{return await li(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Nm})}catch(r){if(In(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Dx(t);try{return await li(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Nm})}catch(n){if(In(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){Dx(t);try{return await li(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Nm})}catch(n){if(In(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Dx(t.userId);try{const{data:r,error:n}=await li(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(In(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Dx(t.userId),Dx(t.id);try{return{data:await li(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(In(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,o,d,i,m;try{const y={nextPage:null,lastPage:0,total:0},S=await li(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:MH});if(S.error)throw S.error;const w=await S.json(),T=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,A=(m=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&m!==void 0?m:[];return A.length>0&&(A.forEach(O=>{const P=parseInt(O.split(";")[0].split("=")[1].substring(0,1)),N=JSON.parse(O.split(";")[1].split("=")[1]);y[`${N}Page`]=P}),y.total=parseInt(T)),{data:Object.assign(Object.assign({},w),y),error:null}}catch(y){if(In(y))return{data:{clients:[]},error:y};throw y}}async _createOAuthClient(t){try{return await li(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(In(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await li(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(In(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await li(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(In(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await li(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(In(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await li(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(In(r))return{data:null,error:r};throw r}}}function DH(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const $y={debug:!!(globalThis&&Zte()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Jte extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Qte extends Jte{}async function ere(e,t,r){$y.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),$y.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){$y.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{$y.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw $y.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Qte(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if($y.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function oEe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function tre(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function lEe(e){return parseInt(e,16)}function cEe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function uEe(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:o=new Date,nonce:d,notBefore:i,requestId:m,resources:y,scheme:S,uri:w,version:T}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!w)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(T!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${T}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const A=tre(e.address),O=S?`${S}://${n}`:n,P=e.statement?`${e.statement}
`:"",N=`${O} wants you to sign in with your Ethereum account:
${A}

${P}`;let R=`URI: ${w}
Version: ${T}
Chain ID: ${r}${d?`
Nonce: ${d}`:""}
Issued At: ${o.toISOString()}`;if(s&&(R+=`
Expiration Time: ${s.toISOString()}`),i&&(R+=`
Not Before: ${i.toISOString()}`),m&&(R+=`
Request ID: ${m}`),y){let M=`
Resources:`;for(const F of y){if(!F||typeof F!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${F}`);M+=`
- ${F}`}R+=M}return`${N}
${R}`}class Oo extends Error{constructor({message:t,code:r,cause:n,name:s}){var o;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(o=s??(n instanceof Error?n.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=r}}class iO extends Oo{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function dEe({error:e,options:t}){var r,n,s;const{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Oo({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Oo({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=o.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Oo({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Oo({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Oo({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Oo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return o.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new Oo({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Oo({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const d=window.location.hostname;if(rre(d)){if(o.rp.id!==d)return new Oo({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Oo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new Oo({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Oo({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Oo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function hEe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Oo({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Oo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(rre(n)){if(r.rpId!==n)return new Oo({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Oo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Oo({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Oo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class fEe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const pEe=new fEe;function mEe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=Sg(e,["challenge","user","excludeCredentials"]),o=R0(t).buffer,d=Object.assign(Object.assign({},r),{id:R0(r.id).buffer}),i=Object.assign(Object.assign({},s),{challenge:o,user:d});if(n&&n.length>0){i.excludeCredentials=new Array(n.length);for(let m=0;m<n.length;m++){const y=n[m];i.excludeCredentials[m]=Object.assign(Object.assign({},y),{id:R0(y.id).buffer,type:y.type||"public-key",transports:y.transports})}}return i}function gEe(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=Sg(e,["challenge","allowCredentials"]),s=R0(t).buffer,o=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){o.allowCredentials=new Array(r.length);for(let d=0;d<r.length;d++){const i=r[d];o.allowCredentials[d]=Object.assign(Object.assign({},i),{id:R0(i.id).buffer,type:i.type||"public-key",transports:i.transports})}}return o}function yEe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Jy(new Uint8Array(e.response.attestationObject)),clientDataJSON:Jy(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function vEe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Jy(new Uint8Array(s.authenticatorData)),clientDataJSON:Jy(new Uint8Array(s.clientDataJSON)),signature:Jy(new Uint8Array(s.signature)),userHandle:s.userHandle?Jy(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function rre(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function LH(){var e,t;return!!(wl()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function _Ee(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new iO("Browser returned unexpected credential type",t)}:{data:null,error:new iO("Empty credential response",t)}}catch(t){return{data:null,error:dEe({error:t,options:e})}}}async function xEe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new iO("Browser returned unexpected credential type",t)}:{data:null,error:new iO("Empty credential response",t)}}catch(t){return{data:null,error:hEe({error:t,options:e})}}}const bEe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},wEe={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function sO(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const o in s){const d=s[o];if(d!==void 0)if(Array.isArray(d))n[o]=d;else if(r(d))n[o]=d;else if(t(d)){const i=n[o];t(i)?n[o]=sO(i,d):n[o]=sO(d)}else n[o]=d}return n}function SEe(e,t){return sO(bEe,e,t||{})}function EEe(e,t){return sO(wEe,e,t||{})}class TEe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},o){try{const{data:d,error:i}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!d)return{data:null,error:i};const m=s??pEe.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:y}=d.webauthn.credential_options.publicKey;y.name||(y.name=`${y.id}:${n}`),y.displayName||(y.displayName=y.name)}switch(d.webauthn.type){case"create":{const y=SEe(d.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:S,error:w}=await _Ee({publicKey:y,signal:m});return S?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:S}},error:null}:{data:null,error:w}}case"request":{const y=EEe(d.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:S,error:w}=await xEe(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:y,signal:m}));return S?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:S}},error:null}:{data:null,error:w}}}}catch(d){return In(d)?{data:null,error:d}:{data:null,error:new km("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!r)return{data:null,error:new db("rpId is required for WebAuthn authentication")};try{if(!LH())return{data:null,error:new km("Browser does not support WebAuthn",null)};const{data:d,error:i}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:o});if(!d)return{data:null,error:i};const{webauthn:m}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:m.type,rpId:r,rpOrigins:n,credential_response:m.credential_response}})}catch(d){return In(d)?{data:null,error:d}:{data:null,error:new km("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!r)return{data:null,error:new db("rpId is required for WebAuthn registration")};try{if(!LH())return{data:null,error:new km("Browser does not support WebAuthn",null)};const{data:d,error:i}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(S=>{var w;return(w=S.data)===null||w===void 0?void 0:w.all.find(T=>T.factor_type==="webauthn"&&T.friendly_name===t&&T.status!=="unverified")}).then(S=>S?this.client.mfa.unenroll({factorId:S==null?void 0:S.id}):void 0),{data:null,error:i};const{data:m,error:y}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:o});return m?this._verify({factorId:d.id,challengeId:m.challengeId,webauthn:{rpId:r,rpOrigins:n,type:m.webauthn.type,credential_response:m.webauthn.credential_response}}):{data:null,error:y}}catch(d){return In(d)?{data:null,error:d}:{data:null,error:new km("Unexpected error in register",d)}}}}oEe();const AEe={url:PSe,storageKey:OSe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:kSe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function FH(e,t,r){return await r()}const Lx={};class hb{get jwks(){var t,r;return(r=(t=Lx[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){Lx[this.storageKey]=Object.assign(Object.assign({},Lx[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=Lx[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Lx[this.storageKey]=Object.assign(Object.assign({},Lx[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},AEe),t);if(this.storageKey=o.storageKey,this.instanceID=(r=hb.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,hb.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&wl()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Yte({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Xte(o.fetch),this.lock=o.lock||FH,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:wl()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=ere:this.lock=FH,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new TEe(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Zte()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=DH(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=DH(this.memoryStorage)),wl()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Ute}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(wl()&&(r=$Se(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),wl()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(r,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),Wte(o)){const m=(t=o.details)===null||t===void 0?void 0:t.code;if(m==="identity_already_exists"||m==="identity_not_found"||m==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:d,redirectType:i}=s;return this._debug("#_initialize()","detected session in URL",d,"redirect type",i),await this._saveSession(d),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return In(r)?this._returnResult({error:r}):this._returnResult({error:new km("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const o=await li(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.captchaToken}},xform:Ed}),{data:d,error:i}=o;if(i||!d)return this._returnResult({data:{user:null,session:null},error:i});const m=d.session,y=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",m)),this._returnResult({data:{user:y,session:m},error:null})}catch(o){if(In(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(t){var r,n,s;try{let o;if("email"in t){const{email:S,password:w,options:T}=t;let A=null,O=null;this.flowType==="pkce"&&([A,O]=await Mx(this.storage,this.storageKey)),o=await li(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:T==null?void 0:T.emailRedirectTo,body:{email:S,password:w,data:(r=T==null?void 0:T.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken},code_challenge:A,code_challenge_method:O},xform:Ed})}else if("phone"in t){const{phone:S,password:w,options:T}=t;o=await li(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:w,data:(n=T==null?void 0:T.data)!==null&&n!==void 0?n:{},channel:(s=T==null?void 0:T.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken}},xform:Ed})}else throw new dE("You must provide either an email or phone number and a password");const{data:d,error:i}=o;if(i||!d)return this._returnResult({data:{user:null,session:null},error:i});const m=d.session,y=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",m)),this._returnResult({data:{user:y,session:m},error:null})}catch(o){if(In(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(t){try{let r;if("email"in t){const{email:o,password:d,options:i}=t;r=await li(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:d,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:RH})}else if("phone"in t){const{phone:o,password:d,options:i}=t;r=await li(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:d,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:RH})}else throw new dE("You must provide either an email or phone number and a password");const{data:n,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const o=new zy;return this._returnResult({data:{user:null,session:null},error:o})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,s,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,o,d,i,m,y,S,w,T;let A,O;if("message"in t)A=t.message,O=t.signature;else{const{chain:P,wallet:N,statement:R,options:M}=t;let F;if(wl())if(typeof N=="object")F=N;else{const ne=window;if("ethereum"in ne&&typeof ne.ethereum=="object"&&"request"in ne.ethereum&&typeof ne.ethereum.request=="function")F=ne.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!(M!=null&&M.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");F=N}const B=new URL((r=M==null?void 0:M.url)!==null&&r!==void 0?r:window.location.href),$=await F.request({method:"eth_requestAccounts"}).then(ne=>ne).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const W=tre($[0]);let K=(n=M==null?void 0:M.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!K){const ne=await F.request({method:"eth_chainId"});K=lEe(ne)}const te={domain:B.host,address:W,statement:R,uri:B.href,version:"1",chainId:K,nonce:(s=M==null?void 0:M.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(d=(o=M==null?void 0:M.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(i=M==null?void 0:M.signInWithEthereum)===null||i===void 0?void 0:i.expirationTime,notBefore:(m=M==null?void 0:M.signInWithEthereum)===null||m===void 0?void 0:m.notBefore,requestId:(y=M==null?void 0:M.signInWithEthereum)===null||y===void 0?void 0:y.requestId,resources:(S=M==null?void 0:M.signInWithEthereum)===null||S===void 0?void 0:S.resources};A=uEe(te),O=await F.request({method:"personal_sign",params:[cEe(A),W]})}try{const{data:P,error:N}=await li(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:A,signature:O},!((w=t.options)===null||w===void 0)&&w.captchaToken?{gotrue_meta_security:{captcha_token:(T=t.options)===null||T===void 0?void 0:T.captchaToken}}:null),xform:Ed});if(N)throw N;if(!P||!P.session||!P.user){const R=new zy;return this._returnResult({data:{user:null,session:null},error:R})}return P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),this._returnResult({data:Object.assign({},P),error:N})}catch(P){if(In(P))return this._returnResult({data:{user:null,session:null},error:P});throw P}}async signInWithSolana(t){var r,n,s,o,d,i,m,y,S,w,T,A;let O,P;if("message"in t)O=t.message,P=t.signature;else{const{chain:N,wallet:R,statement:M,options:F}=t;let B;if(wl())if(typeof R=="object")B=R;else{const W=window;if("solana"in W&&typeof W.solana=="object"&&("signIn"in W.solana&&typeof W.solana.signIn=="function"||"signMessage"in W.solana&&typeof W.solana.signMessage=="function"))B=W.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof R!="object"||!(F!=null&&F.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");B=R}const $=new URL((r=F==null?void 0:F.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in B&&B.signIn){const W=await B.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},F==null?void 0:F.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),M?{statement:M}:null));let K;if(Array.isArray(W)&&W[0]&&typeof W[0]=="object")K=W[0];else if(W&&typeof W=="object"&&"signedMessage"in W&&"signature"in W)K=W;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in K&&"signature"in K&&(typeof K.signedMessage=="string"||K.signedMessage instanceof Uint8Array)&&K.signature instanceof Uint8Array)O=typeof K.signedMessage=="string"?K.signedMessage:new TextDecoder().decode(K.signedMessage),P=K.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in B)||typeof B.signMessage!="function"||!("publicKey"in B)||typeof B!="object"||!B.publicKey||!("toBase58"in B.publicKey)||typeof B.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");O=[`${$.host} wants you to sign in with your Solana account:`,B.publicKey.toBase58(),...M?["",M,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(s=(n=F==null?void 0:F.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=F==null?void 0:F.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${F.signInWithSolana.notBefore}`]:[],...!((d=F==null?void 0:F.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${F.signInWithSolana.expirationTime}`]:[],...!((i=F==null?void 0:F.signInWithSolana)===null||i===void 0)&&i.chainId?[`Chain ID: ${F.signInWithSolana.chainId}`]:[],...!((m=F==null?void 0:F.signInWithSolana)===null||m===void 0)&&m.nonce?[`Nonce: ${F.signInWithSolana.nonce}`]:[],...!((y=F==null?void 0:F.signInWithSolana)===null||y===void 0)&&y.requestId?[`Request ID: ${F.signInWithSolana.requestId}`]:[],...!((w=(S=F==null?void 0:F.signInWithSolana)===null||S===void 0?void 0:S.resources)===null||w===void 0)&&w.length?["Resources",...F.signInWithSolana.resources.map(K=>`- ${K}`)]:[]].join(`
`);const W=await B.signMessage(new TextEncoder().encode(O),"utf8");if(!W||!(W instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");P=W}}try{const{data:N,error:R}=await li(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:O,signature:Jy(P)},!((T=t.options)===null||T===void 0)&&T.captchaToken?{gotrue_meta_security:{captcha_token:(A=t.options)===null||A===void 0?void 0:A.captchaToken}}:null),xform:Ed});if(R)throw R;if(!N||!N.session||!N.user){const M=new zy;return this._returnResult({data:{user:null,session:null},error:M})}return N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),this._returnResult({data:Object.assign({},N),error:R})}catch(N){if(In(N))return this._returnResult({data:{user:null,session:null},error:N});throw N}}async _exchangeCodeForSession(t){const r=await Iy(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:o,error:d}=await li(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Ed});if(await mm(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!o||!o.session||!o.user){const i=new zy;return this._returnResult({data:{user:null,session:null,redirectType:null},error:i})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:d})}catch(o){if(In(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:o,nonce:d}=t,i=await li(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:d,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Ed}),{data:m,error:y}=i;if(y)return this._returnResult({data:{user:null,session:null},error:y});if(!m||!m.session||!m.user){const S=new zy;return this._returnResult({data:{user:null,session:null},error:S})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:m,error:y})}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,s,o,d;try{if("email"in t){const{email:i,options:m}=t;let y=null,S=null;this.flowType==="pkce"&&([y,S]=await Mx(this.storage,this.storageKey));const{error:w}=await li(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(r=m==null?void 0:m.data)!==null&&r!==void 0?r:{},create_user:(n=m==null?void 0:m.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:y,code_challenge_method:S},redirectTo:m==null?void 0:m.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:w})}if("phone"in t){const{phone:i,options:m}=t,{data:y,error:S}=await li(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(s=m==null?void 0:m.data)!==null&&s!==void 0?s:{},create_user:(o=m==null?void 0:m.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},channel:(d=m==null?void 0:m.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:y==null?void 0:y.message_id},error:S})}throw new dE("You must provide either an email or phone number.")}catch(i){if(In(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async verifyOtp(t){var r,n;try{let s,o;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:d,error:i}=await li(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:Ed});if(i)throw i;if(!d)throw new Error("An error occurred on token verification.");const m=d.session,y=d.user;return m!=null&&m.access_token&&(await this._saveSession(m),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",m)),this._returnResult({data:{user:y,session:m},error:null})}catch(s){if(In(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(t){var r,n,s,o,d;try{let i=null,m=null;this.flowType==="pkce"&&([i,m]=await Mx(this.storage,this.storageKey));const y=await li(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t==null?void 0:t.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:m}),headers:this.headers,xform:iEe});return!((o=y.data)===null||o===void 0)&&o.url&&wl()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(y.data.url),this._returnResult(y)}catch(i){if(In(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new Ic;const{error:s}=await li(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(t){if(In(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:o}=t,{error:d}=await li(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:n,type:s,options:o}=t,{data:d,error:i}=await li(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:i})}throw new dE("You must provide either an email or phone number and a type")}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Iy(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<RD:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const d=await Iy(this.userStorage,this.storageKey+"-user");d!=null&&d.user?t.user=d.user:t.user=DD()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=eEe(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await li(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Nm}):await this._useSession(async r=>{var n,s,o;const{data:d,error:i}=r;if(i)throw i;return!(!((n=d.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ic}:await li(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=d.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Nm})})}catch(r){if(In(r))return Gte(r)&&(await this._removeSession(),await mm(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new Ic;const d=s.session;let i=null,m=null;this.flowType==="pkce"&&t.email!=null&&([i,m]=await Mx(this.storage,this.storageKey));const{data:y,error:S}=await li(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:i,code_challenge_method:m}),jwt:d.access_token,xform:Nm});if(S)throw S;return d.user=y.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(n){if(In(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ic;const r=Date.now()/1e3;let n=r,s=!0,o=null;const{payload:d}=MD(t.access_token);if(d.exp&&(n=d.exp,s=n<=r),s){const{data:i,error:m}=await this._callRefreshToken(t.refresh_token);if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!i)return{data:{user:null,session:null},error:null};o=i}else{const{data:i,error:m}=await this._getUser(t.access_token);if(m)throw m;o={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(r){if(In(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:d,error:i}=r;if(i)throw i;t=(n=d.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new Ic;const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!wl())throw new hE("No browser detected.");if(t.error||t.error_description||t.error_code)throw new hE(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new mF("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new hE("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new mF("No code detected.");const{data:M,error:F}=await this._exchangeCodeForSession(t.code);if(F)throw F;const B=new URL(window.location.href);return B.searchParams.delete("code"),window.history.replaceState(window.history.state,"",B.toString()),{data:{session:M.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:d,expires_in:i,expires_at:m,token_type:y}=t;if(!o||!i||!d||!y)throw new hE("No session defined in URL");const S=Math.round(Date.now()/1e3),w=parseInt(i);let T=S+w;m&&(T=parseInt(m));const A=T-S;A*1e3<=Jx&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${A}s, should have been closer to ${w}s`);const O=T-w;S-O>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",O,T,S):S-O<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",O,T,S);const{data:P,error:N}=await this._getUser(o);if(N)throw N;const R={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:w,expires_at:T,refresh_token:d,token_type:y,user:P.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:R,redirectType:t.type},error:null})}catch(n){if(In(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Iy(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({error:o});const d=(n=s.session)===null||n===void 0?void 0:n.access_token;if(d){const{error:i}=await this.admin.signOut(d,t);if(i&&!(Hte(i)&&(i.status===404||i.status===401||i.status===403)))return this._returnResult({error:i})}return t!=="others"&&(await this._removeSession(),await mm(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=BSe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:o},error:d}=r;if(d)throw d;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Mx(this.storage,this.storageKey,!0));try{return await li(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(o){if(In(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async o=>{var d,i,m,y,S;const{data:w,error:T}=o;if(T)throw T;const A=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(m=t.options)===null||m===void 0?void 0:m.queryParams,skipBrowserRedirect:!0});return await li(this.fetch,"GET",A,{headers:this.headers,jwt:(S=(y=w.session)===null||y===void 0?void 0:y.access_token)!==null&&S!==void 0?S:void 0})});if(s)throw s;return wl()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(In(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:o}}=r;if(s)throw s;const{options:d,provider:i,token:m,access_token:y,nonce:S}=t,w=await li(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=o==null?void 0:o.access_token)!==null&&n!==void 0?n:void 0,body:{provider:i,id_token:m,access_token:y,nonce:S,link_identity:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:Ed}),{data:T,error:A}=w;return A?this._returnResult({data:{user:null,session:null},error:A}):!T||!T.session||!T.user?this._returnResult({data:{user:null,session:null},error:new zy}):(T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("USER_UPDATED",T.session)),this._returnResult({data:T,error:A}))}catch(s){if(In(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:d}=r;if(d)throw d;return await li(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await qSe(async s=>(s>0&&await VSe(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await li(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ed})),(s,o)=>{const d=200*Math.pow(2,s);return o&&iP(o)&&Date.now()+d-n<Jx})}catch(n){if(this._debug(r,"error",n),In(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),wl()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Iy(this.storage,this.storageKey);if(s&&this.userStorage){let d=await Iy(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:s.user},await Qx(this.userStorage,this.storageKey+"-user",d)),s.user=(t=d==null?void 0:d.user)!==null&&t!==void 0?t:DD()}else if(s&&!s.user&&!s.user){const d=await Iy(this.storage,this.storageKey+"-user");d&&(d!=null&&d.user)?(s.user=d.user,await mm(this.storage,this.storageKey+"-user"),await Qx(this.storage,this.storageKey,s)):s.user=DD()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<RD;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${RD}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:d}=await this._callRefreshToken(s.refresh_token);d&&(console.error(d),iP(d)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:i}=await this._getUser(s.access_token);!i&&(d!=null&&d.user)?(s.user=d.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(n,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new Ic;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new vN;const{data:o,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!o.session)throw new Ic;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const i={data:o.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(o){if(this._debug(s,"error",o),In(o)){const d={data:null,error:o};return iP(o)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(d),d}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const o=[],d=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,r)}catch(m){o.push(m)}});if(await Promise.all(d),o.length>0){for(let i=0;i<o.length;i+=1)console.error(o[i]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Qx(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const o=NH(s);await Qx(this.storage,this.storageKey,o)}else{const s=NH(r);await Qx(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await mm(this.storage,this.storageKey),await mm(this.storage,this.storageKey+"-code-verifier"),await mm(this.storage,this.storageKey+"-user"),this.userStorage&&await mm(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&wl()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Jx);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/Jx);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Jx}ms, refresh threshold is ${fF} ticks`),s<=fF&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Jte)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!wl()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,d]=await Mx(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(d)}`});s.push(i.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;return o?this._returnResult({data:null,error:o}):await li(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:d}=r;if(d)return this._returnResult({data:null,error:d});const i=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:m,error:y}=await li(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return y?this._returnResult({data:null,error:y}):(t.factorType==="totp"&&m.type==="totp"&&(!((s=m==null?void 0:m.totp)===null||s===void 0)&&s.qr_code)&&(m.totp.qr_code=`data:image/svg+xml;utf-8,${m.totp.qr_code}`),this._returnResult({data:m,error:null}))})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({data:null,error:o});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?yEe(t.webauthn.credential_response):vEe(t.webauthn.credential_response)})}:{code:t.code}),{data:i,error:m}=await li(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return m?this._returnResult({data:null,error:m}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:m}))})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({data:null,error:o});const d=await li(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(d.error)return d;const{data:i}=d;if(i.type!=="webauthn")return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:mEe(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:gEe(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const o of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])s.all.push(o),o.status==="verified"&&s[o.factor_type].push(o);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=MD(n.access_token);let d=null;o.aal&&(d=o.aal);let i=d;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(S=>S.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(i="aal2");const y=o.amr||[];return{data:{currentLevel:d,nextLevel:i,currentAuthenticationMethods:y},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await li(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Ic})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new Ic});const d=await li(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:i=>({data:i,error:null})});return d.data&&d.data.redirect_url&&wl()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(d.data.redirect_url),d})}catch(n){if(In(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new Ic});const d=await li(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:i=>({data:i,error:null})});return d.data&&d.data.redirect_url&&wl()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(d.data.redirect_url),d})}catch(n){if(In(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await li(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ic})})}catch(t){if(In(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await li(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new Ic})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(i=>i.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(i=>i.kid===t),n&&this.jwks_cached_at+ISe>s)return n;const{data:o,error:d}=await li(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(i=>i.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:A,error:O}=await this.getSession();if(O||!A.session)return this._returnResult({data:null,error:O});n=A.session.access_token}const{header:s,payload:o,signature:d,raw:{header:i,payload:m}}=MD(n);r!=null&&r.allowExpired||YSe(o.exp);const y=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!y){const{error:A}=await this.getUser(n);if(A)throw A;return{data:{claims:o,header:s,signature:d},error:null}}const S=JSe(s.alg),w=await crypto.subtle.importKey("jwk",y,S,!0,["verify"]);if(!await crypto.subtle.verify(S,w,d,FSe(`${i}.${m}`)))throw new rO("Invalid JWT signature");return{data:{claims:o,header:s,signature:d},error:null}}catch(n){if(In(n))return this._returnResult({data:null,error:n});throw n}}}hb.nextInstanceID={};const nre=hb;class CEe extends nre{constructor(t){super(t)}}class ire{constructor(t,r,n){var s,o,d;this.supabaseUrl=t,this.supabaseKey=r;const i=jSe(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const m=`sb-${i.hostname.split(".")[0]}-auth-token`,y={db:xSe,realtime:wSe,auth:Object.assign(Object.assign({},bSe),{storageKey:m}),global:_Se},S=CSe(n??{},y);this.storageKey=(s=S.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=S.global.headers)!==null&&o!==void 0?o:{},S.accessToken?(this.accessToken=S.accessToken,this.auth=new Proxy({},{get:(w,T)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(T)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((d=S.auth)!==null&&d!==void 0?d:{},this.headers,S.global.fetch),this.fetch=TSe(r,this._getAccessToken.bind(this),S.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},S.realtime)),this.accessToken&&this.accessToken().then(w=>this.realtime.setAuth(w)).catch(w=>console.warn("Failed to set initial Realtime auth token:",w)),this.rest=new O1e(new URL("rest/v1",i).href,{headers:this.headers,schema:S.db.schema,fetch:this.fetch}),this.storage=new gSe(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),S.accessToken||this._listenForAuthEvents()}get functions(){return new C1e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,r;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,storageKey:d,flowType:i,lock:m,debug:y,throwOnError:S},w,T){const A={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new CEe({url:this.authUrl.href,headers:Object.assign(Object.assign({},A),w),storageKey:d,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,flowType:i,lock:m,debug:y,throwOnError:S,fetch:T,hasCustomAuthorizationHeader:Object.keys(this.headers).some(O=>O.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Lte(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const sre=(e,t,r)=>new ire(e,t,r);function jEe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}jEe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const PEe=Object.freeze(Object.defineProperty({__proto__:null,AuthApiError:qte,AuthClient:nre,AuthError:db,AuthImplicitGrantRedirectError:hE,AuthInvalidCredentialsError:dE,AuthInvalidJwtError:rO,AuthInvalidTokenResponseError:zy,AuthPKCEGrantCodeExchangeError:mF,AuthRetryableFetchError:tO,AuthSessionMissingError:Ic,AuthUnknownError:km,AuthWeakPasswordError:gF,CustomAuthError:gp,get FunctionRegion(){return eO},FunctionsError:gN,FunctionsFetchError:pte,FunctionsHttpError:iF,FunctionsRelayError:nF,GoTrueAdminApi:Yte,GoTrueClient:hb,NavigatorLockAcquireTimeoutError:Qte,PostgrestError:k1e,get REALTIME_LISTEN_TYPES(){return I0},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return cF},get REALTIME_PRESENCE_LISTEN_EVENTS(){return lF},get REALTIME_SUBSCRIBE_STATES(){return _h},RealtimeChannel:yN,RealtimeClient:Lte,RealtimePresence:N0,SIGN_OUT_SCOPES:sP,SupabaseClient:ire,WebSocketFactory:Nte,createClient:sre,isAuthApiError:Hte,isAuthError:In,isAuthImplicitGrantRedirectError:Wte,isAuthRetryableFetchError:iP,isAuthSessionMissingError:Gte,lockInternals:$y,navigatorLock:ere},Symbol.toStringTag,{value:"Module"})),OEe="https://tzdgqhwyzsxkxnncgzap.supabase.co",kEe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",Ct=sre(OEe,kEe,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),are=V.createContext(void 0),NEe=({children:e})=>{const[t,r]=V.useState(null),[n,s]=V.useState(null),[o,d]=V.useState(!0),i=Ju();V.useEffect(()=>{const{data:{subscription:O}}=Ct.auth.onAuthStateChange((P,N)=>{s(N),r((N==null?void 0:N.user)??null),P==="SIGNED_IN"&&N&&i("/")});return Ct.auth.getSession().then(({data:{session:P}})=>{s(P),r((P==null?void 0:P.user)??null),d(!1)}),()=>O.unsubscribe()},[i]);const m=async(O,P,N,R)=>{const M=`${window.location.origin}/`,{error:F}=await Ct.auth.signUp({email:O,password:P,options:{emailRedirectTo:M,data:{display_name:N,phone:R||null}}});return{error:F}},y=async(O,P)=>{const{error:N}=await Ct.auth.signInWithPassword({email:O,password:P});return{error:N}},S=async()=>{const{error:O}=await Ct.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/`}});return{error:O}},w=async O=>{const{error:P}=await Ct.auth.signInWithOtp({phone:O,options:{channel:"sms"}});return{error:P}},T=async(O,P)=>{const{error:N}=await Ct.auth.verifyOtp({phone:O,token:P,type:"sms"});return{error:N}},A=async()=>{try{r(null),s(null),await Ct.auth.signOut()}catch{console.log("Sign out completed (session may have already expired)")}i("/auth")};return h.jsx(are.Provider,{value:{user:t,session:n,signUp:m,signIn:y,signInWithGoogle:S,signInWithPhone:w,verifyOTP:T,signOut:A,loading:o},children:e})},Qn=()=>{const e=V.useContext(are);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},fb=Zv("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Mt=V.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...s},o)=>{const d=n?Wv:"button";return h.jsx(d,{className:fr(fb({variant:t,size:r,className:e})),ref:o,...s})});Mt.displayName="Button";const aO="/assets/xiaoxiong-logo-v3-D4uDr23w.png";var LD="focusScope.autoFocusOnMount",FD="focusScope.autoFocusOnUnmount",zH={bubbles:!1,cancelable:!0},IEe="FocusScope",E2=V.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...d}=e,[i,m]=V.useState(null),y=no(s),S=no(o),w=V.useRef(null),T=$n(t,P=>m(P)),A=V.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;V.useEffect(()=>{if(n){let P=function(F){if(A.paused||!i)return;const B=F.target;i.contains(B)?w.current=B:vm(w.current,{select:!0})},N=function(F){if(A.paused||!i)return;const B=F.relatedTarget;B!==null&&(i.contains(B)||vm(w.current,{select:!0}))},R=function(F){if(document.activeElement===document.body)for(const $ of F)$.removedNodes.length>0&&vm(i)};document.addEventListener("focusin",P),document.addEventListener("focusout",N);const M=new MutationObserver(R);return i&&M.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",P),document.removeEventListener("focusout",N),M.disconnect()}}},[n,i,A.paused]),V.useEffect(()=>{if(i){$H.add(A);const P=document.activeElement;if(!i.contains(P)){const R=new CustomEvent(LD,zH);i.addEventListener(LD,y),i.dispatchEvent(R),R.defaultPrevented||(REe(zEe(ore(i)),{select:!0}),document.activeElement===P&&vm(i))}return()=>{i.removeEventListener(LD,y),setTimeout(()=>{const R=new CustomEvent(FD,zH);i.addEventListener(FD,S),i.dispatchEvent(R),R.defaultPrevented||vm(P??document.body,{select:!0}),i.removeEventListener(FD,S),$H.remove(A)},0)}}},[i,y,S,A]);const O=V.useCallback(P=>{if(!r&&!n||A.paused)return;const N=P.key==="Tab"&&!P.altKey&&!P.ctrlKey&&!P.metaKey,R=document.activeElement;if(N&&R){const M=P.currentTarget,[F,B]=MEe(M);F&&B?!P.shiftKey&&R===B?(P.preventDefault(),r&&vm(F,{select:!0})):P.shiftKey&&R===F&&(P.preventDefault(),r&&vm(B,{select:!0})):R===M&&P.preventDefault()}},[r,n,A.paused]);return h.jsx(on.div,{tabIndex:-1,...d,ref:T,onKeyDown:O})});E2.displayName=IEe;function REe(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(vm(n,{select:t}),document.activeElement!==r)return}function MEe(e){const t=ore(e),r=BH(t,e),n=BH(t.reverse(),e);return[r,n]}function ore(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function BH(e,t){for(const r of e)if(!DEe(r,{upTo:t}))return r}function DEe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function LEe(e){return e instanceof HTMLInputElement&&"select"in e}function vm(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&LEe(e)&&t&&e.select()}}var $H=FEe();function FEe(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=UH(e,t),e.unshift(t)},remove(t){var r;e=UH(e,t),(r=e[0])==null||r.resume()}}}function UH(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function zEe(e){return e.filter(t=>t.tagName!=="A")}var zD=0;function _N(){V.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??VH()),document.body.insertAdjacentElement("beforeend",e[1]??VH()),zD++,()=>{zD===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),zD--}},[])}function VH(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var aP="right-scroll-bar-position",oP="width-before-scroll-bar",BEe="with-scroll-bars-hidden",$Ee="--removed-body-scroll-bar-size";function BD(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function UEe(e,t){var r=V.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var s=r.value;s!==n&&(r.value=n,r.callback(n,s))}}}})[0];return r.callback=t,r.facade}var VEe=typeof window<"u"?V.useLayoutEffect:V.useEffect,qH=new WeakMap;function qEe(e,t){var r=UEe(null,function(n){return e.forEach(function(s){return BD(s,n)})});return VEe(function(){var n=qH.get(r);if(n){var s=new Set(n),o=new Set(e),d=r.current;s.forEach(function(i){o.has(i)||BD(i,null)}),o.forEach(function(i){s.has(i)||BD(i,d)})}qH.set(r,e)},[e]),r}function HEe(e){return e}function GEe(e,t){t===void 0&&(t=HEe);var r=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(o){var d=t(o,n);return r.push(d),function(){r=r.filter(function(i){return i!==d})}},assignSyncMedium:function(o){for(n=!0;r.length;){var d=r;r=[],d.forEach(o)}r={push:function(i){return o(i)},filter:function(){return r}}},assignMedium:function(o){n=!0;var d=[];if(r.length){var i=r;r=[],i.forEach(o),d=r}var m=function(){var S=d;d=[],S.forEach(o)},y=function(){return Promise.resolve().then(m)};y(),r={push:function(S){d.push(S),y()},filter:function(S){return d=d.filter(S),r}}}};return s}function WEe(e){e===void 0&&(e={});var t=GEe(null);return t.options=$u({async:!0,ssr:!1},e),t}var lre=function(e){var t=e.sideCar,r=Sg(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return V.createElement(n,$u({},r))};lre.isSideCarExport=!0;function KEe(e,t){return e.useMedium(t),lre}var cre=WEe(),$D=function(){},xN=V.forwardRef(function(e,t){var r=V.useRef(null),n=V.useState({onScrollCapture:$D,onWheelCapture:$D,onTouchMoveCapture:$D}),s=n[0],o=n[1],d=e.forwardProps,i=e.children,m=e.className,y=e.removeScrollBar,S=e.enabled,w=e.shards,T=e.sideCar,A=e.noRelative,O=e.noIsolation,P=e.inert,N=e.allowPinchZoom,R=e.as,M=R===void 0?"div":R,F=e.gapMode,B=Sg(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),$=T,W=qEe([r,t]),K=$u($u({},B),s);return V.createElement(V.Fragment,null,S&&V.createElement($,{sideCar:cre,removeScrollBar:y,shards:w,noRelative:A,noIsolation:O,inert:P,setCallbacks:o,allowPinchZoom:!!N,lockRef:r,gapMode:F}),d?V.cloneElement(V.Children.only(i),$u($u({},K),{ref:W})):V.createElement(M,$u({},K,{className:m,ref:W}),i))});xN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};xN.classNames={fullWidth:oP,zeroRight:aP};var ZEe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function XEe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=ZEe();return t&&e.setAttribute("nonce",t),e}function YEe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function JEe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var QEe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=XEe())&&(YEe(t,r),JEe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},eTe=function(){var e=QEe();return function(t,r){V.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},ure=function(){var e=eTe(),t=function(r){var n=r.styles,s=r.dynamic;return e(n,s),null};return t},tTe={left:0,top:0,right:0,gap:0},UD=function(e){return parseInt(e||"",10)||0},rTe=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[UD(r),UD(n),UD(s)]},nTe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return tTe;var t=rTe(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},iTe=ure(),M0="data-scroll-locked",sTe=function(e,t,r,n){var s=e.left,o=e.top,d=e.right,i=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(BEe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(i,"px ").concat(n,`;
  }
  body[`).concat(M0,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(d,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(i,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(aP,` {
    right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(oP,` {
    margin-right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(aP," .").concat(aP,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(oP," .").concat(oP,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(M0,`] {
    `).concat($Ee,": ").concat(i,`px;
  }
`)},HH=function(){var e=parseInt(document.body.getAttribute(M0)||"0",10);return isFinite(e)?e:0},aTe=function(){V.useEffect(function(){return document.body.setAttribute(M0,(HH()+1).toString()),function(){var e=HH()-1;e<=0?document.body.removeAttribute(M0):document.body.setAttribute(M0,e.toString())}},[])},oTe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,s=n===void 0?"margin":n;aTe();var o=V.useMemo(function(){return nTe(s)},[s]);return V.createElement(iTe,{styles:sTe(o,!t,s,r?"":"!important")})},yF=!1;if(typeof window<"u")try{var xj=Object.defineProperty({},"passive",{get:function(){return yF=!0,!0}});window.addEventListener("test",xj,xj),window.removeEventListener("test",xj,xj)}catch{yF=!1}var Fx=yF?{passive:!1}:!1,lTe=function(e){return e.tagName==="TEXTAREA"},dre=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!lTe(e)&&r[t]==="visible")},cTe=function(e){return dre(e,"overflowY")},uTe=function(e){return dre(e,"overflowX")},GH=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=hre(e,n);if(s){var o=fre(e,n),d=o[1],i=o[2];if(d>i)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},dTe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},hTe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},hre=function(e,t){return e==="v"?cTe(t):uTe(t)},fre=function(e,t){return e==="v"?dTe(t):hTe(t)},fTe=function(e,t){return e==="h"&&t==="rtl"?-1:1},pTe=function(e,t,r,n,s){var o=fTe(e,window.getComputedStyle(t).direction),d=o*n,i=r.target,m=t.contains(i),y=!1,S=d>0,w=0,T=0;do{if(!i)break;var A=fre(e,i),O=A[0],P=A[1],N=A[2],R=P-N-o*O;(O||R)&&hre(e,i)&&(w+=R,T+=O);var M=i.parentNode;i=M&&M.nodeType===Node.DOCUMENT_FRAGMENT_NODE?M.host:M}while(!m&&i!==document.body||m&&(t.contains(i)||t===i));return(S&&(Math.abs(w)<1||!s)||!S&&(Math.abs(T)<1||!s))&&(y=!0),y},bj=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},WH=function(e){return[e.deltaX,e.deltaY]},KH=function(e){return e&&"current"in e?e.current:e},mTe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},gTe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},yTe=0,zx=[];function vTe(e){var t=V.useRef([]),r=V.useRef([0,0]),n=V.useRef(),s=V.useState(yTe++)[0],o=V.useState(ure)[0],d=V.useRef(e);V.useEffect(function(){d.current=e},[e]),V.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var P=KB([e.lockRef.current],(e.shards||[]).map(KH),!0).filter(Boolean);return P.forEach(function(N){return N.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),P.forEach(function(N){return N.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var i=V.useCallback(function(P,N){if("touches"in P&&P.touches.length===2||P.type==="wheel"&&P.ctrlKey)return!d.current.allowPinchZoom;var R=bj(P),M=r.current,F="deltaX"in P?P.deltaX:M[0]-R[0],B="deltaY"in P?P.deltaY:M[1]-R[1],$,W=P.target,K=Math.abs(F)>Math.abs(B)?"h":"v";if("touches"in P&&K==="h"&&W.type==="range")return!1;var te=GH(K,W);if(!te)return!0;if(te?$=K:($=K==="v"?"h":"v",te=GH(K,W)),!te)return!1;if(!n.current&&"changedTouches"in P&&(F||B)&&(n.current=$),!$)return!0;var ne=n.current||$;return pTe(ne,N,P,ne==="h"?F:B,!0)},[]),m=V.useCallback(function(P){var N=P;if(!(!zx.length||zx[zx.length-1]!==o)){var R="deltaY"in N?WH(N):bj(N),M=t.current.filter(function($){return $.name===N.type&&($.target===N.target||N.target===$.shadowParent)&&mTe($.delta,R)})[0];if(M&&M.should){N.cancelable&&N.preventDefault();return}if(!M){var F=(d.current.shards||[]).map(KH).filter(Boolean).filter(function($){return $.contains(N.target)}),B=F.length>0?i(N,F[0]):!d.current.noIsolation;B&&N.cancelable&&N.preventDefault()}}},[]),y=V.useCallback(function(P,N,R,M){var F={name:P,delta:N,target:R,should:M,shadowParent:_Te(R)};t.current.push(F),setTimeout(function(){t.current=t.current.filter(function(B){return B!==F})},1)},[]),S=V.useCallback(function(P){r.current=bj(P),n.current=void 0},[]),w=V.useCallback(function(P){y(P.type,WH(P),P.target,i(P,e.lockRef.current))},[]),T=V.useCallback(function(P){y(P.type,bj(P),P.target,i(P,e.lockRef.current))},[]);V.useEffect(function(){return zx.push(o),e.setCallbacks({onScrollCapture:w,onWheelCapture:w,onTouchMoveCapture:T}),document.addEventListener("wheel",m,Fx),document.addEventListener("touchmove",m,Fx),document.addEventListener("touchstart",S,Fx),function(){zx=zx.filter(function(P){return P!==o}),document.removeEventListener("wheel",m,Fx),document.removeEventListener("touchmove",m,Fx),document.removeEventListener("touchstart",S,Fx)}},[]);var A=e.removeScrollBar,O=e.inert;return V.createElement(V.Fragment,null,O?V.createElement(o,{styles:gTe(s)}):null,A?V.createElement(oTe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function _Te(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const xTe=KEe(cre,vTe);var T2=V.forwardRef(function(e,t){return V.createElement(xN,$u({},e,{ref:t,sideCar:xTe}))});T2.classNames=xN.classNames;var bTe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Bx=new WeakMap,wj=new WeakMap,Sj={},VD=0,pre=function(e){return e&&(e.host||pre(e.parentNode))},wTe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=pre(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},STe=function(e,t,r,n){var s=wTe(t,Array.isArray(e)?e:[e]);Sj[r]||(Sj[r]=new WeakMap);var o=Sj[r],d=[],i=new Set,m=new Set(s),y=function(w){!w||i.has(w)||(i.add(w),y(w.parentNode))};s.forEach(y);var S=function(w){!w||m.has(w)||Array.prototype.forEach.call(w.children,function(T){if(i.has(T))S(T);else try{var A=T.getAttribute(n),O=A!==null&&A!=="false",P=(Bx.get(T)||0)+1,N=(o.get(T)||0)+1;Bx.set(T,P),o.set(T,N),d.push(T),P===1&&O&&wj.set(T,!0),N===1&&T.setAttribute(r,"true"),O||T.setAttribute(n,"true")}catch(R){console.error("aria-hidden: cannot operate on ",T,R)}})};return S(t),i.clear(),VD++,function(){d.forEach(function(w){var T=Bx.get(w)-1,A=o.get(w)-1;Bx.set(w,T),o.set(w,A),T||(wj.has(w)||w.removeAttribute(n),wj.delete(w)),A||w.removeAttribute(r)}),VD--,VD||(Bx=new WeakMap,Bx=new WeakMap,wj=new WeakMap,Sj={})}},bN=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),s=bTe(e);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live]"))),STe(n,s,r,"aria-hidden")):function(){return null}},wN="Dialog",[mre,gre]=Fo(wN),[ETe,Zd]=mre(wN),yre=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:d=!0}=e,i=V.useRef(null),m=V.useRef(null),[y,S]=Zc({prop:n,defaultProp:s??!1,onChange:o,caller:wN});return h.jsx(ETe,{scope:t,triggerRef:i,contentRef:m,contentId:yu(),titleId:yu(),descriptionId:yu(),open:y,onOpenChange:S,onOpenToggle:V.useCallback(()=>S(w=>!w),[S]),modal:d,children:r})};yre.displayName=wN;var vre="DialogTrigger",_re=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Zd(vre,r),o=$n(t,s.triggerRef);return h.jsx(on.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":n5(s.open),...n,ref:o,onClick:Ir(e.onClick,s.onOpenToggle)})});_re.displayName=vre;var t5="DialogPortal",[TTe,xre]=mre(t5,{forceMount:void 0}),bre=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:s}=e,o=Zd(t5,t);return h.jsx(TTe,{scope:t,forceMount:r,children:V.Children.map(n,d=>h.jsx(zo,{present:r||o.open,children:h.jsx(ew,{asChild:!0,container:s,children:d})}))})};bre.displayName=t5;var oO="DialogOverlay",wre=V.forwardRef((e,t)=>{const r=xre(oO,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Zd(oO,e.__scopeDialog);return o.modal?h.jsx(zo,{present:n||o.open,children:h.jsx(CTe,{...s,ref:t})}):null});wre.displayName=oO;var ATe=ug("DialogOverlay.RemoveScroll"),CTe=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Zd(oO,r);return h.jsx(T2,{as:ATe,allowPinchZoom:!0,shards:[s.contentRef],children:h.jsx(on.div,{"data-state":n5(s.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),jv="DialogContent",Sre=V.forwardRef((e,t)=>{const r=xre(jv,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Zd(jv,e.__scopeDialog);return h.jsx(zo,{present:n||o.open,children:o.modal?h.jsx(jTe,{...s,ref:t}):h.jsx(PTe,{...s,ref:t})})});Sre.displayName=jv;var jTe=V.forwardRef((e,t)=>{const r=Zd(jv,e.__scopeDialog),n=V.useRef(null),s=$n(t,r.contentRef,n);return V.useEffect(()=>{const o=n.current;if(o)return bN(o)},[]),h.jsx(Ere,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ir(e.onCloseAutoFocus,o=>{var d;o.preventDefault(),(d=r.triggerRef.current)==null||d.focus()}),onPointerDownOutside:Ir(e.onPointerDownOutside,o=>{const d=o.detail.originalEvent,i=d.button===0&&d.ctrlKey===!0;(d.button===2||i)&&o.preventDefault()}),onFocusOutside:Ir(e.onFocusOutside,o=>o.preventDefault())})}),PTe=V.forwardRef((e,t)=>{const r=Zd(jv,e.__scopeDialog),n=V.useRef(!1),s=V.useRef(!1);return h.jsx(Ere,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var d,i;(d=e.onCloseAutoFocus)==null||d.call(e,o),o.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{var m,y;(m=e.onInteractOutside)==null||m.call(e,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const d=o.target;((y=r.triggerRef.current)==null?void 0:y.contains(d))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),Ere=V.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,...d}=e,i=Zd(jv,r),m=V.useRef(null),y=$n(t,m);return _N(),h.jsxs(h.Fragment,{children:[h.jsx(E2,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:h.jsx(Kv,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":n5(i.open),...d,ref:y,onDismiss:()=>i.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(kTe,{titleId:i.titleId}),h.jsx(ITe,{contentRef:m,descriptionId:i.descriptionId})]})]})}),r5="DialogTitle",Tre=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Zd(r5,r);return h.jsx(on.h2,{id:s.titleId,...n,ref:t})});Tre.displayName=r5;var Are="DialogDescription",Cre=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Zd(Are,r);return h.jsx(on.p,{id:s.descriptionId,...n,ref:t})});Cre.displayName=Are;var jre="DialogClose",Pre=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Zd(jre,r);return h.jsx(on.button,{type:"button",...n,ref:t,onClick:Ir(e.onClick,()=>s.onOpenChange(!1))})});Pre.displayName=jre;function n5(e){return e?"open":"closed"}var Ore="DialogTitleWarning",[OTe,kre]=Sve(Ore,{contentName:jv,titleName:r5,docsSlug:"dialog"}),kTe=({titleId:e})=>{const t=kre(Ore),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return V.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},NTe="DialogDescriptionWarning",ITe=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${kre(NTe).contentName}}.`;return V.useEffect(()=>{var o;const s=(o=e.current)==null?void 0:o.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},i5=yre,s5=_re,a5=bre,A2=wre,C2=Sre,j2=Tre,P2=Cre,SN=Pre;const Nre=i5,RTe=s5,MTe=a5,Ire=V.forwardRef(({className:e,...t},r)=>h.jsx(A2,{className:fr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Ire.displayName=A2.displayName;const DTe=Zv("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),o5=V.forwardRef(({side:e="right",className:t,children:r,...n},s)=>h.jsxs(MTe,{children:[h.jsx(Ire,{}),h.jsxs(C2,{ref:s,className:fr(DTe({side:e}),t),...n,children:[r,h.jsxs(SN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[h.jsx(wu,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));o5.displayName=C2.displayName;const LTe=V.forwardRef(({className:e,...t},r)=>h.jsx(j2,{ref:r,className:fr("text-lg font-semibold text-foreground",e),...t}));LTe.displayName=j2.displayName;const FTe=V.forwardRef(({className:e,...t},r)=>h.jsx(P2,{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));FTe.displayName=P2.displayName;var Rre={exports:{}},Mre={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pb=V;function zTe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var BTe=typeof Object.is=="function"?Object.is:zTe,$Te=pb.useState,UTe=pb.useEffect,VTe=pb.useLayoutEffect,qTe=pb.useDebugValue;function HTe(e,t){var r=t(),n=$Te({inst:{value:r,getSnapshot:t}}),s=n[0].inst,o=n[1];return VTe(function(){s.value=r,s.getSnapshot=t,qD(s)&&o({inst:s})},[e,r,t]),UTe(function(){return qD(s)&&o({inst:s}),e(function(){qD(s)&&o({inst:s})})},[e]),qTe(r),r}function qD(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!BTe(e,r)}catch{return!0}}function GTe(e,t){return t()}var WTe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?GTe:HTe;Mre.useSyncExternalStore=pb.useSyncExternalStore!==void 0?pb.useSyncExternalStore:WTe;Rre.exports=Mre;var Dre=Rre.exports;function KTe(){return Dre.useSyncExternalStore(ZTe,()=>!0,()=>!1)}function ZTe(){return()=>{}}var l5="Avatar",[XTe,nst]=Fo(l5),[YTe,Lre]=XTe(l5),Fre=V.forwardRef((e,t)=>{const{__scopeAvatar:r,...n}=e,[s,o]=V.useState("idle");return h.jsx(YTe,{scope:r,imageLoadingStatus:s,onImageLoadingStatusChange:o,children:h.jsx(on.span,{...n,ref:t})})});Fre.displayName=l5;var zre="AvatarImage",Bre=V.forwardRef((e,t)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:s=()=>{},...o}=e,d=Lre(zre,r),i=JTe(n,o),m=no(y=>{s(y),d.onImageLoadingStatusChange(y)});return io(()=>{i!=="idle"&&m(i)},[i,m]),i==="loaded"?h.jsx(on.img,{...o,ref:t,src:n}):null});Bre.displayName=zre;var $re="AvatarFallback",Ure=V.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:n,...s}=e,o=Lre($re,r),[d,i]=V.useState(n===void 0);return V.useEffect(()=>{if(n!==void 0){const m=window.setTimeout(()=>i(!0),n);return()=>window.clearTimeout(m)}},[n]),d&&o.imageLoadingStatus!=="loaded"?h.jsx(on.span,{...s,ref:t}):null});Ure.displayName=$re;function ZH(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function JTe(e,{referrerPolicy:t,crossOrigin:r}){const n=KTe(),s=V.useRef(null),o=n?(s.current||(s.current=new window.Image),s.current):null,[d,i]=V.useState(()=>ZH(o,e));return io(()=>{i(ZH(o,e))},[o,e]),io(()=>{const m=w=>()=>{i(w)};if(!o)return;const y=m("loaded"),S=m("error");return o.addEventListener("load",y),o.addEventListener("error",S),t&&(o.referrerPolicy=t),typeof r=="string"&&(o.crossOrigin=r),()=>{o.removeEventListener("load",y),o.removeEventListener("error",S)}},[o,r,t]),d}var Vre=Fre,qre=Bre,Hre=Ure;const qh=V.forwardRef(({className:e,...t},r)=>h.jsx(Vre,{ref:r,className:fr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));qh.displayName=Vre.displayName;const Hh=V.forwardRef(({className:e,...t},r)=>h.jsx(qre,{ref:r,className:fr("aspect-square h-full w-full",e),...t}));Hh.displayName=qre.displayName;const Gh=V.forwardRef(({className:e,...t},r)=>h.jsx(Hre,{ref:r,className:fr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Gh.displayName=Hre.displayName;const bi=e=>typeof e=="string",$S=()=>{let e,t;const r=new Promise((n,s)=>{e=n,t=s});return r.resolve=e,r.reject=t,r},XH=e=>e==null?"":""+e,QTe=(e,t,r)=>{e.forEach(n=>{t[n]&&(r[n]=t[n])})},e2e=/###/g,YH=e=>e&&e.indexOf("###")>-1?e.replace(e2e,"."):e,JH=e=>!e||bi(e),kE=(e,t,r)=>{const n=bi(t)?t.split("."):t;let s=0;for(;s<n.length-1;){if(JH(e))return{};const o=YH(n[s]);!e[o]&&r&&(e[o]=new r),Object.prototype.hasOwnProperty.call(e,o)?e=e[o]:e={},++s}return JH(e)?{}:{obj:e,k:YH(n[s])}},QH=(e,t,r)=>{const{obj:n,k:s}=kE(e,t,Object);if(n!==void 0||t.length===1){n[s]=r;return}let o=t[t.length-1],d=t.slice(0,t.length-1),i=kE(e,d,Object);for(;i.obj===void 0&&d.length;)o=`${d[d.length-1]}.${o}`,d=d.slice(0,d.length-1),i=kE(e,d,Object),i!=null&&i.obj&&typeof i.obj[`${i.k}.${o}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${o}`]=r},t2e=(e,t,r,n)=>{const{obj:s,k:o}=kE(e,t,Object);s[o]=s[o]||[],s[o].push(r)},lO=(e,t)=>{const{obj:r,k:n}=kE(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,n))return r[n]},r2e=(e,t,r)=>{const n=lO(e,r);return n!==void 0?n:lO(t,r)},Gre=(e,t,r)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?bi(e[n])||e[n]instanceof String||bi(t[n])||t[n]instanceof String?r&&(e[n]=t[n]):Gre(e[n],t[n],r):e[n]=t[n]);return e},$x=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var n2e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const i2e=e=>bi(e)?e.replace(/[&<>"'\/]/g,t=>n2e[t]):e;class s2e{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const r=this.regExpMap.get(t);if(r!==void 0)return r;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const a2e=[" ",",","?","!",";"],o2e=new s2e(20),l2e=(e,t,r)=>{t=t||"",r=r||"";const n=a2e.filter(d=>t.indexOf(d)<0&&r.indexOf(d)<0);if(n.length===0)return!0;const s=o2e.getRegExp(`(${n.map(d=>d==="?"?"\\?":d).join("|")})`);let o=!s.test(e);if(!o){const d=e.indexOf(r);d>0&&!s.test(e.substring(0,d))&&(o=!0)}return o},vF=(e,t,r=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(r);let s=e;for(let o=0;o<n.length;){if(!s||typeof s!="object")return;let d,i="";for(let m=o;m<n.length;++m)if(m!==o&&(i+=r),i+=n[m],d=s[i],d!==void 0){if(["string","number","boolean"].indexOf(typeof d)>-1&&m<n.length-1)continue;o+=m-o+1;break}s=d}return s},mT=e=>e==null?void 0:e.replace("_","-"),c2e={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var r,n;(n=(r=console==null?void 0:console[e])==null?void 0:r.apply)==null||n.call(r,console,t)}};class cO{constructor(t,r={}){this.init(t,r)}init(t,r={}){this.prefix=r.prefix||"i18next:",this.logger=t||c2e,this.options=r,this.debug=r.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,r,n,s){return s&&!this.debug?null:(bi(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[r](t))}create(t){return new cO(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new cO(this.logger,t)}}var jh=new cO;let EN=class{constructor(){this.observers={}}on(t,r){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const s=this.observers[n].get(r)||0;this.observers[n].set(r,s+1)}),this}off(t,r){if(this.observers[t]){if(!r){delete this.observers[t];return}this.observers[t].delete(r)}}emit(t,...r){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([s,o])=>{for(let d=0;d<o;d++)s(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([s,o])=>{for(let d=0;d<o;d++)s.apply(s,[t,...r])})}};class eG extends EN{constructor(t,r={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const r=this.options.ns.indexOf(t);r>-1&&this.options.ns.splice(r,1)}getResource(t,r,n,s={}){var y,S;const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,d=s.ignoreJSONStructure!==void 0?s.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;t.indexOf(".")>-1?i=t.split("."):(i=[t,r],n&&(Array.isArray(n)?i.push(...n):bi(n)&&o?i.push(...n.split(o)):i.push(n)));const m=lO(this.data,i);return!m&&!r&&!n&&t.indexOf(".")>-1&&(t=i[0],r=i[1],n=i.slice(2).join(".")),m||!d||!bi(n)?m:vF((S=(y=this.data)==null?void 0:y[t])==null?void 0:S[r],n,o)}addResource(t,r,n,s,o={silent:!1}){const d=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let i=[t,r];n&&(i=i.concat(d?n.split(d):n)),t.indexOf(".")>-1&&(i=t.split("."),s=r,r=i[1]),this.addNamespaces(r),QH(this.data,i,s),o.silent||this.emit("added",t,r,n,s)}addResources(t,r,n,s={silent:!1}){for(const o in n)(bi(n[o])||Array.isArray(n[o]))&&this.addResource(t,r,o,n[o],{silent:!0});s.silent||this.emit("added",t,r,n)}addResourceBundle(t,r,n,s,o,d={silent:!1,skipCopy:!1}){let i=[t,r];t.indexOf(".")>-1&&(i=t.split("."),s=n,n=r,r=i[1]),this.addNamespaces(r);let m=lO(this.data,i)||{};d.skipCopy||(n=JSON.parse(JSON.stringify(n))),s?Gre(m,n,o):m={...m,...n},QH(this.data,i,m),d.silent||this.emit("added",t,r,n)}removeResourceBundle(t,r){this.hasResourceBundle(t,r)&&delete this.data[t][r],this.removeNamespaces(r),this.emit("removed",t,r)}hasResourceBundle(t,r){return this.getResource(t,r)!==void 0}getResourceBundle(t,r){return r||(r=this.options.defaultNS),this.getResource(t,r)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const r=this.getDataByLanguage(t);return!!(r&&Object.keys(r)||[]).find(s=>r[s]&&Object.keys(r[s]).length>0)}toJSON(){return this.data}}var Wre={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,s){return e.forEach(o=>{var d;t=((d=this.processors[o])==null?void 0:d.process(t,r,n,s))??t}),t}};const Kre=Symbol("i18next/PATH_KEY");function u2e(){const e=[],t=Object.create(null);let r;return t.get=(n,s)=>{var o;return(o=r==null?void 0:r.revoke)==null||o.call(r),s===Kre?e:(e.push(s),r=Proxy.revocable(n,t),r.proxy)},Proxy.revocable(Object.create(null),t).proxy}function _F(e,t){const{[Kre]:r}=e(u2e());return r.join((t==null?void 0:t.keySeparator)??".")}const tG={},HD=e=>!bi(e)&&typeof e!="boolean"&&typeof e!="number";class uO extends EN{constructor(t,r={}){super(),QTe(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=jh.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,r={interpolation:{}}){const n={...r};if(t==null)return!1;const s=this.resolve(t,n);if((s==null?void 0:s.res)===void 0)return!1;const o=HD(s.res);return!(n.returnObjects===!1&&o)}extractFromKey(t,r){let n=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const s=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let o=r.ns||this.options.defaultNS||[];const d=n&&t.indexOf(n)>-1,i=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!l2e(t,n,s);if(d&&!i){const m=t.match(this.interpolator.nestingRegexp);if(m&&m.length>0)return{key:t,namespaces:bi(o)?[o]:o};const y=t.split(n);(n!==s||n===s&&this.options.ns.indexOf(y[0])>-1)&&(o=y.shift()),t=y.join(s)}return{key:t,namespaces:bi(o)?[o]:o}}translate(t,r,n){let s=typeof r=="object"?{...r}:r;if(typeof s!="object"&&this.options.overloadTranslationOptionHandler&&(s=this.options.overloadTranslationOptionHandler(arguments)),typeof s=="object"&&(s={...s}),s||(s={}),t==null)return"";typeof t=="function"&&(t=_F(t,{...this.options,...s})),Array.isArray(t)||(t=[String(t)]);const o=s.returnDetails!==void 0?s.returnDetails:this.options.returnDetails,d=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,{key:i,namespaces:m}=this.extractFromKey(t[t.length-1],s),y=m[m.length-1];let S=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;S===void 0&&(S=":");const w=s.lng||this.language,T=s.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((w==null?void 0:w.toLowerCase())==="cimode")return T?o?{res:`${y}${S}${i}`,usedKey:i,exactUsedKey:i,usedLng:w,usedNS:y,usedParams:this.getUsedParamsDetails(s)}:`${y}${S}${i}`:o?{res:i,usedKey:i,exactUsedKey:i,usedLng:w,usedNS:y,usedParams:this.getUsedParamsDetails(s)}:i;const A=this.resolve(t,s);let O=A==null?void 0:A.res;const P=(A==null?void 0:A.usedKey)||i,N=(A==null?void 0:A.exactUsedKey)||i,R=["[object Number]","[object Function]","[object RegExp]"],M=s.joinArrays!==void 0?s.joinArrays:this.options.joinArrays,F=!this.i18nFormat||this.i18nFormat.handleAsObject,B=s.count!==void 0&&!bi(s.count),$=uO.hasDefaultValue(s),W=B?this.pluralResolver.getSuffix(w,s.count,s):"",K=s.ordinal&&B?this.pluralResolver.getSuffix(w,s.count,{ordinal:!1}):"",te=B&&!s.ordinal&&s.count===0,ne=te&&s[`defaultValue${this.options.pluralSeparator}zero`]||s[`defaultValue${W}`]||s[`defaultValue${K}`]||s.defaultValue;let ae=O;F&&!O&&$&&(ae=ne);const re=HD(ae),ee=Object.prototype.toString.apply(ae);if(F&&ae&&re&&R.indexOf(ee)<0&&!(bi(M)&&Array.isArray(ae))){if(!s.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const ie=this.options.returnedObjectHandler?this.options.returnedObjectHandler(P,ae,{...s,ns:m}):`key '${i} (${this.language})' returned an object instead of string.`;return o?(A.res=ie,A.usedParams=this.getUsedParamsDetails(s),A):ie}if(d){const ie=Array.isArray(ae),de=ie?[]:{},be=ie?N:P;for(const Se in ae)if(Object.prototype.hasOwnProperty.call(ae,Se)){const Ae=`${be}${d}${Se}`;$&&!O?de[Se]=this.translate(Ae,{...s,defaultValue:HD(ne)?ne[Se]:void 0,joinArrays:!1,ns:m}):de[Se]=this.translate(Ae,{...s,joinArrays:!1,ns:m}),de[Se]===Ae&&(de[Se]=ae[Se])}O=de}}else if(F&&bi(M)&&Array.isArray(O))O=O.join(M),O&&(O=this.extendTranslation(O,t,s,n));else{let ie=!1,de=!1;!this.isValidLookup(O)&&$&&(ie=!0,O=ne),this.isValidLookup(O)||(de=!0,O=i);const Se=(s.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&de?void 0:O,Ae=$&&ne!==O&&this.options.updateMissing;if(de||ie||Ae){if(this.logger.log(Ae?"updateKey":"missingKey",w,y,i,Ae?ne:O),d){const ge=this.resolve(i,{...s,keySeparator:!1});ge&&ge.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let xe=[];const me=this.languageUtils.getFallbackCodes(this.options.fallbackLng,s.lng||this.language);if(this.options.saveMissingTo==="fallback"&&me&&me[0])for(let ge=0;ge<me.length;ge++)xe.push(me[ge]);else this.options.saveMissingTo==="all"?xe=this.languageUtils.toResolveHierarchy(s.lng||this.language):xe.push(s.lng||this.language);const Ce=(ge,pe,Oe)=>{var We;const Xe=$&&Oe!==O?Oe:Se;this.options.missingKeyHandler?this.options.missingKeyHandler(ge,y,pe,Xe,Ae,s):(We=this.backendConnector)!=null&&We.saveMissing&&this.backendConnector.saveMissing(ge,y,pe,Xe,Ae,s),this.emit("missingKey",ge,y,pe,O)};this.options.saveMissing&&(this.options.saveMissingPlurals&&B?xe.forEach(ge=>{const pe=this.pluralResolver.getSuffixes(ge,s);te&&s[`defaultValue${this.options.pluralSeparator}zero`]&&pe.indexOf(`${this.options.pluralSeparator}zero`)<0&&pe.push(`${this.options.pluralSeparator}zero`),pe.forEach(Oe=>{Ce([ge],i+Oe,s[`defaultValue${Oe}`]||ne)})}):Ce(xe,i,ne))}O=this.extendTranslation(O,t,s,A,n),de&&O===i&&this.options.appendNamespaceToMissingKey&&(O=`${y}${S}${i}`),(de||ie)&&this.options.parseMissingKeyHandler&&(O=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${y}${S}${i}`:i,ie?O:void 0,s))}return o?(A.res=O,A.usedParams=this.getUsedParamsDetails(s),A):O}extendTranslation(t,r,n,s,o){var m,y;if((m=this.i18nFormat)!=null&&m.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||s.usedLng,s.usedNS,s.usedKey,{resolved:s});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const S=bi(t)&&(((y=n==null?void 0:n.interpolation)==null?void 0:y.skipOnVariables)!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let w;if(S){const A=t.match(this.interpolator.nestingRegexp);w=A&&A.length}let T=n.replace&&!bi(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(T={...this.options.interpolation.defaultVariables,...T}),t=this.interpolator.interpolate(t,T,n.lng||this.language||s.usedLng,n),S){const A=t.match(this.interpolator.nestingRegexp),O=A&&A.length;w<O&&(n.nest=!1)}!n.lng&&s&&s.res&&(n.lng=this.language||s.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,(...A)=>(o==null?void 0:o[0])===A[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${A[0]} in key: ${r[0]}`),null):this.translate(...A,r),n)),n.interpolation&&this.interpolator.reset()}const d=n.postProcess||this.options.postProcess,i=bi(d)?[d]:d;return t!=null&&(i!=null&&i.length)&&n.applyPostProcessor!==!1&&(t=Wre.handle(i,t,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...s,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t,r={}){let n,s,o,d,i;return bi(t)&&(t=[t]),t.forEach(m=>{if(this.isValidLookup(n))return;const y=this.extractFromKey(m,r),S=y.key;s=S;let w=y.namespaces;this.options.fallbackNS&&(w=w.concat(this.options.fallbackNS));const T=r.count!==void 0&&!bi(r.count),A=T&&!r.ordinal&&r.count===0,O=r.context!==void 0&&(bi(r.context)||typeof r.context=="number")&&r.context!=="",P=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);w.forEach(N=>{var R,M;this.isValidLookup(n)||(i=N,!tG[`${P[0]}-${N}`]&&((R=this.utils)!=null&&R.hasLoadedNamespace)&&!((M=this.utils)!=null&&M.hasLoadedNamespace(i))&&(tG[`${P[0]}-${N}`]=!0,this.logger.warn(`key "${s}" for languages "${P.join(", ")}" won't get resolved as namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),P.forEach(F=>{var W;if(this.isValidLookup(n))return;d=F;const B=[S];if((W=this.i18nFormat)!=null&&W.addLookupKeys)this.i18nFormat.addLookupKeys(B,S,F,N,r);else{let K;T&&(K=this.pluralResolver.getSuffix(F,r.count,r));const te=`${this.options.pluralSeparator}zero`,ne=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(T&&(r.ordinal&&K.indexOf(ne)===0&&B.push(S+K.replace(ne,this.options.pluralSeparator)),B.push(S+K),A&&B.push(S+te)),O){const ae=`${S}${this.options.contextSeparator||"_"}${r.context}`;B.push(ae),T&&(r.ordinal&&K.indexOf(ne)===0&&B.push(ae+K.replace(ne,this.options.pluralSeparator)),B.push(ae+K),A&&B.push(ae+te))}}let $;for(;$=B.pop();)this.isValidLookup(n)||(o=$,n=this.getResource(F,N,$,r))}))})}),{res:n,usedKey:s,exactUsedKey:o,usedLng:d,usedNS:i}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,r,n,s={}){var o;return(o=this.i18nFormat)!=null&&o.getResource?this.i18nFormat.getResource(t,r,n,s):this.resourceStore.getResource(t,r,n,s)}getUsedParamsDetails(t={}){const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!bi(t.replace);let s=n?t.replace:t;if(n&&typeof t.count<"u"&&(s.count=t.count),this.options.interpolation.defaultVariables&&(s={...this.options.interpolation.defaultVariables,...s}),!n){s={...s};for(const o of r)delete s[o]}return s}static hasDefaultValue(t){const r="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r===n.substring(0,r.length)&&t[n]!==void 0)return!0;return!1}}class rG{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=jh.create("languageUtils")}getScriptPartFromCode(t){if(t=mT(t),!t||t.indexOf("-")<0)return null;const r=t.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(t){if(t=mT(t),!t||t.indexOf("-")<0)return t;const r=t.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(t){if(bi(t)&&t.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(t)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let r;return t.forEach(n=>{if(r)return;const s=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(s))&&(r=s)}),!r&&this.options.supportedLngs&&t.forEach(n=>{if(r)return;const s=this.getScriptPartFromCode(n);if(this.isSupportedCode(s))return r=s;const o=this.getLanguagePartFromCode(n);if(this.isSupportedCode(o))return r=o;r=this.options.supportedLngs.find(d=>{if(d===o)return d;if(!(d.indexOf("-")<0&&o.indexOf("-")<0)&&(d.indexOf("-")>0&&o.indexOf("-")<0&&d.substring(0,d.indexOf("-"))===o||d.indexOf(o)===0&&o.length>1))return d})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(t,r){if(!t)return[];if(typeof t=="function"&&(t=t(r)),bi(t)&&(t=[t]),Array.isArray(t))return t;if(!r)return t.default||[];let n=t[r];return n||(n=t[this.getScriptPartFromCode(r)]),n||(n=t[this.formatLanguageCode(r)]),n||(n=t[this.getLanguagePartFromCode(r)]),n||(n=t.default),n||[]}toResolveHierarchy(t,r){const n=this.getFallbackCodes((r===!1?[]:r)||this.options.fallbackLng||[],t),s=[],o=d=>{d&&(this.isSupportedCode(d)?s.push(d):this.logger.warn(`rejecting language code not found in supportedLngs: ${d}`))};return bi(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(t))):bi(t)&&o(this.formatLanguageCode(t)),n.forEach(d=>{s.indexOf(d)<0&&o(this.formatLanguageCode(d))}),s}}const nG={zero:0,one:1,two:2,few:3,many:4,other:5},iG={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class d2e{constructor(t,r={}){this.languageUtils=t,this.options=r,this.logger=jh.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,r){this.rules[t]=r}clearCache(){this.pluralRulesCache={}}getRule(t,r={}){const n=mT(t==="dev"?"en":t),s=r.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:n,type:s});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let d;try{d=new Intl.PluralRules(n,{type:s})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),iG;if(!t.match(/-|_/))return iG;const m=this.languageUtils.getLanguagePartFromCode(t);d=this.getRule(m,r)}return this.pluralRulesCache[o]=d,d}needsPlural(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),(n==null?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,r,n={}){return this.getSuffixes(t,n).map(s=>`${r}${s}`)}getSuffixes(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),n?n.resolvedOptions().pluralCategories.sort((s,o)=>nG[s]-nG[o]).map(s=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${s}`):[]}getSuffix(t,r,n={}){const s=this.getRule(t,n);return s?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${s.select(r)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",r,n))}}const sG=(e,t,r,n=".",s=!0)=>{let o=r2e(e,t,r);return!o&&s&&bi(r)&&(o=vF(e,r,n),o===void 0&&(o=vF(t,r,n))),o},GD=e=>e.replace(/\$/g,"$$$$");class h2e{constructor(t={}){var r;this.logger=jh.create("interpolator"),this.options=t,this.format=((r=t==null?void 0:t.interpolation)==null?void 0:r.format)||(n=>n),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:r,escapeValue:n,useRawValueToEscape:s,prefix:o,prefixEscaped:d,suffix:i,suffixEscaped:m,formatSeparator:y,unescapeSuffix:S,unescapePrefix:w,nestingPrefix:T,nestingPrefixEscaped:A,nestingSuffix:O,nestingSuffixEscaped:P,nestingOptionsSeparator:N,maxReplaces:R,alwaysFormat:M}=t.interpolation;this.escape=r!==void 0?r:i2e,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=s!==void 0?s:!1,this.prefix=o?$x(o):d||"{{",this.suffix=i?$x(i):m||"}}",this.formatSeparator=y||",",this.unescapePrefix=S?"":w||"-",this.unescapeSuffix=this.unescapePrefix?"":S||"",this.nestingPrefix=T?$x(T):A||$x("$t("),this.nestingSuffix=O?$x(O):P||$x(")"),this.nestingOptionsSeparator=N||",",this.maxReplaces=R||1e3,this.alwaysFormat=M!==void 0?M:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(r,n)=>(r==null?void 0:r.source)===n?(r.lastIndex=0,r):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,r,n,s){var A;let o,d,i;const m=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},y=O=>{if(O.indexOf(this.formatSeparator)<0){const M=sG(r,m,O,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(M,void 0,n,{...s,...r,interpolationkey:O}):M}const P=O.split(this.formatSeparator),N=P.shift().trim(),R=P.join(this.formatSeparator).trim();return this.format(sG(r,m,N,this.options.keySeparator,this.options.ignoreJSONStructure),R,n,{...s,...r,interpolationkey:N})};this.resetRegExp();const S=(s==null?void 0:s.missingInterpolationHandler)||this.options.missingInterpolationHandler,w=((A=s==null?void 0:s.interpolation)==null?void 0:A.skipOnVariables)!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:O=>GD(O)},{regex:this.regexp,safeValue:O=>this.escapeValue?GD(this.escape(O)):GD(O)}].forEach(O=>{for(i=0;o=O.regex.exec(t);){const P=o[1].trim();if(d=y(P),d===void 0)if(typeof S=="function"){const R=S(t,o,s);d=bi(R)?R:""}else if(s&&Object.prototype.hasOwnProperty.call(s,P))d="";else if(w){d=o[0];continue}else this.logger.warn(`missed to pass in variable ${P} for interpolating ${t}`),d="";else!bi(d)&&!this.useRawValueToEscape&&(d=XH(d));const N=O.safeValue(d);if(t=t.replace(o[0],N),w?(O.regex.lastIndex+=d.length,O.regex.lastIndex-=o[0].length):O.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),t}nest(t,r,n={}){let s,o,d;const i=(m,y)=>{const S=this.nestingOptionsSeparator;if(m.indexOf(S)<0)return m;const w=m.split(new RegExp(`${S}[ ]*{`));let T=`{${w[1]}`;m=w[0],T=this.interpolate(T,d);const A=T.match(/'/g),O=T.match(/"/g);(((A==null?void 0:A.length)??0)%2===0&&!O||O.length%2!==0)&&(T=T.replace(/'/g,'"'));try{d=JSON.parse(T),y&&(d={...y,...d})}catch(P){return this.logger.warn(`failed parsing options string in nesting for key ${m}`,P),`${m}${S}${T}`}return d.defaultValue&&d.defaultValue.indexOf(this.prefix)>-1&&delete d.defaultValue,m};for(;s=this.nestingRegexp.exec(t);){let m=[];d={...n},d=d.replace&&!bi(d.replace)?d.replace:d,d.applyPostProcessor=!1,delete d.defaultValue;const y=/{.*}/.test(s[1])?s[1].lastIndexOf("}")+1:s[1].indexOf(this.formatSeparator);if(y!==-1&&(m=s[1].slice(y).split(this.formatSeparator).map(S=>S.trim()).filter(Boolean),s[1]=s[1].slice(0,y)),o=r(i.call(this,s[1].trim(),d),d),o&&s[0]===t&&!bi(o))return o;bi(o)||(o=XH(o)),o||(this.logger.warn(`missed to resolve ${s[1]} for nesting ${t}`),o=""),m.length&&(o=m.reduce((S,w)=>this.format(S,w,n.lng,{...n,interpolationkey:s[1].trim()}),o.trim())),t=t.replace(s[0],o),this.regexp.lastIndex=0}return t}}const f2e=e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const s=n[1].substring(0,n[1].length-1);t==="currency"&&s.indexOf(":")<0?r.currency||(r.currency=s.trim()):t==="relativetime"&&s.indexOf(":")<0?r.range||(r.range=s.trim()):s.split(";").forEach(d=>{if(d){const[i,...m]=d.split(":"),y=m.join(":").trim().replace(/^'+|'+$/g,""),S=i.trim();r[S]||(r[S]=y),y==="false"&&(r[S]=!1),y==="true"&&(r[S]=!0),isNaN(y)||(r[S]=parseInt(y,10))}})}return{formatName:t,formatOptions:r}},aG=e=>{const t={};return(r,n,s)=>{let o=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(o={...o,[s.interpolationkey]:void 0});const d=n+JSON.stringify(o);let i=t[d];return i||(i=e(mT(n),s),t[d]=i),i(r)}},p2e=e=>(t,r,n)=>e(mT(r),n)(t);class m2e{constructor(t={}){this.logger=jh.create("formatter"),this.options=t,this.init(t)}init(t,r={interpolation:{}}){this.formatSeparator=r.interpolation.formatSeparator||",";const n=r.cacheInBuiltFormats?aG:p2e;this.formats={number:n((s,o)=>{const d=new Intl.NumberFormat(s,{...o});return i=>d.format(i)}),currency:n((s,o)=>{const d=new Intl.NumberFormat(s,{...o,style:"currency"});return i=>d.format(i)}),datetime:n((s,o)=>{const d=new Intl.DateTimeFormat(s,{...o});return i=>d.format(i)}),relativetime:n((s,o)=>{const d=new Intl.RelativeTimeFormat(s,{...o});return i=>d.format(i,o.range||"day")}),list:n((s,o)=>{const d=new Intl.ListFormat(s,{...o});return i=>d.format(i)})}}add(t,r){this.formats[t.toLowerCase().trim()]=r}addCached(t,r){this.formats[t.toLowerCase().trim()]=aG(r)}format(t,r,n,s={}){const o=r.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(i=>i.indexOf(")")>-1)){const i=o.findIndex(m=>m.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,i)].join(this.formatSeparator)}return o.reduce((i,m)=>{var w;const{formatName:y,formatOptions:S}=f2e(m);if(this.formats[y]){let T=i;try{const A=((w=s==null?void 0:s.formatParams)==null?void 0:w[s.interpolationkey])||{},O=A.locale||A.lng||s.locale||s.lng||n;T=this.formats[y](i,O,{...S,...s,...A})}catch(A){this.logger.warn(A)}return T}else this.logger.warn(`there was no format function for ${y}`);return i},t)}}const g2e=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class y2e extends EN{constructor(t,r,n,s={}){var o,d;super(),this.backend=t,this.store=r,this.services=n,this.languageUtils=n.languageUtils,this.options=s,this.logger=jh.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=s.maxParallelReads||10,this.readingCalls=0,this.maxRetries=s.maxRetries>=0?s.maxRetries:5,this.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,this.state={},this.queue=[],(d=(o=this.backend)==null?void 0:o.init)==null||d.call(o,n,s.backend,s)}queueLoad(t,r,n,s){const o={},d={},i={},m={};return t.forEach(y=>{let S=!0;r.forEach(w=>{const T=`${y}|${w}`;!n.reload&&this.store.hasResourceBundle(y,w)?this.state[T]=2:this.state[T]<0||(this.state[T]===1?d[T]===void 0&&(d[T]=!0):(this.state[T]=1,S=!1,d[T]===void 0&&(d[T]=!0),o[T]===void 0&&(o[T]=!0),m[w]===void 0&&(m[w]=!0)))}),S||(i[y]=!0)}),(Object.keys(o).length||Object.keys(d).length)&&this.queue.push({pending:d,pendingCount:Object.keys(d).length,loaded:{},errors:[],callback:s}),{toLoad:Object.keys(o),pending:Object.keys(d),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(m)}}loaded(t,r,n){const s=t.split("|"),o=s[0],d=s[1];r&&this.emit("failedLoading",o,d,r),!r&&n&&this.store.addResourceBundle(o,d,n,void 0,void 0,{skipCopy:!0}),this.state[t]=r?-1:2,r&&n&&(this.state[t]=0);const i={};this.queue.forEach(m=>{t2e(m.loaded,[o],d),g2e(m,t),r&&m.errors.push(r),m.pendingCount===0&&!m.done&&(Object.keys(m.loaded).forEach(y=>{i[y]||(i[y]={});const S=m.loaded[y];S.length&&S.forEach(w=>{i[y][w]===void 0&&(i[y][w]=!0)})}),m.done=!0,m.errors.length?m.callback(m.errors):m.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(m=>!m.done)}read(t,r,n,s=0,o=this.retryTimeout,d){if(!t.length)return d(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:r,fcName:n,tried:s,wait:o,callback:d});return}this.readingCalls++;const i=(y,S)=>{if(this.readingCalls--,this.waitingReads.length>0){const w=this.waitingReads.shift();this.read(w.lng,w.ns,w.fcName,w.tried,w.wait,w.callback)}if(y&&S&&s<this.maxRetries){setTimeout(()=>{this.read.call(this,t,r,n,s+1,o*2,d)},o);return}d(y,S)},m=this.backend[n].bind(this.backend);if(m.length===2){try{const y=m(t,r);y&&typeof y.then=="function"?y.then(S=>i(null,S)).catch(i):i(null,y)}catch(y){i(y)}return}return m(t,r,i)}prepareLoading(t,r,n={},s){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();bi(t)&&(t=this.languageUtils.toResolveHierarchy(t)),bi(r)&&(r=[r]);const o=this.queueLoad(t,r,n,s);if(!o.toLoad.length)return o.pending.length||s(),null;o.toLoad.forEach(d=>{this.loadOne(d)})}load(t,r,n){this.prepareLoading(t,r,{},n)}reload(t,r,n){this.prepareLoading(t,r,{reload:!0},n)}loadOne(t,r=""){const n=t.split("|"),s=n[0],o=n[1];this.read(s,o,"read",void 0,void 0,(d,i)=>{d&&this.logger.warn(`${r}loading namespace ${o} for language ${s} failed`,d),!d&&i&&this.logger.log(`${r}loaded namespace ${o} for language ${s}`,i),this.loaded(t,d,i)})}saveMissing(t,r,n,s,o,d={},i=()=>{}){var m,y,S,w,T;if((y=(m=this.services)==null?void 0:m.utils)!=null&&y.hasLoadedNamespace&&!((w=(S=this.services)==null?void 0:S.utils)!=null&&w.hasLoadedNamespace(r))){this.logger.warn(`did not save key "${n}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if((T=this.backend)!=null&&T.create){const A={...d,isUpdate:o},O=this.backend.create.bind(this.backend);if(O.length<6)try{let P;O.length===5?P=O(t,r,n,s,A):P=O(t,r,n,s),P&&typeof P.then=="function"?P.then(N=>i(null,N)).catch(i):i(null,P)}catch(P){i(P)}else O(t,r,n,s,i,A)}!t||!t[0]||this.store.addResource(t[0],r,n,s)}}}const oG=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),bi(e[1])&&(t.defaultValue=e[1]),bi(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const r=e[3]||e[2];Object.keys(r).forEach(n=>{t[n]=r[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),lG=e=>{var t,r;return bi(e.ns)&&(e.ns=[e.ns]),bi(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),bi(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((r=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:r.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},Ej=()=>{},v2e=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(r=>{typeof e[r]=="function"&&(e[r]=e[r].bind(e))})};class NE extends EN{constructor(t={},r){if(super(),this.options=lG(t),this.services={},this.logger=jh,this.modules={external:[]},v2e(this),r&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,r),this;setTimeout(()=>{this.init(t,r)},0)}}init(t={},r){this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),t.defaultNS==null&&t.ns&&(bi(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=oG();this.options={...n,...this.options,...lG(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=y=>y?typeof y=="function"?new y:y:null;if(!this.options.isClone){this.modules.logger?jh.init(s(this.modules.logger),this.options):jh.init(null,this.options);let y;this.modules.formatter?y=this.modules.formatter:y=m2e;const S=new rG(this.options);this.store=new eG(this.options.resources,this.options);const w=this.services;w.logger=jh,w.resourceStore=this.store,w.languageUtils=S,w.pluralResolver=new d2e(S,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),y&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(w.formatter=s(y),w.formatter.init&&w.formatter.init(w,this.options),this.options.interpolation.format=w.formatter.format.bind(w.formatter)),w.interpolator=new h2e(this.options),w.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},w.backendConnector=new y2e(s(this.modules.backend),w.resourceStore,w,this.options),w.backendConnector.on("*",(A,...O)=>{this.emit(A,...O)}),this.modules.languageDetector&&(w.languageDetector=s(this.modules.languageDetector),w.languageDetector.init&&w.languageDetector.init(w,this.options.detection,this.options)),this.modules.i18nFormat&&(w.i18nFormat=s(this.modules.i18nFormat),w.i18nFormat.init&&w.i18nFormat.init(this)),this.translator=new uO(this.services,this.options),this.translator.on("*",(A,...O)=>{this.emit(A,...O)}),this.modules.external.forEach(A=>{A.init&&A.init(this)})}if(this.format=this.options.interpolation.format,r||(r=Ej),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const y=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);y.length>0&&y[0]!=="dev"&&(this.options.lng=y[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(y=>{this[y]=(...S)=>this.store[y](...S)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(y=>{this[y]=(...S)=>(this.store[y](...S),this)});const i=$S(),m=()=>{const y=(S,w)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve(w),r(S,w)};if(this.languages&&!this.isInitialized)return y(null,this.t.bind(this));this.changeLanguage(this.options.lng,y)};return this.options.resources||!this.options.initAsync?m():setTimeout(m,0),i}loadResources(t,r=Ej){var o,d;let n=r;const s=bi(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if((s==null?void 0:s.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const i=[],m=y=>{if(!y||y==="cimode")return;this.services.languageUtils.toResolveHierarchy(y).forEach(w=>{w!=="cimode"&&i.indexOf(w)<0&&i.push(w)})};s?m(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(S=>m(S)),(d=(o=this.options.preload)==null?void 0:o.forEach)==null||d.call(o,y=>m(y)),this.services.backendConnector.load(i,this.options.ns,y=>{!y&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(y)})}else n(null)}reloadResources(t,r,n){const s=$S();return typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=void 0),t||(t=this.languages),r||(r=this.options.ns),n||(n=Ej),this.services.backendConnector.reload(t,r,o=>{s.resolve(),n(o)}),s}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&Wre.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let r=0;r<this.languages.length;r++){const n=this.languages[r];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,r){this.isLanguageChangingTo=t;const n=$S();this.emit("languageChanging",t);const s=i=>{this.language=i,this.languages=this.services.languageUtils.toResolveHierarchy(i),this.resolvedLanguage=void 0,this.setResolvedLanguage(i)},o=(i,m)=>{m?this.isLanguageChangingTo===t&&(s(m),this.translator.changeLanguage(m),this.isLanguageChangingTo=void 0,this.emit("languageChanged",m),this.logger.log("languageChanged",m)):this.isLanguageChangingTo=void 0,n.resolve((...y)=>this.t(...y)),r&&r(i,(...y)=>this.t(...y))},d=i=>{var S,w;!t&&!i&&this.services.languageDetector&&(i=[]);const m=bi(i)?i:i&&i[0],y=this.store.hasLanguageSomeTranslations(m)?m:this.services.languageUtils.getBestMatchFromCodes(bi(i)?[i]:i);y&&(this.language||s(y),this.translator.language||this.translator.changeLanguage(y),(w=(S=this.services.languageDetector)==null?void 0:S.cacheUserLanguage)==null||w.call(S,y)),this.loadResources(y,T=>{o(T,y)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?d(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(d):this.services.languageDetector.detect(d):d(t),n}getFixedT(t,r,n){const s=(o,d,...i)=>{let m;typeof d!="object"?m=this.options.overloadTranslationOptionHandler([o,d].concat(i)):m={...d},m.lng=m.lng||s.lng,m.lngs=m.lngs||s.lngs,m.ns=m.ns||s.ns,m.keyPrefix!==""&&(m.keyPrefix=m.keyPrefix||n||s.keyPrefix);const y=this.options.keySeparator||".";let S;return m.keyPrefix&&Array.isArray(o)?S=o.map(w=>(typeof w=="function"&&(w=_F(w,{...this.options,...d})),`${m.keyPrefix}${y}${w}`)):(typeof o=="function"&&(o=_F(o,{...this.options,...d})),S=m.keyPrefix?`${m.keyPrefix}${y}${o}`:o),this.t(S,m)};return bi(t)?s.lng=t:s.lngs=t,s.ns=r,s.keyPrefix=n,s}t(...t){var r;return(r=this.translator)==null?void 0:r.translate(...t)}exists(...t){var r;return(r=this.translator)==null?void 0:r.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,r={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=r.lng||this.resolvedLanguage||this.languages[0],s=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const d=(i,m)=>{const y=this.services.backendConnector.state[`${i}|${m}`];return y===-1||y===0||y===2};if(r.precheck){const i=r.precheck(this,d);if(i!==void 0)return i}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||d(n,t)&&(!s||d(o,t)))}loadNamespaces(t,r){const n=$S();return this.options.ns?(bi(t)&&(t=[t]),t.forEach(s=>{this.options.ns.indexOf(s)<0&&this.options.ns.push(s)}),this.loadResources(s=>{n.resolve(),r&&r(s)}),n):(r&&r(),Promise.resolve())}loadLanguages(t,r){const n=$S();bi(t)&&(t=[t]);const s=this.options.preload||[],o=t.filter(d=>s.indexOf(d)<0&&this.services.languageUtils.isSupportedCode(d));return o.length?(this.options.preload=s.concat(o),this.loadResources(d=>{n.resolve(),r&&r(d)}),n):(r&&r(),Promise.resolve())}dir(t){var s,o;if(t||(t=this.resolvedLanguage||(((s=this.languages)==null?void 0:s.length)>0?this.languages[0]:this.language)),!t)return"rtl";try{const d=new Intl.Locale(t);if(d&&d.getTextInfo){const i=d.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=((o=this.services)==null?void 0:o.languageUtils)||new rG(oG());return t.toLowerCase().indexOf("-latn")>1?"ltr":r.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},r){const n=new NE(t,r);return n.createInstance=NE.createInstance,n}cloneInstance(t={},r=Ej){const n=t.forkResourceStore;n&&delete t.forkResourceStore;const s={...this.options,...t,isClone:!0},o=new NE(s);if((t.debug!==void 0||t.prefix!==void 0)&&(o.logger=o.logger.clone(t)),["store","services","language"].forEach(i=>{o[i]=this[i]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},n){const i=Object.keys(this.store.data).reduce((m,y)=>(m[y]={...this.store.data[y]},m[y]=Object.keys(m[y]).reduce((S,w)=>(S[w]={...m[y][w]},S),m[y]),m),{});o.store=new eG(i,s),o.services.resourceStore=o.store}return o.translator=new uO(o.services,s),o.translator.on("*",(i,...m)=>{o.emit(i,...m)}),o.init(s,r),o.translator.options=s,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Pr=NE.createInstance();Pr.createInstance;Pr.dir;Pr.init;Pr.loadResources;Pr.reloadResources;Pr.use;Pr.changeLanguage;Pr.getFixedT;Pr.t;Pr.exists;Pr.setDefaultNamespace;Pr.hasLoadedNamespace;Pr.loadNamespaces;Pr.loadLanguages;const _2e=(e,t,r,n)=>{var o,d,i,m;const s=[r,{code:t,...n||{}}];if((d=(o=e==null?void 0:e.services)==null?void 0:o.logger)!=null&&d.forward)return e.services.logger.forward(s,"warn","react-i18next::",!0);Pv(s[0])&&(s[0]=`react-i18next:: ${s[0]}`),(m=(i=e==null?void 0:e.services)==null?void 0:i.logger)!=null&&m.warn?e.services.logger.warn(...s):console!=null&&console.warn&&console.warn(...s)},cG={},Zre=(e,t,r,n)=>{Pv(r)&&cG[r]||(Pv(r)&&(cG[r]=new Date),_2e(e,t,r,n))},Xre=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},xF=(e,t,r)=>{e.loadNamespaces(t,Xre(e,r))},uG=(e,t,r,n)=>{if(Pv(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return xF(e,r,n);r.forEach(s=>{e.options.ns.indexOf(s)<0&&e.options.ns.push(s)}),e.loadLanguages(t,Xre(e,n))},x2e=(e,t,r={})=>!t.languages||!t.languages.length?(Zre(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:r.lng,precheck:(n,s)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&n.services.backendConnector.backend&&n.isLanguageChangingTo&&!s(n.isLanguageChangingTo,e))return!1}}),Pv=e=>typeof e=="string",b2e=e=>typeof e=="object"&&e!==null,w2e=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,S2e={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},E2e=e=>S2e[e],T2e=e=>e.replace(w2e,E2e);let bF={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:T2e};const A2e=(e={})=>{bF={...bF,...e}},C2e=()=>bF;let Yre;const j2e=e=>{Yre=e},P2e=()=>Yre,O2e={type:"3rdParty",init(e){A2e(e.options.react),j2e(e)}},k2e=V.createContext();class N2e{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const I2e=(e,t)=>Pv(t)?t:b2e(t)&&Pv(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,R2e={t:I2e,ready:!1},M2e=()=>()=>{},ei=(e,t={})=>{var ne,ae,re;const{i18n:r}=t,{i18n:n,defaultNS:s}=V.useContext(k2e)||{},o=r||n||P2e();o&&!o.reportNamespaces&&(o.reportNamespaces=new N2e),o||Zre(o,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const d=V.useMemo(()=>{var ee;return{...C2e(),...(ee=o==null?void 0:o.options)==null?void 0:ee.react,...t}},[o,t]),{useSuspense:i,keyPrefix:m}=d,y=s||((ne=o==null?void 0:o.options)==null?void 0:ne.defaultNS),S=Pv(y)?[y]:y||["translation"],w=V.useMemo(()=>S,S);(re=(ae=o==null?void 0:o.reportNamespaces)==null?void 0:ae.addUsedNamespaces)==null||re.call(ae,w);const T=V.useRef(0),A=V.useCallback(ee=>{if(!o)return M2e;const{bindI18n:ie,bindI18nStore:de}=d,be=()=>{T.current+=1,ee()};return ie&&o.on(ie,be),de&&o.store.on(de,be),()=>{ie&&ie.split(" ").forEach(Se=>o.off(Se,be)),de&&de.split(" ").forEach(Se=>o.store.off(Se,be))}},[o,d]),O=V.useRef(),P=V.useCallback(()=>{if(!o)return R2e;const ee=!!(o.isInitialized||o.initializedStoreOnce)&&w.every(xe=>x2e(xe,o,d)),ie=t.lng||o.language,de=T.current,be=O.current;if(be&&be.ready===ee&&be.lng===ie&&be.keyPrefix===m&&be.revision===de)return be;const Ae={t:o.getFixedT(ie,d.nsMode==="fallback"?w:w[0],m),ready:ee,lng:ie,keyPrefix:m,revision:de};return O.current=Ae,Ae},[o,w,m,d,t.lng]),[N,R]=V.useState(0),{t:M,ready:F}=Dre.useSyncExternalStore(A,P,P);V.useEffect(()=>{if(o&&!F&&!i){const ee=()=>R(ie=>ie+1);t.lng?uG(o,t.lng,w,ee):xF(o,w,ee)}},[o,t.lng,w,F,i,N]);const B=o||{},$=V.useRef(null),W=V.useRef(),K=ee=>{const ie=Object.getOwnPropertyDescriptors(ee);ie.__original&&delete ie.__original;const de=Object.create(Object.getPrototypeOf(ee),ie);if(!Object.prototype.hasOwnProperty.call(de,"__original"))try{Object.defineProperty(de,"__original",{value:ee,writable:!1,enumerable:!1,configurable:!1})}catch{}return de},te=V.useMemo(()=>{const ee=B,ie=ee==null?void 0:ee.language;let de=ee;ee&&($.current&&$.current.__original===ee?W.current!==ie?(de=K(ee),$.current=de,W.current=ie):de=$.current:(de=K(ee),$.current=de,W.current=ie));const be=[M,de,F];return be.t=M,be.i18n=de,be.ready=F,be},[M,B,F,B.resolvedLanguage,B.language,B.languages]);if(o&&i&&!F)throw new Promise(ee=>{const ie=()=>ee();t.lng?uG(o,t.lng,w,ie):xF(o,w,ie)});return te};var D2e=V.createContext(void 0);function Yv(e){const t=V.useContext(D2e);return e||t||"ltr"}var WD="rovingFocusGroup.onEntryFocus",L2e={bubbles:!1,cancelable:!0},O2="RovingFocusGroup",[wF,Jre,F2e]=y2(O2),[z2e,uw]=Fo(O2,[F2e]),[B2e,$2e]=z2e(O2),Qre=V.forwardRef((e,t)=>h.jsx(wF.Provider,{scope:e.__scopeRovingFocusGroup,children:h.jsx(wF.Slot,{scope:e.__scopeRovingFocusGroup,children:h.jsx(U2e,{...e,ref:t})})}));Qre.displayName=O2;var U2e=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:s=!1,dir:o,currentTabStopId:d,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:m,onEntryFocus:y,preventScrollOnEntryFocus:S=!1,...w}=e,T=V.useRef(null),A=$n(t,T),O=Yv(o),[P,N]=Zc({prop:d,defaultProp:i??null,onChange:m,caller:O2}),[R,M]=V.useState(!1),F=no(y),B=Jre(r),$=V.useRef(!1),[W,K]=V.useState(0);return V.useEffect(()=>{const te=T.current;if(te)return te.addEventListener(WD,F),()=>te.removeEventListener(WD,F)},[F]),h.jsx(B2e,{scope:r,orientation:n,dir:O,loop:s,currentTabStopId:P,onItemFocus:V.useCallback(te=>N(te),[N]),onItemShiftTab:V.useCallback(()=>M(!0),[]),onFocusableItemAdd:V.useCallback(()=>K(te=>te+1),[]),onFocusableItemRemove:V.useCallback(()=>K(te=>te-1),[]),children:h.jsx(on.div,{tabIndex:R||W===0?-1:0,"data-orientation":n,...w,ref:A,style:{outline:"none",...e.style},onMouseDown:Ir(e.onMouseDown,()=>{$.current=!0}),onFocus:Ir(e.onFocus,te=>{const ne=!$.current;if(te.target===te.currentTarget&&ne&&!R){const ae=new CustomEvent(WD,L2e);if(te.currentTarget.dispatchEvent(ae),!ae.defaultPrevented){const re=B().filter(Se=>Se.focusable),ee=re.find(Se=>Se.active),ie=re.find(Se=>Se.id===P),be=[ee,ie,...re].filter(Boolean).map(Se=>Se.ref.current);rne(be,S)}}$.current=!1}),onBlur:Ir(e.onBlur,()=>M(!1))})})}),ene="RovingFocusGroupItem",tne=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:s=!1,tabStopId:o,children:d,...i}=e,m=yu(),y=o||m,S=$2e(ene,r),w=S.currentTabStopId===y,T=Jre(r),{onFocusableItemAdd:A,onFocusableItemRemove:O,currentTabStopId:P}=S;return V.useEffect(()=>{if(n)return A(),()=>O()},[n,A,O]),h.jsx(wF.ItemSlot,{scope:r,id:y,focusable:n,active:s,children:h.jsx(on.span,{tabIndex:w?0:-1,"data-orientation":S.orientation,...i,ref:t,onMouseDown:Ir(e.onMouseDown,N=>{n?S.onItemFocus(y):N.preventDefault()}),onFocus:Ir(e.onFocus,()=>S.onItemFocus(y)),onKeyDown:Ir(e.onKeyDown,N=>{if(N.key==="Tab"&&N.shiftKey){S.onItemShiftTab();return}if(N.target!==N.currentTarget)return;const R=H2e(N,S.orientation,S.dir);if(R!==void 0){if(N.metaKey||N.ctrlKey||N.altKey||N.shiftKey)return;N.preventDefault();let F=T().filter(B=>B.focusable).map(B=>B.ref.current);if(R==="last")F.reverse();else if(R==="prev"||R==="next"){R==="prev"&&F.reverse();const B=F.indexOf(N.currentTarget);F=S.loop?G2e(F,B+1):F.slice(B+1)}setTimeout(()=>rne(F))}}),children:typeof d=="function"?d({isCurrentTabStop:w,hasTabStop:P!=null}):d})})});tne.displayName=ene;var V2e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function q2e(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function H2e(e,t,r){const n=q2e(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return V2e[n]}function rne(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function G2e(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var c5=Qre,u5=tne,SF=["Enter"," "],W2e=["ArrowDown","PageUp","Home"],nne=["ArrowUp","PageDown","End"],K2e=[...W2e,...nne],Z2e={ltr:[...SF,"ArrowRight"],rtl:[...SF,"ArrowLeft"]},X2e={ltr:["ArrowLeft"],rtl:["ArrowRight"]},k2="Menu",[gT,Y2e,J2e]=y2(k2),[Jv,ine]=Fo(k2,[J2e,bg,uw]),TN=bg(),sne=uw(),[Q2e,Qv]=Jv(k2),[eAe,N2]=Jv(k2),ane=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:o,modal:d=!0}=e,i=TN(t),[m,y]=V.useState(null),S=V.useRef(!1),w=no(o),T=Yv(s);return V.useEffect(()=>{const A=()=>{S.current=!0,document.addEventListener("pointerdown",O,{capture:!0,once:!0}),document.addEventListener("pointermove",O,{capture:!0,once:!0})},O=()=>S.current=!1;return document.addEventListener("keydown",A,{capture:!0}),()=>{document.removeEventListener("keydown",A,{capture:!0}),document.removeEventListener("pointerdown",O,{capture:!0}),document.removeEventListener("pointermove",O,{capture:!0})}},[]),h.jsx(lN,{...i,children:h.jsx(Q2e,{scope:t,open:r,onOpenChange:w,content:m,onContentChange:y,children:h.jsx(eAe,{scope:t,onClose:V.useCallback(()=>w(!1),[w]),isUsingKeyboardRef:S,dir:T,modal:d,children:n})})})};ane.displayName=k2;var tAe="MenuAnchor",d5=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=TN(r);return h.jsx(w2,{...s,...n,ref:t})});d5.displayName=tAe;var h5="MenuPortal",[rAe,one]=Jv(h5,{forceMount:void 0}),lne=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:s}=e,o=Qv(h5,t);return h.jsx(rAe,{scope:t,forceMount:r,children:h.jsx(zo,{present:r||o.open,children:h.jsx(ew,{asChild:!0,container:s,children:n})})})};lne.displayName=h5;var Ku="MenuContent",[nAe,f5]=Jv(Ku),cne=V.forwardRef((e,t)=>{const r=one(Ku,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Qv(Ku,e.__scopeMenu),d=N2(Ku,e.__scopeMenu);return h.jsx(gT.Provider,{scope:e.__scopeMenu,children:h.jsx(zo,{present:n||o.open,children:h.jsx(gT.Slot,{scope:e.__scopeMenu,children:d.modal?h.jsx(iAe,{...s,ref:t}):h.jsx(sAe,{...s,ref:t})})})})}),iAe=V.forwardRef((e,t)=>{const r=Qv(Ku,e.__scopeMenu),n=V.useRef(null),s=$n(t,n);return V.useEffect(()=>{const o=n.current;if(o)return bN(o)},[]),h.jsx(p5,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Ir(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),sAe=V.forwardRef((e,t)=>{const r=Qv(Ku,e.__scopeMenu);return h.jsx(p5,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),aAe=ug("MenuContent.ScrollLock"),p5=V.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:d,disableOutsidePointerEvents:i,onEntryFocus:m,onEscapeKeyDown:y,onPointerDownOutside:S,onFocusOutside:w,onInteractOutside:T,onDismiss:A,disableOutsideScroll:O,...P}=e,N=Qv(Ku,r),R=N2(Ku,r),M=TN(r),F=sne(r),B=Y2e(r),[$,W]=V.useState(null),K=V.useRef(null),te=$n(t,K,N.onContentChange),ne=V.useRef(0),ae=V.useRef(""),re=V.useRef(0),ee=V.useRef(null),ie=V.useRef("right"),de=V.useRef(0),be=O?T2:V.Fragment,Se=O?{as:aAe,allowPinchZoom:!0}:void 0,Ae=me=>{var Ke,Le;const Ce=ae.current+me,ge=B().filter(ke=>!ke.disabled),pe=document.activeElement,Oe=(Ke=ge.find(ke=>ke.ref.current===pe))==null?void 0:Ke.textValue,Xe=ge.map(ke=>ke.textValue),We=vAe(Xe,Ce,Oe),$e=(Le=ge.find(ke=>ke.textValue===We))==null?void 0:Le.ref.current;(function ke(st){ae.current=st,window.clearTimeout(ne.current),st!==""&&(ne.current=window.setTimeout(()=>ke(""),1e3))})(Ce),$e&&setTimeout(()=>$e.focus())};V.useEffect(()=>()=>window.clearTimeout(ne.current),[]),_N();const xe=V.useCallback(me=>{var ge,pe;return ie.current===((ge=ee.current)==null?void 0:ge.side)&&xAe(me,(pe=ee.current)==null?void 0:pe.area)},[]);return h.jsx(nAe,{scope:r,searchRef:ae,onItemEnter:V.useCallback(me=>{xe(me)&&me.preventDefault()},[xe]),onItemLeave:V.useCallback(me=>{var Ce;xe(me)||((Ce=K.current)==null||Ce.focus(),W(null))},[xe]),onTriggerLeave:V.useCallback(me=>{xe(me)&&me.preventDefault()},[xe]),pointerGraceTimerRef:re,onPointerGraceIntentChange:V.useCallback(me=>{ee.current=me},[]),children:h.jsx(be,{...Se,children:h.jsx(E2,{asChild:!0,trapped:s,onMountAutoFocus:Ir(o,me=>{var Ce;me.preventDefault(),(Ce=K.current)==null||Ce.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:h.jsx(Kv,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:y,onPointerDownOutside:S,onFocusOutside:w,onInteractOutside:T,onDismiss:A,children:h.jsx(c5,{asChild:!0,...F,dir:R.dir,orientation:"vertical",loop:n,currentTabStopId:$,onCurrentTabStopIdChange:W,onEntryFocus:Ir(m,me=>{R.isUsingKeyboardRef.current||me.preventDefault()}),preventScrollOnEntryFocus:!0,children:h.jsx(cN,{role:"menu","aria-orientation":"vertical","data-state":Tne(N.open),"data-radix-menu-content":"",dir:R.dir,...M,...P,ref:te,style:{outline:"none",...P.style},onKeyDown:Ir(P.onKeyDown,me=>{const ge=me.target.closest("[data-radix-menu-content]")===me.currentTarget,pe=me.ctrlKey||me.altKey||me.metaKey,Oe=me.key.length===1;ge&&(me.key==="Tab"&&me.preventDefault(),!pe&&Oe&&Ae(me.key));const Xe=K.current;if(me.target!==Xe||!K2e.includes(me.key))return;me.preventDefault();const $e=B().filter(Ke=>!Ke.disabled).map(Ke=>Ke.ref.current);nne.includes(me.key)&&$e.reverse(),gAe($e)}),onBlur:Ir(e.onBlur,me=>{me.currentTarget.contains(me.target)||(window.clearTimeout(ne.current),ae.current="")}),onPointerMove:Ir(e.onPointerMove,yT(me=>{const Ce=me.target,ge=de.current!==me.clientX;if(me.currentTarget.contains(Ce)&&ge){const pe=me.clientX>de.current?"right":"left";ie.current=pe,de.current=me.clientX}}))})})})})})})});cne.displayName=Ku;var oAe="MenuGroup",m5=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return h.jsx(on.div,{role:"group",...n,ref:t})});m5.displayName=oAe;var lAe="MenuLabel",une=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return h.jsx(on.div,{...n,ref:t})});une.displayName=lAe;var dO="MenuItem",dG="menu.itemSelect",AN=V.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...s}=e,o=V.useRef(null),d=N2(dO,e.__scopeMenu),i=f5(dO,e.__scopeMenu),m=$n(t,o),y=V.useRef(!1),S=()=>{const w=o.current;if(!r&&w){const T=new CustomEvent(dG,{bubbles:!0,cancelable:!0});w.addEventListener(dG,A=>n==null?void 0:n(A),{once:!0}),bB(w,T),T.defaultPrevented?y.current=!1:d.onClose()}};return h.jsx(dne,{...s,ref:m,disabled:r,onClick:Ir(e.onClick,S),onPointerDown:w=>{var T;(T=e.onPointerDown)==null||T.call(e,w),y.current=!0},onPointerUp:Ir(e.onPointerUp,w=>{var T;y.current||(T=w.currentTarget)==null||T.click()}),onKeyDown:Ir(e.onKeyDown,w=>{const T=i.searchRef.current!=="";r||T&&w.key===" "||SF.includes(w.key)&&(w.currentTarget.click(),w.preventDefault())})})});AN.displayName=dO;var dne=V.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:s,...o}=e,d=f5(dO,r),i=sne(r),m=V.useRef(null),y=$n(t,m),[S,w]=V.useState(!1),[T,A]=V.useState("");return V.useEffect(()=>{const O=m.current;O&&A((O.textContent??"").trim())},[o.children]),h.jsx(gT.ItemSlot,{scope:r,disabled:n,textValue:s??T,children:h.jsx(u5,{asChild:!0,...i,focusable:!n,children:h.jsx(on.div,{role:"menuitem","data-highlighted":S?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:y,onPointerMove:Ir(e.onPointerMove,yT(O=>{n?d.onItemLeave(O):(d.onItemEnter(O),O.defaultPrevented||O.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ir(e.onPointerLeave,yT(O=>d.onItemLeave(O))),onFocus:Ir(e.onFocus,()=>w(!0)),onBlur:Ir(e.onBlur,()=>w(!1))})})})}),cAe="MenuCheckboxItem",hne=V.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...s}=e;return h.jsx(yne,{scope:e.__scopeMenu,checked:r,children:h.jsx(AN,{role:"menuitemcheckbox","aria-checked":hO(r)?"mixed":r,...s,ref:t,"data-state":y5(r),onSelect:Ir(s.onSelect,()=>n==null?void 0:n(hO(r)?!0:!r),{checkForDefaultPrevented:!1})})})});hne.displayName=cAe;var fne="MenuRadioGroup",[uAe,dAe]=Jv(fne,{value:void 0,onValueChange:()=>{}}),pne=V.forwardRef((e,t)=>{const{value:r,onValueChange:n,...s}=e,o=no(n);return h.jsx(uAe,{scope:e.__scopeMenu,value:r,onValueChange:o,children:h.jsx(m5,{...s,ref:t})})});pne.displayName=fne;var mne="MenuRadioItem",gne=V.forwardRef((e,t)=>{const{value:r,...n}=e,s=dAe(mne,e.__scopeMenu),o=r===s.value;return h.jsx(yne,{scope:e.__scopeMenu,checked:o,children:h.jsx(AN,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":y5(o),onSelect:Ir(n.onSelect,()=>{var d;return(d=s.onValueChange)==null?void 0:d.call(s,r)},{checkForDefaultPrevented:!1})})})});gne.displayName=mne;var g5="MenuItemIndicator",[yne,hAe]=Jv(g5,{checked:!1}),vne=V.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...s}=e,o=hAe(g5,r);return h.jsx(zo,{present:n||hO(o.checked)||o.checked===!0,children:h.jsx(on.span,{...s,ref:t,"data-state":y5(o.checked)})})});vne.displayName=g5;var fAe="MenuSeparator",_ne=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return h.jsx(on.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});_ne.displayName=fAe;var pAe="MenuArrow",xne=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=TN(r);return h.jsx(uN,{...s,...n,ref:t})});xne.displayName=pAe;var mAe="MenuSub",[sst,bne]=Jv(mAe),fE="MenuSubTrigger",wne=V.forwardRef((e,t)=>{const r=Qv(fE,e.__scopeMenu),n=N2(fE,e.__scopeMenu),s=bne(fE,e.__scopeMenu),o=f5(fE,e.__scopeMenu),d=V.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:m}=o,y={__scopeMenu:e.__scopeMenu},S=V.useCallback(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return V.useEffect(()=>S,[S]),V.useEffect(()=>{const w=i.current;return()=>{window.clearTimeout(w),m(null)}},[i,m]),h.jsx(d5,{asChild:!0,...y,children:h.jsx(dne,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":Tne(r.open),...e,ref:Yk(t,s.onTriggerChange),onClick:w=>{var T;(T=e.onClick)==null||T.call(e,w),!(e.disabled||w.defaultPrevented)&&(w.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Ir(e.onPointerMove,yT(w=>{o.onItemEnter(w),!w.defaultPrevented&&!e.disabled&&!r.open&&!d.current&&(o.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{r.onOpenChange(!0),S()},100))})),onPointerLeave:Ir(e.onPointerLeave,yT(w=>{var A,O;S();const T=(A=r.content)==null?void 0:A.getBoundingClientRect();if(T){const P=(O=r.content)==null?void 0:O.dataset.side,N=P==="right",R=N?-5:5,M=T[N?"left":"right"],F=T[N?"right":"left"];o.onPointerGraceIntentChange({area:[{x:w.clientX+R,y:w.clientY},{x:M,y:T.top},{x:F,y:T.top},{x:F,y:T.bottom},{x:M,y:T.bottom}],side:P}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(w),w.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:Ir(e.onKeyDown,w=>{var A;const T=o.searchRef.current!=="";e.disabled||T&&w.key===" "||Z2e[n.dir].includes(w.key)&&(r.onOpenChange(!0),(A=r.content)==null||A.focus(),w.preventDefault())})})})});wne.displayName=fE;var Sne="MenuSubContent",Ene=V.forwardRef((e,t)=>{const r=one(Ku,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Qv(Ku,e.__scopeMenu),d=N2(Ku,e.__scopeMenu),i=bne(Sne,e.__scopeMenu),m=V.useRef(null),y=$n(t,m);return h.jsx(gT.Provider,{scope:e.__scopeMenu,children:h.jsx(zo,{present:n||o.open,children:h.jsx(gT.Slot,{scope:e.__scopeMenu,children:h.jsx(p5,{id:i.contentId,"aria-labelledby":i.triggerId,...s,ref:y,align:"start",side:d.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:S=>{var w;d.isUsingKeyboardRef.current&&((w=m.current)==null||w.focus()),S.preventDefault()},onCloseAutoFocus:S=>S.preventDefault(),onFocusOutside:Ir(e.onFocusOutside,S=>{S.target!==i.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:Ir(e.onEscapeKeyDown,S=>{d.onClose(),S.preventDefault()}),onKeyDown:Ir(e.onKeyDown,S=>{var A;const w=S.currentTarget.contains(S.target),T=X2e[d.dir].includes(S.key);w&&T&&(o.onOpenChange(!1),(A=i.trigger)==null||A.focus(),S.preventDefault())})})})})})});Ene.displayName=Sne;function Tne(e){return e?"open":"closed"}function hO(e){return e==="indeterminate"}function y5(e){return hO(e)?"indeterminate":e?"checked":"unchecked"}function gAe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function yAe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function vAe(e,t,r){const s=t.length>1&&Array.from(t).every(y=>y===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let d=yAe(e,Math.max(o,0));s.length===1&&(d=d.filter(y=>y!==r));const m=d.find(y=>y.toLowerCase().startsWith(s.toLowerCase()));return m!==r?m:void 0}function _Ae(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,d=t.length-1;o<t.length;d=o++){const i=t[o],m=t[d],y=i.x,S=i.y,w=m.x,T=m.y;S>n!=T>n&&r<(w-y)*(n-S)/(T-S)+y&&(s=!s)}return s}function xAe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return _Ae(r,t)}function yT(e){return t=>t.pointerType==="mouse"?e(t):void 0}var bAe=ane,wAe=d5,SAe=lne,EAe=cne,TAe=m5,AAe=une,CAe=AN,jAe=hne,PAe=pne,OAe=gne,kAe=vne,NAe=_ne,IAe=xne,RAe=wne,MAe=Ene,CN="DropdownMenu",[DAe,ast]=Fo(CN,[ine]),vc=ine(),[LAe,Ane]=DAe(CN),Cne=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:o,onOpenChange:d,modal:i=!0}=e,m=vc(t),y=V.useRef(null),[S,w]=Zc({prop:s,defaultProp:o??!1,onChange:d,caller:CN});return h.jsx(LAe,{scope:t,triggerId:yu(),triggerRef:y,contentId:yu(),open:S,onOpenChange:w,onOpenToggle:V.useCallback(()=>w(T=>!T),[w]),modal:i,children:h.jsx(bAe,{...m,open:S,onOpenChange:w,dir:n,modal:i,children:r})})};Cne.displayName=CN;var jne="DropdownMenuTrigger",Pne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...s}=e,o=Ane(jne,r),d=vc(r);return h.jsx(wAe,{asChild:!0,...d,children:h.jsx(on.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:Yk(t,o.triggerRef),onPointerDown:Ir(e.onPointerDown,i=>{!n&&i.button===0&&i.ctrlKey===!1&&(o.onOpenToggle(),o.open||i.preventDefault())}),onKeyDown:Ir(e.onKeyDown,i=>{n||(["Enter"," "].includes(i.key)&&o.onOpenToggle(),i.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});Pne.displayName=jne;var FAe="DropdownMenuPortal",One=e=>{const{__scopeDropdownMenu:t,...r}=e,n=vc(t);return h.jsx(SAe,{...n,...r})};One.displayName=FAe;var kne="DropdownMenuContent",Nne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ane(kne,r),o=vc(r),d=V.useRef(!1);return h.jsx(EAe,{id:s.contentId,"aria-labelledby":s.triggerId,...o,...n,ref:t,onCloseAutoFocus:Ir(e.onCloseAutoFocus,i=>{var m;d.current||(m=s.triggerRef.current)==null||m.focus(),d.current=!1,i.preventDefault()}),onInteractOutside:Ir(e.onInteractOutside,i=>{const m=i.detail.originalEvent,y=m.button===0&&m.ctrlKey===!0,S=m.button===2||y;(!s.modal||S)&&(d.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Nne.displayName=kne;var zAe="DropdownMenuGroup",BAe=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(TAe,{...s,...n,ref:t})});BAe.displayName=zAe;var $Ae="DropdownMenuLabel",Ine=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(AAe,{...s,...n,ref:t})});Ine.displayName=$Ae;var UAe="DropdownMenuItem",Rne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(CAe,{...s,...n,ref:t})});Rne.displayName=UAe;var VAe="DropdownMenuCheckboxItem",Mne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(jAe,{...s,...n,ref:t})});Mne.displayName=VAe;var qAe="DropdownMenuRadioGroup",HAe=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(PAe,{...s,...n,ref:t})});HAe.displayName=qAe;var GAe="DropdownMenuRadioItem",Dne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(OAe,{...s,...n,ref:t})});Dne.displayName=GAe;var WAe="DropdownMenuItemIndicator",Lne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(kAe,{...s,...n,ref:t})});Lne.displayName=WAe;var KAe="DropdownMenuSeparator",Fne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(NAe,{...s,...n,ref:t})});Fne.displayName=KAe;var ZAe="DropdownMenuArrow",XAe=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(IAe,{...s,...n,ref:t})});XAe.displayName=ZAe;var YAe="DropdownMenuSubTrigger",zne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(RAe,{...s,...n,ref:t})});zne.displayName=YAe;var JAe="DropdownMenuSubContent",Bne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return h.jsx(MAe,{...s,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Bne.displayName=JAe;var QAe=Cne,eCe=Pne,tCe=One,$ne=Nne,Une=Ine,Vne=Rne,qne=Mne,Hne=Dne,Gne=Lne,Wne=Fne,Kne=zne,Zne=Bne;const e_=QAe,t_=eCe,rCe=V.forwardRef(({className:e,inset:t,children:r,...n},s)=>h.jsxs(Kne,{ref:s,className:fr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...n,children:[r,h.jsx(tN,{className:"ml-auto h-4 w-4"})]}));rCe.displayName=Kne.displayName;const nCe=V.forwardRef(({className:e,...t},r)=>h.jsx(Zne,{ref:r,className:fr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));nCe.displayName=Zne.displayName;const Eg=V.forwardRef(({className:e,sideOffset:t=4,...r},n)=>h.jsx(tCe,{children:h.jsx($ne,{ref:n,sideOffset:t,className:fr("z-[100] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Eg.displayName=$ne.displayName;const Is=V.forwardRef(({className:e,inset:t,...r},n)=>h.jsx(Vne,{ref:n,className:fr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...r}));Is.displayName=Vne.displayName;const iCe=V.forwardRef(({className:e,children:t,checked:r,...n},s)=>h.jsxs(qne,{ref:s,className:fr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:r,...n,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(Gne,{children:h.jsx(sp,{className:"h-4 w-4"})})}),t]}));iCe.displayName=qne.displayName;const sCe=V.forwardRef(({className:e,children:t,...r},n)=>h.jsxs(Hne,{ref:n,className:fr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(Gne,{children:h.jsx(AQ,{className:"h-2 w-2 fill-current"})})}),t]}));sCe.displayName=Hne.displayName;const v5=V.forwardRef(({className:e,inset:t,...r},n)=>h.jsx(Une,{ref:n,className:fr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));v5.displayName=Une.displayName;const Xf=V.forwardRef(({className:e,...t},r)=>h.jsx(Wne,{ref:r,className:fr("-mx-1 my-1 h-px bg-muted",e),...t}));Xf.displayName=Wne.displayName;const jN=()=>{const{user:e}=Qn();return Ii(),ci({queryKey:["profile",e==null?void 0:e.id],queryFn:async()=>{if(!e)return null;const{data:t,error:r}=await Ct.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;return t},enabled:!!e})},Xne=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async({display_name:n,phone:s,avatar_url:o,language_preference:d})=>{if(!e)throw new Error("User not authenticated");const i={};n!==void 0&&(i.display_name=n),s!==void 0&&(i.phone=s),o!==void 0&&(i.avatar_url=o),d!==void 0&&(i.language_preference=d);const{data:m,error:y}=await Ct.from("profiles").update(i).eq("id",e.id).select().single();if(y)throw y;return m},onSuccess:()=>{r.invalidateQueries({queryKey:["profile"]}),t({title:"Success",description:"Profile updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update profile",variant:"destructive"})}})},aCe=()=>{const{user:e}=Qn(),t=Ri();return Gi({mutationFn:async r=>{if(!e)return;const{error:n}=await Ct.from("profiles").update({language_preference:r}).eq("id",e.id);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]})}})},oCe=()=>{const{user:e}=Qn(),{toast:t}=Ii();return Gi({mutationFn:async r=>{if(!e)throw new Error("User not authenticated");const n=r.name.split(".").pop(),s=`${Date.now()}.${n}`,o=`${e.id}/${s}`,{error:d}=await Ct.storage.from("avatars").upload(o,r,{upsert:!0});if(d)throw d;const{data:{publicUrl:i}}=Ct.storage.from("avatars").getPublicUrl(o);return i},onError:()=>{t({title:"Error",description:"Failed to upload avatar",variant:"destructive"})}})},lCe=()=>{const{user:e}=Qn(),t=Ri();return Gi({mutationFn:async r=>{if(!e)throw new Error("User not authenticated");const n={activity_terms_agreed:r,activity_terms_agreed_at:r?new Date().toISOString():null},{error:s}=await Ct.from("profiles").update(n).eq("id",e.id);if(s)throw s;return r},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]})}})},KD=[{code:"en",name:"English",flag:""},{code:"zh",name:"",flag:""},{code:"pt",name:"Portugus",flag:""}],cCe=()=>{const{i18n:e}=ei(),{user:t}=Qn(),r=aCe(),n=KD.find(o=>o.code===e.language)||KD[0],s=o=>{e.changeLanguage(o),t&&r.mutate(o)};return h.jsxs(e_,{children:[h.jsx(t_,{asChild:!0,children:h.jsx(Mt,{variant:"ghost",size:"icon",title:"Change Language",children:h.jsx(yv,{className:"w-5 h-5"})})}),h.jsx(Eg,{align:"end",children:KD.map(o=>h.jsxs(Is,{onClick:()=>s(o.code),className:`cursor-pointer ${n.code===o.code?"bg-accent":""}`,children:[h.jsx("span",{className:"mr-2",children:o.flag}),h.jsx("span",{children:o.name})]},o.code))})]})},_c=()=>{const{user:e}=Qn(),{data:t,isLoading:r}=ci({queryKey:["user-roles",e==null?void 0:e.id],queryFn:async()=>{if(!e)return"user";const{data:i,error:m}=await Ct.from("user_roles").select("role").eq("user_id",e.id).single();if(m)throw m;return i.role},enabled:!!e});return{role:t??"user",hasRole:i=>t===i,isAdmin:t==="admin",isSupervisor:t==="supervisor",isMerchant:t==="merchant",isLoading:r}},uCe=Zv("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function tn({className:e,variant:t,...r}){return h.jsx("div",{className:fr(uCe({variant:t}),e),...r})}function vT(e,[t,r]){return Math.min(r,Math.max(t,e))}function dCe(e,t){return V.useReducer((r,n)=>t[r][n]??r,e)}var _5="ScrollArea",[Yne,ost]=Fo(_5),[hCe,Qu]=Yne(_5),Jne=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:s,scrollHideDelay:o=600,...d}=e,[i,m]=V.useState(null),[y,S]=V.useState(null),[w,T]=V.useState(null),[A,O]=V.useState(null),[P,N]=V.useState(null),[R,M]=V.useState(0),[F,B]=V.useState(0),[$,W]=V.useState(!1),[K,te]=V.useState(!1),ne=$n(t,re=>m(re)),ae=Yv(s);return h.jsx(hCe,{scope:r,type:n,dir:ae,scrollHideDelay:o,scrollArea:i,viewport:y,onViewportChange:S,content:w,onContentChange:T,scrollbarX:A,onScrollbarXChange:O,scrollbarXEnabled:$,onScrollbarXEnabledChange:W,scrollbarY:P,onScrollbarYChange:N,scrollbarYEnabled:K,onScrollbarYEnabledChange:te,onCornerWidthChange:M,onCornerHeightChange:B,children:h.jsx(on.div,{dir:ae,...d,ref:ne,style:{position:"relative","--radix-scroll-area-corner-width":R+"px","--radix-scroll-area-corner-height":F+"px",...e.style}})})});Jne.displayName=_5;var Qne="ScrollAreaViewport",eie=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:s,...o}=e,d=Qu(Qne,r),i=V.useRef(null),m=$n(t,i,d.onViewportChange);return h.jsxs(h.Fragment,{children:[h.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),h.jsx(on.div,{"data-radix-scroll-area-viewport":"",...o,ref:m,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...e.style},children:h.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});eie.displayName=Qne;var ef="ScrollAreaScrollbar",x5=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=Qu(ef,e.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:d}=s,i=e.orientation==="horizontal";return V.useEffect(()=>(i?o(!0):d(!0),()=>{i?o(!1):d(!1)}),[i,o,d]),s.type==="hover"?h.jsx(fCe,{...n,ref:t,forceMount:r}):s.type==="scroll"?h.jsx(pCe,{...n,ref:t,forceMount:r}):s.type==="auto"?h.jsx(tie,{...n,ref:t,forceMount:r}):s.type==="always"?h.jsx(b5,{...n,ref:t}):null});x5.displayName=ef;var fCe=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=Qu(ef,e.__scopeScrollArea),[o,d]=V.useState(!1);return V.useEffect(()=>{const i=s.scrollArea;let m=0;if(i){const y=()=>{window.clearTimeout(m),d(!0)},S=()=>{m=window.setTimeout(()=>d(!1),s.scrollHideDelay)};return i.addEventListener("pointerenter",y),i.addEventListener("pointerleave",S),()=>{window.clearTimeout(m),i.removeEventListener("pointerenter",y),i.removeEventListener("pointerleave",S)}}},[s.scrollArea,s.scrollHideDelay]),h.jsx(zo,{present:r||o,children:h.jsx(tie,{"data-state":o?"visible":"hidden",...n,ref:t})})}),pCe=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=Qu(ef,e.__scopeScrollArea),o=e.orientation==="horizontal",d=ON(()=>m("SCROLL_END"),100),[i,m]=dCe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return V.useEffect(()=>{if(i==="idle"){const y=window.setTimeout(()=>m("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(y)}},[i,s.scrollHideDelay,m]),V.useEffect(()=>{const y=s.viewport,S=o?"scrollLeft":"scrollTop";if(y){let w=y[S];const T=()=>{const A=y[S];w!==A&&(m("SCROLL"),d()),w=A};return y.addEventListener("scroll",T),()=>y.removeEventListener("scroll",T)}},[s.viewport,o,m,d]),h.jsx(zo,{present:r||i!=="hidden",children:h.jsx(b5,{"data-state":i==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:Ir(e.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:Ir(e.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),tie=V.forwardRef((e,t)=>{const r=Qu(ef,e.__scopeScrollArea),{forceMount:n,...s}=e,[o,d]=V.useState(!1),i=e.orientation==="horizontal",m=ON(()=>{if(r.viewport){const y=r.viewport.offsetWidth<r.viewport.scrollWidth,S=r.viewport.offsetHeight<r.viewport.scrollHeight;d(i?y:S)}},10);return mb(r.viewport,m),mb(r.content,m),h.jsx(zo,{present:n||o,children:h.jsx(b5,{"data-state":o?"visible":"hidden",...s,ref:t})})}),b5=V.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,s=Qu(ef,e.__scopeScrollArea),o=V.useRef(null),d=V.useRef(0),[i,m]=V.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),y=aie(i.viewport,i.content),S={...n,sizes:i,onSizesChange:m,hasThumb:y>0&&y<1,onThumbChange:T=>o.current=T,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:T=>d.current=T};function w(T,A){return xCe(T,d.current,i,A)}return r==="horizontal"?h.jsx(mCe,{...S,ref:t,onThumbPositionChange:()=>{if(s.viewport&&o.current){const T=s.viewport.scrollLeft,A=hG(T,i,s.dir);o.current.style.transform=`translate3d(${A}px, 0, 0)`}},onWheelScroll:T=>{s.viewport&&(s.viewport.scrollLeft=T)},onDragScroll:T=>{s.viewport&&(s.viewport.scrollLeft=w(T,s.dir))}}):r==="vertical"?h.jsx(gCe,{...S,ref:t,onThumbPositionChange:()=>{if(s.viewport&&o.current){const T=s.viewport.scrollTop,A=hG(T,i);o.current.style.transform=`translate3d(0, ${A}px, 0)`}},onWheelScroll:T=>{s.viewport&&(s.viewport.scrollTop=T)},onDragScroll:T=>{s.viewport&&(s.viewport.scrollTop=w(T))}}):null}),mCe=V.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...s}=e,o=Qu(ef,e.__scopeScrollArea),[d,i]=V.useState(),m=V.useRef(null),y=$n(t,m,o.onScrollbarXChange);return V.useEffect(()=>{m.current&&i(getComputedStyle(m.current))},[m]),h.jsx(nie,{"data-orientation":"horizontal",...s,ref:y,sizes:r,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":PN(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.x),onDragScroll:S=>e.onDragScroll(S.x),onWheelScroll:(S,w)=>{if(o.viewport){const T=o.viewport.scrollLeft+S.deltaX;e.onWheelScroll(T),lie(T,w)&&S.preventDefault()}},onResize:()=>{m.current&&o.viewport&&d&&n({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:pO(d.paddingLeft),paddingEnd:pO(d.paddingRight)}})}})}),gCe=V.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...s}=e,o=Qu(ef,e.__scopeScrollArea),[d,i]=V.useState(),m=V.useRef(null),y=$n(t,m,o.onScrollbarYChange);return V.useEffect(()=>{m.current&&i(getComputedStyle(m.current))},[m]),h.jsx(nie,{"data-orientation":"vertical",...s,ref:y,sizes:r,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":PN(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.y),onDragScroll:S=>e.onDragScroll(S.y),onWheelScroll:(S,w)=>{if(o.viewport){const T=o.viewport.scrollTop+S.deltaY;e.onWheelScroll(T),lie(T,w)&&S.preventDefault()}},onResize:()=>{m.current&&o.viewport&&d&&n({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:pO(d.paddingTop),paddingEnd:pO(d.paddingBottom)}})}})}),[yCe,rie]=Yne(ef),nie=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:s,onThumbChange:o,onThumbPointerUp:d,onThumbPointerDown:i,onThumbPositionChange:m,onDragScroll:y,onWheelScroll:S,onResize:w,...T}=e,A=Qu(ef,r),[O,P]=V.useState(null),N=$n(t,ne=>P(ne)),R=V.useRef(null),M=V.useRef(""),F=A.viewport,B=n.content-n.viewport,$=no(S),W=no(m),K=ON(w,10);function te(ne){if(R.current){const ae=ne.clientX-R.current.left,re=ne.clientY-R.current.top;y({x:ae,y:re})}}return V.useEffect(()=>{const ne=ae=>{const re=ae.target;(O==null?void 0:O.contains(re))&&$(ae,B)};return document.addEventListener("wheel",ne,{passive:!1}),()=>document.removeEventListener("wheel",ne,{passive:!1})},[F,O,B,$]),V.useEffect(W,[n,W]),mb(O,K),mb(A.content,K),h.jsx(yCe,{scope:r,scrollbar:O,hasThumb:s,onThumbChange:no(o),onThumbPointerUp:no(d),onThumbPositionChange:W,onThumbPointerDown:no(i),children:h.jsx(on.div,{...T,ref:N,style:{position:"absolute",...T.style},onPointerDown:Ir(e.onPointerDown,ne=>{ne.button===0&&(ne.target.setPointerCapture(ne.pointerId),R.current=O.getBoundingClientRect(),M.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",A.viewport&&(A.viewport.style.scrollBehavior="auto"),te(ne))}),onPointerMove:Ir(e.onPointerMove,te),onPointerUp:Ir(e.onPointerUp,ne=>{const ae=ne.target;ae.hasPointerCapture(ne.pointerId)&&ae.releasePointerCapture(ne.pointerId),document.body.style.webkitUserSelect=M.current,A.viewport&&(A.viewport.style.scrollBehavior=""),R.current=null})})})}),fO="ScrollAreaThumb",iie=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=rie(fO,e.__scopeScrollArea);return h.jsx(zo,{present:r||s.hasThumb,children:h.jsx(vCe,{ref:t,...n})})}),vCe=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...s}=e,o=Qu(fO,r),d=rie(fO,r),{onThumbPositionChange:i}=d,m=$n(t,w=>d.onThumbChange(w)),y=V.useRef(void 0),S=ON(()=>{y.current&&(y.current(),y.current=void 0)},100);return V.useEffect(()=>{const w=o.viewport;if(w){const T=()=>{if(S(),!y.current){const A=bCe(w,i);y.current=A,i()}};return i(),w.addEventListener("scroll",T),()=>w.removeEventListener("scroll",T)}},[o.viewport,S,i]),h.jsx(on.div,{"data-state":d.hasThumb?"visible":"hidden",...s,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Ir(e.onPointerDownCapture,w=>{const A=w.target.getBoundingClientRect(),O=w.clientX-A.left,P=w.clientY-A.top;d.onThumbPointerDown({x:O,y:P})}),onPointerUp:Ir(e.onPointerUp,d.onThumbPointerUp)})});iie.displayName=fO;var w5="ScrollAreaCorner",sie=V.forwardRef((e,t)=>{const r=Qu(w5,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?h.jsx(_Ce,{...e,ref:t}):null});sie.displayName=w5;var _Ce=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,s=Qu(w5,r),[o,d]=V.useState(0),[i,m]=V.useState(0),y=!!(o&&i);return mb(s.scrollbarX,()=>{var w;const S=((w=s.scrollbarX)==null?void 0:w.offsetHeight)||0;s.onCornerHeightChange(S),m(S)}),mb(s.scrollbarY,()=>{var w;const S=((w=s.scrollbarY)==null?void 0:w.offsetWidth)||0;s.onCornerWidthChange(S),d(S)}),y?h.jsx(on.div,{...n,ref:t,style:{width:o,height:i,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function pO(e){return e?parseInt(e,10):0}function aie(e,t){const r=e/t;return isNaN(r)?0:r}function PN(e){const t=aie(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function xCe(e,t,r,n="ltr"){const s=PN(r),o=s/2,d=t||o,i=s-d,m=r.scrollbar.paddingStart+d,y=r.scrollbar.size-r.scrollbar.paddingEnd-i,S=r.content-r.viewport,w=n==="ltr"?[0,S]:[S*-1,0];return oie([m,y],w)(e)}function hG(e,t,r="ltr"){const n=PN(t),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,o=t.scrollbar.size-s,d=t.content-t.viewport,i=o-n,m=r==="ltr"?[0,d]:[d*-1,0],y=vT(e,m);return oie([0,d],[0,i])(y)}function oie(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function lie(e,t){return e>0&&e<t}var bCe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function s(){const o={left:e.scrollLeft,top:e.scrollTop},d=r.left!==o.left,i=r.top!==o.top;(d||i)&&t(),r=o,n=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(n)};function ON(e,t){const r=no(e),n=V.useRef(0);return V.useEffect(()=>()=>window.clearTimeout(n.current),[]),V.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function mb(e,t){const r=no(t);io(()=>{let n=0;if(e){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return s.observe(e),()=>{window.cancelAnimationFrame(n),s.unobserve(e)}}},[e,r])}var cie=Jne,wCe=eie,SCe=sie;const Ov=V.forwardRef(({className:e,children:t,...r},n)=>h.jsxs(cie,{ref:n,className:fr("relative overflow-hidden",e),...r,children:[h.jsx(wCe,{className:"h-full w-full rounded-[inherit]",children:t}),h.jsx(uie,{}),h.jsx(SCe,{})]}));Ov.displayName=cie.displayName;const uie=V.forwardRef(({className:e,orientation:t="vertical",...r},n)=>h.jsx(x5,{ref:n,orientation:t,className:fr("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:h.jsx(iie,{className:"relative flex-1 rounded-full bg-border"})}));uie.displayName=x5.displayName;const{slice:ECe,forEach:TCe}=[];function ACe(e){return TCe.call(ECe.call(arguments,1),t=>{if(t)for(const r in t)e[r]===void 0&&(e[r]=t[r])}),e}function CCe(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(e))}const fG=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,jCe=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},s=encodeURIComponent(t);let o=`${e}=${s}`;if(n.maxAge>0){const d=n.maxAge-0;if(Number.isNaN(d))throw new Error("maxAge should be a Number");o+=`; Max-Age=${Math.floor(d)}`}if(n.domain){if(!fG.test(n.domain))throw new TypeError("option domain is invalid");o+=`; Domain=${n.domain}`}if(n.path){if(!fG.test(n.path))throw new TypeError("option path is invalid");o+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(o+="; HttpOnly"),n.secure&&(o+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(o+="; Partitioned"),o},pG={create(e,t,r,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(s.expires=new Date,s.expires.setTime(s.expires.getTime()+r*60*1e3)),n&&(s.domain=n),document.cookie=jCe(e,t,s)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let n=0;n<r.length;n++){let s=r[n];for(;s.charAt(0)===" ";)s=s.substring(1,s.length);if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var PCe={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return pG.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:n,cookieDomain:s,cookieOptions:o}=t;r&&typeof document<"u"&&pG.create(r,e,n,s,o)}},OCe={name:"querystring",lookup(e){var n;let{lookupQuerystring:t}=e,r;if(typeof window<"u"){let{search:s}=window.location;!window.location.search&&((n=window.location.hash)==null?void 0:n.indexOf("?"))>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));const d=s.substring(1).split("&");for(let i=0;i<d.length;i++){const m=d[i].indexOf("=");m>0&&d[i].substring(0,m)===t&&(r=d[i].substring(m+1))}}return r}},kCe={name:"hash",lookup(e){var s;let{lookupHash:t,lookupFromHashIndex:r}=e,n;if(typeof window<"u"){const{hash:o}=window.location;if(o&&o.length>2){const d=o.substring(1);if(t){const i=d.split("&");for(let m=0;m<i.length;m++){const y=i[m].indexOf("=");y>0&&i[m].substring(0,y)===t&&(n=i[m].substring(y+1))}}if(n)return n;if(!n&&r>-1){const i=o.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?(s=i[typeof r=="number"?r:0])==null?void 0:s.replace("/",""):void 0}}}return n}};let Ux=null;const mG=()=>{if(Ux!==null)return Ux;try{if(Ux=typeof window<"u"&&window.localStorage!==null,!Ux)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{Ux=!1}return Ux};var NCe={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&mG())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&mG()&&window.localStorage.setItem(r,e)}};let Vx=null;const gG=()=>{if(Vx!==null)return Vx;try{if(Vx=typeof window<"u"&&window.sessionStorage!==null,!Vx)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{Vx=!1}return Vx};var ICe={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&gG())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&gG()&&window.sessionStorage.setItem(r,e)}},RCe={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:r,userLanguage:n,language:s}=navigator;if(r)for(let o=0;o<r.length;o++)t.push(r[o]);n&&t.push(n),s&&t.push(s)}return t.length>0?t:void 0}},MCe={name:"htmlTag",lookup(e){let{htmlTag:t}=e,r;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(r=n.getAttribute("lang")),r}},DCe={name:"path",lookup(e){var s;let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?(s=r[typeof t=="number"?t:0])==null?void 0:s.replace("/",""):void 0}},LCe={name:"subdomain",lookup(e){var s,o;let{lookupFromSubdomainIndex:t}=e;const r=typeof t=="number"?t+1:1,n=typeof window<"u"&&((o=(s=window.location)==null?void 0:s.hostname)==null?void 0:o.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(n)return n[r]}};let die=!1;try{document.cookie,die=!0}catch{}const hie=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];die||hie.splice(1,1);const FCe=()=>({order:hie,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class fie{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,r)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=ACe(r,this.options||{},FCe()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=s=>s.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(PCe),this.addDetector(OCe),this.addDetector(NCe),this.addDetector(ICe),this.addDetector(RCe),this.addDetector(MCe),this.addDetector(DCe),this.addDetector(LCe),this.addDetector(kCe)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return t.forEach(n=>{if(this.detectors[n]){let s=this.detectors[n].lookup(this.options);s&&typeof s=="string"&&(s=[s]),s&&(r=r.concat(s))}}),r=r.filter(n=>n!=null&&!CCe(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||r.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}fie.type="languageDetector";const zCe={en:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Home","nav.mapView":"Private Map","nav.restaurants":"Restaurants","nav.activities":"Activities","nav.profile":"Profile","nav.signIn":"Sign In","nav.signOut":"Sign Out","nav.myAccount":"My Account","nav.admin":"Admin Panel","nav.manageRestaurants":"Manage Restaurants","nav.joinUs":"Restaurant Join","map.subtitle":"Explore nearby featured restaurants","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Discover Nearby Cuisine","home.hero.subtitle":"Your Culinary Journey Starts Here","home.hero.description":"Explore curated restaurants across cities, join exciting food events, and connect with fellow food lovers;","home.hero.exploreBtn":"Explore Restaurants","home.hero.activitiesBtn":"View Activities","home.features.title":"Why Choose Us?","home.features.description":"Discover Cuisine; Share Experiences; Join Activities;","home.features.map.title":"Smart Map","home.features.map.desc":"Find nearby restaurants with our intelligent location-based search and interactive map view;","home.features.reviews.title":"Trusted Reviews","home.features.reviews.desc":"Read authentic reviews and ratings from verified diners to make informed decisions;","home.features.events.title":"Exclusive Events","home.features.events.desc":"Join special dining events, food festivals, and connect with the culinary community;","home.cta.title":"Ready to Start?","home.cta.description":"Join Xiaoxiong Market and reach thousands of food lovers. Grow your business with us;","home.cta.button":"Restaurant Join","home.stats.delivery":"Take Away","home.stats.reservation":"Reservation","restaurants.title":"Restaurants","restaurants.search":"Search name, address, postal code...","restaurants.noResults":"No restaurants found","restaurants.noResultsDesc":"Try adjusting your search or filters","restaurants.viewDetails":"View Details","restaurants.addToFavorite":"Add to favorites","restaurants.removeFromFavorite":"Remove from favorites","restaurants.mustSignIn":"Please sign in to favorite restaurants","restaurants.listView":"List View","restaurants.mapView":"Map View","restaurants.sortByDistance":"Sort by Distance","restaurants.sortedByDistance":"Sorted by distance","restaurants.radius":"Radius","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"All Restaurants","restaurants.getLocation":"Get My Location","restaurants.locationEnabled":"Location Enabled","restaurants.directions":"Get Directions","restaurants.distanceAway":"{{distance}} km away","restaurants.restaurantTypes":"Restaurant Types","restaurant.address":"Address","restaurant.phone":"Phone","restaurant.hours":"Hours","restaurant.today":"Today","restaurant.closed":"Closed","restaurant.dayMon":"Mon","restaurant.dayTue":"Tue","restaurant.dayWed":"Wed","restaurant.dayThu":"Thu","restaurant.dayFri":"Fri","restaurant.daySat":"Sat","restaurant.daySun":"Sun","restaurant.website":"Website","restaurant.visitWebsite":"Visit Website","restaurant.getDirections":"Get Directions","restaurant.callNow":"Call Now","restaurant.joinPrivate":"Join Private Domain","restaurant.reviews":"Reviews","restaurant.addReview":"Add Review","restaurant.rating":"Rating","restaurant.edited":"Edited","restaurant.reply":"Reply","restaurant.writeComment":"Write a comment...","restaurant.writeReply":"Write a reply...","restaurant.postComment":"Post Comment","restaurant.signInToComment":"Please sign in to comment","restaurant.signInToRate":"Please sign in to rate this restaurant","restaurant.noComments":"No comments yet. Be the first to share your experience!","restaurant.confirmDelete":"Are you sure you want to delete this comment?","restaurant.ratingsCount":"ratings","restaurant.yourRating":"Your rating","restaurant.rateThisRestaurant":"Rate this restaurant","restaurant.photoGallery":"Photo Gallery","restaurant.addImage":"Add Image","restaurant.imageUploadFailed":"Failed to upload image","restaurant.imageTooLarge":"Image size must be less than 5MB","restaurant.priceRange":"Price Range (Optional)","restaurant.selectPriceRange":"Select price range...","activities.title":"Activities","activities.description":"Join exclusive dining experiences and culinary events","activities.viewDetails":"View Details","activities.joinEvent":"Join Event","activities.joined":"Joined","activities.subscribe":"Subscribe","activities.subscribed":"Subscribed","activities.subscribers":"subscribers","activities.subscribersCount":"subscribers","activities.participants":"participants","activities.restaurantsParticipating":"restaurants participating","activities.until":"Until","activities.shareSuccess":"Activity shared successfully","activities.linkCopied":"Link copied to clipboard","activities.shareError":"Failed to share activity","activities.pinned":"Pinned","activities.ended":"Ended","activities.ongoing":"Ongoing","activities.signInToJoin":"Please sign in to join this activity","activities.signInToJoinHint":"Stay updated with the latest activity notifications","activities.signInToSubscribe":"Please sign in","activities.signInToSubscribeDesc":"You need to sign in to subscribe to activities","activities.about":"About This Activity","activities.participatingRestaurants":"Participating Restaurants","activities.repeat.none":"One-time","activities.repeat.daily":"Daily","activities.repeat.weekly":"Weekly","activities.repeat.monthly":"Monthly","activities.repeat.yearly":"Yearly","activities.serviceType.dine_in":"Dine-in","activities.serviceType.takeaway":"Takeaway","activities.serviceType.both":"Dine-in & Takeaway","activities.creatorLabel":"Creator:","activities.createdByPlatform":"Platform","activities.rules":"Activity Rules","activities.rulesTitle":"Activity Rules","activities.usageInstructions":"How to Use","activities.noActivities":"No activities available","profile.title":"My Profile","profile.settings":"Settings","profile.profile":"Profile","profile.favorites":"Favorites","profile.reviews":"Reviews","profile.comments":"Comments","profile.activities":"Activities","profile.favoriteRestaurants":"My Favorite Restaurants","profile.favoritesDesc":"Restaurants you've bookmarked for future visits","profile.myReviews":"My Reviews","profile.myComments":"My Comments","profile.reviewsDesc":"Your ratings and reviews for restaurants","profile.commentsDesc":"Comments you've posted on restaurants and activities","profile.joinedActivities":"Joined Activities","profile.activitiesDesc":"Events and activities you're participating in","profile.noActivities":"No activities joined yet. Check out our","profile.noFavorites":"No favorite restaurants yet","profile.noComments":"No comments yet","profile.upcomingEvents":"upcoming events","profile.participatedActivities":"Participated Activities","profile.participatedActivitiesDesc":"View all activities your restaurants participated in","profile.personalActivities":"Personal Activities","profile.restaurantActivities":"Restaurant Activities","profile.participatingRestaurants":"Participating Restaurants","profile.noParticipatedActivities":"You haven't participated in any activities yet.","profile.browseActivities":"Browse activities","profile.editProfile":"Edit Profile","profile.editProfileDescription":"Update your profile information","profile.displayName":"Display Name","profile.phone":"Phone","profile.phonePlaceholder":"Enter phone number","profile.addPhoneNumber":"Add phone number","profile.modifyPhoneNumber":"Modify","profile.uploadAvatar":"Upload Avatar","profile.joinedOn":"Joined on","profile.deleteAccount":"Delete Account","profile.deleteAccountWarning":"Warning: This action is permanent","profile.deleteAccountDescription":"Deleting your account will permanently remove all your data, including your profile, favorites, comments, and activity subscriptions. This action cannot be undone.","profile.confirmDeleteAccount":"Final Confirmation Required","profile.confirmDeleteDescription":"This is your last chance. All your data will be permanently deleted and cannot be recovered.","profile.typeDeleteToConfirm":"Type DELETE to confirm","profile.deleteAccountSuccess":"Account deleted successfully","profile.deleteAccountFailed":"Failed to delete account","profile.activityTermsTitle":"Activity Terms Agreement","profile.activityTermsDescription":"Merchants and supervisors must agree to activity terms before participating","profile.activityTermsAgreedStatus":"Agreed","profile.activityTermsNotAgreed":"Not Agreed","profile.viewFullRules":"View Full Rules","profile.agreeToTerms":"I agree to the activity terms","profile.agreedOn":"Agreed","profile.activityTermsAgreed":"Activity terms accepted","profile.activityTermsRevoked":"Activity terms revoked","profile.activityTermsUpdateFailed":"Failed to update activity terms agreement","profile.changeEmail":"Change Email","profile.verifyOldEmail":"Verify Current Email","profile.verifyNewEmail":"Enter New Email","profile.confirmEmailUpdate":"Confirm Email Update","profile.oldEmailStep":"Step 1/3: We need to verify your current email","profile.newEmailStep":"Step 2/3: Enter your new email address","profile.confirmEmailStep":"Step 3/3: Confirm your email update","profile.currentEmail":"Current Email","profile.newEmail":"New Email","profile.verificationCode":"Verification Code","profile.sendCode":"Send Code","profile.codeSent":"Sent","profile.enterCode":"Enter 4-digit code","profile.verify":"Verify","profile.updateEmail":"Update Email","profile.codeSentToOldEmail":"Verification code sent to your old email","profile.codeSentToNewEmail":"Verification code sent to your new email","profile.sendCodeFailed":"Failed to send verification code","profile.enterCodePlaceholder":"Please enter verification code","profile.codeIncorrect":"Verification code is incorrect or expired","profile.verificationFailed":"Verification failed","profile.oldEmailVerified":"Old email verified successfully","profile.newEmailVerified":"New email verified successfully","profile.enterValidEmail":"Please enter a valid email address","profile.pleaseSignIn":"Please sign in first","profile.emailUpdated":"Email updated successfully, please sign in with your new email","profile.emailUpdateFailed":"Failed to update email","profile.enterNewEmail":"Enter your new email address","profile.role.user":"User","profile.role.merchant":"Merchant","profile.role.supervisor":"Supervisor","profile.role.admin":"Admin","profile.changePassword":"Change Password","profile.changePasswordDescription":"Update your account password","profile.verifyOldPassword":"Verify Current Password","profile.oldPasswordStep":"Step 1/2: Verify your identity","profile.currentPassword":"Current Password","profile.enterCurrentPassword":"Enter current password","profile.forgotPassword":"Forgot password?","profile.useEmailVerification":"Use email verification instead","profile.oldPasswordVerified":"Password verified successfully","profile.oldPasswordIncorrect":"Current password is incorrect","profile.setNewPassword":"Set New Password","profile.newPasswordStep":"Step 2/2: Enter your new password","profile.newPassword":"New Password","profile.confirmNewPassword":"Confirm New Password","profile.enterNewPassword":"Enter new password (min 6 characters)","profile.confirmNewPasswordPlaceholder":"Enter new password again","profile.passwordsDontMatch":"Passwords don't match","profile.passwordTooShort":"Password must be at least 6 characters","profile.passwordUpdated":"Password updated successfully","profile.passwordUpdateFailed":"Failed to update password","profile.updatePassword":"Update Password","report.title":"Report","report.reportComment":"Report Comment","report.reportRestaurant":"Report Restaurant","report.reportActivity":"Report Activity","report.reportUser":"Report User","report.description":"Help us maintain a safe community","report.reason":"Reason for Report","report.reasonPlaceholder":"Select a reason","report.reasons":{spam:"Spam or Advertising",harassment:"Harassment or Bullying",inappropriate_content:"Inappropriate Content",misinformation:"Misinformation",copyright:"Copyright Violation",fraud:"Fraud or Scam",hate_speech:"Hate Speech",violence:"Violence or Threats",other:"Other"},"report.detailsLabel":"Details","report.detailsPlaceholder":"Please provide detailed information about this report (required, minimum 20 characters)","report.detailsMin":"Details must be at least 20 characters","report.contactLabel":"Contact Email","report.contactPlaceholder":"Your email for follow-up","report.contactRequired":"Contact email is required","report.invalidEmail":"Please enter a valid email address","report.evidenceLabel":"Evidence URLs","report.evidenceRequired":"At least one evidence (image or URL) is required","report.evidenceRequiredNote":"Please upload at least one image or provide a link","report.uploadImages":"Upload Images","report.evidenceUrls":"Or Provide URLs","report.imageUploadHint":"Supported formats: JPG, PNG, WEBP, GIF. Max 5MB per image","report.imageTooLarge":"Image size must be less than 5MB","report.invalidImageType":"Only JPG, PNG, WEBP, and GIF formats are supported","report.imageUploadFailed":"Failed to upload images. Please try again","report.evidencePlaceholder":"Add screenshot or evidence URL","report.addEvidence":"Add Evidence","report.removeEvidence":"Remove","report.submit":"Submit Report","report.submitting":"Submitting...","report.success":"Report submitted successfully. We will review it soon.","report.successDetailed":"Report submitted successfully! Reference: {{reference}}","report.successDescription":"We will review your report within 24-48 hours. You will receive an email notification at the contact address you provided once the review is complete. Thank you for helping us maintain a safe community!","report.failed":"Failed to submit report","report.cancel":"Cancel","report.confirmTitle":"Confirm Report Submission","report.confirmMessage":"Are you sure you want to submit this report? False reports may result in account restrictions.","admin.reports":"Reports","admin.reportsDescription":"Manage user reports","admin.totalReports":"Total Reports","admin.allReportsCount":"All submitted reports","admin.awaitingReview":"Awaiting review","admin.underReview":"Under review","admin.resolvedReports":"Resolved reports","admin.dismissedReports":"Dismissed reports","admin.allReports":"All Reports","admin.manageReportsDesc":"View and manage all user reports","admin.searchReports":"Search reports by description, reporter, or reason...","admin.noReports":"No reports yet","admin.reportStatus":{pending:"Pending",reviewing:"Reviewing",resolved:"Resolved",dismissed:"Dismissed"},"admin.reportType":{comment:"Comment",restaurant:"Restaurant",activity:"Activity",user:"User"},"admin.reportedBy":"Reported By","admin.reportedAt":"Reported At","admin.viewReport":"View Report","admin.updateStatus":"Update Status","admin.adminNotes":"Admin Notes","admin.saveNotes":"Save Notes","auth.welcome":"Welcome to Xiaoxiong Market","auth.subtitle":"Discover amazing restaurants and join exciting dining events","auth.login":"Login","auth.register":"Email Register","auth.phone":"Phone","auth.email":"Email","auth.password":"Password","auth.displayName":"Display Name","auth.phoneOptional":"Phone (Optional)","auth.phoneNumber":"Phone Number","auth.phoneMin":"Please enter a valid phone number","auth.phoneHint":"Enter your phone number with country code (e.g., +351 912 345 678)","auth.confirmPassword":"Confirm Password","auth.signIn":"Sign In","auth.signingIn":"Signing in...","auth.sendCode":"Send Code","auth.sendingCode":"Sending...","auth.verificationCode":"Verification Code","auth.verify":"Verify","auth.verifying":"Verifying...","auth.otpLength":"Code must be 6 digits","auth.otpSent":"Verification code sent to your phone","auth.otpHint":"Enter the 6-digit code sent to {{phone}}","auth.createAccount":"Create Account","auth.creatingAccount":"Creating account...","auth.orContinueWith":"Or continue with","auth.google":"Google","auth.backToHome":"Back to home","auth.invalidEmail":"Invalid email address","auth.passwordMin":"Password must be at least 6 characters","auth.passwordPlaceholder":"Minimum 6 characters","auth.passwordStrength":{weak:"Weak password - Add uppercase, numbers, or symbols",medium:"Medium password - Consider adding more variety",strong:"Strong password"},"auth.displayNameMin":"Display name must be at least 2 characters","auth.passwordsDontMatch":"Passwords don't match","auth.invalidCredentials":"Invalid email or password","auth.emailExists":"This email is already registered","auth.signInSuccess":"Successfully signed in!","auth.signUpSuccess":"Account created successfully! You can now sign in.","auth.verificationCodeSent":"Verification code sent to your email","auth.verificationCodeFailed":"Failed to send verification code","auth.invalidVerificationCode":"Invalid verification code","auth.verificationCodeUsed":"This verification code has already been used. Please request a new one.","auth.verificationCodeHint":"Please enter the 4-digit verification code sent to {{email}}","auth.resendCode":"Resend Code","auth.resendIn":"Resend in {{seconds}}s","common.loading":"Loading...","common.error":"Error","common.success":"Success","common.cancel":"Cancel","common.confirm":"Confirm","common.continue":"Continue","common.save":"Save","common.delete":"Delete","common.edit":"Edit","common.submit":"Submit","common.back":"Back","common.next":"Next","common.previous":"Previous","common.search":"Search","common.filter":"Filter","common.sort":"Sort","common.actions":"Actions","common.km":"km","common.uploading":"Uploading...","common.deleting":"Deleting...","common.enterPlaceholder":"Enter...","common.selectPlaceholder":"Select...","common.share":"Share","common.copyLink":"Copy Link","common.moreOptions":"More Options","common.shareVia":"Share via","common.linkCopied":"Link copied to clipboard","common.shareSuccess":"Shared successfully","common.shareError":"Failed to share","common.actions.clearFilter":"Clear Filter","common.showMore":"Show More","common.showLess":"Show Less","common.showDetails":"Show Details","common.hideDetails":"Hide Details","common.processing":"Processing...","common.loadMore":"Load More","notifications.title":"Notifications","notifications.markAllRead":"Mark all read","notifications.noNotifications":"No notifications yet","notifications.markAsReadError":"Failed to mark notification as read","notifications.markAllAsReadSuccess":"All notifications marked as read","notifications.markAllAsReadError":"Failed to mark all notifications as read","notifications.userNotAuthenticated":"User not authenticated","admin.management":"Management","admin.dashboard":"Dashboard","admin.users":"Users","admin.restaurants":"Restaurants","admin.activities":"Activities","admin.logs":"Operation Logs","admin.userManagement":"User Management","admin.restaurantManagement":"Restaurant Management","admin.activityManagement":"Activity Management","admin.operationLogs":"Operation Logs","admin.manageUserRoles":"Manage user roles and permissions","admin.manageRestaurants":"View and manage all restaurants","admin.manageActivities":"View and manage all activities","admin.viewSystemLogs":"View all system operation logs","admin.dashboardDescription":"Overview of system statistics","admin.totalUsers":"Total Users","admin.totalRestaurants":"Total Restaurants","admin.totalActivities":"Total Activities","admin.totalComments":"Total Comments","admin.registeredUsers":"Registered users","admin.listedRestaurants":"Listed restaurants","admin.activeEvents":"Active events","admin.userReviews":"User reviews and comments","admin.recentActivity":"Recent Activity","admin.recentActivityDescription":"Latest system activities","admin.viewLogsForDetails":"View operation logs for detailed activity","admin.selectRole":"Select a role","admin.assignRole":"Assign Role","admin.confirmRemoveRole":"Are you sure you want to remove this role?","admin.noPhone":"No phone number","admin.addRestaurant":"Add Restaurant","admin.addActivity":"Add Activity","admin.editActivity":"Edit Activity","admin.activityCreated":"Activity created successfully","admin.activityUpdated":"Activity updated successfully","admin.confirmDelete":"Confirm Deletion","admin.deleteActivityWarning":"This will permanently delete the activity and all associated data. This action cannot be undone.","admin.activityImage":"Activity Image","admin.uploadImage":"Upload Image","admin.titleEnglish":"Title (English)","admin.titleChinese":"Title (Chinese)","admin.titlePortuguese":"Title (Portuguese)","admin.contentEnglish":"Content (English)","admin.contentChinese":"Content (Chinese)","admin.contentPortuguese":"Content (Portuguese)","admin.startDate":"Start Date","admin.endDate":"End Date","admin.pickDate":"Pick a date","admin.repeatMode":"Repeat Mode","admin.selectRepeatMode":"Select repeat mode","admin.serviceType":"Service Type","admin.selectServiceType":"Select service type","admin.repeatNone":"No Repeat","admin.repeatDaily":"Daily","admin.repeatWeekly":"Weekly","admin.repeatMonthly":"Monthly","admin.repeatYearly":"Yearly","admin.associatedRestaurants":"Associated Restaurants","admin.pinned":"Pinned","admin.sortOrder":"Sort Order","admin.editRestaurant":"Edit Restaurant","admin.restaurantCreated":"Restaurant created successfully","admin.restaurantUpdated":"Restaurant updated successfully","admin.deleteRestaurantWarning":"This will permanently delete the restaurant and all associated data. This action cannot be undone.","admin.restaurantImage":"Restaurant Image","admin.nameChinese":"Name (Chinese)","admin.nameEnglish":"Name (English)","admin.namePortuguese":"Name (Portuguese)","admin.typeChinese":"Type (Chinese)","admin.typeEnglish":"Type (English)","admin.typePortuguese":"Type (Portuguese)","admin.restaurantTypes":"Restaurant Types","admin.tags":"tags","admin.addType":"Add Type","admin.descriptionChinese":"Description (Chinese)","admin.descriptionEnglish":"Description (English)","admin.descriptionPortuguese":"Description (Portuguese)","admin.address":"Address","admin.phone":"Phone","admin.website":"Website","admin.showWebsiteButton":"Show Website Button","admin.location":"Location","admin.locationOnMap":"Location on Map","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Click on the map or drag the marker to set the location","admin.mapInstructions":"Click on the map or drag the marker to set the location","admin.openingHours":"Opening Hours","admin.closed":"Closed","admin.day.monday":"Monday","admin.day.tuesday":"Tuesday","admin.day.wednesday":"Wednesday","admin.day.thursday":"Thursday","admin.day.friday":"Friday","admin.day.saturday":"Saturday","admin.day.sunday":"Sunday","admin.userGrowth":"User Growth Trend","admin.userGrowthDescription":"Cumulative user registration over time","admin.activityEngagement":"Activity Engagement","admin.activityEngagementDescription":"Subscribers and comments per activity","admin.topRestaurants":"Top Restaurants","admin.topRestaurantsDescription":"Restaurants ranked by rating and engagement","admin.subscribers":"Subscribers","admin.comments":"Comments","admin.rating":"Rating","admin.noData":"No data available","admin.exportCSV":"Export CSV","admin.exportSuccess":"Data exported successfully","admin.noDataToExport":"No data available to export","admin.batchDelete":"Batch Delete","admin.batchAssignRole":"Batch Assign Role","admin.selectedCount":"{{count}} selected","admin.confirmBatchDelete":"Confirm Batch Delete","admin.batchDeleteWarning":"This will permanently delete {{count}} items. This action cannot be undone.","admin.clearSelection":"Clear Selection","admin.selectAll":"Select All","admin.searchUsers":"Search by name or phone...","admin.searchRestaurants":"Search by name or address...","admin.searchActivities":"Search by title or content...","admin.filterByRole":"Filter by role","admin.filterByType":"Filter by type","admin.filterByStatus":"Filter by status","admin.allRoles":"All Roles","admin.allTypes":"All Types","admin.allStatus":"All Status","admin.statusActive":"Active","admin.statusEnded":"Ended","admin.statusPinned":"Pinned","admin.view":"View","admin.createMerchant":"Create Merchant","admin.createSupervisor":"Create Supervisor","admin.createUser":"Create User","admin.createNewUser":"Create New User","admin.createUserDescription":"Create a new merchant or supervisor account","admin.userCreated":"User created successfully","admin.createUserError":"Failed to create user","admin.role":"Role","admin.create":"Create","admin.oldData":"Old Data","admin.newData":"New Data","admin.noLogs":"No operation logs yet","admin.merchant":"Merchant","admin.supervisor":"Supervisor","admin.editActivityDetails":"Edit activity details, dates and settings","admin.createActivityWithContent":"Create new activity with multilingual content and rich formatting","admin.imageMaxSize":"PNG, JPG Max 5MB","admin.imageTooBig":"Image size must be less than 10MB","admin.cropImage":"Crop Image","admin.cropImageDescription":"Adjust the crop area to fit the recommended size","admin.recommendedSize":"Recommended Size","admin.imageSizeHint":"The image will be displayed at this aspect ratio across all devices (desktop, tablet, mobile)","admin.confirmCrop":"Confirm Crop","admin.multilingualContent":"Multilingual Content","admin.chinese":"Chinese","admin.english":"English","admin.portuguese":"Portuguese","admin.title":"Title","admin.content":"Content","admin.enterTitle":"Enter activity title...","admin.enterContent":"Enter detailed activity content with rich text formatting...","admin.dateSettings":"Date Settings","admin.selectDate":"Select date","admin.displaySettings":"Display Settings","admin.pinToTop":"Pin to Top","admin.showAtTop":"Show this activity at the top of the list","admin.lowerFirst":"Lower numbers appear first","admin.selectParticipatingRestaurants":"Select participating restaurants","admin.editRestaurantDetails":"Edit restaurant details, location, hours and settings","admin.createRestaurantWithInfo":"Create new restaurant with multilingual content and complete information","admin.restaurantName":"Restaurant Name","admin.enterRestaurantName":"Enter restaurant name...","admin.restaurantType":"Restaurant Type (1-3 tags)","admin.typeExample":"e.g. Cantonese","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Enter restaurant description...","admin.contactAndWebsite":"Contact & Website","admin.enterAddress":"Enter address...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Click on the map or drag the marker to set the location","admin.weekdays":"Weekdays","admin.weekend":"Weekend","admin.copyToAll":"Copy to All Days","admin.splitShift":"Split Shift","admin.open":"Open","admin.close":"Close","admin.afternoon":"Afternoon","admin.evening":"Evening","admin.visible":"Visible","admin.showInFrontend":"Show this restaurant in the frontend","common.saving":"Saving...","merchant.myRestaurants":"My Restaurants","merchant.merchantDescription":"Manage your restaurant information and settings","merchant.supervisorDescription":"Manage all restaurants under your supervision","merchant.noRestaurants":"No restaurants assigned yet","joinUs.title":"Join Xiaoxiong Market","joinUs.description":"Partner with us to grow your restaurant business. Fill out the form below and our team will contact you soon.","joinUs.name":"Name","joinUs.namePlaceholder":"Your full name","joinUs.email":"Email","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"Phone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Restaurant Name","joinUs.restaurantNamePlaceholder":"Your restaurant name","joinUs.restaurantAddress":"Restaurant Address (Optional)","joinUs.restaurantAddressPlaceholder":"Street address, city","joinUs.optional":"Optional","joinUs.featuresNeeded":"Features Needed","joinUs.featuresDescription":"Select at least one feature you're interested in","joinUs.feature.booking":"Table Booking","joinUs.feature.delivery":"Delivery Service","joinUs.feature.qrcode":"QR Code Menu","joinUs.submit":"Submit Request","joinUs.nameMin":"Name must be at least 2 characters","joinUs.emailInvalid":"Invalid email address","joinUs.phoneMin":"Phone must be at least 6 characters","joinUs.restaurantNameMin":"Restaurant name must be at least 2 characters","joinUs.addressMin":"Restaurant address must be at least 2 characters","joinUs.featuresMin":"Please select at least one feature","joinUs.consentText":"By registering, you agree to receive marketing emails and promotional offers. For details, please review our Privacy Policy and Terms of Service.","joinUs.successTitle":"Request Submitted!","joinUs.successDescription":"Thank you for your trust!","joinUs.successMessage":"Your information has been successfully submitted! Thank you for your trust! Our dedicated consultant will contact you by phone within 24 business hours.","joinUs.submitAnother":"Submit Another Request","joinUs.submitError":"Failed to submit request. Please try again.","joinUs.rateLimitError":"Too Many Requests","joinUs.rateLimitErrorDesc":"You have already submitted a request in the last 24 hours. Please try again later.","joinUs.adminTitle":"Join Requests Management","joinUs.adminDescription":"View and manage all merchant join requests","joinUs.recipientEmail":"Recipient Email","joinUs.recipientEmailDesc":"Email address where join requests will be sent","joinUs.totalRequests":"Total Requests","joinUs.totalRequestsDesc":"All time join requests received","joinUs.allRequests":"All Join Requests","joinUs.allRequestsDesc":"View and manage all submitted join requests","joinUs.searchPlaceholder":"Search by name, email, restaurant...","joinUs.contact":"Contact","joinUs.restaurant":"Restaurant","joinUs.submittedAt":"Submitted","joinUs.noRequests":"No join requests yet","joinUs.enterNewEmail":"Enter new recipient email:","joinUs.emailUpdated":"Recipient email updated successfully","joinUs.emailUpdateError":"Failed to update recipient email","joinUs.status":"Status","joinUs.status.pending":"Pending","joinUs.status.completed":"Completed","joinUs.status.rejected":"Rejected","joinUs.statusUpdated":"Status updated successfully","joinUs.statusUpdateError":"Failed to update status","joinUs.requestDeleted":"Request deleted successfully","joinUs.deleteError":"Failed to delete request","joinUs.confirmDelete":"Delete Request","joinUs.confirmDeleteDescription":"Are you sure you want to delete this request? This action cannot be undone.","toast.subscribed":"Subscribed!","toast.unsubscribed":"Unsubscribed","toast.subscribedDesc":"You've joined this activity","toast.unsubscribedDesc":"You've left this activity","toast.subscriptionFailed":"Failed to update subscription","toast.roleChanged":"Role changed successfully","toast.roleChangeFailed":"Failed to change role","toast.profileUpdated":"Profile updated successfully","toast.profileUpdateFailed":"Failed to update profile","toast.avatarUploadFailed":"Failed to upload avatar","toast.activityDeleted":"Activity deleted successfully","toast.activityDeleteFailed":"Failed to delete activity","toast.restaurantDeleted":"Restaurant deleted successfully","toast.restaurantDeleteFailed":"Failed to delete restaurant","toast.usersDeleted":"Users deleted successfully","toast.usersDeleteFailed":"Failed to delete users","toast.restaurantsDeleted":"Restaurants deleted successfully","toast.restaurantsDeleteFailed":"Failed to delete restaurants","toast.activitiesDeleted":"Activities deleted successfully","toast.activitiesDeleteFailed":"Failed to delete activities","toast.rolesChanged":"Roles changed successfully","toast.rolesChangeFailed":"Failed to change roles","toast.commentDeleted":"Comment deleted successfully","toast.commentDeleteFailed":"Failed to delete comment","toast.pleaseSelectRating":"Please select a rating","toast.participationJoined":"Successfully joined the activity","toast.participationLeft":"Successfully left the activity","toast.participationFailed":"Failed to update participation","toast.visibilityUpdated":"Restaurant visibility updated","toast.visibilityUpdateFailed":"Failed to update restaurant visibility","toast.restaurantJoined":"Restaurant joined activity","toast.restaurantJoinedDesc":"Your restaurant is now participating in this activity","toast.restaurantLeft":"Restaurant left activity","toast.restaurantLeftDesc":"Your restaurant is no longer participating in this activity","toast.participationUpdateFailed":"Failed to update participation","toast.participationUpdateFailedDesc":"Please try again later","toast.termsNotAgreed":"Activity Terms Required","toast.termsNotAgreedDesc":"Please agree to the activity terms in your profile before joining activities","error.general":"An error occurred","error.networkError":"Network error. Please try again.","error.notFound":"Not found","error.unauthorized":"Unauthorized access","validation.titleRequired":"Title is required","validation.contentRequired":"Content is required","validation.nameRequired":"Name is required","validation.typeRequired":"At least 1 type is required","validation.typeMaximum":"Maximum 3 types allowed","validation.addressRequired":"Address is required","admin.showing":"Showing","admin.of":"of","admin.results":"results","address.myAddresses":"My Addresses","address.manageDescription":"Manage your delivery and billing addresses","address.addNew":"Add Address","address.addDescription":"Add a new address to your account","address.editAddress":"Edit Address","address.editDescription":"Update your address information","address.label":"Label","address.selectLabel":"Select a label","address.labelHome":"Home","address.labelWork":"Work","address.labelOffice":"Office","address.labelOther":"Other","address.street":"Street Address","address.streetPlaceholder":"Enter street address","address.district":"District/Parish","address.districtPlaceholder":"Enter district","address.city":"City","address.cityPlaceholder":"Enter city","address.postalCode":"Postal Code","address.postalCodePlaceholder":"Enter postal code","address.country":"Country","address.selectCountry":"Select country","address.setAsDefault":"Set as default address","address.default":"Default","address.add":"Add Address","address.noAddresses":"You haven't added any addresses yet","address.addFirst":"Add Your First Address","address.deleteTitle":"Delete Address","address.deleteDescription":"Are you sure you want to delete this address? This action cannot be undone.","address.phone":"Phone Number","address.phonePlaceholder":"Enter phone number","address.phoneConfirmTitle":"Add Phone to Profile","address.phoneConfirmDescription":"Your profile doesn't have a phone number yet. Would you like to save this phone number to your profile as well?"}},zh:{translation:{"nav.brandName":"","nav.map":"","nav.mapView":"","nav.restaurants":"","nav.activities":"","nav.profile":"","nav.signIn":"","nav.signOut":"","nav.myAccount":"","nav.admin":"","nav.manageRestaurants":"","nav.joinUs":"","map.subtitle":"","home.hero.brandName":"","home.hero.title":"","home.hero.subtitle":"","home.hero.description":"","home.hero.exploreBtn":"","home.hero.activitiesBtn":"","home.features.title":"","home.features.description":"","home.features.map.title":"","home.features.map.desc":"","home.features.reviews.title":"","home.features.reviews.desc":"","home.features.events.title":"","home.features.events.desc":"","home.cta.title":"","home.cta.description":"","home.cta.button":"","home.stats.delivery":"","home.stats.reservation":"","restaurants.title":"","restaurants.search":"...","restaurants.noResults":"","restaurants.noResultsDesc":"","restaurants.viewDetails":"","restaurants.addToFavorite":"","restaurants.removeFromFavorite":"","restaurants.mustSignIn":"","restaurants.listView":"","restaurants.mapView":"","restaurants.sortByDistance":"","restaurants.sortedByDistance":"","restaurants.radius":"","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"","restaurants.getLocation":"","restaurants.locationEnabled":"","restaurants.directions":"","restaurants.distanceAway":"{{distance}} km","restaurants.restaurantTypes":"","restaurant.address":"","restaurant.phone":"","restaurant.hours":"","restaurant.today":"","restaurant.closed":"","restaurant.dayMon":"","restaurant.dayTue":"","restaurant.dayWed":"","restaurant.dayThu":"","restaurant.dayFri":"","restaurant.daySat":"","restaurant.daySun":"","restaurant.website":"","restaurant.visitWebsite":"","restaurant.getDirections":"","restaurant.callNow":"","restaurant.joinPrivate":"","restaurant.reviews":"","restaurant.addReview":"","restaurant.rating":"","restaurant.edited":"","restaurant.reply":"","restaurant.writeComment":"...","restaurant.writeReply":"...","restaurant.postComment":"","restaurant.signInToComment":"","restaurant.signInToRate":"","restaurant.noComments":"","restaurant.confirmDelete":"","restaurant.ratingsCount":"","restaurant.yourRating":"","restaurant.rateThisRestaurant":"","restaurant.photoGallery":"","restaurant.addImage":"","restaurant.imageUploadFailed":"","restaurant.imageTooLarge":"5MB","restaurant.priceRange":"","restaurant.selectPriceRange":"...","activities.title":"","activities.description":"","activities.viewDetails":"","activities.joinEvent":"","activities.joined":"","activities.subscribe":"","activities.subscribed":"","activities.subscribers":"","activities.subscribersCount":"","activities.participants":"","activities.restaurantsParticipating":"","activities.until":"","activities.shareSuccess":"","activities.linkCopied":"","activities.shareError":"","activities.pinned":"","activities.ended":"","activities.ongoing":"","activities.signInToJoin":"","activities.signInToJoinHint":"","activities.signInToSubscribe":"","activities.signInToSubscribeDesc":"","activities.about":"","activities.participatingRestaurants":"","activities.repeat.none":"","activities.repeat.daily":"","activities.repeat.weekly":"","activities.repeat.monthly":"","activities.repeat.yearly":"","activities.serviceType.dine_in":"","activities.serviceType.takeaway":"","activities.serviceType.both":"&","activities.creatorLabel":"","activities.createdByPlatform":"","activities.rules":"","activities.rulesTitle":"","activities.usageInstructions":"","activities.noActivities":"","profile.title":"","profile.settings":"","profile.profile":"","profile.favorites":"","profile.reviews":"","profile.comments":"","profile.activities":"","profile.favoriteRestaurants":"","profile.favoritesDesc":"","profile.myReviews":"","profile.myComments":"","profile.reviewsDesc":"","profile.commentsDesc":"","profile.joinedActivities":"","profile.activitiesDesc":"","profile.noActivities":"","profile.noFavorites":"","profile.noComments":"","profile.upcomingEvents":"","profile.participatedActivities":"","profile.participatedActivitiesDesc":"","profile.personalActivities":"","profile.restaurantActivities":"","profile.participatingRestaurants":"","profile.noParticipatedActivities":"","profile.browseActivities":"","profile.editProfile":"","profile.editProfileDescription":"","profile.displayName":"","profile.phone":"","profile.phonePlaceholder":"","profile.addPhoneNumber":"","profile.modifyPhoneNumber":"","profile.uploadAvatar":"","profile.joinedOn":"","profile.deleteAccount":"","profile.deleteAccountWarning":"","profile.deleteAccountDescription":"","profile.confirmDeleteAccount":"","profile.confirmDeleteDescription":"","profile.typeDeleteToConfirm":" DELETE ","profile.deleteAccountSuccess":"","profile.deleteAccountFailed":"","profile.activityTermsTitle":"","profile.activityTermsDescription":"","profile.activityTermsAgreedStatus":"","profile.activityTermsNotAgreed":"","profile.viewFullRules":"","profile.agreeToTerms":"","profile.agreedOn":"","profile.activityTermsAgreed":"","profile.activityTermsRevoked":"","profile.activityTermsUpdateFailed":"","profile.changeEmail":"","profile.verifyOldEmail":"","profile.verifyNewEmail":"","profile.confirmEmailUpdate":"","profile.oldEmailStep":" 1/3: ","profile.newEmailStep":" 2/3: ","profile.confirmEmailStep":" 3/3: ","profile.currentEmail":"","profile.newEmail":"","profile.verificationCode":"","profile.sendCode":"","profile.codeSent":"","profile.enterCode":"4","profile.verify":"","profile.updateEmail":"","profile.codeSentToOldEmail":"","profile.codeSentToNewEmail":"","profile.sendCodeFailed":"","profile.enterCodePlaceholder":"","profile.codeIncorrect":"","profile.verificationFailed":"","profile.oldEmailVerified":"","profile.newEmailVerified":"","profile.enterValidEmail":"","profile.pleaseSignIn":"","profile.emailUpdated":"","profile.emailUpdateFailed":"","profile.enterNewEmail":"","profile.role.user":"","profile.role.merchant":"","profile.role.supervisor":"","profile.role.admin":"","profile.changePassword":"","profile.changePasswordDescription":"","profile.verifyOldPassword":"","profile.oldPasswordStep":" 1/2: ","profile.currentPassword":"","profile.enterCurrentPassword":"","profile.forgotPassword":"","profile.useEmailVerification":"","profile.oldPasswordVerified":"","profile.oldPasswordIncorrect":"","profile.setNewPassword":"","profile.newPasswordStep":" 2/2: ","profile.newPassword":"","profile.confirmNewPassword":"","profile.enterNewPassword":"6","profile.confirmNewPasswordPlaceholder":"","profile.passwordsDontMatch":"","profile.passwordTooShort":"6","profile.passwordUpdated":"","profile.passwordUpdateFailed":"","profile.updatePassword":"","report.title":"","report.reportComment":"","report.reportRestaurant":"","report.reportActivity":"","report.reportUser":"","report.description":"","report.reason":"","report.reasonPlaceholder":"","report.reasons":{spam:"",harassment:"",inappropriate_content:"",misinformation:"",copyright:"",fraud:"",hate_speech:"",violence:"",other:""},"report.detailsLabel":"","report.detailsPlaceholder":"20","report.detailsMin":"20","report.contactLabel":"","report.contactPlaceholder":"","report.contactRequired":"","report.invalidEmail":"","report.evidenceLabel":"","report.evidenceRequired":"","report.evidenceRequiredNote":"","report.uploadImages":"","report.evidenceUrls":"","report.imageUploadHint":"JPG, PNG, WEBP, GIF 5MB","report.imageTooLarge":" 5MB","report.invalidImageType":" JPGPNGWEBP  GIF ","report.imageUploadFailed":"","report.evidencePlaceholder":"","report.addEvidence":"","report.removeEvidence":"","report.submit":"","report.submitting":"...","report.success":"","report.successDetailed":"{{reference}}","report.successDescription":" 24-48 ","report.failed":"","report.cancel":"","report.confirmTitle":"","report.confirmMessage":"","admin.reports":"","admin.reportsDescription":"","admin.totalReports":"","admin.allReportsCount":"","admin.awaitingReview":"","admin.underReview":"","admin.resolvedReports":"","admin.dismissedReports":"","admin.allReports":"","admin.manageReportsDesc":"","admin.searchReports":"...","admin.noReports":"","admin.reportStatus":{pending:"",reviewing:"",resolved:"",dismissed:""},"admin.reportType":{comment:"",restaurant:"",activity:"",user:""},"admin.reportedBy":"","admin.reportedAt":"","admin.viewReport":"","admin.updateStatus":"","admin.adminNotes":"","admin.saveNotes":"","auth.welcome":"","auth.subtitle":"","auth.login":"","auth.register":"","auth.phone":"","auth.email":"","auth.password":"","auth.displayName":"","auth.phoneOptional":"","auth.phoneNumber":"","auth.phoneMin":"","auth.phoneHint":"+351 912 345 678","auth.confirmPassword":"","auth.signIn":"","auth.signingIn":"...","auth.sendCode":"","auth.sendingCode":"...","auth.verificationCode":"","auth.verify":"","auth.verifying":"...","auth.otpLength":"6","auth.otpSent":"","auth.otpHint":" {{phone}} 6","auth.createAccount":"","auth.creatingAccount":"...","auth.orContinueWith":"","auth.google":"Google","auth.backToHome":"","auth.invalidEmail":"","auth.passwordMin":"6","auth.passwordPlaceholder":"6","auth.passwordStrength":{weak:" - ",medium:" - ",strong:""},"auth.displayNameMin":"2","auth.passwordsDontMatch":"","auth.invalidCredentials":"","auth.emailExists":"","auth.signInSuccess":"","auth.signUpSuccess":"","auth.verificationCodeSent":"","auth.verificationCodeFailed":"","auth.invalidVerificationCode":"","auth.verificationCodeUsed":"","auth.verificationCodeHint":" {{email}} 4","auth.resendCode":"","auth.resendIn":"{{seconds}}","common.loading":"...","common.error":"","common.success":"","common.cancel":"","common.confirm":"","common.continue":"","common.save":"","common.delete":"","common.edit":"","common.submit":"","common.back":"","common.next":"","common.previous":"","common.search":"","common.filter":"","common.sort":"","common.actions":"","common.km":"","common.uploading":"...","common.deleting":"...","common.share":"","common.copyLink":"","common.moreOptions":"","common.shareVia":"","common.linkCopied":"","common.shareSuccess":"","common.shareError":"","common.actions.clearFilter":"","common.showMore":"","common.showLess":"","common.showDetails":"","common.hideDetails":"","common.processing":"...","common.loadMore":"","notifications.title":"","notifications.markAllRead":"","notifications.noNotifications":"","notifications.markAsReadError":"","notifications.markAllAsReadSuccess":"","notifications.markAllAsReadError":"","notifications.userNotAuthenticated":"","admin.management":"","admin.dashboard":"","admin.users":"","admin.restaurants":"","admin.activities":"","admin.logs":"","admin.userManagement":"","admin.restaurantManagement":"","admin.activityManagement":"","admin.operationLogs":"","admin.manageUserRoles":"","admin.manageRestaurants":"","admin.manageActivities":"","admin.viewSystemLogs":"","admin.dashboardDescription":"","admin.totalUsers":"","admin.totalRestaurants":"","admin.totalActivities":"","admin.totalComments":"","admin.registeredUsers":"","admin.listedRestaurants":"","admin.activeEvents":"","admin.userReviews":"","admin.recentActivity":"","admin.recentActivityDescription":"","admin.viewLogsForDetails":"","admin.selectRole":"","admin.assignRole":"","admin.confirmRemoveRole":"","admin.noPhone":"","admin.addRestaurant":"","admin.addActivity":"","admin.editActivity":"","admin.activityCreated":"","admin.activityUpdated":"","admin.confirmDelete":"","admin.deleteActivityWarning":"","admin.activityImage":"","admin.uploadImage":"","admin.titleEnglish":"","admin.titleChinese":"","admin.titlePortuguese":"","admin.contentEnglish":"","admin.contentChinese":"","admin.contentPortuguese":"","admin.startDate":"","admin.endDate":"","admin.pickDate":"","admin.repeatMode":"","admin.selectRepeatMode":"","admin.serviceType":"","admin.selectServiceType":"","admin.repeatNone":"","admin.repeatDaily":"","admin.repeatWeekly":"","admin.repeatMonthly":"","admin.repeatYearly":"","admin.associatedRestaurants":"","admin.pinned":"","admin.sortOrder":"","admin.editRestaurant":"","admin.restaurantCreated":"","admin.restaurantUpdated":"","admin.deleteRestaurantWarning":"","admin.restaurantImage":"","admin.nameChinese":"","admin.nameEnglish":"","admin.namePortuguese":"","admin.typeChinese":"","admin.typeEnglish":"","admin.typePortuguese":"","admin.restaurantTypes":"","admin.tags":"","admin.addType":"","admin.descriptionChinese":"","admin.descriptionEnglish":"","admin.descriptionPortuguese":"","admin.address":"","admin.phone":"","admin.website":"","admin.showWebsiteButton":"","admin.location":"","admin.locationOnMap":"","admin.latitude":"","admin.longitude":"","admin.clickOrDragToSetLocation":"","admin.mapInstructions":"","admin.openingHours":"","admin.closed":"","admin.day.monday":"","admin.day.tuesday":"","admin.day.wednesday":"","admin.day.thursday":"","admin.day.friday":"","admin.day.saturday":"","admin.day.sunday":"","admin.userGrowth":"","admin.userGrowthDescription":"","admin.activityEngagement":"","admin.activityEngagementDescription":"","admin.topRestaurants":"","admin.topRestaurantsDescription":"","admin.subscribers":"","admin.comments":"","admin.rating":"","admin.noData":"","admin.exportCSV":"CSV","admin.exportSuccess":"","admin.noDataToExport":"","admin.batchDelete":"","admin.batchAssignRole":"","admin.selectedCount":" {{count}} ","admin.confirmBatchDelete":"","admin.batchDeleteWarning":" {{count}} ","admin.clearSelection":"","admin.selectAll":"","admin.searchUsers":"...","admin.searchRestaurants":"...","admin.searchActivities":"...","admin.filterByRole":"","admin.filterByType":"","admin.filterByStatus":"","admin.allRoles":"","admin.allTypes":"","admin.allStatus":"","admin.statusActive":"","admin.statusEnded":"","admin.statusPinned":"","admin.view":"","admin.createMerchant":"","admin.createSupervisor":"Supervisor","admin.createUser":"","admin.createNewUser":"","admin.createUserDescription":"supervisor","admin.userCreated":"","admin.createUserError":"","admin.role":"","admin.create":"","admin.oldData":"","admin.newData":"","admin.noLogs":"","admin.merchant":"","admin.supervisor":"","admin.editActivityDetails":"","admin.createActivityWithContent":"","admin.imageMaxSize":"PNG, JPG  5MB","admin.imageTooBig":" 10MB","admin.cropImage":"","admin.cropImageDescription":"","admin.recommendedSize":"","admin.imageSizeHint":"","admin.confirmCrop":"","admin.multilingualContent":"","admin.chinese":"","admin.english":"","admin.portuguese":"","admin.title":"","admin.content":"","admin.enterTitle":"...","admin.enterContent":"...","admin.dateSettings":"","admin.selectDate":"","admin.displaySettings":"","admin.pinToTop":"","admin.showAtTop":"","admin.lowerFirst":"","admin.selectParticipatingRestaurants":"","admin.editRestaurantDetails":"","admin.createRestaurantWithInfo":"","admin.restaurantName":"","admin.enterRestaurantName":"...","admin.restaurantType":" (1-3 )","admin.typeExample":"","admin.typeExamplePt":"Cantons","admin.enterDescription":"...","admin.contactAndWebsite":"","admin.enterAddress":"...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"","admin.weekdays":"","admin.weekend":"","admin.copyToAll":"","admin.splitShift":"","admin.open":"","admin.close":"","admin.afternoon":"","admin.evening":"","admin.visible":"","admin.showInFrontend":"","common.saving":"...","merchant.myRestaurants":"","merchant.merchantDescription":"","merchant.supervisorDescription":"","merchant.noRestaurants":"","joinUs.title":"","joinUs.description":"","joinUs.name":"","joinUs.namePlaceholder":"","joinUs.email":"","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"","joinUs.restaurantNamePlaceholder":"","joinUs.restaurantAddress":"","joinUs.restaurantAddressPlaceholder":"","joinUs.optional":"","joinUs.featuresNeeded":"","joinUs.featuresDescription":"","joinUs.feature.booking":"","joinUs.feature.delivery":"","joinUs.feature.qrcode":"","joinUs.submit":"","joinUs.nameMin":"2","joinUs.emailInvalid":"","joinUs.phoneMin":"6","joinUs.restaurantNameMin":"2","joinUs.addressMin":"2","joinUs.featuresMin":"","joinUs.consentText":"","joinUs.successTitle":"","joinUs.successDescription":"","joinUs.successMessage":"24","joinUs.submitAnother":"","joinUs.submitError":"","joinUs.rateLimitError":"","joinUs.rateLimitErrorDesc":"24","joinUs.adminTitle":"","joinUs.adminDescription":"","joinUs.recipientEmail":"","joinUs.recipientEmailDesc":"","joinUs.totalRequests":"","joinUs.totalRequestsDesc":"","joinUs.allRequests":"","joinUs.allRequestsDesc":"","joinUs.searchPlaceholder":"...","joinUs.contact":"","joinUs.restaurant":"","joinUs.submittedAt":"","joinUs.noRequests":"","joinUs.enterNewEmail":"","joinUs.emailUpdated":"","joinUs.emailUpdateError":"","joinUs.status":"","joinUs.status.pending":"","joinUs.status.completed":"","joinUs.status.rejected":"","joinUs.statusUpdated":"","joinUs.statusUpdateError":"","joinUs.requestDeleted":"","joinUs.deleteError":"","joinUs.confirmDelete":"","joinUs.confirmDeleteDescription":"","toast.subscribed":"","toast.unsubscribed":"","toast.subscribedDesc":"","toast.unsubscribedDesc":"","toast.subscriptionFailed":"","toast.roleChanged":"","toast.roleChangeFailed":"","toast.profileUpdated":"","toast.profileUpdateFailed":"","toast.avatarUploadFailed":"","toast.activityDeleted":"","toast.activityDeleteFailed":"","toast.restaurantDeleted":"","toast.restaurantDeleteFailed":"","toast.usersDeleted":"","toast.usersDeleteFailed":"","toast.restaurantsDeleted":"","toast.restaurantsDeleteFailed":"","toast.activitiesDeleted":"","toast.activitiesDeleteFailed":"","toast.rolesChanged":"","toast.rolesChangeFailed":"","toast.commentDeleted":"","toast.commentDeleteFailed":"","toast.pleaseSelectRating":"","toast.participationJoined":"","toast.participationJoinFailed":"","toast.participationLeft":"","toast.participationLeaveFailed":"","toast.visibilityUpdated":"","toast.visibilityUpdateFailed":"","toast.verificationFailed":"","toast.restaurantJoined":"","toast.restaurantJoinedDesc":"","toast.restaurantLeft":"","toast.restaurantLeftDesc":"","toast.participationUpdateFailed":"","toast.participationUpdateFailedDesc":"","toast.termsNotAgreed":"","toast.termsNotAgreedDesc":"","toast.pleaseSignIn":"","toast.emailUpdatedSuccess":"","toast.emailUpdateError":"","toast.signInToFavorite":"","toast.favoritesUpdateFailed":"","toast.favoriteAdded":"","toast.favoriteRemoved":"","toast.resendCodeFailed":"","toast.verificationCodeResent":"","toast.reportUpdatedSuccess":"","toast.reportUpdateFailed":"","toast.merchantRestaurantsSaved":"","toast.merchantRestaurantsDescription":"","toast.merchantRestaurantsSaveFailed":"","toast.merchantRestaurantsDescriptionFailed":"","admin.reportsTrend":"","admin.reportsTrendDesc":"7","admin.reportsReasonDist":"","admin.reportsReasonDistDesc":"","admin.reportsTypeDist":"","admin.reportsTypeDistDesc":"","admin.reportsStatusDist":"","admin.reportsStatusDistDesc":"","admin.reportsCount":"","merchant.manageRestaurants":"","merchant.manageSupervisorRestaurants":"","merchant.assignRestaurantsTo":" {name} ","merchant.merchantOnlyOne":" ","merchant.saveReminder":' ""',"merchant.searchRestaurants":"...","merchant.selected":"","merchant.selectedCountOne":" {count}/1 ","merchant.selectedCountMulti":" {count} ","error.general":"","error.networkError":"","error.notFound":"","error.unauthorized":"","validation.titleRequired":"","validation.contentRequired":"","validation.nameRequired":"","validation.typeRequired":"1","validation.typeMaximum":"3","validation.addressRequired":"","admin.showing":"","admin.of":"","admin.results":"","address.myAddresses":"","address.manageDescription":"","address.addNew":"","address.addDescription":"","address.editAddress":"","address.editDescription":"","address.label":"","address.selectLabel":"","address.labelHome":"","address.labelWork":"","address.labelOffice":"","address.labelOther":"","address.street":"","address.streetPlaceholder":"","address.district":"/","address.districtPlaceholder":"","address.city":"","address.cityPlaceholder":"","address.postalCode":"","address.postalCodePlaceholder":"","address.country":"","address.selectCountry":"","address.setAsDefault":"","address.default":"","address.add":"","address.noAddresses":"","address.addFirst":"","address.deleteTitle":"","address.deleteDescription":"","address.phone":"","address.phonePlaceholder":"","address.phoneConfirmTitle":"","address.phoneConfirmDescription":""}},pt:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Incio","nav.mapView":"Mapa Privado","nav.restaurants":"Restaurantes","nav.activities":"Atividades","nav.profile":"Perfil","nav.signIn":"Entrar","nav.signOut":"Sair","nav.myAccount":"Minha Conta","nav.admin":"Painel Admin","nav.manageRestaurants":"Gerir Restaurantes","nav.joinUs":"Juntar Restaurante","map.subtitle":"Explore restaurantes selecionados nas proximidades","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Descubra Gastronomia Prxima","home.hero.subtitle":"Sua Jornada Culinria Comea Aqui","home.hero.description":"Explore restaurantes selecionados em vrias cidades, participe de eventos gastronmicos e conecte-se com amantes da gastronomia;","home.hero.exploreBtn":"Explorar Restaurantes","home.hero.activitiesBtn":"Ver Atividades","home.features.title":"Por Que Nos Escolher?","home.features.description":"Descubra Gastronomia; Compartilhe Experincias; Participe de Atividades;","home.features.map.title":"Mapa Inteligente","home.features.map.desc":"Encontre restaurantes prximos com nossa busca inteligente baseada em localizao e visualizao interativa do mapa;","home.features.reviews.title":"Avaliaes Confiveis","home.features.reviews.desc":"Leia avaliaes e classificaes autnticas de clientes verificados para tomar decises informadas;","home.features.events.title":"Eventos Exclusivos","home.features.events.desc":"Participe de eventos gastronmicos especiais, festivais de comida e conecte-se com a comunidade culinria;","home.cta.title":"Pronto para Comear?","home.cta.description":"Junte-se ao Xiaoxiong Market e alcance milhares de amantes da gastronomia. Cresa seu negcio conosco;","home.cta.button":"Adeso de Restaurante","home.stats.delivery":"Take Away","home.stats.reservation":"Reserva","restaurants.title":"Restaurantes","restaurants.search":"Pesquisar nome, morada, cdigo postal...","restaurants.noResults":"Nenhum restaurante encontrado","restaurants.noResultsDesc":"Tente ajustar sua pesquisa ou filtros","restaurants.viewDetails":"Ver Detalhes","restaurants.addToFavorite":"Adicionar aos favoritos","restaurants.removeFromFavorite":"Remover dos favoritos","restaurants.mustSignIn":"Por favor, faa login para favoritar restaurantes","restaurants.listView":"Vista de Lista","restaurants.mapView":"Vista de Mapa","restaurants.sortByDistance":"Ordenar por Distncia","restaurants.sortedByDistance":"Ordenado por distncia","restaurants.radius":"Raio","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"Todos os Restaurantes","restaurants.getLocation":"Obter Minha Localizao","restaurants.locationEnabled":"Localizao Ativada","restaurants.directions":"Obter Direes","restaurants.distanceAway":"{{distance}} km","restaurants.restaurantTypes":"Tipos de Restaurantes","restaurant.address":"Endereo","restaurant.phone":"Telefone","restaurant.hours":"Horrio","restaurant.today":"Hoje","restaurant.closed":"Fechado","restaurant.dayMon":"Seg","restaurant.dayTue":"Ter","restaurant.dayWed":"Qua","restaurant.dayThu":"Qui","restaurant.dayFri":"Sex","restaurant.daySat":"Sb","restaurant.daySun":"Dom","restaurant.website":"Site","restaurant.visitWebsite":"Visitar Site","restaurant.getDirections":"Obter Direes","restaurant.callNow":"Ligar Agora","restaurant.joinPrivate":"Entrar no Domnio Privado","restaurant.reviews":"Avaliaes","restaurant.addReview":"Adicionar Avaliao","restaurant.rating":"Classificao","restaurant.edited":"Editado","restaurant.reply":"Responder","restaurant.writeComment":"Escreva um comentrio...","restaurant.writeReply":"Escreva uma resposta...","restaurant.postComment":"Publicar Comentrio","restaurant.signInToComment":"Por favor, faa login para comentar","restaurant.signInToRate":"Por favor, faa login para avaliar este restaurante","restaurant.noComments":"Ainda no h comentrios. Seja o primeiro a compartilhar sua experincia!","restaurant.confirmDelete":"Tem certeza de que deseja excluir este comentrio?","restaurant.ratingsCount":"avaliaes","restaurant.yourRating":"Sua avaliao","restaurant.rateThisRestaurant":"Avalie este restaurante","restaurant.photoGallery":"Galeria de Fotos","restaurant.addImage":"Adicionar Imagem","restaurant.imageUploadFailed":"Falha ao enviar imagem","restaurant.imageTooLarge":"O tamanho da imagem deve ser menor que 5MB","restaurant.priceRange":"Faixa de Preo (Opcional)","restaurant.selectPriceRange":"Selecione a faixa de preo...","activities.title":"Atividades","activities.description":"Participe de experincias gastronmicas exclusivas e eventos culinrios","activities.viewDetails":"Ver Detalhes","activities.joinEvent":"Participar do Evento","activities.joined":"Participando","activities.subscribe":"Subscrever","activities.subscribed":"Subscrito","activities.subscribers":"inscritos","activities.subscribersCount":"assinantes","activities.participants":"participantes","activities.restaurantsParticipating":"restaurantes participando","activities.until":"At","activities.shareSuccess":"Atividade partilhada com sucesso","activities.linkCopied":"Link copiado para a rea de transferncia","activities.shareError":"Falha ao partilhar atividade","activities.pinned":"Fixado","activities.ended":"Encerrado","activities.ongoing":"Em Andamento","activities.signInToJoin":"Por favor, faa login para participar desta atividade","activities.signInToJoinHint":"Receba notificaes sobre as ltimas atividades","activities.signInToSubscribe":"Por favor, faa login","activities.signInToSubscribeDesc":"Voc precisa fazer login para subscrever atividades","activities.about":"Sobre Esta Atividade","activities.participatingRestaurants":"Restaurantes Participantes","activities.repeat.none":"nica vez","activities.repeat.daily":"Dirio","activities.repeat.weekly":"Semanal","activities.repeat.monthly":"Mensal","activities.repeat.yearly":"Anual","activities.serviceType.dine_in":"Refeio no local","activities.serviceType.takeaway":"Take Away","activities.serviceType.both":"Refeio & Take Away","activities.creatorLabel":"Criador:","activities.createdByPlatform":"Plataforma","activities.rules":"Regras da Atividade","activities.rulesTitle":"Regras da Atividade","activities.usageInstructions":"Como Usar","activities.noActivities":"Nenhuma atividade disponvel","profile.title":"Meu Perfil","profile.settings":"Configuraes","profile.profile":"Perfil","profile.favorites":"Favoritos","profile.reviews":"Avaliaes","profile.comments":"Comentrios","profile.activities":"Atividades","profile.favoriteRestaurants":"Meus Restaurantes Favoritos","profile.favoritesDesc":"Restaurantes que voc marcou para visitas futuras","profile.myReviews":"Minhas Avaliaes","profile.myComments":"Meus Comentrios","profile.reviewsDesc":"Suas classificaes e avaliaes para restaurantes","profile.commentsDesc":"Comentrios que voc postou em restaurantes e atividades","profile.joinedActivities":"Atividades Participadas","profile.activitiesDesc":"Eventos e atividades em que voc est participando","profile.noActivities":"Nenhuma atividade participada ainda. Confira nossos","profile.noFavorites":"Nenhum restaurante favorito ainda","profile.noComments":"Nenhum comentrio ainda","profile.upcomingEvents":"prximos eventos","profile.participatedActivities":"Atividades Participadas","profile.participatedActivitiesDesc":"Veja todas as atividades em que seus restaurantes participaram","profile.personalActivities":"Atividades Pessoais","profile.restaurantActivities":"Atividades do Restaurante","profile.participatingRestaurants":"Restaurantes Participantes","profile.noParticipatedActivities":"Voc ainda no participou de nenhuma atividade.","profile.browseActivities":"Ver atividades","profile.editProfile":"Editar Perfil","profile.editProfileDescription":"Atualize suas informaes de perfil","profile.displayName":"Nome de Exibio","profile.phone":"Telefone","profile.phonePlaceholder":"Introduza o nmero de telefone","profile.addPhoneNumber":"Adicionar nmero de telefone","profile.modifyPhoneNumber":"Modificar","profile.uploadAvatar":"Enviar Avatar","profile.joinedOn":"Participou em","profile.deleteAccount":"Excluir Conta","profile.deleteAccountWarning":"Aviso: Esta ao  permanente","profile.deleteAccountDescription":"Excluir sua conta remover permanentemente todos os seus dados, incluindo seu perfil, favoritos, comentrios e inscries em atividades. Esta ao no pode ser desfeita.","profile.confirmDeleteAccount":"Confirmao Final Necessria","profile.confirmDeleteDescription":"Esta  sua ltima chance. Todos os seus dados sero permanentemente excludos e no podero ser recuperados.","profile.typeDeleteToConfirm":"Digite DELETE para confirmar","profile.deleteAccountSuccess":"Conta excluda com sucesso","profile.deleteAccountFailed":"Falha ao excluir conta","profile.activityTermsTitle":"Acordo de Termos de Atividade","profile.activityTermsDescription":"Comerciantes e supervisores devem concordar com os termos antes de participar","profile.activityTermsAgreedStatus":"Concordou","profile.activityTermsNotAgreed":"No Concordou","profile.viewFullRules":"Ver Regras Completas","profile.agreeToTerms":"Concordo com os termos da atividade","profile.agreedOn":"Concordou em","profile.activityTermsAgreed":"Termos da atividade aceitos","profile.activityTermsRevoked":"Termos da atividade revogados","profile.activityTermsUpdateFailed":"Falha ao atualizar acordo de termos","profile.changeEmail":"Alterar Email","profile.verifyOldEmail":"Verificar Email Atual","profile.verifyNewEmail":"Inserir Novo Email","profile.confirmEmailUpdate":"Confirmar Atualizao de Email","profile.oldEmailStep":"Passo 1/3: Precisamos verificar seu email atual","profile.newEmailStep":"Passo 2/3: Insira seu novo endereo de email","profile.confirmEmailStep":"Passo 3/3: Confirme sua atualizao de email","profile.currentEmail":"Email Atual","profile.newEmail":"Novo Email","profile.verificationCode":"Cdigo de Verificao","profile.sendCode":"Enviar Cdigo","profile.codeSent":"Enviado","profile.enterCode":"Digite o cdigo de 4 dgitos","profile.verify":"Verificar","profile.updateEmail":"Atualizar Email","profile.codeSentToOldEmail":"Cdigo de verificao enviado para seu email antigo","profile.codeSentToNewEmail":"Cdigo de verificao enviado para seu novo email","profile.sendCodeFailed":"Falha ao enviar cdigo de verificao","profile.enterCodePlaceholder":"Por favor, insira o cdigo de verificao","profile.codeIncorrect":"Cdigo de verificao incorreto ou expirado","profile.verificationFailed":"Falha na verificao","profile.oldEmailVerified":"Email antigo verificado com sucesso","profile.newEmailVerified":"Novo email verificado com sucesso","profile.enterValidEmail":"Por favor, insira um endereo de email vlido","profile.pleaseSignIn":"Por favor, faa login primeiro","profile.emailUpdated":"Email atualizado com sucesso, por favor faa login com seu novo email","profile.emailUpdateFailed":"Falha ao atualizar email","profile.enterNewEmail":"Insira seu novo endereo de email","profile.role.user":"Usurio","profile.role.merchant":"Comerciante","profile.role.supervisor":"Supervisor","profile.role.admin":"Administrador","profile.changePassword":"Alterar Senha","profile.changePasswordDescription":"Atualize a senha da sua conta","profile.verifyOldPassword":"Verificar Senha Atual","profile.oldPasswordStep":"Passo 1/2: Verifique sua identidade","profile.currentPassword":"Senha Atual","profile.enterCurrentPassword":"Digite a senha atual","profile.forgotPassword":"Esqueceu a senha?","profile.useEmailVerification":"Use verificao por e-mail","profile.oldPasswordVerified":"Senha verificada com sucesso","profile.oldPasswordIncorrect":"Senha atual incorreta","profile.setNewPassword":"Definir Nova Senha","profile.newPasswordStep":"Passo 2/2: Digite sua nova senha","profile.newPassword":"Nova Senha","profile.confirmNewPassword":"Confirmar Nova Senha","profile.enterNewPassword":"Digite nova senha (mn. 6 caracteres)","profile.confirmNewPasswordPlaceholder":"Digite a nova senha novamente","profile.passwordsDontMatch":"As senhas no coincidem","profile.passwordTooShort":"A senha deve ter pelo menos 6 caracteres","profile.passwordUpdated":"Senha atualizada com sucesso","profile.passwordUpdateFailed":"Falha ao atualizar senha","profile.updatePassword":"Atualizar Senha","report.title":"Denunciar","report.reportComment":"Denunciar Comentrio","report.reportRestaurant":"Denunciar Restaurante","report.reportActivity":"Denunciar Atividade","report.reportUser":"Denunciar Usurio","report.description":"Ajude-nos a manter uma comunidade segura","report.reason":"Motivo da Denncia","report.reasonPlaceholder":"Selecione um motivo","report.reasons":{spam:"Spam ou Publicidade",harassment:"Assdio ou Bullying",inappropriate_content:"Contedo Inadequado",misinformation:"Desinformao",copyright:"Violao de Direitos Autorais",fraud:"Fraude ou Golpe",hate_speech:"Discurso de dio",violence:"Violncia ou Ameaas",other:"Outro"},"report.detailsLabel":"Detalhes","report.detailsPlaceholder":"Fornea informaes detalhadas sobre esta denncia (obrigatrio, mnimo 20 caracteres)","report.detailsMin":"Detalhes devem ter pelo menos 20 caracteres","report.contactLabel":"Email de Contato","report.contactPlaceholder":"Seu email para acompanhamento","report.contactRequired":"Email de contato  obrigatrio","report.invalidEmail":"Por favor, insira um endereo de email vlido","report.evidenceLabel":"URLs de Evidncia","report.evidenceRequired":" necessrio fornecer pelo menos uma evidncia (imagem ou URL)","report.evidenceRequiredNote":"Por favor, carregue pelo menos uma imagem ou fornea um link","report.uploadImages":"Carregar Imagens","report.evidenceUrls":"Ou Fornecer URLs","report.imageUploadHint":"Formatos suportados: JPG, PNG, WEBP, GIF. Mx 5MB por imagem","report.imageTooLarge":"O tamanho da imagem deve ser inferior a 5MB","report.invalidImageType":"Apenas os formatos JPG, PNG, WEBP e GIF so suportados","report.imageUploadFailed":"Falha ao carregar imagens. Por favor, tente novamente","report.evidencePlaceholder":"Adicionar captura de tela ou URL de evidncia","report.addEvidence":"Adicionar Evidncia","report.removeEvidence":"Remover","report.submit":"Enviar Denncia","report.submitting":"Enviando...","report.success":"Denncia enviada com sucesso. Vamos analis-la em breve.","report.successDetailed":"Denncia enviada com sucesso! Referncia: {{reference}}","report.successDescription":"Vamos analisar sua denncia em 24-48 horas. Voc receber uma notificao por e-mail no endereo de contato fornecido assim que a anlise for concluda. Obrigado por nos ajudar a manter uma comunidade segura!","report.failed":"Falha ao enviar denncia","report.cancel":"Cancelar","report.confirmTitle":"Confirmar Envio de Denncia","report.confirmMessage":"Tem certeza que deseja enviar esta denncia? Denncias falsas podem resultar em restries de conta.","admin.reports":"Denncias","admin.reportsDescription":"Gerenciar denncias de usurios","admin.totalReports":"Total de Denncias","admin.allReportsCount":"Todas as denncias enviadas","admin.awaitingReview":"Aguardando reviso","admin.underReview":"Em reviso","admin.resolvedReports":"Denncias resolvidas","admin.dismissedReports":"Denncias rejeitadas","admin.allReports":"Todas as Denncias","admin.manageReportsDesc":"Ver e gerenciar todas as denncias de usurios","admin.searchReports":"Pesquisar denncias por descrio, denunciante ou motivo...","admin.noReports":"Nenhuma denncia ainda","admin.reportStatus":{pending:"Pendente",reviewing:"Em Anlise",resolved:"Resolvido",dismissed:"Rejeitado"},"admin.reportType":{comment:"Comentrio",restaurant:"Restaurante",activity:"Atividade",user:"Usurio"},"admin.reportedBy":"Denunciado Por","admin.reportedAt":"Denunciado Em","admin.viewReport":"Ver Denncia","admin.updateStatus":"Atualizar Status","admin.adminNotes":"Notas do Administrador","admin.saveNotes":"Salvar Notas","auth.welcome":"Bem-vindo ao Xiaoxiong Market","auth.subtitle":"Descubra restaurantes incrveis e participe de eventos gastronmicos emocionantes","auth.login":"Entrar","auth.register":"Registo por Email","auth.phone":"Telefone","auth.email":"Email","auth.password":"Senha","auth.displayName":"Nome de Exibio","auth.phoneOptional":"Telefone (Opcional)","auth.phoneNumber":"Nmero de Telefone","auth.phoneMin":"Por favor, insira um nmero de telefone vlido","auth.phoneHint":"Insira seu nmero de telefone com cdigo do pas (ex: +351 912 345 678)","auth.confirmPassword":"Confirmar Senha","auth.signIn":"Entrar","auth.signingIn":"Entrando...","auth.sendCode":"Enviar Cdigo","auth.sendingCode":"Enviando...","auth.verificationCode":"Cdigo de Verificao","auth.verify":"Verificar","auth.verifying":"Verificando...","auth.otpLength":"O cdigo deve ter 6 dgitos","auth.otpSent":"Cdigo de verificao enviado para seu telefone","auth.otpHint":"Insira o cdigo de 6 dgitos enviado para {{phone}}","auth.createAccount":"Criar Conta","auth.creatingAccount":"Criando conta...","auth.orContinueWith":"Ou continue com","auth.google":"Google","auth.backToHome":"Voltar ao incio","auth.invalidEmail":"Endereo de email invlido","auth.passwordMin":"A senha deve ter pelo menos 6 caracteres","auth.passwordPlaceholder":"Mnimo 6 caracteres","auth.passwordStrength":{weak:"Senha fraca - Adicione maisculas, nmeros ou smbolos",medium:"Senha mdia - Considere adicionar mais variedade",strong:"Senha forte"},"auth.displayNameMin":"O nome de exibio deve ter pelo menos 2 caracteres","auth.passwordsDontMatch":"As senhas no coincidem","auth.invalidCredentials":"Email ou senha invlidos","auth.emailExists":"Este email j est registrado","auth.signInSuccess":"Login bem-sucedido!","auth.signUpSuccess":"Conta criada com sucesso! Agora voc pode fazer login.","auth.verificationCodeSent":"Cdigo de verificao enviado para seu email","auth.verificationCodeFailed":"Falha ao enviar cdigo de verificao","auth.invalidVerificationCode":"Cdigo de verificao invlido","auth.verificationCodeUsed":"Este cdigo de verificao j foi usado. Por favor, solicite um novo.","auth.verificationCodeHint":"Por favor, insira o cdigo de verificao de 4 dgitos enviado para {{email}}","auth.resendCode":"Reenviar Cdigo","auth.resendIn":"Reenviar em {{seconds}}s","common.loading":"Carregando...","common.error":"Erro","common.success":"Sucesso","common.cancel":"Cancelar","common.confirm":"Confirmar","common.continue":"Continuar","common.save":"Salvar","common.delete":"Excluir","common.edit":"Editar","common.submit":"Enviar","common.back":"Voltar","common.next":"Prximo","common.previous":"Anterior","common.search":"Pesquisar","common.filter":"Filtrar","common.sort":"Ordenar","common.actions":"Aes","common.km":"km","common.uploading":"Carregando...","common.deleting":"Eliminando...","common.enterPlaceholder":"Digite...","common.selectPlaceholder":"Selecione...","common.share":"Compartilhar","common.copyLink":"Copiar Link","common.moreOptions":"Mais Opes","common.shareVia":"Compartilhar via","common.linkCopied":"Link copiado","common.shareSuccess":"Compartilhado com sucesso","common.shareError":"Falha ao compartilhar","common.actions.clearFilter":"Limpar Filtro","common.showMore":"Mostrar Mais","common.showLess":"Mostrar Menos","common.showDetails":"Mostrar Detalhes","common.hideDetails":"Ocultar Detalhes","common.processing":"Processando...","common.loadMore":"Carregar Mais","notifications.title":"Notificaes","notifications.markAllRead":"Marcar todas como lidas","notifications.noNotifications":"Nenhuma notificao ainda","notifications.markAsReadError":"Falha ao marcar notificao como lida","notifications.markAllAsReadSuccess":"Todas as notificaes marcadas como lidas","notifications.markAllAsReadError":"Falha ao marcar todas as notificaes como lidas","notifications.userNotAuthenticated":"Usurio no autenticado","admin.management":"Gerenciamento","admin.dashboard":"Painel","admin.users":"Usurios","admin.restaurants":"Restaurantes","admin.activities":"Atividades","admin.logs":"Logs de Operao","admin.userManagement":"Gerenciamento de Usurios","admin.restaurantManagement":"Gerenciamento de Restaurantes","admin.activityManagement":"Gerenciamento de Atividades","admin.operationLogs":"Logs de Operao","admin.manageUserRoles":"Gerenciar funes e permisses de usurios","admin.manageRestaurants":"Visualizar e gerenciar todos os restaurantes","admin.manageActivities":"Visualizar e gerenciar todas as atividades","admin.viewSystemLogs":"Visualizar todos os logs de operao do sistema","admin.dashboardDescription":"Viso geral das estatsticas do sistema","admin.totalUsers":"Total de Usurios","admin.totalRestaurants":"Total de Restaurantes","admin.totalActivities":"Total de Atividades","admin.totalComments":"Total de Comentrios","admin.registeredUsers":"Usurios registrados","admin.listedRestaurants":"Restaurantes listados","admin.activeEvents":"Eventos ativos","admin.userReviews":"Avaliaes e comentrios de usurios","admin.recentActivity":"Atividade Recente","admin.recentActivityDescription":"ltimas atividades do sistema","admin.viewLogsForDetails":"Visualize os logs de operao para atividades detalhadas","admin.selectRole":"Selecione uma funo","admin.assignRole":"Atribuir Funo","admin.confirmRemoveRole":"Tem certeza de que deseja remover esta funo?","admin.noPhone":"Sem nmero de telefone","admin.addRestaurant":"Adicionar Restaurante","admin.addActivity":"Adicionar Atividade","admin.editActivity":"Editar Atividade","admin.activityCreated":"Atividade criada com sucesso","admin.activityUpdated":"Atividade atualizada com sucesso","admin.confirmDelete":"Confirmar Excluso","admin.deleteActivityWarning":"Isso excluir permanentemente a atividade e todos os dados associados. Esta ao no pode ser desfeita.","admin.activityImage":"Imagem da Atividade","admin.uploadImage":"Carregar Imagem","admin.titleEnglish":"Ttulo (Ingls)","admin.titleChinese":"Ttulo (Chins)","admin.titlePortuguese":"Ttulo (Portugus)","admin.contentEnglish":"Contedo (Ingls)","admin.contentChinese":"Contedo (Chins)","admin.contentPortuguese":"Contedo (Portugus)","admin.startDate":"Data de Incio","admin.endDate":"Data de Trmino","admin.pickDate":"Escolher data","admin.repeatMode":"Modo de Repetio","admin.selectRepeatMode":"Selecione o modo de repetio","admin.serviceType":"Tipo de Servio","admin.selectServiceType":"Selecione o tipo de servio","admin.repeatNone":"Sem Repetio","admin.repeatDaily":"Diariamente","admin.repeatWeekly":"Semanalmente","admin.repeatMonthly":"Mensalmente","admin.repeatYearly":"Anualmente","admin.associatedRestaurants":"Restaurantes Associados","admin.pinned":"Fixado","admin.sortOrder":"Ordem de Classificao","admin.editRestaurant":"Editar Restaurante","admin.restaurantCreated":"Restaurante criado com sucesso","admin.restaurantUpdated":"Restaurante atualizado com sucesso","admin.deleteRestaurantWarning":"Isso excluir permanentemente o restaurante e todos os dados associados. Esta ao no pode ser desfeita.","admin.restaurantImage":"Imagem do Restaurante","admin.nameChinese":"Nome (Chins)","admin.nameEnglish":"Nome (Ingls)","admin.namePortuguese":"Nome (Portugus)","admin.typeChinese":"Tipo (Chins)","admin.typeEnglish":"Tipo (Ingls)","admin.typePortuguese":"Tipo (Portugus)","admin.restaurantTypes":"Tipos de Restaurantes","admin.tags":"etiquetas","admin.addType":"Adicionar Tipo","admin.descriptionChinese":"Descrio (Chins)","admin.descriptionEnglish":"Descrio (Ingls)","admin.descriptionPortuguese":"Descrio (Portugus)","admin.address":"Endereo","admin.phone":"Telefone","admin.website":"Site","admin.showWebsiteButton":"Mostrar Boto do Site","admin.location":"Localizao","admin.locationOnMap":"Localizao no Mapa","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Clique no mapa ou arraste o marcador para definir a localizao","admin.mapInstructions":"Clique no mapa ou arraste o marcador para definir a localizao","admin.openingHours":"Horrio de Funcionamento","admin.closed":"Fechado","admin.day.monday":"Segunda-feira","admin.day.tuesday":"Tera-feira","admin.day.wednesday":"Quarta-feira","admin.day.thursday":"Quinta-feira","admin.day.friday":"Sexta-feira","admin.day.saturday":"Sbado","admin.day.sunday":"Domingo","admin.userGrowth":"Tendncia de Crescimento de Usurios","admin.userGrowthDescription":"Crescimento acumulado de registro de usurios","admin.activityEngagement":"Engajamento em Atividades","admin.activityEngagementDescription":"Inscritos e comentrios por atividade","admin.topRestaurants":"Restaurantes Mais Populares","admin.topRestaurantsDescription":"Restaurantes classificados por classificao e engajamento","admin.subscribers":"Inscritos","admin.comments":"Comentrios","admin.rating":"Classificao","admin.noData":"Nenhum dado disponvel","admin.exportCSV":"Exportar CSV","admin.exportSuccess":"Dados exportados com sucesso","admin.noDataToExport":"Nenhum dado disponvel para exportar","admin.batchDelete":"Excluso em Lote","admin.batchAssignRole":"Atribuir Funo em Lote","admin.selectedCount":"{{count}} selecionado(s)","admin.confirmBatchDelete":"Confirmar Excluso em Lote","admin.batchDeleteWarning":"Isso excluir permanentemente {{count}} itens. Esta ao no pode ser desfeita.","admin.clearSelection":"Limpar Seleo","admin.selectAll":"Selecionar Tudo","admin.searchUsers":"Pesquisar por nome ou telefone...","admin.searchRestaurants":"Pesquisar por nome ou endereo...","admin.searchActivities":"Pesquisar por ttulo ou contedo...","admin.filterByRole":"Filtrar por funo","admin.filterByType":"Filtrar por tipo","admin.filterByStatus":"Filtrar por status","admin.allRoles":"Todas as Funes","admin.allTypes":"Todos os Tipos","admin.allStatus":"Todos os Status","admin.statusActive":"Ativo","admin.statusEnded":"Encerrado","admin.statusPinned":"Fixado","admin.view":"Visualizar","admin.createMerchant":"Criar Comerciante","admin.createSupervisor":"Criar Supervisor","admin.createUser":"Criar Usurio","admin.createNewUser":"Criar Novo Usurio","admin.createUserDescription":"Criar uma nova conta de comerciante ou supervisor","admin.userCreated":"Usurio criado com sucesso","admin.createUserError":"Falha ao criar usurio","admin.role":"Funo","admin.create":"Criar","admin.oldData":"Dados Antigos","admin.newData":"Novos Dados","admin.noLogs":"Nenhum log de operao ainda","admin.merchant":"Comerciante","admin.supervisor":"Supervisor","admin.editActivityDetails":"Editar detalhes da atividade, datas e configuraes","admin.createActivityWithContent":"Criar nova atividade com contedo multilngue e formatao rica","admin.imageMaxSize":"PNG, JPG Mx 5MB","admin.imageTooBig":"O tamanho da imagem deve ser inferior a 10MB","admin.cropImage":"Cortar Imagem","admin.cropImageDescription":"Ajuste a rea de corte para se adequar ao tamanho recomendado","admin.recommendedSize":"Tamanho Recomendado","admin.imageSizeHint":"A imagem ser exibida nesta proporo em todos os dispositivos (desktop, tablet, mobile)","admin.confirmCrop":"Confirmar Corte","admin.multilingualContent":"Contedo Multilngue","admin.chinese":"Chins","admin.english":"Ingls","admin.portuguese":"Portugus","admin.title":"Ttulo","admin.content":"Contedo","admin.enterTitle":"Digite o ttulo da atividade...","admin.enterContent":"Digite o contedo detalhado da atividade com formatao rica...","admin.dateSettings":"Configuraes de Data","admin.selectDate":"Selecionar data","admin.displaySettings":"Configuraes de Exibio","admin.pinToTop":"Fixar no Topo","admin.showAtTop":"Mostrar esta atividade no topo da lista","admin.lowerFirst":"Nmeros menores aparecem primeiro","admin.selectParticipatingRestaurants":"Selecionar restaurantes participantes","admin.editRestaurantDetails":"Editar detalhes do restaurante, localizao, horrios e configuraes","admin.createRestaurantWithInfo":"Criar novo restaurante com contedo multilngue e informaes completas","admin.restaurantName":"Nome do Restaurante","admin.enterRestaurantName":"Digite o nome do restaurante...","admin.restaurantType":"Tipo de Restaurante (1-3 etiquetas)","admin.typeExample":"e.g. Cantons","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Digite a descrio do restaurante...","admin.contactAndWebsite":"Contato e Website","admin.enterAddress":"Digite o endereo...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Clique no mapa ou arraste o marcador para definir a localizao","admin.weekdays":"Dias de Semana","admin.weekend":"Fim de Semana","admin.copyToAll":"Copiar para Todos os Dias","admin.splitShift":"Turno Dividido","admin.open":"Abrir","admin.close":"Fechar","admin.afternoon":"Tarde","admin.evening":"Noite","admin.visible":"Visvel","admin.showInFrontend":"Mostrar este restaurante no frontend","common.saving":"Salvando...","merchant.myRestaurants":"Meus Restaurantes","merchant.merchantDescription":"Gerir informaes e configuraes do seu restaurante","merchant.supervisorDescription":"Gerir todos os restaurantes sob sua superviso","merchant.noRestaurants":"Nenhum restaurante atribudo ainda","joinUs.title":"Junte-se ao Xiaoxiong Market","joinUs.description":"Faa parceria connosco para desenvolver o seu negcio de restaurante. Preencha o formulrio abaixo e a nossa equipa entrar em contacto em breve.","joinUs.name":"Nome","joinUs.namePlaceholder":"Seu nome completo","joinUs.email":"Email","joinUs.emailPlaceholder":"seu@email.com","joinUs.phone":"Telefone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Nome do Restaurante","joinUs.restaurantNamePlaceholder":"Nome do seu restaurante","joinUs.restaurantAddress":"Morada do Restaurante (Opcional)","joinUs.restaurantAddressPlaceholder":"Morada completa, cidade","joinUs.optional":"Opcional","joinUs.featuresNeeded":"Funcionalidades Necessrias","joinUs.featuresDescription":"Selecione pelo menos uma funcionalidade do seu interesse","joinUs.feature.booking":"Reserva de Mesas","joinUs.feature.delivery":"Servio de Entrega","joinUs.feature.qrcode":"Menu QR Code","joinUs.submit":"Enviar Pedido","joinUs.nameMin":"O nome deve ter pelo menos 2 caracteres","joinUs.emailInvalid":"Endereo de email invlido","joinUs.phoneMin":"O telefone deve ter pelo menos 6 caracteres","joinUs.restaurantNameMin":"O nome do restaurante deve ter pelo menos 2 caracteres","joinUs.addressMin":"A morada do restaurante deve ter pelo menos 2 caracteres","joinUs.featuresMin":"Por favor, selecione pelo menos uma funcionalidade","joinUs.consentText":"Ao se registrar, voc concorda em receber e-mails de marketing e ofertas promocionais. Para detalhes, consulte nossa Poltica de Privacidade e Termos de Servio.","joinUs.successTitle":"Informao Enviada com Sucesso!","joinUs.successDescription":"Obrigado pela sua confiana!","joinUs.successMessage":"Suas informaes foram enviadas com sucesso! Obrigado pela sua confiana! Nosso consultor dedicado entrar em contato por telefone dentro de 24 horas teis.","joinUs.submitAnother":"Enviar Outro Pedido","joinUs.submitError":"Falha ao enviar pedido. Por favor, tente novamente.","joinUs.rateLimitError":"Muitos Pedidos","joinUs.rateLimitErrorDesc":"J enviou um pedido nas ltimas 24 horas. Por favor, tente mais tarde.","joinUs.adminTitle":"Gesto de Pedidos de Adeso","joinUs.adminDescription":"Ver e gerir todos os pedidos de adeso de comerciantes","joinUs.recipientEmail":"Email de Receo","joinUs.recipientEmailDesc":"Endereo de email onde os pedidos de adeso sero enviados","joinUs.totalRequests":"Total de Pedidos","joinUs.totalRequestsDesc":"Todos os pedidos de adeso recebidos","joinUs.allRequests":"Todos os Pedidos de Adeso","joinUs.allRequestsDesc":"Ver e gerir todos os pedidos de adeso submetidos","joinUs.searchPlaceholder":"Pesquisar por nome, email, restaurante...","joinUs.contact":"Contacto","joinUs.restaurant":"Restaurante","joinUs.submittedAt":"Submetido","joinUs.noRequests":"Nenhum pedido de adeso ainda","joinUs.enterNewEmail":"Introduza novo email de receo:","joinUs.emailUpdated":"Email de receo atualizado com sucesso","joinUs.emailUpdateError":"Falha ao atualizar email de receo","joinUs.status":"Estado","joinUs.status.pending":"Pendente","joinUs.status.completed":"Concludo","joinUs.status.rejected":"Rejeitado","joinUs.statusUpdated":"Estado atualizado com sucesso","joinUs.statusUpdateError":"Falha ao atualizar o estado","joinUs.requestDeleted":"Pedido eliminado com sucesso","joinUs.deleteError":"Falha ao eliminar o pedido","joinUs.confirmDelete":"Eliminar Pedido","joinUs.confirmDeleteDescription":"Tem certeza de que deseja eliminar este pedido? Esta ao no pode ser desfeita.","toast.subscribed":"Subscrito!","toast.unsubscribed":"Cancelado","toast.subscribedDesc":"Juntou-se a esta atividade","toast.unsubscribedDesc":"Saiu desta atividade","toast.subscriptionFailed":"Falha ao atualizar subscrio","toast.roleChanged":"Funo alterada com sucesso","toast.roleChangeFailed":"Falha ao alterar funo","toast.profileUpdated":"Perfil atualizado com sucesso","toast.profileUpdateFailed":"Falha ao atualizar perfil","toast.avatarUploadFailed":"Falha ao carregar avatar","toast.activityDeleted":"Atividade eliminada com sucesso","toast.activityDeleteFailed":"Falha ao eliminar atividade","toast.restaurantDeleted":"Restaurante eliminado com sucesso","toast.restaurantDeleteFailed":"Falha ao eliminar restaurante","toast.usersDeleted":"Utilizadores eliminados com sucesso","toast.usersDeleteFailed":"Falha ao eliminar utilizadores","toast.restaurantsDeleted":"Restaurantes eliminados com sucesso","toast.restaurantsDeleteFailed":"Falha ao eliminar restaurantes","toast.activitiesDeleted":"Atividades eliminadas com sucesso","toast.activitiesDeleteFailed":"Falha ao eliminar atividades","toast.rolesChanged":"Funes alteradas com sucesso","toast.rolesChangeFailed":"Falha ao alterar funes","toast.commentDeleted":"Comentrio eliminado com sucesso","toast.commentDeleteFailed":"Falha ao eliminar comentrio","toast.pleaseSelectRating":"Por favor selecione uma avaliao","toast.participationJoined":"Participao confirmada com sucesso","toast.participationLeft":"Saiu da atividade com sucesso","toast.participationFailed":"Falha ao atualizar participao","toast.visibilityUpdated":"Visibilidade do restaurante atualizada","toast.visibilityUpdateFailed":"Falha ao atualizar visibilidade do restaurante","toast.restaurantJoined":"Restaurante participou da atividade","toast.restaurantJoinedDesc":"Seu restaurante agora est participando desta atividade","toast.restaurantLeft":"Restaurante saiu da atividade","toast.restaurantLeftDesc":"Seu restaurante no est mais participando desta atividade","toast.participationUpdateFailed":"Falha ao atualizar participao","toast.participationUpdateFailedDesc":"Por favor, tente novamente mais tarde","toast.termsNotAgreed":"Termos da Atividade Necessrios","toast.termsNotAgreedDesc":"Por favor, concorde com os termos da atividade no seu perfil antes de participar","error.general":"Ocorreu um erro","error.networkError":"Erro de rede. Por favor, tente novamente.","error.notFound":"No encontrado","error.unauthorized":"Acesso no autorizado","validation.titleRequired":"Ttulo  obrigatrio","validation.contentRequired":"Contedo  obrigatrio","validation.nameRequired":"Nome  obrigatrio","validation.typeRequired":"Pelo menos 1 tipo  necessrio","validation.typeMaximum":"Mximo de 3 tipos permitidos","validation.addressRequired":"Endereo  obrigatrio","admin.showing":"Mostrando","admin.of":"de","admin.results":"resultados","address.myAddresses":"Meus Endereos","address.manageDescription":"Gerir os seus endereos de entrega e faturao","address.addNew":"Adicionar Endereo","address.addDescription":"Adicionar um novo endereo  sua conta","address.editAddress":"Editar Endereo","address.editDescription":"Atualizar as informaes do seu endereo","address.label":"Rtulo","address.selectLabel":"Selecionar um rtulo","address.labelHome":"Casa","address.labelWork":"Trabalho","address.labelOffice":"Escritrio","address.labelOther":"Outro","address.street":"Morada","address.streetPlaceholder":"Introduza a morada","address.district":"Freguesia/Distrito","address.districtPlaceholder":"Introduza a freguesia","address.city":"Cidade","address.cityPlaceholder":"Introduza a cidade","address.postalCode":"Cdigo Postal","address.postalCodePlaceholder":"Introduza o cdigo postal","address.country":"Pas","address.selectCountry":"Selecionar pas","address.setAsDefault":"Definir como endereo padro","address.default":"Padro","address.add":"Adicionar Endereo","address.noAddresses":"Ainda no adicionou nenhum endereo","address.addFirst":"Adicionar o Primeiro Endereo","address.deleteTitle":"Eliminar Endereo","address.deleteDescription":"Tem a certeza de que deseja eliminar este endereo? Esta ao no pode ser desfeita.","address.phone":"Nmero de Telefone","address.phonePlaceholder":"Introduza o nmero de telefone","address.phoneConfirmTitle":"Adicionar Telefone ao Perfil","address.phoneConfirmDescription":"O seu perfil ainda no tem um nmero de telefone. Gostaria de guardar este nmero de telefone tambm no seu perfil?"}}};Pr.use(fie).use(O2e).init({resources:zCe,fallbackLng:"en",supportedLngs:["en","zh","pt"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const BCe=()=>{const{user:e}=Qn(),t=Ri();return V.useEffect(()=>{if(!e)return;const r=Ct.channel("notifications-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications",e.id]}),t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{Ct.removeChannel(r)}},[e,t]),ci({queryKey:["notifications",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:r,error:n}=await Ct.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);if(n)throw n;return r},enabled:!!e})},$Ce=()=>{const{user:e}=Qn(),t=Ri();return V.useEffect(()=>{if(!e)return;const r=Ct.channel("notifications-unread-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{Ct.removeChannel(r)}},[e,t]),ci({queryKey:["notifications-unread-count",e==null?void 0:e.id],queryFn:async()=>{if(!e)return 0;const{count:r,error:n}=await Ct.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n;return r||0},enabled:!!e})},UCe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("notifications").update({read:!0}).eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notifications-unread-count"]})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("notifications.markAsReadError"),variant:"destructive"})}})},VCe=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async()=>{if(!e)throw new Error(Pr.t("notifications.userNotAuthenticated"));const{error:n}=await Ct.from("notifications").update({read:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["notifications"]}),r.invalidateQueries({queryKey:["notifications-unread-count"]}),t({title:Pr.t("common.success"),description:Pr.t("notifications.markAllAsReadSuccess")})},onError:()=>{t({title:Pr.t("common.error"),description:Pr.t("notifications.markAllAsReadError"),variant:"destructive"})}})};function wi(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Xc(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function cc(e,t){const r=wi(e);return isNaN(t)?Xc(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function Wd(e,t){const r=wi(e);if(isNaN(t))return Xc(e,NaN);if(!t)return r;const n=r.getDate(),s=Xc(e,r.getTime());s.setMonth(r.getMonth()+t+1,0);const o=s.getDate();return n>=o?s:(r.setFullYear(s.getFullYear(),s.getMonth(),n),r)}const S5=6048e5,qCe=864e5,Tj=43200,yG=1440;let HCe={};function dw(){return HCe}function Wh(e,t){var i,m,y,S;const r=dw(),n=(t==null?void 0:t.weekStartsOn)??((m=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:m.weekStartsOn)??r.weekStartsOn??((S=(y=r.locale)==null?void 0:y.options)==null?void 0:S.weekStartsOn)??0,s=wi(e),o=s.getDay(),d=(o<n?7:0)+o-n;return s.setDate(s.getDate()-d),s.setHours(0,0,0,0),s}function kv(e){return Wh(e,{weekStartsOn:1})}function pie(e){const t=wi(e),r=t.getFullYear(),n=Xc(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const s=kv(n),o=Xc(e,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const d=kv(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=d.getTime()?r:r-1}function fg(e){const t=wi(e);return t.setHours(0,0,0,0),t}function gb(e){const t=wi(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function Ph(e,t){const r=fg(e),n=fg(t),s=+r-gb(r),o=+n-gb(n);return Math.round((s-o)/qCe)}function GCe(e){const t=pie(e),r=Xc(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),kv(r)}function EF(e,t){const r=t*7;return cc(e,r)}function WCe(e,t){return Wd(e,t*12)}function KCe(e){let t;return e.forEach(function(r){const n=wi(r);(t===void 0||t<n||isNaN(Number(n)))&&(t=n)}),t||new Date(NaN)}function ZCe(e){let t;return e.forEach(r=>{const n=wi(r);(!t||t>n||isNaN(+n))&&(t=n)}),t||new Date(NaN)}function lP(e,t){const r=wi(e),n=wi(t),s=r.getTime()-n.getTime();return s<0?-1:s>0?1:s}function XCe(e){return Xc(e,Date.now())}function Vc(e,t){const r=fg(e),n=fg(t);return+r==+n}function E5(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function YCe(e){if(!E5(e)&&typeof e!="number")return!1;const t=wi(e);return!isNaN(Number(t))}function yb(e,t){const r=wi(e),n=wi(t),s=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return s*12+o}function JCe(e,t,r){const n=Wh(e,r),s=Wh(t,r),o=+n-gb(n),d=+s-gb(s);return Math.round((o-d)/S5)}function QCe(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function eje(e,t){return+wi(e)-+wi(t)}function tje(e){const t=wi(e);return t.setHours(23,59,59,999),t}function kN(e){const t=wi(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function rje(e){const t=wi(e);return+tje(t)==+kN(t)}function nje(e,t){const r=wi(e),n=wi(t),s=lP(r,n),o=Math.abs(yb(r,n));let d;if(o<1)d=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*o);let i=lP(r,n)===-s;rje(wi(e))&&o===1&&lP(e,n)===1&&(i=!1),d=s*(o-Number(i))}return d===0?0:d}function ije(e,t,r){const n=eje(e,t)/1e3;return QCe(r==null?void 0:r.roundingMethod)(n)}function Kc(e){const t=wi(e);return t.setDate(1),t.setHours(0,0,0,0),t}function mie(e){const t=wi(e),r=Xc(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function T5(e,t){var i,m,y,S;const r=dw(),n=(t==null?void 0:t.weekStartsOn)??((m=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:m.weekStartsOn)??r.weekStartsOn??((S=(y=r.locale)==null?void 0:y.options)==null?void 0:S.weekStartsOn)??0,s=wi(e),o=s.getDay(),d=(o<n?-7:0)+6-(o-n);return s.setDate(s.getDate()+d),s.setHours(23,59,59,999),s}function gie(e){return T5(e,{weekStartsOn:1})}const sje={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},aje=(e,t,r)=>{let n;const s=sje[e];return typeof s=="string"?n=s:t===1?n=s.one:n=s.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function ZD(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const oje={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},lje={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},cje={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},uje={date:ZD({formats:oje,defaultWidth:"full"}),time:ZD({formats:lje,defaultWidth:"full"}),dateTime:ZD({formats:cje,defaultWidth:"full"})},dje={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},hje=(e,t,r,n)=>dje[e];function US(e){return(t,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let s;if(n==="formatting"&&e.formattingValues){const d=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):d;s=e.formattingValues[i]||e.formattingValues[d]}else{const d=e.defaultWidth,i=r!=null&&r.width?String(r.width):e.defaultWidth;s=e.values[i]||e.values[d]}const o=e.argumentCallback?e.argumentCallback(t):t;return s[o]}}const fje={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},pje={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},mje={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},gje={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},yje={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},vje={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},_je=(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},xje={ordinalNumber:_je,era:US({values:fje,defaultWidth:"wide"}),quarter:US({values:pje,defaultWidth:"wide",argumentCallback:e=>e-1}),month:US({values:mje,defaultWidth:"wide"}),day:US({values:gje,defaultWidth:"wide"}),dayPeriod:US({values:yje,defaultWidth:"wide",formattingValues:vje,defaultFormattingWidth:"wide"})};function VS(e){return(t,r={})=>{const n=r.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(s);if(!o)return null;const d=o[0],i=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],m=Array.isArray(i)?wje(i,w=>w.test(d)):bje(i,w=>w.test(d));let y;y=e.valueCallback?e.valueCallback(m):m,y=r.valueCallback?r.valueCallback(y):y;const S=t.slice(d.length);return{value:y,rest:S}}}function bje(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function wje(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function Sje(e){return(t,r={})=>{const n=t.match(e.matchPattern);if(!n)return null;const s=n[0],o=t.match(e.parsePattern);if(!o)return null;let d=e.valueCallback?e.valueCallback(o[0]):o[0];d=r.valueCallback?r.valueCallback(d):d;const i=t.slice(s.length);return{value:d,rest:i}}}const Eje=/^(\d+)(th|st|nd|rd)?/i,Tje=/\d+/i,Aje={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Cje={any:[/^b/i,/^(a|c)/i]},jje={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Pje={any:[/1/i,/2/i,/3/i,/4/i]},Oje={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},kje={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Nje={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ije={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Rje={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Mje={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Dje={ordinalNumber:Sje({matchPattern:Eje,parsePattern:Tje,valueCallback:e=>parseInt(e,10)}),era:VS({matchPatterns:Aje,defaultMatchWidth:"wide",parsePatterns:Cje,defaultParseWidth:"any"}),quarter:VS({matchPatterns:jje,defaultMatchWidth:"wide",parsePatterns:Pje,defaultParseWidth:"any",valueCallback:e=>e+1}),month:VS({matchPatterns:Oje,defaultMatchWidth:"wide",parsePatterns:kje,defaultParseWidth:"any"}),day:VS({matchPatterns:Nje,defaultMatchWidth:"wide",parsePatterns:Ije,defaultParseWidth:"any"}),dayPeriod:VS({matchPatterns:Rje,defaultMatchWidth:"any",parsePatterns:Mje,defaultParseWidth:"any"})},A5={code:"en-US",formatDistance:aje,formatLong:uje,formatRelative:hje,localize:xje,match:Dje,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Lje(e){const t=wi(e);return Ph(t,mie(t))+1}function yie(e){const t=wi(e),r=+kv(t)-+GCe(t);return Math.round(r/S5)+1}function vie(e,t){var S,w,T,A;const r=wi(e),n=r.getFullYear(),s=dw(),o=(t==null?void 0:t.firstWeekContainsDate)??((w=(S=t==null?void 0:t.locale)==null?void 0:S.options)==null?void 0:w.firstWeekContainsDate)??s.firstWeekContainsDate??((A=(T=s.locale)==null?void 0:T.options)==null?void 0:A.firstWeekContainsDate)??1,d=Xc(e,0);d.setFullYear(n+1,0,o),d.setHours(0,0,0,0);const i=Wh(d,t),m=Xc(e,0);m.setFullYear(n,0,o),m.setHours(0,0,0,0);const y=Wh(m,t);return r.getTime()>=i.getTime()?n+1:r.getTime()>=y.getTime()?n:n-1}function Fje(e,t){var i,m,y,S;const r=dw(),n=(t==null?void 0:t.firstWeekContainsDate)??((m=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:m.firstWeekContainsDate)??r.firstWeekContainsDate??((S=(y=r.locale)==null?void 0:y.options)==null?void 0:S.firstWeekContainsDate)??1,s=vie(e,t),o=Xc(e,0);return o.setFullYear(s,0,n),o.setHours(0,0,0,0),Wh(o,t)}function _ie(e,t){const r=wi(e),n=+Wh(r,t)-+Fje(r,t);return Math.round(n/S5)+1}function Vs(e,t){const r=e<0?"-":"",n=Math.abs(e).toString().padStart(t,"0");return r+n}const gm={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return Vs(t==="yy"?n%100:n,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):Vs(r+1,2)},d(e,t){return Vs(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return Vs(e.getHours()%12||12,t.length)},H(e,t){return Vs(e.getHours(),t.length)},m(e,t){return Vs(e.getMinutes(),t.length)},s(e,t){return Vs(e.getSeconds(),t.length)},S(e,t){const r=t.length,n=e.getMilliseconds(),s=Math.trunc(n*Math.pow(10,r-3));return Vs(s,t.length)}},qx={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},vG={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const n=e.getFullYear(),s=n>0?n:1-n;return r.ordinalNumber(s,{unit:"year"})}return gm.y(e,t)},Y:function(e,t,r,n){const s=vie(e,n),o=s>0?s:1-s;if(t==="YY"){const d=o%100;return Vs(d,2)}return t==="Yo"?r.ordinalNumber(o,{unit:"year"}):Vs(o,t.length)},R:function(e,t){const r=pie(e);return Vs(r,t.length)},u:function(e,t){const r=e.getFullYear();return Vs(r,t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return Vs(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return Vs(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return gm.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return Vs(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const s=_ie(e,n);return t==="wo"?r.ordinalNumber(s,{unit:"week"}):Vs(s,t.length)},I:function(e,t,r){const n=yie(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):Vs(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):gm.d(e,t)},D:function(e,t,r){const n=Lje(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):Vs(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const s=e.getDay(),o=(s-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return Vs(o,2);case"eo":return r.ordinalNumber(o,{unit:"day"});case"eee":return r.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(s,{width:"short",context:"formatting"});case"eeee":default:return r.day(s,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const s=e.getDay(),o=(s-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return Vs(o,t.length);case"co":return r.ordinalNumber(o,{unit:"day"});case"ccc":return r.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(s,{width:"narrow",context:"standalone"});case"cccccc":return r.day(s,{width:"short",context:"standalone"});case"cccc":default:return r.day(s,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),s=n===0?7:n;switch(t){case"i":return String(s);case"ii":return Vs(s,t.length);case"io":return r.ordinalNumber(s,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let s;switch(n===12?s=qx.noon:n===0?s=qx.midnight:s=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let s;switch(n>=17?s=qx.evening:n>=12?s=qx.afternoon:n>=4?s=qx.morning:s=qx.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let n=e.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return gm.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):gm.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):Vs(n,t.length)},k:function(e,t,r){let n=e.getHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):Vs(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):gm.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):gm.s(e,t)},S:function(e,t){return gm.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(t){case"X":return xG(n);case"XXXX":case"XX":return Uy(n);case"XXXXX":case"XXX":default:return Uy(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return xG(n);case"xxxx":case"xx":return Uy(n);case"xxxxx":case"xxx":default:return Uy(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+_G(n,":");case"OOOO":default:return"GMT"+Uy(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+_G(n,":");case"zzzz":default:return"GMT"+Uy(n,":")}},t:function(e,t,r){const n=Math.trunc(e.getTime()/1e3);return Vs(n,t.length)},T:function(e,t,r){const n=e.getTime();return Vs(n,t.length)}};function _G(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),s=Math.trunc(n/60),o=n%60;return o===0?r+String(s):r+String(s)+t+Vs(o,2)}function xG(e,t){return e%60===0?(e>0?"-":"+")+Vs(Math.abs(e)/60,2):Uy(e,t)}function Uy(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),s=Vs(Math.trunc(n/60),2),o=Vs(n%60,2);return r+s+t+o}const bG=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},xie=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},zje=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],s=r[2];if(!s)return bG(e,t);let o;switch(n){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",bG(n,t)).replace("{{time}}",xie(s,t))},Bje={p:xie,P:zje},$je=/^D+$/,Uje=/^Y+$/,Vje=["D","DD","YY","YYYY"];function qje(e){return $je.test(e)}function Hje(e){return Uje.test(e)}function Gje(e,t,r){const n=Wje(e,t,r);if(console.warn(n),Vje.includes(e))throw new RangeError(n)}function Wje(e,t,r){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Kje=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Zje=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Xje=/^'([^]*?)'?$/,Yje=/''/g,Jje=/[a-zA-Z]/;function Rs(e,t,r){var S,w,T,A,O,P,N,R;const n=dw(),s=(r==null?void 0:r.locale)??n.locale??A5,o=(r==null?void 0:r.firstWeekContainsDate)??((w=(S=r==null?void 0:r.locale)==null?void 0:S.options)==null?void 0:w.firstWeekContainsDate)??n.firstWeekContainsDate??((A=(T=n.locale)==null?void 0:T.options)==null?void 0:A.firstWeekContainsDate)??1,d=(r==null?void 0:r.weekStartsOn)??((P=(O=r==null?void 0:r.locale)==null?void 0:O.options)==null?void 0:P.weekStartsOn)??n.weekStartsOn??((R=(N=n.locale)==null?void 0:N.options)==null?void 0:R.weekStartsOn)??0,i=wi(e);if(!YCe(i))throw new RangeError("Invalid time value");let m=t.match(Zje).map(M=>{const F=M[0];if(F==="p"||F==="P"){const B=Bje[F];return B(M,s.formatLong)}return M}).join("").match(Kje).map(M=>{if(M==="''")return{isToken:!1,value:"'"};const F=M[0];if(F==="'")return{isToken:!1,value:Qje(M)};if(vG[F])return{isToken:!0,value:M};if(F.match(Jje))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:M}});s.localize.preprocessor&&(m=s.localize.preprocessor(i,m));const y={firstWeekContainsDate:o,weekStartsOn:d,locale:s};return m.map(M=>{if(!M.isToken)return M.value;const F=M.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&Hje(F)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&qje(F))&&Gje(F,t,String(e));const B=vG[F[0]];return B(i,F,s.localize,y)}).join("")}function Qje(e){const t=e.match(Xje);return t?t[1].replace(Yje,"'"):e}function ePe(e,t,r){const n=dw(),s=(r==null?void 0:r.locale)??n.locale??A5,o=2520,d=lP(e,t);if(isNaN(d))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:d});let m,y;d>0?(m=wi(t),y=wi(e)):(m=wi(e),y=wi(t));const S=ije(y,m),w=(gb(y)-gb(m))/1e3,T=Math.round((S-w)/60);let A;if(T<2)return r!=null&&r.includeSeconds?S<5?s.formatDistance("lessThanXSeconds",5,i):S<10?s.formatDistance("lessThanXSeconds",10,i):S<20?s.formatDistance("lessThanXSeconds",20,i):S<40?s.formatDistance("halfAMinute",0,i):S<60?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",1,i):T===0?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",T,i);if(T<45)return s.formatDistance("xMinutes",T,i);if(T<90)return s.formatDistance("aboutXHours",1,i);if(T<yG){const O=Math.round(T/60);return s.formatDistance("aboutXHours",O,i)}else{if(T<o)return s.formatDistance("xDays",1,i);if(T<Tj){const O=Math.round(T/yG);return s.formatDistance("xDays",O,i)}else if(T<Tj*2)return A=Math.round(T/Tj),s.formatDistance("aboutXMonths",A,i)}if(A=nje(y,m),A<12){const O=Math.round(T/Tj);return s.formatDistance("xMonths",O,i)}else{const O=A%12,P=Math.trunc(A/12);return O<3?s.formatDistance("aboutXYears",P,i):O<9?s.formatDistance("overXYears",P,i):s.formatDistance("almostXYears",P+1,i)}}function Tg(e,t){return ePe(e,XCe(e),t)}function tPe(e){const t=wi(e),r=t.getFullYear(),n=t.getMonth(),s=Xc(e,0);return s.setFullYear(r,n+1,0),s.setHours(0,0,0,0),s.getDate()}function rPe(e){return Math.trunc(+wi(e)/1e3)}function nPe(e){const t=wi(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function iPe(e,t){return JCe(nPe(e),Kc(e),t)+1}function TF(e,t){const r=wi(e),n=wi(t);return r.getTime()>n.getTime()}function bie(e,t){const r=wi(e),n=wi(t);return+r<+n}function C5(e,t){const r=wi(e),n=wi(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function sPe(e,t){const r=wi(e),n=wi(t);return r.getFullYear()===n.getFullYear()}function cP(e,t){return cc(e,-t)}function XD(e,t){const r=wi(e),n=r.getFullYear(),s=r.getDate(),o=Xc(e,0);o.setFullYear(n,t,15),o.setHours(0,0,0,0);const d=tPe(o);return r.setMonth(t,Math.min(s,d)),r}function wG(e,t){const r=wi(e);return isNaN(+r)?Xc(e,NaN):(r.setFullYear(t),r)}const aPe=()=>{const{t:e}=ei(),{data:t=[]}=BCe(),{data:r=0}=$Ce(),n=UCe(),s=VCe(),o=(i,m)=>{m||n.mutate(i)},d=i=>{switch(i){case"comment_reply":return"";case"new_activity":return"";case"activity_update":return"";case"new_user":return"";case"merchant_joined":return"";default:return""}};return h.jsxs(e_,{children:[h.jsx(t_,{asChild:!0,children:h.jsxs(Mt,{variant:"ghost",size:"icon",className:"relative",children:[h.jsx(TQ,{className:"h-5 w-5"}),r>0&&h.jsx(tn,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs",children:r>9?"9+":r})]})}),h.jsxs(Eg,{align:"end",className:"w-80 max-h-[500px]",children:[h.jsxs(v5,{className:"flex items-center justify-between",children:[h.jsx("span",{children:e("notifications.title")}),r>0&&h.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>s.mutate(),disabled:s.isPending,children:[h.jsx(w_e,{className:"h-4 w-4 mr-1"}),e("notifications.markAllRead")]})]}),h.jsx(Xf,{}),h.jsx(Ov,{className:"h-[400px]",children:t.length===0?h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("notifications.noNotifications")}):t.map(i=>h.jsx(Is,{className:`flex flex-col items-start p-3 cursor-pointer ${i.read?"":"bg-secondary/50"}`,asChild:!0,children:h.jsx(Hi,{to:i.link||"#",onClick:()=>o(i.id,i.read),children:h.jsxs("div",{className:"flex items-start gap-2 w-full",children:[h.jsx("span",{className:"text-2xl",children:d(i.type)}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsx("p",{className:"font-semibold text-sm truncate",children:i.title}),!i.read&&h.jsx(tn,{variant:"default",className:"h-2 w-2 p-0 rounded-full"})]}),h.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mt-1",children:i.content}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Tg(new Date(i.created_at),{addSuffix:!0})})]})]})})},i.id))})]})]})},D0=()=>{var A,O,P,N,R,M,F,B;const[e,t]=V.useState(!1),{user:r,signOut:n}=Qn(),{t:s,i18n:o}=ei(),{isAdmin:d,isSupervisor:i,isMerchant:m}=_c(),{data:y}=jN();V.useEffect(()=>{y!=null&&y.language_preference&&y.language_preference!==o.language&&o.changeLanguage(y.language_preference)},[y,o]);const S=V.useMemo(()=>[{to:"/",icon:ga,label:s("nav.map")},{to:"/restaurants",icon:jQ,label:s("nav.restaurants")},{to:"/activities",icon:yo,label:s("nav.activities")},{to:"/map",icon:OQ,label:s("nav.mapView")},{to:"/join-us",icon:Mo,label:s("nav.joinUs")}],[s]),w=V.useCallback(()=>{n(),t(!1)},[n]),T=V.useCallback(()=>{t(!1)},[]);return h.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border shadow-soft",children:h.jsxs("div",{className:"w-full px-3 sm:px-4 lg:px-6 h-14 sm:h-16 flex items-center justify-between",children:[h.jsx(Hi,{to:"/",className:"flex items-center gap-2",children:h.jsx("img",{src:aO,alt:"Logo",className:"w-[35px] h-[35px] md:w-[45px] md:h-[45px] object-contain drop-shadow-md"})}),h.jsx("div",{className:"hidden lg:flex items-center gap-6",children:S.map($=>h.jsxs(Hi,{to:$.to,className:"flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[h.jsx($.icon,{className:"w-4 h-4"}),h.jsx("span",{children:$.label})]},$.to))}),h.jsxs("div",{className:"flex items-center gap-1 sm:gap-3",children:[h.jsx(cCe,{}),r&&h.jsx(aPe,{}),r?h.jsxs(e_,{children:[h.jsx(t_,{asChild:!0,children:h.jsx(Mt,{variant:"ghost",size:"icon",className:"rounded-full h-8 w-8 sm:h-10 sm:w-10",children:h.jsxs(qh,{className:"w-7 h-7 sm:w-8 sm:h-8",children:[h.jsx(Hh,{src:(y==null?void 0:y.avatar_url)||((A=r.user_metadata)==null?void 0:A.avatar_url)}),h.jsx(Gh,{className:"text-xs sm:text-sm",children:((P=(O=y==null?void 0:y.display_name)==null?void 0:O[0])==null?void 0:P.toUpperCase())||((M=(R=(N=r.user_metadata)==null?void 0:N.display_name)==null?void 0:R[0])==null?void 0:M.toUpperCase())||((B=(F=r.email)==null?void 0:F[0])==null?void 0:B.toUpperCase())})]})})}),h.jsxs(Eg,{align:"end",children:[h.jsx(v5,{children:s("nav.myAccount")}),h.jsx(Xf,{}),h.jsx(Is,{asChild:!0,children:h.jsxs(Hi,{to:"/profile",className:"cursor-pointer",children:[h.jsx(P0,{className:"w-4 h-4 mr-2"}),s("nav.profile")]})}),(m||i)&&h.jsxs(h.Fragment,{children:[h.jsx(Is,{asChild:!0,children:h.jsxs(Hi,{to:"/merchant-restaurants",className:"cursor-pointer",children:[h.jsx(Mo,{className:"w-4 h-4 mr-2"}),s("nav.manageRestaurants")]})}),h.jsx(Is,{asChild:!0,children:h.jsxs(Hi,{to:"/merchant/activity-requests",className:"cursor-pointer",children:[h.jsx(P3,{className:"w-4 h-4 mr-2"}),""]})})]}),(d||i)&&h.jsxs(h.Fragment,{children:[h.jsx(Xf,{}),h.jsx(Is,{asChild:!0,children:h.jsxs(Hi,{to:"/admin",className:"cursor-pointer",children:[h.jsx(Lc,{className:"w-4 h-4 mr-2"}),s("nav.admin")]})})]}),h.jsx(Xf,{}),h.jsxs(Is,{onClick:()=>n(),className:"cursor-pointer",children:[h.jsx(F9,{className:"w-4 h-4 mr-2"}),s("nav.signOut")]})]})]}):h.jsx(Mt,{asChild:!0,className:"hidden lg:flex",children:h.jsx(Hi,{to:"/auth",children:s("nav.signIn")})}),h.jsxs(Nre,{open:e,onOpenChange:t,children:[h.jsx(RTe,{asChild:!0,className:"lg:hidden",children:h.jsx(Mt,{size:"icon",className:"h-8 w-8 sm:h-10 sm:w-10 bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg",children:h.jsx(kQ,{className:"w-4 sm:w-5 h-4 sm:h-5"})})}),h.jsx(o5,{side:"right",className:"w-64 sm:w-80",children:h.jsxs("div",{className:"flex flex-col gap-4 mt-8",children:[S.map($=>h.jsxs(Hi,{to:$.to,onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[h.jsx($.icon,{className:"w-5 h-5"}),h.jsx("span",{children:$.label})]},$.to)),h.jsx("div",{className:"border-t border-border my-4"}),r?h.jsxs(h.Fragment,{children:[h.jsxs(Hi,{to:"/profile",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[h.jsx(P0,{className:"w-5 h-5"}),h.jsx("span",{children:s("nav.profile")})]}),(m||i)&&h.jsxs(h.Fragment,{children:[h.jsxs(Hi,{to:"/merchant-restaurants",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[h.jsx(Mo,{className:"w-5 h-5"}),h.jsx("span",{children:s("nav.manageRestaurants")})]}),h.jsxs(Hi,{to:"/merchant/activity-requests",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[h.jsx(P3,{className:"w-5 h-5"}),h.jsx("span",{children:""})]})]}),(d||i)&&h.jsxs(Hi,{to:"/admin",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[h.jsx(Lc,{className:"w-5 h-5"}),h.jsx("span",{children:s("nav.admin")})]}),h.jsxs("button",{onClick:w,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[h.jsx(F9,{className:"w-5 h-5"}),h.jsx("span",{children:s("nav.signOut")})]})]}):h.jsxs(Hi,{to:"/auth",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[h.jsx(P0,{className:"w-5 h-5"}),h.jsx("span",{children:s("nav.signIn")})]})]})})]})]})]})})};function oPe(){const{pathname:e}=Qh();return V.useEffect(()=>{window.scrollTo(0,0)},[e]),null}const kr=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,className:fr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));kr.displayName="Card";const Rn=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,className:fr("flex flex-col space-y-1.5 p-6",e),...t}));Rn.displayName="CardHeader";const Hn=V.forwardRef(({className:e,...t},r)=>h.jsx("h3",{ref:r,className:fr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Hn.displayName="CardTitle";const cs=V.forwardRef(({className:e,...t},r)=>h.jsx("p",{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));cs.displayName="CardDescription";const Mr=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,className:fr("p-6 pt-0",e),...t}));Mr.displayName="CardContent";const NN=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,className:fr("flex items-center p-6 pt-0",e),...t}));NN.displayName="CardFooter";const lPe="/assets/sushi-ramen-hero-kMMmiTPz.jpg",cPe="/assets/sushi-ramen-mobile-BHV96LaL.jpg",uPe="/assets/map-icon-CwlHKRle.png",wie="00000000-0000-0000-0000-000000000001",Sie=()=>ci({queryKey:["homepage-config"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("homepage_config").select("*").eq("id",wie).single();if(t)throw t;return e}}),dPe=()=>{const e=Ri();return Gi({mutationFn:async t=>{const{data:r,error:n}=await Ct.from("homepage_config").update(t).eq("id",wie).select().single();if(n)throw n;return r},onSuccess:()=>{e.invalidateQueries({queryKey:["homepage-config"]}),Nr.success("")},onError:t=>{console.error("Failed to update homepage config:",t),Nr.error("")}})},hPe=()=>{const e=Ri();return Gi({mutationFn:async({file:t,type:r})=>{const n=t.name.split(".").pop(),o=`${r}-${Date.now()}.${n}`,{error:d}=await Ct.storage.from("homepage-images").upload(o,t,{upsert:!0});if(d)throw d;const{data:{publicUrl:i}}=Ct.storage.from("homepage-images").getPublicUrl(o);return{type:r,url:i}},onSuccess:({type:t,url:r})=>{e.invalidateQueries({queryKey:["homepage-config"]}),Nr.success(`${t}`)},onError:t=>{console.error("Failed to upload image:",t),Nr.error("")}})},Eie=V.memo(({stats:e,t})=>h.jsx("div",{className:"absolute top-3 sm:top-4 left-3 z-20",children:h.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(aT,{className:"w-4 h-4 text-primary"}),h.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:t("home.stats.delivery")}),h.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:e.order_count})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(__e,{className:"w-4 h-4 text-accent"}),h.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:t("home.stats.reservation")}),h.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:e.reserve_count})]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:t("home.hero.brandName")}),h.jsx("img",{src:uPe,alt:"map icon",className:"w-5 sm:w-8 h-5 sm:h-8 object-contain flex-shrink-0"})]})]})}));Eie.displayName="StatsDisplay";const uP=V.memo(({to:e,Icon:t,title:r,desc:n,iconBg:s,iconColor:o,hoverBorderColor:d})=>h.jsx(Hi,{to:e,children:h.jsxs(kr,{className:`group p-6 sm:p-8 border-border/50 ${d} transition-all hover:shadow-large cursor-pointer h-full`,children:[h.jsx("div",{className:`w-14 sm:w-16 h-14 sm:h-16 rounded-2xl ${s} flex items-center justify-center mb-4 sm:mb-6 group-hover:scale-110 transition-transform`,children:h.jsx(t,{className:`w-7 sm:w-8 h-7 sm:h-8 ${o}`})}),h.jsx("h3",{className:"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3 text-card-foreground",children:r}),h.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground leading-relaxed flex items-center gap-2",children:[n,h.jsx(EQ,{className:"w-4 h-4 flex-shrink-0 group-hover:translate-x-1 transition-transform"})]})]})}));uP.displayName="FeatureCard";const fPe=()=>{const{t:e,i18n:t}=ei(),{data:r}=Sie(),[n,s]=V.useState(null);V.useEffect(()=>{(async()=>{try{const P=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();P&&s({order_count:P.order_count||0,reserve_count:P.reserve_count||0})}catch(O){console.error("Failed to fetch stats:",O)}})()},[]);const o=t.language,d=A=>r&&r[`${A}${o==="zh"?"_zh":o==="pt"?"_pt":"_en"}`]||"",i=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",m=()=>{if(!r)return .3;const A=i();return A==="mobile"&&r.mobile_overlay_opacity!==null&&r.mobile_overlay_opacity!==void 0?r.mobile_overlay_opacity:A==="tablet"&&r.tablet_overlay_opacity!==null&&r.tablet_overlay_opacity!==void 0?r.tablet_overlay_opacity:A==="desktop"&&r.desktop_overlay_opacity!==null&&r.desktop_overlay_opacity!==void 0?r.desktop_overlay_opacity:r.overlay_opacity!==null&&r.overlay_opacity!==void 0?r.overlay_opacity:.3},y=()=>{if(!r)return{background:"linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.25), rgba(0,0,0,0.4))"};const A=m(),O=r.overlay_gradient_direction||"to-b",P=(ae,re)=>ae==null?re/100:ae>1?ae/100:ae,N=A>1?A/100:A,R=P(r.overlay_gradient_from_opacity,30)*N,M=P(r.overlay_gradient_via_opacity,25)*N,F=P(r.overlay_gradient_to_opacity,40)*N,$={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[O]||"to bottom",W={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},K=W[r.overlay_gradient_from||"black"]||"0, 0, 0",te=W[r.overlay_gradient_via||"black"]||"0, 0, 0",ne=W[r.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${$}, rgba(${K}, ${R}), rgba(${te}, ${M}), rgba(${ne}, ${F}))`}},S=(r==null?void 0:r.mobile_image_url)||cPe,w=(r==null?void 0:r.desktop_image_url)||lPe,T=(r==null?void 0:r.background_blur)||0;return h.jsxs("div",{className:"min-h-screen",children:[h.jsxs("section",{className:"relative min-h-screen flex items-start overflow-hidden",children:[h.jsxs("div",{className:"absolute inset-0",children:[h.jsx("img",{src:S,alt:"Background",className:"w-full h-full object-cover sm:hidden",style:{filter:T>0?`blur(${T}px)`:void 0}}),h.jsx("img",{src:w,alt:"Background",className:"w-full h-full object-cover hidden sm:block",style:{filter:T>0?`blur(${T}px)`:void 0}}),h.jsx("div",{className:"absolute inset-0",style:y()})]}),(r==null?void 0:r.show_stats)!==!1&&n&&h.jsx(Eie,{stats:n,t:e}),h.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:h.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[h.jsx(Mt,{size:"lg",asChild:!0,className:"text-base sm:text-lg shadow-lg hover:shadow-xl transition-shadow",children:h.jsxs(Hi,{to:(r==null?void 0:r.subtitle_button_link)||"/map",children:[h.jsx(ga,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),d("subtitle_button_text")||e("home.hero.subtitle")]})}),h.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:d("title")||e("home.hero.title")}),h.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:d("description")||e("home.hero.description")}),h.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center pt-2 sm:pt-4 px-4",children:[h.jsx(Mt,{size:"lg",asChild:!0,className:"text-base sm:text-lg shadow-lg hover:shadow-xl transition-shadow w-full sm:w-auto",children:h.jsxs(Hi,{to:(r==null?void 0:r.primary_button_link)||"/restaurants",children:[h.jsx(pp,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),d("primary_button_text")||e("home.hero.exploreBtn")]})}),h.jsx(Mt,{size:"lg",variant:"outline",asChild:!0,className:"text-base sm:text-lg w-full sm:w-auto backdrop-blur-sm",children:h.jsxs(Hi,{to:(r==null?void 0:r.secondary_button_link)||"/activities",children:[h.jsx(yo,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),d("secondary_button_text")||e("home.hero.activitiesBtn")]})})]})]})})]}),h.jsx("section",{className:"py-16 sm:py-24 px-4 bg-secondary/20",children:h.jsxs("div",{className:"container mx-auto max-w-6xl",children:[h.jsxs("div",{className:"text-center mb-12 sm:mb-16",children:[h.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-foreground mb-3 sm:mb-4",children:e("home.features.title")}),h.jsx("p",{className:"text-base sm:text-lg text-muted-foreground max-w-2xl mx-auto px-4",children:e("home.features.description")})]}),h.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 sm:gap-8",children:[h.jsx(uP,{to:"/map",Icon:ga,title:e("home.features.map.title"),desc:e("home.features.map.desc"),iconBg:"bg-gradient-to-br from-primary to-primary-light",iconColor:"text-primary-foreground",hoverBorderColor:"hover:border-primary/50"}),h.jsx(uP,{to:"/restaurants",Icon:Cl,title:e("home.features.reviews.title"),desc:e("home.features.reviews.desc"),iconBg:"bg-gradient-to-br from-accent to-warning",iconColor:"text-accent-foreground",hoverBorderColor:"hover:border-accent/50"}),h.jsx("div",{className:"sm:col-span-2 md:col-span-1",children:h.jsx(uP,{to:"/activities",Icon:yo,title:e("home.features.events.title"),desc:e("home.features.events.desc"),iconBg:"bg-gradient-to-br from-success to-accent",iconColor:"text-white",hoverBorderColor:"hover:border-success/50"})})]})]})}),h.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[h.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),h.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),h.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),h.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[h.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:e("home.cta.title")}),h.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:e("home.cta.description")}),h.jsx(Mt,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl w-full sm:w-auto mx-4",children:h.jsxs(Hi,{to:"/join-us",children:[h.jsx(ob,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.cta.button")]})})]})]})]})},cr=V.forwardRef(({className:e,type:t,...r},n)=>h.jsx("input",{type:t,className:fr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));cr.displayName="Input";var IN="Popover",[Tie,lst]=Fo(IN,[bg]),I2=bg(),[pPe,Ag]=Tie(IN),Aie=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:d=!1}=e,i=I2(t),m=V.useRef(null),[y,S]=V.useState(!1),[w,T]=Zc({prop:n,defaultProp:s??!1,onChange:o,caller:IN});return h.jsx(lN,{...i,children:h.jsx(pPe,{scope:t,contentId:yu(),triggerRef:m,open:w,onOpenChange:T,onOpenToggle:V.useCallback(()=>T(A=>!A),[T]),hasCustomAnchor:y,onCustomAnchorAdd:V.useCallback(()=>S(!0),[]),onCustomAnchorRemove:V.useCallback(()=>S(!1),[]),modal:d,children:r})})};Aie.displayName=IN;var Cie="PopoverAnchor",mPe=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Ag(Cie,r),o=I2(r),{onCustomAnchorAdd:d,onCustomAnchorRemove:i}=s;return V.useEffect(()=>(d(),()=>i()),[d,i]),h.jsx(w2,{...o,...n,ref:t})});mPe.displayName=Cie;var jie="PopoverTrigger",Pie=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Ag(jie,r),o=I2(r),d=$n(t,s.triggerRef),i=h.jsx(on.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Rie(s.open),...n,ref:d,onClick:Ir(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?i:h.jsx(w2,{asChild:!0,...o,children:i})});Pie.displayName=jie;var j5="PopoverPortal",[gPe,yPe]=Tie(j5,{forceMount:void 0}),Oie=e=>{const{__scopePopover:t,forceMount:r,children:n,container:s}=e,o=Ag(j5,t);return h.jsx(gPe,{scope:t,forceMount:r,children:h.jsx(zo,{present:r||o.open,children:h.jsx(ew,{asChild:!0,container:s,children:n})})})};Oie.displayName=j5;var vb="PopoverContent",kie=V.forwardRef((e,t)=>{const r=yPe(vb,e.__scopePopover),{forceMount:n=r.forceMount,...s}=e,o=Ag(vb,e.__scopePopover);return h.jsx(zo,{present:n||o.open,children:o.modal?h.jsx(_Pe,{...s,ref:t}):h.jsx(xPe,{...s,ref:t})})});kie.displayName=vb;var vPe=ug("PopoverContent.RemoveScroll"),_Pe=V.forwardRef((e,t)=>{const r=Ag(vb,e.__scopePopover),n=V.useRef(null),s=$n(t,n),o=V.useRef(!1);return V.useEffect(()=>{const d=n.current;if(d)return bN(d)},[]),h.jsx(T2,{as:vPe,allowPinchZoom:!0,children:h.jsx(Nie,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ir(e.onCloseAutoFocus,d=>{var i;d.preventDefault(),o.current||(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Ir(e.onPointerDownOutside,d=>{const i=d.detail.originalEvent,m=i.button===0&&i.ctrlKey===!0,y=i.button===2||m;o.current=y},{checkForDefaultPrevented:!1}),onFocusOutside:Ir(e.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),xPe=V.forwardRef((e,t)=>{const r=Ag(vb,e.__scopePopover),n=V.useRef(!1),s=V.useRef(!1);return h.jsx(Nie,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var d,i;(d=e.onCloseAutoFocus)==null||d.call(e,o),o.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{var m,y;(m=e.onInteractOutside)==null||m.call(e,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const d=o.target;((y=r.triggerRef.current)==null?void 0:y.contains(d))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),Nie=V.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:d,onEscapeKeyDown:i,onPointerDownOutside:m,onFocusOutside:y,onInteractOutside:S,...w}=e,T=Ag(vb,r),A=I2(r);return _N(),h.jsx(E2,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:h.jsx(Kv,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:S,onEscapeKeyDown:i,onPointerDownOutside:m,onFocusOutside:y,onDismiss:()=>T.onOpenChange(!1),children:h.jsx(cN,{"data-state":Rie(T.open),role:"dialog",id:T.contentId,...A,...w,ref:t,style:{...w.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Iie="PopoverClose",bPe=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Ag(Iie,r);return h.jsx(on.button,{type:"button",...n,ref:t,onClick:Ir(e.onClick,()=>s.onOpenChange(!1))})});bPe.displayName=Iie;var wPe="PopoverArrow",SPe=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=I2(r);return h.jsx(uN,{...s,...n,ref:t})});SPe.displayName=wPe;function Rie(e){return e?"open":"closed"}var EPe=Aie,TPe=Pie,APe=Oie,Mie=kie;const mO=EPe,gO=TPe,_T=V.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},s)=>h.jsx(APe,{children:h.jsx(Mie,{ref:s,align:t,sideOffset:r,className:fr("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));_T.displayName=Mie.displayName;const P5=(e,t)=>ci({queryKey:["restaurants",e,t],queryFn:async()=>{let r=Ct.from("restaurants").select("*").eq("visible",!0).order("rating",{ascending:!1});if(e&&(r=r.or(`name.ilike.%${e}%,address.ilike.%${e}%`)),t){const d=t.split(",").flatMap(i=>[`type.cs.{${i}}`,`type_en.cs.{${i}}`,`type_pt.cs.{${i}}`]);r=r.or(d.join(","))}const{data:n,error:s}=await r;if(s)throw s;return n}}),CPe=e=>ci({queryKey:["restaurant",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("restaurants").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),Die=()=>{const{user:e}=Qn();return ci({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;return t.map(n=>n.restaurant_id)},enabled:!!e})},Lie=()=>{const{user:e}=Qn(),t=Ri();return Gi({mutationFn:async r=>{if(!e)throw new Error("Must be logged in");const{data:n}=await Ct.from("favorites").select("id").eq("user_id",e.id).eq("restaurant_id",r).maybeSingle();if(n){const{error:s}=await Ct.from("favorites").delete().eq("id",n.id);if(s)throw s;return{action:"removed"}}else{const{error:s}=await Ct.from("favorites").insert({user_id:e.id,restaurant_id:r});if(s)throw s;return{action:"added"}}},onSuccess:r=>{t.invalidateQueries({queryKey:["favorites"]}),Nr.success(Pr.t(r.action==="added"?"toast.favoriteAdded":"toast.favoriteRemoved"))},onError:r=>{r.message==="Must be logged in"?Nr.error(Pr.t("toast.signInToFavorite")):Nr.error(Pr.t("toast.favoritesUpdateFailed"))}})},Fie=()=>ci({queryKey:["restaurant-types",Pr.language],queryFn:async()=>{const e=Pr.language,t=e==="zh"?"type":e==="pt"?"type_pt":"type_en",{data:r,error:n}=await Ct.from("restaurants").select("type, type_en, type_pt").order("type");if(n)throw n;const s=r.flatMap(d=>d[t]||d.type_en||d.type||[]);return Array.from(new Set(s)).sort()}}),R2=(e,t,r,n)=>{const o=Aj(r-e),d=Aj(n-t),i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(Aj(e))*Math.cos(Aj(r))*Math.sin(d/2)*Math.sin(d/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},Aj=e=>e*Math.PI/180,RN=()=>new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):t(new Error("Geolocation is not supported by this browser."))}),zie=(e,t,r)=>{const n=/iPad|iPhone|iPod/.test(navigator.userAgent),s=/Android/.test(navigator.userAgent);n?window.open(`maps://maps.apple.com/?daddr=${e},${t}&q=${encodeURIComponent(r)}`,"_blank"):s?window.open(`geo:${e},${t}?q=${e},${t}(${encodeURIComponent(r)})`,"_blank"):window.open(`https://www.google.com/maps/dir/?api=1&destination=${e},${t}`,"_blank")};var Bie={exports:{}};(function(e,t){(function(r,n){e.exports=n()})($c,function(){var r,n,s;function o(i,m){if(!r)r=m;else if(!n)n=m;else{var y="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",S={};r(S),s=m(S),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}o(["exports"],function(i){var m=1e-6,y=typeof Float32Array<"u"?Float32Array:Array;function S(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],b=c*x-g*p;return b?(u[0]=x*(b=1/b),u[1]=-p*b,u[2]=-g*b,u[3]=c*b,u):null}function w(){var u=new y(9);return y!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function T(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],b=a[4],C=a[5],I=a[6],D=a[7],U=a[8];return u[0]=b*U-C*D,u[1]=g*D-p*U,u[2]=p*C-g*b,u[3]=C*I-x*U,u[4]=c*U-g*I,u[5]=g*x-c*C,u[6]=x*D-b*I,u[7]=p*I-c*D,u[8]=c*b-p*x,u}function A(u,a,c){var p=a[0],g=a[1],x=a[2],b=a[3],C=a[4],I=a[5],D=a[6],U=a[7],q=a[8],H=c[0],Y=c[1],J=c[2],oe=c[3],ce=c[4],he=c[5],we=c[6],Te=c[7],Pe=c[8];return u[0]=H*p+Y*b+J*D,u[1]=H*g+Y*C+J*U,u[2]=H*x+Y*I+J*q,u[3]=oe*p+ce*b+he*D,u[4]=oe*g+ce*C+he*U,u[5]=oe*x+ce*I+he*q,u[6]=we*p+Te*b+Pe*D,u[7]=we*g+Te*C+Pe*U,u[8]=we*x+Te*I+Pe*q,u}function O(){var u=new y(16);return y!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function P(u){var a=new y(16);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a}function N(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function R(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],b=a[4],C=a[5],I=a[6],D=a[7],U=a[8],q=a[9],H=a[10],Y=a[11],J=a[12],oe=a[13],ce=a[14],he=a[15],we=c*C-p*b,Te=c*I-g*b,Pe=c*D-x*b,He=p*I-g*C,Fe=p*D-x*C,Ye=g*D-x*I,tt=U*oe-q*J,it=U*ce-H*J,Tt=U*he-Y*J,ft=q*ce-H*oe,At=q*he-Y*oe,Rt=H*he-Y*ce,Bt=we*Rt-Te*At+Pe*ft+He*Tt-Fe*it+Ye*tt;return Bt?(u[0]=(C*Rt-I*At+D*ft)*(Bt=1/Bt),u[1]=(g*At-p*Rt-x*ft)*Bt,u[2]=(oe*Ye-ce*Fe+he*He)*Bt,u[3]=(H*Fe-q*Ye-Y*He)*Bt,u[4]=(I*Tt-b*Rt-D*it)*Bt,u[5]=(c*Rt-g*Tt+x*it)*Bt,u[6]=(ce*Pe-J*Ye-he*Te)*Bt,u[7]=(U*Ye-H*Pe+Y*Te)*Bt,u[8]=(b*At-C*Tt+D*tt)*Bt,u[9]=(p*Tt-c*At-x*tt)*Bt,u[10]=(J*Fe-oe*Pe+he*we)*Bt,u[11]=(q*Pe-U*Fe-Y*we)*Bt,u[12]=(C*it-b*ft-I*tt)*Bt,u[13]=(c*ft-p*it+g*tt)*Bt,u[14]=(oe*Te-J*He-ce*we)*Bt,u[15]=(U*He-q*Te+H*we)*Bt,u):null}function M(u,a,c){var p=a[0],g=a[1],x=a[2],b=a[3],C=a[4],I=a[5],D=a[6],U=a[7],q=a[8],H=a[9],Y=a[10],J=a[11],oe=a[12],ce=a[13],he=a[14],we=a[15],Te=c[0],Pe=c[1],He=c[2],Fe=c[3];return u[0]=Te*p+Pe*C+He*q+Fe*oe,u[1]=Te*g+Pe*I+He*H+Fe*ce,u[2]=Te*x+Pe*D+He*Y+Fe*he,u[3]=Te*b+Pe*U+He*J+Fe*we,u[4]=(Te=c[4])*p+(Pe=c[5])*C+(He=c[6])*q+(Fe=c[7])*oe,u[5]=Te*g+Pe*I+He*H+Fe*ce,u[6]=Te*x+Pe*D+He*Y+Fe*he,u[7]=Te*b+Pe*U+He*J+Fe*we,u[8]=(Te=c[8])*p+(Pe=c[9])*C+(He=c[10])*q+(Fe=c[11])*oe,u[9]=Te*g+Pe*I+He*H+Fe*ce,u[10]=Te*x+Pe*D+He*Y+Fe*he,u[11]=Te*b+Pe*U+He*J+Fe*we,u[12]=(Te=c[12])*p+(Pe=c[13])*C+(He=c[14])*q+(Fe=c[15])*oe,u[13]=Te*g+Pe*I+He*H+Fe*ce,u[14]=Te*x+Pe*D+He*Y+Fe*he,u[15]=Te*b+Pe*U+He*J+Fe*we,u}function F(u,a,c){var p,g,x,b,C,I,D,U,q,H,Y,J,oe=c[0],ce=c[1],he=c[2];return a===u?(u[12]=a[0]*oe+a[4]*ce+a[8]*he+a[12],u[13]=a[1]*oe+a[5]*ce+a[9]*he+a[13],u[14]=a[2]*oe+a[6]*ce+a[10]*he+a[14],u[15]=a[3]*oe+a[7]*ce+a[11]*he+a[15]):(g=a[1],x=a[2],b=a[3],C=a[4],I=a[5],D=a[6],U=a[7],q=a[8],H=a[9],Y=a[10],J=a[11],u[0]=p=a[0],u[1]=g,u[2]=x,u[3]=b,u[4]=C,u[5]=I,u[6]=D,u[7]=U,u[8]=q,u[9]=H,u[10]=Y,u[11]=J,u[12]=p*oe+C*ce+q*he+a[12],u[13]=g*oe+I*ce+H*he+a[13],u[14]=x*oe+D*ce+Y*he+a[14],u[15]=b*oe+U*ce+J*he+a[15]),u}function B(u,a,c){var p=c[0],g=c[1],x=c[2];return u[0]=a[0]*p,u[1]=a[1]*p,u[2]=a[2]*p,u[3]=a[3]*p,u[4]=a[4]*g,u[5]=a[5]*g,u[6]=a[6]*g,u[7]=a[7]*g,u[8]=a[8]*x,u[9]=a[9]*x,u[10]=a[10]*x,u[11]=a[11]*x,u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u}function $(u,a,c){var p=Math.sin(c),g=Math.cos(c),x=a[4],b=a[5],C=a[6],I=a[7],D=a[8],U=a[9],q=a[10],H=a[11];return a!==u&&(u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[4]=x*g+D*p,u[5]=b*g+U*p,u[6]=C*g+q*p,u[7]=I*g+H*p,u[8]=D*g-x*p,u[9]=U*g-b*p,u[10]=q*g-C*p,u[11]=H*g-I*p,u}function W(u,a,c){var p=Math.sin(c),g=Math.cos(c),x=a[0],b=a[1],C=a[2],I=a[3],D=a[8],U=a[9],q=a[10],H=a[11];return a!==u&&(u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=x*g-D*p,u[1]=b*g-U*p,u[2]=C*g-q*p,u[3]=I*g-H*p,u[8]=x*p+D*g,u[9]=b*p+U*g,u[10]=C*p+q*g,u[11]=I*p+H*g,u}function K(u,a,c){var p=Math.sin(c),g=Math.cos(c),x=a[0],b=a[1],C=a[2],I=a[3],D=a[4],U=a[5],q=a[6],H=a[7];return a!==u&&(u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=x*g+D*p,u[1]=b*g+U*p,u[2]=C*g+q*p,u[3]=I*g+H*p,u[4]=D*g-x*p,u[5]=U*g-b*p,u[6]=q*g-C*p,u[7]=H*g-I*p,u}function te(u,a){return u[0]=a[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=a[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=a[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ne(u,a,c){var p,g,x,b=c[0],C=c[1],I=c[2],D=Math.sqrt(b*b+C*C+I*I);return D<m?null:(b*=D=1/D,C*=D,I*=D,p=Math.sin(a),g=Math.cos(a),u[0]=b*b*(x=1-g)+g,u[1]=C*b*x+I*p,u[2]=I*b*x-C*p,u[3]=0,u[4]=b*C*x-I*p,u[5]=C*C*x+g,u[6]=I*C*x+b*p,u[7]=0,u[8]=b*I*x+C*p,u[9]=C*I*x-b*p,u[10]=I*I*x+g,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function ae(u,a){var c=a[0],p=a[1],g=a[2],x=a[4],b=a[5],C=a[6],I=a[8],D=a[9],U=a[10];return u[0]=Math.sqrt(c*c+p*p+g*g),u[1]=Math.sqrt(x*x+b*b+C*C),u[2]=Math.sqrt(I*I+D*D+U*U),u}function re(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],b=c+c,C=p+p,I=g+g,D=c*b,U=p*b,q=p*C,H=g*b,Y=g*C,J=g*I,oe=x*b,ce=x*C,he=x*I;return u[0]=1-q-J,u[1]=U+he,u[2]=H-ce,u[3]=0,u[4]=U-he,u[5]=1-D-J,u[6]=Y+oe,u[7]=0,u[8]=H+ce,u[9]=Y-oe,u[10]=1-D-q,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}var ee=M;function ie(){var u=new y(3);return y!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function de(u){var a=new y(3);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a}function be(u){var a=u[0],c=u[1],p=u[2];return Math.sqrt(a*a+c*c+p*p)}function Se(u,a,c){var p=new y(3);return p[0]=u,p[1]=a,p[2]=c,p}function Ae(u,a,c,p){return u[0]=a,u[1]=c,u[2]=p,u}function xe(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u[2]=a[2]+c[2],u}function me(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u[2]=a[2]-c[2],u}function Ce(u,a,c){return u[0]=a[0]*c[0],u[1]=a[1]*c[1],u[2]=a[2]*c[2],u}function ge(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u}function pe(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u}function Oe(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u}function Xe(u,a,c,p){return u[0]=a[0]+c[0]*p,u[1]=a[1]+c[1]*p,u[2]=a[2]+c[2]*p,u}function We(u,a){var c=a[0]-u[0],p=a[1]-u[1],g=a[2]-u[2];return Math.sqrt(c*c+p*p+g*g)}function $e(u,a){var c=a[0]-u[0],p=a[1]-u[1],g=a[2]-u[2];return c*c+p*p+g*g}function Ke(u){var a=u[0],c=u[1],p=u[2];return a*a+c*c+p*p}function Le(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u}function ke(u,a){var c=a[0],p=a[1],g=a[2],x=c*c+p*p+g*g;return x>0&&(x=1/Math.sqrt(x)),u[0]=a[0]*x,u[1]=a[1]*x,u[2]=a[2]*x,u}function st(u,a){return u[0]*a[0]+u[1]*a[1]+u[2]*a[2]}function _t(u,a,c){var p=a[0],g=a[1],x=a[2],b=c[0],C=c[1],I=c[2];return u[0]=g*I-x*C,u[1]=x*b-p*I,u[2]=p*C-g*b,u}function Be(u,a,c,p){var g=a[0],x=a[1],b=a[2];return u[0]=g+p*(c[0]-g),u[1]=x+p*(c[1]-x),u[2]=b+p*(c[2]-b),u}function Dt(u,a,c){var p=a[0],g=a[1],x=a[2],b=c[3]*p+c[7]*g+c[11]*x+c[15];return u[0]=(c[0]*p+c[4]*g+c[8]*x+c[12])/(b=b||1),u[1]=(c[1]*p+c[5]*g+c[9]*x+c[13])/b,u[2]=(c[2]*p+c[6]*g+c[10]*x+c[14])/b,u}function It(u,a,c){var p=a[0],g=a[1],x=a[2];return u[0]=p*c[0]+g*c[3]+x*c[6],u[1]=p*c[1]+g*c[4]+x*c[7],u[2]=p*c[2]+g*c[5]+x*c[8],u}function ir(u,a,c){var p=c[0],g=c[1],x=c[2],b=c[3],C=a[0],I=a[1],D=a[2],U=g*D-x*I,q=x*C-p*D,H=p*I-g*C;return u[0]=C+b*(U+=U)+g*(H+=H)-x*(q+=q),u[1]=I+b*q+x*U-p*H,u[2]=D+b*H+p*q-g*U,u}function Dr(u){return u[0]=0,u[1]=0,u[2]=0,u}function Rr(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]}var jt=me,zt=Ce,Je=be;function pt(){var u=new y(4);return y!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function rt(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u[3]=a[3]*c,u}function Kt(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],b=c*c+p*p+g*g+x*x;return b>0&&(b=1/Math.sqrt(b)),u[0]=c*b,u[1]=p*b,u[2]=g*b,u[3]=x*b,u}function Ut(u,a,c){var p=a[0],g=a[1],x=a[2],b=a[3];return u[0]=c[0]*p+c[4]*g+c[8]*x+c[12]*b,u[1]=c[1]*p+c[5]*g+c[9]*x+c[13]*b,u[2]=c[2]*p+c[6]*g+c[10]*x+c[14]*b,u[3]=c[3]*p+c[7]*g+c[11]*x+c[15]*b,u}function Ht(){var u=new y(4);return y!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Cr(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function un(u,a,c){c*=.5;var p=a[0],g=a[1],x=a[2],b=a[3],C=Math.sin(c),I=Math.cos(c);return u[0]=p*I+b*C,u[1]=g*I+x*C,u[2]=x*I-g*C,u[3]=b*I-p*C,u}function hn(u,a,c){c*=.5;var p=a[0],g=a[1],x=a[2],b=a[3],C=Math.sin(c),I=Math.cos(c);return u[0]=p*I-x*C,u[1]=g*I+b*C,u[2]=x*I+p*C,u[3]=b*I-g*C,u}ie(),pt();var Kn,Gn,Mi,Pa=Kt,_s=(Kn=ie(),Gn=Se(1,0,0),Mi=Se(0,1,0),function(u,a,c){var p=st(a,c);return p<-.999999?(_t(Kn,Gn,a),Je(Kn)<1e-6&&_t(Kn,Mi,a),ke(Kn,Kn),function(g,x,b){b*=.5;var C=Math.sin(b);g[0]=C*x[0],g[1]=C*x[1],g[2]=C*x[2],g[3]=Math.cos(b)}(u,Kn,Math.PI),u):p>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(_t(Kn,a,c),u[0]=Kn[0],u[1]=Kn[1],u[2]=Kn[2],u[3]=1+p,Pa(u,u))});function mi(){var u=new y(2);return y!=Float32Array&&(u[0]=0,u[1]=0),u}function Ua(u,a){var c=new y(2);return c[0]=u,c[1]=a,c}function Va(u,a,c){return u[0]=a,u[1]=c,u}function Bo(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u}function qa(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u}function Ha(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u}function Li(u){var a=u[0],c=u[1];return Math.sqrt(a*a+c*c)}function Ws(u,a){var c=a[0],p=a[1],g=c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),u[0]=a[0]*g,u[1]=a[1]*g,u}function nl(u,a){return u[0]*a[0]+u[1]*a[1]}Ht(),Ht(),w();var _a,so,Ln=qa;function Fi(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}mi();var ps=function(){if(so)return _a;function u(a,c,p,g){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(g-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=c,this.p2x=p,this.p2y=g}return so=1,_a=u,u.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,c){if(c===void 0&&(c=1e-6),a<0)return 0;if(a>1)return 1;for(var p=a,g=0;g<8;g++){var x=this.sampleCurveX(p)-a;if(Math.abs(x)<c)return p;var b=this.sampleCurveDerivativeX(p);if(Math.abs(b)<1e-6)break;p-=x/b}var C=0,I=1;for(p=a,g=0;g<20&&(x=this.sampleCurveX(p),!(Math.abs(x-a)<c));g++)a>x?C=p:I=p,p=.5*(I-C)+C;return p},solve:function(a,c){return this.sampleCurveY(this.solveCurveX(a,c))}},_a}(),Ga=Fi(ps);function at(u,a){this.x=u,this.y=a}function gn(u,a){if(Array.isArray(u)){if(!Array.isArray(a)||u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(!gn(u[c],a[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&a!==null){if(typeof a!="object"||Object.keys(u).length!==Object.keys(a).length)return!1;for(const c in u)if(!gn(u[c],a[c]))return!1;return!0}return u===a}at.prototype={clone(){return new at(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,a){return this.clone()._rotateAround(u,a)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const a=u.x-this.x,c=u.y-this.y;return a*a+c*c},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,a){return Math.atan2(this.x*a-this.y*u,this.x*u+this.y*a)},_matMult(u){const a=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=a,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const a=Math.cos(u),c=Math.sin(u),p=c*this.x+a*this.y;return this.x=a*this.x-c*this.y,this.y=p,this},_rotateAround(u,a){const c=Math.cos(u),p=Math.sin(u),g=a.y+p*(this.x-a.x)+c*(this.y-a.y);return this.x=a.x+c*(this.x-a.x)-p*(this.y-a.y),this.y=g,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:at},at.convert=function(u){if(u instanceof at)return u;if(Array.isArray(u))return new at(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new at(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ks=Math.PI/180,Oa=180/Math.PI;function vn(u){return u*Ks}function $o(u){return u*Oa}const jw=[[0,0],[1,0],[1,1],[0,1]];function Ig(u){if(u<=0)return 0;if(u>=1)return 1;const a=u*u,c=a*u;return 4*(u<.5?c:3*(u-a)+c-.75)}function dt(u,a,c,p){const g=new Ga(u,a,c,p);return function(x){return g.solve(x)}}const fe=dt(.25,.1,.25,1);function ve(u,a,c){return Math.min(c,Math.max(a,u))}function Me(u,a,c){return(c=ve((c-u)/(a-u),0,1))*c*(3-2*c)}function et(u,a,c){const p=c-a,g=((u-a)%p+p)%p+a;return g===a?c:g}function Qe(u,a,c){if(!u.length)return c(null,[]);let p=u.length;const g=new Array(u.length);let x=null;u.forEach((b,C)=>{a(b,(I,D)=>{I&&(x=I),g[C]=D,--p==0&&c(x,g)})})}let lt=1;function bt(){return lt++}function ct(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log2(u)))}function vt(u,a){u.forEach(c=>{a[c]&&(a[c]=a[c].bind(a))})}function Jt(u,a,c){const p={};for(const g in u)p[g]=a.call(this,u[g],g,u);return p}function qt(u,a,c){const p={};for(const g in u)a.call(this,u[g],g,u)&&(p[g]=u[g]);return p}function Ar(u){return Array.isArray(u)?u.map(Ar):typeof u=="object"&&u?Jt(u,Ar):u}function Jr(u,a){for(let c=0;c<u.length;c++)if(a.indexOf(u[c])>=0)return!0;return!1}const Zr={};function zr(u){Zr[u]||(typeof console<"u"&&console.warn(u),Zr[u]=!0)}function bn(u,a,c){return(c.y-u.y)*(a.x-u.x)>(a.y-u.y)*(c.x-u.x)}function An(u){let a=0;for(let c,p,g=0,x=u.length,b=x-1;g<x;b=g++)c=u[g],p=u[b],a+=(p.x-c.x)*(c.y+p.y);return a}function Si([u,a,c]){const p=vn(a+90),g=vn(c);return{x:u*Math.cos(p)*Math.sin(g),y:u*Math.sin(p)*Math.sin(g),z:u*Math.cos(g),azimuthal:a,polar:c}}function xs(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function Zs(u){const a={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,p,g,x)=>{const b=g||x;return a[p]=!b||b.toLowerCase(),""}),a["max-age"]){const c=parseInt(a["max-age"],10);isNaN(c)?delete a["max-age"]:a["max-age"]=c}return a}let Ms=null;function Os(u,a){return[u[4*a],u[4*a+1],u[4*a+2],u[4*a+3]]}function _i(u,a,c,p){for(;a<c;){const g=a+c>>1;u[g]<p?a=g+1:c=g}return a}function Mn(u,a,c,p){for(;a<c;){const g=a+c>>1;u[g]<=p?a=g+1:c=g}return a}function Yi(u){return u>0?1/(1.001-u):1+u}function ms(u){return u>0?1-1/(1.001-u):-u}function Ti(u,a,c){return(u-a.min)*(c.max-c.min)/(a.max-a.min)+c.min}const Ji={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ji.API_URL)return null;try{const u=new URL(Ji.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function la(u){return Ji.API_URL_REGEX.test(u)}function Uo(u){return Ji.API_SPRITE_REGEX.test(u)}let bc,sf,xa,wc,il,Jc;function Pl(){return bc==null&&(bc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),bc}const Ol={now:()=>wc!==void 0?wc:performance.now(),setNow(u){wc=u},restoreNow(){wc=void 0},frame(u){const a=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(a)}},getImageData(u,a=0){const{width:c,height:p}=u;il||(il=document.createElement("canvas"));const g=il.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(c>il.width||p>il.height)&&(il.width=c,il.height=p),g.clearRect(-a,-a,c+2*a,p+2*a),g.drawImage(u,0,0,c,p),g.getImageData(-a,-a,c+2*a,p+2*a)},resolveURL:u=>(sf||(sf=document.createElement("a")),sf.href=u,sf.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(xa==null&&(xa=window.matchMedia("(prefers-reduced-motion: reduce)")),xa.matches)},hasCanvasFingerprintNoise(){if(Jc!==void 0)return Jc;if(!Pl())return Jc=!1,!1;const u=new OffscreenCanvas(85,1),a=u.getContext("2d",{willReadFrequently:!0});let c=0;for(let g=0;g<u.width;++g)a.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,a.fillRect(g,0,1,1);const p=a.getImageData(0,0,u.width,u.height);c=0;for(let g=0;g<p.data.length;++g)if(g%4!=3&&c++!==p.data[g])return Jc=!0,!0;return Jc=!1,!1}};function o_(u,a){const c=u.indexOf("?");if(c<0)return`${u}?${new URLSearchParams(a).toString()}`;const p=new URLSearchParams(u.slice(c));for(const g in a)p.set(g,a[g]);return`${u.slice(0,c)}?${p.toString()}`}function Rg(u,a={persistentParams:[]}){const c=u.indexOf("?");if(c<0)return u;const p=new URLSearchParams,g=new URLSearchParams(u.slice(c));for(const b of a.persistentParams){const C=g.get(b);C&&p.set(b,C)}const x=p.toString();return`${u.slice(0,c)}${x.length>0?`?${x}`:""}`}const Mg="mapbox-tiles";let Dg=500,yl=50;const Qc=["language","worldview","jobid"];let sl,Vl;function nd(){try{return caches}catch{}}function af(){const u=nd();u&&sl==null&&(sl=u.open(Mg))}let l_=1/0;const c_={supported:!1,testSupport:function(u){!Pw&&Yd&&(Q2?Ow(u):Au=u)}};let Au,Yd,Pw=!1,Q2=!1;const Sc=typeof self<"u"?self:{};function Ow(u){const a=u.createTexture();u.bindTexture(u.TEXTURE_2D,a);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Yd),u.isContextLost())return;c_.supported=!0}catch{}u.deleteTexture(a),Pw=!0}Sc.document&&(Yd=Sc.document.createElement("img"),Yd.onload=function(){Au&&Ow(Au),Au=null,Q2=!0},Yd.onerror=function(){Pw=!0,Au=null},Yd.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const of={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(of);class lf extends Error{constructor(a,c,p){c===401&&la(p)&&(a+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(a),this.status=c,this.url=p}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const kw=xs()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Lg=function(u,a){if(!(/^file:/.test(c=u.url)||/^file:/.test(kw())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(p,g){const x=new AbortController,b=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:kw(),referrerPolicy:p.referrerPolicy,signal:x.signal});let C=!1,I=!1;const D=(U=b.url).indexOf("sku=")>0&&la(U);var U;p.type==="json"&&b.headers.set("Accept","application/json");const q=(Y,J,oe)=>{if(I)return;if(Y&&Y.message!=="SecurityError"&&zr(Y.toString()),J&&oe)return H(J);const ce=Date.now();fetch(b).then(he=>{if(he.ok){const we=D?he.clone():null;return H(he,we,ce)}return g(new lf(he.statusText,he.status,p.url))}).catch(he=>{he.name!=="AbortError"&&g(new Error(`${he.message} ${p.url}`))})},H=(Y,J,oe)=>{(p.type==="arrayBuffer"?Y.arrayBuffer():p.type==="json"?Y.json():Y.text()).then(ce=>{I||(J&&oe&&function(he,we,Te){if(af(),sl==null)return;const Pe=Zs(we.headers.get("Cache-Control")||"");if(Pe["no-store"])return;const He={status:we.status,statusText:we.statusText,headers:new Headers};we.headers.forEach((tt,it)=>He.headers.set(it,tt)),Pe["max-age"]&&He.headers.set("Expires",new Date(Te+1e3*Pe["max-age"]).toUTCString());const Fe=He.headers.get("Expires");if(!Fe||new Date(Fe).getTime()-Te<42e4)return;let Ye=Rg(he.url,{persistentParams:Qc});if(we.status===206){const tt=he.headers.get("Range");if(!tt)return;He.status=200,Ye=o_(Ye,{range:tt})}(function(tt,it){if(Vl===void 0)try{new Response(new ReadableStream),Vl=!0}catch{Vl=!1}Vl?it(tt.body):tt.blob().then(it).catch(Tt=>zr(Tt.message))})(we,tt=>{const it=new Response((Tt=we.status)!==200&&Tt!==404&&[101,103,204,205,304].includes(Tt)?null:tt,He);var Tt;af(),sl!=null&&sl.then(ft=>ft.put(Ye,it)).catch(ft=>zr(ft.message))})}(b,J,oe),C=!0,g(null,ce,Y.headers))}).catch(ce=>{I||g(new Error(ce.message))})};return D?function(Y,J){if(af(),sl==null)return J(null);sl.then(oe=>{let ce=Rg(Y.url,{persistentParams:Qc});const he=Y.headers.get("Range");he&&(ce=o_(ce,{range:he})),oe.match(ce).then(we=>{const Te=function(Pe){if(!Pe)return!1;const He=new Date(Pe.headers.get("Expires")||0),Fe=Zs(Pe.headers.get("Cache-Control")||"");return Number(He)>Date.now()&&!Fe["no-cache"]}(we);oe.delete(ce).catch(J),Te&&oe.put(ce,we.clone()).catch(J),J(null,we,Te)}).catch(J)}).catch(J)}(b,q):q(null,null),{cancel:()=>{I=!0,C||x.abort()}}}(u,a);if(xs(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,a,void 0,!0)}var c;return function(p,g){const x=new XMLHttpRequest;x.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const b in p.headers)x.setRequestHeader(b,p.headers[b]);return p.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=p.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let b=x.response;if(p.type==="json")try{b=JSON.parse(x.response)}catch(I){return g(I)}const C=new Headers;x.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(I=>{const D=I.split(": "),U=D.shift(),q=D.join(": ");C.append(U,q)}),g(null,b,C)}else g(new lf(x.statusText,x.status,p.url))},x.send(p.body),{cancel:()=>x.abort()}}(u,a)},bp=function(u,a){return Lg(Object.assign(u,{type:"arrayBuffer"}),a)};function si(u){const a=document.createElement("a");return a.href=u,a.protocol===location.protocol&&a.host===location.host}const Nw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Fg,zg;Fg=[],zg=0;const Iw=function(u,a){if(c_.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),zg>=Ji.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:u,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return Fg.push(x),x}zg++;let c=!1;const p=()=>{if(!c)for(c=!0,zg--;Fg.length&&zg<Ji.MAX_PARALLEL_IMAGE_REQUESTS;){const x=Fg.shift(),{requestParameters:b,callback:C,cancelled:I}=x;I||(x.cancel=Iw(b,C).cancel)}},g=bp(u,(x,b,C)=>{p(),x?a(x):b&&(self.createImageBitmap?function(I,D){const U=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(U).then(q=>{D(null,q)}).catch(q=>{D(new Error(`Could not load image because of ${q.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(I,D)=>a(I,D,C)):function(I,D){const U=new Image;U.onload=()=>{D(null,U),URL.revokeObjectURL(U.src),U.onload=null,requestAnimationFrame(()=>{U.src=Nw})},U.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const q=new Blob([new Uint8Array(I)],{type:"image/png"});U.src=I.byteLength?URL.createObjectURL(q):Nw}(b,(I,D)=>a(I,D,C)))});return{cancel:()=>{g.cancel(),p()}}};var Bg,$g,Ug,cf={exports:{}},eA={exports:{}},u_={exports:{}},GI=function(){if(Ug)return cf.exports;Ug=1;var u=(Bg||(Bg=1,eA.exports=function(c,p){var g,x,b,C,I,D,U,q;for(x=c.length-(g=3&c.length),b=p,I=3432918353,D=461845907,q=0;q<x;)U=255&c.charCodeAt(q)|(255&c.charCodeAt(++q))<<8|(255&c.charCodeAt(++q))<<16|(255&c.charCodeAt(++q))<<24,++q,b=27492+(65535&(C=5*(65535&(b=(b^=U=(65535&(U=(U=(65535&U)*I+(((U>>>16)*I&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(U=0,g){case 3:U^=(255&c.charCodeAt(q+2))<<16;case 2:U^=(255&c.charCodeAt(q+1))<<8;case 1:b^=U=(65535&(U=(U=(65535&(U^=255&c.charCodeAt(q)))*I+(((U>>>16)*I&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),eA.exports),a=($g||($g=1,u_.exports=function(c,p){for(var g,x=c.length,b=p^x,C=0;x>=4;)g=1540483477*(65535&(g=255&c.charCodeAt(C)|(255&c.charCodeAt(++C))<<8|(255&c.charCodeAt(++C))<<16|(255&c.charCodeAt(++C))<<24))+((1540483477*(g>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),x-=4,++C;switch(x){case 3:b^=(255&c.charCodeAt(C+2))<<16;case 2:b^=(255&c.charCodeAt(C+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(C)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),u_.exports);return cf.exports=u,cf.exports.murmur3=u,cf.exports.murmur2=a,cf.exports}(),Vg=Fi(GI);class ql{constructor(a,...c){Object.assign(this,c[0]||{}),this.type=a}}class qg extends ql{constructor(a,c={}){super("error",Object.assign({error:a},c))}}function wp(u,a,c){c[u]&&c[u].indexOf(a)!==-1||(c[u]=c[u]||[],c[u].push(a))}function Hg(u,a,c){if(c&&c[u]){const p=c[u].indexOf(a);p!==-1&&c[u].splice(p,1)}}class id{on(a,c){return this._listeners=this._listeners||{},wp(a,c,this._listeners),this}off(a,c){return Hg(a,c,this._listeners),Hg(a,c,this._oneTimeListeners),this}once(a,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},wp(a,c,this._oneTimeListeners),this):new Promise(p=>{this.once(a,p)})}fire(a,c){const p=typeof a=="string"?new ql(a,c):a,g=p.type;if(this.listens(g)){p.target=this;const x=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const I of x)I.call(this,p);const b=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const I of b)Hg(g,I,this._oneTimeListeners),I.call(this,p);const C=this._eventedParent;if(C){const I=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(p,I),C.fire(p)}}else p instanceof qg&&console.error(p.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,c){return this._eventedParent=a,this._eventedParentData=c,this}}class ca{constructor(a){typeof a=="string"?this.name=a:(this.name=a.name,this.iconsetId=a.iconsetId)}static from(a){return new ca(a)}static toString(a){return a.iconsetId?`${a.name}${a.iconsetId}`:a.name}static parse(a){const[c,p]=a.split("");return new ca({name:c,iconsetId:p})}static isEqual(a,c){return a.name===c.name&&a.iconsetId===c.iconsetId}toString(){return ca.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Rw,Mw={},Dw=function(){if(Rw)return Mw;Rw=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(x){return(x=Math.round(x))<0?0:x>255?255:x}function c(x){return a(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function p(x){return(b=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:b>1?1:b;var b}function g(x,b,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?x+(b-x)*C*6:2*C<1?b:3*C<2?x+(b-x)*(2/3-C)*6:x}try{Mw.parseCSSColor=function(x){var b,C=x.replace(/ /g,"").toLowerCase();if(C in u)return u[C].slice();if(C[0]==="#")return C.length===4?(b=parseInt(C.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:C.length===7&&(b=parseInt(C.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var I=C.indexOf("("),D=C.indexOf(")");if(I!==-1&&D+1===C.length){var U=C.substr(0,I),q=C.substr(I+1,D-(I+1)).split(","),H=1;switch(U){case"rgba":if(q.length!==4)return null;H=p(q.pop());case"rgb":return q.length!==3?null:[c(q[0]),c(q[1]),c(q[2]),H];case"hsla":if(q.length!==4)return null;H=p(q.pop());case"hsl":if(q.length!==3)return null;var Y=(parseFloat(q[0])%360+360)%360/360,J=p(q[1]),oe=p(q[2]),ce=oe<=.5?oe*(J+1):oe+J-oe*J,he=2*oe-ce;return[a(255*g(he,ce,Y+1/3)),a(255*g(he,ce,Y)),a(255*g(he,ce,Y-1/3)),H];default:return null}}return null}}catch{}return Mw}();class hi{constructor(a,c,p,g=1){this.r=a,this.g=c,this.b=p,this.a=g}static parse(a){if(!a)return;if(a instanceof hi)return a;if(typeof a!="string")return;const c=Dw.parseCSSColor(a);return c?new hi(c[0]/255,c[1]/255,c[2]/255,c[3]):void 0}toString(){const[a,c,p,g]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*a)},${Math.round(255*c)},${Math.round(255*p)},${g})`}toNonPremultipliedRenderColor(a){const{r:c,g:p,b:g,a:x}=this;return new tA(a,c,p,g,x)}toPremultipliedRenderColor(a){const{r:c,g:p,b:g,a:x}=this;return new rA(a,c*x,p*x,g*x,x)}clone(){return new hi(this.r,this.g,this.b,this.a)}}class Lw{constructor(a,c,p,g,x,b=!1){if(this.premultiplied=!1,this.premultiplied=b,a){const C=a.image.height,I=C*C;this.premultiplied?(c=x===0?0:c/x*(C-1),p=x===0?0:p/x*(C-1),g=x===0?0:g/x*(C-1)):(c*=C-1,p*=C-1,g*=C-1);const D=Math.floor(c),U=Math.floor(p),q=Math.floor(g),H=Math.ceil(c),Y=Math.ceil(p),J=Math.ceil(g),oe=c-D,ce=p-U,he=g-q,we=a.image.data,Te=4*(D+U*I+q*C),Pe=4*(D+U*I+J*C),He=4*(D+Y*I+q*C),Fe=4*(D+Y*I+J*C),Ye=4*(H+U*I+q*C),tt=4*(H+U*I+J*C),it=4*(H+Y*I+q*C),Tt=4*(H+Y*I+J*C);if(Te<0||Tt>=we.length)throw new Error("out of range");this.r=Kr(Kr(Kr(we[Te],we[Pe],he),Kr(we[He],we[Fe],he),ce),Kr(Kr(we[Ye],we[tt],he),Kr(we[it],we[Tt],he),ce),oe)/255*(this.premultiplied?x:1),this.g=Kr(Kr(Kr(we[Te+1],we[Pe+1],he),Kr(we[He+1],we[Fe+1],he),ce),Kr(Kr(we[Ye+1],we[tt+1],he),Kr(we[it+1],we[Tt+1],he),ce),oe)/255*(this.premultiplied?x:1),this.b=Kr(Kr(Kr(we[Te+2],we[Pe+2],he),Kr(we[He+2],we[Fe+2],he),ce),Kr(Kr(we[Ye+2],we[tt+2],he),Kr(we[it+2],we[Tt+2],he),ce),oe)/255*(this.premultiplied?x:1),this.a=x}else this.r=c,this.g=p,this.b=g,this.a=x}toArray(){const{r:a,g:c,b:p,a:g}=this;return[255*a,255*c,255*p,g]}toHslaArray(){let{r:a,g:c,b:p,a:g}=this;if(this.premultiplied){if(g===0)return[0,0,0,0];const J=1/g;a*=J,c*=J,p*=J}const x=Math.min(Math.max(a,0),1),b=Math.min(Math.max(c,0),1),C=Math.min(Math.max(p,0),1),I=Math.min(x,b,C),D=Math.max(x,b,C),U=D-I,q=.5*(I+D);if(U===0)return[0,0,100*q,g];const H=q>.5?U/(2-D-I):U/(D+I);let Y;switch(D){case x:Y=60*((b-C)/U+(b<C?6:0));break;case b:Y=60*((C-x)/U+2);break;default:Y=60*((x-b)/U+4)}return[Y,100*H,100*q,g]}toArray01(){const{r:a,g:c,b:p,a:g}=this;return[a,c,p,g]}toArray01Scaled(a){const{r:c,g:p,b:g}=this;return[c*a,p*a,g*a]}toArray01Linear(){const{r:a,g:c,b:p,a:g}=this;return[Math.pow(a,2.2),Math.pow(c,2.2),Math.pow(p,2.2),g]}}class tA extends Lw{constructor(a,c,p,g,x){super(a,c,p,g,x,!1)}}class rA extends Lw{constructor(a,c,p,g,x){super(a,c,p,g,x,!0)}}function Kr(u,a,c){return u*(1-c)+a*c}function Gg(u,a,c){return u.map((p,g)=>Kr(p,a[g],c))}hi.black=new hi(0,0,0,1),hi.white=new hi(1,1,1,1),hi.transparent=new hi(0,0,0,0),hi.red=new hi(1,0,0,1),hi.blue=new hi(0,0,1,1);var sd=Object.freeze({__proto__:null,array:Gg,color:function(u,a,c){return new hi(Kr(u.r,a.r,c),Kr(u.g,a.g,c),Kr(u.b,a.b,c),Kr(u.a,a.a,c))},number:Kr});class Ec extends Error{constructor(a,c){super(c),this.message=c,this.key=a}}class Tc{constructor(a,c=[]){this.parent=a,this.bindings={};for(const[p,g]of c)this.bindings[p]=g}concat(a){return new Tc(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Sp={kind:"null"},Or={kind:"number"},Zn={kind:"string"},ui={kind:"boolean"},kl={kind:"color"},Ep={kind:"object"},gi={kind:"value"},Wg={kind:"collator"},uf={kind:"formatted"},Kg={kind:"resolvedImage"};function Wa(u,a){return{kind:"array",itemType:u,N:a}}function Qs(u){if(u.kind==="array"){const a=Qs(u.itemType);return typeof u.N=="number"?`array<${a}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${a}>`}return u.kind}const WI=[Sp,Or,Zn,ui,kl,uf,Ep,Wa(gi),Kg];function Zg(u,a){if(a.kind==="error")return null;if(u.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Zg(u.itemType,a.itemType))&&(typeof u.N!="number"||u.N===a.N))return null}else{if(u.kind===a.kind)return null;if(u.kind==="value"){for(const c of WI)if(!Zg(c,a))return null}}return`Expected ${Qs(u)} but found ${Qs(a)} instead.`}function Fw(u,a){return a.some(c=>c.kind===u.kind)}function Xg(u,a){return a.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function d_(u,a){return u.kind==="array"&&a.kind==="array"?u.N===a.N&&d_(u.itemType,a.itemType):u.kind===a.kind}class zw{constructor(a,c,p){this.sensitivity=a?c?"variant":"case":c?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,c){return this.collator.compare(a,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yg{constructor(a,c,p,g,x){this.text=a.normalize?a.normalize():a,this.image=c,this.scale=p,this.fontStack=g,this.textColor=x}}class ka{constructor(a){this.sections=a}static fromString(a){return new ka([new Yg(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||!!a.image&&a.image.hasPrimary())}static factory(a){return a instanceof ka?a:ka.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const c of this.sections){if(c.image){const g=c.image.getPrimary().id.toString();a.push(["image",g]);continue}a.push(c.text);const p={};c.fontStack&&(p["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(p["font-scale"]=c.scale),c.textColor&&(p["text-color"]=["rgba"].concat(c.textColor.toNonPremultipliedRenderColor(null).toArray())),a.push(p)}return a}}class ad{constructor(a,c={}){if(this.id=ca.from(a),this.options=Object.assign({},c),c.transform){const{a:p,b:g,c:x,d:b,e:C,f:I}=c.transform;this.options.transform=new DOMMatrix([p,g,x,b,C,I])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a,b:c,c:p,d:g,e:x,f:b}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a,b:c,c:p,d:g,e:x,f:b}})}static parse(a){let c,p,g,x;try{({name:c,iconsetId:p,params:g,transform:x}=JSON.parse(a)||{})}catch{return null}if(!c)return null;const{a:b,b:C,c:I,d:D,e:U,f:q}=x||{};return new ad({name:c,iconsetId:p},{params:g,transform:new DOMMatrix([b,C,I,D,U,q])})}scaleSelf(a,c){return this.options.transform.scaleSelf(a,c),this}}class vl{constructor(a,c,p,g,x=!1){this.primaryId=ca.from(a),this.primaryOptions=c,p&&(this.secondaryId=ca.from(p)),this.secondaryOptions=g,this.available=x}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ad(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ad(this.secondaryId,this.secondaryOptions):null}static from(a){return typeof a=="string"?vl.build({name:a}):a}static build(a,c,p,g){return!a||typeof a=="object"&&!("name"in a)?null:new vl(a,p,c,g)}}function h_(u,a,c,p){return typeof u=="number"&&u>=0&&u<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof c=="number"&&c>=0&&c<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,a,c,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,a,c,p]:[u,a,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tp(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof hi||u instanceof zw||u instanceof ka||u instanceof vl)return!0;if(Array.isArray(u)){for(const a of u)if(!Tp(a))return!1;return!0}if(typeof u=="object"){for(const a in u)if(!Tp(u[a]))return!1;return!0}return!1}function ba(u){if(u===null)return Sp;if(typeof u=="string")return Zn;if(typeof u=="boolean")return ui;if(typeof u=="number")return Or;if(u instanceof hi)return kl;if(u instanceof zw)return Wg;if(u instanceof ka)return uf;if(u instanceof vl)return Kg;if(Array.isArray(u)){const a=u.length;let c;for(const p of u){const g=ba(p);if(c){if(c===g)continue;c=gi;break}c=g}return Wa(c||gi,a)}return Ep}function Cu(u){const a=typeof u;return u===null?"":a==="string"||a==="number"||a==="boolean"?String(u):u instanceof ka||u instanceof vl||u instanceof hi?u.toString():JSON.stringify(u)}class od{constructor(a,c){this.type=a,this.value=c}static parse(a,c){if(a.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Tp(a[1]))return c.error("invalid value");const p=a[1];let g=ba(p);const x=c.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new od(g,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof hi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ka?this.value.serialize():this.value}}class Ds{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const yn={string:Zn,number:Or,boolean:ui,object:Ep};class Er{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");let p,g=1;const x=a[0];if(x==="array"){let C,I;if(a.length>2){const D=a[1];if(typeof D!="string"||!(D in yn)||D==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);C=yn[D],g++}else C=gi;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=a[2],g++}p=Wa(C,I)}else p=yn[x];const b=[];for(;g<a.length;g++){const C=c.parse(a[g],g,gi);if(!C)return null;b.push(C)}return new Er(p,b)}evaluate(a){for(let c=0;c<this.args.length;c++){const p=this.args[c].evaluate(a);if(!Zg(this.type,ba(p)))return p;if(c===this.args.length-1)throw new Ds(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${Qs(ba(p))} but was expected to be of type ${Qs(this.type)}.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,c=[a.kind];if(a.kind==="array"){const p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){c.push(p.kind);const g=a.N;(typeof g=="number"||this.args.length>1)&&c.push(g)}}return c.concat(this.args.map(p=>p.serialize()))}}class df{constructor(a){this.type=uf,this.sections=a}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const p=a[1];if(!Array.isArray(p)&&typeof p=="object")return c.error("First argument must be an image or text section.");const g=[];let x=!1;for(let b=1;b<=a.length-1;++b){const C=a[b];if(x&&typeof C=="object"&&!Array.isArray(C)){x=!1;let I=null;if(C["font-scale"]&&(I=c.parseObjectValue(C["font-scale"],b,"font-scale",Or),!I))return null;let D=null;if(C["text-font"]&&(D=c.parseObjectValue(C["text-font"],b,"text-font",Wa(Zn)),!D))return null;let U=null;if(C["text-color"]&&(U=c.parseObjectValue(C["text-color"],b,"text-color",kl),!U))return null;const q=g[g.length-1];q.scale=I,q.font=D,q.textColor=U}else{const I=c.parse(a[b],b,gi);if(!I)return null;const D=I.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new df(g)}evaluate(a){return new ka(this.sections.map(c=>{const p=c.content.evaluate(a);return d_(ba(p),Kg)?new Yg("",p,null,null,null):new Yg(Cu(p),null,c.scale?c.scale.evaluate(a):null,c.font?c.font.evaluate(a).join(","):null,c.textColor?c.textColor.evaluate(a):null)}))}eachChild(a){for(const c of this.sections)a(c.content),c.scale&&a(c.scale),c.font&&a(c.font),c.textColor&&a(c.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const c of this.sections){a.push(c.content.serialize());const p={};c.scale&&(p["font-scale"]=c.scale.serialize()),c.font&&(p["text-font"]=c.font.serialize()),c.textColor&&(p["text-color"]=c.textColor.serialize()),a.push(p)}return a}}class rn{constructor(a,c,p,g){this._imageWarnHistory={},this.type=Kg,this.namePrimary=a,this.nameSecondary=c,p&&(this.paramsPrimary=p.params,this.iconsetIdPrimary=p.iconset?p.iconset.id:void 0),g&&(this.paramsSecondary=g.params,this.iconsetIdSecondary=g.iconset?g.iconset.id:void 0)}static parse(a,c){if(a.length<2)return c.error("Expected two or more arguments.");let p=1;const g=[];function x(){if(p<a.length){const C=c.parse(a[p],p++,Zn);return C?(g.push({image:C,options:{}}),!0):(c.error(g.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function b(){if(p<a.length){const I=a[p];if((C=I)===null||typeof C!="object"||Array.isArray(C))return!0;const D=I.params,U=I.iconset,q=c.concat(p);if(!D&&!U)return p++,!0;if(D){if(typeof D!="object"||D.constructor!==Object)return q.error('Image options "params" should be an object'),!1;const H={},Y=q.concat(void 0,"params");for(const J in D){if(!J)return Y.error("Image parameter name should be non-empty"),!1;const oe=Y.concat(void 0,J).parse(D[J],void 0,kl,void 0,{typeAnnotation:"coerce"});if(!oe)return!1;H[J]=oe}g[g.length-1].options.params=H}if(U){if(typeof U!="object"||U.constructor!==Object)return q.error('Image options "iconset" should be an object'),!1;if(!U.id)return q.error('Image options "iconset" should have an "id" property'),!1;g[g.length-1].options.iconset=U}return p++,!0}var C;return!0}for(let C=0;C<2;C++)if(!x()||!b())return;return new rn(g[0].image,g[1]?g[1].image:void 0,g[0].options,g[1]?g[1].options:void 0)}evaluateParams(a,c){const p={};if(c){for(const g in c)if(c[g])try{p[g]=c[g].evaluate(a)}catch{continue}if(Object.keys(p).length!==0)return{params:p}}}evaluate(a){const c={name:this.namePrimary.evaluate(a),iconsetId:this.iconsetIdPrimary},p=this.nameSecondary?{name:this.nameSecondary.evaluate(a),iconsetId:this.iconsetIdSecondary}:void 0,g=vl.build(c,p,this.paramsPrimary?this.evaluateParams(a,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(a,this.paramsSecondary):void 0);if(g&&a.availableImages){const x=g.getPrimary().id;if(g.available=a.availableImages.some(b=>ca.isEqual(b,x)),g.available){const b=g.getSecondary()?g.getSecondary().id:null;b&&(g.available=a.availableImages.some(C=>ca.isEqual(C,b)))}}return g}eachChild(a){if(a(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&a(this.paramsPrimary[c]);if(this.nameSecondary&&(a(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&a(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(a,c){const p={};if(c&&(p.iconset={id:c}),a){p.params={};for(const g in a)a[g]&&(p.params[g]=a[g].serialize())}return Object.keys(p).length>0?p:void 0}serialize(){const a=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&a.push(c)}if(this.nameSecondary&&(a.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&a.push(c)}return a}}function Ap(u){return Xr(u)?"string":Jg(u)?"number":p_(u)?"boolean":Array.isArray(u)?"array":u===null?"null":f_(u)?"object":typeof u}function f_(u){return u!=null&&!Array.isArray(u)&&typeof u!="function"&&!(u instanceof String||u instanceof Number||u instanceof Boolean)&&typeof u=="object"}function Xr(u){return typeof u=="string"||u instanceof String}function Jg(u){return typeof u=="number"||u instanceof Number}function p_(u){return typeof u=="boolean"||u instanceof Boolean}const nA={"to-boolean":ui,"to-color":kl,"to-number":Or,"to-string":Zn};class ju{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const p=a[0],g=[];let x=Sp;if(p==="to-array"){if(!Array.isArray(a[1]))return null;const b=a[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);x=Wa(c.expectedType.itemType,b)}else{if(!(b>0&&Tp(a[1][0])))return null;x=Wa(ba(a[1][0]),b)}for(let C=0;C<b;C++){const I=a[1][C];let D;if(Array.isArray(I))D=c.parse(I,void 0,x.itemType);else{const U=Ap(I);if(U!==x.itemType.kind)return c.error(`Expected ${x.itemType.kind} but found ${U}.`);D=c.registry.literal.parse(["literal",I===void 0?null:I],c)}if(!D)return null;g.push(D)}}else{if((p==="to-boolean"||p==="to-string")&&a.length!==2)return c.error("Expected one argument.");x=nA[p];for(let b=1;b<a.length;b++){const C=c.parse(a[b],b,gi);if(!C)return null;g.push(C)}}return new ju(x,g)}evaluate(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){let c,p;for(const g of this.args){if(c=g.evaluate(a),p=null,c instanceof hi)return c;if(typeof c=="string"){const x=a.parseColor(c);if(x)return x}else if(Array.isArray(c)&&(p=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:h_(c[0],c[1],c[2],c[3]),!p))return new hi(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ds(p||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const p of this.args){if(c=p.evaluate(a),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new Ds(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?ka.fromString(Cu(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?vl.build(Cu(this.args[0].evaluate(a))):this.type.kind==="array"?this.args.map(c=>c.evaluate(a)):Cu(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if(this.type.kind==="formatted")return new df([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rn(this.args[0]).serialize();const a=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{a.push(c.serialize())}),a}}const m_=["Unknown","Point","LineString","Polygon"];class Ka{constructor(a,c,p){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=a,this.options=c,this.iconImageUseTheme=p}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?m_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(a){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:p,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(p*c-a[0])+this.featureDistanceData.bearing[1]*(g*c-a[1])}return 0}parseColor(a){let c=this._parseColorCache[a];return c||(c=this._parseColorCache[a]=hi.parse(a)),c}getConfig(a){return this.options?this.options.get(a):null}}class Vo{constructor(a,c,p,g,x){this.name=a,this.type=c,this._evaluate=p,this.args=g,this._overloadIndex=x}evaluate(a){if(!this._evaluate){const c=Vo.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,c){const p=a[0],g=Vo.definitions[p];if(!g)return c.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,C=[];let I=null,D=-1;for(const[U,q]of b){if(Array.isArray(U)&&U.length!==a.length-1)continue;C.push(U),D++,I=new T_(c.registry,c.path,null,c.scope,void 0,c._scope,c.options,c.iconImageUseTheme);const H=[];let Y=!1;for(let J=1;J<a.length;J++){const oe=a[J],ce=Array.isArray(U)?U[J-1]:U.type,he=I.parse(oe,1+H.length,ce);if(!he){Y=!0;break}H.push(he)}if(!Y)if(Array.isArray(U)&&U.length!==H.length)I.error(`Expected ${U.length} arguments, but found ${H.length} instead.`);else{for(let J=0;J<H.length;J++){const oe=Array.isArray(U)?U[J]:U.type,ce=H[J];I.concat(J+1).checkSubtype(oe,ce.type)}if(I.errors.length===0)return new Vo(p,x,q,H,D)}}if(C.length===1)c.errors.push(...I.errors);else{const U=(C.length?C:b.map(([H])=>H)).map(hf).join(" | "),q=[];for(let H=1;H<a.length;H++){const Y=c.parse(a[H],1+q.length);if(!Y)return null;q.push(Qs(Y.type))}c.error(`Expected arguments of type ${U}, but found (${q.join(", ")}) instead.`)}return null}static register(a,c){Vo.definitions=c;for(const p in c)a[p]=Vo}}function hf(u){return Array.isArray(u)?`(${u.map(Qs).join(", ")})`:`(${Qs(u.type)}...)`}class Cp{constructor(a,c,p){this.type=Wg,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=c}static parse(a,c){if(a.length!==2)return c.error("Expected one argument.");const p=a[1];if(typeof p!="object"||Array.isArray(p))return c.error("Collator options argument must be an object.");const g=p["case-sensitive"]===void 0?c.parse(!1,1,ui):c.parseObjectValue(p["case-sensitive"],1,"case-sensitive",ui);if(!g)return null;const x=p["diacritic-sensitive"]===void 0?c.parse(!1,1,ui):c.parseObjectValue(p["diacritic-sensitive"],1,"diacritic-sensitive",ui);if(!x)return null;let b=null;return p.locale&&(b=c.parseObjectValue(p.locale,1,"locale",Zn),!b)?null:new Cp(g,x,b)}evaluate(a){return new zw(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}function ld(u,a,c=0,p=u.length-1,g=KI){for(;p>c;){if(p-c>600){const I=p-c+1,D=a-c+1,U=Math.log(I),q=.5*Math.exp(2*U/3),H=.5*Math.sqrt(U*q*(I-q)/I)*(D-I/2<0?-1:1);ld(u,a,Math.max(c,Math.floor(a-D*q/I+H)),Math.min(p,Math.floor(a+(I-D)*q/I+H)),g)}const x=u[a];let b=c,C=p;for(Za(u,c,a),g(u[p],x)>0&&Za(u,c,p);b<C;){for(Za(u,b,C),b++,C--;g(u[b],x)<0;)b++;for(;g(u[C],x)>0;)C--}g(u[c],x)===0?Za(u,c,C):(C++,Za(u,C,p)),C<=a&&(c=C+1),a<=C&&(p=C-1)}}function Za(u,a,c){const p=u[a];u[a]=u[c],u[c]=p}function KI(u,a){return u<a?-1:u>a?1:0}function ZI(u){let a=0;for(let c,p,g=0,x=u.length,b=x-1;g<x;b=g++)c=u[g],p=u[b],a+=(p.x-c.x)*(c.y+p.y);return a}function Qg(u,a){u[0]=Math.min(u[0],a[0]),u[1]=Math.min(u[1],a[1]),u[2]=Math.max(u[2],a[0]),u[3]=Math.max(u[3],a[1])}function Jd(u,a){return!(u[0]<=a[0]||u[2]>=a[2]||u[1]<=a[1]||u[3]>=a[3])}function iA(u,a,c){const p=u[0]-a[0],g=u[1]-a[1],x=u[0]-c[0],b=u[1]-c[1];return p*b-x*g==0&&p*x<=0&&g*b<=0}function Ac(u,a,c=!1){let p=!1;for(let C=0,I=a.length;C<I;C++){const D=a[C];for(let U=0,q=D.length,H=q-1;U<q;H=U++){const Y=D[H],J=D[U];if(iA(u,Y,J))return c;(x=Y)[1]>(g=u)[1]!=(b=J)[1]>g[1]&&g[0]<(b[0]-x[0])*(g[1]-x[1])/(b[1]-x[1])+x[0]&&(p=!p)}}var g,x,b;return p}function sA(u,a,c,p){const g=p[0]-c[0],x=p[1]-c[1],b=(u[0]-c[0])*x-g*(u[1]-c[1]),C=(a[0]-c[0])*x-g*(a[1]-c[1]);return b>0&&C<0||b<0&&C>0}function g_(u,a,c,p){return(g=[p[0]-c[0],p[1]-c[1]])[0]*(x=[a[0]-u[0],a[1]-u[1]])[1]-g[1]*x[0]!=0&&!(!sA(u,a,c,p)||!sA(c,p,u,a));var g,x}function ey(u){const a=new at(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new at(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const p of u[0])a.x>p.x&&(a.x=p.x),a.y>p.y&&(a.y=p.y),c.x<p.x&&(c.x=p.x),c.y<p.y&&(c.y=p.y);return{min:a,max:c}}const Qd=8192;function XI(u,a){const c=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,g=Math.pow(2,a.z);return[Math.round(c*g*Qd),Math.round(p*g*Qd)]}function aA(u,a){for(let c=0;c<a.length;c++)if(Ac(u,a[c]))return!0;return!1}function YI(u,a,c){for(const p of c)for(let g=0,x=p.length,b=x-1;g<x;b=g++)if(g_(u,a,p[b],p[g]))return!0;return!1}function eh(u,a){for(let c=0;c<u.length;++c)if(!Ac(u[c],a))return!1;for(let c=0;c<u.length-1;++c)if(YI(u[c],u[c+1],a))return!1;return!0}function JI(u,a){for(let c=0;c<a.length;c++)if(eh(u,a[c]))return!0;return!1}function Bw(u,a,c){const p=[];for(let g=0;g<u.length;g++){const x=[];for(let b=0;b<u[g].length;b++){const C=XI(u[g][b],c);Qg(a,C),x.push(C)}p.push(x)}return p}function y_(u,a,c){const p=[];for(let g=0;g<u.length;g++){const x=Bw(u[g],a,c);p.push(x)}return p}function $w(u,a,c,p){if(u[0]<c[0]||u[0]>c[2]){const g=.5*p;let x=u[0]-c[0]>g?-p:c[0]-u[0]>g?p:0;x===0&&(x=u[0]-c[2]>g?-p:c[2]-u[0]>g?p:0),u[0]+=x}Qg(a,u)}function Uw(u,a,c,p){const g=Math.pow(2,p.z)*Qd,x=[p.x*Qd,p.y*Qd],b=[];if(!u)return b;for(const C of u)for(const I of C){const D=[I.x+x[0],I.y+x[1]];$w(D,a,c,g),b.push(D)}return b}function Cc(u,a,c,p){const g=Math.pow(2,p.z)*Qd,x=[p.x*Qd,p.y*Qd],b=[];if(!u)return b;for(const I of u){const D=[];for(const U of I){const q=[U.x+x[0],U.y+x[1]];Qg(a,q),D.push(q)}b.push(D)}if(a[2]-a[0]<=g/2){(C=a)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const I of b)for(const D of I)$w(D,a,c,g)}var C;return b}class ff{constructor(a,c){this.type=ui,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Tp(a[1])){const p=a[1];if(p.type==="FeatureCollection")for(let g=0;g<p.features.length;++g){const x=p.features[g].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new ff(p,p.features[g].geometry)}else if(p.type==="Feature"){const g=p.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ff(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ff(p,p)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(c,p){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(!b)return!1;if(p.type==="Polygon"){const C=Bw(p.coordinates,x,b),I=Uw(c.geometry(),g,x,b);if(!Jd(g,x))return!1;for(const D of I)if(!Ac(D,C))return!1}if(p.type==="MultiPolygon"){const C=y_(p.coordinates,x,b),I=Uw(c.geometry(),g,x,b);if(!Jd(g,x))return!1;for(const D of I)if(!aA(D,C))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(c,p){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(!b)return!1;if(p.type==="Polygon"){const C=Bw(p.coordinates,x,b),I=Cc(c.geometry(),g,x,b);if(!Jd(g,x))return!1;for(const D of I)if(!eh(D,C))return!1}if(p.type==="MultiPolygon"){const C=y_(p.coordinates,x,b),I=Cc(c.geometry(),g,x,b);if(!Jd(g,x))return!1;for(const D of I)if(!JI(D,C))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ty={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Vw=1/298.257223563,qw=Vw*(2-Vw),jp=Math.PI/180;class Pp{static fromTile(a,c,p){const g=Math.PI*(1-2*(a+.5)/Math.pow(2,c)),x=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/jp;return new Pp(x,p)}static get units(){return ty}constructor(a,c){if(a===void 0)throw new Error("No latitude given.");if(c&&!ty[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(ty).join(", ")}`);const p=6378.137*jp*(c?ty[c]:1),g=Math.cos(a*jp),x=1/(1-qw*(1-g*g)),b=Math.sqrt(x);this.kx=p*b*g,this.ky=p*b*x*(1-qw)}distance(a,c){const p=Hl(a[0]-c[0])*this.kx,g=(a[1]-c[1])*this.ky;return Math.sqrt(p*p+g*g)}bearing(a,c){const p=Hl(c[0]-a[0])*this.kx;return Math.atan2(p,(c[1]-a[1])*this.ky)/jp}destination(a,c,p){const g=p*jp;return this.offset(a,Math.sin(g)*c,Math.cos(g)*c)}offset(a,c,p){return[a[0]+c/this.kx,a[1]+p/this.ky]}lineDistance(a){let c=0;for(let p=0;p<a.length-1;p++)c+=this.distance(a[p],a[p+1]);return c}area(a){let c=0;for(let p=0;p<a.length;p++){const g=a[p];for(let x=0,b=g.length,C=b-1;x<b;C=x++)c+=Hl(g[x][0]-g[C][0])*(g[x][1]+g[C][1])*(p?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(a,c){let p=0;if(c<=0)return a[0];for(let g=0;g<a.length-1;g++){const x=a[g],b=a[g+1],C=this.distance(x,b);if(p+=C,p>c)return v_(x,b,(c-(p-C))/C)}return a[a.length-1]}pointToSegmentDistance(a,c,p){let[g,x]=c,b=Hl(p[0]-g)*this.kx,C=(p[1]-x)*this.ky;if(b!==0||C!==0){const I=(Hl(a[0]-g)*this.kx*b+(a[1]-x)*this.ky*C)/(b*b+C*C);I>1?(g=p[0],x=p[1]):I>0&&(g+=b/this.kx*I,x+=C/this.ky*I)}return b=Hl(a[0]-g)*this.kx,C=(a[1]-x)*this.ky,Math.sqrt(b*b+C*C)}pointOnLine(a,c){let p=1/0,g=a[0][0],x=a[0][1],b=0,C=0;for(let I=0;I<a.length-1;I++){let D=a[I][0],U=a[I][1],q=Hl(a[I+1][0]-D)*this.kx,H=(a[I+1][1]-U)*this.ky,Y=0;q===0&&H===0||(Y=(Hl(c[0]-D)*this.kx*q+(c[1]-U)*this.ky*H)/(q*q+H*H),Y>1?(D=a[I+1][0],U=a[I+1][1]):Y>0&&(D+=q/this.kx*Y,U+=H/this.ky*Y)),q=Hl(c[0]-D)*this.kx,H=(c[1]-U)*this.ky;const J=q*q+H*H;J<p&&(p=J,g=D,x=U,b=I,C=Y)}return{point:[g,x],index:b,t:Math.max(0,Math.min(1,C))}}lineSlice(a,c,p){let g=this.pointOnLine(p,a),x=this.pointOnLine(p,c);if(g.index>x.index||g.index===x.index&&g.t>x.t){const D=g;g=x,x=D}const b=[g.point],C=g.index+1,I=x.index;!Hw(p[C],b[0])&&C<=I&&b.push(p[C]);for(let D=C+1;D<=I;D++)b.push(p[D]);return Hw(p[I],x.point)||b.push(x.point),b}lineSliceAlong(a,c,p){let g=0;const x=[];for(let b=0;b<p.length-1;b++){const C=p[b],I=p[b+1],D=this.distance(C,I);if(g+=D,g>a&&x.length===0&&x.push(v_(C,I,(a-(g-D))/D)),g>=c)return x.push(v_(C,I,(c-(g-D))/D)),x;g>a&&x.push(I)}return x}bufferPoint(a,c){const p=c/this.ky,g=c/this.kx;return[a[0]-g,a[1]-p,a[0]+g,a[1]+p]}bufferBBox(a,c){const p=c/this.ky,g=c/this.kx;return[a[0]-g,a[1]-p,a[2]+g,a[3]+p]}insideBBox(a,c){return Hl(a[0]-c[0])>=0&&Hl(a[0]-c[2])<=0&&a[1]>=c[1]&&a[1]<=c[3]}}function Hw(u,a){return u[0]===a[0]&&u[1]===a[1]}function v_(u,a,c){const p=Hl(a[0]-u[0]);return[u[0]+p*c,u[1]+(a[1]-u[1])*c]}function Hl(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class __{constructor(a=[],c=(p,g)=>p<g?-1:p>g?1:0){if(this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:c,compare:p}=this,g=c[a];for(;a>0;){const x=a-1>>1,b=c[x];if(p(g,b)>=0)break;c[a]=b,a=x}c[a]=g}_down(a){const{data:c,compare:p}=this,g=this.length>>1,x=c[a];for(;a<g;){let b=1+(a<<1);const C=b+1;if(C<this.length&&p(c[C],c[b])<0&&(b=C),p(c[b],x)>=0)break;c[a]=c[b],a=b}c[a]=x}}var rr=8192;function Gw(u,a){return a.dist-u.dist}const Op=100,kp=50;function ry(u){const a=[1/0,1/0,-1/0,-1/0];if(a.length!==u.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==u[c])return!1;return!0}function ny(u){return u[1]-u[0]+1}function Pu(u,a){const c=u[1]>=u[0]&&u[1]<a;return c||console.warn("Distance Expression: Index is out of range"),c}function x_(u,a){if(u[0]>u[1])return[null,null];const c=ny(u);if(a){if(c===2)return[u,null];const p=Math.floor(c/2);return[[u[0],u[0]+p],[u[0]+p,u[1]]]}{if(c===1)return[u,null];const p=Math.floor(c/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}}function jc(u,a){const c=[1/0,1/0,-1/0,-1/0];if(!Pu(a,u.length))return c;for(let p=a[0];p<=a[1];++p)Qg(c,u[p]);return c}function Nn(u){const a=[1/0,1/0,-1/0,-1/0];for(let c=0;c<u.length;++c)for(let p=0;p<u[c].length;++p)Qg(a,u[c][p]);return a}function Np(u,a,c){if(ry(u)||ry(a))return NaN;let p=0,g=0;return u[2]<a[0]&&(p=a[0]-u[2]),u[0]>a[2]&&(p=u[0]-a[2]),u[1]>a[3]&&(g=u[1]-a[3]),u[3]<a[1]&&(g=a[1]-u[3]),c.distance([0,0],[p,g])}function QI(u){return 360*u-180}function eR(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function b_(u,a){const c=Math.pow(2,a.z),p=(u.y/rr+a.y)/c;return[QI((u.x/rr+a.x)/c),eR(p)]}function tR(u,a){const c=[];for(let p=0;p<u.length;++p)c.push(b_(u[p],a));return c}function us(u,a,c){const p=c.pointOnLine(a,u).point;return c.distance(u,p)}function oA(u,a,c,p,g){const x=c.slice(p[0],p[1]+1);let b=1/0;for(let C=a[0];C<=a[1];++C)if((b=Math.min(b,us(u[C],x,g)))===0)return 0;return b}function Ww(u,a,c,p,g){const x=Math.min(g.pointToSegmentDistance(u,c,p),g.pointToSegmentDistance(a,c,p)),b=Math.min(g.pointToSegmentDistance(c,u,a),g.pointToSegmentDistance(p,u,a));return Math.min(x,b)}function rR(u,a,c,p,g){if(!Pu(a,u.length)||!Pu(p,c.length))return NaN;let x=1/0;for(let b=a[0];b<a[1];++b)for(let C=p[0];C<p[1];++C){if(g_(u[b],u[b+1],c[C],c[C+1]))return 0;x=Math.min(x,Ww(u[b],u[b+1],c[C],c[C+1],g))}return x}function nR(u,a,c,p,g){if(!Pu(a,u.length)||!Pu(p,c.length))return NaN;let x=1/0;for(let b=a[0];b<=a[1];++b)for(let C=p[0];C<=p[1];++C)if((x=Math.min(x,g.distance(u[b],c[C])))===0)return x;return x}function iR(u,a,c){if(Ac(u,a,!0))return 0;let p=1/0;for(const g of a){const x=g.length;if(x<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[x-1]&&(p=Math.min(p,c.pointToSegmentDistance(u,g[x-1],g[0])))===0||(p=Math.min(p,us(u,g,c)))===0)return p}return p}function sR(u,a,c,p){if(!Pu(a,u.length))return NaN;for(let x=a[0];x<=a[1];++x)if(Ac(u[x],c,!0))return 0;let g=1/0;for(let x=a[0];x<a[1];++x)for(const b of c)for(let C=0,I=b.length,D=I-1;C<I;D=C++){if(g_(u[x],u[x+1],b[D],b[C]))return 0;g=Math.min(g,Ww(u[x],u[x+1],b[D],b[C],p))}return g}function lA(u,a){for(const c of u)for(let p=0;p<=c.length-1;++p)if(Ac(c[p],a,!0))return!0;return!1}function aR(u,a,c,p=1/0){const g=Nn(u),x=Nn(a);if(p!==1/0&&Np(g,x,c)>=p)return p;if(Jd(g,x)){if(lA(u,a))return 0}else if(lA(a,u))return 0;let b=p;for(const C of u)for(let I=0,D=C.length,U=D-1;I<D;U=I++)for(const q of a)for(let H=0,Y=q.length,J=Y-1;H<Y;J=H++){if(g_(C[U],C[I],q[J],q[H]))return 0;b=Math.min(b,Ww(C[U],C[I],q[J],q[H],c))}return b}function w_(u,a,c,p,g,x,b){if(x===null||b===null)return;const C=Np(jc(p,x),jc(g,b),c);C<a&&u.push({dist:C,range1:x,range2:b})}function oR(u,a,c,p,g=1/0){let x=Math.min(p.distance(u[0],c[0][0]),g);if(x===0)return x;const b=new __([{dist:0,range1:[0,u.length-1],range2:[0,0]}],Gw),C=a?kp:Op,I=Nn(c);for(;b.length;){const D=b.pop();if(D.dist>=x)continue;const U=D.range1;if(ny(U)<=C){if(!Pu(U,u.length))return NaN;if(a){const q=sR(u,U,c,p);if((x=Math.min(x,q))===0)return x}else for(let q=U[0];q<=U[1];++q){const H=iR(u[q],c,p);if((x=Math.min(x,H))===0)return x}}else{const q=x_(U,a);if(q[0]!==null){const H=Np(jc(u,q[0]),I,p);H<x&&b.push({dist:H,range1:q[0],range2:[0,0]})}if(q[1]!==null){const H=Np(jc(u,q[1]),I,p);H<x&&b.push({dist:H,range1:q[1],range2:[0,0]})}}}return x}function cA(u,a,c,p,g,x=1/0){let b=Math.min(x,g.distance(u[0],c[0]));if(b===0)return b;const C=new __([{dist:0,range1:[0,u.length-1],range2:[0,c.length-1]}],Gw),I=a?kp:Op,D=p?kp:Op;for(;C.length;){const U=C.pop();if(U.dist>=b)continue;const q=U.range1,H=U.range2;if(ny(q)<=I&&ny(H)<=D){if(!Pu(q,u.length)||!Pu(H,c.length))return NaN;if(a&&p?b=Math.min(b,rR(u,q,c,H,g)):a||p?a&&!p?b=Math.min(b,oA(c,H,u,q,g)):!a&&p&&(b=Math.min(b,oA(u,q,c,H,g))):b=Math.min(b,nR(u,q,c,H,g)),b===0)return b}else{const Y=x_(q,a),J=x_(H,p);w_(C,b,g,u,c,Y[0],J[0]),w_(C,b,g,u,c,Y[0],J[1]),w_(C,b,g,u,c,Y[1],J[0]),w_(C,b,g,u,c,Y[1],J[1])}}return b}function Kw(u,a,c,p,g=1/0){let x=g;const b=jc(u,[0,u.length-1]);for(const C of c)if(!(x!==1/0&&Np(b,jc(C,[0,C.length-1]),p)>=x)&&(x=Math.min(x,cA(u,a,C,!0,p,x)),x===0))return x;return x}function S_(u,a,c,p,g=1/0){let x=g;const b=jc(u,[0,u.length-1]);for(const C of c){if(x!==1/0&&Np(b,Nn(C),p)>=x)continue;const I=oR(u,a,C,p,x);if(isNaN(I))return I;if((x=Math.min(x,I))===0)return x}return x}function Zw(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class pf{constructor(a,c){this.type=Or,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${a.length-1} instead.`);if(Tp(a[1])){const p=a[1];if(p.type==="FeatureCollection"){for(let g=0;g<p.features.length;++g)if(Zw(p.features[g].geometry.type))return new pf(p,p.features[g].geometry)}else if(p.type==="Feature"){if(Zw(p.geometry.type))return new pf(p,p.geometry)}else if(Zw(p.type))return new pf(p,p)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(a){const c=a.geometry(),p=a.canonicalID();if(c!=null&&p!=null){if(a.geometryType()==="Point")return function(g,x,b){const C=[];for(const D of g)for(const U of D)C.push(b_(U,x));const I=new Pp(C[0][1],"meters");return b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString"?cA(C,!1,b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",I):b.type==="MultiLineString"?Kw(C,!1,b.coordinates,I):b.type==="Polygon"||b.type==="MultiPolygon"?S_(C,!1,b.type==="Polygon"?[b.coordinates]:b.coordinates,I):null}(c,p,this.geometries);if(a.geometryType()==="LineString")return function(g,x,b){const C=[];for(const D of g){const U=[];for(const q of D)U.push(b_(q,x));C.push(U)}const I=new Pp(C[0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return Kw(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",C,I);if(b.type==="MultiLineString"){let D=1/0;for(let U=0;U<b.coordinates.length;U++){const q=Kw(b.coordinates[U],!0,C,I,D);if(isNaN(q))return q;if((D=Math.min(D,q))===0)return D}return D}if(b.type==="Polygon"||b.type==="MultiPolygon"){let D=1/0;for(let U=0;U<C.length;U++){const q=S_(C[U],!0,b.type==="Polygon"?[b.coordinates]:b.coordinates,I,D);if(isNaN(q))return q;if((D=Math.min(D,q))===0)return D}return D}return null}(c,p,this.geometries);if(a.geometryType()==="Polygon")return function(g,x,b){const C=[];for(const D of function(U,q){const H=U.length;if(H<=1)return[U];const Y=[];let J,oe;for(let ce=0;ce<H;ce++){const he=ZI(U[ce]);he!==0&&(U[ce].area=Math.abs(he),oe===void 0&&(oe=he<0),oe===he<0?(J&&Y.push(J),J=[U[ce]]):J.push(U[ce]))}return J&&Y.push(J),Y}(g)){const U=[];for(let q=0;q<D.length;++q)U.push(tR(D[q],x));C.push(U)}const I=new Pp(C[0][0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return S_(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",C,I);if(b.type==="MultiLineString"){let D=1/0;for(let U=0;U<b.coordinates.length;U++){const q=S_(b.coordinates[U],!0,C,I,D);if(isNaN(q))return q;if((D=Math.min(D,q))===0)return D}return D}return b.type==="Polygon"||b.type==="MultiPolygon"?function(D,U,q){let H=1/0;for(const Y of D)for(const J of U){const oe=aR(Y,J,q,H);if(isNaN(oe))return oe;if((H=Math.min(H,oe))===0)return H}return H}(b.type==="Polygon"?[b.coordinates]:b.coordinates,C,I):null}(c,p,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ip(u){if(u instanceof Vo&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ff||u instanceof pf)return!1;if(u instanceof Mp)return u.featureConstant;let a=!0;return u.eachChild(c=>{a&&!Ip(c)&&(a=!1)}),a}function iy(u){if(u instanceof Vo&&u.name==="feature-state")return!1;let a=!0;return u.eachChild(c=>{a&&!iy(c)&&(a=!1)}),a}function Rp(u,a){if(u instanceof Vo&&a.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(p=>{c&&!Rp(p,a)&&(c=!1)}),c}function uA(u,a,c){return[u,a,c].filter(Boolean).join("")}function Xw(u,a){switch(u){case"string":return Cu(a);case"number":return+a;case"boolean":return!!a;case"color":return hi.parse(a);case"formatted":return ka.fromString(Cu(a));case"resolvedImage":return vl.build(Cu(a))}return a}function dA(u,a,c,p){return p!==void 0&&(u=p*Math.round(u/p)),a!==void 0&&u<a&&(u=a),c!==void 0&&u>c&&(u=c),u}class Mp{constructor(a,c,p,g=!1){this.type=a,this.key=c,this.scope=p,this.featureConstant=g}static parse(a,c){let p=c.expectedType;if(p==null&&(p=gi),a.length<2||a.length>3)return c.error("Invalid number of arguments for 'config' expression.");const g=c.parse(a[1],1);if(!(g instanceof od))return c.error("Key name of 'config' expression must be a string literal.");let x,b=!0;const C=Cu(g.value);if(a.length>=3){const I=c.parse(a[2],2);if(!(I instanceof od))return c.error("Scope of 'config' expression must be a string literal.");x=Cu(I.value)}if(c.options){const I=uA(C,x,c._scope),D=c.options.get(I);D&&(b=Ip(D.value||D.default))}return new Mp(p,C,x,b)}evaluate(a){const c=uA(this.key,this.scope,a.scope),p=a.getConfig(c);if(!p)return null;const{type:g,value:x,values:b,minValue:C,maxValue:I,stepValue:D}=p,U=p.default.evaluate(a);let q=U;if(x){const H=a.scope;a.scope=(H||"").split("").slice(1).join(""),q=x.evaluate(a),a.scope=H}return g&&(q=Xw(g,q)),q===void 0||C===void 0&&I===void 0&&D===void 0||(typeof q=="number"?q=dA(q,C,I,D):Array.isArray(q)&&(q=q.map(H=>typeof H=="number"?dA(H,C,I,D):H))),x!==void 0&&q!==void 0&&b&&!b.includes(q)&&(q=U,g&&(q=Xw(g,q))),(g&&g!==this.type||q!==void 0&&!d_(ba(q),this.type))&&(q=Xw(this.type.kind,q)),q}eachChild(){}outputDefined(){return!1}serialize(){const a=["config",this.key];return this.scope&&a.concat(this.scope),a}}class E_{constructor(a,c){this.type=c.type,this.name=a,this.boundExpression=c}static parse(a,c){if(a.length!==2||typeof a[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const p=a[1];return c.scope.has(p)?new E_(p,c.scope.get(p)):c.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class T_{constructor(a,c=[],p,g=new Tc,x=[],b,C,I){this.registry=a,this.path=c,this.key=c.map(D=>typeof D=="string"?`['${D}']`:`[${D}]`).join(""),this.scope=g,this.errors=x,this.expectedType=p,this._scope=b,this.options=C,this.iconImageUseTheme=I}parse(a,c,p,g,x={}){return c||p?this.concat(c,null,p,g)._parse(a,x):this._parse(a,x)}parseObjectValue(a,c,p,g,x,b={}){return this.concat(c,p,g,x)._parse(a,b)}_parse(a,c){function p(g,x,b){return b==="assert"?new Er(x,[g]):b==="coerce"?new ju(x,[g]):g}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof a[0]=="string"?this.registry[a[0]]:void 0;if(g){let x=g.parse(a,this);if(!x)return null;if(this.expectedType){const b=this.expectedType,C=x.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||C.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(b,C))return null}else x=p(x,b,c.typeAnnotation||"coerce");else x=p(x,b,c.typeAnnotation||"assert")}if(!(x instanceof od)&&x.type.kind!=="resolvedImage"&&Yw(x)){const b=new Ka(this._scope,this.options,this.iconImageUseTheme);try{x=new od(x.type,x.evaluate(b))}catch(C){return this.error(C.message),null}}return x}return ju.parse(["to-array",a],this)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,c,p,g){let x=typeof a=="number"?this.path.concat(a):this.path;x=typeof c=="string"?x.concat(c):x;const b=g?this.scope.concat(g):this.scope;return new T_(this.registry,x,p||null,b,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(a,...c){const p=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ec(p,a))}checkSubtype(a,c){const p=Zg(a,c);return p&&this.error(p),p}}function Yw(u){if(u instanceof E_)return Yw(u.boundExpression);if(u instanceof Vo&&u.name==="error"||u instanceof Cp||u instanceof ff||u instanceof pf||u instanceof Mp)return!1;const a=u instanceof ju||u instanceof Er;let c=!0;return u.eachChild(p=>{c=a?c&&Yw(p):c&&p instanceof od}),!!c&&Ip(u)&&Rp(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function A_(u,a){const c=u.length-1;let p,g,x=0,b=c,C=0;for(;x<=b;)if(C=Math.floor((x+b)/2),p=u[C],g=u[C+1],p<=a){if(C===c||a<g)return C;x=C+1}else{if(!(p>a))throw new Ds("Input is not a number.");b=C-1}return 0}class sy{constructor(a,c,p){this.type=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static parse(a,c){if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");const p=c.parse(a[1],1,Or);if(!p)return null;const g=[];let x=null;c.expectedType&&c.expectedType.kind!=="value"&&(x=c.expectedType);for(let b=1;b<a.length;b+=2){const C=b===1?-1/0:a[b],I=a[b+1],D=b,U=b+1;if(typeof C!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=C)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const q=c.parse(I,U,x);if(!q)return null;x=x||q.type,g.push([C,q])}return new sy(x,p,g)}evaluate(a){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(a);const g=this.input.evaluate(a);if(g<=c[0])return p[0].evaluate(a);const x=c.length;return g>=c[x-1]?p[x-1].evaluate(a):p[A_(c,g)].evaluate(a)}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&a.push(this.labels[c]),a.push(this.outputs[c].serialize());return a}}const hA=.95047,fA=1.08883,pA=4/29,Dp=6/29,C_=3*Dp*Dp,lR=Dp*Dp*Dp,mA=Math.PI/180,cR=180/Math.PI;function Jw(u){return u>lR?Math.pow(u,1/3):u/C_+pA}function Qw(u){return u>Dp?u*u*u:C_*(u-pA)}function j_(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function P_(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function mf(u){const a=P_(u.r),c=P_(u.g),p=P_(u.b),g=Jw((.4124564*a+.3575761*c+.1804375*p)/hA),x=Jw((.2126729*a+.7151522*c+.072175*p)/1);return{l:116*x-16,a:500*(g-x),b:200*(x-Jw((.0193339*a+.119192*c+.9503041*p)/fA)),alpha:u.a}}function e1(u){let a=(u.l+16)/116,c=isNaN(u.a)?a:a+u.a/500,p=isNaN(u.b)?a:a-u.b/200;return a=1*Qw(a),c=hA*Qw(c),p=fA*Qw(p),new hi(j_(3.2404542*c-1.5371385*a-.4985314*p),j_(-.969266*c+1.8760108*a+.041556*p),j_(.0556434*c-.2040259*a+1.0572252*p),u.alpha)}function gA(u,a,c){const p=a-u;return u+c*(p>180||p<-180?p-360*Math.round(p/360):p)}const ay={forward:mf,reverse:e1,interpolate:function(u,a,c){return{l:Kr(u.l,a.l,c),a:Kr(u.a,a.a,c),b:Kr(u.b,a.b,c),alpha:Kr(u.alpha,a.alpha,c)}}},gf={forward:function(u){const{l:a,a:c,b:p}=mf(u),g=Math.atan2(p,c)*cR;return{h:g<0?g+360:g,c:Math.sqrt(c*c+p*p),l:a,alpha:u.a}},reverse:function(u){const a=u.h*mA,c=u.c;return e1({l:u.l,a:Math.cos(a)*c,b:Math.sin(a)*c,alpha:u.alpha})},interpolate:function(u,a,c){return{h:gA(u.h,a.h,c),c:Kr(u.c,a.c,c),l:Kr(u.l,a.l,c),alpha:Kr(u.alpha,a.alpha,c)}}};var O_=Object.freeze({__proto__:null,hcl:gf,lab:ay});class Gl{constructor(a,c,p,g,x){this.type=a,this.operator=c,this.interpolation=p,this.input=g,this.labels=[],this.outputs=[];for(const[b,C]of x)this.labels.push(b),this.outputs.push(C)}static interpolationFactor(a,c,p,g){let x=0;if(a.name==="exponential")x=t1(c,a.base,p,g);else if(a.name==="linear")x=t1(c,1,p,g);else if(a.name==="cubic-bezier"){const b=a.controlPoints;x=new Ga(b[0],b[1],b[2],b[3]).solve(t1(c,1,p,g))}return x}static parse(a,c){let[p,g,x,...b]=a;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some(U=>typeof U!="number"||U<0||U>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length-1>3&&(a.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(x=c.parse(x,2,Or),!x)return null;const C=[];let I=null;p==="interpolate-hcl"||p==="interpolate-lab"?I=kl:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let D=0;D<b.length;D+=2){const U=b[D],q=b[D+1],H=D+3,Y=D+4;if(typeof U!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(C.length&&C[C.length-1][0]>=U)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const J=c.parse(q,Y,I);if(!J)return null;I=I||J.type,C.push([U,J])}return I.kind==="number"||I.kind==="color"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new Gl(I,p,g,x,C):c.error(`Type ${Qs(I)} is not interpolatable.`)}evaluate(a){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(a);const g=this.input.evaluate(a);if(g<=c[0])return p[0].evaluate(a);const x=c.length;if(g>=c[x-1])return p[x-1].evaluate(a);const b=A_(c,g),C=Gl.interpolationFactor(this.interpolation,g,c[b],c[b+1]),I=p[b].evaluate(a),D=p[b+1].evaluate(a);return this.operator==="interpolate"?sd[this.type.kind.toLowerCase()](I,D,C):this.operator==="interpolate-hcl"?gf.reverse(gf.interpolate(gf.forward(I),gf.forward(D),C)):ay.reverse(ay.interpolate(ay.forward(I),ay.forward(D),C))}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,a,this.input.serialize()];for(let p=0;p<this.labels.length;p++)c.push(this.labels[p],this.outputs[p].serialize());return c}}function t1(u,a,c,p){const g=p-c,x=u-c;return g===0?0:a===1?x/g:(Math.pow(a,x)-1)/(Math.pow(a,g)-1)}class oy{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expectected at least one argument.");let p=null;const g=c.expectedType;g&&g.kind!=="value"&&(p=g);const x=[];for(const C of a.slice(1)){const I=c.parse(C,1+x.length,p,void 0,{typeAnnotation:"omit"});if(!I)return null;p=p||I.type,x.push(I)}const b=g&&x.some(C=>Zg(g,C.type));return new oy(b?gi:p,x)}evaluate(a){let c,p=null,g=0;for(const x of this.args){if(g++,p=x.evaluate(a),p&&p instanceof vl&&!p.available&&(c||(c=p),p=null,g===this.args.length))return c;if(p!==null)break}return p}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class ly{constructor(a,c){this.type=c.type,this.bindings=[].concat(a),this.result=c}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const c of this.bindings)a(c[1]);a(this.result)}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const p=[];for(let x=1;x<a.length-1;x+=2){const b=a[x];if(typeof b!="string")return c.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return c.error("Variable names must contain only alphanumeric characters or '_'.",x);const C=c.parse(a[x+1],x+1);if(!C)return null;p.push([b,C])}const g=c.parse(a[a.length-1],a.length-1,c.expectedType,p);return g?new ly(p,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[c,p]of this.bindings)a.push(c,p.serialize());return a.push(this.result.serialize()),a}}class r1{constructor(a,c,p){this.type=a,this.index=c,this.input=p}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,Or),g=c.parse(a[2],2,Wa(c.expectedType||gi));return p&&g?new r1(g.type.itemType,p,g):null}evaluate(a){const c=this.index.evaluate(a),p=this.input.evaluate(a);if(c<0)throw new Ds("Array index out of bounds: negative index");if(c>=p.length)throw new Ds("Array index out of bounds: index exceeds array size");if(c!==Math.floor(c))throw new Ds("Array index must be an integer. Use at-interpolated for fractional indices");return p[c]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class n1{constructor(a,c,p){this.type=a,this.index=c,this.input=p}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,Or),g=c.parse(a[2],2,Wa(c.expectedType||gi));return p&&g?new n1(g.type.itemType,p,g):null}evaluate(a){const c=this.index.evaluate(a),p=this.input.evaluate(a);if(c<0)throw new Ds(`Array index out of bounds: ${c} < 0.`);if(c>p.length-1)throw new Ds(`Array index out of bounds: ${c} > ${p.length-1}.`);if(c===Math.floor(c))return p[c];const g=Math.floor(c),x=Math.ceil(c),b=p[g],C=p[x];if(typeof b!="number"||typeof C!="number")throw new Ds(`Cannot interpolate between non-number values at index ${c}.`);const I=c-g;return b*(1-I)+C*I}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class i1{constructor(a,c){this.type=ui,this.needle=a,this.haystack=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,gi),g=c.parse(a[2],2,gi);return p&&g?Fw(p.type,[ui,Zn,Or,Sp,gi])?new i1(p,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qs(p.type)} instead`):null}evaluate(a){const c=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(p==null)return!1;if(!Xg(c,["boolean","string","number","null"]))throw new Ds(`Expected first argument to be of type boolean, string, number or null, but found ${Qs(ba(c))} instead.`);if(!Xg(p,["string","array"]))throw new Ds(`Expected second argument to be of type array or string, but found ${Qs(ba(p))} instead.`);return p.indexOf(c)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class cy{constructor(a,c,p){this.type=Or,this.needle=a,this.haystack=c,this.fromIndex=p}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,gi),g=c.parse(a[2],2,gi);if(!p||!g)return null;if(!Fw(p.type,[ui,Zn,Or,Sp,gi]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qs(p.type)} instead`);if(a.length===4){const x=c.parse(a[3],3,Or);return x?new cy(p,g,x):null}return new cy(p,g)}evaluate(a){const c=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Xg(c,["boolean","string","number","null"]))throw new Ds(`Expected first argument to be of type boolean, string, number or null, but found ${Qs(ba(c))} instead.`);if(!Xg(p,["string","array"]))throw new Ds(`Expected second argument to be of type array or string, but found ${Qs(ba(p))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(a);return p.indexOf(c,g)}return p.indexOf(c)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class k_{constructor(a,c,p,g,x,b){this.inputType=a,this.type=c,this.input=p,this.cases=g,this.outputs=x,this.otherwise=b}static parse(a,c){if(a.length<5)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return c.error("Expected an even number of arguments.");let p,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const x={},b=[];for(let D=2;D<a.length-1;D+=2){let U=a[D];const q=a[D+1];Array.isArray(U)||(U=[U]);const H=c.concat(D);if(U.length===0)return H.error("Expected at least one branch label.");for(const J of U){if(typeof J!="number"&&typeof J!="string")return H.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return H.error("Numeric branch labels must be integer values.");if(p){if(H.checkSubtype(p,ba(J)))return null}else p=ba(J);if(x[String(J)]!==void 0)return H.error("Branch labels must be unique.");x[String(J)]=b.length}const Y=c.parse(q,D,g);if(!Y)return null;g=g||Y.type,b.push(Y)}const C=c.parse(a[1],1,gi);if(!C)return null;const I=c.parse(a[a.length-1],a.length-1,g);return I?C.type.kind!=="value"&&c.concat(1).checkSubtype(p,C.type)?null:new k_(p,g,C,x,b,I):null}evaluate(a){const c=this.input.evaluate(a);return(d_(ba(c),this.inputType)&&this.outputs[this.cases[c]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),p=[],g={};for(const b of c){const C=g[this.cases[b]];C===void 0?(g[this.cases[b]]=p.length,p.push([this.cases[b],[b]])):p[C][1].push(b)}const x=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,C]of p)a.push(C.length===1?x(C[0]):C.map(x)),a.push(this.outputs[b].serialize());return a.push(this.otherwise.serialize()),a}}class Lp{constructor(a,c,p){this.type=a,this.branches=c,this.otherwise=p}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return c.error("Expected an odd number of arguments.");let p;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);const g=[];for(let b=1;b<a.length-1;b+=2){const C=c.parse(a[b],b,ui);if(!C)return null;const I=c.parse(a[b+1],b+1,p);if(!I)return null;g.push([C,I]),p=p||I.type}const x=c.parse(a[a.length-1],a.length-1,p);return x?new Lp(p,g,x):null}evaluate(a){for(const[c,p]of this.branches)if(c.evaluate(a))return p.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[c,p]of this.branches)a(c),a(p);a(this.otherwise)}outputDefined(){return this.branches.every(([a,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class N_{constructor(a,c,p,g){this.type=a,this.input=c,this.beginIndex=p,this.endIndex=g}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,gi),g=c.parse(a[2],2,Or);if(!p||!g)return null;if(!Fw(p.type,[Wa(gi),Zn,gi]))return c.error(`Expected first argument to be of type array or string, but found ${Qs(p.type)} instead`);if(a.length===4){const x=c.parse(a[3],3,Or);return x?new N_(p.type,p,g,x):null}return new N_(p.type,p,g)}evaluate(a){const c=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!Xg(c,["string","array"]))throw new Ds(`Expected first argument to be of type array or string, but found ${Qs(ba(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(a);return c.slice(p,g)}return c.slice(p)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class I_{constructor(a,c){this.type=Wa(Zn),this.str=a,this.delimiter=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,Zn),g=c.parse(a[2],2,Zn);return p&&g?new I_(p,g):void 0}evaluate(a){const c=this.str.evaluate(a),p=this.delimiter.evaluate(a);return c.split(p)}eachChild(a){a(this.str),a(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function yA(u,a){return u==="=="||u==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function vA(u,a,c,p){return p.compare(a,c)===0}function Fp(u,a,c){const p=u!=="=="&&u!=="!=";return class $ie{constructor(x,b,C){this.type=ui,this.lhs=x,this.rhs=b,this.collator=C,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const C=x[0];let I=b.parse(x[1],1,gi);if(!I)return null;if(!yA(C,I.type))return b.concat(1).error(`"${C}" comparisons are not supported for type '${Qs(I.type)}'.`);let D=b.parse(x[2],2,gi);if(!D)return null;if(!yA(C,D.type))return b.concat(2).error(`"${C}" comparisons are not supported for type '${Qs(D.type)}'.`);if(I.type.kind!==D.type.kind&&I.type.kind!=="value"&&D.type.kind!=="value")return b.error(`Cannot compare types '${Qs(I.type)}' and '${Qs(D.type)}'.`);p&&(I.type.kind==="value"&&D.type.kind!=="value"?I=new Er(D.type,[I]):I.type.kind!=="value"&&D.type.kind==="value"&&(D=new Er(I.type,[D])));let U=null;if(x.length===4){if(I.type.kind!=="string"&&D.type.kind!=="string"&&I.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(U=b.parse(x[3],3,Wg),!U)return null}return new $ie(I,D,U)}evaluate(x){const b=this.lhs.evaluate(x),C=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){const I=ba(b),D=ba(C);if(I.kind!==D.kind||I.kind!=="string"&&I.kind!=="number")throw new Ds(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${I.kind}, ${D.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const I=ba(b),D=ba(C);if(I.kind!=="string"||D.kind!=="string")return a(x,b,C)}return this.collator?c(x,b,C,this.collator.evaluate(x)):a(x,b,C)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[u];return this.eachChild(b=>{x.push(b.serialize())}),x}}}const _A=Fp("==",function(u,a,c){return a===c},vA),xA=Fp("!=",function(u,a,c){return a!==c},function(u,a,c,p){return!vA(0,a,c,p)}),uR=Fp("<",function(u,a,c){return a<c},function(u,a,c,p){return p.compare(a,c)<0}),dR=Fp(">",function(u,a,c){return a>c},function(u,a,c,p){return p.compare(a,c)>0}),hR=Fp("<=",function(u,a,c){return a<=c},function(u,a,c,p){return p.compare(a,c)<=0}),R_=Fp(">=",function(u,a,c){return a>=c},function(u,a,c,p){return p.compare(a,c)>=0});class s1{constructor(a,c,p,g,x,b){this.type=Zn,this.number=a,this.locale=c,this.currency=p,this.unit=g,this.minFractionDigits=x,this.maxFractionDigits=b}static parse(a,c){if(a.length!==3)return c.error("Expected two arguments.");const p=c.parse(a[1],1,Or);if(!p)return null;const g=a[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=c.parseObjectValue(g.locale,2,"locale",Zn),!x))return null;let b=null;if(g.currency&&(b=c.parseObjectValue(g.currency,2,"currency",Zn),!b))return null;let C=null;if(g.unit&&(C=c.parseObjectValue(g.unit,2,"unit",Zn),!C))return null;let I=null;if(g["min-fraction-digits"]&&(I=c.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",Or),!I))return null;let D=null;return g["max-fraction-digits"]&&(D=c.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",Or),!D)?null:new s1(p,x,b,C,I,D)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(a):void 0,unit:this.unit?this.unit.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.unit&&a(this.unit),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.unit&&(a.unit=this.unit.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class a1{constructor(a){this.type=Or,this.input=a}static parse(a,c){if(a.length!==2)return c.error(`Expected 1 argument, but found ${a.length-1} instead.`);const p=c.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Qs(p.type)} instead.`):new a1(p):null}evaluate(a){const c=this.input.evaluate(a);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ds(`Expected value to be of type string or array, but found ${Qs(ba(c))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(c=>{a.push(c.serialize())}),a}}function bA(u){return function(){u=1831565813+(u|=0)|0;let a=Math.imul(u^u>>>15,1|u);return a=a+Math.imul(a^a>>>7,61|a)^a,((a^a>>>14)>>>0)/4294967296}}const zp={"==":_A,"!=":xA,">":dR,"<":uR,">=":R_,"<=":hR,array:Er,at:r1,"at-interpolated":n1,boolean:Er,case:Lp,coalesce:oy,collator:Cp,format:df,image:rn,in:i1,"index-of":cy,interpolate:Gl,"interpolate-hcl":Gl,"interpolate-lab":Gl,length:a1,let:ly,literal:od,match:k_,number:Er,"number-format":s1,object:Er,slice:N_,step:sy,string:Er,"to-boolean":ju,"to-color":ju,"to-number":ju,"to-string":ju,var:E_,within:ff,distance:pf,config:Mp,split:I_};function o1(u,[a,c,p,g]){a=a.evaluate(u),c=c.evaluate(u),p=p.evaluate(u);const x=g?g.evaluate(u):1,b=h_(a,c,p,x);if(b)throw new Ds(b);return new hi(a/255,c/255,p/255,x)}function wA(u,[a,c,p,g]){a=a.evaluate(u),c=c.evaluate(u),p=p.evaluate(u);const x=g?g.evaluate(u):1,b=function(D,U,q,H){return typeof D=="number"&&D>=0&&D<=360?typeof U=="number"&&U>=0&&U<=100&&typeof q=="number"&&q>=0&&q<=100?H===void 0||typeof H=="number"&&H>=0&&H<=1?null:`Invalid hsla value [${[D,U,q,H].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof H=="number"?[D,U,q,H]:[D,U,q]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof H=="number"?[D,U,q,H]:[D,U,q]).join(", ")}]: 'h' must be between 0 and 360.`}(a,c,p,x);if(b)throw new Ds(b);const C=`hsla(${a}, ${c}%, ${p}%, ${x})`,I=hi.parse(C);if(!I)throw new Ds(`Failed to parse HSLA color: ${C}`);return I}function SA(u,a){return u in a}function M_(u,a){const c=a[u];return c===void 0?null:c}function cd(u){return{type:u}}function uy(u){if(u instanceof Mp)return new Set([u.key]);let a=new Set;return u.eachChild(c=>{a=new Set([...a,...uy(c)])}),a}function D_(u){if(u instanceof Vo&&u.name==="is-active-floor")return!0;let a=!1;return u.eachChild(c=>{!a&&D_(c)&&(a=!0)}),a}function yf(u){return{result:"success",value:u}}function th(u){return{result:"error",value:u}}function l1(u,a){return!!u&&!!u.parameters&&u.parameters.indexOf(a)>-1}function L_(u){return u["property-type"]==="data-driven"}function c1(u){return l1(u.expression,"measure-light")}function u1(u){return l1(u.expression,"zoom")}function F_(u){return!!u.expression&&u.expression.interpolated}function z_(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function d1(u){return u}function B_(u,a){const c=a.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",g=p||!(p||u.property!==void 0),x=u.type||(F_(a)?"exponential":"interval");if(c&&((u=Object.assign({},u)).stops&&(u.stops=u.stops.map(D=>[D[0],hi.parse(D[1])])),u.default=hi.parse(u.default?u.default:a.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!O_[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let b,C,I;if(x==="exponential")b=EA;else if(x==="interval")b=rh;else if(x==="categorical"){b=fR,C=Object.create(null);for(const D of u.stops)C[D[0]]=D[1];I=typeof u.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);b=pR}if(p){const D={},U=[];for(let Y=0;Y<u.stops.length;Y++){const J=u.stops[Y],oe=J[0].zoom;D[oe]===void 0&&(D[oe]={zoom:oe,type:u.type,property:u.property,default:u.default,stops:[]},U.push(oe)),D[oe].stops.push([J[0].value,J[1]])}const q=[];for(const Y of U)q.push([D[Y].zoom,B_(D[Y],a)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Gl.interpolationFactor.bind(void 0,H),zoomStops:q.map(Y=>Y[0]),evaluate:({zoom:Y},J)=>EA({stops:q,base:u.base},a,Y).evaluate(Y,J)}}if(g){const D=x==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Gl.interpolationFactor.bind(void 0,D),zoomStops:u.stops.map(U=>U[0]),evaluate:({zoom:U})=>b(u,a,U,C,I)}}return{kind:"source",evaluate(D,U){const q=U&&U.properties?U.properties[u.property]:void 0;return q===void 0?Bp(u.default,a.default):b(u,a,q,C,I)}}}function Bp(u,a,c){return u!==void 0?u:a!==void 0?a:c!==void 0?c:void 0}function fR(u,a,c,p,g){return Bp(typeof c===g?p[c]:void 0,u.default,a.default)}function rh(u,a,c){if(!Jg(c))return Bp(u.default,a.default);const p=u.stops.length;if(p===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[p-1][0])return u.stops[p-1][1];const g=A_(u.stops.map(x=>x[0]),c);return u.stops[g][1]}function EA(u,a,c){const p=u.base!==void 0?u.base:1;if(!Jg(c))return Bp(u.default,a.default);const g=u.stops.length;if(g===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[g-1][0])return u.stops[g-1][1];const x=A_(u.stops.map(U=>U[0]),c),b=function(U,q,H,Y){const J=Y-H,oe=U-H;return J===0?0:q===1?oe/J:(Math.pow(q,oe)-1)/(Math.pow(q,J)-1)}(c,p,u.stops[x][0],u.stops[x+1][0]),C=u.stops[x][1],I=u.stops[x+1][1];let D=sd[a.type]||d1;if(u.colorSpace&&u.colorSpace!=="rgb"){const U=O_[u.colorSpace];D=(q,H)=>U.reverse(U.interpolate(U.forward(q),U.forward(H),b))}return typeof C.evaluate=="function"?{evaluate(...U){const q=C.evaluate.apply(void 0,U),H=I.evaluate.apply(void 0,U);if(q!==void 0&&H!==void 0)return D(q,H,b)}}:D(C,I,b)}function pR(u,a,c){return a.type==="color"?c=hi.parse(c):a.type==="formatted"?c=ka.fromString(c.toString()):a.type==="resolvedImage"?c=vl.build(c.toString()):Ap(c)===a.type||a.type==="enum"&&a.values[c]||(c=void 0),Bp(c,u.default,a.default)}Vo.register(zp,{error:[{kind:"error"},[Zn],(u,[a])=>{throw new Ds(a.evaluate(u))}],typeof:[Zn,[gi],(u,[a])=>Qs(ba(a.evaluate(u)))],"to-rgba":[Wa(Or,4),[kl],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Wa(Or,4),[kl],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[kl,[Or,Or,Or],o1],rgba:[kl,[Or,Or,Or,Or],o1],hsl:[kl,[Or,Or,Or],wA],hsla:[kl,[Or,Or,Or,Or],wA],has:{type:ui,overloads:[[[Zn],(u,[a])=>SA(a.evaluate(u),u.properties())],[[Zn,Ep],(u,[a,c])=>SA(a.evaluate(u),c.evaluate(u))]]},get:{type:gi,overloads:[[[Zn],(u,[a])=>M_(a.evaluate(u),u.properties())],[[Zn,Ep],(u,[a,c])=>M_(a.evaluate(u),c.evaluate(u))]]},"feature-state":[gi,[Zn],(u,[a])=>M_(a.evaluate(u),u.featureState||{})],properties:[Ep,[],u=>u.properties()],"geometry-type":[Zn,[],u=>u.geometryType()],worldview:[Zn,[],u=>u.globals.worldview||""],"is-active-floor":[ui,cd(Zn),(u,a)=>{if(!(u.globals.activeFloors&&u.globals.activeFloors.size>0))return!1;const c=u.globals.activeFloors;return a.some(p=>{const g=p.evaluate(u);return c.has(g)})}],id:[gi,[],u=>u.id()],zoom:[Or,[],u=>u.globals.zoom],pitch:[Or,[],u=>u.globals.pitch||0],"distance-from-center":[Or,[],u=>u.distanceFromCenter()],"measure-light":[Or,[Zn],(u,[a])=>u.measureLight(a.evaluate(u))],"heatmap-density":[Or,[],u=>u.globals.heatmapDensity||0],"line-progress":[Or,[],u=>u.globals.lineProgress||0],"raster-value":[Or,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[Or,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[Or,[],u=>u.globals.skyRadialProgress||0],accumulated:[gi,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Or,cd(Or),(u,a)=>{let c=0;for(const p of a)c+=p.evaluate(u);return c}],"*":[Or,cd(Or),(u,a)=>{let c=1;for(const p of a)c*=p.evaluate(u);return c}],"-":{type:Or,overloads:[[[Or,Or],(u,[a,c])=>a.evaluate(u)-c.evaluate(u)],[[Or],(u,[a])=>-a.evaluate(u)]]},"/":[Or,[Or,Or],(u,[a,c])=>a.evaluate(u)/c.evaluate(u)],"%":[Or,[Or,Or],(u,[a,c])=>a.evaluate(u)%c.evaluate(u)],ln2:[Or,[],()=>Math.LN2],pi:[Or,[],()=>Math.PI],e:[Or,[],()=>Math.E],"^":[Or,[Or,Or],(u,[a,c])=>Math.pow(a.evaluate(u),c.evaluate(u))],sqrt:[Or,[Or],(u,[a])=>Math.sqrt(a.evaluate(u))],log10:[Or,[Or],(u,[a])=>Math.log(a.evaluate(u))/Math.LN10],ln:[Or,[Or],(u,[a])=>Math.log(a.evaluate(u))],log2:[Or,[Or],(u,[a])=>Math.log2(a.evaluate(u))],sin:[Or,[Or],(u,[a])=>Math.sin(a.evaluate(u))],cos:[Or,[Or],(u,[a])=>Math.cos(a.evaluate(u))],tan:[Or,[Or],(u,[a])=>Math.tan(a.evaluate(u))],asin:[Or,[Or],(u,[a])=>Math.asin(a.evaluate(u))],acos:[Or,[Or],(u,[a])=>Math.acos(a.evaluate(u))],atan:[Or,[Or],(u,[a])=>Math.atan(a.evaluate(u))],min:[Or,cd(Or),(u,a)=>Math.min(...a.map(c=>c.evaluate(u)))],max:[Or,cd(Or),(u,a)=>Math.max(...a.map(c=>c.evaluate(u)))],abs:[Or,[Or],(u,[a])=>Math.abs(a.evaluate(u))],round:[Or,[Or],(u,[a])=>{const c=a.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[Or,[Or],(u,[a])=>Math.floor(a.evaluate(u))],ceil:[Or,[Or],(u,[a])=>Math.ceil(a.evaluate(u))],"filter-==":[ui,[Zn,gi],(u,[a,c])=>u.properties()[a.value]===c.value],"filter-id-==":[ui,[gi],(u,[a])=>u.id()===a.value],"filter-type-==":[ui,[Zn],(u,[a])=>u.geometryType()===a.value],"filter-<":[ui,[Zn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p<g}],"filter-id-<":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c<p}],"filter->":[ui,[Zn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p>g}],"filter-id->":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c>p}],"filter-<=":[ui,[Zn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p<=g}],"filter-id-<=":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c<=p}],"filter->=":[ui,[Zn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p>=g}],"filter-id->=":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c>=p}],"filter-has":[ui,[gi],(u,[a])=>a.value in u.properties()],"filter-has-id":[ui,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[ui,[Wa(Zn)],(u,[a])=>a.value.indexOf(u.geometryType())>=0],"filter-id-in":[ui,[Wa(gi)],(u,[a])=>a.value.indexOf(u.id())>=0],"filter-in-small":[ui,[Zn,Wa(gi)],(u,[a,c])=>c.value.indexOf(u.properties()[a.value])>=0],"filter-in-large":[ui,[Zn,Wa(gi)],(u,[a,c])=>function(p,g,x,b){for(;x<=b;){const C=x+b>>1;if(g[C]===p)return!0;g[C]>p?b=C-1:x=C+1}return!1}(u.properties()[a.value],c.value,0,c.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(u,[a,c])=>a.evaluate(u)&&c.evaluate(u)],[cd(ui),(u,a)=>{for(const c of a)if(!c.evaluate(u))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(u,[a,c])=>a.evaluate(u)||c.evaluate(u)],[cd(ui),(u,a)=>{for(const c of a)if(c.evaluate(u))return!0;return!1}]]},"!":[ui,[ui],(u,[a])=>!a.evaluate(u)],"is-supported-script":[ui,[Zn],(u,[a])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(a.evaluate(u))}],upcase:[Zn,[Zn],(u,[a])=>a.evaluate(u).toUpperCase()],downcase:[Zn,[Zn],(u,[a])=>a.evaluate(u).toLowerCase()],concat:[Zn,cd(gi),(u,a)=>a.map(c=>Cu(c.evaluate(u))).join("")],"resolved-locale":[Zn,[Wg],(u,[a])=>a.evaluate(u).resolvedLocale()],random:[Or,[Or,Or,gi],(u,a)=>{const[c,p,g]=a.map(b=>b.evaluate(u));if(c>p||c===p)return c;let x;if(typeof g=="string")x=function(b){let C=0;if(b.length===0)return C;for(let I=0;I<b.length;I++)C=(C<<5)-C+b.charCodeAt(I),C|=0;return C}(g);else{if(typeof g!="number")throw new Ds(`Invalid seed input: ${g}`);x=g}return c+bA(x)()*(p-c)}]});class $_{constructor(a,c,p,g,x){this.expression=a,this._warningHistory={},this._scope=p,this._options=g,this._iconImageUseTheme=x,this._evaluator=new Ka(p,g,x),this._defaultValue=c?function(b){return b.type==="color"&&(z_(b.default)||Array.isArray(b.default))?new hi(0,0,0,0):b.type==="color"?hi.parse(b.default)||null:b.default===void 0?null:b.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=uy(a),this.isIndoorDependent=D_(a)}evaluateWithoutErrorHandling(a,c,p,g,x,b,C,I){return this._evaluator.globals=a,this._evaluator.feature=c,this._evaluator.featureState=p,this._evaluator.canonical=g||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(a,c,p,g,x,b,C,I,D){this._evaluator||(this._evaluator=new Ka(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=a,this._evaluator.feature=c||null,this._evaluator.featureState=p||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=I||null,this._evaluator.iconImageUseTheme=D||null;try{const U=this.expression.evaluate(this._evaluator);if(U==null||typeof U=="number"&&U!=U)return this._defaultValue;if(this._enumValues&&!(U in this._enumValues))throw new Ds(`Expected value to be one of ${Object.keys(this._enumValues).map(q=>JSON.stringify(q)).join(", ")}, but found ${JSON.stringify(U)} instead.`);return U}catch(U){return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${U.message}`)),this._defaultValue}}}function U_(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in zp}function Ou(u,a,c,p,g){const x=new T_(zp,[],a?function(C){const I={color:kl,string:Zn,number:Or,enum:Zn,boolean:ui,formatted:uf,resolvedImage:Kg};return C.type==="array"?Wa(I[C.value]||gi,C.length):I[C.type]}(a):void 0,void 0,void 0,c,p,g),b=x.parse(u,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return b?yf(new $_(b,a,c,p,g)):th(x.errors)}class dy{constructor(a,c,p,g){this.kind=a,this._styleExpression=c,this.isLightConstant=p,this.isLineProgressConstant=g,this.isStateDependent=a!=="constant"&&!iy(c.expression),this.configDependencies=uy(c.expression),this.isIndoorDependent=D_(c.expression)}evaluateWithoutErrorHandling(a,c,p,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(a,c,p,g,x,b)}evaluate(a,c,p,g,x,b,C){return this._styleExpression.evaluate(a,c,p,g,x,b,void 0,void 0,C)}}class nh{constructor(a,c,p,g,x,b){this.kind=a,this.zoomStops=p,this._styleExpression=c,this.isStateDependent=a!=="camera"&&!iy(c.expression),this.isIndoorDependent=D_(c.expression),this.isLightConstant=x,this.isLineProgressConstant=b,this.configDependencies=uy(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(a,c,p,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(a,c,p,g,x,b)}evaluate(a,c,p,g,x,b){return this._styleExpression.evaluate(a,c,p,g,x,b)}interpolationFactor(a,c,p){return this.interpolationType?Gl.interpolationFactor(this.interpolationType,a,c,p):0}}function h1(u,a,c,p,g){if((u=Ou(u,a,c,p,g)).result==="error")return u;const x=u.value.expression,b=Ip(x);if(!b&&!L_(a))return th([new Ec("","data expressions not supported")]);const C=Rp(x,["zoom","pitch","distance-from-center"]);if(!C&&!u1(a))return th([new Ec("","zoom expressions not supported")]);const I=Rp(x,["measure-light"]);if(!I&&!c1(a))return th([new Ec("","measure-light expression not supported")]);const D=Rp(x,["line-progress"]);if(!D&&!function(H){return l1(H.expression,"line-progress")}(a))return th([new Ec("","line-progress expression not supported")]);const U=a.expression&&a.expression.relaxZoomRestriction,q=q_(x);return q||C||U?q instanceof Ec?th([q]):q instanceof Gl&&!F_(a)?th([new Ec("",'"interpolate" expressions cannot be used with this property')]):yf(q?new nh(b&&D?"camera":"composite",u.value,q.labels,q instanceof Gl?q.interpolation:void 0,I,D):new dy(b&&D?"constant":"source",u.value,I,D)):th([new Ec("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class V_{constructor(a,c){this._parameters=a,this._specification=c,Object.assign(this,B_(this._parameters,this._specification))}static deserialize(a){return new V_(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function q_(u){let a=null;if(u instanceof ly)a=q_(u.result);else if(u instanceof oy){for(const c of u.args)if(a=q_(c),a)break}else(u instanceof sy||u instanceof Gl)&&u.input instanceof Vo&&u.input.name==="zoom"&&(a=u);return a instanceof Ec||u.eachChild(c=>{const p=q_(c);p instanceof Ec?a=p:a&&p&&a!==p&&(a=new Ec("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}var hy,H_,TA=function(){if(H_)return hy;H_=1,hy=a;var u=3;function a(c,p,g){var x=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var b=new Int32Array(this.arrayBuffer);c=b[0],this.d=(p=b[1])+2*(g=b[2]);for(var C=0;C<this.d*this.d;C++){var I=b[u+C],D=b[u+C+1];x.push(I===D?null:b.subarray(I,D))}var U=b[u+x.length+1];this.keys=b.subarray(b[u+x.length],U),this.bboxes=b.subarray(U),this.insert=this._insertReadonly}else{this.d=p+2*g;for(var q=0;q<this.d*this.d;q++)x.push([]);this.keys=[],this.bboxes=[]}this.n=p,this.extent=c,this.padding=g,this.scale=p/c,this.uid=0;var H=g/p*c;this.min=-H,this.max=c+H}return a.prototype.insert=function(c,p,g,x,b){this._forEachCell(p,g,x,b,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(b)},a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},a.prototype._insertCell=function(c,p,g,x,b,C){this.cells[b].push(C)},a.prototype.query=function(c,p,g,x,b){var C=this.min,I=this.max;if(c<=C&&p<=C&&I<=g&&I<=x&&!b)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(c,p,g,x,this._queryCell,D,{},b),D},a.prototype._queryCell=function(c,p,g,x,b,C,I,D){var U=this.cells[b];if(U!==null)for(var q=this.keys,H=this.bboxes,Y=0;Y<U.length;Y++){var J=U[Y];if(I[J]===void 0){var oe=4*J;(D?D(H[oe+0],H[oe+1],H[oe+2],H[oe+3]):c<=H[oe+2]&&p<=H[oe+3]&&g>=H[oe+0]&&x>=H[oe+1])?(I[J]=!0,C.push(q[J])):I[J]=!1}}},a.prototype._forEachCell=function(c,p,g,x,b,C,I,D){for(var U=this._convertToCellCoord(c),q=this._convertToCellCoord(p),H=this._convertToCellCoord(g),Y=this._convertToCellCoord(x),J=U;J<=H;J++)for(var oe=q;oe<=Y;oe++){var ce=this.d*oe+J;if((!D||D(this._convertFromCellCoord(J),this._convertFromCellCoord(oe),this._convertFromCellCoord(J+1),this._convertFromCellCoord(oe+1)))&&b.call(this,c,p,g,x,ce,C,I,D))return}},a.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},a.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,p=u+this.cells.length+1+1,g=0,x=0;x<this.cells.length;x++)g+=this.cells[x].length;var b=new Int32Array(p+g+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var C=p,I=0;I<c.length;I++){var D=c[I];b[u+I]=C,b.set(D,C),C+=D.length}return b[u+c.length]=C,b.set(this.keys,C),b[u+c.length+1]=C+=this.keys.length,b.set(this.bboxes,C),C+=this.bboxes.length,b.buffer},hy}(),vf=Fi(TA);const $p={};function _r(u,a,c={}){Object.defineProperty(u,"_classRegistryKey",{value:a,writable:!1}),$p[a]={klass:u,omit:c.omit||[]}}_r(Object,"Object"),vf.serialize=function(u,a){const c=u.toArrayBuffer();return a&&a.add(c),{buffer:c}},vf.deserialize=function(u){return new vf(u.buffer)},Object.defineProperty(vf,"name",{value:"Grid"}),_r(vf,"Grid"),delete at.prototype.constructor,typeof DOMMatrix<"u"&&_r(DOMMatrix,"DOMMatrix"),_r(hi,"Color"),_r(Error,"Error"),_r(ka,"Formatted"),_r(Yg,"FormattedSection"),_r(lf,"AJAXError"),_r(vl,"ResolvedImage"),_r(V_,"StylePropertyFunction"),_r($_,"StyleExpression",{omit:["_evaluator"]}),_r(ca,"ImageId"),_r(ad,"ImageVariant"),_r(nh,"ZoomDependentExpression"),_r(dy,"ZoomConstantExpression"),_r(Vo,"CompoundExpression",{omit:["_evaluate"]});for(const u in zp)$p[zp[u]._classRegistryKey]||_r(zp[u],`Expression${u}`);function f1(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function ud(u){return self.ImageBitmap&&u instanceof ImageBitmap}function ih(u,a){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(f1(u)||ud(u))return a&&a.add(u),u;if(ArrayBuffer.isView(u))return a&&a.add(u.buffer),u;if(u instanceof ImageData)return a&&a.add(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const p of u)c.push(ih(p,a));return c}if(u instanceof Map){const c={$name:"Map",entries:[]};for(const[p,g]of u.entries())c.entries.push(ih(p),ih(g,a));return c}if(u instanceof Set){const c={$name:"Set"};let p=0;for(const g of u.values())c[++p]=ih(g);return c}if(u instanceof DOMMatrix){const c={$name:"DOMMatrix"},p=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const g of p)c[g]=u[g];return c}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const c=u.constructor,p=c._classRegistryKey;if(!p)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const g=c.serialize?c.serialize(u,a):{};if(!c.serialize){for(const x in u)u.hasOwnProperty(x)&&($p[p].omit.indexOf(x)>=0||(g[x]=ih(u[x],a)));u instanceof Error&&(g.message=u.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(g.$name=p),g}throw new Error("can't serialize object of type "+typeof u)}function sh(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||f1(u)||ud(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(sh);if(typeof u=="object"){const a=u.$name||"Object";if(a==="Map"){const g=u.entries||[],x=new Map;for(let b=0;b<g.length;b+=2)x.set(sh(g[b]),sh(g[b+1]));return x}if(a==="Set"){const g=new Set;for(const x of Object.keys(u))x!=="$name"&&g.add(sh(u[x]));return g}if(a==="DOMMatrix"){let g;return g=u.is2D?[u.a,u.b,u.c,u.d,u.e,u.f]:[u.m11,u.m12,u.m13,u.m14,u.m21,u.m22,u.m23,u.m24,u.m31,u.m32,u.m33,u.m34,u.m41,u.m42,u.m43,u.m44],new DOMMatrix(g)}if(a==="BigInt")return BigInt(u.value);const{klass:c}=$p[a];if(!c)throw new Error(`Can't deserialize unregistered class "${a}".`);if(c.deserialize)return c.deserialize(u);const p=Object.create(c.prototype);for(const g of Object.keys(u))g!=="$name"&&(p[g]=sh(u[g]));return p}throw new Error("can't deserialize object of type "+typeof u)}const Br={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,Osage:u=>u>=66736&&u<=66815,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function p1(u){for(const a of u)if(W_(a.charCodeAt(0)))return!0;return!1}function AA(u){for(const a of u)if(!G_(a.charCodeAt(0)))return!1;return!0}function G_(u){return!(Br.Arabic(u)||Br["Arabic Supplement"](u)||Br["Arabic Extended-A"](u)||Br["Arabic Presentation Forms-A"](u)||Br["Arabic Presentation Forms-B"](u))}function W_(u){return!(u!==746&&u!==747&&(u<4352||!(Br["Bopomofo Extended"](u)||Br.Bopomofo(u)||Br["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Br["CJK Compatibility Ideographs"](u)||Br["CJK Compatibility"](u)||Br["CJK Radicals Supplement"](u)||Br["CJK Strokes"](u)||!(!Br["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Br["CJK Unified Ideographs Extension A"](u)||Br["CJK Unified Ideographs"](u)||Br["Enclosed CJK Letters and Months"](u)||Br["Hangul Compatibility Jamo"](u)||Br["Hangul Jamo Extended-A"](u)||Br["Hangul Jamo Extended-B"](u)||Br["Hangul Jamo"](u)||Br["Hangul Syllables"](u)||Br.Hiragana(u)||Br["Ideographic Description Characters"](u)||Br.Kanbun(u)||Br["Kangxi Radicals"](u)||Br["Katakana Phonetic Extensions"](u)||Br.Katakana(u)&&u!==12540||!(!Br["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Br["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Br["Unified Canadian Aboriginal Syllabics"](u)||Br["Unified Canadian Aboriginal Syllabics Extended"](u)||Br["Vertical Forms"](u)||Br["Yijing Hexagram Symbols"](u)||Br["Yi Syllables"](u)||Br["Yi Radicals"](u))))}function m1(u){return!(W_(u)||function(a){return!!(Br["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Br["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Br["Letterlike Symbols"](a)||Br["Number Forms"](a)||Br["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Br["Control Pictures"](a)&&a!==9251||Br["Optical Character Recognition"](a)||Br["Enclosed Alphanumerics"](a)||Br["Geometric Shapes"](a)||Br["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Br["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Br["CJK Symbols and Punctuation"](a)||Br.Katakana(a)||Br["Private Use Area"](a)||Br["CJK Compatibility Forms"](a)||Br["Small Form Variants"](a)||Br["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(u))}function g1(u){return Br.Arabic(u)||Br["Arabic Supplement"](u)||Br["Arabic Extended-A"](u)||Br["Arabic Presentation Forms-A"](u)||Br["Arabic Presentation Forms-B"](u)}function CA(u){return u>=1424&&u<=2303||Br["Arabic Presentation Forms-A"](u)||Br["Arabic Presentation Forms-B"](u)}function mR(u,a){return!(!a&&CA(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Br.Khmer(u))}function gR(u){for(const a of u)if(CA(a.charCodeAt(0)))return!0;return!1}const Nl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let y1=null,al=Nl.unavailable,ah=null;const jA=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(al=Nl.error),y1&&y1(u)};function v1(){_1.fire(new ql("pluginStateChange",{pluginStatus:al,pluginURL:ah}))}const _1=new id,x1=function(){return al},b1=function(){if(al!==Nl.deferred||!ah)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");al=Nl.loading,v1(),ah&&bp({url:ah},u=>{u?jA(u):(al=Nl.loaded,v1())})},Il={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>al===Nl.loaded||Il.applyArabicShaping!=null,isLoading:()=>al===Nl.loading,setState(u){al=u.pluginStatus,ah=u.pluginURL},isParsing:()=>al===Nl.parsing,isParsed:()=>al===Nl.parsed,getPluginURL:()=>ah};class Ui{constructor(a,c){this.zoom=a,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness,this.worldview=c.worldview,this.activeFloors=c.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(a){return function(c,p){for(const g of c)if(!mR(g.charCodeAt(0),p))return!1;return!0}(a,Il.isLoaded())}}class fy{constructor(a,c,p,g,x){this.property=a,this.value=c,this.expression=function(b,C,I,D,U){if(z_(b))return new V_(b,C);if(U_(b)||Array.isArray(b)&&b.length>0){const q=h1(b,C,I,D,U);if(q.result==="error")throw new Error(q.value.map(H=>`${H.key}: ${H.message}`).join(", "));return q.value}{let q=b;return typeof b=="string"&&C.type==="color"&&(q=hi.parse(b)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>q}}}(c===void 0?a.specification.default:c,a.specification,p,g,x)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,c,p,g){return this.property.possiblyEvaluate(this,a,c,p,g)}}class Up{constructor(a,c,p,g){this.property=a,this.value=new fy(a,void 0,c,p,g)}transitioned(a,c){return new OA(this.property,this.value,c,Object.assign({},a.transition,this.transition),a.now)}untransitioned(){return new OA(this.property,this.value,null,{},0)}}class PA{constructor(a,c,p,g){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._scope=c,this._options=p,this._iconImageUseTheme=g,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Ar(this._values[a].value.value)}setValue(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new Up(this._values[a].property,this._scope,this._options,this._iconImageUseTheme)),this._values[a].value=new fy(this._values[a].property,c===null?void 0:Ar(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].value.isIndoorDependent())}setTransitionOrValue(a,c){c&&(this._options=c);const p=this._properties.properties;if(a)for(const g in a){const x=a[g];if(g.endsWith("-transition")){const b=g.slice(0,-11);p[b]&&this.setTransition(b,x)}else p.hasOwnProperty(g)&&this.setValue(g,x)}}getTransition(a){return Ar(this._values[a].transition)}setTransition(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new Up(this._values[a].property)),this._values[a].transition=Ar(c)||void 0}serialize(){const a={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(a[c]=p);const g=this.getTransition(c);g!==void 0&&(a[`${c}-transition`]=g)}return a}transitioned(a,c){const p=new dd(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].transitioned(a,c._values[g]);return p}untransitioned(){const a=new dd(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].untransitioned();return a}isIndoorDependent(){return this._isIndoorDependent}}class OA{constructor(a,c,p,g,x){const b=g.delay||0,C=g.duration||0;x=x||0,this.property=a,this.value=c,this.begin=x+b,this.end=this.begin+C,a.specification.transition&&(g.delay||g.duration)&&(this.prior=p)}possiblyEvaluate(a,c,p){const g=a.now||0,x=this.value.possiblyEvaluate(a,c,p),b=this.prior;if(b){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return b.possiblyEvaluate(a,c,p);{const C=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(a,c,p),x,Ig(C))}}return x}}class dd{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,c,p){const g=new _f(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(a,c,p);return g}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class w1{constructor(a,c,p,g){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._scope=c,this._options=p,this._iconImageUseTheme=g,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Ar(this._values[a].value)}setValue(a,c){this._values[a]=new fy(this._values[a].property,c===null?void 0:Ar(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].isIndoorDependent())}serialize(){const a={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(a[c]=p)}return a}possiblyEvaluate(a,c,p,g){const x=new _f(this._properties);for(const b of Object.keys(this._values))x._values[b]=this._values[b].possiblyEvaluate(a,c,p,g);return x}isIndoorDependent(){return this._isIndoorDependent}}class Pc{constructor(a,c,p,g){this.property=a,this.value=c,this.parameters=p,this.iconImageUseTheme=g}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,c,p,g){return this.property.evaluate(this.value,this.parameters,a,c,p,g,this.iconImageUseTheme)}}class _f{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Zt{constructor(a){this.specification=a}possiblyEvaluate(a,c){return a.expression.evaluate(c)}interpolate(a,c,p){const g=sd[this.specification.type];return g?g(a,c,p):a}}class ur{constructor(a,c){this.specification=a,this.overrides=c}possiblyEvaluate(a,c,p,g,x){return a.expression.kind==="constant"||a.expression.kind==="camera"?new Pc(this,{kind:"constant",value:a.expression.evaluate(c,null,{},p,g,void 0,x)},c):new Pc(this,a.expression,c,x)}interpolate(a,c,p){if(a.value.kind!=="constant"||c.value.kind!=="constant")return a;if(a.value.value===void 0||c.value.value===void 0)return new Pc(this,{kind:"constant",value:void 0},a.parameters);const g=sd[this.specification.type];return g?new Pc(this,{kind:"constant",value:g(a.value.value,c.value.value,p)},a.parameters):a}evaluate(a,c,p,g,x,b,C){return a.kind==="constant"?a.value:a.evaluate(c,p,g,x,b,void 0,C)}}class Vp{constructor(a){this.specification=a}possiblyEvaluate(a,c,p,g){return!!a.expression.evaluate(c,null,{},p,g)}interpolate(){return!1}}class bs{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new Ui(0,{});for(const p in a){const g=a[p];g.specification.overridable&&this.overridableProperties.push(p);const x=this.defaultPropertyValues[p]=new fy(g,void 0),b=this.defaultTransitionablePropertyValues[p]=new Up(g);this.defaultTransitioningPropertyValues[p]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[p]=x.possiblyEvaluate(c)}}}_r(ur,"DataDrivenProperty"),_r(Zt,"DataConstantProperty"),_r(Vp,"ColorRampProperty");var ht=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function S1(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function qp(u){if(Array.isArray(u))return u.map(qp);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const a={};for(const c in u)a[c]=qp(u[c]);return a}return S1(u)}function Hp(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const a of u.slice(1))if(!Hp(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function K_(u,a="",c=null,p="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hp(u)||(u=Wl(u));const g=u;let x=!0;try{x=function(U){if(!Wp(U))return U;let q=qp(U);return Gp(q),q=Z_(q),q}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}let b=null,C=null;if(p!=="background"&&p!=="sky"&&p!=="slot"){C=ht[`filter_${p}`];const U=Ou(x,C,a,c);if(U.result==="error")throw new Error(U.value.map(q=>`${q.key}: ${q.message}`).join(", "));b=(q,H,Y)=>U.value.evaluate(q,H,{},Y)}let I=null,D=null;if(x!==g){const U=Ou(g,C,a,c);if(U.result==="error")throw new Error(U.value.map(q=>`${q.key}: ${q.message}`).join(", "));I=(q,H,Y,J,oe)=>U.value.evaluate(q,H,{},Y,void 0,void 0,J,oe),D=!Ip(U.value.expression)}return{filter:b,dynamicFilter:I||void 0,needGeometry:NA(x),needFeature:!!D}}function Z_(u){if(!Array.isArray(u))return u;const a=function(c){if(yR.has(c[0])){for(let p=1;p<c.length;p++)if(Wp(c[p]))return!0}return c}(u);return a===!0?a:a.map(c=>Z_(c))}function Gp(u){let a=!1;const c=[];if(u[0]==="case"){for(let p=1;p<u.length-1;p+=2)a=a||Wp(u[p]),c.push(u[p+1]);c.push(u[u.length-1])}else if(u[0]==="match"){a=a||Wp(u[1]);for(let p=2;p<u.length-1;p+=2)c.push(u[p+1]);c.push(u[u.length-1])}else if(u[0]==="step"){a=a||Wp(u[1]);for(let p=1;p<u.length-1;p+=2)c.push(u[p+1])}a&&(u.length=0,u.push("any",...c));for(let p=1;p<u.length;p++)Gp(u[p])}function Wp(u){if(!Array.isArray(u))return!1;if((a=u[0])==="pitch"||a==="distance-from-center")return!0;var a;for(let c=1;c<u.length;c++)if(Wp(u[c]))return!0;return!1}const yR=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function kA(u,a){return u<a?-1:u>a?1:0}function NA(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let a=1;a<u.length;a++)if(NA(u[a]))return!0;return!1}function Wl(u){if(!u)return!0;const a=u[0];return u.length<=1?a!=="any":a==="=="?E1(u[1],u[2],"=="):a==="!="?X_(E1(u[1],u[2],"==")):a==="<"||a===">"||a==="<="||a===">="?E1(u[1],u[2],a):a==="any"?(c=u.slice(1),["any"].concat(c.map(Wl))):a==="all"?["all"].concat(u.slice(1).map(Wl)):a==="none"?["all"].concat(u.slice(1).map(Wl).map(X_)):a==="in"?T1(u[1],u.slice(2)):a==="!in"?X_(T1(u[1],u.slice(2))):a==="has"?IA(u[1]):a!=="!has"||X_(IA(u[1]));var c}function E1(u,a,c){switch(u){case"$type":return[`filter-type-${c}`,a];case"$id":return[`filter-id-${c}`,a];default:return[`filter-${c}`,u,a]}}function T1(u,a){if(a.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(c=>typeof c!=typeof a[0])?["filter-in-large",u,["literal",a.sort(kA)]]:["filter-in-small",u,["literal",a]]}}function IA(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function X_(u){return["!",u]}const py="";function xf(u,a){return a?`${u}${py}${a}`:u}let RA;const MA=()=>RA||(RA=new bs({"icon-size":new ur(ht.layout_symbol["icon-size"]),"icon-image":new ur(ht.layout_symbol["icon-image"]),"icon-rotate":new ur(ht.layout_symbol["icon-rotate"]),"icon-offset":new ur(ht.layout_symbol["icon-offset"])}));class vR{constructor(a,c,p,g,x,b){this.cachedIconPrimary=null;const C=Ou(a,ht.appearance.condition);if(C.result==="success"&&(this.condition=C.value),this.name=c,p){this.properties=new _f(MA()),this.unevaluatedLayout=new w1(MA(),g,x,b);for(const I in p)this.unevaluatedLayout.setValue(I,p[I])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(a){this.cachedIconPrimary=a}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(a){return!(this.condition||!a.isHidden||this.name!=="hidden")||this.condition.evaluate(a.globals,a.feature,a.featureState,a.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(a){return this.properties.get(a)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(a,c,p){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(a,void 0,c,p))}serialize(){const a={};return a.condition=this.condition.expression.serialize(),this.name&&(a.name=this.name),this.unevaluatedLayout&&(a.properties=this.unevaluatedLayout.serialize()),a}}const DA="-transition",_R=new Set(["fill","line","background","hillshade","raster"]);class qo extends id{constructor(a,c,p,g,x,b){if(super(),this.id=a.id,this.fqid=xf(this.id,p),this.type=a.type,this.scope=p,this.lut=g,this.options=x,this.iconImageUseTheme=b,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},a.type!=="custom"){if(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type&&a.type!=="background"&&a.type!=="sky"&&a.type!=="slot"){this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter;const C=Ou(this.filter,ht[`filter_${a.type}`]);C.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...C.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||C.value.isIndoorDependent)}if(a.slot&&(this.slot=a.slot),a.appearances&&this.setAppearances(a.appearances),c.layout&&(this._unevaluatedLayout=new w1(c.layout,this.scope,x,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),c.paint){this._transitionablePaint=new PA(c.paint,this.scope,x);for(const C in a.paint)this.setPaintProperty(C,a.paint[C]);for(const C in a.layout)this.setLayoutProperty(C,a.layout[C]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _f(c.paint)}}}onAdd(a){}onRemove(a){}isDraped(a){return!this.is3D(!0)&&_R.has(this.type)}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,c){if(this.type==="custom"&&a==="visibility")return void(this.visibility=c);const p=this._unevaluatedLayout;p._properties.properties[a]&&(p.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...p.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||p.isIndoorDependent(),a==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(a){this.appearances=[],a.forEach(c=>{this.appearances.push(new vR(c.condition,c.name,c.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(a){return a.endsWith(DA)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}isPaintProperty(a){return!!this._transitionablePaint._properties.properties[a]}setPaintProperty(a,c){const p=this._transitionablePaint,g=p._properties.properties;if(a.endsWith(DA)){const q=a.slice(0,-11);return g[q]&&p.setTransition(q,c||void 0),!1}if(!g[a])return!1;const x=p._values[a],b=x.value.isDataDriven(),C=x.value;p.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...p.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||p.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(a);const I=p._values[a].value,D=I.isDataDriven(),U=a.endsWith("pattern")||a==="line-dasharray";return D||b||U||this._handleOverridablePaintPropertyUpdate(a,C,I)}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getDefaultProgramParams(a,c,p){return null}_handleOverridablePaintPropertyUpdate(a,c,p){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,c,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,c)}serialize(){const a={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(a.appearances=this.appearances.map(c=>c.serialize())),qt(a,(c,p)=>!(c===void 0||p==="layout"&&!Object.keys(c).length||p==="paint"&&!Object.keys(c).length))}is3D(a){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const a in this.paint._values){const c=this.paint.get(a);if(c instanceof Pc&&L_(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}for(const a of this.appearances)if(!iy(a.condition.expression))return!0;return!1}compileFilter(a){this._filterCompiled||(this._featureFilter=K_(this.filter,this.scope,a),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(a){this._stats&&(a.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(a,c,p){return{}}queryRadius(a){}queryIntersectsFeature(a,c,p,g,x,b,C,I,D){}}const xR={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class my{constructor(a,c){this._structArray=a,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qi{constructor(){this.capacity=-1,this.resize(0)}static serialize(a,c){return a._trim(),c&&c.add(a.arrayBuffer),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const c=Object.create(this.prototype);return c.arrayBuffer=a.arrayBuffer,c.length=a.length,c.capacity=a.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...a){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...a){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Cn(u,a=1){let c=0,p=0;return{members:u.map(g=>{const x=xR[g.type].BYTES_PER_ELEMENT,b=c=A1(c,Math.max(a,x)),C=g.components||1;return p=Math.max(p,x),c+=x*C,{name:g.name,type:g.type,components:C,offset:b}}),size:A1(c,Math.max(p,a)),alignment:a}}function A1(u,a){return Math.ceil(u/a)*a}class _l extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c){const p=this.length;return this.resize(p+1),this.emplace(p,a,c)}emplace(a,c,p){const g=2*a;return this.int16[g+0]=c,this.int16[g+1]=p,a}}_l.prototype.bytesPerElement=4,_r(_l,"StructArrayLayout2i4");class bf extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=3*a;return this.int16[x+0]=c,this.int16[x+1]=p,this.int16[x+2]=g,a}}bf.prototype.bytesPerElement=6,_r(bf,"StructArrayLayout3i6");class Kp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const b=4*a;return this.int16[b+0]=c,this.int16[b+1]=p,this.int16[b+2]=g,this.int16[b+3]=x,a}}Kp.prototype.bytesPerElement=8,_r(Kp,"StructArrayLayout4i8");class hd extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.float32[1*a+0]=c,a}}hd.prototype.bytesPerElement=4,_r(hd,"StructArrayLayout1f4");class C1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=4*a,b=2*a;return this.int16[x+0]=c,this.int16[x+1]=p,this.float32[b+1]=g,a}}C1.prototype.bytesPerElement=8,_r(C1,"StructArrayLayout2i1f8");class j1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=4*a;return this.int16[x+0]=c,this.int16[x+1]=p,this.int16[x+2]=g,a}}j1.prototype.bytesPerElement=8,_r(j1,"StructArrayLayout3i8");class Y_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,p,g,x)}emplace(a,c,p,g,x,b){const C=5*a;return this.int16[C+0]=c,this.int16[C+1]=p,this.int16[C+2]=g,this.int16[C+3]=x,this.int16[C+4]=b,a}}Y_.prototype.bytesPerElement=10,_r(Y_,"StructArrayLayout5i10");class J_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,p,g,x,b,C)}emplace(a,c,p,g,x,b,C,I){const D=6*a,U=12*a,q=3*a;return this.int16[D+0]=c,this.int16[D+1]=p,this.uint8[U+4]=g,this.uint8[U+5]=x,this.uint8[U+6]=b,this.uint8[U+7]=C,this.float32[q+2]=I,a}}J_.prototype.bytesPerElement=12,_r(J_,"StructArrayLayout2i4ub1f12");class Kl extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=3*a;return this.float32[x+0]=c,this.float32[x+1]=p,this.float32[x+2]=g,a}}Kl.prototype.bytesPerElement=12,_r(Kl,"StructArrayLayout3f12");class oh extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,p,g,x)}emplace(a,c,p,g,x,b){const C=6*a,I=3*a;return this.uint16[C+0]=c,this.uint16[C+1]=p,this.uint16[C+2]=g,this.uint16[C+3]=x,this.float32[I+2]=b,a}}oh.prototype.bytesPerElement=12,_r(oh,"StructArrayLayout4ui1f12");class wf extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const b=4*a;return this.uint16[b+0]=c,this.uint16[b+1]=p,this.uint16[b+2]=g,this.uint16[b+3]=x,a}}wf.prototype.bytesPerElement=8,_r(wf,"StructArrayLayout4ui8");class Q_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,b)}emplace(a,c,p,g,x,b,C){const I=6*a;return this.int16[I+0]=c,this.int16[I+1]=p,this.int16[I+2]=g,this.int16[I+3]=x,this.int16[I+4]=b,this.int16[I+5]=C,a}}Q_.prototype.bytesPerElement=12,_r(Q_,"StructArrayLayout6i12");class ex extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C,I,D,U,q,H){const Y=this.length;return this.resize(Y+1),this.emplace(Y,a,c,p,g,x,b,C,I,D,U,q,H)}emplace(a,c,p,g,x,b,C,I,D,U,q,H,Y){const J=12*a;return this.int16[J+0]=c,this.int16[J+1]=p,this.int16[J+2]=g,this.int16[J+3]=x,this.uint16[J+4]=b,this.uint16[J+5]=C,this.uint16[J+6]=I,this.uint16[J+7]=D,this.int16[J+8]=U,this.int16[J+9]=q,this.int16[J+10]=H,this.int16[J+11]=Y,a}}ex.prototype.bytesPerElement=24,_r(ex,"StructArrayLayout4i4ui4i24");class Zp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,b)}emplace(a,c,p,g,x,b,C){const I=10*a,D=5*a;return this.int16[I+0]=c,this.int16[I+1]=p,this.int16[I+2]=g,this.float32[D+2]=x,this.float32[D+3]=b,this.float32[D+4]=C,a}}Zp.prototype.bytesPerElement=20,_r(Zp,"StructArrayLayout3i3f20");class lh extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const b=4*a;return this.float32[b+0]=c,this.float32[b+1]=p,this.float32[b+2]=g,this.float32[b+3]=x,a}}lh.prototype.bytesPerElement=16,_r(lh,"StructArrayLayout4f16");class P1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint32[1*a+0]=c,a}}P1.prototype.bytesPerElement=4,_r(P1,"StructArrayLayout1ul4");class Oc extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c){const p=this.length;return this.resize(p+1),this.emplace(p,a,c)}emplace(a,c,p){const g=2*a;return this.uint16[g+0]=c,this.uint16[g+1]=p,a}}Oc.prototype.bytesPerElement=4,_r(Oc,"StructArrayLayout2ui4");class O1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C,I,D,U,q,H,Y){const J=this.length;return this.resize(J+1),this.emplace(J,a,c,p,g,x,b,C,I,D,U,q,H,Y)}emplace(a,c,p,g,x,b,C,I,D,U,q,H,Y,J){const oe=20*a,ce=10*a;return this.int16[oe+0]=c,this.int16[oe+1]=p,this.int16[oe+2]=g,this.int16[oe+3]=x,this.int16[oe+4]=b,this.float32[ce+3]=C,this.float32[ce+4]=I,this.float32[ce+5]=D,this.float32[ce+6]=U,this.int16[oe+14]=q,this.uint32[ce+8]=H,this.uint16[oe+18]=Y,this.uint16[oe+19]=J,a}}O1.prototype.bytesPerElement=40,_r(O1,"StructArrayLayout5i4f1i1ul2ui40");class tx extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,p,g,x,b,C)}emplace(a,c,p,g,x,b,C,I){const D=8*a;return this.int16[D+0]=c,this.int16[D+1]=p,this.int16[D+2]=g,this.int16[D+4]=x,this.int16[D+5]=b,this.int16[D+6]=C,this.int16[D+7]=I,a}}tx.prototype.bytesPerElement=16,_r(tx,"StructArrayLayout3i2i2i16");class Xp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,p,g,x)}emplace(a,c,p,g,x,b){const C=4*a,I=8*a;return this.float32[C+0]=c,this.float32[C+1]=p,this.float32[C+2]=g,this.int16[I+6]=x,this.int16[I+7]=b,a}}Xp.prototype.bytesPerElement=16,_r(Xp,"StructArrayLayout2f1f2i16");class Yp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,b)}emplace(a,c,p,g,x,b,C){const I=20*a,D=5*a;return this.uint8[I+0]=c,this.uint8[I+1]=p,this.float32[D+1]=g,this.float32[D+2]=x,this.float32[D+3]=b,this.float32[D+4]=C,a}}Yp.prototype.bytesPerElement=20,_r(Yp,"StructArrayLayout2ub4f20");class is extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=3*a;return this.uint16[x+0]=c,this.uint16[x+1]=p,this.uint16[x+2]=g,a}}is.prototype.bytesPerElement=6,_r(is,"StructArrayLayout3ui6");class Jp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we,Te,Pe,He){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we,Te,Pe,He)}emplace(a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we,Te,Pe,He,Fe){const Ye=30*a,tt=15*a,it=60*a;return this.int16[Ye+0]=c,this.int16[Ye+1]=p,this.int16[Ye+2]=g,this.float32[tt+2]=x,this.float32[tt+3]=b,this.uint16[Ye+8]=C,this.uint16[Ye+9]=I,this.uint32[tt+5]=D,this.uint32[tt+6]=U,this.uint32[tt+7]=q,this.uint16[Ye+16]=H,this.uint16[Ye+17]=Y,this.uint16[Ye+18]=J,this.float32[tt+10]=oe,this.float32[tt+11]=ce,this.uint8[it+48]=he,this.uint8[it+49]=we,this.uint8[it+50]=Te,this.uint32[tt+13]=Pe,this.int16[Ye+28]=He,this.uint8[it+58]=Fe,a}}Jp.prototype.bytesPerElement=60,_r(Jp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class k1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we,Te,Pe,He,Fe,Ye,tt,it,Tt,ft,At,Rt,Bt,er,Wt,Lt){const Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we,Te,Pe,He,Fe,Ye,tt,it,Tt,ft,At,Rt,Bt,er,Wt,Lt)}emplace(a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we,Te,Pe,He,Fe,Ye,tt,it,Tt,ft,At,Rt,Bt,er,Wt,Lt,Gt){const wt=20*a,xt=40*a,Vt=80*a;return this.float32[wt+0]=c,this.float32[wt+1]=p,this.int16[xt+4]=g,this.int16[xt+5]=x,this.int16[xt+6]=b,this.int16[xt+7]=C,this.int16[xt+8]=I,this.int16[xt+9]=D,this.int16[xt+10]=U,this.int16[xt+11]=q,this.int16[xt+12]=H,this.uint16[xt+13]=Y,this.uint16[xt+14]=J,this.uint16[xt+15]=oe,this.uint16[xt+16]=ce,this.uint16[xt+17]=he,this.uint16[xt+18]=we,this.uint16[xt+19]=Te,this.uint16[xt+20]=Pe,this.uint16[xt+21]=He,this.uint16[xt+22]=Fe,this.uint16[xt+23]=Ye,this.uint16[xt+24]=tt,this.uint16[xt+25]=it,this.uint16[xt+26]=Tt,this.uint16[xt+27]=ft,this.uint32[wt+14]=At,this.float32[wt+15]=Rt,this.float32[wt+16]=Bt,this.float32[wt+17]=er,this.float32[wt+18]=Wt,this.uint8[Vt+76]=Lt,this.uint16[xt+39]=Gt,a}}k1.prototype.bytesPerElement=80,_r(k1,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class N1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,b)}emplace(a,c,p,g,x,b,C){const I=6*a;return this.float32[I+0]=c,this.float32[I+1]=p,this.float32[I+2]=g,this.float32[I+3]=x,this.float32[I+4]=b,this.float32[I+5]=C,a}}N1.prototype.bytesPerElement=24,_r(N1,"StructArrayLayout6f24");class Sf extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,p,g,x)}emplace(a,c,p,g,x,b){const C=5*a;return this.float32[C+0]=c,this.float32[C+1]=p,this.float32[C+2]=g,this.float32[C+3]=x,this.float32[C+4]=b,a}}Sf.prototype.bytesPerElement=20,_r(Sf,"StructArrayLayout5f20");class I1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,p,g,x,b,C)}emplace(a,c,p,g,x,b,C,I){const D=7*a;return this.float32[D+0]=c,this.float32[D+1]=p,this.float32[D+2]=g,this.float32[D+3]=x,this.float32[D+4]=b,this.float32[D+5]=C,this.float32[D+6]=I,a}}I1.prototype.bytesPerElement=28,_r(I1,"StructArrayLayout7f28");class gy extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C,I,D,U,q){const H=this.length;return this.resize(H+1),this.emplace(H,a,c,p,g,x,b,C,I,D,U,q)}emplace(a,c,p,g,x,b,C,I,D,U,q,H){const Y=11*a;return this.float32[Y+0]=c,this.float32[Y+1]=p,this.float32[Y+2]=g,this.float32[Y+3]=x,this.float32[Y+4]=b,this.float32[Y+5]=C,this.float32[Y+6]=I,this.float32[Y+7]=D,this.float32[Y+8]=U,this.float32[Y+9]=q,this.float32[Y+10]=H,a}}gy.prototype.bytesPerElement=44,_r(gy,"StructArrayLayout11f44");class R1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C,I,D){const U=this.length;return this.resize(U+1),this.emplace(U,a,c,p,g,x,b,C,I,D)}emplace(a,c,p,g,x,b,C,I,D,U){const q=9*a;return this.float32[q+0]=c,this.float32[q+1]=p,this.float32[q+2]=g,this.float32[q+3]=x,this.float32[q+4]=b,this.float32[q+5]=C,this.float32[q+6]=I,this.float32[q+7]=D,this.float32[q+8]=U,a}}R1.prototype.bytesPerElement=36,_r(R1,"StructArrayLayout9f36");class ch extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c){const p=this.length;return this.resize(p+1),this.emplace(p,a,c)}emplace(a,c,p){const g=2*a;return this.float32[g+0]=c,this.float32[g+1]=p,a}}ch.prototype.bytesPerElement=8,_r(ch,"StructArrayLayout2f8");class M1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const b=6*a;return this.uint32[3*a+0]=c,this.uint16[b+2]=p,this.uint16[b+3]=g,this.uint16[b+4]=x,a}}M1.prototype.bytesPerElement=12,_r(M1,"StructArrayLayout1ul3ui12");class rx extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint16[1*a+0]=c,a}}rx.prototype.bytesPerElement=2,_r(rx,"StructArrayLayout1ui2");class nx extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce){const he=this.length;return this.resize(he+1),this.emplace(he,a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce)}emplace(a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he){const we=16*a;return this.float32[we+0]=c,this.float32[we+1]=p,this.float32[we+2]=g,this.float32[we+3]=x,this.float32[we+4]=b,this.float32[we+5]=C,this.float32[we+6]=I,this.float32[we+7]=D,this.float32[we+8]=U,this.float32[we+9]=q,this.float32[we+10]=H,this.float32[we+11]=Y,this.float32[we+12]=J,this.float32[we+13]=oe,this.float32[we+14]=ce,this.float32[we+15]=he,a}}nx.prototype.bytesPerElement=64,_r(nx,"StructArrayLayout16f64");class Qp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,b,C){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,p,g,x,b,C)}emplace(a,c,p,g,x,b,C,I){const D=10*a,U=5*a;return this.uint16[D+0]=c,this.uint16[D+1]=p,this.uint16[D+2]=g,this.uint16[D+3]=x,this.float32[U+2]=b,this.float32[U+3]=C,this.float32[U+4]=I,a}}Qp.prototype.bytesPerElement=20,_r(Qp,"StructArrayLayout4ui3f20");class D1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.int16[1*a+0]=c,a}}D1.prototype.bytesPerElement=2,_r(D1,"StructArrayLayout1i2");class ix extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint8[1*a+0]=c,a}}ix.prototype.bytesPerElement=1,_r(ix,"StructArrayLayout1ub1");class L1 extends my{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}L1.prototype.size=40;class LA extends O1{get(a){return new L1(this,a)}}_r(LA,"CollisionBoxArray");class sx extends my{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}sx.prototype.size=60;class yy extends Jp{get(a){return new sx(this,a)}}_r(yy,"PlacedSymbolArray");class F1 extends my{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(a){this._structArray.uint32[this._pos4+14]=a}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(a){this._structArray.float32[this._pos4+18]=a}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}F1.prototype.size=80;class FA extends k1{get(a){return new F1(this,a)}}_r(FA,"SymbolInstanceArray");class z1 extends hd{getoffsetX(a){return this.float32[1*a+0]}}_r(z1,"GlyphOffsetArray");class zA extends _l{getx(a){return this.int16[2*a+0]}gety(a){return this.int16[2*a+1]}}_r(zA,"SymbolLineVertexArray");class ax extends my{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ax.prototype.size=12;class BA extends M1{get(a){return new ax(this,a)}}_r(BA,"FeatureIndexArray");class $A extends Oc{geta_centroid_pos0(a){return this.uint16[2*a+0]}geta_centroid_pos1(a){return this.uint16[2*a+1]}}_r($A,"FillExtrusionCentroidArray");class UA extends my{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}UA.prototype.size=6;class VA extends bf{get(a){return new UA(this,a)}}_r(VA,"FillExtrusionWallArray");const qA=Cn([{name:"a_pos",components:2,type:"Int16"}],4),bR=Cn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),wR=Cn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ds{constructor(a=[]){this.segments=a}_prepareSegment(a,c,p,g){let x=this.segments[this.segments.length-1];return a>ds.MAX_VERTEX_ARRAY_LENGTH&&zr(`Max vertices per segment is ${ds.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!x||x.vertexLength+a>ds.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g)&&(x={vertexOffset:c,primitiveOffset:p,vertexLength:0,primitiveLength:0},g!==void 0&&(x.sortKey=g),this.segments.push(x)),x}prepareSegment(a,c,p,g){return this._prepareSegment(a,c.length,p.length,g)}get(){return this.segments}destroy(){for(const a of this.segments)for(const c in a.vaos)a.vaos[c].destroy()}static simpleSegment(a,c,p,g){return new ds([{vertexOffset:a,primitiveOffset:c,vertexLength:p,primitiveLength:g,vaos:{},sortKey:0}])}}function HA(u,a){return 256*(u=ve(Math.floor(u),0,255))+ve(Math.floor(a),0,255)}ds.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_r(ds,"SegmentVector");const SR=Cn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ER=Cn([{name:"a_pattern_b",components:4,type:"Uint16"}]),TR=Cn([{name:"a_dash",components:4,type:"Uint16"}]);class vy{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(a,c,p,g){this.ids.push(_y(a)),this.positions.push(c,p,g)}eachPosition(a,c){const p=_y(a);let g=0,x=this.ids.length-1;for(;g<x;){const b=g+x>>1;this.ids[b]>=p?x=b:g=b+1}for(;this.ids[g]===p;)c(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(a,c){const p=new Float64Array(a.ids),g=new Uint32Array(a.positions);return B1(p,g,0,p.length-1),c&&(c.add(p.buffer),c.add(g.buffer)),{ids:p,positions:g}}static deserialize(a){const c=new vy;let p;c.ids=a.ids,c.positions=a.positions;for(const g of c.ids)g!==p&&c.uniqueIds.push(g),p=g;return c.indexed=!0,c}}function _y(u){const a=+u;return Number.isSafeInteger(a)?a:Vg(String(u))}function B1(u,a,c,p){for(;c<p;){const g=u[c+p>>1];let x=c-1,b=p+1;for(;;){do x++;while(u[x]<g);do b--;while(u[b]>g);if(x>=b)break;ox(u,x,b),ox(a,3*x,3*b),ox(a,3*x+1,3*b+1),ox(a,3*x+2,3*b+2)}b-c<p-b?(B1(u,a,c,b),c=b+1):(B1(u,a,b+1,p),p=b)}}function ox(u,a,c){const p=u[a];u[a]=u[c],u[c]=p}_r(vy,"FeaturePositionMap");class kc{constructor(a){this.gl=a.gl,this.initialized=!1}fetchUniformLocation(a,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(a,c),this.initialized=!0),!!this.location}set(a,c,p){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class lx extends kc{constructor(a){super(a),this.current=0}set(a,c,p){this.fetchUniformLocation(a,c)&&this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}}class $s extends kc{constructor(a){super(a),this.current=0}set(a,c,p){this.fetchUniformLocation(a,c)&&this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))}}class ku extends kc{constructor(a){super(a),this.current=[0,0]}set(a,c,p){this.fetchUniformLocation(a,c)&&(p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1])))}}class em extends kc{constructor(a){super(a),this.current=[0,0,0]}set(a,c,p){this.fetchUniformLocation(a,c)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2])))}}class xy extends kc{constructor(a){super(a),this.current=[0,0,0,0]}set(a,c,p){this.fetchUniformLocation(a,c)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3])))}}class $1 extends kc{constructor(a){super(a),this.current=hi.transparent.toPremultipliedRenderColor(null)}set(a,c,p){this.fetchUniformLocation(a,c)&&(p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a)))}}const GA=new Float32Array(16);class by extends kc{constructor(a){super(a),this.current=GA}set(a,c,p){if(this.fetchUniformLocation(a,c)){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let g=1;g<16;g++)if(p[g]!==this.current[g]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}}}const AR=new Float32Array(9),WA=new Float32Array(4);class U1 extends kc{constructor(a){super(a),this.current=WA}set(a,c,p){if(this.fetchUniformLocation(a,c)){for(let g=0;g<4;g++)if(p[g]!==this.current[g]){this.current=p,this.gl.uniformMatrix2fv(this.location,!1,p);break}}}}function V1(u){return[HA(255*u.r,255*u.g),HA(255*u.b,255*u.a)]}function cx(u,a,c,p,g,x,b,C){return!!u&&(u.kind==="composite"||u.kind==="source"?u.evaluate(new Ui(0,{brightness:x,worldview:C}),a,c,g,p,b)==="none":u.value==="none")}class ux{constructor(a,c,p,g){this.value=a,this.uniformNames=c.map(x=>`u_${x}`),this.type=p,this.context=g}setUniform(a,c,p,g,x){const b=g.constantOr(this.value);c.set(a,x,b instanceof hi?b.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):b)}getBinding(a,c){return this.type==="color"?new $1(a):new $s(a)}}class wy{constructor(a,c){this.uniformNames=c.map(p=>`u_${p}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(a,c){this.pixelRatio=a.pixelRatio||1,this.pattern=a.tl.concat(a.br),this.patternTransition=c?c.tl.concat(c.br):this.pattern}setUniform(a,c,p,g,x){let b=null;x!=="u_pattern"&&x!=="u_dash"||(b=this.pattern),x==="u_pattern_b"&&(b=this.patternTransition),x==="u_pixel_ratio"&&(b=this.pixelRatio),b&&c.set(a,x,b)}getBinding(a,c){return c==="u_pattern"||c==="u_pattern_b"||c==="u_dash"?new xy(a):new $s(a)}}class fd{constructor(a,c,p,g){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=c.map(x=>({name:`a_${x}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(a,c,p,g,x,b,C,I){const D=this.paintVertexArray.length,U=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ui(0,{brightness:b,worldview:I}),c,{},x,g,C):this.expression.kind==="constant"&&this.expression.value,q=cx(this.lutExpression,c,{},g,x,b,C,I);this.paintVertexArray.resize(a),this._setPaintValue(D,a,U,q?null:this.context.lut)}updatePaintArray(a,c,p,g,x,b,C,I){const D=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:C,worldview:I},p,g,void 0,x):this.expression.kind==="constant"&&this.expression.value,U=cx(this.lutExpression,p,g,x,void 0,C,void 0,I);this._setPaintValue(a,c,D,U?null:this.context.lut)}_setPaintValue(a,c,p,g){if(this.type==="color"){const x=V1(p.toPremultipliedRenderColor(g));for(let b=a;b<c;b++)this.paintVertexArray.emplace(b,x[0],x[1])}else{for(let x=a;x<c;x++)this.paintVertexArray.emplace(x,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eu{constructor(a,c,p,g,x,b){this.expression=a,this.uniformNames=c.map(C=>`u_${C}_t`),this.type=p,this.useIntegerZoom=g,this.context=x,this.maxValue=0,this.paintVertexAttributes=c.map(C=>({name:`a_${C}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,c,p,g,x,b,C,I){const D=this.expression.evaluate(new Ui(this.context.zoom,{brightness:b,worldview:I}),c,{},x,g,C),U=this.expression.evaluate(new Ui(this.context.zoom+1,{brightness:b,worldview:I}),c,{},x,g,C),q=cx(this.lutExpression,c,{},g,x,b,C,I),H=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(H,a,D,U,q?null:this.context.lut)}updatePaintArray(a,c,p,g,x,b,C,I){const D=this.expression.evaluate({zoom:this.context.zoom,brightness:C,worldview:I},p,g,void 0,x),U=this.expression.evaluate({zoom:this.context.zoom+1,brightness:C,worldview:I},p,g,void 0,x),q=cx(this.lutExpression,p,g,x,void 0,C,void 0,I);this._setPaintValue(a,c,D,U,q?null:this.context.lut)}_setPaintValue(a,c,p,g,x){if(this.type==="color"){const b=V1(p.toPremultipliedRenderColor(x)),C=V1(p.toPremultipliedRenderColor(x));for(let I=a;I<c;I++)this.paintVertexArray.emplace(I,b[0],b[1],C[0],C[1])}else{for(let b=a;b<c;b++)this.paintVertexArray.emplace(b,p,g);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(g))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,c,p,g,x){const b=this.useIntegerZoom?Math.floor(p.zoom):p.zoom,C=ve(this.expression.interpolationFactor(b,this.context.zoom,this.context.zoom+1),0,1);c.set(a,x,C)}getBinding(a,c){return new $s(a)}}class So{constructor(a,c,p,g,x){this.expression=a,this.layerId=x,this.paintVertexAttributes=(p==="array"?TR:SR).members;for(let b=0;b<c.length;++b);this.paintVertexArray=new g,this.paintTransitionVertexArray=new wf}populatePaintArray(a,c,p,g){const x=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValues(x,a,c.patterns&&c.patterns[this.layerId],p)}updatePaintArray(a,c,p,g,x,b,C){this._setPaintValues(a,c,p.patterns&&p.patterns[this.layerId],b)}_setPaintValues(a,c,p,g){if(!g||!p)return;const x=g[p[0]],b=g[p[1]];if(x){if(x){const{tl:C,br:I,pixelRatio:D}=x;for(let U=a;U<c;U++)this.paintVertexArray.emplace(U,C[0],C[1],I[0],I[1],D)}if(b){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:C,br:I}=b;for(let D=a;D<c;D++)this.paintTransitionVertexArray.emplace(D,C[0],C[1],I[0],I[1])}}}upload(a){const c=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,c)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=a.createVertexBuffer(this.paintTransitionVertexArray,ER.members,c))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class pd{constructor(a,c,p=()=>!0){this.binders={},this._buffers=[],this.context=c;const g=[];for(const x in a.paint._values){const b=a.paint.get(x);if(x.endsWith("-use-theme")||!p(x)||!(b instanceof Pc&&L_(b.property.specification)))continue;const C=jR(x,a.type),I=b.value,D=b.property.specification.type,U=!!b.property.useIntegerZoom,q=x==="line-dasharray"||x.endsWith("pattern"),H=a.paint.get(`${x}-use-theme`),Y=x==="line-dasharray"&&a.layout.get("line-cap").value.kind!=="constant"||H&&H.value.kind!=="constant";if(I.kind!=="constant"||Y)if(I.kind==="source"||Y||q){const J=q1(x,D,"source");this.binders[x]=q?new So(I,C,D,J,a.id):new fd(I,C,D,J),g.push(`/a_${x}`)}else{const J=q1(x,D,"composite");this.binders[x]=new eu(I,C,D,U,c,J),g.push(`/z_${x}`)}else this.binders[x]=q?new wy(I.value,C):new ux(I.value,C,D,c),g.push(`/u_${x}`);H&&(this.binders[x].lutExpression=H.value)}this.cacheKey=g.sort().join("")}getMaxValue(a){const c=this.binders[a];return c instanceof fd||c instanceof eu?c.maxValue:0}populatePaintArrays(a,c,p,g,x,b,C,I){for(const D in this.binders){const U=this.binders[D];U.context=this.context,(U instanceof fd||U instanceof eu||U instanceof So)&&U.populatePaintArray(a,c,p,g,x,b,C,I)}}setConstantPatternPositions(a,c){for(const p in this.binders){const g=this.binders[p];g instanceof wy&&g.setConstantPatternPositions(a,c)}}getPatternTransitionVertexBuffer(a){const c=this.binders[a];return c instanceof So?c.paintTransitionVertexBuffer:null}updatePaintArrays(a,c,p,g,x,b,C,I,D,U){let q=!1;const H=Object.keys(a),Y=H.length!==0&&!I,J=Y?H:c.uniqueIds;this.context.lut=x.lut;for(const oe in this.binders){const ce=this.binders[oe];if(ce.context=this.context,(ce instanceof fd||ce instanceof eu||ce instanceof So)&&ce.expression&&ce.expression.kind&&ce.expression.kind!=="constant"&&(ce.expression.isStateDependent===!0||ce.expression.isLightConstant===!1)){const he=x.paint.get(oe);ce.expression=he.value;for(const we of J){const Te=a[we.toString()];c.eachPosition(we,(Pe,He,Fe)=>{const Ye=g.feature(Pe);ce.updatePaintArray(He,Fe,Ye,Te,b,C,D,U)})}if(!Y)for(const we of p.uniqueIds){const Te=a[we.toString()];p.eachPosition(we,(Pe,He,Fe)=>{const Ye=g.feature(Pe);ce.updatePaintArray(He,Fe,Ye,Te,b,C,D,U)})}q=!0}}return q}defines(){const a=[];for(const c in this.binders){const p=this.binders[c];(p instanceof ux||p instanceof wy)&&a.push(...p.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a){const c=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof ux||g instanceof wy||g instanceof eu)for(const x of g.uniformNames)c.push({name:x,property:p,binding:g.getBinding(a,x)})}return c}setUniforms(a,c,p,g,x){for(const{name:b,property:C,binding:I}of p)this.binders[C].setUniform(a,I,x,g.get(C),b)}updatePaintBuffers(){this._buffers=[];for(const a in this.binders){const c=this.binders[a];(c instanceof fd||c instanceof eu||c instanceof So)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer),c instanceof So&&c.paintTransitionVertexBuffer&&this._buffers.push(c.paintTransitionVertexBuffer)}}upload(a){for(const c in this.binders){const p=this.binders[c];(p instanceof fd||p instanceof eu||p instanceof So)&&p.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const c=this.binders[a];(c instanceof fd||c instanceof eu||c instanceof So)&&c.destroy()}}}class tu{constructor(a,c,p=()=>!0){this.programConfigurations={};for(const g of a)this.programConfigurations[g.id]=new pd(g,c,p);this.needsUpload=!1,this._featureMap=new vy,this._featureMapWithoutIds=new vy,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(a,c,p,g,x,b,C,I,D){for(const U in this.programConfigurations)this.programConfigurations[U].populatePaintArrays(a,c,g,x,b,C,I,D);c.id!==void 0?this._featureMap.add(c.id,p,this._bufferOffset,a):(this._featureMapWithoutIds.add(this._idlessCounter,p,this._bufferOffset,a),this._idlessCounter+=1),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,c,p,g,x,b,C,I){for(const D of p)this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(a,this._featureMap,this._featureMapWithoutIds,c,D,g,x,b,C||0,I)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const CR={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function jR(u,a){return CR[u]||[u.replace(`${a}-`,"").replace(/-/g,"_")]}const PR={"line-pattern":{source:oh,composite:oh},"fill-pattern":{source:oh,composite:oh},"fill-extrusion-pattern":{source:oh,composite:oh},"line-dasharray":{source:wf,composite:wf}},OR={color:{source:ch,composite:lh},number:{source:hd,composite:ch}};function q1(u,a,c){const p=PR[u];return p&&p[c]||OR[a][c]}_r(ux,"ConstantBinder"),_r(wy,"PatternConstantBinder"),_r(fd,"SourceExpressionBinder"),_r(So,"PatternCompositeBinder"),_r(eu,"CompositeExpressionBinder"),_r(pd,"ProgramConfiguration",{omit:["_buffers"]}),_r(tu,"ProgramConfigurationSet");const xl=rr/Math.PI/2,v=5,l=6,f=16383,_=64,E=[_,32,16],j=-xl,k=xl;function L(u,a,c,p=xl){return c=vn(c),[u*Math.sin(c)*p,-a*p,u*Math.cos(c)*p]}function z(u,a,c){return L(Math.cos(vn(u)),Math.sin(vn(u)),a,c)}const G=63710088e-1,Z=2*Math.PI*G;class Q{constructor(a,c){if(isNaN(a)||isNaN(c))throw new Error(`Invalid LngLat object: (${a}, ${c})`);if(this.lng=+a,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Q(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const c=Math.PI/180,p=this.lat*c,g=a.lat*c,x=Math.sin(p)*Math.sin(g)+Math.cos(p)*Math.cos(g)*Math.cos((a.lng-this.lng)*c);return G*Math.acos(Math.min(x,1))}toBounds(a=0){const c=360*a/40075017,p=c/Math.cos(Math.PI/180*this.lat);return new X({lng:this.lng-p,lat:this.lat-c},{lng:this.lng+p,lat:this.lat+c})}toEcef(a){return z(this.lat,this.lng,xl+a*xl/G)}static convert(a){if(a instanceof Q)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Q(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Q(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class X{constructor(a,c){a&&(c?this.setSouthWest(a).setNorthEast(c):Array.isArray(a)&&a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}setNorthEast(a){return this._ne=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}setSouthWest(a){return this._sw=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}extend(a){const c=this._sw,p=this._ne;let g,x;if(a instanceof Q)g=a,x=a;else{if(!(a instanceof X))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(X.convert(a)):this.extend(Q.convert(a)):typeof a=="object"&&a!==null&&a.hasOwnProperty("lat")&&(a.hasOwnProperty("lon")||a.hasOwnProperty("lng"))?this.extend(Q.convert(a)):this;if(g=a._sw,x=a._ne,!g||!x)return this}return c||p?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),p.lng=Math.max(x.lng,p.lng),p.lat=Math.max(x.lat,p.lat)):(this._sw=new Q(g.lng,g.lat),this._ne=new Q(x.lng,x.lat)),this}getCenter(){return new Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Q(this.getWest(),this.getNorth())}getSouthEast(){return new Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:c,lat:p}=Q.convert(a);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g}static convert(a){if(a)return a instanceof X?a:new X(a)}}const se=0,le=25.5;function ue(u){return Z*Math.cos(u*Math.PI/180)}function _e(u){return(180+u)/360}function ye(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Ee(u,a){return u/ue(a)}function Ne(u){return 360*u-180}function je(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function qe(u,a){return u*ue(je(a))}const Ie=85.051129;function Ge(u){return Math.cos(vn(ve(u,-Ie,Ie)))}function Ue(u,a){const c=ve(a,se,le),p=Math.pow(2,c);return Ge(u)*Z/(512*p)}function De(u){return 1/Math.cos(u*Math.PI/180)}function Ze(u,a=0){const c=Math.exp(Math.PI*(1-(u.y+a/rr)/(1<<u.z)*2));return 80150034*c/(c*c+1)/rr/(1<<u.z)}class ut{constructor(a,c,p=0){this.x=+a,this.y=+c,this.z=+p}static fromLngLat(a,c=0){const p=Q.convert(a);return new ut(_e(p.lng),ye(p.lat),Ee(c,p.lat))}toLngLat(){return new Q(Ne(this.x),je(this.y))}toAltitude(){return qe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Z*De(je(this.y))}}function ot(u,a,c,p,g,x,b,C,I){const D=(a+p)/2,U=(c+g)/2,q=new at(D,U);C(q),function(H,Y,J,oe,ce,he){const we=J-ce,Te=oe-he;return Math.abs((oe-Y)*we-(J-H)*Te)/Math.hypot(we,Te)}(q.x,q.y,x.x,x.y,b.x,b.y)>=I?(ot(u,a,c,D,U,x,q,C,I),ot(u,D,U,p,g,q,b,C,I)):u.push(b)}function St(u,a,c){let p=u[0],g=p.x,x=p.y;a(p);const b=[p];for(let C=1;C<u.length;C++){const I=u[C],{x:D,y:U}=I;a(I),ot(b,g,x,D,U,p,I,a,c),g=D,x=U,p=I}return b}function gt(u,a,c,p){if(p(a,c)){const g=a.add(c)._mult(.5);gt(u,a,g,p),gt(u,g,c,p)}else u.push(c)}function kt(u,a){let c=u[0];const p=[c];for(let g=1;g<u.length;g++){const x=u[g];gt(p,c,x,a),c=x}return p}const Qt=Math.pow(2,14)-1,mt=-Qt-1;function nt(u,a){const c=Math.round(u.x*a),p=Math.round(u.y*a);return u.x=ve(c,mt,Qt),u.y=ve(p,mt,Qt),(c<u.x||c>u.x+1||p<u.y||p>u.y+1)&&zr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function Nt(u,a,c){const p=u.loadGeometry(),g=u.extent,x=rr/g;if(a&&c&&c.projection.isReprojectedInTileSpace){const b=1<<a.z,{scale:C,x:I,y:D,projection:U}=c,q=H=>{const Y=Ne((a.x+H.x/g)/b),J=je((a.y+H.y/g)/b),oe=U.project(Y,J);H.x=(oe.x*C-I)*g,H.y=(oe.y*C-D)*g};for(let H=0;H<p.length;H++)if(u.type!==1)p[H]=St(p[H],q,1);else{const Y=[];for(const J of p[H])J.x<0||J.x>=g||J.y<0||J.y>=g||(q(J),Y.push(J));p[H]=Y}}for(const b of p)for(const C of b)nt(C,x);return p}function yt(u,a){return{type:u.type,id:u.id,properties:u.properties,geometry:a?Nt(u):[]}}class $t{constructor(a,c,p,g,x){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=g,this._values=x,a.readFields(nr,this,c)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos,p=[];let g,x=1,b=0,C=0,I=0;for(;a.pos<c;){if(b<=0){const D=a.readVarint();x=7&D,b=D>>3}if(b--,x===1||x===2)C+=a.readSVarint(),I+=a.readSVarint(),x===1&&(g&&p.push(g),g=[]),g&&g.push(new at(C,I));else{if(x!==7)throw new Error(`unknown command ${x}`);g&&g.push(g[0].clone())}}return g&&p.push(g),p}bbox(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos;let p=1,g=0,x=0,b=0,C=1/0,I=-1/0,D=1/0,U=-1/0;for(;a.pos<c;){if(g<=0){const q=a.readVarint();p=7&q,g=q>>3}if(g--,p===1||p===2)x+=a.readSVarint(),b+=a.readSVarint(),x<C&&(C=x),x>I&&(I=x),b<D&&(D=b),b>U&&(U=b);else if(p!==7)throw new Error(`unknown command ${p}`)}return[C,D,I,U]}toGeoJSON(a,c,p){const g=this.extent*Math.pow(2,p),x=this.extent*a,b=this.extent*c,C=this.loadGeometry();function I(H){return[360*(H.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(H.y+b)/g)*Math.PI))-90]}function D(H){return H.map(I)}let U;if(this.type===1){const H=[];for(const J of C)H.push(J[0]);const Y=D(H);U=H.length===1?{type:"Point",coordinates:Y[0]}:{type:"MultiPoint",coordinates:Y}}else if(this.type===2){const H=C.map(D);U=H.length===1?{type:"LineString",coordinates:H[0]}:{type:"MultiLineString",coordinates:H}}else{if(this.type!==3)throw new Error("unknown feature type");{const H=function(J){const oe=J.length;if(oe<=1)return[J];const ce=[];let he,we;for(let Te=0;Te<oe;Te++){const Pe=xr(J[Te]);Pe!==0&&(we===void 0&&(we=Pe<0),we===Pe<0?(he&&ce.push(he),he=[J[Te]]):he&&he.push(J[Te]))}return he&&ce.push(he),ce}(C),Y=[];for(const J of H)Y.push(J.map(D));U=Y.length===1?{type:"Polygon",coordinates:Y[0]}:{type:"MultiPolygon",coordinates:Y}}}const q={type:"Feature",geometry:U,properties:this.properties};return this.id!=null&&(q.id=this.id),q}}function nr(u,a,c){u===1?a.id=c.readVarint():u===2?function(p,g){const x=p.readVarint()+p.pos;for(;p.pos<x;){const b=g._keys[p.readVarint()],C=g._values[p.readVarint()];g.properties[b]=C}}(c,a):u===3?a.type=c.readVarint():u===4&&(a._geometry=c.pos)}function xr(u){let a=0;for(let c,p,g=0,x=u.length,b=x-1;g<x;b=g++)c=u[g],p=u[b],a+=(p.x-c.x)*(c.y+p.y);return a}$t.types=["Unknown","Point","LineString","Polygon"];class Xt{constructor(a,c){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(tr,this,c),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const c=this._pbf.readVarint()+this._pbf.pos;return new $t(this._pbf,c,this.extent,this._keys,this._values)}}function tr(u,a,c){u===15?a.version=c.readVarint():u===1?a.name=c.readString():u===5?a.extent=c.readVarint():u===2?a._features.push(c.pos):u===3?a._keys.push(c.readString()):u===4&&a._values.push(function(p){let g=null;const x=p.readVarint()+p.pos;for(;p.pos<x;){const b=p.readVarint()>>3;g=b===1?p.readString():b===2?p.readFloat():b===3?p.readDouble():b===4?p.readVarint64():b===5?p.readVarint():b===6?p.readSVarint():b===7?p.readBoolean():null}if(g==null)throw new Error("unknown feature value");return g}(c))}class wr{constructor(a,c){this.layers=a.readFields(pr,{},c)}}function pr(u,a,c){if(u===3){const p=new Xt(c,c.readVarint()+c.pos);p.length&&(a[p.name]=p)}}const dr="3d_elevation_id",mr="level";class $r{constructor(){this._valid=!1}reset(a){return this.feature=a,this._valid=!0,this._geometry=a.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(a,c){return this._valid&&a(c(this._geometry)),this}require(a,c,p){return this.get(a,!0,c,p)}optional(a,c,p){return this.get(a,!1,c,p)}success(){return this._valid}get(a,c,p,g){const x=this.feature.properties.hasOwnProperty(a)?+this.feature.properties[a]:void 0;return this._valid&&x!==void 0&&!Number.isNaN(x)?p(g?g(x):x):c&&(this._valid=!1),this}}class jn{constructor(a,c){this.featureFunc=a,this.vertexFunc=c}parseFeature(a,c,p){return this.featureFunc(a,c,p)}parseVertex(a,c,p){return this.vertexFunc(a,c,p)}}const Fn=new jn((u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).optional("fixed_height_relative",p=>{c.constantHeight=p},Yr.decodeRelativeHeight).geometry(p=>{c.bounds=p},ey).success(),(u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).require("elevation_idx",p=>{c.idx=p}).require("extent",p=>{c.extent=p}).require("height_relative",p=>{c.height=p},Yr.decodeRelativeHeight).geometry(p=>{c.position=p},Yr.getPoint).success()),Ei=new jn((u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).optional("fixed_height",p=>{c.constantHeight=p},Yr.decodeMetricHeight).geometry(p=>{c.bounds=p},ey).success(),(u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).require("elevation_idx",p=>{c.idx=p}).require("extent",p=>{c.extent=p}).require("height",p=>{c.height=p},Yr.decodeMetricHeight).geometry(p=>{c.position=p},Yr.getPoint).success());class Yr{static getPoint(a){return Ua(a[0][0].x,a[0][0].y)}static decodeRelativeHeight(a){return 1e-4*a*5}static decodeMetricHeight(a){return 1e-4*a}static getVersionSchema(a){return a?a==="1.0.1"?Ei:void 0:Fn}static parse(a){const c=[],p=[],g=a.length,x=new $r;for(let b=0;b<g;b++){const C=a.feature(b),I=C.properties.version,D=Yr.getVersionSchema(I);if(D===void 0){zr(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const U=C.properties.type;if(!U)continue;const q=$t.types[C.type];if(q==="Point"&&U==="curve_point"){const H={};D.parseVertex(x,C,H)&&c.push(H)}else if(q==="Polygon"&&U==="curve_meta"){const H={};D.parseFeature(x,C,H)&&p.push(H)}}return{vertices:c,features:p}}}class Dn{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,p){const g=nl(c,this.dir);if(Math.abs(g)<1e-6)return!1;const x=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1])/g;return p[0]=this.pos[0]+this.dir[0]*x,p[1]=this.pos[1]+this.dir[1]*x,!0}}class dn{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,p){const g=st(c,this.dir);if(Math.abs(g)<1e-6)return!1;const x=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1]+(a[2]-this.pos[2])*c[2])/g;return p[0]=this.pos[0]+this.dir[0]*x,p[1]=this.pos[1]+this.dir[1]*x,p[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(a,c,p){if(function(Y,J){var oe=Y[0],ce=Y[1],he=Y[2],we=J[0],Te=J[1],Pe=J[2];return Math.abs(oe-we)<=m*Math.max(1,Math.abs(oe),Math.abs(we))&&Math.abs(ce-Te)<=m*Math.max(1,Math.abs(ce),Math.abs(Te))&&Math.abs(he-Pe)<=m*Math.max(1,Math.abs(he),Math.abs(Pe))}(this.pos,a)||c===0)return p[0]=p[1]=p[2]=0,!1;const[g,x,b]=this.dir,C=this.pos[0]-a[0],I=this.pos[1]-a[1],D=this.pos[2]-a[2],U=g*g+x*x+b*b,q=2*(C*g+I*x+D*b),H=q*q-4*U*(C*C+I*I+D*D-c*c);if(H<0){const Y=Math.max(-q/2,0),J=C+g*Y,oe=I+x*Y,ce=D+b*Y,he=Math.hypot(J,oe,ce);return p[0]=J*c/he,p[1]=oe*c/he,p[2]=ce*c/he,!1}{const Y=(-q-Math.sqrt(H))/(2*U);if(Y<0){const J=Math.hypot(C,I,D);return p[0]=C*c/J,p[1]=I*c/J,p[2]=D*c/J,!1}return p[0]=C+g*Y,p[1]=I+x*Y,p[2]=D+b*Y,!0}}}class yi{constructor(a,c,p,g,x){this.TL=a,this.TR=c,this.BR=p,this.BL=g,this.horizon=x}static fromInvProjectionMatrix(a,c,p){const g=[-1,1,1],x=[1,1,1],b=[1,-1,1],C=[-1,-1,1],I=Dt(g,g,a),D=Dt(x,x,a),U=Dt(b,b,a),q=Dt(C,C,a);return new yi(I,D,U,q,c/p)}}function zn(u,a,c){let p=1/0,g=-1/0;const x=[];for(const b of u){jt(x,b,a);const C=st(x,c);p=Math.min(p,C),g=Math.max(g,C)}return[p,g]}function Di(u,a){let c=!0;for(let p=0;p<u.planes.length;p++){const g=u.planes[p];let x=0;for(let b=0;b<a.length;b++)x+=+(st(g,a[b])+g[3]>=0);if(x===0)return 0;x!==a.length&&(c=!1)}return c?2:1}function Xn(u,a){for(const c of u.projections){const p=zn(a,u.points[0],c.axis);if(c.projection[1]<p[0]||c.projection[0]>p[1])return 0}return 1}function fn(u,a){let c=0;const p=[0,0,0,0];for(let b=0;b<u.length;b++)p[0]=u[b][0],p[1]=u[b][1],p[2]=u[b][2],p[3]=1,(g=p)[0]*(x=a)[0]+g[1]*x[1]+g[2]*x[2]+g[3]*x[3]>=0&&c++;var g,x;return c}class ai{constructor(a,c){this.points=a||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=_n.fromPoints(this.points),this.projections=[],this.frustumEdges=[jt([],this.points[2],this.points[3]),jt([],this.points[0],this.points[3]),jt([],this.points[4],this.points[0]),jt([],this.points[5],this.points[1]),jt([],this.points[6],this.points[2]),jt([],this.points[7],this.points[3])];for(const p of this.frustumEdges){const g=[0,-p[2],p[1]],x=[p[2],0,-p[0]];this.projections.push({axis:g,projection:zn(this.points,this.points[0],g)}),this.projections.push({axis:x,projection:zn(this.points,this.points[0],x)})}}static fromInvProjectionMatrix(a,c,p,g){const x=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const U=Ut([],D,a),q=1/U[3]/c*x;return(H=U)[0]=(Y=U)[0]*(J=[q,q,g?1/U[3]:q,q])[0],H[1]=Y[1]*J[1],H[2]=Y[2]*J[2],H[3]=Y[3]*J[3],H;var H,Y,J}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const U=ke([],_t([],jt([],b[D[0]],b[D[1]]),jt([],b[D[2]],b[D[1]]))),q=-st(U,b[D[1]]);return U.concat(q)}),I=[];for(let D=0;D<b.length;D++)I.push([b[D][0],b[D][1],b[D][2]]);return new ai(I,C)}intersectsPrecise(a,c,p){for(let g=0;g<c.length;g++)if(!fn(a,c[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!fn(a,this.planes[g]))return 0;for(const g of p)for(const x of this.frustumEdges){const b=_t([],g,x),C=be(b);if(C===0)continue;Oe(b,b,1/C);const I=zn(this.points,this.points[0],b),D=zn(a,this.points[0],b);if(I[0]>D[1]||D[0]>I[1])return 0}return 1}containsPoint(a){for(const c of this.planes){const p=c[3];if(st([c[0],c[1],c[2]],a)+p<0)return!1}return!0}}class _n{static fromPoints(a){const c=[1/0,1/0,1/0],p=[-1/0,-1/0,-1/0];for(const g of a)ge(c,c,g),pe(p,p,g);return new _n(c,p)}static fromTileIdAndHeight(a,c,p){const g=1<<a.canonical.z,x=a.canonical.x,b=a.canonical.y;return new _n([x/g,b/g,c],[(x+1)/g,(b+1)/g,p])}static applyTransform(a,c){const p=a.getCorners();for(let g=0;g<p.length;++g)Dt(p[g],p[g],c);return _n.fromPoints(p)}static applyTransformFast(a,c){const p=[c[12],c[13],c[14]],g=[...p];for(let x=0;x<3;x++)for(let b=0;b<3;b++){const C=c[4*b+x],I=C*a.min[b],D=C*a.max[b];p[x]+=Math.min(I,D),g[x]+=Math.max(I,D)}return new _n(p,g)}static projectAabbCorners(a,c){const p=a.getCorners();for(let g=0;g<p.length;++g)Dt(p[g],p[g],c);return p}constructor(a,c){this.min=a,this.max=c,this.center=Oe([],xe([],this.min,this.max),.5)}quadrant(a){const c=[a%2==0,a<2],p=de(this.min),g=de(this.max);for(let x=0;x<c.length;x++)p[x]=c[x]?this.min[x]:this.center[x],g[x]=c[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new _n(p,g)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}distanceZ(a){return Math.max(Math.min(this.max[2],a[2]),this.min[2])-a[2]}getCorners(){const a=this.min,c=this.max;return[[a[0],a[1],a[2]],[c[0],a[1],a[2]],[c[0],c[1],a[2]],[a[0],c[1],a[2]],[a[0],a[1],c[2]],[c[0],a[1],c[2]],[c[0],c[1],c[2]],[a[0],c[1],c[2]]]}intersects(a){return this.intersectsAabb(a.bounds)?Di(a,this.getCorners()):0}intersectsFlat(a){return this.intersectsAabb(a.bounds)?Di(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(a,c){return c||this.intersects(a)?Xn(a,this.getCorners()):0}intersectsPreciseFlat(a,c){return c||this.intersectsFlat(a)?Xn(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(a){for(let c=0;c<3;++c)if(this.min[c]>a.max[c]||a.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(a){return!(this.min[0]>a.max[0]||a.min[0]>this.max[0]||this.min[1]>a.max[1]||a.min[1]>this.max[1])}encapsulate(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a.min[c]),this.max[c]=Math.max(this.max[c],a.max[c])}encapsulatePoint(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a[c]),this.max[c]=Math.max(this.max[c],a[c])}closestPoint(a){return[Math.max(Math.min(this.max[0],a[0]),this.min[0]),Math.max(Math.min(this.max[1],a[1]),this.min[1]),Math.max(Math.min(this.max[2],a[2]),this.min[2])]}}_r(_n,"Aabb");class Wi{constructor(a,c){this.feature=a,this.metersToTile=c,this.index=0}get(){const a=this.feature.vertices[this.index],c=this.feature.vertexProps[this.index].dir,p=c[1],g=-c[0],x=(a.extent+1)*this.metersToTile;return[new at(Math.trunc(a.position[0]+p*x),Math.trunc(a.position[1]+g*x)),new at(Math.trunc(a.position[0]-p*x),Math.trunc(a.position[1]-g*x))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class di{constructor(a,c,p,g,x,b){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[mi(),mi(),mi(),mi(),mi(),mi(),mi()],this.id=a,this.heightRange={min:p,max:p},this.safeArea=c,this.constantHeight=p,this.constantHeight==null&&(this.constantHeight!=null||g.length!==0)){this.vertices=g,this.edges=x,this.edges=this.edges.filter(C=>{return C.a<this.vertices.length&&C.b<this.vertices.length&&!((I=this.vertices[C.a].position)[0]===(D=this.vertices[C.b].position)[0]&&I[1]===D[1]);var I,D}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const C of this.vertices)this.vertexProps.push({dir:Ua(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,C.height),this.heightRange.max=Math.max(this.heightRange.max,C.height);for(const C of this.edges){const I=this.vertices[C.a].position,D=this.vertices[C.b].position,U=qa(mi(),D,I),q=Li(U),H=Ha(mi(),U,1/q);this.edgeProps.push({vec:U,dir:H,len:q});const Y=this.vertexProps[C.a].dir,J=this.vertexProps[C.b].dir;Bo(Y,Y,H),Bo(J,J,H)}for(const C of this.vertexProps)C.dir[0]===0&&C.dir[1]===0||Ws(C.dir,C.dir);this.tessellate(b)}}pointElevation(a){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(a);if(c==null)return 0;const[p,g]=c;return Kr(this.vertices[this.edges[p].a].height,this.vertices[this.edges[p].b].height,g)}computeSlopeNormal(a,c){const p=this.getClosestEdge(a);if(!p)return Se(0,0,1);const g=p[0],x=this.edges[g],b=this.edgeProps[g].vec,C=Se(b[0],b[1],(this.vertices[x.b].height-this.vertices[x.a].height)*c),I=Se(C[1],-C[0],0);_t(I,I,C);const D=be(I);return D>0?Oe(I,I,1/D):Ae(I,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(a){if(this.edges.length===0)return;let c=0,p=Number.POSITIVE_INFINITY,g=0;const[x,b,C,I,D,U,q]=this._tmpVec2;Va(q,a.x,a.y);const H=new Dn(q,null);for(let Y=0;Y<this.edges.length;Y++){const J=this.edges[Y],oe=this.edgeProps[Y].dir;H.dir=oe;const ce=this.vertices[J.a].position,he=this.vertices[J.b].position,we=H.intersectsPlane(ce,this.vertexProps[J.a].dir,x),Te=H.intersectsPlane(he,this.vertexProps[J.b].dir,b);if(!we||!Te)continue;qa(C,b,x),qa(I,q,x);const Pe=nl(C,C),He=Pe>0?nl(I,C)/Pe:0,Fe=ve(He,0,1),Ye=Math.abs((He-Fe)*this.edgeProps[Y].len);qa(D,q,ce),Va(U,oe[1],-oe[0]);const tt=Ye+Math.abs(nl(D,U));tt<p&&(c=Y,p=tt,g=Fe)}return[c,g]}tessellate(a){const c=ie(),p=ie(),g=ie(),x=ie();for(let b=this.edges.length-1;b>=0;--b){const C=this.edges[b].a,I=this.edges[b].b,{position:D,height:U,extent:q}=this.vertices[C],{position:H,height:Y,extent:J}=this.vertices[I],oe=this.vertexProps[C].dir,ce=this.vertexProps[I].dir;if(Ae(c,D[0]/a,D[1]/a,U),Ae(p,H[0]/a,H[1]/a,Y),Ae(g,oe[1],-oe[0],0),Oe(g,g,q),Ae(x,ce[1],-ce[0],0),Oe(x,x,J),this.distSqLines(Se(c[0]+.5*g[0],c[1]+.5*g[1],c[2]+.5*g[2]),Se(p[0]-.5*x[0],p[1]-.5*x[1],p[2]-.5*x[2]),Se(c[0]-.5*g[0],c[1]-.5*g[1],c[2]-.5*g[2]),Se(p[0]+.5*x[0],p[1]+.5*x[1],p[2]+.5*x[2]))<=.0025000000000000005)continue;const he=this.vertices.length,we=Bo(mi(),D,H);this.vertices.push({position:Ha(we,we,.5),height:.5*(U+Y),extent:.5*(q+J)});const Te=Bo(mi(),oe,ce);this.vertexProps.push({dir:Ws(Te,Te)}),this.edges.splice(b,1),this.edgeProps.splice(b,1),this.edges.push({a:C,b:he}),this.edges.push({a:he,b:I});const Pe=qa(mi(),this.vertices[he].position,D),He=Li(Pe),Fe={vec:Pe,dir:Ha(mi(),Pe,1/He),len:He};this.edgeProps.push(Fe),this.edgeProps.push(Fe)}}distSqLines(a,c,p,g){const x=me(ie(),c,a),b=me(ie(),g,p),C=me(ie(),a,p),I=st(x,x),D=st(x,b),U=st(x,C),q=st(b,b),H=st(b,C),Y=I*q-D*D;if(Y===0)return $e(Be(x,p,g,st(C,b)/st(b,b)),a);const J=(I*H-D*U)/Y;return $e(Be(x,a,c,(D*H-U*q)/Y),Be(b,p,g,J))}}class Qr{static parseFrom(a,c){const p=Yr.parse(a);if(!p)return[];let{vertices:g,features:x}=p;const b=1/Ze(c);x.sort((U,q)=>U.id-q.id),g.sort((U,q)=>U.id-q.id||U.idx-q.idx),g=g.filter((U,q,H)=>q===H.findIndex(Y=>Y.id===U.id&&Y.idx===U.idx));const C=new Array;let I=0;const D=g.length;for(const U of x){if(U.constantHeight){C.push(new di(U.id,U.bounds,U.constantHeight));continue}for(;I!==D&&g[I].id<U.id;)I++;if(I===D||g[I].id!==U.id)continue;const q=new Array,H=new Array,Y=I;for(;I!==D&&g[I].id===U.id;){const J=g[I];if(q.push({position:J.position,height:J.height,extent:J.extent}),I!==Y&&g[I-1].idx===J.idx-1){const oe=I-Y;H.push({a:oe-1,b:oe})}I++}C.push(new di(U.id,U.bounds,void 0,q,H,b))}return C}static getElevationFeature(a,c){if(!c)return;const p=+a.properties[dr];return Number.isNaN(p)?void 0:c.find(g=>g.id===p)}}class Un{constructor(a,c){this.zScale=1,this.xOffset=0,this.yOffset=0,a.equals(c)||(this.zScale=Math.pow(2,c.z-a.z),this.xOffset=(a.x*this.zScale-c.x)*rr,this.yOffset=(a.y*this.zScale-c.y)*rr)}constantElevation(a,c){if(a.constantHeight!=null)return this.computeBiasedHeight(a.constantHeight,c)}pointElevation(a,c,p){const g=this.constantElevation(c,p);return g??(a.x=a.x*this.zScale+this.xOffset,a.y=a.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(a),p))}computeBiasedHeight(a,c){return c<=0?a:a+c*Me(0,c,a>=0?a:Math.abs(.5*a))}}_r(di,"ElevationFeature");class os{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.projection=a.projection,this.layoutVertexArray=new _l,this.indexArray=new is,this.segments=new ds,this.programConfigurations=new tu(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new hd),this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){const x=this.layers[0],b=[];let C=null;x.type==="circle"&&(C=x.layout.get("circle-sort-key"));for(const{feature:D,id:U,index:q,sourceLayerIndex:H}of a){const Y=this.layers[0]._featureFilter.needGeometry,J=yt(D,Y);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),J,p))continue;const oe=C?C.evaluate(J,{},p):void 0,ce={id:U,properties:D.properties,type:D.type,sourceLayerIndex:H,index:q,geometry:Y?J.geometry:Nt(D,p,g),patterns:{},sortKey:oe};b.push(ce)}C&&b.sort((D,U)=>D.sortKey-U.sortKey);let I=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new Q_,I=g.projection);for(const D of b){const{geometry:U,index:q,sourceLayerIndex:H}=D,Y=a[q].feature;this.addFeature(D,U,q,c.availableImages,p,I,c.brightness,c.elevationFeatures),c.featureIndex.insert(Y,U,q,H,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(a,c,p,g,x,b,C){this.programConfigurations.updatePaintArrays(a,c,x,p,g,b,C,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,qA.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,wR.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,bR.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(a,c,p,g,x,b,C,I){let D;this.elevationMode!=="none"&&(D=Qr.getElevationFeature(a,I));for(const U of c)for(const q of U){const H=q.x,Y=q.y;if(H<0||H>=rr||Y<0||Y>=rr)continue;if(b){const ce=b.projectTilePoint(H,Y,x),he=b.upVector(x,H,Y);this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he)}const J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),oe=J.vertexLength;if(this.addCircleVertex(H,Y,-1,-1),this.addCircleVertex(H,Y,1,-1),this.addCircleVertex(H,Y,1,1),this.addCircleVertex(H,Y,-1,1),this.elevationMode!=="none"){const ce=D?D.pointElevation(new at(H,Y)):0;this.hasElevation=this.hasElevation||ce!==0;for(let he=0;he<4;he++)this.elevatedLayoutVertexArray.emplaceBack(ce)}this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+2,oe+3),J.vertexLength+=4,J.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},g,x,C,void 0,this.worldview)}addCircleVertex(a,c,p,g){this.layoutVertexArray.emplaceBack(2*a+(p+1)/2,2*c+(g+1)/2)}addGlobeExtVertex(a,c){this.globeExtVertexArray.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}}function ks(u,a){for(let c=0;c<u.length;c++)if(Na(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(Na(u,a[c]))return!0;return!!ol(u,a)}function hs(u,a,c){return!!Na(u,a)||!!oo(a,u,c)}function ws(u,a){if(u.length===1)return Nc(a,u[0]);for(let c=0;c<a.length;c++){const p=a[c];for(let g=0;g<p.length;g++)if(Na(u,p[g]))return!0}for(let c=0;c<u.length;c++)if(Nc(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(ol(u,a[c]))return!0;return!1}function bl(u,a,c){if(u.length>1){if(ol(u,a))return!0;for(let p=0;p<a.length;p++)if(oo(a[p],u,c))return!0}for(let p=0;p<u.length;p++)if(oo(u[p],a,c))return!0;return!1}function ol(u,a){if(u.length===0||a.length===0)return!1;for(let c=0;c<u.length-1;c++){const p=u[c],g=u[c+1];for(let x=0;x<a.length-1;x++)if(ao(p,g,a[x],a[x+1]))return!0}return!1}function ao(u,a,c,p){return bn(u,c,p)!==bn(a,c,p)&&bn(u,a,c)!==bn(u,a,p)}function Eo(u,a,c){return(u.x-c.x)*(a.y-c.y)-(u.y-c.y)*(a.x-c.x)}function Zl(u,a,c,p){const g=Eo(u,a,p),x=Eo(u,a,c);if(Math.sign(g)===Math.sign(x))return;const b=Eo(c,p,u),C=b+x-g;return Math.sign(b)!==Math.sign(C)?[b/(b-C),x/(x-g)]:void 0}function oo(u,a,c){const p=c*c;if(a.length===1)return u.distSqr(a[0])<p;for(let g=1;g<a.length;g++)if(Xl(u,a[g-1],a[g])<p)return!0;return!1}function Xl(u,a,c){const p=a.distSqr(c);if(p===0)return u.distSqr(a);const g=((u.x-a.x)*(c.x-a.x)+(u.y-a.y)*(c.y-a.y))/p;return u.distSqr(g<0?a:g>1?c:c.sub(a)._mult(g)._add(a))}function Nc(u,a){let c,p,g,x=!1;for(let b=0;b<u.length;b++){c=u[b];for(let C=0,I=c.length-1;C<c.length;I=C++)p=c[C],g=c[I],p.y>a.y!=g.y>a.y&&a.x<(g.x-p.x)*(a.y-p.y)/(g.y-p.y)+p.x&&(x=!x)}return x}function Na(u,a){let c=!1;for(let p=0,g=u.length-1;p<u.length;g=p++){const x=u[p],b=u[g];x.y>a.y!=b.y>a.y&&a.x<(b.x-x.x)*(a.y-x.y)/(b.y-x.y)+x.x&&(c=!c)}return c}function gs(u,a,c,p,g){for(const b of u)if(a<=b.x&&c<=b.y&&p>=b.x&&g>=b.y)return!0;const x=[new at(a,c),new at(a,g),new at(p,g),new at(p,c)];if(u.length>2){for(const b of x)if(Na(u,b))return!0}for(let b=0;b<u.length-1;b++)if(Ns(u[b],u[b+1],x))return!0;return!1}function Ns(u,a,c){const p=c[0],g=c[2];if(u.x<p.x&&a.x<p.x||u.x>g.x&&a.x>g.x||u.y<p.y&&a.y<p.y||u.y>g.y&&a.y>g.y)return!1;const x=bn(u,a,c[0]);return x!==bn(u,a,c[1])||x!==bn(u,a,c[2])||x!==bn(u,a,c[3])}function ki(u,a,c,p,g,x){let b=a.y-u.y,C=u.x-a.x;if(x=x||0){const I=b*b+C*C;if(I===0)return!0;const D=Math.sqrt(I);b/=D,C/=D}return!((c.x-u.x)*b+(c.y-u.y)*C-x<0||(p.x-u.x)*b+(p.y-u.y)*C-x<0||(g.x-u.x)*b+(g.y-u.y)*C-x<0)}function Ls(u,a,c,p,g,x,b){return!(ki(u,a,p,g,x,b)||ki(a,c,p,g,x,b)||ki(c,u,p,g,x,b)||ki(p,g,u,a,c,b)||ki(g,x,u,a,c,b)||ki(x,p,u,a,c,b))}function Ia(u,a,c){const p=a.paint.get(u).value;return p.kind==="constant"?p.value:c.programConfigurations.get(a.id).getMaxValue(u)}function ys(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Yl(u,a,c,p,g){if(!a[0]&&!a[1])return u;const x=at.convert(a)._mult(g);c==="viewport"&&x._rotate(-p);const b=[];for(let C=0;C<u.length;C++)b.push(u[C].sub(x));return b}function tm(u,a,c,p){const g=at.convert(u)._mult(p);return a==="viewport"&&g._rotate(-c),g}let md,rm;function nm(u,a,c){var p=2*Math.PI*6378137/256/Math.pow(2,c);return[u*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}_r(os,"CircleBucket",{omit:["layers"]});class Jl{constructor(a,c,p){this.z=a,this.x=c,this.y=p,this.key=Ql(0,a,a,c,p)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}isChildOf(a){const c=this.z-a.z;return a.z===0||a.z<this.z&&a.x===this.x>>c&&a.y===this.y>>c}url(a,c){const p=function(x,b,C){var I=nm(256*x,256*(b=Math.pow(2,C)-b-1),C),D=nm(256*(x+1),256*(b+1),C);return I[0]+","+I[1]+","+D[0]+","+D[1]}(this.x,this.y,this.z),g=function(x,b,C){let I,D="";for(let U=x;U>0;U--)I=1<<U-1,D+=(b&I?1:0)+(C&I?2:0);return D}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",p)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Nu{constructor(a,c){this.wrap=a,this.canonical=c,this.key=Ql(a,c.z,c.z,c.x,c.y)}}class wa{constructor(a,c,p,g,x){this.overscaledZ=a,this.wrap=c,this.canonical=new Jl(p,+g,+x),this.key=c===0&&a===p?this.canonical.key:Ql(c,a,p,g,x)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const c=this.canonical.z-a;return a>this.canonical.z?new wa(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wa(a,this.wrap,a,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(a,c=!0){if(this.overscaledZ===a&&c)return this.key;if(a>this.canonical.z)return Ql(this.wrap*+c,a,this.canonical.z,this.canonical.x,this.canonical.y);{const p=this.canonical.z-a;return Ql(this.wrap*+c,a,a,this.canonical.x>>p,this.canonical.y>>p)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const c=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.z<this.canonical.z&&a.canonical.x===this.canonical.x>>c&&a.canonical.y===this.canonical.y>>c}children(a){if(this.overscaledZ>=a)return[new wa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,p=2*this.canonical.x,g=2*this.canonical.y;return[new wa(c,this.wrap,c,p,g),new wa(c,this.wrap,c,p+1,g),new wa(c,this.wrap,c,p,g+1),new wa(c,this.wrap,c,p+1,g+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new wa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new wa(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Nu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ql(u,a,c,p,g){const x=1<<Math.min(c,22);let b=x*(g%x)+p%x;return u&&c<22&&(b+=x*x*((u<0?-2*u-1:2*u)%(1<<2*(22-c)))),16*(32*b+c)+(a-c)}const Ef=[u=>{let a=u.canonical.x-1,c=u.wrap;return a<0&&(a=(1<<u.canonical.z)-1,c--),new wa(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>{let a=u.canonical.x+1,c=u.wrap;return a===1<<u.canonical.z&&(a=0,c++),new wa(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>new wa(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new wa(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];_r(Jl,"CanonicalTileID"),_r(wa,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const KA=Cn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:dx}=KA,che=Cn([{name:"a_pos_3",components:3,type:"Int16"}]);var bU=Cn([{name:"a_pos",type:"Int16",components:2}]);function ZA(u){return u*xl/G}const uhe=[new _n([j,j,j],[k,k,k]),new _n([j,j,j],[0,0,k]),new _n([0,j,j],[k,0,k]),new _n([j,0,j],[0,k,k]),new _n([0,0,j],[k,k,k])];function wU(u,a,c,p=!0){const g=Oe([],u._camera.position,u.worldSize),x=[a,c,1,1];Ut(x,x,u.pixelMatrixInverse),rt(x,x,1/x[3]);const b=ke([],jt([],x,g)),C=u.globeMatrix,I=[C[12],C[13],C[14]],D=jt([],I,g),U=be(D),q=ke([],D),H=u.worldSize/(2*Math.PI),Y=st(q,b),J=Math.asin(H/U);if(J<Math.acos(Y)){if(!p)return null;const Tt=[],ft=[];Oe(Tt,b,U/Y),ke(ft,jt(ft,Tt,D)),ke(b,xe(b,D,Oe(b,ft,Math.tan(J)*U)))}const oe=[];new dn(g,b).closestPointOnSphere(I,H,oe);const ce=ke([],Os(C,0)),he=ke([],Os(C,1)),we=ke([],Os(C,2)),Te=st(ce,oe),Pe=st(he,oe),He=st(we,oe),Fe=$o(Math.asin(-Pe/H));let Ye=$o(Math.atan2(Te,He));Ye=u.center.lng+function(Tt,ft){const At=(ft-Tt+180)%360-180;return At<-180?At+360:At}(u.center.lng,Ye);const tt=_e(Ye),it=ve(ye(Fe),0,1);return new ut(tt,it)}class dhe{constructor(a,c,p){this.a=jt([],a,p),this.b=jt([],c,p),this.center=p;const g=ke([],this.a),x=ke([],this.b);this.angle=Math.acos(st(g,x))}}function kR(u,a){if(u.angle===0)return null;let c;return c=u.a[a]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[a]/u.a[a]/Math.sin(u.angle)-1/Math.tan(u.angle)),c<0||c>1?null:function(p,g,x,b){const C=Math.sin(x);return p*(Math.sin((1-b)*x)/C)+g*(Math.sin(b*x)/C)}(u.a[a],u.b[a],u.angle,ve(c,0,1))+u.center[a]}function uh(u){if(u.z<=1)return uhe[u.z+2*u.y+u.x];const a=NR(XA(u));return _n.fromPoints(a)}function Tf(u,a,c){return Oe(u,u,1-c),Xe(u,u,a,c)}function SU(u,a,c){for(const p of u)Dt(p,p,a),Oe(p,p,c)}function EU(u,a,c,p){const g=a/u.worldSize,x=u.globeMatrix;if(c.z<=1){const it=uh(c).getCorners();return SU(it,x,g),_n.fromPoints(it)}const b=XA(c,p),C=NR(b,xl+ZA(u._tileCoverLift));SU(C,x,g);const I=Number.MAX_VALUE,D=[-I,-I,-I],U=[I,I,I];if(b.contains(u.center)){for(const ft of C)ge(U,U,ft),pe(D,D,ft);D[2]=0;const it=u.point,Tt=[it.x*g,it.y*g,0];return ge(U,U,Tt),pe(D,D,Tt),new _n(U,D)}if(u._tileCoverLift>0){for(const it of C)ge(U,U,it),pe(D,D,it);return new _n(U,D)}const q=[x[12]*g,x[13]*g,x[14]*g],H=b.getCenter(),Y=ve(u.center.lat,-Ie,Ie),J=ve(H.lat,-Ie,Ie),oe=_e(u.center.lng),ce=ye(Y);let he=oe-_e(H.lng);const we=ce-ye(J);he>.5?he-=1:he<-.5&&(he+=1);let Te=0;Math.abs(he)>Math.abs(we)?Te=he>=0?1:3:(Te=we>=0?0:2,Xe(q,q,[x[4]*g,x[5]*g,x[6]*g],-Math.sin(vn(we>=0?b.getSouth():b.getNorth()))*xl));const Pe=C[Te],He=C[(Te+1)%4],Fe=new dhe(Pe,He,q),Ye=[kR(Fe,0)||Pe[0],kR(Fe,1)||Pe[1],kR(Fe,2)||Pe[2]],tt=im(u.zoom);if(tt>0){const it=function({x:ft,y:At,z:Rt},Bt,er,Wt,Lt){const Gt=1/(1<<Rt);let wt=ft*Gt,xt=wt+Gt,Vt=At*Gt,Yt=Vt+Gt,Ft=0;const gr=(wt+xt)/2-Wt;return gr>.5?Ft=-1:gr<-.5&&(Ft=1),wt=((wt+Ft)*Bt-(Wt*=Bt))*er+Wt,xt=((xt+Ft)*Bt-Wt)*er+Wt,Vt=(Vt*Bt-(Lt*=Bt))*er+Lt,Yt=(Yt*Bt-Lt)*er+Lt,[[wt,Yt,0],[xt,Yt,0],[xt,Vt,0],[wt,Vt,0]]}(c,a,u._pixelsPerMercatorPixel,oe,ce);for(let ft=0;ft<C.length;ft++)Tf(C[ft],it[ft],tt);const Tt=xe([],it[Te],it[(Te+1)%4]);Oe(Tt,Tt,.5),Tf(Ye,Tt,tt)}for(const it of C)ge(U,U,it),pe(D,D,it);return U[2]=Math.min(Pe[2],He[2]),ge(U,U,Ye),pe(D,D,Ye),new _n(U,D)}function XA({x:u,y:a,z:c},p=!1){const g=1/(1<<c),x=new Q(Ne(u*g),a===(1<<c)-1&&p?-90:je((a+1)*g)),b=new Q(Ne((u+1)*g),a===0&&p?90:je(a*g));return new X(x,b)}function NR(u,a=xl){const c=vn(u.getNorth()),p=vn(u.getSouth()),g=Math.cos(c),x=Math.cos(p),b=Math.sin(c),C=Math.sin(p),I=u.getWest(),D=u.getEast();return[L(x,C,I,a),L(x,C,D,a),L(g,b,D,a),L(g,b,I,a)]}function H1(u,a,c,p){const g=1<<c.z,x=(u/rr+c.x)/g;return z(je((a/rr+c.y)/g),Ne(x),p)}function YA({min:u,max:a}){return f/Math.max(a[0]-u[0],a[1]-u[1],a[2]-u[2])}const TU=new Float64Array(16);function JA(u){const a=YA(u),c=te(TU,[a,a,a]);return F(c,c,Le([],u.min))}function IR(u){const a=(p=u.min,(c=TU)[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=p[0],c[13]=p[1],c[14]=p[2],c[15]=1,c);var c,p;const g=1/YA(u);return B(a,a,[g,g,g])}function RR(u){const a=rr/(2*Math.PI);return u/(2*Math.PI)/a}function AU(u,a){return rr/(512*Math.pow(2,u))*YA(uh(a))}function CU(u,a,c,p,g){const x=RR(c),b=[u,a,-c/(2*Math.PI)],C=N(new Float64Array(16));return F(C,C,b),B(C,C,[x,x,x]),$(C,C,vn(-g)),W(C,C,vn(-p)),C}function im(u){return Me(v,l,u)}function jU(u,a){const c=z(a.lat,a.lng),p=function(J){const oe=z(J._center.lat,J._center.lng);let ce=_t([],Se(0,1,0),oe);const he=ne([],-J.angle,oe);ce=Dt(ce,ce,he),ne(he,-J._pitch,ce);const we=ke([],oe);return Oe(we,we,ZA(J.cameraToCenterDistance/J.pixelsPerMeter)),Dt(we,we,he),xe([],oe,we)}(u);return b=(g=me([],p,c))[0],C=g[1],I=g[2],D=(x=c)[0],U=x[1],q=x[2],Y=(H=Math.sqrt((b*b+C*C+I*I)*(D*D+U*U+q*q)))&&st(g,x)/H,Math.acos(Math.min(Math.max(Y,-1),1));var g,x,b,C,I,D,U,q,H,Y}function MR(u,a){return jU(u,a)>Math.PI/2*1.01}const PU=vn(85),hhe=Math.cos(PU),fhe=Math.sin(PU),phe=O(),OU=u=>{const a=[];return u.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a};function kU(u,a,c,p,g,x,b,C,I){if(x&&u.queryGeometry.isAboveHorizon)return!1;x&&(I*=u.pixelToTileUnitsFactor);const D=u.tileID.canonical,U=c.projection.upVectorScale(D,c.center.lat,c.worldSize).metersToTile;for(const q of a)for(const H of q){const Y=H.add(C),J=g&&c.elevation?c.elevation.exaggeration()*g.getElevationAt(Y.x,Y.y,!0):0,oe=c.projection.projectTilePoint(Y.x,Y.y,D);if(J>0){const Te=c.projection.upVector(D,Y.x,Y.y);oe.x+=Te[0]*U*J,oe.y+=Te[1]*U*J,oe.z+=Te[2]*U*J}const ce=x?Y:mhe(oe.x,oe.y,oe.z,p),he=x?u.tilespaceRays.map(Te=>yhe(Te,J)):u.queryGeometry.screenGeometry,we=Ut([],[oe.x,oe.y,oe.z,1],p);if(!b&&x?I*=we[3]/c.cameraToCenterDistance:b&&!x&&(I*=c.cameraToCenterDistance/we[3]),x){const Te=je((H.y/rr+D.y)/(1<<D.z));I/=c.projection.pixelsPerMeter(Te,1)/Ee(1,Te)}if(hs(he,ce,I))return!0}return!1}function mhe(u,a,c,p){const g=Ut([],[u,a,c,1],p);return new at(g[0]/g[3],g[1]/g[3])}const NU=Se(0,0,0),ghe=Se(0,0,1);function yhe(u,a){const c=ie();return NU[2]=a,u.intersectsPlane(NU,ghe,c),new at(c[0],c[1])}class IU extends os{}let RU,MU,DU,LU;function FU(u,{width:a,height:c},p,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==a*c*p)throw new RangeError("mismatched image size")}else g=new Uint8Array(a*c*p);return u.width=a,u.height=c,u.data=g,u}function zU(u,a,c){const{width:p,height:g}=a;p===u.width&&g===u.height||(DR(u,a,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,p),height:Math.min(u.height,g)},c,null),u.width=p,u.height=g,u.data=a.data)}function DR(u,a,c,p,g,x,b,C){if(g.width===0||g.height===0)return a;if(g.width>u.width||g.height>u.height||c.x>u.width-g.width||c.y>u.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>a.width||g.height>a.height||p.x>a.width-g.width||p.y>a.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const I=u.data,D=a.data,U=x===4&&C;for(let q=0;q<g.height;q++){const H=((c.y+q)*u.width+c.x)*x,Y=((p.y+q)*a.width+p.x)*x;if(U)for(let J=0;J<g.width;J++){const oe=H+J*x+3,ce=Y+J*x;D[ce+0]=255,D[ce+1]=255,D[ce+2]=255,D[ce+3]=I[oe]}else if(b)for(let J=0;J<g.width;J++){const oe=H+J*x,ce=Y+J*x,he=new hi(I[oe+0]/255,I[oe+1]/255,I[oe+2]/255,I[oe+3]).toNonPremultipliedRenderColor(b).toArray();D[ce+0]=he[0],D[ce+1]=he[1],D[ce+2]=he[2],D[ce+3]=he[3]}else for(let J=0;J<g.width*x;J++)D[Y+J]=I[H+J]}return a}_r(IU,"HeatmapBucket",{omit:["layers"]});class sm{constructor(a,c){FU(this,a,1,c)}resize(a){zU(this,new sm(a),1)}clone(){return new sm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,p,g,x){DR(a,c,p,g,x,1,null)}}class To{constructor(a,c){FU(this,a,4,c)}resize(a){zU(this,new To(a),4)}replace(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new To({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,p,g,x,b,C){DR(a,c,p,g,x,4,b,C)}}class BU{constructor(a,c){this.width=a.width,this.height=a.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function G1(u){const a={},c=u.resolution||256,p=u.clips?u.clips.length:1,g=u.image||new To({width:c,height:p}),x=(b,C,I)=>{a[u.evaluationKey]=I;const D=u.expression.evaluate(a),U=D?D.toNonPremultipliedRenderColor(null):null;U&&(g.data[b+C+0]=Math.floor(255*U.r),g.data[b+C+1]=Math.floor(255*U.g),g.data[b+C+2]=Math.floor(255*U.b),g.data[b+C+3]=Math.floor(255*U.a))};if(u.clips)for(let b=0,C=0;b<p;++b,C+=4*c)for(let I=0,D=0;I<c;I++,D+=4){const U=I/(c-1),{start:q,end:H}=u.clips[b];x(C,D,q*(1-U)+H*U)}else for(let b=0,C=0;b<c;b++,C+=4)x(0,C,b/(c-1));return g}_r(sm,"AlphaImage"),_r(To,"RGBAImage");const vhe=Cn([{name:"a_pos",components:2,type:"Int16"}],4),_he=Cn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),xhe=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),bhe=Cn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function hx(u,a,c=2){const p=a&&a.length,g=p?a[0]*c:u.length;let x=$U(u,0,g,c,!0);const b=[];if(!x||x.next===x.prev)return b;let C,I,D;if(p&&(x=function(U,q,H,Y){const J=[];for(let oe=0,ce=q.length;oe<ce;oe++){const he=$U(U,q[oe]*Y,oe<ce-1?q[oe+1]*Y:U.length,Y,!1);he===he.next&&(he.steiner=!0),J.push(Phe(he))}J.sort(Ahe);for(let oe=0;oe<J.length;oe++)H=Che(J[oe],H);return H}(u,a,x,c)),u.length>80*c){C=u[0],I=u[1];let U=C,q=I;for(let H=c;H<g;H+=c){const Y=u[H],J=u[H+1];Y<C&&(C=Y),J<I&&(I=J),Y>U&&(U=Y),J>q&&(q=J)}D=Math.max(U-C,q-I),D=D!==0?32767/D:0}return W1(x,b,c,C,I,D,0),b}function $U(u,a,c,p,g){let x;if(g===function(b,C,I,D){let U=0;for(let q=C,H=I-D;q<I;q+=D)U+=(b[H]-b[q])*(b[q+1]+b[H+1]),H=q;return U}(u,a,c,p)>0)for(let b=a;b<c;b+=p)x=HU(b/p|0,u[b],u[b+1],x);else for(let b=c-p;b>=a;b-=p)x=HU(b/p|0,u[b],u[b+1],x);return x&&fx(x,x.next)&&(X1(x),x=x.next),x}function Sy(u,a){if(!u)return u;a||(a=u);let c,p=u;do if(c=!1,p.steiner||!fx(p,p.next)&&Ra(p.prev,p,p.next)!==0)p=p.next;else{if(X1(p),p=a=p.prev,p===p.next)break;c=!0}while(c||p!==a);return a}function W1(u,a,c,p,g,x,b){if(!u)return;!b&&x&&function(I,D,U,q){let H=I;do H.z===0&&(H.z=LR(H.x,H.y,D,U,q)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==I);H.prevZ.nextZ=null,H.prevZ=null,function(Y){let J,oe=1;do{let ce,he=Y;Y=null;let we=null;for(J=0;he;){J++;let Te=he,Pe=0;for(let Fe=0;Fe<oe&&(Pe++,Te=Te.nextZ,Te);Fe++);let He=oe;for(;Pe>0||He>0&&Te;)Pe!==0&&(He===0||!Te||he.z<=Te.z)?(ce=he,he=he.nextZ,Pe--):(ce=Te,Te=Te.nextZ,He--),we?we.nextZ=ce:Y=ce,ce.prevZ=we,we=ce;he=Te}we.nextZ=null,oe*=2}while(J>1)}(H)}(u,p,g,x);let C=u;for(;u.prev!==u.next;){const I=u.prev,D=u.next;if(x?She(u,p,g,x):whe(u))a.push(I.i,u.i,D.i),X1(u),u=D.next,C=D.next;else if((u=D)===C){b?b===1?W1(u=Ehe(Sy(u),a),a,c,p,g,x,2):b===2&&The(u,a,c,p,g,x):W1(Sy(u),a,c,p,g,x,1);break}}}function whe(u){const a=u.prev,c=u,p=u.next;if(Ra(a,c,p)>=0)return!1;const g=a.x,x=c.x,b=p.x,C=a.y,I=c.y,D=p.y,U=Math.min(g,x,b),q=Math.min(C,I,D),H=Math.max(g,x,b),Y=Math.max(C,I,D);let J=p.next;for(;J!==a;){if(J.x>=U&&J.x<=H&&J.y>=q&&J.y<=Y&&K1(g,C,x,I,b,D,J.x,J.y)&&Ra(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function She(u,a,c,p){const g=u.prev,x=u,b=u.next;if(Ra(g,x,b)>=0)return!1;const C=g.x,I=x.x,D=b.x,U=g.y,q=x.y,H=b.y,Y=Math.min(C,I,D),J=Math.min(U,q,H),oe=Math.max(C,I,D),ce=Math.max(U,q,H),he=LR(Y,J,a,c,p),we=LR(oe,ce,a,c,p);let Te=u.prevZ,Pe=u.nextZ;for(;Te&&Te.z>=he&&Pe&&Pe.z<=we;){if(Te.x>=Y&&Te.x<=oe&&Te.y>=J&&Te.y<=ce&&Te!==g&&Te!==b&&K1(C,U,I,q,D,H,Te.x,Te.y)&&Ra(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Pe.x>=Y&&Pe.x<=oe&&Pe.y>=J&&Pe.y<=ce&&Pe!==g&&Pe!==b&&K1(C,U,I,q,D,H,Pe.x,Pe.y)&&Ra(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;Te&&Te.z>=he;){if(Te.x>=Y&&Te.x<=oe&&Te.y>=J&&Te.y<=ce&&Te!==g&&Te!==b&&K1(C,U,I,q,D,H,Te.x,Te.y)&&Ra(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Pe&&Pe.z<=we;){if(Pe.x>=Y&&Pe.x<=oe&&Pe.y>=J&&Pe.y<=ce&&Pe!==g&&Pe!==b&&K1(C,U,I,q,D,H,Pe.x,Pe.y)&&Ra(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function Ehe(u,a){let c=u;do{const p=c.prev,g=c.next.next;!fx(p,g)&&VU(p,c,c.next,g)&&Z1(p,g)&&Z1(g,p)&&(a.push(p.i,c.i,g.i),X1(c),X1(c.next),c=u=g),c=c.next}while(c!==u);return Sy(c)}function The(u,a,c,p,g,x){let b=u;do{let C=b.next.next;for(;C!==b.prev;){if(b.i!==C.i&&Ohe(b,C)){let I=qU(b,C);return b=Sy(b,b.next),I=Sy(I,I.next),W1(b,a,c,p,g,x,0),void W1(I,a,c,p,g,x,0)}C=C.next}b=b.next}while(b!==u)}function Ahe(u,a){let c=u.x-a.x;return c===0&&(c=u.y-a.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(a.next.y-a.y)/(a.next.x-a.x)),c}function Che(u,a){const c=function(g,x){let b=x;const C=g.x,I=g.y;let D,U=-1/0;if(fx(g,b))return b;do{if(fx(g,b.next))return b.next;if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){const oe=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(oe<=C&&oe>U&&(U=oe,D=b.x<b.next.x?b:b.next,oe===C))return D}b=b.next}while(b!==x);if(!D)return null;const q=D,H=D.x,Y=D.y;let J=1/0;b=D;do{if(C>=b.x&&b.x>=H&&C!==b.x&&UU(I<Y?C:U,I,H,Y,I<Y?U:C,I,b.x,b.y)){const oe=Math.abs(I-b.y)/(C-b.x);Z1(b,g)&&(oe<J||oe===J&&(b.x>D.x||b.x===D.x&&jhe(D,b)))&&(D=b,J=oe)}b=b.next}while(b!==q);return D}(u,a);if(!c)return a;const p=qU(c,u);return Sy(p,p.next),Sy(c,c.next)}function jhe(u,a){return Ra(u.prev,u,a.prev)<0&&Ra(a.next,u,u.next)<0}function LR(u,a,c,p,g){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*g|0)|u<<8))|u<<4))|u<<2))|u<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-p)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Phe(u){let a=u,c=u;do(a.x<c.x||a.x===c.x&&a.y<c.y)&&(c=a),a=a.next;while(a!==u);return c}function UU(u,a,c,p,g,x,b,C){return(g-b)*(a-C)>=(u-b)*(x-C)&&(u-b)*(p-C)>=(c-b)*(a-C)&&(c-b)*(x-C)>=(g-b)*(p-C)}function K1(u,a,c,p,g,x,b,C){return!(u===b&&a===C)&&UU(u,a,c,p,g,x,b,C)}function Ohe(u,a){return u.next.i!==a.i&&u.prev.i!==a.i&&!function(c,p){let g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==p.i&&g.next.i!==p.i&&VU(g,g.next,c,p))return!0;g=g.next}while(g!==c);return!1}(u,a)&&(Z1(u,a)&&Z1(a,u)&&function(c,p){let g=c,x=!1;const b=(c.x+p.x)/2,C=(c.y+p.y)/2;do g.y>C!=g.next.y>C&&g.next.y!==g.y&&b<(g.next.x-g.x)*(C-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==c);return x}(u,a)&&(Ra(u.prev,u,a.prev)||Ra(u,a.prev,a))||fx(u,a)&&Ra(u.prev,u,u.next)>0&&Ra(a.prev,a,a.next)>0)}function Ra(u,a,c){return(a.y-u.y)*(c.x-a.x)-(a.x-u.x)*(c.y-a.y)}function fx(u,a){return u.x===a.x&&u.y===a.y}function VU(u,a,c,p){const g=eC(Ra(u,a,c)),x=eC(Ra(u,a,p)),b=eC(Ra(c,p,u)),C=eC(Ra(c,p,a));return g!==x&&b!==C||!(g!==0||!QA(u,c,a))||!(x!==0||!QA(u,p,a))||!(b!==0||!QA(c,u,p))||!(C!==0||!QA(c,a,p))}function QA(u,a,c){return a.x<=Math.max(u.x,c.x)&&a.x>=Math.min(u.x,c.x)&&a.y<=Math.max(u.y,c.y)&&a.y>=Math.min(u.y,c.y)}function eC(u){return u>0?1:u<0?-1:0}function Z1(u,a){return Ra(u.prev,u,u.next)<0?Ra(u,a,u.next)>=0&&Ra(u,u.prev,a)>=0:Ra(u,a,u.prev)<0||Ra(u,u.next,a)<0}function qU(u,a){const c=FR(u.i,u.x,u.y),p=FR(a.i,a.x,a.y),g=u.next,x=a.prev;return u.next=a,a.prev=u,c.next=g,g.prev=c,p.next=c,c.prev=p,x.next=p,p.prev=x,p}function HU(u,a,c,p){const g=FR(u,a,c);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function X1(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function FR(u,a,c){return{i:u,x:a,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Y1(u,a){const c=u.length;if(c<=1)return[u];const p=[];let g,x;for(let b=0;b<c;b++){const C=An(u[b]);C!==0&&(u[b].area=Math.abs(C),x===void 0&&(x=C<0),x===C<0?(g&&p.push(g),g=[u[b]]):g.push(u[b]))}if(g&&p.push(g),a>1)for(let b=0;b<p.length;b++)p[b].length<=a||(ld(p[b],a,1,p[b].length-1,khe),p[b]=p[b].slice(0,a));return p}function khe(u,a){return a.area-u.area}function GU(u,a,c=1){if(!u)return null;const p=typeof u=="string"?vl.from(u).getPrimary():u.getPrimary(),g=typeof u=="string"?null:u.getSecondary();for(const x of[p,g]){if(!x)continue;const b=x.id.toString();a.has(b)||a.set(b,[]),x.scaleSelf(c),a.get(b).push(x)}return{primary:p.toString(),secondary:g?g.toString():null}}function zR(u,a,c,p){const g=p.patternDependencies;let x=!1;for(const b of a){const C=b.paint.get(`${u}-pattern`);C.isConstant()||(x=!0),GU(C.constantOr(null),g,c)&&(x=!0)}return x}function BR(u,a,c,p,g,x){const b=x.patternDependencies;for(const C of a){const I=C.paint.get(`${u}-pattern`).value;if(I.kind!=="constant"){let D=I.evaluate({zoom:p},c,{},x.availableImages);D=D&&D.name?D.name:D;const U=GU(D,b,g);if(!U)continue;const{primary:q,secondary:H}=U;q&&(c.patterns[C.id]=[q,H].filter(Boolean))}}return c}class WU{constructor(){this.polygons=new Map}add(a,...c){const p=this.polygons.get(a);p?p.push(...c):this.polygons.set(a,c)}merge(a){for(const[c,p]of a.polygons)this.add(c,...p)}}class Af{constructor(){this.portals=[]}static isOnBorder(a,c){return a<=0&&c<=0||a>=rr&&c>=rr}static evaluate(a){if(a.length===0)return new Af;let c=[];for(const I of a)c.push(...I.portals);if(c.length===0)return new Af;for(const I of c){const D=I.va,U=I.vb;(Af.isOnBorder(D.x,U.x)||Af.isOnBorder(D.y,U.y))&&(I.type="border")}const p=c.filter(I=>I.type!=="unevaluated"),g=c.filter(I=>I.type==="unevaluated");if(g.length===0)return new Af;g.sort((I,D)=>I.hash===D.hash?I.isTunnel===D.isTunnel?0:I.isTunnel?-1:1:I.hash<D.hash?1:-1),c=p.concat(g);let x=p.length,b=x,C=x;do if(b++,b===c.length||c[x].hash!==c[b].hash){if(b-x==2){C<x&&(c[C]=c[x],c[x]=null);const I=c[C],D=c[b-1];I.type=I.isTunnel!==D.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:D.connection.a},C++}x=b}while(x!==c.length);return c.splice(C),c.sort((I,D)=>I.hash<D.hash?1:-1),{portals:c}}}_r(Af,"ElevationPortalGraph"),_r(WU,"ElevationPolygons");class Nhe{constructor(a,c,p){this.outPositions=a,this.outNormals=c,this.outIndices=p,this.vertexLookup=new Map}addVertex(a,c,p){let g=a[2];p!=null&&(g*=p);const x=`${a[0]},${a[1]},${a[2]},${c[0]},${c[1]},${c[2]}`,b=this.vertexLookup.get(x);if(b!=null)return b;const C=this.outPositions.length;this.vertexLookup.set(x,C);const I=Math.trunc(16384*c[0]),D=Math.trunc(16384*c[1]),U=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(a[0],a[1],g),this.outNormals.emplaceBack(I,D,U),C}addTriangle(a,c,p){this.outIndices.emplaceBack(a,c,p)}addTriangles(a,c,p){if(a.length===0)return;const g=p.length===1,x=ie(),b=ie();for(let C=0;C<a.length;C+=3){const I=c[a[C+0]],D=c[a[C+1]],U=c[a[C+2]],q=g?p[0]:p[a[C+1]],H=g?p[0]:p[a[C+2]];Ae(x,I.x,I.y,g?p[0]:p[a[C+0]]);const Y=this.addVertex(x,b);Ae(x,D.x,D.y,q);const J=this.addVertex(x,b);Ae(x,U.x,U.y,H);const oe=this.addVertex(x,b);this.outIndices.emplaceBack(Y,J,oe)}}addQuad(a,c,p,g,x,b){const C=this.addVertex(a,x,b),I=this.addVertex(c,x,b),D=this.addVertex(p,x,b),U=this.addVertex(g,x,b);this.addTriangle(C,I,D),this.addTriangle(D,U,C)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ec{constructor(a,c,p,g){this.unevaluatedPortals=new Af,this.portalPolygons=new WU,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new C1,this.vertexNormals=new j1,this.indexArray=new is,this.tileToMeters=Ze(a),this.bridgeProgramConfigurations=new tu(c,{zoom:p,lut:g},x=>x!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new tu(c,{zoom:p,lut:g},x=>x!=="fill-bridge-guard-rail-color")}addVertices(a,c){const p=this.unevalVertices.length;for(let g=0;g<a.length;g++)this.unevalVertices.push(a[g]),this.unevalHeights.push(c[g]);return p}addTriangles(a,c,p){const g=p?this.unevalTunnelTriangles:this.unevalTriangles;for(const x of a)g.push(x+c)}addRenderableRing(a,c,p,g,x,b){const C=[new at(x.min.x,x.min.y),new at(x.max.x,x.min.y),new at(x.max.x,x.max.y),new at(x.min.x,x.max.y)];for(let I=0;I<p-1;I++){const D=c+I,U=D+1,q=this.unevalVertices[D],H=this.unevalVertices[U];if(!(q.x>=x.min.x&&q.x<=x.max.x&&q.y>=x.min.y&&q.y<=x.max.y||H.x>=x.min.x&&H.x<=x.max.x&&H.y>=x.min.y&&H.y<=x.max.y||Ns(q,H,C))||this.isOnBorder(q.x,H.x)||this.isOnBorder(q.y,H.y))continue;const Y=ec.computeEdgeHash(this.unevalVertices[D],this.unevalVertices[U]);let J,oe=this.vertexHashLookup.get(ec.computePosHash(q));oe!=null?J=oe.next:(oe=this.vertexHashLookup.get(ec.computePosHash(H)),J=oe!=null?oe.prev:Y),this.unevalEdges.push({polygonIdx:a,a:D,b:U,hash:Y,portalHash:J,isTunnel:g,type:"unevaluated",featureInfo:b})}}addPortalCandidates(a,c,p,g,x){if(c.length===0)return;this.portalPolygons.add(a,{geometry:c,zLevel:x});const b=c[0];this.vertexHashLookup.clear();let C=ec.computeEdgeHash(b[b.length-2],b[b.length-1]);for(let I=0;I<b.length-1;I++){const D=b[I+0],U=b[I+1],q=Ua(U.x-D.x,U.y-D.y),H=Li(q);if(H===0)continue;let Y="unevaluated";const J=g.pointElevation(D),oe=g.pointElevation(U);Math.abs(J)<.01&&Math.abs(oe)<.01?Y="entrance":(this.isOnBorder(D.x,U.x)||this.isOnBorder(D.y,U.y))&&(Y="border");const ce=ec.computeEdgeHash(D,U);this.unevaluatedPortals.portals.push({connection:{a,b:void 0},va:D,vb:U,vab:q,length:H,hash:ce,isTunnel:p,type:Y});const he=ec.computePosHash(D);this.vertexHashLookup.set(he,{prev:C,next:ce}),C=ce}}construct(a){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),p=H=>{H.primitiveLength=this.indexArray.length-H.primitiveOffset},g=new Nhe(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(a.portals,this.unevalEdges);const x=c(),b=c(),C=c(),I=(H,Y)=>{H.sort((oe,ce)=>oe.type===Y&&ce.type!==Y?-1:oe.type!==Y&&ce.type===Y?1:0);const J=H.findIndex(oe=>oe.type!==Y);return J>=0?J:H.length};let D=0;this.unevalEdges.length>0&&(D=I(this.unevalEdges,"none"),this.constructBridgeStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:D},this.tileToMeters)),p(C);const U=c(),q=c();if(this.unevalEdges.length>0){const H=this.unevalEdges.splice(D),Y=I(H,"tunnel")+D;this.unevalEdges.push(...H),this.constructTunnelStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:D},{min:D,max:Y})}p(U),g.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),p(q),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),p(b),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),p(x),this.maskSegments=ds.simpleSegment(0,q.primitiveOffset,0,q.primitiveLength),this.depthSegments=ds.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableBridgeSegments=ds.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.renderableTunnelSegments=ds.simpleSegment(0,U.primitiveOffset,0,U.primitiveLength),this.shadowCasterSegments=ds.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength)}update(a,c,p,g,x,b,C,I){this.bridgeProgramConfigurations.updatePaintArrays(a,c,x,p,g,b,C,I),this.tunnelProgramConfigurations.updatePaintArrays(a,c,x,p,g,b,C,I)}upload(a){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=a.createVertexBuffer(this.vertexPositions,xhe.members),this.vertexBufferNormal=a.createVertexBuffer(this.vertexNormals,bhe.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(a),this.tunnelProgramConfigurations.upload(a))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(a,c,p,g,x){const b=(C,I)=>{for(let D=0;D<I.length-1;D++){const U=I[D].featureIndex,q=I[D+1].vertexStart,H=a.feature(U);C.populatePaintArrays(q,H,U,{},p,c,g,void 0,x)}};b(this.bridgeProgramConfigurations,this.bridgeFeatureSections),b(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(a,c,p,g,x){const b=new Map;for(let C=g;C<x;C++){const I=p[C],D=I.a,U=I.b,q=ec.computePosHash(a[D]),H=ec.computePosHash(a[U]);let Y=b.get(q);Y||(Y={},b.set(q,Y));let J=b.get(H);J||(J={},b.set(H,J)),c[D]<=0&&c[U]<=0||(Y.to=U,J.from=D)}return b}isTerminalVertex(a,c){const p=ec.computePosHash(this.unevalVertices[a]),g=c.get(p);return!g||!g.from||!g.to}constructBridgeStructures(a,c,p,g,x,b){a.clearVertexLookup();const C=this.computeVertexConnections(c,p,g,x.min,x.max),I=1/b,D=.5*I,U=(er,Wt)=>Ae(er,c[Wt].x,c[Wt].y,p[Wt]*I),q=ie(),H=ie(),Y=ie(),J=ie(),oe=ie(),ce=(er,Wt)=>{const Lt=C.get(ec.computePosHash(c[Wt])),Gt=Lt.from,wt=Lt.to;if(!Gt||!wt)return;U(q,Gt),U(H,Wt),U(Y,wt),Dr(J),Rr(q,H)||(jt(oe,H,q),ke(J,oe)),Rr(Y,H)||(jt(oe,Y,H),xe(J,J,ke(oe,oe)));const xt=Je(J);return xt>0?Oe(er,J,1/xt):void 0};let he=Number.POSITIVE_INFINITY;this.sortSubarray(g,x.min,x.max,(er,Wt)=>er.featureInfo.featureIndex-Wt.featureInfo.featureIndex);const we=ie(),Te=ie(),Pe=ie(),He=ie(),Fe=ie(),Ye=ie(),tt=ie(),it=ie(),Tt=ie(),ft=[ie(),ie(),ie(),ie()],At=[ie(),ie(),ie(),ie()],Rt=[{coord:new at(0,0),height:0},{coord:new at(0,0),height:0}],Bt=(er,Wt)=>er>Wt;for(let er=x.min;er<x.max;er++){const Wt=g[er];if(!Wt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Rt,c,p,Wt,Bt))continue;const[Lt,Gt]=Rt;if(Ae(we,Lt.coord.x,Lt.coord.y,I*Lt.height),Ae(Te,Gt.coord.x,Gt.coord.y,I*Gt.height),Rr(we,Te))continue;jt(Pe,Te,we),ke(Pe,Pe);const wt=ce(it,Wt.a)||Pe,xt=ce(Tt,Wt.b)||Pe;Ae(He,wt[1],-wt[0],0),ke(He,He),Ae(Fe,xt[1],-xt[0],0),ke(Fe,Fe),_t(it,He,wt),ke(Ye,it),_t(it,Fe,xt),ke(tt,it),xe(ft[0],we,Oe(it,jt(it,He,Ye),D)),xe(ft[1],we,Oe(it,xe(it,He,Ye),D)),xe(ft[2],we,Oe(it,Ye,D)),ft[3]=we,xe(At[0],Te,Oe(it,jt(it,Fe,tt),D)),xe(At[1],Te,Oe(it,xe(it,Fe,tt),D)),xe(At[2],Te,Oe(it,tt,D)),At[3]=Te,he=this.addFeatureSection(Wt.featureInfo.featureIndex,he,this.bridgeFeatureSections,a);const Vt=a.addVertex(ft[0],He,b),Yt=a.addVertex(ft[1],He,b),Ft=a.addVertex(At[0],Fe,b),gr=a.addVertex(At[1],Fe,b);a.addTriangle(Vt,Yt,Ft),a.addTriangle(Yt,gr,Ft);const br=a.addVertex(ft[1],Ye,b),hr=a.addVertex(ft[2],Ye,b),ar=a.addVertex(At[1],tt,b),en=a.addVertex(At[2],tt,b);a.addTriangle(br,hr,ar),a.addTriangle(hr,en,ar),Le(He,He),Le(Fe,Fe);const lr=a.addVertex(ft[2],He,b),Lr=a.addVertex(ft[3],He,b),nn=a.addVertex(At[2],Fe,b),wn=a.addVertex(At[3],Fe,b);a.addTriangle(lr,Lr,nn),a.addTriangle(Lr,wn,nn);const Vn=this.isTerminalVertex(Wt.a,C),an=this.isTerminalVertex(Wt.b,C);Lt.height<.01&&Vn&&a.addQuad(ft[3],ft[2],ft[1],ft[0],Le(wt,wt),b),Gt.height<.01&&an&&a.addQuad(At[0],At[1],At[2],At[3],xt,b)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}constructTunnelStructures(a,c,p,g,x,b){a.clearVertexLookup();let C=Number.POSITIVE_INFINITY;const I=(he,we)=>he.featureInfo.featureIndex-we.featureInfo.featureIndex;this.sortSubarray(g,x.min,x.max,I),this.sortSubarray(g,b.min,b.max,I);const D=he=>ke(he,he),U=[{coord:new at(0,0),height:0},{coord:new at(0,0),height:0}],q=(he,we)=>he<we,H=ie(),Y=ie(),J=ie(),oe=ie(),ce=ie();for(let he=x.min;he<x.max;he++){if(!this.prepareEdgePoints(U,c,p,g[he],q))continue;const[we,Te]=U,Pe=D(Ae(ce,-(Te.coord.y-we.coord.y),Te.coord.x-we.coord.x,0));C=this.addFeatureSection(g[he].featureInfo.featureIndex,C,this.tunnelFeatureSections,a),a.addQuad(Ae(H,we.coord.x,we.coord.y,we.height),Ae(Y,Te.coord.x,Te.coord.y,Te.height),Ae(J,Te.coord.x,Te.coord.y,g[he].isTunnel?-.1:0),Ae(oe,we.coord.x,we.coord.y,g[he].isTunnel?-.1:0),Pe)}for(let he=b.min;he<b.max;he++){const we=g[he];we.isTunnel&&([we.a,we.b]=[we.b,we.a]);const Te=c[we.a],Pe=c[we.b],He=D(Ae(ce,-(Pe.y-Te.y),Pe.x-Te.x,0));C=this.addFeatureSection(we.featureInfo.featureIndex,C,this.tunnelFeatureSections,a),a.addQuad(Ae(H,Pe.x,Pe.y,0),Ae(Y,Te.x,Te.y,0),Ae(J,Te.x,Te.y,p[we.a]+4),Ae(oe,Pe.x,Pe.y,p[we.b]+4),He),a.addQuad(Ae(H,Te.x,Te.y,0),Ae(Y,Pe.x,Pe.y,0),Ae(J,Pe.x,Pe.y,p[we.b]+4),Ae(oe,Te.x,Te.y,p[we.a]+4),He)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}setElevatedPoint(a,c,p,g){a.coord.x=c,a.coord.y=p,a.height=g}prepareEdgePoints(a,c,p,g,x){let b=c[g.a].x,C=c[g.a].y,I=c[g.b].x,D=c[g.b].y,U=p[g.a],q=p[g.b];const H=x(U,0),Y=x(q,0);if(H&&Y)return this.setElevatedPoint(a[0],b,C,U),this.setElevatedPoint(a[1],I,D,q),!0;if(!H&&!Y)return!1;if(H){if(!Y){const J=q/(q-U);I=Kr(I,b,J),D=Kr(D,C,J),q=Kr(q,U,J)}}else{const J=U/(U-q);b=Kr(b,I,J),C=Kr(C,D,J),U=Kr(U,q,J)}return this.setElevatedPoint(a[0],b,C,U),this.setElevatedPoint(a[1],I,D,q),!0}prepareEdges(a,c){if(c.length===0)return;c.sort((C,I)=>C.hash===I.hash?I.polygonIdx-C.polygonIdx:I.hash>C.hash?1:-1);let p=0,g=0,x=0,b=c[p].polygonIdx;do g++,(g===c.length||c[p].hash!==c[g].hash)&&((g-p==1||c[g-1].polygonIdx!==b)&&(x<p&&(c[x]=c[p],c[p]=null),c[x].type="none",x++),p=g,p!==c.length&&(b=c[p].polygonIdx));while(p!==c.length);if(c.splice(x),c.length!==0&&a.length!==0){c.sort((D,U)=>D.portalHash<U.portalHash?1:-1);let C=0,I=0;for(;C!==c.length&&I!==a.length;){const D=c[C],U=a[I];D.portalHash>U.hash?C++:U.hash>D.portalHash?I++:(D.type=U.type,C++)}}}isOnBorder(a,c){return a<=0&&c<=0||a>=rr&&c>=rr}addFeatureSection(a,c,p,g){return a!==c&&(c=a,p.push({featureIndex:a,vertexStart:g.getVertexCount()}),g.clearVertexLookup()),c}sortSubarray(a,c,p,g){const x=a.slice(c,p);x.sort(g),a.splice(c,x.length,...x)}static computeEdgeHash(a,c){return(a.y===c.y&&a.x>c.x||a.y>c.y)&&([a,c]=[c,a]),BigInt(ec.computePosHash(a))<<32n|BigInt(ec.computePosHash(c))}static computePosHash(a){return((65535&a.x)<<16|65535&a.y)>>>0}}var KU,ZU={exports:{}},XU=(KU||(KU=1,function(u,a){(function(c){function p(ze,Re){return ze>Re?1:ze<Re?-1:0}var g=function(ze,Re){ze===void 0&&(ze=p),Re===void 0&&(Re=!1),this._compare=ze,this._root=null,this._size=0,this._noDuplicates=!!Re},x={size:{configurable:!0}};function b(ze,Re,Pt,sr,Ot){var or=Ot-sr;if(or>0){var jr=sr+Math.floor(or/2),Tr={key:Re[jr],data:Pt[jr],parent:ze};return Tr.left=b(Tr,Re,Pt,sr,jr),Tr.right=b(Tr,Re,Pt,jr+1,Ot),Tr}return null}function C(ze,Re,Pt,sr,Ot){if(!(Pt>=sr)){for(var or=ze[Pt+sr>>1],jr=Pt-1,Tr=sr+1;;){do jr++;while(Ot(ze[jr],or)<0);do Tr--;while(Ot(ze[Tr],or)>0);if(jr>=Tr)break;var ln=ze[jr];ze[jr]=ze[Tr],ze[Tr]=ln,ln=Re[jr],Re[jr]=Re[Tr],Re[Tr]=ln}C(ze,Re,Pt,Tr,Ot),C(ze,Re,Tr+1,sr,Ot)}}g.prototype.rotateLeft=function(ze){var Re=ze.right;Re&&(ze.right=Re.left,Re.left&&(Re.left.parent=ze),Re.parent=ze.parent),ze.parent?ze===ze.parent.left?ze.parent.left=Re:ze.parent.right=Re:this._root=Re,Re&&(Re.left=ze),ze.parent=Re},g.prototype.rotateRight=function(ze){var Re=ze.left;Re&&(ze.left=Re.right,Re.right&&(Re.right.parent=ze),Re.parent=ze.parent),ze.parent?ze===ze.parent.left?ze.parent.left=Re:ze.parent.right=Re:this._root=Re,Re&&(Re.right=ze),ze.parent=Re},g.prototype._splay=function(ze){for(;ze.parent;){var Re=ze.parent;Re.parent?Re.left===ze&&Re.parent.left===Re?(this.rotateRight(Re.parent),this.rotateRight(Re)):Re.right===ze&&Re.parent.right===Re?(this.rotateLeft(Re.parent),this.rotateLeft(Re)):Re.left===ze&&Re.parent.right===Re?(this.rotateRight(Re),this.rotateLeft(Re)):(this.rotateLeft(Re),this.rotateRight(Re)):Re.left===ze?this.rotateRight(Re):this.rotateLeft(Re)}},g.prototype.splay=function(ze){for(var Re,Pt,sr,Ot,or;ze.parent;)(Pt=(Re=ze.parent).parent)&&Pt.parent?((sr=Pt.parent).left===Pt?sr.left=ze:sr.right=ze,ze.parent=sr):(ze.parent=null,this._root=ze),Ot=ze.left,or=ze.right,ze===Re.left?(Pt&&(Pt.left===Re?(Re.right?(Pt.left=Re.right,Pt.left.parent=Pt):Pt.left=null,Re.right=Pt,Pt.parent=Re):(Ot?(Pt.right=Ot,Ot.parent=Pt):Pt.right=null,ze.left=Pt,Pt.parent=ze)),or?(Re.left=or,or.parent=Re):Re.left=null,ze.right=Re,Re.parent=ze):(Pt&&(Pt.right===Re?(Re.left?(Pt.right=Re.left,Pt.right.parent=Pt):Pt.right=null,Re.left=Pt,Pt.parent=Re):(or?(Pt.left=or,or.parent=Pt):Pt.left=null,ze.right=Pt,Pt.parent=ze)),Ot?(Re.right=Ot,Ot.parent=Re):Re.right=null,ze.left=Re,Re.parent=ze)},g.prototype.replace=function(ze,Re){ze.parent?ze===ze.parent.left?ze.parent.left=Re:ze.parent.right=Re:this._root=Re,Re&&(Re.parent=ze.parent)},g.prototype.minNode=function(ze){if(ze===void 0&&(ze=this._root),ze)for(;ze.left;)ze=ze.left;return ze},g.prototype.maxNode=function(ze){if(ze===void 0&&(ze=this._root),ze)for(;ze.right;)ze=ze.right;return ze},g.prototype.insert=function(ze,Re){var Pt=this._root,sr=null,Ot=this._compare;if(this._noDuplicates)for(;Pt;){if(sr=Pt,Ot(Pt.key,ze)===0)return;Pt=Ot(Pt.key,ze)<0?Pt.right:Pt.left}else for(;Pt;)sr=Pt,Pt=Ot(Pt.key,ze)<0?Pt.right:Pt.left;return Pt={key:ze,data:Re,left:null,right:null,parent:sr},sr?Ot(sr.key,Pt.key)<0?sr.right=Pt:sr.left=Pt:this._root=Pt,this.splay(Pt),this._size++,Pt},g.prototype.find=function(ze){for(var Re=this._root,Pt=this._compare;Re;){var sr=Pt(Re.key,ze);if(sr<0)Re=Re.right;else{if(!(sr>0))return Re;Re=Re.left}}return null},g.prototype.contains=function(ze){for(var Re=this._root,Pt=this._compare;Re;){var sr=Pt(ze,Re.key);if(sr===0)return!0;Re=sr<0?Re.left:Re.right}return!1},g.prototype.remove=function(ze){var Re=this.find(ze);if(!Re)return!1;if(this.splay(Re),Re.left)if(Re.right){var Pt=this.minNode(Re.right);Pt.parent!==Re&&(this.replace(Pt,Pt.right),Pt.right=Re.right,Pt.right.parent=Pt),this.replace(Re,Pt),Pt.left=Re.left,Pt.left.parent=Pt}else this.replace(Re,Re.left);else this.replace(Re,Re.right);return this._size--,!0},g.prototype.removeNode=function(ze){if(!ze)return!1;if(this.splay(ze),ze.left)if(ze.right){var Re=this.minNode(ze.right);Re.parent!==ze&&(this.replace(Re,Re.right),Re.right=ze.right,Re.right.parent=Re),this.replace(ze,Re),Re.left=ze.left,Re.left.parent=Re}else this.replace(ze,ze.left);else this.replace(ze,ze.right);return this._size--,!0},g.prototype.erase=function(ze){var Re=this.find(ze);if(Re){this.splay(Re);var Pt=Re.left,sr=Re.right,Ot=null;Pt&&(Pt.parent=null,Ot=this.maxNode(Pt),this.splay(Ot),this._root=Ot),sr&&(Pt?Ot.right=sr:this._root=sr,sr.parent=Ot),this._size--}},g.prototype.pop=function(){var ze=this._root,Re=null;if(ze){for(;ze.left;)ze=ze.left;Re={key:ze.key,data:ze.data},this.remove(ze.key)}return Re},g.prototype.next=function(ze){var Re=ze;if(Re)if(Re.right)for(Re=Re.right;Re&&Re.left;)Re=Re.left;else for(Re=ze.parent;Re&&Re.right===ze;)ze=Re,Re=Re.parent;return Re},g.prototype.prev=function(ze){var Re=ze;if(Re)if(Re.left)for(Re=Re.left;Re&&Re.right;)Re=Re.right;else for(Re=ze.parent;Re&&Re.left===ze;)ze=Re,Re=Re.parent;return Re},g.prototype.forEach=function(ze){for(var Re=this._root,Pt=[],sr=!1,Ot=0;!sr;)Re?(Pt.push(Re),Re=Re.left):Pt.length>0?(ze(Re=Pt.pop(),Ot++),Re=Re.right):sr=!0;return this},g.prototype.range=function(ze,Re,Pt,sr){for(var Ot=[],or=this._compare,jr=this._root;Ot.length!==0||jr;)if(jr)Ot.push(jr),jr=jr.left;else{if(or((jr=Ot.pop()).key,Re)>0)break;if(or(jr.key,ze)>=0&&Pt.call(sr,jr))return this;jr=jr.right}return this},g.prototype.keys=function(){for(var ze=this._root,Re=[],Pt=[],sr=!1;!sr;)ze?(Re.push(ze),ze=ze.left):Re.length>0?(ze=Re.pop(),Pt.push(ze.key),ze=ze.right):sr=!0;return Pt},g.prototype.values=function(){for(var ze=this._root,Re=[],Pt=[],sr=!1;!sr;)ze?(Re.push(ze),ze=ze.left):Re.length>0?(ze=Re.pop(),Pt.push(ze.data),ze=ze.right):sr=!0;return Pt},g.prototype.at=function(ze){for(var Re=this._root,Pt=[],sr=!1,Ot=0;!sr;)if(Re)Pt.push(Re),Re=Re.left;else if(Pt.length>0){if(Re=Pt.pop(),Ot===ze)return Re;Ot++,Re=Re.right}else sr=!0;return null},g.prototype.load=function(ze,Re,Pt){if(ze===void 0&&(ze=[]),Re===void 0&&(Re=[]),Pt===void 0&&(Pt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var sr=ze.length;return Pt&&C(ze,Re,0,sr-1,this._compare),this._root=b(null,ze,Re,0,sr),this._size=sr,this},g.prototype.min=function(){var ze=this.minNode(this._root);return ze?ze.key:null},g.prototype.max=function(){var ze=this.maxNode(this._root);return ze?ze.key:null},g.prototype.isEmpty=function(){return this._root===null},x.size.get=function(){return this._size},g.createTree=function(ze,Re,Pt,sr,Ot){return new g(Pt,Ot).load(ze,Re,sr)},Object.defineProperties(g.prototype,x);var I=0,D=1,U=2,q=3,H=0,Y=1,J=2,oe=3;function ce(ze,Re,Pt){Re===null?(ze.inOut=!1,ze.otherInOut=!0):(ze.isSubject===Re.isSubject?(ze.inOut=!Re.inOut,ze.otherInOut=Re.otherInOut):(ze.inOut=!Re.otherInOut,ze.otherInOut=Re.isVertical()?!Re.inOut:Re.inOut),Re&&(ze.prevInResult=!he(Re,Pt)||Re.isVertical()?Re.prevInResult:Re));var sr=he(ze,Pt);ze.resultTransition=sr?function(Ot,or){var jr,Tr=!Ot.inOut,ln=!Ot.otherInOut;switch(or){case H:jr=Tr&&ln;break;case Y:jr=Tr||ln;break;case oe:jr=Tr^ln;break;case J:jr=Ot.isSubject?Tr&&!ln:ln&&!Tr}return jr?1:-1}(ze,Pt):0}function he(ze,Re){switch(ze.type){case I:switch(Re){case H:return!ze.otherInOut;case Y:return ze.otherInOut;case J:return ze.isSubject&&ze.otherInOut||!ze.isSubject&&!ze.otherInOut;case oe:return!0}break;case U:return Re===H||Re===Y;case q:return Re===J;case D:return!1}return!1}var we=function(ze,Re,Pt,sr,Ot){this.left=Re,this.point=ze,this.otherEvent=Pt,this.isSubject=sr,this.type=Ot||I,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Te={inResult:{configurable:!0}};function Pe(ze,Re){return ze[0]===Re[0]&&ze[1]===Re[1]}we.prototype.isBelow=function(ze){var Re=this.point,Pt=this.otherEvent.point;return this.left?(Re[0]-ze[0])*(Pt[1]-ze[1])-(Pt[0]-ze[0])*(Re[1]-ze[1])>0:(Pt[0]-ze[0])*(Re[1]-ze[1])-(Re[0]-ze[0])*(Pt[1]-ze[1])>0},we.prototype.isAbove=function(ze){return!this.isBelow(ze)},we.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Te.inResult.get=function(){return this.resultTransition!==0},we.prototype.clone=function(){var ze=new we(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ze.contourId=this.contourId,ze.resultTransition=this.resultTransition,ze.prevInResult=this.prevInResult,ze.isExteriorRing=this.isExteriorRing,ze.inOut=this.inOut,ze.otherInOut=this.otherInOut,ze},Object.defineProperties(we.prototype,Te);var He=11102230246251565e-32,Fe=134217729,Ye=(3+8*He)*He;function tt(ze,Re,Pt,sr,Ot){var or,jr,Tr,ln,qr=Re[0],Sr=sr[0],Yn=0,Ai=0;Sr>qr==Sr>-qr?(or=qr,qr=Re[++Yn]):(or=Sr,Sr=sr[++Ai]);var Wr=0;if(Yn<ze&&Ai<Pt)for(Sr>qr==Sr>-qr?(Tr=or-((jr=qr+or)-qr),qr=Re[++Yn]):(Tr=or-((jr=Sr+or)-Sr),Sr=sr[++Ai]),or=jr,Tr!==0&&(Ot[Wr++]=Tr);Yn<ze&&Ai<Pt;)Sr>qr==Sr>-qr?(Tr=or-((jr=or+qr)-(ln=jr-or))+(qr-ln),qr=Re[++Yn]):(Tr=or-((jr=or+Sr)-(ln=jr-or))+(Sr-ln),Sr=sr[++Ai]),or=jr,Tr!==0&&(Ot[Wr++]=Tr);for(;Yn<ze;)Tr=or-((jr=or+qr)-(ln=jr-or))+(qr-ln),qr=Re[++Yn],or=jr,Tr!==0&&(Ot[Wr++]=Tr);for(;Ai<Pt;)Tr=or-((jr=or+Sr)-(ln=jr-or))+(Sr-ln),Sr=sr[++Ai],or=jr,Tr!==0&&(Ot[Wr++]=Tr);return or===0&&Wr!==0||(Ot[Wr++]=or),Wr}function it(ze){return new Float64Array(ze)}var Tt=33306690738754716e-32,ft=22204460492503146e-32,At=11093356479670487e-47,Rt=it(4),Bt=it(8),er=it(12),Wt=it(16),Lt=it(4);function Gt(ze,Re,Pt){var sr=function(Ot,or,jr,Tr,ln,qr){var Sr=(or-qr)*(jr-ln),Yn=(Ot-ln)*(Tr-qr),Ai=Sr-Yn;if(Sr===0||Yn===0||Sr>0!=Yn>0)return Ai;var Wr=Math.abs(Sr+Yn);return Math.abs(Ai)>=Tt*Wr?Ai:-function(Bn,Ci,fi,vs,es,zi,xi){var ni,cn,ii,Bi,Hr,qn,ts,Ts,Fs,ea,rs,Xs,Rl,Ys,rc,Ao,nu,Ml,nc=Bn-es,Co=fi-es,ic=Ci-zi,iu=vs-zi;Rt[0]=(rc=(Ts=nc-(ts=(qn=Fe*nc)-(qn-nc)))*(ea=iu-(Fs=(qn=Fe*iu)-(qn-iu)))-((Ys=nc*iu)-ts*Fs-Ts*Fs-ts*ea))-((rs=rc-(nu=(Ts=ic-(ts=(qn=Fe*ic)-(qn-ic)))*(ea=Co-(Fs=(qn=Fe*Co)-(qn-Co)))-((Ao=ic*Co)-ts*Fs-Ts*Fs-ts*ea)))+(Hr=rc-rs))+(Hr-nu),Rt[1]=(Rl=Ys-((Xs=Ys+rs)-(Hr=Xs-Ys))+(rs-Hr))-((rs=Rl-Ao)+(Hr=Rl-rs))+(Hr-Ao),Rt[2]=Xs-((Ml=Xs+rs)-(Hr=Ml-Xs))+(rs-Hr),Rt[3]=Ml;var Ya=function(dm,ph){for(var VC=ph[0],Nx=1;Nx<4;Nx++)VC+=ph[Nx];return VC}(0,Rt),ll=ft*xi;if(Ya>=ll||-Ya>=ll||(ni=Bn-(nc+(Hr=Bn-nc))+(Hr-es),ii=fi-(Co+(Hr=fi-Co))+(Hr-es),cn=Ci-(ic+(Hr=Ci-ic))+(Hr-zi),Bi=vs-(iu+(Hr=vs-iu))+(Hr-zi),ni===0&&cn===0&&ii===0&&Bi===0)||(ll=At*xi+Ye*Math.abs(Ya),(Ya+=nc*Bi+iu*ni-(ic*ii+Co*cn))>=ll||-Ya>=ll))return Ya;Lt[0]=(rc=(Ts=ni-(ts=(qn=Fe*ni)-(qn-ni)))*(ea=iu-(Fs=(qn=Fe*iu)-(qn-iu)))-((Ys=ni*iu)-ts*Fs-Ts*Fs-ts*ea))-((rs=rc-(nu=(Ts=cn-(ts=(qn=Fe*cn)-(qn-cn)))*(ea=Co-(Fs=(qn=Fe*Co)-(qn-Co)))-((Ao=cn*Co)-ts*Fs-Ts*Fs-ts*ea)))+(Hr=rc-rs))+(Hr-nu),Lt[1]=(Rl=Ys-((Xs=Ys+rs)-(Hr=Xs-Ys))+(rs-Hr))-((rs=Rl-Ao)+(Hr=Rl-rs))+(Hr-Ao),Lt[2]=Xs-((Ml=Xs+rs)-(Hr=Ml-Xs))+(rs-Hr),Lt[3]=Ml;var fh=tt(4,Rt,4,Lt,Bt);Lt[0]=(rc=(Ts=nc-(ts=(qn=Fe*nc)-(qn-nc)))*(ea=Bi-(Fs=(qn=Fe*Bi)-(qn-Bi)))-((Ys=nc*Bi)-ts*Fs-Ts*Fs-ts*ea))-((rs=rc-(nu=(Ts=ic-(ts=(qn=Fe*ic)-(qn-ic)))*(ea=ii-(Fs=(qn=Fe*ii)-(qn-ii)))-((Ao=ic*ii)-ts*Fs-Ts*Fs-ts*ea)))+(Hr=rc-rs))+(Hr-nu),Lt[1]=(Rl=Ys-((Xs=Ys+rs)-(Hr=Xs-Ys))+(rs-Hr))-((rs=Rl-Ao)+(Hr=Rl-rs))+(Hr-Ao),Lt[2]=Xs-((Ml=Xs+rs)-(Hr=Ml-Xs))+(rs-Hr),Lt[3]=Ml;var um=tt(fh,Bt,4,Lt,er);Lt[0]=(rc=(Ts=ni-(ts=(qn=Fe*ni)-(qn-ni)))*(ea=Bi-(Fs=(qn=Fe*Bi)-(qn-Bi)))-((Ys=ni*Bi)-ts*Fs-Ts*Fs-ts*ea))-((rs=rc-(nu=(Ts=cn-(ts=(qn=Fe*cn)-(qn-cn)))*(ea=ii-(Fs=(qn=Fe*ii)-(qn-ii)))-((Ao=cn*ii)-ts*Fs-Ts*Fs-ts*ea)))+(Hr=rc-rs))+(Hr-nu),Lt[1]=(Rl=Ys-((Xs=Ys+rs)-(Hr=Xs-Ys))+(rs-Hr))-((rs=Rl-Ao)+(Hr=Rl-rs))+(Hr-Ao),Lt[2]=Xs-((Ml=Xs+rs)-(Hr=Ml-Xs))+(rs-Hr),Lt[3]=Ml;var kx=tt(um,er,4,Lt,Wt);return Wt[kx-1]}(Ot,or,jr,Tr,ln,qr,Wr)}(ze[0],ze[1],Re[0],Re[1],Pt[0],Pt[1]);return sr>0?-1:sr<0?1:0}function wt(ze,Re){var Pt=ze.point,sr=Re.point;return Pt[0]>sr[0]?1:Pt[0]<sr[0]?-1:Pt[1]!==sr[1]?Pt[1]>sr[1]?1:-1:function(Ot,or,jr,Tr){return Ot.left!==or.left?Ot.left?1:-1:Gt(jr,Ot.otherEvent.point,or.otherEvent.point)!==0?Ot.isBelow(or.otherEvent.point)?-1:1:!Ot.isSubject&&or.isSubject?1:-1}(ze,Re,Pt)}function xt(ze,Re,Pt){var sr=new we(Re,!1,ze,ze.isSubject),Ot=new we(Re,!0,ze.otherEvent,ze.isSubject);return Pe(ze.point,ze.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ze),sr.contourId=Ot.contourId=ze.contourId,wt(Ot,ze.otherEvent)>0&&(ze.otherEvent.left=!0,Ot.left=!1),ze.otherEvent.otherEvent=Ot,ze.otherEvent=sr,Pt.push(Ot),Pt.push(sr),Pt}function Vt(ze,Re){return ze[0]*Re[1]-ze[1]*Re[0]}function Yt(ze,Re){return ze[0]*Re[0]+ze[1]*Re[1]}function Ft(ze,Re,Pt){var sr=function(ln,qr,Sr,Yn,Ai){var Wr=[qr[0]-ln[0],qr[1]-ln[1]],Bn=[Yn[0]-Sr[0],Yn[1]-Sr[1]];function Ci(qn,ts,Ts){return[qn[0]+ts*Ts[0],qn[1]+ts*Ts[1]]}var fi=[Sr[0]-ln[0],Sr[1]-ln[1]],vs=Vt(Wr,Bn),es=vs*vs,zi=Yt(Wr,Wr);if(es>0){var xi=Vt(fi,Bn)/vs;if(xi<0||xi>1)return null;var ni=Vt(fi,Wr)/vs;return ni<0||ni>1?null:xi===0||xi===1?[Ci(ln,xi,Wr)]:ni===0||ni===1?[Ci(Sr,ni,Bn)]:[Ci(ln,xi,Wr)]}if((es=(vs=Vt(fi,Wr))*vs)>0)return null;var cn=Yt(Wr,fi)/zi,ii=cn+Yt(Wr,Bn)/zi,Bi=Math.min(cn,ii),Hr=Math.max(cn,ii);return Bi<=1&&Hr>=0?Bi===1?[Ci(ln,Bi>0?Bi:0,Wr)]:Hr===0?[Ci(ln,Hr<1?Hr:1,Wr)]:[Ci(ln,Bi>0?Bi:0,Wr),Ci(ln,Hr<1?Hr:1,Wr)]:null}(ze.point,ze.otherEvent.point,Re.point,Re.otherEvent.point),Ot=sr?sr.length:0;if(Ot===0||Ot===1&&(Pe(ze.point,Re.point)||Pe(ze.otherEvent.point,Re.otherEvent.point))||Ot===2&&ze.isSubject===Re.isSubject)return 0;if(Ot===1)return Pe(ze.point,sr[0])||Pe(ze.otherEvent.point,sr[0])||xt(ze,sr[0],Pt),Pe(Re.point,sr[0])||Pe(Re.otherEvent.point,sr[0])||xt(Re,sr[0],Pt),1;var or=[],jr=!1,Tr=!1;return Pe(ze.point,Re.point)?jr=!0:wt(ze,Re)===1?or.push(Re,ze):or.push(ze,Re),Pe(ze.otherEvent.point,Re.otherEvent.point)?Tr=!0:wt(ze.otherEvent,Re.otherEvent)===1?or.push(Re.otherEvent,ze.otherEvent):or.push(ze.otherEvent,Re.otherEvent),jr&&Tr||jr?(Re.type=D,ze.type=Re.inOut===ze.inOut?U:q,jr&&!Tr&&xt(or[1].otherEvent,or[0].point,Pt),2):Tr?(xt(or[0],or[1].point,Pt),3):or[0]!==or[3].otherEvent?(xt(or[0],or[1].point,Pt),xt(or[1],or[2].point,Pt),3):(xt(or[0],or[1].point,Pt),xt(or[3].otherEvent,or[2].point,Pt),3)}function gr(ze,Re){if(ze===Re)return 0;if(Gt(ze.point,ze.otherEvent.point,Re.point)!==0||Gt(ze.point,ze.otherEvent.point,Re.otherEvent.point)!==0)return Pe(ze.point,Re.point)?ze.isBelow(Re.otherEvent.point)?-1:1:ze.point[0]===Re.point[0]?ze.point[1]<Re.point[1]?-1:1:wt(ze,Re)===1?Re.isAbove(ze.point)?-1:1:ze.isBelow(Re.point)?-1:1;if(ze.isSubject!==Re.isSubject)return ze.isSubject?-1:1;var Pt=ze.point,sr=Re.point;return Pt[0]===sr[0]&&Pt[1]===sr[1]?(Pt=ze.otherEvent.point)[0]===(sr=Re.otherEvent.point)[0]&&Pt[1]===sr[1]?0:ze.contourId>Re.contourId?1:-1:wt(ze,Re)===1?1:-1}var br=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function hr(ze,Re,Pt,sr){var Ot,or=ze+1,jr=Re[ze].point,Tr=Re.length;for(or<Tr&&(Ot=Re[or].point);or<Tr&&Ot[0]===jr[0]&&Ot[1]===jr[1];){if(!Pt[or])return or;++or<Tr&&(Ot=Re[or].point)}for(or=ze-1;Pt[or]&&or>sr;)or--;return or}br.prototype.isExterior=function(){return this.holeOf==null};var ar=lr,en=lr;function lr(ze,Re){if(!(this instanceof lr))return new lr(ze,Re);if(this.data=ze||[],this.length=this.data.length,this.compare=Re||Lr,this.length>0)for(var Pt=(this.length>>1)-1;Pt>=0;Pt--)this._down(Pt)}function Lr(ze,Re){return ze<Re?-1:ze>Re?1:0}lr.prototype={push:function(ze){this.data.push(ze),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ze=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ze}},peek:function(){return this.data[0]},_up:function(ze){for(var Re=this.data,Pt=this.compare,sr=Re[ze];ze>0;){var Ot=ze-1>>1,or=Re[Ot];if(Pt(sr,or)>=0)break;Re[ze]=or,ze=Ot}Re[ze]=sr},_down:function(ze){for(var Re=this.data,Pt=this.compare,sr=this.length>>1,Ot=Re[ze];ze<sr;){var or=1+(ze<<1),jr=or+1,Tr=Re[or];if(jr<this.length&&Pt(Re[jr],Tr)<0&&(or=jr,Tr=Re[jr]),Pt(Tr,Ot)>=0)break;Re[ze]=Tr,ze=or}Re[ze]=Ot}},ar.default=en;var nn=Math.max,wn=Math.min,Vn=0;function an(ze,Re,Pt,sr,Ot,or){var jr,Tr,ln,qr,Sr,Yn;for(jr=0,Tr=ze.length-1;jr<Tr;jr++)if(qr=ze[jr+1],Sr=new we(ln=ze[jr],!1,void 0,Re),Yn=new we(qr,!1,Sr,Re),Sr.otherEvent=Yn,ln[0]!==qr[0]||ln[1]!==qr[1]){Sr.contourId=Yn.contourId=Pt,or||(Sr.isExteriorRing=!1,Yn.isExteriorRing=!1),wt(Sr,Yn)>0?Yn.left=!0:Sr.left=!0;var Ai=ln[0],Wr=ln[1];Ot[0]=wn(Ot[0],Ai),Ot[1]=wn(Ot[1],Wr),Ot[2]=nn(Ot[2],Ai),Ot[3]=nn(Ot[3],Wr),sr.push(Sr),sr.push(Yn)}}var ti=[];function ri(ze,Re,Pt){typeof ze[0][0][0]=="number"&&(ze=[ze]),typeof Re[0][0][0]=="number"&&(Re=[Re]);var sr=function(Wr,Bn,Ci){var fi=null;return Wr.length*Bn.length==0&&(Ci===H?fi=ti:Ci===J?fi=Wr:Ci!==Y&&Ci!==oe||(fi=Wr.length===0?Bn:Wr)),fi}(ze,Re,Pt);if(sr)return sr===ti?null:sr;var Ot=[1/0,1/0,-1/0,-1/0],or=[1/0,1/0,-1/0,-1/0],jr=function(Wr,Bn,Ci,fi,vs){var es,zi,xi,ni,cn,ii,Bi=new ar(null,wt);for(xi=0,ni=Wr.length;xi<ni;xi++)for(cn=0,ii=(es=Wr[xi]).length;cn<ii;cn++)(zi=cn===0)&&Vn++,an(es[cn],!0,Vn,Bi,Ci,zi);for(xi=0,ni=Bn.length;xi<ni;xi++)for(cn=0,ii=(es=Bn[xi]).length;cn<ii;cn++)zi=cn===0,vs===J&&(zi=!1),zi&&Vn++,an(es[cn],!1,Vn,Bi,fi,zi);return Bi}(ze,Re,Ot,or,Pt);if(sr=function(Wr,Bn,Ci,fi,vs){var es=null;return(Ci[0]>fi[2]||fi[0]>Ci[2]||Ci[1]>fi[3]||fi[1]>Ci[3])&&(vs===H?es=ti:vs===J?es=Wr:vs!==Y&&vs!==oe||(es=Wr.concat(Bn))),es}(ze,Re,Ot,or,Pt))return sr===ti?null:sr;for(var Tr=function(Wr){var Bn,Ci,fi=function(xi){var ni,cn,ii,Bi,Hr=[];for(cn=0,ii=xi.length;cn<ii;cn++)((ni=xi[cn]).left&&ni.inResult||!ni.left&&ni.otherEvent.inResult)&&Hr.push(ni);for(var qn=!1;!qn;)for(qn=!0,cn=0,ii=Hr.length;cn<ii;cn++)cn+1<ii&&wt(Hr[cn],Hr[cn+1])===1&&(Bi=Hr[cn],Hr[cn]=Hr[cn+1],Hr[cn+1]=Bi,qn=!1);for(cn=0,ii=Hr.length;cn<ii;cn++)(ni=Hr[cn]).otherPos=cn;for(cn=0,ii=Hr.length;cn<ii;cn++)(ni=Hr[cn]).left||(Bi=ni.otherPos,ni.otherPos=ni.otherEvent.otherPos,ni.otherEvent.otherPos=Bi);return Hr}(Wr),vs={},es=[],zi=function(){if(!vs[Bn]){var xi=es.length,ni=function(Hr,qn,ts){var Ts=new br;if(Hr.prevInResult!=null){var Fs=Hr.prevInResult,ea=Fs.outputContourId;if(Fs.resultTransition>0){var rs=qn[ea];if(rs.holeOf!=null){var Xs=rs.holeOf;qn[Xs].holeIds.push(ts),Ts.holeOf=Xs,Ts.depth=qn[ea].depth}else qn[ea].holeIds.push(ts),Ts.holeOf=ea,Ts.depth=qn[ea].depth+1}else Ts.holeOf=null,Ts.depth=qn[ea].depth}else Ts.holeOf=null,Ts.depth=0;return Ts}(fi[Bn],es,xi),cn=function(Hr){vs[Hr]=!0,Hr<fi.length&&fi[Hr]&&(fi[Hr].outputContourId=xi)},ii=Bn,Bi=Bn;for(ni.points.push(fi[Bn].point);cn(ii),cn(ii=fi[ii].otherPos),ni.points.push(fi[ii].point),!((ii=hr(ii,fi,vs,Bi))==Bi||ii>=fi.length)&&fi[ii];);es.push(ni)}};for(Bn=0,Ci=fi.length;Bn<Ci;Bn++)zi();return es}(function(Wr,Bn,Ci,fi,vs,es){for(var zi,xi,ni,cn=new g(gr),ii=[],Bi=Math.min(fi[2],vs[2]);Wr.length!==0;){var Hr=Wr.pop();if(ii.push(Hr),es===H&&Hr.point[0]>Bi||es===J&&Hr.point[0]>fi[2])break;if(Hr.left){xi=zi=cn.insert(Hr),zi=zi!==(ni=cn.minNode())?cn.prev(zi):null,xi=cn.next(xi);var qn=zi?zi.key:null;if(ce(Hr,qn,es),xi&&Ft(Hr,xi.key,Wr)===2&&(ce(Hr,qn,es),ce(xi.key,Hr,es)),zi&&Ft(zi.key,Hr,Wr)===2){var ts=zi;ce(qn,(ts=ts!==ni?cn.prev(ts):null)?ts.key:null,es),ce(Hr,qn,es)}}else xi=zi=cn.find(Hr=Hr.otherEvent),zi&&xi&&(zi=zi!==ni?cn.prev(zi):null,xi=cn.next(xi),cn.remove(Hr),xi&&zi&&Ft(zi.key,xi.key,Wr))}return ii}(jr,0,0,Ot,or,Pt)),ln=[],qr=0;qr<Tr.length;qr++){var Sr=Tr[qr];if(Sr.isExterior()){for(var Yn=[Sr.points],Ai=0;Ai<Sr.holeIds.length;Ai++)Yn.push(Tr[Sr.holeIds[Ai]].points);ln.push(Yn)}}return ln}var ls={UNION:Y,DIFFERENCE:J,INTERSECTION:H,XOR:oe};c.diff=function(ze,Re){return ri(ze,Re,J)},c.intersection=function(ze,Re){return ri(ze,Re,H)},c.operations=ls,c.union=function(ze,Re){return ri(ze,Re,Y)},c.xor=function(ze,Re){return ri(ze,Re,oe)},Object.defineProperty(c,"__esModule",{value:!0})})(a)}(0,ZU.exports)),ZU.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function tC(u,a,c,p){const g=[],x=p===0?(b,C,I,D,U,q)=>{b.push(new at(q,I+(q-C)/(D-C)*(U-I)))}:(b,C,I,D,U,q)=>{b.push(new at(C+(q-I)/(U-I)*(D-C),q))};for(const b of u){const C=[];for(const I of b){if(I.length<=2)continue;const D=[];for(let H=0;H<I.length-1;H++){const Y=I[H].x,J=I[H].y,oe=I[H+1].x,ce=I[H+1].y,he=p===0?Y:J,we=p===0?oe:ce;he<a?we>a&&x(D,Y,J,oe,ce,a):he>c?we<c&&x(D,Y,J,oe,ce,c):D.push(I[H]),we<a&&he>=a&&x(D,Y,J,oe,ce,a),we>c&&he<=c&&x(D,Y,J,oe,ce,c)}let U=I[I.length-1];const q=p===0?U.x:U.y;q>=a&&q<=c&&D.push(U),D.length&&(U=D[D.length-1],D[0].x===U.x&&D[0].y===U.y||D.push(D[0]),C.push(D))}C.length&&g.push(C)}return g}function Ihe(u,a){const c=$R(u),p=$R([a]),g=XU.intersection(c,p);return g==null?[]:YU(g)}function Rhe(u,a){let p=$R(u,65536);const g=[];for(;a.valid();a.next()){const[x,b]=a.get(),C=x.x*65536,I=x.y*65536,D=b.x*65536,U=b.y*65536,q=D-C,H=U-I,Y=Math.hypot(q,H);if(Y===0)continue;const J=Math.trunc(H/Y*3),oe=-Math.trunc(q/Y*3);g.push([[[C,I],[D,U],[D+J,U+oe],[C+J,I+oe],[C,I]]])}return g.length>0&&(p=XU.diff(p,g)),YU(p,1/65536)}function $R(u,a=1){return[u.map(c=>c.map(p=>[p.x*a,p.y*a]))]}function YU(u,a=1){return u.map(c=>c.map((p,g)=>{const x=p.map(b=>new at(b[0]*a,b[1]*a).round());return g>0&&x.reverse(),x}))}class UR{constructor(a,c){this.layoutVertexArray=new _l,this.indexArray=new is,this.lineIndexArray=new Oc,this.triangleSegments=new ds,this.lineSegments=new ds,this.programConfigurations=new tu(a.layers,{zoom:a.zoom,lut:a.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new hd)}update(a,c,p,g,x,b,C,I){this.programConfigurations.updatePaintArrays(a,c,x,p,g,b,C,I)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,vhe.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.lineIndexBuffer=a.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,_he.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(a,c,p,g,x,b,C){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,p,g,x,b,void 0,C)}}class VR{constructor(a){this.zoom=a.zoom,this.pixelRatio=a.pixelRatio,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=a.lut,this.bufferData=new UR(a,!1),this.elevationBufferData=new UR(a,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=a.sourceLayerIndex,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.hasPattern=zR("fill",this.layers,this.pixelRatio,c);const x=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:C,id:I,index:D,sourceLayerIndex:U}of a){const q=this.layers[0]._featureFilter.needGeometry,H=yt(C,q);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),H,p))continue;const Y=x?x.evaluate(H,{},p,c.availableImages):void 0,J={id:I,properties:C.properties,type:C.type,sourceLayerIndex:U,index:D,geometry:q?H.geometry:Nt(C,p,g),patterns:{},sortKey:Y};b.push(J)}x&&b.sort((C,I)=>C.sortKey-I.sortKey);for(const C of b){const{geometry:I,index:D,sourceLayerIndex:U}=C;if(this.hasPattern){const q=BR("fill",this.layers,C,this.zoom,this.pixelRatio,c);this.patternFeatures.push(q)}else this.addFeature(C,I,D,p,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(a[D].feature,I,D,U,this.index)}}update(a,c,p,g,x,b,C){this.bufferData.update(a,c,p,g,x,b,C,this.worldview),this.elevationBufferData.update(a,c,p,g,x,b,C,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(a,c,p,g,x,b,C,this.worldview)}addFeatures(a,c,p,g,x,b){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,c,p,g,b,a.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(a){this.bufferData.upload(a),this.elevationBufferData.upload(a),this.elevatedStructures&&this.elevatedStructures.upload(a)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(a,c,p,g,x,b=[],C,I){const D=Y1(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(a,D,g,p,I):this.addGeometry(D,this.bufferData),this.bufferData.populatePaintArrays(a,p,x,b,g,C,this.worldview),this.elevationBufferData.populatePaintArrays(a,p,x,b,g,C,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(a,c,p,g,x){this.elevatedStructures&&(this.elevatedStructures.construct(a),this.elevatedStructures.populatePaintArrays(c,p,g,x,this.worldview))}addElevatedRoadFeature(a,c,p,g,x){const b=new Array,C=Qr.getElevationFeature(a,x);if(!C)return void this.addGeometry(c,this.bufferData);{const D=this.clipPolygonsToTile(c,1);D.length>0&&b.push({polygons:D,elevationFeature:C,elevationTileID:p})}const I={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(a,{},p),featureIndex:g};for(const D of b)if(D.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ec(D.elevationTileID,this.layers,this.zoom,this.lut));const q=D.elevationFeature.isTunnel();let H=0;a.properties.hasOwnProperty(mr)&&(H=+a.properties[mr]);for(const Y of D.polygons)this.elevatedStructures.addPortalCandidates(D.elevationFeature.id,Y,q,D.elevationFeature,H)}D.elevationFeature.constantHeight==null&&(D.polygons=this.prepareElevatedPolygons(D.polygons,D.elevationFeature,D.elevationTileID));const U=new Un(p,D.elevationTileID);this.addElevatedGeometry(D.polygons,U,D.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,g,I)}}addElevatedGeometry(a,c,p,g,x,b){const C={elevation:p,elevationSampler:c,bias:g,index:x,featureInfo:b},[I,D]=this.addGeometry(a,this.elevationBufferData,C);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:I,max:D}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,I),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,D))}addGeometry(a,c,p){let g=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,b=null;p&&(b=p.elevationSampler.constantElevation(p.elevation,p.bias),b!=null&&(g=b,x=b));const C=(I,D,U)=>{if(p!=null)if(D.push(I),b!=null)c.elevatedLayoutVertexArray.emplaceBack(b),U.push(b);else{const q=p.elevationSampler.pointElevation(I,p.elevation,p.bias);c.elevatedLayoutVertexArray.emplaceBack(q),U.push(q),g=Math.min(g,q),x=Math.max(x,q)}};for(const I of a){let D=0;for(const Te of I)D+=Te.length;const U=c.triangleSegments.prepareSegment(D,c.layoutVertexArray,c.indexArray),q=U.vertexLength,H=[],Y=[],J=[],oe=[],ce=[],he=c.layoutVertexArray.length;for(const Te of I){if(Te.length===0)continue;Te!==I[0]&&Y.push(H.length/2);const Pe=c.lineSegments.prepareSegment(Te.length,c.layoutVertexArray,c.lineIndexArray),He=Pe.vertexLength;p&&ce.push(c.layoutVertexArray.length-he),C(Te[0],J,oe),c.layoutVertexArray.emplaceBack(Te[0].x,Te[0].y),c.lineIndexArray.emplaceBack(He+Te.length-1,He),H.push(Te[0].x),H.push(Te[0].y);for(let Fe=1;Fe<Te.length;Fe++)C(Te[Fe],J,oe),c.layoutVertexArray.emplaceBack(Te[Fe].x,Te[Fe].y),c.lineIndexArray.emplaceBack(He+Fe-1,He+Fe),H.push(Te[Fe].x),H.push(Te[Fe].y);Pe.vertexLength+=Te.length,Pe.primitiveLength+=Te.length}const we=hx(H,Y);for(let Te=0;Te<we.length;Te+=3)c.indexArray.emplaceBack(q+we[Te],q+we[Te+1],q+we[Te+2]);if(we.length>0&&p&&this.elevationMode==="hd-road-base"){const Te=p.elevation.isTunnel(),Pe=p.elevation.safeArea,He=this.elevatedStructures.addVertices(J,oe);this.elevatedStructures.addTriangles(we,He,Te);const Fe=ce.length;if(Fe>0){for(let Ye=0;Ye<Fe-1;Ye++)this.elevatedStructures.addRenderableRing(p.index,ce[Ye]+He,ce[Ye+1]-ce[Ye],Te,Pe,p.featureInfo);this.elevatedStructures.addRenderableRing(p.index,ce[Fe-1]+He,J.length-ce[Fe-1],Te,Pe,p.featureInfo)}}U.vertexLength+=D,U.primitiveLength+=we.length/3}return[g,x]}prepareElevatedPolygons(a,c,p){const g=1/Ze(p),x=[];for(const b of a){const C=Rhe(b,new Wi(c,g));x.push(...C)}return x}clipPolygonsToTile(a,c){const p=-c,g=-c,x=rr+c,b=rr+c;let C=0;const I=[],D=[];for(;C<a.length;C++){const H=a[C],Y=ey(H);(Y.min.x>=p&&Y.max.x<=x&&Y.min.y>=g&&Y.max.y<=b?I:D).push(H)}if(I.length===a.length)return a;const U=[new at(p,g),new at(x,g),new at(x,b),new at(p,b),new at(p,g)],q=I;for(const H of D)q.push(...Ihe(H,U));return q}}let JU,QU,eV,tV;_r(VR,"FillBucket",{omit:["layers","patternFeatures"]}),_r(UR,"FillBufferData"),_r(ec,"ElevatedStructures");class rC{constructor(a,c,p,g){if(this.triangleCount=c.length/3,this.min=new at(0,0),this.max=new at(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||a.length===0)return;const[x,b]=[a[0].clone(),a[0].clone()];for(let q=1;q<a.length;++q){const H=a[q];x.x=Math.min(x.x,H.x),x.y=Math.min(x.y,H.y),b.x=Math.max(b.x,H.x),b.y=Math.max(b.y,H.y)}if(g){const q=Math.ceil(Math.max(b.x-x.x,b.y-x.y)/g);p=Math.max(p,q)}if(p===0)return;this.min=x,this.max=b;const C=this.max.sub(this.min);C.x=Math.max(C.x,1),C.y=Math.max(C.y,1);const I=Math.max(C.x,C.y)/p;this.cellsX=Math.max(1,Math.ceil(C.x/I)),this.cellsY=Math.max(1,Math.ceil(C.y/I)),this.xScale=1/I,this.yScale=1/I;const D=[];for(let q=0;q<this.triangleCount;q++){const H=a[c[3*q+0]].sub(this.min),Y=a[c[3*q+1]].sub(this.min),J=a[c[3*q+2]].sub(this.min),oe=dh(Math.floor(Math.min(H.x,Y.x,J.x)),this.xScale,this.cellsX),ce=dh(Math.floor(Math.max(H.x,Y.x,J.x)),this.xScale,this.cellsX),he=dh(Math.floor(Math.min(H.y,Y.y,J.y)),this.yScale,this.cellsY),we=dh(Math.floor(Math.max(H.y,Y.y,J.y)),this.yScale,this.cellsY),Te=new at(0,0),Pe=new at(0,0),He=new at(0,0),Fe=new at(0,0);for(let Ye=he;Ye<=we;++Ye){Te.y=Pe.y=Ye*I,He.y=Fe.y=(Ye+1)*I;for(let tt=oe;tt<=ce;++tt)Te.x=He.x=tt*I,Pe.x=Fe.x=(tt+1)*I,(Ls(H,Y,J,Te,Pe,Fe)||Ls(H,Y,J,Te,Fe,He))&&D.push({cellIdx:Ye*this.cellsX+tt,triIdx:q})}}if(D.length===0)return;D.sort((q,H)=>q.cellIdx-H.cellIdx||q.triIdx-H.triIdx);let U=0;for(;U<D.length;){const q=D[U].cellIdx,H={start:this.payload.length,len:0};for(;U<D.length&&D[U].cellIdx===q;)++H.len,this.payload.push(D[U++].triIdx);this.cells[q]=H}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(a,c){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>a.x||a.y>this.max.y||this.min.y>a.y)return;const p=dh(a.x-this.min.x,this.xScale,this.cellsX),g=dh(a.y-this.min.y,this.yScale,this.cellsY),x=this.cells[g*this.cellsX+p];if(x){this._lazyInitLookup();for(let b=0;b<x.len;b++){const C=this.payload[x.start+b],I=Math.floor(C/8),D=1<<C%8;if(!(this.lookup[I]&D)&&(this.lookup[I]|=D,c.push(C),c.length===this.triangleCount))return}}}query(a,c,p){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>c.x||a.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const g=dh(a.x-this.min.x,this.xScale,this.cellsX),x=dh(c.x-this.min.x,this.xScale,this.cellsX),b=dh(a.y-this.min.y,this.yScale,this.cellsY),C=dh(c.y-this.min.y,this.yScale,this.cellsY);for(let I=b;I<=C;I++)for(let D=g;D<=x;D++){const U=this.cells[I*this.cellsX+D];if(U)for(let q=0;q<U.len;q++){const H=this.payload[U.start+q],Y=Math.floor(H/8),J=1<<H%8;if(!(this.lookup[Y]&J)&&(this.lookup[Y]|=J,p.push(H),p.length===this.triangleCount))return}}}}function dh(u,a,c){return Math.max(0,Math.min(c-1,Math.floor(u*a)))}_r(rC,"TriangleGridIndex");class rV{constructor(a){this.zoom=a.zoom,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){for(const p of this.footprints)c.push({footprint:p,id:a})}updateAppearances(a,c,p,g){}populate(a,c,p,g){const x=[];for(const{feature:b,id:C,index:I,sourceLayerIndex:D}of a){const U=this.layers[0]._featureFilter.needGeometry,q=yt(b,U);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),q,p))continue;const H={id:C,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:U?q.geometry:Nt(b,p,g),patterns:{}};x.push(H)}for(const b of x){const{geometry:C,index:I,sourceLayerIndex:D}=b;this.addFeature(b,C,I,p,{},c.availableImages,c.brightness),c.featureIndex.insert(a[I].feature,C,I,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(a){}update(a,c,p,g,x,b,C){}destroy(){}addFeature(a,c,p,g,x,b=[],C){for(const I of Y1(c,2)){const D=[],U=[],q=[],H=new at(1/0,1/0),Y=new at(-1/0,-1/0);for(const ce of I)if(ce.length!==0){ce!==I[0]&&q.push(U.length/2);for(let he=0;he<ce.length;he++)U.push(ce[he].x),U.push(ce[he].y),D.push(ce[he]),H.x=Math.min(H.x,ce[he].x),H.y=Math.min(H.y,ce[he].y),Y.x=Math.max(Y.x,ce[he].x),Y.y=Math.max(Y.y,ce[he].y)}const J=hx(U,q),oe=new rC(D,J,8,256);this.footprints.push({vertices:D,indices:J,grid:oe,min:H,max:Y})}}}_r(rV,"ClipBucket",{omit:["layers"]});const Mhe=Cn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dhe=Cn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Lhe=Cn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Fhe=Cn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),zhe=Cn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Bhe=Cn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),$he=Cn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Uhe}=Mhe,J1=Number.MAX_SAFE_INTEGER,nV=J1-1;function iV(u,a,c,p){return u.order<a||u.order===J1||!(u.clipMask&c)||function(g,x){return x.length!==0&&x.find(b=>b===g)===void 0}(p,u.clipScope)}function nC(u,a){return u.x-a.x||u.y-a.y}function sV(u,a){return nC(u.min,a.min)===0&&nC(u.max,a.max)===0}function qR(u,a){return!(u.min.x>a.max.x||u.max.x<a.min.x||u.min.y>a.max.y||u.max.y<a.min.y)}function iC(u,a){if(u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(u[c].sourceId!==a[c].sourceId||!sV(u[c],a[c])||u[c].order!==a[c].order||u[c].clipMask!==a[c].clipMask||!gn(u[c].clipScope,a[c].clipScope))return!1;return!0}function aV(u,a,c){const p=1/rr,g=1/(1<<c.canonical.z),x=(a.x*p+c.canonical.x)*g+c.wrap,b=(a.y*p+c.canonical.y)*g;return{min:new at((u.x*p+c.canonical.x)*g+c.wrap,(u.y*p+c.canonical.y)*g),max:new at(x,b)}}function Vhe(u,a,c){const p=1<<c.canonical.z,g=((a.x-c.wrap)*p-c.canonical.x)*rr,x=(a.y*p-c.canonical.y)*rr;return{min:new at(((u.x-c.wrap)*p-c.canonical.x)*rr,(u.y*p-c.canonical.y)*rr),max:new at(g,x)}}function HR(u,a,c,p,g,x,b){const C=u.indices,I=u.vertices,D=[];for(let U=p;U<p+g;U+=3){const q=a[c[U+0]+x],H=a[c[U+1]+x],Y=a[c[U+2]+x],J=Math.min(q.x,H.x,Y.x),oe=Math.max(q.x,H.x,Y.x),ce=Math.min(q.y,H.y,Y.y),he=Math.max(q.y,H.y,Y.y);D.length=0,u.grid.query(new at(J,ce),new at(oe,he),D);for(let we=0;we<D.length;we++){const Te=D[we];if(Ls(I[C[3*Te+0]],I[C[3*Te+1]],I[C[3*Te+2]],q,H,Y,b))return!0}}return!1}function oV(u,a,c,p){if(!u||!c)return!1;let g=u.vertices;if(!a.canonical.equals(p.canonical)||a.wrap!==p.wrap){if(c.vertices.length<u.vertices.length)return oV(c,p,u,a);const x=a.canonical,b=p.canonical,C=Math.pow(2,b.z-x.z);g=u.vertices.map(I=>new at((I.x+x.x*rr)*C-b.x*rr,(I.y+x.y*rr)*C-b.y*rr))}return HR(c,g,u.indices,0,u.indices.length,0,0)}function lV(u,a,c,p){const g=Math.pow(2,p.z-c.z);return new at((u+c.x*rr)*g-p.x*rr,(a+c.y*rr)*g-p.y*rr)}function GR(u,a){const c=[];a.grid.queryPoint(u,c);const p=a.indices,g=a.vertices;for(let x=0;x<c.length;x++){const b=c[x];if(Na([g[p[3*b+0]],g[p[3*b+1]],g[p[3*b+2]]],u))return!0}return!1}const WR=[new at(0,0),new at(rr,0),new at(rr,rr),new at(0,rr)];function cV(u,a){const c=[];let p=[];if(!a||u.length<2)return[u];if(u.length===2)return Ns(u[0],u[1],WR)?[u]:[];for(let g=0;g<u.length+2;g++){const x=u[g%u.length],b=u[(g+1)%u.length],C=Ns(g===0?u[u.length-1]:u[(g-1)%u.length],x,WR),I=Ns(x,b,WR),D=C||I;D&&p.push(x),D&&I||p.length>0&&(p.length>1&&c.push(p),p=[])}return p.length>1&&c.push(p),c}const KR=$t.types,qhe=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Hhe=["fill-extrusion-flood-light-ground-radius"],Ghe=Math.pow(2,13),Whe=Math.pow(2,15)-1,uV=new at(0,1),am=2147483648,dV=7,hV=450;function Q1(u,a,c,p,g,x,b,C){u.emplaceBack((a<<1)+b,(c<<1)+x,(Math.floor(p*Ghe)<<1)+g,Math.round(C))}function eS(u,a,c){u.emplaceBack(a.x*rr,a.y*rr,c?1:0)}function sC(u,a,c,p,g,x){u.emplaceBack(a.x,a.y,(c.x<<1)+p,(c.y<<1)+g,x)}function tS(u,a,c){u.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}class fV{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class pV{constructor(){this.centroidXY=new at(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new at(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new at(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}}class mV{constructor(){this.acc=new at(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(a,c){a.min.x===Number.MAX_VALUE&&(a.min.x=a.max.x=c.x,a.min.y=a.max.y=c.y)}appendEdge(a,c,p){this.accCount++,this.acc._add(c);let g=!!this.borders;c.x<a.min.x?(a.min.x=c.x,g=!0):c.x>a.max.x&&(a.max.x=c.x,g=!0),c.y<a.min.y?(a.min.y=c.y,g=!0):c.y>a.max.y&&(a.max.y=c.y,g=!0),((c.x===0||c.x===rr)&&c.x===p.x)!=((c.y===0||c.y===rr)&&c.y===p.y)&&this.processBorderOverlap(c,p),g&&this.checkBorderIntersection(c,p)}checkBorderIntersection(a,c){c.x<0!=a.x<0&&this.addBorderIntersection(0,Kr(c.y,a.y,(0-c.x)/(a.x-c.x))),c.x>rr!=a.x>rr&&this.addBorderIntersection(1,Kr(c.y,a.y,(rr-c.x)/(a.x-c.x))),c.y<0!=a.y<0&&this.addBorderIntersection(2,Kr(c.x,a.x,(0-c.y)/(a.y-c.y))),c.y>rr!=a.y>rr&&this.addBorderIntersection(3,Kr(c.x,a.x,(rr-c.y)/(a.y-c.y)))}addBorderIntersection(a,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const p=this.borders[a];c<p[0]&&(p[0]=c),c>p[1]&&(p[1]=c)}processBorderOverlap(a,c){if(a.x===c.x){if(a.y===c.y)return;const p=a.x===0?0:1;this.addBorderIntersection(p,c.y),this.addBorderIntersection(p,a.y)}else{const p=a.y===0?2:3;this.addBorderIntersection(p,c.x),this.addBorderIntersection(p,a.x)}}centroid(){return this.accCount===0?new at(0,0):new at(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((a,c)=>a+ +(c[0]!==Number.MAX_VALUE),0):0}}function gV(u,a){const c=u.add(a)._unit(),p=ve(u.x*c.x+u.y*c.y,-1,1);var g,x,b;return g=Math.acos(p),Math.min(4,Math.max(-4,Math.tan(g)))/4*Whe*((x=u).x*(b=a).y-x.y*b.x<0?-1:1)}const Khe=[u=>u.x<0,u=>u.x>rr,u=>u.y<0,u=>u.y>rr];function Zhe(u,a,c,p){const g=[4];if(p===0)return g;c._mult(p);const x=u.sub(c),b=a.sub(c),C=[u,a,x,b];for(let I=0;I<4;I++)for(const D of C)if(Khe[I](D)){g.push(I);break}return g}class ZR{constructor(a){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Y_,this.indexArray=new is,this.programConfigurations=new tu(a.layers,{zoom:a.zoom,lut:a.lut},c=>Hhe.includes(c)),this._segments=new ds,this.hiddenByLandmarkVertexArray=new ix,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ds}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(a,c,p,g=!1){const x=a.length;if(x>2){let b=Math.max(0,this._segments.get().length-1);const C=this._segments._prepareSegment(4*x,this.vertexArray.length,2*this._segmentToGroundQuads[b].length);let I;b!==this._segments.get().length-1&&(b++,this._segmentToGroundQuads[b]=[],this._segmentToRegionTriCounts[b]=[0,0,0,0,0]);{const D=a[0],U=a[1];I=gV(D.sub(a[x-1])._perp()._unit(),U.sub(D)._perp()._unit())}for(let D=0;D<x;D++){const U=D===x-1?0:D+1,q=a[D],H=a[U],Y=a[U===x-1?0:U+1],J=H.sub(q)._perp()._unit(),oe=gV(J,Y.sub(H)._perp()._unit()),ce=I,he=oe;if(XR(q,H,c)||g&&_V(q,c)&&_V(H,c)){I=oe;continue}const we=C.vertexLength;sC(this.vertexArray,q,H,1,1,ce),sC(this.vertexArray,q,H,1,0,ce),sC(this.vertexArray,q,H,0,1,he),sC(this.vertexArray,q,H,0,0,he),C.vertexLength+=4;const Te=Zhe(q,H,J,p);for(const Pe of Te)this._segmentToGroundQuads[b].push({id:we,region:Pe}),this._segmentToRegionTriCounts[b][Pe]+=2,C.primitiveLength+=2;I=oe}}}prepareBorderSegments(){if(!this.hasData())return;const a=this._segments.get(),c=a.length;for(let p=0;p<c;p++)this._segmentToGroundQuads[p].sort((g,x)=>g.region-x.region);for(let p=0;p<c;p++){const g=this._segmentToGroundQuads[p],x=a[p],b=this._segmentToRegionTriCounts[p];b.reduce((I,D)=>I+D,0);let C=0;for(let I=0;I<=4;I++){const D=b[I];if(D!==0){let U=this.regionSegments[I];U||(U=this.regionSegments[I]=new ds);const q={vertexOffset:x.vertexOffset,primitiveOffset:x.primitiveOffset+C,vertexLength:x.vertexLength,primitiveLength:D};U.get().push(q)}C+=D}for(let I=0;I<g.length;I++){const D=g[I].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(a,c,p,g,x,b,C){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,a,c,p,g,x,b,void 0,C)}upload(a){this.hasData()&&(this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Dhe.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=a.createVertexBuffer(this.groundRadiusArray,Lhe.members)))}uploadPaintProperties(a){this.hasData()&&this.programConfigurations.upload(a)}update(a,c,p,g,x,b,C,I){this.hasData()&&this.programConfigurations.updatePaintArrays(a,c,p,g,x,b,C,I)}updateHiddenByLandmark(a){this.updateHiddenByLandmarkRange(a.groundVertexArrayOffset,a.groundVertexCount,!!(a.flags&am))}updateHiddenByLandmarkRange(a,c,p){if(!this.hasData())return;const g=c+a;if(c!==0){for(let x=a;x<g;++x)this.hiddenByLandmarkVertexArray.emplace(x,p?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(a){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=a.createVertexBuffer(this.hiddenByLandmarkVertexArray,Bhe.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let a=0;a<=4;a++){const c=this.regionSegments[a];c&&c.destroy()}}}}class aC{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaling=a.overscaling,this.layers=a.layers,this.pixelRatio=a.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=a.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new is,this.footprintVertices=new _l,this.footprintSegments=[],this.layoutVertexArray=new Kp,this.centroidVertexArray=new $A,this.wallVertexArray=new VA,this.indexArray=new is,this.programConfigurations=new tu(a.layers,{zoom:a.zoom,lut:a.lut},c=>qhe.includes(c)),this.segments=new ds,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new ZR(a),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.features=[],this.hasPattern=zR("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ze(p),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:x,id:b,index:C,sourceLayerIndex:I}of a){const D=this.layers[0]._featureFilter.needGeometry,U=yt(x,D);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),U,p))continue;const q={id:b,sourceLayerIndex:I,index:C,geometry:D?U.geometry:Nt(x,p,g),properties:x.properties,type:x.type,patterns:{}},H=this.layoutVertexArray.length,Y=KR[q.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:x.id,feature:BR("fill-extrusion",this.layers,q,this.zoom,this.pixelRatio,c)});else if(this.wallMode)for(const J of q.geometry)for(const oe of cV(J,Y))this.addFeature(x.id,q,[oe],C,p,{},c.availableImages,g,c.brightness);else this.addFeature(x.id,q,q.geometry,C,p,{},c.availableImages,g,c.brightness);c.featureIndex.insert(x,q.geometry,C,I,this.index,H)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(a,c,p,g,x,b){for(const{featureId:C,feature:I}of this.features){const D=KR[I.type]==="Polygon",{geometry:U}=I;if(this.wallMode)for(const q of U)for(const H of cV(q,D))this.addFeature(C,I,[H],I.index,c,p,g,x,b);else this.addFeature(C,I,U,I.index,c,p,g,x,b)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(a,c,p,g,x,b,C){this.programConfigurations.updatePaintArrays(a,c,x,p,g,b,C,this.worldview),this.groundEffect.update(a,c,x,p,g,b,C,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Uhe),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.wallVertexBuffer=a.createVertexBuffer(this.wallVertexArray,zhe.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=a.createVertexBuffer(this.layoutVertexExtArray,$he.members,!0)),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){this.groundEffect.uploadHiddenByLandmark(a),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Fhe.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,c,p,g,x,b,C,I,D){const U=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(c,{})/this.tileToMeter,q=[new at(0,0),new at(rr,rr)],H=I.projection,Y=H.name==="globe",J=this.wallMode||KR[c.type]==="Polygon",oe=new mV;oe.centroidDataIndex=this.centroidData.length;const ce=new pV;ce.buildingId=a,c.properties&&c.properties.hasOwnProperty("building_id")&&(ce.buildingId=c.properties.building_id);const he=this.layers[0].paint.get("fill-extrusion-base").evaluate(c,{},x)<=0,we=this.layers[0].paint.get("fill-extrusion-height").evaluate(c,{},x);let Te;if(ce.height=we,ce.vertexArrayOffset=this.layoutVertexArray.length,ce.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Y&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Q_),this.wallMode){if(Y)return void zr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(p.length!==1)return;Te=function(ft){const At=ft[0].x===ft[ft.length-1].x&&ft[0].y===ft[ft.length-1].y;(function(hr){let ar=0;const en=hr.length;for(let lr=0;lr<en;lr++)ar+=(hr[(lr+1)%en].x-hr[lr].x)*(hr[(lr+1)%en].y+hr[lr].y);return ar>=0})(ft)||(ft=ft.reverse());const Bt={geometry:[],joinNormals:[],indices:[]},er=[],Wt=[],Lt=[];let Gt=ft.length;for(;Gt>=2&&ft[Gt-1].equals(ft[Gt-2]);)Gt--;if(Gt<(At?3:2))return Bt;let wt,xt,Vt,Yt,Ft,gr=0;for(;gr<Gt-1&&ft[gr].equals(ft[gr+1]);)gr++;At&&(wt=ft[Gt-2],Ft=ft[gr].sub(wt)._unit()._perp());for(let hr=gr;hr<Gt;hr++){if(Vt=hr===Gt-1?At?ft[gr+1]:void 0:ft[hr+1],Vt&&ft[hr].equals(Vt))continue;Ft&&(Yt=Ft),wt&&(xt=wt),wt=ft[hr],Ft=Vt?Vt.sub(wt)._unit()._perp():Yt,Yt=Yt||Ft;let ar=Yt.add(Ft);ar.x===0&&ar.y===0||ar._unit();const en=ar.x*Ft.x+ar.y*Ft.y,lr=en!==0?1/en:1/0,Lr=Yt.x*Ft.y-Yt.y*Ft.x>0;let nn="miter";const wn=2;nn==="miter"&&lr>wn&&(nn="bevel"),nn==="bevel"&&(lr>100&&(nn="flipbevel"),lr<wn&&(nn="miter"));const Vn=(an,ti,ri,ls)=>{const ze=new at(an.x,an.y),Re=new at(an.x,an.y);ze.x+=ti.x*ls,ze.y+=ti.y*ls,Re.x-=ti.x*Math.max(ri,1),Re.y-=ti.y*Math.max(ri,1),Lt.push(ti),er.push(ze),Wt.push(Re)};if(nn==="miter")ar._mult(lr),Vn(wt,ar,0,0);else if(nn==="flipbevel")ar=Ft.mult(-1),Vn(wt,ar,0,0),Vn(wt,ar.mult(-1),0,0);else{const an=-Math.sqrt(lr*lr-1),ti=Lr?an:0,ri=Lr?0:an;xt&&Vn(wt,Yt,ti,ri),Vt&&Vn(wt,Ft,ti,ri)}}Bt.geometry=[...er,...Wt.reverse(),er[0]],Bt.joinNormals=[...Lt,...Lt.reverse(),Lt[Lt.length-1]];const br=Bt.geometry.length-1;for(let hr=0;hr<br/2;hr++)if(hr+1<br/2){let ar=hr,en=hr+1,lr=br-1-hr,Lr=br-2-hr;ar=ar===0?br-1:ar-1,en=en===0?br-1:en-1,lr=lr===0?br-1:lr-1,Lr=Lr===0?br-1:Lr-1,Bt.indices.push(lr),Bt.indices.push(en),Bt.indices.push(ar),Bt.indices.push(lr),Bt.indices.push(Lr),Bt.indices.push(en)}return Bt}(p[0]),p=[Te.geometry]}const Pe=(ft,At)=>ft<(At.length-1)/2||ft===At.length-1,He=this.wallMode?[p]:Y1(p,500);for(let ft=He.length-1;ft>=0;ft--){const At=He[ft];(At.length===0||(Fe=At[0]).every(Rt=>Rt.x<=0)||Fe.every(Rt=>Rt.x>=rr)||Fe.every(Rt=>Rt.y<=0)||Fe.every(Rt=>Rt.y>=rr))&&He.splice(ft,1)}var Fe;let Ye;if(Y)Ye=SV(He,q,x);else{Ye=[];for(const ft of He)Ye.push({polygon:ft,bounds:q})}const tt=J?this.edgeRadius:0,it=tt>0&&this.zoom<17,Tt=(ft,At)=>{if(ft.length===0)return!1;const Rt=ft[ft.length-1];return At.x===Rt.x&&At.y===Rt.y};for(const{polygon:ft,bounds:At}of Ye){let Rt=0,Bt=0;for(const Gt of ft)J&&!Gt[0].equals(Gt[Gt.length-1])&&Gt.push(Gt[0]),Bt+=J?Gt.length-1:Gt.length;const er=this.segments.prepareSegment((J?5:4)*Bt,this.layoutVertexArray,this.indexArray);ce.footprintSegIdx<0&&(ce.footprintSegIdx=this.footprintSegments.length),ce.polygonSegIdx<0&&(ce.polygonSegIdx=this.polygonSegments.length);const Wt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Lt=new fV;if(Lt.vertexOffset=this.footprintVertices.length,Lt.indexOffset=3*this.footprintIndices.length,Lt.ringIndices=[],J){const Gt=[],wt=[];Rt=er.vertexLength;for(let Vt=0;Vt<ft.length;Vt++){const Yt=ft[Vt];Yt.length&&Vt!==0&&wt.push(Gt.length/2);const Ft=[];let gr,br;gr=Yt[1].sub(Yt[0])._perp()._unit(),Lt.ringIndices.push(Yt.length-1);for(let hr=1;hr<Yt.length;hr++){const ar=Yt[hr],en=Yt[hr===Yt.length-1?1:hr+1],lr=ar.clone();if(tt){br=en.sub(ar)._perp()._unit();const Lr=gr.add(br)._unit(),nn=tt*Math.min(4,1/(gr.x*Lr.x+gr.y*Lr.y));lr.x+=nn*Lr.x,lr.y+=nn*Lr.y,lr.x=Math.round(lr.x),lr.y=Math.round(lr.y),gr=br}if(!he||tt!==0&&!it||Tt(Ft,lr)||Ft.push(lr),Q1(this.layoutVertexArray,lr.x,lr.y,0,0,1,1,0),this.wallMode){const Lr=Pe(hr,Yt);eS(this.wallVertexArray,Te.joinNormals[hr],!Lr)}er.vertexLength++,this.footprintVertices.emplaceBack(ar.x,ar.y),Gt.push(ar.x,ar.y),Y&&tS(this.layoutVertexExtArray,H.projectTilePoint(lr.x,lr.y,x),H.upVector(x,lr.x,lr.y))}he&&(tt===0||it)&&(Ft.length!==0&&Tt(Ft,Ft[0])&&Ft.pop(),this.groundEffect.addData(Ft,At,U))}const xt=this.wallMode?Te.indices:hx(Gt,wt);for(let Vt=0;Vt<xt.length;Vt+=3)this.footprintIndices.emplaceBack(Lt.vertexOffset+xt[Vt+0],Lt.vertexOffset+xt[Vt+1],Lt.vertexOffset+xt[Vt+2]),this.indexArray.emplaceBack(Rt+xt[Vt],Rt+xt[Vt+2],Rt+xt[Vt+1]),er.primitiveLength++;Lt.indexCount+=xt.length,Lt.vertexCount+=this.footprintVertices.length-Lt.vertexOffset}for(let Gt=0;Gt<ft.length;Gt++){const wt=ft[Gt];oe.startRing(ce,wt[0]);let xt=wt.length>4&&xV(wt[wt.length-2],wt[0],wt[1]),Vt=tt?Xhe(wt[wt.length-2],wt[0],wt[1],tt):0;const Yt=[];let Ft,gr,br;gr=wt[1].sub(wt[0])._perp()._unit();let hr=!0;for(let ar=1,en=0;ar<wt.length;ar++){let lr=wt[ar-1],Lr=wt[ar];const nn=wt[ar===wt.length-1?1:ar+1];if(oe.appendEdge(ce,Lr,lr),XR(Lr,lr,At)){tt&&(gr=nn.sub(Lr)._perp()._unit(),hr=!hr);continue}const wn=Lr.sub(lr)._perp(),Vn=wn.x/(Math.abs(wn.x)+Math.abs(wn.y)),an=wn.y>0?1:0,ti=lr.dist(Lr);if(en+ti>32768&&(en=0),tt){br=nn.sub(Lr)._perp()._unit();let Re=vV(lr,Lr,nn,yV(gr,br),tt);isNaN(Re)&&(Re=0);const Pt=Lr.sub(lr)._unit();lr=lr.add(Pt.mult(Vt))._round(),Lr=Lr.add(Pt.mult(-Re))._round(),Vt=Re,gr=br,he&&this.zoom>=17&&(Tt(Yt,lr)||Yt.push(lr),Tt(Yt,Lr)||Yt.push(Lr))}const ri=er.vertexLength,ls=wt.length>4&&xV(lr,Lr,nn);let ze=bV(en,xt,hr);if(Q1(this.layoutVertexArray,lr.x,lr.y,Vn,an,0,0,ze),Q1(this.layoutVertexArray,lr.x,lr.y,Vn,an,0,1,ze),this.wallMode){const Re=Pe(ar-1,wt),Pt=Te.joinNormals[ar-1];eS(this.wallVertexArray,Pt,Re),eS(this.wallVertexArray,Pt,Re)}if(en+=ti,ze=bV(en,ls,!hr),xt=ls,Q1(this.layoutVertexArray,Lr.x,Lr.y,Vn,an,0,0,ze),Q1(this.layoutVertexArray,Lr.x,Lr.y,Vn,an,0,1,ze),this.wallMode){const Re=Pe(ar,wt),Pt=Te.joinNormals[ar];eS(this.wallVertexArray,Pt,Re),eS(this.wallVertexArray,Pt,Re)}if(er.vertexLength+=4,this.indexArray.emplaceBack(ri+0,ri+1,ri+2),this.indexArray.emplaceBack(ri+1,ri+3,ri+2),er.primitiveLength+=2,tt){const Re=Rt+(ar===1?wt.length-2:ar-2),Pt=ar===1?Rt:Re+1;if(this.indexArray.emplaceBack(ri+1,Re,ri+3),this.indexArray.emplaceBack(Re,Pt,ri+3),er.primitiveLength+=2,Ft===void 0&&(Ft=ri),!XR(nn,wt[ar],At)){const sr=ar===wt.length-1?Ft:er.vertexLength;this.indexArray.emplaceBack(ri+2,ri+3,sr),this.indexArray.emplaceBack(ri+3,sr+1,sr),this.indexArray.emplaceBack(ri+3,Pt,sr+1),er.primitiveLength+=3}hr=!hr}if(Y){const Re=this.layoutVertexExtArray,Pt=H.projectTilePoint(lr.x,lr.y,x),sr=H.projectTilePoint(Lr.x,Lr.y,x),Ot=H.upVector(x,lr.x,lr.y),or=H.upVector(x,Lr.x,Lr.y);tS(Re,Pt,Ot),tS(Re,Pt,Ot),tS(Re,sr,or),tS(Re,sr,or)}}J&&(Rt+=wt.length-1),he&&tt&&this.zoom>=17&&(Yt.length!==0&&Tt(Yt,Yt[0])&&Yt.pop(),this.groundEffect.addData(Yt,At,U,tt>0))}this.footprintSegments.push(Lt),Wt.triangleCount=this.indexArray.length-Wt.triangleArrayOffset,this.polygonSegments.push(Wt),++ce.footprintSegLen,++ce.polygonSegLen}if(ce.vertexCount=this.layoutVertexArray.length-ce.vertexArrayOffset,ce.groundVertexCount=this.groundEffect.vertexArray.length-ce.groundVertexArrayOffset,ce.vertexCount!==0){if(ce.centroidXY=oe.borders?uV:this.encodeCentroid(oe,ce),this.centroidData.push(ce),oe.borders){this.featuresOnBorder.push(oe);const ft=this.featuresOnBorder.length-1;for(let At=0;At<oe.borders.length;At++)oe.borders[At][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[At].push(ft)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,b,C,x,D,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(c,g,b,C,x,D,this.worldview),this.maxHeight=Math.max(this.maxHeight,we)}}sortBorders(){for(let a=0;a<this.borderFeatureIndices.length;a++)this.borderFeatureIndices[a].sort((c,p)=>this.featuresOnBorder[c].borders[a][0]-this.featuresOnBorder[p].borders[a][0])}splitToSubtiles(){const a=[];for(let C=0;C<this.centroidData.length;C++){const I=this.centroidData[C],D=+(I.min.y+I.max.y>rr),U=2*D+(+(I.min.x+I.max.x>rr)^D);for(let q=0;q<I.polygonSegLen;q++){const H=I.polygonSegIdx+q;a.push({centroidIdx:C,subtile:U,polygonSegmentIdx:H,triangleSegmentIdx:this.polygonSegments[H].triangleSegIdx})}}const c=new is;a.sort((C,I)=>C.triangleSegmentIdx===I.triangleSegmentIdx?C.subtile-I.subtile:C.triangleSegmentIdx-I.triangleSegmentIdx);let p=0,g=0,x=0;for(const C of a){if(C.triangleSegmentIdx!==p)break;x++}const b=a.length;for(;g!==a.length;){p=a[g].triangleSegmentIdx;let C=0,I=g,D=g;for(let U=I;U<x&&a[U].subtile===C;U++)D++;for(;I!==x;){const U=a[I];C=U.subtile;const q=this.centroidData[U.centroidIdx].min.clone(),H=this.centroidData[U.centroidIdx].max.clone(),Y={vertexOffset:this.segments.segments[p].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[p].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let J=I;J<D;J++){const oe=a[J],ce=this.polygonSegments[oe.polygonSegmentIdx],he=this.centroidData[oe.centroidIdx].min,we=this.centroidData[oe.centroidIdx].max,Te=this.indexArray.uint16;for(let Pe=ce.triangleArrayOffset;Pe<ce.triangleArrayOffset+ce.triangleCount;Pe++)c.emplaceBack(Te[3*Pe],Te[3*Pe+1],Te[3*Pe+2]);Y.primitiveLength+=ce.triangleCount,q.x=Math.min(q.x,he.x),q.y=Math.min(q.y,he.y),H.x=Math.max(H.x,we.x),H.y=Math.max(H.y,we.y)}Y.primitiveLength>0&&this.triangleSubSegments.push({segment:Y,min:q,max:H}),I=D;for(let J=I;J<x&&a[J].subtile===a[I].subtile;J++)D++}g=x;for(let U=g;U<b&&a[U].triangleSegmentIdx===a[g].triangleSegmentIdx;U++)x++}c._trim(),this.indexArray=c}getVisibleSegments(a,c,p){const g=new ds;if(this.wallMode){for(const oe of this.triangleSubSegments)g.segments.push(oe.segment);return g}let x=0,b=0;const C=1<<a.canonical.z;if(c){const oe=c.getMinMaxForTile(a);oe&&(x=oe.min,b=oe.max)}b+=this.maxHeight;const I=a.toUnwrapped();let D;const U=[I.canonical.x/C+I.wrap,I.canonical.y/C],q=[(I.canonical.x+1)/C+I.wrap,(I.canonical.y+1)/C],H=(oe,ce,he)=>[oe[0]*(1-he[0])+ce[0]*he[0],oe[1]*(1-he[1])+ce[1]*he[1]],Y=[],J=[];for(const oe of this.triangleSubSegments){Y[0]=oe.min.x/rr,Y[1]=oe.min.y/rr,J[0]=oe.max.x/rr,J[1]=oe.max.y/rr;const ce=H(U,q,Y),he=H(U,q,J);if(new _n([ce[0],ce[1],x],[he[0],he[1],b]).intersectsPrecise(p)===0){D&&(g.segments.push(D),D=void 0);continue}const we=oe.segment;D&&D.vertexOffset!==we.vertexOffset&&(g.segments.push(D),D=void 0),D?(D.vertexLength+=we.vertexLength,D.primitiveLength+=we.primitiveLength):D={vertexOffset:we.vertexOffset,primitiveLength:we.primitiveLength,vertexLength:we.vertexLength,primitiveOffset:we.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&g.segments.push(D),g}encodeCentroid(a,c){const p=a.centroid(),g=c.span(),x=Math.min(7,Math.round(g.x*this.tileToMeter/10)),b=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new at(ve(p.x,1,rr-1)<<3|x,ve(p.y,1,rr-1)<<3|b)}encodeBorderCentroid(a){if(!a.borders)return new at(0,0);const c=a.borders,p=Number.MAX_VALUE;if(c[0][0]!==p||c[1][0]!==p){const g=c[0][0]!==p?0:1;return new at(6|(c[0][0]!==p?0:65528),(c[g][0]+c[g][1])/2<<3|6)}{const g=c[2][0]!==p?2:3;return new at((c[g][0]+c[g][1])/2<<3|6,6|(c[2][0]!==p?0:65528))}}showCentroid(a){const c=this.centroidData[a.centroidDataIndex];c.flags&=2147483647,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(a){this.groundEffect.updateHiddenByLandmark(a);const c=a.vertexArrayOffset,p=a.vertexCount+a.vertexArrayOffset,g=a.flags&am?uV:a.centroidXY,x=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==g.y||x!==g.x){for(let b=c;b<p;++b)this.centroidVertexArray.emplace(b,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of this.centroidData)this.writeCentroidToBuffer(a)}updateReplacement(a,c,p){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(a.toUnwrapped());if(iC(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const b of this.centroidData)b.flags&=2147483647;const x=[];for(const b of this.activeReplacements){if(b.order<p)continue;const C=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-a.canonical.z));if(b.footprint.buildingId){const I=b.footprint.buildingId;for(const D of this.centroidData)D.buildingId===I&&(D.flags|=am)}else for(const I of this.centroidData)if(!(I.flags&am||b.min.x>I.max.x||I.min.x>b.max.x||b.min.y>I.max.y||I.min.y>b.max.y))for(let D=0;D<I.footprintSegLen;D++){const U=this.footprintSegments[I.footprintSegIdx+D];if(x.length=0,Yhe(this.footprintVertices,U.vertexOffset,U.vertexCount,b.footprintTileId.canonical,a.canonical,x),HR(b.footprint,x,this.footprintIndices.uint16,U.indexOffset,U.indexCount,-U.vertexOffset,-C)){I.flags|=am;break}}}for(const b of this.centroidData)this.writeCentroidToBuffer(b);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(a,c,p){let g=!1;for(let x=0;x<p.footprintSegLen;x++){const b=this.footprintSegments[p.footprintSegIdx+x];let C=0;for(const I of b.ringIndices){for(let D=C,U=I+C-1;D<I+C;U=D++){const q=this.footprintVertices.int16[2*(D+b.vertexOffset)+0],H=this.footprintVertices.int16[2*(D+b.vertexOffset)+1],Y=this.footprintVertices.int16[2*(U+b.vertexOffset)+1];H>c!=Y>c&&a<(this.footprintVertices.int16[2*(U+b.vertexOffset)+0]-q)*(c-H)/(Y-H)+q&&(g=!g)}C=I}}return g}getHeightAtTileCoord(a,c){let p=Number.NEGATIVE_INFINITY,g=!0;const x=4*(a+rr)*rr+(c+rr);if(this.partLookup.hasOwnProperty(x)){const b=this.partLookup[x];return b?{height:b.height,hidden:!!(b.flags&am)}:void 0}for(const b of this.centroidData)a>b.max.x||b.min.x>a||c>b.max.y||b.min.y>c||b.height<=p||this.footprintContainsPoint(a,c,b)&&(p=b.height,this.partLookup[x]=b,g=!!(b.flags&am));if(p!==Number.NEGATIVE_INFINITY)return{height:p,hidden:g};this.partLookup[x]=void 0}}function yV(u,a){const c=u.add(a)._unit();return u.x*c.x+u.y*c.y}function Xhe(u,a,c,p){const g=a.sub(u)._perp()._unit(),x=c.sub(a)._perp()._unit();return vV(u,a,c,yV(g,x),p)}function vV(u,a,c,p,g){const x=Math.sqrt(1-p*p);return Math.min(u.dist(a)/3,a.dist(c)/3,g*x/p)}function XR(u,a,c){return u.x<c[0].x&&a.x<c[0].x||u.x>c[1].x&&a.x>c[1].x||u.y<c[0].y&&a.y<c[0].y||u.y>c[1].y&&a.y>c[1].y}function _V(u,a){return u.x<a[0].x||u.x>a[1].x||u.y<a[0].y||u.y>a[1].y}function xV(u,a,c){if(u.x<0||u.x>=rr||a.x<0||a.x>=rr||c.x<0||c.x>=rr)return!1;const p=c.sub(a),g=p.perp(),x=u.sub(a);return(p.x*x.x+p.y*x.y)/Math.sqrt((p.x*p.x+p.y*p.y)*(x.x*x.x+x.y*x.y))>-.866&&g.x*x.x+g.y*x.y<0}function bV(u,a,c){const p=a?2|u:-3&u;return c?1|p:-2&p}function wV(){const u=Math.PI/32,a=Math.tan(u),c=G;return c*Math.sqrt(1+2*a*a)-c}function SV(u,a,c){const p=1<<c.z,g=Ne(c.x/p),x=Ne((c.x+1)/p),b=je(c.y/p),C=je((c.y+1)/p);return function(I,D,U,q,H=0,Y){const J=[];if(!I.length||!U||!q)return J;const oe=(Fe,Ye)=>{for(const tt of Fe)J.push({polygon:tt,bounds:Ye})},ce=Math.ceil(Math.log2(U)),he=Math.ceil(Math.log2(q)),we=ce-he,Te=[];for(let Fe=0;Fe<Math.abs(we);Fe++)Te.push(we>0?0:1);for(let Fe=0;Fe<Math.min(ce,he);Fe++)Te.push(0),Te.push(1);let Pe=I;if(Pe=tC(Pe,D[0].y-H,D[1].y+H,1),Pe=tC(Pe,D[0].x-H,D[1].x+H,0),!Pe.length)return J;const He=[];for(Te.length?He.push({polygons:Pe,bounds:D,depth:0}):oe(Pe,D);He.length;){const Fe=He.pop(),Ye=Fe.depth,tt=Te[Ye],it=Fe.bounds[0],Tt=Fe.bounds[1],ft=tt===0?it.x:it.y,At=tt===0?Tt.x:Tt.y,Rt=Y?Y(tt,ft,At):.5*(ft+At),Bt=tC(Fe.polygons,ft-H,Rt+H,tt),er=tC(Fe.polygons,Rt-H,At+H,tt);if(Bt.length){const Wt=[it,new at(tt===0?Rt:Tt.x,tt===1?Rt:Tt.y)];Te.length>Ye+1?He.push({polygons:Bt,bounds:Wt,depth:Ye+1}):oe(Bt,Wt)}if(er.length){const Wt=[new at(tt===0?Rt:it.x,tt===1?Rt:it.y),Tt];Te.length>Ye+1?He.push({polygons:er,bounds:Wt,depth:Ye+1}):oe(er,Wt)}}return J}(u,a,Math.ceil((x-g)/11.25),Math.ceil((b-C)/11.25),1,(I,D,U)=>{if(I===0)return .5*(D+U);{const q=je((c.y+D/rr)/p);return(ye(.5*(je((c.y+U/rr)/p)+q))*p-c.y)*rr}})}function Yhe(u,a,c,p,g,x){const b=Math.pow(2,p.z-g.z);for(let C=0;C<c;C++){let I=u.int16[2*(C+a)+0],D=u.int16[2*(C+a)+1];I=(I+g.x*rr)*b-p.x*rr,D=(D+g.y*rr)*b-p.y*rr,x.push(new at(I,D))}}let EV,TV;_r(aC,"FillExtrusionBucket",{omit:["layers","features"]}),_r(pV,"PartData"),_r(fV,"FootprintSegment"),_r(mV,"BorderCentroidData"),_r(ZR,"GroundEffect");class Ey extends at{constructor(a,c,p){super(a,c),this.z=p}}class AV extends Ey{constructor(a,c,p,g){super(a,c,p),this.w=g}}function CV(u,a,c,p){const g=c==="x"?"y":"x",x=(p-u[c])/(a[c]-u[c]);u[g]=Math.round(u[g]+(a[g]-u[g])*x),u[c]=p,u.hasOwnProperty("z")&&(u.z=Kr(u.z,a.z,x)),u.hasOwnProperty("w")&&(u.w=Kr(u.w,a.w,x))}function jV(u,a,c,p){const g=c,x=p;for(const b of["x","y"]){let C=u,I=a;C[b]>=I[b]&&(C=a,I=u),C[b]<g&&I[b]>g&&CV(C,I,b,g),C[b]<x&&I[b]>x&&CV(I,C,b,x)}}function oC(u,a,c,p,g,x){const b=[];for(let C=0;C<u.length;C++){const I=u[C];let D;const U=b.length;let q=0;for(let H=0;H<I.length-1;H++){let Y=I[H],J=I[H+1],oe=0;const ce=q;let he,we;x&&(oe=Math.hypot(J.x-Y.x,J.y-Y.y),q+=oe,he=Y,we=J),Y.x<a&&J.x<a||(Y.x<a?Y=new at(a,Y.y+(a-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x<a&&(J=new at(a,Y.y+(a-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y<c&&J.y<c||(Y.y<c?Y=new at(Y.x+(c-Y.y)/(J.y-Y.y)*(J.x-Y.x),c)._round():J.y<c&&(J=new at(Y.x+(c-Y.y)/(J.y-Y.y)*(J.x-Y.x),c)._round()),Y.x>=p&&J.x>=p||(Y.x>=p?Y=new at(p,Y.y+(p-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x>=p&&(J=new at(p,Y.y+(p-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y>=g&&J.y>=g||(Y.y>=g?Y=new at(Y.x+(g-Y.y)/(J.y-Y.y)*(J.x-Y.x),g)._round():J.y>=g&&(J=new at(Y.x+(g-Y.y)/(J.y-Y.y)*(J.x-Y.x),g)._round()),D&&Y.equals(D[D.length-1])||(D=[Y],b.push(D),x&&x.push({progress:{min:ce+PV(he,we,Y)*oe,max:1},parentIndex:C,prevPoint:he,nextPoint:we})),D.push(J),x&&(x[x.length-1].progress.max=ce+PV(he,we,J)*oe,x[x.length-1].nextPoint=we)))))}if(x&&q>0)for(let H=U;H<b.length;H++)x[H].progress.min/=q,x[H].progress.max/=q}return b}function Jhe(u,a,c,p,g){if(u.length<2)return void p.push(u);const x=[];for(;a.valid();){const[D,U]=a.get();for(let q=0;q<u.length-1;q++){const H=u[q],Y=u[q+1],J=Zl(H,Y,D,U);if(J){const[oe]=J,ce=new at(Kr(H.x,Y.x,oe),Kr(H.y,Y.y,oe));x.push({t:q+oe,distance:0,point:ce})}}a.next()}if(x.length===0)return void p.push(u);x.sort((D,U)=>D.t-U.t);let b=0,C=0,I=[];for(p.push(I);b!==u.length;){if(C===x.length){for(;b!==u.length;)I.length!==0&&I[I.length-1].equals(u[b])||I.push(u[b]),b++;break}x[C].t<=b?(I.length!==0&&I[I.length-1].equals(x[C].point)||I.push(x[C].point),Math.trunc(x[C].t),C++):(I.length!==0&&I[I.length-1].equals(u[b])||I.push(u[b]),b++)}}function PV(u,a,c){return u.x!==a.x?(c.x-u.x)/(a.x-u.x):u.y!==a.y?(c.y-u.y)/(a.y-u.y):0}function rS(u,a){return u.x*a.x+u.y*a.y}function OV(u,a){if(u.length===1){let c=0;const p=a[c++];let g;for(;!g||p.equals(g);)if(g=a[c++],!g)return 1/0;for(;c<a.length;c++){const x=a[c],b=u[0],C=g.sub(p),I=x.sub(p),D=b.sub(p),U=rS(C,C),q=rS(C,I),H=rS(I,I),Y=rS(D,C),J=rS(D,I),oe=U*H-q*q,ce=(H*Y-q*J)/oe,he=(U*J-q*Y)/oe,we=p.z*(1-ce-he)+g.z*ce+x.z*he;if(isFinite(we))return we}return 1/0}{let c=1/0;for(const p of a)c=Math.min(c,p.z);return c}}function kV(u,a,c){let p=1/0;ws(c,a)&&(p=OV(c,a[0]));for(let g=0;g<a.length;g++){const x=a[g],b=u[g];for(let C=0;C<x.length-1;C++){const I=x[C],D=[I,x[C+1],b[C+1],b[C],I];ks(c,D)&&(p=Math.min(p,OV(c,D)))}}return p!==1/0&&p}function NV(u,a,c,p,g,x,b,C,I,D,U){return u.projection.name==="globe"?function(q,H,Y,J,oe,ce,he,we,Te,Pe,He){const Fe=[],Ye=[],tt=q.projection.upVectorScale(He,q.center.lat,q.worldSize).metersToTile,it=[0,0,0,1],Tt=[0,0,0,1],ft=(Rt,Bt,er,Wt)=>{Rt[0]=Bt,Rt[1]=er,Rt[2]=Wt,Rt[3]=1},At=wV();Y>0&&(Y+=At),J+=At;for(const Rt of H){const Bt=[],er=[];for(const Wt of Rt){const Lt=Wt.x+oe.x,Gt=Wt.y+oe.y,wt=q.projection.projectTilePoint(Lt,Gt,He),xt=q.projection.upVector(He,Wt.x,Wt.y);let Vt=Y,Yt=J;if(he){const Ft=IV(Lt,Gt,Y,J,he,we,Te,Pe);Vt+=Ft.base,Yt+=Ft.top}Y!==0?ft(it,wt.x+xt[0]*tt*Vt,wt.y+xt[1]*tt*Vt,wt.z+xt[2]*tt*Vt):ft(it,wt.x,wt.y,wt.z),ft(Tt,wt.x+xt[0]*tt*Yt,wt.y+xt[1]*tt*Yt,wt.z+xt[2]*tt*Yt),Dt(it,it,ce),Dt(Tt,Tt,ce),Bt.push(new Ey(it[0],it[1],it[2])),er.push(new Ey(Tt[0],Tt[1],Tt[2]))}Fe.push(Bt),Ye.push(er)}return[Fe,Ye]}(u,a,c,p,g,x,b,C,I,D,U):b?function(q,H,Y,J,oe,ce,he,we,Te){const Pe=[],He=[],Fe=[0,0,0,1];for(const Ye of q){const tt=[],it=[];for(const Tt of Ye){const ft=Tt.x+J.x,At=Tt.y+J.y,Rt=IV(ft,At,H,Y,ce,he,we,Te);Fe[0]=ft,Fe[1]=At,Fe[2]=Rt.base,Fe[3]=1,Ut(Fe,Fe,oe),Fe[3]=Math.max(Fe[3],1e-5);const Bt=new Ey(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);Fe[0]=ft,Fe[1]=At,Fe[2]=Rt.top,Fe[3]=1,Ut(Fe,Fe,oe),Fe[3]=Math.max(Fe[3],1e-5);const er=new Ey(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);tt.push(Bt),it.push(er)}Pe.push(tt),He.push(it)}return[Pe,He]}(a,c,p,g,x,b,C,I,D):function(q,H,Y,J,oe){const ce=[],he=[],we=oe[8]*H,Te=oe[9]*H,Pe=oe[10]*H,He=oe[11]*H,Fe=oe[8]*Y,Ye=oe[9]*Y,tt=oe[10]*Y,it=oe[11]*Y;for(const Tt of q){const ft=[],At=[];for(const Rt of Tt){const Bt=Rt.x+J.x,er=Rt.y+J.y,Wt=oe[0]*Bt+oe[4]*er+oe[12],Lt=oe[1]*Bt+oe[5]*er+oe[13],Gt=oe[2]*Bt+oe[6]*er+oe[14],wt=oe[3]*Bt+oe[7]*er+oe[15],xt=Wt+we,Vt=Lt+Te,Yt=Gt+Pe,Ft=Math.max(wt+He,1e-5),gr=Wt+Fe,br=Lt+Ye,hr=Gt+tt,ar=Math.max(wt+it,1e-5);ft.push(new Ey(xt/Ft,Vt/Ft,Yt/Ft)),At.push(new Ey(gr/ar,br/ar,hr/ar))}ce.push(ft),he.push(At)}return[ce,he]}(a,c,p,g,x)}function IV(u,a,c,p,g,x,b,C){const I=b*g.getElevationAt(u,a,!0,!0),D=x[0]!==0,U=D?x[1]===0?b*(x[0]/dV-hV):b*function(q,H,Y){const J=Math.floor(H[0]/8),oe=Math.floor(H[1]/8),ce=10*(H[0]-8*J),he=10*(H[1]-8*oe),we=q.getElevationAt(J,oe,!0,!0),Te=q.getMeterToDEM(Y),Pe=Math.floor(.5*(ce*Te-1)),He=Math.floor(.5*(he*Te-1)),Fe=q.tileCoordToPixel(J,oe),Ye=2*Pe+1,tt=2*He+1,it=function(er,Wt,Lt,Gt,wt){return[er.getElevationAtPixel(Wt,Lt,!0),er.getElevationAtPixel(Wt+wt,Lt,!0),er.getElevationAtPixel(Wt,Lt+wt,!0),er.getElevationAtPixel(Wt+Gt,Lt+wt,!0)]}(q,Fe.x-Pe,Fe.y-He,Ye,tt),Tt=Math.abs(it[0]-it[1]),ft=Math.abs(it[2]-it[3]),At=Math.abs(it[0]-it[2])+Math.abs(it[1]-it[3]),Rt=Math.min(.25,.5*Te*(Tt+ft)/Ye),Bt=Math.min(.25,.5*Te*At/tt);return we+Math.max(Rt*ce,Bt*he)}(g,x,C):I;return{base:I+(c===0?-1:c),top:D?Math.max(U+p,I+c+2):I+p}}class Qhe{constructor(a){this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class efe{constructor(){this.tasks={},this.taskQueue=[],vt(["process"],this),this.invoker=new Qhe(this.process),this.nextId=0}add(a,c){const p=this.nextId++,g=function({type:x,isSymbolTile:b,zoom:C}){return C=C||0,x==="message"?0:x!=="maybePrepare"||b?x!=="parseTile"||b?x==="parseTile"&&b?300-C:x==="maybePrepare"&&b?400-C:500:200-C:100-C}(c);if(g===0){try{a()}finally{}return null}return this.tasks[p]={fn:a,metadata:c,priority:g,id:p},this.taskQueue.push(p),this.invoker.trigger(),{cancel:()=>{delete this.tasks[p]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(p=>!!this.tasks[p]),!this.taskQueue.length)return;const a=this.pick();if(a===null)return;const c=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let a=null,c=1/0;for(let g=0;g<this.taskQueue.length;g++){const x=this.tasks[this.taskQueue[g]];x.priority<c&&(c=x.priority,a=g)}if(a===null)return null;const p=this.taskQueue[a];return this.taskQueue.splice(a,1),p}remove(){this.invoker.remove()}}class RV{constructor(a,c,p){this.target=a,this.parent=c,this.mapId=p,this.callbacks={},this.cancelCallbacks={},vt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new efe}send(a,c,p,g,x=!1,b){const C=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(p.metadata=b,this.callbacks[C]=p);const I=new Set;return this.target.postMessage({id:C,type:a,hasCallback:!!p,targetMapId:g,mustQueue:x,sourceMapId:this.mapId,data:ih(c,I)},I),{cancel:()=>{p&&delete this.callbacks[C],this.target.postMessage({id:C,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(a){const c=a.data;if(!c)return;const p=c.id;if(p&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const g=this.cancelCallbacks[p];delete this.cancelCallbacks[p],g&&g.cancel()}else if(c.mustQueue||xs(self)){const g=this.callbacks[p],x=this.scheduler.add(()=>this.processTask(p,c),g&&g.metadata||{type:"message"});x&&(this.cancelCallbacks[p]=x)}else this.processTask(p,c)}processTask(a,c){if(delete this.cancelCallbacks[a],c.type==="<response>"){const p=this.callbacks[a];delete this.callbacks[a],p&&(c.error?p(sh(c.error)):p(null,sh(c.data)))}else{const p=new Set,g=c.hasCallback?(b,C)=>{this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?ih(b):null,data:ih(C,p)},p)}:()=>{},x=sh(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,x,g);else if(this.parent.getWorkerSource){const b=c.type.split("."),{source:C,scope:I}=x;this.parent.getWorkerSource(c.sourceMapId,b[0],C,I)[b[1]](x,g)}else g(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var nS={workerUrl:"",workerClass:null,workerParams:void 0};const YR="mapboxgl_preloaded_worker_pool";class Ty{constructor(){this.active={}}acquire(a,c=Ty.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(nS.workerClass!=null?new nS.workerClass:new self.Worker(nS.workerUrl,nS.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[YR]}numActive(){return Object.keys(this.active).length}}Ty.workerCount=2;class px{constructor(a,c,p="Worker",g=Ty.workerCount){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=bt();const x=this.workerPool.acquire(this.id,g);for(let b=0;b<x.length;b++){const C=new px.Actor(x[b],c,this.id);C.name=`${p} ${b}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,c,p){Qe(this.actors,(g,x)=>{g.send(a,c,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}let iS,JR;function lC(){return iS||(iS=new Ty),iS}px.Actor=RV;class tfe{constructor(a){this.module=a}createIntArray(a){const c=new Int32Array(a),p=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heap32.set(c,p/c.BYTES_PER_ELEMENT),p}createFloatArray(a){const c=new Float32Array(a),p=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heapF32.set(c,p/c.BYTES_PER_ELEMENT),p}createStringBuffer(a){const c=this.module.malloc(a.length+1);for(let p=0;p<a.length;++p)this.module.heapU8[c+p]=a.charCodeAt(p);return this.module.heapU8[c+a.length]=0,c}readStringBuffer(a){let c="";for(;this.module.heapU8[a]!==0;)c+=String.fromCharCode(this.module.heapU8[a]),++a;return c}setStyle(a){const c=a.entranceColorRgb,p=a.facadeGlazingColorRgb,g=a.roofColorRgb,x=a.wallColorRgb,b=a.normalScale;this.module.setStyle(c[0],c[1],c[2],p[0],p[1],p[2],g[0],g[1],g[2],x[0],x[1],x[2],b[0],b[1],b[2],a.tileToMeters)}setAOOptions(a,c){this.module.setAOOptions(a?1:0,c)}setMetricOptions(a,c){this.module.setMetricOptions(a?1:0,c)}setStructuralOptions(a){this.module.setStructuralOptions(a?1:0)}setFacadeOptions(a,c){this.module.setFacadeOptions(a,c?1:0)}setFauxFacadeOptions(a,c,p){this.module.setFauxFacadeOptions(a?1:0,c?1:0,p)}setFacadeClassifierOptions(a){this.module.setFacadeClassifierOptions(a)}generateMesh(a,c){for(const C of a){const I=this.createStringBuffer(C.roofType),D=[0],U=[];for(const Y of C.coordinates)if(Array.isArray(Y)){for(const J of Y)U.push(J.x),U.push(J.y);D.push(U.length)}const q=this.createIntArray(D),H=this.createFloatArray(U);this.module.addFeature(C.id,C.sourceId,C.minHeight,C.height,I,C.roofType.length,H,q,D.length-1),this.module.free(I),this.module.free(q),this.module.free(H)}for(const C of c){let I;I=C.entrances?JSON.parse(C.entrances):[];const D=this.createFloatArray(I),U=[];for(const H of C.coordinates)U.push(H.x),U.push(H.y);const q=this.createFloatArray(U);this.module.addFacade(C.sourceId,C.crossPerc,C.distanceToRoad,D,I.length,q,U.length),this.module.free(D),this.module.free(q)}if(!this.module.generateMesh()){const C=this.module.getLastError();return this.readStringBuffer(C)}const p=this.module.getMeshCount(),g=new Array(p);for(let C=0;C<p;C++){const I=this.module.getPositionsPtr(C),D=this.module.getPositionsLength(C),U=new Float32Array(this.module.heapF32.buffer,I,D),q=this.module.getNormalsPtr(C),H=this.module.getNormalsLength(C),Y=new Float32Array(this.module.heapF32.buffer,q,H),J=this.module.getColorsPtr(C),oe=this.module.getColorsLength(C),ce=new Uint8Array(this.module.heapU8.buffer,J,oe),he=this.module.getAOPtr(C),we=this.module.getAOLength(C),Te=new Float32Array(this.module.heapF32.buffer,he,we),Pe=this.module.getUVPtr(C),He=this.module.getUVLength(C),Fe=new Float32Array(this.module.heapF32.buffer,Pe,He),Ye=this.module.getFauxFacadePtr(C),tt=this.module.getFauxFacadeLength(C),it=new Uint8Array(this.module.heapU8.buffer,Ye,tt),Tt=this.module.getIndicesPtr(C),ft=this.module.getIndicesLength(C),At=new Int32Array(this.module.heap32.buffer,Tt,ft),Rt=this.module.getBuildingPart(C),Bt=this.readStringBuffer(Rt);g[C]={positions:U,normals:Y,colors:ce,ao:Te,uv:Fe,isFauxFacade:it,indices:At,buildingPart:Bt}}const x=this.module.getRingCount(),b=[];for(let C=0;C<x;C++){const I=this.module.getRingPtr(C),D=this.module.getRingLength(C),U=new Float32Array(this.module.heapF32.buffer,I,D);b.push(U)}return{meshes:g,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:b}}}let sS,QR,gd,mx,eM,gx=null,yx=null,MV=null,cC=null;function DV(){return xs(self)&&self.worker.dracoUrl?self.worker.dracoUrl:QR||Ji.DRACO_URL}function LV(){if(xs(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(mx)return mx;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return mx=WebAssembly.validate(u)?Ji.MESHOPT_SIMD_URL:Ji.MESHOPT_URL,mx}function rfe(){return cC}const uC={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},nfe={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},aS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function FV(u,a,c){const p=c.json.bufferViews.length,g=c.buffers.length;a.bufferView=p,c.json.bufferViews[p]={buffer:g,byteLength:u.byteLength},c.buffers[g]=u}const tM="KHR_draco_mesh_compression";function ife(u,a){const c=u.extensions&&u.extensions[tM];if(!c)return;const p=new gd.Decoder,g=UV(a,c.bufferView),x=new gd.Mesh;if(!p.DecodeArrayToMesh(g,g.byteLength,x))throw new Error("Failed to decode Draco mesh");const b=a.json.accessors[u.indices],C=uC[b.componentType],I=b.count*C.BYTES_PER_ELEMENT,D=gd._malloc(I);C===Uint16Array?p.GetTrianglesUInt16Array(x,I,D):p.GetTrianglesUInt32Array(x,I,D),FV(gd.memory.buffer.slice(D,D+I),b,a),gd._free(D);for(const U of Object.keys(c.attributes)){const q=p.GetAttributeByUniqueId(x,c.attributes[U]),H=a.json.accessors[u.attributes[U]],Y=nfe[H.componentType],J=H.count*aS[H.type]*uC[H.componentType].BYTES_PER_ELEMENT,oe=gd._malloc(J);p.GetAttributeDataArrayForAllPoints(x,q,gd[Y],J,oe),FV(gd.memory.buffer.slice(oe,oe+J),H,a),gd._free(oe)}p.destroy(),x.destroy(),delete u.extensions[tM]}const dC="EXT_meshopt_compression";function sfe(u,a){if(!u.extensions||!u.extensions[dC])return;const c=u.extensions[dC],p=new Uint8Array(a.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),g=new Uint8Array(c.count*c.byteStride);eM.decodeGltfBuffer(g,c.count,c.byteStride,p,c.mode,c.filter),u.buffer=a.buffers.length,u.byteOffset=0,a.buffers[u.buffer]=g.buffer,delete u.extensions[dC]}const zV=1179937895,BV=new TextDecoder("utf8");function $V(u,a){return new URL(u,a).href}function afe(u,a,c,p){return fetch($V(u.uri,p)).then(g=>g.arrayBuffer()).then(g=>{a.buffers[c]=g})}function UV(u,a){const c=u.json.bufferViews[a];return new Uint8Array(u.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function ofe(u,a,c,p){if(u.uri){const g=$V(u.uri,p);return fetch(g).then(x=>x.blob()).then(x=>createImageBitmap(x)).then(x=>{a.images[c]=x})}if(u.bufferView!==void 0){const g=UV(a,u.bufferView),x=new Blob([g],{type:u.mimeType});return createImageBitmap(x).then(b=>{a.images[c]=b})}}function VV(u,a=0,c){const p={json:null,images:[],buffers:[]};if(new Uint32Array(u,a,1)[0]===zV){const U=new Uint32Array(u,a);let q=2;const H=(U[q++]>>2)-3,Y=U[q++]>>2;if(q++,p.json=JSON.parse(BV.decode(U.subarray(q,q+Y))),q+=Y,q<H){const J=U[q++];q++;const oe=a+(q<<2);p.buffers[0]=u.slice(oe,oe+J)}}else p.json=JSON.parse(BV.decode(new Uint8Array(u,a)));const{buffers:g,images:x,meshes:b,extensionsUsed:C,bufferViews:I}=p.json;let D=Promise.resolve();if(g){const U=[];for(let q=0;q<g.length;q++){const H=g[q];H.uri?U.push(afe(H,p,q,c)):p.buffers[q]||(p.buffers[q]=null)}D=Promise.all(U)}return D.then(()=>{const U=[],q=C&&C.includes(tM),H=C&&C.includes(dC);if(q&&U.push(function(){if(!gd)return sS??(sS=function(Y){let J,oe=null;function ce(){J=new Uint8Array(oe.buffer)}function he(){throw new Error("Unexpected Draco error.")}const we={a:{a:he,d:function(Te,Pe,He){return J.copyWithin(Te,Pe,Pe+He)},c:function(Te){const Pe=J.length,He=Math.max(Te>>>0,Math.ceil(1.2*Pe)),Fe=Math.ceil((He-Pe)/65536);try{return oe.grow(Fe),ce(),!0}catch{return!1}},b:he}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Y,we):Y.then(Te=>Te.arrayBuffer()).then(Te=>WebAssembly.instantiate(Te,we))).then(Te=>{const{Rb:Pe,Qb:He,P:Fe,T:Ye,X:tt,Ja:it,La:Tt,Qa:ft,Va:At,Wa:Rt,eb:Bt,jb:er,f:Wt,e:Lt,yb:Gt,zb:wt,Ab:xt,Bb:Vt,Db:Yt,Gb:Ft}=Te.instance.exports;oe=Lt;const gr=(()=>{let br=0,hr=0,ar=0,en=0;return lr=>{ar&&(Pe(en),Pe(br),hr+=ar,ar=br=0),br||(hr+=128,br=He(hr));const Lr=lr.length+7&-8;let nn=br;Lr>=hr&&(ar=Lr,nn=en=He(Lr));for(let wn=0;wn<lr.length;wn++)J[nn+wn]=lr[wn];return nn}})();return ce(),Wt(),{memory:Lt,_free:Pe,_malloc:He,Mesh:class{constructor(){this.ptr=Fe()}destroy(){Ye(this.ptr)}},Decoder:class{constructor(){this.ptr=it()}destroy(){er(this.ptr)}DecodeArrayToMesh(br,hr,ar){const en=gr(br),lr=Tt(this.ptr,en,hr,ar.ptr);return!!tt(lr)}GetAttributeByUniqueId(br,hr){return{ptr:ft(this.ptr,br.ptr,hr)}}GetTrianglesUInt16Array(br,hr,ar){At(this.ptr,br.ptr,hr,ar)}GetTrianglesUInt32Array(br,hr,ar){Rt(this.ptr,br.ptr,hr,ar)}GetAttributeDataArrayForAllPoints(br,hr,ar,en,lr){Bt(this.ptr,br.ptr,hr.ptr,ar,en,lr)}},DT_INT8:Gt(),DT_UINT8:wt(),DT_INT16:xt(),DT_UINT16:Vt(),DT_UINT32:Yt(),DT_FLOAT32:Ft()}})}(fetch(DV())),sS.then(Y=>{gd=Y,sS=void 0}))}()),H&&U.push(function(){if(eM)return;const Y=function(J){let oe;const ce=WebAssembly.instantiateStreaming(J,{}).then(Te=>{oe=Te.instance,oe.exports.__wasm_call_ctors()}),he={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},we={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ce,supported:!0,decodeGltfBuffer(Te,Pe,He,Fe,Ye,tt){(function(it,Tt,ft,At,Rt,Bt,er){const Wt=it.exports.sbrk,Lt=At+3&-4,Gt=Wt(Lt*Rt),wt=Wt(Bt.length),xt=new Uint8Array(it.exports.memory.buffer);xt.set(Bt,wt);const Vt=Tt(Gt,At,Rt,wt,Bt.length);if(Vt===0&&er&&er(Gt,Lt,Rt),ft.set(xt.subarray(Gt,Gt+At*Rt)),Wt(Gt-Wt(0)),Vt!==0)throw new Error(`Malformed buffer data: ${Vt}`)})(oe,oe.exports[we[Ye]],Te,Pe,He,Fe,oe.exports[he[tt]])}}}(fetch(LV()));return Y.ready.then(()=>{eM=Y})}()),x)for(let Y=0;Y<x.length;Y++)U.push(ofe(x[Y],p,Y,c));return(U.length?Promise.all(U):Promise.resolve()).then(()=>{if(q&&b)for(const{primitives:Y}of b)for(const J of Y)ife(J,p);if(H&&b&&I)for(const Y of I)sfe(Y,p);return p})})}function qV(u){return fetch(u).then(a=>a.arrayBuffer()).then(a=>VV(a,0,u))}function rM(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function nM(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class iM{constructor(a,c,p,g){this.context=a,this.format=p,this.useMipmap=g&&g.useMipmap,this.texture=a.gl.createTexture(),this.update(c,{premultiply:g&&g.premultiply})}update(a,c){const p=a&&a instanceof HTMLVideoElement&&a.width===0?a.videoWidth:a.width,g=a&&a instanceof HTMLVideoElement&&a.height===0?a.videoHeight:a.height,{context:x}=this,{gl:b}=x,{x:C,y:I}=c&&c.position?c.position:{x:0,y:0},D=C+p,U=I+g;!this.size||this.size[0]===D&&this.size[1]===U||(b.bindTexture(b.TEXTURE_2D,null),b.deleteTexture(this.texture),this.texture=b.createTexture(),this.size=null),b.bindTexture(b.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA8&&(!c||c.premultiply!==!1));const q=a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||ImageBitmap&&a instanceof ImageBitmap;if(!this.size&&D>0&&U>0){const H=this.useMipmap?Math.floor(Math.log2(Math.max(D,U)))+1:1;b.texStorage2D(b.TEXTURE_2D,H,this.format,D,U),this.size=[D,U]}this.size&&(q?b.texSubImage2D(b.TEXTURE_2D,0,C,I,rM(this.format),nM(this.format),a):"data"in a&&a.data&&b.texSubImage2D(b.TEXTURE_2D,0,C,I,p,g,rM(this.format),nM(this.format),a.data)),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(a,c,p=!1){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),a!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap&&!p?a===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),c!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(a,c,p,g,x){const{context:b}=this,{gl:C}=b;C.bindTexture(C.TEXTURE_2D,this.texture),c!==this.magFilter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,c),this.magFilter=c),a!==this.minFilter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,this.useMipmap?a===C.NEAREST?C.NEAREST_MIPMAP_NEAREST:C.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),p!==this.wrapS&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,p),this.wrapS=p),g!==this.wrapT&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,g),this.wrapT=g),x!==this.compareMode&&(x?(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_MODE,C.COMPARE_REF_TO_TEXTURE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_FUNC,x)):C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_MODE,C.NONE),this.compareMode=x)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class oS{constructor(a,c){this.context=a,this.texture=c}bind(a,c){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),a!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a),this.minFilter=a),c!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,c),this.wrapS=c)}}const lfe=Cn([{name:"a_pos_3f",components:3,type:"Float32"}]),cfe=Cn([{name:"a_color_3f",components:3,type:"Float32"}]),ufe=Cn([{name:"a_color_4f",components:4,type:"Float32"}]),dfe=Cn([{name:"a_uv_2f",components:2,type:"Float32"}]),hfe=Cn([{name:"a_normal_3f",components:3,type:"Float32"}]),ffe=Cn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),pfe=Cn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function HV(u,a){const c=hC(u.projection,u.zoom,u.width,u.height),p=function(x,b,C,I,D){const U=new Q(C.lng-180*om,C.lat),q=new Q(C.lng+180*om,C.lat),H=x.project(U.lng,U.lat),Y=x.project(q.lng,q.lat),J=-Math.atan2(Y.y-H.y,Y.x-H.x),oe=ut.fromLngLat(C);oe.y=ve(oe.y,-1+om,1-om);const ce=oe.toLngLat(),he=x.project(ce.lng,ce.lat),we=ut.fromLngLat(ce);we.x+=om;const Te=we.toLngLat(),Pe=x.project(Te.lng,Te.lat),He=WV(Pe.x-he.x,Pe.y-he.y,J),Fe=ut.fromLngLat(ce);Fe.y+=om;const Ye=Fe.toLngLat(),tt=x.project(Ye.lng,Ye.lat),it=WV(tt.x-he.x,tt.y-he.y,J),Tt=Math.abs(He.x)/Math.abs(it.y),ft=N([]);K(ft,ft,-J*(1-(D?0:I)));const At=N([]);return B(At,At,[1,1-(1-Tt)*I,1]),At[4]=-it.x/it.y*I,K(At,At,J),M(At,ft,At),At}(u.projection,0,u.center,c,a),g=GV(u);return B(p,p,[g,g,1]),p}function GV(u){const a=u.projection,c=hC(u.projection,u.zoom,u.width,u.height),p=sM(a,u.center),g=sM(a,Q.convert(a.center));return Math.pow(2,p*c+(1-c)*g)}function hC(u,a,c,p,g=1/0){const x=u.range;if(!x)return 0;const b=Math.min(g,Math.max(c,p)),C=Math.log2(b/1024);return Me(x[0]+C,x[1]+C,a)}const om=1/4e4;function sM(u,a){const c=ve(a.lat,-Ie,Ie),p=new Q(a.lng-180*om,c),g=new Q(a.lng+180*om,c),x=u.project(p.lng,c),b=u.project(g.lng,c),C=ut.fromLngLat(p),I=ut.fromLngLat(g),D=b.x-x.x,U=b.y-x.y,q=I.x-C.x,H=I.y-C.y,Y=Math.sqrt((q*q+H*H)/(D*D+U*U));return Math.log2(Y)}function WV(u,a,c){const p=Math.cos(c),g=Math.sin(c);return{x:u*p-a*g,y:u*g+a*p}}function KV(u,a,c){N(u),K(u,u,vn(a[2])),$(u,u,vn(a[0])),W(u,u,vn(a[1])),B(u,u,c),M(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function fC(u,a,c,p,g,x,b,C){const I=[c[0]-a[0],c[1]-a[1],0],D=[p[0]-a[0],p[1]-a[1],0];if(be(I)<1e-12||be(D)<1e-12)return Cr(u);const U=_t([],I,D);ke(U,U),me(D,p,a),I[2]=(x-g)*C,D[2]=(b-g)*C;const q=I;return _t(q,I,D),ke(q,q),_s(u,U,q)}function pC(u,a,c=!1){const p=im(a.zoom),g=function(x,b,C){const I=b.worldSize,D=[x[12],x[13],x[14]],U=je(D[1]/I),q=Ne(D[0]/I),H=N([]),Y=Ee(1,U)*I,J=Ee(1,0)*I*Ue(U,b.zoom),oe=1/RR(I);let ce=J*oe;if(C){const Pe=hC(b.projection,b.zoom,b.width,b.height,1024);ce=oe*b.projection.pixelSpaceConversion(b.center.lat,I,Pe)}const he=z(U,q);xe(he,he,Oe([],ke([],he),Y*ce*D[2]));const we=function(Pe){const He=[Pe[0],Pe[1],Pe[2]];let Fe=[0,1,0];const Ye=_t([],Fe,He);return _t(Fe,He,Ye),Ke(Fe)===0&&(Fe=[0,1,0],_t(Ye,He,Fe)),ke(Ye,Ye),ke(Fe,Fe),ke(He,He),[Ye[0],Ye[1],Ye[2],0,Fe[0],Fe[1],Fe[2],0,He[0],He[1],He[2],0,Pe[0],Pe[1],Pe[2],1]}(he);B(H,H,[ce,ce,ce*Y]),F(H,H,[-D[0],-D[1],-D[2]]);const Te=M([],b.globeMatrix,we);return M(Te,Te,H),M(Te,Te,x),Te}(u,a,c);if(p>0){const x=function(b,C){const I=C.worldSize,D=Ee(1,0)*I*Ue(C.center.lat,C.zoom)/RR(I),U=Ee(1,C.center.lat)*I,q=N([]);W(q,q,vn(C.center.lng)),$(q,q,vn(C.center.lat)),F(q,q,[0,0,xl]),B(q,q,[D,D,D*U]);const H=C.point;return F(q,q,[-H.x,-H.y,0]),M(q,q,b),M(q,C.globeMatrix,q)}(u,a);return function(b,C,I){const D=(J,oe,ce)=>{const he=be(J),we=be(oe),Te=Tf(J,oe,ce);return Oe(Te,Te,1/be(Te)*Kr(he,we,ce))},U=D([b[0],b[1],b[2]],[C[0],C[1],C[2]],I),q=D([b[4],b[5],b[6]],[C[4],C[5],C[6]],I),H=D([b[8],b[9],b[10]],[C[8],C[9],C[10]],I),Y=Tf([b[12],b[13],b[14]],[C[12],C[13],C[14]],I);return[U[0],U[1],U[2],0,q[0],q[1],q[2],0,H[0],H[1],H[2],0,Y[0],Y[1],Y[2],1]}(g,x,p)}return g}function aM(u,a,c,p){const g=_n.projectAabbCorners(p,c);let x=Number.MAX_VALUE;for(let C=0;C<g.length;++C){const I=g[C];I[0]=(.5*I[0]+.5)*a.width,I[1]=(.5-.5*I[1])*a.height,I[2]<x&&(x=I[2])}const b=function(C){const I=[];let D=0;for(let Y=1;Y<C.length;Y++)(C[Y][0]<C[D][0]||C[Y][0]===C[D][0]&&C[Y][1]<C[D][1])&&(D=Y);let U,q=D;const H=new Uint8Array(C.length);do{if(H[q])break;I.push(new at(C[q][0],C[q][1])),H[q]=1,U=(q+1)%C.length;for(let Y=0;Y<C.length;Y++){if(C[Y][0]===C[U][0]&&C[Y][1]===C[U][1]||C[Y][0]===C[q][0]&&C[Y][1]===C[q][1])continue;const J=[C[Y][0]-C[q][0],C[Y][1]-C[q][1]],oe=[C[U][0]-C[q][0],C[U][1]-C[q][1]],ce=J[0]*oe[1]-J[1]*oe[0];(ce>0||ce===0&&J[0]*oe[0]+J[1]*oe[1]>=0&&J[0]*J[0]+J[1]*J[1]>oe[0]*oe[0]+oe[1]*oe[1])&&(U=Y)}q=U}while(q!==D);return I.length>0&&I.push(I[0]),I}(g);if(ks(u,b))return x}const Ay=64,vx={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function mC(u,a,c,p,g,x,b,C,I,D=!1){const U=c.zoom,q=c.project(p),H=Ue(p.lat,U),Y=1/H;N(u),F(u,u,[q.x+b[0]*Y,q.y+b[1]*Y,b[2]]);let J=1,oe=1;const ce=c.worldSize;if(D){if(c.projection.name==="mercator"){let Pe=0;c.elevation&&(Pe=c.elevation.getAtPointOrZero(new ut(q.x/ce,q.y/ce),0));const He=Ut([],[q.x,q.y,Pe,1],c.projMatrix)[3]/c.cameraToCenterDistance;J=He,oe=He*Ue(c.center.lat,U)}else if(c.projection.name==="globe"){const Pe=pC(u,c),He=[0,0,0,1];Ut(He,He,M([],c.projMatrix,Pe));const Fe=He[3]/c.cameraToCenterDistance,Ye=im(U),tt=c.projection.pixelsPerMeter(p.lat,ce)*Ue(p.lat,U),it=c.projection.pixelsPerMeter(c.center.lat,ce)*Ue(c.center.lat,U);J=Fe/Kr(tt,Ge(c.center.lat),Ye),oe=Fe*H/tt,J*=it,oe*=it}}else J=Y;B(u,u,[J,J,oe]);const he=[...u],we=a.orientation,Te=[];if(KV(Te,[we[0]+(g?g[0]:0),we[1]+(g?g[1]:0),we[2]+(g?g[2]:0)],x),M(u,he,Te),C&&c.elevation){let Pe=0;const He=[];if(I&&c.elevation){Pe=function(Ye,tt,it,Tt,ft){const At=tt.elevation;if(!At)return 0;const Rt=_n.projectAabbCorners(it,Tt),Bt=Ee(1,ft.lat)*tt.worldSize,er=function(hr,ar){const en=[0,0,1],lr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Lr of lr){const nn=hr[Lr.corners[0]],wn=hr[Lr.corners[1]],Vn=hr[Lr.corners[2]],an=[wn[0]-nn[0],wn[1]-nn[1],ar*(wn[2]-nn[2])],ti=_t(an,an,[Vn[0]-nn[0],Vn[1]-nn[1],ar*(Vn[2]-nn[2])]);ke(ti,ti),Lr.dotProductWithUp=st(ti,en)}return lr.sort((Lr,nn)=>Lr.dotProductWithUp-nn.dotProductWithUp),lr[0].corners}(Rt,Bt),Wt=Rt[er[0]],Lt=Rt[er[1]],Gt=Rt[er[2]],wt=Rt[er[3]],xt=At.getAtPointOrZero(new ut(Wt[0]/tt.worldSize,Wt[1]/tt.worldSize),0),Vt=At.getAtPointOrZero(new ut(Lt[0]/tt.worldSize,Lt[1]/tt.worldSize),0),Yt=At.getAtPointOrZero(new ut(Gt[0]/tt.worldSize,Gt[1]/tt.worldSize),0),Ft=At.getAtPointOrZero(new ut(wt[0]/tt.worldSize,wt[1]/tt.worldSize),0),gr=(xt+Ft)/2,br=(Vt+Yt)/2;return gr>br?Vt<Yt?fC(Ye,Lt,wt,Wt,Vt,Ft,xt,Bt):fC(Ye,Gt,Wt,wt,Yt,xt,Ft,Bt):xt<Ft?fC(Ye,Wt,Lt,Gt,xt,Vt,Yt,Bt):fC(Ye,wt,Gt,Lt,Ft,Yt,Vt,Bt),Math.max(gr,br)}(He,c,a.aabb,u,p);const Fe=M([],re([],He),Te);M(u,he,Fe)}else Pe=c.elevation.getAtPointOrZero(new ut(q.x/ce,q.y/ce),0);Pe!==0&&(u[14]+=Pe)}}class ZV{constructor(a,c,p,g,x){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=a,this.uri=c,this.position=p!=null?new Q(p[0],p[1]):new Q(0,0),this.orientation=g??[0,0,0],this.nodes=x,this.uploaded=!1,this.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,c){M(a.globalMatrix,c,a.localMatrix);const p=this.nodeOverrides.get(a.name);if(p!==void 0){const b=[];x=p.orientation,N(g=b),W(g,g,vn(x[1])),K(g,g,vn(x[2])),$(g,g,vn(x[0])),M(a.globalMatrix,a.globalMatrix,b)}var g,x;if(a.meshes)for(const b of a.meshes){const C=_n.applyTransformFast(b.aabb,a.globalMatrix);this.aabb.encapsulate(C)}if(a.children)for(const b of a.children)this._applyTransformations(b,a.globalMatrix)}computeBoundsAndApplyParent(){const a=N([]);this.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.nodes)this._applyTransformations(c,a)}computeModelMatrix(a,c,p,g,x,b,C=!1){mC(this.matrix,this,a.transform,this.position,c,p,g,x,b,C)}upload(a){if(!this.uploaded){for(const c of this.nodes)oM(c,a);for(const c of this.nodes)gC(c);this.uploaded=!0}}destroy(){for(const a of this.nodes)lM(a)}}function lS(u,a,c=!1){u.uploaded||(u.gfxTexture=new iM(a,u.image,c?a.gl.R8:a.gl.RGBA8,{useMipmap:u.sampler.minFilter>=a.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function mfe(u,a,c){u.indexBuffer=a.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=a.createVertexBuffer(u.vertexArray,lfe.members,!1,!0),u.normalArray&&(u.normalBuffer=a.createVertexBuffer(u.normalArray,hfe.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=a.createVertexBuffer(u.texcoordArray,dfe.members,!1,!0)),u.colorArray&&(u.colorBuffer=a.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?cfe:ufe).members,!1,!0)),u.featureArray&&(u.pbrBuffer=a.createVertexBuffer(u.featureArray,pfe.members,!0)),u.segments=ds.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const p=u.material;p.pbrMetallicRoughness.baseColorTexture&&lS(p.pbrMetallicRoughness.baseColorTexture,a),p.pbrMetallicRoughness.metallicRoughnessTexture&&lS(p.pbrMetallicRoughness.metallicRoughnessTexture,a),p.normalTexture&&lS(p.normalTexture,a),p.occlusionTexture&&lS(p.occlusionTexture,a,c),p.emissionTexture&&lS(p.emissionTexture,a)}function oM(u,a,c){if(u.meshes)for(const p of u.meshes)mfe(p,a,c);if(u.children)for(const p of u.children)oM(p,a,c)}function gC(u){if(u.meshes)for(const a of u.meshes)a.indexArray.destroy(),a.vertexArray.destroy(),a.colorArray&&a.colorArray.destroy(),a.normalArray&&a.normalArray.destroy(),a.texcoordArray&&a.texcoordArray.destroy(),a.featureArray&&a.featureArray.destroy();if(u.children)for(const a of u.children)gC(a)}function lM(u){if(u.meshes)for(const c of u.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((a=c.material).pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()));var a;if(u.children)for(const c of u.children)lM(c)}function Cy(u,a){const c=u.json.bufferViews[a.bufferView],p=uC[a.componentType];return new p(u.buffers[c.buffer],(a.byteOffset||0)+(c.byteOffset||0),a.count*(c.byteStride&&c.byteStride!==aS[a.type]*p.BYTES_PER_ELEMENT?c.byteStride/p.BYTES_PER_ELEMENT:aS[a.type]))}function cM(u,a,c,p){const g=uC[a.componentType],x=function(U){switch(U){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),b=u.json.bufferViews[a.bufferView],C=b.byteStride?b.byteStride/g.BYTES_PER_ELEMENT:aS[a.type],I=c.float32,D=I.length/c.capacity;for(let U=0,q=0;U<a.count*C;U+=C,q+=D)for(let H=0;H<D;H++)I[q+H]=p[U+H]*x;c._trim()}function gfe(u,a,c){const p=u.indices,g=u.attributes,x={};x.indexArray=new is;const b=a.json.accessors[p],C=b.count/3;x.indexArray.reserve(C);const I=Cy(a,b);for(let H=0;H<C;H++)x.indexArray.emplaceBack(I[3*H],I[3*H+1],I[3*H+2]);x.indexArray._trim(),x.vertexArray=new Kl;const D=a.json.accessors[g.POSITION];x.vertexArray.reserve(D.count);const U=Cy(a,D);for(let H=0;H<D.count;H++)x.vertexArray.emplaceBack(U[3*H],U[3*H+1],U[3*H+2]);if(x.vertexArray._trim(),x.aabb=new _n(D.min,D.max),x.centroid=function(H,Y){const J=[0,0,0],oe=H.length;if(oe>0){for(let ce=0;ce<oe;ce++){const he=3*H[ce];J[0]+=Y[he],J[1]+=Y[he+1],J[2]+=Y[he+2]}J[0]/=oe,J[1]/=oe,J[2]/=oe}return J}(I,U),g.COLOR_0!==void 0){const H=a.json.accessors[g.COLOR_0],Y=aS[H.type],J=Cy(a,H);x.colorArray=Y===3?new Kl:new lh,x.colorArray.resize(H.count),cM(a,H,x.colorArray,J)}if(g.NORMAL!==void 0){x.normalArray=new Kl;const H=a.json.accessors[g.NORMAL];x.normalArray.resize(H.count);const Y=Cy(a,H);cM(a,H,x.normalArray,Y)}if(g.TEXCOORD_0!==void 0&&c.length>0){x.texcoordArray=new ch;const H=a.json.accessors[g.TEXCOORD_0];x.texcoordArray.resize(H.count);const Y=Cy(a,H);cM(a,H,x.texcoordArray,Y)}if(g._FEATURE_ID_RGBA4444!==void 0){const H=a.json.accessors[g._FEATURE_ID_RGBA4444];a.json.extensionsUsed&&a.json.extensionsUsed.includes("EXT_meshopt_compression")&&(x.featureData=Cy(a,H))}g._FEATURE_RGBA4444!==void 0&&(x.featureData=new Uint32Array(Cy(a,a.json.accessors[g._FEATURE_RGBA4444]).buffer));const q=u.material;return x.material=function(H,Y){const{emissiveFactor:J=[0,0,0],alphaMode:oe="OPAQUE",alphaCutoff:ce=.5,normalTexture:he,occlusionTexture:we,emissiveTexture:Te,doubleSided:Pe,name:He}=H,{baseColorFactor:Fe=[1,1,1,1],metallicFactor:Ye=1,roughnessFactor:tt=1,baseColorTexture:it,metallicRoughnessTexture:Tt}=H.pbrMetallicRoughness||{},ft=we?Y[we.index]:void 0;if(we&&we.extensions&&we.extensions.KHR_texture_transform&&ft){const At=we.extensions.KHR_texture_transform;ft.offsetScale=[At.offset[0],At.offset[1],At.scale[0],At.scale[1]]}return{name:He,pbrMetallicRoughness:{baseColorFactor:new hi(...Fe),metallicFactor:Ye,roughnessFactor:tt,baseColorTexture:it?Y[it.index]:void 0,metallicRoughnessTexture:Tt?Y[Tt.index]:void 0},doubleSided:Pe,emissiveFactor:new hi(...J),alphaMode:oe,alphaCutoff:ce,normalTexture:he?Y[he.index]:void 0,occlusionTexture:ft,emissionTexture:Te?Y[Te.index]:void 0,defined:H.defined===void 0}}(q!==void 0?a.json.materials[q]:{defined:!1},c),x}function XV(u,a,c){const{matrix:p,rotation:g,translation:x,scale:b,mesh:C,extras:I,children:D,name:U}=u,q={};if(q.name=U,q.localMatrix=p||function(H,Y,J,oe){var ce=Y[0],he=Y[1],we=Y[2],Te=Y[3],Pe=ce+ce,He=he+he,Fe=we+we,Ye=ce*Pe,tt=ce*He,it=ce*Fe,Tt=he*He,ft=he*Fe,At=we*Fe,Rt=Te*Pe,Bt=Te*He,er=Te*Fe,Wt=oe[0],Lt=oe[1],Gt=oe[2];return H[0]=(1-(Tt+At))*Wt,H[1]=(tt+er)*Wt,H[2]=(it-Bt)*Wt,H[3]=0,H[4]=(tt-er)*Lt,H[5]=(1-(Ye+At))*Lt,H[6]=(ft+Rt)*Lt,H[7]=0,H[8]=(it+Bt)*Gt,H[9]=(ft-Rt)*Gt,H[10]=(1-(Ye+Tt))*Gt,H[11]=0,H[12]=J[0],H[13]=J[1],H[14]=J[2],H[15]=1,H}([],g||[0,0,0,1],x||[0,0,0],b||[1,1,1]),q.globalMatrix=P(q.localMatrix),C!==void 0){q.meshes=c[C];const H=q.anchor=[0,0];for(const Y of q.meshes){const{min:J,max:oe}=Y.aabb;H[0]+=J[0]+oe[0],H[1]+=J[1]+oe[1]}H[0]=Math.floor(H[0]/q.meshes.length/2),H[1]=Math.floor(H[1]/q.meshes.length/2)}if(I&&(I.id&&(q.id=I.id),I.lights&&(q.lights=function(H){if(!H.length)return[];const Y=function(we){const Te=atob(we),Pe=new Uint8Array(Te.length);for(let He=0;He<Te.length;He++)Pe[He]=Te.codePointAt(He);return Pe}(H),J=[],oe=Y.length/24,ce=new Uint16Array(Y.buffer),he=new Float32Array(Y.buffer);for(let we=0;we<oe;we++){const Te=ce[2*we*6]/30,Pe=ce[2*we*6+1]/30,He=ce[2*we*6+10]/100,Fe=he[6*we+1],Ye=he[6*we+2],tt=he[6*we+3],it=he[6*we+4],Tt=tt-Fe,ft=it-Ye,At=Math.hypot(Tt,ft);J.push({pos:[Fe+.5*Tt,Ye+.5*ft,Pe],normal:[ft/At,-Tt/At,0],width:At,height:Te,depth:He,points:[Fe,Ye,tt,it]})}return J}(I.lights)),I.MAPBOX_geometry_bloom&&(q.isGeometryBloom=I.MAPBOX_geometry_bloom)),D){const H=[];for(const Y of D)H.push(XV(a.json.nodes[Y],a,c));q.children=H}return q}function yfe(u){if(u.vertices.length===0||u.indices.length===0)return null;const a=new rC(u.vertices,u.indices,8,256),[c,p]=[a.min.clone(),a.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:a,min:c,max:p}}function vfe(u){if(!u.extras||!u.extras.ground)return null;const a=u.extras.ground;if(!a||!Array.isArray(a)||a.length===0)return null;const c=a[0];if(!c||!Array.isArray(c)||c.length===0)return null;const p=[];for(const b of c){if(!Array.isArray(b)||b.length!==2)continue;const C=b[0],I=b[1];typeof C=="number"&&typeof I=="number"&&p.push(new at(C,I))}if(p.length<3)return null;p.length>1&&p[p.length-1].equals(p[0])&&p.pop();let g=0;for(let b=0;b<p.length;b++){const C=p[b],I=p[(b+1)%p.length],D=p[(b+2)%p.length];g+=(C.x-I.x)*(D.y-I.y)-(D.x-I.x)*(C.y-I.y)}g>0&&p.reverse();const x=hx(p.flatMap(b=>[b.x,b.y]),[]);return x.length===0?null:{vertices:p,indices:x}}function _fe(u,a){const c=[],p=[];let g=0;const x=[];for(const b of u){g=c.length;const C=b.vertexArray.float32,I=b.indexArray.uint16;for(let D=0;D<b.vertexArray.length;D++)x[0]=C[3*D+0],x[1]=C[3*D+1],x[2]=C[3*D+2],Dt(x,x,a),c.push(new at(x[0],x[1]));for(let D=0;D<3*b.indexArray.length;D++)p.push(I[D]+g)}if(p.length%3!=0)return null;for(let b=0;b<p.length;b+=3){const C=c[p[b+0]],I=c[p[b+1]],D=c[p[b+2]];(C.x-I.x)*(D.y-I.y)-(D.x-I.x)*(C.y-I.y)>0&&([p[b+1],p[b+2]]=[p[b+2],p[b+1]])}return{vertices:c,indices:p}}function uM(u){const a=function(I,D){const U=[],q=WebGL2RenderingContext;if(I.json.textures)for(const H of I.json.textures){const Y={magFilter:q.LINEAR,minFilter:q.NEAREST,wrapS:q.REPEAT,wrapT:q.REPEAT};H.sampler!==void 0&&Object.assign(Y,I.json.samplers[H.sampler]),U.push({image:D[H.source],sampler:Y,uploaded:!1})}return U}(u,u.images),c=function(I,D){const U=[];for(const q of I.json.meshes){const H=[];for(const Y of q.primitives)H.push(gfe(Y,I,D));U.push(H)}return U}(u,a),{scenes:p,scene:g,nodes:x}=u.json,b=p?p[g||0].nodes:[...x.keys()],C=[];for(const I of b)C.push(XV(x[I],u,c));return function(I,D,U){const q={},H=new Set;for(let Y=0;Y<I.length;Y++){const J=U[D[Y]];if(!J.extras)continue;const oe=J.extras["mapbox:footprint:version"],ce=J.extras["mapbox:footprint:id"];(oe||ce)&&H.add(Y),oe==="1.0.0"&&ce&&(q[ce]=Y)}for(let Y=0;Y<I.length;Y++){if(H.has(Y))continue;const J=I[Y],oe=U[D[Y]];if(!oe.extras)continue;let ce=null;J.id in q&&(ce=_fe(I[q[J.id]].meshes,J.localMatrix)),ce||(ce=vfe(oe)),ce&&(J.footprint=yfe(ce))}if(H.size>0){const Y=Array.from(H.values()).sort((J,oe)=>J-oe);for(let J=Y.length-1;J>=0;J--)I.splice(Y[J],1)}}(C,b,u.json.nodes),C}function xfe(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const a=u.vertexArray.float32,c=u.aabb.min[0]-1,p=u.aabb.min[1]-1,g=Ay/(u.aabb.max[0]-c+2),x=Ay/(u.aabb.max[1]-p+2);for(let b=0;b<a.length;b+=3){const C=a[b+2],I=(a[b+0]-c)*g|0,D=(a[b+1]-p)*x|0;C>u.heightmap[D*Ay+I]&&(u.heightmap[D*Ay+I]=C)}}function YV(u,a,c,p,g){c.reserve(c.length+4*u.length),p.reserve(p.length+10*u.length),g.reserve(g.length+10*u.length);let x=p.length;for(const b of u){const C=Math.min(10,Math.max(4,1.3*b.height))*a,I=[-b.normal[1],b.normal[0],0],D=Math.min(.29,.1*b.width/b.depth),U=b.width-2*b.depth*a*(D+.01),q=Xe([],b.pos,I,U/2),H=Xe([],b.pos,I,-U/2),Y=[q[0],q[1],q[2]+b.height],J=[H[0],H[1],H[2]+b.height],oe=Xe([],b.normal,I,D);Oe(oe,oe,C);const ce=Xe([],b.normal,I,-D);Oe(ce,ce,C),xe(oe,q,oe),xe(ce,H,ce),q[2]+=.1,H[2]+=.1,p.emplaceBack(oe[0],oe[1],oe[2]),p.emplaceBack(ce[0],ce[1],ce[2]),p.emplaceBack(q[0],q[1],q[2]),p.emplaceBack(H[0],H[1],H[2]),p.emplaceBack(Y[0],Y[1],Y[2]),p.emplaceBack(J[0],J[1],J[2]),p.emplaceBack(q[0],q[1],q[2]),p.emplaceBack(H[0],H[1],H[2]),p.emplaceBack(oe[0],oe[1],oe[2]),p.emplaceBack(ce[0],ce[1],ce[2]);const he=U/C/2;g.emplaceBack(-he-D,-1,he,.8),g.emplaceBack(he+D,-1,he,.8),g.emplaceBack(-he,0,he,1.3),g.emplaceBack(he,0,he,1.3),g.emplaceBack(he+D,-.8,he,.7),g.emplaceBack(he+D,-.8,he,.7),g.emplaceBack(0,0,he,1.3),g.emplaceBack(0,0,he,1.3),g.emplaceBack(he+D,-1.2,he,.8),g.emplaceBack(he+D,-1.2,he,.8),c.emplaceBack(6+x,4+x,8+x),c.emplaceBack(7+x,9+x,5+x),c.emplaceBack(0+x,1+x,2+x),c.emplaceBack(1+x,3+x,2+x),x+=10}}function bfe(u,a){const c={};c.indexArray=new is,c.vertexArray=new Kl,c.colorArray=new lh,YV(u,a,c.indexArray,c.vertexArray,c.colorArray);const p={defined:!0};p.emissiveFactor=hi.black;const g={};return g.baseColorFactor=hi.white,p.pbrMetallicRoughness=g,c.material=p,c.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}const JV=Cn([{name:"a_pos_3f",components:3,type:"Float32"}]),wfe=Cn([{name:"a_normal_3",components:3,type:"Int16"}]),Sfe=Cn([{name:"a_centroid_3",components:3,type:"Int16"}]),QV=Cn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Efe=Cn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Tfe=Cn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Afe=Cn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Cfe=Cn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),jfe=Cn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),e6=$t.types,yC=32767;function Pfe(u,a){const c=rr+a;for(const p of u)for(const g of p)if(g.x<-a||g.x>c||g.y<-a||g.y>c)return!1;return!0}class t6{constructor(){this.layoutVertexArray=new Kl,this.layoutAttenuationArray=new lh,this.layoutColorArray=new Oc,this.indexArray=new is,this.indexArrayForConflation=new is,this.segmentsBucket=new ds}}class dM{constructor(){this.layoutVertexArray=new Kl,this.layoutNormalArray=new bf,this.layoutCentroidArray=new bf,this.layoutColorArray=new Oc,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new rx,this.layoutAOArray=new hd,this.indexArray=new is,this.indexArrayForConflation=new is,this.segmentsBucket=new ds,this.entranceBloom=new t6}}class r6{constructor(a){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new dM,this.buildingWithFacade=new dM,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=a.zoom,this.canonical=a.canonical,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.worldview=a.worldview,this.lut=a.lut,this.buildingWithFacade.layoutFacadePaintArray=new Oc,this.buildingWithFacade.layoutFacadeDataArray=new wf,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Oc,this.programConfigurations=new tu(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.groundEffect=new ZR(a),this.groundEffect.groundRadiusArray=new hd,this.hasAppearances=null}updateFootprints(a,c){for(const p of this.footprints)c.push({footprint:p,id:a})}updateAppearances(a,c,p,g){}prepare(){return function(){if(cC!=null||MV!=null)return null;if(yx!=null)return yx;const a=fetch(Ji.BUILDING_GEN_URL);return yx=function(c){let p,g,x,b;function C(){p=new Uint8Array(b.buffer),g=new Int32Array(b.buffer),x=new Float32Array(b.buffer)}function I(){throw new Error("Unexpected BuildingGen error.")}const D=()=>{},U={a:{a:I,f:function(q){const H=p.length,Y=Math.max(q>>>0,Math.ceil(1.2*H)),J=Math.ceil((Y-H)/65536);try{return b.grow(J),C(),!0}catch{return!1}},g:I,b:D,c:D,d:D,e:D}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(c,U):c.then(q=>q.arrayBuffer()).then(q=>WebAssembly.instantiate(q,U))).then(q=>{const H=q.instance.exports;return(0,H.g)(),b=H.f,C(),new tfe({setStyle:H.h,setAOOptions:H.i,setMetricOptions:H.j,setStructuralOptions:H.k,setFacadeOptions:H.l,setFauxFacadeOptions:H.m,setFacadeClassifierOptions:H.n,addFeature:H.o,addFacade:H.p,generateMesh:H.q,getLastError:H.r,getOuterRingLength:H.s,getMeshCount:H.t,getPositionsPtr:H.u,getPositionsLength:H.v,getNormalsPtr:H.w,getNormalsLength:H.x,getColorsPtr:H.y,getColorsLength:H.z,getAOPtr:H.A,getAOLength:H.B,getUVPtr:H.C,getUVLength:H.D,getFauxFacadePtr:H.E,getFauxFacadeLength:H.F,getIndicesPtr:H.G,getIndicesLength:H.H,getBuildingPart:H.I,getRingCount:H.J,getRingPtr:H.K,getRingLength:H.L,free:H.M,malloc:H.N,heapU8:p,heap32:g,heapF32:x})})}(a).then(c=>(yx=null,cC=c,cC)).catch(c=>{zr("Could not load building-gen"),yx=null,MV=c}),yx}()}populate(a,c,p,g){const x=rfe();if(!x)return;const b=Ze(p);this.tileToMeter=b,this.brightness=c.brightness,x.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,b],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:b,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),x.setAOOptions(!1,.3),x.setMetricOptions(!1,16),x.setStructuralOptions(!0),x.setFacadeClassifierOptions(3);const C=new Map,I=new Map;for(const{feature:D}of a){if(e6[D.type]!=="LineString"){C.set(D.id,D.properties.source_id);continue}const U=this.layers[0]._featureFilter.needGeometry,q=yt(D,U);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),q,p))continue;const H=U?q.geometry:Nt(D,p,g),Y=[];for(const he of H)for(const we of he)Y.push({x:we.x,y:we.y});const J={coordinates:Y,crossPerc:D.properties.cross_perc,distanceToRoad:D.properties.distance_to_road,entrances:D.properties.entrances,sourceId:0},oe=D.properties.source_id;let ce=I.get(oe);ce||(ce=[],I.set(oe,ce)),ce.push(J)}this.maxHeight=0;for(const{feature:D,id:U,index:q,sourceLayerIndex:H}of a){if(e6[D.type]==="LineString")continue;const Y=this.layers[0]._featureFilter.needGeometry,J=yt(D,Y);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),J,p))continue;const oe=Y?J.geometry:Nt(D,p,g),ce=Y1(oe,500);if(!Pfe(oe,163))continue;const he=this.layers[0],we=he.layout.get("building-roof-shape").evaluate(D,{},p);if(we==="flat")continue;const Te=he.layout.get("building-base").evaluate(D,{},p),Pe=he.layout.get("building-height").evaluate(D,{},p),He=he.layout.get("building-flood-light-ground-radius").evaluate(D,{},p),Fe=he.paint.get("building-ambient-occlusion-intensity"),Ye=He/this.tileToMeter;let tt=he.layout.get("building-flood-light-wall-radius").evaluate(D,{},p);tt=ve(tt,0,2048);const it=tt/2048*yC,Tt=C.get(U);let ft;ft=I.has(Tt)?I.get(Tt):[];const At=ft.length!==0&&he.layout.get("building-facade").evaluate(D,{},p);x.setFacadeOptions(4,!0),x.setFauxFacadeOptions(At,!1,1);let Rt=0,Bt=0,er=0,Wt=0,Lt=0,Gt=0;if(At){let Ot=Math.round(he.layout.get("building-facade-floors").evaluate(D,{},p));if(Te===0){Ot=Math.max(1,Ot-(ft.length>0?1:0));let jr=4;if(Pe>100){const Tr=[10,13,15];jr=Tr[D.id?D.id%Tr.length:0],x.setFacadeOptions(jr,!0)}Lt=1.6803*jr/b}else Lt=Te/b;Gt=Pe/b,Lt=Math.min(Lt,Gt),er=he.layout.get("building-facade-unit-width").evaluate(D,{},p)/b,Wt=(Gt-Lt)/Ot,x.setFauxFacadeOptions(!0,!0,er);const or=he.layout.get("building-facade-window").evaluate(D,{},p);Rt=or[0],Bt=or[1]}const wt=[],xt=new at(1/0,1/0),Vt=new at(-1/0,-1/0),Yt=new at(0,0);let Ft=0;for(const Ot of ce)if(Ot.length>0){const or=[];for(const jr of Ot){const Tr=[];for(let ln=jr.length-1;ln>=0;ln--){const qr=jr[ln];Tr.push({x:qr.x,y:qr.y}),xt.x=Math.min(xt.x,qr.x),xt.y=Math.min(xt.y,qr.y),Vt.x=Math.max(Vt.x,qr.x),Vt.y=Math.max(Vt.y,qr.y),Yt.x+=qr.x,Yt.y+=qr.y,Ft++}or.push(Tr)}wt.push({id:D.id?D.id:0,height:Pe,minHeight:Te,sourceId:0,roofType:we,coordinates:or})}Yt.x/=Ft||1,Yt.y/=Ft||1;const gr=x.generateMesh(wt,ft);if(typeof gr=="string"){zr(`Unable to generate building ${D.id}: ${gr}`);continue}if(gr.meshes.length===0||gr.modifiedPolygonRings.length===0)continue;let br=0;for(const Ot of gr.meshes)br+=Ot.positions.length/3;const hr=At?this.buildingWithFacade:this.buildingWithoutFacade,ar=hr.segmentsBucket.prepareSegment(br,hr.layoutVertexArray,hr.indexArray),en=[];let lr=null,Lr=0,nn=-1;const wn=hr.layoutVertexArray.length,Vn=hr.indexArray.length;let an=0;for(const Ot of gr.meshes){const or=hr.layoutVertexArray.length;if(Ot.buildingPart==="entrance"){const Sr=new Array;for(let Bn=0;Bn<Ot.positions.length;Bn+=12){const Ci=Ot.positions[Bn+0],fi=Ot.positions[Bn+1],vs=Ot.positions[Bn+3],es=Ot.positions[Bn+4],zi=Ot.positions[Bn+2],xi=Ot.positions[Bn+8]-zi,ni=1,cn=vs-Ci,ii=es-fi,Bi=Math.hypot(cn,ii);Sr.push({pos:[Ci+.5*cn,fi+.5*ii,zi],normal:[ii/Bi,-cn/Bi,0],width:Bi,height:xi,depth:ni,points:[Ci,fi,vs,es]})}const Yn=hr.entranceBloom.segmentsBucket.prepareSegment(10*Sr.length,hr.entranceBloom.layoutVertexArray,hr.entranceBloom.indexArray),Ai=hr.entranceBloom.layoutVertexArray.length;Lr=hr.entranceBloom.indexArray.length,YV(Sr,.5/this.tileToMeter,hr.entranceBloom.indexArray,hr.entranceBloom.layoutVertexArray,hr.entranceBloom.layoutAttenuationArray);const Wr=hr.entranceBloom.layoutVertexArray.length-Ai;nn=hr.entranceBloom.indexArray.length-Lr;for(let Bn=0;Bn<Wr;Bn++)hr.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Yn.vertexLength+=Wr,Yn.primitiveLength+=nn,lr={part:Ot.buildingPart,vertexOffset:Ai,vertexLength:Wr}}for(let Sr=0;Sr<Ot.positions.length;Sr+=3)an=Math.max(an,Ot.positions[Sr+2]),hr.layoutVertexArray.emplaceBack(Ot.positions[Sr],Ot.positions[Sr+1],Ot.positions[Sr+2]);const jr=Math.floor(Yt.x),Tr=Math.floor(Yt.y),ln=Math.floor(an);for(let Sr=0;Sr<Ot.positions.length;Sr+=3)hr.layoutCentroidArray.emplaceBack(jr,Tr,ln),hr.layoutFloodLightDataArray.emplaceBack(Ot.buildingPart==="wall"?it:0);for(let Sr=0;Sr<Ot.normals.length;Sr+=3)hr.layoutNormalArray.emplaceBack(Ot.normals[Sr+0]*yC,Ot.normals[Sr+1]*yC,Ot.normals[Sr+2]*yC);for(let Sr=0;Sr<Ot.ao.length;Sr++)hr.layoutAOArray.emplaceBack(Ot.ao[Sr]);for(let Sr=0;Sr<Ot.colors.length;Sr+=3){const Yn=1+(Ot.ao[Sr/3]-1)*Fe;hr.layoutColorArray.emplaceBack(Ot.colors[Sr]*Yn<<8|Ot.colors[Sr+1]*Yn,Ot.colors[Sr+2]*Yn<<8)}if(At){for(let Sr=0;Sr<Ot.positions.length;Sr+=3)hr.layoutFacadePaintArray.emplaceBack(65535,255);for(let Sr=0;Sr<Ot.isFauxFacade.length;Sr++)if(Ot.isFauxFacade[Sr]){const Yn=1|Math.min(65535,Math.floor(Ot.uv[2*Sr]*gr.outerRingLength)),Ai=Math.floor(255*Rt)<<8|Math.floor(255*Bt),Wr=Math.floor(65535*Math.min(1,er/rr)),Bn=Math.floor(65535*Math.min(1,Wt/rr));hr.layoutFacadeDataArray.emplaceBack(Yn,Ai,Wr,Bn);const Ci=Math.floor(65535*Math.min(1,Lt/rr)),fi=Math.floor(65535*Math.min(1,Gt/rr));hr.layoutFacadeVerticalRangeArray.emplaceBack(Ci,fi)}else hr.layoutFacadeDataArray.emplaceBack(0,0,0,0),hr.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const qr=ar.vertexLength;for(let Sr=0;Sr<Ot.indices.length;Sr+=3)hr.indexArray.emplaceBack(qr+Ot.indices[Sr],qr+Ot.indices[Sr+1],qr+Ot.indices[Sr+2]);ar.vertexLength+=Ot.positions.length/3,ar.primitiveLength+=Ot.indices.length/3,(Ot.buildingPart==="roof"||Ot.buildingPart==="wall"||Ot.buildingPart==="facade_glazing"||Ot.buildingPart==="entrance")&&en.push({part:Ot.buildingPart,vertexOffset:or,vertexLength:Ot.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,an),this.buildingFeatures.push({promoteId:U,feature:J,hasFauxFacade:At,segment:ar,parts:en,buildingBloom:lr});const ti=hr.indexArray.length-Vn,ri=[],ls=[],ze=new at(1/0,1/0),Re=new at(-1/0,-1/0),Pt=this.groundEffect.vertexArray.length;for(const Ot of gr.modifiedPolygonRings){const or=[],jr=new at(1/0,1/0),Tr=new at(-1/0,-1/0);for(let ln=0;ln<Ot.length;ln+=2){const qr=Ot.length-ln-2;jr.x=Math.min(jr.x,Ot[qr]),jr.y=Math.min(jr.y,Ot[qr+1]),Tr.x=Math.max(Tr.x,Ot[qr]),Tr.y=Math.max(Tr.y,Ot[qr+1]);const Sr=new at(Ot[qr],Ot[qr+1]);or.push(Sr),ri.push(Sr.x,Sr.y),ls.push(Sr.clone())}ze.x=Math.min(ze.x,jr.x),ze.y=Math.min(ze.y,jr.y),Re.x=Math.max(Re.x,Tr.x),Re.y=Math.max(Re.y,Tr.y),this.groundEffect.addData(or,[jr,Tr],Ye)}const sr=this.groundEffect.vertexArray.length-Pt;for(let Ot=0;Ot<sr;Ot++)this.groundEffect.groundRadiusArray.emplaceBack(He);(xt.x<0||Vt.x>rr||xt.y<0||Vt.y>rr)&&this.featuresOnBorder.push({featureId:D.id,footprintIndex:this.footprints.length});{const Ot=hx(ri,null,2),or=new rC(ls,Ot,8,256);let jr=D.id;D.properties&&D.properties.hasOwnProperty("building_id")&&(jr=D.properties.building_id);const Tr={vertices:ls,indices:Ot,grid:or,min:ze,max:Re,buildingId:jr,hiddenFlags:0,indicesOffset:Vn,indicesLength:ti,bloomIndicesOffset:Lr,bloomIndicesLength:nn,groundEffectVertexOffset:Pt,groundEffectVertexLength:sr,hasFauxFacade:At,segment:ar,height:an};D.id!==void 0&&this.featureFootprintLookup.set(D.id,this.footprints.length),this.footprints.push(Tr)}this.programConfigurations.populatePaintArrays(hr.layoutVertexArray.length,D,q,{},c.availableImages,p,c.brightness),this.groundEffect.addPaintPropertiesData(D,q,{},c.availableImages,p,c.brightness),c.featureIndex.insert(D,oe,q,H,this.index,wn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(a,c,p,g,x,b,C){this.programConfigurations.updatePaintArrays(a,c,x,p,g,b,C),this.groundEffect.update(a,c,x,p,g,b,C),this.evaluate(this.layers[0],a),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){const c=p=>{p.layoutVertexBuffer=a.createVertexBuffer(p.layoutVertexArray,JV.members),p.layoutNormalBuffer=a.createVertexBuffer(p.layoutNormalArray,wfe.members),p.layoutCentroidBuffer=a.createVertexBuffer(p.layoutCentroidArray,Sfe.members),p.layoutFloodLightDataBuffer=a.createVertexBuffer(p.layoutFloodLightDataArray,jfe.members),p.layoutFacadeDataArray&&p.layoutFacadeDataArray.length&&(p.layoutFacadeDataBuffer=a.createVertexBuffer(p.layoutFacadeDataArray,Tfe.members)),p.layoutFacadeVerticalRangeArray&&p.layoutFacadeVerticalRangeArray.length&&(p.layoutFacadeVerticalRangeBuffer=a.createVertexBuffer(p.layoutFacadeVerticalRangeArray,Afe.members)),p.entranceBloom.layoutVertexArray.length&&(p.entranceBloom.layoutVertexBuffer=a.createVertexBuffer(p.entranceBloom.layoutVertexArray,JV.members),p.entranceBloom.layoutAttenuationBuffer=a.createVertexBuffer(p.entranceBloom.layoutAttenuationArray,Cfe.members)),this.uploadUpdatedColorBuffer(a),this.uploadUpdatedIndexBuffer(a)};this.uploaded||(c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){const a=c=>{c.layoutVertexBuffer&&(c.layoutVertexBuffer.destroy(),c.layoutNormalBuffer.destroy(),c.layoutColorBuffer.destroy(),c.segmentsBucket.destroy(),c.indexBuffer&&c.indexBuffer.destroy(),c.entranceBloom.layoutVertexBuffer&&(c.entranceBloom.layoutVertexBuffer.destroy(),c.entranceBloom.layoutColorBuffer.destroy(),c.entranceBloom.layoutAttenuationBuffer.destroy(),c.entranceBloom.indexBuffer.destroy(),c.entranceBloom.segmentsBucket.destroy()))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(a,c,p=!0){let g=!1;const x=p?c:0,b=0|(p?-1:~c);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const C of a){const I=this.footprints[C],D=I.hiddenFlags&b|x;I.hiddenFlags!==D&&(I.hiddenFlags=D,g=!0,this.groundEffect.updateHiddenByLandmarkRange(I.groundEffectVertexOffset,I.groundEffectVertexLength,I.hiddenFlags!==0))}return g&&(this.indexArrayForConflationUploaded=!1),g}uploadUpdatedIndexBuffer(a){if(this.groundEffect.uploadHiddenByLandmark(a),this.indexArrayForConflationUploaded)return;const c=g=>{g.indexArray.length!==0&&(g.indexArrayForConflation.resize(g.indexArray.length),g.indexArrayForConflation.uint16.set(g.indexArray.uint16),g.entranceBloom.indexArrayForConflation.resize(g.entranceBloom.indexArray.length),g.entranceBloom.indexArrayForConflation.uint16.set(g.entranceBloom.indexArray.uint16))};c(this.buildingWithoutFacade),c(this.buildingWithFacade);for(const g of this.footprints){const x=g.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,b=g.indicesOffset+g.indicesLength;if(g.hiddenFlags!==0){for(let I=g.indicesOffset;I<b;I++)x.indexArrayForConflation.uint16[3*I+0]=0,x.indexArrayForConflation.uint16[3*I+1]=0,x.indexArrayForConflation.uint16[3*I+2]=0;const C=g.bloomIndicesOffset+g.bloomIndicesLength;for(let I=g.bloomIndicesOffset;I<C;I++)x.entranceBloom.indexArrayForConflation.uint16[3*I+0]=0,x.entranceBloom.indexArrayForConflation.uint16[3*I+1]=0,x.entranceBloom.indexArrayForConflation.uint16[3*I+2]=0}}const p=g=>{g.indexArray.length!==0&&(g.indexBuffer?g.indexBuffer.updateData(g.indexArrayForConflation):g.indexBuffer=a.createIndexBuffer(g.indexArrayForConflation,!0),g.entranceBloom.indexBuffer?g.entranceBloom.indexBuffer.updateData(g.entranceBloom.indexArrayForConflation):g.entranceBloom.indexBuffer=a.createIndexBuffer(g.entranceBloom.indexArrayForConflation,!0))};p(this.buildingWithoutFacade),p(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(a){const c=p=>{p.layoutColorBuffer?p.layoutColorBuffer.updateData(p.layoutColorArray):p.layoutColorBuffer=a.createVertexBuffer(p.layoutColorArray,QV.members,!0),p.layoutFacadePaintArray&&(p.layoutFacadePaintBuffer?p.layoutFacadePaintBuffer.updateData(p.layoutFacadePaintArray):p.layoutFacadePaintBuffer=a.createVertexBuffer(p.layoutFacadePaintArray,Efe.members,!0)),p.entranceBloom.layoutColorBuffer?p.entranceBloom.layoutColorBuffer.updateData(p.entranceBloom.layoutColorArray):p.entranceBloom.layoutColorBuffer=a.createVertexBuffer(p.entranceBloom.layoutColorArray,QV.members,!0)};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(a,c){const p=a.paint.get("building-ambient-occlusion-intensity");for(const g of this.buildingFeatures){const x=c[g.promoteId],b=g.feature;b.properties["building-part"]="roof";const C=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),I=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical);b.properties["building-part"]="wall";const D=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),U=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical);b.properties["building-part"]="window";const q=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),H=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical);b.properties["building-part"]="door";const Y=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),J=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical),oe=g.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const he of g.parts){let we,Te=C;he.part==="roof"?(Te=C,we=I):he.part==="wall"?(Te=D,we=U):he.part==="facade_glazing"?(Te=q,we=H):he.part==="entrance"&&(Te=Y,we=J),we=ve(we,0,1);for(let Pe=0;Pe<he.vertexLength;Pe++){const He=he.vertexOffset+Pe,Fe=1+(oe.layoutAOArray.float32[He]-1)*p;oe.layoutColorArray.emplace(He,Te.r*Fe*255<<8|Te.g*Fe*255,Te.b*Fe*255<<8|255*we),g.hasFauxFacade&&oe.layoutFacadePaintArray.emplace(He,255*q.r<<8|255*q.g,255*q.b<<8|255*H)}}const ce=g.buildingBloom;if(ce)for(let he=0;he<ce.vertexLength;he++)oe.entranceBloom.layoutColorArray.emplace(ce.vertexOffset+he,255*Y.r<<8|255*Y.g,255*Y.b<<8|51*J)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(a,c,p){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(a.toUnwrapped());if(iC(this.activeReplacements,g))return;this.activeReplacements=g;for(const b of this.footprints)b.hiddenFlags&=-2;const x=[];for(const b of this.activeReplacements){if(b.order<=nV)continue;const C=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-a.canonical.z));for(const I of this.footprints)I.min.x>b.max.x||I.max.x<b.min.x||I.min.y>b.max.y||I.max.y<b.min.y||(x.length=0,Ofe(I.vertices,0,I.vertices.length,b.footprintTileId.canonical,a.canonical,x),HR(b.footprint,x,I.indices,0,I.indices.length,0,-C)&&(I.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(a){if(a.id!==void 0){const c=this.featureFootprintLookup.get(a.id);return this.footprints[c]}return null}getHeightAtTileCoord(a,c){let p=Number.NEGATIVE_INFINITY,g=!0;const x=4*(a+rr)*rr+(c+rr);if(this.footprintLookup.hasOwnProperty(x)){const C=this.footprintLookup[x];return C?{height:C.height,hidden:C.hiddenFlags!==0}:void 0}const b=new at(a,c);for(const C of this.footprints)a>C.max.x||C.min.x>a||c>C.max.y||C.min.y>c||C.height<=p||GR(b,C)&&(p=C.height,this.footprintLookup[x]=C,g=C.hiddenFlags!==0);if(p!==Number.NEGATIVE_INFINITY)return{height:p,hidden:g};this.footprintLookup[x]=void 0}}function Ofe(u,a,c,p,g,x){const b=Math.pow(2,p.z-g.z);for(let C=0;C<c;C++){let I=u[C+a].x,D=u[C+a].y;I=(I+g.x*rr)*b-p.x*rr,D=(D+g.y*rr)*b-p.y*rr,x.push(new at(I,D))}}let n6,i6;_r(r6,"BuildingBucket",{omit:["layers"]}),_r(dM,"BuildingGeometry"),_r(t6,"BuildingBloomGeometry");const kfe=Cn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Nfe=Cn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Ife}=kfe,Rfe=Cn([{name:"a_packed",components:3,type:"Float32"}]),{members:Mfe}=Rfe,Dfe=Cn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Lfe}=Dfe;class s6{constructor(a,c){this.width=a,this.height=c,this.nextRow=0,this.image=new sm({width:a,height:c}),this.positions={},this.uploaded=!1}getDash(a,c){const p=this.getKey(a,c);return this.positions[p]}trim(){const a=this.width,c=this.height=ct(this.nextRow);this.image.resize({width:a,height:c})}getKey(a,c){return a.join(",")+c}getDashRanges(a,c,p){const g=[];let x=a.length%2==1?-a[a.length-1]*p:0,b=a[0]*p,C=!0;g.push({left:x,right:b,isDash:C,zeroLength:a[0]===0});let I=a[0];for(let D=1;D<a.length;D++){C=!C;const U=a[D];x=I*p,I+=U,b=I*p,g.push({left:x,right:b,isDash:C,zeroLength:U===0})}return g}addRoundDash(a,c,p){const g=c/2;for(let x=-p;x<=p;x++){const b=this.width*(this.nextRow+p+x);let C=0,I=a[C];for(let D=0;D<this.width;D++){D/I.right>1&&(I=a[++C]);const U=Math.abs(D-I.left),q=Math.abs(D-I.right),H=Math.min(U,q);let Y;const J=x/p*(g+1);if(I.isDash){const oe=g-Math.abs(J);Y=Math.sqrt(H*H+oe*oe)}else Y=g-Math.sqrt(H*H+J*J);this.image.data[b+D]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(a,c){for(let I=a.length-1;I>=0;--I){const D=a[I],U=a[I+1];D.zeroLength?a.splice(I,1):U&&U.isDash===D.isDash&&(U.left=D.left,a.splice(I,1))}const p=a[0],g=a[a.length-1];p.isDash===g.isDash&&(p.left=g.left-this.width,g.right=p.right+this.width);const x=this.width*this.nextRow;let b=0,C=a[b];for(let I=0;I<this.width;I++){I/C.right>1&&(C=a[++b]);const D=Math.abs(I-C.left),U=Math.abs(I-C.right),q=Math.min(D,U);this.image.data[x+I]=Math.max(0,Math.min(255,(C.isDash?q:-q)+c+128))}}addDash(a,c){const p=this.getKey(a,c);if(this.positions[p])return this.positions[p];const g=c==="round",x=g?7:0,b=2*x+1;if(this.nextRow+b>this.height)return zr("LineAtlas out of space"),null;a.length===0&&a.push(1);let C=0;for(let U=0;U<a.length;U++)a[U]<0&&(zr("Negative value is found in line dasharray, replacing values with 0"),a[U]=0),C+=a[U];if(C!==0){const U=this.width/C,q=this.getDashRanges(a,this.width,U);g?this.addRoundDash(q,U,x):this.addRegularDash(q,c==="square"?.5*U:0)}const I=this.nextRow+x;this.nextRow+=b;const D={tl:[I,x],br:[C,0]};return this.positions[p]=D,D}}_r(s6,"LineAtlas");const Ffe=$t.types,zfe=Math.cos(Math.PI/180*37.5),Bfe=Math.cos(Math.PI/180*5);class hM{constructor(a){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=a.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=a.overscaling,this.pixelRatio=a.pixelRatio,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.projection=a.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new J_,this.layoutVertexArray2=new Kl,this.patternVertexArray=new Kl,this.indexArray=new is,this.programConfigurations=new tu(a.layers,{zoom:a.zoom,lut:a.lut}),this.segments=new ds,this.maxLineLength=0,this.zOffsetVertexArray=new Kl,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=a.tessellationStep?a.tessellationStep:rr/64,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.hasPattern=zR("line",this.layers,this.pixelRatio,c);const x=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ze(p);const b=this.layers[0].layout.get("line-elevation-reference");if(b==="hd-road-markup")this.elevationType="road";else{const H=this.layers[0].layout.get("line-z-offset"),Y=H.isConstant()&&!H.constantOr(0);this.elevationType=b!=="sea"&&b!=="ground"&&Y?"none":"offset",this.elevationType==="offset"&&b==="none"&&zr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const C=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&C!==void 0;const I=[];for(const{feature:H,id:Y,index:J,sourceLayerIndex:oe}of a){const ce=this.layers[0]._featureFilter.needGeometry,he=yt(H,ce);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),he,p))continue;const we=x?x.evaluate(he,{},p):void 0,Te={id:Y,properties:H.properties,type:H.type,sourceLayerIndex:oe,index:J,geometry:ce?he.geometry:Nt(H,p,g),patterns:{},sortKey:we};I.push(Te)}x&&I.sort((H,Y)=>H.sortKey-Y.sortKey);const{lineAtlas:D,featureIndex:U}=c,q=this.addConstantDashes(D);for(const H of I){const{geometry:Y,index:J,sourceLayerIndex:oe}=H;if(q&&this.addFeatureDashes(H,D),this.hasPattern){const ce=BR("line",this.layers,H,this.zoom,this.pixelRatio,c);this.patternFeatures.push(ce)}else this.addFeature(H,Y,J,p,D.positions,c.availableImages,c.brightness,c.elevationFeatures);U.insert(a[J].feature,Y,J,oe,this.index)}}addConstantDashes(a){let c=!1;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,x=p.layout.get("line-cap").value;if(g.kind!=="constant"||x.kind!=="constant")c=!0;else{const b=x.value,C=g.value;if(!C)continue;a.addDash(C,b)}}return c}addFeatureDashes(a,c){const p=this.zoom;for(const g of this.layers){const x=g.paint.get("line-dasharray").value,b=g.layout.get("line-cap").value;if(x.kind==="constant"&&b.kind==="constant")continue;let C,I;if(x.kind==="constant"){if(C=x.value,!C)continue}else C=x.evaluate({zoom:p},a);I=b.kind==="constant"?b.value:b.evaluate({zoom:p},a),c.addDash(C,I),a.patterns[g.id]=[c.getKey(C,I)]}}update(a,c,p,g,x,b,C,I){this.programConfigurations.updatePaintArrays(a,c,x,p,g,b,C,I)}addFeatures(a,c,p,g,x,b){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,c,p,g,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Mfe)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=a.createVertexBuffer(this.patternVertexArray,Lfe)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,Nfe.members,!0)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ife),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a,c){let p,g;if(c&&c>0?(p=`mapbox_clip_start_${c}`,g=`mapbox_clip_end_${c}`):(p="mapbox_clip_start",g="mapbox_clip_end"),a.properties&&a.properties.hasOwnProperty(p)&&a.properties.hasOwnProperty(g))return{start:+a.properties[p],end:+a.properties[g]}}addFeature(a,c,p,g,x,b,C,I){const D=this.layers[0].layout,U=D.get("line-join").evaluate(a,{}),q=D.get("line-cap").evaluate(a,{}),H=D.get("line-miter-limit"),Y=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(a),this.lineFeature=a;const J=!(!a.properties||!a.properties.hasOwnProperty("mapbox_line_metrics"))&&a.properties.mapbox_line_metrics;this.zOffsetValue=D.get("line-z-offset").value;const oe=this.layers[0].paint.get("line-width").value;if(oe.kind!=="constant"&&oe.isLineProgressConstant===!1&&(this.variableWidthValue=oe),this.elevationType==="road"){const ce=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(a,c,g,I,U,q,H,Y)){const[he,we]=this.clipRuntimeLinesToTile(c,1);for(let Te=0;Te<he.length;Te++){const Pe=he[Te],He=we[Te],Fe={progress:{min:He.progress.min,max:He.progress.max},nextDir:this.computeSegNextDir(He,Pe),prevDir:this.computeSegPrevDir(He,Pe)};this.addLine(Pe,a,g,U,q,H,Y,Fe,J&&He.parentIndex>0?He.parentIndex:null)}this.fillNonElevatedRoadSegment(ce)}}else for(let ce=0;ce<c.length;ce++)this.addLine(c[ce],a,g,U,q,H,Y,void 0,J&&ce>0?ce:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,x,b,g,C,void 0,this.worldview)}computeSegNextDir(a,c){return a.nextPoint.sub(c.at(-2)).unit()}computeSegPrevDir(a,c){return c[1].sub(a.prevPoint).unit()}clipLinesToTile(a,c){return oC(a,-c,-c,rr+c,rr+c)}clipRuntimeLinesToTile(a,c){const p=[];return[oC(a,-c,-c,rr+c,rr+c,p),p]}addElevatedRoadFeature(a,c,p,g,x,b,C,I){const D=[],U=Qr.getElevationFeature(a,g);if(U){const q=this.clipLinesToTile(c,1),H=this.prepareElevatedLines(q,U,p);for(const Y of H)D.push({geometry:Y,elevation:U,elevationTileID:p,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(D.length===0)return!1;for(const q of D){const H=this.layoutVertexArray.length;this.addLine(q.geometry,a,p,x,b,C,I);const Y=new Un(p,q.elevationTileID);if(q.elevation)for(let J=H;J<this.layoutVertexArray.length;J++){const oe=new at(this.layoutVertexArray.int16[6*J]>>1,this.layoutVertexArray.int16[6*J+1]>>1),ce=Y.pointElevation(oe,q.elevation,.05);this.updateHeightRange(ce),this.zOffsetVertexArray.emplaceBack(ce,0,0)}else this.fillNonElevatedRoadSegment(H)}return!0}prepareElevatedLines(a,c,p){if(c.constantHeight!=null)return a;const g=[],x=1/Ze(p);for(const b of a)Jhe(b,new Wi(c,x),0,g);return g}fillNonElevatedRoadSegment(a){for(let c=a;c<this.layoutVertexArray.length;c++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(a){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,a),this.heightRange.max=Math.max(this.heightRange.max,a)):this.heightRange={min:a,max:a}}addLine(a,c,p,g,x,b,C,I,D){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=D?this.lineFeatureClips(c,D):this.lineClips;const U=g==="none";this.patternJoinNone=this.hasPattern&&U,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const q=I&&I.progress.min>0,H=I&&I.progress.max<1;if(this.lineClips){let it={min:this.lineClips.start,max:this.lineClips.end},Tt=1;if(I){const Rt=this.lineClips.end-this.lineClips.start;it=function(Bt,er,Wt){return{min:Ti(Bt.min,er,Wt),max:Ti(Bt.max,er,Wt)}}(I.progress,{min:0,max:1},it),Rt>0&&(Tt=(it.max-it.min)/Rt)}const ft=+c.properties.mapbox_clip_feature_len,At=+c.properties.mapbox_clip_seg_len;if(Number.isNaN(ft)||Number.isNaN(At)){for(let Bt=0;Bt<a.length-1;Bt++)this.totalDistance+=a[Bt].dist(a[Bt+1]);const Rt=this.totalDistance/(it.max-it.min);this.totalFeatureLength=Number.isFinite(Rt)?Rt:0,this.lineClips.start=it.min,this.lineClips.end=it.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ft,this.distance=At*Tt,this.lineClips.start=it.min,this.lineClips.end=it.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Y=Ffe[c.type]==="Polygon";let J=a.length;for(;J>=2&&a[J-1].equals(a[J-2]);)J--;let oe=0;for(;oe<J-1&&a[oe].equals(a[oe+1]);)oe++;if(J<(Y?3:2))return;g==="bevel"&&(b=1.05);const ce=this.segments.prepareSegment(10*J,this.layoutVertexArray,this.indexArray);let he,we,Te,Pe,He,Fe,Ye,tt;I&&I.prevDir&&(Fe=I.prevDir.perp()),I&&I.nextDir&&(Ye=I.nextDir.perp()),this.e1=this.e2=-1,Y&&(he=a[J-2],He=a[oe].sub(he)._unit()._perp());for(let it=oe;it<J;it++){if(Te=it===J-1?Y?a[oe+1]:void 0:a[it+1],Te&&a[it].equals(Te))continue;He&&(Pe=He),he&&(we=he),he=a[it],tt=this.evaluateLineProgressFeatures(we?we.dist(he):0),He=Te?Te.sub(he)._unit()._perp():Pe,Pe=Pe||He;const Tt=we&&Te;let ft=Tt?g:Y||U?"butt":x;const At=Pe.x*He.x+Pe.y*He.y;if(U){const xt=function(Vt){if(Vt.patternJoinNone){const Yt=Vt.segmentPoints.length/2,Ft=Vt.lineSoFar-Vt.segmentStart;for(let gr=0;gr<Yt;++gr){const br=Vt.segmentPoints[2*gr+1],hr=Math.round(Vt.segmentPoints[2*gr])+.5+.25*br;Vt.patternVertexArray.emplaceBack(hr,Ft,Vt.segmentStart),Vt.patternVertexArray.emplaceBack(hr,Ft,Vt.segmentStart)}Vt.segmentPoints.length=0}Vt.e1=Vt.e2=-1};if(Tt&&At<Bfe){this.updateDistance(we,he),this.addCurrentVertex(he,Pe,1,1,ce,tt),xt(this),this.addCurrentVertex(he,He,-1,-1,ce,tt);continue}if(we){if(!Te){this.updateDistance(we,he),this.addCurrentVertex(he,Pe,1,1,ce,tt),xt(this);continue}ft="miter"}}let Rt=Pe.add(He);Rt.x===0&&Rt.y===0||Rt._unit();const Bt=Rt.x*He.x+Rt.y*He.y,er=Bt!==0?1/Bt:1/0,Wt=2*Math.sqrt(2-2*Bt),Lt=Bt<zfe&&we&&Te,Gt=Pe.x*He.y-Pe.y*He.x>0,wt=this.overscaling<=16?15*rr/(512*this.overscaling):0;if(Tt&&ft==="round"){if(er<C)ft="miter";else if(er<=2){const xt=fM(he,-10,rr+10);ft=this.elevationType==="offset"&&(xt||this.hasCrossSlope)?"miter":"fakeround"}}if(ft==="miter"&&er>b&&(ft="bevel"),ft==="bevel"&&(er>2&&(ft="flipbevel"),er<b&&(ft="miter")),we&&!(ft==="miter"&&Lt)&&this.updateDistance(we,he),ft==="miter")if(Lt){const xt=he.dist(we);if(xt>2*wt){const Yt=he.sub(he.sub(we)._mult(wt/xt)._round());this.updateDistance(we,Yt),this.addCurrentVertex(Yt,Pe,0,0,ce,tt),we=Yt}this.updateDistance(we,he),Rt._mult(er),this.addCurrentVertex(he,Rt,0,0,ce,tt);const Vt=he.dist(Te);if(Vt>2*wt){const Yt=he.add(Te.sub(he)._mult(wt/Vt)._round());this.updateDistance(he,Yt),this.addCurrentVertex(Yt,He,0,0,ce,tt),he=Yt}}else Rt._mult(er),this.addCurrentVertex(he,Rt,0,0,ce,tt);else if(ft==="flipbevel"){if(er>100)Rt=He.mult(-1);else{const xt=er*Pe.add(He).mag()/Pe.sub(He).mag();Rt._perp()._mult(xt*(Gt?-1:1))}this.addCurrentVertex(he,Rt,0,0,ce,tt),this.addCurrentVertex(he,Rt.mult(-1),0,0,ce,tt)}else if(ft==="bevel"||ft==="fakeround"){tt!=null&&we&&this.addCurrentVertex(he,Ye||Pe,-1,-1,ce,tt);const xt=he.dist(we)<=2*wt&&ft!=="bevel",Vt=Rt.mult(Gt?1:-1);Vt._mult(er);const Yt=He.mult(Gt?-1:1),Ft=Pe.mult(Gt?-1:1),gr=this.evaluateLineProgressFeatures(this.distance);if(tt==null&&(this.addHalfVertex(he,Vt.x,Vt.y,!1,!Gt,0,ce,gr),xt||this.addHalfVertex(he,Vt.x+2*Ft.x,Vt.y+2*Ft.y,!1,Gt,0,ce,gr)),ft==="fakeround"){const br=Math.round(180*Wt/Math.PI/20);this.addHalfVertex(he,Ft.x,Ft.y,!1,Gt,0,ce,gr);for(let hr=0;hr<br;hr++){let ar=hr/br;if(ar!==.5){const lr=ar-.5;ar+=ar*lr*(ar-1)*((1.0904+At*(At*(3.55645-1.43519*At)-3.2452))*lr*lr+(.848013+At*(.215638*At-1.06021)))}const en=Yt.sub(Ft)._mult(ar)._add(Ft)._unit();this.addHalfVertex(he,en.x,en.y,!1,Gt,0,ce,gr)}this.addHalfVertex(he,Yt.x,Yt.y,!1,Gt,0,ce,gr)}xt||tt!=null||this.addHalfVertex(he,Vt.x+2*Yt.x,Vt.y+2*Yt.y,!1,Gt,0,ce,gr),tt!=null&&Te&&this.addCurrentVertex(he,Fe||He,1,1,ce,tt)}else if(ft==="butt")this.addCurrentVertex(he,Rt,0,0,ce,tt);else if(ft==="square"){if(!we){const xt=q?0:-1;this.addCurrentVertex(he,Rt,xt,xt,ce,tt)}if(this.addCurrentVertex(he,Rt,0,0,ce,tt),we){const xt=H?0:1;this.addCurrentVertex(he,Rt,xt,xt,ce,tt)}}else if(ft==="round"){if(we){const xt=!Tt&&Ye?Ye:Pe;this.addCurrentVertex(he,xt,0,0,ce,tt),!Tt&&H||this.addCurrentVertex(he,xt,1,1,ce,tt,!0)}if(Te){const xt=!Tt&&Fe?Fe:He;!Tt&&q||this.addCurrentVertex(he,xt,-1,-1,ce,tt,!0),this.addCurrentVertex(he,xt,0,0,ce,tt)}}}}addVerticesTo(a,c,p,g,x,b,C,I,D,U){const q=(c.w-a.w)/this.tessellationStep|0;let H=0;const Y=this.scaledDistance;if(q>1){this.lineSoFar=a.w;const oe=(c.x-a.x)/q,ce=(c.y-a.y)/q,he=(c.z-a.z)/q,we=(c.w-a.w)/q;for(let Te=1;Te<q;++Te){a.x+=oe,a.y+=ce,a.z+=he,this.lineSoFar+=we,H+=we;const Pe=this.evaluateLineProgressFeatures(this.prevDistance+H);this.scaledDistance=(this.prevDistance+H)/this.totalDistance,this.addHalfVertex(a,p,g,U,!1,C,D,Pe),this.addHalfVertex(a,x,b,U,!0,-I,D,Pe)}}this.lineSoFar=c.w,this.scaledDistance=Y;const J=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,p,g,U,!1,C,D,J),this.addHalfVertex(c,x,b,U,!0,-I,D,J)}evaluateLineProgressFeatures(a){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+a)/this.totalFeatureLength):zr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:c}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}}addCurrentVertex(a,c,p,g,x,b,C=!1){const I=c.x+c.y*p,D=c.y-c.x*p,U=c.y*g-c.x,q=-c.y-c.x*g;if(b!=null){const H=this.elevationType==="offset",Y=-10,J=rr+10,oe=b.zOffset,ce=new AV(a.x,a.y,oe,this.lineSoFar),he=!!H&&fM(a,Y,J),we=this.lineSoFar,Te=this.distance;if(this.currentVertex)if(he){const Pe=this.currentVertexIsOutside,He=this.currentVertex,Fe=new AV(a.x,a.y,oe,this.lineSoFar);if(jV(He,Fe,Y,J),!fM(Fe,Y,J)){if(Pe){this.e1=this.e2=-1,this.distance-=He.dist(ce),this.lineSoFar=He.w;const Ye=this.evaluateLineProgressFeatures(He.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(He,I,D,C,!1,p,x,Ye),this.addHalfVertex(He,U,q,C,!0,-g,x,Ye),this.prevDistance=this.distance}this.distance=this.prevDistance+He.dist(Fe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(He,Fe,I,D,U,q,p,g,x,C),this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}}else{const Pe=this.currentVertex;if(this.currentVertexIsOutside){jV(Pe,ce,Y,J),this.e1=this.e2=-1,this.distance-=Pe.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Pe.w;const He=this.evaluateLineProgressFeatures(Pe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Pe,I,D,C,!1,p,x,He),this.addHalfVertex(Pe,U,q,C,!0,-g,x,He),this.prevDistance=this.distance,this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Pe,ce,I,D,U,q,p,g,x,C)}else he||(this.addHalfVertex(a,I,D,C,!1,p,x,b),this.addHalfVertex(a,U,q,C,!0,-g,x,b));this.currentVertex=ce,this.currentVertexIsOutside=he,this.lineSoFar=we}else this.addHalfVertex(a,I,D,C,!1,p,x,b),this.addHalfVertex(a,U,q,C,!0,-g,x,b)}addHalfVertex({x:a,y:c},p,g,x,b,C,I,D){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),b||this.segmentPoints.push(this.lineSoFar-this.segmentStart,C)),this.layoutVertexArray.emplaceBack((a<<1)+(x?1:0),(c<<1)+(b?1:0),Math.round(63*p)+128,Math.round(63*g)+128,1+(C===0?0:C<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const q=Kr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,q)}const U=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),I.primitiveLength++),b?this.e2=U:this.e1=U,D!=null&&this.zOffsetVertexArray.emplaceBack(D.zOffset,D.variableWidth,D.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(a,c){this.prevDistance=this.distance,this.distance+=a.dist(c),this.updateScaledDistance()}}function fM(u,a,c){return u.x<a||u.x>c||u.y<a||u.y>c}let a6,o6;function l6(u,a,c){return a*(rr/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}_r(hM,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const c6=(u,a,c)=>(1-c)*u+c*a;function u6(u,a){return 1/l6(u,1,a.tileZoom)}function d6(u,a,c,p){return u.translatePosMatrix(p||a.tileID.projMatrix,a,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const h6=u=>{const a=[];f6(u)&&a.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&a.push("RENDER_LINE_GRADIENT");const c=u.paint.get("line-trim-offset");c[0]===0&&c[1]===0||a.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&a.push("RENDER_LINE_BORDER");const p=u.layout.get("line-join").constantOr("miter")==="none",g=!!u.paint.get("line-pattern").constantOr(1);return p&&g&&a.push("LINE_JOIN_NONE"),a};function f6(u){const a=u.paint.get("line-dasharray").value;return a.kind!=="constant"||a.value}let pM;const p6=()=>pM||(pM={layout:a6||(a6=new bs({"line-cap":new ur(ht.layout_line["line-cap"]),"line-join":new ur(ht.layout_line["line-join"]),"line-miter-limit":new Zt(ht.layout_line["line-miter-limit"]),"line-round-limit":new Zt(ht.layout_line["line-round-limit"]),"line-sort-key":new ur(ht.layout_line["line-sort-key"]),"line-z-offset":new ur(ht.layout_line["line-z-offset"]),"line-elevation-reference":new Zt(ht.layout_line["line-elevation-reference"]),"line-cross-slope":new Zt(ht.layout_line["line-cross-slope"]),visibility:new Zt(ht.layout_line.visibility),"line-width-unit":new Zt(ht.layout_line["line-width-unit"])})),paint:o6||(o6=new bs({"line-opacity":new ur(ht.paint_line["line-opacity"]),"line-color":new ur(ht.paint_line["line-color"]),"line-translate":new Zt(ht.paint_line["line-translate"]),"line-translate-anchor":new Zt(ht.paint_line["line-translate-anchor"]),"line-width":new ur(ht.paint_line["line-width"]),"line-gap-width":new ur(ht.paint_line["line-gap-width"]),"line-offset":new ur(ht.paint_line["line-offset"]),"line-blur":new ur(ht.paint_line["line-blur"]),"line-dasharray":new ur(ht.paint_line["line-dasharray"]),"line-pattern":new ur(ht.paint_line["line-pattern"]),"line-pattern-cross-fade":new Zt(ht.paint_line["line-pattern-cross-fade"]),"line-gradient":new Vp(ht.paint_line["line-gradient"]),"line-trim-offset":new Zt(ht.paint_line["line-trim-offset"]),"line-trim-fade-range":new Zt(ht.paint_line["line-trim-fade-range"]),"line-trim-color":new Zt(ht.paint_line["line-trim-color"]),"line-emissive-strength":new Zt(ht.paint_line["line-emissive-strength"]),"line-border-width":new ur(ht.paint_line["line-border-width"]),"line-border-color":new ur(ht.paint_line["line-border-color"]),"line-occlusion-opacity":new Zt(ht.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},pM);class $fe extends ur{possiblyEvaluate(a,c){return c=new Ui(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition,worldview:c.worldview}),super.possiblyEvaluate(a,c)}evaluate(a,c,p,g){return c=Object.assign({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(a,c,p,g)}}let cS;function m6(u,a){return a>0?a+2*u:u}const Ufe=Cn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vfe=Cn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qfe=Cn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Cn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hfe=Cn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Gfe=Cn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Wfe=Cn([{name:"a_texb",components:2,type:"Uint16"}]),Kfe=Cn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Zfe=Cn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Cn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const g6=Cn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xfe=Cn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Cn([{name:"triangle",components:3,type:"Uint16"}]),Cn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Cn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Cn([{type:"Float32",name:"offsetX"}]),Cn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xa=24;function Yfe(u,a,c){return u.sections.forEach(p=>{p.text=function(g,x,b){const C=x.layout.get("text-transform").evaluate(b,{});return C==="uppercase"?g=g.toLocaleUpperCase():C==="lowercase"&&(g=g.toLocaleLowerCase()),Il.applyArabicShaping&&(g=Il.applyArabicShaping(g)),g}(p.text,a,c)}),u}const uS={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Jfe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function Qfe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}const mM=4294967296,y6=1/mM,v6=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let vC=class{constructor(u=new Uint8Array(16)){this.buf=ArrayBuffer.isView(u)?u:new Uint8Array(u),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(u,a,c=this.length){for(;this.pos<c;){const p=this.readVarint(),g=p>>3,x=this.pos;this.type=7&p,u(g,a,this),this.pos===x&&this.skip(p)}return a}readMessage(u,a){return this.readFields(u,a,this.readVarint()+this.pos)}readFixed32(){const u=this.dataView.getUint32(this.pos,!0);return this.pos+=4,u}readSFixed32(){const u=this.dataView.getInt32(this.pos,!0);return this.pos+=4,u}readFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*mM;return this.pos+=8,u}readSFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*mM;return this.pos+=8,u}readFloat(){const u=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,u}readDouble(){const u=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,u}readVarint(u){const a=this.buf;let c,p;return p=a[this.pos++],c=127&p,p<128?c:(p=a[this.pos++],c|=(127&p)<<7,p<128?c:(p=a[this.pos++],c|=(127&p)<<14,p<128?c:(p=a[this.pos++],c|=(127&p)<<21,p<128?c:(p=a[this.pos],c|=(15&p)<<28,function(g,x,b){const C=b.buf;let I,D;if(D=C[b.pos++],I=(112&D)>>4,D<128||(D=C[b.pos++],I|=(127&D)<<3,D<128)||(D=C[b.pos++],I|=(127&D)<<10,D<128)||(D=C[b.pos++],I|=(127&D)<<17,D<128)||(D=C[b.pos++],I|=(127&D)<<24,D<128)||(D=C[b.pos++],I|=(1&D)<<31,D<128))return _x(g,I,x);throw new Error("Expected varint not more than 10 bytes")}(c,u,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const u=this.readVarint();return u%2==1?(u+1)/-2:u/2}readBoolean(){return!!this.readVarint()}readString(){const u=this.readVarint()+this.pos,a=this.pos;return this.pos=u,u-a>=12&&v6?v6.decode(this.buf.subarray(a,u)):function(c,p,g){let x="",b=p;for(;b<g;){const C=c[b];let I,D,U,q=null,H=C>239?4:C>223?3:C>191?2:1;if(b+H>g)break;H===1?C<128&&(q=C):H===2?(I=c[b+1],(192&I)==128&&(q=(31&C)<<6|63&I,q<=127&&(q=null))):H===3?(I=c[b+1],D=c[b+2],(192&I)==128&&(192&D)==128&&(q=(15&C)<<12|(63&I)<<6|63&D,(q<=2047||q>=55296&&q<=57343)&&(q=null))):H===4&&(I=c[b+1],D=c[b+2],U=c[b+3],(192&I)==128&&(192&D)==128&&(192&U)==128&&(q=(15&C)<<18|(63&I)<<12|(63&D)<<6|63&U,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,H=1):q>65535&&(q-=65536,x+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),x+=String.fromCharCode(q),b+=H}return x}(this.buf,a,u)}readBytes(){const u=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,u);return this.pos=u,a}readPackedVarint(u=[],a){const c=this.readPackedEnd();for(;this.pos<c;)u.push(this.readVarint(a));return u}readPackedSVarint(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSVarint());return u}readPackedBoolean(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readBoolean());return u}readPackedFloat(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFloat());return u}readPackedDouble(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readDouble());return u}readPackedFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed32());return u}readPackedSFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed32());return u}readPackedFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed64());return u}readPackedSFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed64());return u}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(u){const a=7&u;if(a===0)for(;this.buf[this.pos++]>127;);else if(a===2)this.pos=this.readVarint()+this.pos;else if(a===5)this.pos+=4;else{if(a!==1)throw new Error(`Unimplemented type: ${a}`);this.pos+=8}}writeTag(u,a){this.writeVarint(u<<3|a)}realloc(u){let a=this.length||16;for(;a<this.pos+u;)a*=2;if(a!==this.length){const c=new Uint8Array(a);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=a}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeSFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*y6),!0),this.pos+=8}writeSFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*y6),!0),this.pos+=8}writeVarint(u){(u=+u||0)>268435455||u<0?function(a,c){let p,g;if(a>=0?(p=a%4294967296|0,g=a/4294967296|0):(p=~(-a%4294967296),g=~(-a/4294967296),4294967295^p?p=p+1|0:(p=0,g=g+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(x,b,C){C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,C.buf[C.pos]=127&(x>>>=7)}(p,0,c),function(x,b){const C=(7&x)<<4;b.buf[b.pos++]|=C|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(g,c)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))}writeSVarint(u){this.writeVarint(u<0?2*-u-1:2*u)}writeBoolean(u){this.writeVarint(+u)}writeString(u){u=String(u),this.realloc(4*u.length),this.pos++;const a=this.pos;this.pos=function(p,g,x){for(let b,C,I=0;I<g.length;I++){if(b=g.charCodeAt(I),b>55295&&b<57344){if(!C){b>56319||I+1===g.length?(p[x++]=239,p[x++]=191,p[x++]=189):C=b;continue}if(b<56320){p[x++]=239,p[x++]=191,p[x++]=189,C=b;continue}b=C-55296<<10|b-56320|65536,C=null}else C&&(p[x++]=239,p[x++]=191,p[x++]=189,C=null);b<128?p[x++]=b:(b<2048?p[x++]=b>>6|192:(b<65536?p[x++]=b>>12|224:(p[x++]=b>>18|240,p[x++]=b>>12&63|128),p[x++]=b>>6&63|128),p[x++]=63&b|128)}return x}(this.buf,u,this.pos);const c=this.pos-a;c>=128&&_6(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c}writeFloat(u){this.realloc(4),this.dataView.setFloat32(this.pos,u,!0),this.pos+=4}writeDouble(u){this.realloc(8),this.dataView.setFloat64(this.pos,u,!0),this.pos+=8}writeBytes(u){const a=u.length;this.writeVarint(a),this.realloc(a);for(let c=0;c<a;c++)this.buf[this.pos++]=u[c]}writeRawMessage(u,a){this.pos++;const c=this.pos;u(a,this);const p=this.pos-c;p>=128&&_6(c,p,this),this.pos=c-1,this.writeVarint(p),this.pos+=p}writeMessage(u,a,c){this.writeTag(u,2),this.writeRawMessage(a,c)}writePackedVarint(u,a){a.length&&this.writeMessage(u,epe,a)}writePackedSVarint(u,a){a.length&&this.writeMessage(u,tpe,a)}writePackedBoolean(u,a){a.length&&this.writeMessage(u,ipe,a)}writePackedFloat(u,a){a.length&&this.writeMessage(u,rpe,a)}writePackedDouble(u,a){a.length&&this.writeMessage(u,npe,a)}writePackedFixed32(u,a){a.length&&this.writeMessage(u,spe,a)}writePackedSFixed32(u,a){a.length&&this.writeMessage(u,ape,a)}writePackedFixed64(u,a){a.length&&this.writeMessage(u,ope,a)}writePackedSFixed64(u,a){a.length&&this.writeMessage(u,lpe,a)}writeBytesField(u,a){this.writeTag(u,2),this.writeBytes(a)}writeFixed32Field(u,a){this.writeTag(u,5),this.writeFixed32(a)}writeSFixed32Field(u,a){this.writeTag(u,5),this.writeSFixed32(a)}writeFixed64Field(u,a){this.writeTag(u,1),this.writeFixed64(a)}writeSFixed64Field(u,a){this.writeTag(u,1),this.writeSFixed64(a)}writeVarintField(u,a){this.writeTag(u,0),this.writeVarint(a)}writeSVarintField(u,a){this.writeTag(u,0),this.writeSVarint(a)}writeStringField(u,a){this.writeTag(u,2),this.writeString(a)}writeFloatField(u,a){this.writeTag(u,5),this.writeFloat(a)}writeDoubleField(u,a){this.writeTag(u,1),this.writeDouble(a)}writeBooleanField(u,a){this.writeVarintField(u,+a)}};function _x(u,a,c){return c?4294967296*a+(u>>>0):4294967296*(a>>>0)+(u>>>0)}function _6(u,a,c){const p=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));c.realloc(p);for(let g=c.pos-1;g>=u;g--)c.buf[g+p]=c.buf[g]}function epe(u,a){for(let c=0;c<u.length;c++)a.writeVarint(u[c])}function tpe(u,a){for(let c=0;c<u.length;c++)a.writeSVarint(u[c])}function rpe(u,a){for(let c=0;c<u.length;c++)a.writeFloat(u[c])}function npe(u,a){for(let c=0;c<u.length;c++)a.writeDouble(u[c])}function ipe(u,a){for(let c=0;c<u.length;c++)a.writeBoolean(u[c])}function spe(u,a){for(let c=0;c<u.length;c++)a.writeFixed32(u[c])}function ape(u,a){for(let c=0;c<u.length;c++)a.writeSFixed32(u[c])}function ope(u,a){for(let c=0;c<u.length;c++)a.writeFixed64(u[c])}function lpe(u,a){for(let c=0;c<u.length;c++)a.writeSFixed64(u[c])}const gM=3;function cpe(u,a,c){a.glyphs=[],u===1&&c.readMessage(upe,a)}function upe(u,a,c){if(u===3){const{id:p,bitmap:g,width:x,height:b,left:C,top:I,advance:D}=c.readMessage(dpe,{});a.glyphs.push({id:p,bitmap:new sm({width:x+2*gM,height:b+2*gM},g),metrics:{width:x,height:b,left:C,top:I,advance:D}})}else u===4?a.ascender=c.readSVarint():u===5&&(a.descender=c.readSVarint())}function dpe(u,a,c){u===1?a.id=c.readVarint():u===2?a.bitmap=c.readBytes():u===3?a.width=c.readVarint():u===4?a.height=c.readVarint():u===5?a.left=c.readSVarint():u===6?a.top=c.readSVarint():u===7&&(a.advance=c.readVarint())}const x6=gM,tc={horizontal:1,vertical:2,horizontalOnly:3};class dS{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(a,c){const p=new dS;return p.scale=a||1,p.fontStack=c,p}static forImage(a){const c=new dS;return c.image=a,c}}class xx{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,c,p){const g=new xx;for(let x=0;x<a.sections.length;x++){const b=a.sections[x];b.image?g.addImageSection(b,p):g.addTextSection(b,c)}return g}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCodePoint(a){return this.text.codePointAt(a)}verticalizePunctuation(a){this.text=function(c,p){let g="";for(let x=0;x<c.length;x++){const b=c.charCodeAt(x+1)||null,C=c.charCodeAt(x-1)||null;g+=!p&&(b&&m1(b)&&!uS[c[x+1]]||C&&m1(C)&&!uS[c[x-1]])||!uS[c[x]]?c[x]:uS[c[x]]}return g}(this.text,a)}trim(){let a=0;for(let p=0;p<this.text.length&&_C[this.text.charCodeAt(p)];p++)a++;let c=this.text.length;for(let p=this.text.length-1;p>=0&&p>=a&&_C[this.text.charCodeAt(p)];p--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)}substring(a,c){const p=new xx;return p.text=this.text.substring(a,c),p.sectionIndex=this.sectionIndex.slice(a,c),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,c)=>Math.max(a,this.sections[c].scale),0)}addTextSection(a,c){this.text+=a.text,this.sections.push(dS.forText(a.scale,a.fontStack||c));const p=this.sections.length-1;for(let g=0;g<a.text.length;++g)this.sectionIndex.push(p)}addImageSection(a,c){const p=a.image?a.image.getPrimary():null;if(!p)return void zr("Can't add FormattedSection with an empty image.");p.scaleSelf(c);const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCodePoint(g),this.sections.push(dS.forImage(p)),this.sectionIndex.push(this.sections.length-1)):zr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yM(u,a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe=1){const ce=xx.fromFeature(u,g,oe);q===tc.vertical&&ce.verticalizePunctuation(H);let he=[];const we=function(Ye,tt,it,Tt,ft,At){if(!Ye)return[];const Rt=[],Bt=function(Gt,wt,xt,Vt,Yt,Ft){let gr=0;for(let br=0;br<Gt.length();br++){const hr=Gt.getSection(br);gr+=b6(Gt.getCodePoint(br),hr,Vt,Yt,wt,Ft)}return gr/Math.max(1,Math.ceil(gr/xt))}(Ye,tt,it,Tt,ft,At),er=Ye.text.indexOf("")>=0;let Wt=0;for(let Gt=0;Gt<Ye.length();Gt++){const wt=Ye.getSection(Gt),xt=Ye.getCodePoint(Gt);if(_C[xt]||(Wt+=b6(xt,wt,Tt,ft,tt,At)),Gt<Ye.length()-1){const Vt=!((Lt=xt)<11904||!(Br["Bopomofo Extended"](Lt)||Br.Bopomofo(Lt)||Br["CJK Compatibility Forms"](Lt)||Br["CJK Compatibility Ideographs"](Lt)||Br["CJK Compatibility"](Lt)||Br["CJK Radicals Supplement"](Lt)||Br["CJK Strokes"](Lt)||Br["CJK Symbols and Punctuation"](Lt)||Br["CJK Unified Ideographs Extension A"](Lt)||Br["CJK Unified Ideographs"](Lt)||Br["Enclosed CJK Letters and Months"](Lt)||Br["Halfwidth and Fullwidth Forms"](Lt)||Br.Hiragana(Lt)||Br["Ideographic Description Characters"](Lt)||Br["Kangxi Radicals"](Lt)||Br["Katakana Phonetic Extensions"](Lt)||Br.Katakana(Lt)||Br["Vertical Forms"](Lt)||Br["Yi Radicals"](Lt)||Br["Yi Syllables"](Lt)));(hpe[xt]||Vt||wt.image)&&Rt.push(S6(Gt+1,Wt,Bt,Rt,fpe(xt,Ye.getCodePoint(Gt+1),Vt&&er),!1))}}var Lt;return E6(S6(Ye.length(),Wt,Bt,Rt,0,!0))}(ce,D,x,a,p,Y),{processBidirectionalText:Te,processStyledBidirectionalText:Pe}=Il;if(Te&&ce.sections.length===1){const Ye=Te(ce.toString(),we);for(const tt of Ye){const it=new xx;it.text=tt,it.sections=ce.sections;for(let Tt=0;Tt<tt.length;Tt++)it.sectionIndex.push(0);he.push(it)}}else if(Pe){const Ye=Pe(ce.text,ce.sectionIndex,we);for(const tt of Ye){const it=new xx;it.text=tt[0],it.sectionIndex=tt[1],it.sections=ce.sections,he.push(it)}}else he=function(Ye,tt){const it=[],Tt=Ye.text;let ft=0;for(const At of tt)it.push(Ye.substring(ft,At)),ft=At;return ft<Tt.length&&it.push(Ye.substring(ft,Tt.length)),it}(ce,we);const He=[],Fe={positionedLines:He,text:ce.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:q,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ye,tt,it,Tt,ft,At,Rt,Bt,er,Wt,Lt,Gt){let wt=0,xt=0,Vt=0;const Yt=Bt==="right"?1:Bt==="left"?0:.5;let Ft=!1;for(const lr of ft){const Lr=lr.getSections();for(const nn of Lr){if(nn.image)continue;const wn=tt[nn.fontStack];if(wn&&(Ft=wn.ascender!==void 0&&wn.descender!==void 0,!Ft))break}if(!Ft)break}let gr=0;for(const lr of ft){lr.trim();const Lr=lr.getMaxScale(),nn=(Lr-1)*Xa,wn={positionedGlyphs:[],lineOffset:0};Ye.positionedLines[gr]=wn;const Vn=wn.positionedGlyphs;let an=0;if(!lr.length()){xt+=At,++gr;continue}let ti=0,ri=0;for(let ze=0;ze<lr.length();ze++){const Re=lr.getSection(ze),Pt=lr.getSectionIndex(ze),sr=lr.getCodePoint(ze);let Ot=Re.scale,or=null,jr=null,Tr=null,ln=Xa,qr=0,Sr=er;Sr===tc.vertical&&((br=sr)===12312||br===12313||br===12316||br===12540||br===12448)&&(Sr=tc.horizontal);const Yn=!(Sr===tc.horizontal||!Lt&&!W_(sr)||Lt&&(_C[sr]||g1(sr)));if(Re.image){const Ai=Tt.get(Re.image.toString());if(!Ai)continue;Tr=Re.image,Ye.iconsInText=Ye.iconsInText||!0,jr=Ai.paddedRect;const Wr=Ai.displaySize;Ot=Ot*Xa/Gt,or={width:Wr[0],height:Wr[1],left:0,top:-x6,advance:Yn?Wr[1]:Wr[0],localGlyph:!1},qr=Ft?-or.height*Ot:Lr*Xa-17-Wr[1]*Ot,ln=or.advance;const Bn=(Yn?Wr[0]:Wr[1])*Ot-Xa*Lr;Bn>0&&Bn>an&&(an=Bn)}else{const Ai=it[Re.fontStack];if(!Ai)continue;Ai[sr]&&(jr=Ai[sr]);const Wr=tt[Re.fontStack];if(!Wr)continue;const Bn=Wr.glyphs[sr];if(!Bn)continue;if(or=Bn.metrics,ln=sr!==8203?Xa:0,Ft){const Ci=Wr.ascender!==void 0?Math.abs(Wr.ascender):0,fi=Wr.descender!==void 0?Math.abs(Wr.descender):0,vs=(Ci+fi)*Ot;ti<vs&&(ti=vs,ri=(Ci-fi)/2*Ot),qr=-Ci*Ot}else qr=(Lr-Ot)*Xa-17}Yn?(Ye.verticalizable=!0,Vn.push({glyph:sr,image:Tr,x:wt,y:xt+qr,vertical:Yn,scale:Ot,localGlyph:or.localGlyph,fontStack:Re.fontStack,sectionIndex:Pt,metrics:or,rect:jr}),wt+=ln*Ot+Wt):(Vn.push({glyph:sr,image:Tr,x:wt,y:xt+qr,vertical:Yn,scale:Ot,localGlyph:or.localGlyph,fontStack:Re.fontStack,sectionIndex:Pt,metrics:or,rect:jr}),wt+=or.advance*Ot+Wt)}Vn.length!==0&&(Vt=Math.max(wt-Wt,Vt),Ft?T6(Vn,Yt,an,ri,At*Lr/2):T6(Vn,Yt,an,0,At/2)),wt=0;const ls=At*Lr+an;wn.lineOffset=Math.max(an,nn),xt+=ls,++gr}var br;const hr=xt,{horizontalAlign:ar,verticalAlign:en}=vM(Rt);(function(lr,Lr,nn,wn,Vn,an){const ti=(Lr-nn)*Vn,ri=-an*wn;for(const ls of lr)for(const ze of ls.positionedGlyphs)ze.x+=ti,ze.y+=ri})(Ye.positionedLines,Yt,ar,en,Vt,hr),Ye.top+=-en*hr,Ye.bottom=Ye.top+hr,Ye.left+=-ar*Vt,Ye.right=Ye.left+Vt,Ye.hasBaseline=Ft}(Fe,a,c,p,he,b,C,I,q,D,H,J),!function(Ye){for(const tt of Ye)if(tt.positionedGlyphs.length!==0)return!1;return!0}(He))return Fe}const _C={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hpe={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function b6(u,a,c,p,g,x){if(a.image){const b=p.get(a.image.toString());return b?b.displaySize[0]*a.scale*Xa/x+g:0}{const b=c[a.fontStack],C=b&&b.glyphs[u];return C?C.metrics.advance*a.scale+g:0}}function w6(u,a,c,p){const g=Math.pow(u-a,2);return p?u<a?g/2:2*g:g+Math.abs(c)*c}function fpe(u,a,c){let p=0;return u===10&&(p-=1e4),c&&(p+=150),u!==40&&u!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function S6(u,a,c,p,g,x){let b=null,C=w6(a,c,g,x);for(const I of p){const D=w6(a-I.x,c,g,x)+I.badness;D<=C&&(b=I,C=D)}return{index:u,x:a,priorBreak:b,badness:C}}function E6(u){return u?E6(u.priorBreak).concat(u.index):[]}function vM(u){let a=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:a,verticalAlign:c}}function T6(u,a,c,p,g){if(!(a||c||p||g))return;const x=u.length-1,b=u[x],C=(b.x+b.metrics.advance*b.scale)*a;for(let I=0;I<=x;I++)u[I].x-=C,u[I].y+=c+p+g}function A6(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function xC(u,a,c,p){const{horizontalAlign:g,verticalAlign:x}=vM(p),b=c[0]-u.displaySize[0]*g,C=c[1]-u.displaySize[1]*x;return{imagePrimary:u,imageSecondary:a,top:C,bottom:C+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function _M(u,a,c,p,g,x){const b=u.imagePrimary;let C;if(b.content){const ce=b.content,he=b.pixelRatio||1;C=[ce[0]/he,ce[1]/he,b.displaySize[0]-ce[2]/he,b.displaySize[1]-ce[3]/he]}const I=a.left*x,D=a.right*x;let U,q,H,Y;c==="width"||c==="both"?(Y=g[0]+I-p[3],q=g[0]+D+p[1]):(Y=g[0]+(I+D-b.displaySize[0])/2,q=Y+b.displaySize[0]);const J=a.top*x,oe=a.bottom*x;return c==="height"||c==="both"?(U=g[1]+J-p[0],H=g[1]+oe+p[2]):(U=g[1]+(J+oe-b.displaySize[1])/2,H=U+b.displaySize[1]),{imagePrimary:b,imageSecondary:void 0,top:U,right:q,bottom:H,left:Y,collisionPadding:C}}function C6(u){return!u.imagePrimary.stretchX}function j6(u){return!u.imagePrimary.stretchY}function P6(u){return{width:u.right-u.left,height:u.bottom-u.top}}const yd=128;function bx(u,a,c){const{expression:p}=a;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Ui(u+1,{worldview:c}))};if(p.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:x}=p;let b=0;for(;b<g.length&&g[b]<=u;)b++;b=Math.max(0,b-1);let C=b;for(;C<g.length&&g[C]<u+1;)C++;C=Math.min(g.length-1,C);const I=g[b],D=g[C];return p.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:x}:{kind:"camera",minZoom:I,maxZoom:D,minSize:p.evaluate(new Ui(I,{worldview:c})),maxSize:p.evaluate(new Ui(D,{worldview:c})),interpolationType:x}}}function xM(u,{uSize:a,uSizeT:c},{lowerSize:p,upperSize:g}){return u.kind==="source"?p/yd:u.kind==="composite"?Kr(p/yd,g/yd,c):a}function wx(u,a,c=1){let p=0,g=0;if(u.kind==="constant")g=u.layoutSize*c;else if(u.kind!=="source"){const{interpolationType:x,minZoom:b,maxZoom:C}=u,I=x?ve(Gl.interpolationFactor(x,a,b,C),0,1):0;u.kind==="camera"?g=Kr(u.minSize,u.maxSize,I)*c:p=I*c}return{uSizeT:p,uSize:g}}class Cf extends at{constructor(a,c,p,g,x){super(a,c),this.angle=g,this.z=p,x!==void 0&&(this.segment=x)}clone(){return new Cf(this.x,this.y,this.z,this.angle,this.segment)}}function O6(u,a,c,p,g){if(a.segment===void 0)return!0;let x=a,b=a.segment+1,C=0;for(;C>-c/2;){if(b--,b<0)return!1;C-=u[b].dist(x),x=u[b]}C+=u[b].dist(u[b+1]),b++;const I=[];let D=0;for(;C<c/2;){const U=u[b],q=u[b+1];if(!q)return!1;let H=u[b-1].angleTo(U)-U.angleTo(q);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:C,angleDelta:H}),D+=H;C-I[0].distance>p;)D-=I.shift().angleDelta;if(D>g)return!1;b++,C+=U.dist(q)}return!0}function k6(u){let a=0;for(let c=0;c<u.length-1;c++)a+=u[c].dist(u[c+1]);return a}function N6(u,a,c){return u?.6*a*c:0}function I6(u,a){return Math.max(u?u.right-u.left:0,a?a.right-a.left:0)}function ppe(u,a,c,p,g,x){const b=N6(c,g,x),C=I6(c,p)*x;let I=0;const D=k6(u)/2;for(let U=0;U<u.length-1;U++){const q=u[U],H=u[U+1],Y=q.dist(H);if(I+Y>D){const J=(D-I)/Y,oe=Kr(q.x,H.x,J),ce=Kr(q.y,H.y,J),he=new Cf(oe,ce,0,H.angleTo(q),U);return!b||O6(u,he,C,b,a)?he:void 0}I+=Y}}function mpe(u,a,c,p,g,x,b,C,I){const D=N6(p,x,b),U=I6(p,g),q=U*b,H=u[0].x===0||u[0].x===I||u[0].y===0||u[0].y===I;return a-q<a/4&&(a=q+a/4),R6(u,H?a/2*C%a:(U/2+2*x)*b*C%a,a,D,c,q,H,!1,I)}function R6(u,a,c,p,g,x,b,C,I){const D=x/2,U=k6(u);let q=0,H=a-c,Y=[];for(let J=0;J<u.length-1;J++){const oe=u[J],ce=u[J+1],he=oe.dist(ce),we=ce.angleTo(oe);for(;H+c<q+he;){H+=c;const Te=(H-q)/he,Pe=Kr(oe.x,ce.x,Te),He=Kr(oe.y,ce.y,Te);if(Pe>=0&&Pe<I&&He>=0&&He<I&&H-D>=0&&H+D<=U){const Fe=new Cf(Pe,He,0,we,J);p&&!O6(u,Fe,x,p,g)||Y.push(Fe)}}q+=he}return C||Y.length||b||(Y=R6(u,q/2,c,p,g,x,b,!0,I)),Y}function M6(u){let a=0,c=0;for(const b of u)a+=b.w*b.h,c=Math.max(c,b.w);u.sort((b,C)=>C.h-b.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),c),h:1/0}];let g=0,x=0;for(const b of u)for(let C=p.length-1;C>=0;C--){const I=p[C];if(!(b.w>I.w||b.h>I.h)){if(b.x=I.x,b.y=I.y,x=Math.max(x,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===I.w&&b.h===I.h){const D=p.pop();D&&C<p.length&&(p[C]=D)}else b.h===I.h?(I.x+=b.w,I.w-=b.w):b.w===I.w?(I.y+=b.h,I.h-=b.h):(p.push({x:I.x+b.w,y:I.y,w:I.w-b.w,h:b.h}),I.y+=b.h,I.h-=b.h);break}}return{w:g,h:x,fill:a/(g*x)||0}}_r(Cf,"Anchor");const jy=1;class hS{static getImagePositionScale(a,c,p){if(c&&a&&a.options&&a.options.transform){const g=a.options.transform;return{x:g.a,y:g.d}}return{x:p,y:p}}constructor(a,c,p,g){this.paddedRect=a;const{pixelRatio:x,version:b,stretchX:C,stretchY:I,content:D,sdf:U,usvg:q}=c;this.pixelRatio=x,this.stretchX=C,this.stretchY=I,this.content=D,this.version=b,this.padding=p,this.sdf=U,this.usvg=q,this.scale=hS.getImagePositionScale(g,q,x)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function bM(u,a,c){const p=ad.parse(u),g=function(x,b,C=[1,1]){return{x:0,y:0,w:(x.data?x.data.width:x.width*C[0])+2*b,h:(x.data?x.data.height:x.height*C[1])+2*b}}(a,c,[p.options.transform.a,p.options.transform.d]);return{bin:g,imagePosition:new hS(g,a,c,p),imageVariant:p}}class D6{constructor(a,c,p){const g=new Map,x=new Map;this.haveRenderCallbacks=[];const b=[];this.addImages(a,g,jy,b),this.addImages(c,x,2,b);const{w:C,h:I}=M6(b),D=new To({width:C||1,height:I||1});for(const[U,q]of a.entries()){const H=g.get(U).paddedRect;To.copy(q.data,D,{x:0,y:0},{x:H.x+jy,y:H.y+jy},q.data,null,q.sdf)}for(const[U,q]of c.entries()){const H=x.get(U),Y=H.paddedRect;let J=H.padding;const oe=Y.x+J,ce=Y.y+J,he=q.data.width,we=q.data.height;J=J>1?J-1:J,To.copy(q.data,D,{x:0,y:0},{x:oe,y:ce},q.data,p),To.copy(q.data,D,{x:0,y:we-J},{x:oe,y:ce-J},{width:he,height:J},p),To.copy(q.data,D,{x:0,y:0},{x:oe,y:ce+we},{width:he,height:J},p),To.copy(q.data,D,{x:he-J,y:0},{x:oe-J,y:ce},{width:J,height:we},p),To.copy(q.data,D,{x:0,y:0},{x:oe+he,y:ce},{width:J,height:we},p),To.copy(q.data,D,{x:he-J,y:we-J},{x:oe-J,y:ce-J},{width:J,height:J},p),To.copy(q.data,D,{x:0,y:we-J},{x:oe+he,y:ce-J},{width:J,height:J},p),To.copy(q.data,D,{x:0,y:0},{x:oe+he,y:ce+we},{width:J,height:J},p),To.copy(q.data,D,{x:he-J,y:0},{x:oe-J,y:ce+we},{width:J,height:J},p)}this.lut=p,this.image=D,this.iconPositions=g,this.patternPositions=x}addImages(a,c,p,g){for(const[x,b]of a.entries()){const{bin:C,imagePosition:I,imageVariant:D}=bM(x,b,p);c.set(x,I),g.push(C),b.hasRenderCallback&&this.haveRenderCallbacks.push(D.id)}}patchUpdatedImages(a,c,p){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>a.hasImage(g,p)),a.dispatchRenderCallbacks(this.haveRenderCallbacks,p);for(const g of a.getUpdatedImages(p)){for(const x of this.iconPositions.keys()){const b=ad.parse(x);if(ca.isEqual(b.id,g)){const C=a.getImage(g,p);this.patchUpdatedImage(this.iconPositions.get(x),C,c,null)}}for(const x of this.patternPositions.keys()){const b=ad.parse(x);if(ca.isEqual(b.id,g)){const C=a.getImage(g,p);this.patchUpdatedImage(this.patternPositions.get(x),C,c,this.lut)}}}}patchUpdatedImage(a,c,p,g=null){if(!a||!c||a.version===c.version)return;a.version=c.version;const[x,b]=a.tl,C=a.sdf;if(this.lut||C){const I={width:c.data.width,height:c.data.height},D=new To(I);To.copy(c.data,D,{x:0,y:0},{x:0,y:0},I,g,C),p.update(D,{position:{x,y:b}})}else p.update(c.data,{position:{x,y:b}})}}_r(hS,"ImagePosition"),_r(D6,"ImageAtlas");const fS=1e20;function L6(u,a,c,p,g,x,b,C,I){for(let D=a;D<a+p;D++)F6(u,c*x+D,x,g,b,C,I);for(let D=c;D<c+g;D++)F6(u,D*x+a,1,p,b,C,I)}function F6(u,a,c,p,g,x,b){x[0]=0,b[0]=-fS,b[1]=fS,g[0]=u[a];for(let C=1,I=0,D=0;C<p;C++){g[C]=u[a+C*c];const U=C*C;do{const q=x[I];D=(g[C]-g[q]+U-q*q)/(C-q)/2}while(D<=b[I]&&--I>-1);I++,x[I]=C,b[I]=D,b[I+1]=fS}for(let C=0,I=0;C<p;C++){for(;b[I+1]<C;)I++;const D=x[I],U=C-D;u[a+C*c]=g[D]+U*U}}const vd=2,wM={none:0,ideographs:1,all:2};class Sx{constructor(a,c,p){this.requestManager=a,this.localGlyphMode=c,this.localFontFamily=p,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a){this.url=a}getGlyphs(a,c){const p=[],g=this.url||Ji.GLYPHS_URL;for(const x in a)for(const b of a[x])p.push({stack:x,id:b});Qe(p,({stack:x,id:b},C)=>{let I=this.entries[x];I||(I=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=I.glyphs[b];if(D!==void 0)return void C(null,{stack:x,id:b,glyph:D});if(D=this._tinySDF(I,x,b),D)return I.glyphs[b]=D,void C(null,{stack:x,id:b,glyph:D});const U=Math.floor(b/256);if(256*U>65535)return zr("glyphs > 65535 not supported"),void C(null,{stack:x,id:b,glyph:D});if(I.ranges[U])return void C(null,{stack:x,id:b,glyph:D});let q=I.requests[U];q||(q=I.requests[U]=[],Sx.loadGlyphRange(x,U,g,this.requestManager,(H,Y)=>{if(Y){I.ascender=Y.ascender,I.descender=Y.descender;for(const J in Y.glyphs)this._doesCharSupportLocalGlyph(+J)||(I.glyphs[+J]=Y.glyphs[+J]);I.ranges[U]=!0}for(const J of q)J(H,Y);delete I.requests[U]})),q.push((H,Y)=>{H?C(H):Y&&C(null,{stack:x,id:b,glyph:Y.glyphs[b]||null})})},(x,b)=>{if(x)c(x);else if(b){const C={};for(const{stack:I,id:D,glyph:U}of b)C[I]===void 0&&(C[I]={}),C[I].glyphs===void 0&&(C[I].glyphs={}),C[I].glyphs[D]=U&&{id:U.id,bitmap:U.bitmap.clone(),metrics:U.metrics},C[I].ascender=this.entries[I].ascender,C[I].descender=this.entries[I].descender;c(null,C)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==wM.none&&(this.localGlyphMode===wM.all?!!this.localFontFamily:!!this.localFontFamily&&(Br["CJK Unified Ideographs"](a)||Br["Hangul Syllables"](a)||Br.Hiragana(a)||Br.Katakana(a)||Br["CJK Symbols and Punctuation"](a)||Br["CJK Unified Ideographs Extension A"](a)||Br["CJK Unified Ideographs Extension B"](a)||Br.Osage(a)))}_tinySDF(a,c,p){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(p))return;let x=a.tinySDF;if(!x){let oe="400";/bold/i.test(c)?oe="900":/medium/i.test(c)?oe="500":/light/i.test(c)&&(oe="200"),x=a.tinySDF=new Sx.TinySDF({fontFamily:g,fontWeight:oe,fontSize:24*vd,buffer:3*vd,radius:8*vd}),x.fontWeight=oe}if(this.localGlyphs[x.fontWeight][p])return this.localGlyphs[x.fontWeight][p];const b=String.fromCodePoint(p),{data:C,width:I,height:D,glyphWidth:U,glyphHeight:q,glyphLeft:H,glyphTop:Y,glyphAdvance:J}=x.draw(b);return this.localGlyphs[x.fontWeight][p]={id:p,bitmap:new sm({width:I,height:D},C),metrics:{width:U/vd,height:q/vd,left:H/vd,top:Y/vd-27,advance:J/vd,localGlyph:!0}}}}Sx.loadGlyphRange=function(u,a,c,p,g){const x=256*a,b=x+255,C=p.transformRequest(p.normalizeGlyphsURL(c).replace("{fontstack}",u).replace("{range}",`${x}-${b}`),of.Glyphs);bp(C,(I,D)=>{if(I)g(I);else if(D){const U={},q=function(H){return new vC(H).readFields(cpe,{})}(D);for(const H of q.glyphs)U[H.id]=H;g(null,{glyphs:U,ascender:q.ascender,descender:q.descender})}})},Sx.TinySDF=class{constructor({fontSize:u=24,buffer:a=3,radius:c=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:b="normal",lang:C=null}={}){this.buffer=a,this.cutoff=p,this.radius=c,this.lang=C;const I=this.size=u+4*a,D=this._createCanvas(I),U=this.ctx=D.getContext("2d",{willReadFrequently:!0});U.font=`${b} ${x} ${u}px ${g}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(u){const a=document.createElement("canvas");return a.width=a.height=u,a}draw(u){const{width:a,actualBoundingBoxAscent:c,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(u),b=Math.ceil(c),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),I=Math.min(this.size-this.buffer,b+Math.ceil(p)),D=C+2*this.buffer,U=I+2*this.buffer,q=Math.max(D*U,0),H=new Uint8ClampedArray(q),Y={data:H,width:D,height:U,glyphWidth:C,glyphHeight:I,glyphTop:b,glyphLeft:0,glyphAdvance:a};if(C===0||I===0)return Y;const{ctx:J,buffer:oe,gridInner:ce,gridOuter:he}=this;this.lang&&(J.lang=this.lang),J.clearRect(oe,oe,C,I),J.fillText(u,oe,oe+b);const we=J.getImageData(oe,oe,C,I);he.fill(fS,0,q),ce.fill(0,0,q);for(let Te=0;Te<I;Te++)for(let Pe=0;Pe<C;Pe++){const He=we.data[4*(Te*C+Pe)+3]/255;if(He===0)continue;const Fe=(Te+oe)*D+Pe+oe;if(He===1)he[Fe]=0,ce[Fe]=fS;else{const Ye=.5-He;he[Fe]=Ye>0?Ye*Ye:0,ce[Fe]=Ye<0?Ye*Ye:0}}L6(he,0,0,D,U,D,this.f,this.v,this.z),L6(ce,oe,oe,C,I,D,this.f,this.v,this.z);for(let Te=0;Te<q;Te++){const Pe=Math.sqrt(he[Te])-Math.sqrt(ce[Te]);H[Te]=Math.round(255-255*(Pe/this.radius+this.cutoff))}return Y}};const hh=jy;function z6(u,a){return u+a[1]-a[0]}function SM(u,a,c,p,g=1){const x=[],b=u.imagePrimary,C=b.pixelRatio,I=b.paddedRect.w-2*hh,D=b.paddedRect.h-2*hh,U=(u.right-u.left)*g,q=(u.bottom-u.top)*g,H=b.stretchX||[[0,I]],Y=b.stretchY||[[0,D]],J=H.reduce(z6,0),oe=Y.reduce(z6,0),ce=I-J,he=D-oe;let we=0,Te=J,Pe=0,He=oe,Fe=0,Ye=ce,tt=0,it=he;if(b.content&&p){const ft=b.content;we=bC(H,0,ft[0]),Pe=bC(Y,0,ft[1]),Te=bC(H,ft[0],ft[2]),He=bC(Y,ft[1],ft[3]),Fe=ft[0]-we,tt=ft[1]-Pe,Ye=ft[2]-ft[0]-Te,it=ft[3]-ft[1]-He}const Tt=(ft,At,Rt,Bt)=>{const er=wC(ft.stretch-we,Te,U,u.left*g),Wt=SC(ft.fixed-Fe,Ye,ft.stretch,J),Lt=wC(At.stretch-Pe,He,q,u.top*g),Gt=SC(At.fixed-tt,it,At.stretch,oe),wt=wC(Rt.stretch-we,Te,U,u.left*g),xt=SC(Rt.fixed-Fe,Ye,Rt.stretch,J),Vt=wC(Bt.stretch-Pe,He,q,u.top*g),Yt=SC(Bt.fixed-tt,it,Bt.stretch,oe),Ft=new at(er,Lt),gr=new at(wt,Lt),br=new at(wt,Vt),hr=new at(er,Vt),ar=new at(Wt/C,Gt/C),en=new at(xt/C,Yt/C),lr=a*Math.PI/180;if(lr){const ti=Math.sin(lr),ri=Math.cos(lr),ls=[ri,-ti,ti,ri];Ft._matMult(ls),gr._matMult(ls),hr._matMult(ls),br._matMult(ls)}const Lr=ft.stretch+ft.fixed,nn=Rt.stretch+Rt.fixed,wn=At.stretch+At.fixed,Vn=Bt.stretch+Bt.fixed,an=u.imageSecondary;return{tl:Ft,tr:gr,bl:hr,br,texPrimary:{x:b.paddedRect.x+hh+Lr,y:b.paddedRect.y+hh+wn,w:nn-Lr,h:Vn-wn},texSecondary:an?{x:an.paddedRect.x+hh+Lr,y:an.paddedRect.y+hh+wn,w:nn-Lr,h:Vn-wn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ar,pixelOffsetBR:en,minFontScaleX:Ye/C/U,minFontScaleY:it/C/q,isSDF:c}};if(p&&(b.stretchX||b.stretchY)){const ft=B6(H,ce,J),At=B6(Y,he,oe);for(let Rt=0;Rt<ft.length-1;Rt++){const Bt=ft[Rt],er=ft[Rt+1];for(let Wt=0;Wt<At.length-1;Wt++)x.push(Tt(Bt,At[Wt],er,At[Wt+1]))}}else x.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return x}function gpe(u,a){const c=u.stretchY||[[0,u.paddedRect.h-2*hh]];return a&&(u.stretchX||u.stretchY)?$6(u.stretchX||[[0,u.paddedRect.w-2*hh]])*$6(c):1}function bC(u,a,c){let p=0;for(const g of u)p+=Math.max(a,Math.min(c,g[1]))-Math.max(a,Math.min(c,g[0]));return p}function B6(u,a,c){const p=[{fixed:-hh,stretch:0}];for(const[g,x]of u){const b=p[p.length-1];p.push({fixed:g-b.stretch,stretch:b.stretch}),p.push({fixed:g-b.stretch,stretch:b.stretch+(x-g)})}return p.push({fixed:a+hh,stretch:c}),p}function $6(u){return 2*u.length+1}function wC(u,a,c,p){return u/a*c+p}function SC(u,a,c,p){return u-a*c/p}function ype(u,a,c,p){const g=a+u.positionedLines[p].lineOffset;return p===0?c+g/2:c+(g+(a+u.positionedLines[p-1].lineOffset))/2}function vpe(u,a=1,c=!1){let p=1/0,g=1/0,x=-1/0,b=-1/0;const C=u[0];for(let Y=0;Y<C.length;Y++){const J=C[Y];(!Y||J.x<p)&&(p=J.x),(!Y||J.y<g)&&(g=J.y),(!Y||J.x>x)&&(x=J.x),(!Y||J.y>b)&&(b=J.y)}const I=Math.min(x-p,b-g);let D=I/2;const U=new __([],_pe);if(I===0)return new at(p,g);for(let Y=p;Y<x;Y+=I)for(let J=g;J<b;J+=I)U.push(new Ex(Y+D,J+D,D,u));let q=function(Y){let J=0,oe=0,ce=0;const he=Y[0];for(let we=0,Te=he.length,Pe=Te-1;we<Te;Pe=we++){const He=he[we],Fe=he[Pe],Ye=He.x*Fe.y-Fe.x*He.y;oe+=(He.x+Fe.x)*Ye,ce+=(He.y+Fe.y)*Ye,J+=3*Ye}return new Ex(oe/J,ce/J,0,Y)}(u),H=U.length;for(;U.length;){const Y=U.pop();(Y.d>q.d||!q.d)&&(q=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,H)),Y.max-q.d<=a||(D=Y.h/2,U.push(new Ex(Y.p.x-D,Y.p.y-D,D,u)),U.push(new Ex(Y.p.x+D,Y.p.y-D,D,u)),U.push(new Ex(Y.p.x-D,Y.p.y+D,D,u)),U.push(new Ex(Y.p.x+D,Y.p.y+D,D,u)),H+=4)}return c&&(console.log(`num probes: ${H}`),console.log(`best distance: ${q.d}`)),q.p}function _pe(u,a){return a.max-u.max}class Ex{constructor(a,c,p,g){this.p=new at(a,c),this.h=p,this.d=function(x,b){let C=!1,I=1/0;for(let D=0;D<b.length;D++){const U=b[D];for(let q=0,H=U.length,Y=H-1;q<H;Y=q++){const J=U[q],oe=U[Y];J.y>x.y!=oe.y>x.y&&x.x<(oe.x-J.x)*(x.y-J.y)/(oe.y-J.y)+J.x&&(C=!C),I=Math.min(I,Xl(x,J,oe))}}return(C?1:-1)*Math.sqrt(I)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const xpe=Object.keys,EM=Number.POSITIVE_INFINITY,bpe=Math.sqrt(2);function EC(u,a,c,p){const g=u.collisionPadding||[0,0,0,0],x={top:u.top-g[1],bottom:u.bottom+g[3],left:u.left-g[0],right:u.right+g[2],scaled:!1};return p!==void 0&&function(b,C){b.top*=C,b.bottom*=C,b.left*=C,b.right*=C,b.scaled=!0}(x,p),c&&function(b,C){if(!C)return;const I=vn(C),D=new at(b.left,b.top),U=new at(b.right,b.top),q=new at(b.left,b.bottom),H=new at(b.right,b.bottom);D._rotateAround(I,new at(0,0)),U._rotateAround(I,new at(0,0)),q._rotateAround(I,new at(0,0)),H._rotateAround(I,new at(0,0)),b.left=Math.min(D.x,U.x,q.x,H.x),b.right=Math.max(D.x,U.x,q.x,H.x),b.top=Math.min(D.y,U.y,q.y,H.y),b.bottom=Math.max(D.y,U.y,q.y,H.y)}(x,c),a?{top:Math.min(a.top,x.top),bottom:Math.max(a.bottom,x.bottom),left:Math.min(a.left,x.left),right:Math.max(a.right,x.right),scaled:a.scaled||x.scaled}:x}function U6(u,[a,c]){let p=0,g=0;if(c===EM){a<0&&(a=0);const x=a/bpe;switch(u){case"top-right":case"top-left":g=x-7;break;case"bottom-right":case"bottom-left":g=7-x;break;case"bottom":g=7-a;break;case"top":g=a-7}switch(u){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=a;break;case"right":p=-a}}else{switch(a=Math.abs(a),c=Math.abs(c),u){case"top-right":case"top-left":case"top":g=c-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-c}switch(u){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}}return[p,g]}function wpe(u,a,c,p,g,x,b,C,I,D,U){const q=u.layers[0],H=q.appearances;if(H.length===0)return{iconBBox:null,iconVerticalBBox:null};let Y=null,J=null;const oe=p.get("icon-rotate").evaluate(g,{},x);a&&(Y=EC(a,Y,oe,b),c)&&(J=EC(c,J,oe+90,b));const[ce,he]=p.get("icon-size-scale-range"),we=ve(1,ce,he);for(const Te of H){const Pe=Te.getUnevaluatedProperties(),He=Pe._values["icon-image"].value!==void 0,Fe=Pe._values["icon-size"].value!==void 0,Ye=Pe._values["icon-offset"].value!==void 0,tt=Pe._values["icon-rotate"].value!==void 0;if(He||Fe||Ye||tt){const it=Ye?q.getAppearanceValueAndResolveTokens(Te,"icon-offset",g,x,[]):null,Tt=it&&Array.isArray(it)?it:C,ft=tt?q.getAppearanceValueAndResolveTokens(Te,"icon-rotate",g,x,[]):null,At=typeof ft=="number"?ft:oe,Rt=Fe?q.getAppearanceValueAndResolveTokens(Te,"icon-size",g,x,[]):null,Bt=typeof Rt=="number"?Rt*I.iconScaleFactor:b;let er=null,Wt=null,Lt=null;if(He){const Gt=q.getAppearanceValueAndResolveTokens(Te,"icon-image",g,x,[]);if(Gt){const wt=u.getResolvedImageFromTokens(Gt),xt=Pe._values["icon-size"],Vt=pS(wt,bx(u.zoom,xt,u.worldview),xt,x,u.zoom,g,u.pixelRatio,we,u.worldview);Lt=D.get(Vt.iconPrimary.toString())}}else a&&(Lt=a.imagePrimary);Lt&&(er=xC(Lt,null,Tt,U),u.allowVerticalPlacement&&(Wt=xC(Lt,null,Tt,U))),er&&(Y=EC(er,Y,At,Bt)),Wt&&(J=EC(Wt,J,At+90,Bt))}}return{iconBBox:Y,iconVerticalBBox:J}}function TC(u,a,c,p,g,x,b,C,I){if(!a||!a.usvg)return;const D=P6(p),U=P6(g),q=x!=="both"&&x!=="width"||!C6(p)?1:U.width/D.width,H=x!=="both"&&x!=="height"||!j6(p)?1:U.height/D.height;c.scaleSelf(q,H);const Y=c.toString();b.set(Y,c),C.set(Y,a);const{imagePosition:J}=bM(Y,a,jy);I.set(Y,J)}function V6(u,a,c,p,g,x,b,C,I){if(!u)return;const D=function(U,q,H,Y,J,oe){if(U.kind==="camera")return U.maxSize;if(U.kind==="composite"){const ce=q.possiblyEvaluate(new Ui(U.maxZoom,{worldview:oe}),H).evaluate(J,{},H),he=q.possiblyEvaluate(new Ui(U.minZoom,{worldview:oe}),H).evaluate(J,{},H);return Math.max(ce,he)}return q.possiblyEvaluate(new Ui(Y,{worldview:oe})).evaluate(J,{},H)}(a,c,p,g,x,I);return u.scaleSelf(D*C*b)}function pS(u,a,c,p,g,x,b,C,I){return{iconPrimary:V6(u.getPrimary(),a,c,p,g,x,b,C,I),iconSecondary:V6(u.getSecondary(),a,c,p,g,x,b,C,I)}}function Spe(u,a,c){if(!a)return;const p=c.get(u.toString()),g=c.get(a.toString());p&&g&&(p.paddedRect.w===g.paddedRect.w&&p.paddedRect.h===g.paddedRect.h||zr(`Mismatch in icon variant sizes: ${u.toString()} and ${a.toString()}`),p.usvg!==g.usvg&&zr(`Mismatch in icon variant image types: ${u.id} and ${a.id}`))}function q6(u,a,c,p){if(!u)return;const g=a.get(c.toString());if(u.imagePrimary=g,p){const x=a.get(p.toString());u.imageSecondary=x}}function Epe(u,a){for(const c in u.horizontal)H6(u.horizontal[c],a);H6(u.vertical,a)}function H6(u,a){if(u){for(const c of u.positionedLines)for(const p of c.positionedGlyphs)if(p.image!==null){const g=p.image.toString();p.rect=a.get(g).paddedRect}}}function TM(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Tpe(u,a,c,p,g,x,b,C,I){const D=AM(x.horizontal)||x.vertical,U=c.get("icon-text-fit-padding").evaluate(p,{},g);let q,H=a;return a&&I!=="none"&&(u.allowVerticalPlacement&&x.vertical&&(q=_M(a,x.vertical,I,U,C,b)),D&&(H=_M(a,D,I,U,C,b))),{defaultShapedIcon:H,verticallyShapedIcon:q}}function Ape(u,a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we,Te,Pe,He){let Fe=b.textMaxSize.evaluate(a,{},H);Fe===void 0?Fe=C*b.textScaleFactor:Fe*=b.textScaleFactor;const Ye=u.layers[0].layout,tt=Xa,it=C*b.textScaleFactor/tt,Tt=AM(c.horizontal)||c.vertical;if(ce!=="none"&&u.appearanceFeatureData&&a.index<u.appearanceFeatureData.length){const Ft=u.appearanceFeatureData[a.index];Ft&&(Ft.textShaping=Tt,Ft.iconTextFitPadding=Ye.get("icon-text-fit-padding").evaluate(a,{},H),Ft.fontScale=it)}const ft=Y.name==="globe",At=u.tilePixelRatio*Fe/tt,Rt=(wt=u.overscaling,u.zoom>18&&wt>2&&(wt>>=1),Math.max(rr/(512*wt),1)*Ye.get("symbol-spacing")),Bt=Ye.get("text-padding")*u.tilePixelRatio,er=Ye.get("icon-padding")*u.tilePixelRatio,Wt=vn(Ye.get("text-max-angle")),Lt=Ye.get("icon-rotation-alignment")==="map"&&Te!=="point",Gt=Rt/2;var wt;u.hasAnyIconTextFit===!1&&ce!=="none"&&(u.hasAnyIconTextFit=!0);const xt=a.properties?+a.properties[dr]:null,Vt=xt&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(xt):65535,Yt=(Ft,gr,br)=>{if(gr.x<0||gr.x>=rr||gr.y<0||gr.y>=rr)return;let hr=null;if(ft){const{x:ar,y:en,z:lr}=Y.projectTilePoint(gr.x,gr.y,br);hr={anchor:new Cf(ar,en,lr,0,void 0),up:Y.upVector(br,gr.x,gr.y)}}(function(ar,en,lr,Lr,nn,wn,Vn,an,ti,ri,ls,ze,Re,Pt,sr,Ot,or,jr,Tr,ln,qr,Sr,Yn,Ai,Wr,Bn,Ci,fi,vs,es,zi){const xi=ar.addToLineVertexArray(en,Lr);let ni,cn,ii,Bi,Hr,qn,ts,Ts=0,Fs=0,ea=0,rs=0,Xs=-1,Rl=-1;const Ys={};let rc=Vg("");const Ao=lr?lr.anchor:en,nu=fi!=="none";let Ml=0,nc=0;if(ti._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ya=ti.layout.get("text-offset").evaluate(qr,{},Wr);Ml=Ya[0]*Xa,nc=Ya[1]*Xa}else Ml=ti.layout.get("text-radial-offset").evaluate(qr,{},Wr)*Xa,nc=EM;if(ar.allowVerticalPlacement&&nn.vertical){const Ya=nn.vertical;if(sr)qn=CM(Ya),an&&(ts=CM(an));else{const ll=ti.layout.get("text-rotate").evaluate(qr,{},Wr)+90;ii=AC(ri,Ao,en,ls,ze,Re,Ya,Pt,ll,Ot),an&&(Bi=AC(ri,Ao,en,ls,ze,Re,an,jr,ll,null,zi))}}if(wn){const Ya=ar.iconSizeData,ll=ti.layout.get("icon-rotate").evaluate(qr,{},Wr),fh=SM(wn,ll,Yn,nu,Sr.iconScaleFactor),um=an?SM(an,ll,Yn,nu,Sr.iconScaleFactor):void 0;cn=AC(ri,Ao,en,ls,ze,Re,wn,jr,ll,null,es);const kx=function(ph,VC,Nx,zme,uq,dq,Bme,$me){const hq=ph.layers[0],fq=hq.appearances;let Ix=VC.length;if(Nx&&(Ix=Math.max(Ix,Nx.length)),fq.length===0)return Ix;const[Ume,Vme]=zme.get("icon-size-scale-range"),qme=ve(1,Ume,Vme);for(const pq of fq){const mq=pq.getUnevaluatedProperties();if(mq._values["icon-image"].value!==void 0){const gq=hq.getAppearanceValueAndResolveTokens(pq,"icon-image",uq,dq,[]);if(gq){const yq=ph.getResolvedImageFromTokens(gq);if(yq){const vq=mq._values["icon-size"],Hme=pS(yq,bx(ph.zoom,vq,ph.worldview),vq,dq,ph.zoom,uq,ph.pixelRatio,qme,ph.worldview),Gme=Bme.get(Hme.iconPrimary.toString());Ix=Math.max(Ix,gpe(Gme,$me))}}}}return Ix}(ar,fh,um,ti.layout,qr,Wr,ar.iconAtlasPositions,nu);Ts=4*kx;let dm=null;Ya.kind==="source"?(dm=[yd*ti.layout.get("icon-size").evaluate(qr,{},Wr)*Sr.iconScaleFactor],dm[0]>jf&&zr(`${ar.layerIds[0]}: Value for "icon-size" is >= ${mS}. Reduce your "icon-size".`)):Ya.kind==="composite"&&(dm=[yd*Sr.compositeIconSizes[0].evaluate(qr,{},Wr)*Sr.iconScaleFactor,yd*Sr.compositeIconSizes[1].evaluate(qr,{},Wr)*Sr.iconScaleFactor],(dm[0]>jf||dm[1]>jf)&&zr(`${ar.layerIds[0]}: Value for "icon-size" is >= ${mS}. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,fh,dm,ln,Tr,qr,void 0,lr,en,xi.lineStartIndex,xi.lineLength,-1,Ai,Wr,Bn,Ci,ar.symbolInstances.length,kx),Xs=ar.icon.placedSymbolArray.length-1,um&&(Fs=4*kx,ar.addSymbols(ar.icon,um,dm,ln,Tr,qr,tc.vertical,lr,en,xi.lineStartIndex,xi.lineLength,-1,Ai,Wr,Bn,Ci,ar.symbolInstances.length,kx),Rl=ar.icon.placedSymbolArray.length-1)}for(const Ya in nn.horizontal){const ll=Ya,fh=nn.horizontal[ll];ni||(rc=Vg(fh.text),sr?Hr=CM(fh):ni=AC(ri,Ao,en,ls,ze,Re,fh,Pt,ti.layout.get("text-rotate").evaluate(qr,{},Wr),Ot));const um=fh.positionedLines.length===1;if(ea+=G6(ar,lr,en,fh,Vn,ti,sr,qr,Ot,xi,nn.vertical?tc.horizontal:tc.horizontalOnly,um?xpe(nn.horizontal):[ll],Ys,Xs,Sr,Ai,Wr,ar.symbolInstances.length,Bn),um)break}nn.vertical&&(rs+=G6(ar,lr,en,nn.vertical,Vn,ti,sr,qr,Ot,xi,tc.vertical,["vertical"],Ys,Rl,Sr,Ai,Wr,ar.symbolInstances.length,Bn));let Co=-1;const ic=(Ya,ll)=>Ya?Math.max(Ya,ll):ll;Co=ic(Hr,Co),Co=ic(qn,Co),Co=ic(ts,Co);const iu=Co>-1?1:0;ar.glyphOffsetArray.length>=65535&&zr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qr.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,qr.sortKey),ar.symbolInstances.emplaceBack(en.x,en.y,Ao.x,Ao.y,Ao.z,Ys.right>=0?Ys.right:-1,Ys.center>=0?Ys.center:-1,Ys.left>=0?Ys.left:-1,Ys.vertical>=0?Ys.vertical:-1,Xs,Rl,rc,ni!==void 0?ni:ar.collisionBoxArray.length,ni!==void 0?ni+1:ar.collisionBoxArray.length,ii!==void 0?ii:ar.collisionBoxArray.length,ii!==void 0?ii+1:ar.collisionBoxArray.length,cn!==void 0?cn:ar.collisionBoxArray.length,cn!==void 0?cn+1:ar.collisionBoxArray.length,Bi||ar.collisionBoxArray.length,Bi?Bi+1:ar.collisionBoxArray.length,ls,ea,rs,Ts,Fs,iu,0,Ml,nc,Co,0,nu?1:0,vs)})(u,gr,hr,Ft,c,p,x,g,u.layers[0],u.collisionBoxArray,a.index,a.sourceLayerIndex,u.index,Bt,we,D,0,er,Lt,he,a,b,U,q,H,J,oe,ce,Vt,Pe,He)};if(Te==="line")for(const Ft of oC(a.geometry,0,0,rr,rr)){const gr=mpe(Ft,Rt,Wt,c.vertical||Tt,p,tt,At,u.overscaling,rr);for(const br of gr)Tt&&Cpe(u,Tt.text,Gt,br)||Yt(Ft,br,H)}else if(Te==="line-center"){for(const Ft of a.geometry)if(Ft.length>1){const gr=ppe(Ft,Wt,c.vertical||Tt,p,tt,At);gr&&Yt(Ft,gr,H)}}else if(a.type==="Polygon")for(const Ft of Y1(a.geometry,0)){const gr=vpe(Ft,16);Yt(Ft[0],new Cf(gr.x,gr.y,0,0,void 0),H)}else if(a.type==="LineString")for(const Ft of a.geometry)Yt(Ft,new Cf(Ft[0].x,Ft[0].y,0,0,void 0),H);else if(a.type==="Point")for(const Ft of a.geometry)for(const gr of Ft)Yt([gr],new Cf(gr.x,gr.y,0,0,void 0),H)}const mS=255,jf=mS*yd;function G6(u,a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we){const Te=function(Fe,Ye,tt,it,Tt,ft,At,Rt){const Bt=[];if(Ye.positionedLines.length===0)return Bt;const er=it.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Wt=function(Vt){const Yt=Vt[0],Ft=Vt[1],gr=Yt*Ft;return gr>0?[Yt,-Ft]:gr<0?[-Yt,Ft]:Yt===0?[Ft,Yt]:[Ft,-Yt]}(tt);let Lt=Math.abs(Ye.top-Ye.bottom);for(const Vt of Ye.positionedLines)Lt-=Vt.lineOffset;const Gt=Ye.positionedLines.length,wt=Lt/Gt;let xt=Ye.top-tt[1];for(let Vt=0;Vt<Gt;++Vt){const Yt=Ye.positionedLines[Vt];xt=ype(Ye,wt,xt,Vt);for(const Ft of Yt.positionedGlyphs){if(!Ft.rect)continue;const gr=Ft.rect||{};let br=x6+1,hr=!0,ar=1,en=0;if(Ft.image){const Tr=At.get(Ft.image.toString());if(!Tr)continue;if(Tr.sdf){zr("SDF images are not supported in formatted text and will be ignored.");continue}hr=!1,ar=Tr.pixelRatio,br=jy/ar}const lr=(Tt||Rt)&&Ft.vertical,Lr=Ft.metrics.advance*Ft.scale/2,nn=Ft.metrics,wn=Ft.rect;if(wn===null)continue;Rt&&Ye.verticalizable&&(en=Ft.image?Lr-Ft.metrics.width*Ft.scale/2:0);const Vn=Tt?[Ft.x+Lr,Ft.y]:[0,0];let an=[0,0],ti=[0,0],ri=!1;Tt||(lr?(ti=[Ft.x+Lr+Wt[0],Ft.y+Wt[1]-en],ri=!0):an=[Ft.x+Lr+tt[0],Ft.y+tt[1]-en]);const ls=wn.w*Ft.scale/(ar*(Ft.localGlyph?vd:1)),ze=wn.h*Ft.scale/(ar*(Ft.localGlyph?vd:1));let Re,Pt,sr,Ot;if(lr){const Tr=Ft.y-xt,ln=new at(-Lr,Lr-Tr),qr=-Math.PI/2,Sr=new at(...ti);Re=new at(-Lr+an[0],an[1]),Re._rotateAround(qr,ln)._add(Sr),Re.x+=-Tr+Lr,Re.y-=(nn.left-br)*Ft.scale;const Yn=Ft.image?nn.advance*Ft.scale:Xa*Ft.scale,Ai=String.fromCodePoint(Ft.glyph);Jfe(Ai)?Re.x+=(1-br)*Ft.scale:Qfe(Ai)?Re.x+=Yn-nn.height*Ft.scale+(-br-1)*Ft.scale:Re.x+=Ft.image||nn.width+2*br===wn.w&&nn.height+2*br===wn.h?(Yn-ze)/2:(Yn-(nn.height+2*br)*Ft.scale)/2,Pt=new at(Re.x,Re.y-ls),sr=new at(Re.x+ze,Re.y),Ot=new at(Re.x+ze,Re.y-ls)}else{const Tr=(nn.left-br)*Ft.scale-Lr+an[0],ln=(-nn.top-br)*Ft.scale+an[1],qr=Tr+ls,Sr=ln+ze;Re=new at(Tr,ln),Pt=new at(qr,ln),sr=new at(Tr,Sr),Ot=new at(qr,Sr)}if(er){let Tr;Tr=Tt?new at(0,0):ri?new at(Wt[0],Wt[1]):new at(tt[0],tt[1]),Re._rotateAround(er,Tr),Pt._rotateAround(er,Tr),sr._rotateAround(er,Tr),Ot._rotateAround(er,Tr)}const or=new at(0,0),jr=new at(0,0);Bt.push({tl:Re,tr:Pt,bl:sr,br:Ot,texPrimary:gr,texSecondary:void 0,writingMode:Ye.writingMode,glyphOffset:Vn,sectionIndex:Ft.sectionIndex,isSDF:hr,pixelOffsetTL:or,pixelOffsetBR:jr,minFontScaleX:0,minFontScaleY:0})}}return Bt}(0,p,I,x,b,C,g,u.allowVerticalPlacement),Pe=u.textSizeData;let He=null;Pe.kind==="source"?(He=[yd*x.layout.get("text-size").evaluate(C,{},ce)*J.textScaleFactor],He[0]>jf&&zr(`${u.layerIds[0]}: Value for "text-size" is >= ${mS}. Reduce your "text-size".`)):Pe.kind==="composite"&&(He=[yd*J.compositeTextSizes[0].evaluate(C,{},ce)*J.textScaleFactor,yd*J.compositeTextSizes[1].evaluate(C,{},ce)*J.textScaleFactor],(He[0]>jf||He[1]>jf)&&zr(`${u.layerIds[0]}: Value for "text-size" is >= ${mS}. Reduce your "text-size".`)),u.addSymbols(u.text,Te,He,I,b,C,U,a,c,D.lineStartIndex,D.lineLength,Y,oe,ce,we,!1,he,Te.length);for(const Fe of q)H[Fe]=u.text.placedSymbolArray.length-1;return 4*Te.length}function AM(u){for(const a in u)return u[a];return null}function AC(u,a,c,p,g,x,b,C,I,D,U){let q,H,Y,J;if(q=U?U.top:b.top,H=U?U.bottom:b.bottom,Y=U?U.left:b.left,J=U?U.right:b.right,A6(b)&&b.collisionPadding){const oe=b.collisionPadding;Y-=oe[0],q-=oe[1],J+=oe[2],H+=oe[3]}if(I){const oe=new at(Y,q),ce=new at(J,q),he=new at(Y,H),we=new at(J,H),Te=vn(I);let Pe=new at(0,0);D&&(Pe=new at(D[0],D[1])),oe._rotateAround(Te,Pe),ce._rotateAround(Te,Pe),he._rotateAround(Te,Pe),we._rotateAround(Te,Pe),Y=Math.min(oe.x,ce.x,he.x,we.x),J=Math.max(oe.x,ce.x,he.x,we.x),q=Math.min(oe.y,ce.y,he.y,we.y),H=Math.max(oe.y,ce.y,he.y,we.y)}return u.emplaceBack(a.x,a.y,a.z,c.x,c.y,Y,q,J,H,C,p,g,x),u.length-1}function CM(u){A6(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const a=u.bottom-u.top;return a>0?Math.max(10,a):null}function Cpe(u,a,c,p){const g=u.compareText;if(a in g){const x=g[a];for(let b=x.length-1;b>=0;b--)if(p.dist(x[b])<c)return!0}else g[a]=[];return g[a].push(p),!1}function W6(u,a){const c=u.fovAboveCenter,p=u.elevation?u.elevation.getMinElevationBelowMSL()*a:0,g=(u._camera.position[2]*u.worldSize-p)/Math.cos(u._pitch),x=Math.sin(c)*g/Math.sin(Math.max(Math.PI/2-u._pitch-c,.01));let b=Math.sin(u._pitch)*x+g;const C=g*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let I=Math.max(u.zoom-17,0);u.isOrthographic&&(I/=10),b*=1+I}return Math.min(1.01*b,C)}function gS(u,a){if(!a.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:a};const c=Math.pow(2,-u.z),p=u.x*c,g=(u.x+1)*c,x=u.y*c,b=(u.y+1)*c,C=Ne(p),I=Ne(g),D=je(x),U=je(b),q=a.project(C,D),H=a.project(I,D),Y=a.project(I,U),J=a.project(C,U);let oe=Math.min(q.x,H.x,Y.x,J.x),ce=Math.min(q.y,H.y,Y.y,J.y),he=Math.max(q.x,H.x,Y.x,J.x),we=Math.max(q.y,H.y,Y.y,J.y);const Te=c/16;function Pe(Fe,Ye,tt,it,Tt,ft){const At=(tt+Tt)/2,Rt=(it+ft)/2,Bt=a.project(Ne(At),je(Rt)),er=Math.max(0,oe-Bt.x,ce-Bt.y,Bt.x-he,Bt.y-we);oe=Math.min(oe,Bt.x),he=Math.max(he,Bt.x),ce=Math.min(ce,Bt.y),we=Math.max(we,Bt.y),er>Te&&(Pe(Fe,Bt,tt,it,At,Rt),Pe(Bt,Ye,At,Rt,Tt,ft))}Pe(q,H,p,x,g,x),Pe(H,Y,g,x,g,b),Pe(Y,J,g,b,p,b),Pe(J,q,p,b,p,x),oe-=Te,ce-=Te,he+=Te,we+=Te;const He=1/Math.max(he-oe,we-ce);return{scale:He,x:oe*He,y:ce*He,x2:he*He,y2:we*He,projection:a}}function K6(u,{x:a,y:c},p=0){return new at(((a-p)*u.scale-u.x)*rr,(c*u.scale-u.y)*rr)}const jpe=N(new Float32Array(16));class lm{constructor(a){this.spec=a,this.name=a.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(a,c){return{x:0,y:0,z:0}}unproject(a,c){return new Q(0,0)}projectTilePoint(a,c,p){return{x:a,y:c,z:0}}locationPoint(a,c,p,g=!0){return a._coordinatePoint(a.locationCoordinate(c,p),g)}pixelsPerMeter(a,c){return Ee(1,a)*c}pixelSpaceConversion(a,c,p){return 1}farthestPixelDistance(a){return W6(a,a.pixelsPerMeter)}pointCoordinate(a,c,p,g){const x=a.horizonLineFromTop(!1),b=new at(c,Math.max(x,p));return a.rayIntersectionCoordinate(a.pointRayIntersection(b,g))}pointCoordinate3D(a,c,p){const g=new at(c,p);if(a.elevation)return a.elevation.pointCoordinate(g);{const x=this.pointCoordinate(a,g.x,g.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(a,c){if(a.elevation&&a.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(a,c.x,c.y);const p=a.horizonLineFromTop();return c.y<p}createInversionMatrix(a,c){return jpe}createTileMatrix(a,c,p){let g,x,b;const C=p.canonical,I=N(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=gS(C,this);g=1,x=D.x+p.wrap*D.scale,b=D.y,B(I,I,[g/D.scale,g/D.scale,a.pixelsPerMeter/c])}else g=c/a.zoomScale(C.z),x=(C.x+Math.pow(2,C.z)*p.wrap)*g,b=C.y*g;return F(I,I,[x,b,0]),B(I,I,[g/rr,g/rr,1]),I}upVector(a,c,p){return[0,0,1]}upVectorScale(a,c,p){return{metersToTile:1}}}class Ppe extends lm{constructor(a){super(a),this.range=[4,7],this.center=a.center||[-96,37.5];const[c,p]=this.parallels=a.parallels||[29.5,45.5],g=Math.sin(vn(c));this.n=(g+Math.sin(vn(p)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(a,c){const{n:p,c:g,r0:x}=this,b=vn(a-this.center[0]),C=vn(c),I=Math.sqrt(g-2*p*Math.sin(C))/p;return{x:I*Math.sin(b*p),y:I*Math.cos(b*p)-x,z:0}}unproject(a,c){const{n:p,c:g,r0:x}=this,b=x+c;let C=Math.atan2(a,Math.abs(b))*Math.sign(b);b*p<0&&(C-=Math.PI*Math.sign(a)*Math.sign(b));const I=vn(this.center[0])*p;C=et(C,-Math.PI-I,Math.PI-I);const D=ve($o(C/p)+this.center[0],-180,180),U=Math.asin(ve((g-(a*a+b*b)*p*p)/(2*p),-1,1)),q=ve($o(U),-Ie,Ie);return new Q(D,q)}}const yS=1.340264,vS=-.081106,_S=893e-6,xS=.003796,CC=Math.sqrt(3)/2;class Ope extends lm{project(a,c){c=c/180*Math.PI,a=a/180*Math.PI;const p=Math.asin(CC*Math.sin(c)),g=p*p,x=g*g*g;return{x:.5*(a*Math.cos(p)/(CC*(yS+3*vS*g+x*(7*_S+9*xS*g)))/Math.PI+.5),y:1-.5*(p*(yS+vS*g+x*(_S+xS*g))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let p=c=(2*(1-c)-1)*Math.PI,g=p*p,x=g*g*g;for(let U,q,H,Y=0;Y<12&&(q=p*(yS+vS*g+x*(_S+xS*g))-c,H=yS+3*vS*g+x*(7*_S+9*xS*g),U=q/H,p=ve(p-U,-Math.PI/3,Math.PI/3),g=p*p,x=g*g*g,!(Math.abs(U)<1e-12));++Y);const b=CC*a*(yS+3*vS*g+x*(7*_S+9*xS*g))/Math.cos(p),C=Math.asin(Math.sin(p)/CC),I=ve(180*b/Math.PI,-180,180),D=ve(180*C/Math.PI,-Ie,Ie);return new Q(I,D)}}class kpe extends lm{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){return{x:.5+a/360,y:.5-c/360,z:0}}unproject(a,c){const p=360*(a-.5),g=ve(360*(.5-c),-Ie,Ie);return new Q(p,g)}}const Tx=Math.PI/2;function jC(u){return Math.tan((Tx+u)/2)}class Npe extends lm{constructor(a){super(a),this.center=a.center||[0,30];const[c,p]=this.parallels=a.parallels||[30,30];let g=vn(c),x=vn(p);this.southernCenter=g+x<0,this.southernCenter&&(g=-g,x=-x);const b=Math.cos(g),C=jC(g);this.n=g===x?Math.sin(g):Math.log(b/Math.cos(x))/Math.log(jC(x)/C),this.f=b*Math.pow(jC(g),this.n)/this.n}project(a,c){c=vn(c),this.southernCenter&&(c=-c),a=vn(a-this.center[0]);const p=1e-6,{n:g,f:x}=this;x>0?c<-Tx+p&&(c=-Tx+p):c>Tx-p&&(c=Tx-p);const b=x/Math.pow(jC(c),g);let C=b*Math.sin(g*a),I=x-b*Math.cos(g*a);return C=.5*(C/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:C,y:this.southernCenter?I:1-I,z:0}}unproject(a,c){a=(2*a-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:p,f:g}=this,x=g-c,b=Math.sign(x),C=Math.sign(p)*Math.sqrt(a*a+x*x);let I=Math.atan2(a,Math.abs(x))*b;x*p<0&&(I-=Math.PI*Math.sign(a)*b);const D=ve($o(I/p)+this.center[0],-180,180),U=ve($o(2*Math.atan(Math.pow(g/C,1/p))-Tx),-Ie,Ie);return new Q(D,this.southernCenter?-U:U)}}class Z6 extends lm{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(a,c){return{x:_e(a),y:ye(c),z:0}}unproject(a,c){const p=Ne(a),g=je(c);return new Q(p,g)}}const X6=vn(Ie);class Ipe extends lm{project(a,c){const p=(c=vn(c))*c,g=p*p;return{x:.5*((a=vn(a))*(.8707-.131979*p+g*(g*(.003971*p-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+p*(.015085+g*(.028874*p-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let p=c=(2*(1-c)-1)*Math.PI,g=25,x=0,b=p*p;do{b=p*p;const D=b*b;x=(p*(1.007226+b*(.015085+D*(.028874*b-.044475-.005916*D)))-c)/(1.007226+b*(.045255+D*(.259866*b-.311325-.005916*11*D))),p=ve(p-x,-X6,X6)}while(Math.abs(x)>1e-6&&--g>0);b=p*p;const C=ve($o(a/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),I=$o(p);return new Q(C,I)}}const Y6=vn(Ie);class Rpe extends lm{project(a,c){c=vn(c),a=vn(a);const p=Math.cos(c),g=2/Math.PI,x=Math.acos(p*Math.cos(a/2)),b=Math.sin(x)/x,C=.5*(a*g+2*p*Math.sin(a/2)/b)||0,I=.5*(c+Math.sin(c)/b)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(a,c){let p=a=(2*a-.5)*Math.PI,g=c=(2*(1-c)-1)*Math.PI,x=25;const b=1e-6;let C=0,I=0;do{const D=Math.cos(g),U=Math.sin(g),q=2*U*D,H=U*U,Y=D*D,J=Math.cos(p/2),oe=Math.sin(p/2),ce=2*J*oe,he=oe*oe,we=1-Y*J*J,Te=we?1/we:0,Pe=we?Math.acos(D*J)*Math.sqrt(1/we):0,He=.5*(2*Pe*D*oe+2*p/Math.PI)-a,Fe=.5*(Pe*U+g)-c,Ye=.5*Te*(Y*he+Pe*D*J*H)+1/Math.PI,tt=Te*(ce*q/4-Pe*U*oe),it=.125*Te*(q*oe-Pe*U*Y*ce),Tt=.5*Te*(H*J+Pe*he*D)+.5,ft=tt*it-Tt*Ye;C=(Fe*tt-He*Tt)/ft,I=(He*it-Fe*Ye)/ft,p=ve(p-C,-Math.PI,Math.PI),g=ve(g-I,-Y6,Y6)}while((Math.abs(C)>b||Math.abs(I)>b)&&--x>0);return new Q($o(p),$o(g))}}class J6 extends lm{constructor(a){super(a),this.center=a.center||[0,0],this.parallels=a.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(vn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){const{scale:p,cosPhi:g}=this;return{x:vn(a)*g*p+.5,y:-Math.sin(vn(c))/g*p+.5,z:0}}unproject(a,c){const{scale:p,cosPhi:g}=this,x=-(c-.5)/p,b=ve($o((a-.5)/p)/g,-180,180),C=Math.asin(ve(x*g,-1,1)),I=ve($o(C),-Ie,Ie);return new Q(b,I)}}class Mpe extends Z6{constructor(a){super(a),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(a,c,p){const g=H1(a,c,p);return Dt(g,g,JA(uh(p))),{x:g[0],y:g[1],z:g[2]}}locationPoint(a,c,p){const g=z(c.lat,c.lng),x=ke([],g),b=p?a._centerAltitude+p:a.elevation?a.elevation.getAtPointOrZero(a.locationCoordinate(c),a._centerAltitude):a._centerAltitude;Xe(g,g,x,Ee(1,0)*rr*b);const C=N(new Float64Array(16));return M(C,a.pixelMatrix,a.globeMatrix),Dt(g,g,C),new at(g[0],g[1])}pixelsPerMeter(a,c){return Ee(1,0)*c}pixelSpaceConversion(a,c,p){const g=Ee(1,a)*c,x=Kr(Ee(1,45)*c,g,p);return this.pixelsPerMeter(a,c)/x}createTileMatrix(a,c,p){const g=IR(uh(p.canonical));return M(new Float64Array(16),a.globeMatrix,g)}createInversionMatrix(a,c){const{center:p}=a,g=JA(uh(c));return W(g,g,vn(p.lng)),$(g,g,vn(p.lat)),B(g,g,[a._pixelsPerMercatorPixel,a._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(a,c,p,g){return wU(a,c,p,!0)||new ut(0,0)}pointCoordinate3D(a,c,p){const g=this.pointCoordinate(a,c,p,0);return[g.x,g.y,g.z]}isPointAboveHorizon(a,c){return!wU(a,c.x,c.y,!1)}farthestPixelDistance(a){const c=function(g,x){const b=g.cameraToCenterDistance,C=g._centerAltitude*x,I=g._camera,D=g._camera.forward(),U=xe([],Oe([],D,-b),[0,0,C]),q=g.worldSize/(2*Math.PI),H=[0,0,-q],Y=g.width/g.height,J=Math.tan(g.fovAboveCenter),oe=Oe([],I.up(),J),ce=Oe([],I.right(),J*Y),he=ke([],xe([],xe([],D,oe),ce)),we=[];let Te;if(new dn(U,he).closestPointOnSphere(H,q,we)){const Pe=xe([],we,H),He=jt([],Pe,U);Te=Math.cos(g.fovAboveCenter)*be(He)}else{const Pe=jt([],U,H),He=jt([],H,U);ke(He,He);const Fe=be(Pe)-q;Te=Math.sqrt(Fe*(Fe+2*q));const Ye=Math.acos(Te/(q+Fe))-Math.acos(st(D,He));Te*=Math.cos(Ye)}return 1.01*Te}(a,this.pixelsPerMeter(a.center.lat,a.worldSize)),p=im(a.zoom);if(p>0){const g=W6(a,Ee(1,a.center.lat)*a.worldSize),x=a.worldSize/(2*Math.PI),b=Math.max(a.width,a.height)/a.worldSize*Math.PI;return Kr(c,g+x*(1-Math.cos(b)),Math.pow(p,10))}return c}upVector(a,c,p){return H1(c,p,a,1)}upVectorScale(a){return{metersToTile:ZA(YA(uh(a)))}}}function Q6(u){const a=u.parallels,c=!!a&&Math.abs(a[0]+a[1])<.01;switch(u.name){case"mercator":return new Z6(u);case"equirectangular":return new kpe(u);case"naturalEarth":return new Ipe(u);case"equalEarth":return new Ope(u);case"winkelTripel":return new Rpe(u);case"albers":return c?new J6(u):new Ppe(u);case"lambertConformalConic":return c?new J6(u):new Npe(u);case"globe":return new Mpe(u)}throw new Error(`Invalid projection name: ${u.name}`)}const Dpe=$t.types,Lpe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bS(u,a,c,p,g,x,b,C,I,D,U,q,H){const Y=C?Math.min(jf,Math.round(C[0])):0,J=C?Math.min(jf,Math.round(C[1])):0;u.emplaceBack(a,c,Math.round(32*p),Math.round(32*g),x,b,(Y<<1)+(I?1:0),0+(J<<1),16*D,16*U,256*q,256*H)}function wS(u,a,c){u.emplaceBack(a,c)}function SS(u,a,c,p,g,x,b){u.emplaceBack(a,c,p,g,x,b)}const PC=(u,a,c,p)=>{for(let g=0;g<a;g++)u.emplaceBack(c[0],c[1],c[2],p[0],p[1],p[2])};function Ax(u,a,c,p,g){u.emplaceBack(a,c,p,g),u.emplaceBack(a,c,p,g),u.emplaceBack(a,c,p,g),u.emplaceBack(a,c,p,g)}function Fpe(u){for(const a of u.sections)if(gR(a.text))return!0;return!1}class jM{constructor(a){this.layoutVertexArray=new ex,this.indexArray=new is,this.programConfigurations=a,this.segments=new ds,this.dynamicLayoutVertexArray=new lh,this.opacityVertexArray=new P1,this.placedSymbolArray=new yy,this.iconTransitioningVertexArray=new Oc,this.globeExtVertexArray=new Zp,this.zOffsetVertexArray=new hd,this.orientationVertexArray=new N1,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(a,c){const p=[],g=this.layoutVertexArray.uint16;for(let x=0;x<c;++x){const b=12*(a+x);p.push(...g.slice(b,b+12))}return p}updateIconVertexData(a,c,p,g,x,b,C,I,D,U,q,H,Y){const J=this.layoutVertexArray.uint16,oe=12*a;J[oe]=c,J[oe+1]=p,J[oe+2]=g,J[oe+3]=x,J[oe+4]=b,J[oe+5]=C,J[oe+6]=I,J[oe+7]=D,J[oe+8]=U,J[oe+9]=q,J[oe+10]=H,J[oe+11]=Y}upload(a,c,p,g,x,b){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ufe.members,!!b),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,qfe.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Lpe,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=a.createVertexBuffer(this.iconTransitioningVertexArray,Wfe.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,Vfe.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||x)&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,Hfe.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=a.createVertexBuffer(this.orientationVertexArray,Gfe.members,!0)),this.opacityVertexBuffer.itemSize=1),(p||g)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}_r(jM,"SymbolBuffers");class PM{constructor(a,c,p){this.layoutVertexArray=new a,this.layoutAttributes=c,this.indexArray=new p,this.segments=new ds,this.collisionVertexArray=new Yp,this.collisionVertexArrayExt=new lh}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Kfe.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,Zfe.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_r(PM,"CollisionBuffers");class OC{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(b=>b.fqid),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=N([]),this.placementViewportMatrix=N([]);const c=this.layers[0]._unevaluatedLayout._values;this.worldview=a.worldview,this.textSizeData=bx(this.zoom,c["text-size"],this.worldview),this.iconSizeData=bx(this.zoom,c["icon-size"],this.worldview);const p=this.layers[0].layout,g=p.get("symbol-sort-key"),x=p.get("symbol-z-order");this.lut=a.lut,this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=p.get("text-writing-mode").map(b=>tc[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=a.sourceID,this.projection=a.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(a){const c=this.layers[0].getAppearances();return!(!c||c.length===0)&&c.some(p=>p.getProperty(a)!=null)}createArrays(){this.text=new jM(new tu(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("text")||a.startsWith("symbol"))),this.icon=new jM(new tu(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("icon")||a.startsWith("symbol"))),this.glyphOffsetArray=new z1,this.lineVertexArray=new zA,this.symbolInstances=new FA}calculateGlyphDependencies(a,c,p,g,x){for(const b of a){const C=b.codePointAt(0);if(C===void 0)break;if(c[C]=!0,g&&x&&C<=65535){const I=uS[b];I&&(c[I.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(a,c,p,g,x,b){let C=1;const I=a.getUnevaluatedProperties()._values["icon-size"],D=bx(this.zoom,I,this.worldview),U=wx(D,c);if(D.kind!=="constant"&&D.kind!=="camera"||(C=U.uSize),D.kind==="composite"){const{minZoom:q,maxZoom:H}=D,Y=I.possiblyEvaluate(new Ui(q,{worldview:this.worldview}),g),J=I.possiblyEvaluate(new Ui(H,{worldview:this.worldview}),g),oe=Y.evaluate(p,{},g,x);C=oe+(J.evaluate(p,{},g,x)-oe)*U.uSizeT}return D.kind==="source"&&(C=I.possiblyEvaluate(new Ui(this.zoom,{worldview:this.worldview}),g).evaluate(p,{},g,x)),C*b}updateFootprints(a,c){}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);return!iC(this.activeReplacements,p)&&(this.activeReplacements=p,!0)}getResolvedImageFromTokens(a){return typeof a=="string"?vl.build(a):a}populate(a,c,p,g){const x=this.layers[0],b=x.layout,C=this.projection.name==="globe",I=b.get("text-font"),D=b.get("text-field"),U=b.get("icon-image"),[q,H]=b.get("icon-size-scale-range"),Y=ve(c.scaleFactor||1,q,H),J=(D.value.kind!=="constant"||D.value.value instanceof ka&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),oe=U.value.kind!=="constant"||!!U.value.value||Object.keys(U.parameters).length>0,ce=this.hasAnyAppearanceProperty("icon-image"),he=b.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!J&&!oe&&!ce)return;const we=c.iconDependencies,Te=c.glyphDependencies,Pe=c.availableImages,He=new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),Fe=Ye=>{const tt=Ye.id.toString();we.has(tt)?we.get(tt).push(Ye):we.set(tt,[Ye])};for(const Ye of a){const{feature:tt,id:it,index:Tt,sourceLayerIndex:ft}=Ye,At=x._featureFilter.needGeometry,Rt=yt(tt,At);if(!x._featureFilter.filter(He,Rt,p))continue;if(At||(Rt.geometry=Nt(tt,p,g)),C&&tt.type!==1&&p.z<=5){const Vt=Rt.geometry,Yt=.98078528056,Ft=(gr,br)=>st(H1(gr.x,gr.y,p,1),H1(br.x,br.y,p,1))<Yt;for(let gr=0;gr<Vt.length;gr++)Vt[gr]=kt(Vt[gr],Ft)}let Bt,er;if(J){const Vt=x.getValueAndResolveTokens("text-field",Rt,p,Pe),Yt=ka.factory(Vt);Fpe(Yt)&&(this.hasRTLText=!0),(!this.hasRTLText||x1()==="unavailable"||this.hasRTLText&&Il.isParsed())&&(Bt=Yfe(Yt,x,Rt))}if(oe){const Vt=x.getValueAndResolveTokens("icon-image",Rt,p,Pe);er=this.getResolvedImageFromTokens(Vt)}const Wt=this.layers[0];let Lt=!1;if(!er&&ce){const Vt=Wt.getAppearances();for(const Yt of Vt)if(Yt.getProperty("icon-image")){const Ft=Wt.getAppearanceValueAndResolveTokens(Yt,"icon-image",Rt,p,Pe);if(Ft){er=this.getResolvedImageFromTokens(Ft),Lt=!0;break}}}if(!Bt&&!er)continue;const Gt=this.sortFeaturesByKey?he.evaluate(Rt,{},p):void 0,wt={id:it,text:Bt,icon:er,index:Tt,sourceLayerIndex:ft,geometry:Rt.geometry,properties:tt.properties,type:Dpe[tt.type],sortKey:Gt};if(this.features.push(wt),this.appearanceFeatureData.push({id:it,properties:tt.properties,usesAppearanceIconAsPlaceholder:Lt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),er){const Vt=Wt._unevaluatedLayout._values,{iconPrimary:Yt,iconSecondary:Ft}=pS(er,this.iconSizeData,Vt["icon-size"],p,this.zoom,wt,this.pixelRatio,Y,this.worldview);Fe(Yt),Ft&&(this.hasAnySecondaryIcon=!0,Fe(Ft))}const xt=Wt.getAppearances();if(xt.length!==0&&xt.forEach(Vt=>{if(!Vt.getProperty("icon-image"))return;const Yt=this.getCombinedIconPrimary(Vt,Wt,Rt,p,Pe,wt,Y);Yt&&Fe(Yt)}),Bt){const Vt=I.evaluate(Rt,{},p).join(","),Yt=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tc.vertical)>=0;for(const Ft of Bt.sections)if(Ft.image){const gr=Ft.image.getPrimary().scaleSelf(this.pixelRatio),br=gr.id.toString(),hr=we.get(br)||[];hr.push(gr),we.set(br,hr)}else{const gr=p1(Bt.toString()),br=Ft.fontStack||Vt,hr=Te[br]=Te[br]||{};this.calculateGlyphDependencies(Ft.text,hr,Yt,this.allowVerticalPlacement,gr)}}}if(b.get("symbol-placement")==="line"&&(this.features=function(Ye){const tt={},it={},Tt=[];let ft=0;function At(Wt){Tt.push(Ye[Wt]),ft++}function Rt(Wt,Lt,Gt){const wt=it[Wt];return delete it[Wt],it[Lt]=wt,Tt[wt].geometry[0].pop(),Tt[wt].geometry[0]=Tt[wt].geometry[0].concat(Gt[0]),wt}function Bt(Wt,Lt,Gt){const wt=tt[Lt];return delete tt[Lt],tt[Wt]=wt,Tt[wt].geometry[0].shift(),Tt[wt].geometry[0]=Gt[0].concat(Tt[wt].geometry[0]),wt}function er(Wt,Lt,Gt){const wt=Gt?Lt[0][Lt[0].length-1]:Lt[0][0];return`${Wt}:${wt.x}:${wt.y}`}for(let Wt=0;Wt<Ye.length;Wt++){const Lt=Ye[Wt],Gt=Lt.geometry,wt=Lt.text?Lt.text.toString():null;if(!wt){At(Wt);continue}const xt=er(wt,Gt),Vt=er(wt,Gt,!0);if(xt in it&&Vt in tt&&it[xt]!==tt[Vt]){const Yt=Bt(xt,Vt,Gt),Ft=Rt(xt,Vt,Tt[Yt].geometry);delete tt[xt],delete it[Vt],it[er(wt,Tt[Ft].geometry,!0)]=Ft,Tt[Yt].geometry=null}else xt in it?Rt(xt,Vt,Gt):Vt in tt?Bt(xt,Vt,Gt):(At(Wt),tt[xt]=ft-1,it[Vt]=ft-1)}return Tt.filter(Wt=>Wt.geometry)}(this.features)),b.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ye of c.elevationFeatures)this.elevationFeatureIdToIndex.set(Ye.id,this.elevationFeatures.length),this.elevationFeatures.push(Ye)}}else b.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ye,tt)=>Ye.sortKey-tt.sortKey)}getCombinedIconPrimary(a,c,p,g,x,b,C){let I,D;const U=a.getUnevaluatedProperties();if(U._values["icon-image"].value!==void 0){const q=c.getAppearanceValueAndResolveTokens(a,"icon-image",p,g,x);I=this.getResolvedImageFromTokens(q)}else{const q=c.getValueAndResolveTokens("icon-image",p,g,x);I=this.getResolvedImageFromTokens(q)}if(I){const q=U._values["icon-size"]||c._unevaluatedLayout._values["icon-size"];D=pS(I,bx(this.zoom,q,this.worldview),q,g,this.zoom,b,this.pixelRatio,C,this.worldview).iconPrimary}return D}updateAppearanceBasedIconTextures(a,c,p,g){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const x=this.layers[0];let b=!1,C=0;const I=x.layout,[D,U]=I.get("icon-size-scale-range"),q=ve(1,D,U);for(let H=0;H<this.symbolInstances.length;H++){const Y=this.symbolInstances.get(H),J=this.appearanceFeatureData[Y.featureIndex];if(J&&Y.placedIconSymbolIndex>=0){const oe=J.id,ce=c&&oe!==void 0?c[String(oe)]:void 0,he={type:"Point",id:J.id,properties:J.properties,geometry:[]},we=this.layers[0].appearances&&this.layers[0].appearances.find(Te=>Te.isActive({globals:g,feature:he,canonical:a,featureState:ce}));if(J.activeAppearance===we)continue;if(we){J.activeAppearance=we;const Te={sortKey:void 0,text:void 0,icon:null,index:Y.featureIndex,sourceLayerIndex:Y.featureIndex,geometry:[],properties:J.properties,type:"Point",id:J.id};if(!we.hasCachedIconPrimary()){const Ye=this.getCombinedIconPrimary(we,x,he,a,p,Te,q);we.setCachedIconPrimary(Ye)}const Pe=we.getCachedIconPrimary();if(!Pe)continue;const He=Pe.toString(),Fe=this.iconAtlasPositions&&this.iconAtlasPositions.get(He);if(Fe){const Ye=x.getAppearanceValueAndResolveTokens(we,"icon-offset",he,a,p),tt=Ye&&Array.isArray(Ye)?Ye:[0,0];let it=xC(Fe,void 0,tt,x.layout.get("icon-anchor").evaluate(he,{},a));const Tt=x.getAppearanceValueAndResolveTokens(we,"icon-rotate",he,a,p),ft=typeof Tt=="number"?Tt:0,At=Fe.sdf,Rt=x.layout.get("icon-text-fit").constantOr("none");Rt!=="none"&&J.textShaping&&J.iconTextFitPadding&&J.fontScale&&(it=_M(it,J.textShaping,Rt,J.iconTextFitPadding,tt,J.fontScale));const Bt=this.calculateEffectiveAppearanceIconSize(we,g.zoom,he,a,p,q),er=0,Wt=1+(Math.min(jf,Math.round(Bt*yd))<<1),Lt=SM(it,ft,At,Rt!=="none",q);J.isUsingAppearanceVertexData||(J.isUsingAppearanceVertexData=!0,J.layoutBasedVertexData=this.icon.getIconVertexData(C,Y.numIconVertices));for(let wt=0;wt<Lt.length;++wt){const xt=Lt[wt],Vt=J.layoutBasedVertexData[0]||Y.tileAnchorX,Yt=J.layoutBasedVertexData[1]||Y.tileAnchorY,Ft=16*xt.pixelOffsetTL.x,gr=16*xt.pixelOffsetTL.y,br=16*xt.pixelOffsetBR.x,hr=16*xt.pixelOffsetBR.y,ar=16*xt.minFontScaleX,en=16*xt.minFontScaleY;this.icon.updateIconVertexData(C,Vt,Yt,Math.round(32*xt.tl.x),Math.round(32*xt.tl.y),xt.texPrimary.x,xt.texPrimary.y,er,Wt,Ft,gr,ar,en),this.icon.updateIconVertexData(C+1,Vt,Yt,Math.round(32*xt.tr.x),Math.round(32*xt.tr.y),xt.texPrimary.x+xt.texPrimary.w,xt.texPrimary.y,er,Wt,br,gr,ar,en),this.icon.updateIconVertexData(C+2,Vt,Yt,Math.round(32*xt.bl.x),Math.round(32*xt.bl.y),xt.texPrimary.x,xt.texPrimary.y+xt.texPrimary.h,er,Wt,Ft,hr,ar,en),this.icon.updateIconVertexData(C+3,Vt,Yt,Math.round(32*xt.br.x),Math.round(32*xt.br.y),xt.texPrimary.x+xt.texPrimary.w,xt.texPrimary.y+xt.texPrimary.h,er,Wt,br,hr,ar,en),C+=4}const Gt=Y.numIconVertices-4*Lt.length;for(let wt=0;wt<Gt;++wt)this.icon.updateIconVertexData(C+wt,0,0,0,0,0,0,0,0,0,0,0,0);b=!0}else C+=Y.numIconVertices}else if(J.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(C,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+3,0,0,0,0,0,0,0,0,0,0,0,0),b=!0),C+=Y.numIconVertices,J.activeAppearance=null;else if(J.isUsingAppearanceVertexData){const Pe=J.layoutBasedVertexData.length/12;for(let He=0;He<Pe;++He){const Fe=He*12;this.icon.updateIconVertexData(C+He,J.layoutBasedVertexData[Fe+0],J.layoutBasedVertexData[Fe+1],J.layoutBasedVertexData[Fe+2],J.layoutBasedVertexData[Fe+3],J.layoutBasedVertexData[Fe+4],J.layoutBasedVertexData[Fe+5],J.layoutBasedVertexData[Fe+6],J.layoutBasedVertexData[Fe+7],J.layoutBasedVertexData[Fe+8],J.layoutBasedVertexData[Fe+9],J.layoutBasedVertexData[Fe+10],J.layoutBasedVertexData[Fe+11])}C+=Pe,J.isUsingAppearanceVertexData=!1,J.activeAppearance=null,b=!0}else C+=Y.numIconVertices,J.activeAppearance=null}}return b}update(a,c,p,g,x,b,C){this.text.programConfigurations.updatePaintArrays(a,c,x,p,g,b,C,this.worldview),this.icon.programConfigurations.updatePaintArrays(a,c,x,p,g,b,C,this.worldview)}updateRoadElevation(a){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let c=!1;const p=Ze(a),g=1/p;let x=!1,b=!1;for(let C=0;C<this.symbolInstances.length;C++){const I=this.symbolInstances.get(C),D=Se(1,0,0),U=Se(0,1,0),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:H,numIconVertices:Y,numVerticalIconVertices:J}=I,oe=q>0||H>0,ce=Y>0,he=this.elevationFeatures[I.elevationFeatureIndex];if(he){const we=new at(I.tileAnchorX,I.tileAnchorY),Te=.075+he.pointElevation(we);I.zOffset!==Te&&(c=!0,I.zOffset=Te),Te!==0&&(this.hasAnyZOffset=!0);const Pe=he.computeSlopeNormal(we,g),He=_s(Ht(),Se(0,0,1),Pe);ir(D,D,He),ir(U,U,He),D[2]*=p,U[2]*=p,D[0]===1&&D[1]===0&&D[2]===0&&U[0]===0&&U[1]===1&&U[2]===0||(x=x||oe,b=b||ce)}if(oe&&(PC(this.text.orientationVertexArray,q,D,U),PC(this.text.orientationVertexArray,H,D,U)),ce){const{placedIconSymbolIndex:we,verticalPlacedIconSymbolIndex:Te}=I;we>=0&&PC(this.icon.orientationVertexArray,Y,D,U),Te>=0&&PC(this.icon.orientationVertexArray,J,D,U)}}x||(this.text.orientationVertexArray=void 0),b||(this.icon.orientationVertexArray=void 0),c&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const a=(x,b,C)=>{p+=b,p>x.length&&x.resize(p);for(let I=-b;I<0;I++)x.emplace(I+p,C)},c=(x,b,C)=>{g+=b,g>x.length&&x.resize(g);for(let I=-b;I<0;I++)x.emplace(I+g,C)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let p=0,g=0;for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:I,numIconVertices:D}=b,U=b.zOffset,q=D>0;if((C>0||I>0)&&(a(this.text.zOffsetVertexArray,C,U),a(this.text.zOffsetVertexArray,I,U)),q){const{placedIconSymbolIndex:H,verticalPlacedIconSymbolIndex:Y}=b;H>=0&&c(this.icon.zOffsetVertexArray,D,U),Y>=0&&c(this.icon.zOffsetVertexArray,b.numVerticalIconVertices,U)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a,c,p,g,x){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(b=>b.appearances&&b.appearances.length>0)),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(a,c,p,g){return!!(a&&c&&p)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(a,c,p,g)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Q6(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,c){const p=this.lineVertexArray.length;if(a.segment!==void 0)for(const{x:g,y:x}of c)this.lineVertexArray.emplaceBack(g,x);return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe,ce,he,we){const Te=a.indexArray,Pe=a.layoutVertexArray,He=a.globeExtVertexArray,Fe=a.segments.prepareSegment(4*we,Pe,Te,this.canOverlap?b.sortKey:void 0),Ye=this.glyphOffsetArray.length,tt=Fe.vertexLength,it=this.allowVerticalPlacement&&C===tc.vertical?Math.PI/2:0,Tt=b.text&&b.text.sections;for(let Rt=0;Rt<c.length;Rt++){const{tl:Bt,tr:er,bl:Wt,br:Lt,texPrimary:Gt,texSecondary:wt,pixelOffsetTL:xt,pixelOffsetBR:Vt,minFontScaleX:Yt,minFontScaleY:Ft,glyphOffset:gr,isSDF:br,sectionIndex:hr}=c[Rt],ar=Fe.vertexLength,en=gr[1];if(bS(Pe,D.x,D.y,Bt.x,en+Bt.y,Gt.x,Gt.y,p,br,xt.x,xt.y,Yt,Ft),bS(Pe,D.x,D.y,er.x,en+er.y,Gt.x+Gt.w,Gt.y,p,br,Vt.x,xt.y,Yt,Ft),bS(Pe,D.x,D.y,Wt.x,en+Wt.y,Gt.x,Gt.y+Gt.h,p,br,xt.x,Vt.y,Yt,Ft),bS(Pe,D.x,D.y,Lt.x,en+Lt.y,Gt.x+Gt.w,Gt.y+Gt.h,p,br,Vt.x,Vt.y,Yt,Ft),I){const{x:lr,y:Lr,z:nn}=I.anchor,[wn,Vn,an]=I.up;SS(He,lr,Lr,nn,wn,Vn,an),SS(He,lr,Lr,nn,wn,Vn,an),SS(He,lr,Lr,nn,wn,Vn,an),SS(He,lr,Lr,nn,wn,Vn,an),Ax(a.dynamicLayoutVertexArray,lr,Lr,nn,it)}else Ax(a.dynamicLayoutVertexArray,D.x,D.y,D.z,it);if(ce){const lr=wt||Gt;wS(a.iconTransitioningVertexArray,lr.x,lr.y),wS(a.iconTransitioningVertexArray,lr.x+lr.w,lr.y),wS(a.iconTransitioningVertexArray,lr.x,lr.y+lr.h),wS(a.iconTransitioningVertexArray,lr.x+lr.w,lr.y+lr.h)}Te.emplaceBack(ar,ar+1,ar+2),Te.emplaceBack(ar+1,ar+2,ar+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gr[0]),Rt!==c.length-1&&hr===c[Rt+1].sectionIndex||a.programConfigurations.populatePaintArrays(Pe.length,b,b.index,{},Y,J,oe,Tt&&Tt[hr],this.worldview)}const ft=we-c.length;ft!==0&&this._addNullVertices(ft,Pe,p,I,He,a,ce,Fe,Te);const At=I?I.anchor:D;a.placedSymbolArray.emplaceBack(At.x,At.y,At.z,D.x,D.y,Ye,this.glyphOffsetArray.length-Ye,tt,U,q,D.segment,p?p[0]:0,p?p[1]:0,g[0],g[1],C,0,0,0,H,0),a.symbolInstanceIndices.push(he)}_addNullVertices(a,c,p,g,x,b,C,I,D){for(let U=0;U<a;U++){for(let H=0;H<4;H++)bS(c,0,0,0,0,0,0,p,!1,0,0,0,0),g&&SS(x,0,0,0,0,0,0),Ax(b.dynamicLayoutVertexArray,0,0,0,0),C&&wS(b.iconTransitioningVertexArray,0,0);const q=I.vertexLength;D.emplaceBack(q,q+1,q+2),D.emplaceBack(q+1,q+2,q+3),I.vertexLength+=4,I.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(a,c,p,g,x,b,C){a.emplaceBack(c,p,g,x,b,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(a,c,p,g,x,b,C){const I=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),D=I.vertexLength,U=C.tileAnchorX,q=C.tileAnchorY;for(let Y=0;Y<4;Y++)p.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(p.collisionVertexArrayExt,c,a.padding,C.zOffset),this._commitLayoutVertex(p.layoutVertexArray,g,x,b,U,q,new at(a.x1,a.y1)),this._commitLayoutVertex(p.layoutVertexArray,g,x,b,U,q,new at(a.x2,a.y1)),this._commitLayoutVertex(p.layoutVertexArray,g,x,b,U,q,new at(a.x2,a.y2)),this._commitLayoutVertex(p.layoutVertexArray,g,x,b,U,q,new at(a.x1,a.y2)),I.vertexLength+=4;const H=p.indexArray;H.emplaceBack(D,D+1),H.emplaceBack(D+1,D+2),H.emplaceBack(D+2,D+3),H.emplaceBack(D+3,D),I.primitiveLength+=4}_addTextDebugCollisionBoxes(a,c,p,g,x,b){for(let C=g;C<x;C++){const I=p.get(C),D=this.getSymbolInstanceTextSize(a,b,c,C);this._addCollisionDebugVertices(I,D,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(a,c,p,g,x,b){for(let C=g;C<x;C++){const I=p.get(C),D=this.getSymbolInstanceIconSize(a,c,b.placedIconSymbolIndex);this._addCollisionDebugVertices(I,D,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,b)}}generateCollisionDebugBuffers(a,c,p){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new PM(tx,g6.members,Oc),this.iconCollisionBox=new PM(tx,g6.members,Oc);const g=wx(this.iconSizeData,a),x=wx(this.textSizeData,a,p);for(let b=0;b<this.symbolInstances.length;b++){const C=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(x,a,c,C.textBoxStartIndex,C.textBoxEndIndex,C),this._addTextDebugCollisionBoxes(x,a,c,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._addIconDebugCollisionBoxes(g,a,c,C.iconBoxStartIndex,C.iconBoxEndIndex,C),this._addIconDebugCollisionBoxes(g,a,c,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C)}}getSymbolInstanceTextSize(a,c,p,g){const x=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:g),b=xM(this.textSizeData,a,x)/Xa;return this.tilePixelRatio*b}getSymbolInstanceIconSize(a,c,p){const g=this.icon.placedSymbolArray.get(p),x=xM(this.iconSizeData,a,g);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(a,c,p,g){a.emplaceBack(c,-p,-p,g),a.emplaceBack(c,p,-p,g),a.emplaceBack(c,p,p,g),a.emplaceBack(c,-p,p,g)}_updateTextDebugCollisionBoxes(a,c,p,g,x,b,C){for(let I=g;I<x;I++){const D=p.get(I),U=this.getSymbolInstanceTextSize(a,b,c,I);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,U,D.padding,b.zOffset)}}_updateIconDebugCollisionBoxes(a,c,p,g,x,b,C){for(let I=g;I<x;I++){const D=p.get(I),U=this.getSymbolInstanceIconSize(a,c,b.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,U,D.padding,b.zOffset)}}updateCollisionDebugBuffers(a,c,p,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const x=wx(this.iconSizeData,a,g),b=wx(this.textSizeData,a,p);for(let C=0;C<this.symbolInstances.length;C++){const I=this.symbolInstances.get(C);this._updateTextDebugCollisionBoxes(b,a,c,I.textBoxStartIndex,I.textBoxEndIndex,I,p),this._updateTextDebugCollisionBoxes(b,a,c,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I,p),this._updateIconDebugCollisionBoxes(x,a,c,I.iconBoxStartIndex,I.iconBoxEndIndex,I,g),this._updateIconDebugCollisionBoxes(x,a,c,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,c,p,g,x,b,C,I,D){const U={};if(c<p){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe,featureIndex:He}=a.get(c);U.textBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe},U.textFeatureIndex=He}if(g<x){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe,featureIndex:He}=a.get(g);U.verticalTextBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe},U.verticalTextFeatureIndex=He}if(b<C){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe,featureIndex:He}=a.get(b);U.iconBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe},U.iconFeatureIndex=He}if(I<D){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe,featureIndex:He}=a.get(I);U.verticalIconBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Pe},U.verticalIconFeatureIndex=He}return U}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const p=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(a,c){const p=a.placedSymbolArray.get(c),g=p.vertexStartIndex+4*p.numGlyphs;for(let x=p.vertexStartIndex;x<g;x+=4)a.indexArray.emplaceBack(x,x+1,x+2),a.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(a),p=Math.cos(a),g=[],x=[],b=[];for(let C=0;C<this.symbolInstances.length;++C){b.push(C);const I=this.symbolInstances.get(C);g.push(0|Math.round(c*I.tileAnchorX+p*I.tileAnchorY)),x.push(I.featureIndex)}return b.sort((C,I)=>g[C]-g[I]||x[I]-x[C]),b}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let a=0;a<this.symbolInstances.length;++a)this.symbolInstanceIndexesSortedZOffset.push(a)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((a,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(a).zOffset)}addToSortKeyRanges(a,c){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===c?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const p=this.symbolInstances.get(c);this.featureSortOrder.push(p.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:D}=p;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&x!==g&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&b!==x&&b!==g&&this.addIndicesForPlacedSymbol(this.text,b),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(a){const c=this.symbolInstances.get(this.text.symbolInstanceIndices[a]).elevationFeatureIndex;let p;return this.elevationFeatures&&c<this.elevationFeatures.length&&(p=this.elevationFeatures[c]),p}}function e8(u,a){return a.replace(/{([^{}]+)}/g,(c,p)=>p in u?String(u[p]):"")}let t8,r8,OM;_r(OC,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),OC.addDynamicAttributes=Ax;class n8{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Sp,this.defaultValue=a}evaluate(a){if(a.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(a.formattedSection))return c.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_r(n8,"FormatSectionOverride",{omit:["defaultValue"]});const kM=()=>OM||(OM={layout:t8||(t8=new bs({"symbol-placement":new Zt(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Zt(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Zt(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ur(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Zt(ht.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Zt(ht.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Zt(ht.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Zt(ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Zt(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Zt(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Zt(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new ur(ht.layout_symbol["icon-size"]),"icon-size-scale-range":new Zt(ht.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ur(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ur(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new ur(ht.layout_symbol["icon-image"]),"icon-image-use-theme":new Zt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new ur(ht.layout_symbol["icon-rotate"]),"icon-padding":new Zt(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Zt(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new ur(ht.layout_symbol["icon-offset"]),"icon-anchor":new ur(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Zt(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Zt(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Zt(ht.layout_symbol["text-rotation-alignment"]),"text-field":new ur(ht.layout_symbol["text-field"]),"text-font":new ur(ht.layout_symbol["text-font"]),"text-size":new ur(ht.layout_symbol["text-size"]),"text-size-scale-range":new Zt(ht.layout_symbol["text-size-scale-range"]),"text-max-width":new ur(ht.layout_symbol["text-max-width"]),"text-line-height":new ur(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new ur(ht.layout_symbol["text-letter-spacing"]),"text-justify":new ur(ht.layout_symbol["text-justify"]),"text-radial-offset":new ur(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Zt(ht.layout_symbol["text-variable-anchor"]),"text-anchor":new ur(ht.layout_symbol["text-anchor"]),"text-max-angle":new Zt(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Zt(ht.layout_symbol["text-writing-mode"]),"text-rotate":new ur(ht.layout_symbol["text-rotate"]),"text-padding":new Zt(ht.layout_symbol["text-padding"]),"text-keep-upright":new Zt(ht.layout_symbol["text-keep-upright"]),"text-transform":new ur(ht.layout_symbol["text-transform"]),"text-offset":new ur(ht.layout_symbol["text-offset"]),"text-allow-overlap":new Zt(ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Zt(ht.layout_symbol["text-ignore-placement"]),"text-optional":new Zt(ht.layout_symbol["text-optional"]),visibility:new Zt(ht.layout_symbol.visibility)})),paint:r8||(r8=new bs({"icon-opacity":new ur(ht.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ur(ht.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ur(ht.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ur(ht.paint_symbol["text-emissive-strength"]),"icon-color":new ur(ht.paint_symbol["icon-color"]),"icon-halo-color":new ur(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new ur(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ur(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Zt(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Zt(ht.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Zt(ht.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ur(ht.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ur(ht.paint_symbol["text-occlusion-opacity"]),"text-color":new ur(ht.paint_symbol["text-color"],{runtimeType:kl,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new ur(ht.paint_symbol["text-halo-color"]),"text-halo-width":new ur(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new ur(ht.paint_symbol["text-halo-blur"]),"text-translate":new Zt(ht.paint_symbol["text-translate"]),"text-translate-anchor":new Zt(ht.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Zt(ht.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Zt(ht.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Zt(ht.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Zt(ht.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ur(ht.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},OM);class kC extends qo{constructor(a,c,p,g){super(a,kM(),c,p,g,a.layout?a.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=N([]),this.hasOcclusionOpacityProperties=a.paint!==void 0&&("icon-occlusion-opacity"in a.paint||"text-occlusion-opacity"in a.paint)}_handleSpecialPaintPropertyUpdate(a){a!=="icon-occlusion-opacity"&&a!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(a,c){super.recalculate(a,c),this.appearances&&this.appearances.forEach(g=>{g.recalculate(a,c,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const p=this.layout.get("text-writing-mode");if(p){const g=[];for(const x of p)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(a,c,p,g){return this._saturation===a&&this._contrast===c&&this._brightnessMin===p&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(x,b,C,I){x=ms(x),b=Yi(b);const D=O(),U=x/3,q=1-2*U,H=[q,U,U,0,U,q,U,0,U,U,q,0,0,0,0,1],Y=.5-.5*b,J=I-C;return M(D,[J,0,0,0,0,J,0,0,0,0,J,0,C,C,C,1],[b,0,0,0,0,b,0,0,0,0,b,0,Y,Y,Y,1]),M(D,D,H),D}(a,c,p,g),this._saturation=a,this._contrast=c,this._brightnessMin=p,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(a,c,p,g){const x=this.layout.get(a).evaluate(c,{},p,g),b=this._unevaluatedLayout._values[a];return b.isDataDriven()||U_(b.value)||!x?x:e8(c.properties,x)}getAppearanceValueAndResolveTokens(a,c,p,g,x){const b=a.getProperty(c);if(!b)return;const C=b.evaluate(p,{},g,x),I=a.getUnevaluatedProperties()._values[c];return I.isDataDriven()||U_(I.value)||!C||typeof C!="string"?C:e8(p.properties,C)}createBucket(a){return new OC(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of kM().paint.overridableProperties){if(!kC.hasPaintOverride(this.layout,a))continue;const c=this.paint.get(a),p=new n8(c),g=new $_(p,c.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let x=null;x=c.value.kind==="constant"||c.value.kind==="source"?new dy("source",g):new nh("composite",g,c.value.zoomStops,c.value.interpolationType),this.paint._values[a]=new Pc(c.property,x,c.parameters)}}_handleOverridablePaintPropertyUpdate(a,c,p){return!(!this.layout||c.isDataDriven()||p.isDataDriven())&&kC.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,c){const p=a.get("text-field"),g=kM().paint.properties[c];let x=!1;const b=C=>{for(const I of C)if(g.overrides&&g.overrides.hasOverride(I))return void(x=!0)};if(p.value.kind==="constant"&&p.value.value instanceof ka)b(p.value.value.sections);else if(p.value.kind==="source"){const C=D=>{x||(D instanceof od&&ba(D.value)===uf?b(D.value.sections):D instanceof df?b(D.sections):D.eachChild(C))},I=p.value;I._styleExpression&&C(I._styleExpression.expression)}return x}getProgramIds(){return["symbol"]}getDefaultProgramParams(a,c,p){return{config:new pd(this,{zoom:c,lut:p}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let i8,s8,a8,o8;var NM=Cn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function NC(u,a,c,p,g,x,b,C){const I=[u,a,1,c,p,1,g,x,1],D=[b,C,1],U=T([],I),[q,H,Y]=It(D,D,U);return A(I,I,[q,0,0,0,H,0,0,0,Y])}function l8(u,a,c,p,g,x,b,C){const I=function(D,U,q,H,Y,J,oe,ce){const he=NC(0,0,1,0,1,1,0,1),we=NC(D,U,q,H,Y,J,oe,ce);return A(we,we,T([],he))}(u,a,c,p,g,x,b,C);return[I[2]/I[8]/rr,I[5]/I[8]/rr]}function IC(u){return[u[0],Math.min(Math.max(u[1],-Ie),Ie)]}class c8 extends id{constructor(a,c,p,g){super(),this.id=a,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=c,this._dirty=!1}load(a,c){if(this._loaded=c||!1,this.fire(new ql("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return a&&(this.coordinates=a),this._loaded=!0,void this._finishLoading();this._imageRequest=Iw(this.map._requestManager.transformRequest(this.url,of.Image),(p,g)=>{this._imageRequest=null,this._loaded=!0,p?this.fire(new qg(p)):g&&(this.image=g instanceof HTMLImageElement?Ol.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}setTexture(a){if(!(a.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new oS(this.map.painter.context,a.handle),this.width=a.dimensions[0],this.height=a.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ql("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(a){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof oS||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(a){if(this.coordinates=a,this._boundsArray=void 0,this._unsupportedCoords=!1,!a.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=a[0][1],p=a[0][1];for(const x of a)x[1]>p&&(p=x[1]),x[1]<c&&(c=x[1]);const g=(p+c)/2;if(g>Ie?this.onNorthPole=!0:g<-Ie&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const x=a.map(ut.fromLngLat);this.tileID=function(b){let C=1/0,I=1/0,D=-1/0,U=-1/0;for(const oe of b)C=Math.min(C,oe.x),I=Math.min(I,oe.y),D=Math.max(D,oe.x),U=Math.max(U,oe.y);const q=Math.max(D-C,U-I),H=Math.max(0,Math.floor(-Math.log2(q))),Y=Math.pow(2,H);let J=Math.floor((C+D)/2*Y);return J>1&&(J-=1),new Jl(H,J,Math.floor((I+U)/2*Y))}(x),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ql("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof oS||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(a){for(const he in this.tiles){const we=this.tiles[he];we.state!=="loaded"&&(we.state="loaded",we.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=gS(new Jl(0,0,0),this.map.transform.projection),p=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(he){const we=he[1].x-he[0].x,Te=he[1].y-he[0].y,Pe=he[2].x-he[1].x,He=he[2].y-he[1].y,Fe=he[3].x-he[2].x,Ye=he[3].y-he[2].y,tt=he[0].x-he[3].x,it=he[0].y-he[3].y,Tt=we*He-Pe*Te,ft=Pe*Ye-Fe*He,At=Fe*it-tt*Ye,Rt=tt*Te-we*it;return Tt>0&&ft>0&&At>0&&Rt>0||Tt<0&&ft<0&&At<0&&Rt<0}(p))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=gS(this.tileID,this.map.transform.projection),[x,b,C,I]=this.coordinates.map(he=>{const we=g.projection.project(he[0],he[1]);return K6(g,we)._round()});this.perspectiveTransform=l8(x.x,x.y,b.x,b.y,C.x,C.y,I.x,I.y);const D=this._boundsArray=new Kp;D.emplaceBack(x.x,x.y,0,0),D.emplaceBack(b.x,b.y,rr,0),D.emplaceBack(I.x,I.y,0,rr),D.emplaceBack(C.x,C.y,rr,rr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=a.createVertexBuffer(D,NM.members),this.boundsSegments=ds.simpleSegment(0,0,4,2);const U=[],q=[IC((H=this.coordinates)[0]),IC(H[1]),IC(H[2]),IC(H[3])];var H;const[Y,J,oe,ce]=function(he){let we=he[0][0],Te=we,Pe=he[0][1],He=Pe;for(let Fe=1;Fe<he.length;Fe++)he[Fe][0]<we?we=he[Fe][0]:he[Fe][0]>Te&&(Te=he[Fe][0]),he[Fe][1]<Pe?Pe=he[Fe][1]:he[Fe][1]>He&&(He=he[Fe][1]);return[we,Pe,Te-we,He-Pe]}(q);{const he=new Kp,[we,Te,Pe,He]=function(Lt){let Gt=Lt[0].x,wt=Gt,xt=Lt[0].y,Vt=xt;for(let Yt=1;Yt<Lt.length;Yt++)Lt[Yt].x<Gt?Gt=Lt[Yt].x:Lt[Yt].x>wt&&(wt=Lt[Yt].x),Lt[Yt].y<xt?xt=Lt[Yt].y:Lt[Yt].y>Vt&&(Vt=Lt[Yt].y);return[Gt,xt,wt-Gt,Vt-xt]}(p),Fe=Lt=>[(Lt.x-we)/Pe,(Lt.y-Te)/He],[Ye,tt,it,Tt]=p.map(Fe),ft=function(Lt,Gt,wt,xt,Vt,Yt,Ft,gr){const br=NC(0,0,1,0,1,1,0,1);return A(br,br,T([],NC(Lt,Gt,wt,xt,Vt,Yt,Ft,gr)))}(Ye[0],Ye[1],tt[0],tt[1],it[0],it[1],Tt[0],Tt[1]);this.elevatedGlobePerspectiveTransform=l8(Ye[0],Ye[1],tt[0],tt[1],it[0],it[1],Tt[0],Tt[1]);const At=(Lt,Gt)=>{U.push(Lt.lng);const wt=Math.round((Lt.lng-Y)/oe*rr),xt=Math.round((Lt.lat-J)/ce*rr),Vt=Fe(Gt),Yt=It([],[Vt[0],Vt[1],1],ft),Ft=Math.round(Yt[0]/Yt[2]*rr),gr=Math.round(Yt[1]/Yt[2]*rr);he.emplaceBack(wt,xt,Ft,gr)},Rt=p[3].x-p[0].x,Bt=p[3].y-p[0].y,er=p[2].x-p[1].x,Wt=p[2].y-p[1].y;for(let Lt=0;Lt<65;Lt++){const Gt=Lt/64,wt=[p[0].x+Gt*Rt,p[0].y+Gt*Bt],xt=[p[1].x+Gt*er,p[1].y+Gt*Wt],Vt=xt[0]-wt[0],Yt=xt[1]-wt[1];for(let Ft=0;Ft<65;Ft++){const gr=Ft/64,br={x:wt[0]+Vt*gr,y:wt[1]+Yt*gr};At(c.projection.unproject(br.x,br.y),br)}}this.elevatedGlobeVertexBuffer=a.createVertexBuffer(he,NM.members)}{this.maxLongitudeTriangleSize=0;let he=[],we=new is;const Te=(Pe,He,Fe)=>{we.emplaceBack(Pe,He,Fe);const Ye=U[Pe],tt=U[He],it=U[Fe],Tt=Math.min(Math.min(Ye,tt),it),ft=Math.max(Math.max(Ye,tt),it)-Tt;ft>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ft),he.push(Tt+ft/2)};for(let Pe=0;Pe<64;Pe++)for(let He=0;He<64;He++){const Fe=65*Pe+He,Ye=Fe+1,tt=Fe+65,it=tt+1;Te(Fe,tt,Ye),Te(Ye,tt,it)}[he,we]=function(Pe,He){const Fe=Array.from({length:Pe.length},(it,Tt)=>Tt);Fe.sort((it,Tt)=>Pe[it]-Pe[Tt]);const Ye=[],tt=new is;for(let it=0;it<Fe.length;it++){const Tt=Fe[it];Ye.push(Pe[Tt]);const ft=3*Tt,At=ft+1;tt.emplaceBack(He.uint16[ft],He.uint16[At],He.uint16[At+1])}return[Ye,tt]}(he,we),this.elevatedGlobeTrianglesCenterLongitudes=he,this.elevatedGlobeIndexBuffer=a.createIndexBuffer(we)}this.elevatedGlobeSegments=ds.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,oe/rr,0,ce/rr,0,0,J,Y,0])}prepare(){const a=Object.keys(this.tiles).length!==0;if(this.tileID&&!a)return;const c=this.map.painter.context,p=c.gl;!this._dirty||this.texture instanceof oS||(this.texture?this.texture.update(this.image):(this.texture=new iM(c,this.image,p.RGBA8),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),a&&this._prepareData(c)}loadTile(a,c){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},c(null)):(a.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(a){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const p=this.elevatedGlobeTrianglesCenterLongitudes;let g=(x=a+180)+360*Math.round((p[0]-x)/360);var x;const b=new ds,C=(q,H)=>{b.segments.push({vertexOffset:0,primitiveOffset:q,vertexLength:c.segments[0].vertexLength,primitiveLength:H,sortKey:void 0,vaos:{}})},I=.51*this.maxLongitudeTriangleSize;if(Math.abs(p[0]-g)<=I){const q=Mn(p,0,p.length,g+I);return q===p.length||C(q,_i(p,q+1,p.length,g+360-I)-q),b}g<p[0]&&(g+=360);const D=_i(p,0,p.length,g-I);if(D===p.length)return C(0,p.length),b;C(0,D-0);const U=Mn(p,D+1,p.length,g+I);return U!==p.length&&C(U,p.length-U),b}}const zpe=(Math.pow(256,2)-1)/16907520;class u8 extends qo{constructor(a,c,p,g){super(a,{layout:a8||(a8=new bs({visibility:new Zt(ht.layout_raster.visibility)})),paint:o8||(o8=new bs({"raster-opacity":new Zt(ht.paint_raster["raster-opacity"]),"raster-color":new Vp(ht.paint_raster["raster-color"]),"raster-color-mix":new Zt(ht.paint_raster["raster-color-mix"]),"raster-color-range":new Zt(ht.paint_raster["raster-color-range"]),"raster-hue-rotate":new Zt(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Zt(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Zt(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Zt(ht.paint_raster["raster-saturation"]),"raster-contrast":new Zt(ht.paint_raster["raster-contrast"]),"raster-resampling":new Zt(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Zt(ht.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Zt(ht.paint_raster["raster-emissive-strength"]),"raster-array-band":new Zt(ht.paint_raster["raster-array-band"]),"raster-elevation":new Zt(ht.paint_raster["raster-elevation"]),"raster-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},c,p,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(a){return!(a&&a._source instanceof c8&&(a._source.onNorthPole||a._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(a){a!=="raster-color"&&a!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(a){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[p,g]=a||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(p)&&isNaN(g)||p===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=G1({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:p,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[p,g])}}let d8,h8,f8,p8,m8;class g8 extends qo{constructor(a,c,p,g){super(a,{layout:d8||(d8=new bs({visibility:new Zt(ht["layout_raster-particle"].visibility)})),paint:h8||(h8=new bs({"raster-particle-array-band":new Zt(ht["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Zt(ht["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Vp(ht["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Zt(ht["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Zt(ht["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Zt(ht["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Zt(ht["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Zt(ht["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},c,p,g),this._updateColorRamp(),this.lastInvalidatedAt=Ol.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(a){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(a){return!1}_handleSpecialPaintPropertyUpdate(a){a!=="raster-particle-color"&&a!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),a==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const a=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=G1({expression:a,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ol.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Bpe extends qo{constructor(a,c){super(a,{},c,null),this.implementation=a,a.slot&&(this.slot=a.slot)}is3D(a){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(a){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}function IM(u,a,c){const p=[0,0,1],g=Cr([]);return hn(g,g,c?-vn(u)+Math.PI:vn(u)),un(g,g,-vn(a)),ir(p,p,g),ke(p,p)}const y8={None:0,Model:1,Symbol:2,FillExtrusion:4};class RC{constructor(a,c,p,g){this.message=(a?`${a}: `:"")+p,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function RM(u,a){const c=u.indexOf("://")===-1;try{return new URL(u,c&&a?"http://example.com":void 0),!0}catch{return!1}}class v8{constructor(a,c){this.feature=a,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class _8{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new nx,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(a){const c=16*a,p=this.instancedDataArray.float32;let g=Math.floor(p[c+2]);const x=1.05*(p[c+2]-g);return g/=100,[p[c]%1*1.05,p[c+1]%1*1.05,x,g]}tileCoordinatesForInstance(a){const c=16*a,p=this.instancedDataArray.float32;let g=p[c+0];return g=g>rr?g-rr:g,new at(Math.trunc(g),Math.trunc(p[c+1]))}translationForInstance(a){const c=16*a,p=this.instancedDataArray.float32;return[p[c+4],p[c+5],p[c+6]]}rotationScaleForInstance(a){const c=16*a,p=this.instancedDataArray.float32;return[p[c+7],p[c+8],p[c+9],p[c+10],p[c+11],p[c+12],p[c+13],p[c+14],p[c+15]]}transformForInstance(a){const c=16*a,p=this.instancedDataArray.float32;return[p[c+7],p[c+8],p[c+9],p[c+4],p[c+10],p[c+11],p[c+12],p[c+5],p[c+13],p[c+14],p[c+15],p[c+6],0,0,0,1]}}class MM{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaledZ=this.canonical.z+Math.log2(a.overscaling),this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=a.projection,this.index=a.index,this.worldview=a.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=a.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.tileToMeter=Ze(p);const x=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:b,id:C,index:I,sourceLayerIndex:D}of a){const U=C??(b.properties&&b.properties.hasOwnProperty("id")?b.properties.id:void 0),q=yt(b,x);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),q,p))continue;const H={id:U,sourceLayerIndex:D,index:I,geometry:x?q.geometry:Nt(b,p,g),properties:b.properties,type:b.type,patterns:{}},Y=this.addFeature(H,H.geometry,q);Y&&c.featureIndex.insert(b,H.geometry,I,D,this.index,this.instancesPerModel[Y].instancedDataArray.length,rr/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const a=this.layers[0].modelManager,c=this.layers[0].scope;let p=0;for(const g of this.modelUris){const x=a.getModel(g,c);if(!x)continue;const b=this.instancesPerModel[g];if(b){const C=.5*We(x.aabb.max,x.aabb.min)*b.maxScale+b.maxXYTranslationDistance,I=Math.min(rr,Math.max(C/this.tileToMeter,rr/32));p=Math.max(I,p)}}return p}update(a,c,p,g){for(const x in this.instancesPerModel){const b=this.instancesPerModel[x];for(const C in a)b.idToFeaturesIndex.hasOwnProperty(C)&&(this.evaluate(b.features[b.idToFeaturesIndex[C]],a[C],b,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let a=!1;for(const c in this.instancesPerModel){const p=this.instancesPerModel[c];for(const g of p.features){const x=this.layers[0],b=g.feature,C=this.canonical,I=x.paint.get("model-rotation").evaluate(b,{},C),D=x.paint.get("model-scale").evaluate(b,{},C),U=x.paint.get("model-translation").evaluate(b,{},C);Rr(g.rotation,I)&&Rr(g.scale,D)&&Rr(g.translation,U)||(this.evaluate(g,g.featureStates,p,!0),a=!0)}}return a}updateReplacement(a,c,p,g){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const x=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);if(iC(this.activeReplacements,x))return!1;this.activeReplacements=x;let b=!1;for(const C in this.instancesPerModel){const I=this.instancesPerModel[C],D=I.instancedDataArray;for(const U of I.features){const q=U.instancedDataOffset,H=U.instancedDataCount;for(let Y=0;Y<H;Y++){const J=16*(Y+q);let oe=D.float32[J+0];const ce=oe>rr;oe=ce?oe-rr:oe;const he=Math.floor(oe),we=Math.floor(D.float32[J+1]);let Te=!1;for(const Pe of this.activeReplacements)if(!iV(Pe,p,y8.Model,g)&&!(Pe.min.x>he||he>Pe.max.x||Pe.min.y>we||we>Pe.max.y)&&(Te=GR(lV(he,we,a.canonical,Pe.footprintTileId.canonical),Pe.footprint),Te))break;D.float32[J]=Te?oe+rr:oe,b=b||Te!==ce}}}return b}isEmpty(){for(const a in this.instancesPerModel)if(this.instancesPerModel[a].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(a){if(!this.uploaded)for(const c in this.instancesPerModel){const p=this.instancesPerModel[c];p.instancedDataArray.length<0||p.instancedDataArray.length===0||(p.instancedDataBuffer?p.instancedDataBuffer.updateData(p.instancedDataArray):p.instancedDataBuffer=a.createVertexBuffer(p.instancedDataArray,ffe.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const p=this.instancesPerModel[c];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(a&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)a.removeModel(c,"",!0)}addFeature(a,c,p){const g=this.layers[0],x=g.layout.get("model-id").evaluate(p,{},this.canonical);if(!x)return zr(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),x;(RM(x,!1)||this.styleDefinedModelURLs[x]!==void 0)&&(this.modelUris.includes(x)||this.modelUris.push(x)),this.instancesPerModel[x]||(this.instancesPerModel[x]=new _8);const b=this.instancesPerModel[x],C=b.instancedDataArray,I=new v8(p,C.length);for(const D of c)for(const U of D){if(U.x<0||U.x>=rr||U.y<0||U.y>=rr)continue;if(this.lookupDim!==0){const H=(this.lookupDim-1)/rr,Y=this.lookupDim*(U.y*H|0)+U.x*H|0;if(this.lookup){if(this.lookup[Y]!==0)continue;this.lookup[Y]=1}}this.instanceCount++;const q=C.length;C.resize(q+1),b.instancesEvaluatedElevation.push(0),C.float32[16*q]=U.x,C.float32[16*q+1]=U.y}return I.instancedDataCount=b.instancedDataArray.length-I.instancedDataOffset,I.instancedDataCount>0&&(a.id&&(b.idToFeaturesIndex[a.id]=b.features.length),b.features.push(I),this.evaluate(I,{},b,!1)),x}getModelUris(){return this.modelUris}evaluate(a,c,p,g){const x=this.layers[0],b=a.feature,C=this.canonical,I=a.rotation=x.paint.get("model-rotation").evaluate(b,c,C),D=a.scale=x.paint.get("model-scale").evaluate(b,c,C),U=a.translation=x.paint.get("model-translation").evaluate(b,c,C),q=Object.assign({},x.paint.get("model-color").evaluate(b,c,C));q.a=x.paint.get("model-color-mix-intensity").evaluate(b,c,C);const H=[];this.maxVerticalOffset<U[2]&&(this.maxVerticalOffset=U[2]);const Y=U[0]*U[0]+U[1]*U[1],J=Y>0?Math.sqrt(Y):0;p.maxScale=Math.max(Math.max(p.maxScale,D[0]),Math.max(D[1],D[2])),p.maxXYTranslationDistance=Math.max(p.maxXYTranslationDistance,J),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),KV(H,I,D);const oe=Math.round(100*q.a)+q.b/1.05;for(let ce=0;ce<a.instancedDataCount;++ce){const he=a.instancedDataOffset+ce,we=16*he,Te=p.instancedDataArray.float32;let Pe=0;g&&(Pe=Te[we+6]-p.instancesEvaluatedElevation[he]);const He=0|Te[we+1];Te[we]=(0|Te[we])+q.r/1.05,Te[we+1]=He+q.g/1.05,Te[we+2]=oe,Te[we+3]=1/(C.z>10?this.tileToMeter:Ze(C,He)),Te[we+4]=U[0],Te[we+5]=U[1],Te[we+6]=U[2]+Pe,Te[we+7]=H[0],Te[we+8]=H[1],Te[we+9]=H[2],Te[we+10]=H[4],Te[we+11]=H[5],Te[we+12]=H[6],Te[we+13]=H[8],Te[we+14]=H[9],Te[we+15]=H[10],p.instancesEvaluatedElevation[he]=U[2]}}}let x8,b8;_r(MM,"ModelBucket",{omit:["layers"]}),_r(_8,"PerModelAttributes"),_r(v8,"ModelFeature");class Cx{constructor(a,c,p){this._demTile=a,this._dem=this._demTile.dem,this._scale=c,this._offset=p}static create(a,c,p){const g=p||a.findDEMTileFor(c);if(!g||!g.dem)return;const x=g.dem,b=g.tileID,C=1<<c.canonical.z-b.canonical.z;return new Cx(g,x.dim/rr/C,[(c.canonical.x/C-b.canonical.x)*x.dim,(c.canonical.y/C-b.canonical.y)*x.dim])}tileCoordToPixel(a,c){const p=c*this._scale+this._offset[1];return new at(Math.floor(a*this._scale+this._offset[0]),Math.floor(p))}getElevationAt(a,c,p,g){const x=a*this._scale+this._offset[0],b=c*this._scale+this._offset[1],C=Math.floor(x),I=Math.floor(b),D=this._dem;return g=!!g,p?Kr(Kr(D.get(C,I,g),D.get(C,I+1,g),b-I),Kr(D.get(C+1,I,g),D.get(C+1,I+1,g),b-I),x-C):D.get(C,I,g)}getElevationAtPixel(a,c,p){return this._dem.get(a,c,!!p)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*Ee(1,a)*this._dem.stride}}const DM=new Float32Array(262144),Py=new Uint8Array(262144);function w8(u){let a=0;if(u.meshes)for(const c of u.meshes)a=Math.max(a,c.aabb.max[2]);if(u.children)for(const c of u.children)a=Math.max(a,w8(c));return a}function S8(u,a,c){if(u.meshes)for(const p of u.meshes){if(p.aabb.min[0]===1/0)continue;const g=_n.applyTransform(p.aabb,u.globalMatrix);c.insert(a,g.min[0],g.min[1],g.max[0],g.max[1])}if(u.children)for(const p of u.children)S8(p,a,c)}const E8=["","wall","door","roof","window","lamp","logo"];class T8{constructor(a){this.node=a,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:a.id,geometry:[],properties:{height:w8(a)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let a=0;const c=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const p of this.node.meshes)this.node.lightMeshIndex!==a&&(p.transformedAabb=_n.applyTransformFast(p.aabb,this.node.globalMatrix),c.encapsulate(p.transformedAabb)),a++;this.aabb=c}return this.aabb}}class MC{constructor(a,c,p,g,x,b,C,I){this.id=p,this.layers=a,this.layerIds=this.layers.map(D=>D.fqid),this.stateDependentLayerIds=this.layers.filter(D=>D.isStateDependent()).map(D=>D.id),this.modelTraits|=vx.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=vx.HasMapboxMeshFeatures),x&&(this.modelTraits|=vx.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=b,this.worldview=I,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const D of c)this.nodesInfo.push(new T8(D)),S8(D,C.featureIndexArray.length,C.grid),C.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,C.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(a,c){for(const p of this.getNodesInfo()){const g=p.node;g.footprint&&c.push({footprint:g.footprint,id:a})}}updateAppearances(a,c,p,g){}update(a){const c=Object.keys(a).length!==0;if(c&&!this.stateDependentLayers.length)return;const p=c?this.stateDependentLayers:this.layers;if(!gn(a,this.states))for(const g of p)this.evaluate(g,a);this.states=structuredClone(a)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(a){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const p of c){const g=p.node;this.uploaded?this.updatePbrBuffer(g):oM(g,a,!0)}for(const p of c)gC(p.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(a){let c=!1;if(!a.meshes)return c;for(const p of a.meshes)p.pbrBuffer&&(p.pbrBuffer.updateData(p.featureArray),c=!0);return c}needsReEvaluation(a,c,p){const g=a.transform.projectionOptions,x=a.style.getBrightness(),b=this.brightness!==x;if(!this.uploaded||this.dirty||g.name!==this.projection.name||ES(p.paint.get("model-color").value,b)||ES(p.paint.get("model-color-mix-intensity").value,b)||ES(p.paint.get("model-roughness").value,b)||ES(p.paint.get("model-emissive-strength").value,b)||ES(p.paint.get("model-height-based-emissive-strength-multiplier").value,b)){this.projection=g,this.brightness=x;const C=this.getNodesInfo();for(const I of C)I.state=null;return!0}return!1}evaluateTransform(a,c){if(a.transform.zoom===this.zoom)return;this.zoom=a.transform.zoom;const p=this.getNodesInfo(),g=this.id.canonical;for(const x of p){const b=x.feature;x.evaluatedTranslation=c.paint.get("model-translation").evaluate(b,{},g),x.evaluatedScale=c.paint.get("model-scale").evaluate(b,{},g)}}evaluate(a,c){const p=this.getNodesInfo();for(const g of p){if(!g.node.meshes)continue;const x=g.feature,b=c&&c[x.id];if(gn(b,g.state))continue;g.state=structuredClone(b);const C=g.node.meshes&&g.node.meshes[0].featureData,I=g.evaluatedColor[2],D=g.evaluatedRMEA[2],U=this.id.canonical;if(g.hasTranslucentParts=!1,C){for(let q=0;q<E8.length;q++){const H=E8[q];H.length&&(x.properties.part=H);const Y=a.paint.get("model-color").evaluate(x,b,U).toPremultipliedRenderColor(null),J=a.paint.get("model-color-mix-intensity").evaluate(x,b,U);g.evaluatedColor[q]=[Y.r,Y.g,Y.b,J],g.evaluatedRMEA[q][0]=a.paint.get("model-roughness").evaluate(x,b,U),g.evaluatedRMEA[q][2]=a.paint.get("model-emissive-strength").evaluate(x,b,U),g.evaluatedRMEA[q][3]=Y.a,g.emissionHeightBasedParams[q]=a.paint.get("model-height-based-emissive-strength-multiplier").evaluate(x,b,U),!g.hasTranslucentParts&&Y.a<1&&(g.hasTranslucentParts=!0)}delete x.properties.part,Upe(g,I!==g.evaluatedColor[2]||D!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=a.paint.get("model-emissive-strength").evaluate(x,b,U);g.evaluatedTranslation=a.paint.get("model-translation").evaluate(x,b,U),g.evaluatedScale=a.paint.get("model-scale").evaluate(x,b,U),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(a,c,p,g){const x=a.findDEMTileFor(p);if(x&&(x.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(x.dem&&x.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=x.tileID.overscaledZ;const b=Cx.create(a,p,x);if(!b)return;this.modelTraits&vx.HasMapboxMeshFeatures&&this.updateDEM(a,b,p,g);for(const C of this.getNodesInfo()){const I=C.node;if(!I.footprint||!I.footprint.vertices||!I.footprint.vertices.length)continue;const D=I.footprint.vertices;let U=b.getElevationAt(D[0].x,D[0].y,!0,!0);for(let q=1;q<D.length;q++)U=Math.min(U,b.getElevationAt(D[q].x,D[q].y,!0,!0));I.elevation=U}}this.terrainTile=x.tileID.canonical,this.terrainExaggeration=c}}updateDEM(a,c,p,g){let x=c._dem._modifiedForSources[g];if(x===void 0&&(c._dem._modifiedForSources[g]=[],x=c._dem._modifiedForSources[g]),x.includes(p.canonical))return;const b=c._dem.dim;x.push(p.canonical);let C=!1;for(const I of this.getNodesInfo()){const D=I.node;if(!D.footprint||!D.footprint.grid)continue;const U=D.footprint.grid,q=c.tileCoordToPixel(U.min.x,U.min.y),H=c.tileCoordToPixel(U.max.x,U.max.y),Y=Math.min(Math.min(b-H.y,q.x),Math.min(q.y,b-H.x));if(Y<0)continue;const J=ve(Y,2,5);let oe=Math.max(0,q.x-J),ce=Math.max(0,q.y-J),he=Math.min(H.x+J,b-1),we=Math.min(H.y+J,b-1);for(let Fe=ce;Fe<=we;++Fe)for(let Ye=oe;Ye<=he;++Ye)Py[Fe*b+Ye]=255;let Te=0,Pe=0;for(let Fe=0;Fe<U.cellsY;++Fe)for(let Ye=0;Ye<U.cellsX;++Ye){if(!U.cells[Fe*U.cellsX+Ye])continue;const tt=c.tileCoordToPixel(U.min.x+Ye/U.xScale,U.min.y+Fe/U.yScale),it=c.tileCoordToPixel(U.min.x+(Ye+1)/U.xScale,U.min.y+(Fe+1)/U.yScale);for(let Tt=tt.y;Tt<=Math.min(it.y+1,b-1);++Tt)for(let ft=tt.x;ft<=Math.min(it.x+1,b-1);++ft)Py[Tt*b+ft]===255&&(Py[Tt*b+ft]=0,Te+=c.getElevationAtPixel(ft,Tt),Pe++)}const He=Te/Pe;oe=Math.max(1,q.x-J),ce=Math.max(1,q.y-J),he=Math.min(H.x+J,b-2),we=Math.min(H.y+J,b-2),C=!0;for(let Fe=ce;Fe<=we;++Fe)for(let Ye=oe;Ye<=he;++Ye)Py[Fe*b+Ye]===0&&(DM[Fe*b+Ye]=c._dem.set(Ye,Fe,He));for(let Fe=1;Fe<J;++Fe){oe=Math.max(1,q.x-Fe),ce=Math.max(1,q.y-Fe),he=Math.min(H.x+Fe,b-2),we=Math.min(H.y+Fe,b-2);for(let Ye=ce;Ye<=we;++Ye)for(let tt=oe;tt<=he;++tt){const it=Ye*b+tt;if(Py[it]===255){let Tt=0,ft=0,At=-1,Rt=-1;for(let Bt=-1;Bt<=1;++Bt)for(let er=-1;er<=1;++er){const Wt=(Ye+Bt)*b+tt+er;if(Py[Wt]>=Fe)continue;const Lt=DM[Wt],Gt=Math.abs(Lt);Gt>ft&&(Tt=Lt,ft=Gt,At=er,Rt=Bt)}if(ft>.1){const Bt=1-(Fe+.5*Math.abs(At*Rt))/J;let er=c._dem.get(tt,Ye)+Tt*Bt;const Wt=c._dem.get(tt+At,Ye+Rt),Lt=c._dem.get(tt-At,Ye-Rt,!0);(er-Wt)*(er-Lt)>0&&(er=(Wt+Lt)/2),DM[it]=c._dem.set(tt,Ye,er),Py[it]=Fe}}}}}C&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=Ol.now())}setFilter(a){this.filter=a?K_(a):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(a=>this.filter.filter(new Ui(this.id.overscaledZ,{worldview:this.worldview}),a.feature,this.id.canonical)):this.nodesInfo}destroy(){const a=this.getNodesInfo();for(const c of a)gC(c.node),lM(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped());for(const g of this.getNodesInfo()){const x=g.node.footprint;g.hiddenByReplacement=!!x&&!p.find(b=>b.footprint===x)}}getHeightAtTileCoord(a,c){const p=[],g=[0,0,0],x=N([]);for(const b of this.getNodesInfo()){const C=b.node.meshes[0],I=C.transformedAabb;if(a<I.min[0]||c<I.min[1]||a>I.max[0]||c>I.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};R(x,b.node.globalMatrix),g[0]=a,g[1]=c,Dt(g,g,x);const D=(g[0]-C.aabb.min[0])/(C.aabb.max[0]-C.aabb.min[0])*Ay|0,U=Math.min(63,(g[1]-C.aabb.min[1])/(C.aabb.max[1]-C.aabb.min[1])*Ay|0)*Ay+Math.min(63,D),q=C.heightmap[U];if(!(q<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:q,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new at(a,c),new at(a,c),p),p.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function ES(u,a){return u instanceof dy&&!u.isLightConstant&&a}function $pe(u,a,c,p,g,x,b,C){let I=(61440&a|(61440&a)>>4)>>8,D=(3840&a|(3840&a)>>4)>>4,U=240&a|(240&a)>>4;c[3]>0&&(I=Kr(I,255*c[0],c[3]),D=Kr(D,255*c[1],c[3]),U=Kr(U,255*c[2],c[3]));const q=I<<8|D,H=U<<8|Math.floor(255*p[3]),Y=function(Fe){const Ye=ve(Fe,0,2);return Math.min(Math.round(.5*Ye*255),255)}(p[2])<<8|15*p[0]<<4|15*p[1],J=ve(g[0],0,1),oe=ve(g[1],0,1),ce=ve(g[2],0,1),he=ve(g[3],0,1);let we,Te,Pe,He;if(J!==oe&&b!==x&&oe!==J){const Fe=b-x;Te=1/(Fe*(oe-J)),Pe=-(x+Fe*J)/(Fe*(oe-J));const Ye=ve(g[4],-1,1);He=Math.pow(10,Ye),we=255*ce<<8|255*he}else we=65535,Te=0,Pe=1,He=1;if(u.emplaceBack(q,H,Y,we,Te,Pe,He),C){const Fe=C.length;C.clear();for(let Ye=0;Ye<Fe;Ye++)C.emplaceBack(q,H,Y,we,Te,Pe,He)}}function Upe(u,a,c){const p=u.node;let g=0;const x=c&vx.HasMeshoptCompression;for(const b of p.meshes){if(p.lights&&p.lightMeshIndex===g||!b.featureData)continue;b.featureArray=new Qp,b.featureArray.reserve(b.featureData.length);let C=a;for(const I of b.featureData){const D=x?65535&I:I>>16&65535,U=x?I>>16&65535:65535&I,q=(15&U)<8?15&U:0,H=u.evaluatedRMEA[q],Y=u.evaluatedColor[q],J=u.emissionHeightBasedParams[q];let oe;if(C&&q===2&&p.lights&&(oe=new Qp,oe.resize(10*p.lights.length)),$pe(b.featureArray,D,Y,H,J,b.aabb.min[2],b.aabb.max[2],oe),oe&&C){C=!1;const ce=p.meshes[p.lightMeshIndex];ce.featureArray=oe,ce.featureArray._trim()}}b.featureArray._trim(),g++}}_r(MC,"Tiled3dModelBucket",{omit:["layers"]}),_r(T8,"Tiled3dModelFeature");const Vpe=["id","tile","layer","source","sourceLayer","state"];class Oy{constructor(a,c,p,g,x){this.type="Feature",this._vectorTileFeature=a,this._z=c,this._x=p,this._y=g,this.properties=a?a.properties:{},this.id=x}clone(){const a=new Oy(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(a.state=Object.assign({},this.state)),this.layer&&(a.layer=Object.assign({},this.layer)),this.source&&(a.source=this.source),this.sourceLayer&&(a.sourceLayer=this.sourceLayer),a}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of Vpe)this[c]!==void 0&&(a[c]=this[c]);return a}}class ky extends id{constructor(a,c,p,g){super(),this.id=a,this.type="model",this.models=[],this._loaded=!1,this._options=c,this._modelsInfo=new Map}load(){const a=[];for(const c in this._options.models){const p=this._options.models[c],g=this._modelsInfo.get(c);if(g){const x=g.model;x.position=p.position!=null?new Q(p.position[0],p.position[1]):new Q(0,0),x.orientation=p.orientation!=null?p.orientation:[0,0,0],g.modelSpec=p,ky.applyModelSpecification(x,p),x.computeBoundsAndApplyParent(),this.models.push(x)}else{const x=qV(this.map._requestManager.transformRequest(p.uri,of.Model).url).then(b=>{if(!b)return;const C=uM(b),I=new ZV(c,p.uri,p.position,p.orientation,C);ky.applyModelSpecification(I,p),I.computeBoundsAndApplyParent(),this.models.push(I),this._modelsInfo.set(c,{modelSpec:p,model:I})}).catch(b=>{this.fire(new qg(new Error(`Could not load model ${c} from ${p.uri}: ${b.message}`)))});a.push(x)}}Promise.allSettled(a).then(()=>{this._loaded=!0,this.fire(new ql("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this._loaded=!0,this.fire(new qg(new Error(`Could not load models: ${c.message}`)))})}static applyModelSpecification(a,c){c.nodeOverrides&&ky.convertNodeOverrides(a,c.nodeOverrides),c.materialOverrides&&ky.convertMaterialOverrides(a,c.materialOverrides),c.nodeOverrideNames&&(a.nodeOverrideNames=[...c.nodeOverrideNames]),c.materialOverrideNames&&(a.materialOverrideNames=[...c.materialOverrideNames]),c.featureProperties&&(a.featureProperties=c.featureProperties)}static convertNodeOverrides(a,c){if(Array.isArray(c)&&c.every(p=>typeof p=="string")){a.nodeOverrideNames=[];for(const p of c)a.nodeOverrideNames.push(p)}else Object.entries(c).forEach(([p,g])=>{const x={orientation:[0,0,0]};if(g.hasOwnProperty("orientation")){const b=g.orientation;b&&(x.orientation=b)}a.nodeOverrides.set(p,x)})}static convertMaterialOverrides(a,c){if(Array.isArray(c)&&c.every(p=>typeof p=="string")){a.materialOverrideNames=[];for(const p of c)a.materialOverrideNames.push(p)}else Object.entries(c).forEach(([p,g])=>{const x={color:new hi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},b=g["model-color"];b!==void 0&&(x.color.r=b[0],x.color.g=b[1],x.color.b=b[2]);const C=g["model-color-mix-intensity"];C!==void 0&&(x.colorMix=C);const I=g["model-emissive-strength"];I!==void 0&&(x.emissionStrength=I);const D=g["model-opacity"];D!==void 0&&(x.opacity=D),a.materialOverrides.set(p,x)})}onAdd(a){this.map=a,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(a,c){}serialize(){return this._options}setProperty(a,c){return!1}reload(){const a=xf(this.id,this.scope);this.map.style.clearSource(a),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(a){this.models=[];const c=new Map;for(const p in a){const g=a[p];if(this._modelsInfo.has(p)){const x=this._modelsInfo.get(p);x&&x.modelSpec.uri===g.uri&&c.set(p,x)}}this._modelsInfo=c,this._options.models=a,this._loaded=!1,this.load()}}function LM(u,a,c,p){const g=1<<u.z;a.lat=je((p/rr+u.y)/g),a.lng=Ne((c/rr+u.x)/g)}function qpe(u,a,c,p){const g=u.getNodesInfo()[a];if(!g||g.hiddenByReplacement||!g.node.meshes)return;let x=Number.MAX_VALUE;const b=g.node,C=c.tile,I=p.calculatePosMatrix(C.tileID.toUnwrapped(),p.worldSize),D=g.evaluatedScale;let U=0;p.elevation&&b.elevation&&(U=b.elevation*p.elevation.exaggeration()),F(I,I,[(b.anchor?b.anchor[0]:0)*(D[0]-1),(b.anchor?b.anchor[1]:0)*(D[1]-1),U]),B(I,I,D);const q=c.queryGeometry,H=q.isPointQuery()?q.screenBounds:q.screenGeometry,Y=function(oe){const ce=M([],I,oe.globalMatrix);M(ce,p.expandedFarZProjMatrix,ce);for(let he=0;he<oe.meshes.length;++he){const we=oe.meshes[he];if(he===oe.lightMeshIndex)continue;const Te=aM(H,p,ce,we.aabb);Te!=null&&(x=Math.min(Te,x))}if(oe.children)for(const he of oe.children)Y(he)};if(Y(b),x===Number.MAX_VALUE)return;const J=new Q(0,0);return LM(C.tileID.canonical,J,g.node.anchor[0],g.node.anchor[1]),{intersectionZ:x,position:J,feature:g.feature}}const Hpe={circle:class extends qo{constructor(u,a,c,p){super(u,{layout:md||(md=new bs({"circle-sort-key":new ur(ht.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Zt(ht.layout_circle["circle-elevation-reference"]),visibility:new Zt(ht.layout_circle.visibility)})),paint:rm||(rm=new bs({"circle-radius":new ur(ht.paint_circle["circle-radius"]),"circle-color":new ur(ht.paint_circle["circle-color"]),"circle-blur":new ur(ht.paint_circle["circle-blur"]),"circle-opacity":new ur(ht.paint_circle["circle-opacity"]),"circle-translate":new Zt(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Zt(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Zt(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Zt(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ur(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ur(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ur(ht.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Zt(ht.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}createBucket(u){return new os(u)}queryRadius(u){const a=u;return Ia("circle-radius",this,a)+Ia("circle-stroke-width",this,a)+ys(this.paint.get("circle-translate"))}queryIntersectsFeature(u,a,c,p,g,x,b,C){const I=tm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(a,c)+this.paint.get("circle-stroke-width").evaluate(a,c);return kU(u,p,x,b,C,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",I,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,a,c){const p=OU(this);return{config:new pd(this,{zoom:a,lut:c}),defines:p,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends qo{createBucket(u){return new IU(u)}constructor(u,a,c,p){super(u,{layout:RU||(RU=new bs({visibility:new Zt(ht.layout_heatmap.visibility)})),paint:MU||(MU=new bs({"heatmap-radius":new ur(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ur(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Zt(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vp(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Zt(ht.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=G1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(u){return Ia("heatmap-radius",this,u)}queryIntersectsFeature(u,a,c,p,g,x,b,C){const I=this.paint.get("heatmap-radius").evaluate(a,c);return kU(u,p,x,b,C,!0,!0,new at(0,0),I)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,a,c){return u==="heatmap"?{config:new pd(this,{zoom:a,lut:c}),overrideFog:!1}:{}}},hillshade:class extends qo{constructor(u,a,c,p){super(u,{layout:DU||(DU=new bs({visibility:new Zt(ht.layout_hillshade.visibility)})),paint:LU||(LU=new bs({"hillshade-illumination-direction":new Zt(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Zt(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Zt(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Zt(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Zt(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Zt(ht.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Zt(ht.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}},fill:class extends qo{constructor(u,a,c,p){super(u,{layout:JU||(JU=new bs({"fill-sort-key":new ur(ht.layout_fill["fill-sort-key"]),visibility:new Zt(ht.layout_fill.visibility),"fill-elevation-reference":new Zt(ht.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ur(ht.layout_fill["fill-construct-bridge-guard-rail"])})),paint:QU||(QU=new bs({"fill-antialias":new Zt(ht.paint_fill["fill-antialias"]),"fill-opacity":new ur(ht.paint_fill["fill-opacity"]),"fill-color":new ur(ht.paint_fill["fill-color"]),"fill-outline-color":new ur(ht.paint_fill["fill-outline-color"]),"fill-translate":new Zt(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Zt(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new ur(ht.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Zt(ht.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Zt(ht.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ur(ht.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ur(ht.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ur(ht.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}getProgramIds(){const u=this.paint.get("fill-pattern"),a=u&&u.constantOr(1),c=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(u,a,c){return{config:new pd(this,{zoom:a,lut:c}),overrideFog:!1}}recalculate(u,a){super.recalculate(u,a);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new VR(u)}queryRadius(){return ys(this.paint.get("fill-translate"))}queryIntersectsFeature(u,a,c,p,g,x){return!u.queryGeometry.isAboveHorizon&&ws(Yl(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),p)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const a=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?a&&!u:a}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends qo{constructor(u,a,c,p){super(u,{layout:EV||(EV=new bs({visibility:new Zt(ht["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Zt(ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:TV||(TV=new bs({"fill-extrusion-opacity":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ur(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ur(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ur(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ur(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ur(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ur(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ur(ht["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ur(ht["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Zt(ht["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new aC(u)}queryRadius(){return ys(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,a,c,p,g,x,b,C,I){const D=tm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),U=this.paint.get("fill-extrusion-height").evaluate(a,c),q=this.paint.get("fill-extrusion-base").evaluate(a,c),H=[0,0],Y=C&&x.elevation,J=x.elevation?x.elevation.exaggeration():1,oe=u.tile.getBucket(this);if(Y&&oe instanceof aC){const Pe=oe.centroidVertexArray,He=I+1;He<Pe.length&&(H[0]=Pe.geta_centroid_pos0(He),H[1]=Pe.geta_centroid_pos1(He))}if(H[0]===0&&H[1]===1)return!1;x.projection.name==="globe"&&(p=SV([p],[new at(0,0),new at(rr,rr)],u.tileID.canonical).map(Pe=>Pe.polygon).flat());const ce=Y?C:null,[he,we]=NV(x,p,q,U,D,b,ce,H,J,x.center.lat,u.tileID.canonical),Te=u.queryGeometry;return kV(he,we,Te.isPointQuery()?Te.screenBounds:Te.screenGeometry)}},building:class extends qo{constructor(u,a,c,p){super(u,{layout:n6||(n6=new bs({visibility:new Zt(ht.layout_building.visibility),"building-facade":new ur(ht.layout_building["building-facade"]),"building-facade-floors":new ur(ht.layout_building["building-facade-floors"]),"building-facade-unit-width":new ur(ht.layout_building["building-facade-unit-width"]),"building-facade-window":new ur(ht.layout_building["building-facade-window"]),"building-roof-shape":new ur(ht.layout_building["building-roof-shape"]),"building-height":new ur(ht.layout_building["building-height"]),"building-base":new ur(ht.layout_building["building-base"]),"building-flood-light-wall-radius":new ur(ht.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new ur(ht.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new ur(ht.layout_building["building-flip-roof-orientation"])})),paint:i6||(i6=new bs({"building-opacity":new Zt(ht.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Zt(ht.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Zt(ht.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Zt(ht.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Zt(ht.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Zt(ht.paint_building["building-vertical-scale"]),"building-cast-shadows":new Zt(ht.paint_building["building-cast-shadows"]),"building-color":new ur(ht.paint_building["building-color"]),"building-emissive-strength":new ur(ht.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Zt(ht.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Zt(ht.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Zt(ht.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Zt(ht.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Zt(ht.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new r6(u)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(u){return!0}queryRadius(u){return 0}queryIntersectsFeature(u,a,c,p,g,x,b,C,I){let D=this.layout.get("building-height").evaluate(a,c);const U=this.layout.get("building-base").evaluate(a,c),q=u.tile.getBucket(this).getFootprint(a);if(q){if(q.hiddenFlags!==0)return!1;D=q.height}const[H,Y]=NV(x,p,U,D,new at(0,0),b,null,[0,0],1,x.center.lat,u.tileID.canonical),J=u.queryGeometry;return kV(H,Y,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends qo{constructor(u,a,c,p){const g=p6();super(u,g,a,c,p),g.layout&&(this.layout=new _f(g.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof sy,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,a){super.recalculate(u,a),this.paint._values["line-floorwidth"]=(()=>{if(cS)return cS;const c=p6();return cS=new $fe(c.paint.properties["line-width"].specification),cS.useIntegerZoom=!0,cS})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new hM(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,a,c){const p=h6(this);return{config:new pd(this,{zoom:a,lut:c}),defines:p,overrideFog:!1}}queryRadius(u){const a=u,c=m6(Ia("line-width",this,a),Ia("line-gap-width",this,a)),p=Ia("line-offset",this,a);return c/2+Math.abs(p)+ys(this.paint.get("line-translate"))}queryIntersectsFeature(u,a,c,p,g,x){if(u.queryGeometry.isAboveHorizon)return!1;const b=Yl(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),C=u.pixelToTileUnitsFactor/2*m6(this.paint.get("line-width").evaluate(a,c),this.paint.get("line-gap-width").evaluate(a,c)),I=this.paint.get("line-offset").evaluate(a,c);return I&&(p=function(D,U){const q=[],H=new at(0,0);for(let Y=0;Y<D.length;Y++){const J=D[Y],oe=[];for(let ce=0;ce<J.length;ce++){const he=J[ce],we=J[ce+1],Te=ce===0?H:he.sub(J[ce-1])._unit()._perp(),Pe=ce===J.length-1?H:we.sub(he)._unit()._perp(),He=Te._add(Pe)._unit();He._mult(1/(He.x*Pe.x+He.y*Pe.y)),oe.push(He._mult(U)._add(he))}q.push(oe)}return q}(p,I*u.pixelToTileUnitsFactor)),function(D,U,q){for(let H=0;H<U.length;H++){const Y=U[H];if(D.length>=3){for(let J=0;J<Y.length;J++)if(Na(D,Y[J]))return!0}if(bl(D,Y,q))return!0}return!1}(b,p,C)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:kC,background:class extends qo{constructor(u,a,c,p){super(u,{layout:i8||(i8=new bs({visibility:new Zt(ht.layout_background.visibility)})),paint:s8||(s8=new bs({"background-pitch-alignment":new Zt(ht.paint_background["background-pitch-alignment"]),"background-color":new Zt(ht.paint_background["background-color"]),"background-pattern":new Zt(ht.paint_background["background-pattern"]),"background-opacity":new Zt(ht.paint_background["background-opacity"]),"background-emissive-strength":new Zt(ht.paint_background["background-emissive-strength"]),"background-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:u8,"raster-particle":g8,sky:class extends qo{constructor(u,a,c,p){super(u,{layout:f8||(f8=new bs({visibility:new Zt(ht.layout_sky.visibility)})),paint:p8||(p8=new bs({"sky-type":new Zt(ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new Zt(ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Zt(ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Zt(ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Zt(ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new Vp(ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Zt(ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Zt(ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Zt(ht.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=G1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}return!1}getCenter(u,a){if(this.paint.get("sky-type")==="atmosphere"){const p=this.paint.get("sky-atmosphere-sun"),g=!p,x=u.style.light,b=x.properties.get("position");return g&&x.properties.get("anchor")==="viewport"&&zr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?IM(b.azimuthal,90-b.polar,a):IM(p[0],90-p[1],a)}const c=this.paint.get("sky-gradient-center");return IM(c[0],90-c[1],a)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends qo{constructor(u,a,c,p){super(u,{paint:m8||(m8=new bs({}))},a,null)}},model:class extends qo{constructor(u,a,c,p){super(u,{layout:x8||(x8=new bs({visibility:new Zt(ht.layout_model.visibility),"model-id":new ur(ht.layout_model["model-id"])})),paint:b8||(b8=new bs({"model-opacity":new ur(ht.paint_model["model-opacity"]),"model-rotation":new ur(ht.paint_model["model-rotation"]),"model-scale":new ur(ht.paint_model["model-scale"]),"model-translation":new ur(ht.paint_model["model-translation"]),"model-color":new ur(ht.paint_model["model-color"]),"model-color-mix-intensity":new ur(ht.paint_model["model-color-mix-intensity"]),"model-type":new Zt(ht.paint_model["model-type"]),"model-cast-shadows":new Zt(ht.paint_model["model-cast-shadows"]),"model-receive-shadows":new Zt(ht.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Zt(ht.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ur(ht.paint_model["model-emissive-strength"]),"model-roughness":new ur(ht.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ur(ht.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Zt(ht.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Zt(ht.paint_model["model-front-cutoff"]),"model-elevation-reference":new Zt(ht.paint_model["model-elevation-reference"]),"model-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this.layer=u,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new MM(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof MC?rr-1:0}queryRenderedFeatures(u,a,c){const p=a.getSource();if(!(p&&p instanceof ky))return{};const g=p,x={};x[this.id]=[];const b=x[this.id];let C=0;for(const I of g.models){const D=a.getFeatureState(this.sourceLayer,I.id),U={type:"Unknown",id:I.id,properties:I.featureProperties},q=this.paint.get("model-rotation").evaluate(U,D),H=this.paint.get("model-scale").evaluate(U,D),Y=this.paint.get("model-translation").evaluate(U,D),J=this.paint.get("model-elevation-reference");let oe=[];mC(oe,I,c,I.position,q,H,Y,J==="ground",J==="ground",!1),c.projection.name==="globe"&&(oe=pC(oe,c));const ce=M([],c.projMatrix,oe),he=aM(u.isPointQuery()?u.screenBounds:u.screenGeometry,c,ce,I.aabb);if(he!=null){const we=new Oy(void 0,0,0,0,I.id);we.layer=this.layer,we.properties=structuredClone(I.featureProperties),we.properties.layer=this.id,we.properties.uri=I.uri,we.properties.orientation=I.orientation,we.sourceLayer=this.sourceLayer,we.geometry={type:"Point",coordinates:[I.position.lng,I.position.lat]},we.state=D,we.source=this.source,b.push({featureIndex:C,feature:we,intersectionZ:he})}++C}return x}queryIntersectsFeature(u,a,c,p,g,x){if(!this.modelManager)return!1;const b=this.modelManager,C=u.tile.getBucket(this);if(!(C&&C instanceof MM))return!1;for(const I in C.instancesPerModel){const D=C.instancesPerModel[I],U=a.id!==void 0?a.id:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0;if(D.idToFeaturesIndex.hasOwnProperty(U)){const q=D.features[D.idToFeaturesIndex[U]],H=b.getModel(I,this.scope);if(!H)return!1;let Y=[];const J=new Q(0,0),oe=C.canonical;let ce=Number.MAX_VALUE;for(let he=0;he<q.instancedDataCount;++he){const we=16*(q.instancedDataOffset+he),Te=D.instancedDataArray.float32,Pe=[Te[we+4],Te[we+5],Te[we+6]];LM(oe,J,Math.floor(Te[we]),Math.floor(Te[we+1])),mC(Y,H,x,J,q.rotation,q.scale,Pe,!1,!1,!1),x.projection.name==="globe"&&(Y=pC(Y,x));const He=M([],x.projMatrix,Y),Fe=u.queryGeometry,Ye=aM(Fe.isPointQuery()?Fe.screenBounds:Fe.screenGeometry,x,He,H.aabb);Ye!=null&&(ce=Math.min(Ye,ce))}return ce!==Number.MAX_VALUE&&ce}}return!1}_handleOverridablePaintPropertyUpdate(u,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const a=this._transitionablePaint._values[u];return a!=null&&a.value!=null&&a.value.expression!=null&&a.value.expression instanceof nh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends qo{constructor(u,a,c,p){super(u,{layout:eV||(eV=new bs({"clip-layer-types":new Zt(ht.layout_clip["clip-layer-types"]),"clip-layer-scope":new Zt(ht.layout_clip["clip-layer-scope"])})),paint:tV||(tV=new bs({}))},a,c,p)}recalculate(u,a){super.recalculate(u,a)}createBucket(u){return new rV(u)}is3D(u){return!0}}},FM=new hi(0,0,0),zM={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},BM={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},DC={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Gpe={PAINT_ORDER_FILL_AND_STROKE:1},TS={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},A8={MASK_TYPE_LUMINANCE:1};function Wpe(u,a,c){u===1&&a.icons.push(function(p,g){return function(x){if(x.usvg_tree.height||(x.usvg_tree.height=x.usvg_tree.width),!x.metadata)return x;const{metadata:b}=x;if(b.content_area){const{content_area:C}=b;C.left==null&&(C.left=0),C.top==null&&(C.top=C.left),C.width==null&&(C.width=x.usvg_tree.width),C.height==null&&(C.height=C.width)}if(b.text_placeholder){const{text_placeholder:C}=b;C.top==null&&(C.top=C.left),C.height==null&&(C.height=C.width)}return b.stretch_x&&b.stretch_x.length&&C8(b,"x"),b.stretch_y&&b.stretch_y.length&&C8(b,"y"),x}(p.readFields(Kpe,{name:void 0},g))}(c,c.readVarint()+c.pos))}function C8(u,a){const c=[],p=u[`stretch_${a}`];let g=null;for(let x=0;x<p.length;x++)g===null?g=c.length===0?p[0]:c[c.length-1][1]+p[x]:(c.push([g,g+p[x]]),g=null);u[`stretch_${a}_areas`]=c}function Kpe(u,a,c){u===1?a.name=c.readString():u===2?a.metadata=function(p,g){return p.readFields(Zpe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},g)}(c,c.readVarint()+c.pos):u===3&&(a.usvg_tree=function(p,g){return p.readFields(Jpe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},g)}(c,c.readVarint()+c.pos),a.data="usvg_tree")}function Zpe(u,a,c){u===1?a.stretch_x=c.readPackedVarint():u===2?a.stretch_y=c.readPackedVarint():u===3?a.content_area=j8(c,c.readVarint()+c.pos):u===4?a.variables.push(function(p,g){return p.readFields(Ype,{name:void 0},g)}(c,c.readVarint()+c.pos)):u===5&&(a.text_placeholder=j8(c,c.readVarint()+c.pos))}function j8(u,a){return u.readFields(Xpe,{},a)}function Xpe(u,a,c){u===1?a.left=c.readVarint():u===2?a.width=c.readVarint():u===3?a.top=c.readVarint():u===4&&(a.height=c.readVarint())}function Ype(u,a,c){u===1?a.name=c.readString():u===2&&(a.rgb_color=zC(c.readVarint()),a.value="rgb_color")}function Jpe(u,a,c){u===1?a.width=a.height=c.readVarint():u===2?a.height=c.readVarint():u===3?a.children.push(LC(c,c.readVarint()+c.pos)):u===4?a.linear_gradients.push(function(p,g){return p.readFields(sme,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},g)}(c,c.readVarint()+c.pos)):u===5?a.radial_gradients.push(function(p,g){return p.readFields(ome,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},g)}(c,c.readVarint()+c.pos)):u===7?a.clip_paths.push(function(p,g){return p.readFields(lme,{children:[]},g)}(c,c.readVarint()+c.pos)):u===8&&a.masks.push(function(p,g){const x=p.readFields(cme,{left:0,width:20,mask_type:A8.MASK_TYPE_LUMINANCE,children:[]},g);return x.height==null&&(x.height=x.width),x.top==null&&(x.top=x.left),x}(c,c.readVarint()+c.pos))}function LC(u,a){return u.readFields(Qpe,{},a)}function Qpe(u,a,c){u===1?(a.group=function(p,g){return p.readFields(eme,{opacity:255,children:[]},g)}(c,c.readVarint()+c.pos),a.node="group"):u===2&&(a.path=function(p,g){return p.readFields(rme,{paint_order:1,commands:[],step:1,diffs:[],rule:zM.PATH_RULE_NON_ZERO},g)}(c,c.readVarint()+c.pos),a.node="path")}function eme(u,a,c){u===1?a.transform=FC(c,c.readVarint()+c.pos):u===2?a.opacity=c.readVarint():u===5?a.clip_path_idx=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(LC(c,c.readVarint()+c.pos))}function FC(u,a){return u.readFields(tme,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},a)}function tme(u,a,c){u===1?a.sx=c.readFloat():u===2?a.ky=c.readFloat():u===3?a.kx=c.readFloat():u===4?a.sy=c.readFloat():u===5?a.tx=c.readFloat():u===6&&(a.ty=c.readFloat())}function rme(u,a,c){u===1?a.fill=function(p,g){return p.readFields(nme,{rgb_color:FM,paint:"rgb_color",opacity:255},g)}(c,c.readVarint()+c.pos):u===2?a.stroke=function(p,g){return p.readFields(ime,{rgb_color:FM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},g)}(c,c.readVarint()+c.pos):u===3?a.paint_order=c.readVarint():u===5?c.readPackedVarint(a.commands):u===6?a.step=c.readFloat():u===7?c.readPackedSVarint(a.diffs):u===8&&(a.rule=c.readVarint())}function nme(u,a,c){u===1?(a.rgb_color=zC(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5&&(a.opacity=c.readVarint())}function zC(u){return new hi((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function ime(u,a,c){u===1?(a.rgb_color=zC(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5?c.readPackedFloat(a.dasharray):u===6?a.dashoffset=c.readFloat():u===7?a.miterlimit=c.readFloat():u===8?a.opacity=c.readVarint():u===9?a.width=c.readFloat():u===10?a.linecap=c.readVarint():u===11&&(a.linejoin=c.readVarint())}function sme(u,a,c){u===1?a.transform=FC(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(P8(c,c.readVarint()+c.pos)):u===4?a.x1=c.readFloat():u===5?a.y1=c.readFloat():u===6?a.x2=c.readFloat():u===7&&(a.y2=c.readFloat())}function P8(u,a){return u.readFields(ame,{offset:0,opacity:255,rgb_color:FM},a)}function ame(u,a,c){u===1?a.offset=c.readFloat():u===2?a.opacity=c.readVarint():u===3&&(a.rgb_color=zC(c.readVarint()))}function ome(u,a,c){u===1?a.transform=FC(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(P8(c,c.readVarint()+c.pos)):u===4?a.cx=c.readFloat():u===5?a.cy=c.readFloat():u===6?a.r=c.readFloat():u===7?a.fx=c.readFloat():u===8?a.fy=c.readFloat():u===9&&(a.fr=c.readFloat())}function lme(u,a,c){u===1?a.transform=FC(c,c.readVarint()+c.pos):u===2?a.clip_path_idx=c.readVarint():u===3&&a.children.push(LC(c,c.readVarint()+c.pos))}function cme(u,a,c){u===1?a.left=a.top=c.readFloat():u===2?a.width=a.height=c.readFloat():u===3?a.top=c.readFloat():u===4?a.height=c.readFloat():u===5?a.mask_type=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(LC(c,c.readVarint()+c.pos))}class ume{static calculate(a={},c=[]){const p=new Map,g=new Map;if(Object.keys(a).length===0)return p;c.forEach(x=>{g.set(x.name,x.rgb_color||new hi(0,0,0))});for(const[x,b]of Object.entries(a))g.has(x)?p.set(g.get(x).toString(),b):console.warn(`Ignoring unknown image variable "${x}"`);return p}}function jx(u,a=255,c){const p=a/255,g=u.toString(),x=c.has(g)?c.get(g).clone():u.clone();return x.a*=p,x.toString()}function AS(u,a){if(!Pl()){const c=document.createElement("canvas");return c.width=u,c.height=a,c}return new OffscreenCanvas(u,a)}function dme(u,a){const c=ume.calculate(a.params,u.metadata?u.metadata.variables:[]),p=u.usvg_tree,g=p.width,x=p.height,b=a.transform?a.transform:new DOMMatrix,C=Math.max(1,Math.round(g*b.a)),I=Math.max(1,Math.round(x*b.d)),D=new DOMMatrix([C/g,0,0,I/x,0,0]),U=AS(C,I).getContext("2d");return $M(U,D,p,p,c),U.getImageData(0,0,C,I)}function $M(u,a,c,p,g){for(const x of p.children)O8(u,a,c,x,g)}function O8(u,a,c,p,g){p.group?(u.save(),function(x,b,C,I,D){const U=I.mask_idx!=null?C.masks[I.mask_idx]:null,q=I.clip_path_idx!=null?C.clip_paths[I.clip_path_idx]:null;if(I.transform&&(b=Px(I.transform).preMultiplySelf(b)),!function(J,oe,ce){return J.opacity!==255||oe||ce}(I,q!=null,U!=null))return void $M(x,b,C,I,D);const H=AS(x.canvas.width,x.canvas.height),Y=H.getContext("2d");$M(Y,b,C,I,D),q&&L8(Y,b,C,q),U&&F8(Y,b,C,U,D),x.globalAlpha=I.opacity/255,x.drawImage(H,0,0)}(u,a,c,p.group,g),u.restore()):p.path&&(u.save(),function(x,b,C,I,D){x.setTransform(b),I.paint_order===Gpe.PAINT_ORDER_FILL_AND_STROKE?(k8(x,C,I,D),I8(x,C,I,D)):(I8(x,C,I,D),k8(x,C,I,D))}(u,a,c,p.path,g),u.restore())}function k8(u,a,c,p){const g=c.fill;if(!g)return;const x=g.opacity/255;switch(u.save(),u.beginPath(),z8(c,u),g.paint){case"rgb_color":u.fillStyle=jx(g.rgb_color,g.opacity,p);break;case"linear_gradient_idx":{const b=a.linear_gradients[g.linear_gradient_idx];b.transform&&u.setTransform(Px(b.transform).preMultiplySelf(u.getTransform())),u.fillStyle=R8(u,b,x,p);break}case"radial_gradient_idx":{const b=a.radial_gradients[g.radial_gradient_idx];b.transform&&u.setTransform(Px(b.transform).preMultiplySelf(u.getTransform())),u.fillStyle=M8(u,b,x,p)}}u.fill(N8(c)),u.restore()}function N8(u){return u.rule===zM.PATH_RULE_NON_ZERO?"nonzero":u.rule===zM.PATH_RULE_EVEN_ODD?"evenodd":void 0}function I8(u,a,c,p){const g=c.stroke;if(!g)return;const x=B8(c);u.lineWidth=g.width,u.miterLimit=g.miterlimit,u.setLineDash(g.dasharray),u.lineDashOffset=g.dashoffset;const b=g.opacity/255;switch(g.paint){case"rgb_color":u.strokeStyle=jx(g.rgb_color,g.opacity,p);break;case"linear_gradient_idx":u.strokeStyle=R8(u,a.linear_gradients[g.linear_gradient_idx],b,p,!0);break;case"radial_gradient_idx":u.strokeStyle=M8(u,a.radial_gradients[g.radial_gradient_idx],b,p,!0)}switch(g.linejoin){case DC.LINE_JOIN_MITER_CLIP:case DC.LINE_JOIN_MITER:u.lineJoin="miter";break;case DC.LINE_JOIN_ROUND:u.lineJoin="round";break;case DC.LINE_JOIN_BEVEL:u.lineJoin="bevel"}switch(g.linecap){case BM.LINE_CAP_BUTT:u.lineCap="butt";break;case BM.LINE_CAP_ROUND:u.lineCap="round";break;case BM.LINE_CAP_SQUARE:u.lineCap="square"}u.stroke(x)}function R8(u,a,c,p,g=!1){if(a.stops.length===1){const H=a.stops[0];return jx(H.rgb_color,H.opacity*c,p)}const{x1:x,y1:b,x2:C,y2:I}=a;let D=new DOMPoint(x,b),U=new DOMPoint(C,I);if(g){const H=Px(a.transform);D=H.transformPoint(D),U=H.transformPoint(U)}const q=u.createLinearGradient(D.x,D.y,U.x,U.y);for(const H of a.stops)q.addColorStop(H.offset,jx(H.rgb_color,H.opacity*c,p));return q}function M8(u,a,c,p,g=!1){if(a.stops.length===1){const he=a.stops[0];return jx(he.rgb_color,he.opacity*c,p)}const x=Px(a.transform),{fx:b,fy:C,fr:I,cx:D,cy:U,r:q}=a;let H=new DOMPoint(b,C),Y=new DOMPoint(D,U),J=I,oe=q;if(g){H=x.transformPoint(H),Y=x.transformPoint(Y);const he=(x.a+x.d)/2;J=I*he,oe=a.r*he}const ce=u.createRadialGradient(H.x,H.y,J,Y.x,Y.y,oe);for(const he of a.stops)ce.addColorStop(he.offset,jx(he.rgb_color,he.opacity*c,p));return ce}function D8(u,a,c,p){const g=p.transform?Px(p.transform).preMultiplySelf(a):a,x=AS(u.canvas.width,u.canvas.height),b=x.getContext("2d");for(const I of p.children)if(I.group)D8(b,g,c,I.group);else if(I.path){const D=I.path,U=new Path2D;U.addPath(B8(D),g),b.fill(U,N8(D))}const C=p.clip_path_idx!=null?c.clip_paths[p.clip_path_idx]:null;C&&L8(b,g,c,C),u.globalCompositeOperation="source-over",u.drawImage(x,0,0)}function L8(u,a,c,p){const g=AS(u.canvas.width,u.canvas.height);D8(g.getContext("2d"),a,c,p),u.globalCompositeOperation="destination-in",u.drawImage(g,0,0)}function F8(u,a,c,p,g){if(p.children.length===0)return;const x=p.mask_idx!=null?c.masks[p.mask_idx]:null;x&&F8(u,a,c,x,g);const b=u.canvas.width,C=u.canvas.height,I=AS(b,C),D=I.getContext("2d"),U=p.width,q=p.height,H=p.left,Y=p.top,J=new Path2D,oe=new Path2D;oe.rect(H,Y,U,q),J.addPath(oe,a),D.clip(J);for(const we of p.children)O8(D,a,c,we,g);const ce=D.getImageData(0,0,b,C),he=ce.data;if(p.mask_type===A8.MASK_TYPE_LUMINANCE)for(let we=0;we<he.length;we+=4)he[we+3]=he[we+3]/255*(.2126*he[we]+.7152*he[we+1]+.0722*he[we+2]);D.putImageData(ce,0,0),u.globalCompositeOperation="destination-in",u.drawImage(I,0,0)}function Px(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function z8(u,a){const c=u.step;let p=u.diffs[0]*c,g=u.diffs[1]*c;a.moveTo(p,g);for(let x=0,b=2;x<u.commands.length;x++)switch(u.commands[x]){case TS.PATH_COMMAND_MOVE:p+=u.diffs[b++]*c,g+=u.diffs[b++]*c,a.moveTo(p,g);break;case TS.PATH_COMMAND_LINE:p+=u.diffs[b++]*c,g+=u.diffs[b++]*c,a.lineTo(p,g);break;case TS.PATH_COMMAND_QUAD:{const C=p+u.diffs[b++]*c,I=g+u.diffs[b++]*c;p=C+u.diffs[b++]*c,g=I+u.diffs[b++]*c,a.quadraticCurveTo(C,I,p,g);break}case TS.PATH_COMMAND_CUBIC:{const C=p+u.diffs[b++]*c,I=g+u.diffs[b++]*c,D=C+u.diffs[b++]*c,U=I+u.diffs[b++]*c;p=D+u.diffs[b++]*c,g=U+u.diffs[b++]*c,a.bezierCurveTo(C,I,D,U,p,g);break}case TS.PATH_COMMAND_CLOSE:a.closePath()}return a}function B8(u){return z8(u,new Path2D)}class BC{constructor(a){this.capacity=a,this.cache=new Map}get(a){if(!this.cache.has(a))return;const c=this.cache.get(a);return this.cache.delete(a),this.cache.set(a,c),c}put(a,c){this.cache.has(a)?this.cache.delete(a):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(a,c)}delete(a){this.cache.delete(a)}}_r(BC,"LRUCache");class UM{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(a){return new To(a,a.data)}getFromCache(a,c,p){return this.cacheMap.has(p)||this.cacheMap.set(p,new BC(150)),this.cacheMap.get(p).get(xf(a.toString(),c))}setInCache(a,c,p,g){this.cacheDependenciesMap.has(g)||this.cacheDependenciesMap.set(g,new Map),this.cacheMap.has(g)||this.cacheMap.set(g,new BC(150));const x=this.cacheDependenciesMap.get(g),b=xf(a.id.toString(),p);x.get(b)||x.set(b,new Set);const C=this.cacheMap.get(g),I=a.toString();x.get(b).add(I),C.put(xf(a.toString(),p),c)}removeImagesFromCacheByIds(a,c,p=0){if(!this.cacheMap.has(p)||!this.cacheDependenciesMap.has(p))return;const g=this.cacheMap.get(p),x=this.cacheDependenciesMap.get(p);for(const b of a){const C=xf(b.toString(),c);if(x.has(C)){for(const I of x.get(C))g.delete(I);x.delete(C)}}}rasterize(a,c,p,g,x=dme){const b=this.getFromCache(a,p,g);if(b)return b.clone();const C=x(c.icon,a.options),I=UM._getImage(C);return this.setInCache(a,I,p,g),I.clone()}}class $8{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,c){const p=this.toIdx(a,c);return{min:this.minimums[p],max:this.maximums[p]}}isLeaf(a,c){return this.leaves[this.toIdx(a,c)]}toIdx(a,c){return c*this.size+a}}function U8(u,a,c,p){let g=0,x=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(p[b])<1e-15){if(c[b]<u[b]||c[b]>a[b])return null}else{const C=1/p[b];let I=(u[b]-c[b])*C,D=(a[b]-c[b])*C;if(I>D){const U=I;I=D,D=U}if(I>g&&(g=I),D<x&&(x=D),g>x)return null}return g}function V8(u,a,c,p,g,x,b,C,I,D,U){const q=p-u,H=g-a,Y=x-c,J=b-u,oe=C-a,ce=I-c,he=U[1]*ce-U[2]*oe,we=U[2]*J-U[0]*ce,Te=U[0]*oe-U[1]*J,Pe=q*he+H*we+Y*Te;if(Math.abs(Pe)<1e-15)return null;const He=1/Pe,Fe=D[0]-u,Ye=D[1]-a,tt=D[2]-c,it=(Fe*he+Ye*we+tt*Te)*He;if(it<0||it>1)return null;const Tt=Ye*Y-tt*H,ft=tt*q-Fe*Y,At=Fe*H-Ye*q,Rt=(U[0]*Tt+U[1]*ft+U[2]*At)*He;return Rt<0||it+Rt>1?null:(J*Tt+oe*ft+ce*At)*He}function q8(u,a,c){return(u-a)/(c-a)}function H8(u,a,c,p,g,x,b,C,I){const D=1<<c,U=x-p,q=b-g,H=(u+1)/D*U+p,Y=(a+0)/D*q+g,J=(a+1)/D*q+g;C[0]=(u+0)/D*U+p,C[1]=Y,I[0]=H,I[1]=J}class G8{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(x){const b=Math.ceil(Math.log2(x.dim/8)),C=[];let I=Math.ceil(Math.pow(2,b));const D=1/I,U=(Y,J,oe,ce,he)=>{const we=ce?1:0,Te=(Y+1)*oe-we,Pe=J*oe,He=(J+1)*oe-we;he[0]=Y*oe,he[1]=Pe,he[2]=Te,he[3]=He};let q=new $8(I);const H=[];for(let Y=0;Y<I*I;Y++){U(Y%I,Math.floor(Y/I),D,!1,H);const J=cm(H[0],H[1],x),oe=cm(H[2],H[1],x),ce=cm(H[2],H[3],x),he=cm(H[0],H[3],x);q.minimums.push(Math.min(J,oe,ce,he)),q.maximums.push(Math.max(J,oe,ce,he)),q.leaves.push(1)}for(C.push(q),I/=2;I>=1;I/=2){const Y=C[C.length-1];q=new $8(I);for(let J=0;J<I*I;J++){U(J%I,Math.floor(J/I),2,!0,H);const oe=Y.getElevation(H[0],H[1]),ce=Y.getElevation(H[2],H[1]),he=Y.getElevation(H[2],H[3]),we=Y.getElevation(H[0],H[3]),Te=Y.isLeaf(H[0],H[1]),Pe=Y.isLeaf(H[2],H[1]),He=Y.isLeaf(H[2],H[3]),Fe=Y.isLeaf(H[0],H[3]),Ye=Math.min(oe.min,ce.min,he.min,we.min),tt=Math.max(oe.max,ce.max,he.max,we.max),it=Te&&Pe&&He&&Fe;q.maximums.push(tt),q.minimums.push(Ye),q.leaves.push(tt-Ye<=5&&it?1:0)}C.push(q)}return C}(this.dem),p=c.length-1,g=c[p];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(c,0,0,p,0)}raycastRoot(a,c,p,g,x,b,C=1){return U8([a,c,-100],[p,g,this.maximums[0]*C],x,b)}raycast(a,c,p,g,x,b,C=1){if(!this.nodeCount)return null;const I=this.raycastRoot(a,c,p,g,x,b,C);if(I==null)return null;const D=[],U=[],q=[],H=[],Y=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:J,t:oe,nodex:ce,nodey:he,depth:we}=Y.pop();if(this.leaves[J]){H8(ce,he,we,a,c,p,g,q,H);const Pe=1<<we,He=(ce+0)/Pe,Fe=(ce+1)/Pe,Ye=(he+0)/Pe,tt=(he+1)/Pe,it=cm(He,Ye,this.dem)*C,Tt=cm(Fe,Ye,this.dem)*C,ft=cm(Fe,tt,this.dem)*C,At=cm(He,tt,this.dem)*C,Rt=V8(q[0],q[1],it,H[0],q[1],Tt,H[0],H[1],ft,x,b),Bt=V8(H[0],H[1],ft,q[0],H[1],At,q[0],q[1],it,x,b),er=Math.min(Rt!==null?Rt:Number.MAX_VALUE,Bt!==null?Bt:Number.MAX_VALUE);if(er!==Number.MAX_VALUE)return er;{const Wt=Xe([],x,b,oe);if(W8(it,Tt,At,ft,q8(Wt[0],q[0],H[0]),q8(Wt[1],q[1],H[1]))>=Wt[2])return oe}continue}let Te=0;for(let Pe=0;Pe<this._siblingOffset.length;Pe++){H8((ce<<1)+this._siblingOffset[Pe][0],(he<<1)+this._siblingOffset[Pe][1],we+1,a,c,p,g,q,H),q[2]=-100,H[2]=this.maximums[this.childOffsets[J]+Pe]*C;const He=U8(q,H,x,b);if(He!=null){const Fe=He;D[Pe]=Fe;let Ye=!1;for(let tt=0;tt<Te&&!Ye;tt++)Fe>=D[U[tt]]&&(U.splice(tt,0,Pe),Ye=!0);Ye||(U[Te]=Pe),Te++}}for(let Pe=0;Pe<Te;Pe++){const He=U[Pe];Y.push({idx:this.childOffsets[J]+He,t:D[He],nodex:(ce<<1)+this._siblingOffset[He][0],nodey:(he<<1)+this._siblingOffset[He][1],depth:we+1})}}return null}_addNode(a,c,p){return this.minimums.push(a),this.maximums.push(c),this.leaves.push(p),this.childOffsets.push(0),this.nodeCount++}_construct(a,c,p,g,x){if(a[g].isLeaf(c,p)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const b=g-1,C=a[b];let I=0,D=0;for(let U=0;U<this._siblingOffset.length;U++){const q=2*c+this._siblingOffset[U][0],H=2*p+this._siblingOffset[U][1],Y=C.getElevation(q,H),J=C.isLeaf(q,H),oe=this._addNode(Y.min,Y.max,J);J&&(I|=1<<U),D||(D=oe)}for(let U=0;U<this._siblingOffset.length;U++)I&1<<U||this._construct(a,2*c+this._siblingOffset[U][0],2*p+this._siblingOffset[U][1],b,D+U)}}function W8(u,a,c,p,g,x){return Kr(Kr(u,c,x),Kr(a,p,x),g)}function cm(u,a,c){const p=c.dim,g=ve(u*p-.5,0,p-1),x=ve(a*p-.5,0,p-1),b=Math.floor(g),C=Math.floor(x),I=Math.min(b+1,p-1),D=Math.min(C+1,p-1);return W8(c.get(b,C),c.get(I,C),c.get(b,D),c.get(I,D),g-b,x-C)}const hme={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function fme(u,a,c){return(256*u*256+256*a+c)/10-1e4}function pme(u,a,c){return 256*u+a+c/256-32768}class $C{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,c,p,g=!1){if(this.uid=a,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return void zr(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const x=this.dim=c.height-2,b=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let I=0;I<x;I++)b[this._idx(-1,I)]=b[this._idx(0,I)],b[this._idx(x,I)]=b[this._idx(x-1,I)],b[this._idx(I,-1)]=b[this._idx(I,0)],b[this._idx(I,x)]=b[this._idx(I,x-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(x,-1)]=b[this._idx(x-1,0)],b[this._idx(-1,x)]=b[this._idx(0,x-1)],b[this._idx(x,x)]=b[this._idx(x-1,x-1)]}const C=p==="terrarium"?pme:fme;for(let I=0;I<b.length;++I){const D=4*I;this.floatView[I]=C(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=Ol.now()}_buildQuadTree(){this._tree=new G8(this)}get(a,c,p=!1){p&&(a=ve(a,-1,this.dim),c=ve(c,-1,this.dim));const g=this._idx(a,c);return this.floatView[g]}set(a,c,p){const g=this._idx(a,c),x=this.floatView[g];return this.floatView[g]=p,p-x}static getUnpackVector(a){return hme[a]}_idx(a,c){if(a<-1||a>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(a+1)}static pack(a,c){const p=[0,0,0,0],g=$C.getUnpackVector(c);let x=Math.floor((a+g[3])/g[2]);return p[2]=x%256,x=Math.floor(x/256),p[1]=x%256,x=Math.floor(x/256),p[0]=x,p}getPixels(){return new BU({width:this.stride,height:this.stride},this.pixels)}backfillBorder(a,c,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,x=c*this.dim+this.dim,b=p*this.dim,C=p*this.dim+this.dim;switch(c){case-1:g=x-1;break;case 1:x=g+1}switch(p){case-1:b=C-1;break;case 1:C=b+1}const I=-c*this.dim,D=-p*this.dim;for(let U=b;U<C;U++)for(let q=g;q<x;q++){const H=4*this._idx(q,U),Y=4*this._idx(q+I,U+D);this.pixels[H+0]=a.pixels[Y+0],this.pixels[H+1]=a.pixels[Y+1],this.pixels[H+2]=a.pixels[Y+2],this.pixels[H+3]=a.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function mme(u,a,c){u===1?a.headerLength=c.readFixed32():u===2?a.x=c.readVarint():u===3?a.y=c.readVarint():u===4?a.z=c.readVarint():u===5&&a.layers.push(function(p,g){return p.readFields(xme,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)}(c,c.readVarint()+c.pos))}function gme(u,a,c){u===1?(a.delta_filter=function(p,g){return p.readFields(yme,{blockSize:0},g)}(c,c.readVarint()+c.pos),a.filter="delta_filter"):u===2?(c.readVarint(),a.filter="zigzag_filter"):u===3?(c.readVarint(),a.filter="bitshuffle_filter"):u===4&&(c.readVarint(),a.filter="byteshuffle_filter")}function yme(u,a,c){u===1&&(a.blockSize=c.readVarint())}function vme(u,a,c){u===1?(c.readVarint(),a.codec="gzip_data"):u===2?(c.readVarint(),a.codec="jpeg_image"):u===3?(c.readVarint(),a.codec="webp_image"):u===4&&(c.readVarint(),a.codec="png_image")}function _me(u,a,c){let p=0,g=0;u===1?a.firstByte=c.readFixed64():u===2?a.lastByte=c.readFixed64():u===3?a.filters.push(function(x,b){return x.readFields(gme,{},b)}(c,c.readVarint()+c.pos)):u===4?a.codec=function(x,b){return x.readFields(vme,{},b)}(c,c.readVarint()+c.pos):u===5?g=c.readFloat():u===6?p=c.readFloat():u===7?a.bands.push(c.readString()):u===8?a.offset=c.readDouble():u===9&&(a.scale=c.readDouble()),a.offset===0&&(a.offset=g),a.scale===0&&(a.scale=p)}function xme(u,a,c){u===1?a.version=c.readVarint():u===2?a.name=c.readString():u===3?a.units=c.readString():u===4?a.tileSize=c.readVarint():u===5?a.buffer=c.readVarint():u===6?a.pixelFormat=c.readVarint():u===7&&a.dataIndex.push(function(p,g){return p.readFields(_me,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)}(c,c.readVarint()+c.pos))}function bme(u,a,c){if(u===2)(function(p,g,x){p.readFields(wme,x,g)})(c,c.readVarint()+c.pos,a);else if(u===3)throw new Error("Not implemented")}function wme(u,a,c){if(u===1){let p=0;const g=c.readVarint()+c.pos;for(;c.pos<g;)a[p++]=c.readVarint()}}function Sme(u,a){if(a.length!==4)throw new Error(`Expected data of dimension 4 but got ${a.length}.`);let c=a[3];for(let p=2;p>=1;p--){const g=p===1?1:0,x=p===2?1:0;for(let b=0;b<a[0];b++){const C=a[1]*b;for(let I=g;I<a[1];I++){const D=a[2]*(I+C);for(let U=x;U<a[2];U++){const q=a[3]*(U+D);for(let H=0;H<a[3];H++){const Y=q+H;u[Y]+=u[Y-c]}}}}c*=a[p]}return u}function Eme(u){for(let a=0,c=u.length;a<c;a++)u[a]=u[a]>>>1^-(1&u[a]);return u}function Tme(u,a){switch(a){case"uint32":return u;case"uint16":for(let c=0;c<u.length;c+=2){const p=u[c],g=u[c+1];u[c]=(240&p)>>4|(61440&p)>>8|(240&g)<<4|61440&g,u[c+1]=15&p|(3840&p)>>4|(15&g)<<8|(3840&g)<<4}return u;case"uint8":for(let c=0;c<u.length;c+=4){const p=u[c],g=u[c+1],x=u[c+2],b=u[c+3];u[c+0]=(192&p)>>6|(192&g)>>4|(192&x)>>2|192&b,u[c+1]=(48&p)>>4|(48&g)>>2|48&x|(48&b)<<2,u[c+2]=(12&p)>>2|12&g|(12&x)<<2|(12&b)<<4,u[c+3]=3&p|(3&g)<<2|(3&x)<<4|(3&b)<<6}return u;default:throw new Error(`Invalid pixel format, "${a}"`)}}_r($C,"DEMData"),_r(G8,"DemMinMaxQuadTree",{omit:["dem"]});var ru=Uint8Array,CS=Uint16Array,Ame=Int32Array,K8=new ru([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Z8=new ru([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Cme=new ru([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X8=function(u,a){for(var c=new CS(31),p=0;p<31;++p)c[p]=a+=1<<u[p-1];var g=new Ame(c[30]);for(p=1;p<30;++p)for(var x=c[p];x<c[p+1];++x)g[x]=x-c[p]<<5|p;return{b:c,r:g}},Y8=X8(K8,2),J8=Y8.b,jme=Y8.r;J8[28]=258,jme[258]=28;for(var Pme=X8(Z8,0).b,Q8=new CS(32768),ua=0;ua<32768;++ua){var Ox=(43690&ua)>>1|(21845&ua)<<1;Q8[ua]=((65280&(Ox=(61680&(Ox=(52428&Ox)>>2|(13107&Ox)<<2))>>4|(3855&Ox)<<4))>>8|(255&Ox)<<8)>>1}var jS=function(u,a,c){for(var p=u.length,g=0,x=new CS(a);g<p;++g)u[g]&&++x[u[g]-1];var b,C=new CS(a);for(g=1;g<a;++g)C[g]=C[g-1]+x[g-1]<<1;b=new CS(1<<a);var I=15-a;for(g=0;g<p;++g)if(u[g])for(var D=g<<4|u[g],U=a-u[g],q=C[u[g]-1]++<<U,H=q|(1<<U)-1;q<=H;++q)b[Q8[q]>>I]=D;return b},PS=new ru(288);for(ua=0;ua<144;++ua)PS[ua]=8;for(ua=144;ua<256;++ua)PS[ua]=9;for(ua=256;ua<280;++ua)PS[ua]=7;for(ua=280;ua<288;++ua)PS[ua]=8;var eq=new ru(32);for(ua=0;ua<32;++ua)eq[ua]=5;var Ome=jS(PS,9),kme=jS(eq,5),VM=function(u){for(var a=u[0],c=1;c<u.length;++c)u[c]>a&&(a=u[c]);return a},_d=function(u,a,c){var p=a/8|0;return(u[p]|u[p+1]<<8)>>(7&a)&c},qM=function(u,a){var c=a/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(7&a)},Nme=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xd=function(u,a,c){var p=new Error(a||Nme[u]);if(p.code=u,Error.captureStackTrace&&Error.captureStackTrace(p,xd),!c)throw p;return p},Ime=new ru(0),Rme=typeof TextDecoder<"u"&&new TextDecoder;try{Rme.decode(Ime,{stream:!0})}catch{}const Mme={gzip_data:"gzip"};class Iu extends Error{constructor(a){super(a),this.name="MRTError"}}const Dme={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},tq={uint32:1,uint16:2,uint8:4},Lme={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let HM;class UC{constructor(a=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=a}getLayer(a){const c=this.layers[a];if(!c)throw new Iu(`Layer '${a}' not found`);return c}getHeaderLength(a){const c=new Uint8Array(a),p=new DataView(a);if(c[0]!==13)throw new Iu("File is not a valid MRT.");return p.getUint32(1,!0)}parseHeader(a){const c=new Uint8Array(a),p=this.getHeaderLength(a);if(c.length<p)throw new Iu(`Expected header with length >= ${p} but got buffer of length ${c.length}`);const g=new HM(c.subarray(0,p)).readFields(mme,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new Iu(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const x of g.layers)this.layers[x.name]=new rq(x,{cacheSize:this._cacheSize});return this}createDecodingTask(a){const c=[],p=this.getLayer(a.layerName);for(let g of a.blockIndices){const x=p.dataIndex[g],b=x.firstByte-a.firstByte,C=x.lastByte-a.firstByte;if(p._blocksInProgress.has(g))continue;const I={layerName:p.name,firstByte:b,lastByte:C,pixelFormat:p.pixelFormat,blockIndex:g,blockShape:[x.bands.length].concat(p.bandShape),buffer:p.buffer,codec:x.codec.codec,filters:x.filters.map(D=>D.filter)};p._blocksInProgress.add(g),c.push(I)}return new nq(c,()=>{c.forEach(g=>p._blocksInProgress.delete(g.blockIndex))},(g,x)=>{if(c.forEach(b=>p._blocksInProgress.delete(b.blockIndex)),g)throw g;x.forEach(b=>{this.getLayer(b.layerName).processDecodedData(b)})})}}class rq{constructor({version:a,name:c,units:p,tileSize:g,pixelFormat:x,buffer:b,dataIndex:C},I){if(this.version=a,this.version!==1)throw new Iu(`Cannot parse raster layer encoded with MRT version ${a}`);this.name=c,this.units=p,this.tileSize=g,this.buffer=b,this.pixelFormat=Dme[x],this.dataIndex=C,this.bandShape=[g+2*b,g+2*b,tq[this.pixelFormat]],this._decodedBlocks=new BC(I?I.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return tq[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:a})=>a).flat()}processDecodedData(a){const c=a.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,a.data)}getBlockForBand(a){let c=0;switch(typeof a){case"string":for(const[p,g]of this.dataIndex.entries()){for(const[x,b]of g.bands.entries())if(b===a)return{bandIndex:c+x,blockIndex:p,blockBandIndex:x};c+=g.bands.length}break;case"number":for(const[p,g]of this.dataIndex.entries()){if(a>=c&&a<c+g.bands.length)return{bandIndex:a,blockIndex:p,blockBandIndex:a-c};c+=g.bands.length}break;default:throw new Iu(`Invalid band \`${JSON.stringify(a)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(a){let c=1/0,p=-1/0;const g=[],x=new Set;for(const b of a){const{blockIndex:C}=this.getBlockForBand(b);if(C<0)throw new Iu(`Invalid band: ${JSON.stringify(b)}`);const I=this.dataIndex[C];g.includes(C)||g.push(C),x.add(C),c=Math.min(c,I.firstByte),p=Math.max(p,I.lastByte)}if(x.size>this.cacheSize)throw new Iu(`Number of blocks to decode (${x.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:p,blockIndices:g}}hasBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0}hasDataForBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(a){const{blockIndex:c,blockBandIndex:p}=this.getBlockForBand(a);if(c<0)throw new Iu(`Band not found: ${JSON.stringify(a)}`);const g=this._decodedBlocks.get(c.toString());if(!g)throw new Iu(`Data for band ${JSON.stringify(a)} of layer "${this.name}" not decoded.`);const x=this.dataIndex[c],b=this.bandShape.reduce((D,U)=>D*U,1),C=p*b,I=g.subarray(C,C+b);return{data:I,bytes:new Uint8Array(I.buffer).subarray(I.byteOffset,I.byteOffset+I.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:x.offset,scale:x.scale}}}UC.setPbf=function(u){HM=u};class nq{constructor(a,c,p){this.tasks=a,this._onCancel=c,this._onComplete=p,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(a,c){this._finalized||(this._onComplete(a,c),this._finalized=!0)}}UC.performDecoding=function(u,a){const c=new Uint8Array(u);return Promise.all(a.tasks.map(p=>{const{layerName:g,firstByte:x,lastByte:b,pixelFormat:C,blockShape:I,blockIndex:D,filters:U,codec:q}=p,H=c.subarray(x,b+1),Y=new Uint32Array(I[0]*I[1]*I[2]);let J;if(q!=="gzip_data")throw new Iu(`Unhandled codec: ${q}`);return J=function(oe,ce){if(!globalThis.DecompressionStream&&ce==="gzip_data")return Promise.resolve(((Pe=function(Ye){Ye[0]==31&&Ye[1]==139&&Ye[2]==8||xd(6,"invalid gzip data");var tt=Ye[3],it=10;4&tt&&(it+=2+(Ye[10]|Ye[11]<<8));for(var Tt=(tt>>3&1)+(tt>>4&1);Tt>0;Tt-=!Ye[it++]);return it+(2&tt)}(Te=oe))+8>Te.length&&xd(6,"invalid gzip data"),function(Ye,tt,it,Tt){var ft=Ye.length;if(!ft||tt.f&&!tt.l)return it||new ru(0);var At=!it,Rt=At||tt.i!=2,Bt=tt.i;At&&(it=new ru(3*ft));var er,Wt,Lt=function(vs){var es=it.length;if(vs>es){var zi=new ru(Math.max(2*es,vs));zi.set(it),it=zi}},Gt=tt.f||0,wt=tt.p||0,xt=tt.b||0,Vt=tt.l,Yt=tt.d,Ft=tt.m,gr=tt.n,br=8*ft;do{if(!Vt){Gt=_d(Ye,wt,1);var hr=_d(Ye,wt+1,3);if(wt+=3,!hr){var ar=Ye[(ze=4+((wt+7)/8|0))-4]|Ye[ze-3]<<8,en=ze+ar;if(en>ft){Bt&&xd(0);break}Rt&&Lt(xt+ar),it.set(Ye.subarray(ze,en),xt),tt.b=xt+=ar,tt.p=wt=8*en,tt.f=Gt;continue}if(hr==1)Vt=Ome,Yt=kme,Ft=9,gr=5;else if(hr==2){var lr=_d(Ye,wt,31)+257,Lr=_d(Ye,wt+10,15)+4,nn=lr+_d(Ye,wt+5,31)+1;wt+=14;for(var wn=new ru(nn),Vn=new ru(19),an=0;an<Lr;++an)Vn[Cme[an]]=_d(Ye,wt+3*an,7);wt+=3*Lr;var ti=VM(Vn),ri=(1<<ti)-1,ls=jS(Vn,ti);for(an=0;an<nn;){var ze,Re=ls[_d(Ye,wt,ri)];if(wt+=15&Re,(ze=Re>>4)<16)wn[an++]=ze;else{var Pt=0,sr=0;for(ze==16?(sr=3+_d(Ye,wt,3),wt+=2,Pt=wn[an-1]):ze==17?(sr=3+_d(Ye,wt,7),wt+=3):ze==18&&(sr=11+_d(Ye,wt,127),wt+=7);sr--;)wn[an++]=Pt}}var Ot=wn.subarray(0,lr),or=wn.subarray(lr);Ft=VM(Ot),gr=VM(or),Vt=jS(Ot,Ft),Yt=jS(or,gr)}else xd(1);if(wt>br){Bt&&xd(0);break}}Rt&&Lt(xt+131072);for(var jr=(1<<Ft)-1,Tr=(1<<gr)-1,ln=wt;;ln=wt){var qr=(Pt=Vt[qM(Ye,wt)&jr])>>4;if((wt+=15&Pt)>br){Bt&&xd(0);break}if(Pt||xd(2),qr<256)it[xt++]=qr;else{if(qr==256){ln=wt,Vt=null;break}var Sr=qr-254;qr>264&&(Sr=_d(Ye,wt,(1<<(Wr=K8[an=qr-257]))-1)+J8[an],wt+=Wr);var Yn=Yt[qM(Ye,wt)&Tr],Ai=Yn>>4;if(Yn||xd(3),wt+=15&Yn,or=Pme[Ai],Ai>3){var Wr=Z8[Ai];or+=qM(Ye,wt)&(1<<Wr)-1,wt+=Wr}if(wt>br){Bt&&xd(0);break}Rt&&Lt(xt+131072);var Bn=xt+Sr;if(xt<or){var Ci=0-or,fi=Math.min(or,Bn);for(Ci+xt<0&&xd(3);xt<fi;++xt)it[xt]=(void 0)[Ci+xt]}for(;xt<Bn;++xt)it[xt]=it[xt-or]}}tt.l=Vt,tt.p=ln,tt.b=xt,tt.f=Gt,Vt&&(Gt=1,tt.m=Ft,tt.d=Yt,tt.n=gr)}while(!Gt);return xt!=it.length&&At?(er=it,((Wt=xt)==null||Wt>er.length)&&(Wt=er.length),new ru(er.subarray(0,Wt))):it.subarray(0,xt)}(Te.subarray(Pe,-8),{i:2},new ru(((he=Te)[(we=he.length)-4]|he[we-3]<<8|he[we-2]<<16|he[we-1]<<24)>>>0))));var he,we,Te,Pe;const He=Mme[ce];if(!He)throw new Error(`Unhandled codec: ${ce}`);const Fe=new globalThis.DecompressionStream(He);return new Response(new Blob([oe]).stream().pipeThrough(Fe)).arrayBuffer().then(Ye=>new Uint8Array(Ye))}(H,q).then(oe=>(function(ce,he){ce.readFields(bme,he)}(new HM(oe),Y),new Lme[C](Y.buffer))),J.then(oe=>{for(let ce=U.length-1;ce>=0;ce--)switch(U[ce]){case"delta_filter":Sme(oe,I);break;case"zigzag_filter":Eme(oe);break;case"bitshuffle_filter":Tme(oe,C);break;default:throw new Iu(`Unhandled filter "${U[ce]}"`)}return{layerName:g,blockIndex:D,data:oe}}).catch(oe=>{throw oe})}))},_r(nq,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),_r(UC,"MapboxRasterTile"),_r(rq,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class iq{constructor(a){this._stringToNumber={},this._numberToString=[];for(let c=0;c<a.length;c++){const p=a[c];this._stringToNumber[p]=c,this._numberToString[c]=p}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}class sq{constructor(a,c){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new vf(rr,16,0),this.featureIndexArray=new BA,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(a,c,p,g,x,b=0,C=0){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,g,x,b);const D=this.grid;for(let U=0;U<c.length;U++){const q=c[U],H=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<q.length;Y++){const J=q[Y];H[0]=Math.min(H[0],J.x),H[1]=Math.min(H[1],J.y),H[2]=Math.max(H[2],J.x),H[3]=Math.max(H[3],J.y)}C!==0&&(H[0]-=C,H[1]-=C,H[2]+=C,H[3]+=C),H[0]<rr&&H[1]<rr&&H[2]>=0&&H[3]>=0&&D.insert(I,H[0],H[1],H[2],H[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wr(new vC(this.rawTileData)).layers,this.sourceLayerCoder=new iq(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,c){const{tilespaceGeometry:p,transform:g,tileTransform:x,pixelPosMatrix:b,availableImages:C,worldview:I}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const D=c.queryRadius?c.queryRadius:0,U=p.bufferedTilespaceBounds,q=this.grid.query(U.min.x,U.min.y,U.max.x,U.max.y,(oe,ce,he,we)=>gs(p.bufferedTilespaceGeometry,oe-D,ce-D,he+D,we+D));q.sort(Fme);let H=null;g.elevation&&q.length>0&&(H=Cx.create(g.elevation,this.tileID));const Y={};let J;for(let oe=0;oe<q.length;oe++){const ce=q[oe];if(ce===J)continue;J=ce;const he=this.featureIndexArray.get(ce);let we=null;this.is3DTile?this.loadMatchingModelFeature(Y,he,a,p,g,I):this.loadMatchingFeature(Y,he,a,C,I,(Te,Pe,He,Fe=0)=>(we||(we=Nt(Te,this.tileID.canonical,x)),Pe.queryIntersectsFeature(p,Te,He,we,this.z,g,b,H,Fe)))}return Y}loadMatchingFeature(a,c,p,g,x,b){const{featureIndex:C,bucketIndex:I,sourceLayerIndex:D,layoutVertexArrayOffset:U}=c,q=this.bucketLayerIDs[I],H=p.layers,Y=Object.keys(H);if(Y.length&&!Jr(Y,q))return;const J=p.sourceCache,oe=this.sourceLayerCoder.decode(D),ce=this.vtLayers[oe].feature(C),he=this.getId(ce,oe);for(let we=0;we<q.length;we++){const Te=q[we];if(!H[Te])continue;const{styleLayer:Pe,targets:He}=H[Te];let Fe={};he!==void 0&&(Fe=J.getFeatureState(Pe.sourceLayer,he));const Ye=!b||b(ce,Pe,Fe,U);if(!Ye)continue;const tt=new Oy(ce,this.z,this.x,this.y,he);tt.tile=this.tileID.canonical,tt.state=Fe;let it=this.serializedLayersCache.get(Te);it||(it=Pe.serialize(),it.id=Te,this.serializedLayersCache.set(Te,it)),tt.source=it.source,tt.sourceLayer=it["source-layer"],tt.layer=Object.assign({},it),tt.layer.paint=aq(it.paint,Pe.paint,ce,Fe,g),tt.layer.layout=aq(it.layout,Pe.layout,ce,Fe,g);let Tt=!1;for(const ft of He){this.updateFeatureProperties(tt,ft);const{filter:At}=ft;if(At){if(ce.properties=tt.properties,At.needGeometry){const Rt=yt(ce,!0);if(!At.filter(new Ui(this.tileID.overscaledZ,{worldview:x}),Rt,this.tileID.canonical))continue}else if(!At.filter(new Ui(this.tileID.overscaledZ,{worldview:x}),ce))continue}Tt=!0,ft.targetId&&this.addFeatureVariant(tt,ft)}Tt&&this.appendToResult(a,Te,C,tt,Ye)}}loadMatchingModelFeature(a,c,p,g,x,b){const{featureIndex:C,bucketIndex:I}=c,D=this.bucketLayerIDs[I],U=p.layers,q=Object.keys(U);if(!q.length||Jr(q,D))for(let H=0;H<D.length;H++){const Y=D[H],{styleLayer:J,targets:oe}=U[Y];if(J.type!=="model")continue;const ce=g.tile,he=ce.getBucket(J);if(!(he&&he instanceof MC))continue;const we=qpe(he,C,g,x);if(!we)continue;const{z:Te,x:Pe,y:He}=ce.tileID.canonical,{feature:Fe,intersectionZ:Ye,position:tt}=we;let it={};Fe.id!==void 0&&(it=p.sourceCache.getFeatureState(J.sourceLayer,Fe.id));const Tt=new Oy({},Te,Pe,He,Fe.id);Tt.tile=this.tileID.canonical,Tt.state=it,Tt.properties=Fe.properties,Tt.geometry={type:"Point",coordinates:[tt.lng,tt.lat]};let ft=this.serializedLayersCache.get(Y);ft||(ft=J.serialize(),ft.id=Y,this.serializedLayersCache.set(Y,ft)),Tt.source=ft.source,Tt.sourceLayer=ft["source-layer"],Tt.layer=Object.assign({},ft);let At=!1;for(const Rt of oe){this.updateFeatureProperties(Tt,Rt);const{filter:Bt}=Rt;if(Bt){if(Fe.properties=Tt.properties,Bt.needGeometry){if(!Bt.filter(new Ui(this.tileID.overscaledZ,{worldview:b}),Fe,this.tileID.canonical))continue}else if(!Bt.filter(new Ui(this.tileID.overscaledZ,{worldview:b}),Fe))continue}At=!0,Rt.targetId&&this.addFeatureVariant(Tt,Rt)}At&&this.appendToResult(a,Y,C,Tt,Ye)}}updateFeatureProperties(a,c,p){if(c.properties){const g={};for(const x in c.properties){const b=c.properties[x].evaluate({zoom:this.z},a._vectorTileFeature,a.state,a.tile,p);b!=null&&(g[x]=b)}a.properties=g}}addFeatureVariant(a,c,p){const g={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(g.properties=a.properties),a.variants=a.variants||{},a.variants[c.targetId]=a.variants[c.targetId]||[],a.variants[c.targetId].push(g)}appendToResult(a,c,p,g,x){let b=a[c];b===void 0&&(b=a[c]=[]),b.push({featureIndex:p,feature:g,intersectionZ:x})}lookupSymbolFeatures(a,c,p,g,x,b){const C={};this.loadVTLayers();for(const I of a)this.loadMatchingFeature(C,{bucketIndex:c,sourceLayerIndex:p,featureIndex:I,layoutVertexArrayOffset:0},g,x,b);return C}loadFeature(a){const{featureIndex:c,sourceLayerIndex:p}=a;this.loadVTLayers();const g=this.sourceLayerCoder.decode(p),x=this.vtFeatures[g];if(x[c])return x[c];const b=this.vtLayers[g].feature(c);return x[c]=b,b}hasLayer(a){for(const c of this.bucketLayerIDs)for(const p of c)if(a===p)return!0;return!1}getId(a,c){let p=a.id;if(this.promoteId){const g=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(g!=null)if(Array.isArray(g)){if(!this.promoteIdExpression){const x=Ou(g);if(x.result!=="success"){const b=x.value.map(C=>`${C.key}: ${C.message}`).join(", ");return void zr(`Failed to create expression for promoteId: ${b}`)}this.promoteIdExpression=x.value}p=this.promoteIdExpression.evaluate({zoom:0},a)}else p=a.properties[g];typeof p=="boolean"&&(p=Number(p))}return p}}function aq(u,a,c,p,g){return Jt(u,(x,b)=>{const C=a instanceof _f?a.get(b):null;return C&&C.evaluate?C.evaluate(c,p,void 0,g):C})}function Fme(u,a){return a-u}_r(sq,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const oq=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class GM{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,p]=new Uint8Array(a,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=p>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=oq[15&p];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(a,2,1),[C]=new Uint32Array(a,4,1);return new GM(C,b,x,a)}constructor(a,c=64,p=Float64Array,g){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=p,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const x=oq.indexOf(this.ArrayType),b=2*a*this.ArrayType.BYTES_PER_ELEMENT,C=a*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-C%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${p}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+C+I,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+b+C+I),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+C+I,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=a)}add(a,c){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=a,this.coords[this._pos++]=c,p}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return WM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,c,p,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:C}=this,I=[0,x.length-1,0],D=[];for(;I.length;){const U=I.pop()||0,q=I.pop()||0,H=I.pop()||0;if(q-H<=C){for(let ce=H;ce<=q;ce++){const he=b[2*ce],we=b[2*ce+1];he>=a&&he<=p&&we>=c&&we<=g&&D.push(x[ce])}continue}const Y=H+q>>1,J=b[2*Y],oe=b[2*Y+1];J>=a&&J<=p&&oe>=c&&oe<=g&&D.push(x[Y]),(U===0?a<=J:c<=oe)&&(I.push(H),I.push(Y-1),I.push(1-U)),(U===0?p>=J:g>=oe)&&(I.push(Y+1),I.push(q),I.push(1-U))}return D}within(a,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:b}=this,C=[0,g.length-1,0],I=[],D=p*p;for(;C.length;){const U=C.pop()||0,q=C.pop()||0,H=C.pop()||0;if(q-H<=b){for(let ce=H;ce<=q;ce++)cq(x[2*ce],x[2*ce+1],a,c)<=D&&I.push(g[ce]);continue}const Y=H+q>>1,J=x[2*Y],oe=x[2*Y+1];cq(J,oe,a,c)<=D&&I.push(g[Y]),(U===0?a-p<=J:c-p<=oe)&&(C.push(H),C.push(Y-1),C.push(1-U)),(U===0?a+p>=J:c+p>=oe)&&(C.push(Y+1),C.push(q),C.push(1-U))}return I}}function WM(u,a,c,p,g,x){if(g-p<=c)return;const b=p+g>>1;lq(u,a,b,p,g,x),WM(u,a,c,p,b-1,1-x),WM(u,a,c,b+1,g,1-x)}function lq(u,a,c,p,g,x){for(;g>p;){if(g-p>600){const D=g-p+1,U=c-p+1,q=Math.log(D),H=.5*Math.exp(2*q/3),Y=.5*Math.sqrt(q*H*(D-H)/D)*(U-D/2<0?-1:1);lq(u,a,c,Math.max(p,Math.floor(c-U*H/D+Y)),Math.min(g,Math.floor(c+(D-U)*H/D+Y)),x)}const b=a[2*c+x];let C=p,I=g;for(OS(u,a,p,c),a[2*g+x]>b&&OS(u,a,p,g);C<I;){for(OS(u,a,C,I),C++,I--;a[2*C+x]<b;)C++;for(;a[2*I+x]>b;)I--}a[2*p+x]===b?OS(u,a,p,I):(I++,OS(u,a,I,g)),I<=c&&(p=I+1),c<=I&&(g=I-1)}}function OS(u,a,c,p){KM(u,c,p),KM(a,2*c,2*p),KM(a,2*c+1,2*p+1)}function KM(u,a,c){const p=u[a];u[a]=u[c],u[c]=p}function cq(u,a,c,p){const g=u-c,x=a-p;return g*g+x*x}i.$=p_,i.A=ad,i.B=xf,i.C=2,i.D=px,i.E=id,i.F=hS,i.G=M6,i.H=f_,i.I=ca,i.J=S1,i.K=Ap,i.L=Jg,i.M=F_,i.N=L_,i.O=u1,i.P=at,i.Q=U_,i.R=of,i.S=qp,i.T=iM,i.U=Ou,i.V=RC,i.W=h1,i.X=Rp,i.Y=Ip,i.Z=iy,i._=Vo,i.a=function(u){return Ji.API_CDN_URL_REGEX.test(u)},i.a$=Kp,i.a0=Xr,i.a1=Dw,i.a2=Hp,i.a3=class extends RC{},i.a4=z_,i.a5=c1,i.a6=ht,i.a7=function(u){const a=u.value;return a?Xr(a)?RM(a,!0)?[]:[new RC(u.key,a,`invalid url "${a}"`)]:[new RC(u.key,a,`string expected, "${Ap(a)}" found`)]:[]},i.a8=PA,i.a9=bs,i.aA=ve,i.aB=M,i.aC=Ut,i.aD=xl,i.aE=Na,i.aF=_e,i.aG=St,i.aH=function(u,a){const c={};for(let p=0;p<a.length;p++){const g=a[p];g in u&&(c[g]=u[g])}return c},i.aI=X,i.aJ=ye,i.aK=class{constructor(u){this.entries={},this.scheduler=u}request(u,a,c,p){const g=this.entries[u]=this.entries[u]||{callbacks:[]};if(g.result){const[x,b]=g.result;return this.scheduler?this.scheduler.add(()=>{p(x,b)},a):p(x,b),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=c((x,b)=>{g.result=[x,b];for(const C of g.callbacks)this.scheduler?this.scheduler.add(()=>{C(x,b)},a):C(x,b);setTimeout(()=>delete this.entries[u],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(x=>x!==p),g.callbacks.length||(g.cancel(),delete this.entries[u]))}}},i.aL=function(u,a,c){const p=JSON.stringify(u.request);return u.data&&(this.deduped.entries[p]={result:[null,u.data]}),this.deduped.request(p,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},g=>{const x=bp(u.request,(b,C,I)=>{b?g(b):C&&g(null,{vectorTile:c?void 0:new wr(new vC(C)),rawData:C,responseHeaders:new Map(I.entries())})});return()=>{x.cancel(),g()}},a)},i.aM=function(u){return u?{cacheControl:u.get("Cache-Control"),expires:u.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=function(u){l_++,l_>yl&&(u.getActor().send("enforceCacheSizeLimit",Dg),l_=0)},i.aO=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log2(u)))},i.aP=wa,i.aQ=u8,i.aR=g8,i.aS=Q,i.aT=c8,i.aU=function(u,a){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){a(null,c)};for(let p=0;p<u.length;p++){const g=document.createElement("source");si(u[p])||(c.crossOrigin="Anonymous"),g.src=u[p],c.appendChild(g)}return{cancel:()=>{}}},i.aV=oS,i.aW=ky,i.aX=vt,i.aY=gS,i.aZ=Ne,i.a_=je,i.aa=Zt,i.ab=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return Si(u.expression.evaluate(a))}interpolate(u,a,c){return{x:Kr(u.x,a.x,c),y:Kr(u.y,a.y,c),z:Kr(u.z,a.z,c),azimuthal:Kr(u.azimuthal,a.azimuthal,c),polar:Kr(u.polar,a.polar,c)}}},i.ac=Ui,i.ad=nh,i.ae=ut,i.af=Dt,i.ag=be,i.ah=Me,i.ai=_f,i.aj=im,i.ak=Kr,i.al=rr,i.am=Gg,i.an=vn,i.ao=hi,i.ap=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return function([c,p]){const g=Si([1,c,p]);return{x:g.x,y:g.y,z:g.z}}(u.expression.evaluate(a))}interpolate(u,a,c){return{x:Kr(u.x,a.x,c),y:Kr(u.y,a.y,c),z:Kr(u.z,a.z,c)}}},i.aq=function(u,a,c=0,p=!0){const g=new at(c,c),x=u.sub(g),b=a.add(g),C=[x,new at(b.x,x.y),b,new at(x.x,b.y)];return p&&C.push(x.clone()),C},i.ar=function(u,a){const c=[];for(let p=0;p<u.length;p++){const g=et(p-1,-1,u.length-1),x=et(p+1,-1,u.length-1),b=u[p],C=u[x],I=u[g].sub(b).unit(),D=C.sub(b).unit(),U=D.angleWithSep(I.x,I.y),q=I.add(D).unit().mult(-1*a/Math.sin(U/2));c.push(b.add(q))}return c},i.as=K6,i.at=gs,i.au=function(u,a,c=0){return Se(((a.x-c)*u.scale-u.x)*rr,(a.y*u.scale-u.y)*rr,qe(a.z,a.y))},i.av=jt,i.aw=ke,i.ax=dn,i.ay=l6,i.az=function(u){let a=1/0,c=1/0,p=-1/0,g=-1/0;for(const x of u)a=Math.min(a,x.x),c=Math.min(c,x.y),p=Math.max(p,x.x),g=Math.max(g,x.y);return{min:new at(a,c),max:new at(p,g)}},i.b=function(u){return Ji.API_FONTS_REGEX.test(u)},i.b$=GR,i.b0=is,i.b1=bt,i.b2=LA,i.b3=OC,i.b4=function(){Il.isLoading()||Il.isLoaded()||x1()!=="deferred"||b1()},i.b5=K_,i.b6=yt,i.b7=Oy,i.b8=Zs,i.b9=hM,i.bA=K,i.bB=O,i.bC=function(u,a){const{x:c,y:p}=u.point,g=CU(c,p,u.worldSize/u._pixelsPerMercatorPixel,0,0);return M(g,g,IR(uh(a)))},i.bD=S,i.bE=Dr,i.bF=We,i.bG=Xe,i.bH=_t,i.bI=st,i.bJ=wx,i.bK=tc,i.bL=xM,i.bM=function(u,a,c,p,g){const x=5*a+2;u.float32[x+0]=c,u.float32[x+1]=p,u.float32[x+2]=g},i.bN=Ax,i.bO=Ua,i.bP=Ha,i.bQ=Bo,i.bR=Ln,i.bS=et,i.bT=function(u,a,c,p){var g=new y(4);return g[0]=u,g[1]=a,g[2]=c,g[3]=p,g},i.bU=class{isDataAvailableAtPoint(u){const a=this._source();if(this.isUsingMockSource()||!a||u.y<0||u.y>1)return!1;const c=a.getSource().maxzoom,p=1<<c,g=Math.floor(u.x),x=Math.floor((u.x-g)*p),b=Math.floor(u.y*p),C=this.findDEMTileFor(new wa(c,g,c,x,b));return!(!C||!C.dem)}getAtPointOrZero(u,a=0){return this.getAtPoint(u,a)||0}getAtPoint(u,a,c=!0){if(this.isUsingMockSource())return null;a==null&&(a=null);const p=this._source();if(!p||u.y<0||u.y>1)return a;const g=p.getSource().maxzoom,x=1<<g,b=Math.floor(u.x),C=u.x-b,I=new wa(g,b,g,Math.floor(C*x),Math.floor(u.y*x)),D=this.findDEMTileFor(I);if(!D||!D.dem)return a;const U=D.dem,q=1<<D.tileID.canonical.z,H=(C*q-D.tileID.canonical.x)*U.dim,Y=(u.y*q-D.tileID.canonical.y)*U.dim,J=Math.floor(H),oe=Math.floor(Y);return(c?this.exaggeration():1)*Kr(Kr(U.get(J,oe),U.get(J,oe+1),Y-oe),Kr(U.get(J+1,oe),U.get(J+1,oe+1),Y-oe),H-J)}static getAtTileOffset(u,a,c,p){const g=1<<u.canonical.z;return p?p.pointElevation(a):c?c.getAtPointOrZero(new ut(u.wrap+(u.canonical.x+a.x/rr)/g,(u.canonical.y+a.y/rr)/g)):0}static getAtTileOffsetFunc(u,a,c,p){return(g,x,b)=>{const C=this.getAtTileOffset(u,g,x,b),I=p.upVector(u.canonical,g.x,g.y);return Oe(I,I,C*p.upVectorScale(u.canonical,a,c).metersToTile),I}}getForTilePoints(u,a,c,p){if(this.isUsingMockSource())return!1;const g=Cx.create(this,u,p);return!!g&&(a.forEach(x=>{x[2]=this.exaggeration()*g.getElevationAt(x[0],x[1],c)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const a=this.findDEMTileFor(u);if(!a||!a.dem)return null;const c=a.dem.tree,p=a.tileID,g=1<<u.canonical.z-p.canonical.z;let x=u.canonical.x/g-p.canonical.x,b=u.canonical.y/g-p.canonical.y,C=0;for(let I=0;I<u.canonical.z-p.canonical.z&&!c.leaves[C];I++){x*=2,b*=2;const D=2*Math.floor(b)+Math.floor(x);C=c.childOffsets[C]+D,x%=1,b%=1}return{min:this.exaggeration()*c.minimums[C],max:this.exaggeration()*c.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,a,c){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let a=!1,c=Number.MAX_VALUE,p=Number.MIN_VALUE;for(const g of u){const x=this.getMinMaxForTile(g.tileID);x&&(c=Math.min(c,x.min),p=Math.max(p,x.max),a=!0)}return a?{min:c,max:p}:null}},i.bV=oC,i.bW=ks,i.bX=Xa,i.bY=iV,i.bZ=y8,i.b_=lV,i.ba=VR,i.bb=Nt,i.bc=_l,i.bd=rx,i.be=bU,i.bf=ds,i.bg=hx,i.bh=NM,i.bi=function(u,a){const c=im(a.zoom);if(c===0)return uh(u);const p=XA(u),g=NR(p),x=_e(p.getWest())*a.worldSize,b=_e(p.getEast())*a.worldSize,C=ye(p.getNorth())*a.worldSize,I=ye(p.getSouth())*a.worldSize,D=[x,C,0],U=[b,C,0],q=[x,I,0],H=[b,I,0],Y=R([],a.globeMatrix);return Dt(D,D,Y),Dt(U,U,Y),Dt(q,q,Y),Dt(H,H,Y),g[0]=Tf(g[0],q,c),g[1]=Tf(g[1],H,c),g[2]=Tf(g[2],U,c),g[3]=Tf(g[3],D,c),_n.fromPoints(g)},i.bj=JA,i.bk=R,i.bl=H1,i.bm=Tf,i.bn=bf,i.bo=che,i.bp=te,i.bq=F,i.br=UC,i.bs=vC,i.bt=bp,i.bu=function(u,a){const c=[];for(const p in u)p in a||c.push(p);return c},i.bv=Qe,i.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bx=gn,i.by=P,i.bz=N,i.c=Uo,i.c$=function(u){return u*u*u*u*u},i.c0=vM,i.c1=U6,i.c2=TM,i.c3=GM,i.c4=Oe,i.c5=Je,i.c6=Cr,i.c7=function(u,a,c){c*=.5;var p=a[0],g=a[1],x=a[2],b=a[3],C=Math.sin(c),I=Math.cos(c);return u[0]=p*I+g*C,u[1]=g*I-p*C,u[2]=x*I+b*C,u[3]=b*I-x*C,u},i.c8=un,i.c9=Os,i.cA=ai,i.cB=GV,i.cC=Jl,i.cD=EU,i.cE=function(u,a,c,p,g,x,b,C,I){if(I.name==="globe")return EU(u,a,new Jl(c,p,g),!1);const D=gS({z:c,x:p,y:g},I);return new _n([(x+D.x/D.scale)*a,a*(D.y/D.scale),b],[(x+D.x2/D.scale)*a,a*(D.y2/D.scale),C])},i.cF=function(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u[3]=Math.min(a[3],c[3]),u},i.cG=function(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u[3]=Math.max(a[3],c[3]),u},i.cH=function(u){const a=Math.round((u+45+360)%360/90)%4;return jw[a]},i.cI=Ie,i.cJ=rt,i.cK=l,i.cL=function(u){const a=N(new Float64Array(16));M(a,u.pixelMatrix,u.globeMatrix);const c=[0,j,0],p=[0,k,0];return Dt(c,c,a),Dt(p,p,a),[c[0]>0&&c[0]<=u.width&&c[1]>0&&c[1]<=u.height&&!MR(u,new Q(u.center.lat,90)),p[0]>0&&p[0]<=u.width&&p[1]>0&&p[1]<=u.height&&!MR(u,new Q(u.center.lat,-90))]},i.cM=function(u,a){const{scale:c}=u.tileTransform,p=c*rr/(u.tileSize*Math.pow(2,a.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(g,x,b){var C=x[1],I=x[2],D=x[3],U=b[0],q=b[1];return g[0]=x[0]*U,g[1]=C*U,g[2]=I*q,g[3]=D*q,g}(new Float32Array(4),a.inverseAdjustmentMatrix,[p,p])},i.cN=hC,i.cO=ee,i.cP=HV,i.cQ=function(u){const a=HV(u,!0);return S([],[a[0],a[1],a[4],a[5]])},i.cR=B,i.cS=yi,i.cT=$,i.cU=function(u){const{x:a,y:c}=u.point,{lng:p,lat:g}=u._center;return CU(a,c,u.worldSize,p,g)},i.cV=Ce,i.cW=$o,i.cX=Ql,i.cY=Ns,i.cZ=v,i.c_=function(u,a,c){let p=0;for(let g=0;g<2;++g)u[g]>0&&(p+=(u[g]-0)*(u[g]-0)),a[g]<0&&(p+=(0-a[g])*(0-a[g]));return p},i.ca=function(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u[3]=a[3],u},i.cb=re,i.cc=function(u,a,c,p,g){var x=1/Math.tan(a/2);if(u[0]=x/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=x,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,g!=null&&g!==1/0){var b=1/(p-g);u[10]=(g+p)*b,u[14]=2*g*p*b}else u[10]=-1,u[14]=-2*p;return u},i.cd=function(u,a,c,p,g,x,b){var C=1/(a-c),I=1/(p-g),D=1/(x-b);return u[0]=-2*C,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*I,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*D,u[11]=0,u[12]=(a+c)*C,u[13]=(g+p)*I,u[14]=(b+x)*D,u[15]=1,u},i.ce=Ee,i.cf=function(u,a,c){u[4*a+0]=c[0],u[4*a+1]=c[1],u[4*a+2]=c[2],u[4*a+3]=c[3]},i.cg=lx,i.ch=em,i.ci=$s,i.cj=ku,i.ck=by,i.cl=Q6,i.cm=function(){var u=new y(4);return y!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},i.cn=function(u,a,c){var p=a[0],g=a[1],x=a[2],b=a[3],C=Math.sin(c),I=Math.cos(c);return u[0]=p*I+x*C,u[1]=g*I+b*C,u[2]=p*-C+x*I,u[3]=g*-C+b*I,u},i.co=function(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]&&u[3]===a[3]},i.cp=Rr,i.cq=function(u){var a=u[0],c=u[1],p=u[2],g=u[3];return Math.sqrt(a*a+c*c+p*p+g*g)},i.cr=Pa,i.cs=ir,i.ct=Nu,i.cu=3,i.cv=2,i.cw=7,i.cx=6,i.cy=Be,i.cz=ie,i.d=function(u){return Ji.API_TILEJSON_REGEX.test(u)},i.d$=OU,i.d0=ue,i.d1=45,i.d2=xy,i.d3=function(u,a,c){const p=Math.sqrt(u*u+a*a+c*c),g=p>0?Math.acos(c/p)*Oa:0;let x=u!==0||a!==0?Math.atan2(-a,-u)*Oa+90:0;return x<0&&(x+=360),[p,x,g]},i.d4=Se,i.d5=Si,i.d6=Ze,i.d7=xe,i.d8=_n,i.d9=me,i.dA=$1,i.dB=class extends kc{constructor(u){super(u),this.current=AR}set(u,a,c){if(this.fetchUniformLocation(u,a)){for(let p=0;p<9;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},i.dC=Ig,i.dD=function(u,a,c){const p=im(c.zoom),g=u.style.map._antialias,x=u.terrain&&u.terrain.exaggeration()>0;return p===0&&!g&&!x},i.dE=function(u){const a=u.pixelsPerMeter,c=a/Ee(1,u.center.lat),p=N(new Float64Array(16));return F(p,p,[u.point.x,u.point.y,0]),B(p,p,[c,c,a]),Float32Array.from(p)},i.dF=XA,i.dG=function(u){const a=Ie-5;u=ve(u,-a,a)/a*90;const c=Math.pow(Math.abs(Math.sin(vn(u))),3);return Math.round(c*(E.length-1))},i.dH=function(u,a,c,p){const g=a.getNorth(),x=a.getSouth(),b=a.getWest(),C=a.getEast(),I=1<<u.z,D=C-b,U=g-x,q=D/_,H=-U/E[c],Y=[0,q,0,H,0,0,g,b,0];if(u.z>0){const J=180/p;A(Y,Y,[J/D+1,0,0,0,J/U+1,0,-.5*J/q,.5*J/H,1])}return Y[2]=I,Y[5]=u.x,Y[8]=u.y,Y},i.dI=uh,i.dJ=function(u,a,c){const p=N(new Float64Array(16)),g=(a/(1<<u)-.5)*Math.PI*2;return W(p,c.globeMatrix,g),Float32Array.from(p)},i.dK=BU,i.dL=ZA,i.dM=function(u,a){return[Math.pow(u[0],2.2)*a,Math.pow(u[1],2.2)*a,Math.pow(u[2],2.2)*a]},i.dN=w,i.dO=function(u,a){var c=Math.sin(a),p=Math.cos(a);return u[0]=p,u[1]=c,u[2]=0,u[3]=-c,u[4]=p,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},i.dP=It,i.dQ=AU,i.dR=Yi,i.dS=ms,i.dT=256,i.dU=function(u,a){const c=[0,0,0];return Dt(c,c,JA(uh(a.canonical))),Dt(c,c,u),c},i.dV=u=>({u_matrix:new by(u),u_texsize:new ku(u),u_pixels_to_tile_units:new U1(u),u_device_pixel_ratio:new $s(u),u_width_scale:new $s(u),u_floor_width_scale:new $s(u),u_image:new lx(u),u_units_to_pixels:new ku(u),u_tile_units_to_pixels:new $s(u),u_alpha_discard_threshold:new $s(u),u_trim_offset:new ku(u),u_trim_fade_range:new ku(u),u_trim_color:new xy(u),u_emissive_strength:new $s(u),u_zbias_factor:new $s(u),u_tile_to_meter:new $s(u),u_ground_shadow_factor:new em(u),u_pattern_transition:new $s(u)}),i.dW=u=>({u_matrix:new by(u),u_pixels_to_tile_units:new U1(u),u_device_pixel_ratio:new $s(u),u_width_scale:new $s(u),u_floor_width_scale:new $s(u),u_units_to_pixels:new ku(u),u_dash_image:new lx(u),u_gradient_image:new lx(u),u_image_height:new $s(u),u_texsize:new ku(u),u_tile_units_to_pixels:new $s(u),u_alpha_discard_threshold:new $s(u),u_trim_offset:new ku(u),u_trim_fade_range:new ku(u),u_trim_color:new xy(u),u_emissive_strength:new $s(u),u_zbias_factor:new $s(u),u_tile_to_meter:new $s(u),u_ground_shadow_factor:new em(u)}),i.dX=u=>({u_camera_to_center_distance:new $s(u),u_extrude_scale:new U1(u),u_device_pixel_ratio:new $s(u),u_matrix:new by(u),u_inv_rot_matrix:new by(u),u_merc_center:new ku(u),u_tile_id:new em(u),u_zoom_transition:new $s(u),u_up_dir:new em(u),u_emissive_strength:new $s(u)}),i.dY=Xp,i.dZ=Xfe,i.d_=class{constructor(u,a,c,p){this.context=u,this.format=p,this.size=c,this.texture=u.gl.createTexture();const[g,x,b]=this.size,{gl:C}=u;C.bindTexture(C.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in a&&a.data&&C.texImage3D(C.TEXTURE_3D,0,this.format,g,x,b,0,rM(this.format),nM(this.format),a.data)}bind(u,a){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_3D,this.texture),u!==this.minFilter&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MAG_FILTER,u),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MIN_FILTER,u),this.minFilter=u),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_T,a),this.wrapS=a)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},i.da=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},i.db=qV,i.dc=uM,i.dd=ZV,i.de=RM,i.df=function(u,a){return u.readFields(Wpe,{icons:[]},a)},i.dg=lC,i.dh=Sx,i.di=wM,i.dj=kw,i.dk=jA,i.dl=Rg,i.dm=Vg,i.dn=Ar,i.dp=function(u){const a=u.indexOf(py);return a>=0?u.slice(0,a):u},i.dq=function(u){return u.indexOf(py)>=0},i.dr=function(u){const a=u.lastIndexOf(py);return a>=0?u.slice(a+1):""},i.ds=function(u){const a=[],c=u.id;return c===void 0&&a.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&a.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&a.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),a},i.dt=function(u,a,c,p){return u.type==="custom"?new Bpe(u,a):new Hpe[u.type](u,a,c,p)},i.du=qt,i.dv=function(u){const a=u.indexOf(py);return a>=0?u.slice(a+1):""},i.dw=class extends Oy{constructor(u,a){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=a.target,this.namespace=a.namespace,a.properties&&(this.properties=a.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},i.dx=_1,i.dy=Lg,i.dz=function(u){return u({pluginStatus:al,pluginURL:ah}),_1.on("pluginStateChange",u),u},i.e=Ji,i.e$=function([u,a,c]){const p=Math.hypot(u,a,c),g=Math.atan2(u,c),x=.5*Math.PI-Math.acos(-a/p);return new Q($o(g),$o(x))},i.e0=(u,a,c,p,g,x)=>{const b=u.transform,C=b.projection.name==="globe";let I;if(x.paint.get("circle-pitch-alignment")==="map")if(C){const U=AU(b.zoom,a.canonical)*b._pixelsPerMercatorPixel;I=Float32Array.from([U,0,0,U])}else I=b.calculatePixelsToTileUnitsMatrix(c);else I=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(b.projection),u_matrix:u.translatePosMatrix(a.projMatrix,c,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ol.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:phe,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:x.paint.get("circle-emissive-strength")};if(C){D.u_inv_rot_matrix=p,D.u_merc_center=g,D.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],D.u_zoom_transition=im(b.zoom);const U=g[0]*rr,q=g[1]*rr;D.u_up_dir=b.projection.upVector(new Jl(0,0,0),U,q)}return D},i.e1=h6,i.e2=vl,i.e3=(u,a,c,p,g,x,b,C,I,D)=>{const U=u.transform,q=U.pitch<15?c6(.07,.7,ve((14-U.zoom)/5,0,1)):.07,H=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:d6(u,a,c,p),u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:U.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:g,u_width_scale:x,u_floor_width_scale:b,u_image:0,u_tile_units_to_pixels:u6(a,U),u_units_to_pixels:[1/U.pixelsToGLUnits[0],1/U.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(H?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:q,u_tile_to_meter:Ze(a.tileID.canonical,0),u_ground_shadow_factor:I,u_pattern_transition:D}},i.e4=(u,a,c,p,g,x,b,C,I,D)=>{const U=u.transform,q=U.calculatePixelsToTileUnitsMatrix(a),H=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Y=U.pitch<15?c6(.07,.7,ve((14-U.zoom)/5,0,1)):.07;return{u_matrix:d6(u,a,c,p),u_pixels_to_tile_units:q,u_device_pixel_ratio:x,u_width_scale:b,u_floor_width_scale:C,u_units_to_pixels:[1/U.pixelsToGLUnits[0],1/U.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:f6(c)&&a.lineAtlasTexture?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:u6(a,u.transform),u_alpha_discard_threshold:0,u_trim_offset:I,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(H?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:Y,u_tile_to_meter:Ze(a.tileID.canonical,0),u_ground_shadow_factor:D}},i.e5=ct,i.e6=G1,i.e7=qe,i.e8=Ef,i.e9=aC,i.eA=LM,i.eB=mC,i.eC=pC,i.eD=[1,1,1],i.eE=Cx,i.eF=pt,i.eG=function(u,a,c,p){var g=a[0],x=a[1],b=a[2],C=a[3];return u[0]=g+p*(c[0]-g),u[1]=x+p*(c[1]-x),u[2]=b+p*(c[2]-b),u[3]=C+p*(c[3]-C),u},i.eH=vx,i.eI=Oc,i.eJ=ch,i.eK=function(u,a,c,p,g,x,b,C,I,D,U,q,H,Y,J,oe){var ce=new y(16);return ce[0]=u,ce[1]=a,ce[2]=c,ce[3]=p,ce[4]=g,ce[5]=x,ce[6]=b,ce[7]=C,ce[8]=I,ce[9]=D,ce[10]=U,ce[11]=q,ce[12]=H,ce[13]=Y,ce[14]=J,ce[15]=oe,ce},i.eL=G,i.eM=R1,i.eN=gy,i.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new at(1/0,1/0),max:new at(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,a=!1){const c=aV(new at(0,0),new at(rr,rr),u),p=[];if(a&&!qR(c,this._globalClipBounds))return p;for(const g of this._activeRegions){if(g.hiddenByOverlap||!qR(c,g))continue;const x=Vhe(g.min,g.max,u);p.push({min:x.min,max:x.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return p}setSources(u){this._setSources(u.map(a=>({getSourceId:()=>a.cache.id,getFootprints:()=>{const c=[];for(const p of a.cache.getVisibleCoordinates()){const g=a.cache.getTile(p).buckets[a.layer];g&&g.updateFootprints(p.toUnwrapped(),c)}return c},getOrder:()=>a.order,getClipMask:()=>a.clipMask,getClipScope:()=>a.clipScope})))}_addSource(u){const a=u.getFootprints();if(a.length===0)return;const c=u.getOrder(),p=u.getClipMask(),g=u.getClipScope();for(const x of a){if(!x.footprint)continue;const b=aV(x.footprint.min,x.footprint.max,x.id);this._activeRegions.push({min:b.min,max:b.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:x.id,footprint:x.footprint,order:c,clipMask:p,clipScope:g})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((a,c)=>a.priority-c.priority||nC(a.min,c.min)||nC(a.max,c.max)||a.order-c.order||a.clipMask-c.clipMask||function(p,g){const x=(b,C)=>b+C;return p.length-g.length||p.reduce(x,"").localeCompare(g.reduce(x,""))}(a.clipScope,c.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let a=0;for(;!u&&a!==this._activeRegions.length;){const c=this._activeRegions[a],p=this._prevRegions[a];u=c.priority!==p.priority||!sV(c,p)||c.order!==p.order||c.clipMask!==p.clipMask||!gn(c.clipScope,p.clipScope),this._activeRegions[a].hiddenByOverlap=p.hiddenByOverlap,++a}}if(u){++this._updateTime;for(const c of this._activeRegions)c.order!==J1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const a=c=>{const p=this._activeRegions;if(c>=p.length)return c;const g=p[c].priority;for(;c<p.length&&p[c].priority===g;)++c;return c};if(this._sourceIds.length>1){let c=0,p=a(c);for(;c!==p;){let g=c;const x=c;for(;g!==p;){const b=this._activeRegions[g];b.hiddenByOverlap=!1;for(let C=0;C<x;C++){const I=this._activeRegions[C];if(!I.hiddenByOverlap&&b.order===J1&&qR(b,I)&&(b.hiddenByOverlap=oV(b.footprint,b.tileId,I.footprint,I.tileId),b.hiddenByOverlap))break}++g}c=p,p=a(c)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let a=u.length-1;a>=0;a--)this._addSource(u[a]);this._computeReplacement()}},i.eP=J1,i.eQ=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,a){const c=new _l,p=new is,g=[],x=u+1+2,b=a[0]+1,C=a[0]+1+(1+a.length),I=(D,U,q)=>{let H=D===x-1?D-2:D===0?D:D-1;return H+=q?24575:0,[H,U]};for(let D=0;D<x;++D)c.emplaceBack(...I(D,0,!0));for(let D=0;D<b;++D)for(let U=0;U<x;++U)c.emplaceBack(...I(U,D,(U===0||U===x-1)&&!0));for(let D=0;D<a.length;++D){const U=a[D];for(let q=0;q<x;++q)c.emplaceBack(...I(q,U,!0))}for(let D=0;D<a.length;++D){const U=p.length,q=a[D]+1+2,H=new is;for(let oe=0;oe<q-1;oe++){const ce=oe===q-2,he=ce?x*(C-a.length+D-oe):x;for(let we=0;we<x-1;we++){const Te=oe*x+we;oe===0||ce||we===0||we===x-2?(H.emplaceBack(Te+1,Te,Te+he),H.emplaceBack(Te+he,Te+he+1,Te+1)):(p.emplaceBack(Te+1,Te,Te+he),p.emplaceBack(Te+he,Te+he+1,Te+1))}}const Y=ds.simpleSegment(0,U,c.length,p.length-U);for(let oe=0;oe<H.uint16.length;oe+=3)p.emplaceBack(H.uint16[oe],H.uint16[oe+1],H.uint16[oe+2]);const J=ds.simpleSegment(0,U,c.length,p.length-U);g.push({withoutSkirts:Y,withSkirts:J})}return{vertices:c,indices:p,segments:g}}_createGrid(u){const a=this._fillGridMeshWithLods(_,E);this._gridSegments=a.segments,this._gridBuffer=u.createVertexBuffer(a.vertices,bU.members),this._gridIndexBuffer=u.createIndexBuffer(a.indices,!0)}_createPoles(u){const a=new is;for(let b=0;b<=_;b++)a.emplaceBack(0,b+1,b+2);this._poleIndexBuffer=u.createIndexBuffer(a,!0);const c=new Sf,p=new Sf,g=new Sf,x=new Sf;this._poleSegments=[];for(let b=0,C=0;b<v;b++){const I=360/(1<<b);c.emplaceBack(0,-xl,0,.5,0),p.emplaceBack(0,-xl,0,.5,1),g.emplaceBack(0,-xl,0,.5,.5),x.emplaceBack(0,-xl,0,.5,.5);for(let D=0;D<=_;D++){let U=D/_,q=0;const H=Kr(0,I,U),[Y,J,oe]=L(hhe,fhe,H,xl);c.emplaceBack(Y,J,oe,U,q),p.emplaceBack(Y,J,oe,U,1-q);const ce=vn(H);U=.5+.5*Math.sin(ce),q=.5+.5*Math.cos(ce),g.emplaceBack(Y,J,oe,U,q),x.emplaceBack(Y,J,oe,U,1-q)}this._poleSegments.push(ds.simpleSegment(C,0,66,64)),C+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(c,dx,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(p,dx,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(g,dx,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(x,dx,!1)}getGridBuffers(u,a){return[this._gridBuffer,this._gridIndexBuffer,a?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,a){return[a?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,a?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},i.eR=nV,i.eS=dt,i.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eU=fe,i.eV=De,i.eW=function(u,a,c){return u[0]=a[0]/c[0],u[1]=a[1]/c[1],u[2]=a[2]/c[2],u},i.eX=zt,i.eY=z,i.eZ=Ke,i.e_=Ae,i.ea=wV,i.eb=am,i.ec=hV,i.ed=dV,i.ee=Ue,i.ef=function(u,a){if(u===a){var c=a[1],p=a[2],g=a[3],x=a[6],b=a[7],C=a[11];u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=c,u[6]=a[9],u[7]=a[13],u[8]=p,u[9]=x,u[11]=a[14],u[12]=g,u[13]=b,u[14]=C}else u[0]=a[0],u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=a[1],u[5]=a[5],u[6]=a[9],u[7]=a[13],u[8]=a[2],u[9]=a[6],u[10]=a[10],u[11]=a[14],u[12]=a[3],u[13]=a[7],u[14]=a[11],u[15]=a[15];return u},i.eg=zpe,i.eh=Cn,i.ei=D1,i.ej=256,i.ek=IR,i.el=Kl,i.em=W,i.en=function(u,a){return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[4],u[4]=a[5],u[5]=a[6],u[6]=a[8],u[7]=a[9],u[8]=a[10],u},i.eo=Sf,i.ep=I1,i.eq=bA,i.er=function(u,a,c,p,g){return ve((u-a)/(c-a)*(g-p)+p,p,g)},i.es=hn,i.et=function(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],b=a[4],C=a[5],I=a[6],D=a[7],U=a[8],q=U*b-C*D,H=-U*x+C*I,Y=D*x-b*I,J=c*q+p*H+g*Y;return J?(u[0]=q*(J=1/J),u[1]=(-U*p+g*D)*J,u[2]=(C*p-g*b)*J,u[3]=H*J,u[4]=(U*c-g*I)*J,u[5]=(-C*c+g*x)*J,u[6]=Y*J,u[7]=(-D*c+p*I)*J,u[8]=(b*c-p*x)*J,u):null},i.eu=2,i.ev=Le,i.ew=Ht,i.ex=ae,i.ey=function(u,a){var c=new y(3);ae(c,a);var p=1/c[0],g=1/c[1],x=1/c[2],b=a[0]*p,C=a[1]*g,I=a[2]*x,D=a[4]*p,U=a[5]*g,q=a[6]*x,H=a[8]*p,Y=a[9]*g,J=a[10]*x,oe=b+U+J,ce=0;return oe>0?(ce=2*Math.sqrt(oe+1),u[3]=.25*ce,u[0]=(q-Y)/ce,u[1]=(H-I)/ce,u[2]=(C-D)/ce):b>U&&b>J?(ce=2*Math.sqrt(1+b-U-J),u[3]=(q-Y)/ce,u[0]=.25*ce,u[1]=(C+D)/ce,u[2]=(H+I)/ce):U>J?(ce=2*Math.sqrt(1+U-b-J),u[3]=(H-I)/ce,u[0]=(C+D)/ce,u[1]=.25*ce,u[2]=(q+Y)/ce):(ce=2*Math.sqrt(1+J-b-U),u[3]=(C-D)/ce,u[0]=(H+I)/ce,u[1]=(q+Y)/ce,u[2]=.25*ce),u},i.ez=function(u,a){var c=2*Math.acos(a[3]),p=Math.sin(c/2);return p>m?(u[0]=a[0]/p,u[1]=a[1]/p,u[2]=a[2]/p):(u[0]=1,u[1]=0,u[2]=0),c},i.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c))))},i.f0=Kt,i.f1=sM,i.f2=function(u){const a=u.navigator?u.navigator.userAgent:null;return!!function(c){if(Ms==null){const p=c.navigator?c.navigator.userAgent:null;Ms=!!c.safari||!(!p||!(/\b(iPad|iPhone|iPod)\b/.test(p)||p.match("Safari")&&!p.match("Chrome")))}return Ms}(u)&&!(!a||!(a.match("Version/15.4")||a.match("Version/15.5")||a.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f3=function(u,a){Dg=u,yl=a},i.f4=MR,i.f5=jU,i.f6=function(u){const a=[0,0,0],c=N(new Float64Array(16));return M(c,u.pixelMatrix,u.globeMatrix),Dt(a,a,c),new at(a[0],a[1])},i.f7=function(){const u=iS;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(YR),iS=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f8=function(){lC().acquire(YR)},i.f9=x1,i.fA=$t,i.fB=function(u){let a=0;if(new Uint32Array(u,0,1)[0]!==zV){const c=new Uint32Array(u,0,7),[,,p,g,x,b]=c;a=c.byteLength+g+x+b+x,(p!==u.byteLength||a>=u.byteLength)&&zr("Invalid b3dm header information.")}return VV(u,a)},i.fC=function(u,a){const c=uM(u);for(const p of c){for(const g of p.meshes)xfe(g);p.lights&&(p.lightMeshIndex=p.meshes.length,p.meshes.push(bfe(p.lights,a)))}return c},i.fD=MC,i.fE=xs,i.fF=RV,i.fG=Il,i.fH=Nl,i.fI=function(u){af(),sl!=null&&sl.then(a=>{a.keys().then(c=>{for(let p=0;p<c.length-u;p++)a.delete(c[p]).catch(g=>zr(g.message))}).catch(c=>zr(c.message))}).catch(a=>zr(a.message))},i.fa=function(u,a,c=!1){if(al===Nl.deferred||al===Nl.loading||al===Nl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ah=Ol.resolveURL(u),al=Nl.deferred,y1=a,v1(),c||b1()},i.fb=function(u){mx=Ol.resolveURL(u),gx||(gx=new px(lC(),new id)),gx.broadcast("setMeshoptUrl",mx)},i.fc=LV,i.fd=function(u){QR=Ol.resolveURL(u),gx||(gx=new px(lC(),new id)),gx.broadcast("setDracoUrl",QR)},i.fe=DV,i.ff=nS,i.fg=function(u){const a=nd();if(!a)return;const c=a.delete(Mg);u&&c.then(()=>u()).catch(u)},i.fh=Ty,i.fi=_r,i.fj=sm,i.fk=vd,i.fl=iq,i.fm=sq,i.fn=s6,i.fo=dr,i.fp="hd_road_elevation",i.fq=Qr,i.fr=Jt,i.fs=Af,i.ft=bM,i.fu=jy,i.fv=function(u,a,c,p,g,x,b,C=1,I,D,U){u.createArrays(),u.tilePixelRatio=rr/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const q=u.layers[0].layout,H=u.layers[0]._unevaluatedLayout._values,Y={};Y.scaleFactor=C,Y.textSizeScaleRange=q.get("text-size-scale-range"),Y.iconSizeScaleRange=q.get("icon-size-scale-range");const[J,oe]=Y.textSizeScaleRange,[ce,he]=Y.iconSizeScaleRange;Y.textScaleFactor=ve(Y.scaleFactor,J,oe),Y.iconScaleFactor=ve(Y.scaleFactor,ce,he);const we=H["text-size"],Te=H["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:it,maxZoom:Tt}=u.textSizeData;Y.compositeTextSizes=[we.possiblyEvaluate(new Ui(it,{worldview:U}),x),we.possiblyEvaluate(new Ui(Tt,{worldview:U}),x)]}if(u.iconSizeData.kind==="composite"){const{minZoom:it,maxZoom:Tt}=u.iconSizeData;Y.compositeIconSizes=[Te.possiblyEvaluate(new Ui(it,{worldview:U}),x),Te.possiblyEvaluate(new Ui(Tt,{worldview:U}),x)]}Y.layoutTextSize=we.possiblyEvaluate(new Ui(b+1,{worldview:U}),x),Y.layoutIconSize=Te.possiblyEvaluate(new Ui(b+1,{worldview:U}),x),Y.textMaxSize=we.possiblyEvaluate(new Ui(18,{worldview:U}),x);const Pe=q.get("symbol-placement"),He=q.get("text-rotation-alignment")==="map"&&Pe!=="point",Fe=q.get("text-size");let Ye=!1;const tt=[];for(const it of u.features){const Tt=q.get("text-font").evaluate(it,{},x).join(","),ft=Fe.evaluate(it,{},x)*Y.textScaleFactor,At=Y.layoutTextSize.evaluate(it,{},x)*Y.textScaleFactor,Rt=Y.layoutIconSize.evaluate(it,{},x)*Y.iconScaleFactor,Bt={horizontal:{},vertical:void 0},er=it.text;let Wt,Lt=[0,0];if(er){const wn=er.toString(),Vn=q.get("text-letter-spacing").evaluate(it,{},x)*Xa,an=q.get("text-line-height").evaluate(it,{},x)*Xa,ti=AA(wn)?Vn:0,ri=q.get("text-anchor").evaluate(it,{},x),ls=q.get("text-variable-anchor");if(!ls){const Ot=q.get("text-radial-offset").evaluate(it,{},x);if(Ot)Lt=U6(ri,[Ot*Xa,EM]);else{const or=q.get("text-offset").evaluate(it,{},x);Lt=[or[0]*Xa,or[1]*Xa]}}let ze=He?"center":q.get("text-justify").evaluate(it,{},x);const Re=Pe==="point",Pt=Re?q.get("text-max-width").evaluate(it,{},x)*Xa:1/0,sr=Ot=>{u.allowVerticalPlacement&&p1(wn)&&(Bt.vertical=yM(er,a,c,g,Tt,Pt,an,ri,Ot,ti,Lt,tc.vertical,!0,At,ft,I))};if(!He&&ls){const Ot=ze==="auto"?ls.map(jr=>TM(jr)):[ze];let or=!1;for(let jr=0;jr<Ot.length;jr++){const Tr=Ot[jr];if(!Bt.horizontal[Tr])if(or)Bt.horizontal[Tr]=Bt.horizontal[0];else{const ln=yM(er,a,c,g,Tt,Pt,an,"center",Tr,ti,Lt,tc.horizontal,!1,At,ft,I);ln&&(Bt.horizontal[Tr]=ln,or=ln.positionedLines.length===1)}}sr("left")}else{if(ze==="auto"&&(ze=TM(ri)),Re||q.get("text-writing-mode").indexOf("horizontal")>=0||!p1(wn)){const Ot=yM(er,a,c,g,Tt,Pt,an,ri,ze,ti,Lt,tc.horizontal,!1,At,ft,I);Ot&&(Bt.horizontal[ze]=Ot)}sr(Re?"left":ze)}}let Gt,wt,xt,Vt,Yt,Ft,gr=!1;const br=q.get("icon-text-fit").evaluate(it,{},x);if(it.icon&&it.icon.hasPrimary()){const wn=pS(it.icon,u.iconSizeData,H["icon-size"],x,u.zoom,it,I,Y.iconScaleFactor,U);Gt=wn.iconPrimary,xt=wn.iconSecondary;const Vn=Gt.toString();if(wt=p.get(Vn),wt&&(Yt=q.get("icon-offset").evaluate(it,{},x),Ft=q.get("icon-anchor").evaluate(it,{},x),Wt=xC(g.get(Vn),xt?g.get(xt.toString()):void 0,Yt,Ft),gr=wt.sdf,u.sdfIcons===void 0?u.sdfIcons=wt.sdf:u.sdfIcons!==wt.sdf&&zr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wt.pixelRatio!==u.pixelRatio||q.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),xt){const an=xt.toString();Vt=p.get(an)}}Ye=Ye||!(!it.icon||!it.icon.hasSecondary());const hr=AM(Bt.horizontal)||Bt.vertical;u.iconsInText||(u.iconsInText=!!hr&&hr.iconsInText);const ar=At*Y.textScaleFactor/Xa,{defaultShapedIcon:en,verticallyShapedIcon:lr}=Tpe(u,Wt,q,it,x,Bt,ar,Yt,br);br!=="none"&&Wt&&(C6(Wt)||j6(Wt))&&(TC(0,wt,Gt,Wt,en,br,D,p,g),TC(0,Vt,xt,Wt,en,br,D,p,g),lr&&(TC(0,wt,Gt,Wt,lr,br,D,p,g),TC(0,Vt,xt,Wt,lr,br,D,p,g))),Wt=en;const{iconBBox:Lr,iconVerticalBBox:nn}=wpe(u,Wt,lr,q,it,x,Rt,Yt,Y,g,Ft);tt.push({feature:it,shapedTextOrientations:Bt,shapedText:hr,shapedIcon:Wt,iconPrimary:Gt,iconSecondary:xt,iconOffset:Yt,iconAnchor:Ft,verticallyShapedIcon:lr,layoutTextSize:At,layoutIconSize:Rt,textOffset:Lt,isSDFIcon:gr,iconTextFit:br,iconCollisionBounds:Lr,iconVerticalCollisionBounds:nn})}return{featureData:tt,sizes:Y,hasAnySecondaryIcon:Ye,textAlongLine:He,symbolPlacement:Pe}},i.fw=D6,i.fx=function(u,a,c,p,g,x,b,C,I,D){u.iconAtlasPositions=D.iconPositions;const{featureData:U,hasAnySecondaryIcon:q,sizes:H,textAlongLine:Y,symbolPlacement:J}=a;for(const oe of U){const{shapedIcon:ce,verticallyShapedIcon:he,feature:we,shapedTextOrientations:Te,shapedText:Pe,layoutTextSize:He,textOffset:Fe,isSDFIcon:Ye,iconPrimary:tt,iconSecondary:it,iconTextFit:Tt,iconOffset:ft,iconCollisionBounds:At,iconVerticalCollisionBounds:Rt}=oe;q6(ce,D.iconPositions,tt,it),q6(he,D.iconPositions,tt,it),Epe(Te,D.iconPositions),Spe(tt,it,D.iconPositions),(Pe||ce)&&Ape(u,we,Te,ce,he,I,H,He,0,Fe,Ye,p,g,b,C,q,Tt,ft,Y,J,At,Rt)}c&&u.generateCollisionDebugBuffers(x,u.collisionBoxArray,H.textScaleFactor)},i.fy=wr,i.fz=$C,i.g=function(u,a){return Lg(Object.assign(u,{method:"GET"}),a)},i.h=function(u){return u.indexOf("mapbox:")===0},i.i=function(u){return Ji.API_STYLE_REGEX.test(u)&&!Uo(u)},i.j=la,i.k=c_,i.l=function(u){return decodeURIComponent(atob(u).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(u,a){return Lg(Object.assign(u,{type:"json"}),a)},i.n=Iw,i.o=Ol,i.p=function(u,a){return Lg(Object.assign(u,{method:"POST"}),a)},i.q=To,i.r=Pl,i.s=function(u){try{const a=self[u];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return JR||(JR=new Ty),JR},i.u=function(){return function u(a){return a?(a^Math.random()*(16>>a/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},i.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},i.w=zr,i.x=UM,i.y=qg,i.z=ql}),o(["./shared"],function(i){function m(dt){const fe=dt?dt.url.toString():void 0;return fe?performance.getEntriesByName(fe):[]}function y(dt){if(typeof dt=="number"||typeof dt=="boolean"||typeof dt=="string"||dt==null)return JSON.stringify(dt);if(Array.isArray(dt)){let ve="[";for(const Me of dt)ve+=`${y(Me)},`;return`${ve}]`}let fe="{";for(const ve of Object.keys(dt).sort())fe+=`${ve}:${y(dt[ve])},`;return`${fe}}`}function S(dt){let fe="";for(const ve of i.bw)fe+=`/${y(dt[ve])}`;return fe}class w{constructor(fe){this.keyCache={},this._layers={},this._layerConfigs={},fe&&this.replace(fe)}replace(fe,ve){this._layerConfigs={},this._layers={},this.update(fe,[],ve)}update(fe,ve,Me){this._options=Me;for(const Qe of fe)this._layerConfigs[Qe.id]=Qe,(this._layers[Qe.id]=i.dt(Qe,this.scope,null,this._options)).compileFilter(Me),this.keyCache[Qe.id]&&delete this.keyCache[Qe.id];for(const Qe of ve)delete this.keyCache[Qe],delete this._layerConfigs[Qe],delete this._layers[Qe];this.familiesBySource={};const et=function(Qe,lt){const bt={};for(let vt=0;vt<Qe.length;vt++){const Jt=Qe[vt];let qt=lt&&lt[Jt.id];qt||(Jt.type==="symbol"?qt=Jt.id:(qt=S(Jt),Jt.type==="line"&&Jt.paint&&function Jr(Zr){return typeof Zr=="string"&&Zr==="line-progress"||(Array.isArray(Zr)?Zr.some(Jr):!(!Zr||typeof Zr!="object")&&Object.values(Zr).some(Jr))}(Jt.paint["line-width"])&&(qt+=`/${y(Jt.paint["line-width"])}`))),lt&&(lt[Jt.id]=qt);let Ar=bt[qt];Ar||(Ar=bt[qt]=[]),Ar.push(Jt)}const ct=[];for(const vt in bt)ct.push(bt[vt]);return ct}(Object.values(this._layerConfigs),this.keyCache);for(const Qe of et){const lt=Qe.map(Ar=>this._layers[Ar.id]),bt=lt[0];if(bt.visibility==="none")continue;const ct=bt.source||"";let vt=this.familiesBySource[ct];vt||(vt=this.familiesBySource[ct]={});const Jt=bt.sourceLayer||"_geojsonTileLayer";let qt=vt[Jt];qt||(qt=vt[Jt]=[]),qt.push(lt)}}}const T=1*i.fk;class A{constructor(fe){const ve={},Me=[];for(const bt in fe){const ct=fe[bt],vt=ve[bt]={};for(const Jt in ct.glyphs){const qt=ct.glyphs[+Jt];if(!qt||qt.bitmap.width===0||qt.bitmap.height===0)continue;const Ar=qt.metrics.localGlyph?T:1,Jr={x:0,y:0,w:qt.bitmap.width+2*Ar,h:qt.bitmap.height+2*Ar};Me.push(Jr),vt[Jt]=Jr}}const{w:et,h:Qe}=i.G(Me),lt=new i.fj({width:et||1,height:Qe||1});for(const bt in fe){const ct=fe[bt];for(const vt in ct.glyphs){const Jt=ct.glyphs[+vt];if(!Jt||Jt.bitmap.width===0||Jt.bitmap.height===0)continue;const qt=ve[bt][vt],Ar=Jt.metrics.localGlyph?T:1;i.fj.copy(Jt.bitmap,lt,{x:0,y:0},{x:qt.x+Ar,y:qt.y+Ar},Jt.bitmap)}}this.image=lt,this.positions=ve}}function O(dt,fe,ve){dt[fe]?ve&&(dt[fe].center=ve):dt[fe]={floorIds:new Set,center:ve||[0,0],floors:{}}}function P(dt,fe,ve,Me){for(const et of fe)O(dt,et),dt[et].floors[ve]=Me,dt[et].floorIds.add(ve)}function N(dt){return{id:dt.properties.id.toString(),center:dt.properties.center.toString().split(";").map(Number)}}function R(dt){return{id:dt.properties.id.toString(),isDefault:!!dt.properties.is_default&&dt.properties.is_default,connections:dt.properties.connected_floor_ids?new Set(dt.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:dt.properties.conflicted_floor_ids?new Set(dt.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:dt.properties.building_ids?new Set(dt.properties.building_ids.toString().split(";")):new Set,name:dt.properties.name.toString(),zIndex:dt.properties.z_index}}function M(dt,fe){return fe.every(ve=>dt.properties&&dt.properties[ve]!=null)}function F(dt){return M(dt,["type","id","name"])&&dt.properties.type==="building"}function B(dt){return M(dt,["type","id","name","z_index"])&&dt.properties.type==="floor"}i.fi(A,"GlyphAtlas");class ${constructor(fe){this.tileID=new i.aP(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.lut=fe.lut,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.scope=fe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=fe.showCollisionBoxes,this.collectResourceTiming=!!fe.request&&fe.request.collectResourceTiming,this.promoteId=fe.promoteId,this.isSymbolTile=fe.isSymbolTile,this.tileTransform=i.aY(fe.tileID.canonical,fe.projection),this.projection=fe.projection,this.worldview=fe.worldview,this.localizableLayerIds=fe.localizableLayerIds,this.brightness=fe.brightness,this.extraShadowCaster=!!fe.extraShadowCaster,this.tessellationStep=fe.tessellationStep,this.scaleFactor=fe.scaleFactor,this.worldview=fe.worldview,this.indoor=fe.indoor}parse(fe,ve,Me,et,Qe,lt){this.status="parsing",this.data=fe,this.collisionBoxArray=new i.b2;const bt=new i.fl(Object.keys(fe.layers).sort()),ct=new i.fm(this.tileID,this.promoteId);ct.bucketLayerIDs=[];const vt={},Jt=new i.fn(256,256),qt={featureIndex:ct,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Jt,availableImages:Me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const zr=this.indoor.indoorState.activeFloorsVisible,bn=function(An,Si,xs){const Zs=function(_i,Mn){if(!_i)return i.w("No source layers defined in indoor specification"),Mn;if(_i.size===0)return Mn;const Yi=_i.difference(Mn);for(const ms of Yi)i.w(`Missing source layer required in indoor specification: ${ms}`);return Mn.intersection(Mn)}(Si.sourceLayers,new Set(Object.keys(An.layers))),Ms=Si.indoorState,Os=function(_i,Mn,Yi,ms){const Ti=new Set,Ji=new Set,la=new Set,Uo=new Map,bc={},sf=xa=>{const wc=Uo.get(xa)||new Set;for(const il of Ti)if((Uo.get(il)||new Set).has(xa)||wc.has(il))return!0;return!1};for(const xa of Mn){const wc=_i.layers[xa];if(wc)for(let il=0;il<wc.length;il++){const Jc=wc.feature(il);if(F(Jc)){const{id:Pl,center:Ol}=N(Jc);O(bc,Pl,Ol),Ti.add(Pl)}else if(B(Jc)){const{id:Pl,isDefault:Ol,connections:o_,conflicts:Rg,buildings:Mg,name:Dg,zIndex:yl}=R(Jc);P(bc,Mg,Pl,{name:Dg,zIndex:yl}),Uo.set(Pl,Rg),(Pl===ms||o_.has(ms))&&Ti.add(Pl),Ji.add(Pl),Ol&&la.add(Pl)}}else i.w(`indoor source layer not found: ${xa}`)}if(Yi)for(const xa of Yi)Ji.has(xa)&&(sf(xa)||Ti.add(xa));for(const xa of la)Ti.has(xa)||sf(xa)||Ti.add(xa);return{buildings:bc,activeFloors:Ti}}(An,Zs,Ms.lastActiveFloors,Ms.selectedFloorId);return xs.send("setIndoorData",Os),Os}(fe,this.indoor,Qe);qt.activeFloors=zr?bn.activeFloors:void 0}const Ar=[],Jr=ve.familiesBySource[this.source];for(const zr in Jr){const bn=fe.layers[zr];if(!bn)continue;let An=!1,Si=!1,xs=!1;for(const _i of Jr[zr])_i[0].type==="symbol"?An=!0:Si=!0,_i[0].is3D()&&_i[0].type!=="model"&&(xs=!0);if(this.extraShadowCaster&&!xs||this.isSymbolTile===!0&&!An||this.isSymbolTile===!1&&!Si)continue;bn.version===1&&i.w(`Vector tile source "${this.source}" layer "${zr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zs=bt.encode(zr),Ms=[];let Os=!1;for(let _i=0,Mn=0;_i<bn.length;_i++){const Yi=bn.feature(_i),ms=ct.getId(Yi,zr);if(this.localizableLayerIds&&this.localizableLayerIds.has(zr)){const Ti=Yi.properties?Yi.properties.worldview:null;if(this.worldview&&typeof Ti=="string")if(Ti==="all")Yi.properties.$localized=!0;else{if(!Ti.split(",").includes(this.worldview))continue;Yi.properties.$localized=!0,Yi.properties.worldview=this.worldview}}!Os&&Yi.properties&&Yi.properties.hasOwnProperty(i.fo)&&(Os=!0),Ms.push({feature:Yi,id:ms,index:Mn,sourceLayerIndex:Zs}),Mn++}Os&&!qt.elevationFeatures&&fe.layers.hasOwnProperty(i.fp)&&(qt.elevationFeatures=i.fq.parseFrom(fe.layers[i.fp],this.canonical));for(const _i of Jr[zr]){const Mn=_i[0];if(this.extraShadowCaster&&(!Mn.is3D()||Mn.type==="model")||this.isSymbolTile!==void 0&&Mn.type==="symbol"!==this.isSymbolTile||Mn.minzoom&&this.zoom<Math.floor(Mn.minzoom)||Mn.maxzoom&&this.zoom>=Mn.maxzoom||Mn.visibility==="none")continue;W(_i,this.zoom,qt.brightness,Me,this.worldview);const Yi=vt[Mn.id]=Mn.createBucket({index:ct.bucketLayerIDs.length,layers:_i,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zs,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:et,worldview:this.worldview});ct.bucketLayerIDs.push(_i.map(Ti=>i.B(Ti.id,Ti.scope)));let ms=Yi.prepare?Yi.prepare():null;ms!=null?(ms=ms.then(()=>Yi.populate(Ms,qt,this.tileID.canonical,this.tileTransform)),Ar.push(ms)):Yi.populate(Ms,qt,this.tileID.canonical,this.tileTransform)}}const Zr=()=>{let zr,bn,An,Si,xs,Zs;Jt.trim();const Ms={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Os=()=>{if(zr)return this.status="done",lt(zr);if(this.extraShadowCaster)this.status="done",lt(null,{buckets:Object.values(vt).filter(Mn=>!Mn.isEmpty()),featureIndex:ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:qt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(bn&&An&&Si){const Mn=new A(bn),Yi=new Map;for(const[Ji,la]of An.entries()){const{imagePosition:Uo}=i.ft(Ji,la,i.fu);Yi.set(Ji,Uo)}const ms={};for(const Ji in vt){const la=vt[Ji];la instanceof i.b3&&(W(la.layers,this.zoom,qt.brightness,Me,this.worldview),ms[Ji]=i.fv(la,bn,Mn.positions,An,Yi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,xs,this.worldview))}const Ti={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Qe,An,xs,()=>{Ti.iconsPending=!1,_i(ms,Mn,Ti)}),this.rasterizeIfNeeded(Qe,Si,Zs,()=>{Ti.patternsPending=!1,_i(ms,Mn,Ti)})}},_i=(Mn,Yi,ms,Ti)=>{if(ms.iconsPending||ms.patternsPending)return;const Ji=new i.fw(An,Si,this.lut);for(const la in vt){const Uo=vt[la];if(la in Mn)i.fx(Uo,Mn[la],this.showCollisionBoxes,Me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,An,Ji);else if(Uo.hasPattern&&(Uo instanceof i.b9||Uo instanceof i.ba||Uo instanceof i.e9)){W(Uo.layers,this.zoom,qt.brightness,Me,this.worldview);const bc=Object.fromEntries(Ji.patternPositions);Uo.addFeatures(qt,this.tileID.canonical,bc,Me,this.tileTransform,this.brightness)}}this.status="done",lt(null,{buckets:Object.values(vt).filter(la=>!la.isEmpty()),featureIndex:ct,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yi.image,lineAtlas:Jt,imageAtlas:Ji,brightness:qt.brightness})};if(!this.extraShadowCaster){const Mn=i.fr(qt.glyphDependencies,Ti=>Object.keys(Ti).map(Number));Object.keys(Mn).length?Qe.send("getGlyphs",{uid:this.uid,stacks:Mn},(Ti,Ji)=>{zr||(zr=Ti,bn=Ji,Os())},void 0,!1,Ms):bn={};const Yi=Array.from(qt.iconDependencies.keys()).map(Ti=>i.I.parse(Ti));Yi.length?Qe.send("getImages",{images:Yi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ti,Ji)=>{zr||(zr=Ti,An=new Map,xs=this.updateImageMapAndGetImageTaskQueue(An,Ji,qt.iconDependencies),Os())},void 0,!1,Ms):(An=new Map,xs=new Map);const ms=Array.from(qt.patternDependencies.keys()).map(Ti=>i.I.parse(Ti));ms.length?Qe.send("getImages",{images:ms,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ti,Ji)=>{zr||(zr=Ti,Si=new Map,Zs=this.updateImageMapAndGetImageTaskQueue(Si,Ji,qt.patternDependencies),Os())},void 0,!1,Ms):(Si=new Map,Zs=new Map)}if(qt.elevationFeatures&&qt.elevationFeatures.length>0){const Mn=[];for(const ms of Object.values(vt))if(ms instanceof i.ba){const Ti=ms.getUnevaluatedPortalGraph();Ti&&Mn.push(Ti)}const Yi=i.fs.evaluate(Mn);for(const ms of Object.values(vt))if(ms instanceof i.ba){const Ti=fe.layers[bt.decode(ms.sourceLayerIndex)];ms.setEvaluatedPortalGraph(Yi,Ti,this.tileID.canonical,qt.availableImages,qt.brightness)}}Os()};Ar.length>0?Promise.allSettled(Ar).then(Zr).catch(lt):Zr()}updateParameters(fe){this.scaleFactor=fe.scaleFactor,this.showCollisionBoxes=fe.showCollisionBoxes,this.projection=fe.projection,this.brightness=fe.brightness,this.tileTransform=i.aY(fe.tileID.canonical,fe.projection),this.extraShadowCaster=fe.extraShadowCaster,this.lut=fe.lut,this.worldview=fe.worldview,this.indoor=fe.indoor}rasterizeIfNeeded(fe,ve,Me,et){Array.from(ve.values()).some(Qe=>Qe.usvg)?this.rasterize(fe,ve,Me,et):et()}updateImageMapAndGetImageTaskQueue(fe,ve,Me){const et=new Map;for(const Qe of ve.keys()){const lt=Me.get(Qe)||[];for(const bt of lt){const ct=bt.toString(),vt=ve.get(bt.id.toString());vt.usvg?et.has(ct)||(et.set(ct,bt),fe.set(ct,Object.assign({},vt))):fe.set(ct,vt)}}return et}rasterize(fe,ve,Me,et){this.rasterizeTask=fe.send("rasterizeImages",{scope:this.scope,tasks:Me},(Qe,lt)=>{if(!Qe)for(const[bt,ct]of lt.entries()){const vt=Object.assign(ve.get(bt),{data:ct});ve.set(bt,vt)}et()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function W(dt,fe,ve,Me,et){const Qe=new i.ac(fe,{brightness:ve,worldview:et});for(const lt of dt)lt.recalculate(Qe,Me)}class K extends i.E{constructor(fe,ve,Me,et,Qe,lt,bt){super(),this.actor=fe,this.layerIndex=ve,this.availableImages=Me,this.availableModels=et,this.loadVectorData=lt||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(fe.scheduler),this.isSpriteLoaded=Qe,this.scheduler=fe.scheduler,this.brightness=bt}loadTile(fe,ve){const Me=fe.uid,et=fe&&fe.request,Qe=et&&et.collectResourceTiming,lt=this.loading[Me]=new $(fe);lt.abort=this.loadVectorData(fe,(bt,ct)=>{const vt=!this.loading[Me];if(delete this.loading[Me],lt.cancelRasterize(),vt||bt||!ct)return lt.status="done",vt||(this.loaded[Me]=lt),ve(bt);const Jt=ct.rawData,qt={},Ar=i.aM(ct.responseHeaders);Ar&&Ar.expires&&(qt.expires=Ar.expires),Ar&&Ar.cacheControl&&(qt.cacheControl=Ar.cacheControl),lt.vectorTile=ct.vectorTile||new i.fy(new i.bs(Jt));const Jr=()=>{lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Zr,zr)=>{if(Zr||!zr)return ve(Zr);const bn={};if(Qe){const An=m(et);An.length>0&&(bn.resourceTiming=JSON.parse(JSON.stringify(An)))}ve(null,Object.assign({rawTileData:Jt.slice(0),responseHeaders:ct.responseHeaders},zr,qt,bn))})};this.isSpriteLoaded?Jr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Jr,{type:"parseTile",isSymbolTile:fe.isSymbolTile,zoom:fe.tileZoom}):Jr()}),this.loaded=this.loaded||{},this.loaded[Me]=lt})}reloadTile(fe,ve){const Me=this.loaded,et=fe.uid;if(Me&&Me[et]){const Qe=Me[et];Qe.updateParameters(fe);const lt=(bt,ct)=>{const vt=Qe.reloadCallback;vt&&(delete Qe.reloadCallback,Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,vt)),ve(bt,ct)};Qe.status==="parsing"?Qe.reloadCallback=lt:Qe.status==="done"&&(Qe.vectorTile?Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,lt):lt())}else ve(null,void 0)}abortTile(fe,ve){const Me=fe.uid,et=this.loading[Me];et&&(et.abort&&et.abort(),delete this.loading[Me]),ve()}removeTile(fe,ve){const Me=this.loaded,et=fe.uid;Me&&Me[et]&&delete Me[et],ve()}}class te{loadTile(fe,ve){const{uid:Me,encoding:et,rawImageData:Qe,padding:lt}=fe,bt=ImageBitmap&&Qe instanceof ImageBitmap?this.getImageData(Qe,lt):Qe;ve(null,new i.fz(Me,bt,et,lt<1))}reloadTile(fe,ve){ve(null,null)}abortTile(fe,ve){ve()}removeTile(fe,ve){ve()}getImageData(fe,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(fe.width,fe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=fe.width,this.offscreenCanvas.height=fe.height,this.offscreenCanvasContext.drawImage(fe,0,0,fe.width,fe.height);const Me=this.offscreenCanvasContext.getImageData(-ve,-ve,fe.width+2*ve,fe.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Me}}i.br.setPbf(i.bs);class ne{constructor(fe){this._mrt=new i.br(fe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=fe.uid,this.tileID=fe.tileID,this.source=fe.source}parse(fe,ve){const Me=this._mrt;this.status="parsing",this._entireBuffer=fe;try{Me.parseHeader(fe),this._isHeaderLoaded=!0;const et=[];for(const Qe in Me.layers){const lt=Me.getLayer(Qe),bt=lt.getDataRange(lt.getBandList()),ct=Me.createDecodingTask(bt),vt=fe.slice(bt.firstByte,bt.lastByte+1),Jt=i.br.performDecoding(vt,ct).then(qt=>ct.complete(null,qt)).catch(qt=>ct.complete(qt,null));et.push(Jt)}Promise.allSettled(et).then(()=>ve(null,Me)).catch(Qe=>ve(Qe))}catch(et){ve(et)}}}class ae{constructor(fe){this.actor=fe,this.loading={},this.loaded={}}loadTile(fe,ve){const Me=fe.uid,et=fe.request,Qe=this.loading[Me]=new ne(fe),{cancel:lt}=i.bt(et,(bt,ct,vt)=>{const Jt=!this.loading[Me];if(delete this.loading[Me],Jt||bt||!ct)return Qe.status="done",Jt||(this.loaded[Me]=Qe),ve(bt);Qe.parse(ct,(qt,Ar)=>{if(qt||!Ar)return ve(qt);ve(null,Ar,vt)}),this.loaded[Me]=Qe});Qe.abort=lt}reloadTile(fe,ve){ve(null,void 0)}abortTile(fe,ve){const Me=fe.uid,et=this.loading[Me];et&&(et.abort&&et.abort(),delete this.loading[Me]),ve()}removeTile(fe,ve){const Me=fe.uid;this.loaded[Me]&&delete this.loaded[Me],ve()}decodeRasterArray(fe,ve){i.br.performDecoding(fe.buffer,fe.task).then(Me=>ve(null,Me)).catch(Me=>ve(Me))}}const re=i.fA.prototype.toGeoJSON;class ee{constructor(fe){this._feature=fe,this.extent=i.al,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){const fe=[];for(const ve of this._feature.geometry)fe.push([new i.P(ve[0],ve[1])]);return fe}{const fe=[];for(const ve of this._feature.geometry){const Me=[];for(const et of ve)Me.push(new i.P(et[0],et[1]));fe.push(Me)}return fe}}toGeoJSON(fe,ve,Me){return re.call(this,fe,ve,Me)}}class ie{constructor(fe,ve){this.name=fe,this.extent=i.al,this.length=ve.length,this._jsonFeatures=ve}feature(fe){return new ee(this._jsonFeatures[fe])}}class de{constructor(fe){this.layers={},this.extent=i.al;for(const ve of Object.keys(fe))this.layers[ve]=new ie(ve,fe[ve])}}const be=64/4096,Se=128;class Ae{constructor(){this.features=new Map}clear(){this.features.clear()}load(fe=[],ve){for(const Me of fe){const et=Me.id;if(et==null)continue;let Qe=this.features.get(et);Qe&&this.updateCache(Qe,ve),Me.geometry?(Qe=me(Me),this.updateCache(Qe,ve),this.features.set(et,Qe)):this.features.delete(et),this.updateCache(Qe,ve)}}updateCache(fe,ve){for(const{canonical:Me,uid:et}of Object.values(ve)){const{z:Qe,x:lt,y:bt}=Me;xe(fe,Math.pow(2,Qe),lt,bt)&&delete ve[et]}}getTile(fe,ve,Me){const et=Math.pow(2,fe),Qe=[];for(const lt of this.features.values())xe(lt,et,ve,Me)&&Qe.push(Oe(lt,et,ve,Me));return{features:Qe}}getFeatures(){return[...this.features.values()]}}function xe({minX:dt,minY:fe,maxX:ve,maxY:Me},et,Qe,lt){return dt<(Qe+1+be)/et&&fe<(lt+1+be)/et&&ve>(Qe-be)/et&&Me>(lt-be)/et}function me(dt){const{id:fe,geometry:ve,properties:Me}=dt;if(!ve)return;if(ve.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:et,coordinates:Qe}=ve,lt={id:fe,type:1,geometry:[],tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},bt=lt.geometry;if(et==="Point")Ce(Qe,bt,lt);else if(et==="MultiPoint")for(const ct of Qe)Ce(ct,bt,lt);else if(et==="LineString")lt.type=2,ge(Qe,bt,lt);else if(et==="MultiLineString")lt.type=2,pe(Qe,bt,lt);else if(et==="Polygon")lt.type=3,pe(Qe,bt,lt,!0);else{if(et!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");lt.type=3;for(const ct of Qe)pe(ct,bt,lt,!0)}return lt}function Ce([dt,fe],ve,Me){const et=i.aF(dt);let Qe=i.aJ(fe);Qe=Qe<0?0:Qe>1?1:Qe,ve.push(et,Qe),Me.minX=Math.min(Me.minX,et),Me.minY=Math.min(Me.minY,Qe),Me.maxX=Math.max(Me.maxX,et),Me.maxY=Math.max(Me.maxY,Qe)}function ge(dt,fe,ve,Me=!1,et=!1){const Qe=[];for(const lt of dt)Ce(lt,Qe,ve);fe.push(Qe),Me&&function(lt,bt){let ct=0;for(let vt=0,Jt=lt.length,qt=Jt-2;vt<Jt;qt=vt,vt+=2)ct+=(lt[vt]-lt[qt])*(lt[vt+1]+lt[qt+1]);if(ct>0===bt)for(let vt=0,Jt=lt.length;vt<Jt/2;vt+=2){const qt=lt[vt],Ar=lt[vt+1];lt[vt]=lt[Jt-2-vt],lt[vt+1]=lt[Jt-1-vt],lt[Jt-2-vt]=qt,lt[Jt-1-vt]=Ar}}(Qe,et)}function pe(dt,fe,ve,Me=!1){for(let et=0;et<dt.length;et++)ge(dt[et],fe,ve,Me,et===0)}function Oe(dt,fe,ve,Me){const{id:et,type:Qe,geometry:lt,tags:bt}=dt,ct=[];if(Qe===1)(function(vt,Jt,qt,Ar,Jr){for(let Zr=0;Zr<vt.length;Zr+=2){const zr=Math.round(i.al*(vt[Zr+0]*Jt-qt)),bn=Math.round(i.al*(vt[Zr+1]*Jt-Ar));Jr.push([zr,bn])}})(lt,fe,ve,Me,ct);else for(const vt of lt)Xe(vt,fe,ve,Me,ct);return{id:et,type:Qe,geometry:ct,tags:bt}}function Xe(dt,fe,ve,Me,et){const Qe=-Se,lt=i.al+Se;let bt;for(let ct=0;ct<dt.length-2;ct+=2){let vt=Math.round(i.al*(dt[ct+0]*fe-ve)),Jt=Math.round(i.al*(dt[ct+1]*fe-Me)),qt=Math.round(i.al*(dt[ct+2]*fe-ve)),Ar=Math.round(i.al*(dt[ct+3]*fe-Me));const Jr=qt-vt,Zr=Ar-Jt;vt<Qe&&qt<Qe||(vt<Qe?(Jt+=Math.round(Zr*((Qe-vt)/Jr)),vt=Qe):qt<Qe&&(Ar=Jt+Math.round(Zr*((Qe-vt)/Jr)),qt=Qe),Jt<Qe&&Ar<Qe||(Jt<Qe?(vt+=Math.round(Jr*((Qe-Jt)/Zr)),Jt=Qe):Ar<Qe&&(qt=vt+Math.round(Jr*((Qe-Jt)/Zr)),Ar=Qe),vt>=lt&&qt>=lt||(vt>=lt?(Jt+=Math.round(Zr*((lt-vt)/Jr)),vt=lt):qt>=lt&&(Ar=Jt+Math.round(Zr*((lt-vt)/Jr)),qt=lt),Jt>=lt&&Ar>=lt||(Jt>=lt?(vt+=Math.round(Jr*((lt-Jt)/Zr)),Jt=lt):Ar>=lt&&(qt=vt+Math.round(Jr*((lt-Jt)/Zr)),Ar=lt),bt&&vt===bt[bt.length-1][0]&&Jt===bt[bt.length-1][1]||(bt=[[vt,Jt]],et.push(bt)),bt.push([qt,Ar])))))}}function We({name:dt,features:fe},ve){ve.writeStringField(1,dt),ve.writeVarintField(5,i.al);const Me=new Map,et=new Map,Qe={keys:Me,values:et,feature:null};for(const lt of fe)Qe.feature=lt,ve.writeMessage(2,$e,Qe);for(const lt of Me.keys())ve.writeStringField(3,lt);for(const lt of et.keys())ve.writeMessage(4,_t,lt)}function $e(dt,fe){const ve=dt.feature;ve.id!==void 0&&Number.isSafeInteger(+ve.id)&&fe.writeVarintField(1,+ve.id),ve.tags&&fe.writeMessage(2,Ke,dt),fe.writeVarintField(3,ve.type),fe.writeMessage(4,st,ve)}function Ke({keys:dt,values:fe,feature:ve},Me){for(const et of Object.keys(ve.tags)){let Qe=ve.tags[et];if(Qe===null)continue;let lt=dt.get(et);lt===void 0&&(lt=dt.size,dt.set(et,lt)),Me.writeVarint(lt);const bt=typeof Qe;bt!=="string"&&bt!=="boolean"&&bt!=="number"&&(Qe=JSON.stringify(Qe));let ct=fe.get(Qe);ct===void 0&&(ct=fe.size,fe.set(Qe,ct)),Me.writeVarint(ct)}}function Le(dt,fe){return(fe<<3)+(7&dt)}function ke(dt){return dt<<1^dt>>31}function st(dt,fe){const{geometry:ve,type:Me}=dt;let et=0,Qe=0;if(Me===1){fe.writeVarint(Le(1,ve.length));for(const lt of ve){const bt=lt[0]-et,ct=lt[1]-Qe;fe.writeVarint(ke(bt)),fe.writeVarint(ke(ct)),et+=bt,Qe+=ct}}else for(const lt of ve){fe.writeVarint(Le(1,1));const bt=lt.length-(Me===3?1:0);for(let ct=0;ct<bt;ct++){ct===1&&fe.writeVarint(Le(2,bt-1));const vt=lt[ct][0]-et,Jt=lt[ct][1]-Qe;fe.writeVarint(ke(vt)),fe.writeVarint(ke(Jt)),et+=vt,Qe+=Jt}Me===3&&fe.writeVarint(Le(7,1))}}function _t(dt,fe){const ve=typeof dt;ve==="string"?fe.writeStringField(1,dt):ve==="boolean"?fe.writeBooleanField(7,dt):ve==="number"&&(dt%1!=0?fe.writeDoubleField(3,dt):dt<0?fe.writeSVarintField(6,dt):fe.writeVarintField(5,dt))}const Be={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:dt=>dt},Dt=Math.fround||(It=new Float32Array(1),dt=>(It[0]=+dt,It[0]));var It;const ir=3,Dr=5,Rr=6;class jt{constructor(fe){this.options=Object.assign(Object.create(Be),fe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(fe){const{log:ve,minZoom:Me,maxZoom:et}=this.options;ve&&console.time("total time");const Qe=`prepare ${fe.length} points`;ve&&console.time(Qe),this.points=fe;const lt=[];for(let ct=0;ct<fe.length;ct++){const vt=fe[ct];if(!vt.geometry)continue;const[Jt,qt]=vt.geometry.coordinates,Ar=Dt(pt(Jt)),Jr=Dt(rt(qt));lt.push(Ar,Jr,1/0,ct,-1,1),this.options.reduce&&lt.push(0)}let bt=this.trees[et+1]=this._createTree(lt);ve&&console.timeEnd(Qe);for(let ct=et;ct>=Me;ct--){const vt=+Date.now();bt=this.trees[ct]=this._createTree(this._cluster(bt,ct)),ve&&console.log("z%d: %d clusters in %dms",ct,bt.numItems,+Date.now()-vt)}return ve&&console.timeEnd("total time"),this}getClusters(fe,ve){let Me=((fe[0]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,fe[1]));let Qe=fe[2]===180?180:((fe[2]+180)%360+360)%360-180;const lt=Math.max(-90,Math.min(90,fe[3]));if(fe[2]-fe[0]>=360)Me=-180,Qe=180;else if(Me>Qe){const qt=this.getClusters([Me,et,180,lt],ve),Ar=this.getClusters([-180,et,Qe,lt],ve);return qt.concat(Ar)}const bt=this.trees[this._limitZoom(ve)],ct=bt.range(pt(Me),rt(lt),pt(Qe),rt(et)),vt=bt.data,Jt=[];for(const qt of ct){const Ar=this.stride*qt;Jt.push(vt[Ar+Dr]>1?zt(vt,Ar,this.clusterProps):this.points[vt[Ar+ir]])}return Jt}getChildren(fe){const ve=this._getOriginId(fe),Me=this._getOriginZoom(fe),et="No cluster with the specified id.",Qe=this.trees[Me];if(!Qe)throw new Error(et);const lt=Qe.data;if(ve*this.stride>=lt.length)throw new Error(et);const bt=this.options.radius/(this.options.extent*Math.pow(2,Me-1)),ct=Qe.within(lt[ve*this.stride],lt[ve*this.stride+1],bt),vt=[];for(const Jt of ct){const qt=Jt*this.stride;lt[qt+4]===fe&&vt.push(lt[qt+Dr]>1?zt(lt,qt,this.clusterProps):this.points[lt[qt+ir]])}if(vt.length===0)throw new Error(et);return vt}getLeaves(fe,ve,Me){const et=[];return this._appendLeaves(et,fe,ve=ve||10,Me=Me||0,0),et}getTile(fe,ve,Me){const et=this.trees[this._limitZoom(fe)],Qe=Math.pow(2,fe),{extent:lt,radius:bt}=this.options,ct=bt/lt,vt=(Me-ct)/Qe,Jt=(Me+1+ct)/Qe,qt={features:[]};return this._addTileFeatures(et.range((ve-ct)/Qe,vt,(ve+1+ct)/Qe,Jt),et.data,ve,Me,Qe,qt),ve===0&&this._addTileFeatures(et.range(1-ct/Qe,vt,1,Jt),et.data,Qe,Me,Qe,qt),ve===Qe-1&&this._addTileFeatures(et.range(0,vt,ct/Qe,Jt),et.data,-1,Me,Qe,qt),qt.features.length?qt:null}getClusterExpansionZoom(fe){let ve=this._getOriginZoom(fe)-1;for(;ve<=this.options.maxZoom;){const Me=this.getChildren(fe);if(ve++,Me.length!==1)break;fe=Me[0].properties.cluster_id}return ve}_appendLeaves(fe,ve,Me,et,Qe){const lt=this.getChildren(ve);for(const bt of lt){const ct=bt.properties;if(ct&&ct.cluster?Qe+ct.point_count<=et?Qe+=ct.point_count:Qe=this._appendLeaves(fe,ct.cluster_id,Me,et,Qe):Qe<et?Qe++:fe.push(bt),fe.length===Me)break}return Qe}_createTree(fe){const ve=new i.c3(fe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Me=0;Me<fe.length;Me+=this.stride)ve.add(fe[Me],fe[Me+1]);return ve.finish(),ve.data=fe,ve}_addTileFeatures(fe,ve,Me,et,Qe,lt){for(const bt of fe){const ct=bt*this.stride,vt=ve[ct+Dr]>1;let Jt,qt,Ar;if(vt)Jt=Je(ve,ct,this.clusterProps),qt=ve[ct],Ar=ve[ct+1];else{const zr=this.points[ve[ct+ir]];Jt=zr.properties;const[bn,An]=zr.geometry.coordinates;qt=pt(bn),Ar=rt(An)}const Jr={type:1,geometry:[[Math.round(this.options.extent*(qt*Qe-Me)),Math.round(this.options.extent*(Ar*Qe-et))]],tags:Jt};let Zr;Zr=vt||this.options.generateId?ve[ct+ir]:this.points[ve[ct+ir]].id,Zr!==void 0&&(Jr.id=Zr),lt.features.push(Jr)}}_limitZoom(fe){return Math.max(this.options.minZoom,Math.min(Math.floor(+fe),this.options.maxZoom+1))}_cluster(fe,ve){const{radius:Me,extent:et,reduce:Qe,minPoints:lt}=this.options,bt=Me/(et*Math.pow(2,ve)),ct=fe.data,vt=[],Jt=this.stride;for(let qt=0;qt<ct.length;qt+=Jt){if(ct[qt+2]<=ve)continue;ct[qt+2]=ve;const Ar=ct[qt],Jr=ct[qt+1],Zr=fe.within(ct[qt],ct[qt+1],bt),zr=ct[qt+Dr];let bn=zr;for(const An of Zr){const Si=An*Jt;ct[Si+2]>ve&&(bn+=ct[Si+Dr])}if(bn>zr&&bn>=lt){let An,Si=Ar*zr,xs=Jr*zr,Zs=-1;const Ms=(qt/Jt<<5)+(ve+1)+this.points.length;for(const Os of Zr){const _i=Os*Jt;if(ct[_i+2]<=ve)continue;ct[_i+2]=ve;const Mn=ct[_i+Dr];Si+=ct[_i]*Mn,xs+=ct[_i+1]*Mn,ct[_i+4]=Ms,Qe&&(An||(An=this._map(ct,qt,!0),Zs=this.clusterProps.length,this.clusterProps.push(An)),Qe(An,this._map(ct,_i)))}ct[qt+4]=Ms,vt.push(Si/bn,xs/bn,1/0,Ms,-1,bn),Qe&&vt.push(Zs)}else{for(let An=0;An<Jt;An++)vt.push(ct[qt+An]);if(bn>1)for(const An of Zr){const Si=An*Jt;if(!(ct[Si+2]<=ve)){ct[Si+2]=ve;for(let xs=0;xs<Jt;xs++)vt.push(ct[Si+xs])}}}}return vt}_getOriginId(fe){return fe-this.points.length>>5}_getOriginZoom(fe){return(fe-this.points.length)%32}_map(fe,ve,Me){if(fe[ve+Dr]>1){const lt=this.clusterProps[fe[ve+Rr]];return Me?Object.assign({},lt):lt}const et=this.points[fe[ve+ir]].properties,Qe=this.options.map(et);return Me&&Qe===et?Object.assign({},Qe):Qe}}function zt(dt,fe,ve){return{type:"Feature",id:dt[fe+ir],properties:Je(dt,fe,ve),geometry:{type:"Point",coordinates:[(Me=dt[fe],360*(Me-.5)),Kt(dt[fe+1])]}};var Me}function Je(dt,fe,ve){const Me=dt[fe+Dr],et=Me>=1e4?`${Math.round(Me/1e3)}k`:Me>=1e3?Math.round(Me/100)/10+"k":Me,Qe=dt[fe+Rr],lt=Qe===-1?{}:Object.assign({},ve[Qe]);return Object.assign(lt,{cluster:!0,cluster_id:dt[fe+ir],point_count:Me,point_count_abbreviated:et})}function pt(dt){return dt/360+.5}function rt(dt){const fe=Math.sin(dt*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function Kt(dt){const fe=(180-360*dt)*Math.PI/180;return 360*Math.atan(Math.exp(fe))/Math.PI-90}function Ut(dt,fe,ve,Me){let et=Me;const Qe=fe+(ve-fe>>1);let lt,bt=ve-fe;const ct=dt[fe],vt=dt[fe+1],Jt=dt[ve],qt=dt[ve+1];for(let Ar=fe+3;Ar<ve;Ar+=3){const Jr=Ht(dt[Ar],dt[Ar+1],ct,vt,Jt,qt);if(Jr>et)lt=Ar,et=Jr;else if(Jr===et){const Zr=Math.abs(Ar-Qe);Zr<bt&&(lt=Ar,bt=Zr)}}et>Me&&(lt-fe>3&&Ut(dt,fe,lt,Me),dt[lt+2]=et,ve-lt>3&&Ut(dt,lt,ve,Me))}function Ht(dt,fe,ve,Me,et,Qe){let lt=et-ve,bt=Qe-Me;if(lt!==0||bt!==0){const ct=((dt-ve)*lt+(fe-Me)*bt)/(lt*lt+bt*bt);ct>1?(ve=et,Me=Qe):ct>0&&(ve+=lt*ct,Me+=bt*ct)}return lt=dt-ve,bt=fe-Me,lt*lt+bt*bt}function Cr(dt,fe,ve,Me){const et={id:dt??null,type:fe,geometry:ve,tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")un(et,ve);else if(fe==="Polygon")un(et,ve[0]);else if(fe==="MultiLineString")for(const Qe of ve)un(et,Qe);else if(fe==="MultiPolygon")for(const Qe of ve)un(et,Qe[0]);return et}function un(dt,fe){for(let ve=0;ve<fe.length;ve+=3)dt.minX=Math.min(dt.minX,fe[ve]),dt.minY=Math.min(dt.minY,fe[ve+1]),dt.maxX=Math.max(dt.maxX,fe[ve]),dt.maxY=Math.max(dt.maxY,fe[ve+1])}function hn(dt,fe,ve,Me){if(!fe.geometry)return;const et=fe.geometry.coordinates;if(et&&et.length===0)return;const Qe=fe.geometry.type,lt=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2);let bt=[],ct=fe.id;if(ve.promoteId?ct=fe.properties[ve.promoteId]:ve.generateId&&(ct=Me||0),Qe==="Point")Kn(et,bt);else if(Qe==="MultiPoint")for(const vt of et)Kn(vt,bt);else if(Qe==="LineString")Gn(et,bt,lt,!1);else if(Qe==="MultiLineString"){if(ve.lineMetrics){for(const vt of et)bt=[],Gn(vt,bt,lt,!1),dt.push(Cr(ct,"LineString",bt,fe.properties));return}Mi(et,bt,lt,!1)}else if(Qe==="Polygon")Mi(et,bt,lt,!0);else{if(Qe!=="MultiPolygon"){if(Qe==="GeometryCollection"){for(const vt of fe.geometry.geometries)hn(dt,{id:ct,geometry:vt,properties:fe.properties},ve,Me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const vt of et){const Jt=[];Mi(vt,Jt,lt,!0),bt.push(Jt)}}dt.push(Cr(ct,Qe,bt,fe.properties))}function Kn(dt,fe){fe.push(Pa(dt[0]),_s(dt[1]),0)}function Gn(dt,fe,ve,Me){let et,Qe,lt=0;for(let ct=0;ct<dt.length;ct++){const vt=Pa(dt[ct][0]),Jt=_s(dt[ct][1]);fe.push(vt,Jt,0),ct>0&&(lt+=Me?(et*Jt-vt*Qe)/2:Math.sqrt(Math.pow(vt-et,2)+Math.pow(Jt-Qe,2))),et=vt,Qe=Jt}const bt=fe.length-3;fe[2]=1,Ut(fe,0,bt,ve),fe[bt+2]=1,fe.size=Math.abs(lt),fe.start=0,fe.end=fe.size}function Mi(dt,fe,ve,Me){for(let et=0;et<dt.length;et++){const Qe=[];Gn(dt[et],Qe,ve,Me),fe.push(Qe)}}function Pa(dt){return dt/360+.5}function _s(dt){const fe=Math.sin(dt*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function mi(dt,fe,ve,Me,et,Qe,lt,bt){if(Me/=fe,Qe>=(ve/=fe)&&lt<Me)return dt;if(lt<ve||Qe>=Me)return null;const ct=[];for(const vt of dt){const Jt=vt.geometry;let qt=vt.type;const Ar=et===0?vt.minX:vt.minY,Jr=et===0?vt.maxX:vt.maxY;if(Ar>=ve&&Jr<Me){ct.push(vt);continue}if(Jr<ve||Ar>=Me)continue;let Zr=[];if(qt==="Point"||qt==="MultiPoint")Ua(Jt,Zr,ve,Me,et);else if(qt==="LineString")Va(Jt,Zr,ve,Me,et,!1,bt.lineMetrics);else if(qt==="MultiLineString")qa(Jt,Zr,ve,Me,et,!1);else if(qt==="Polygon")qa(Jt,Zr,ve,Me,et,!0);else if(qt==="MultiPolygon")for(const zr of Jt){const bn=[];qa(zr,bn,ve,Me,et,!0),bn.length&&Zr.push(bn)}if(Zr.length){if(bt.lineMetrics&&qt==="LineString"){for(const zr of Zr)ct.push(Cr(vt.id,qt,zr,vt.tags));continue}qt!=="LineString"&&qt!=="MultiLineString"||(Zr.length===1?(qt="LineString",Zr=Zr[0]):qt="MultiLineString"),qt!=="Point"&&qt!=="MultiPoint"||(qt=Zr.length===3?"Point":"MultiPoint"),ct.push(Cr(vt.id,qt,Zr,vt.tags))}}return ct.length?ct:null}function Ua(dt,fe,ve,Me,et){for(let Qe=0;Qe<dt.length;Qe+=3){const lt=dt[Qe+et];lt>=ve&&lt<=Me&&Ha(fe,dt[Qe],dt[Qe+1],dt[Qe+2])}}function Va(dt,fe,ve,Me,et,Qe,lt){let bt=Bo(dt);const ct=et===0?Li:Ws;let vt,Jt,qt=dt.start;for(let bn=0;bn<dt.length-3;bn+=3){const An=dt[bn],Si=dt[bn+1],xs=dt[bn+2],Zs=dt[bn+3],Ms=dt[bn+4],Os=et===0?An:Si,_i=et===0?Zs:Ms;let Mn=!1;lt&&(vt=Math.sqrt(Math.pow(An-Zs,2)+Math.pow(Si-Ms,2))),Os<ve?_i>ve&&(Jt=ct(bt,An,Si,Zs,Ms,ve),lt&&(bt.start=qt+vt*Jt)):Os>Me?_i<Me&&(Jt=ct(bt,An,Si,Zs,Ms,Me),lt&&(bt.start=qt+vt*Jt)):Ha(bt,An,Si,xs),_i<ve&&Os>=ve&&(Jt=ct(bt,An,Si,Zs,Ms,ve),Mn=!0),_i>Me&&Os<=Me&&(Jt=ct(bt,An,Si,Zs,Ms,Me),Mn=!0),!Qe&&Mn&&(lt&&(bt.end=qt+vt*Jt),fe.push(bt),bt=Bo(dt)),lt&&(qt+=vt)}let Ar=dt.length-3;const Jr=dt[Ar],Zr=dt[Ar+1],zr=et===0?Jr:Zr;zr>=ve&&zr<=Me&&Ha(bt,Jr,Zr,dt[Ar+2]),Ar=bt.length-3,Qe&&Ar>=3&&(bt[Ar]!==bt[0]||bt[Ar+1]!==bt[1])&&Ha(bt,bt[0],bt[1],bt[2]),bt.length&&fe.push(bt)}function Bo(dt){const fe=[];return fe.size=dt.size,fe.start=dt.start,fe.end=dt.end,fe}function qa(dt,fe,ve,Me,et,Qe){for(const lt of dt)Va(lt,fe,ve,Me,et,Qe,!1)}function Ha(dt,fe,ve,Me){dt.push(fe,ve,Me)}function Li(dt,fe,ve,Me,et,Qe){const lt=(Qe-fe)/(Me-fe);return Ha(dt,Qe,ve+(et-ve)*lt,1),lt}function Ws(dt,fe,ve,Me,et,Qe){const lt=(Qe-ve)/(et-ve);return Ha(dt,fe+(Me-fe)*lt,Qe,1),lt}function nl(dt,fe){const ve=[];for(let Me=0;Me<dt.length;Me++){const et=dt[Me],Qe=et.type;let lt;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")lt=_a(et.geometry,fe);else if(Qe==="MultiLineString"||Qe==="Polygon"){lt=[];for(const bt of et.geometry)lt.push(_a(bt,fe))}else if(Qe==="MultiPolygon"){lt=[];for(const bt of et.geometry){const ct=[];for(const vt of bt)ct.push(_a(vt,fe));lt.push(ct)}}ve.push(Cr(et.id,Qe,lt,et.tags))}return ve}function _a(dt,fe){const ve=[];ve.size=dt.size,dt.start!==void 0&&(ve.start=dt.start,ve.end=dt.end);for(let Me=0;Me<dt.length;Me+=3)ve.push(dt[Me]+fe,dt[Me+1],dt[Me+2]);return ve}function so(dt,fe){if(dt.transformed)return dt;const ve=1<<dt.z,Me=dt.x,et=dt.y;for(const Qe of dt.features){const lt=Qe.geometry,bt=Qe.type;if(Qe.geometry=[],bt===1)for(let ct=0;ct<lt.length;ct+=2)Qe.geometry.push(Ln(lt[ct],lt[ct+1],fe,ve,Me,et));else for(let ct=0;ct<lt.length;ct++){const vt=[];for(let Jt=0;Jt<lt[ct].length;Jt+=2)vt.push(Ln(lt[ct][Jt],lt[ct][Jt+1],fe,ve,Me,et));Qe.geometry.push(vt)}}return dt.transformed=!0,dt}function Ln(dt,fe,ve,Me,et,Qe){return[Math.round(ve*(dt*Me-et)),Math.round(ve*(fe*Me-Qe))]}function Fi(dt,fe,ve,Me,et){const Qe=fe===et.maxZoom?0:et.tolerance/((1<<fe)*et.extent),lt={features:[],numPoints:0,numSimplified:0,numFeatures:dt.length,source:null,x:ve,y:Me,z:fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const bt of dt)ps(lt,bt,Qe,et);return lt}function ps(dt,fe,ve,Me){const et=fe.geometry,Qe=fe.type,lt=[];if(dt.minX=Math.min(dt.minX,fe.minX),dt.minY=Math.min(dt.minY,fe.minY),dt.maxX=Math.max(dt.maxX,fe.maxX),dt.maxY=Math.max(dt.maxY,fe.maxY),Qe==="Point"||Qe==="MultiPoint")for(let bt=0;bt<et.length;bt+=3)lt.push(et[bt],et[bt+1]),dt.numPoints++,dt.numSimplified++;else if(Qe==="LineString")Ga(lt,et,dt,ve,!1,!1);else if(Qe==="MultiLineString"||Qe==="Polygon")for(let bt=0;bt<et.length;bt++)Ga(lt,et[bt],dt,ve,Qe==="Polygon",bt===0);else if(Qe==="MultiPolygon")for(let bt=0;bt<et.length;bt++){const ct=et[bt];for(let vt=0;vt<ct.length;vt++)Ga(lt,ct[vt],dt,ve,!0,vt===0)}if(lt.length){let bt=fe.tags||null;if(Qe==="LineString"&&Me.lineMetrics){bt={};for(const vt in fe.tags)bt[vt]=fe.tags[vt];bt.mapbox_clip_start=et.start/et.size,bt.mapbox_clip_end=et.end/et.size}const ct={geometry:lt,type:Qe==="Polygon"||Qe==="MultiPolygon"?3:Qe==="LineString"||Qe==="MultiLineString"?2:1,tags:bt};fe.id!==null&&(ct.id=fe.id),dt.features.push(ct)}}function Ga(dt,fe,ve,Me,et,Qe){const lt=Me*Me;if(Me>0&&fe.size<(et?lt:Me))return void(ve.numPoints+=fe.length/3);const bt=[];for(let ct=0;ct<fe.length;ct+=3)(Me===0||fe[ct+2]>lt)&&(ve.numSimplified++,bt.push(fe[ct],fe[ct+1])),ve.numPoints++;et&&function(ct,vt){let Jt=0;for(let qt=0,Ar=ct.length,Jr=Ar-2;qt<Ar;Jr=qt,qt+=2)Jt+=(ct[qt]-ct[Jr])*(ct[qt+1]+ct[Jr+1]);if(Jt>0===vt)for(let qt=0,Ar=ct.length;qt<Ar/2;qt+=2){const Jr=ct[qt],Zr=ct[qt+1];ct[qt]=ct[Ar-2-qt],ct[qt+1]=ct[Ar-1-qt],ct[Ar-2-qt]=Jr,ct[Ar-1-qt]=Zr}}(bt,Qe),dt.push(bt)}const at={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gn{constructor(fe,ve){const Me=(ve=this.options=function(Qe,lt){for(const bt in lt)Qe[bt]=lt[bt];return Qe}(Object.create(at),ve)).debug;if(Me&&console.time("preprocess data"),ve.maxZoom<0||ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ve.promoteId&&ve.generateId)throw new Error("promoteId and generateId cannot be used together.");let et=function(Qe,lt){const bt=[];if(Qe.type==="FeatureCollection")for(let ct=0;ct<Qe.features.length;ct++)hn(bt,Qe.features[ct],lt,ct);else hn(bt,Qe.type==="Feature"?Qe:{geometry:Qe},lt);return bt}(fe,ve);this.tiles={},this.tileCoords=[],Me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ve.indexMaxZoom,ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),et=function(Qe,lt){const bt=lt.buffer/lt.extent;let ct=Qe;const vt=mi(Qe,1,-1-bt,bt,0,-1,2,lt),Jt=mi(Qe,1,1-bt,2+bt,0,-1,2,lt);return(vt||Jt)&&(ct=mi(Qe,1,-bt,1+bt,0,-1,2,lt)||[],vt&&(ct=nl(vt,1).concat(ct)),Jt&&(ct=ct.concat(nl(Jt,-1)))),ct}(et,ve),et.length&&this.splitTile(et,0,0,0),Me&&(et.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(fe,ve,Me,et,Qe,lt,bt){const ct=[fe,ve,Me,et],vt=this.options,Jt=vt.debug;for(;ct.length;){et=ct.pop(),Me=ct.pop(),ve=ct.pop(),fe=ct.pop();const qt=1<<ve,Ar=Ks(ve,Me,et);let Jr=this.tiles[Ar];if(!Jr&&(Jt>1&&console.time("creation"),Jr=this.tiles[Ar]=Fi(fe,ve,Me,et,vt),this.tileCoords.push({z:ve,x:Me,y:et}),Jt)){Jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ve,Me,et,Jr.numFeatures,Jr.numPoints,Jr.numSimplified),console.timeEnd("creation"));const Mn=`z${ve}`;this.stats[Mn]=(this.stats[Mn]||0)+1,this.total++}if(Jr.source=fe,Qe==null){if(ve===vt.indexMaxZoom||Jr.numPoints<=vt.indexMaxPoints)continue}else{if(ve===vt.maxZoom||ve===Qe)continue;if(Qe!=null){const Mn=Qe-ve;if(Me!==lt>>Mn||et!==bt>>Mn)continue}}if(Jr.source=null,fe.length===0)continue;Jt>1&&console.time("clipping");const Zr=.5*vt.buffer/vt.extent,zr=.5-Zr,bn=.5+Zr,An=1+Zr;let Si=null,xs=null,Zs=null,Ms=null,Os=mi(fe,qt,Me-Zr,Me+bn,0,Jr.minX,Jr.maxX,vt),_i=mi(fe,qt,Me+zr,Me+An,0,Jr.minX,Jr.maxX,vt);fe=null,Os&&(Si=mi(Os,qt,et-Zr,et+bn,1,Jr.minY,Jr.maxY,vt),xs=mi(Os,qt,et+zr,et+An,1,Jr.minY,Jr.maxY,vt),Os=null),_i&&(Zs=mi(_i,qt,et-Zr,et+bn,1,Jr.minY,Jr.maxY,vt),Ms=mi(_i,qt,et+zr,et+An,1,Jr.minY,Jr.maxY,vt),_i=null),Jt>1&&console.timeEnd("clipping"),ct.push(Si||[],ve+1,2*Me,2*et),ct.push(xs||[],ve+1,2*Me,2*et+1),ct.push(Zs||[],ve+1,2*Me+1,2*et),ct.push(Ms||[],ve+1,2*Me+1,2*et+1)}}getTile(fe,ve,Me){fe=+fe,ve=+ve,Me=+Me;const et=this.options,{extent:Qe,debug:lt}=et;if(fe<0||fe>24)return null;const bt=1<<fe,ct=Ks(fe,ve=ve+bt&bt-1,Me);if(this.tiles[ct])return so(this.tiles[ct],Qe);lt>1&&console.log("drilling down to z%d-%d-%d",fe,ve,Me);let vt,Jt=fe,qt=ve,Ar=Me;for(;!vt&&Jt>0;)Jt--,qt>>=1,Ar>>=1,vt=this.tiles[Ks(Jt,qt,Ar)];return vt&&vt.source?(lt>1&&(console.log("found parent tile z%d-%d-%d",Jt,qt,Ar),console.time("drilling down")),this.splitTile(vt.source,Jt,qt,Ar,fe,ve,Me),lt>1&&console.timeEnd("drilling down"),this.tiles[ct]?so(this.tiles[ct],Qe):null):null}}function Ks(dt,fe,ve){return 32*((1<<dt)*ve+fe)+dt}function Oa(dt,fe){const ve=dt.tileID.canonical;if(!this._geoJSONIndex)return void fe(null,null);const Me=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Me)return void fe(null,null);const et=vt=>vt.tags&&"3d_elevation_id"in vt.tags&&"source"in vt.tags&&vt.tags.source==="elevation",Qe=Me.features.filter(vt=>et(vt));let lt={_geojsonTileLayer:Me.features};Qe.length>0&&(lt={_geojsonTileLayer:Me.features.filter(vt=>!et(vt)),hd_road_elevation:Qe});const bt=new de(lt),ct=function(vt){const Jt=new i.bs;for(const qt of Object.keys(vt))Jt.writeMessage(3,We,{name:qt,features:vt[qt]});return Jt.finish()}(lt).buffer;fe(null,{vectorTile:bt,rawData:ct})}class vn extends K{constructor(fe,ve,Me,et,Qe,lt,bt){super(fe,ve,Me,et,Qe,Oa,bt),lt&&(this.loadGeoJSON=lt),this._dynamicIndex=new Ae}loadData(fe,ve){const Me=fe&&fe.request,et=Me&&Me.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(fe,(Qe,lt)=>{if(Qe||!lt)return ve(Qe);if(typeof lt!="object")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));{try{if(fe.filter){const ct=i.U(fe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ct.result==="error")throw new Error(ct.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));lt.features=lt.features.filter(vt=>ct.value.evaluate({zoom:0},vt))}fe.dynamic?(lt.type==="Feature"&&(lt={type:"FeatureCollection",features:[lt]}),fe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(lt.features,this.loaded),fe.cluster&&(lt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=fe.cluster?new jt(function({superclusterOptions:ct,clusterProperties:vt}){if(!vt||!ct)return ct;const Jt={},qt={},Ar={accumulated:null,zoom:0},Jr={properties:null},Zr=Object.keys(vt);for(const zr of Zr){const[bn,An]=vt[zr],Si=i.U(An),xs=i.U(typeof bn=="string"?[bn,["accumulated"],["get",zr]]:bn);Jt[zr]=Si.value,qt[zr]=xs.value}return ct.map=zr=>{Jr.properties=zr;const bn={};for(const An of Zr)bn[An]=Jt[An].evaluate(Ar,Jr);return bn},ct.reduce=(zr,bn)=>{Jr.properties=bn;for(const An of Zr)Ar.accumulated=zr[An],zr[An]=qt[An].evaluate(Ar,Jr)},ct}(fe)).load(lt.features):fe.dynamic?this._dynamicIndex:function(ct,vt){return new gn(ct,vt)}(lt,fe.geojsonVtOptions)}catch(ct){return ve(ct)}const bt={};if(et){const ct=m(Me);ct&&(bt.resourceTiming={},bt.resourceTiming[fe.source]=JSON.parse(JSON.stringify(ct)))}ve(null,bt)}})}reloadTile(fe,ve){const Me=this.loaded;return Me&&Me[fe.uid]?fe.partial?ve(null,void 0):super.reloadTile(fe,ve):this.loadTile(fe,ve)}loadGeoJSON(fe,ve){if(fe.request)i.m(fe.request,ve);else{if(typeof fe.data!="string")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ve(null,JSON.parse(fe.data))}catch{return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(fe,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId))}catch(Me){ve(Me)}}getClusterChildren(fe,ve){try{ve(null,this._geoJSONIndex.getChildren(fe.clusterId))}catch(Me){ve(Me)}}getClusterLeaves(fe,ve){try{ve(null,this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset))}catch(Me){ve(Me)}}}class $o{constructor(fe,ve,Me){this.tileID=new i.aP(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=fe.projection,this.brightness=ve,this.worldview=Me}parse(fe,ve,Me,et){this.status="parsing";const Qe=new i.aP(Me.tileID.overscaledZ,Me.tileID.wrap,Me.tileID.canonical.z,Me.tileID.canonical.x,Me.tileID.canonical.y),lt=[],bt=ve.familiesBySource[Me.source],ct=new i.fm(Qe,Me.promoteId);ct.bucketLayerIDs=[],ct.is3DTile=!0,i.fB(fe).then(vt=>{if(!vt)return et(new Error("Could not parse tile"));const Jt=vt.json.extensionsUsed&&vt.json.extensionsUsed.includes("MAPBOX_mesh_features")||vt.json.asset.extras&&vt.json.asset.extras.MAPBOX_mesh_features,qt=vt.json.extensionsUsed&&vt.json.extensionsUsed.includes("EXT_meshopt_compression"),Ar=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Jr in bt)for(const Zr of bt[Jr]){const zr=Zr[0];ct.bucketLayerIDs.push(Zr.map(Si=>i.B(Si.id,Si.scope))),zr.recalculate(Ar,[]);const bn=i.fC(vt,1/i.d6(Me.tileID.canonical)),An=new i.fD(Zr,bn,Qe,Jt,qt,this.brightness,ct,this.worldview);Jt||(An.needsUpload=!0),lt.push(An),An.evaluate(zr)}this.status="done",et(null,{buckets:lt,featureIndex:ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(vt=>et(new Error(vt.message)))}}class jw{constructor(fe,ve,Me,et,Qe,lt,bt,ct){this.actor=fe,this.layerIndex=ve,this.availableImages=Me,this.availableModels=et,this.brightness=bt,this.loading={},this.loaded={},this.worldview=ct}loadTile(fe,ve){const Me=fe.uid,et=this.loading[Me]=new $o(fe,this.brightness,this.worldview);i.bt(fe.request,(Qe,lt)=>{const bt=!this.loading[Me];return delete this.loading[Me],bt||Qe?(et.status="done",bt||(this.loaded[Me]=et),ve(Qe)):lt&&lt.byteLength!==0?void et.parse(lt,this.layerIndex,fe,(ct,vt)=>{et.status="done",this.loaded=this.loaded||{},this.loaded[Me]=et,ct||!vt?ve(ct):ve(null,vt)}):(et.status="done",this.loaded[Me]=et,ve())})}reloadTile(fe,ve){const Me=this.loaded,et=fe.uid;if(Me&&Me[et]){const Qe=Me[et];Qe.projection=fe.projection,Qe.brightness=fe.brightness;const lt=(bt,ct)=>{Qe.reloadCallback&&(delete Qe.reloadCallback,this.loadTile(fe,ve)),ve(bt,ct)};Qe.status==="parsing"?Qe.reloadCallback=lt:Qe.status==="done"&&this.loadTile(fe,ve)}}abortTile(fe,ve){const Me=fe.uid;this.loading[Me]&&delete this.loading[Me],ve()}removeTile(fe,ve){const Me=this.loaded,et=fe.uid;Me&&Me[et]&&delete Me[et],ve()}}class Ig{constructor(fe){this.self=fe,this.actor=new i.fF(fe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cl({name:"mercator"}),this.workerSourceTypes={vector:K,geojson:vn,"raster-dem":te,"raster-array":ae,"batched-model":jw},this.workerSources={},this.self.registerWorkerSource=(ve,Me)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=Me},this.self.registerRTLTextPlugin=ve=>{if(i.fG.isParsed())throw new Error("RTL text plugin already registered.");i.fG.setState({pluginStatus:i.fH.parsed,pluginURL:i.fG.getPluginURL()}),i.fG.applyArabicShaping=ve.applyArabicShaping,i.fG.processBidirectionalText=ve.processBidirectionalText,i.fG.processStyledBidirectionalText=ve.processStyledBidirectionalText;for(const Me of this.rtlPluginParsingListeners)Me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(fe,ve,Me){delete this.layerIndexes[fe],delete this.availableImages[fe],delete this.availableModels[fe],delete this.workerSources[fe],Me()}checkIfReady(fe,ve,Me){Me()}setReferrer(fe,ve){this.referrer=ve}spriteLoaded(fe,ve){this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={});const{scope:Me,isLoaded:et}=ve;if(this.isSpriteLoaded[fe][Me]=et,this.workerSources[fe]&&this.workerSources[fe][Me])for(const Qe in this.workerSources[fe][Me]){const lt=this.workerSources[fe][Me][Qe];for(const bt in lt){const ct=lt[bt];ct instanceof K&&(ct.isSpriteLoaded=et,ct.fire(new i.z("isSpriteLoaded")))}}}setImages(fe,ve,Me){this.availableImages[fe]||(this.availableImages[fe]={});const{scope:et,images:Qe}=ve;if(this.availableImages[fe][et]=Qe,this.workerSources[fe]&&this.workerSources[fe][et]){for(const lt in this.workerSources[fe][et]){const bt=this.workerSources[fe][et][lt];for(const ct in bt)bt[ct].availableImages=Qe}Me()}else Me()}setModels(fe,{scope:ve,models:Me},et){if(this.availableModels[fe]||(this.availableModels[fe]={}),this.availableModels[fe][ve]=Me,this.workerSources[fe]&&this.workerSources[fe][ve]){for(const Qe in this.workerSources[fe][ve]){const lt=this.workerSources[fe][ve][Qe];for(const bt in lt)lt[bt].availableModels=Me}et()}else et()}setProjection(fe,ve){this.projections[fe]=i.cl(ve)}setBrightness(fe,ve,Me){this.brightness=ve,Me()}setWorldview(fe,ve,Me){this.worldview=ve,Me()}setLayers(fe,ve,Me){this.getLayerIndex(fe,ve.scope).replace(ve.layers,ve.options),Me()}updateLayers(fe,ve,Me){this.getLayerIndex(fe,ve.scope).update(ve.layers,ve.removedIds,ve.options),Me()}loadTile(fe,ve,Me){ve.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source,ve.scope).loadTile(ve,Me)}decodeRasterArray(fe,ve,Me){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).decodeRasterArray(ve,Me)}reloadTile(fe,ve,Me){ve.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source,ve.scope).reloadTile(ve,Me)}abortTile(fe,ve,Me){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).abortTile(ve,Me)}removeTile(fe,ve,Me){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).removeTile(ve,Me)}removeSource(fe,ve,Me){if(!(this.workerSources[fe]&&this.workerSources[fe][ve.scope]&&this.workerSources[fe][ve.scope][ve.type]&&this.workerSources[fe][ve.scope][ve.type][ve.source]))return;const et=this.workerSources[fe][ve.scope][ve.type][ve.source];delete this.workerSources[fe][ve.scope][ve.type][ve.source],et.removeSource!==void 0?et.removeSource(ve,Me):Me()}loadWorkerSource(fe,ve,Me){try{this.self.importScripts(ve.url),Me()}catch(et){Me(et.toString())}}syncRTLPluginState(fe,ve,Me){if(i.fG.isParsed())Me(null,!0);else if(i.fG.isParsing())this.rtlPluginParsingListeners.push(Me);else try{i.fG.setState(ve);const et=i.fG.getPluginURL();!i.fG.isLoaded()||i.fG.isParsed()||i.fG.isParsing()||et==null||(i.fG.setState({pluginStatus:i.fH.parsing,pluginURL:i.fG.getPluginURL()}),this.self.importScripts(et),i.fG.isParsed()?Me(null,!0):this.rtlPluginParsingListeners.push(Me))}catch(et){Me(et.toString())}}setDracoUrl(fe,ve){this.dracoUrl=ve}getAvailableImages(fe,ve){this.availableImages[fe]||(this.availableImages[fe]={});let Me=this.availableImages[fe][ve];return Me||(Me=[]),Me}getAvailableModels(fe,ve){this.availableModels[fe]||(this.availableModels[fe]={});let Me=this.availableModels[fe][ve];return Me||(Me={}),Me}getLayerIndex(fe,ve){this.layerIndexes[fe]||(this.layerIndexes[fe]={});let Me=this.layerIndexes[fe][ve];return Me||(Me=this.layerIndexes[fe][ve]=new w,Me.scope=ve),Me}getWorkerSource(fe,ve,Me,et){const Qe=this.workerSources;return Qe[fe]||(Qe[fe]={}),Qe[fe][et]||(Qe[fe][et]={}),Qe[fe][et][ve]||(Qe[fe][et][ve]={}),this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={}),Qe[fe][et][ve][Me]||(Qe[fe][et][ve][Me]=new this.workerSourceTypes[ve]({send:(lt,bt,ct,vt,Jt,qt)=>this.actor.send(lt,bt,ct,fe,Jt,qt),scheduler:this.actor.scheduler},this.getLayerIndex(fe,et),this.getAvailableImages(fe,et),this.getAvailableModels(fe,et),this.isSpriteLoaded[fe][et],void 0,this.brightness,this.worldview)),Qe[fe][et][ve][Me]}rasterizeImagesWorker(fe,ve,Me){const et=new Map;for(const[Qe,{image:lt,imageVariant:bt}]of ve.tasks.entries()){const ct=this.imageRasterizer.rasterize(bt,lt,ve.scope,fe);et.set(Qe,ct)}Me(void 0,et)}removeRasterizedImages(fe,ve,Me){this.imageRasterizer.removeImagesFromCacheByIds(ve.imageIds,ve.scope,fe),Me()}enforceCacheSizeLimit(fe,ve){i.fI(ve)}getWorkerPerformanceMetrics(fe,ve,Me){Me(void 0,void 0)}}return i.fE(self)&&(self.worker=new Ig(self)),Ig}),o(["./shared"],function(i){var m="3.16.0";const y={create:"create",load:"load",fullLoad:"fullLoad"},S={mark(v){performance.mark(v)},measure(v,l,f){performance.measure(v,l,f)}};function w(v){const l=v.name.split("?")[0];return i.a(l)&&l.includes("mapbox-gl.js")?"javascript":i.a(l)&&l.includes("mapbox-gl.css")?"css":i.b(l)?"fontRange":i.c(l)?"sprite":i.i(l)?"style":i.d(l)?"tilejson":"other"}var T,A={},O=function(){if(T)return A;function v(_){return!l(_)}function l(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var j,k,L=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(L);try{k=new Worker(z),j=!0}catch{j=!1}return k&&k.terminate(),URL.revokeObjectURL(z),j}()?function(){var j=document.createElement("canvas");j.width=j.height=1;var k=j.getContext("2d");if(!k)return!1;var L=k.getImageData(0,0,1,1);return L&&L.width===j.width}()?(f[E=_&&_.failIfMajorPerformanceCaveat]===void 0&&(f[E]=function(j){var k,L=function(z){var G=document.createElement("canvas"),Z=Object.create(v.webGLContextAttributes);return Z.failIfMajorPerformanceCaveat=z,G.getContext("webgl2",Z)}(j);if(!L)return!1;try{k=L.createShader(L.VERTEX_SHADER)}catch{return!1}return!(!k||L.isContextLost())&&(L.shaderSource(k,"void main() {}"),L.compileShader(k),L.getShaderParameter(k,L.COMPILE_STATUS)===!0)}(E)),f[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var E}T=1,A.supported=v,A.notSupportedReason=l;var f={};return v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},A}();function P(v,l,f){const _=document.createElement(v);return l!=null&&(_.className=l),f&&f.appendChild(_),_}function N(v,l,f){const _=document.createElementNS("http://www.w3.org/2000/svg",v);for(const E of Object.keys(l))_.setAttributeNS(null,E,String(l[E]));return f&&f.appendChild(_),_}const R=typeof document<"u"?document.documentElement&&document.documentElement.style:null,M=R&&R.userSelect!==void 0?"userSelect":"WebkitUserSelect";let F;function B(){R&&M&&(F=R[M],R[M]="none")}function $(){R&&M&&(R[M]=F)}function W(v){v.preventDefault(),v.stopPropagation(),window.removeEventListener("click",W,!0)}function K(){window.addEventListener("click",W,!0),window.setTimeout(()=>{window.removeEventListener("click",W,!0)},0)}function te(v,l){const f=v.getBoundingClientRect();return re(v,f,l)}function ne(v,l){const f=v.getBoundingClientRect(),_=[];for(let E=0;E<l.length;E++)_.push(re(v,f,l[E]));return _}function ae(v){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&v.button===2&&v.ctrlKey?0:v.button}function re(v,l,f){const _=v.offsetWidth===l.width?1:v.offsetWidth/l.width;return new i.P((f.clientX-l.left)*_,(f.clientY-l.top)*_)}const ee="01",ie="NO_ACCESS_TOKEN";class de{constructor(l,f,_){this._transformRequestFn=l,this._customAccessToken=f,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const l=function(){let f="";for(let _=0;_<10;_++)f+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ee,f].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=l.token,this._skuTokenExpiresAt=l.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}normalizeStyleURL(l,f){if(!i.h(l))return l;const _=Se(l);return _.params.push(`sdk=js-${m}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||f)}normalizeGlyphsURL(l,f){if(!i.h(l))return l;const _=Se(l);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||f)}normalizeModelURL(l,f){if(!i.h(l))return l;const _=Se(l);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||f)}normalizeSourceURL(l,f,_,E){if(!i.h(l))return l;const j=Se(l);return j.path=`/v4/${j.authority}.json`,j.params.push("secure"),_&&j.params.push(`language=${_}`),E&&j.params.push(`worldview=${E}`),this._makeAPIURL(j,this._customAccessToken||f)}normalizeIconsetURL(l,f){const _=Se(l);return i.h(l)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||f)):Ae(_)}normalizeSpriteURL(l,f,_,E){const j=Se(l);return i.h(l)?(j.path=`/styles/v1${j.path}/sprite${f}${_}`,this._makeAPIURL(j,this._customAccessToken||E)):(j.path+=`${f}${_}`,Ae(j))}normalizeTileURL(l,f,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),l&&!i.h(l))return l;const E=Se(l);E.path=E.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${f||_&&E.authority!=="raster"&&_===512?"@2x":""}${i.k.supported?".webp":"$1"}`),E.authority==="raster"?E.path=`/${i.e.RASTER_URL_PREFIX}${E.path}`:E.authority==="rasterarrays"?E.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${E.path}`:E.authority==="3dtiles"?E.path=`/${i.e.TILES3D_URL_PREFIX}${E.path}`:(E.path=E.path.replace(/^.+\/v4\//,"/"),E.path=`/${i.e.TILE_URL_VERSION}${E.path}`);const j=this._customAccessToken||function(k){for(const L of k){const z=L.match(/^access_token=(.*)$/);if(z)return z[1]}return null}(E.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&j&&this._skuToken&&E.params.push(`sku=${this._skuToken}`),this._makeAPIURL(E,j)}canonicalizeTileURL(l,f){const _=Se(l);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return l;let E="mapbox://";_.path.match(/^\/raster\/v1\//)?E+=`raster/${_.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?E+=`rasterarrays/${_.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:E+=`tiles/${_.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let j=_.params;return f&&(j=j.filter(k=>!k.match(/^access_token=/))),j.length&&(E+=`?${j.join("&")}`),E}canonicalizeTileset(l,f){const _=!!f&&i.h(f),E=[];for(const j of l.tiles||[])i.j(j)?E.push(this.canonicalizeTileURL(j,_)):E.push(j);return E}_makeAPIURL(l,f){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",E=Se(i.e.API_URL);if(l.protocol=E.protocol,l.authority=E.authority,l.protocol==="http"){const j=l.params.indexOf("secure");j>=0&&l.params.splice(j,1)}if(E.path!=="/"&&(l.path=`${E.path}${l.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Ae(l);if(f=f||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!f)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if(f[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return l.params=l.params.filter(j=>j.indexOf("access_token")===-1),l.params.push(`access_token=${f||""}`),Ae(l)}}const be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Se(v){const l=v.match(be);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function Ae(v){const l=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${l}`}const xe="mapbox.eventData";function me(v){if(!v)return null;const l=v.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(i.l(l[1]))}catch{return null}}class Ce{constructor(l){this.type=l,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(l){const f=me(i.e.ACCESS_TOKEN);let _="";return _=f&&f.u?i.f(f.u):i.e.ACCESS_TOKEN||"",l?`${xe}.${l}:${_}`:`${xe}:${_}`}fetchEventData(){const l=i.s("localStorage"),f=this.getStorageKey(),_=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp");if(l)try{const j=localStorage.getItem(f);j&&(this.eventData=JSON.parse(j));const k=localStorage.getItem(_);k&&(this.anonId=k);const L=localStorage.getItem(E);L&&(this.anonIdTimestamp=Number(L));const z=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<z)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const l=i.s("localStorage"),f=this.getStorageKey(),_=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp"),j=this.anonId,k=this.anonIdTimestamp;if(l&&j)try{localStorage.setItem(_,j),Object.keys(this.eventData).length>=1&&localStorage.setItem(f,JSON.stringify(this.eventData)),k&&localStorage.setItem(E,k.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(l){}postEvent(l,f,_,E){if(!i.e.EVENTS_URL)return;const j=Se(i.e.EVENTS_URL);j.params.push(`access_token=${E||i.e.ACCESS_TOKEN||""}`);const k={event:this.type,created:new Date(l).toISOString()},L=f?Object.assign(k,f):k,z={url:Ae(j),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=i.p(z,G=>{this.pendingRequest=null,_(G),this.saveEventData(),this.processRequests(E)})}queueRequest(l,f){this.queue.push(l),this.processRequests(f)}}const ge=new class extends Ce{constructor(v){super("appUserTurnstile"),this._customAccessToken=v}postTurnstileEvent(v,l){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(v)&&v.some(f=>i.h(f)||i.j(f))&&this.queueRequest(Date.now(),l)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const l=me(i.e.ACCESS_TOKEN),f=l?l.u:i.e.ACCESS_TOKEN;let _=f!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),_=!0);const E=this.queue.shift();if(this.eventData.lastSuccess){const j=new Date(this.eventData.lastSuccess),k=new Date(E),L=(E-this.eventData.lastSuccess)/864e5;_=_||L>=1||L<-1||j.getDate()!==k.getDate()}else _=!0;_?this.postEvent(E,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:ee,"enabled.telemetry":!1,userId:this.anonId},j=>{j||(this.eventData.lastSuccess=E,this.eventData.tokenU=f)},v):this.processRequests()}},pe=ge.postTurnstileEvent.bind(ge),Oe=new class extends Ce{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(v,l,f,_){this.skuToken=l,this.errorCb=_,i.e.EVENTS_URL&&(f||i.e.ACCESS_TOKEN?this.queueRequest({id:v,timestamp:Date.now()},f):this.errorCb(new Error(ie)))}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:f}=this.queue.shift();l&&this.success[l]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:ee,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):l&&(this.success[l]=!0)},v))}remove(){this.errorCb=null}},Xe=Oe.postMapLoadEvent.bind(Oe),We=new class extends Ce{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(v){let l=this.mapInstanceIdMap.get(v);return l||(l=i.u(),this.mapInstanceIdMap.set(v,l)),l}getEventId(v){const l=this.eventIdPerMapInstanceMap.get(v)||0;return this.eventIdPerMapInstanceMap.set(v,l+1),l}postStyleLoadEvent(v,l){const{map:f,style:_,importedStyles:E}=l;if(!i.e.EVENTS_URL||!v&&!i.e.ACCESS_TOKEN)return;const j=this.getMapInstanceId(f),k={mapInstanceId:j,eventId:this.getEventId(j),style:_};E.length&&(k.importedStyles=E),this.queueRequest({timestamp:Date.now(),payload:k},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,payload:f}=this.queue.shift();this.postEvent(l,f,()=>{},v)}},$e=We.postStyleLoadEvent.bind(We),Ke=new class extends Ce{constructor(v){super("metrics"),v&&(this.data=v)}postMetricsEvent(v){if(!i.e.EVENTS_URL||!v&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const l=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:l},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,payload:f}=this.queue.shift();this.postEvent(l,f,()=>{},v)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Le=Ke.postMetricsEvent.bind(Ke),ke=new class extends Ce{constructor(){super("gljs.performance")}postPerformanceEvent(v,l){i.e.EVENTS_URL&&(v||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:l},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,performanceData:f}=this.queue.shift(),_=function(E){const j=performance.getEntriesByType("resource"),k=performance.getEntriesByType("mark"),L=function(se){const le={};if(se){for(const ue in se)if(ue!=="other")for(const _e of se[ue]){const ye=`${ue}ResolveRangeMin`,Ee=`${ue}ResolveRangeMax`,Ne=`${ue}RequestCount`,je=`${ue}RequestCachedCount`;le[ye]=Math.min(le[ye]||1/0,_e.startTime),le[Ee]=Math.max(le[Ee]||-1/0,_e.responseEnd);const qe=Ie=>{le[Ie]===void 0&&(le[Ie]=0),++le[Ie]};_e.transferSize!==void 0&&_e.transferSize===0&&qe(je),qe(Ne)}}return le}(function(se,le){const ue={};if(se)for(const _e of se){const ye=le(_e);ue[ye]===void 0&&(ue[ye]=[]),ue[ye].push(_e)}return ue}(j,w)),z=window.devicePixelRatio,G=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Z=G?G.effectiveType:void 0,Q={counters:[],metadata:[],attributes:[]},X=(se,le,ue)=>{ue!=null&&se.push({name:le,value:ue.toString()})};for(const se in L)X(Q.counters,se,L[se]);if(E.interactionRange[0]!==1/0&&E.interactionRange[1]!==-1/0&&(X(Q.counters,"interactionRangeMin",E.interactionRange[0]),X(Q.counters,"interactionRangeMax",E.interactionRange[1])),k)for(const se of Object.values(y)){const le=k.find(ue=>ue.name===se);le&&X(Q.counters,se,le.startTime)}return X(Q.counters,"visibilityHidden",E.visibilityHidden),X(Q.attributes,"style",function(se){if(se)for(const le of se){const ue=le.name.split("?")[0];if(i.i(ue)){const _e=ue.split("/").slice(-2);if(_e.length===2)return`mapbox://styles/${_e[0]}/${_e[1]}`}}}(j)),X(Q.attributes,"terrainEnabled",E.terrainEnabled?"true":"false"),X(Q.attributes,"fogEnabled",E.fogEnabled?"true":"false"),X(Q.attributes,"projection",E.projection),X(Q.attributes,"zoom",E.zoom),X(Q.metadata,"devicePixelRatio",z),X(Q.metadata,"connectionEffectiveType",Z),X(Q.metadata,"navigatorUserAgent",navigator.userAgent),X(Q.metadata,"screenWidth",window.screen.width),X(Q.metadata,"screenHeight",window.screen.height),X(Q.metadata,"windowWidth",window.innerWidth),X(Q.metadata,"windowHeight",window.innerHeight),X(Q.metadata,"mapWidth",E.width/z),X(Q.metadata,"mapHeight",E.height/z),X(Q.metadata,"webglRenderer",E.renderer),X(Q.metadata,"webglVendor",E.vendor),X(Q.metadata,"sdkVersion",m),X(Q.metadata,"sdkIdentifier","mapbox-gl-js"),Q}(f);for(const E of _.metadata);for(const E of _.counters);for(const E of _.attributes);this.postEvent(l,_,()=>{},v)}},st=ke.postPerformanceEvent.bind(ke),_t=new class extends Ce{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(v,l,f,_){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const E=Se(i.e.API_URL+i.e.SESSION_PATH);E.params.push(`sku=${l||""}`),E.params.push(`access_token=${_||i.e.ACCESS_TOKEN||""}`);const j={url:Ae(E),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(j,k=>{this.pendingRequest=null,f(k),this.saveEventData(),this.processRequests(_)})}getSessionAPI(v,l,f,_){this.skuToken=l,this.errorCb=_,i.e.SESSION_PATH&&i.e.API_URL&&(f||i.e.ACCESS_TOKEN?this.queueRequest({id:v,timestamp:Date.now()},f):this.errorCb(new Error(ie)))}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:f}=this.queue.shift();l&&this.success[l]||this.getSession(f,this.skuToken,_=>{_?this.errorCb(_):l&&(this.success[l]=!0)},v)}remove(){this.errorCb=null}},Be=_t.getSessionAPI.bind(_t),Dt=new Set;function It(v,l){l?Dt.add(v):Dt.delete(v)}class ir{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,f){this._updatedSourceCaches[l]=f,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const f=l.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(l.id),this.setDirty()}removeLayer(l){const f=l.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][l.id]=l,this._updatedLayers[f].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const f in this._updatedLayers)l[f]=l[f]||{},l[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)l[f]=l[f]||{},l[f].removedIds=Object.keys(this._removedLayers[f]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(l){return this._updatedImages[l]?Array.from(this._updatedImages[l].values()):[]}updateImage(l,f){this._updatedImages[f]=this._updatedImages[f]||new Set,this._updatedImages[f].add(i.I.toString(l)),this.setDirty()}resetUpdatedImages(l){this._updatedImages[l]&&this._updatedImages[l].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Dr(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}class Rr extends i.E{constructor(l){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=l,l!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(l){this.loaded.set(l,!1),this.imageProviders.set(l,new Map),this.images.set(l,new Map),this.updatedImages.set(l,new Set),this.callbackDispatchedThisFrame.set(l,new Set),this.patterns.set(l,new Map),this.atlasImage.set(l,new i.q({width:1,height:1}))}removeScope(l){this.loaded.delete(l),this.imageProviders.delete(l),this.images.delete(l),this.updatedImages.delete(l),this.callbackDispatchedThisFrame.delete(l),this.patterns.delete(l),this.atlasImage.delete(l);const f=this.atlasTexture.get(l);f&&(f.destroy(),this.atlasTexture.delete(l))}addImageProvider(l,f){this.imageProviders.has(f)||this.imageProviders.set(f,new Map),this.imageProviders.get(f).set(l.id,l)}removeImageProvider(l,f){this.imageProviders.has(f)&&this.imageProviders.get(f).delete(l)}getPendingImageProviders(){const l=[];for(const f of this.imageProviders.values())for(const _ of f.values())_.hasPendingRequests()&&l.push(_);return l}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const l of this.loaded.keys())if(!this.loaded.get(l))return!1;return!0}setLoaded(l,f){if(this.loaded.get(f)!==l&&(this.loaded.set(f,l),l)){for(const{ids:_,callback:E}of this.requestors)this._notify(_,f,E);this.requestors=[]}}hasImage(l,f){return!!this.getImage(l,f)}getImage(l,f){return this.images.get(f).get(l.toString())}addImage(l,f,_){this._validate(l,_)&&this.images.get(f).set(l.toString(),_)}_validate(l,f){let _=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new i.y(new Error(`Image "${l.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new i.y(new Error(`Image "${l.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new i.y(new Error(`Image "${l.name}" has invalid "content" value`))),_=!1),_}_validateStretch(l,f){if(!l)return!0;let _=0;for(const E of l){if(E[0]<_||E[1]<E[0]||f<E[1])return!1;_=E[1]}return!0}_validateContent(l,f){return l?l.length!==4||!f.usvg&&(l[0]<0||f.data.width<l[0]||l[1]<0||f.data.height<l[1]||l[2]<0||f.data.width<l[2]||l[3]<0||f.data.height<l[3])?!1:!(l[2]<l[0]||l[3]<l[1]):!0}updateImage(l,f,_){const E=this.images.get(f).get(l.toString());_.version=E.version+1,this.images.get(f).set(l.toString(),_),this.updatedImages.get(f).add(l),this.removeFromImageRasterizerCache(l,f)}clearUpdatedImages(l){this.updatedImages.get(l).clear()}removeFromImageRasterizerCache(l,f){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[l],scope:f}):this.imageRasterizer.removeImagesFromCacheByIds([l],f))}removeImage(l,f){const _=this.images.get(f),E=_.get(l.toString());_.delete(l.toString()),this.patterns.get(f).delete(l.toString()),this.removeFromImageRasterizerCache(l,f),E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(l){return Array.from(this.images.get(l).keys()).map(f=>i.I.from(f))}getImages(l,f,_){const E=[],j=[],k=this.imageProviders.get(f);for(const Z of l){if(!Z.iconsetId){E.push(Z);continue}const Q=k.get(Z.iconsetId);Q&&(this.getImage(Z,f)?j.push(Z):Q.addPendingRequest(Z))}if(E.length===0)return void this._notify(j,f,_);let L=!0;const z=!!this.loaded.get(f),G=this.images.get(f);if(!z)for(const Z of E)G.has(Z.toString())||(L=!1);z||L?this._notify(E,f,_):this.requestors.push({ids:E,scope:f,callback:_})}rasterizeImages(l,f){const _=new Map,{tasks:E,scope:j}=l;for(const[k,L]of E.entries()){const z=this.getImage(L.id,j);z&&_.set(k,{image:z,imageVariant:L})}this._rasterizeImages(j,_,f)}_rasterizeImages(l,f,_){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:f,scope:l},_);else{const E=new Map;for(const[j,{image:k,imageVariant:L}]of f.entries())E.set(j,this.imageRasterizer.rasterize(L,k,l,0));_(void 0,E)}}getUpdatedImages(l){return this.updatedImages.get(l)||new Set}_notify(l,f,_){const E=this.images.get(f),j=new Map;for(const k of l){if(!E.get(k.toString())){if(k.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:k.name}))}const L=E.get(k.toString());if(!L){i.w(`Image "${k.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const z={data:L.usvg?null:L.data.clone(),pixelRatio:L.pixelRatio,sdf:L.sdf,usvg:L.usvg,version:L.version,stretchX:L.stretchX,stretchY:L.stretchY,content:L.content,hasRenderCallback:!!(L.userImage&&L.userImage.render)};L.usvg&&Object.assign(z,{width:L.icon.usvg_tree.width,height:L.icon.usvg_tree.height}),j.set(i.I.toString(k),z)}_(null,j)}getPixelSize(l){const{width:f,height:_}=this.atlasImage.get(l);return{width:f,height:_}}getPattern(l,f,_){const E=l.toString(),j=this.patterns.get(f),k=j.get(E),L=this.getImage(l,f);if(!L)return null;if(k){if(k.position.version===L.version)return k.position;k.position.version=L.version}else{if(L.usvg&&!L.data){const z=this.getPatternInFlightId(E,f);if(this.patternsInFlight.has(z))return null;this.patternsInFlight.add(z);const G=new i.A(l).scaleSelf(i.o.devicePixelRatio),Z=new Map([[G.toString(),{image:L,imageVariant:G}]]);return this._rasterizeImages(f,Z,(Q,X)=>this.storePatternImage(G,f,L,_,X)),null}this.storePattern(l,f,L)}return this._updatePatternAtlas(f,_),j.get(E).position}getPatternInFlightId(l,f){return i.B(l,f)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(l,f,_,E,j){const k=l.toString(),L=j?j.get(k):void 0;L&&(_.data=L,this.storePattern(l.id,f,_),this._updatePatternAtlas(f,E),this.patternsInFlight.delete(this.getPatternInFlightId(l.id.toString(),f)))}storePattern(l,f,_){const E={w:_.data.width+2*i.C,h:_.data.height+2*i.C,x:0,y:0},j=new i.F(E,_,i.C);this.patterns.get(f).set(l.toString(),{bin:E,position:j})}destroyAtlasTextures(){for(const l of this.atlasTexture.values())l&&l.destroy();this.atlasTexture.clear()}bind(l,f){const _=l.gl;let E=this.atlasTexture.get(f);E?this.dirty&&(E.update(this.atlasImage.get(f)),this.dirty=!1):(E=new i.T(l,this.atlasImage.get(f),_.RGBA8),this.atlasTexture.set(f,E)),E.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(l,f){const _=this.patterns.get(l),E=Array.from(_.values()).map(({bin:G})=>G),{w:j,h:k}=i.G(E),L=this.atlasImage.get(l);L.resize({width:j||1,height:k||1});const z=this.images.get(l);for(const[G,{bin:Z,position:Q}]of _.entries()){let X=Q.padding;const se=Z.x+X,le=Z.y+X,ue=z.get(G).data,_e=ue.width,ye=ue.height;X=X>1?X-1:X,i.q.copy(ue,L,{x:0,y:0},{x:se,y:le},{width:_e,height:ye},f),i.q.copy(ue,L,{x:0,y:ye-X},{x:se,y:le-X},{width:_e,height:X},f),i.q.copy(ue,L,{x:0,y:0},{x:se,y:le+ye},{width:_e,height:X},f),i.q.copy(ue,L,{x:_e-X,y:0},{x:se-X,y:le},{width:X,height:ye},f),i.q.copy(ue,L,{x:0,y:0},{x:se+_e,y:le},{width:X,height:ye},f),i.q.copy(ue,L,{x:_e-X,y:ye-X},{x:se-X,y:le-X},{width:X,height:X},f),i.q.copy(ue,L,{x:0,y:ye-X},{x:se+_e,y:le-X},{width:X,height:X},f),i.q.copy(ue,L,{x:0,y:0},{x:se+_e,y:le+ye},{width:X,height:X},f),i.q.copy(ue,L,{x:_e-X,y:0},{x:se-X,y:le+ye},{width:X,height:X},f)}this.dirty=!0}beginFrame(){for(const l of this.images.keys())this.callbackDispatchedThisFrame.set(l,new Set)}dispatchRenderCallbacks(l,f){const _=this.images.get(f);for(const E of l){if(this.callbackDispatchedThisFrame.get(f).has(E.toString()))continue;this.callbackDispatchedThisFrame.get(f).add(E.toString());const j=_.get(E.toString());Dr(j)&&this.updateImage(E,f,j)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function jt(v){const l=v.value,f=v.valueSpec,_=v.style,E=v.styleSpec,j=v.key,k=v.arrayElementValidator||Li;if(!Array.isArray(l))return[new i.V(j,l,`array expected, ${i.K(l)} found`)];if(f.length&&l.length!==f.length)return[new i.V(j,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new i.V(j,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let L={type:f.value,values:f.values,minimum:f.minimum,maximum:f.maximum,function:void 0};E.$version<7&&(L.function=f.function),i.H(f.value)&&(L=f.value);let z=[];for(let G=0;G<l.length;G++)z=z.concat(k({array:l,arrayIndex:G,value:l[G],valueSpec:L,style:_,styleSpec:E,key:`${j}[${G}]`},!0));return z}function zt(v){const l=v.key,f=v.value,_=v.valueSpec;if(!i.L(f))return[new i.V(l,f,`number expected, ${i.K(f)} found`)];if(f!=f)return[new i.V(l,f,"number expected, NaN found")];if("minimum"in _){let E=_.minimum;if(Array.isArray(_.minimum)&&(E=_.minimum[v.arrayIndex]),f<E)return[new i.V(l,f,`${f} is less than the minimum value ${E}`)]}if("maximum"in _){let E=_.maximum;if(Array.isArray(_.maximum)&&(E=_.maximum[v.arrayIndex]),f>E)return[new i.V(l,f,`${f} is greater than the maximum value ${E}`)]}return[]}function Je(v){const l=v.key,f=v.value;if(!i.H(f))return[new i.V(l,f,`object expected, ${i.K(f)} found`)];const _=v.valueSpec,E=i.J(f.type);let j,k,L,z={};const G=E!=="categorical"&&f.property===void 0,Z=!G,Q=function(ue){const _e=ue.stops;return Array.isArray(_e)&&Array.isArray(_e[0])&&i.H(_e[0][0])}(f),X=Ws({key:v.key,value:v.value,valueSpec:v.styleSpec.function,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{stops:function(ue){if(E==="identity")return[new i.V(ue.key,ue.value,'identity function may not have a "stops" property')];let _e=[];const ye=ue.value;return _e=_e.concat(jt({key:ue.key,value:ye,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:se})),Array.isArray(ye)&&ye.length===0&&_e.push(new i.V(ue.key,ye,"array must have at least one stop")),_e},default:function(ue){return Li({key:ue.key,value:ue.value,valueSpec:_,style:ue.style,styleSpec:ue.styleSpec})}}});return E==="identity"&&G&&X.push(new i.V(v.key,v.value,'missing required property "property"')),E==="identity"||f.stops||X.push(new i.V(v.key,v.value,'missing required property "stops"')),E==="exponential"&&_.expression&&!i.M(_)&&X.push(new i.V(v.key,v.value,"exponential functions not supported")),v.styleSpec.$version>=8&&(Z&&!i.N(_)?X.push(new i.V(v.key,v.value,"property functions not supported")):G&&!i.O(_)&&X.push(new i.V(v.key,v.value,"zoom functions not supported"))),E!=="categorical"&&!Q||f.property!==void 0||X.push(new i.V(v.key,v.value,'"property" property is required')),X;function se(ue){let _e=[];const ye=ue.value,Ee=ue.key;if(!Array.isArray(ye))return[new i.V(Ee,ye,`array expected, ${i.K(ye)} found`)];if(ye.length!==2)return[new i.V(Ee,ye,`array length 2 expected, length ${ye.length} found`)];if(Q){if(!i.H(ye[0]))return[new i.V(Ee,ye,`object expected, ${i.K(ye[0])} found`)];const Ne=ye[0];if(Ne.zoom===void 0)return[new i.V(Ee,ye,"object stop key must have zoom")];if(Ne.value===void 0)return[new i.V(Ee,ye,"object stop key must have value")];const je=i.J(Ne.zoom);if(typeof je!="number")return[new i.V(Ee,Ne.zoom,"stop zoom values must be numbers")];if(L&&L>je)return[new i.V(Ee,Ne.zoom,"stop zoom values must appear in ascending order")];je!==L&&(L=je,k=void 0,z={}),_e=_e.concat(Ws({key:`${Ee}[0]`,value:ye[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:zt,value:le}}))}else _e=_e.concat(le({key:`${Ee}[0]`,value:ye[0],style:ue.style,styleSpec:ue.styleSpec},ye));return i.Q(i.S(ye[1]))?_e.concat([new i.V(`${Ee}[1]`,ye[1],"expressions are not allowed in function stops.")]):_e.concat(Li({key:`${Ee}[1]`,value:ye[1],valueSpec:_,style:ue.style,styleSpec:ue.styleSpec}))}function le(ue,_e){const ye=i.K(ue.value),Ee=i.J(ue.value),Ne=ue.value!==null?ue.value:_e;if(j){if(ye!==j)return[new i.V(ue.key,Ne,`${ye} stop domain type must match previous stop domain type ${j}`)]}else j=ye;if(ye!=="number"&&ye!=="string"&&ye!=="boolean"&&typeof Ee!="number"&&typeof Ee!="string"&&typeof Ee!="boolean")return[new i.V(ue.key,Ne,"stop domain value must be a number, string, or boolean")];if(ye!=="number"&&E!=="categorical"){let je=`number expected, ${ye} found`;return i.N(_)&&E===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ue.key,Ne,je)]}return E!=="categorical"||ye!=="number"||typeof Ee=="number"&&isFinite(Ee)&&Math.floor(Ee)===Ee?E!=="categorical"&&ye==="number"&&typeof Ee=="number"&&typeof k=="number"&&k!==void 0&&Ee<k?[new i.V(ue.key,Ne,"stop domain values must appear in ascending order")]:(k=Ee,E==="categorical"&&Ee in z?[new i.V(ue.key,Ne,"stop domain values must be unique")]:(z[Ee]=!0,[])):[new i.V(ue.key,Ne,`integer expected, found ${String(Ee)}`)]}}function pt(v){const l=(v.expressionContext==="property"?i.W:i.U)(i.S(v.value),v.valueSpec);if(l.result==="error")return l.value.map(_=>new i.V(`${v.key}${_.key}`,v.value,_.message));const f=l.value.expression||l.value._styleExpression.expression;if(v.expressionContext==="property"&&v.propertyKey==="text-font"&&!f.outputDefined())return[new i.V(v.key,v.value,`Invalid data expression for "${v.propertyKey}". Output values must be contained as literals within the expression.`)];if(v.expressionContext==="property"&&v.propertyType==="layout"&&!i.Z(f))return[new i.V(v.key,v.value,'"feature-state" data expressions are not supported with layout properties.')];if(v.expressionContext==="filter")return rt(f,v);if(v.expressionContext==="appearance")return Kt(f,v);if(v.expressionContext&&v.expressionContext.indexOf("cluster")===0){if(!i.X(f,["zoom","feature-state"]))return[new i.V(v.key,v.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(v.expressionContext==="cluster-initial"&&!i.Y(f))return[new i.V(v.key,v.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rt(v,l){const f=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const E of l.valueSpec.expression.parameters)f.delete(E);if(f.size===0)return[];const _=[];return v instanceof i._&&f.has(v.name)?[new i.V(l.key,l.value,`["${v.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(v.eachChild(E=>{_.push(...rt(E,l))}),_)}function Kt(v,l){const f=new Set;if(l.valueSpec&&l.valueSpec.expression)for(const E of l.valueSpec.expression.parameters)f.add(E);if(f.size===0)return[];const _=[];return v instanceof i._&&!f.has(v.name)?[new i.V(l.key,l.value,`["${v.name}"] is not an allowed parameter`)]:(v.eachChild(E=>{_.push(...Kt(E,l))}),_)}function Ut(v){const l=v.key,f=v.value,_=v.valueSpec,E=[];return Array.isArray(_.values)?_.values.indexOf(i.J(f))===-1&&E.push(new i.V(l,f,`expected one of [${_.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(_.values).indexOf(i.J(f))===-1&&E.push(new i.V(l,f,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(f)} found`)),E}function Ht(v){return i.a2(i.S(v.value))?pt(Object.assign({},v,{expressionContext:"filter",valueSpec:v.styleSpec[`filter_${v.layerType||"fill"}`]})):Cr(v)}function Cr(v){const l=v.value,f=v.key;if(!Array.isArray(l))return[new i.V(f,l,`array expected, ${i.K(l)} found`)];if(l.length<1)return[new i.V(f,l,"filter array must have at least 1 element")];const _=v.styleSpec;let E=Ut({key:`${f}[0]`,value:l[0],valueSpec:_.filter_operator});switch(i.J(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&i.J(l[1])==="$type"&&E.push(new i.V(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&E.push(new i.V(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(i.a0(l[1])||E.push(new i.V(`${f}[1]`,l[1],`string expected, ${i.K(l[1])} found`)));for(let j=2;j<l.length;j++)i.J(l[1])==="$type"?E=E.concat(Ut({key:`${f}[${j}]`,value:l[j],valueSpec:_.geometry_type})):i.a0(l[j])||i.L(l[j])||i.$(l[j])||E.push(new i.V(`${f}[${j}]`,l[j],`string, number, or boolean expected, ${i.K(l[j])} found.`));break;case"any":case"all":case"none":for(let j=1;j<l.length;j++)E=E.concat(Cr({key:`${f}[${j}]`,value:l[j],style:v.style,styleSpec:v.styleSpec}));break;case"has":case"!has":l.length!==2?E.push(new i.V(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):i.a0(l[1])||E.push(new i.V(`${f}[1]`,l[1],`string expected, ${i.K(l[1])} found`))}return E}function un(v,l){const f=v.key,_=v.style,E=v.layer,j=v.styleSpec,k=v.value,L=v.objectKey,z=j[`${l}_${v.layerType}`];if(!z)return[];const G=L.match(/^(.*)-use-theme$/);if(G&&z[G[1]])return i.Q(i.S(k))?[].concat(Li({key:f,value:k,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:j,expressionContext:"property",propertyType:l,propertyKey:L})):Li({key:f,value:k,valueSpec:{type:"string"},style:_,styleSpec:j});const Z=L.match(/^(.*)-transition$/);if(l==="paint"&&Z&&z[Z[1]]&&z[Z[1]].transition)return Li({key:f,value:k,valueSpec:j.transition,style:_,styleSpec:j});const Q=v.valueSpec||z[L];if(!Q)return[new i.a3(f,k,`unknown property "${L}"`)];let X;if(i.a0(k)&&i.N(Q)&&!Q.tokens&&(X=/^{([^}]+)}$/.exec(k))){const le=`\`{ "type": "identity", "property": ${X?JSON.stringify(X[1]):'"_"'} }\``;return[new i.V(f,k,`"${L}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const se=[];if(v.layerType==="symbol")L!=="text-field"||!_||_.glyphs||_.imports||se.push(new i.V(f,k,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&i.a4(i.S(k))&&i.J(k.type)==="identity"&&se.push(new i.V(f,k,'"text-font" does not support identity functions'));else if(v.layerType==="model"&&l==="paint"&&E&&E.layout&&E.layout.hasOwnProperty("model-id")&&i.N(Q)&&(i.a5(Q)||i.O(Q))){const le=i.W(i.S(k),Q).value,ue="expression"in le&&le.expression||"_styleExpression"in le&&le._styleExpression&&le._styleExpression.expression;ue&&!i.X(ue,["measure-light"])&&(L==="model-emissive-strength"&&i.Y(ue)&&i.Z(ue)||se.push(new i.V(f,k,`${L} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return se.concat(Li({key:v.key,value:k,valueSpec:Q,style:_,styleSpec:j,expressionContext:"property",propertyType:l,propertyKey:L}))}function hn(v){return un(v,"paint")}function Kn(v){return un(v,"layout")}function Gn(v){let l=[];const f=v.value,_=v.key,E=v.style,j=v.styleSpec;if(!i.H(f))return[new i.V(_,f,"object expected")];f.type||f.ref||l.push(new i.V(_,f,'either "type" or "ref" is required'));let k=i.J(f.type);const L=i.J(f.ref);if(f.id){const z=i.J(f.id);for(let G=0;G<v.arrayIndex;G++){const Z=E.layers[G];i.J(Z.id)===z&&l.push(new i.V(_,f.id,`duplicate layer id "${z}", previously used at line ${Z.id.__line__}`))}}if("ref"in f){let z;["type","source","source-layer","filter","layout"].forEach(G=>{G in f&&l.push(new i.V(_,f[G],`"${G}" is prohibited for ref layers`))}),E.layers.forEach(G=>{i.J(G.id)===L&&(z=G)}),z?z.ref?l.push(new i.V(_,f.ref,"ref cannot reference another ref layer")):k=i.J(z.type):typeof L=="string"&&l.push(new i.V(_,f.ref,`ref layer "${L}" not found`))}else if(k!=="background"&&k!=="sky"&&k!=="slot")if(f.source)if(i.a0(f.source)){const z=E.sources&&E.sources[f.source],G=z&&i.J(z.type);z?G==="vector"&&k==="raster"?l.push(new i.V(_,f.source,`layer "${f.id}" requires a raster source`)):G==="raster"&&k!=="raster"?l.push(new i.V(_,f.source,`layer "${f.id}" requires a vector source`)):G!=="vector"||f["source-layer"]?G==="raster-dem"&&k!=="hillshade"?l.push(new i.V(_,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(k)?k==="line"&&f.paint&&(f.paint["line-gradient"]||f.paint["line-trim-offset"])&&G==="geojson"&&!z.lineMetrics?l.push(new i.V(_,f,`layer "${f.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):k==="raster-particle"&&G!=="raster-array"&&l.push(new i.V(_,f.source,`layer "${f.id}" requires a 'raster-array' source.`)):l.push(new i.V(_,f.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new i.V(_,f,`layer "${f.id}" must specify a "source-layer"`)):l.push(new i.V(_,f.source,`source "${f.source}" not found`))}else l.push(new i.V(`${_}.source`,f.source,'"source" must be a string'));else l.push(new i.V(_,f,'missing required property "source"'));return l=l.concat(Ws({key:_,value:f,valueSpec:j.layer,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Li({key:`${_}.type`,value:f.type,valueSpec:j.layer.type,style:v.style,styleSpec:v.styleSpec,object:f,objectKey:"type"}),filter:z=>Ht(Object.assign({layerType:k},z)),layout:z=>Ws({layer:f,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":G=>Kn(Object.assign({layerType:k},G))}}),paint:z=>Ws({layer:f,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":G=>hn(Object.assign({layerType:k,layer:f},G))}}),appearances(z){const G=jt({key:z.key,value:z.value,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:X=>function(se){const{key:le,layer:ue,layerType:_e}=se,ye=i.J(se.value),Ee=i.J(ye.name),Ne=i.J(ye.condition),je=Ws({key:le,value:ye,valueSpec:se.styleSpec.appearance,style:se.style,styleSpec:se.styleSpec,objectElementValidators:{condition:qe=>function(Ie){const Ge=[];return Ge.push(...pt({key:Ie.key,value:Ie.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ge}(Object.assign({layer:ue,layerType:_e},qe)),properties:qe=>function(Ie){const Ge=[],{styleSpec:Ue,layer:De,layerType:Ze}=Ie,ut=Ue[`paint_${Ze}`],ot=Ue[`layout_${Ze}`],St=Ie.object[Ie.objectKey];for(const gt in St){const kt=gt in ut?"paint":gt in ot?"layout":void 0;if(!kt){Ge.push(new i.V(Ie.key,gt,`unknown property "${gt}" for layer type "${Ze}"`));continue}const Qt=Object.assign({},Ie,{key:`${Ie.key}.${gt}`,object:St,objectKey:gt,layer:De,layerType:Ze,value:St[gt],valueSpec:kt==="paint"?ut[gt]:ot[gt]});Ge.push(...un(Qt,kt))}return Ge}(Object.assign({layer:ue,layerType:_e},qe))}});return Ee!=="hidden"&&Ne===void 0&&je.push(new i.V(se.key,"name",'Appearance with name different than "hidden" must have a condition')),je}(Object.assign({layerType:k,layer:f},X))}),Z=Array.isArray(z.value)?z.value:[],Q=new Set;return Z.forEach((X,se)=>{const le=i.J(X.name);if(le)if(Q.has(le)){const ue=i.J(f.id);G.push(new i.V(z.key,le,`Duplicated appearance name "${le}" for layer "${ue}"`))}else Q.add(le)}),G}}})),l}function Mi({key:v,value:l}){return i.a0(l)?[]:[new i.V(v,l,`string expected, ${i.K(l)} found`)]}const Pa={promoteId:function v({key:l,value:f}){if(i.a0(f))return Mi({key:l,value:f});if(Array.isArray(f)){const E=[],j=i.S(f),k=i.U(j);return k.result==="error"&&k.value.forEach(L=>{E.push(new i.V(`${l}${L.key}`,null,`${L.message}`))}),i.X(k.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||E.push(new i.V(`${l}`,null,"promoteId expression should be only feature dependent")),E}if(!i.H(f))return[new i.V(l,f,`string, expression or object expected, "${i.K(f)}" found`)];const _=[];for(const E in f)_.push(...v({key:`${l}.${E}`,value:f[E]}));return _}};function _s(v){const l=v.value,f=v.key,_=v.styleSpec,E=v.style;if(!i.H(l))return[new i.V(f,l,`object expected, ${i.K(l)} found`)];if(!("type"in l))return[new i.V(f,l,'"type" is required')];const j=i.J(l.type);let k=[];switch(["vector","raster","raster-dem","raster-array"].includes(j)&&("url"in l||"tiles"in l||k.push(new i.a3(f,l,'Either "url" or "tiles" is required.'))),j){case"vector":case"raster":case"raster-dem":case"raster-array":return k=k.concat(Ws({key:f,value:l,valueSpec:_[`source_${j.replace("-","_")}`],style:v.style,styleSpec:_,objectElementValidators:Pa})),k;case"geojson":if(k=Ws({key:f,value:l,valueSpec:_.source_geojson,style:E,styleSpec:_,objectElementValidators:Pa}),"cluster"in l&&"clusterProperties"in l){if(!i.H(l.clusterProperties))return[new i.V(`${f}.clusterProperties`,l,`object expected, ${i.K(l)} found`)];for(const L in l.clusterProperties){const z=l.clusterProperties[L];if(!Array.isArray(z))return[new i.V(`${f}.clusterProperties.${L}`,z,"array expected")];const[G,Z]=z,Q=typeof G=="string"?[G,["accumulated"],["get",L]]:G;k.push(...pt({key:`${f}.${L}.map`,value:Z,expressionContext:"cluster-map"})),k.push(...pt({key:`${f}.${L}.reduce`,value:Q,expressionContext:"cluster-reduce"}))}}return k;case"video":return Ws({key:f,value:l,valueSpec:_.source_video,style:E,styleSpec:_});case"image":return Ws({key:f,value:l,valueSpec:_.source_image,style:E,styleSpec:_});case"canvas":return[new i.V(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ut({key:`${f}.type`,value:l.type,valueSpec:{values:mi(_)}})}}function mi(v){return v.source.reduce((l,f)=>{const _=v[f];return _.type.type==="enum"&&(l=l.concat(Object.keys(_.type.values||{}))),l},[])}function Ua(v){const l=v.value,f=v.styleSpec,_=f.light,E=v.style;if(l===void 0)return[];if(!i.H(l))return[new i.V("light",l,`object expected, ${i.K(l)} found`)];let j=[];for(const k in l){const L=k.match(/^(.*)-transition$/),z=k.match(/^(.*)-use-theme$/);j=j.concat(z&&_[z[1]]?Li({key:k,value:l[k],valueSpec:{type:"string"},style:E,styleSpec:f}):L&&_[L[1]]&&_[L[1]].transition?Li({key:k,value:l[k],valueSpec:f.transition,style:E,styleSpec:f}):_[k]?Li({key:k,value:l[k],valueSpec:_[k],style:E,styleSpec:f}):[new i.V(k,l[k],`unknown property "${k}"`)])}return j}function Va(v){const l=v.value;if(!l)return[];const f=v.key;if(!i.H(l))return[new i.V(f,l,`object expected, ${i.K(l)} found`)];let _=[];const E=v.styleSpec,j=E["light-3d"],k=v.style,L=v.style.lights;for(const Z of["type","id"])if(!(Z in l))return _=_.concat([new i.V(f,l,`missing property "${Z}"`)]),_;if(!i.a0(l.type))return _=_.concat([new i.V(`${f}.type`,l.type,"string expected")]),_;if(L)for(let Z=0;Z<v.arrayIndex;Z++){const Q=i.J(l.type),X=L[Z];i.J(X.type)===Q&&_.push(new i.V(f,l.id,`duplicate light type "${l.type}", previously defined at line ${X.id.__line__}`))}const z=`properties_light_${l.type}`;if(!(z in E))return _=_.concat([new i.V(`${f}.type`,l,`Invalid light type ${l.type}`)]),_;const G=E[z];for(const Z in l)if(Z==="properties"){const Q=l[Z];if(!i.H(Q))return _=_.concat([new i.V("properties",Q,`object expected, ${i.K(Q)} found`)]),_;for(const X in Q){const se=X.match(/^(.*)-transition$/),le=X.match(/^(.*)-use-theme$/);_=_.concat(le&&G[le[1]]?Li({key:Z,value:Q[X],valueSpec:{type:"string"},style:k,styleSpec:E}):se&&G[se[1]]&&G[se[1]].transition?Li({key:Z,value:l[Z],valueSpec:E.transition,style:k,styleSpec:E}):G[X]?Li({key:X,value:Q[X],valueSpec:G[X],style:k,styleSpec:E}):[new i.a3(v.key,Q[X],`unknown property "${X}"`)])}}else _=_.concat(j[Z]?Li({key:Z,value:l[Z],valueSpec:j[Z],style:k,styleSpec:E}):[new i.a3(Z,l[Z],`unknown property "${Z}"`)]);return _}function Bo(v){const l=v.value,f=v.key,_=v.style,E=v.styleSpec,j=E.terrain;if(l==null)return[];if(!i.H(l))return[new i.V("terrain",l,`object expected, ${i.K(l)} found`)];let k=[];for(const L in l){const z=L.match(/^(.*)-transition$/),G=L.match(/^(.*)-use-theme$/);k=k.concat(G&&j[G[1]]?Li({key:L,value:l[L],valueSpec:{type:"string"},style:_,styleSpec:E}):z&&j[z[1]]&&j[z[1]].transition?Li({key:L,value:l[L],valueSpec:E.transition,style:_,styleSpec:E}):j[L]?Li({key:L,value:l[L],valueSpec:j[L],style:_,styleSpec:E}):[new i.a3(L,l[L],`unknown property "${L}"`)])}if(l.source)if(i.a0(l.source)){const L=_.sources&&_.sources[l.source],z=L&&i.J(L.type);L?z!=="raster-dem"&&k.push(new i.V(`${f}.source`,l.source,`terrain cannot be used with a source of type ${z}, it only be used with a "raster-dem" source type`)):k.push(new i.V(`${f}.source`,l.source,`source "${l.source}" not found`))}else k.push(new i.V(`${f}.source`,l.source,"source must be a string"));else k.push(new i.V(f,l,'terrain is missing required property "source"'));return k}function qa(v){const l=v.value,f=v.style,_=v.styleSpec,E=_.fog;if(l===void 0)return[];if(!i.H(l))return[new i.V("fog",l,`object expected, ${i.K(l)} found`)];let j=[];for(const k in l){const L=k.match(/^(.*)-transition$/),z=k.match(/^(.*)-use-theme$/);j=j.concat(z&&E[z[1]]?Li({key:k,value:l[k],valueSpec:{type:"string"},style:f,styleSpec:_}):L&&E[L[1]]&&E[L[1]].transition?Li({key:k,value:l[k],valueSpec:_.transition,style:f,styleSpec:_}):E[k]?Li({key:k,value:l[k],valueSpec:E[k],style:f,styleSpec:_}):[new i.a3(k,l[k],`unknown property "${k}"`)])}return j}const Ha={"*":()=>[],array:jt,boolean:function(v){const l=v.value,f=v.key;return i.$(l)?[]:[new i.V(f,l,`boolean expected, ${i.K(l)} found`)]},number:zt,color:function({key:v,value:l}){return i.a0(l)?i.a1.parseCSSColor(l)===null?[new i.V(v,l,`color expected, "${l}" found`)]:[]:[new i.V(v,l,`color expected, ${i.K(l)} found`)]},enum:Ut,filter:Ht,function:Je,layer:Gn,object:Ws,source:_s,model:i.a7,light:Ua,"light-3d":Va,terrain:Bo,fog:qa,string:Mi,formatted:function(v){return Mi(v).length===0?[]:pt(v)},resolvedImage:function(v){return Mi(v).length===0?[]:pt(v)},projection:function(v){const l=v.value,f=v.styleSpec,_=f.projection,E=v.style;if(i.H(l)){let j=[];for(const k in l)j=j.concat(Li({key:k,value:l[k],valueSpec:_[k],style:E,styleSpec:f}));return j}return i.a0(l)?[]:[new i.V("projection",l,`object or string expected, ${i.K(l)} found`)]},import:function(v){const l=v.key,{value:f,styleSpec:_}=v;if(!i.H(f))return[new i.V(l,f,"import must be an object")];const{data:E,...j}=f;Object.defineProperty(j,"__line__",{value:f.__line__,enumerable:!1});let k=Ws(Object.assign({},v,{value:j,valueSpec:_.import}));return i.J(j.id)===""&&k.push(new i.V(`${v.key}.id`,j,"import id can't be an empty string")),E&&(k=k.concat(_a(E,_,{key:`${v.key}.data`}))),k},iconset:function(v){const l=v.value,f=v.key,_=v.styleSpec,E=v.style;if(!i.H(l))return[new i.V(f,l,"object expected")];if(!l.type)return[new i.V(f,l,'"type" is required')];const j=i.J(l.type);let k=[];if(k=k.concat(Ws({key:f,value:l,valueSpec:_[`iconset_${j}`],style:E,styleSpec:_})),function(L,z){return!(L!=="source"||!z.source)}(j,l)){const L=E.sources&&E.sources[l.source],z=L&&i.J(L.type);L?z!=="raster-array"&&k.push(new i.V(f,l.source,`iconset cannot be used with a source of type ${String(z)}, it only be used with a "raster-array" source type`)):k.push(new i.V(f,l.source,`source "${l.source}" not found`))}return k}};function Li(v,l=!1){const f=v.value,_=v.valueSpec,E=v.styleSpec;if(_.expression){if(i.a4(i.J(f)))return Je(v);if(i.Q(i.S(f)))return pt(v)}if(_.type&&Ha[_.type]){const j=Ha[_.type](v);return l===!0&&j.length>0&&Array.isArray(v.value)?pt(v):j}return Ws(Object.assign({},v,{valueSpec:_.type?E[_.type]:_}))}function Ws(v){const l=v.key,f=v.value,_=v.valueSpec||{},E=v.objectElementValidators||{},j=v.style,k=v.styleSpec;if(!i.H(f))return[new i.V(l,f,`object expected, ${i.K(f)} found`)];let L=[];for(const z in f){const G=z.split(".")[0];let Z;E[G]?Z=E[G]:_[G]?Z=Li:E["*"]?Z=E["*"]:_["*"]&&(Z=Li),Z?L=L.concat(Z({key:(l&&`${l}.`)+z,value:f[z],valueSpec:_[G]||_["*"],style:j,styleSpec:k,object:f,objectKey:z},f)):L.push(new i.a3(l,f[z],`unknown property "${z}"`))}for(const z in _){if(E[z])continue;const G=_[z];G.required&&G.default===void 0&&f[z]===void 0&&L.push(new i.V(l,f,`missing required property "${z}"`))}return L}function nl({key:v,value:l}){const f=Mi({key:v,value:l});if(f.length)return f;const _=l;return _.indexOf("{fontstack}")===-1&&f.push(new i.V(v,l,'"glyphs" url must include a "{fontstack}" token')),_.indexOf("{range}")===-1&&f.push(new i.V(v,l,'"glyphs" url must include a "{range}" token')),f}function _a(v,l=i.a6,f={}){return Ws({key:f.key||"",value:v,valueSpec:Object.assign(l.$root,{"*":{type:"*"}}),styleSpec:l,style:v,objectElementValidators:{glyphs:nl}})}function so(v,l=i.a6){return dt(_a(v,l))}const Ln=v=>dt(_s(v)),Fi=v=>dt(Ua(v)),ps=v=>dt(Va(v)),Ga=v=>dt(Bo(v)),at=v=>dt(qa(v)),gn=v=>dt(function(l){const f=l.value,_=l.style,E=l.styleSpec,j=E.snow;if(f===void 0)return[];if(!i.H(f))return[new i.V("snow",f,`object expected, ${i.K(f)} found`)];let k=[];for(const L in f){const z=L.match(/^(.*)-transition$/);k=k.concat(z&&j[z[1]]&&j[z[1]].transition?Li({key:L,value:f[L],valueSpec:E.transition,style:_,styleSpec:E}):j[L]?Li({key:L,value:f[L],valueSpec:j[L],style:_,styleSpec:E}):[new i.a3(L,f[L],`unknown property "${L}"`)])}return k}(v)),Ks=v=>dt(function(l){const f=l.value,_=l.style,E=l.styleSpec,j=E.rain;if(f===void 0)return[];if(!i.H(f))return[new i.V("rain",f,`object expected, ${i.K(f)} found`)];let k=[];for(const L in f){const z=L.match(/^(.*)-transition$/);k=k.concat(z&&j[z[1]]&&j[z[1]].transition?Li({key:L,value:f[L],valueSpec:E.transition,style:_,styleSpec:E}):j[L]?Li({key:L,value:f[L],valueSpec:j[L],style:_,styleSpec:E}):[new i.a3(L,f[L],`unknown property "${L}"`)])}return k}(v)),Oa=v=>dt(Gn(v)),vn=v=>dt(Ht(v)),$o=v=>dt(hn(v)),jw=v=>dt(Kn(v)),Ig=v=>dt(i.a7(v));function dt(v){return v.slice().sort((l,f)=>l.line&&f.line?l.line-f.line:0)}function fe(v,l){let f=!1;if(l&&l.length)for(const _ of l)_ instanceof i.a3?i.w(_.message):(v.fire(new i.y(new Error(_.message))),f=!0);return f}const ve=i.a6.light;let Me;class et extends i.E{constructor(l,f="flat"){super(),this._transitionable=new i.a8(Me||(Me=new i.a9({anchor:new i.aa(ve.anchor),position:new i.ab(ve.position),color:new i.aa(ve.color),intensity:new i.aa(ve.intensity)}))),this.setLight(l,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f,_={}){this._validate(Fi,l,_)||(this._transitionable.setTransitionOrValue(l),this.id=f)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&fe(this,l.call(so,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const Qe=i.a6.terrain;let lt=class extends i.E{constructor(v,l,f,_,E){super(),this.scope=f,this._transitionable=new i.a8(new i.a9({source:new i.aa(Qe.source),exaggeration:new i.aa(Qe.exaggeration)}),f,_),this._transitionable.setTransitionOrValue(v,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l,this.worldview=E}get(){return this._transitionable.serialize()}set(v,l){this._transitionable.setTransitionOrValue(v,l)}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}getExaggeration(v){return this._transitioning.possiblyEvaluate(new i.ac(v,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const v=this._transitionable._values.exaggeration;if(!v)return null;const l=v.value.expression;if(!l)return null;let f=-1,_=-1,E=1;for(const j of l.zoomStops)E=l.evaluate(new i.ac(j,{worldview:this.worldview})),E>.01?(f=j,_=-1):_=j;return E<.01&&f>0&&_>f?[f,_]:null}isZoomDependent(){const v=this._transitionable._values.exaggeration;return v!=null&&v.value!=null&&v.value.expression!=null&&v.value.expression instanceof i.ad}};const bt=45,ct=65,vt=.05;function Jt(v,l,f,_){const E=i.ah(bt,ct,f),[j,k]=qt(v,_);let L=1-Math.min(1,Math.exp((l-j)/(k-j)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*E*v.alpha}function qt(v,l){const f=.5/Math.tan(.5*l);return[v.range[0]+f,v.range[1]+f]}function Ar(v,l,f,_,E){const j=i.af([],[l,f,_],E.mercatorFogMatrix);return Jt(v,i.ag(j),E.pitch,E._fov)}function Jr(v,l,f,_,E,j,k){const L=[[f,_,0],[E,_,0],[E,j,0],[f,j,0]];let z=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(const Z of L){const Q=i.af([],Z,l),X=i.ag(Q);z=Math.min(z,X),G=Math.max(G,X)}return[Jt(v,z,k.pitch,k._fov),Jt(v,G,k.pitch,k._fov)]}const Zr=i.a6.fog;class zr extends i.E{constructor(l,f,_,E){super();const j=new i.a9({range:new i.aa(Zr.range),color:new i.aa(Zr.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(Zr["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(Zr["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(Zr["horizon-blend"]),"star-intensity":new i.aa(Zr["star-intensity"]),"vertical-range":new i.aa(Zr["vertical-range"])});this._transitionable=new i.a8(j,_,new Map(E)),this.set(l,E),this._transitioning=this._transitionable.untransitioned(),this._transform=f,this.properties=new i.ai(j),this.scope=_}get state(){const l=this._transform,f=l.projection.name==="globe",_=i.aj(l.zoom),E=this.properties.get("range"),j=[.5,3];return{range:f?[i.ak(j[0],E[0],_),i.ak(j[1],E[1],_)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,f,_={}){if(this._validate(at,l,_))return;const E=Object.assign({},l);for(const j of Object.keys(Zr))E[j]===void 0&&(E[j]=Zr[j].default);this._options=E,this._transitionable.setTransitionOrValue(this._options,f)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(bt,ct,l))*f.a}getOpacityAtLatLng(l,f){return this._transform.projection.supportsFog?function(_,E,j){const k=i.ae.fromLngLat(E),L=j.elevation?j.elevation.getAtPointOrZero(k):0;return Ar(_,k.x,k.y,L,j)}(this.state,l,f):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Jr(this.state,f,0,0,i.al,i.al,this._transform)}getOpacityForBounds(l,f,_,E,j){return this._transform.projection.supportsFog?Jr(this.state,l,f,_,E,j,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?qt(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const _ of f){const E=l.points[_];let j;if(E[2]>=0)j=E;else{const k=l.points[_-4];j=i.am(k,E,k[2]/(k[2]-E[2]))}if(Ar(this.state,j[0],j[1],0,this._transform)>=vt)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&fe(this,l.call(so,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let bn,An,Si,xs,Zs=class extends i.E{constructor(v,l,f,_){super();const E=bn||(bn=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(E,f,new Map(_)),this.set(v,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(E),this.scope=f}get state(){const v=this.properties.get("opacity"),l=this.properties.get("color"),f=this.properties.get("direction"),_=i.an(f[0]),E=-Math.max(i.an(f[1]),.01),j=[Math.cos(_)*Math.cos(E),Math.sin(_)*Math.cos(E),Math.sin(E)],k=this.properties.get("vignette"),L=this.properties.get("vignette-color");return L.a=k,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(l.r,l.g,l.b,l.a*v),direction:j,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:L}}get(){return this._transitionable.serialize()}set(v,l,f={}){if(this._validate(gn,v,f))return;const _=Object.assign({},v),E=i.a6.snow;for(const j of Object.keys(E))_[j]===void 0&&(_[j]=E[j].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}updateConfig(v){this._transitionable.setTransitionOrValue(this._options,new Map(v))}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}_validate(v,l,f){return(!f||f.validate!==!1)&&fe(this,v.call(so,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},Ms=class extends i.E{constructor(v,l,f,_){super();const E=An||(An=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(E,f,new Map(_)),this.set(v,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(E),this.scope=f}get state(){const v=this.properties.get("opacity"),l=this.properties.get("color"),f=this.properties.get("direction"),_=i.an(f[0]),E=-Math.max(i.an(f[1]),.01),j=[Math.cos(_)*Math.cos(E),Math.sin(_)*Math.cos(E),Math.sin(E)],k=this.properties.get("vignette-color");return k.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(l.r,l.g,l.b,l.a*v),direction:j,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:k}}get(){return this._transitionable.serialize()}set(v,l,f={}){if(this._validate(Ks,v,f))return;const _=Object.assign({},v),E=i.a6.rain;for(const j of Object.keys(E))_[j]===void 0&&(_[j]=E[j].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}updateConfig(v){this._transitionable.setTransitionOrValue(this._options,new Map(v))}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}_validate(v,l,f){return(!f||f.validate!==!1)&&fe(this,v.call(so,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class Os extends i.E{constructor(l,f,_,E){super(),this.scope=_,this._options=l,this.properties=new i.ai(f),this._transitionable=new i.a8(f,_,new Map(E)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,f){this._options=l,this._transitionable.setTransitionOrValue(l.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class _i{constructor(l,f,_){this.screenBounds=l,this.cameraPoint=_.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(l,f){let _,E;if(l instanceof i.P||typeof l[0]=="number"){const j=i.P.convert(l);_=[j],E=f.isPointAboveHorizon(j)}else{const j=i.P.convert(l[0]),k=i.P.convert(l[1]),L=j.add(k)._div(2);_=[j,k],E=i.aq(j,k).every(z=>f.isPointAboveHorizon(z))&&f.isPointAboveHorizon(L)}return new _i(_,E,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],E=i.aq(f,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<_.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?E[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(E[3]=this.cameraPoint)),i.ar(E,l)}bufferedCameraGeometryGlobe(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],E=i.aq(f,_,l),j=this.cameraPoint.clone();switch(3*((j.y>f.y)+(j.y>_.y))+((j.x>f.x)+(j.x>_.x))){case 0:E[0]=j,E[4]=j.clone();break;case 1:E.splice(1,0,j);break;case 2:E[1]=j;break;case 3:E.splice(4,0,j);break;case 5:E.splice(2,0,j);break;case 6:E[3]=j;break;case 7:E.splice(3,0,j);break;case 8:E[2]=j}return E}containsTile(l,f,_,E=0){const j=Math.max(l.queryPadding,l.evaluateQueryRenderedFeaturePadding())/f._pixelsPerMercatorPixel+1,k=_?this._bufferedCameraMercator(j,f):this._bufferedScreenMercator(j,f);let L=l.tileID.wrap+(k.unwrapped?E:0);const z=k.polygon.map(_e=>i.as(l.tileTransform,_e,L));if(!i.at(z,0,0,i.al,i.al))return;L=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const G=this.screenGeometryMercator.polygon.map(_e=>i.au(l.tileTransform,_e,L)),Z=G.map(_e=>new i.P(_e[0],_e[1])),Q=f.getFreeCameraOptions().position||new i.ae(0,0,0),X=i.au(l.tileTransform,Q,L),se=G.map(_e=>{const ye=i.av(_e,_e,X);return i.aw(ye,ye),new i.ax(X,ye)}),le=i.ay(l,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Z,tilespaceRays:se,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(ue=i.az(z),ue.min.x=i.aA(ue.min.x,0,i.al),ue.min.y=i.aA(ue.min.y,0,i.al),ue.max.x=i.aA(ue.max.x,0,i.al),ue.max.y=i.aA(ue.max.y,0,i.al),ue),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:le};var ue}_bufferedScreenMercator(l,f){const _=ms(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let E;return E=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),f):{polygon:this.bufferedScreenGeometry(l).map(j=>f.pointCoordinate3D(j)),unwrapped:!0},this._screenRaycastCache[_]=E,E}}_bufferedCameraMercator(l,f){const _=ms(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let E;return E=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),f):{polygon:this.bufferedCameraGeometry(l).map(j=>f.pointCoordinate3D(j)),unwrapped:!0},this._cameraRaycastCache[_]=E,E}}_projectAndResample(l,f){const _=function(j,k){const L=i.aB([],k.pixelMatrix,k.globeMatrix),z=[0,-i.aD,0,1],G=[0,i.aD,0,1],Z=[0,0,0,1];i.aC(z,z,L),i.aC(G,G,L),i.aC(Z,Z,L);const Q=new i.P(z[0]/z[3],z[1]/z[3]),X=new i.P(G[0]/G[3],G[1]/G[3]),se=i.aE(j,Q)&&z[3]<Z[3],le=i.aE(j,X)&&G[3]<Z[3];if(!se&&!le)return null;const ue=function(Ge,Ue,De){for(let Ze=1;Ze<Ge.length;Ze++){const ut=Yi(Ue.pointCoordinate3D(Ge[Ze-1]).x),ot=Yi(Ue.pointCoordinate3D(Ge[Ze]).x);if(De<0){if(ut<ot)return{idx:Ze,t:-ut/(ot-1-ut)}}else if(ot<ut)return{idx:Ze,t:(1-ut)/(ot+1-ut)}}return null}(j,k,se?-1:1);if(!ue)return null;const{idx:_e,t:ye}=ue;let Ee=_e>1?Mn(j.slice(0,_e),k):[],Ne=_e<j.length?Mn(j.slice(_e),k):[];Ee=Ee.map(Ge=>new i.P(Yi(Ge.x),Ge.y)),Ne=Ne.map(Ge=>new i.P(Yi(Ge.x),Ge.y));const je=[...Ee];je.length===0&&je.push(Ne[Ne.length-1]);const qe=i.ak(je[je.length-1].y,(Ne.length===0?Ee[0]:Ne[0]).y,ye);let Ie;return Ie=se?[new i.P(0,qe),new i.P(0,0),new i.P(1,0),new i.P(1,qe)]:[new i.P(1,qe),new i.P(1,1),new i.P(0,1),new i.P(0,qe)],je.push(...Ie),Ne.length===0?je.push(Ee[0]):je.push(...Ne),{polygon:je.map(Ge=>new i.ae(Ge.x,Ge.y)),unwrapped:!1}}(l,f);if(_)return _;const E=function(j,k){let L=!1,z=-1/0,G=0;for(let Q=0;Q<j.length-1;Q++)j[Q].x>z&&(z=j[Q].x,G=Q);for(let Q=0;Q<j.length-1;Q++){const X=(G+Q)%(j.length-1),se=j[X],le=j[X+1];Math.abs(se.x-le.x)>.5&&(se.x<le.x?(se.x+=1,X===0&&(j[j.length-1].x+=1)):(le.x+=1,X+1===j.length-1&&(j[0].x+=1)),L=!0)}const Z=i.aF(k.center.lng);return L&&Z<Math.abs(Z-1)&&j.forEach(Q=>{Q.x-=1}),{polygon:j,unwrapped:L}}(Mn(l,f).map(j=>new i.P(Yi(j.x),j.y)),f);return{polygon:E.polygon.map(j=>new i.ae(j.x,j.y)),unwrapped:E.unwrapped}}}function Mn(v,l){return i.aG(v,f=>{const _=l.pointCoordinate3D(f);f.x=_.x,f.y=_.y},1/256)}function Yi(v){return v<0?1+v%1:v%1}function ms(v){return 100*v|0}function Ti(v,l,f,_,E){const j=function(L,z){if(L)return E(L);if(z){if(v.url&&z.tiles&&v.tiles&&delete v.tiles,z.variants){if(!Array.isArray(z.variants))return E(new Error("variants must be an array"));for(const Z of z.variants){if(Z==null||typeof Z!="object"||Z.constructor!==Object)return E(new Error("variant must be an object"));if(!Array.isArray(Z.capabilities))return E(new Error("capabilities must be an array"));if(Z.capabilities.length===1&&Z.capabilities[0]==="meshopt"){z=Object.assign(z,Z);break}}}const G=i.aH(Object.assign({},z,v),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);G.tiles=l.canonicalizeTileset(G,v.url),E(null,G)}},k=function(L,z,G){if(!L)return null;if(!z&&!G)return L;G=G||L.worldview_default;const Z=Object.values(L.language||{});if(Z.length===0)return null;const Q=Object.values(L.worldview||{});if(Q.length===0)return null;const X=Z.every(le=>le===z),se=Q.every(le=>le===G);return X&&se?L:z in(L.language_options||{})||G in(L.worldview_options||{})?null:L.language_options&&L.worldview_options?L:null}(v.data,f,_);return k?i.o.frame(()=>j(null,k)):v.url?i.m(l.transformRequest(l.normalizeSourceURL(v.url,null,f,_),i.R.Source),j):i.o.frame(()=>{const{data:L,...z}=v;j(null,z)})}function Ji(v,l){const f=Math.pow(2,l.z),_=Math.floor(i.aF(v.getWest())*f),E=Math.floor(i.aJ(v.getNorth())*f),j=Math.ceil(i.aF(v.getEast())*f),k=Math.ceil(i.aJ(v.getSouth())*f);return l.x>=_&&l.x<j&&l.y>=E&&l.y<k}class la{constructor(l,f,_){this.bounds=l?i.aI.convert(this.validateBounds(l)):null,this.minzoom=f||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}addExtraBounds(l){if(l){this.extraBounds||(this.extraBounds=[]);for(const f of l)this.extraBounds.push(i.aI.convert(this.validateBounds(f)))}}contains(l){if(l.z>this.maxzoom||l.z<this.minzoom||this.bounds&&!Ji(this.bounds,l))return!1;if(!this.extraBounds)return!0;for(const f of this.extraBounds)if(Ji(f,l))return!0;return!1}static fromTileJSON(l){if(!l.bounds&&!l.extra_bounds)return null;const f=new la(l.bounds,l.minzoom,l.maxzoom);return f.addExtraBounds(l.extra_bounds),f}}class Uo extends i.E{constructor(l,f,_,E){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(f,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E),this._tileWorkers={},this._deduped=new i.aK}load(l){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=Ti(this._options,this.map._requestManager,f,_,(E,j)=>{if(this._tileJSONRequest=null,this._loaded=!0,E)f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new i.y(E));else if(j){if(Object.assign(this,j),this.hasWorldviews=!!j.worldview_options,j.worldview_default&&(this.worldviewDefault=j.worldview_default),j.vector_layers){this.vectorLayers=j.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const k of j.vector_layers)this.vectorLayerIds.push(k.id),j.worldview&&j.worldview[k.source]&&this.localizableLayerIds.add(k.id)}this.tileBounds=la.fromTileJSON(j),pe(j.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}l&&l(E)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(l,f){const _=l.tileID.canonical.url(this.tiles,this.scheme),E=this.map._requestManager.normalizeTileURL(_),j=this.map._requestManager.transformRequest(E,i.R.Tile),k=this.map.style?this.map.style.getLut(this.scope):null,L=k?{image:k.image.clone()}:null,z={request:j,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,lut:L,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(_)&&(z.localizableLayerIds=this.localizableLayerIds),z.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=f:l.request=l.actor.send("reloadTile",z,G.bind(this));else if(l.actor=this._tileWorkers[E]=this._tileWorkers[E]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",z,G.bind(this),void 0,!0);else{const Z=i.aL.call({deduped:this._deduped},z,(Q,X)=>{if(Q||!X)G.call(this,Q);else{const se=i.aM(X.responseHeaders);z.data={cacheControl:se.cacheControl,expires:se.expires,rawData:X.rawData.slice(0)},l.actor&&l.actor.send("loadTile",z,G.bind(this),void 0,!0)}},!0);l.request={cancel:Z}}function G(Z,Q){return delete l.request,l.aborted?f(null):Z&&Z.status!==404?f(Z):(Q&&Q.resourceTiming&&(l.resourceTiming=Q.resourceTiming),this.map._refreshExpiredTiles&&Q&&l.setExpiryData(Q),l.loadVectorData(Q,this.map.painter),i.aN(this.dispatcher),f(null,Q),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,f){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class bc extends i.E{constructor(l,f,_,E){super(),this.id=l,this.dispatcher=_,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},f),Object.assign(this,i.aH(f,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const f=this.map.getWorldview();this._tileJSONRequest=Ti(this._options,this.map._requestManager,null,f,(_,E)=>{this._tileJSONRequest=null,this._loaded=!0,_?this.fire(new i.y(_)):E&&(Object.assign(this,E),E.raster_layers&&(this.rasterLayers=E.raster_layers,this.rasterLayerIds=this.rasterLayers.map(j=>j.id)),this.tileBounds=la.fromTileJSON(E),pe(E.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),l&&l(_)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,f){const _=i.o.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=i.n(this.map._requestManager.transformRequest(E,i.R.Tile),(j,k,L)=>{if(delete l.request,l.aborted)return l.state="unloaded",f(null);if(j)return l.state="errored",f(j);if(!k)return f(null);const z=i.aM(L);this.map._refreshExpiredTiles&&l.setExpiryData(z),l.setTexture(k,this.map.painter),l.state="loaded",i.aN(this.dispatcher),f(null)})}abortTile(l,f){l.request&&(l.request.cancel(),delete l.request),f&&f()}unloadTile(l,f){l.texture&&l.texture instanceof i.T?(l.destroy(!0),l.texture&&l.texture instanceof i.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),f&&f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function sf([v,l],f,_,{scaled:E=!0}={}){const{tileSize:j,buffer:k}=_,{x:L,y:z,z:G}=f;if(!isFinite(L)||!isFinite(z)||!isFinite(G))throw new Error("Invalid MRT header");const Z=2**G,Q=Z*i.aF(v),X=Z*i.aJ(l);return function([se,le],ue,{scaled:_e=!0}={}){if(!ue)throw new Error("bandView is undefined");const{data:ye,tileSize:Ee,buffer:Ne,offset:je,scale:qe,dimension:Ie}=ue;if(se<-Ne||se>Ee+Ne||le<-Ne||le>Ee+Ne)throw new Error(`Point (${se}, ${le}) out of bounds for tileSize=${Ee}, buffer=${Ne}`);const Ge=(le+Ne)*(Ee+2*Ne)+(se+Ne);if(new Uint32Array(ye.buffer)[Ge]===4294967295)return null;let Ue=[];Ue=_e?[]:new ue.data.constructor(Ie);for(let De=0;De<Ie;De++)Ue[De]=Math.round(1e12*(ye[Ie*Ge+De]*qe+je))/1e12;return Ue}([Math.min(Math.max(-k,Math.floor((Q-L)*j)),j-1+k),Math.min(Math.max(-k,Math.floor((X-z)*j)),j-1+k)],_,{scaled:E})}class xa extends bc{constructor(l,f,_,E){super(l,f,_,E),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},f)}triggerRepaint(l){const f=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);f&&f.enabled&&_&&f._clearRenderCacheForTile(_.id,l.tileID),this.map.triggerRepaint()}loadTile(l,f){const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(_,i.R.Tile),j={request:E,uid:l.uid,tileID:l.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};l.source=this.id,l.scope=this.scope,l.requestParams=E,l.actor||(l.actor=this.dispatcher.getActor());const k=(L,z,G)=>{if(delete l.request,l.aborted)return l.state="unloaded",f(null);if(L)return L.name==="AbortError"?void 0:(l.state="errored",f(L));if(this.map._refreshExpiredTiles&&z){const Z=i.aM(G);l.setExpiryData(Z)}if(this.partial&&l.state!=="expired")l.state="empty";else if(!this.partial){if(!z)return f(null);l.state="loaded",l._isHeaderLoaded=!0,l._mrt=z}f(null)};l.request=this.partial?l.fetchHeader(void 0,k.bind(this)):l.actor.send("loadTile",j,k.bind(this),void 0,!0)}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,f){const _=l.texturePerLayer;if(l.flushAllQueues(),_.size){l.destroy(!0);for(const E of _.values())this.map.painter.saveTileTexture(E)}else l.destroy()}prepareTile(l,f,_,E){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBandForRender(f,_,E,(j,k)=>{if(j)return l.state="errored",this.fire(new i.y(j)),void this.triggerRepaint(l);k&&(l._isHeaderLoaded=!0,l.setTexturePerLayer(_,k,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const f=this.rasterLayers.find(({id:j})=>j===l),_=f&&f.fields,E=_&&_.bands&&_.bands;return E?E[0]:0}getTextureDescriptor(l,f,_){if(!l)return;const E=f.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!E)return;let j=null;f instanceof i.aQ?j=f.paint.get("raster-array-band"):f instanceof i.aR&&(j=f.paint.get("raster-particle-array-band"));const k=j||this.getInitialBand(E);if(k==null)return;if(!l.textureDescriptorPerLayer.get(f.id))return void this.prepareTile(l,E,f.id,k);if(l.updateNeeded(f.id,k)&&!_)return;const L=l.textureDescriptorPerLayer.get(f.id);return Object.assign({},L,{texture:l.texturePerLayer.get(f.id)})}getImages(l,f){const _=new Map;for(const E of l)for(const j of f){const[k,L]=j.split("/"),z=E.getLayer(k);if(!z||!z.hasBand(L)||!z.hasDataForBand(L))continue;const{bytes:G,tileSize:Z,buffer:Q}=z.getBandView(L),X=Z+2*Q,se={data:new i.q({width:X,height:X},G),pixelRatio:2,sdf:!1,usvg:!1,version:0};_.set(j,se)}return _}queryRasterArrayValueByBandId(l,f,_){const E=f._mrt;return new Promise(j=>{const k={},L=new Set;for(const[z,G]of Object.entries(E.layers)){if(_.layerName&&z!==_.layerName)continue;const Z={};k[z]=Z;for(const{bands:Q}of G.dataIndex)for(const X of Q)_.bands&&!_.bands.includes(X)||(L.add(i.B(z,X)),f.fetchBand(z,null,X,se=>{i.o.frame(()=>{Z[X]=se?null:sf([l.lng,l.lat],E,G.getBandView(X)),L.delete(i.B(z,X)),L.size===0&&j(k)})},!1))}L.size===0&&j(k)})}_loadTileForQuery(l,f){if(this._loadTileLoaded[l.uid])return void f(null,l._mrt);if(this._loadTilePending[l.uid])return void this._loadTilePending[l.uid].push(f);this._loadTilePending[l.uid]=[f];const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(_,i.R.Tile);l.actor.send("loadTile",{request:E,uid:l.uid,tileID:l.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(j,k,L)=>{if(j)return this._loadTilePending[l.uid].forEach(z=>z(j,null)),void delete this._loadTilePending[l.uid];if(!k)return this._loadTilePending[l.uid].forEach(z=>z(null,null)),void delete this._loadTilePending[l.uid];if(this.map._refreshExpiredTiles&&k){const z=i.aM(L);l.setExpiryData(z)}l._mrt=k,l._isHeaderLoaded=!0,l.state="loaded",this._loadTilePending[l.uid].forEach(z=>z(null,k)),this._loadTileLoaded[l.uid]=!0,delete this._loadTilePending[l.uid]},void 0,!0)}queryRasterArrayValueByAllBands(l,f,_){return new Promise((E,j)=>{this._loadTileForQuery(f,(k,L)=>{k?j(k):E(L?this.queryRasterArrayValueByBandId(l,f,_):null)})})}queryRasterArrayValue(l,f){const _=i.aS.convert(l),E=this.findLoadedParent(_);return E&&E._mrt?f.bands||!this.partial?this.queryRasterArrayValueByBandId(_,E,f):this.queryRasterArrayValueByAllBands(_,E,f):Promise.resolve(null)}findLoadedParent(l){const f=i.ae.fromLngLat(l,this.map.transform.tileSize),_=this.maxzoom+1,E=1<<_,j=Math.floor(f.x),k=Math.floor((f.x-j)*E),L=Math.floor(f.y*E),z=this.map.style.getSourceCache(this.id),G=new i.aP(_,j,_,k,L);return z.findLoadedParent(G,this.minzoom)}}const wc={vector:Uo,raster:bc,"raster-dem":class extends bc{constructor(v,l,f,_){super(v,l,f,_),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(v,l){const f=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(E,j){E&&(v.state="errored",l(E)),j&&(v.dem=j,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",l(null))}v.request=i.n(this.map._requestManager.transformRequest(f,i.R.Tile),(function(E,j,k){if(delete v.request,v.aborted)v.state="unloaded",l(null);else if(E)v.state="errored",l(E);else if(j){const L=i.aM(k);this.map._refreshExpiredTiles&&v.setExpiryData(L);const z=ImageBitmap&&j instanceof ImageBitmap&&i.r(),G=1-(j.width-i.aO(j.width))/2;G<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const Z=z?j:i.o.getImageData(j,G),Q={uid:v.uid,tileID:v.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:Z,encoding:this.encoding,padding:G};v.actor&&v.state!=="expired"||(v.actor=this.dispatcher.getActor(),v.actor.send("loadTile",Q,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(v){const l=v.canonical,f=Math.pow(2,l.z),_=(l.x-1+f)%f,E=l.x===0?v.wrap-1:v.wrap,j=(l.x+1+f)%f,k=l.x+1===f?v.wrap+1:v.wrap,L={};return L[new i.aP(v.overscaledZ,E,l.z,_,l.y).key]={backfilled:!1},L[new i.aP(v.overscaledZ,k,l.z,j,l.y).key]={backfilled:!1},l.y>0&&(L[new i.aP(v.overscaledZ,E,l.z,_,l.y-1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,v.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,k,l.z,j,l.y-1).key]={backfilled:!1}),l.y+1<f&&(L[new i.aP(v.overscaledZ,E,l.z,_,l.y+1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,v.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,k,l.z,j,l.y+1).key]={backfilled:!1}),L}},"raster-array":xa,geojson:class extends i.E{constructor(v,l,f,_){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(_),this._data=l.data,this._options=Object.assign({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const E=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*E,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*E,extent:i.al,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:i.al,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*E,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}updateData(v){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof v!="string"&&(v.type==="Feature"&&(v={type:"FeatureCollection",features:[v]}),v.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof v!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const f of this._data.features)l.set(f.id,f);for(const f of v.features)l.set(f.id,f);this._data.features=[...l.values()]}else this._data=v;return this._updateWorkerData(!0),this}getClusterExpansionZoom(v,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id,scope:this.scope},l),this}getClusterChildren(v,l){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id,scope:this.scope},l),this}getClusterLeaves(v,l,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:v,limit:l,offset:f},_),this}_updateWorkerData(v=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const l=Object.assign({append:v},this.workerOptions);l.scope=this.scope;const f=this._data;typeof f=="string"?(l.request=this.map._requestManager.transformRequest(i.o.resolveURL(f),i.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(f),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(_,E)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new i.y(_));else{const j={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&E&&E.resourceTiming&&E.resourceTiming[this.id]&&(j.resourceTiming=E.resourceTiming[this.id]),v&&(this._partialReload=!0),this.fire(new i.z("data",j)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(v),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const v=i.B(this.id,this.scope);this.map.style.clearSource(v),this._updateWorkerData()}loadTile(v,l){const f=v.actor?"reloadTile":"loadTile";v.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,E=_?{image:_.image.clone()}:null,j=this._partialReload,k={type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:E,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:v.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:j,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};v.request=this.actor.send(f,k,(L,z)=>j&&!z?(v.state="loaded",l(null)):(delete v.request,v.destroy(),v.aborted?l(null):L?l(L):(v.loadVectorData(z,this.map.painter,f==="reloadTile"),l(null))),void 0,f==="loadTile")}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v,l){this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id,scope:this.scope}),v.destroy()}onRemove(v){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aT{constructor(v,l,f,_){super(v,l,f,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const l of v.urls)this.urls.push(this.map._requestManager.transformRequest(l,i.R.Source).url);i.aU(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new i.y(l)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const l=this.video.seekable;v<l.start(0)||v>l.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const v=this.map.painter.context,l=v.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(v,this.video,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aT,model:i.aW,"batched-model":class extends i.E{constructor(v,l,f,_){super(),this.type="batched-model",this.id=v,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(v){this.map=v,this.load()}reload(){this.cancelTileJSONRequest();const v=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(v))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(v){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Ti(this._options,this.map._requestManager,l,f,(_,E)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.y(_))):E&&(Object.assign(this,E),E.bounds&&(this.tileBounds=new la(E.bounds,this.minzoom,this.maxzoom)),pe(E.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),v&&v(_)})}hasTransition(){return!1}hasTile(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)}loaded(){return this._loaded}loadTile(v,l){const f=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(f,i.R.Tile),data:void 0,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:v.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(v.actor&&v.state!=="expired")if(v.state==="loading")v.reloadCallback=l;else{if(v.buckets){const j=Object.values(v.buckets);for(const k of j)k.dirty=!0;return void(v.state="loaded")}v.request=v.actor.send("reloadTile",_,E.bind(this))}else v.actor=this.dispatcher.getActor(),v.request=v.actor.send("loadTile",_,E.bind(this),void 0,!0);function E(j,k){return v.aborted?l(null):j&&j.status!==404?l(j):(this.map._refreshExpiredTiles&&k&&v.setExpiryData(k),v.loadModelData(k,this.map.painter),v.state="loaded",void l(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aT{constructor(v,l,f,_){super(v,l,f,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(j=>typeof j!="number"))||this.fire(new i.y(new i.V(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${v}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${v}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(v){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!v&&!this._playing||this.texture instanceof i.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(l,this.canvas,l.gl.RGBA8,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends i.E{constructor(v,l,f,_){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new la(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this.map=v,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:l,y:f,z:_}=v.canonical;return this._implementation.hasTile({x:l,y:f,z:_})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,l){const{x:f,y:_,z:E}=v.tileID.canonical,j=new AbortController;v.request=Promise.resolve(this._implementation.loadTile({x:f,y:_,z:E},{signal:j.signal})).then((function(k){return delete v.request,v.aborted?(v.state="unloaded",l(null)):k===void 0?(v.state="errored",l(null)):k===null?(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",l(null)):function(L){return L instanceof ImageData||L instanceof HTMLCanvasElement||L instanceof ImageBitmap||L instanceof HTMLImageElement}(k)?(this.loadTileData(v,k),v.state="loaded",void l(null)):(v.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(k=>{k.name!=="AbortError"&&(v.state="errored",l(k))}),v.request.cancel=()=>j.abort()}loadTileData(v,l){v.setTexture(l,this.map.painter)}unloadTile(v,l){if(v.texture&&v.texture instanceof i.T?(v.destroy(!0),v.texture&&v.texture instanceof i.T&&this.map.painter.saveTileTexture(v.texture)):v.destroy(),this._implementation.unloadTile){const{x:f,y:_,z:E}=v.tileID.canonical;this._implementation.unloadTile({x:f,y:_,z:E})}l&&l()}abortTile(v,l){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z}))}_clearTiles(){const v=i.B(this.id,this.scope);this.map.style.clearSource(v)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},il=function(v,l,f,_){const E=new wc[l.type](v,l,f,_);if(E.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${E.id}`);return i.aX(["load","abort","unload","serialize","prepare"],E),E};function Jc(v,l,f=""){return`${f}:${l.id||""}:${l.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:E,importId:j}=_;return`featureset:${E}${j?`:import:${j}`:""}`}}(v.target)}`}function Pl(v,l,f,_=""){if(v.uniqueFeatureID){const E=Jc(v,l,_);if(f.has(E))return!0;f.add(E)}return!1}function Ol(v,l,f,_,E=!1){const j=l.sourceCache.transform,k=l.sourceCache.tilesIn(v,l.has3DLayers,E);k.sort(Mg);const L=[];for(const z of k){const G=z.tile.queryRenderedFeatures(l,z,f,_,j,E);Object.keys(G).length&&L.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:G})}for(const z in l.layers){const G=l.layers[z];if(G.styleLayer){const Z=G.styleLayer.queryRenderedFeatures(v,l.sourceCache,_);Object.keys(Z).length&&L.push({wrappedTileID:0,queryResults:Z})}}return L.length===0?{}:function(z){const G={},Z={};for(const Q of z){const X=Q.queryResults,se=Q.wrappedTileID,le=Z[se]=Z[se]||{};for(const ue in X){const _e=X[ue],ye=le[ue]=le[ue]||{},Ee=G[ue]=G[ue]||[];for(const Ne of _e)ye[Ne.featureIndex]||(ye[Ne.featureIndex]=!0,Ee.push(Ne))}}return G}(L)}function o_(v,l,f,_,E,j){const k={},L=_.queryRenderedSymbols(v),z=[];for(const G of Object.keys(L).map(Number))z.push(E[G]);z.sort(Mg);for(const G of z){const Z=G.featureIndex.lookupSymbolFeatures(L[G.bucketInstanceId],G.bucketIndex,G.sourceLayerIndex,l,f,j);for(const Q in Z){const X=k[Q]=k[Q]||[],se=Z[Q];se.sort((le,ue)=>{const _e=G.featureSortOrder;if(_e){const ye=_e.indexOf(le.featureIndex);return _e.indexOf(ue.featureIndex)-ye}return ue.featureIndex-le.featureIndex});for(const le of se)X.push(le)}}return k}function Rg(v,l){const f=v.getRenderableIds().map(j=>v.getTileByID(j)),_=[],E={};for(let j=0;j<f.length;j++){const k=f[j],L=k.tileID.canonical.key;E[L]||(E[L]=!0,k.querySourceFeatures(_,l))}return _}function Mg(v,l){const f=v.tileID,_=l.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function Dg(v,l){const f={};if(!l)return f;for(const _ of v){const E=_.layerIds.map(j=>l.getLayer(j)).filter(Boolean);if(E.length!==0){_.layers=E,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(j=>E.filter(k=>k.id===j)[0]));for(const j of E)f[j.fqid]=_}}return f}const yl=32,Qc=33,sl=new Uint16Array(8184);for(let v=0;v<2046;v++){let l=v+2,f=0,_=0,E=0,j=0,k=0,L=0;for(1&l?E=j=k=yl:f=_=L=yl;(l>>=1)>1;){const G=f+E>>1,Z=_+j>>1;1&l?(E=f,j=_,f=k,_=L):(f=E,_=j,E=k,j=L),k=G,L=Z}const z=4*v;sl[z+0]=f,sl[z+1]=_,sl[z+2]=E,sl[z+3]=j}const Vl=new Uint16Array(2178),nd=new Uint8Array(1089),af=new Uint16Array(1089);function l_(v){return v===0?-.03125:v===32?.03125:0}const c_={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class Au{constructor(l,f,_,E,j,k){this.tileID=l,this.uid=i.b1(),this.uses=0,this.tileSize=f,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=j,E&&E.style&&(this._lastUpdatedBrightness=E.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",E&&E.transform&&(this.projection=E.transform.projection),this.worldview=k,this._hasAppearances=null}registerFadeDuration(l){const f=l+this.timeAdded;f<i.o.now()||this.fadeEndTime&&f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(l,f,_){if(this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=Dg(l.buckets,f.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const j=this.buckets[E];if(j instanceof i.b3){if(this.hasSymbolBuckets=!0,!_)break;j.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const j=this.buckets[E];if(j instanceof i.b3&&j.hasRTLText){this.hasRTLText=!0,i.b4();break}}this.queryPadding=0;for(const E in this.buckets){const j=this.buckets[E],k=f.style.getOwnLayer(E);if(!k)continue;const L=k.queryRadius(j);this.queryPadding=Math.max(this.queryPadding,L)}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),l.lineAtlas&&(this.lineAtlas=l.lineAtlas),this._lastUpdatedBrightness=l.brightness}else this.collisionBoxArray=new i.b2}unloadVectorData(){if(this.hasData()){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(l,f,_){l&&(l.resourceTiming&&(this.resourceTiming=l.resourceTiming),this.buckets=Object.assign({},this.buckets,Dg(l.buckets,f.style)),l.featureIndex&&(this.latestFeatureIndex=l.featureIndex))}getBucket(l){return this.buckets[l.fqid]}upload(l,f){for(const j in this.buckets){const k=this.buckets[j];if(k.uploadPending()){let L={},z=[],G={zoom:0,pitch:0,brightness:0,worldview:""};if(f){if(f.style){z=f.style.listImages();const Z=k.layers[0],Q=Z.sourceLayer||"_geojsonTileLayer",X=f.style.getLayerSourceCache(Z);X&&(L=X._state.getState(Q,void 0))}G={zoom:f.transform.zoom||0,pitch:f.transform.pitch||0,brightness:f.style.getBrightness()||0,worldview:f.worldview||""}}k.upload(l,this.tileID.canonical,L,z,G)}}const _=l.gl,E=this.imageAtlas;E&&!E.uploaded&&(this.imageAtlasTexture=new i.T(l,E.image,_.RGBA8,{useMipmap:!!E.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(l,this.glyphAtlasImage,_.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(l,this.lineAtlas.image,_.R8),this.lineAtlas.uploaded=!0)}prepare(l,f,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture,_),!f||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const E=f.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(f)),(this._lastUpdatedBrightness||E||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&E&&Math.abs(this._lastUpdatedBrightness-E)<.001||(this.updateBuckets(f,this._lastUpdatedBrightness!==E),this._lastUpdatedBrightness=E))}evaluateQueryRenderedFeaturePadding(){let l=0;for(const f in this.buckets){const _=this.buckets[f];_.evaluateQueryRenderedFeaturePadding&&(l=Math.max(l,_.evaluateQueryRenderedFeaturePadding()))}return l}queryRenderedFeatures(l,f,_,E,j,k){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const L=this.evaluateQueryRenderedFeaturePadding(),z=function(G,Z){const Q=i.bp([],[.5*G.width,.5*-G.height,1]);return i.bq(Q,Q,[1,-1,0]),i.aB(Q,Q,G.calculateProjMatrix(Z.toUnwrapped())),Float32Array.from(Q)}(j,this.tileID);return this.latestFeatureIndex.query(l,{tilespaceGeometry:f,pixelPosMatrix:z,transform:E,availableImages:_,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:L})}querySourceFeatures(l,f){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const E=_.loadVTLayers(),j=f?f.sourceLayer:"",k=E._geojsonTileLayer||E[j];if(!k)return;const L=i.b5(f&&f.filter),{z,x:G,y:Z}=this.tileID.canonical,Q={z,x:G,y:Z};for(let X=0;X<k.length;X++){const se=k.feature(X);if(L.needGeometry){const _e=i.b6(se,!0);if(!L.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),_e,this.tileID.canonical))continue}else if(!L.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),se))continue;const le=_.getId(se,j),ue=new i.b7(se,z,G,Z,le);ue.tile=Q,l.push(ue)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const _=i.b8(l.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const _=Date.now();let E=!1;if(this.expirationTime>_)E=!1;else if(f)if(this.expirationTime<f)E=!0;else{const j=this.expirationTime-f;j?this.expirationTime=_+Math.max(j,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(l){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&l&&this.updateBuckets(l)}hasAppearances(l){for(const f in this.buckets)if(l.style.hasLayer(f)&&this.buckets[f].layers.some(_=>_.appearances&&_.appearances.length>0))return!0;return!1}updateBuckets(l,f){if(!this.latestFeatureIndex||!l.style)return;const _=this.latestFeatureIndex.loadVTLayers(),E=l.style.listImages(),j=l.style.getBrightness();for(const k in this.buckets){if(!l.style.hasLayer(k))continue;const L=this.buckets[k],z=L.layers[0],G=z.sourceLayer||"_geojsonTileLayer",Z=_[G],Q=l.style.getLayerSourceCache(z);let X={};Q&&(X=Q._state.getState(G,void 0));const se=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},le=Object.keys(X).length>0&&!f;if(L.hasAppearances=L.layers.some(_e=>_e.appearances&&_e.appearances.length>0),(le&&L.stateDependentLayers.length!==0||f)&&L.update(X,Z,E,se,le?L.stateDependentLayers:L.layers,f,j),le&&L.stateDependentLayers.length!==0||f||L.hasAppearances){const _e={zoom:l.transform.zoom,pitch:l.transform.pitch,brightness:l.style.getBrightness()||0,worldview:l.worldview};L.updateAppearances(this.tileID.canonical,X,E,_e)}(L instanceof i.b9||L instanceof i.ba)&&l._terrain&&l._terrain.enabled&&Q&&L.uploadPending()&&l._terrain._clearRenderCacheForTile(Q.id,this.tileID);const ue=l&&l.style&&l.style.getOwnLayer(k);ue&&(this.queryPadding=Math.max(this.queryPadding,ue.queryRadius(L)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=i.o.now()+l}setTexture(l,f){const _=f.context,E=_.gl;this.texture=this.texture||f.getTileTexture(l.width),this.texture&&this.texture instanceof i.T?this.texture.update(l):(this.texture=new i.T(_,l,E.RGBA8,{useMipmap:!0}),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE))}setDependencies(l,f){const _={};for(const E of f)_[E]=!0;this.dependencies[l]=_}hasDependency(l,f){for(const _ of l){const E=this.dependencies[_];if(E){for(const j of f)if(E[j])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(l,f){if(!f||f.name==="mercator"||this._tileDebugBuffer)return;const _=i.bb(c_,this.tileID.canonical,this.tileTransform)[0],E=new i.bc,j=new i.bd;for(let k=0;k<_.length;k++){const{x:L,y:z}=_[k];E.emplaceBack(L,z),j.emplaceBack(k)}j.emplaceBack(0),this._tileDebugIndexBuffer=l.createIndexBuffer(j),this._tileDebugBuffer=l.createVertexBuffer(E,i.be.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,E.length,j.length)}_makeTileBoundsBuffers(l,f){if(this._tileBoundsBuffer||!f||f.name==="mercator")return;const _=i.bb(c_,this.tileID.canonical,this.tileTransform)[0];let E,j;if(this.isRaster){const k=function(L,z){const G=i.aY(L,z),Z=Math.pow(2,L.z);for(let _e=0;_e<Qc;_e++)for(let ye=0;ye<Qc;ye++){const Ee=i.aZ((L.x+(ye+l_(ye))/yl)/Z),Ne=i.a_((L.y+(_e+l_(_e))/yl)/Z),je=z.project(Ee,Ne),qe=_e*Qc+ye;Vl[2*qe+0]=Math.round((je.x*G.scale-G.x)*i.al),Vl[2*qe+1]=Math.round((je.y*G.scale-G.y)*i.al)}nd.fill(0),af.fill(0);for(let _e=2045;_e>=0;_e--){const ye=4*_e,Ee=sl[ye+0],Ne=sl[ye+1],je=sl[ye+2],qe=sl[ye+3],Ie=Ee+je>>1,Ge=Ne+qe>>1,Ue=Ie+Ge-Ne,De=Ge+Ee-Ie,Ze=Ne*Qc+Ee,ut=qe*Qc+je,ot=Ge*Qc+Ie,St=Math.hypot((Vl[2*Ze+0]+Vl[2*ut+0])/2-Vl[2*ot+0],(Vl[2*Ze+1]+Vl[2*ut+1])/2-Vl[2*ot+1])>=16;nd[ot]=nd[ot]||(St?1:0),_e<1022&&(nd[ot]=nd[ot]||nd[(Ne+De>>1)*Qc+(Ee+Ue>>1)]||nd[(qe+De>>1)*Qc+(je+Ue>>1)])}const Q=new i.a$,X=new i.b0;let se=0;function le(_e,ye){const Ee=ye*Qc+_e;return af[Ee]===0&&(Q.emplaceBack(Vl[2*Ee+0],Vl[2*Ee+1],_e*i.al/yl,ye*i.al/yl),af[Ee]=++se),af[Ee]-1}function ue(_e,ye,Ee,Ne,je,qe){const Ie=_e+Ee>>1,Ge=ye+Ne>>1;if(Math.abs(_e-je)+Math.abs(ye-qe)>1&&nd[Ge*Qc+Ie])ue(je,qe,_e,ye,Ie,Ge),ue(Ee,Ne,je,qe,Ie,Ge);else{const Ue=le(_e,ye),De=le(Ee,Ne),Ze=le(je,qe);X.emplaceBack(Ue,De,Ze)}}return ue(0,0,yl,yl,yl,0),ue(yl,yl,0,0,0,yl),{vertices:Q,indices:X}}(this.tileID.canonical,f);E=k.vertices,j=k.indices}else{E=new i.a$,j=new i.b0;for(const{x:L,y:z}of _)E.emplaceBack(L,z,0,0);const k=i.bg(E.int16.subarray(0,4*E.length),void 0,4);for(let L=0;L<k.length;L+=3)j.emplaceBack(k[L],k[L+1],k[L+2])}this._tileBoundsBuffer=l.createVertexBuffer(E,i.bh.members),this._tileBoundsIndexBuffer=l.createIndexBuffer(j),this._tileBoundsSegments=i.bf.simpleSegment(0,0,E.length,j.length)}_makeGlobeTileDebugBuffers(l,f){const _=f.projection;if(!_||_.name!=="globe"||f.freezeTileCoverage)return;const E=this.tileID.canonical,j=i.bi(E,f),k=i.bj(j),L=i.aj(f.zoom);let z;L>0&&(z=i.bk(new Float64Array(16),f.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(l,E,f,k,z,L),this._makeGlobeTileDebugTextBuffer(l,E,f,k,z,L)}_globePoint(l,f,_,E,j,k,L){let z=i.bl(l,f,_);if(k){const G=1<<_.z,Z=i.aF(E.center.lng),Q=i.aJ(E.center.lat),X=(_.x+.5)/G-Z;let se=0;X>.5?se=-1:X<-.5&&(se=1);let le=(l/i.al+_.x)/G+se,ue=(f/i.al+_.y)/G;le=(le-Z)*E._pixelsPerMercatorPixel+Z,ue=(ue-Q)*E._pixelsPerMercatorPixel+Q;const _e=[le*E.worldSize,ue*E.worldSize,0];i.af(_e,_e,k),z=i.bm(z,_e,L)}return i.af(z,z,j)}_makeGlobeTileDebugBorderBuffer(l,f,_,E,j,k){const L=new i.bc,z=new i.bd,G=new i.bn,Z=(X,se,le,ue,_e)=>{const ye=(le-X)/(_e-1),Ee=(ue-se)/(_e-1),Ne=L.length;for(let je=0;je<_e;je++){const qe=X+je*ye,Ie=se+je*Ee;L.emplaceBack(qe,Ie);const Ge=this._globePoint(qe,Ie,f,_,E,j,k);G.emplaceBack(Ge[0],Ge[1],Ge[2]),z.emplaceBack(Ne+je)}},Q=i.al;Z(0,0,Q,0,16),Z(Q,0,Q,Q,16),Z(Q,Q,0,Q,16),Z(0,Q,0,0,16),this._tileDebugIndexBuffer=l.createIndexBuffer(z),this._tileDebugBuffer=l.createVertexBuffer(L,i.be.members),this._globeTileDebugBorderBuffer=l.createVertexBuffer(G,i.bo.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,L.length,z.length)}_makeGlobeTileDebugTextBuffer(l,f,_,E,j,k){const L=i.al/4,z=new i.bc,G=new i.b0,Z=new i.bn,Q=25;G.reserve(32),z.reserve(Q),Z.reserve(Q);const X=(se,le)=>Q*se+le;for(let se=0;se<Q;se++){const le=se*L;for(let ue=0;ue<Q;ue++){const _e=ue*L;z.emplaceBack(_e,le);const ye=this._globePoint(_e,le,f,_,E,j,k);Z.emplaceBack(ye[0],ye[1],ye[2])}}for(let se=0;se<4;se++)for(let le=0;le<4;le++){const ue=X(se,le),_e=X(se,le+1),ye=X(se+1,le),Ee=X(se+1,le+1);G.emplaceBack(ue,_e,ye),G.emplaceBack(ye,_e,Ee)}this._tileDebugTextIndexBuffer=l.createIndexBuffer(G),this._tileDebugTextBuffer=l.createVertexBuffer(z,i.be.members),this._globeTileDebugTextBuffer=l.createVertexBuffer(Z,i.bo.members),this._tileDebugTextSegments=i.bf.simpleSegment(0,0,Q,32)}destroy(l=!1){for(const f in this.buckets)this.buckets[f].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!l&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.br.setPbf(i.bs);class Yd extends Au{constructor(l,f,_,E,j){super(l,f,_,E,j),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(l){return this._mrt&&this._mrt.getLayer(l)}setTexturePerLayer(l,f,_){const E=_.context,j=E.gl;let k=this.texturePerLayer.get(l)||_.getTileTexture(f.width);k&&k instanceof i.T?k.update(f,{premultiply:!1}):k=new i.T(E,f,j.RGBA8,{premultiply:!1}),this.texturePerLayer.has(l)||this.texturePerLayer.set(l,k)}flushQueues(l){const f=this._workQueuePerLayer.get(l)||[],_=this._fetchQueuePerLayer.get(l)||[];for(;f.length;)f.pop()();for(;_.length;)_.pop()()}flushAllQueues(){for(const l of this._workQueuePerLayer.keys()){const f=this._workQueuePerLayer.get(l)||[];for(;f.length;)f.pop()()}for(const l of this._fetchQueuePerLayer.keys()){const f=this._fetchQueuePerLayer.get(l)||[];for(;f.length;)f.pop()()}}fetchHeader(l=16384,f){const _=this._mrt=new i.br(30),E=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(l-1)}});return this.entireBuffer=null,this.request=i.bt(E,(j,k,L)=>{if(j)f(j);else try{const z=_.getHeaderLength(k);if(z>l)return void(this.request=this.fetchHeader(z,f));_.parseHeader(k),this._isHeaderLoaded=!0;let G=0;for(const Z of Object.values(_.layers))G=Math.max(G,Z.dataIndex[Z.dataIndex.length-1].lastByte);k.byteLength>=G&&(this.entireBuffer=k),f(null,this.entireBuffer||k,L)}catch(z){f(z)}}),this.request}fetchBandForRender(l,f,_,E){this.fetchBand(l,f,_,j=>{if(j)return void E(j);this.updateTextureDescriptor(l,f,_);const k=this.textureDescriptorPerLayer.get(f);E(null,k?k.img:null)})}fetchBand(l,f,_,E,j=!0){const k=this._mrt;if(!this._isHeaderLoaded||!k)return void E(new Error("Tile header is not ready"));const L=this.actor;if(!L)return void E(new Error("Can't fetch tile band without an actor"));let z;const G=i.B(String(_),i.B(this.tileID.key,l));let Z=this._taskQueue.get(G);Z?Z.add(E):(Z=new Set,Z.add(E),this._taskQueue.set(G,Z));const Q=(ue,_e)=>{z.complete(ue,_e),ue?E(ue):(Z.values().forEach(ye=>ye(null,_e)),this._taskQueue.delete(G))},X=(ue,_e)=>{if(ue)return E(ue);const ye=L.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:_e,task:z},Q,void 0,!0);if(f!==null){const Ee=this._workQueuePerLayer.get(f)||[];Ee.push(()=>{ye&&ye.cancel(),z.cancel()}),this._workQueuePerLayer.has(f)||this._workQueuePerLayer.set(f,Ee)}};let se;try{se=k.getLayer(l)}catch(ue){if(this.state==="reloading")return;throw ue}if(!se)return void E(new Error(`Unknown sourceLayer "${l}"`));if(se.hasDataForBand(_))return Z.values().forEach(ue=>ue(null,null)),void this._taskQueue.delete(G);const le=se.getDataRange([_]);if(z=k.createDecodingTask(le),!z||z.tasks.length)if(f!==null&&this.flushQueues(f),this.entireBuffer)X(null,this.entireBuffer.slice(le.firstByte,le.lastByte+1));else{const ue=Object.assign({},this.requestParams,{headers:{Range:`bytes=${le.firstByte}-${le.lastByte}`}}),_e=i.bt(ue,X);if(f!==null){const ye=this._fetchQueuePerLayer.get(f)||[];ye.push(()=>{_e.cancel(),z.cancel()}),this._fetchQueuePerLayer.has(f)||this._fetchQueuePerLayer.set(f,ye)}}}updateNeeded(l,f){return(!this.textureDescriptorPerLayer.get(l)||this.textureDescriptorPerLayer.get(l).band!==f||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(l,f,_){if(!this._mrt)return;const E=this._mrt.getLayer(l);if(!E||!E.hasBand(_)||!E.hasDataForBand(_))return;const{bytes:j,tileSize:k,buffer:L,offset:z,scale:G}=E.getBandView(_),Z=k+2*L,Q=new i.q({width:Z,height:Z},j),X=this.texturePerLayer.get(f);X&&X instanceof i.T&&X.update(Q,{premultiply:!1}),this.textureDescriptorPerLayer.set(f,{layer:l,band:_,img:Q,buffer:L,offset:z,tileSize:k,format:E.pixelFormat,mix:[G,256*G,65536*G,16777216*G]})}destroy(l=!1){if(super.destroy(l),delete this._mrt,!l)for(const f of this.texturePerLayer.values())f&&f instanceof i.T&&f.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Pw{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,_){const E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);const j={value:f,timeout:void 0};if(_!==void 0&&(j.timeout=setTimeout(()=>{this.remove(l,j)},_)),this.data[E].push(j),this.order.push(E),this.order.length>this.max){const k=this._getAndRemoveByKey(this.order[0]);k&&this.onRemove(k)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const _=l.wrapped().key,E=f===void 0?0:this.data[_].indexOf(f),j=this.data[_][E];return this.data[_].splice(E,1),j.timeout&&clearTimeout(j.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(j.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const _ in this.data)for(const E of this.data[_])l(E.value)||f.push(E);for(const _ of f)this.remove(_.value.tileID,_)}}class Q2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,_){const E=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][E]=this.stateChanges[l][E]||{},Object.assign(this.stateChanges[l][E],_),this.deletedStates[l]===null){this.deletedStates[l]={};for(const j in this.state[l])j!==E&&(this.deletedStates[l][j]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][E]===null){this.deletedStates[l][E]={};for(const j in this.state[l][E])_[j]||(this.deletedStates[l][E][j]=null)}else for(const j in _)this.deletedStates[l]&&this.deletedStates[l][E]&&this.deletedStates[l][E][j]===null&&delete this.deletedStates[l][E][j]}removeFeatureState(l,f,_){if(this.deletedStates[l]===null)return;const E=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},_&&f!==void 0)this.deletedStates[l][E]!==null&&(this.deletedStates[l][E]=this.deletedStates[l][E]||{},this.deletedStates[l][E][_]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][E])for(_ in this.deletedStates[l][E]={},this.stateChanges[l][E])this.deletedStates[l][E][_]=null;else this.deletedStates[l][E]=null;else this.deletedStates[l]=null}getState(l,f){const _=this.state[l]||{},E=this.stateChanges[l]||{},j=this.deletedStates[l];if(j===null)return{};if(f!==void 0){const L=String(f),z=Object.assign({},_[L],E[L]);if(j){const G=j[f];if(G===null)return{};for(const Z in G)delete z[Z]}return z}const k=Object.assign({},_,E);if(j)for(const L in j)delete k[L];return k}initializeTileState(l,f){l.refreshFeatureState(f)}coalesceChanges(l,f){const _={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const j={};for(const k in this.stateChanges[E])this.state[E][k]||(this.state[E][k]={}),Object.assign(this.state[E][k],this.stateChanges[E][k]),j[k]=this.state[E][k];_[E]=j}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const j={};if(this.deletedStates[E]===null)for(const k in this.state[E])j[k]={},this.state[E][k]={};else for(const k in this.deletedStates[E]){if(this.deletedStates[E][k]===null)this.state[E][k]={};else if(this.state[E][k])for(const L of Object.keys(this.deletedStates[E][k]))delete this.state[E][k][L];j[k]=this.state[E][k]}_[E]=_[E]||{},Object.assign(_[E],j)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const E in l)l[E].refreshFeatureState(f)}}class Sc extends i.E{constructor(l,f,_){super(),this.id=l,this._onlySymbols=_,f.on("data",E=>{E.dataType==="source"&&E.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),f.on("error",()=>{this._sourceErrored=!0}),this._source=f,this._tiles={},this._cache=new Pw(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Q2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(l){this.map=l,this._minTileCacheSize=this._minTileCacheSize===void 0&&l?l._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&l?l._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles)if(!this._tiles[l].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(l,f){return l.isSymbolTile=this._onlySymbols,l.isExtraShadowCaster=this._shadowCasterTiles[l.tileID.key],this._source.loadTile(l,f)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l)}_abortTile(l){if(this._source.abortTile)return this._source.abortTile(l)}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const _=this._tiles[f];_.upload(l,this.map?this.map.painter:void 0),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Ow).map(l=>l.key)}getRenderableIds(l,f){const _=[];for(const E in this._tiles)this._isIdRenderable(+E,l,f)&&_.push(this._tiles[E]);return l?_.sort((E,j)=>{const k=E.tileID,L=j.tileID,z=new i.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),G=new i.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-L.overscaledZ||G.y-z.y||G.x-z.x}).map(E=>E.tileID.key):_.map(E=>E.tileID).sort(Ow).map(E=>E.key)}hasRenderableParent(l){const f=this.findLoadedParent(l,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(l,f,_){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(f||!this._tiles[l].holdingForFade())&&(_||!this._shadowCasterTiles[l])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(+l,"reloading")}}_reloadTile(l,f){const _=this._tiles[l];_&&(_.state!=="loading"&&(_.state=f),this._loadTile(_,this._tileLoaded.bind(this,_,l,f)))}_tileLoaded(l,f,_,E,j){if(E){if(l.state="errored",E.status!==404)this._source.fire(new i.y(E,{tile:l}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:l})),!(l.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const L=this.map.painter.terrain;this.update(this.transform,L.getScaledDemTileSize(),!0),L.resetTileLookupCache(this.id)}else this.update(this.transform)}return}l.timeAdded=i.o.now(),_==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this._source.type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null);let k=new Map;j&&j.responseHeaders&&(k=j.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:l,coord:l.tileID,sourceCacheId:this.id,responseHeaders:k}))}_backfillDEM(l){const f=this.getRenderableIds();for(let E=0;E<f.length;E++){const j=f[E];if(l.neighboringTiles&&l.neighboringTiles[j]){const k=this.getTileByID(j);_(l,k),_(k,l)}}function _(E,j){if(!E.dem||E.dem.borderReady)return;E.needsHillshadePrepare=!0,E.needsDEMTextureUpload=!0;let k=j.tileID.canonical.x-E.tileID.canonical.x;const L=j.tileID.canonical.y-E.tileID.canonical.y,z=Math.pow(2,E.tileID.canonical.z),G=j.tileID.key;k===0&&L===0||Math.abs(L)>1||(Math.abs(k)>1&&(Math.abs(k+z)===1?k+=z:Math.abs(k-z)===1&&(k-=z)),j.dem&&E.dem&&(E.dem.backfillBorder(j.dem,k,L),E.neighboringTiles&&E.neighboringTiles[G]&&(E.neighboringTiles[G].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f,_,E){for(const j in this._tiles){let k=this._tiles[j];if(E[j]||!k.hasData()||k.tileID.overscaledZ<=f||k.tileID.overscaledZ>_)continue;let L=k.tileID;for(;k&&k.tileID.overscaledZ>f+1;){const G=k.tileID.scaledTo(k.tileID.overscaledZ-1);k=this._tiles[G.key],k&&k.hasData()&&(L=G)}let z=L;for(;z.overscaledZ>f;)if(z=z.scaledTo(z.overscaledZ-1),l[z.key]){E[L.key]=L;break}}}findLoadedParent(l,f){if(l.key in this._loadedParentTiles){const _=this._loadedParentTiles[l.key];return _&&_.tileID.overscaledZ>=f?_:null}for(let _=l.overscaledZ-1;_>=f;_--){const E=l.scaledTo(_),j=this._getLoadedTile(E);if(j)return j}}_getLoadedTile(l){const f=this._tiles[l.key];return f&&f.hasData()?f:this._cache.getByKey(this._source.reparseOverscaled?l.wrapped().key:l.canonical.key)}updateCacheSize(l,f){f=f||this._source.tileSize;const _=Math.ceil(l.width/f)+1,E=Math.ceil(l.height/f)+1,j=Math.floor(_*E*5),k=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,j):j,L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(L)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const _={};for(const E in this._tiles){const j=this._tiles[E];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+f),_[j.tileID.key]=j}this._tiles=_;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(+E,this._tiles[E])}}update(l,f,_,E,j){if(this.transform=l,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(l,f),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const k=this._source.type==="batched-model";let L,z=this._source.maxzoom;const G=this.map&&this.map.painter?this.map.painter._terrain:null;if(G&&G.sourceCache===this&&G.attenuationRange()){const X=G.attenuationRange()[0],se=Math.floor(X)-Math.log2(G.getDemUpscale());z>se&&(z=se)}if(this.used||this.usedForTerrain){if(this._source.tileID)L=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(X=>new i.aP(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y));else if(this.tileCoverLift!==0){const X=l.clone();X.tileCoverLift=this.tileCoverLift,L=X.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:k}),this._source.minzoom<=1&&l.projection.name==="globe"&&(L.push(new i.aP(1,0,1,0,0)),L.push(new i.aP(1,0,1,1,0)),L.push(new i.aP(1,0,1,0,1)),L.push(new i.aP(1,0,1,1,1)))}else if(L=l.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:k}),this._source.hasTile){const X=this._source.hasTile.bind(this._source);L=L.filter(se=>X(se))}}else L=[];if(L.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!of(this._source.type)){const X=l.coveringZoomLevel({tileSize:f||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),se=Math.min(X,this._source.maxzoom);if(k){const le=l.extendTileCover(L,se);for(const ue of le)L.push(ue)}else if(j){const le=l.extendTileCoverToNearPlane(L,this.transform.getFrustum(se),se);for(const ue of le)L.push(ue)}else if(this.castsShadows&&E){const le=l.extendTileCover(L,se,E);for(const ue of le)this._shadowCasterTiles[ue.key]=!0,L.push(ue)}}const Z=this._updateRetainedTiles(L);if(of(this._source.type)&&L.length!==0){const X={},se={},le=Object.keys(Z);for(const _e of le){const ye=Z[_e],Ee=this._tiles[_e];if(!Ee||Ee.fadeEndTime&&Ee.fadeEndTime<=i.o.now())continue;const Ne=this.findLoadedParent(ye,Math.max(ye.overscaledZ-Sc.maxOverzooming,this._source.minzoom));Ne&&(this._addTile(Ne.tileID),X[Ne.tileID.key]=Ne.tileID),se[_e]=ye}const ue=L[L.length-1].overscaledZ;for(const _e in this._tiles){const ye=this._tiles[_e];if(Z[_e]||!ye.hasData())continue;let Ee=ye.tileID;for(;Ee.overscaledZ>ue;){Ee=Ee.scaledTo(Ee.overscaledZ-1);const Ne=this._tiles[Ee.key];if(Ne&&Ne.hasData()&&se[Ee.key]){Z[_e]=ye.tileID;break}}}for(const _e in X)Z[_e]||(this._coveredTiles[_e]=!0,Z[_e]=X[_e])}for(const X in Z)this._tiles[X].clearFadeHold();const Q=i.bu(this._tiles,Z);for(const X of Q){const se=this._tiles[X];se.hasSymbolBuckets&&!se.holdingForFade()?se.setHoldDuration(this.map._fadeDuration):se.hasSymbolBuckets&&!se.symbolFadeFinished()||this._removeTile(+X)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(+l)}_updateRetainedTiles(l){const f={};if(l.length===0)return f;const _={},E=l.reduce((G,Z)=>Math.min(G,Z.overscaledZ),1/0),j=l[0].overscaledZ,k=Math.max(j-Sc.maxOverzooming,this._source.minzoom),L=Math.max(j+Sc.maxUnderzooming,this._source.minzoom),z={};for(const G of l){const Z=this._addTile(G);f[G.key]=G,Z.hasData()||E<this._source.maxzoom&&(z[G.key]=G)}this._retainLoadedChildren(z,E,L,f);for(const G of l){let Z=this._tiles[G.key];if(Z.hasData())continue;if(G.canonical.z>=this._source.maxzoom){const X=G.children(this._source.maxzoom)[0],se=this.getTile(X);if(se&&se.hasData()){f[X.key]=X;continue}}else{const X=G.children(this._source.maxzoom);if(f[X[0].key]&&f[X[1].key]&&f[X[2].key]&&f[X[3].key])continue}let Q=Z.wasRequested();for(let X=G.overscaledZ-1;X>=k;--X){const se=G.scaledTo(X);if(_[se.key]||(_[se.key]=!0,Z=this.getTile(se),!Z&&Q&&(Z=this._addTile(se)),Z&&(f[se.key]=se,Q=Z.wasRequested(),Z.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const f=[];let _,E=this._tiles[l].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){_=this._loadedParentTiles[E.key];break}f.push(E.key);const j=E.scaledTo(E.overscaledZ-1);if(_=this._getLoadedTile(j),_)break;E=j}for(const j of f)this._loadedParentTiles[j]=_}}_addTile(l){let f=this._tiles[l.key];if(f)return f.isExtraShadowCaster!==!0||this._shadowCasterTiles[l.key]||this._reloadTile(l.key,"reloading"),f;f=this._cache.getAndRemove(l),f&&(this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,f)));const _=!!f;if(!_){const E=this.map?this.map.painter:null,j=this._source.tileSize*l.overscaleFactor();f=this._source.type==="raster-array"?new Yd(l,j,this.transform.tileZoom,E,this._isRaster):new Au(l,j,this.transform.tileZoom,E,this._isRaster,this._source.worldview),this._loadTile(f,this._tileLoaded.bind(this,f,l.key,f.state))}return f.uses++,this._tiles[l.key]=f,_||this._source.fire(new i.z("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const _=f.getExpiryTimeout();_&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},_))}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),f.uses>0||(f.hasData()&&f.state!=="reloading"||f.state==="empty"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(+l);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(l,f,_){const E=[],j=this.transform;if(!j)return E;const k=j.projection.name==="globe",L=i.aF(j.center.lng);for(const z in this._tiles){const G=this._tiles[z];if(_&&G.clearQueryDebugViz(),G.holdingForFade())continue;let Z;if(k){const Q=G.tileID.canonical;if(Q.z===0){const X=[Math.abs(i.aA(L,...lf(Q,-1))-L),Math.abs(i.aA(L,...lf(Q,1))-L)];Z=[0,2*X.indexOf(Math.min(...X))-1]}else{const X=[Math.abs(i.aA(L,...lf(Q,-1))-L),Math.abs(i.aA(L,...lf(Q,0))-L),Math.abs(i.aA(L,...lf(Q,1))-L)];Z=[X.indexOf(Math.min(...X))-1]}}else Z=[0];for(const Q of Z){const X=l.containsTile(G,j,f,Q);X&&E.push(X)}}return E}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(l){return this._getRenderableCoordinates(l)}_getRenderableCoordinates(l,f){const _=this.getRenderableIds(l,f).map(j=>this._tiles[j].tileID),E=this.transform.projection.name==="globe";for(const j of _)j.projMatrix=this.transform.calculateProjMatrix(j.toUnwrapped()),j.expandedProjMatrix=E?this.transform.calculateProjMatrix(j.toUnwrapped(),!1,!0):j.projMatrix;return _}sortCoordinatesByDistance(l){const f=l.slice(),_=this.transform._camera.position,E=this.transform._camera.forward(),j={};for(const k of f){const L=1/(1<<k.canonical.z);j[k.key]=((k.canonical.x+.5)*L+k.wrap-_[0])*E[0]+((k.canonical.y+.5)*L-_[1])*E[1]-_[2]*E[2]}return f.sort((k,L)=>j[k.key]-j[L.key]),f}hasTransition(){if(this._source.hasTransition())return!0;if(of(this._source.type))for(const l in this._tiles){const f=this._tiles[l];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(l,f,_){this._state.updateState(l=l||"_geojsonTileLayer",f,_)}removeFeatureState(l,f,_){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,_)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,_){const E=this._tiles[l];E&&E.setDependencies(f,_)}reloadTilesForDependencies(l,f){for(const _ in this._tiles)this._tiles[_].hasDependency(l,f)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(l,f))}_preloadTiles(l,f){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(l,f))};return void this._source.on("data",z)}const _=new Map,E=Array.isArray(l)?l:[l],j=this.map.painter.terrain,k=this.usedForTerrain&&j?j.getScaledDemTileSize():this._source.tileSize;for(const z of E){const G=z.coveringTiles({tileSize:k,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Z of G)_.set(Z.key,Z);this.usedForTerrain&&z.updateElevation(!1)}const L=Array.from(_.values());i.bv(L,(z,G)=>{const Z=new Au(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(Z,Q=>{this._source.type==="raster-dem"&&Z.dem&&this._backfillDEM(Z),G(Q,Z)})},f)}}function Ow(v,l){const f=Math.abs(2*v.wrap)-+(v.wrap<0),_=Math.abs(2*l.wrap)-+(l.wrap<0);return v.overscaledZ-l.overscaledZ||_-f||l.canonical.y-v.canonical.y||l.canonical.x-v.canonical.x}function of(v){return v==="raster"||v==="image"||v==="video"||v==="custom"}function lf(v,l){const f=1<<v.z;return[v.x/f+l,(v.x+1)/f+l]}Sc.maxOverzooming=10,Sc.maxUnderzooming=3;class kw{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,f=!1;for(const _ in this.style._mergedLayers){const E=this.style._mergedLayers[_];if(E.type==="fill-extrusion"||E.type==="building")this.layers.push({layer:E,visible:l,visibilityChanged:f});else if(E.type==="model"){const j=this.style.getLayerSource(E);j&&j.type==="batched-model"&&this.layers.push({layer:E,visible:l,visibilityChanged:f})}}}onNewFrame(l){this.layersGotHidden=!1;for(const f of this.layers){const _=f.layer;let E=!1;_.type==="fill-extrusion"?E=!_.isHidden(l)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="building"?E=!_.isHidden(l)&&_.paint.get("building-opacity")>0:_.type==="model"&&(E=!_.isHidden(l)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!E&&f.visible,f.visible=E}}updateZOffset(l,f){this.currentBuildingBuckets=[];for(const E of this.layers){const j=E.layer,k=this.style.getLayerSourceCache(j);let L=1;j.type==="fill-extrusion"?L=E.visible?j.paint.get("fill-extrusion-vertical-scale"):0:j.type==="building"&&(L=E.visible?j.paint.get("building-vertical-scale"):0);let z=k?k.getTile(f):null;if(!z&&k)for(const G in k._tiles){const Z=k._tiles[G];if(f.canonical.isChildOf(Z.tileID.canonical)){z=Z;break}}this.currentBuildingBuckets.push({bucket:z?z.getBucket(j):null,tileID:z?z.tileID:f,verticalScale:L})}l.hasAnyZOffset=!1;let _=!1;for(let E=0;E<l.symbolInstances.length;E++){const j=l.symbolInstances.get(E),k=j.zOffset,L=this._getHeightAtTileOffset(f,j.tileAnchorX,j.tileAnchorY);j.zOffset=L!==Number.NEGATIVE_INFINITY?L:k,_||k===j.zOffset||(_=!0),l.hasAnyZOffset||j.zOffset===0||(l.hasAnyZOffset=!0)}_&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,f,_,E){let j=f,k=_;if(l.canonical.z!==E.canonical.z){const L=E.canonical,z=1/(1<<l.canonical.z-L.z);j=(f+l.canonical.x*i.al)*z-L.x*i.al|0,k=(_+l.canonical.y*i.al)*z-L.y*i.al|0}return{tileX:j,tileY:k}}_getHeightAtTileOffset(l,f,_){let E,j;for(let k=0;k<this.layers.length;++k){const L=this.layers[k].layer;if(L.type!=="fill-extrusion"&&L.type!=="building")continue;const{bucket:z,tileID:G,verticalScale:Z}=this.currentBuildingBuckets[k];if(!z)continue;const{tileX:Q,tileY:X}=this._mapCoordToOverlappingTile(l,f,_,G),se=z.getHeightAtTileCoord(Q,X);se&&se.height!==void 0&&(se.hidden?E=se.height:j=Math.max(se.height*Z,j||0))}if(j!==void 0)return j;for(let k=0;k<this.layers.length;++k){const L=this.layers[k];if(L.layer.type!=="model"||!L.visible)continue;const{bucket:z,tileID:G}=this.currentBuildingBuckets[k];if(!z)continue;const{tileX:Z,tileY:Q}=this._mapCoordToOverlappingTile(l,f,_,G),X=z.getHeightAtTileCoord(Z,Q);if(X&&!X.hidden)return X.height===void 0&&E!==void 0?Math.min(X.maxHeight,E)*X.verticalScale:X.height?X.height*X.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Lg(v,l){const f={};for(const _ in v)_!=="ref"&&(f[_]=v[_]);return i.bw.forEach(_=>{_ in l&&(f[_]=l[_])}),f}function bp(v){v=v.slice();const l=Object.create(null);for(let f=0;f<v.length;f++)l[v[f].id]=v[f];for(let f=0;f<v.length;f++)"ref"in v[f]&&(v[f]=Lg(v[f],l[v[f].ref]));return v}const si={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Nw(v,l,f){f.push({command:si.addSource,args:[v,l[v]]})}function Fg(v,l,f){l.push({command:si.removeSource,args:[v]}),f[v]=!0}function zg(v,l,f,_){Fg(v,f,_),Nw(v,l,f)}function Iw(v,l,f){let _;for(_ in v[f])if(v[f].hasOwnProperty(_)&&_!=="data"&&!i.bx(v[f][_],l[f][_]))return!1;for(_ in l[f])if(l[f].hasOwnProperty(_)&&_!=="data"&&!i.bx(v[f][_],l[f][_]))return!1;return!0}function Bg(v,l,f,_,E,j){let k;for(k in l=l||{},v=v||{})v.hasOwnProperty(k)&&(i.bx(v[k],l[k])||f.push({command:j,args:[_,k,l[k],E]}));for(k in l)l.hasOwnProperty(k)&&!v.hasOwnProperty(k)&&(i.bx(v[k],l[k])||f.push({command:j,args:[_,k,l[k],E]}))}function $g(v){return v.id}function Ug(v,l){return v[l.id]=l,v}function cf(v,l,f){const _=l.createTileMatrix(v,v.worldSize,f.toUnwrapped());return i.aB(new Float32Array(16),v.projMatrix,_)}function eA(v,l,f){if(l.projection.name===f.projection.name)return v.projMatrix;const _=f.clone();return _.setProjection(l.projection),cf(_,l.getProjection(),v)}function u_(v,l,f){return l.name===f.projection.name?v.projMatrix:cf(f,l,v)}class GI{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=i.aA(l,0,1);let f=1,_=this._distances[f];const E=l*this.paddedLength+this.padding;for(;_<E&&f<this._distances.length;)_=this._distances[++f];const j=f-1,k=this._distances[j],L=_-k,z=L>0?(E-k)/L:0;return this.points[j].mult(1-z).add(this.points[f].mult(z))}}class Vg{constructor(l,f,_){const E=this.boxCells=[],j=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(f/_);for(let k=0;k<this.xCellCount*this.yCellCount;k++)E.push([]),j.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,_,E,j){this._forEachCell(f,_,E,j,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(E),this.bboxes.push(j)}insertCircle(l,f,_,E){this._forEachCell(f-E,_-E,f+E,_+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(_),this.circles.push(E)}_insertBoxCell(l,f,_,E,j,k){this.boxCells[j].push(k)}_insertCircleCell(l,f,_,E,j,k){this.circleCells[j].push(k)}_query(l,f,_,E,j,k){if(_<0||l>this.width||E<0||f>this.height)return!j&&[];const L=[];if(l<=0&&f<=0&&this.width<=_&&this.height<=E){if(j)return!0;for(let z=0;z<this.boxKeys.length;z++)L.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const G=this.circles[3*z],Z=this.circles[3*z+1],Q=this.circles[3*z+2];L.push({key:this.circleKeys[z],x1:G-Q,y1:Z-Q,x2:G+Q,y2:Z+Q})}return k?L.filter(k):L}return this._forEachCell(l,f,_,E,this._queryCell,L,{hitTest:j,seenUids:{box:{},circle:{}}},k),j?L.length>0:L}_queryCircle(l,f,_,E,j){const k=l-_,L=l+_,z=f-_,G=f+_;if(L<0||k>this.width||G<0||z>this.height)return!E&&[];const Z=[];return this._forEachCell(k,z,L,G,this._queryCellCircle,Z,{hitTest:E,circle:{x:l,y:f,radius:_},seenUids:{box:{},circle:{}}},j),E?Z.length>0:Z}query(l,f,_,E,j){return this._query(l,f,_,E,!1,j)}hitTest(l,f,_,E,j){return this._query(l,f,_,E,!0,j)}hitTestCircle(l,f,_,E){return this._queryCircle(l,f,_,!0,E)}_queryCell(l,f,_,E,j,k,L,z){const G=L.seenUids,Z=this.boxCells[j];if(Z!==null){const X=this.bboxes;for(const se of Z)if(!G.box[se]){G.box[se]=!0;const le=4*se;if(l<=X[le+2]&&f<=X[le+3]&&_>=X[le+0]&&E>=X[le+1]&&(!z||z(this.boxKeys[se]))){if(L.hitTest)return k.push(!0),!0;k.push({key:this.boxKeys[se],x1:X[le],y1:X[le+1],x2:X[le+2],y2:X[le+3]})}}}const Q=this.circleCells[j];if(Q!==null){const X=this.circles;for(const se of Q)if(!G.circle[se]){G.circle[se]=!0;const le=3*se;if(this._circleAndRectCollide(X[le],X[le+1],X[le+2],l,f,_,E)&&(!z||z(this.circleKeys[se]))){if(L.hitTest)return k.push(!0),!0;{const ue=X[le],_e=X[le+1],ye=X[le+2];k.push({key:this.circleKeys[se],x1:ue-ye,y1:_e-ye,x2:ue+ye,y2:_e+ye})}}}}}_queryCellCircle(l,f,_,E,j,k,L,z){const G=L.circle,Z=L.seenUids,Q=this.boxCells[j];if(Q!==null){const se=this.bboxes;for(const le of Q)if(!Z.box[le]){Z.box[le]=!0;const ue=4*le;if(this._circleAndRectCollide(G.x,G.y,G.radius,se[ue+0],se[ue+1],se[ue+2],se[ue+3])&&(!z||z(this.boxKeys[le])))return k.push(!0),!0}}const X=this.circleCells[j];if(X!==null){const se=this.circles;for(const le of X)if(!Z.circle[le]){Z.circle[le]=!0;const ue=3*le;if(this._circlesCollide(se[ue],se[ue+1],se[ue+2],G.x,G.y,G.radius)&&(!z||z(this.circleKeys[le])))return k.push(!0),!0}}}_forEachCell(l,f,_,E,j,k,L,z){const G=this._convertToXCellCoord(l),Z=this._convertToYCellCoord(f),Q=this._convertToXCellCoord(_),X=this._convertToYCellCoord(E);for(let se=G;se<=Q;se++)for(let le=Z;le<=X;le++)if(j.call(this,l,f,_,E,this.xCellCount*le+se,k,L,z))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,_,E,j,k){const L=E-l,z=j-f,G=_+k;return G*G>L*L+z*z}_circleAndRectCollide(l,f,_,E,j,k,L){const z=(k-E)/2,G=Math.abs(l-(E+z));if(G>z+_)return!1;const Z=(L-j)/2,Q=Math.abs(f-(j+Z));if(Q>Z+_)return!1;if(G<=z||Q<=Z)return!0;const X=G-z,se=Q-Z;return X*X+se*se<=_*_}}const ql={unknown:0,flipRequired:1,flipNotRequired:2},qg=Math.tan(85*Math.PI/180);function wp(v,l,f,_,E,j,k){const L=i.bB();if(f)if(j.name==="globe"){const z=i.bC(E,l);i.aB(L,L,z)}else{const z=i.bD([],k);L[0]=z[0],L[1]=z[1],L[4]=z[2],L[5]=z[3],_||i.bA(L,L,E.angle)}else i.aB(L,E.labelPlaneMatrix,v);return L}function Hg(v,l,f,_,E,j,k){const L=wp(v,l,f,_,E,j,k);return j.name==="globe"&&f||(L[2]=L[6]=L[10]=L[14]=0),L}function id(v,l,f,_,E,j,k){if(f){if(j.name==="globe"){const L=wp(v,l,f,_,E,j,k);return i.bk(L,L),i.aB(L,v,L),L}{const L=i.by(v),z=i.bz([]);return z[0]=k[0],z[1]=k[1],z[4]=k[2],z[5]=k[3],i.aB(L,L,z),_||i.bA(L,L,-E.angle),L}}return E.glCoordMatrix}function ca(v,l,f,_){const E=[v,l,f,1];f?i.aC(E,E,_):Ec(E,E,_);const j=E[3];return E[0]/=j,E[1]/=j,E[2]/=j,E}function Rw(v,l){return Math.min(.5+v/l*.5,1.5)}function Mw(v,l){const f=v[0]/v[3],_=v[1]/v[3];return f>=-l[0]&&f<=l[0]&&_>=-l[1]&&_<=l[1]}function Dw(v,l,f,_,E,j,k,L,z,G,Z=1){const Q=f.transform,X=_?v.textSizeData:v.iconSizeData,se=i.bJ(X,f.transform.zoom,Z),le=Q.projection.name==="globe",ue=[256/f.width*2+1,256/f.height*2+1],_e=_?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;_e.clear();let ye=null;le&&(ye=_?v.text.globeExtVertexArray:v.icon.globeExtVertexArray);const Ee=v.lineVertexArray,Ne=_?v.text.placedSymbolArray:v.icon.placedSymbolArray,je=f.transform.width/f.transform.height;let qe,Ie=!1;for(let Ge=0;Ge<Ne.length;Ge++){const Ue=Ne.get(Ge),{numGlyphs:De,writingMode:Ze}=Ue;if(Ze!==i.bK.vertical||Ie||qe===i.bK.horizontal||(Ie=!0),qe=Ze,(Ue.hidden||Ze===i.bK.vertical)&&!Ie){sd(De,_e);continue}Ie=!1;const ut=new i.P(Ue.tileAnchorX,Ue.tileAnchorY),ot=v.elevationType==="road",St=!!Q.elevation||ot;let{x:gt,y:kt,z:Qt}=Q.projection.projectTilePoint(ut.x,ut.y,G.canonical),mt=null;if(St){const mr=ot?v.getElevationFeatureForText(Ge):null;mt={getElevation:z,elevation:Q.elevation,elevationFeature:mr};const[$r,jn,Fn]=z(ut,Q.elevation,mr);gt+=$r,kt+=jn,Qt+=Fn}const nt=[gt,kt,Qt,1];if(i.aC(nt,nt,l),!Mw(nt,ue)){sd(De,_e);continue}const Nt=nt[3],yt=Rw(f.transform.getCameraToCenterDistance(Q.projection),Nt),$t=i.bL(X,se,Ue),nr=k?$t/yt:$t*yt,xr=ca(gt,kt,Qt,E);if(xr[3]<=0){sd(De,_e);continue}let Xt={};const tr=i.an(v.layers[0].layout.get("text-max-angle")),wr=Math.cos(tr),pr=k?null:mt,dr=tA(Ue,nr,!1,L,l,E,j,v.glyphOffsetArray,Ee,_e,ye,xr,ut,Xt,je,pr,Q.projection,G,k,wr);Ie=dr.useVertical,pr&&dr.needsFlipping&&(Xt={}),(dr.notEnoughRoom||Ie||dr.needsFlipping&&tA(Ue,nr,!0,L,l,E,j,v.glyphOffsetArray,Ee,_e,ye,xr,ut,Xt,je,pr,Q.projection,G,k,wr).notEnoughRoom)&&sd(De,_e)}_?(v.text.dynamicLayoutVertexBuffer.updateData(_e),ye&&v.text.globeExtVertexBuffer&&v.text.globeExtVertexBuffer.updateData(ye)):(v.icon.dynamicLayoutVertexBuffer.updateData(_e),ye&&v.icon.globeExtVertexBuffer&&v.icon.globeExtVertexBuffer.updateData(ye))}function hi(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e){const{lineStartIndex:ye,glyphStartIndex:Ee,segment:Ne}=L,je=Ee+L.numGlyphs,qe=ye+L.lineLength,Ie=l.getoffsetX(Ee),Ge=l.getoffsetX(je-1),Ue=Gg(v*Ie,f,_,E,j,k,Ne,ye,qe,z,G,Z,Q,X,!0,se,le,ue,_e);if(!Ue)return null;const De=Gg(v*Ge,f,_,E,j,k,Ne,ye,qe,z,G,Z,Q,X,!0,se,le,ue,_e);return De?{first:Ue,last:De}:null}function Lw(v,l,f,_){return v===i.bK.horizontal&&Math.abs(_)>Math.abs(f)?{useVertical:!0}:v===i.bK.vertical?_>0?{needsFlipping:!0}:null:l!==ql.unknown&&function(E,j){return E===0||Math.abs(j/E)>qg}(f,_)?l===ql.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function tA(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye,Ee,Ne){const je=l/24,qe=v.lineOffsetX*je,Ie=v.lineOffsetY*je,{lineStartIndex:Ge,glyphStartIndex:Ue,numGlyphs:De,segment:Ze,writingMode:ut,flipState:ot}=v,St=Ge+v.lineLength,gt=kt=>{if(Z){const[Nt,yt,$t]=kt.up,nr=G.length;i.bM(Z,nr+0,Nt,yt,$t),i.bM(Z,nr+1,Nt,yt,$t),i.bM(Z,nr+2,Nt,yt,$t),i.bM(Z,nr+3,Nt,yt,$t)}const[Qt,mt,nt]=kt.point;i.bN(G,Qt,mt,nt,kt.angle)};if(De>1){const kt=hi(je,L,qe,Ie,f,Q,X,v,z,j,se,ue,!1,_e,ye,Ee,Ne);if(!kt)return{notEnoughRoom:!0};if(_&&!f){let[Qt,mt,nt]=kt.first.point,[Nt,yt,$t]=kt.last.point;[Qt,mt]=ca(Qt,mt,nt,k),[Nt,yt]=ca(Nt,yt,$t,k);const nr=Lw(ut,ot,(Nt-Qt)*le,yt-mt);if(v.flipState=nr&&nr.needsFlipping?ql.flipRequired:ql.flipNotRequired,nr)return nr}gt(kt.first);for(let Qt=Ue+1;Qt<Ue+De-1;Qt++){const mt=Gg(je*L.getoffsetX(Qt),qe,Ie,f,Q,X,Ze,Ge,St,z,j,se,ue,!1,!1,_e,ye,Ee,Ne);if(!mt)return G.length-=4*(Qt-Ue),{notEnoughRoom:!0};gt(mt)}gt(kt.last)}else{if(_&&!f){const Qt=ca(X.x,X.y,0,E),mt=Ge+Ze+1,nt=new i.P(z.getx(mt),z.gety(mt)),Nt=ca(nt.x,nt.y,0,E),yt=Nt[3]>0?Nt:Kr(X,nt,Qt,1,E,void 0,_e,ye.canonical),$t=Lw(ut,ot,(yt[0]-Qt[0])*le,yt[1]-Qt[1]);if(v.flipState=$t&&$t.needsFlipping?ql.flipRequired:ql.flipNotRequired,$t)return $t}const kt=Gg(je*L.getoffsetX(Ue),qe,Ie,f,Q,X,Ze,Ge,St,z,j,se,ue,!1,!1,_e,ye,Ee,Ne);if(!kt)return{notEnoughRoom:!0};gt(kt)}return{}}function rA(v,l,f,_,E){const{x:j,y:k,z:L}=_.projectTilePoint(v.x,v.y,l);if(!E)return ca(j,k,L,f);const[z,G,Z]=E.getElevation(v,E.elevation,E.elevationFeature);return ca(j+z,k+G,L+Z,f)}function Kr(v,l,f,_,E,j,k,L){const z=rA(v.sub(l)._unit()._add(v),L,E,k,j);return i.av(z,f,z),i.aw(z,z),i.bG(z,f,z,_)}function Gg(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye,Ee){const Ne=_?v-l:v+l;let je=Ne>0?1:-1,qe=0;_&&(je*=-1,qe=Math.PI),je<0&&(qe+=Math.PI);let Ie=L+k+(je>0?0:1)|0,Ge=E,Ue=E,De=0,Ze=0;const ut=Math.abs(Ne),ot=[],St=[];let gt=j,kt=gt,Qt=i.bE([]);const mt=()=>Kr(kt,gt,Ue,ut-De+1,Z,X,ue,_e.canonical);for(;De+Ze<=ut;){if(Ie+=je,Ie<L||Ie>=z)return null;if(Ue=Ge,kt=gt,ot.push(Ue),se&&St.push(kt),gt=new i.P(G.getx(Ie),G.gety(Ie)),Ge=Q[Ie],!Ge){const pr=rA(gt,_e.canonical,Z,ue,X);Ge=pr[3]>0?Q[Ie]=pr:mt()}De+=Ze;const tr=i.av([],Ge,Ue),wr=i.bF(Ue,Ge);if(f&&wr>0&&Ze>0&&i.bI(Qt,tr)/(Ze*wr)<Ee)return null;Ze=wr,Qt=tr}le&&X&&(Q[Ie]&&(Ge=mt(),Ze=i.bF(Ue,Ge),Qt=i.av([],Ge,Ue)),Q[Ie]=Ge);const nt=(ut-De)/Ze,Nt=gt.sub(kt)._mult(nt)._add(kt),yt=i.bG([],Ue,Qt,nt);let $t=[0,0,1],nr=Qt[0],xr=Qt[1];if(ye&&($t=ue.upVector(_e.canonical,Nt.x,Nt.y),$t[0]!==0||$t[1]!==0||$t[2]!==1)){const tr=[$t[2],0,-$t[0]],wr=i.bH([],$t,tr);i.aw(tr,tr),i.aw(wr,wr),nr=i.bI(Qt,tr),xr=i.bI(Qt,wr)}if(f){const tr=i.bH([],$t,Qt);i.aw(tr,tr),i.bG(yt,yt,tr,f*je)}const Xt=qe+Math.atan2(xr,nr);return ot.push(yt),se&&St.push(Nt),{point:yt,angle:Xt,path:ot,tilePath:St,up:$t}}function sd(v,l){const f=l.length,_=f+4*v;l.resize(_),l.float32.fill(-1/0,4*f,4*_)}function Ec(v,l,f){const _=l[0],E=l[1];return v[0]=f[0]*_+f[4]*E+f[12],v[1]=f[1]*_+f[5]*E+f[13],v[3]=f[3]*_+f[7]*E+f[15],v}const Tc=100;class Sp{constructor(l,f,_=new Vg(l.width+200,l.height+200,25),E=new Vg(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=E,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Tc,this.screenBottomBoundary=l.height+Tc,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=f}placeCollisionBox(l,f,_,E,j,k,L,z,G,Z,Q){let X=_.projectedAnchorX,se=_.projectedAnchorY,le=_.projectedAnchorZ;const ue=_.tileAnchorX,_e=_.tileAnchorY,ye=_.elevation,Ee=_.tileID,Ne=l.getProjection();if(ye&&Ee){const[St,gt,kt]=Ne.upVector(Ee.canonical,_.tileAnchorX,_.tileAnchorY),Qt=Ne.upVectorScale(Ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;X+=St*ye*Qt,se+=gt*ye*Qt,le+=kt*ye*Qt}const je=l.projection.name==="globe",qe=l.projection.name==="globe"?i.aj(this.transform.zoom):0;if(Ee&&je&&qe<1&&!k){const St=1<<Ee.canonical.z,gt=i.bO(ue,_e);i.bP(gt,gt,1/i.al),i.bQ(gt,gt,i.bO(Ee.canonical.x,Ee.canonical.y)),i.bP(gt,gt,1/St),i.bR(gt,gt,i.bO(E[0],E[1])),gt[0]=i.bS(gt[0],-.5,.5),i.bP(gt,gt,i.al);const kt=i.bT(gt[0],gt[1],i.al/(2*Math.PI),1);i.aC(kt,kt,j),X=i.ak(X,kt[0],qe),se=i.ak(se,kt[1],qe),le=i.ak(le,kt[2],qe)}const Ie=this.projectAndGetPerspectiveRatio(Z,X,se,le,_.tileID,Ne.name==="globe"||!!ye||this.transform.pitch>0,Ne),Ge=G*Ie.perspectiveRatio,Ue=(_.x1*f+L.x-_.padding)*Ge+Ie.point.x,De=(_.y1*f+L.y-_.padding)*Ge+Ie.point.y,Ze=(_.x2*f+L.x+_.padding)*Ge+Ie.point.x,ut=(_.y2*f+L.y+_.padding)*Ge+Ie.point.y,ot=Ie.perspectiveRatio<=.55||Ie.occluded;return!this.isInsideGrid(Ue,De,Ze,ut)||!z&&this.grid.hitTest(Ue,De,Ze,ut,Q)||ot?{box:[],offscreen:!1,occluded:Ie.occluded}:{box:[Ue,De,Ze,ut],offscreen:this.isOffscreen(Ue,De,Ze,ut),occluded:!1}}placeCollisionCircles(l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e){const ye=[],Ee=this.transform.elevation,Ne=l.getProjection(),je=l.elevationType==="road",qe=!!Ee||je,Ie=i.bU.getAtTileOffsetFunc(_e,this.transform.center.lat,this.transform.worldSize,Ne),Ge=new i.P(_.tileAnchorX,_.tileAnchorY),Ue=new i.P(_.tileAnchorX,_.tileAnchorY);let{x:De,y:Ze,z:ut}=Ne.projectTilePoint(Ue.x,Ue.y,_e.canonical),ot=null;if(qe){const wr=je?l.getElevationFeatureForText(E):null;ot={getElevation:Ie,elevation:Ee,elevationFeature:wr};const[pr,dr,mr]=Ie(Ge,Ee,wr);De+=pr,Ze+=dr,ut+=mr}const St=Ne.name==="globe",gt=this.projectAndGetPerspectiveRatio(z,De,Ze,ut,_e,St||!!Ee||this.transform.pitch>0,Ne),{perspectiveRatio:kt}=gt,Qt=(X?L/kt:L*kt)/i.bX,mt=ca(De,Ze,ut,G),nt=_.lineOffsetX*Qt,Nt=_.lineOffsetY*Qt,yt=i.an(l.layers[0].layout.get("text-max-angle")),$t=Math.cos(yt),nr=gt.signedDistanceFromCamera>0?hi(Qt,k,nt,Nt,je&&_.flipState===1,mt,Ue,_,j,G,{},qe&&!X?ot:null,X&&qe,Ne,_e,X,$t):null;let xr=!1,Xt=!1,tr=!0;if(nr&&!gt.occluded){const wr=.5*le*kt+ue,pr=new i.P(-100,-100),dr=new i.P(this.screenRightBoundary,this.screenBottomBoundary),mr=new GI,{first:$r,last:jn}=nr,Fn=$r.path.length;let Ei=[];for(let dn=Fn-1;dn>=1;dn--)Ei.push($r.path[dn]);for(let dn=1;dn<jn.path.length;dn++)Ei.push(jn.path[dn]);const Yr=2.5*wr;Z&&(Ei=Ei.map(([dn,yi,zn],Di)=>(qe&&!St&&(zn=Ie(Di<Fn-1?$r.tilePath[Fn-1-Di]:jn.tilePath[Di-Fn+2],Ee,ot.elevationFeature)[2]),ca(dn,yi,zn,Z))),Ei.some(dn=>dn[3]<=0)&&(Ei=[]));let Dn=[];if(Ei.length>0){let dn=1/0,yi=-1/0,zn=1/0,Di=-1/0;for(const Xn of Ei)dn=Math.min(dn,Xn[0]),zn=Math.min(zn,Xn[1]),yi=Math.max(yi,Xn[0]),Di=Math.max(Di,Xn[1]);yi>=pr.x&&dn<=dr.x&&Di>=pr.y&&zn<=dr.y&&(Dn=[Ei.map(Xn=>new i.P(Xn[0],Xn[1]))],(dn<pr.x||yi>dr.x||zn<pr.y||Di>dr.y)&&(Dn=i.bV(Dn,pr.x,pr.y,dr.x,dr.y)))}for(const dn of Dn){mr.reset(dn,.25*wr);let yi=0;yi=mr.length<=.5*wr?1:Math.ceil(mr.paddedLength/Yr)+1;for(let zn=0;zn<yi;zn++){const Di=zn/Math.max(yi-1,1),Xn=mr.lerp(Di),fn=Xn.x+Tc,ai=Xn.y+Tc;ye.push(fn,ai,wr,0);const _n=fn-wr,Wi=ai-wr,di=fn+wr,Qr=ai+wr;if(tr=tr&&this.isOffscreen(_n,Wi,di,Qr),Xt=Xt||this.isInsideGrid(_n,Wi,di,Qr),!f&&this.grid.hitTestCircle(fn,ai,wr,se)&&(xr=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:xr,occluded:!1}}}}return{circles:!Q&&xr||!Xt?[]:ye,offscreen:tr,collisionDetected:xr,occluded:gt.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,E=1/0,j=-1/0,k=-1/0;for(const Z of l){const Q=new i.P(Z.x+Tc,Z.y+Tc);_=Math.min(_,Q.x),E=Math.min(E,Q.y),j=Math.max(j,Q.x),k=Math.max(k,Q.y),f.push(Q)}const L=this.grid.query(_,E,j,k).concat(this.ignoredGrid.query(_,E,j,k)),z={},G={};for(const Z of L){const Q=Z.key;if(z[Q.bucketInstanceId]===void 0&&(z[Q.bucketInstanceId]={}),z[Q.bucketInstanceId][Q.featureIndex])continue;const X=[new i.P(Z.x1,Z.y1),new i.P(Z.x2,Z.y1),new i.P(Z.x2,Z.y2),new i.P(Z.x1,Z.y2)];i.bW(f,X)&&(z[Q.bucketInstanceId][Q.featureIndex]=!0,G[Q.bucketInstanceId]===void 0&&(G[Q.bucketInstanceId]=[]),G[Q.bucketInstanceId].push(Q.featureIndex))}return G}insertCollisionBox(l,f,_,E,j){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:E,collisionGroupID:j},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,_,E,j){const k=f?this.ignoredGrid:this.grid,L={bucketInstanceId:_,featureIndex:E,collisionGroupID:j};for(let z=0;z<l.length;z+=4)k.insertCircle(L,l[z],l[z+1],l[z+2])}projectAndGetPerspectiveRatio(l,f,_,E,j,k,L){const z=[f,_,E,1];let G=!1;E||this.transform.pitch>0?(i.aC(z,z,l),this.fogState&&j&&L.name!=="globe"&&(G=function(X,se,le,ue,_e,ye){const Ee=ye.calculateFogTileMatrix(_e),Ne=[se,le,ue];return i.af(Ne,Ne,Ee),Jt(X,i.ag(Ne),ye.pitch,ye._fov)}(this.fogState,f,_,E,j.toUnwrapped(),this.transform)>.9)):Ec(z,z,l);const Z=z[3];return{point:new i.P((z[0]/Z+1)/2*this.transform.width+Tc,(-z[1]/Z+1)/2*this.transform.height+Tc),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(L)/Z*.5,1.5),signedDistanceFromCamera:Z,occluded:k&&z[2]>Z||G}}isOffscreen(l,f,_,E){return _<Tc||l>=this.screenRightBoundary||E<Tc||f>this.screenBottomBoundary}isInsideGrid(l,f,_,E){return _>=0&&l<this.gridRightBoundary&&E>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=i.bz([]);return i.bq(l,l,[-100,-100,0]),l}}class Or{constructor(l,f,_,E){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):E&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Zn{constructor(l,f,_,E,j,k=!1){this.text=new Or(l?l.text:null,f,_,j),this.icon=new Or(l?l.icon:null,f,E,j),this.clipped=k}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ui{constructor(l,f,_,E=!1){this.text=l,this.icon=f,this.skipFade=_,this.clipped=E}}class kl{constructor(){this.invProjMatrix=i.bB(),this.viewportMatrix=i.bB(),this.circles=[]}}class Ep{constructor(l,f,_,E,j){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=E,this.tileID=j}}class gi{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[l]}}function Wg(v,l,f,_,E){const{horizontalAlign:j,verticalAlign:k}=i.c0(v),L=-(j-.5)*l,z=-(k-.5)*f,G=i.c1(v,_);return new i.P(L+G[0]*E,z+G[1]*E)}function uf(v,l,f,_,E){const j=new i.P(v,l);return f&&j._rotate(_?E:-E),j}class Kg{constructor(l,f,_,E,j,k){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new Sp(this.transform,j),this.buildingIndex=k,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new gi(_),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,_,E,j=1){const k=_.getBucket(f),L=_.latestFeatureIndex;if(!k||!L||f.fqid!==k.layerIds[0])return;const z=k.layers[0].layout,G=k.layers[0].paint,Z=_.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/i.al,se=_.tileID.toUnwrapped();this.transform.setProjection(k.projection);const le=(ue=_.tileID,_e=k.getProjection(),ye=this.transform,_e.name===this.projection?ye.calculateProjMatrix(ue.toUnwrapped()):cf(ye,_e,ue));var ue,_e,ye;const Ee=z.get("text-pitch-alignment")==="map",Ne=z.get("text-rotation-alignment")==="map";f.compileFilter(f.options);const je=f.dynamicFilter(),qe=f.dynamicFilterNeedsFeature(),Ie=this.transform.calculatePixelsToTileUnitsMatrix(_),Ge=Hg(le,_.tileID.canonical,Ee,Ne,this.transform,k.getProjection(),Ie);let Ue=null;const De=k.getProjection().createInversionMatrix(this.transform,_.tileID.canonical);if(Ee){const nt=id(le,_.tileID.canonical,Ee,Ne,this.transform,k.getProjection(),Ie);Ue=i.aB([],this.transform.labelPlaneMatrix,nt)}let Ze=null;je&&_.latestFeatureIndex&&(Ze={unwrappedTileID:se,dynamicFilter:je,dynamicFilterNeedsFeature:qe}),this.retainedQueryData[k.bucketInstanceId]=new Ep(k.bucketInstanceId,L,k.sourceLayerIndex,k.index,_.tileID);const[ut,ot]=k.layers[0].layout.get("text-size-scale-range"),St=i.aA(j,ut,ot),[gt,kt]=z.get("icon-size-scale-range"),Qt=i.aA(j,gt,kt),mt={bucket:k,layout:z,paint:G,posMatrix:le,invMatrix:De,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ge,labelToScreenMatrix:Ue,clippingData:Ze,scale:Q,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:Z,partiallyEvaluatedTextSize:i.bJ(k.textSizeData,this.transform.zoom,St),partiallyEvaluatedIconSize:i.bJ(k.iconSizeData,this.transform.zoom,Qt),collisionGroup:this.collisionGroups.get(k.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(E)for(const nt of k.sortKeyRanges){const{sortKey:Nt,symbolInstanceStart:yt,symbolInstanceEnd:$t}=nt;l.push({sortKey:Nt,symbolInstanceStart:yt,symbolInstanceEnd:$t,parameters:mt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:mt})}attemptAnchorPlacement(l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye,Ee,Ne,je,qe){const{textOffset0:Ie,textOffset1:Ge,crossTileID:Ue}=ue,De=[Ie,Ge],Ze=Wg(l,k,L,De,z),ut=this.collisionIndex.placeCollisionBox(ye,z,f,_,E,j,uf(Ze.x,Ze.y,G,Z,this.transform.angle),le,Q,X,se.predicate);if(Ne){const ot=ye.getSymbolInstanceIconSize(qe,this.transform.zoom,ue.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ye,ot,Ne,_,E,j,uf(Ze.x,Ze.y,G,Z,this.transform.angle),le,Q,X,se.predicate).box.length===0)return}if(ut.box.length>0){let ot;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ue]&&this.prevPlacement.placements[Ue]&&this.prevPlacement.placements[Ue].text&&(ot=this.prevPlacement.variableOffsets[Ue].anchor),this.variableOffsets[Ue]={textOffset:De,width:k,height:L,anchor:l,textScale:z,prevAnchor:ot},this.markUsedJustification(ye,l,ue,Ee),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,Ee,ue),this.placedOrientations[Ue]=Ee),{shift:Ze,placedGlyphBoxes:ut}}}placeLayerBucketPart(l,f,_,E,j=1){const{bucket:k,layout:L,paint:z,posMatrix:G,textLabelPlaneMatrix:Z,labelToScreenMatrix:Q,clippingData:X,textPixelRatio:se,mercatorCenter:le,invMatrix:ue,holdingForFade:_e,collisionBoxArray:ye,partiallyEvaluatedTextSize:Ee,partiallyEvaluatedIconSize:Ne,collisionGroup:je,latestFeatureIndex:qe}=l.parameters,Ie=L.get("text-optional"),Ge=L.get("icon-optional"),Ue=L.get("text-allow-overlap"),De=L.get("icon-allow-overlap"),Ze=L.get("text-rotation-alignment")==="map",ut=L.get("icon-rotation-alignment")==="map",ot=L.get("text-pitch-alignment")==="map",St=z.get("symbol-z-offset"),gt=L.get("symbol-elevation-reference")==="sea",kt=L.get("symbol-placement"),[Qt,mt]=L.get("text-size-scale-range"),[nt,Nt]=L.get("icon-size-scale-range"),yt=i.aA(j,Qt,mt),$t=i.aA(j,nt,Nt),nr=L.get("text-variable-anchor"),xr=Ze&&kt!=="point",Xt=ut&&kt!=="point",tr=nr&&k.hasTextData(),wr=k.hasIconTextFit()&&tr&&k.hasIconData();this.transform.setProjection(k.projection);const pr=tr||xr,dr=Xt||wr;let mr=Ue&&(De||!k.hasIconData()||Ge),$r=De&&(Ue||!k.hasTextData()||Ie);const jn=!St.isConstant();!k.collisionArrays&&ye&&k.deserializeCollisionBoxes(ye),_&&E&&k.updateCollisionDebugBuffers(this.transform.zoom,ye,yt,$t);const Fn=(Yr,Dn,dn)=>{const{crossTileID:yi,numVerticalGlyphVertices:zn}=Yr;let Di=null;if(X&&X.dynamicFilterNeedsFeature||jn){const gs=this.retainedQueryData[k.bucketInstanceId];Di=qe.loadFeature({featureIndex:Yr.featureIndex,bucketIndex:gs.bucketIndex,sourceLayerIndex:gs.sourceLayerIndex,layoutVertexArrayOffset:0})}if(X&&!(0,X.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:k.worldview},Di,this.retainedQueryData[k.bucketInstanceId].tileID.canonical,new i.P(Yr.tileAnchorX,Yr.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[yi]=new ui(!1,!1,!1,!0),void f.add(yi);const Xn=St.evaluate(Di,{});if(f.has(yi))return;if(_e)return void(this.placements[yi]=new ui(!1,!1,!1));let fn=!1,ai=!1,_n=!0,Wi=!1,di=!1,Qr=null,Un={box:null,offscreen:null,occluded:null},os={box:null},ks=null,hs=null,ws=null,bl=0,ol=0,ao=0;dn.textFeatureIndex?bl=dn.textFeatureIndex:Yr.useRuntimeCollisionCircles&&(bl=Yr.featureIndex),dn.verticalTextFeatureIndex&&(ol=dn.verticalTextFeatureIndex);const Eo=k.elevationFeatures?k.elevationFeatures[Yr.elevationFeatureIndex]:void 0,Zl=gs=>{gs.tileID=this.retainedQueryData[k.bucketInstanceId].tileID;const Ns=this.transform.elevation;gs.elevation=gt?Xn:Xn+i.bU.getAtTileOffset(gs.tileID,new i.P(gs.tileAnchorX,gs.tileAnchorY),Ns,Eo),gs.elevation+=Yr.zOffset},oo=dn.textBox;if(oo){Zl(oo);const gs=ki=>{let Ls=i.bK.horizontal;if(k.allowVerticalPlacement&&!ki&&this.prevPlacement){const Ia=this.prevPlacement.placedOrientations[yi];Ia&&(this.placedOrientations[yi]=Ia,Ls=Ia,this.markUsedOrientation(k,Ls,Yr))}return Ls},Ns=(ki,Ls)=>{if(k.allowVerticalPlacement&&zn>0&&dn.verticalTextBox){for(const Ia of k.writingModes)if(Ia===i.bK.vertical?(Un=Ls(),os=Un):Un=ki(),Un&&Un.box&&Un.box.length)break}else Un=ki()};if(nr){let ki=nr;if(this.prevPlacement&&this.prevPlacement.variableOffsets[yi]){const ys=this.prevPlacement.variableOffsets[yi];ki.indexOf(ys.anchor)>0&&(ki=ki.filter(Yl=>Yl!==ys.anchor),ki.unshift(ys.anchor))}const Ls=(ys,Yl,tm)=>{const md=k.getSymbolInstanceTextSize(Ee,Yr,this.transform.zoom,Dn),rm=(ys.x2-ys.x1)*md+2*ys.padding,nm=(ys.y2-ys.y1)*md+2*ys.padding,Jl=Yr.hasIconTextFit&&!De?Yl:null;Jl&&Zl(Jl);let Nu={box:[],offscreen:!1,occluded:!1};const wa=Ue?2*ki.length:ki.length;for(let Ql=0;Ql<wa;++Ql){const Ef=this.attemptAnchorPlacement(ki[Ql%ki.length],ys,le,ue,pr,rm,nm,md,Ze,ot,se,G,je,Ql>=ki.length,Yr,Dn,k,tm,Jl,Ee,Ne);if(Ef&&(Nu=Ef.placedGlyphBoxes,Nu&&Nu.box&&Nu.box.length)){fn=!0,Qr=Ef.shift;break}}return Nu};Ns(()=>Ls(oo,dn.iconBox,i.bK.horizontal),()=>{const ys=dn.verticalTextBox;return ys&&Zl(ys),k.allowVerticalPlacement&&!(Un&&Un.box&&Un.box.length)&&zn>0&&ys?Ls(ys,dn.verticalIconBox,i.bK.vertical):{box:null,offscreen:null,occluded:null}}),Un&&(fn=Un.box,_n=Un.offscreen,Wi=Un.occluded);const Ia=gs(!(!Un||!Un.box));if(!fn&&this.prevPlacement){const ys=this.prevPlacement.variableOffsets[yi];ys&&(this.variableOffsets[yi]=ys,this.markUsedJustification(k,ys.anchor,Yr,Ia))}}else{const ki=(Ls,Ia)=>{const ys=k.getSymbolInstanceTextSize(Ee,Yr,this.transform.zoom,Dn),Yl=this.collisionIndex.placeCollisionBox(k,ys,Ls,le,ue,pr,new i.P(0,0),Ue,se,G,je.predicate);return Yl&&Yl.box&&Yl.box.length&&(this.markUsedOrientation(k,Ia,Yr),this.placedOrientations[yi]=Ia),Yl};Ns(()=>ki(oo,i.bK.horizontal),()=>{const Ls=dn.verticalTextBox;return k.allowVerticalPlacement&&zn>0&&Ls?(Zl(Ls),ki(Ls,i.bK.vertical)):{box:null,offscreen:null,occluded:null}}),gs(!!(Un&&Un.box&&Un.box.length))}}if(ks=Un,fn=ks&&ks.box&&ks.box.length>0,_n=ks&&ks.offscreen,Wi=ks&&ks.occluded,Yr.useRuntimeCollisionCircles){const gs=Yr.centerJustifiedTextSymbolIndex>=0?Yr.centerJustifiedTextSymbolIndex:Yr.verticalPlacedTextSymbolIndex,Ns=k.text.placedSymbolArray.get(gs),ki=i.bL(k.textSizeData,Ee,Ns),Ls=L.get("text-padding");hs=this.collisionIndex.placeCollisionCircles(k,Ue,Ns,gs,k.lineVertexArray,k.glyphOffsetArray,ki,G,Z,Q,_,ot,je.predicate,Yr.collisionCircleDiameter*ki/i.bX,Ls,this.retainedQueryData[k.bucketInstanceId].tileID),fn=Ue||hs.circles.length>0&&!hs.collisionDetected,_n=_n&&hs.offscreen,Wi=hs.occluded}if(dn.iconFeatureIndex&&(ao=dn.iconFeatureIndex),dn.iconBox){const gs=Ns=>{Zl(Ns);const ki=Yr.hasIconTextFit&&Qr?uf(Qr.x,Qr.y,Ze,ot,this.transform.angle):new i.P(0,0),Ls=k.getSymbolInstanceIconSize(Ne,this.transform.zoom,Yr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(k,Ls,Ns,le,ue,dr,ki,De,se,G,je.predicate)};os&&os.box&&os.box.length&&dn.verticalIconBox?(ws=gs(dn.verticalIconBox),ai=ws.box.length>0):(ws=gs(dn.iconBox),ai=ws.box.length>0),_n=_n&&ws.offscreen,di=ws.occluded}const Xl=Ie||Yr.numHorizontalGlyphVertices===0&&zn===0,Nc=Ge||Yr.numIconVertices===0;if(Xl||Nc?Nc?Xl||(ai=ai&&fn):fn=ai&&fn:ai=fn=ai&&fn,fn&&ks&&ks.box&&this.collisionIndex.insertCollisionBox(ks.box,L.get("text-ignore-placement"),k.bucketInstanceId,os&&os.box&&ol?ol:bl,je.ID),ai&&ws&&this.collisionIndex.insertCollisionBox(ws.box,L.get("icon-ignore-placement"),k.bucketInstanceId,ao,je.ID),hs&&(fn&&this.collisionIndex.insertCollisionCircles(hs.circles,L.get("text-ignore-placement"),k.bucketInstanceId,bl,je.ID),_)){const gs=k.bucketInstanceId;let Ns=this.collisionCircleArrays[gs];Ns===void 0&&(Ns=this.collisionCircleArrays[gs]=new kl);for(let ki=0;ki<hs.circles.length;ki+=4)Ns.circles.push(hs.circles[ki+0]),Ns.circles.push(hs.circles[ki+1]),Ns.circles.push(hs.circles[ki+2]),Ns.circles.push(hs.collisionDetected?1:0)}const Na=k.projection.name!=="globe";mr=mr&&(Na||!Wi),$r=$r&&(Na||!di),this.placements[yi]=new ui(fn||mr,ai||$r,_n||k.justReloaded),f.add(yi)},Ei=this.retainedQueryData[k.bucketInstanceId].tileID;if(k.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(k,Ei),k.elevationType==="road"&&k.updateRoadElevation(Ei.canonical),k.updateZOffset(),k.sortFeaturesByY){const Yr=k.getSortedSymbolIndexes(this.transform.angle);for(let Dn=Yr.length-1;Dn>=0;--Dn){const dn=Yr[Dn];Fn(k.symbolInstances.get(dn),dn,k.collisionArrays[dn])}k.hasAnyZOffset&&i.w(`${k.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(k.hasAnyZOffset){const Yr=k.getSortedIndexesByZOffset();for(let Dn=0;Dn<Yr.length;++Dn){const dn=Yr[Dn];Fn(k.symbolInstances.get(dn),dn,k.collisionArrays[dn])}}else for(let Yr=l.symbolInstanceStart;Yr<l.symbolInstanceEnd;Yr++)Fn(k.symbolInstances.get(Yr),Yr,k.collisionArrays[Yr]);if(_&&k.bucketInstanceId in this.collisionCircleArrays){const Yr=this.collisionCircleArrays[k.bucketInstanceId];i.bk(Yr.invProjMatrix,G),Yr.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(l,f,_,E){const{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:z,crossTileID:G}=_,Z=i.c2(f),Q=E===i.bK.vertical?z:Z==="left"?j:Z==="center"?k:Z==="right"?L:-1;j>=0&&(l.text.placedSymbolArray.get(j).crossTileID=Q>=0&&j!==Q?0:G),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=Q>=0&&k!==Q?0:G),L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=Q>=0&&L!==Q?0:G),z>=0&&(l.text.placedSymbolArray.get(z).crossTileID=Q>=0&&z!==Q?0:G)}markUsedOrientation(l,f,_){const E=f===i.bK.horizontal||f===i.bK.horizontalOnly?f:0,j=f===i.bK.vertical?f:0,{leftJustifiedTextSymbolIndex:k,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:G}=_,Z=l.text.placedSymbolArray;k>=0&&(Z.get(k).placedOrientation=E),L>=0&&(Z.get(L).placedOrientation=E),z>=0&&(Z.get(z).placedOrientation=E),G>=0&&(Z.get(G).placedOrientation=j)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const E=f?f.symbolFadeChange(l):1,j=f?f.opacities:{},k=f?f.variableOffsets:{},L=f?f.placedOrientations:{};for(const z in this.placements){const G=this.placements[z],Z=j[z];Z?(this.opacities[z]=new Zn(Z,E,G.text,G.icon,null,G.clipped),_=_||G.text!==Z.text.placed||G.icon!==Z.icon.placed):(this.opacities[z]=new Zn(null,E,G.text,G.icon,G.skipFade,G.clipped),_=_||G.text||G.icon)}for(const z in j){const G=j[z];if(!this.opacities[z]){const Z=new Zn(G,E,!1,!1);Z.isHidden()||(this.opacities[z]=Z,_=_||G.text.placed||G.icon.placed)}}for(const z in k)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=k[z]);for(const z in L)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=L[z]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f,_,E){const j=new Set;for(const k of f){const L=k.getBucket(l);L&&k.latestFeatureIndex&&l.fqid===L.layerIds[0]&&(this.updateBucketOpacities(L,j,k,k.collisionBoxArray,_,E,k.tileID,l.scope),L.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(L,k.tileID),L.elevationType==="road"&&L.updateRoadElevation(k.tileID.canonical),L.updateZOffset())}}updateBucketOpacities(l,f,_,E,j,k,L,z){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const G=l.layers[0].layout,Z=l.layers[0].paint,Q=!!l.layers[0].dynamicFilter(),X=new Zn(null,0,!1,!1,!0),se=G.get("text-allow-overlap"),le=G.get("icon-allow-overlap"),ue=G.get("text-variable-anchor"),_e=G.get("text-rotation-alignment")==="map",ye=G.get("text-pitch-alignment")==="map",Ee=Z.get("symbol-z-offset"),Ne=G.get("symbol-elevation-reference")==="sea",je=!Ee.isConstant(),qe=new Zn(null,0,se&&(le||!l.hasIconData()||G.get("icon-optional")),le&&(se||!l.hasTextData()||G.get("text-optional")),!0);!l.collisionArrays&&E&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(E);const Ie=(Ue,De,Ze)=>{for(let ut=0;ut<De/4;ut++)Ue.opacityVertexArray.emplaceBack(Ze)};let Ge=0;k&&l.updateReplacement(L,k);for(let Ue=0;Ue<l.symbolInstances.length;Ue++){const De=l.symbolInstances.get(Ue),{numHorizontalGlyphVertices:Ze,numVerticalGlyphVertices:ut,crossTileID:ot,numIconVertices:St,tileAnchorX:gt,tileAnchorY:kt}=De;let Qt=null;const mt=this.retainedQueryData[l.bucketInstanceId];je&&De&&mt&&(Qt=_.latestFeatureIndex.loadFeature({featureIndex:De.featureIndex,bucketIndex:mt.bucketIndex,sourceLayerIndex:mt.sourceLayerIndex,layoutVertexArrayOffset:0}));const nt=Ee.evaluate(Qt,{}),Nt=f.has(ot);let yt=this.opacities[ot];Nt?yt=X:yt||(yt=qe,this.opacities[ot]=yt),f.add(ot);const $t=Ze>0||ut>0,nr=St>0,xr=this.placedOrientations[ot],Xt=xr===i.bK.vertical,tr=xr===i.bK.horizontal||xr===i.bK.horizontalOnly;!$t&&!nr||yt.isHidden()||Ge++;let wr=!1;if(($t||nr)&&k)for(const pr of l.activeReplacements){if(i.bY(pr,j,i.bZ.Symbol,z)||pr.min.x>gt||gt>pr.max.x||pr.min.y>kt||kt>pr.max.y)continue;const dr=i.b_(gt,kt,L.canonical,pr.footprintTileId.canonical);if(wr=i.b$(dr,pr.footprint),wr)break}if($t){const pr=wr?ka:Yg(yt.text);Ie(l.text,Ze,Xt?ka:pr),Ie(l.text,ut,tr?ka:pr);const dr=yt.text.isHidden(),{leftJustifiedTextSymbolIndex:mr,centerJustifiedTextSymbolIndex:$r,rightJustifiedTextSymbolIndex:jn,verticalPlacedTextSymbolIndex:Fn}=De,Ei=l.text.placedSymbolArray,Yr=dr||Xt?1:0;mr>=0&&(Ei.get(mr).hidden=Yr),$r>=0&&(Ei.get($r).hidden=Yr),jn>=0&&(Ei.get(jn).hidden=Yr),Fn>=0&&(Ei.get(Fn).hidden=dr||tr?1:0);const Dn=this.variableOffsets[ot];Dn&&this.markUsedJustification(l,Dn.anchor,De,xr);const dn=this.placedOrientations[ot];dn&&(this.markUsedJustification(l,"left",De,dn),this.markUsedOrientation(l,dn,De))}if(nr){const pr=wr?ka:Yg(yt.icon),{placedIconSymbolIndex:dr,verticalPlacedIconSymbolIndex:mr}=De,$r=l.icon.placedSymbolArray,jn=yt.icon.isHidden()?1:0;dr>=0&&(Ie(l.icon,St,Xt?ka:pr),$r.get(dr).hidden=jn),mr>=0&&(Ie(l.icon,De.numVerticalIconVertices,tr?ka:pr),$r.get(mr).hidden=jn)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const pr=l.collisionArrays[Ue];if(pr){let dr=new i.P(0,0),mr=!0;if(pr.textBox||pr.verticalTextBox){if(ue){const jn=this.variableOffsets[ot];jn?(dr=Wg(jn.anchor,jn.width,jn.height,jn.textOffset,jn.textScale),_e&&dr._rotate(ye?this.transform.angle:-this.transform.angle)):mr=!1}Q&&(mr=!yt.clipped),pr.textBox&&Wa(l.textCollisionBox.collisionVertexArray,yt.text.placed,!mr||Xt,nt,Ne,dr.x,dr.y),pr.verticalTextBox&&Wa(l.textCollisionBox.collisionVertexArray,yt.text.placed,!mr||tr,nt,Ne,dr.x,dr.y)}const $r=mr&&!!(!tr&&pr.verticalIconBox);pr.iconBox&&Wa(l.iconCollisionBox.collisionVertexArray,yt.icon.placed,$r,nt,Ne,De.hasIconTextFit?dr.x:0,De.hasIconTextFit?dr.y:0),pr.verticalIconBox&&Wa(l.iconCollisionBox.collisionVertexArray,yt.icon.placed,!$r,nt,Ne,De.hasIconTextFit?dr.x:0,De.hasIconTextFit?dr.y:0)}}}if(l.fullyClipped=Ge===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ue.invProjMatrix,l.placementViewportMatrix=Ue.viewportMatrix,l.collisionCircleArray=Ue.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function Wa(v,l,f,_,E,j,k){v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0),v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0),v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0),v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0)}const Qs=Math.pow(2,25),WI=Math.pow(2,24),Zg=Math.pow(2,17),Fw=Math.pow(2,16),Xg=Math.pow(2,9),d_=Math.pow(2,8),zw=Math.pow(2,1);function Yg(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const l=v.placed?1:0,f=Math.floor(127*v.opacity);return f*Qs+l*WI+f*Zg+l*Fw+f*Xg+l*d_+f*zw+l}const ka=0;class ad{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,f,_,E,j,k){const L=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(L,E,l[this._currentTileIndex],this._sortAcrossTiles,k),this._currentTileIndex++,j())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((z,G)=>z.sortKey-G.sortKey));this._currentPartIndex<L.length;){const z=L[this._currentPartIndex];if(f.placeLayerBucketPart(z,this._seenCrossTileIDs,_,z.symbolInstanceStart===0,k),this._currentPartIndex++,j())return!0}return!1}}class vl{constructor(l,f,_,E,j,k,L,z,G){this.placement=new Kg(l,j,k,L,z,G),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(l,f,_,E,j){const k=i.o.now(),L=()=>{const z=i.o.now()-k;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){const z=f[l[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=G)&&(!z.maxzoom||z.maxzoom>G)){const Z=z,Q=Z.layout.get("symbol-z-elevate"),X=Z.layout.get("symbol-sort-key").constantOr(1)!==void 0,se=Z.layout.get("symbol-z-order"),le=se==="viewport-y"||se==="auto"&&!(se!=="viewport-y"&&X),ue=Z.layout.get("text-allow-overlap")||Z.layout.get("icon-allow-overlap")||Z.layout.get("text-ignore-placement")||Z.layout.get("icon-ignore-placement"),_e=le&&ue,ye=this._inProgressLayer=this._inProgressLayer||new ad(Z),Ee=i.B(z.source,z.scope);if(ye.continuePlacement(Q||_e?E[Ee]:_[Ee],this.placement,this._showCollisionBoxes,z,L,j))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const h_=512/i.al/2;class Tp{constructor(l,f,_){this.tileID=l,this.bucketInstanceId=_,this.index=new i.c3(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const E=l.canonical.x*i.al,j=l.canonical.y*i.al;for(let k=0;k<f.length;k++){const{key:L,crossTileID:z,tileAnchorX:G,tileAnchorY:Z}=f.get(k),Q=Math.floor((E+G)*h_),X=Math.floor((j+Z)*h_);this.index.add(Q,X),this.keys.push(L),this.crossTileIDs.push(z)}this.index.finish()}findMatches(l,f,_){const E=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),j=h_/Math.pow(2,f.canonical.z-this.tileID.canonical.z),k=f.canonical.x*i.al,L=f.canonical.y*i.al;for(let z=0;z<l.length;z++){const G=l.get(z);if(G.crossTileID)continue;const{key:Z,tileAnchorX:Q,tileAnchorY:X}=G,se=Math.floor((k+Q)*j),le=Math.floor((L+X)*j),ue=this.index.range(se-E,le-E,se+E,le+E).sort((_e,ye)=>_e-ye);for(const _e of ue){const ye=this.crossTileIDs[_e];if(this.keys[_e]===Z&&!_.has(ye)){_.add(ye),G.crossTileID=ye;break}}}}}class ba{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const _ in this.indexes){const E=this.indexes[_],j={};for(const k in E){const L=E[k];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+f),j[L.tileID.key]=L}this.indexes[_]=j}this.lng=l}addBucket(l,f,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let j=0;j<f.symbolInstances.length;j++)f.symbolInstances.get(j).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const E=this.usedCrossTileIDs[l.overscaledZ];for(const j in this.indexes){const k=this.indexes[j];if(Number(j)>l.overscaledZ)for(const L in k){const z=k[L];z.tileID.isChildOf(l)&&z.findMatches(f.symbolInstances,l,E)}else{const L=k[l.scaledTo(Number(j)).key];L&&L.findMatches(f.symbolInstances,l,E)}}for(let j=0;j<f.symbolInstances.length;j++){const k=f.symbolInstances.get(j);k.crossTileID||(k.crossTileID=_.generate(),E.add(k.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Tp(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const _ of f.crossTileIDs)this.usedCrossTileIDs[l].delete(_)}removeStaleBuckets(l){let f=!1;for(const _ in this.indexes){const E=this.indexes[_];for(const j in E)l[E[j].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,E[j]),delete E[j],f=!0)}return f}}class od{constructor(){this.layerIndexes={},this.crossTileIDs=new ba,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,_,E){let j=this.layerIndexes[l.fqid];j===void 0&&(j=this.layerIndexes[l.fqid]=new Cu);let k=!1;const L={};E.name!=="globe"&&j.handleWrapJump(_);for(const z of f){const G=z.getBucket(l);G&&l.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),j.addBucket(z.tileID,G,this.crossTileIDs)&&(k=!0),L[G.bucketInstanceId]=!0)}return j.removeStaleBuckets(L)&&(k=!0),k}pruneUnusedLayers(l){const f={};l.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Ds=771;class yn{constructor(l,f,_,E){this.blendFunction=l,this.blendColor=f.toNonPremultipliedRenderColor(null),this.mask=_,this.blendEquation=E}}yn.Replace=[1,0,1,0],yn.disabled=new yn(yn.Replace,i.ao.transparent,[!1,!1,!1,!1]),yn.unblended=new yn(yn.Replace,i.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlended=new yn([1,Ds,1,Ds],i.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlendedNonPremultiplied=new yn([770,Ds,770,Ds],i.ao.transparent,[!0,!0,!0,!0]),yn.multiply=new yn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),yn.additive=new yn([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Er{constructor(l,f,_){this.func=l,this.mask=f,this.range=_}}Er.ReadOnly=!1,Er.ReadWrite=!0,Er.disabled=new Er(519,Er.ReadOnly,[0,1]);const df=7680;class rn{constructor(l,f,_,E,j,k){this.test=l,this.ref=f,this.mask=_,this.fail=E,this.depthFail=j,this.pass=k}}rn.disabled=new rn({func:519,mask:0},0,0,df,df,df);const Ap=1029,f_=2305;class Xr{constructor(l,f,_){this.enable=l,this.mode=f,this.frontFace=_}}function Jg(v,l){const f=i.c9(v,3);i.cb(v,l),i.cf(v,3,f)}function p_(v,l){const f=i.c6([]);return i.c7(f,f,-l),i.c8(f,f,-v),f}function nA(v,l){const f=[v[0],v[1],0],_=[l[0],l[1],0];if(i.ag(f)>=1e-15){const k=i.aw([],f);i.c4(_,k,i.bI(_,k)),l[0]=_[0],l[1]=_[1]}const E=i.bH([],l,v);if(i.c5(E)<1e-15)return null;const j=Math.atan2(-E[1],E[0]);return p_(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),j)}Xr.disabled=new Xr(!1,Ap,f_),Xr.backCCW=new Xr(!0,Ap,f_),Xr.backCW=new Xr(!0,Ap,2304),Xr.frontCW=new Xr(!0,1028,2304),Xr.frontCCW=new Xr(!0,1028,f_);class ju{constructor(l,f){this.position=l,this.orientation=f}get position(){return this._position}set position(l){if(l){const f=l instanceof i.ae?l:new i.ae(l[0],l[1],l[2]);this._renderWorldCopies&&(f.x=i.bS(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(l,f,_){if(this.orientation=null,!this.position)return;const E=this.position,j=_||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(l)):0),k=i.ae.fromLngLat(l,j),L=[k.x-E.x,k.y-E.y,k.z-E.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=nA(L,f)}setPitchBearing(l,f){this.orientation=p_(i.an(l),i.an(-f))}}class m_{constructor(l,f){this._transform=i.bz([]),this.orientation=f,this.position=l}get mercatorPosition(){const l=this.position;return new i.ae(l[0],l[1],l[2])}get position(){const l=i.c9(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var f;l&&i.cf(this._transform,3,[(f=l)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||i.c6([]),l&&Jg(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,f){this._orientation=p_(l,f),Jg(this._transform,this._orientation)}forward(){const l=i.c9(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=i.c9(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=i.c9(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,f){const _=new Float64Array(16);return i.bk(_,this.getWorldToCamera(l,f)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,f,_){const E=this.position;i.c4(E,E,-l);const j=new Float64Array(16);return i.bp(j,[_,_,_]),i.bq(j,j,E),j[10]*=f,j}getWorldToCamera(l,f){const _=new Float64Array(16),E=new Float64Array(4),j=this.position;return i.ca(E,this._orientation),i.c4(j,j,-l),i.cb(_,E),i.bq(_,_,j),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=f,_[9]*=f,_[10]*=f,_[11]*=f,_}getCameraToClipPerspective(l,f,_,E){const j=new Float64Array(16);return i.cc(j,l,f,_,E),j}getCameraToClipOrthographic(l,f,_,E,j,k){const L=new Float64Array(16);return i.cd(L,l,f,_,E,j,k),L}getDistanceToElevation(l,f=!1){const _=l===0?0:i.ce(l,f?i.a_(this.position[1]):this.position[1]),E=this.forward();return(_-this.position[2])/E[2]}clone(){return new m_([...this.position],[...this.orientation])}}const Ka={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Vo{constructor(l=0,f=0,_=0,E=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=_,this.right=E}interpolate(l,f,_){return f.top!=null&&l.top!=null&&(this.top=i.ak(l.top,f.top,_)),f.bottom!=null&&l.bottom!=null&&(this.bottom=i.ak(l.bottom,f.bottom,_)),f.left!=null&&l.left!=null&&(this.left=i.ak(l.left,f.left,_)),f.right!=null&&l.right!=null&&(this.right=i.ak(l.right,f.right,_)),this}getCenter(l,f){const _=i.aA((this.left+l-this.right)/2,0,l),E=i.aA((this.top+f-this.bottom)/2,0,f);return new i.P(_,E)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Vo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const hf=15;class Cp{constructor(l,f,_,E,j,k,L){this.tileSize=512,this._renderWorldCopies=j===void 0||j,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=E??60,this.setProjection(k),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new i.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Vo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new m_,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const l=new Cp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l._allowWorldUnderZoom=this._allowWorldUnderZoom,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<hf}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,f=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=i.cl(this.projectionOptions);const _=this.getProjection(),E=!i.bx(f,_);return E&&this._calcMatrices(),this.mercatorFromTransition=!1,E}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cl({name:"mercator"});const f=l!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bS(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const f=-l*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=i.cm(),i.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=i.aA(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=i.an(l),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const l=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(l)}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let E=0,j=0;for(let k=0;k<f.length;k++){const L=new i.P(f[k][0]*this.width,_+f[k][1]*(this.height-_)),z=l.pointCoordinate(L);if(!z)continue;const G=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);E+=z[3]*G,j+=G}return j===0?NaN:E/j}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*f,E=this._mercatorZfromZoom(l),j=this._mercatorZfromZoom(this._maxZoom),k=Math.max(E-_,j);this._setZoom(this._zoomFromMercatorZ(k))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let _;_=l.z<this._camera.position[2]?[f.x,f.y,f.z]:[l.x,l.y,l.z];const E=i.ag(i.av([],this._camera.position,_));return i.aA(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let f=!1;if(l.orientation&&!i.co(l.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(l.orientation)),l.position){const _=[l.position.x,l.position.y,l.position.z];i.cp(_,this._camera.position)||(this._setCameraPosition(_),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,f=new ju;return f.position=new i.ae(l[0],l[1],l[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(l){if(!i.cq(l))return!1;i.cr(l,l);const f=i.cs([],[0,0,-1],l),_=i.cs([],[0,-1,0],l);if(_[2]<0)return!1;const E=nA(f,_);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(l){const f=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;l[2]=i.aA(l[2],E/_,E/f),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,_){this._unmodified=!1,this._edgeInsets.interpolate(l,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new i.ct(0,l)];if(this.renderWorldCopies){const _=this.pointCoordinate(new i.P(0,0)),E=this.pointCoordinate(new i.P(this.width,0)),j=this.pointCoordinate(new i.P(this.width,this.height)),k=this.pointCoordinate(new i.P(0,this.height)),L=Math.floor(Math.min(_.x,E.x,j.x,k.x)),z=Math.floor(Math.max(_.x,E.x,j.x,k.x)),G=1;for(let Z=L-G;Z<=z+G;Z++)Z!==0&&f.push(new i.ct(Z,l))}return f}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,f,_){let E=[];const j=_!=null,k=!j;if(k&&this.zoom<f||j&&_[0]===0&&_[1]===0)return E;const L=new Set,z=(Z,Q,X,se,le)=>{const ue=i.cX(Q,Z,X,se,le);L.has(ue)||(E.push(new i.aP(Z,Q,X,se,le)),L.add(ue))};for(let Z=0;Z<l.length;Z++){const Q=l[Z];if(k&&Q.canonical.z!==f)continue;const X=Q.canonical,se=Q.overscaledZ,le=Q.wrap,ue=1<<X.z,_e=X.x+1<ue,ye=X.x>0,Ee=X.y+1<ue,Ne=X.y>0,je=Q.wrap-(ye?0:1),qe=Q.wrap+(_e?0:1),Ie=ye?X.x-1:ue-1,Ge=_e?X.x+1:0;if(j)_[0]<0?(z(se,qe,X.z,Ge,X.y),_[1]<0&&Ee&&(z(se,le,X.z,X.x,X.y+1),z(se,qe,X.z,Ge,X.y+1)),_[1]>0&&Ne&&(z(se,le,X.z,X.x,X.y-1),z(se,qe,X.z,Ge,X.y-1))):_[0]>0?(z(se,je,X.z,Ie,X.y),_[1]<0&&Ee&&(z(se,le,X.z,X.x,X.y+1),z(se,je,X.z,Ie,X.y+1)),_[1]>0&&Ne&&(z(se,le,X.z,X.x,X.y-1),z(se,je,X.z,Ie,X.y-1))):_[1]<0&&Ee?z(se,le,X.z,X.x,X.y+1):Ne&&z(se,le,X.z,X.x,X.y-1);else{const Ue=Q.visibleQuadrants;1&Ue&&(z(se,je,X.z,Ie,X.y),Ne&&(z(se,le,X.z,X.x,X.y-1),z(se,je,X.z,Ie,X.y-1))),2&Ue&&(z(se,qe,X.z,Ge,X.y),Ne&&(z(se,le,X.z,X.x,X.y-1),z(se,qe,X.z,Ge,X.y-1))),4&Ue&&(z(se,je,X.z,Ie,X.y),Ee&&(z(se,le,X.z,X.x,X.y+1),z(se,je,X.z,Ie,X.y+1))),8&Ue&&(z(se,qe,X.z,Ge,X.y),Ee&&(z(se,le,X.z,X.x,X.y+1),z(se,qe,X.z,Ge,X.y+1)))}}const G=[];for(const Z of E)E.some(Q=>Z.isChildOf(Q))||G.push(Z);if(E=G.filter(Z=>!l.some(Q=>!!(Z.overscaledZ<f&&Q.isChildOf(Z))||Z.equals(Q)||Z.isChildOf(Q))),k){const Z=1<<f,Q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=[Z*Q.x,Z*Q.y],se=4,le=se*se;E=E.filter(ue=>{const _e=ue.canonical.x+.5-X[0],ye=ue.canonical.y+.5-X[1];return _e*_e+ye*ye<le})}return E}extendTileCoverToNearPlane(l,f,_){const E=[],j=new Set;for(const Ee of l)j.add(Ee.key);const k=(Ee,Ne,je,qe,Ie)=>{const Ge=i.cX(Ne,Ee,je,qe,Ie);j.has(Ge)||(E.push(new i.aP(Ee,Ne,je,qe,Ie)),j.add(Ge))},L=l.reduce((Ee,Ne)=>Math.max(Ee,Ne.overscaledZ),_),z=1<<_,G=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],Z=new i.P(0,0),Q=new i.P(0,0),X=(Ee,Ne)=>{const je=Math.floor(Ee[0]),qe=Math.floor(Ee[1]),Ie=(Ee[0]-je)*i.al,Ge=(Ee[1]-qe)*i.al,Ue=Math.floor(Ne[0]),De=Math.floor(Ne[1]),Ze=(Ne[0]-Ue)*i.al,ut=(Ne[1]-De)*i.al;for(let ot=-1;ot<=1;ot++){const St=je+ot;if(!(St<0||St>=z)){Z.x=Ie-ot*i.al,Q.x=Ze-(St-Ue)*i.al;for(let gt=-1;gt<=1;gt++){const kt=qe+gt;Z.y=Ge-gt*i.al,Q.y=ut-(kt-De)*i.al,i.cY(Z,Q,G)&&k(L,0,_,St,kt)}}}},se=f.points,le=se[i.cu],ue=se[i.cv],_e=this._projectToGround(le,se[i.cw]),ye=this._projectToGround(ue,se[i.cx]);return X(le,_e),X(ue,ye),E}_projectToGround(l,f){return i.cy(i.cz(),l,f,l[2]/(l[2]-f[2]))}coveringTiles(l){let f=this.coveringZoomLevel(l);const _=f,E=this.elevation&&this.elevation.exaggeration(),j=E&&!l.isTerrainDEM,k=this.projection.name==="mercator";if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);const L=this.locationCoordinate(this.center),z=this.center.lat,G=1<<f,Z=[G*L.x,G*L.y,0],Q=this.projection.name==="globe",X=!Q,se=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,X),le=Q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=G*i.ce(1,this.center.lat),_e=this._camera.position[2]/i.ce(1,this.center.lat),ye=[G*le.x,G*le.y,_e*(X?1:ue)],Ee=Q||E,Ne=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),je=this.isLODDisabled(!0)?f:0;let qe;if(this._elevation&&l.isTerrainDEM)qe=1e4*this._elevation.exaggeration();else if(this._elevation){const nt=this._elevation.getMinMaxForVisibleTiles();qe=nt?nt.max:this._centerAltitude}else qe=this._centerAltitude;const Ie=l.isTerrainDEM?-qe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ge=this.projection.isReprojectedInTileSpace?i.cB(this):1,Ue=nt=>{const yt=new i.ae(nt.x+25e-6,nt.y,nt.z),$t=new i.ae(nt.x,nt.y+25e-6,nt.z),nr=nt.toLngLat(),xr=yt.toLngLat(),Xt=$t.toLngLat(),tr=this.locationCoordinate(nr),wr=this.locationCoordinate(xr),pr=this.locationCoordinate(Xt),dr=Math.hypot(wr.x-tr.x,wr.y-tr.y),mr=Math.hypot(pr.x-tr.x,pr.y-tr.y);return Math.sqrt(dr*mr)*Ge/25e-6},De=nt=>{const Nt=qe,yt=Ie;return{aabb:i.cE(this,G,0,0,0,nt,yt,Nt,this.projection),zoom:0,x:0,y:0,minZ:yt,maxZ:Nt,wrap:nt,fullyVisible:!1}},Ze=[];let ut=[];const ot=f,St=l.reparseOverscaled?_:f,gt=(_e-this._centerAltitude)*ue,kt=nt=>{if(!this._elevation||!nt.tileID||!k)return;const Nt=this._elevation.getMinMaxForTile(nt.tileID),yt=nt.aabb;Nt?(yt.min[2]=Nt.min,yt.max[2]=Nt.max,yt.center[2]=(yt.min[2]+yt.max[2])/2):(nt.shouldSplit=mt(nt),nt.shouldSplit||(yt.min[2]=yt.max[2]=yt.center[2]=this._centerAltitude))},Qt=(nt,Nt)=>{if(.707*Nt<nt)return 1;const yt=Nt/nt;return yt/(1.4144271570014144+(Math.pow(1.1,yt-1.4144271570014144+1)-1)/(1.1-1)-1)},mt=nt=>{if(nt.zoom<je)return!0;if(nt.zoom===ot)return!1;if(nt.shouldSplit!=null)return nt.shouldSplit;const Nt=nt.aabb.distanceX(ye),yt=nt.aabb.distanceY(ye);let $t=gt,nr=1;if(Q){$t=nt.aabb.distanceZ(ye);const mr=Math.pow(2,nt.zoom),$r=i.a_((nt.y+1)/mr),jn=i.a_(nt.y/mr),Fn=Math.min(Math.max(z,$r),jn),Ei=i.d0(Fn)/i.d0(z);if(nr=Fn===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ei/this._mercatorScaleRatio),this.zoom<=i.cZ&&nt.zoom===ot-1&&Ei>=.9)return!0}else if(j&&($t=nt.aabb.distanceZ(ye)*ue),this.projection.isReprojectedInTileSpace&&_<=5){const mr=Math.pow(2,nt.zoom),$r=Ue(new i.ae((nt.x+.5)/mr,(nt.y+.5)/mr));nr=$r>.85?1:$r}if(!k&&!Q){const mr=Math.sqrt(Nt*Nt+yt*yt+$t*$t);let $r=(1<<ot-nt.zoom)*Ne*nr;return $r*=Qt(Math.max($t,gt),mr),mr<$r}let xr=Number.MAX_VALUE,Xt=0;const tr=nt.aabb.getCorners(),wr=[];for(const mr of tr){i.av(wr,mr,ye),Q||(j?wr[2]*=ue:wr[2]=gt);const $r=i.bI(wr,this._camera.forward());$r<xr&&(xr=$r,Xt=Math.abs(wr[2]))}let pr=(1<<ot-nt.zoom)*Ne*nr;if(pr*=Qt(Math.max(Xt,gt),xr),xr<pr)return!0;const dr=nt.aabb.closestPoint(Z);return dr[0]===Z[0]&&dr[1]===Z[1]};if(this.renderWorldCopies)for(let nt=1;nt<=3;nt++)Ze.push(De(-nt)),Ze.push(De(nt));for(Ze.push(De(0));Ze.length>0;){const nt=Ze.pop(),Nt=nt.x,yt=nt.y;let $t=nt.fullyVisible;const nr=()=>this.projection.name==="globe"&&(nt.y===0||nt.y===(1<<nt.zoom)-1);if(!$t){let xr=Ee?nt.aabb.intersects(se):nt.aabb.intersectsFlat(se);if(xr===0&&nr()){const Xt=new i.cC(nt.zoom,Nt,yt);xr=i.cD(this,G,Xt,!0).intersects(se)}if(xr===0)continue;$t=xr===2}if(nt.zoom!==ot&&mt(nt))for(let xr=0;xr<4;xr++){const Xt=(Nt<<1)+xr%2,tr=(yt<<1)+(xr>>1),wr={aabb:k?nt.aabb.quadrant(xr):i.cE(this,G,nt.zoom+1,Xt,tr,nt.wrap,nt.minZ,nt.maxZ,this.projection),zoom:nt.zoom+1,x:Xt,y:tr,wrap:nt.wrap,fullyVisible:$t,tileID:void 0,shouldSplit:void 0,minZ:nt.minZ,maxZ:nt.maxZ};j&&!Q&&(wr.tileID=new i.aP(nt.zoom+1===ot?St:nt.zoom+1,nt.wrap,nt.zoom+1,Xt,tr),kt(wr)),Ze.push(wr)}else{const xr=nt.zoom===ot?St:nt.zoom;if(l.minzoom&&l.minzoom>xr)continue;let Xt=0;if(!$t){let dr=Ee?nt.aabb.intersectsPrecise(se):nt.aabb.intersectsPreciseFlat(se);if(dr===0&&nr()){const mr=new i.cC(nt.zoom,Nt,yt);dr=i.cD(this,G,mr,!0).intersectsPrecise(se)}if(dr===0)continue;if(l.calculateQuadrantVisibility)if(se.containsPoint(nt.aabb.center))Xt=15;else for(let mr=0;mr<4;mr++)nt.aabb.quadrant(mr).intersects(se)!==0&&(Xt|=1<<mr)}const tr=Z[0]-(.5+Nt+(nt.wrap<<nt.zoom))*(1<<f-nt.zoom),wr=Z[1]-.5-yt,pr=nt.tileID?nt.tileID:new i.aP(xr,nt.wrap,nt.zoom,Nt,yt);l.calculateQuadrantVisibility&&(pr.visibleQuadrants=Xt),ut.push({tileID:pr,distanceSq:tr*tr+wr*wr})}}if(this.fogCullDistSq){const nt=this.fogCullDistSq,Nt=this.horizonLineFromTop();ut=ut.filter(yt=>{const $t=[0,0,0,1],nr=[i.al,i.al,0,1],xr=this.calculateFogTileMatrix(yt.tileID.toUnwrapped());i.aC($t,$t,xr),i.aC(nr,nr,xr);const Xt=i.cF([],$t,nr),tr=i.cG([],$t,nr),wr=i.c_(Xt,tr);if(wr===0)return!0;let pr=!1;const dr=this._elevation;if(dr&&wr>nt&&Nt!==0){const mr=this.calculateProjMatrix(yt.tileID.toUnwrapped());let $r;l.isTerrainDEM||($r=dr.getMinMaxForTile(yt.tileID)),$r||($r={min:Ie,max:qe});const jn=i.cH(this.rotation),Fn=[jn[0]*i.al,jn[1]*i.al,$r.max];i.af(Fn,Fn,mr),pr=(1-Fn[1])*this.height*.5<Nt}return wr<nt||pr})}return ut.sort((nt,Nt)=>nt.distanceSq-Nt.distanceSq).map(nt=>nt.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log2(l)}project(l){const f=i.aA(l.lat,-i.cI,i.cI),_=this.projection.project(l.lng,f);return new i.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,f){let _,E;const j=this.centerPoint;if(this.projection.name==="globe"){const L=this.worldSize;_=(f.x-j.x)/L,E=(f.y-j.y)/L}else{const L=this.pointCoordinate(f),z=this.pointCoordinate(j);_=L.x-z.x,E=L.y-z.y}const k=this.locationCoordinate(l);this.setLocation(new i.ae(k.x-_,k.y-E))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l,f){return this.projection.locationPoint(this,l,f)}locationPoint3D(l,f){return this.projection.locationPoint(this,l,f,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l,f){return this.coordinateLocation(this.pointCoordinate3D(l,f))}locationCoordinate(l,f){const _=f?i.ce(f,l.lat):void 0,E=this.projection.project(l.lng,l.lat);return new i.ae(E.x,E.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,f){const _=f??this._centerAltitude,E=[l.x,l.y,0,1],j=[l.x,l.y,1,1];i.aC(E,E,this.pixelMatrixInverse),i.aC(j,j,this.pixelMatrixInverse);const k=j[3];i.cJ(E,E,1/E[3]),i.cJ(j,j,1/k);const L=E[2],z=j[2];return{p0:E,p1:j,t:L===z?0:(_-L)/(z-L)}}screenPointToMercatorRay(l){const f=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return i.aC(f,f,this.pixelMatrixInverse),i.aC(_,_,this.pixelMatrixInverse),i.cJ(f,f,1/f[3]),i.cJ(_,_,1/_[3]),f[2]=i.ce(f[2],this._center.lat)*this.worldSize,_[2]=i.ce(_[2],this._center.lat)*this.worldSize,i.cJ(f,f,1/this.worldSize),i.cJ(_,_,1/this.worldSize),new i.ax([f[0],f[1],f[2]],i.aw([],i.av([],_,f)))}rayIntersectionCoordinate(l){const{p0:f,p1:_,t:E}=l,j=i.ce(f[2],this._center.lat),k=i.ce(_[2],this._center.lat);return new i.ae(i.ak(f[0],_[0],E)/this.worldSize,i.ak(f[1],_[1],E)/this.worldSize,i.ak(j,k,E))}pointCoordinate(l,f=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,f)}pointCoordinate3D(l,f){if(!this.elevation)return this.pointCoordinate(l,f);let _=this.projection.pointCoordinate3D(this,l.x,l.y);if(_)return new i.ae(_[0],_[1],_[2]);let E=0,j=this.horizonLineFromTop();if(l.y>j)return this.pointCoordinate(l,f);const k=.02*j,L=l.clone();for(let z=0;z<10&&j-E>k;z++){L.y=i.ak(E,j,.66);const G=this.projection.pointCoordinate3D(this,L.x,L.y);G?(j=L.y,_=G):E=L.y}return _?new i.ae(_[0],_[1],_[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=i.cK)return!this.isPointAboveHorizon(l);const f=this.pointCoordinate(l);return f.y>=0&&f.y<=1}_coordinatePoint(l,f){const _=f&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,E=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return i.aC(E,E,this.pixelMatrix),E[3]>0?new i.P(E[0]/E[3],E[1]/E[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,j=this.pointLocation3D(new i.P(f,l)),k=this.pointLocation3D(new i.P(E,l)),L=this.pointLocation3D(new i.P(E,_)),z=this.pointLocation3D(new i.P(f,_));let G=Math.min(j.lng,k.lng,L.lng,z.lng),Z=Math.max(j.lng,k.lng,L.lng,z.lng),Q=Math.min(j.lat,k.lat,L.lat,z.lat),X=Math.max(j.lat,k.lat,L.lat,z.lat);const se=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,ue=(_e,ye,Ee,Ne,je)=>{const qe=(_e+Ee)/2,Ie=(ye+Ne)/2,Ge=new i.P(qe,Ie),{lng:Ue,lat:De}=this.pointLocation3D(Ge),Ze=Math.max(0,G-Ue,Q-De,Ue-Z,De-X);G=Math.min(G,Ue),Z=Math.max(Z,Ue),Q=Math.min(Q,De),X=Math.max(X,De),(je<le||Ze>se)&&(ue(_e,ye,qe,Ie,je+1),ue(qe,Ie,Ee,Ne,je+1))};if(ue(f,l,E,l,1),ue(E,l,E,_,1),ue(E,_,f,_,1),ue(f,_,f,l,1),this.projection.name==="globe"){const[_e,ye]=i.cL(this);_e?(X=90,Z=180,G=-180):ye&&(Q=-90,Z=180,G=-180)}return new i.aI(new i.aS(G,Q),new i.aS(Z,X))}_getBoundsRectangular(l,f){const{top:_,left:E}=this._edgeInsets,j=this.height-this._edgeInsets.bottom,k=this.width-this._edgeInsets.right,L=new i.P(E,_),z=new i.P(k,_),G=new i.P(k,j),Z=new i.P(E,j);let Q=this.pointCoordinate(L,l),X=this.pointCoordinate(z,l);const se=this.pointCoordinate(G,f),le=this.pointCoordinate(Z,f),ue=(_e,ye)=>(ye.y-_e.y)/(ye.x-_e.x);return Q.y>1&&X.y>=0?Q=new i.ae((1-le.y)/ue(le,Q)+le.x,1):Q.y<0&&X.y<=1&&(Q=new i.ae(-le.y/ue(le,Q)+le.x,0)),X.y>1&&Q.y>=0?X=new i.ae((1-se.y)/ue(se,X)+se.x,1):X.y<0&&Q.y<=1&&(X=new i.ae(-se.y/ue(se,X)+se.x,0)),new i.aI().extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(se))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=l.visibleDemTiles.reduce((_,E)=>{if(E.dem){const j=E.dem.tree;_.min=Math.min(_.min,j.minimums[0]),_.max=Math.max(_.max,j.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*l.exaggeration(),f.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-f*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-i.cI,this.maxLat=i.cI,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,f){return this.projection.createTileMatrix(this,f,l)}calculateDistanceTileData(l){const f=l.key,_=this._distanceTileDataCache;if(_[f])return _[f];const E=l.canonical,j=1/this.height,k=this.cameraWorldSize,L=k/this.zoomScale(E.z),z=(E.x+Math.pow(2,E.z)*l.wrap)*L,G=E.y*L,Z=this.point;Z.x*=k/this.worldSize,Z.y*=k/this.worldSize;const Q=this.angle,X=Math.sin(-Q),se=-Math.cos(-Q);return _[f]={bearing:[X,se],center:[(Z.x-z)*j,(Z.y-G)*j],scale:L/i.al*j},_[f]}calculateFogTileMatrix(l){const f=l.key,_=this._fogTileMatrixCache;if(_[f])return _[f];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return i.aB(E,this.worldToFogMatrix,E),_[f]=new Float32Array(E),_[f]}calculateProjMatrix(l,f=!1,_=!1){const E=l.key;let j;if(j=_?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,j[E])return j[E];const k=this.calculatePosMatrix(l,this.worldSize);let L;return L=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,i.aB(k,L,k),j[E]=new Float32Array(k),j[E]}calculatePixelsToTileUnitsMatrix(l){const f=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[f])return _[f];const E=i.cM(l,this);return _[f]=E,_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,f=i.bp([],[l,l,l]);return i.aB(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const f=i.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),E=this._camera.forward(),j=i.ce(1,this._center.lat);_[2]/=j,E[2]/=j,i.aw(E,E);const k=l.raycast(_,E,l.exaggeration());if(k){const L=i.bG([],_,E,k),z=new i.ae(L[0],L[1],i.ce(L[2],i.a_(L[1]))),G=(z.z+i.ag([z.x-_[0],z.y-_[1],z.z-_[2]*j]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const f=this._elevation,_=i.ce(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(_),j=f.getAtPointOrZero(new i.ae(...E)),k=this.pixelsPerMeter/this.worldSize*j,L=this._minimumHeightOverTerrain(),z=E[2]-k;if(z<=L)if(z<0||l){const G=this.locationCoordinate(this._center,this._centerAltitude),Z=[E[0],E[1],G.z-E[2]],Q=i.ag(Z);Z[2]-=(L-z)/this._pixelsPerMercatorPixel;const X=i.ag(Z);if(X===0)return;i.c4(Z,Z,Q/X*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],G.z*this._pixelsPerMercatorPixel-Z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const X=this.center;return X.lat=i.aA(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(X.lng=i.aA(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const f=this._unmodified,{x:_,y:E}=this.point;let j=0,k=_,L=E;const z=this.width/2,G=this.height/2,Z=this.worldMinY*this.scale,Q=this.worldMaxY*this.scale;if(E-G<Z&&(L=Z+G),E+G>Q&&(L=Q-G),Q-Z<this.height&&(j=Math.max(j,this.height/(Q-Z)),L=(Q+Z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,le=this.worldSize/2-(X+se)/2;k=(_+le+this.worldSize)%this.worldSize-le,k-z<X&&(k=X+z),k+z>se&&(k=se-z),se-X<this.width&&(j=Math.max(j,this.width/(se-X)),k=(se+X)/2)}k===_&&L===E||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(k,L))),j&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(j)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ce(1,this.center.lat)/i.ce(1,i.d1));const E=i.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,E),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const j=this.projection.zAxisUnit==="meters"?_:1,k=this._camera.getWorldToCamera(this.worldSize,j);let L;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-l.x/this.width,z[9]=2*l.y/this.height,this.isOrthographic){let De=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ze=De*this.aspect,ut=-Ze,ot=-De;Ze-=l.x,ut-=l.x,De+=l.y,ot+=l.y,L=this._camera.getCameraToClipOrthographic(ut,Ze,ot,De,this._nearZ,this._farZ),((St,gt,kt,Qt)=>{for(let mt=0;mt<16;mt++)St[mt]=i.ak(gt[mt],kt[mt],Qt)})(L,L,z,i.c$(this.pitch>=hf?1:this.pitch/hf))}else L=z;const G=i.cO([],z,k);let Z=i.cO([],L,k);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),Ze=i.bz([]);i.bq(Ze,Ze,[De.x*this.worldSize,De.y*this.worldSize,0]),i.aB(Ze,Ze,i.cP(this)),i.bq(Ze,Ze,[-De.x*this.worldSize,-De.y*this.worldSize,0]),i.aB(Z,Z,Ze),i.aB(G,G,Ze),this.inverseAdjustmentMatrix=i.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cR([],Z,[this.worldSize,this.worldSize,this.worldSize/j,1]),this.projMatrix=Z,this.invProjMatrix=i.bk(new Float64Array(16),this.projMatrix),f){const De=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);De[8]=2*-l.x/this.width,De[9]=2*l.y/this.height,this.expandedFarZProjMatrix=i.cO([],De,k)}else this.expandedFarZProjMatrix=this.projMatrix;const Q=i.bk([],L);this.frustumCorners=i.cS.fromInvProjectionMatrix(Q,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const X=new Float32Array(16);i.bz(X),i.cR(X,X,[1,-1,1]),i.cT(X,X,this._pitch),i.bA(X,X,this.angle);const se=i.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.by(se);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;se[8]=2*-l.x/this.width,se[9]=2*(l.y+le)/this.height,this.skyboxMatrix=i.aB(X,se,X);const ue=this.point,_e=ue.x,ye=ue.y,Ee=this.width%2/2,Ne=this.height%2/2,je=Math.cos(this.angle),qe=Math.sin(this.angle),Ie=_e-Math.round(_e)+je*Ee+qe*Ne,Ge=ye-Math.round(ye)+je*Ne+qe*Ee,Ue=new Float64Array(Z);if(i.bq(Ue,Ue,[Ie>.5?Ie-1:Ie,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Ue,Z=i.bB(),i.cR(Z,Z,[this.width/2,-this.height/2,1]),i.bq(Z,Z,[1,-1,0]),this.labelPlaneMatrix=Z,Z=i.bB(),i.cR(Z,Z,[1,-1,1]),i.bq(Z,Z,[-1,-1,0]),i.cR(Z,Z,[2/this.width,2/this.height,1]),this.glCoordMatrix=Z,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},Z=i.bk(new Float64Array(16),this.pixelMatrix),!Z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cU(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(De,De,k),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,_=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,j=[l,l,f];i.c4(j,j,E),i.c4(_,_,-1),i.cV(_,_,j);const k=i.bB();i.bq(k,k,_),i.cR(k,k,j),this.mercatorFogMatrix=k,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,f,E)}_computeCameraPosition(l){const f=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),E=this.point,j=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-l/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-_[0]*j,E.y/this.worldSize-_[1]*j,l/this.worldSize*this._centerAltitude-_[2]*j]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],E=l[2];let j=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(j=Math.min((f-_)/E,1)),this._camera.position=i.bG([],this._camera.position,l,j),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,f=this._camera.forward(),{pitch:_,bearing:E}=this._camera.getPitchBearing(),j=i.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,k=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),L=Math.max((l[2]-j)/Math.cos(_),k),z=this._zoomFromMercatorZ(L);i.bG(l,l,f,L),this._pitch=i.aA(_,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bS(E,-Math.PI,Math.PI),this._setZoom(i.aA(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,l)*this.tileSize))}zoomFromMercatorZAdjusted(l){let f=0,_=i.cK,E=0,j=1/0;for(;_-f>1e-6&&_>f;){const k=f+.5*(_-f),L=this.tileSize*Math.pow(2,k),z=this.getCameraToCenterDistance(this.projection,k,L),G=this.scaleZoom(z/(Math.max(0,l)*this.tileSize)),Z=Math.abs(k-G);Z<j&&(j=Z,E=k),k<G?f=k:_=k}return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,f){const _=Math.min(l.x,f.x),E=Math.max(l.x,f.x),j=Math.min(l.y,f.y),k=Math.max(l.y,f.y);if(j<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const L=[new i.P(_,j),new i.P(E,k),new i.P(_,k),new i.P(E,j)],z=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const Z of L){const Q=this.pointRayIntersection(Z);if(Q.t<0)return!0;const X=this.rayIntersectionCoordinate(Q);if(X.x<z||X.y<0||X.x>G||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(l,f){const _=i.ag(i.av([],this._camera.position,l)),E=this._zoomFromMercatorZ(_)+f;return _-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([f,_,E],j){const k=[f,_,E,1];i.aC(k,k,j);const L=k[3]=Math.max(k[3],1e-6);return k[0]/=L,k[1]/=L,k[2]/=L,k}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,l))}}getCameraToCenterDistance(l,f=this.zoom,_=this.worldSize){const E=i.cN(l,f,this.width,this.height,1024),j=l.pixelSpaceConversion(this.center.lat,_,E);let k=.5/Math.tan(.5*this._fov)*this.height*j;return this.isOrthographic&&(k=i.ak(1,k,i.c$(this.pitch>=hf?1:this.pitch/hf))),k}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(l,l,this.globeMatrix),l}getFrustum(l){return i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const ld=(v,l)=>{if(l>0&&v.terrain&&i.w("Cutoff is currently disabled on terrain"),l<=0||v.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=v.transform,_=Math.max(Math.abs(f._zoom-(v.minCutoffZoom-1)),1),E=f.isLODDisabled(!1)?i.ah(60,45,f.pitch):i.ah(30,15,f.pitch),j=f._farZ-f._nearZ,k=l*f.height,L=((1-(z=E))*f.cameraToCenterDistance+z*(f._farZ+k))*_;var z;return{shouldRenderCutoff:E<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(L-f._nearZ)/j,(L-k-f._nearZ)/j]}}},Za={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class KI{constructor(l,f){this.aabb=l,this.lastCascade=f}}class ZI{add(l,f){const _=this.receivers[l.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],f.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],f.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],f.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],f.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],f.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],f.max[2])):this.receivers[l.key]=new KI(f,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,f,_){const E=i.d8.fromPoints(l.points);let j=0;for(const k in this.receivers){const L=this.receivers[k];if(!L||!E.intersectsAabb(L.aabb))continue;L.aabb.min=E.closestPoint(L.aabb.min),L.aabb.max=E.closestPoint(L.aabb.max);const z=L.aabb.getCorners();for(let G=0;G<_.length;G++){let Z=!0;for(const Q of z){const X=[Q[0]*f,Q[1]*f,Q[2]];if(i.af(X,X,_[G].matrix),X[0]<-1||X[0]>1||X[1]<-1||X[1]>1){Z=!1;break}}if(L.lastCascade=G,j=Math.max(j,G),Z)break}}return j+1}}class Qg{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ZI,this._depthMode=new Er(l.context.gl.LEQUAL,Er.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(Za,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(Za,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(Za,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,f){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!f||!f.properties)return;const E=f.properties.get("shadow-intensity");if(!f.shadowsEnabled()||E<=0||(this._shadowLayerCount=_.style.order.reduce((le,ue)=>{const _e=_.style._mergedLayers[ue];return le+(_e.hasShadowPass()&&!_e.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const j=_.context,k=Za.shadowMapResolution,L=Za.shadowMapResolution;if(this._cascades.length===0||Za.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<Za.cascadeCount;++le){const ue=_._shadowMapDebug,_e=j.gl,ye=j.createFramebuffer(k,L,ue,"texture"),Ee=new i.T(j,{width:k,height:L,data:null},_e.DEPTH_COMPONENT16);if(ye.depthAttachment.set(Ee.texture),ue){const Ne=new i.T(j,{width:k,height:L,data:null},_e.RGBA8);ye.colorAttachment.set(Ne.texture)}this._cascades.push({framebuffer:ye,texture:Ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cA,scale:0})}}this.shadowDirection=iA(f);let z=0;if(l.elevation){const le=l.elevation,ue=[1e4,-1e4];le.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const ye=_e.dem.tree;ue[0]=Math.min(ue[0],ye.minimums[0]),ue[1]=Math.max(ue[1],ye.maximums[0])}),ue[0]!==1e4&&(z=(ue[1]-ue[0])*le.exaggeration())}const G=1.5*l.cameraToCenterDistance,Z=3*G,Q=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const ue=this._cascades[le];let _e=l.height/50,ye=1;Za.cascadeCount===1?ye=Z:le===0?ye=G:(_e=G,ye=Z);const[Ee,Ne]=sA(l,this.shadowDirection,_e,ye,Za.shadowMapResolution,z);ue.scale=l.scale,ue.matrix=Ee,ue.boundingSphereRadius=Ne,i.bk(Q,ue.matrix),ue.frustum=i.cA.fromInvProjectionMatrix(Q,1,0,!0),ue.far=ye}const X=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[X].far,this._cascades[X].far],this._uniformValues.u_shadow_intensity=E,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Za.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Za.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ka.ShadowMap0,this._uniformValues.u_shadowmap_1=Ka.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const se=_.transform.elevation;for(const le of this._groundShadowTiles){let ue={min:0,max:0};if(se){const _e=se.getMinMaxForTile(le);_e&&(ue=_e)}this.addShadowReceiver(le.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,f){if(!this.enabled)return;const _=this.painter,E=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),E.viewport.set([0,0,Za.shadowMapResolution,Za.shadowMapResolution]);for(let j=0;j<this._numCascadesToRender;++j){_.currentShadowCascade=j,E.bindFramebuffer.set(this._cascades[j].framebuffer.framebuffer),E.clear({color:i.ao.white,depth:1});for(const k of l.order){const L=l._mergedLayers[k];if(!L.hasShadowPass()||L.isHidden(_.transform.zoom))continue;const z=l.getLayerSourceCache(L),G=z?f[z.id]:void 0;(L.type==="model"||G&&G.length)&&_.renderLayer(_,z,L,G)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,f=l.style,_=l.context,E=_.gl,j=f.directionalLight,k=f.ambientLight;if(!j||!k)return;const L=[],z=ld(l,l.longestCutoffRange);z.shouldRenderCutoff&&L.push("RENDER_CUTOFF"),L.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&L.push("NORMAL_OFFSET");const G=Ac(f,j,k),Z=new Er(E.LEQUAL,Er.ReadOnly,l.depthRangeFor3D),Q=new rn({func:E.EQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.KEEP);for(const X of this._groundShadowTiles){const se=X.toUnwrapped(),le=l.isTileAffectedByFog(X),ue=l.getOrCreateProgram("groundShadow",{defines:L,overrideFog:le});this.setupShadows(se,ue),l.uploadCommonUniforms(_,ue,se,null,z);const _e={u_matrix:l.transform.calculateProjMatrix(se),u_ground_shadow_factor:G};ue.draw(l,E.TRIANGLES,Z,Q,yn.multiply,Xr.disabled,_e,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,null,l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?yn.unblended:yn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const f=this.painter.transform,_=f.calculatePosMatrix(l,f.worldSize);return i.aB(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(l){const f=i.by(l);return i.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,l),f}setupShadows(l,f,_){if(!this.enabled)return;const E=this.painter.transform,j=this.painter.context,k=j.gl,L=this._uniformValues,z=new Float64Array(16),G=E.calculatePosMatrix(l,E.worldSize);for(let Z=0;Z<this._cascades.length;Z++)i.aB(z,this._cascades[Z].matrix,G),L[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),j.activeTexture.set(k.TEXTURE0+Ka.ShadowMap0+Z),this._cascades[Z].texture.bindExtraParam(k.LINEAR,k.LINEAR,k.CLAMP_TO_EDGE,k.CLAMP_TO_EDGE,k.GREATER);if(this.useNormalOffset=!!_,this.useNormalOffset){const Z=i.d6(l.canonical),Q=2/E.tileSize*i.al/Za.shadowMapResolution,X=Q*this._cascades[0].boundingSphereRadius,se=Q*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(_==="vector-tile"?1:3)*function(ue,_e,ye,Ee,Ne){const je=i.aA((ue-22)/-22,0,1);return .125*(1-je)+4*je}(E.zoom);L.u_shadow_normal_offset=[Z,X*le,se*le],L.u_shadow_bias=[1e-4,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(j,L)}setupShadowsFromMatrix(l,f,_=!1){if(!this.enabled)return;const E=this.painter.context,j=E.gl,k=this._uniformValues,L=new Float64Array(16);for(let z=0;z<Za.cascadeCount;z++)i.aB(L,this._cascades[z].matrix,l),k[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),E.activeTexture.set(j.TEXTURE0+Ka.ShadowMap0+z),this._cascades[z].texture.bindExtraParam(j.LINEAR,j.LINEAR,j.CLAMP_TO_EDGE,j.CLAMP_TO_EDGE,j.GREATER);if(this.useNormalOffset=_,_){const z=Za.normalOffset;k.u_shadow_normal_offset=[1,z,z],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(E,k)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,f,_,E){if(E[2]>=0)return{};const j=function(z,G,Z){const Q=Z/(1<<z.canonical.z);return new i.d8([z.canonical.x*Q+z.wrap*Z,z.canonical.y*Q+z.wrap*Z,0],[(z.canonical.x+1)*Q+z.wrap*Z,(z.canonical.y+1)*Q+z.wrap*Z,G])}(l,f,_).getCorners(),k=f/-E[2];E[0]<0?(i.d7(j[0],j[0],[E[0]*k,0,0]),i.d7(j[3],j[3],[E[0]*k,0,0])):E[0]>0&&(i.d7(j[1],j[1],[E[0]*k,0,0]),i.d7(j[2],j[2],[E[0]*k,0,0])),E[1]<0?(i.d7(j[0],j[0],[0,E[1]*k,0]),i.d7(j[1],j[1],[0,E[1]*k,0])):E[1]>0&&(i.d7(j[2],j[2],[0,E[1]*k,0]),i.d7(j[3],j[3],[0,E[1]*k,0]));const L={};return L.vertices=j,L.planes=[Jd(j[1],j[0],j[4]),Jd(j[2],j[1],j[5]),Jd(j[3],j[2],j[6]),Jd(j[0],j[3],j[7])],L}addShadowReceiver(l,f,_){this._receivers.add(l,i.d8.fromTileIdAndHeight(l,f,_))}getMaxCascadeForTile(l){const f=this._receivers.get(l);return f&&f.lastCascade?f.lastCascade:0}}function Jd(v,l,f){const _=i.av([],f,l),E=i.av([],v,l),j=i.bH([],_,E),k=i.ag(j);return k===0?[0,0,1,0]:(i.c4(j,j,1/k),[j[0],j[1],j[2],-i.bI(j,l)])}function iA(v){const l=v.properties.get("direction"),f=i.d3(l.x,l.y,l.z);f[2]=i.aA(f[2],0,75);const _=i.d5([f[0],f[1],f[2]]);return i.d4(_.x,_.y,_.z)}function Ac(v,l,f){const _=l.properties.get("color-use-theme")==="none",E=l.properties.get("color"),j=l.properties.get("intensity"),k=l.properties.get("direction"),L=[k.x,k.y,k.z],z=f.properties.get("color-use-theme")==="none",G=f.properties.get("color"),Z=f.properties.get("intensity"),Q=Math.max(i.bI([0,0,1],L),0),X=[0,0,0];i.c4(X,G.toPremultipliedRenderColor(z?null:v.getLut(l.scope)).toArray01Linear().slice(0,3),Z);const se=[0,0,0];return i.c4(se,E.toPremultipliedRenderColor(_?null:v.getLut(f.scope)).toArray01Linear().slice(0,3),Q*j),i.da([X[0]>0?X[0]/(X[0]+se[0]):0,X[1]>0?X[1]/(X[1]+se[1]):0,X[2]>0?X[2]/(X[2]+se[2]):0])}function sA(v,l,f,_,E,j){const k=v.zoom,L=v.scale,z=v.worldSize,G=1/z,Z=v.aspect,Q=Math.sqrt(1+Z*Z)*Math.tan(.5*v.fovX),X=Q*Q,se=_-f,le=_+f;let ue,_e;X>se/le?(ue=_,_e=_*Q):(ue=.5*le*(1+X),_e=.5*Math.sqrt(se*se+2*(_*_+f*f)*X+le*le*X*X));const ye=v.projection.pixelsPerMeter(v.center.lat,z),Ee=v._camera.getCameraToWorldMercator(),Ne=[0,0,-ue*G];i.af(Ne,Ne,Ee);let je=_e*G;const qe=v._edgeInsets;if(!(qe.left===0&&qe.top===0&&qe.right===0&&qe.bottom===0||qe.left===qe.right&&qe.top===qe.bottom)){const $t=v._camera.getWorldToCamera(v.worldSize,v.projection.zAxisUnit==="meters"?ye:1),nr=v._camera.getCameraToClipPerspective(v._fov,v.width/v.height,f,_);nr[8]=2*-v.centerOffset.x/v.width,nr[9]=2*v.centerOffset.y/v.height;const xr=new Float64Array(16);i.cO(xr,nr,$t);const Xt=new Float64Array(16);i.bk(Xt,xr);const tr=i.cA.fromInvProjectionMatrix(Xt,z,k,!0);for(const wr of tr.points){const pr=((Ie=wr)[0]/=L,Ie[1]/=L,Ie[2]=i.ce(Ie[2],v._center.lat),Ie);je=Math.max(je,i.c5(i.d9([],Ne,pr)))}}var Ie;je*=E/(E-1);const Ge=Math.acos(l[2]),Ue=Math.atan2(-l[0],-l[1]),De=new m_;De.position=Ne,De.setPitchBearing(Ge,Ue);const Ze=De.getWorldToCamera(z,ye),ut=je*z,ot=Math.min(v._mercatorZfromZoom(17)*z*-2,-2*ut),St=De.getCameraToClipOrthographic(-ut,ut,-ut,ut,ot,(ut+j*ye)/l[2]),gt=new Float64Array(16);i.aB(gt,St,Ze);const kt=i.d4(Math.floor(1e6*Ne[0])/1e6*z,Math.floor(1e6*Ne[1])/1e6*z,0),Qt=.5*E,mt=[0,0,0];i.af(mt,kt,gt),i.c4(mt,mt,Qt);const nt=[Math.floor(mt[0]),Math.floor(mt[1]),Math.floor(mt[2])],Nt=[0,0,0];i.av(Nt,mt,nt),i.c4(Nt,Nt,-1/Qt);const yt=new Float64Array(16);return i.bz(yt),i.bq(yt,yt,Nt),i.aB(gt,yt,gt),[gt,ut]}class g_ extends i.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(l,f){return i.db(this.requestManager.transformRequest(f,i.R.Model).url).then(_=>{if(!_)return;const E=i.dc(_),j=new i.dd(l,f,void 0,void 0,E);return j.computeBoundsAndApplyParent(),j}).catch(_=>{if(_&&_.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${l} from ${f}: ${_.message}`)))})}load(l,f,_={forceReload:!1}){this.models[f]||(this.models[f]={});const E=Object.keys(l),j=[],k=[];for(const L of E){const z=l[L];this.hasURLBeenRequested(z)&&!_.forceReload||(this.modelByURL[z]={modelId:L,scope:f},j.push(this.loadModel(L,z)),k.push(L)),this.models[f][L]||(this.models[f][L]={model:null,numReferences:1})}this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+k.length,Promise.allSettled(j).then(L=>{for(let z=0;z<L.length;z++){const{status:G}=L[z];if(G==="rejected")continue;const{value:Z}=L[z];this.models[f][k[z]]||(this.models[f][k[z]]={model:null,numReferences:1}),this.models[f][k[z]].model=Z}this.numModelsLoading[f]-=k.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(L=>{this.fire(new i.y(new Error(`Could not load models: ${L.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,f,_={exactIdMatch:!1}){return!!(_.exactIdMatch?this.getModel(l,f):this.getModelByURL(this.modelUris[f][l]))}getModel(l,f){return this.models[f]||(this.models[f]={}),this.models[f][l]?this.models[f][l].model:void 0}getModelByURL(l){if(!l)return null;const f=this.modelByURL[l];return f?this.models[f.scope][f.modelId].model:null}hasModelBeenAdded(l,f){return this.models[f]&&this.models[f][l]!==void 0}getModelURIs(l){return this.modelUris[l]||{}}addModel(l,f,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={});const E=this.requestManager.normalizeModelURL(f);if((this.hasModel(l,_,{exactIdMatch:!0})||this.hasModelBeenAdded(l,_))&&this.modelUris[_][l]===E)this.models[_][l].numReferences++;else if(this.hasURLBeenRequested(E)){const{scope:j,modelId:k}=this.modelByURL[E];this.models[j][k].numReferences++}else this.modelUris[_][l]=E,this.load({[l]:this.modelUris[_][l]},_)}addModelURLs(l,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const _=this.modelUris[f];for(const E in l)_[E]=this.requestManager.normalizeModelURL(l[E])}reloadModels(l){this.load(this.modelUris[l],l,{forceReload:!0})}addModelsFromBucket(l,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const _={};for(const E of l)this.hasModel(E,f,{exactIdMatch:!0})||this.hasURLBeenRequested(E)?this.models[f][E].numReferences++:this.modelUris[f][E]&&!this.hasURLBeenRequested(E)?_[E]=this.modelUris[f][E]:!this.hasURLBeenRequested(E)&&i.de(E,!1)&&(this.modelUris[f][E]=this.requestManager.normalizeModelURL(E),_[E]=this.modelUris[f][E]);this.load(_,f)}hasURLBeenRequested(l){return this.modelByURL[l]!==void 0}removeModel(l,f,_=!1,E=!1){if(this.models[f]&&this.models[f][l]&&(this.models[f][l].numReferences--,this.models[f][l].numReferences===0||E)){const j=this.modelUris[f][l];_||delete this.modelUris[f][l],delete this.modelByURL[j];const k=this.models[f][l].model;if(!k)return;delete this.models[f][l],k.destroy()}}destroy(){for(const l of Object.keys(this.models))for(const f of Object.keys(this.models[l])){const _=this.models[l][f].model;delete this.models[l][f],_&&_.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,f){this.models[f]||(this.models[f]={});for(const _ in this.models[f])this.models[f][_].model&&this.models[f][_].model.upload(l.context)}}const ey=i.a6.colorTheme,Qd=new i.a9({data:new i.aa(ey.data)});function XI(v){if(!v.metadata||!v.metadata.content_area)return;const l=i.o.devicePixelRatio,{left:f,top:_,width:E,height:j}=v.metadata.content_area,k=f*l,L=_*l;return[k,L,k+E*l,L+j*l]}function aA(v){if(v)return v.map(([l,f])=>[l*i.o.devicePixelRatio,f*i.o.devicePixelRatio])}class YI{constructor(l,f,_){this.id=l,this.scope=f,this.sourceCache=_,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(l){this.missingRequests.has(l.name)||this.pendingRequests.has(l.name)||this.pendingRequests.add(l.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const l=new Map;if(!this.sourceCache.loaded())return l;const f=this.sourceCache.getVisibleCoordinates();if(f.length===0)return l;const _=this.sourceCache.getSource();if(!(_ instanceof xa))return l;const E=f.map(k=>this.sourceCache.getTile(k)),j=_.getImages(E,Array.from(this.pendingRequests));for(const[k,L]of j)l.set(i.I.from({name:k,iconsetId:this.id}),L),this.pendingRequests.delete(k);for(const k of this.pendingRequests)this.missingRequests.add(k);return this.pendingRequests.clear(),l}}const eh=(v,l)=>fe(v,l&&l.filter(f=>f.identifier!=="source.canvas")),JI=i.aH(si,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Bw=i.aH(si,["setCenter","setZoom","setBearing","setPitch"]),y_=new Set(["background","sky","slot","custom"]),$w={version:8,layers:[],sources:{}},Uw={duration:300,delay:0};class Cc extends i.E{constructor(l,f={}){super(),this.map=l,this.scope=f.scope||"",this.globalId=null,this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=Object.assign({},Uw),this._buildingIndex=new kw(this),this.crossTileSymbolIndex=new od,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=f.styleChanges||new ir,this.dispatcher=f.dispatcher?f.dispatcher:new i.D(i.dg(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new Rr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new i.dh(l._requestManager,f.localFontFamily?i.di.all:f.localIdeographFontFamily?i.di.ideographs:i.di.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new g_(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._indoorDependentLayers=f.indoorDependentLayers?f.indoorDependentLayers:new Set,this._config=f.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:f.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=f.initialConfig,this.dispatcher.broadcast("setReferrer",i.dj());const _=this;this._rtlTextPluginCallback=Cc.registerForPluginStateChange(E=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(j,k)=>{if(i.dk(j),k&&k.every(L=>L))for(const L in _._sourceCaches){const z=_._sourceCaches[L],G=z.getSource().type;G!=="vector"&&G!=="geojson"||z.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const j=this.getOwnSource(E.sourceId);if(j&&j.vectorLayerIds)for(const k in this._layers){const L=this._layers[k];L.source===j.id&&this._validateLayer(L)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(i.h(l))return l;const f=i.dl(l);if(!f.startsWith("http"))try{return new URL(f,location.href).toString()}catch{return f}return f}return`json://${i.dm(JSON.stringify(l))}`}_diffStyle(l,f,_){this.globalId=this._getGlobalId(l);const E=(j,k)=>{try{k(null,this.setState(j,_))}catch(L){k(L,!1)}};if(typeof l=="string"){const j=this.map._requestManager.normalizeStyleURL(l),k=this.map._requestManager.transformRequest(j,i.R.Style);i.m(k,(L,z)=>{L?this.fire(new i.y(L)):z&&E(z,f)})}else typeof l=="object"&&E(l,f)}loadURL(l,f={}){this.fire(new i.z("dataloading",{dataType:"style"}));const _=typeof f.validate=="boolean"?f.validate:!i.h(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,f.accessToken),this.resolvedImports.add(l);const E=this.importsCache.get(l);if(E)return this._load(E,_);const j=this.map._requestManager.transformRequest(l,i.R.Style);this._request=i.m(j,(k,L)=>{if(this._request=null,k)this.fire(new i.y(k));else if(L)return this.importsCache.set(l,L),this._load(L,_)})}loadJSON(l,f={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=i.o.frame(()=>{this._request=null,this._load(l,f.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load($w,!1)}_loadImports(l,f,_){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const E=[];for(const j of l){const k=this._createFragmentStyle(j),L=new Promise(Z=>{k.once("style.import.load",Z),k.once("error",Z)}).then(()=>this.mergeAll());if(E.push(L),this.resolvedImports.has(j.url)){k.loadEmpty();continue}const z=j.data||this.importsCache.get(j.url);z?(k.loadJSON(z,{validate:f}),this._isInternalStyle(z)&&(k.globalId=null)):j.url?k.loadURL(j.url,{validate:f}):k.loadEmpty();const G={style:k,id:j.id,config:j.config};if(_){const Z=this.fragments.findIndex(({id:Q})=>Q===_);this.fragments=this.fragments.slice(0,Z).concat(G).concat(this.fragments.slice(Z))}else this.fragments.push(G)}return Promise.allSettled(E)}getImportGlobalIds(l=this,f=new Set){for(const _ of l.fragments)_.style.globalId&&f.add(_.style.globalId),this.getImportGlobalIds(_.style,f);return[...f.values()]}_createFragmentStyle(l){const f=this.scope?i.B(l.id,this.scope):l.id;let _;const E=this._initialConfig&&this._initialConfig[f];(l.config||E)&&(_=Object.assign({},l.config,E));const j=new Cc(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:l["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return j.setEventedParent(this.map,{style:j}),j}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,f){if(this._isInternalStyle(l)){const j=Object.assign({},$w,{imports:[{id:"basemap",data:l,url:""}]},l.center?{center:l.center}:{},l.bearing?{bearing:l.bearing}:{},l.pitch?{pitch:l.pitch}:{},l.zoom?{zoom:l.zoom}:{},l.light?{light:l.light}:{});return this._importedAsBasemap=!0,void this._load(j,f)}if(this.updateConfig(this._config,l.schema),f&&eh(this,so(l)))return;this._loaded=!0,this.stylesheet=i.dn(l);const _=()=>{for(const z in l.sources)this.addSource(z,l.sources[z],{validate:!1,isInitialLoad:!0});if(l.iconsets)for(const z in l.iconsets)this.addIconset(z,l.iconsets[z]);l.sprite?this._loadIconset(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&l.glyphs&&this.glyphManager.setURL(l.glyphs);const j=bp(this.stylesheet.layers);if(this._order=j.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new et(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new et(this.stylesheet.light)),this._layers={};for(const z of j){const G=i.dt(z,this.scope,this._styleColorTheme.lut,this.options);G.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(G.fqid),G.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(G.fqid),this._hasAppearances=this._hasAppearances||G.getAppearances().length!==0,G.setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G;const Z=this.getOwnLayerSourceCache(G),Q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Z&&G.canCastShadows()&&Q&&(Z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const L=this.isRootStyle();l.imports?this._loadImports(l.imports,f).then(()=>{this._reloadImports(),this.fire(new i.z(L?"style.load":"style.import.load"))}).catch(z=>{this.fire(new i.y(new Error("Failed to load imports",z))),this.fire(new i.z(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(L?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const E=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(E){const j=this._evaluateColorThemeData(E);this._loadColorTheme(j).then(()=>{_()}).catch(k=>{i.w(`Couldn't load color theme from the stylesheet: ${k}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let l,f,_,E,j,k,L,z,G,Z;const Q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(X=>{if(X.stylesheet){if(X.light!=null&&(l=X.light),X.stylesheet.lights)for(const se of X.stylesheet.lights)se.type==="ambient"&&X.ambientLight!=null&&(f=X.ambientLight),se.type==="directional"&&X.directionalLight!=null&&(_=X.directionalLight);E=this._prioritizeTerrain(E,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(j=X.fog),X.stylesheet.snow&&X.snow!=null&&(k=X.snow),X.stylesheet.rain&&X.rain!=null&&(L=X.rain),X.stylesheet.camera!=null&&(Z=X.stylesheet.camera),X.stylesheet.projection!=null&&(z=X.stylesheet.projection),X.stylesheet.transition!=null&&(G=X.stylesheet.transition),Q[X.scope]=X._styleColorTheme}}),this.light=l,this.ambientLight=f,this.directionalLight=_,this.fog=j,this.snow=k,this.rain=L,this._styleColorThemeForScope=Q,E===null?delete this.terrain:this.terrain=E,this.camera=Z||{"camera-projection":"perspective"},this.projection=z||{name:"mercator"},this.transition=Object.assign({},Uw,G),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(l){const f=_=>{for(const E of _.fragments)f(E.style);l(_)};f(this)}_prioritizeTerrain(l,f,_){const E=l&&l.drapeRenderMode===0;return _===null?f&&f.drapeRenderMode===0?f:E?l:null:f!=null&&(!l||E||f&&f.drapeRenderMode===1)?f:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{l=this._prioritizeTerrain(l,f.terrain,f.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(l=f.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},f={},_={};this.forEachFragmentStyle(E=>{for(const j in E._sourceCaches){const k=i.B(j,E.scope);l[k]=E._sourceCaches[j]}for(const j in E._otherSourceCaches){const k=i.B(j,E.scope);f[k]=E._otherSourceCaches[j]}for(const j in E._symbolSourceCaches){const k=i.B(j,E.scope);_[k]=E._symbolSourceCaches[j]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=_}mergeIndoor(){this.forEachFragmentStyle(l=>{if(l.stylesheet&&l.stylesheet.indoor)for(const f of Object.values(l.stylesheet.indoor)){const _=f,E=i.B(_.sourceId,l.scope);this._mergedIndoor[E]=new Set(_.sourceLayers||[])}})}mergeLayers(){const l={},f=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(k=>{for(const L of k._order){const z=k._layers[L];if(z.type==="slot"){const G=i.dp(L);if(l[G])continue;l[G]=[]}z.slot&&l[z.slot]?l[z.slot].push(z):f.push(z)}}),this._mergedOrder=[];let E=-1;const j=(k=[])=>{for(const L of k)if(L.type==="slot"){const z=i.dp(L.id);l[z]&&j(l[z]),this._mergedSlots.push(z)}else{const z=i.B(L.id,L.scope);this._mergedOrder.push(z),_[z]=L,L.is3D(!!this.terrain)&&(this._has3DLayers=!0,E=this._mergedOrder.length-1),L.type==="circle"&&(this._hasCircleLayers=!0),L.type==="symbol"&&(this._hasSymbolLayers=!0),L.type==="clip"&&(this._clipLayerPresent=!0)}};if(j(f),this._has3DLayers){const k={};for(let L=0;L<this._mergedOrder.length;++L){const z=this._mergedOrder[L];k[z]=L===E?1:L<E?_[z].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((L,z)=>k[L]-k[z])}this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(f,_,E,j){const k=Object.assign({},_);for(const z of Object.keys(ey))k[z]===void 0&&(k[z]=ey[z].default);const L=new i.a8(Qd,f,new Map(E));return L.setTransitionOrValue(k,E),L.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const f=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,E)=>{const j="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let k=l;k.startsWith(j)||(k=j+k);const L=i.I.from("mapbox-reserved-lut"),z=new Image;z.src=k,z.onerror=()=>{this._styleColorTheme.lutLoading=!1,E(new Error("Failed to load image data"))},z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==f)return void _();this._styleColorTheme.lutLoading=!1;const{width:G,height:Z,data:Q}=i.o.getImageData(z);if(Z>32)return void E(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==Z*Z)return void E(new Error("The width of the image must be equal to the height squared."));this.getImage(L)&&this.removeImage(L),this.addImage(L,{data:new i.q({width:G,height:Z},Q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const X=this.imageManager.getImage(L,this.scope);X?(this._styleColorTheme.lut={image:X.data,data:l},_()):E(new Error("Missing LUT image."))}})}getLut(l){const f=this._styleColorThemeForScope[l];return f?f.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(f,_,E){let j,k,L;const z=i.o.devicePixelRatio>1?"@2x":"";let G=i.m(_.transformRequest(_.normalizeSpriteURL(f,z,".json"),i.R.SpriteJSON),(X,se)=>{G=null,L||(L=X,j=se,Q())}),Z=i.n(_.transformRequest(_.normalizeSpriteURL(f,z,".png"),i.R.SpriteImage),(X,se)=>{Z=null,L||(L=X,k=se,Q())});function Q(){if(L)E(L);else if(j&&k){const X=i.o.getImageData(k),se={};for(const le in j){const{width:ue,height:_e,x:ye,y:Ee,sdf:Ne,pixelRatio:je,stretchX:qe,stretchY:Ie,content:Ge}=j[le],Ue=new i.q({width:ue,height:_e});i.q.copy(X,Ue,{x:ye,y:Ee},{x:0,y:0},{width:ue,height:_e},null),se[le]={data:Ue,pixelRatio:je!==void 0?je:1,sdf:Ne!==void 0&&Ne,stretchX:qe,stretchY:Ie,content:Ge,usvg:!1,version:0}}E(null,se)}}return{cancel(){G&&(G.cancel(),G=null),Z&&(Z.cancel(),Z=null)}}}(l,this.map._requestManager,(f,_)=>{if(this._spriteRequest=null,f)this.fire(new i.y(f));else if(_){const E=new Map;for(const j in _)E.set(i.I.from(j),_[j]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(l,f){if(f.type==="sprite")return void this._loadSprite(f.url);const _=this.getOwnSourceCache(f.source);if(!_)return void this.fire(new i.y(new Error(`Source "${f.source}" as specified by iconset "${l}" does not exist and cannot be used as an iconset source`)));const E=_.getSource();if(E.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${f.source}" as specified by iconset "${l}" is not a "raster-array" source and cannot be used as an iconset source`)));E.partial=!1;const j=new YI(l,this.scope,_);this.imageManager.addImageProvider(j,this.scope)}removeIconset(l){this.imageManager.removeImageProvider(l,this.scope)}_loadIconset(l){if(!i.h(l)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(l);const f=this.map._spriteFormat==="auto";var _,E;this._spriteRequest=(E=(j,k)=>{if(this._spriteRequest=null,j)f?this._loadSprite(l):this.fire(new i.y(j));else if(k){const L=new Map;for(const z in k)L.set(i.I.from(z),k[z]);this.addImages(L)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bt((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(l),i.R.Iconset),(j,k)=>{if(j)return void E(j);const L={},z=i.df(new i.bs(k));for(const G of z.icons){const Z={version:1,pixelRatio:i.o.devicePixelRatio,content:XI(G),stretchX:G.metadata?aA(G.metadata.stretch_x_areas):void 0,stretchY:G.metadata?aA(G.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:G};L[G.name]=Z}E(null,L)}))}_validateLayer(l){const f=this.getOwnSource(l.source);if(!f)return;const _=l.sourceLayer;_&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(_)===-1)&&this.fire(new i.y(new Error(`Source layer "${_}" does not exist on source "${f.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,f)=>{const _=this.fragments[f];return _&&_.style&&(l.data=_.style.serialize()),l})}_serializeSources(){const l={};for(const f in this._sourceCaches){const _=this._sourceCaches[f].getSource();l[_.id]||(l[_.id]=_.serialize())}return l}_serializeLayers(l){const f=[];for(const _ of l){const E=this._layers[_];E&&E.type!=="custom"&&f.push(E.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(l){return l?this.order:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const f=this.getOwnLayer(l);if(f)return f;this.fire(new i.y(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const f=this.getOwnSource(l);if(f)return f;this.fire(new i.y(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,f){const _=this.map.painter;if(_)for(let E=l.minzoom||0;E<(l.maxzoom||25.5);E++){const j=l.getProgramIds();if(j)for(const k of j){const L=l.getDefaultProgramParams(k,f.zoom,this._styleColorTheme.lut);L&&(_.style=this,this.fog&&(_._fogVisible=!0,L.overrideFog=!0,_.getOrCreateProgram(k,L)),_._fogVisible=!1,L.overrideFog=!1,_.getOrCreateProgram(k,L),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(L.overrideRtt=!0,_.getOrCreateProgram(k,L)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const f=this.calculateLightsBrightness();l.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f)),l.worldview!==this._worldview&&(this._worldview=l.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const _=this._changes.isDirty();let E=!1;if(this._changes.isDirty()){const L=this._changes.getLayerUpdatesByScope();for(const z in L){const{updatedIds:G,removedIds:Z}=L[z];(G||Z)&&(this._updateWorkerLayers(z,G,Z),E=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this.snow&&this.snow.updateTransitions(l),this.rain&&this.rain.updateTransitions(l),this._changes.reset()}const j={};for(const L in this._mergedSourceCaches){const z=this._mergedSourceCaches[L];j[L]=z.used,z.used=!1,z.tileCoverLift=0}for(const L of this._mergedOrder){const z=this._mergedLayers[L];if(z.recalculate(l,this._availableImages),!z.isHidden(l.zoom)){const G=this.getLayerSourceCache(z);G&&(G.used=!0,G.tileCoverLift=Math.max(G.tileCoverLift,z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(z,l)}):this.precompilePrograms(z,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&E&&this.mergeLayers();const k=this.imageManager.getPendingImageProviders();for(const L of k)L.sourceCache.used=!0;for(const L in j){const z=this._mergedSourceCaches[L];j[L]!==z.used&&z.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:z.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.snow&&this.snow.recalculate(l),this.rain&&this.rain.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const l=this.imageManager.getPendingImageProviders();for(const f of l){const _=f.resolvePendingRequests(),E=this.getFragmentStyle(f.scope);E&&E.addImages(_)}}_updateTilesForChangedImages(){const l={};for(const f in this._mergedSourceCaches){const _=this._mergedSourceCaches[f].getSource().scope;l[_]=l[_]||this._changes.getUpdatedImages(_),l[_].length!==0&&this._mergedSourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l[_])}for(const f in l)this._changes.resetUpdatedImages(f)}_updateWorkerLayers(l,f,_){const E=this.getFragmentStyle(l);E&&this.dispatcher.broadcast("updateLayers",{layers:f?E._serializeLayers(f):[],scope:l,removedIds:_||[],options:E.options})}setState(l,f){if(this._checkLoaded(),eh(this,so(l)))return!1;(l=i.dn(l)).layers=bp(l.layers);const _=function(k,L){if(!k)return[{command:si.setStyle,args:[L]}];let z=[];try{if(!i.bx(k.version,L.version))return[{command:si.setStyle,args:[L]}];if(i.bx(k.center,L.center)||z.push({command:si.setCenter,args:[L.center]}),i.bx(k.zoom,L.zoom)||z.push({command:si.setZoom,args:[L.zoom]}),i.bx(k.bearing,L.bearing)||z.push({command:si.setBearing,args:[L.bearing]}),i.bx(k.pitch,L.pitch)||z.push({command:si.setPitch,args:[L.pitch]}),i.bx(k.sprite,L.sprite)||z.push({command:si.setSprite,args:[L.sprite]}),i.bx(k.glyphs,L.glyphs)||z.push({command:si.setGlyphs,args:[L.glyphs]}),i.bx(k.imports,L.imports)||function(se=[],le=[],ue){le=le||[];const _e=(se=se||[]).map($g),ye=le.map($g),Ee=se.reduce(Ug,{}),Ne=le.reduce(Ug,{}),je=_e.slice();let qe,Ie,Ge,Ue;for(qe=0,Ie=0;qe<_e.length;qe++)Ge=_e[qe],Ne.hasOwnProperty(Ge)?Ie++:(ue.push({command:si.removeImport,args:[Ge]}),je.splice(je.indexOf(Ge,Ie),1));for(qe=0,Ie=0;qe<ye.length;qe++)Ge=ye[ye.length-1-qe],je[je.length-1-qe]!==Ge&&(Ee.hasOwnProperty(Ge)?(ue.push({command:si.removeImport,args:[Ge]}),je.splice(je.lastIndexOf(Ge,je.length-Ie),1)):Ie++,Ue=je[je.length-qe],ue.push({command:si.addImport,args:[Ne[Ge],Ue]}),je.splice(je.length-qe,0,Ge));for(const De of le){const Ze=Ee[De.id];Ze&&(delete Ze.data,i.bx(Ze,De)||ue.push({command:si.updateImport,args:[De.id,De]}))}}(k.imports,L.imports,z),i.bx(k.transition,L.transition)||z.push({command:si.setTransition,args:[L.transition]}),i.bx(k.light,L.light)||z.push({command:si.setLight,args:[L.light]}),i.bx(k.fog,L.fog)||z.push({command:si.setFog,args:[L.fog]}),i.bx(k.snow,L.snow)||z.push({command:si.setSnow,args:[L.snow]}),i.bx(k.rain,L.rain)||z.push({command:si.setRain,args:[L.rain]}),i.bx(k.projection,L.projection)||z.push({command:si.setProjection,args:[L.projection]}),i.bx(k.lights,L.lights)||z.push({command:si.setLights,args:[L.lights]}),i.bx(k.camera,L.camera)||z.push({command:si.setCamera,args:[L.camera]}),i.bx(k.iconsets,L.iconsets)||function(se,le,ue){let _e;for(_e in le=le||{},se=se||{})se.hasOwnProperty(_e)&&(le.hasOwnProperty(_e)||ue.push({command:si.removeIconset,args:[_e]}));for(_e in le){if(!le.hasOwnProperty(_e))continue;const ye=le[_e];se.hasOwnProperty(_e)?i.bx(se[_e],ye)||(ue.push({command:si.removeIconset,args:[_e]}),ue.push({command:si.addIconset,args:[_e,ye]})):ue.push({command:si.addIconset,args:[_e,ye]})}}(k.iconsets,L.iconsets,z),!i.bx(k["color-theme"],L["color-theme"]))return[{command:si.setStyle,args:[L]}];const G={},Z=[];(function(se,le,ue,_e){let ye;for(ye in le=le||{},se=se||{})se.hasOwnProperty(ye)&&(le.hasOwnProperty(ye)||Fg(ye,ue,_e));for(ye in le){if(!le.hasOwnProperty(ye))continue;const Ee=le[ye];se.hasOwnProperty(ye)?i.bx(se[ye],Ee)||(se[ye].type==="geojson"&&Ee.type==="geojson"&&Iw(se,le,ye)?ue.push({command:si.setGeoJSONSourceData,args:[ye,Ee.data]}):zg(ye,le,ue,_e)):Nw(ye,le,ue)}})(k.sources,L.sources,Z,G);const Q=[];k.layers&&k.layers.forEach(se=>{se.source&&G[se.source]?z.push({command:si.removeLayer,args:[se.id]}):Q.push(se)});let X=k.terrain;X&&G[X.source]&&(z.push({command:si.setTerrain,args:[void 0]}),X=void 0),z=z.concat(Z),i.bx(X,L.terrain)||z.push({command:si.setTerrain,args:[L.terrain]}),function(se,le,ue){le=le||[];const _e=(se=se||[]).map($g),ye=le.map($g),Ee=se.reduce(Ug,{}),Ne=le.reduce(Ug,{}),je=_e.slice(),qe=Object.create(null);let Ie,Ge,Ue,De,Ze,ut,ot;for(Ie=0,Ge=0;Ie<_e.length;Ie++)Ue=_e[Ie],Ne.hasOwnProperty(Ue)?Ge++:(ue.push({command:si.removeLayer,args:[Ue]}),je.splice(je.indexOf(Ue,Ge),1));for(Ie=0,Ge=0;Ie<ye.length;Ie++)Ue=ye[ye.length-1-Ie],je[je.length-1-Ie]!==Ue&&(Ee.hasOwnProperty(Ue)?(ue.push({command:si.removeLayer,args:[Ue]}),je.splice(je.lastIndexOf(Ue,je.length-Ge),1)):Ge++,ut=je[je.length-Ie],ue.push({command:si.addLayer,args:[Ne[Ue],ut]}),je.splice(je.length-Ie,0,Ue),qe[Ue]=!0);for(Ie=0;Ie<ye.length;Ie++)if(Ue=ye[Ie],De=Ee[Ue],Ze=Ne[Ue],!qe[Ue]&&!i.bx(De,Ze))if(i.bx(De.source,Ze.source)&&i.bx(De["source-layer"],Ze["source-layer"])&&i.bx(De.type,Ze.type)){for(ot in Bg(De.layout,Ze.layout,ue,Ue,null,si.setLayoutProperty),Bg(De.paint,Ze.paint,ue,Ue,null,si.setPaintProperty),i.bx(De.slot,Ze.slot)||ue.push({command:si.setSlot,args:[Ue,Ze.slot]}),i.bx(De.filter,Ze.filter)||ue.push({command:si.setFilter,args:[Ue,Ze.filter]}),i.bx(De.minzoom,Ze.minzoom)&&i.bx(De.maxzoom,Ze.maxzoom)||ue.push({command:si.setLayerZoomRange,args:[Ue,Ze.minzoom,Ze.maxzoom]}),De)De.hasOwnProperty(ot)&&ot!=="layout"&&ot!=="paint"&&ot!=="filter"&&ot!=="metadata"&&ot!=="minzoom"&&ot!=="maxzoom"&&ot!=="slot"&&(ot.indexOf("paint.")===0?Bg(De[ot],Ze[ot],ue,Ue,ot.slice(6),si.setPaintProperty):i.bx(De[ot],Ze[ot])||ue.push({command:si.setLayerProperty,args:[Ue,ot,Ze[ot]]}));for(ot in Ze)Ze.hasOwnProperty(ot)&&!De.hasOwnProperty(ot)&&ot!=="layout"&&ot!=="paint"&&ot!=="filter"&&ot!=="metadata"&&ot!=="minzoom"&&ot!=="maxzoom"&&ot!=="slot"&&(ot.indexOf("paint.")===0?Bg(De[ot],Ze[ot],ue,Ue,ot.slice(6),si.setPaintProperty):i.bx(De[ot],Ze[ot])||ue.push({command:si.setLayerProperty,args:[Ue,ot,Ze[ot]]}))}else ue.push({command:si.removeLayer,args:[Ue]}),ut=je[je.lastIndexOf(Ue)+1],ue.push({command:si.addLayer,args:[Ze,ut]})}(Q,L.layers,z)}catch(G){console.warn("Unable to compute style diff:",G),z=[{command:si.setStyle,args:[L]}]}return z}(this.serialize(),l).filter(k=>!(k.command in Bw));if(_.length===0)return!1;const E=_.filter(k=>!(k.command in JI));if(E.length>0)throw new Error(`Unimplemented: ${E.map(k=>k.command).join(", ")}.`);const j=[];return _.forEach(k=>{j.push(this[k.command](...k.args))}),f&&Promise.all(j).then(f).catch(f),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(l){if(l.size===0)return this;for(const[f,_]of l.entries()){if(this.getImage(f))return this.fire(new i.y(new Error(`An image with the name "${f.name}" already exists.`)));this.imageManager.addImage(f,this.scope,_),this._changes.updateImage(f,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(l,f){return this.getImage(l)?this.fire(new i.y(new Error(`An image with the name "${l.name}" already exists.`))):(this.imageManager.addImage(l,this.scope,f),this._changes.updateImage(l,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(l,f,_=!1){this.imageManager.updateImage(l,this.scope,f),_&&(this._changes.updateImage(l,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._changes.updateImage(l,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(l){return this.modelManager.addModelURLs(l,this.scope),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(l,f,_={}){return this._checkLoaded(),this._validate(Ig,`models.${l}`,f,null,_)||(this.modelManager.addModel(l,f,this.scope),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope,!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,f,_={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(Ln,`sources.${l}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const E=il(l,f,this.dispatcher,this);E.scope=this.scope,E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(E.id),source:E.serialize(),sourceId:E.id}));const j=k=>{const L=(k?"symbol:":"other:")+E.id,z=i.B(L,this.scope),G=this._sourceCaches[L]=new Sc(z,E,k);(k?this._symbolSourceCaches:this._otherSourceCaches)[E.id]=G,G.onAdd(this.map)};j(!1),f.type!=="vector"&&f.type!=="geojson"||j(!0),E.onAdd&&E.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const f=this.getOwnSource(l);if(!f)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===l)return this.fire(new i.y(new Error(`Source "${l}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new i.y(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const E=Object.entries(this.stylesheet.iconsets).find(([j,k])=>k.type==="source"&&k.source===l);if(E)return this.fire(new i.y(new Error(`Source "${l}" cannot be removed while iconset "${E[0]}" is using it.`)))}const _=this.getOwnSourceCaches(l);for(const E of _){const j=i.dp(E.id);delete this._sourceCaches[j],this._changes.discardSourceCacheUpdate(E.id),E.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,f){this._checkLoaded(),this.getOwnSource(l).setData(f),this._changes.setDirty()}getOwnSource(l){const f=this.getOwnSourceCache(l);return f&&f.getSource()}getOwnSources(){const l=[];for(const f in this._otherSourceCaches){const _=this.getOwnSourceCache(f);_&&l.push(_.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const f in l){const _=l[f]._tiles;for(const E in _){const j=_[E];if(j.state!=="loaded"&&j.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const j of l){if(this._validate(ps,"lights",j))return;switch(j.type){case"ambient":if(this.ambientLight){const k=this.ambientLight;k.set(j),k.updateTransitions(f)}else this.ambientLight=new Os(j,Si||(Si=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const k=this.directionalLight;k.set(j),k.updateTransitions(f)}else this.directionalLight=new Os(j,xs||(xs=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=Object.assign(f,{worldview:this.map.getWorldview()}),E=new i.ac(this.z||0,_);this.ambientLight&&this.ambientLight.recalculate(E),this.directionalLight&&this.directionalLight.recalculate(E),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,f=this.ambientLight;if(!l||!f)return;const _=X=>.2126*(X[0]<=.03928?X[0]/12.92:Math.pow((X[0]+.055)/1.055,2.4))+.7152*(X[1]<=.03928?X[1]/12.92:Math.pow((X[1]+.055)/1.055,2.4))+.0722*(X[2]<=.03928?X[2]/12.92:Math.pow((X[2]+.055)/1.055,2.4)),E=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),j=l.properties.get("intensity"),k=l.properties.get("direction"),L=1-i.d3(k.x,k.y,k.z)[2]/90,z=_(E)*j*L,G=f.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),Z=f.properties.get("intensity"),Q=_(G)*Z;return Number(((z+Q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(l==null||l===""&&this.isRootStyle())return this;if(i.dq(l)){const f=i.dr(l),_=this.fragments.find(({id:j})=>j===f);if(!_)return;const E=i.dp(l);return _.style.getFragmentStyle(E)}{const f=this.fragments.find(({id:_})=>_===l);return f?f.style:void 0}}setFeaturesetSelectors(l){if(!l)return;const f={},_=(E,j="")=>`${E}::${j}`;this._featuresetSelectors={};for(const E in l){const j=this._featuresetSelectors[E]=[];for(const k of l[E].selectors){if(k.featureNamespace){const z=this.getOwnLayer(k.layer);if(!z){i.w(`Layer is undefined for selector: ${k.layer}`);continue}const G=_(z.source,z.sourceLayer);if(G in f&&f[G]!==k.featureNamespace){i.w(`"featureNamespace ${k.featureNamespace} of featureset ${E}'s selector is not associated to the same source, skip this selector`);continue}f[G]=k.featureNamespace}let L;if(k.properties)for(const z in k.properties){const G=i.U(k.properties[z]);G.result==="success"&&(L=L||{},L[z]=G.value)}j.push({layerId:k.layer,namespace:k.featureNamespace,properties:L,uniqueFeatureID:k._uniqueFeatureID})}}}getFeaturesetDescriptors(l){const f=this.getFragmentStyle(l);if(!f||!f.stylesheet.featuresets)return[];const _=[];for(const E in f.stylesheet.featuresets)_.push({featuresetId:E,importId:f.scope?f.scope:void 0});return _}getFeaturesetLayers(l,f){const _=this.getFragmentStyle(f),E=_.stylesheet.featuresets;if(!E||!E[l])return this.fire(new i.y(new Error(`The featureset '${l}' does not exist in the map's style and cannot be queried.`))),[];const j=[];for(const k of E[l].selectors){const L=_.getOwnLayer(k.layer);L&&j.push(L)}return j}getConfigProperty(l,f){const _=this.getFragmentStyle(l);if(!_)return null;const E=i.B(f,_.scope),j=_.options.get(E),k=j?j.value||j.default:null;return k?k.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(l,f){const _=i.B(l,f);return this._mergedIndoor[_]}setIndoorData(l,f){this.map.indoor.setIndoorData(f)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(l,f,_){const E=this.getFragmentStyle(l);if(!E)return;const j=E.stylesheet.schema;if(!j||!j[f])return;const k=i.U(_);if(k.result!=="success")return void eh(this,k.value);const L=k.value.expression,z=i.B(f,E.scope),G=E.options.get(z);if(!G)return;let Z;const{minValue:Q,maxValue:X,stepValue:se,type:le,values:ue}=j[f],_e=i.U(j[f].default);_e.result==="success"&&(Z=_e.value.expression),Z?(this.options.set(z,Object.assign({},G,{value:L,default:Z,minValue:Q,maxValue:X,stepValue:se,type:le,values:ue})),this.updateConfigDependencies(f)):this.fire(new i.y(new Error(`No schema defined for the config option "${f}" in the "${l}" fragment.`)))}getConfig(l){const f=this.getFragmentStyle(l);if(!f)return null;const _=f.stylesheet.schema;if(!_)return null;const E={};for(const j in _){const k=i.B(j,f.scope),L=f.options.get(k),z=L?L.value||L.default:null;E[j]=z?z.serialize():null}return E}setConfig(l,f){const _=this.getFragmentStyle(l);_&&(_.updateConfig(f,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const f=this.getFragmentStyle(l);return f?f.stylesheet.schema:null}setSchema(l,f){const _=this.getFragmentStyle(l);_&&(_.stylesheet.schema=f,_.updateConfig(_._config,f),this.updateConfigDependencies())}updateConfig(l,f){if(this._config=l,l||f)if(f)for(const _ in f){let E,j;const k=i.U(f[_].default);if(k.result==="success"&&(E=k.value.expression),l&&l[_]!==void 0){const X=i.U(l[_]);X.result==="success"&&(j=X.value.expression)}const{minValue:L,maxValue:z,stepValue:G,type:Z,values:Q}=f[_];if(E){const X=i.B(_,this.scope);this.options.set(X,{default:E,value:j,minValue:L,maxValue:z,stepValue:G,type:Z,values:Q})}else this.fire(new i.y(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(l,f=()=>!0){for(const _ of l){const E=this.getLayer(_);E&&f(E)&&(E.possiblyEvaluateVisibility(),this._updateLayer(E),this._changes.setDirty())}}updateConfigDependencies(l){this._updateLayers(this._configDependentLayers,f=>!l||f.expressionDependencies.configDependencies.has(l)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(f=>{const _=f._styleColorTheme.colorThemeOverride?f._styleColorTheme.colorThemeOverride:f._styleColorTheme.colorTheme;if(_){const E=f._evaluateColorThemeData(_);(!f._styleColorTheme.lut&&E!==""||f._styleColorTheme.lut&&E!==f._styleColorTheme.lut.data)&&f.setColorTheme(_)}}),this._changes.setDirty()}addLayer(l,f,_={}){this._checkLoaded();const E=l.id;if(this._layers[E])return void this.fire(new i.y(new Error(`Layer with id "${E}" already exists on this map`)));let j;if(l.type==="custom"){if(eh(this,i.ds(l)))return;j=i.dt(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(E,l.source),l=i.dn(l),l=Object.assign(l,{source:E})),this._validate(Oa,`layers.${E}`,l,{arrayIndex:-1},_))return;j=i.dt(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(j),j.setEventedParent(this,{layer:{id:E}})}const k=i.B(j.source,j.scope);j.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(k),j.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(k);let L=this._order.length;if(f){const Q=this._order.indexOf(f);if(Q===-1)return void this.fire(new i.y(new Error(`Layer with id "${f}" does not exist on this map.`)));j.slot===this._layers[f].slot?L=Q:i.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(L,0,E),this._layerOrderChanged=!0,this._layers[E]=j;const z=this.getOwnLayerSourceCache(j),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&j.canCastShadows()&&G&&(z.castsShadows=!0);const Z=this._changes.getRemovedLayer(j);if(Z&&j.source&&z&&j.type!=="custom"){this._changes.discardLayerRemoval(j);const Q=i.B(j.source,j.scope);Z.type!==j.type?this._changes.updateSourceCache(Q,"clear"):(this._changes.updateSourceCache(Q,"reload"),z.pause())}this._updateLayer(j),j.onAdd&&j.onAdd(this.map),j.scope=this.scope,this.mergeLayers()}moveLayer(l,f){this._checkLoaded();const _=this._checkLayer(l);if(!_||l===f)return;const E=this._order.indexOf(l);this._order.splice(E,1);let j=this._order.length;if(f){const k=this._order.indexOf(f);if(k===-1)return void this.fire(new i.y(new Error(`Layer with id "${f}" does not exist on this map.`)));_.slot===this._layers[f].slot?j=k:i.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(j,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const f=this._checkLayer(l);if(!f)return;f.setEventedParent(null);const _=this._order.indexOf(l);this._order.splice(_,1),delete this._layers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(f.fqid),this._indoorDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const E=this.getOwnLayerSourceCache(f);if(E&&E.castsShadows){let j=!1;for(const k in this._layers)if(this._layers[k].source===f.source&&this._layers[k].canCastShadows()){j=!0;break}E.castsShadows=j}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const f in this._layers)if(this._layers[f].type===l)return!0;return!1}setLayerZoomRange(l,f,_){this._checkLoaded();const E=this._checkLayer(l);E&&(E.minzoom===f&&E.maxzoom===_||(f!=null&&(E.minzoom=f),_!=null&&(E.maxzoom=_),this._updateLayer(E)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,f){this._checkLoaded();const _=this._checkLayer(l);_&&_.slot!==f&&(_.slot=f,this._updateLayer(_))}setFilter(l,f,_={}){this._checkLoaded();const E=this._checkLayer(l);if(E&&!i.bx(E.filter,f))return f==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(vn,`layers.${E.id}.filter`,f,{layerType:E.type},_)||(E.filter=i.dn(f),this._updateLayer(E)))}getFilter(l){const f=this._checkLayer(l);if(f)return i.dn(f.filter)}setLayoutProperty(l,f,_,E={}){this._checkLoaded();const j=this._checkLayer(l);if(j&&!i.bx(j.getLayoutProperty(f),_)){if(_!=null&&(!E||E.validate!==!1)&&eh(j,jw.call(so,{key:`layers.${l}.layout.${f}`,layerType:j.type,objectKey:f,value:_,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;j.setLayoutProperty(f,_),j.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(j.fqid),this._updateLayer(j)}}setLayerProperty(l,f,_,E={}){this._checkLoaded();const j=this._checkLayer(l);j&&(f==="appearances"?(j.setAppearances(_),this._changes.setDirty()):j.isPaintProperty(f)?this.setPaintProperty(l,f,_,E):this.setLayoutProperty(l,f,_,E))}getLayoutProperty(l,f){const _=this._checkLayer(l);if(_)return _.getLayoutProperty(f)}setPaintProperty(l,f,_,E={}){this._checkLoaded();const j=this._checkLayer(l);if(!j||i.bx(j.getPaintProperty(f),_)||_!=null&&(!E||E.validate!==!1)&&eh(j,$o.call(so,{key:`layers.${l}.paint.${f}`,layerType:j.type,objectKey:f,value:_,styleSpec:i.a6})))return;const k=j.setPaintProperty(f,_);j.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(j.fqid),k&&this._updateLayer(j),this._changes.updatePaintProperties(j)}getPaintProperty(l,f){const _=this._checkLayer(l);if(_)return _.getPaintProperty(f)}setFeatureState(l,f){if(this._checkLoaded(),"target"in l){if("featuresetId"in l.target){const{featuresetId:z,importId:G}=l.target,Z=this.getFragmentStyle(G),Q=Z.getFeaturesetLayers(z);for(const{source:X,sourceLayer:se}of Q)Z.setFeatureState({id:l.id,source:X,sourceLayer:se},f)}else if("layerId"in l.target){const{layerId:z}=l.target,G=this.getLayer(z);this.setFeatureState({id:l.id,source:G.source,sourceLayer:G.sourceLayer},f)}return}const _=l.source,E=l.sourceLayer,j=this._checkSource(_);if(!j)return;const k=j.type;if(k==="geojson"&&E)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(k==="vector"&&!E)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const L=this.getOwnSourceCaches(_);for(const z of L)z.setFeatureState(E,l.id,f)}removeFeatureState(l,f){if(this._checkLoaded(),"target"in l){if("featuresetId"in l.target){const{featuresetId:z,importId:G}=l.target,Z=this.getFragmentStyle(G),Q=Z.getFeaturesetLayers(z);for(const{source:X,sourceLayer:se}of Q)Z.removeFeatureState({id:l.id,source:X,sourceLayer:se},f)}else if("layerId"in l.target){const{layerId:z}=l.target,G=this.getLayer(z);this.removeFeatureState({id:l.id,source:G.source,sourceLayer:G.sourceLayer},f)}return}const _=l.source,E=this._checkSource(_);if(!E)return;const j=E.type,k=j==="vector"?l.sourceLayer:void 0;if(j==="vector"&&!k)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const L=this.getOwnSourceCaches(_);for(const z of L)z.removeFeatureState(k,l.id,f)}getFeatureState(l){if(this._checkLoaded(),"target"in l){let j;if("featuresetId"in l.target){const{featuresetId:k,importId:L}=l.target,z=this.getFragmentStyle(L),G=z.getFeaturesetLayers(k);for(const{source:Z,sourceLayer:Q}of G){const X=z.getFeatureState({id:l.id,source:Z,sourceLayer:Q});if(X&&!j)j=X;else if(!i.bx(j,X))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in l.target){const{layerId:k}=l.target,L=this.getLayer(k);j=this.getFeatureState({id:l.id,source:L.source,sourceLayer:L.sourceLayer})}return j}const f=l.source,_=l.sourceLayer,E=this._checkSource(f);if(E){if(E.type!=="vector"||_)return l.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(_,l.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),f=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return i.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateFilteredLayers(l){for(const f of Object.values(this._mergedLayers))l(f)&&this._updateLayer(f)}_updateLayer(l){this._changes.updateLayer(l);const f=this.getLayerSourceCache(l),_=i.B(l.source,l.scope),E=this._changes.getUpdatedSourceCaches();l.source&&!E[_]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),f.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const f=L=>this._mergedLayers[L].is3D(!!this.terrain),_=this.order,E={},j=[];for(let L=_.length-1;L>=0;L--){const z=_[L];if(f(z)){E[z]=L;for(const G of l){const Z=G[z];if(Z)for(const Q of Z)j.push(Q)}}}j.sort((L,z)=>z.intersectionZ-L.intersectionZ);const k=[];for(let L=_.length-1;L>=0;L--){const z=_[L];if(f(z))for(let G=j.length-1;G>=0;G--){const Z=j[G].feature;if(Z.layer&&E[Z.layer.id]<L)break;k.push(Z),j.pop()}else for(const G of l){const Z=G[z];if(Z)for(const Q of Z)k.push(Q.feature)}}return k}queryRasterValue(l,f,_){const E=this.getOwnSource(l);return E?E.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):E.queryRasterArrayValue(f,_):(this.fire(new i.y(new Error(`Source with id "${l}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(l,f,_){let E;f&&!Array.isArray(f)&&f.filter&&(this._validate(vn,"queryRenderedFeatures.filter",f.filter,null,f),E=i.b5(f.filter));const j={},k=Z=>{if(y_.has(Z.type))return;const Q=this.getOwnLayerSourceCache(Z),X=j[Q.id]=j[Q.id]||{sourceCache:Q,layers:{},has3DLayers:!1};Z.is3D(!!this.terrain)&&(X.has3DLayers=!0),X.layers[Z.fqid]=X.layers[Z.fqid]||{styleLayer:Z,targets:[]},X.layers[Z.fqid].targets.push({filter:E})};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const Z of f.layers){const Q=this._layers[Z];if(!Q)return this.fire(new i.y(new Error(`The layer '${Z}' does not exist in the map's style and cannot be queried for features.`))),[];k(Q)}}else for(const Z in this._layers)k(this._layers[Z]);const L=this._queryRenderedFeatures(l,j,_),z=this._flattenAndSortRenderedFeatures(L),G=[];for(const Z of z)i.dv(Z.layer.id)===this.scope&&G.push(Z);return G}queryRenderedFeatureset(l,f,_){let E;f&&!Array.isArray(f)&&f.filter&&(this._validate(vn,"queryRenderedFeatures.filter",f.filter,null,f),E=i.b5(f.filter));const j="mock",k=[];if(f&&f.target)k.push(Object.assign({},f,{targetId:j,filter:E}));else{const Z=this.getFeaturesetDescriptors();for(const Q of Z)k.push({targetId:j,filter:E,target:Q});for(const{style:Q}of this.fragments){const X=Q.getFeaturesetDescriptors();for(const se of X)k.push({targetId:j,filter:E,target:se})}}const L=this.queryRenderedTargets(l,k,_),z=[],G=new Set;for(const Z of L)for(const Q of Z.variants[j])Pl(Q,Z,G)||z.push(new i.dw(Z,Q));return z}queryRenderedTargets(l,f,_){const E={},j=(L,z,G,Z)=>{const Q=E[z.id]=E[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};if(Q.layers[L.fqid]=Q.layers[L.fqid]||{styleLayer:L,targets:[]},L.is3D(!!this.terrain)&&(Q.has3DLayers=!0),!Z)return G.uniqueFeatureID=!1,void Q.layers[L.fqid].targets.push(G);Q.layers[L.fqid].targets.push(Object.assign({},G,{namespace:Z.namespace,properties:Z.properties,uniqueFeatureID:Z.uniqueFeatureID}))};for(const L of f)if("featuresetId"in L.target){const{featuresetId:z,importId:G}=L.target,Z=this.getFragmentStyle(G);if(!Z||!Z._featuresetSelectors)continue;const Q=Z._featuresetSelectors[z];if(!Q){this.fire(new i.y(new Error(`The featureset '${z}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const X of Q){const se=Z.getOwnLayer(X.layerId);se&&!y_.has(se.type)&&j(se,Z.getOwnLayerSourceCache(se),L,X)}}else if("layerId"in L.target){const{layerId:z}=L.target,G=this.getLayer(z);if(!G||y_.has(G.type))continue;j(G,this.getLayerSourceCache(G),L)}const k=this._queryRenderedFeatures(l,E,_);return this._flattenAndSortRenderedFeatures(k)}_queryRenderedFeatures(l,f,_){const E=[],j=!!this.map._showQueryGeometry,k=_i.createFromScreenPoints(l,_);for(const L in f){const z=Ol(k,f[L],this._availableImages,_,j);Object.keys(z).length&&E.push(z)}if(this.placement)for(const L in f){if(!f[L].sourceCache._onlySymbols)continue;const z=o_(k.screenGeometry,f[L],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(z).length&&E.push(z)}return E}querySourceFeatures(l,f){const _=f&&f.filter;_&&this._validate(vn,"querySourceFeatures.filter",_,null,f);let E=[];const j=this.getOwnSourceCaches(l);for(const k of j)E=E.concat(Rg(k,f));return E}addSourceType(l,f,_){return Cc.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(Cc.setSourceType(l,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:f.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,f,_={}){this._checkLoaded();const E=this.light.getLight();let j=!1;for(const L in l)if(!i.bx(l[L],E[L])){j=!0;break}if(!j)return;const k=this._getTransitionParameters();this.light.setLight(l,f,_),this.light.updateTransitions(k)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,f=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),f===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=l;const E=l.source==null;if(f===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const L="terrain-dem-src";this.addSource(L,_.source),_=i.dn(_),_=Object.assign(_,{source:L})}const j=Object.assign({},_),k={};if(this.terrain&&E){j.source=this.terrain.get().source;const L=this.terrain?this.getFragmentStyle(this.terrain.scope):null;L&&(k.style=L.serialize())}if(this._validate(Ga,"terrain",j,k))return}if(!this.terrain||this.terrain.scope!==this.scope&&!E||this.terrain&&f!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,f),this.fire(new i.z("data",{dataType:"style"}))}else{const j=this.terrain,k=j.get();for(const L of Object.keys(i.a6.terrain))!_.hasOwnProperty(L)&&i.a6.terrain[L].default&&(_[L]=i.a6.terrain[L].default);for(const L in l)if(!i.bx(l[L],k[L])){j.set(l,this.options),this.stylesheet.terrain=l;const z=this._getTransitionParameters({duration:0});j.updateTransitions(z),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const f=this.fog=new zr(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_createSnow(l){const f=this.snow=new Zs(l,this.map.transform,this.scope,this.options);this.stylesheet.snow=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_createRain(l){const f=this.rain=new Ms(l,this.map.transform,this.scope,this.options);this.stylesheet.rain=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!i.bx(f.get(),l)){f.set(l,this.options),this.stylesheet.fog=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}}else this._createFog(l);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(l){if(this._checkLoaded(),!l)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const f=this.snow;if(!i.bx(f.get(),l)){f.set(l,this.options),this.stylesheet.snow=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}}else this._createSnow(l);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(l){if(this._checkLoaded(),!l)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const f=this.rain;if(!i.bx(f.get(),l)){f.set(l,this.options),this.stylesheet.rain=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}}else this._createRain(l);this._markersNeedUpdate=!0}_reloadColorTheme(){const l=()=>{for(const E in this._layers)this._layers[E].lut=this._styleColorTheme.lut;for(const E in this._sourceCaches)this._sourceCaches[E].clearTiles()},f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!f)return this._styleColorTheme.lut=null,void l();const _=this._evaluateColorThemeData(f);this._loadColorTheme(_).then(()=>{this.fire(new i.z("colorthemeset")),l()}).catch(E=>{i.w(`Couldn't set color theme: ${E}`)})}setColorTheme(l){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=l,this._reloadColorTheme()}setImportColorTheme(l,f){const _=this.getFragmentStyle(l);_&&(_._styleColorTheme.colorThemeOverride=f,_._reloadColorTheme())}_getTransitionParameters(l){return{now:i.o.now(),transition:Object.assign(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],f=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?l.push(_):f.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...f)}_createTerrain(l,f){const _=this.terrain=new lt(l,f,this.scope,this.options,this.map.getWorldview());f===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const E=this._getTransitionParameters({duration:0});_.updateTransitions(E)}_force3DLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="symbol"&&this._updateLayer(f)}}_validate(l,f,_,E,j={}){if(j&&j.validate===!1)return!1;const k=Object.assign({},this.serialize());return eh(this,l.call(so,Object.assign({key:f,style:k,value:_,styleSpec:i.a6},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(l){const f=this.getSourceCaches(l);for(const _ of f)_.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}clearLayers(){for(const l in this._mergedLayers){const f=this._mergedLayers[l];f._clear&&f._clear()}}reloadSource(l){const f=this.getSourceCaches(l);for(const _ of f)_.resume(),_.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(l=>{l.modelManager.reloadModels(l.scope)})}updateSources(l){let f;this.directionalLight&&(f=iA(this.directionalLight));const _=new Set;for(const E in this._mergedLayers){const j=this._mergedLayers[E];j.hasElevation()&&!_.has(j.source)&&_.add(j.source)}for(const E in this._mergedSourceCaches){const j=this._mergedSourceCaches[E],k=_.has(j._source.id);j.update(l,void 0,void 0,f,k)}}_generateCollisionBoxes(){for(const l in this._sourceCaches){const f=this._sourceCaches[l];f.resume(),f.reload()}}_updatePlacement(l,f,_,E,j,k,L=!1){let z=!1,G=!1;const Z={},Q={};for(const X of this._mergedOrder){const se=this._mergedLayers[X];if(se.type!=="symbol")continue;const le=i.B(se.source,se.scope);let ue=Z[le];if(!ue){const ye=this.getLayerSourceCache(se);if(!ye)continue;const Ee=ye.getRenderableIds(!0).map(Ne=>ye.getTileByID(Ne));Q[le]=Ee.slice(),ue=Z[le]=Ee.sort((Ne,je)=>je.tileID.overscaledZ-Ne.tileID.overscaledZ||(Ne.tileID.isLessThan(je.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(se,ue,f.center.lng,f.projection);z=z||_e}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),L=L||this._layerOrderChanged||E===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(L||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),f.zoom))&&(this.pauseablePlacement=new vl(f,this._mergedOrder,L,_,E,j,this.placement,this.fog&&f.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Z,Q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),G=!0),z&&this.pauseablePlacement.placement.setStale()),G||z){this._buildingIndex.onNewFrame(f.zoom);for(let X=0;X<this._mergedOrder.length;X++){const se=this._mergedLayers[this._mergedOrder[X]];if(se.type!=="symbol")continue;const le=this.isLayerClipped(se);this.placement.updateLayerOpacities(se,Z[i.B(se.source,se.scope)],X,le?k:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,f){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:j})=>j===l.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!f)return _.push(l),this._loadImports([l],!0);const E=_.findIndex(({id:j})=>j===f);return E===-1&&this.fire(new i.y(new Error(`Import with id "${f}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,E).concat(l).concat(_.slice(E)),this._loadImports([l],!0,f)}updateImport(l,f){this._checkLoaded();const _=this.stylesheet.imports||[],E=this.getImportIndex(l);return E===-1?this:typeof f=="string"?(this.setImportUrl(l,f),this):(f.url&&f.url!==_[E].url&&this.setImportUrl(l,f.url),i.bx(f.config,_[E].config)||this.setImportConfig(l,f.config,f.data.schema),i.bx(f.data,_[E].data)||this.setImportData(l,f.data),this)}moveImport(l,f){this._checkLoaded();let _=this.stylesheet.imports||[];const E=this.getImportIndex(l);if(E===-1)return this;const j=this.getImportIndex(f);if(j===-1)return this;const k=_[E],L=this.fragments[E];return _=_.filter(({id:z})=>z!==l),this.fragments=this.fragments.filter(({id:z})=>z!==l),this.stylesheet.imports=_.slice(0,j).concat(k).concat(_.slice(j)),this.fragments=this.fragments.slice(0,j).concat(L).concat(this.fragments.slice(j)),this.mergeLayers(),this}setImportUrl(l,f){this._checkLoaded();const _=this.stylesheet.imports||[],E=this.getImportIndex(l);if(E===-1)return this;_[E].url=f;const j=this.fragments[E];return j.style=this._createFragmentStyle(_[E]),j.style.on("style.import.load",()=>this.mergeAll()),j.style.loadURL(f),this}setImportData(l,f){this._checkLoaded();const _=this.getImportIndex(l),E=this.stylesheet.imports||[];return _===-1?this:f?(this.fragments[_].style.setState(f),this._reloadImports(),this):(delete E[_].data,this.setImportUrl(l,E[_].url))}setImportConfig(l,f,_){this._checkLoaded();const E=this.getImportIndex(l),j=this.stylesheet.imports||[];if(E===-1)return this;f?j[E].config=f:delete j[E].config;const k=this.fragments[E];_&&k.style.stylesheet&&(k.style.stylesheet.schema=_);const L=k.style.stylesheet&&k.style.stylesheet.schema;return k.config=f,k.style.updateConfig(f,L),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(l);_!==-1&&(f.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(l){const f=(this.stylesheet.imports||[]).findIndex(_=>_.id===l);return f===-1&&this.fire(new i.y(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),f}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const f in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[f];_&&l.push(_.getSource())}return l}getSource(l,f){const _=this.getSourceCache(l,f);return _&&_.getSource()}getLayerSource(l){const f=this.getLayerSourceCache(l);return f&&f.getSource()}getSourceCache(l,f){const _=i.B(l,f);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(l){const f=i.B(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const f=[];return this._mergedOtherSourceCaches[l]&&f.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&f.push(this._mergedSymbolSourceCaches[l]),f}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const f in l){const _=l[f];_==="reload"?this.reloadSource(f):_==="clear"&&this.clearSource(f)}}updateLayers(l){const f=this._changes.getUpdatedPaintProperties();for(const _ of f){const E=this.getLayer(_);E&&E.updateTransitions(l)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(l){this.stylesheet.glyphs=l,this.glyphManager.setURL(l)}getImages(l,f,_){this.imageManager.getImages(f.images,f.scope,_),this._updateTilesForChangedImages();const E=k=>{if(k){const L=f.images.map(z=>i.I.toString(z));k.setDependencies(f.tileID.key,f.type,L)}},j=i.B(f.source,f.scope);E(this._mergedOtherSourceCaches[j]),E(this._mergedSymbolSourceCaches[j]),f.images.some(k=>k.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(l,f,_){this.imageManager.rasterizeImages(f,_)}getGlyphs(l,f,_){this.glyphManager.getGlyphs(f.stacks,_)}getResource(l,f,_){return i.dy(f,_)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const f=[];return this._otherSourceCaches[l]&&f.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&f.push(this._symbolSourceCaches[l]),f}_isSourceCacheLoaded(l){const f=this.getOwnSourceCaches(l);return f.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${l}'`))),!1):f.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,f){if(!this._clipLayerPresent&&l.type!=="fill-extrusion"&&l.type!=="building")return!1;const _=l.type==="fill-extrusion"&&(l.sourceLayer==="building"||l.sourceLayer==="procedural_buildings"),E=l.type==="building";if(l.is3D(!!this.terrain)){if(_||E||f&&f.type==="batched-model"||l.type==="model")return!0}else if(l.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Cc.getSourceType=function(v){return wc[v]},Cc.setSourceType=function(v,l){wc[v]=l},Cc.registerForPluginStateChange=i.dz;class ff extends i.E{constructor(l){super(),this._style=l,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(l){l===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=l,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(l){this._activeFloorsVisible=l,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(l){for(const[f,_]of Object.entries(l.buildings))if(this._buildings[f])for(const E of _.floorIds)this._buildings[f].floors[E]||(this._buildings[f].floors[E]=_.floors[E]);else this._buildings[f]=_;for(const f of l.activeFloors)this._activeFloors.add(f);this._updateIndoorSelector()}getIndoorTileOptions(l,f){const _=this._style.getIndoorSourceLayers(l,f);return _&&this._indoorState?{sourceLayers:_,indoorState:this._indoorState}:null}_updateUI(l,f,_){const E=function(j,k,L,z){let G=null,Z=Number.MAX_SAFE_INTEGER;if(z<16)return null;for(const[Q,X]of Object.entries(j)){const se=X.center;if(se){const le=k.distanceTo(i.aS.convert(se));le<Z&&L.contains(se)&&(Z=le,G=Q)}}return G}(this._buildings,f,_,l);E!==this._closestBuildingId&&(this._closestBuildingId=E,this._updateIndoorSelector())}_updateIndoorSelector(){const l=this._buildings,f=this._closestBuildingId,_=f&&l?l[f]:void 0;if(!_)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let E=null;for(const k of _.floorIds)if(this._activeFloors&&this._activeFloors.has(k)){E=k;break}const j=Array.from(_.floorIds).map(k=>({id:k,name:_.floors[k].name,zIndex:_.floors[k].zIndex})).sort((k,L)=>L.zIndex-k.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:E,activeFloorsVisible:this._activeFloorsVisible,floors:j}))}_updateActiveFloors(){const l=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:l,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var ty=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Vw=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,qw=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,jp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Hw=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,v_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Hl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,__=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,rr=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Gw=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Op=[];jc(ty,Op),jc(qw,Op),jc(Vw,Op);const kp={"_prelude_fog.vertex.glsl":Hw,"_prelude_terrain.vertex.glsl":Pp,"_prelude_shadow.vertex.glsl":rr,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":v_,"_prelude_shadow.fragment.glsl":Gw,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Hl,"_prelude_raster_particle.glsl":__},ry={};Nn("",Pp),Nn(v_,Hw),Nn(Gw,rr),Nn(Hl,""),Nn(__,"");const ny=Nn(Vw,qw),Pu=ty;var x_={background:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Nn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Nn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Nn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Nn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Nn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Nn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Nn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Nn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Nn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Nn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Nn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Nn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Nn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Nn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Nn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Nn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Nn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Nn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Nn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,jp),skyboxGradient:Nn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,jp),skyboxCapture:Nn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Nn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Nn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Nn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Nn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Nn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Nn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Nn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function jc(v,l){const f=v.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of f)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const E=_.split(" ");for(const j of E)l.includes(j)||l.push(j)}}function Nn(v,l){const f=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,E={},j=[],k=[];if(v=v.replace(f,(z,G)=>(k.push(G),"")),(l=l.replace(f,(z,G)=>(j.push(G),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...Op];jc(v,L),jc(l,L);for(const z of[...j,...k])kp[z]||console.error(`Undefined include: ${z}`),ry[z]||(ry[z]=[],jc(kp[z],ry[z])),L=[...L,...ry[z]];return{fragmentSource:v=v.replace(_,(z,G,Z,Q,X)=>(E[X]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${X}
in ${Z} ${Q} ${X};
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="initialize"?`
#ifdef HAS_UNIFORM_u_${X}
    ${Z} ${Q} ${X} = u_${X};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${Z} ${Q} ${X};
#endif
`:G==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(_,(z,G,Z,Q,X)=>{const se=`MATERIAL_ATTRIBUTE_OFFSET_${X}`,le=Q==="float"?"vec2":Q,ue=`GET_ATTRIBUTE_${le}(a_${X}, materialInfo, ${se})`,_e=X.match(/color/)?"color":le;return G==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${X}
in ${Z} ${Q} a_${X};
#endif
`:E[X]?G==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
    #if !defined(${se})
        in ${Z} ${le} a_${X};
    #endif
out ${Z} ${Q} ${X};
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="initialize"?_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${X}) 
    #ifdef ${se}
        ${X} = unpack_mix_${_e}(${ue}, u_${X}_t);
    #else
        ${X} = unpack_mix_${_e}(a_${X}, u_${X}_t);
    #endif
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${Z} ${Q} a_${X};
    out ${Z} ${Q} ${X};
#endif
`:G==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${X} = a_${X};
#endif
`:void 0:G==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
    #if !defined(${se})
        in ${Z} ${le} a_${X};
    #endif  
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="define-instanced"?_e==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${X}0;
in vec4 a_${X}1;
in vec4 a_${X}2;
in vec4 a_${X}3;
#else
uniform ${Z} ${Q} u_${X};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Z} ${le} a_${X};
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${Z} ${Q} ${X} = a_${X};
#endif
`:_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    #ifdef ${se}
        ${Z} ${Q} ${X} = ${ue};
    #else
        ${Z} ${Q} ${X} = a_${X};
    #endif
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    #ifdef ${se}
        ${Z} ${Q} ${X} = unpack_mix_${_e}(${ue}, u_${X}_t);
    #else
        ${Z} ${Q} ${X} = unpack_mix_${_e}(a_${X}, u_${X}_t);
    #endif
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`}),usedDefines:L,vertexIncludes:j,fragmentIncludes:k}}class Np{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,f,_,E,j,k,L,z){this.context=l;let G=this.boundPaintVertexBuffers.length!==E.length;for(let Q=0;!G&&Q<E.length;Q++)this.boundPaintVertexBuffers[Q]!==E[Q]&&(G=!0);let Z=this.boundDynamicVertexBuffers.length!==L.length;for(let Q=0;!Z&&Q<L.length;Q++)this.boundDynamicVertexBuffers[Q]!==L[Q]&&(Z=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||G||Z||this.boundIndexBuffer!==j||this.boundVertexOffset!==k)this.freshBind(f,_,E,j,k,L,z);else{l.bindVertexArrayOES.set(this.vao);for(const Q of L)Q&&(Q.bind(),z&&Q.instanceCount&&Q.setVertexAttribDivisor(l.gl,f,z));j&&j.dynamicDraw&&j.bind()}}freshBind(l,f,_,E,j,k,L){const z=this.context,G=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=E,this.boundVertexOffset=j,this.boundDynamicVertexBuffers=k,f.enableAttributes(G,l),f.bind(),f.setVertexAttribPointers(G,l,j);for(const Z of _)Z.enableAttributes(G,l),Z.bind(),Z.setVertexAttribPointers(G,l,j);for(const Z of k)Z&&(Z.enableAttributes(G,l),Z.bind(),Z.setVertexAttribPointers(G,l,j),L&&Z.instanceCount&&Z.setVertexAttribDivisor(G,l,L));E&&E.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function QI(v,l){const f=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new i.ae(0,_/f).toLngLat().lat,new i.ae(0,(_+1)/f).toLngLat().lat]}function eR(v,l,f,_,E,j,k){const L=v.context,z=L.gl,G=f.hillshadeFBO;if(!G)return;v.prepareDrawTile();const Z=v.isTileAffectedByFog(l),Q=v.getOrCreateProgram("hillshade",{overrideFog:Z});L.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.colorAttachment.get());const X=((_e,ye,Ee,Ne)=>{const je=Ee.paint.get("hillshade-shadow-color"),qe=Ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ie=Ee.paint.get("hillshade-highlight-color"),Ge=Ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ue=Ee.paint.get("hillshade-accent-color"),De=Ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ze=Ee.paint.get("hillshade-emissive-strength");let ut=i.an(Ee.paint.get("hillshade-illumination-direction"));if(Ee.paint.get("hillshade-illumination-anchor")==="viewport")ut-=_e.transform.angle;else if(_e.style&&_e.style.enable3dLights()&&_e.style.directionalLight){const St=_e.style.directionalLight.properties.get("direction"),gt=i.d3(St.x,St.y,St.z);ut=i.an(gt[1])}const ot=!_e.options.moving;return{u_matrix:Ne||_e.transform.calculateProjMatrix(ye.tileID.toUnwrapped(),ot),u_image:0,u_latrange:QI(0,ye.tileID),u_light:[Ee.paint.get("hillshade-exaggeration"),ut],u_shadow:je.toPremultipliedRenderColor(qe?null:Ee.lut),u_highlight:Ie.toPremultipliedRenderColor(Ge?null:Ee.lut),u_emissive_strength:Ze,u_accent:Ue.toPremultipliedRenderColor(De?null:Ee.lut)}})(v,f,_,v.terrain?l.projMatrix:null);v.uploadCommonUniforms(L,Q,l.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:le,tileBoundsSegments:ue}=v.getTileBoundsBuffers(f);Q.draw(v,z.TRIANGLES,E,j,k,Xr.disabled,X,_.id,se,le,ue)}function b_(v,l,f){if(!l.needsDEMTextureUpload)return;const _=v.context,E=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||v.getTileTexture(f.stride);const j=f.getPixels();l.demTexture?l.demTexture.update(j,{premultiply:!1}):l.demTexture=new i.T(_,j,E.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function tR(v,l,f){const _=v.context,E=_.gl;if(!l.dem)return;const j=l.dem;if(_.activeTexture.set(E.TEXTURE1),b_(v,l,j),!l.demTexture)return;l.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const k=j.dim;_.activeTexture.set(E.TEXTURE0);let L=l.hillshadeFBO;if(!L){const X=new i.T(_,{width:k,height:k,data:null},E.RGBA8);X.bind(E.LINEAR,E.CLAMP_TO_EDGE),L=l.hillshadeFBO=_.createFramebuffer(k,k,!0,"renderbuffer"),L.colorAttachment.set(X.texture)}_.bindFramebuffer.set(L.framebuffer),_.viewport.set([0,0,k,k]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:G,tileBoundsSegments:Z}=v.getMercatorTileBoundsBuffers(),Q=[];v.linearFloatFilteringSupported()&&Q.push("TERRAIN_DEM_FLOAT_FORMAT"),v.getOrCreateProgram("hillshadePrepare",{defines:Q}).draw(v,E.TRIANGLES,Er.disabled,rn.disabled,yn.unblended,Xr.disabled,((X,se)=>{const le=se.stride,ue=i.bB();return i.cd(ue,0,i.al,-i.al,0,0,1),i.bq(ue,ue,[0,-i.al,0]),{u_matrix:ue,u_image:1,u_dimension:[le,le],u_zoom:X.overscaledZ}})(l.tileID,j),f.id,z,G,Z),l.needsHillshadePrepare=!1}class us{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oA extends us{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ww extends us{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class rR extends us{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class nR extends us{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class iR extends us{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class sR extends us{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class lA extends us{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class aR extends us{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class w_ extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class oR extends us{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class cA extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class Kw extends us{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class S_ extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Zw extends us{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class pf extends us{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ip extends us{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class iy extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Rp extends us{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class uA extends us{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Xw=class extends us{getDefault(){return null}set(v){(v!==this.current||this.dirty)&&(this.gl.useProgram(v),this.current=v,this.dirty=!1)}};class dA extends us{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Mp extends us{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class E_ extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class T_ extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Yw extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class A_ extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class sy extends us{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class hA extends us{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class fA extends us{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class pA extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Dp extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class C_ extends us{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class lR extends C_{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class mA extends C_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class cR extends C_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Jw extends mA{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Qw=(v,l,f)=>({u_matrix:v,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:f}),j_=(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:f,u_zoom_transition:E,u_merc_center:j,u_image0:0,u_frustum_tl:k,u_frustum_tr:L,u_frustum_br:z,u_frustum_bl:G,u_globe_pos:Z,u_globe_radius:Q,u_viewport:X,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:se,u_far_z_cutoff:le});function P_(v,l){return v!=null&&l!=null&&!(!v.hasData()||!l.hasData())&&v.demTexture!=null&&l.demTexture!=null&&v.tileID.key!==l.tileID.key}const mf=new class{constructor(){this.operations={}}newMorphing(v,l,f,_,E){if(v in this.operations){const j=this.operations[v];j.to.tileID.key!==f.tileID.key&&(j.queued=f)}else this.operations[v]={startTime:_,phase:0,duration:E,from:l,to:f,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const l=this.operations[v];return{from:l.from,to:l.to,phase:l.phase}}update(v){for(const l in this.operations){const f=this.operations[l];for(f.phase=(v-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,v)){delete this.operations[l];break}}}_nextOp(v,l){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=l,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},e1={0:null,1:"TERRAIN_VERTEX_MORPHING"};function gA(v,l,f){if(l===0)return 0;const _=l<1&&f===514?.25/l:1;return 6*Math.pow(1.5,22-v)*Math.max(l,1)*_}function ay(v,l){const f=1<<v.z;return!l&&(v.x===0||v.x===f-1)||v.y===0||v.y===f-1}const gf=v=>({u_matrix:v});function O_(v,l,f,_,E){if(E>0){const j=i.o.now(),k=(j-v.timeAdded)/E,L=l?(j-l.timeAdded)/E:-1,z=f.getSource(),G=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),Z=!l||Math.abs(l.tileID.overscaledZ-G)>Math.abs(v.tileID.overscaledZ-G),Q=Z&&v.refreshedUponExpiration?1:i.aA(Z?k:1-L,0,1);return l?{opacity:1,mix:1-Q,isFading:k<1}:{opacity:Q,mix:0,isFading:k<1}}return{opacity:1,mix:0,isFading:!1}}class Gl extends Sc{constructor(l){const f=il("mock-dem",{type:"raster-dem",maxzoom:l.transform.maxZoom},l.style.dispatcher,l.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,f){l.state="loaded",f(null)}}class t1 extends Sc{constructor(l){const f=il("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},l.style.dispatcher,l.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,f,_){if(l.freezeTileCoverage)return;this.transform=l;const E=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((j,k)=>{if(j[k.key]="",!this._tiles[k.key]){const L=new Au(k,this._source.tileSize*k.overscaleFactor(),l.tileZoom,void 0,void 0,this._source.worldview);L.state="loaded",this._tiles[k.key]=L}return j},{});for(const j in this._tiles)j in E||(this.freeFBO(j),this._tiles[j].unloadVectorData(),delete this._tiles[j])}freeFBO(l){const f=this.proxyCachedFBO[l];if(f!==void 0){const _=Object.values(f);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class oy extends i.aP{constructor(l,f,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=f,this.projMatrix=_}}class ly extends i.bU{constructor(l,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,E,j]=function(z){const G=new i.bc,Z=new i.b0,Q=131;G.reserve(17161),Z.reserve(33800);const X=i.al/128,se=i.al+X/2,le=se+X;for(let _e=-X;_e<le;_e+=X)for(let ye=-X;ye<le;ye+=X){const Ee=ye<0||ye>se||_e<0||_e>se?24575:0,Ne=i.aA(Math.round(ye),0,i.al),je=i.aA(Math.round(_e),0,i.al);G.emplaceBack(Ne+Ee,je)}const ue=(_e,ye)=>{const Ee=ye*Q+_e;Z.emplaceBack(Ee+1,Ee,Ee+Q),Z.emplaceBack(Ee+Q,Ee+Q+1,Ee+1)};for(let _e=1;_e<129;_e++)for(let ye=1;ye<129;ye++)ue(ye,_e);return[0,129].forEach(_e=>{for(let ye=0;ye<130;ye++)ue(ye,_e),ue(_e,ye)}),[G,Z,32768]}(),k=l.context;this.gridBuffer=k.createVertexBuffer(_,i.be.members),this.gridIndexBuffer=k.createIndexBuffer(E),this.gridSegments=i.bf.simpleSegment(0,0,_.length,E.length),this.gridNoSkirtSegments=i.bf.simpleSegment(0,0,_.length,j),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new t1(f.map),this.orthoMatrix=i.bB(),i.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const L=k.gl;this._overlapStencilMode=new rn({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gl(f.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,f,_){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const E=l.terrain.properties,j=l.terrain.drapeRenderMode===0,k=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const L=l.terrain&&l.terrain.scope,z=E.get("source"),G=j?this._mockSourceCache:l.getSourceCache(z,L);if(!G)return void i.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=G,this._attenuationRange=l.terrain.getAttenuationRange(),this._exaggeration=k?this.calculateExaggeration(f):E.get("exaggeration"),!f.projection.requiresDraping&&k&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Z=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Q=this.getScaledDemTileSize();this.sourceCache.update(f,Q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Z(),this._initializing=!0),Z(),f.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(l){if(this._attenuationRange&&l.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(l.zoom);const f=this._previousCameraAltitude,_=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=_;const E=f!=null?_-f:Number.MAX_VALUE;if(Math.abs(E)<2)return this._exaggeration;const j=l.zoom,k=this._style.terrain;if(!this._previousUpdateTimestamp)return k.getExaggeration(j);let L=j-this._previousZoom;const z=this._previousUpdateTimestamp;let G=j;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(j-G)>.5&&(L=.5*(j-G+L)),L*E<0&&(G+=L)),this._evaluationZoom=G;const Z=k.getExaggeration(G),Q=Z===k.getExaggeration(Math.max(0,G-.1));if(Q&&Math.abs(Z-this._exaggeration)<.01)return Z;let X=Math.min(.1,.00375*(this._updateTimestamp-z));return(Q||Z<.1||Math.abs(L)<1e-4)&&(X=Math.min(.2,4*X)),i.ak(this._exaggeration,Z,X)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.dataType==="source"&&l.coord?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=f.getIds().map(z=>{const G=f.getTileByID(z).tileID;return G.projMatrix=_.calculateProjMatrix(G.toUnwrapped()),G});(function(z,G){const Z=G.transform.pointCoordinate(G.transform.getCameraPoint()),Q=new i.P(Z.x,Z.y);z.sort((X,se)=>{if(se.overscaledZ-X.overscaledZ)return se.overscaledZ-X.overscaledZ;const le=new i.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ue=new i.P(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),_e=Q.mult(1<<X.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(le)-_e.distSqr(ue)})})(E,this.painter);const j=this.proxyToSource||{};this.proxyToSource={},E.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const k=this._style._mergedSourceCaches;for(const z in k){const G=k[z];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,l[z],j),G.usedForTerrain))continue;const Z=l[z];G.getSource().reparseOverscaled&&this._assignTerrainTiles(Z)}this.proxiedCoords[f.id]=E.map(z=>new oy(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(j),this.renderingToTexture=!1;const L={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const G=this.terrainTileForTile[z.key];if(!G)continue;const Z=G.tileID.key;Z in L||(this._visibleDemTiles.push(G),L[Z]=Z)}}_assignTerrainTiles(l){this._initializing||l.forEach(f=>{if(this.terrainTileForTile[f.key])return;const _=this._findTileCoveringTileID(f,this.sourceCache);_&&(this.terrainTileForTile[f.key]=_)})}_prepareDEMTextures(){const l=this.painter.context,f=l.gl;for(const _ in this.terrainTileForTile){const E=this.terrainTileForTile[_],j=E.dem;!j||E.demTexture&&!E.needsDEMTextureUpload||(l.activeTexture.set(f.TEXTURE1),b_(this.painter,E,j))}}_prepareDemTileUniforms(l,f,_,E){if(!f||f.demTexture==null)return!1;const j=l.tileID.canonical,k=Math.pow(2,f.tileID.canonical.z-j.z),L=E||"";return _[`u_dem_tl${L}`]=[j.x*k%1,j.y*k%1],_[`u_dem_scale${L}`]=k,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const f=this._visibleDemTiles.reduce((_,E)=>{if(!E.dem)return _;const j=E.dem.tree.minimums[0];return j>0&&l++,_+j},0);return l?f/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,f=l.gl;l.activeTexture.set(f.TEXTURE2);const _=this._getLoadedAreaMinimum(),E=new i.dK({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let j=this._emptyDEMTexture;return j?j.update(E,{premultiply:!1}):j=this._emptyDEMTexture=new i.T(l,E,f.R32F,{premultiply:!1}),j}setupElevationDraw(l,f,_){const E=this.painter.context,j=E.gl,k={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};k.u_exaggeration=this.exaggeration();let L=null,z=null,G=1;if(_&&_.morphing&&this._useVertexMorphing){const se=_.morphing.srcDemTile,le=_.morphing.dstDemTile;G=_.morphing.phase,se&&le&&(this._prepareDemTileUniforms(l,se,k,"_prev")&&(z=se),this._prepareDemTileUniforms(l,le,k)&&(L=le))}const Z=se=>se&&se.demTexture&&this.painter.linearFloatFilteringSupported()?j.LINEAR:j.NEAREST;let Q=null;var X;if(this.enabled?z&&L?(Q=L.demTexture,E.activeTexture.set(j.TEXTURE4),z.demTexture.bind(Z(z),j.CLAMP_TO_EDGE),k.u_dem_lerp=G):(L=this.terrainTileForTile[l.tileID.key],Q=this._prepareDemTileUniforms(l,L,k)?L.demTexture:this.emptyDEMTexture):Q=this.emptyDEMTexture,E.activeTexture.set(j.TEXTURE2),Q&&(k.u_dem_size=(X=Q).size[0]===1?1:X.size[0]-2,Q.bind(Z(L),j.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,f,k),_&&_.useMeterToDem&&L){const se=(1<<L.tileID.canonical.z)*i.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;k.u_meter_to_dem=se}if(_&&_.labelPlaneMatrixInv&&(k.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),f.setTerrainUniformValues(E,k),this.painter.transform.projection.name==="globe"){const se=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);f.setGlobeUniformValues(E,se)}}globeUniformValues(l,f,_){const E=l.projection;return{u_tile_tl_up:E.upVector(f,0,0),u_tile_tr_up:E.upVector(f,i.al,0),u_tile_br_up:E.upVector(f,i.al,i.al),u_tile_bl_up:E.upVector(f,0,i.al),u_tile_up_scale:_?i.dL(1):E.upVectorScale(f,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const f=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(E,j,k,L,z){if(E.transform.projection.name==="globe")(function(G,Z,Q,X,se){const le=G.context,ue=le.gl;let _e,ye;const Ee=G.transform,Ne=i.dD(G,le,Ee),je=(St,gt)=>{if(ye===gt)return;const kt=[e1[gt],"PROJECTION_GLOBE_VIEW"];Ne&&kt.push("CUSTOM_ANTIALIASING");const Qt=G.isTileAffectedByFog(St);_e=G.getOrCreateProgram("globeRaster",{defines:kt,overrideFog:Qt}),ye=gt},qe=G.colorModeForRenderPass(),Ie=new Er(ue.LEQUAL,Er.ReadWrite,G.depthRangeFor3D);mf.update(se);const Ge=i.dE(Ee),Ue=[i.aF(Ee.center.lng),i.aJ(Ee.center.lat)],De=G.globeSharedBuffers,Ze=[Ee.width*i.o.devicePixelRatio,Ee.height*i.o.devicePixelRatio],ut=Float32Array.from(Ee.globeMatrix),ot={useDenormalizedUpVectorScale:!0};{const St=G.transform,gt=gA(St.zoom,Z.exaggeration(),Z.sourceCache._source.tileSize);ye=-1;const kt=ue.TRIANGLES;for(const Qt of X){const mt=Q.getTile(Qt),nt=rn.disabled,Nt=Z.prevTerrainTileForTile[Qt.key],yt=Z.terrainTileForTile[Qt.key];P_(Nt,yt)&&mf.newMorphing(Qt.key,Nt,yt,se,250),le.activeTexture.set(ue.TEXTURE0),mt.texture&&mt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const $t=mf.getMorphValuesForProxy(Qt.key),nr=$t?1:0;$t&&Object.assign(ot,{morphing:{srcDemTile:$t.from,dstDemTile:$t.to,phase:i.dC($t.phase)}});const xr=i.dF(Qt.canonical),Xt=i.dG(xr.getCenter().lat),tr=i.dH(Qt.canonical,xr,Xt,St.worldSize/St._pixelsPerMercatorPixel),wr=i.bj(i.dI(Qt.canonical)),pr=j_(St.expandedFarZProjMatrix,ut,Ge,wr,i.aj(St.zoom),Ue,St.frustumCorners.TL,St.frustumCorners.TR,St.frustumCorners.BR,St.frustumCorners.BL,St.globeCenterInViewSpace,St.globeRadius,Ze,gt,St._farZ,tr);if(je(Qt,nr),_e&&(Z.setupElevationDraw(mt,_e,ot),G.uploadCommonUniforms(le,_e,Qt.toUnwrapped()),De)){const[dr,mr,$r]=De.getGridBuffers(Xt,gt!==0);_e.draw(G,kt,Ie,nt,qe,Xr.backCCW,pr,"globe_raster",dr,mr,$r)}}}if(De&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){const St=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ne&&St.push("CUSTOM_ANTIALIASING"),_e=G.getOrCreateProgram("globeRaster",{defines:St});for(const gt of X){const{x:kt,y:Qt,z:mt}=gt.canonical,nt=Qt===0,Nt=Qt===(1<<mt)-1,[yt,$t,nr,xr]=De.getPoleBuffers(mt,!1);if(xr&&(nt||Nt)){const Xt=Q.getTile(gt);le.activeTexture.set(ue.TEXTURE0),Xt.texture&&Xt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let tr=i.dJ(mt,kt,Ee);const wr=i.bj(i.dI(gt.canonical)),pr=(dr,mr)=>dr.draw(G,ue.TRIANGLES,Ie,rn.disabled,qe,Xr.disabled,j_(Ee.expandedFarZProjMatrix,tr,tr,wr,0,Ue,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,Ze,0,Ee._farZ),"globe_pole_raster",mr,nr,xr);Z.setupElevationDraw(Xt,_e,ot),G.uploadCommonUniforms(le,_e,gt.toUnwrapped()),nt&&G.renderDefaultNorthPole&&pr(_e,yt),Nt&&G.renderDefaultSouthPole&&(tr=i.cR(i.bB(),tr,[1,-1,1]),pr(_e,$t))}}}})(E,j,k,L,z);else{const G=E.context,Z=G.gl;let Q,X;const se=E.shadowRenderer,le=ld(E,E.longestCutoffRange),ue=qe=>{if(X===qe)return;const Ie=[];Ie.push(e1[qe]),le.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),se&&(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),se.useNormalOffset&&Ie.push("NORMAL_OFFSET")),Q=E.getOrCreateProgram("terrainRaster",{defines:Ie}),X=qe},_e=E.colorModeForRenderPass(),ye=new Er(Z.LEQUAL,Er.ReadWrite,E.depthRangeFor3D);mf.update(z);const Ee=E.transform,Ne=gA(Ee.zoom,j.exaggeration(),j.sourceCache._source.tileSize);let je=[0,0,0];if(se){const qe=E.style.directionalLight,Ie=E.style.ambientLight;qe&&Ie&&(je=Ac(E.style,qe,Ie))}{X=-1;const qe=Z.TRIANGLES,[Ie,Ge]=[j.gridIndexBuffer,j.gridSegments];for(const Ue of L){const De=k.getTile(Ue),Ze=rn.disabled,ut=j.prevTerrainTileForTile[Ue.key],ot=j.terrainTileForTile[Ue.key];P_(ut,ot)&&mf.newMorphing(Ue.key,ut,ot,z,250),G.activeTexture.set(Z.TEXTURE0),De.texture&&De.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const St=mf.getMorphValuesForProxy(Ue.key),gt=St?1:0;let kt;St&&(kt={morphing:{srcDemTile:St.from,dstDemTile:St.to,phase:i.dC(St.phase)}});const Qt=Qw(Ue.projMatrix,ay(Ue.canonical,Ee.renderWorldCopies)?Ne/10:Ne,je);if(ue(gt),!Q)continue;j.setupElevationDraw(De,Q,kt);const mt=Ue.toUnwrapped();se&&se.setupShadows(mt,Q),E.uploadCommonUniforms(G,Q,mt,null,le),Q.draw(E,qe,ye,Ze,_e,Xr.backCCW,Qt,"terrain_raster",j.gridBuffer,Ie,Ge)}}}}(f,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const f=this.painter,_=this.painter.context,E=this.proxySourceCache,j=this.proxiedCoords[E.id],k=this._drapedRenderBatches.shift(),L=f.style.order,z=[];let G=0;for(const Z of j){const Q=E.getTileByID(Z.proxyTileKey),X=E.proxyCachedFBO[Z.key]?E.proxyCachedFBO[Z.key][l]:void 0,se=X!==void 0?E.renderCache[X]:this.pool[G++],le=X!==void 0;if(Q.texture=se.tex,le&&!se.dirty){z.push(Q.tileID);continue}let ue;_.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(_.clear({color:i.ao.transparent,stencil:0}),se.dirty=!1);for(let _e=k.start;_e<=k.end;++_e){const ye=f.style._mergedLayers[L[_e]];if(ye.isHidden(f.transform.zoom))continue;const Ee=f.style.getLayerSourceCache(ye),Ne=Ee?this.proxyToSource[Z.key][Ee.id]:[Z];if(!Ne)continue;const je=Ne;_.viewport.set([0,0,se.fb.width,se.fb.height]),ue!==(Ee?Ee.id:null)&&(this._setupStencil(se,Ne,ye,Ee),ue=Ee?Ee.id:null),f.renderLayer(f,Ee,ye,je)}if(this._drapedRenderBatches.length===0)for(const _e of this._pendingGroundEffectLayers){const ye=f.style._mergedLayers[L[_e]];if(ye.isHidden(f.transform.zoom))continue;const Ee=f.style.getLayerSourceCache(ye),Ne=Ee?this.proxyToSource[Z.key][Ee.id]:[Z];if(!Ne)continue;const je=Ne;_.viewport.set([0,0,se.fb.width,se.fb.height]),ue!==(Ee?Ee.id:null)&&(this._setupStencil(se,Ne,ye,Ee),ue=Ee?Ee.id:null),f.renderLayer(f,Ee,ye,je)}this.renderedToTile?(se.dirty=!0,z.push(Q.tileID)):le||--G,G===5&&(G=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),k.end+1}postRender(){}isLayerOrderingCorrect(l){const f=l.order.length;let _=-1,E=f;for(let j=0;j<f;++j)this._style.isLayerDraped(l._mergedLayers[l.order[j]])?_=Math.max(_,j):E=Math.min(E,j);return E>_}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{l=Math.min(l,f.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,f,_){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(j=>j.dem).map(j=>{const k=j.tileID,L=1<<k.overscaledZ,{x:z,y:G}=k.canonical,Z=z/L,Q=(z+1)/L,X=G/L,se=(G+1)/L;return{minx:Z,miny:X,maxx:Q,maxy:se,t:j.dem.tree.raycastRoot(Z,X,Q,se,l,f,_),tile:j}});E.sort((j,k)=>(j.t!==null?j.t:Number.MAX_VALUE)-(k.t!==null?k.t:Number.MAX_VALUE));for(const j of E){if(j.t==null)return null;const k=j.tile.dem.tree.raycast(j.minx,j.miny,j.maxx,j.maxy,l,f,_);if(k!=null)return k}return null}_createFBO(){const l=this.painter.context,f=l.gl,_=this.drapeBufferSize;l.activeTexture.set(f.TEXTURE0);const E=new i.T(l,{width:_[0],height:_[1],data:null},f.RGBA8);E.bind(f.LINEAR,f.CLAMP_TO_EDGE);const j=l.createFramebuffer(_[0],_[1],!0,null);return j.colorAttachment.set(E.texture),j.depthAttachment=new Jw(l,j.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,j.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):j.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:j,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const f=this._style._mergedLayers[l],_=f.isHidden(this.painter.transform.zoom);return f.type==="hillshade"||f.type==="custom"?!_&&f.shouldRedrape():!_&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const _ of this._style.getSources())if(_ instanceof Uo){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const E=this._style._mergedLayers[this._style.order[_]],j=this._style.getLayerSourceCache(E);if(j&&!f[j.id]&&!E.isHidden(this.painter.transform.zoom)&&E.type==="line"&&E.widthExpression()instanceof i.ad){f[j.id]=!0;for(const k of this.proxyCoords){const L=this.proxyToSource[k.key][j.id];if(L)for(const z of L)this._clearRenderCacheForTile(j.id,z)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof bc){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const E=this._style._mergedLayers[this._style.order[_]],j=this._style.getLayerSourceCache(E);if(!j||f[j.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="raster")continue;const k=E.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const z=this.proxyToSource[L.key][j.id];if(z)for(const G of z){const Z=O_(j.getTile(G),j.findLoadedParent(G,0),j,this.painter.transform,k);(Z.opacity!==1||Z.mix!==0)&&this._clearRenderCacheForTile(j.id,G)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const l=this._style.order,f=l.length;if(f===0)return;const _=[];this._pendingGroundEffectLayers=[];let E,j=0,k=this._style._mergedLayers[l[j]];for(;!this._style.isLayerDraped(k)&&k.isHidden(this.painter.transform.zoom)&&++j<f;)k=this._style._mergedLayers[l[j]];for(;j<f;++j){const L=this._style._mergedLayers[l[j]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?E===void 0&&(E=j):(L.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(j),E!==void 0&&(_.push({start:E,end:j-1}),E=void 0)))}if(E!==void 0&&_.push({start:E,end:j-1}),_.length!==0){const L=_[_.length-1];this._pendingGroundEffectLayers.every(z=>z>L.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(l){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const k=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let L=0;L<k.length;++L){const z=Object.values(k[L]);f.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,E=this._tilesDirty;for(let k=_.length-1;k>=0;k--){const L=_[k];if(f.getTileByID(L.key),f.proxyCachedFBO[L.key]!==void 0){const z=l[L.key],G=this.proxyToSource[L.key];let Z=0;for(const Q in G){const X=G[Q],se=z[Q];if(!se||se.length!==X.length||X.some((le,ue)=>le!==se[ue]||E[Q]&&E[Q].hasOwnProperty(le.key))){Z=-1;break}++Z}for(const Q in f.proxyCachedFBO[L.key])f.renderCache[f.proxyCachedFBO[L.key][Q]].dirty=Z<0||Z!==Object.values(z).length}}const j=[...this._drapedRenderBatches];j.sort((k,L)=>L.end-L.start-(k.end-k.start));for(const k of j)for(const L of _){if(f.proxyCachedFBO[L.key])continue;let z=f.renderCachePool.pop();z===void 0&&f.renderCache.length<50&&(z=f.renderCache.length,f.renderCache.push(this._createFBO())),z!==void 0&&(f.proxyCachedFBO[L.key]={},f.proxyCachedFBO[L.key][k.start]=z,f.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(l,f,_,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const j=this.painter.context,k=j.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let L;if(_.isTileClipped())L=f.length,this._overlapStencilMode.test={func:k.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:k.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(j.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):rn.disabled}_renderTileClippingMasks(l,f){const _=this.painter,E=this.painter.context,j=E.gl;_._tileClippingMaskIDs={},E.setColorMode(yn.disabled),E.setDepthMode(Er.disabled);const k=_.getOrCreateProgram("clippingMask");for(const L of l){const z=_._tileClippingMaskIDs[L.key]=--f;k.draw(_,j.TRIANGLES,Er.disabled,new rn({func:j.ALWAYS,mask:0},z,255,j.KEEP,j.KEEP,j.REPLACE),yn.disabled,Xr.disabled,gf(L.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){const f=this.painter.transform;if(l.x<0||l.x>f.width||l.y<0||l.y>f.height)return null;const _=[l.x,l.y,1,1];i.aC(_,_,f.pixelMatrixInverse),i.cJ(_,_,1/_[3]),_[0]/=f.worldSize,_[1]/=f.worldSize;const E=f._camera.position,j=i.ce(1,f.center.lat),k=[E[0],E[1],E[2]/j,0],L=i.d9([],_.slice(0,3),k);i.aw(L,L);const z=this.raycast(k,L,this._exaggeration);return z!==null&&z?(i.bG(k,k,L,z),k[3]=k[2],k[2]*=j,k):null}_setupProxiedCoordsForOrtho(l,f,_){if(l.getSource()instanceof i.aT)return this._setupProxiedCoordsForImageSource(l,f,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const E=this.proxiedCoords[l.id]=[],j=this.proxyCoords;for(let z=0;z<j.length;z++){const G=j[z],Z=this._findTileCoveringTileID(G,l);if(Z){const Q=this._createProxiedId(G,Z,_[G.key]&&_[G.key][l.id]);E.push(Q),this.proxyToSource[G.key][l.id]=[Q]}}let k=!1;const L=new Set;for(let z=0;z<f.length;z++){const G=l.getTile(f[z]);if(!G||!G.hasData())continue;const Z=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(Z&&Z.tileID.canonical.z!==G.tileID.canonical.z){const Q=this.proxyToSource[Z.tileID.key][l.id],X=this._createProxiedId(Z.tileID,G,_[Z.tileID.key]&&_[Z.tileID.key][l.id]);Q?Q.splice(Q.length-1,0,X):this.proxyToSource[Z.tileID.key][l.id]=[X];const se=this.proxyToSource[Z.tileID.key][l.id];L.has(se)||L.add(se),E.push(X),k=!0}}if(this._sourceTilesOverlap[l.id]=k,k&&this._debugParams.sortTilesHiZFirst)for(const z of L)z.sort((G,Z)=>Z.overscaledZ-G.overscaledZ)}_setupProxiedCoordsForImageSource(l,f,_){if(!l.getSource().loaded())return;const E=this.proxiedCoords[l.id]=[],j=this.proxyCoords,k=l.getSource(),L=k.tileID;if(!L)return;const z=new i.P(L.x,L.y)._div(1<<L.z),G=k.coordinates.map(i.ae.fromLngLat).reduce((Q,X)=>(Q.min.x=Math.min(Q.min.x,X.x-z.x),Q.min.y=Math.min(Q.min.y,X.y-z.y),Q.max.x=Math.max(Q.max.x,X.x-z.x),Q.max.y=Math.max(Q.max.y,X.y-z.y),Q),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Z=(Q,X)=>{const se=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),le=Q.canonical.y/(1<<Q.canonical.z),ue=i.al/(1<<Q.canonical.z),_e=X.wrap+X.canonical.x/(1<<X.canonical.z),ye=X.canonical.y/(1<<X.canonical.z);return se+ue<_e+G.min.x||se>_e+G.max.x||le+ue<ye+G.min.y||le>ye+G.max.y};for(let Q=0;Q<j.length;Q++){const X=j[Q];for(let se=0;se<f.length;se++){const le=l.getTile(f[se]);if(!le||!le.hasData()||Z(X,le.tileID))continue;const ue=this._createProxiedId(X,le,_[X.key]&&_[X.key][l.id]),_e=this.proxyToSource[X.key][l.id];_e?_e.push(ue):this.proxyToSource[X.key][l.id]=[ue],E.push(ue)}}}_createProxiedId(l,f,_){let E=this.orthoMatrix;if(_){const j=_.find(k=>k.key===f.tileID.key);if(j)return j}if(f.tileID.key!==l.key){const j=l.canonical.z-f.tileID.canonical.z;let k,L,z;E=i.bB();const G=f.tileID.wrap-l.wrap<<l.overscaledZ;j>0?(k=i.al>>j,L=k*((f.tileID.canonical.x<<j)-l.canonical.x+G),z=k*((f.tileID.canonical.y<<j)-l.canonical.y)):(k=i.al<<-j,L=i.al*(f.tileID.canonical.x-(l.canonical.x+G<<-j)),z=i.al*(f.tileID.canonical.y-(l.canonical.y<<-j))),i.cd(E,0,k,0,k,0,1),i.bq(E,E,[L,z,0])}return new oy(f.tileID,l.key,E)}_findTileCoveringTileID(l,f){let _=f.getTile(l);if(_&&_.hasData())return _;const E=this._findCoveringTileCache[f.id],j=E[l.key];if(_=j?f.getTileByID(j):null,_&&_.hasData()||j===null)return _;let k=_?_.tileID:l,L=k.overscaledZ;const z=f.getSource().minzoom,G=[];if(!j){const Q=f.getSource().maxzoom;if(l.canonical.z>=Q){const X=l.canonical.z-Q;f.getSource().reparseOverscaled?(L=Math.max(l.canonical.z+2,f.transform.tileZoom),k=new i.aP(L,l.wrap,Q,l.canonical.x>>X,l.canonical.y>>X)):X!==0&&(L=Q,k=new i.aP(L,l.wrap,Q,l.canonical.x>>X,l.canonical.y>>X))}k.key!==l.key&&(G.push(k.key),_=f.getTile(k))}const Z=Q=>{G.forEach(X=>{E[X]=Q}),G.length=0};for(L-=1;L>=z&&(!_||!_.hasData());L--){_&&Z(_.tileID.key);const Q=k.calculateScaledKey(L);if(_=f.getTileByID(Q),_&&_.hasData())break;const X=E[Q];if(X===null)break;X===void 0?G.push(Q):_=f.getTileByID(X)}return Z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,f){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[f.key]=!0}}function r1(v,l,f){const _=function(L,z,G){const Z=i.bI(z,L),Q=i.bI(G,[.2126,.7152,.0722]),X=(le,ue,_e)=>(1-_e)*le+_e*ue,se=X(1-.3*Math.min(Q,1),1,Math.min(Z+1,1));return X(.92,1,Math.asin(i.aA(z[2],-1,1))/Math.PI+.5)*se}(v,[0,0,1],l),E=[0,0,0];i.c4(E,f.slice(0,3),_);const j=[0,0,0];i.c4(j,l.slice(0,3),v[2]);const k=[0,0,0];return i.d7(k,E,j),i.da(k)}const n1=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],i1=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class cy{static cacheKey(l,f,_,E){let j=`${f}${E?E.cacheKey:""}`;for(const k of _)l.usedDefines.includes(k)&&(j+=`/${k}`);return j}constructor(l,f,_,E,j,k){const L=l.gl;this.program=L.createProgram(),this.configuration=E,this.name=f,this.fixedDefines=[...k];let z=E?E.defines():[];z=z.concat(k.map(le=>`#define ${le}`));const G=`#version 300 es
`;let Z=G+z.concat("precision mediump float;",Pu,ny.fragmentSource).join(`
`);for(const le of _.fragmentIncludes)Z+=`
${kp[le]}`;Z+=`
${_.fragmentSource}`;let Q=G+z.concat("precision highp float;",Pu,ny.vertexSource).join(`
`);for(const le of _.vertexIncludes)Q+=`
${kp[le]}`;this.forceManualRenderingForInstanceIDShaders=l.forceManualRenderingForInstanceIDShaders&&_.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const X=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(X,Z),L.compileShader(X),L.attachShader(this.program,X);const se=L.createShader(L.VERTEX_SHADER);L.isContextLost()?this.failedToCreate=!0:(L.shaderSource(se,Q),L.compileShader(se),L.attachShader(this.program,se),this.attributes={},L.linkProgram(this.program),L.deleteShader(se),L.deleteShader(X),this.fixedUniforms=j(l),this.binderUniforms=E?E.getUniforms(l):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(le=>({u_instanceID:new i.cg(le)}))(l)),(k.includes("TERRAIN")||f.indexOf("symbol")!==-1||f.indexOf("circle")!==-1)&&(this.terrainUniforms=(le=>({u_dem:new i.cg(le),u_dem_prev:new i.cg(le),u_dem_tl:new i.cj(le),u_dem_scale:new i.ci(le),u_dem_tl_prev:new i.cj(le),u_dem_scale_prev:new i.ci(le),u_dem_size:new i.ci(le),u_dem_lerp:new i.ci(le),u_exaggeration:new i.ci(le),u_depth:new i.cg(le),u_depth_size_inv:new i.cj(le),u_depth_range_unpack:new i.cj(le),u_occluder_half_size:new i.ci(le),u_occlusion_depth_offset:new i.ci(le),u_meter_to_dem:new i.ci(le),u_label_plane_matrix_inv:new i.ck(le)}))(l)),k.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new i.ch(le),u_tile_tr_up:new i.ch(le),u_tile_br_up:new i.ch(le),u_tile_bl_up:new i.ch(le),u_tile_up_scale:new i.ci(le)}))(l)),k.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new i.ck(le),u_fog_range:new i.cj(le),u_fog_color:new i.d2(le),u_fog_horizon_blend:new i.ci(le),u_fog_vertical_limit:new i.cj(le),u_fog_temporal_offset:new i.ci(le),u_frustum_tl:new i.ch(le),u_frustum_tr:new i.ch(le),u_frustum_br:new i.ch(le),u_frustum_bl:new i.ch(le),u_globe_pos:new i.ch(le),u_globe_radius:new i.ci(le),u_globe_transition:new i.ci(le),u_is_globe:new i.cg(le),u_viewport:new i.cj(le)}))(l)),k.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(le=>({u_cutoff_params:new i.d2(le)}))(l)),k.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(le=>({u_lighting_ambient_color:new i.ch(le),u_lighting_directional_dir:new i.ch(le),u_lighting_directional_color:new i.ch(le),u_ground_radiance:new i.ch(le)}))(l)),k.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(le=>({u_light_matrix_0:new i.ck(le),u_light_matrix_1:new i.ck(le),u_fade_range:new i.cj(le),u_shadow_normal_offset:new i.ch(le),u_shadow_intensity:new i.ci(le),u_shadow_texel_size:new i.ci(le),u_shadow_map_resolution:new i.ci(le),u_shadow_direction:new i.ch(le),u_shadow_bias:new i.ch(le),u_shadowmap_0:new i.cg(le),u_shadowmap_1:new i.cg(le)}))(l)))}getAttributeLocation(l,f){let _=this.attributes[f];return _===void 0&&(_=this.attributes[f]=l.getAttribLocation(this.program,f)),_}setTerrainUniformValues(l,f){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E]&&_[E].set(this.program,E,f[E])}}setGlobeUniformValues(l,f){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E]&&_[E].set(this.program,E,f[E])}}setFogUniformValues(l,f){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}}setCutoffUniformValues(l,f){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}}setLightsUniformValues(l,f){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}}setShadowUniformValues(l,f){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}_drawDebugWireframe(l,f,_,E,j,k,L,z,G,Z){const Q=l.options.wireframe;if(Q.terrain===!1&&Q.layers2D===!1&&Q.layers3D===!1)return;const X=l.context;if(!(!(!Q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Q.layers2D||l._terrain&&l._terrain.renderingToTexture||!n1.includes(this.name))||!(!Q.layers3D||!i1.includes(this.name))))return;const se=X.gl,le=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,j,X);if(!le)return;const ue=[...this.fixedDefines];ue.push("DEBUG_WIREFRAME");const _e=l.getOrCreateProgram(this.name,{config:this.configuration,defines:ue});X.program.set(_e.program);const ye=(je,qe,Ie)=>{if(qe[je]&&Ie[je])for(const Ge in qe[je])Ie[je][Ge]&&Ie[je][Ge].set(Ie.program,Ge,qe[je][Ge].current)};G&&G.setUniforms(_e.program,X,_e.binderUniforms,L,{zoom:z}),ye("fixedUniforms",this,_e),ye("terrainUniforms",this,_e),ye("globeUniforms",this,_e),ye("fogUniforms",this,_e),ye("lightsUniforms",this,_e),ye("shadowUniforms",this,_e),le.bind(),X.setColorMode(new yn([se.ONE,se.ONE_MINUS_SRC_ALPHA,se.ZERO,se.ONE],i.ao.transparent,[!0,!0,!0,!1])),X.setDepthMode(new Er(f.func===se.LESS?se.LEQUAL:f.func,Er.ReadOnly,f.range)),X.setStencilMode(rn.disabled);const Ee=3*k.primitiveLength*2,Ne=3*k.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const je=Z||1;for(let qe=0;qe<je;++qe)_e.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",qe),se.drawElements(se.LINES,Ee,se.UNSIGNED_SHORT,Ne)}else Z&&Z>1?se.drawElementsInstanced(se.LINES,Ee,se.UNSIGNED_SHORT,Ne,Z):se.drawElements(se.LINES,Ee,se.UNSIGNED_SHORT,Ne);j.bind(),X.program.set(this.program),X.setDepthMode(f),X.setStencilMode(_),X.setColorMode(E)}checkUniforms(l,f,_){if(this.fixedDefines.includes(f)){for(const E of Object.keys(_))if(!_[E].initialized)throw new Error(`Program '${this.name}', from draw '${l}': uniform ${E} not set but required by ${f} being defined`)}}draw(l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e){const ye=l.context,Ee=ye.gl;if(this.failedToCreate)return;ye.program.set(this.program),ye.setDepthMode(_),ye.setStencilMode(E),ye.setColorMode(j),ye.setCullFace(k);for(const qe of Object.keys(this.fixedUniforms))this.fixedUniforms[qe].set(this.program,qe,L[qe]);le&&le.setUniforms(this.program,ye,this.binderUniforms,X,{zoom:se});const Ne={[Ee.POINTS]:1,[Ee.LINES]:2,[Ee.TRIANGLES]:3,[Ee.LINE_STRIP]:1}[f];this.checkUniforms(z,"RENDER_SHADOWS",this.shadowUniforms);const je=_e&&_e>0?1:void 0;for(const qe of Q.get()){const Ie=qe.vaos||(qe.vaos={});if((Ie[z]||(Ie[z]=new Np)).bind(ye,this,G,le?le.getPaintVertexBuffers():[],Z,qe.vertexOffset,ue||[],je),this.forceManualRenderingForInstanceIDShaders){const Ge=_e||1;for(let Ue=0;Ue<Ge;++Ue)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ue),Z?Ee.drawElements(f,qe.primitiveLength*Ne,Ee.UNSIGNED_SHORT,qe.primitiveOffset*Ne*2):Ee.drawArrays(f,qe.vertexOffset,qe.vertexLength)}else _e&&_e>1?Ee.drawElementsInstanced(f,qe.primitiveLength*Ne,Ee.UNSIGNED_SHORT,qe.primitiveOffset*Ne*2,_e):Z?Ee.drawElements(f,qe.primitiveLength*Ne,Ee.UNSIGNED_SHORT,qe.primitiveOffset*Ne*2):Ee.drawArrays(f,qe.vertexOffset,qe.vertexLength);f===Ee.TRIANGLES&&Z&&this._drawDebugWireframe(l,_,E,j,Z,qe,X,se,le,_e)}}}function k_(v,l,f=0){const _=Math.pow(2,l.tileID.overscaledZ),E=l.tileSize*Math.pow(2,v.transform.tileZoom)/_,j=E*(l.tileID.canonical.x+l.tileID.wrap*_),k=E*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(l,1,v.transform.tileZoom),u_pixel_coord_upper:[j>>16,k>>16],u_pixel_coord_lower:[65535&j,65535&k],u_pattern_transition:f}}const Lp={terrain:0,flat:1},N_=i.bB(),I_=(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye)=>{const Ee=l.style.light,Ne=Ee.properties.get("position"),je=[Ne.x,Ne.y,Ne.z],qe=i.dN();Ee.properties.get("anchor")==="viewport"&&(i.dO(qe,-l.transform.angle),i.dP(je,je,qe));const Ie=Ee.properties.get("color").toPremultipliedRenderColor(null),Ge=l.transform,Ue={u_matrix:v,u_lightpos:je,u_lightintensity:Ee.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_vertical_gradient:+f,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:N_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Lp[G],u_base_type:Lp[Z],u_ao:E,u_edge_radius:j,u_width_scale:k,u_flood_light_color:le,u_vertical_scale:ue,u_flood_light_intensity:_e,u_ground_shadow_factor:ye};return Ge.projection.name==="globe"&&(Ue.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],Ue.u_zoom_transition=Q,Ue.u_inv_rot_matrix=se,Ue.u_merc_center=X,Ue.u_up_dir=Ge.projection.upVector(new i.cC(0,0,0),X[0]*i.al,X[1]*i.al),Ue.u_height_lift=z),Ue},yA=(v,l,f,_,E,j)=>({u_matrix:v,u_edge_radius:l,u_width_scale:f,u_vertical_scale:_,u_height_type:Lp[E],u_base_type:Lp[j]}),vA=(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye)=>{const Ee=I_(v,l,f,_,E,j,k,L,G,Z,Q,X,se,le,ue,_e,1,[0,0,0]),Ne={u_height_factor:-Math.pow(2,L.overscaledZ)/z.tileSize/8};return Object.assign(Ee,k_(l,z,ye),Ne)},Fp=(v,l,f,_,E,j,k,L,z,G,Z)=>({u_matrix:l,u_opacity:f,u_ao_pass:_?1:0,u_meter_to_tile:E,u_ao:j,u_flood_light_intensity:k,u_flood_light_color:L,u_attenuation:z,u_edge_radius:G,u_fb:0,u_fb_size:Z,u_dynamic_offset:1}),_A=(v,l,f)=>({u_matrix:v,u_emissive_strength:l,u_ground_shadow_factor:f}),xA=(v,l,f,_,E,j=0)=>Object.assign(_A(v,l,E),k_(f,_,j)),uR=(v,l,f,_)=>({u_matrix:v,u_world:f,u_emissive_strength:l,u_ground_shadow_factor:_}),dR=(v,l,f,_,E,j,k=0)=>Object.assign(xA(v,l,f,_,j,k),{u_world:E}),hR=(v,l)=>({u_matrix:v,u_ground_shadow_factor:l}),R_=(v,l,f,_,E)=>({u_matrix:v,u_camera_pos:[l[0],l[1],l[2]],u_depth_bias:f,u_height_scale:_,u_reset_depth:E}),s1=(v,l,f,_,E,j,k,L,z)=>({u_matrix:v,u_normal_matrix:l,u_opacity:f,u_faux_facade_ao_intensity:_,u_camera_pos:E,u_tile_to_meter:j,u_facade_emissive_chance:k,u_flood_light_color:L,u_flood_light_intensity:z}),a1=v=>({u_matrix:v}),bA=v=>({u_matrix:v}),zp=(v,l,f,_,E,j,k,L)=>{const z=i.al/j.tileSize;return{u_matrix:v,u_inv_rot_matrix:l,u_camera_to_center_distance:f.getCameraToCenterDistance(L),u_extrude_scale:[f.pixelsToGLUnits[0]/z,f.pixelsToGLUnits[1]/z],u_zoom_transition:_,u_tile_id:k,u_merc_center:E}},o1=(v,l,f=1)=>({u_matrix:v,u_color:l,u_overlay:0,u_overlay_scale:f}),wA=i.bB(),SA=(v,l,f,_,E,j,k)=>{const L=v.transform,z=L.projection.name==="globe",G=z?i.dQ(L.zoom,l.canonical)*L._pixelsPerMercatorPixel:i.ay(f,1,j),Z={u_matrix:l.projMatrix,u_extrude_scale:G,u_intensity:k,u_inv_rot_matrix:wA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){Z.u_inv_rot_matrix=_,Z.u_merc_center=E,Z.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],Z.u_zoom_transition=i.aj(L.zoom);const Q=E[0]*i.al,X=E[1]*i.al;Z.u_up_dir=L.projection.upVector(new i.cC(0,0,0),Q,X)}return Z};function M_(v,[l,f,_,E],[j,k]){if(j===k)return[0,0,0,0];const L=255*(v-1)/(v*(k-j));return[l*L,f*L,_*L,E*L]}function cd(v,l,[f,_]){return f===_?0:.5/v+(l-f)*(v-1)/(v*(_-f))}const uy=(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye,Ee,Ne,je)=>({u_matrix:v,u_normalize_matrix:l,u_globe_matrix:f,u_merc_matrix:_,u_grid_matrix:E,u_tl_parent:j,u_scale_parent:G,u_fade_t:Z.mix,u_opacity:Z.opacity*Q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Q.paint.get("raster-brightness-min"),u_brightness_high:Q.paint.get("raster-brightness-max"),u_saturation_factor:i.dS(Q.paint.get("raster-saturation")),u_contrast_factor:i.dR(Q.paint.get("raster-contrast")),u_spin_weights:D_(Q.paint.get("raster-hue-rotate")),u_perspective_transform:X,u_raster_elevation:se,u_zoom_transition:k,u_merc_center:L,u_cutoff_params:z,u_colorization_mix:M_(i.dT,ue,ye),u_colorization_offset:cd(i.dT,_e,ye),u_color_ramp:le,u_texture_offset:[Ne/(Ee+2*Ne),Ee/(Ee+2*Ne)],u_texture_res:[Ee+2*Ne,Ee+2*Ne],u_emissive_strength:je});function D_(v){v*=Math.PI/180;const l=Math.sin(v),f=Math.cos(v);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const yf=.05,th=(v,l,f,_,E,j,k,L,z,G,Z,Q)=>({u_matrix:v,u_normalize_matrix:l,u_globe_matrix:f,u_merc_matrix:_,u_grid_matrix:E,u_tl_parent:j,u_scale_parent:G,u_fade_t:Z.mix,u_opacity:Z.opacity,u_image0:0,u_image1:1,u_raster_elevation:Q,u_zoom_transition:k,u_merc_center:L,u_cutoff_params:z}),l1=(v,l,f,_,E,j,k,L,z,G)=>({u_particle_texture:v,u_particle_texture_side_len:l,u_tile_offset:f,u_velocity:_,u_color_ramp:j,u_velocity_res:E,u_max_speed:k,u_uv_offset:L,u_data_scale:[255*z[0],255*z[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[yf,yf]}),L_=(v,l,f,_,E,j,k,L,z,G)=>({u_particle_texture:v,u_particle_texture_side_len:l,u_velocity:f,u_velocity_res:_,u_max_speed:E,u_speed_factor:j,u_reset_rate:k,u_rand_seed:Math.random(),u_uv_offset:L,u_data_scale:[255*z[0],255*z[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[yf,yf]}),c1=i.bB(),u1=(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye,Ee,Ne,je,qe,Ie,Ge)=>{const Ue=E.transform,De={u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Ue.getCameraToCenterDistance(Ee),u_rotate_symbol:+f,u_aspect_ratio:Ue.width/Ue.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:j,u_label_plane_matrix:k,u_coord_matrix:L,u_is_text:+G,u_elevation_from_sea:z?1:0,u_pitch_with_map:+_,u_texsize:Z,u_texsize_icon:Q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:c1,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:c1,u_up_vector:[0,-1,0],u_color_adj_mat:qe,u_icon_transition:Ie||0,u_gamma_scale:_?E.transform.getCameraToCenterDistance(Ee)*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ge||1,u_ground_shadow_factor:Ne,u_inv_matrix:i.bk(i.bB(),k),u_normal_scale:je,u_lutTexture:Ka.LUT};return Ee.name==="globe"&&(De.u_tile_id=[se.canonical.x,se.canonical.y,1<<se.canonical.z],De.u_zoom_transition=le,De.u_inv_rot_matrix=_e,De.u_merc_center=ue,De.u_camera_forward=Ue._camera.forward(),De.u_ecef_origin=i.dU(Ue.globeMatrix,se.toUnwrapped()),De.u_tile_matrix=Float32Array.from(Ue.globeMatrix),De.u_up_vector=ye),De},F_=(v,l,f,_)=>({u_matrix:v,u_emissive_strength:l,u_opacity:f,u_color:_}),z_=(v,l,f,_,E,j,k,L,z)=>Object.assign(function(G,Z,Q,X,se,le){const{width:ue,height:_e}=X.imageManager.getPixelSize(Z),ye=Math.pow(2,le.tileID.overscaledZ),Ee=le.tileSize*Math.pow(2,X.transform.tileZoom)/ye,Ne=Ee*(le.tileID.canonical.x+le.tileID.wrap*ye),je=Ee*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:Q.tl,u_pattern_br:Q.br,u_texsize:[ue,_e],u_pattern_size:Q.displaySize,u_pattern_units_to_pixels:se?[X.transform.width,-1*X.transform.height]:[1/i.ay(le,1,X.transform.tileZoom),1/i.ay(le,1,X.transform.tileZoom)],u_pixel_coord_upper:[Ne>>16,je>>16],u_pixel_coord_lower:[65535&Ne,65535&je]}}(0,j,k,_,L,z),{u_matrix:v,u_emissive_strength:l,u_opacity:f}),d1=new Float32Array(i.bz([])),B_=(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se=[0,0,0],le,ue,_e)=>{const ye=E.style.light,Ee=ye.properties.get("position"),Ne=[-Ee.x,-Ee.y,Ee.z],je=i.dN();ye.properties.get("anchor")==="viewport"&&(i.dO(je,-E.transform.angle),i.dP(Ne,Ne,je));const qe=Z.alphaMode==="MASK",Ie=ye.properties.get("color").toNonPremultipliedRenderColor(null),Ge=X.paint.get("model-ambient-occlusion-intensity"),Ue=X.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return Ue.a=X.paint.get("model-color-mix-intensity").constantOr(0),_e&&(Ue.r=_e[0],Ue.g=_e[1],Ue.b=_e[2],Ue.a=_e[3]),ue&&(Ue.r=ue.color.r,Ue.g=ue.color.g,Ue.b=ue.color.b,Ue.a=ue.colorMix,Q=ue.emissionStrength,j=ue.opacity),{u_matrix:v,u_lighting_matrix:l,u_normal_matrix:f,u_node_matrix:_||d1,u_lightpos:Ne,u_lightintensity:ye.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_camera_pos:se,u_opacity:j,u_baseTextureIsAlpha:0,u_alphaMask:+qe,u_alphaCutoff:Z.alphaCutoff,u_baseColorFactor:k.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:L.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:z,u_roughnessFactor:G,u_baseColorTexture:Ka.BaseColor,u_metallicRoughnessTexture:Ka.MetallicRoughness,u_normalTexture:Ka.Normal,u_occlusionTexture:Ka.Occlusion,u_emissionTexture:Ka.Emission,u_lutTexture:Ka.LUT,u_color_mix:Ue.toArray01(),u_aoIntensity:Ge,u_emissive_strength:Q,u_occlusionTextureTransform:le||[0,0,0,0]}},Bp=(v,l=d1,f=d1)=>({u_matrix:v,u_instance:l,u_node_matrix:f}),fR={fillExtrusion:v=>({u_matrix:new i.ck(v),u_lightpos:new i.ch(v),u_lightintensity:new i.ci(v),u_lightcolor:new i.ch(v),u_vertical_gradient:new i.ci(v),u_opacity:new i.ci(v),u_edge_radius:new i.ci(v),u_width_scale:new i.ci(v),u_ao:new i.cj(v),u_height_type:new i.cg(v),u_base_type:new i.cg(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_up_dir:new i.ch(v),u_height_lift:new i.ci(v),u_flood_light_color:new i.ch(v),u_vertical_scale:new i.ci(v),u_flood_light_intensity:new i.ci(v),u_ground_shadow_factor:new i.ch(v)}),fillExtrusionDepth:v=>({u_matrix:new i.ck(v),u_edge_radius:new i.ci(v),u_width_scale:new i.ci(v),u_vertical_scale:new i.ci(v),u_height_type:new i.cg(v),u_base_type:new i.cg(v)}),fillExtrusionPattern:v=>({u_matrix:new i.ck(v),u_lightpos:new i.ch(v),u_lightintensity:new i.ci(v),u_lightcolor:new i.ch(v),u_vertical_gradient:new i.ci(v),u_height_factor:new i.ci(v),u_edge_radius:new i.ci(v),u_width_scale:new i.ci(v),u_ao:new i.cj(v),u_height_type:new i.cg(v),u_base_type:new i.cg(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_up_dir:new i.ch(v),u_height_lift:new i.ci(v),u_image:new i.cg(v),u_texsize:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_tile_units_to_pixels:new i.ci(v),u_opacity:new i.ci(v),u_pattern_transition:new i.ci(v)}),fillExtrusionGroundEffect:v=>({u_matrix:new i.ck(v),u_opacity:new i.ci(v),u_ao_pass:new i.ci(v),u_meter_to_tile:new i.ci(v),u_ao:new i.cj(v),u_flood_light_intensity:new i.ci(v),u_flood_light_color:new i.ch(v),u_attenuation:new i.ci(v),u_edge_radius:new i.ci(v),u_fb:new i.cg(v),u_fb_size:new i.ci(v),u_dynamic_offset:new i.ci(v)}),fill:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_ground_shadow_factor:new i.ch(v)}),fillPattern:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_image:new i.cg(v),u_texsize:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_tile_units_to_pixels:new i.ci(v),u_ground_shadow_factor:new i.ch(v),u_pattern_transition:new i.ci(v)}),fillOutline:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_world:new i.cj(v),u_ground_shadow_factor:new i.ch(v)}),fillOutlinePattern:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_world:new i.cj(v),u_image:new i.cg(v),u_texsize:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_tile_units_to_pixels:new i.ci(v),u_ground_shadow_factor:new i.ch(v),u_pattern_transition:new i.ci(v)}),building:v=>({u_matrix:new i.ck(v),u_normal_matrix:new i.ck(v),u_opacity:new i.ci(v),u_faux_facade_ao_intensity:new i.ci(v),u_camera_pos:new i.ch(v),u_tile_to_meter:new i.ci(v),u_facade_emissive_chance:new i.ci(v),u_flood_light_color:new i.ch(v),u_flood_light_intensity:new i.ci(v)}),buildingBloom:v=>({u_matrix:new i.ck(v)}),buildingDepth:v=>({u_matrix:new i.ck(v)}),elevatedStructuresDepth:v=>({u_matrix:new i.ck(v),u_depth_bias:new i.ci(v)}),elevatedStructures:v=>({u_matrix:new i.ck(v),u_ground_shadow_factor:new i.ch(v)}),elevatedStructuresDepthReconstruct:v=>({u_matrix:new i.ck(v),u_camera_pos:new i.ch(v),u_depth_bias:new i.ci(v),u_height_scale:new i.ci(v),u_reset_depth:new i.ci(v)}),circle:i.dX,collisionBox:v=>({u_matrix:new i.ck(v),u_inv_rot_matrix:new i.ck(v),u_camera_to_center_distance:new i.ci(v),u_extrude_scale:new i.cj(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_tile_id:new i.ch(v)}),collisionCircle:v=>({u_matrix:new i.ck(v),u_inv_matrix:new i.ck(v),u_camera_to_center_distance:new i.ci(v),u_viewport_size:new i.cj(v)}),debug:v=>({u_color:new i.dA(v),u_matrix:new i.ck(v),u_overlay:new i.cg(v),u_overlay_scale:new i.ci(v)}),clippingMask:v=>({u_matrix:new i.ck(v)}),heatmap:v=>({u_extrude_scale:new i.ci(v),u_intensity:new i.ci(v),u_matrix:new i.ck(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_up_dir:new i.ch(v)}),heatmapTexture:v=>({u_image:new i.cg(v),u_color_ramp:new i.cg(v),u_opacity:new i.ci(v)}),hillshade:v=>({u_matrix:new i.ck(v),u_image:new i.cg(v),u_latrange:new i.cj(v),u_light:new i.cj(v),u_shadow:new i.dA(v),u_highlight:new i.dA(v),u_emissive_strength:new i.ci(v),u_accent:new i.dA(v)}),hillshadePrepare:v=>({u_matrix:new i.ck(v),u_image:new i.cg(v),u_dimension:new i.cj(v),u_zoom:new i.ci(v)}),line:i.dW,linePattern:i.dV,raster:v=>({u_matrix:new i.ck(v),u_normalize_matrix:new i.ck(v),u_globe_matrix:new i.ck(v),u_merc_matrix:new i.ck(v),u_grid_matrix:new i.dB(v),u_tl_parent:new i.cj(v),u_scale_parent:new i.ci(v),u_fade_t:new i.ci(v),u_opacity:new i.ci(v),u_image0:new i.cg(v),u_image1:new i.cg(v),u_brightness_low:new i.ci(v),u_brightness_high:new i.ci(v),u_saturation_factor:new i.ci(v),u_contrast_factor:new i.ci(v),u_spin_weights:new i.ch(v),u_perspective_transform:new i.cj(v),u_raster_elevation:new i.ci(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_cutoff_params:new i.d2(v),u_colorization_mix:new i.d2(v),u_colorization_offset:new i.ci(v),u_color_ramp:new i.cg(v),u_texture_offset:new i.cj(v),u_texture_res:new i.cj(v),u_emissive_strength:new i.ci(v)}),rasterParticle:v=>({u_matrix:new i.ck(v),u_normalize_matrix:new i.ck(v),u_globe_matrix:new i.ck(v),u_merc_matrix:new i.ck(v),u_grid_matrix:new i.dB(v),u_tl_parent:new i.cj(v),u_scale_parent:new i.ci(v),u_fade_t:new i.ci(v),u_opacity:new i.ci(v),u_image0:new i.cg(v),u_image1:new i.cg(v),u_raster_elevation:new i.ci(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_cutoff_params:new i.d2(v)}),rasterParticleTexture:v=>({u_texture:new i.cg(v),u_opacity:new i.ci(v)}),rasterParticleDraw:v=>({u_particle_texture:new i.cg(v),u_particle_texture_side_len:new i.ci(v),u_tile_offset:new i.cj(v),u_velocity:new i.cg(v),u_color_ramp:new i.cg(v),u_velocity_res:new i.cj(v),u_max_speed:new i.ci(v),u_uv_offset:new i.cj(v),u_data_scale:new i.cj(v),u_data_offset:new i.ci(v),u_particle_pos_scale:new i.ci(v),u_particle_pos_offset:new i.cj(v)}),rasterParticleUpdate:v=>({u_particle_texture:new i.cg(v),u_particle_texture_side_len:new i.ci(v),u_velocity:new i.cg(v),u_velocity_res:new i.cj(v),u_max_speed:new i.ci(v),u_speed_factor:new i.ci(v),u_reset_rate:new i.ci(v),u_rand_seed:new i.ci(v),u_uv_offset:new i.cj(v),u_data_scale:new i.cj(v),u_data_offset:new i.ci(v),u_particle_pos_scale:new i.ci(v),u_particle_pos_offset:new i.cj(v)}),symbol:v=>({u_is_size_zoom_constant:new i.cg(v),u_is_size_feature_constant:new i.cg(v),u_size_t:new i.ci(v),u_size:new i.ci(v),u_camera_to_center_distance:new i.ci(v),u_rotate_symbol:new i.cg(v),u_aspect_ratio:new i.ci(v),u_fade_change:new i.ci(v),u_matrix:new i.ck(v),u_label_plane_matrix:new i.ck(v),u_coord_matrix:new i.ck(v),u_is_text:new i.cg(v),u_elevation_from_sea:new i.cg(v),u_pitch_with_map:new i.cg(v),u_texsize:new i.cj(v),u_texsize_icon:new i.cj(v),u_texture:new i.cg(v),u_texture_icon:new i.cg(v),u_gamma_scale:new i.ci(v),u_device_pixel_ratio:new i.ci(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_camera_forward:new i.ch(v),u_tile_matrix:new i.ck(v),u_up_vector:new i.ch(v),u_ecef_origin:new i.ch(v),u_is_halo:new i.cg(v),u_icon_transition:new i.ci(v),u_color_adj_mat:new i.ck(v),u_scale_factor:new i.ci(v),u_ground_shadow_factor:new i.ch(v),u_inv_matrix:new i.ck(v),u_normal_scale:new i.ci(v),u_lutTexture:new i.cg(v)}),background:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_opacity:new i.ci(v),u_color:new i.dA(v)}),backgroundPattern:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_opacity:new i.ci(v),u_image:new i.cg(v),u_pattern_tl:new i.cj(v),u_pattern_br:new i.cj(v),u_texsize:new i.cj(v),u_pattern_size:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_pattern_units_to_pixels:new i.cj(v)}),terrainRaster:v=>({u_matrix:new i.ck(v),u_image0:new i.cg(v),u_skirt_height:new i.ci(v),u_ground_shadow_factor:new i.ch(v)}),skybox:v=>({u_matrix:new i.ck(v),u_sun_direction:new i.ch(v),u_cubemap:new i.cg(v),u_opacity:new i.ci(v),u_temporal_offset:new i.ci(v)}),skyboxGradient:v=>({u_matrix:new i.ck(v),u_color_ramp:new i.cg(v),u_center_direction:new i.ch(v),u_radius:new i.ci(v),u_opacity:new i.ci(v),u_temporal_offset:new i.ci(v)}),skyboxCapture:v=>({u_matrix_3f:new i.dB(v),u_sun_direction:new i.ch(v),u_sun_intensity:new i.ci(v),u_color_tint_r:new i.d2(v),u_color_tint_m:new i.d2(v),u_luminance:new i.ci(v)}),globeRaster:v=>({u_proj_matrix:new i.ck(v),u_globe_matrix:new i.ck(v),u_normalize_matrix:new i.ck(v),u_merc_matrix:new i.ck(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_image0:new i.cg(v),u_grid_matrix:new i.dB(v),u_skirt_height:new i.ci(v),u_far_z_cutoff:new i.ci(v),u_frustum_tl:new i.ch(v),u_frustum_tr:new i.ch(v),u_frustum_br:new i.ch(v),u_frustum_bl:new i.ch(v),u_globe_pos:new i.ch(v),u_globe_radius:new i.ci(v),u_viewport:new i.cj(v)}),globeAtmosphere:v=>({u_frustum_tl:new i.ch(v),u_frustum_tr:new i.ch(v),u_frustum_br:new i.ch(v),u_frustum_bl:new i.ch(v),u_horizon:new i.ci(v),u_transition:new i.ci(v),u_fadeout_range:new i.ci(v),u_atmosphere_fog_color:new i.d2(v),u_high_color:new i.d2(v),u_space_color:new i.d2(v),u_temporal_offset:new i.ci(v),u_horizon_angle:new i.ci(v)}),model:v=>({u_matrix:new i.ck(v),u_lighting_matrix:new i.ck(v),u_normal_matrix:new i.ck(v),u_node_matrix:new i.ck(v),u_lightpos:new i.ch(v),u_lightintensity:new i.ci(v),u_lightcolor:new i.ch(v),u_camera_pos:new i.ch(v),u_opacity:new i.ci(v),u_baseColorFactor:new i.d2(v),u_emissiveFactor:new i.d2(v),u_metallicFactor:new i.ci(v),u_roughnessFactor:new i.ci(v),u_baseTextureIsAlpha:new i.cg(v),u_alphaMask:new i.cg(v),u_alphaCutoff:new i.ci(v),u_baseColorTexture:new i.cg(v),u_metallicRoughnessTexture:new i.cg(v),u_normalTexture:new i.cg(v),u_occlusionTexture:new i.cg(v),u_emissionTexture:new i.cg(v),u_lutTexture:new i.cg(v),u_color_mix:new i.d2(v),u_aoIntensity:new i.ci(v),u_emissive_strength:new i.ci(v),u_occlusionTextureTransform:new i.d2(v)}),modelDepth:v=>({u_matrix:new i.ck(v),u_instance:new i.ck(v),u_node_matrix:new i.ck(v)}),groundShadow:v=>({u_matrix:new i.ck(v),u_ground_shadow_factor:new i.ch(v)}),stars:v=>({u_matrix:new i.ck(v),u_up:new i.ch(v),u_right:new i.ch(v),u_intensity_multiplier:new i.ci(v)}),snowParticle:v=>({u_modelview:new i.ck(v),u_projection:new i.ck(v),u_time:new i.ci(v),u_cam_pos:new i.ch(v),u_velocityConeAperture:new i.ci(v),u_velocity:new i.ci(v),u_horizontalOscillationRadius:new i.ci(v),u_horizontalOscillationRate:new i.ci(v),u_boxSize:new i.ci(v),u_billboardSize:new i.ci(v),u_simpleShapeParameters:new i.cj(v),u_screenSize:new i.cj(v),u_thinningCenterPos:new i.cj(v),u_thinningShape:new i.ch(v),u_thinningAffectedRatio:new i.ci(v),u_thinningParticleOffset:new i.ci(v),u_particleColor:new i.d2(v),u_direction:new i.ch(v)}),rainParticle:v=>({u_modelview:new i.ck(v),u_projection:new i.ck(v),u_time:new i.ci(v),u_cam_pos:new i.ch(v),u_texScreen:new i.cg(v),u_velocityConeAperture:new i.ci(v),u_velocity:new i.ci(v),u_boxSize:new i.ci(v),u_rainDropletSize:new i.cj(v),u_distortionStrength:new i.ci(v),u_rainDirection:new i.ch(v),u_color:new i.d2(v),u_screenSize:new i.cj(v),u_thinningCenterPos:new i.cj(v),u_thinningShape:new i.ch(v),u_thinningAffectedRatio:new i.ci(v),u_thinningParticleOffset:new i.ci(v),u_shapeDirectionalPower:new i.ci(v),u_shapeNormalPower:new i.ci(v),u_mode:new i.ci(v)}),vignette:v=>({u_vignetteShape:new i.ch(v),u_vignetteColor:new i.d2(v)}),occlusion:v=>({u_matrix:new i.ck(v),u_anchorPos:new i.ch(v),u_screenSizePx:new i.cj(v),u_occluderSizePx:new i.cj(v),u_color:new i.d2(v)})};class rh{constructor(l,f,_,E){this.id=rh.uniqueIdxCounter,rh.uniqueIdxCounter++,this.context=l;const j=l.gl;this.buffer=j.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),j.bufferData(j.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||E||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=rh.uniqueIdxCounter,rh.uniqueIdxCounter++;const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}rh.uniqueIdxCounter=0;const EA={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pR{constructor(l,f,_,E,j,k){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=E,this.instanceCount=k,this.context=l;const L=l.gl;this.buffer=L.createBuffer(),l.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||j||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let _=0;_<this.attributes.length;_++){const E=f.getAttributeLocation(l,this.attributes[_].name);E!==-1&&l.enableVertexAttribArray(E)}}setVertexAttribPointers(l,f,_){for(let E=0;E<this.attributes.length;E++){const j=this.attributes[E],k=f.getAttributeLocation(l,j.name);k!==-1&&l.vertexAttribPointer(k,j.components,l[EA[j.type]],!1,this.itemSize,j.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(l,f,_){for(let E=0;E<this.attributes.length;E++){const j=f.getAttributeLocation(l,this.attributes[E].name);j!==-1&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(j,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $_{constructor(l,f,_,E,j){this.context=l,this.width=f,this.height=_;const k=this.framebuffer=l.gl.createFramebuffer();E&&(this.colorAttachment=new lR(l,k)),j&&(this.depthAttachmentType=j,this.depthAttachment=j==="renderbuffer"?new mA(l,k):new cR(l,k))}destroy(){const l=this.context.gl;if(this.colorAttachment){const f=this.colorAttachment.get();f&&l.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&l.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&l.deleteTexture(f)}l.deleteFramebuffer(this.framebuffer)}}class U_{constructor(l,f){this.gl=l,this.clearColor=new oA(this),this.clearDepth=new Ww(this),this.clearStencil=new rR(this),this.colorMask=new nR(this),this.depthMask=new iR(this),this.stencilMask=new sR(this),this.stencilFunc=new lA(this),this.stencilOp=new aR(this),this.stencilTest=new w_(this),this.depthRange=new oR(this),this.depthTest=new cA(this),this.depthFunc=new Kw(this),this.blend=new S_(this),this.blendFunc=new Zw(this),this.blendColor=new pf(this),this.blendEquation=new Ip(this),this.cullFace=new iy(this),this.cullFaceSide=new Rp(this),this.frontFace=new uA(this),this.program=new Xw(this),this.activeTexture=new dA(this),this.viewport=new Mp(this),this.bindFramebuffer=new E_(this),this.bindRenderbuffer=new T_(this),this.bindTexture=new Yw(this),this.bindVertexBuffer=new A_(this),this.bindElementBuffer=new sy(this),this.bindVertexArrayOES=new hA(this),this.pixelStoreUnpack=new fA(this),this.pixelStoreUnpackPremultiplyAlpha=new pA(this),this.pixelStoreUnpackFlipY=new Dp(this),this.options=f?Object.assign({},f):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=f&&!!f.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f,_){return new rh(this,l,f,_)}createVertexBuffer(l,f,_,E,j){return new pR(this,l,f,_,E,j)}createRenderbuffer(l,f,_){const E=this.gl,j=E.createRenderbuffer();return this.bindRenderbuffer.set(j),E.renderbufferStorage(E.RENDERBUFFER,l,f,_),this.bindRenderbuffer.set(null),j}createFramebuffer(l,f,_,E){return new $_(this,l,f,_,E)}clear({color:l,depth:f,stencil:_,colorMask:E}){const j=this.gl;let k=0;l&&(k|=j.COLOR_BUFFER_BIT,this.clearColor.set(l.toNonPremultipliedRenderColor(null)),this.colorMask.set(E||[!0,!0,!0,!0])),f!==void 0&&(k|=j.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(k|=j.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),j.clear(k)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){i.bx(l.blendFunction,yn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ou;function dy(v,l,f,_,E,j,k){const L=v.context,z=L.gl,G=v.transform,Z=[i.aF(G.center.lng),i.aJ(G.center.lat)],Q=f.layout.get("symbol-placement"),X=f.layout.get("text-variable-anchor"),se=f.layout.get("icon-rotation-alignment")==="map",le=f.layout.get("text-rotation-alignment")==="map",ue=Q!=="point",_e=[];let ye=0,Ee=0;for(let De=0;De<_.length;De++){const Ze=_[De],ut=l.getTile(Ze),ot=ut.getBucket(f);if(!ot)continue;const St=ot.getProjection().createInversionMatrix(G,Ze.canonical),gt=[],kt=eA(Ze,ot,G),Qt=!k&&se&&ue,mt=k&&le&&ue,nt=X&&ot.hasTextData(),Nt=ot.hasIconTextFit()&&nt&&ot.hasIconData(),yt=Qt||mt||k&&nt||Nt,$t=ot.projection.name==="globe",nr=$t?i.aj(G.zoom):0;$t&&(gt.push("PROJECTION_GLOBE_VIEW"),yt&&gt.push("PROJECTED_POS_ON_VIEWPORT"));const xr=v.getOrCreateProgram("collisionBox",{defines:gt});let Xt=kt;E[0]===0&&E[1]===0||(Xt=v.translatePosMatrix(kt,ut,E,j));const tr=k?ot.textCollisionBox:ot.iconCollisionBox,wr=ot.collisionCircleArray;if(wr.length>0){const dr=i.bB(),mr=Xt;i.cO(dr,ot.placementInvProjMatrix,G.glCoordMatrix),i.cO(dr,dr,ot.placementViewportMatrix),_e.push({circleArray:wr,circleOffset:Ee,transform:mr,invTransform:dr,projection:ot.getProjection()}),ye+=wr.length/4,Ee=ye}if(!tr)continue;v.terrain&&v.terrain.setupElevationDraw(ut,xr);const pr=$t?[Ze.canonical.x,Ze.canonical.y,1<<Ze.canonical.z]:[0,0,0];xr.draw(v,z.LINES,Er.disabled,rn.disabled,v.colorModeForRenderPass(),Xr.disabled,zp(Xt,St,G,nr,Z,ut,pr,ot.getProjection()),f.id,tr.layoutVertexBuffer,tr.indexBuffer,tr.segments,null,G.zoom,null,[tr.collisionVertexBuffer,tr.collisionVertexBufferExt])}if(!k||!_e.length)return;const Ne=v.getOrCreateProgram("collisionCircle"),je=new i.dY;je.resize(4*ye),je._trim();let qe=0;for(const De of _e)for(let Ze=0;Ze<De.circleArray.length/4;Ze++){const ut=4*Ze,ot=De.circleArray[ut+0],St=De.circleArray[ut+1],gt=De.circleArray[ut+2],kt=De.circleArray[ut+3];je.emplace(qe++,ot,St,gt,kt,0),je.emplace(qe++,ot,St,gt,kt,1),je.emplace(qe++,ot,St,gt,kt,2),je.emplace(qe++,ot,St,gt,kt,3)}(!Ou||Ou.length<2*ye)&&(Ou=function(De){const Ze=2*De,ut=new i.b0;ut.resize(Ze),ut._trim();for(let ot=0;ot<Ze;ot++){const St=6*ot;ut.uint16[St+0]=4*ot+0,ut.uint16[St+1]=4*ot+1,ut.uint16[St+2]=4*ot+2,ut.uint16[St+3]=4*ot+2,ut.uint16[St+4]=4*ot+3,ut.uint16[St+5]=4*ot+0}return ut}(ye));const Ie=L.createIndexBuffer(Ou,!0),Ge=L.createVertexBuffer(je,i.dZ.members,!0);for(const De of _e){const Ze={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(Ue=G).getCameraToCenterDistance(De.projection),u_viewport_size:[Ue.width,Ue.height]};Ne.draw(v,z.TRIANGLES,Er.disabled,rn.disabled,v.colorModeForRenderPass(),Xr.disabled,Ze,f.id,Ge,Ie,i.bf.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,G.zoom)}var Ue;Ge.destroy(),Ie.destroy()}const nh=i.bB();function h1(v){const l=v._camera.getWorldToCamera(v.worldSize,1),f=i.aB([],l,v.globeMatrix);i.bk(f,f);const _=[0,0,0],E=[0,1,0,0];return i.aC(E,E,f),_[0]=E[0],_[1]=E[1],_[2]=E[2],i.aw(_,_),_}function V_({width:v,height:l,anchor:f,textOffset:_,textScale:E},j){const{horizontalAlign:k,verticalAlign:L}=i.c0(f),z=-(k-.5)*v,G=-(L-.5)*l,Z=i.c1(f,_);return new i.P((z/E+Z[0])*j,(G/E+Z[1])*j)}function q_(v,l,f,_,E,j,k,L,z,G){const Z=v.text.placedSymbolArray,Q=v.text.dynamicLayoutVertexArray,X=v.icon.dynamicLayoutVertexArray,se={},le=v.getProjection(),ue=u_(k,le,E),_e=E.elevation,ye=le.upVectorScale(k.canonical,E.center.lat,E.worldSize).metersToTile;Q.clear();for(let Ee=0;Ee<Z.length;Ee++){const Ne=Z.get(Ee),{tileAnchorX:je,tileAnchorY:qe,numGlyphs:Ie}=Ne,Ge=Ne.hidden||!Ne.crossTileID||v.allowVerticalPlacement&&!Ne.placedOrientation?null:_[Ne.crossTileID];if(Ge){let Ue=0,De=0,Ze=0;const ut=v.elevationType==="road";if(_e||ut){const yt=ut?v.getElevationFeatureForText(Ee):null,$t=i.bU.getAtTileOffset(k,new i.P(je,qe),_e,yt),[nr,xr,Xt]=le.upVector(k.canonical,je,qe);Ue=$t*nr*ye,De=$t*xr*ye,Ze=$t*Xt*ye}let[ot,St,gt,kt]=ca(Ne.projectedAnchorX+Ue,Ne.projectedAnchorY+De,Ne.projectedAnchorZ+Ze,f?ue:j);const Qt=Rw(E.getCameraToCenterDistance(le),kt);let mt=i.bL(v.textSizeData,z,Ne)*Qt/i.bX;f&&(mt*=v.tilePixelRatio/L);const nt=V_(Ge,mt);f?({x:ot,y:St,z:gt}=le.projectTilePoint(je+nt.x,qe+nt.y,k.canonical),[ot,St,gt]=ca(ot+Ue,St+De,gt+Ze,j)):(l&&nt._rotate(-E.angle),ot+=nt.x,St+=nt.y,gt=0);const Nt=v.allowVerticalPlacement&&Ne.placedOrientation===i.bK.vertical?Math.PI/2:0;for(let yt=0;yt<Ie;yt++)i.bN(Q,ot,St,gt,Nt);G&&Ne.associatedIconIndex>=0&&(se[Ne.associatedIconIndex]={x:ot,y:St,z:gt,angle:Nt})}else sd(Ie,Q)}if(G){X.clear();const Ee=v.icon.placedSymbolArray;for(let Ne=0;Ne<Ee.length;Ne++){const je=Ee.get(Ne),{numGlyphs:qe}=je,Ie=se[Ne];if(je.hidden||!Ie)sd(qe,X);else{const{x:Ge,y:Ue,z:De,angle:Ze}=Ie;for(let ut=0;ut<qe;ut++)i.bN(X,Ge,Ue,De,Ze)}}v.icon.dynamicLayoutVertexBuffer.updateData(X)}v.text.dynamicLayoutVertexBuffer.updateData(Q)}function hy(v,l,f,_,E,j,k={}){const L=f.paint.get("icon-translate"),z=f.paint.get("text-translate"),G=f.paint.get("icon-translate-anchor"),Z=f.paint.get("text-translate-anchor"),Q=f.layout.get("icon-rotation-alignment"),X=f.layout.get("text-rotation-alignment"),se=f.layout.get("icon-pitch-alignment"),le=f.layout.get("text-pitch-alignment"),ue=f.layout.get("icon-keep-upright"),_e=f.layout.get("text-keep-upright"),ye=f.paint.get("icon-color-saturation"),Ee=f.paint.get("icon-color-contrast"),Ne=f.paint.get("icon-color-brightness-min"),je=f.paint.get("icon-color-brightness-max"),qe=f.layout.get("symbol-elevation-reference")==="sea",Ie=f.layout.get("icon-image-use-theme")==="none",Ge=v.context,Ue=Ge.gl,De=v.transform,Ze=Q==="map",ut=X==="map",ot=se==="map",St=le==="map",gt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let kt=!1;const Qt=v.depthModeForSublayer(0,Er.ReadOnly),mt=new Er(v.context.gl.LEQUAL,Er.ReadOnly,v.depthRangeFor3D),nt=[i.aF(De.center.lng),i.aJ(De.center.lat)],Nt=f.layout.get("text-variable-anchor"),yt=De.projection.name==="globe",$t=[],nr=[0,-1,0];for(const xr of _){const Xt=l.getTile(xr),tr=Xt.getBucket(f);if(!tr||tr.projection.name==="mercator"&&yt||tr.fullyClipped)continue;const wr=tr.projection.name==="globe",pr=wr?i.aj(De.zoom):0,dr=u_(xr,tr.getProjection(),De),mr=De.calculatePixelsToTileUnitsMatrix(Xt),$r=Nt&&tr.hasTextData(),jn=tr.hasIconTextFit()&&$r&&tr.hasIconData(),Fn=tr.getProjection().createInversionMatrix(De,xr.canonical),Ei=(1<<Xt.tileID.canonical.z)*i.al/v.transform.worldSize,Yr=di=>{let Qr=[0,0,0];if(di){const Un=v.style.directionalLight,os=v.style.ambientLight;Un&&os&&(Qr=Ac(v.style,Un,os))}return Qr},Dn=di=>{De.depthOcclusionForSymbolsAndCircles&&(f.hasOcclusionOpacityProperties||v.terrain)&&(di.push("DEPTH_D24"),di.push("DEPTH_OCCLUSION"))},dn=di=>{f.lut&&!Ie&&(f.lut.texture||(f.lut.texture=new i.d_(v.context,f.lut.image,[f.lut.image.height,f.lut.image.height,f.lut.image.height],Ge.gl.RGBA8)),Ge.activeTexture.set(Ge.gl.TEXTURE0+Ka.LUT),f.lut.texture&&f.lut.texture.bind(Ge.gl.LINEAR,Ge.gl.CLAMP_TO_EDGE),di.push("APPLY_LUT_ON_GPU"))},yi=()=>{const di=Ze&&f.layout.get("symbol-placement")!=="point",Qr=[];Dn(Qr),dn(Qr);const Un=di||jn,os=tr.elevationType==="road",ks=v.shadowRenderer,hs=os&&ot&&!!ks&&ks.enabled,ws=Yr(hs),bl=os&&ot&&!v.terrain?mt:Qt,ol=f.paint.get("icon-image-cross-fade");v.terrainRenderModeElevated()&&ot&&Qr.push("PITCH_WITH_MAP_TERRAIN"),wr&&(Qr.push("PROJECTION_GLOBE_VIEW"),Un&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),ol>0&&tr.hasAnySecondaryIcon&&Qr.push("ICON_TRANSITION"),!tr.icon.zOffsetVertexBuffer||os&&v.terrain||Qr.push("Z_OFFSET"),ye===0&&Ee===0&&Ne===0&&je===1||Qr.push("COLOR_ADJUSTMENT"),tr.sdfIcons&&Qr.push("RENDER_SDF"),hs&&Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),os&&ot&&!v.terrain&&tr.icon.orientationVertexBuffer&&Qr.push("ELEVATED_ROADS");const ao=tr.icon.programConfigurations.get(f.id),Eo=v.getOrCreateProgram("symbol",{config:ao,defines:Qr}),Zl=Xt.imageAtlasTexture?Xt.imageAtlasTexture.size:[0,0],oo=tr.iconSizeData,Xl=i.bJ(oo,De.zoom),Nc=ot||!De.isOrthographic,Na=wp(dr,Xt.tileID.canonical,ot,Ze,De,tr.getProjection(),mr),gs=id(dr,Xt.tileID.canonical,ot,Ze,De,tr.getProjection(),mr),Ns=v.translatePosMatrix(gs,Xt,L,G,!0),ki=v.translatePosMatrix(dr,Xt,L,G),Ls=Un?nh:Na,Ia=Ze&&!ot&&!di;let ys=nr;!yt&&!De.mercatorFromTransition||Ze||(ys=h1(De));const Yl=wr?ys:nr,tm=f.getColorAdjustmentMatrix(ye,Ee,Ne,je),md=u1(oo.kind,Xl,Ia,ot,v,ki,Ls,Ns,qe,!1,Zl,[0,0],0,xr,pr,nt,Fn,Yl,tr.getProjection(),ws,Ei,tm,ol,null),rm=Xt.imageAtlasTexture?Xt.imageAtlasTexture:null,nm=f.layout.get("icon-size").constantOr(0)!==1||tr.iconsNeedLinear,Jl=tr.sdfIcons||v.options.rotating||v.options.zooming||nm||Nc?Ue.LINEAR:Ue.NEAREST,Nu=tr.sdfIcons&&f.paint.get("icon-halo-width").constantOr(1)!==0,wa=v.terrain&&ot&&di?i.bk(i.bB(),Na):nh;if(di&&tr.icon){const Ql=i.bU.getAtTileOffsetFunc(xr,De.center.lat,De.worldSize,tr.getProjection()),Ef=Hg(dr,Xt.tileID.canonical,ot,Ze,De,tr.getProjection(),mr),KA=f.layout.get("icon-size-scale-range"),dx=i.aA(v.scaleFactor,KA[0],KA[1]);Dw(tr,dr,v,!1,Ef,gs,ot,ue,Ql,xr,dx)}return{program:Eo,buffers:tr.icon,uniformValues:md,atlasTexture:rm,atlasTextureIcon:null,atlasInterpolation:Jl,atlasInterpolationIcon:null,isSDF:tr.sdfIcons,hasHalo:Nu,depthMode:bl,tile:Xt,renderWithShadows:hs,labelPlaneMatrixInv:wa}},zn=()=>{const di=ut&&f.layout.get("symbol-placement")!=="point",Qr=[],Un=di||Nt||jn,os=tr.elevationType==="road",ks=v.shadowRenderer,hs=os&&St&&!!ks&&ks.enabled,ws=Yr(hs),bl=os&&St&&!v.terrain?mt:Qt;v.terrainRenderModeElevated()&&St&&Qr.push("PITCH_WITH_MAP_TERRAIN"),wr&&(Qr.push("PROJECTION_GLOBE_VIEW"),Un&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),!tr.text.zOffsetVertexBuffer||os&&v.terrain||Qr.push("Z_OFFSET"),tr.iconsInText&&Qr.push("RENDER_TEXT_AND_SYMBOL"),Qr.push("RENDER_SDF"),hs&&Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),os&&St&&!v.terrain&&tr.text.orientationVertexBuffer&&Qr.push("ELEVATED_ROADS"),Dn(Qr);const ol=tr.text.programConfigurations.get(f.id),ao=v.getOrCreateProgram("symbol",{config:ol,defines:Qr});let Eo,Zl=[0,0],oo=null;const Xl=tr.textSizeData;tr.iconsInText&&(Zl=Xt.imageAtlasTexture?Xt.imageAtlasTexture.size:[0,0],oo=Xt.imageAtlasTexture?Xt.imageAtlasTexture:null,Eo=St||!De.isOrthographic||v.options.rotating||v.options.zooming||Xl.kind==="composite"||Xl.kind==="camera"?Ue.LINEAR:Ue.NEAREST);const Nc=Xt.glyphAtlasTexture?Xt.glyphAtlasTexture.size:[0,0],Na=f.layout.get("text-size-scale-range"),gs=i.aA(v.scaleFactor,Na[0],Na[1]),Ns=i.bJ(Xl,De.zoom,gs),ki=wp(dr,Xt.tileID.canonical,St,ut,De,tr.getProjection(),mr),Ls=id(dr,Xt.tileID.canonical,St,ut,De,tr.getProjection(),mr),Ia=v.translatePosMatrix(Ls,Xt,z,Z,!0),ys=v.translatePosMatrix(dr,Xt,z,Z),Yl=Un?nh:ki,tm=ut&&!St&&!di;let md=nr;!yt&&!De.mercatorFromTransition||ut||(md=h1(De));const rm=u1(Xl.kind,Ns,tm,St,v,ys,Yl,Ia,qe,!0,Nc,Zl,0,xr,pr,nt,Fn,wr?md:nr,tr.getProjection(),ws,Ei,null,null,gs),nm=Xt.glyphAtlasTexture?Xt.glyphAtlasTexture:null,Jl=Ue.LINEAR,Nu=f.paint.get("text-halo-width").constantOr(1)!==0,wa=v.terrain&&St&&di?i.bk(i.bB(),ki):nh;if(di&&tr.text){const Ql=i.bU.getAtTileOffsetFunc(xr,De.center.lat,De.worldSize,tr.getProjection()),Ef=Hg(dr,Xt.tileID.canonical,St,ut,De,tr.getProjection(),mr);Dw(tr,dr,v,!0,Ef,Ls,St,_e,Ql,xr,gs)}return{program:ao,buffers:tr.text,uniformValues:rm,atlasTexture:nm,atlasTextureIcon:oo,atlasInterpolation:Jl,atlasInterpolationIcon:Eo,isSDF:!0,hasHalo:Nu,depthMode:bl,tile:Xt,renderWithShadows:hs,labelPlaneMatrixInv:wa}},Di=tr.icon.segments.get().length,Xn=tr.text.segments.get().length,fn=Di&&!k.onlyText?yi():null,ai=Xn&&!k.onlyIcons?zn():null,_n=f.paint.get("icon-opacity").constantOr(1),Wi=f.paint.get("text-opacity").constantOr(1);if(gt&&tr.canOverlap){kt=!0;const di=_n&&!k.onlyText?tr.icon.segments.get():[],Qr=Wi&&!k.onlyIcons?tr.text.segments.get():[];for(const Un of di)$t.push({segments:new i.bf([Un]),sortKey:Un.sortKey,state:fn});for(const Un of Qr)$t.push({segments:new i.bf([Un]),sortKey:Un.sortKey,state:ai})}else k.onlyText||$t.push({segments:_n?tr.icon.segments:new i.bf([]),sortKey:0,state:fn}),k.onlyIcons||$t.push({segments:Wi?tr.text.segments:new i.bf([]),sortKey:0,state:ai})}kt&&$t.sort((xr,Xt)=>xr.sortKey-Xt.sortKey);for(const xr of $t){const Xt=xr.state;if(Xt)if(v.terrain?v.terrain.setupElevationDraw(Xt.tile,Xt.program,{useDepthForOcclusion:De.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Xt.labelPlaneMatrixInv}):v.setupDepthForOcclusion(De.depthOcclusionForSymbolsAndCircles,Xt.program),Ge.activeTexture.set(Ue.TEXTURE0),Xt.atlasTexture&&Xt.atlasTexture.bind(Xt.atlasInterpolation,Ue.CLAMP_TO_EDGE,!0),Xt.atlasTextureIcon&&(Ge.activeTexture.set(Ue.TEXTURE1),Xt.atlasTextureIcon&&Xt.atlasTextureIcon.bind(Xt.atlasInterpolationIcon,Ue.CLAMP_TO_EDGE,!0)),Xt.renderWithShadows&&v.shadowRenderer.setupShadows(Xt.tile.tileID.toUnwrapped(),Xt.program,"vector-tile"),v.uploadCommonLightUniforms(v.context,Xt.program),Xt.hasHalo){const tr=Xt.uniformValues;tr.u_is_halo=1,H_(Xt.buffers,xr.segments,f,v,Xt.program,Xt.depthMode,E,j,tr,2),tr.u_is_halo=0}else{if(Xt.isSDF){const tr=Xt.uniformValues;Xt.hasHalo&&(tr.u_is_halo=1,H_(Xt.buffers,xr.segments,f,v,Xt.program,Xt.depthMode,E,j,tr,1)),tr.u_is_halo=0}H_(Xt.buffers,xr.segments,f,v,Xt.program,Xt.depthMode,E,j,Xt.uniformValues,1)}}}function H_(v,l,f,_,E,j,k,L,z,G){const Z=[v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer,v.iconTransitioningVertexBuffer,v.globeExtVertexBuffer,v.zOffsetVertexBuffer,v.orientationVertexBuffer];E.draw(_,_.context.gl.TRIANGLES,j,k,L,Xr.disabled,z,f.id,v.layoutVertexBuffer,v.indexBuffer,l,f.paint,_.transform.zoom,v.programConfigurations.get(f.id),Z,G)}function TA(v,l){const f=1<<v.canonical.z,_=(l.x*f-v.canonical.x-v.wrap*f)*i.al,E=(l.y*f-v.canonical.y)*i.al,j=i.e7(l.z,l.y);return i.d4(_,E,j)}function vf(v,l,f,_,E){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const j=v.context.gl,k=new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D),L=new Er(v.context.gl.GREATER,Er.ReadWrite,v.depthRangeFor3D),z=function(se){let le=.01;return se.isOrthographic&&(le=i.ak(1e-4,le,i.c$(se.pitch>=hf?1:se.pitch/hf))),2*le}(v.transform),G=v.transform.getFreeCameraOptions().position,Z="elevatedStructuresDepthReconstruct",Q=v.getOrCreateProgram(Z,{defines:["DEPTH_RECONSTRUCTION"]}),X=v.getOrCreateProgram(Z);for(const se of _){const le=l.getTile(se),ue=le.getBucket(f);if(!ue)continue;const _e=ue.elevatedStructures;if(!_e)continue;const ye=ue.elevationBufferData.heightRange,Ee=TA(se.toUnwrapped(),G),Ne=v.translatePosMatrix(se.projMatrix,le,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));let je,qe,Ie,Ge;if(E==="initialize"){if(!ye||ye.min>=1||_e.depthSegments.segments[0].primitiveLength===0)continue;je=R_(Ne,Ee,z,1,0),qe=k,Ie=_e.depthSegments,Ge=Q}else if(E==="reset"){if(!ye||ye.min>=0||_e.maskSegments.segments[0].primitiveLength===0)continue;je=R_(Ne,Ee,0,0,1),qe=L,Ie=_e.maskSegments,Ge=Q}else if(E==="geometry"){if(_e.depthSegments.segments[0].primitiveLength===0)continue;je=R_(Ne,Ee,z,1,0),qe=k,Ie=_e.depthSegments,Ge=X}Ge.draw(v,j.TRIANGLES,qe,rn.disabled,yn.disabled,Xr.disabled,je,f.id,_e.vertexBuffer,_e.indexBuffer,Ie,f.paint,v.transform.zoom)}}function $p(v,l,f){const{painter:_,sourceCache:E,layer:j,coords:k,colorMode:L,elevationType:z,terrainEnabled:G,pass:Z}=v,Q=_.context.gl,X=j.paint.get("fill-pattern"),se=j.paint.get("fill-pattern-cross-fade"),le=X.constantOr(null);let ue=z;z!=="road"||l&&!G||(ue="none");const _e=ue==="road",ye=v.painter.shadowRenderer,Ee=_e&&!!ye&&ye.enabled,Ne=new Er(_.context.gl.LEQUAL,Er.ReadOnly,_.depthRangeFor3D);let je=[0,0,0];if(Ee){const Ge=_.style.directionalLight,Ue=_.style.ambientLight;Ge&&Ue&&(je=Ac(_.style,Ge,Ue))}const qe=X&&X.constantOr(1),Ie=(Ge,Ue)=>{let De,Ze,ut,ot,St;Ue?(De=qe&&!j.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ut=Q.LINES):(De=qe?"fillPattern":"fill",ut=Q.TRIANGLES);for(const gt of k){const kt=E.getTile(gt);if(qe&&!kt.patternsLoaded())continue;const Qt=kt.getBucket(j);if(!Qt)continue;const mt=l?Qt.elevationBufferData:Qt.bufferData;if(mt.isEmpty())continue;_.prepareDrawTile();const nt=mt.programConfigurations.get(j.id),Nt=_.isTileAffectedByFog(gt),yt=[],$t=[];_e&&(yt.push("ELEVATED_ROADS"),$t.push(mt.elevatedLayoutVertexBuffer)),Ee&&yt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),qe&&(_.context.activeTexture.set(Q.TEXTURE0),kt.imageAtlasTexture&&kt.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),nt.updatePaintBuffers());let nr=!1;if(le&&kt.imageAtlas){const pr=kt.imageAtlas,dr=i.e2.from(le),mr=dr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),$r=dr.getSecondary(),jn=pr.patternPositions.get(mr),Fn=$r?pr.patternPositions.get($r.scaleSelf(i.o.devicePixelRatio).toString()):null;nr=!!jn&&!!Fn,jn&&nt.setConstantPatternPositions(jn,Fn)}se>0&&(nr||nt.getPatternTransitionVertexBuffer("fill-pattern"))&&yt.push("FILL_PATTERN_TRANSITION");const xr=_.getOrCreateProgram(De,{config:nt,overrideFog:Nt,defines:yt}),Xt=_.translatePosMatrix(gt.projMatrix,kt,j.paint.get("fill-translate"),j.paint.get("fill-translate-anchor"));Ee&&ye.setupShadows(kt.tileID.toUnwrapped(),xr,"vector-tile");const tr=j.paint.get("fill-emissive-strength");if(Ue){ot=mt.lineIndexBuffer,St=mt.lineSegments;const pr=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[Q.drawingBufferWidth,Q.drawingBufferHeight];Ze=De==="fillOutlinePattern"&&qe?dR(Xt,tr,_,kt,pr,je,se):uR(Xt,tr,pr,je)}else ot=mt.indexBuffer,St=mt.triangleSegments,Ze=qe?xA(Xt,tr,_,kt,je,se):_A(Xt,tr,je);_.uploadCommonUniforms(_.context,xr,gt.toUnwrapped());let wr=Ge;(z==="road"&&!G||z==="offset")&&(wr=Ne),xr.draw(_,ut,wr,f||_.stencilModeForClipping(gt),L,Xr.disabled,Ze,j.id,mt.layoutVertexBuffer,ot,St,j.paint,_.transform.zoom,nt,$t)}};_.renderPass===Z&&Ie(_.depthModeForSublayer(1,_.renderPass==="opaque"?Er.ReadWrite:Er.ReadOnly),!1),ue==="none"&&_.renderPass==="translucent"&&j.paint.get("fill-antialias")&&Ie(_.depthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,Er.ReadOnly),!0)}function _r(v,l,f,_,E,j,k,L){f.resetLayerRenderingStats(v);const z=v.context,G=z.gl,Z=v.transform,Q=f.paint.get("fill-extrusion-pattern"),X=f.paint.get("fill-extrusion-pattern-cross-fade"),se=Q.constantOr(null),le=Q.constantOr(1),ue=f.paint.get("fill-extrusion-opacity"),_e=v.style.enable3dLights(),ye=f.paint.get(_e&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ee=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),ye],Ne=f.layout.get("fill-extrusion-edge-radius"),je=Ne>0&&!f.paint.get("fill-extrusion-rounded-roof"),qe=je?0:Ne,Ie=Z.projection.name==="globe"?i.ea():0,Ge=Z.projection.name==="globe",Ue=Ge?i.aj(Z.zoom):0,De=[i.aF(Z.center.lng),i.aJ(Z.center.lat)],Ze=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ut=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ze?null:f.lut).toArray01().slice(0,3),ot=f.paint.get("fill-extrusion-flood-light-intensity"),St=f.paint.get("fill-extrusion-vertical-scale"),gt=f.paint.get("fill-extrusion-line-width").constantOr(1)!==0,kt=f.paint.get("fill-extrusion-height-alignment"),Qt=f.paint.get("fill-extrusion-base-alignment"),mt=ld(v,f.paint.get("fill-extrusion-cutoff-fade-range")),nt=[];let Nt;Ge&&nt.push("PROJECTION_GLOBE_VIEW"),Ee[0]>0&&nt.push("FAUX_AO"),je&&nt.push("ZERO_ROOF_RADIUS"),L&&nt.push("HAS_CENTROID"),ot>0&&nt.push("FLOOD_LIGHT"),mt.shouldRenderCutoff&&nt.push("RENDER_CUTOFF"),gt&&nt.push("RENDER_WALL_MODE");const yt=v.renderPass==="shadow",$t=v.shadowRenderer,nr=yt&&!!$t,xr=yt?Xr.disabled:Xr.backCCW;v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!0);let Xt=[0,0,0];if($t){const pr=v.style.directionalLight,dr=v.style.ambientLight;pr&&dr&&(Xt=Ac(v.style,pr,dr)),yt||(nt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$t.useNormalOffset&&nt.push("NORMAL_OFFSET")),Nt=nt.concat(["SHADOWS_SINGLE_CASCADE"])}const tr=nr?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",wr=f.getLayerRenderingStats();for(const pr of _){const dr=l.getTile(pr),mr=dr.getBucket(f);if(!mr||mr.projection.name!==Z.projection.name)continue;let $r=!1;$t&&($r=$t.getMaxCascadeForTile(pr.toUnwrapped())===0);const jn=v.isTileAffectedByFog(pr),Fn=mr.programConfigurations.get(f.id);let Ei=!1;if(se&&dr.imageAtlas){const Xn=dr.imageAtlas,fn=i.e2.from(se),ai=fn.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),_n=fn.getSecondary(),Wi=Xn.patternPositions.get(ai),di=_n?Xn.patternPositions.get(_n.scaleSelf(i.o.devicePixelRatio).toString()):null;Ei=!!Wi&&!!di,Wi&&Fn.setConstantPatternPositions(Wi,di)}X>0&&(Ei||Fn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&nt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yr=v.getOrCreateProgram(tr,{config:Fn,defines:$r?Nt:nt,overrideFog:jn});if(v.terrain&&v.terrain.setupElevationDraw(dr,Yr,{useMeterToDem:!0}),!mr.centroidVertexBuffer){const Xn=Yr.getAttributeLocation(G,"a_centroid_pos");Xn!==-1&&G.vertexAttrib2f(Xn,0,0)}!yt&&$t&&$t.setupShadows(dr.tileID.toUnwrapped(),Yr,"vector-tile"),le&&(v.context.activeTexture.set(G.TEXTURE0),dr.imageAtlasTexture&&dr.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Fn.updatePaintBuffers());const Dn=f.paint.get("fill-extrusion-vertical-gradient"),dn=1/mr.tileToMeter;let yi;if(yt&&$t){if(AA(dr.tileID,mr.maxHeight,v))continue;const Xn=$t.calculateShadowPassMatrixFromTile(dr.tileID.toUnwrapped());yi=yA(Xn,qe,dn,St,kt,Qt)}else{const Xn=v.translatePosMatrix(pr.expandedProjMatrix,dr,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),fn=Z.projection.createInversionMatrix(Z,pr.canonical);yi=le?vA(Xn,v,Dn,ue,Ee,qe,dn,pr,dr,Ie,kt,Qt,Ue,De,fn,ut,St,X):I_(Xn,v,Dn,ue,Ee,qe,dn,pr,Ie,kt,Qt,Ue,De,fn,ut,St,ot,Xt)}v.uploadCommonUniforms(z,Yr,pr.toUnwrapped(),null,mt);let zn=mr.segments;if(Z.projection.name==="mercator"&&!yt&&(zn=mr.getVisibleSegments(dr.tileID,v.terrain,v.transform.getFrustum(0)),!zn.get().length))continue;if(wr)if(yt)for(const Xn of zn.get())wr.numRenderedVerticesInShadowPass+=Xn.primitiveLength;else for(const Xn of zn.get())wr.numRenderedVerticesInTransparentPass+=Xn.primitiveLength;const Di=[];(v.terrain||L)&&Di.push(mr.centroidVertexBuffer),Ge&&Di.push(mr.layoutVertexExtBuffer),gt&&Di.push(mr.wallVertexBuffer),Yr.draw(v,z.gl.TRIANGLES,E,j,k,xr,yi,f.id,mr.layoutVertexBuffer,mr.indexBuffer,zn,f.paint,v.transform.zoom,Fn,Di)}v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!1)}class f1{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function ud(v,l,f,_,E,j,k,L,z,G,Z,Q,X,se,le,ue,_e,ye,Ee,Ne){const je=l.context,qe=je.gl,Ie=l.transform,Ge=l.transform.zoom,Ue=[],De=v.translate,Ze=v.translateAnchor,ut=v.edgeRadius,ot=ld(l,v.cutoffFadeRange);Z==="clear"?(Ue.push("CLEAR_SUBPASS"),Ne&&(Ue.push("CLEAR_FROM_TEXTURE"),je.activeTexture.set(qe.TEXTURE0),Ne.bind(qe.LINEAR,qe.CLAMP_TO_EDGE))):Z==="sdf"&&Ue.push("SDF_SUBPASS"),ye&&Ue.push("HAS_CENTROID"),ot.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF");const St=(gt,kt,Qt,mt,nt)=>{let Nt=Ue;kt.groundRadiusBuffer!=null&&(Nt=Ue.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const yt=kt.programConfigurations.get(_.id),$t=l.isTileAffectedByFog(gt),nr=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:yt,defines:Nt,overrideFog:$t}),xr=Fp(l,mt,Q,G,nt,[X,se*nt],le,ue,_e,Ge>=17?0:ut*nt,Ne?Ne.size[0]:0),Xt=[];ye&&Xt.push(kt.hiddenByLandmarkVertexBuffer),kt.groundRadiusBuffer!=null&&Xt.push(kt.groundRadiusBuffer),l.uploadCommonUniforms(je,nr,gt.toUnwrapped(),null,ot),nr.draw(l,je.gl.TRIANGLES,j,k,L,z,xr,_.id,kt.vertexBuffer,kt.indexBuffer,Qt,_.paint,Ge,yt,Xt)};for(const gt of E){const kt=f.getTile(gt),Qt=kt.getBucket(_);if(!Qt||Qt.projection.name!==Ie.projection.name||!Qt.groundEffect||Qt.groundEffect&&!Qt.groundEffect.hasData())continue;const mt=Qt.groundEffect,nt=1/Qt.tileToMeter;{const Nt=l.translatePosMatrix(gt.projMatrix,kt,De,Ze),yt=mt.getDefaultSegment();St(gt,mt,yt,Nt,nt)}if(Ee)for(let Nt=0;Nt<4;Nt++){const yt=i.e8[Nt](gt),$t=f.getTile(yt);if(!$t)continue;const nr=$t.getBucket(_);if(!nr||nr.projection.name!==Ie.projection.name||!nr.groundEffect||nr.groundEffect&&!nr.groundEffect.hasData())continue;const xr=nr.groundEffect;let Xt,tr;Nt===0?(Xt=[-i.al,0,0],tr=1):Nt===1?(Xt=[i.al,0,0],tr=0):Nt===2?(Xt=[0,-i.al,0],tr=3):(Xt=[0,i.al,0],tr=2);const wr=xr.regionSegments[tr];if(!wr)continue;const pr=new Float32Array(16);i.bq(pr,gt.projMatrix,Xt),St(gt,xr,wr,l.translatePosMatrix(pr,kt,De,Ze),nt)}}}function ih(v,l,f,_,E,j,k){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const L=j?j.findDEMTileFor(f):null;if(!(L&&L.dem||k))return;j&&L&&L.dem&&_.selfDEMTileTimestamp!==L.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=L.dem._timestamp);const z=ye=>new i.P(Math.ceil((ye+i.ec)*i.ed),0),G=ye=>{const Ee=l.getSource().minzoom,Ne=qe=>{const Ie=l.getTileByID(qe);if(Ie&&Ie.hasData())return Ie.getBucket(E)},je=[0,-1,1];for(const qe of je){if(ye.overscaledZ+qe<Ee)continue;const Ie=Ne(ye.calculateScaledKey(ye.overscaledZ+qe));if(Ie)return Ie}},Z=[0,0,0],Q=(ye,Ee)=>(Z[0]=Math.min(ye.min.y,Ee.min.y),Z[1]=Math.max(ye.max.y,Ee.max.y),Z[2]=i.al-Ee.min.x>ye.max.x?Ee.min.x-i.al:ye.max.x,Z),X=(ye,Ee)=>(Z[0]=Math.min(ye.min.x,Ee.min.x),Z[1]=Math.max(ye.max.x,Ee.max.x),Z[2]=i.al-Ee.min.y>ye.max.y?Ee.min.y-i.al:ye.max.y,Z),se=[(ye,Ee)=>Q(ye,Ee),(ye,Ee)=>Q(Ee,ye),(ye,Ee)=>X(ye,Ee),(ye,Ee)=>X(Ee,ye)],le=(ye,Ee,Ne,je,qe,Ie,Ge)=>{if(!j)return 0;const Ue=[[Ie?Ne:ye,Ie?ye:Ne,0],[Ie?Ne:Ee,Ie?Ee:Ne,0]],De=Ge<0?i.al+Ge:Ge,Ze=[Ie?De:(ye+Ee)/2,Ie?(ye+Ee)/2:De,0];return Ne===0&&Ge<0||Ne!==0&&Ge>0?j.getForTilePoints(qe,[Ze],!0,je):Ue.push(Ze),j.getForTilePoints(f,Ue,!0,L),Math.max(Ue[0][2],Ue[1][2],Ze[2])/j.exaggeration()};for(let ye=0;ye<4;ye++){const Ee=_.borderFeatureIndices[ye];if(Ee.length===0)continue;const Ne=i.e8[ye](f),je=G(Ne);if(!(je&&je instanceof i.e9))continue;const qe=j?j.findDEMTileFor(Ne):null;if(!(qe&&qe.dem||k)||(j&&qe&&qe.dem&&_.borderDEMTileTimestamp[ye]!==qe.dem._timestamp&&(_.borderDoneWithNeighborZ[ye]=-1,_.borderDEMTileTimestamp[ye]=qe.dem._timestamp),_.borderDoneWithNeighborZ[ye]===je.canonical.z))continue;je.centroidVertexArray.length===0&&je.createCentroidsBuffer();const Ie=(ye<2?1:5)-ye,Ge=je.borderDoneWithNeighborZ[Ie]!==_.canonical.z,Ue=je.borderFeatureIndices[Ie];let De=0;if(_.canonical.z!==je.canonical.z){for(const Ze of Ee)_.showCentroid(_.featuresOnBorder[Ze]);if(Ge)for(const Ze of Ue)je.showCentroid(je.featuresOnBorder[Ze]);_.borderDoneWithNeighborZ[ye]=je.canonical.z,je.borderDoneWithNeighborZ[Ie]=_.canonical.z}for(const Ze of Ee){const ut=_.featuresOnBorder[Ze],ot=_.centroidData[ut.centroidDataIndex],St=ut.borders[ye];let gt;for(;De<Ue.length;){gt=je.featuresOnBorder[Ue[De]];const kt=gt.borders[Ie];if(kt[1]>St[0]+3||kt[0]>St[0]-3)break;je.showCentroid(gt),De++}if(gt&&De<Ue.length){const kt=De;let Qt=0;for(;!(gt.borders[Ie][0]>St[1]-3)&&(Qt++,++De!==Ue.length);)gt=je.featuresOnBorder[Ue[De]];gt=je.featuresOnBorder[Ue[kt]];let mt=!1;if(Qt>=1){const yt=gt.borders[Ie];Math.abs(St[0]-yt[0])<3&&Math.abs(St[1]-yt[1])<3&&(Qt=1,mt=!0,De=kt+1)}else if(Qt===0){_.showCentroid(ut);continue}const nt=je.centroidData[gt.centroidDataIndex];k&&mt&&(((ue=ot).flags|(_e=nt).flags)&i.eb?(ue.flags|=i.eb,_e.flags|=i.eb):(ue.flags&=~i.eb,_e.flags&=~i.eb));const Nt=ut.intersectsCount()>1||gt.intersectsCount()>1;if(Qt>1)De=kt,ot.centroidXY=nt.centroidXY=new i.P(0,0);else if(qe&&qe.dem&&!Nt){const yt=se[ye](ot,nt),$t=ye%2?i.al-1:0,nr=le(yt[0],Math.min(i.al-1,yt[1]),$t,qe,Ne,ye<2,yt[2]);ot.centroidXY=nt.centroidXY=z(nr)}else Nt?ot.centroidXY=nt.centroidXY=new i.P(0,0):(ot.centroidXY=_.encodeBorderCentroid(ut),nt.centroidXY=je.encodeBorderCentroid(gt));_.writeCentroidToBuffer(ot),je.writeCentroidToBuffer(nt)}else _.showCentroid(ut)}_.borderDoneWithNeighborZ[ye]=je.canonical.z,je.borderDoneWithNeighborZ[Ie]=_.canonical.z}var ue,_e;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(v)}const sh=[1,0,0],Br=[0,1,0],p1=[0,0,1];function AA(v,l,f){const _=f.transform,E=f.shadowRenderer;if(!E)return!0;const j=v.toUnwrapped(),k=_.tileSize*E._cascades[f.currentShadowCascade].scale;let L=l;if(_.elevation){const ue=_.elevation.getMinMaxForTile(v);ue&&(L+=ue.max)}const z=[...E.shadowDirection];z[2]=-z[2];const G=E.computeSimplifiedTileShadowVolume(j,L,k,z);if(!G)return!1;const Z=[sh,Br,p1,z,[z[0],0,z[2]],[0,z[1],z[2]]],Q=_.projection.name==="globe",X=_.scaleZoom(k),se=i.cA.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,X,!Q),le=E.getCurrentCascadeFrustum();return se.intersectsPrecise(G.vertices,G.planes,Z)===0||le.intersectsPrecise(G.vertices,G.planes,Z)===0}function G_(v){const{painter:l,source:f,layer:_,coords:E}=v;let j=v.defines;const k=l.context,L=l.renderPass==="shadow",z=l.renderPass==="light-beam",G=l.shadowRenderer,Z=i.ee(l.transform.center.lat,l.transform.zoom),Q=ld(l,_.paint.get("building-cutoff-fade-range"));Q.shouldRenderCutoff&&(j=j.concat("RENDER_CUTOFF")),v.floodLightIntensity>0&&(j=j.concat("FLOOD_LIGHT"));for(const X of E){const se=f.getTile(X),le=se.getBucket(_);if(!le)continue;G&&G.getMaxCascadeForTile(X.toUnwrapped())===0&&(j=j.concat("SHADOWS_SINGLE_CASCADE"));const ue=le.programConfigurations.get(_.id);let _e,ye,Ee,Ne=l.translatePosMatrix(X.expandedProjMatrix,se,[0,0],"map");if(Ne=i.cR(i.bB(),Ne,[1,1,v.verticalScale]),L&&G){if(AA(se.tileID,le.maxHeight*Z,l))continue;let qe=G.calculateShadowPassMatrixFromTile(se.tileID.toUnwrapped());qe=i.cR(i.bB(),qe,[1,1,v.verticalScale]),Ee=bA(qe),_e=ye=l.getOrCreateProgram("buildingDepth",{config:ue,defines:j,overrideFog:!1})}else if(z)_e=ye=l.getOrCreateProgram("buildingBloom",{config:ue,defines:j,overrideFog:!1}),Ee=a1(Ne);else{const qe=l.transform.calculatePosMatrix(X.toUnwrapped(),l.transform.worldSize);i.cR(qe,qe,[1,1,v.verticalScale]);const Ie=i.bB();i.cR(Ie,qe,[1,-1,1/Z]),i.bk(Ie,Ie),i.ef(Ie,Ie);const Ge=l.transform.getFreeCameraOptions().position,Ue=1<<X.canonical.z;if(Ee=s1(Ne,Ie,v.opacity,v.facadeAOIntensity,[((Ge.x-X.wrap)*Ue-X.canonical.x)*i.al,(Ge.y*Ue-X.canonical.y)*i.al,Ge.z*Ue*i.al],le.tileToMeter,v.facadeEmissiveChance,v.floodLightColor,v.floodLightIntensity),ye=l.getOrCreateProgram("building",{config:ue,defines:j,overrideFog:!1}),v.depthOnly===!0)_e=ye;else{const De=j.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);_e=l.getOrCreateProgram("building",{config:ue,defines:De,overrideFog:!1})}G&&(G.setupShadowsFromMatrix(qe,ye,!0),_e!==ye&&G.setupShadowsFromMatrix(qe,_e,!0))}const je=(qe,Ie)=>{if(z){const Ge=qe.entranceBloom;Ie.draw(l,k.gl.TRIANGLES,v.depthMode,rn.disabled,v.blendMode,Xr.disabled,Ee,_.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segmentsBucket,_.paint,l.transform.zoom,ue,[Ge.layoutAttenuationBuffer,Ge.layoutColorBuffer])}else{const Ge=qe.segmentsBucket;let Ue=[qe.layoutNormalBuffer,qe.layoutCentroidBuffer,qe.layoutColorBuffer,qe.layoutFloodLightDataBuffer];qe.layoutFacadePaintBuffer&&(Ue=Ue.concat([qe.layoutFacadeDataBuffer,qe.layoutFacadeVerticalRangeBuffer,qe.layoutFacadePaintBuffer])),Ie.draw(l,k.gl.TRIANGLES,v.depthMode,rn.disabled,v.blendMode,L?Xr.disabled:Xr.backCW,Ee,_.id,qe.layoutVertexBuffer,qe.indexBuffer,Ge,_.paint,l.transform.zoom,ue,Ue)}};l.uploadCommonUniforms(k,ye,X.toUnwrapped(),null,Q),le.buildingWithoutFacade&&je(le.buildingWithoutFacade,ye),le.buildingWithFacade&&(_e!==ye&&l.uploadCommonUniforms(k,_e,X.toUnwrapped(),null,Q),je(le.buildingWithFacade,_e))}}function W_(v,l,f,_,E,j,k,L,z,G,Z,Q,X){const se=v.context.gl,le=v.depthModeForSublayer(1,Er.ReadOnly,se.LEQUAL,!0),ue=.1*(1-(_e=Z))+3*_e;var _e;const ye=v._showOverdrawInspector,Ee=Q,Ne=new f1;ye||ud(Ne,v,l,f,_,le,new rn({func:se.ALWAYS,mask:255},255,255,se.KEEP,se.KEEP,se.REPLACE),new yn([se.ONE,se.ONE,se.ONE,se.ONE],i.ao.transparent,[!1,!1,!1,!0],se.MIN),Xr.disabled,E,"sdf",j,k,L,z,G,ue,Ee,!1);{const je=ye?rn.disabled:new rn({func:se.EQUAL,mask:255},255,255,se.KEEP,se.DECR,se.DECR),qe=ye?v.colorModeForRenderPass():new yn([se.ONE_MINUS_DST_ALPHA,se.DST_ALPHA,se.ONE,se.ONE],i.ao.transparent,[!0,!0,!0,!0]);ud(Ne,v,l,f,_,le,je,qe,Xr.disabled,E,"color",j,k,L,z,G,ue,Ee,!1)}}function m1(v){return[v[0]*i.eg,v[1]*i.eg,v[2]*i.eg,0]}function g1(v,l,f,_,E,j,k,L,z){const G=_.getSource(),Z=f.globeSharedBuffers;if(!Z)return;let Q,X,se;if(l&&(Q=_.getTile(l)),G instanceof i.aT?(X=G.texture,se=i.dJ(0,0,f.transform)):Q&&l&&(X=Q.texture,se=i.dJ(l.canonical.z,l.canonical.x,f.transform)),!X||!se)return;v||(se=i.cR(i.bB(),se,[1,-1,1]));const le=f.context,ue=le.gl,_e=E.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR,ye=f.colorModeForDrapableLayerRenderPass(j),Ee=k.defines;Ee.push("GLOBE_POLES");const Ne=new Er(ue.LEQUAL,Er.ReadWrite,f.depthRangeFor3D),je=Float32Array.from(f.transform.expandedFarZProjMatrix),qe=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0))));f.terrain&&f.terrain.prepareDrawTile(),le.activeTexture.set(ue.TEXTURE0),X.bind(_e,ue.CLAMP_TO_EDGE),le.activeTexture.set(ue.TEXTURE1),X.bind(_e,ue.CLAMP_TO_EDGE),"useMipmap"in X&&le.extTextureFilterAnisotropic&&f.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[Ie,Ge,Ue,De]=l?Z.getPoleBuffers(l.canonical.z,!1):Z.getPoleBuffers(0,!0),Ze=E.paint.get("raster-elevation");let ut;v?(ut=Ie,f.renderDefaultNorthPole=Ze!==0):(ut=Ge,f.renderDefaultSouthPole=Ze!==0);const ot=m1(k.mix),St=((kt,Qt,mt,nt,Nt,yt,$t,nr,xr,Xt,tr,wr,pr)=>uy(kt,Qt,mt,new Float32Array(16),new Float32Array(9),[0,0],nt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},yt,[0,0],nr,2,Xt,tr,wr,1,0,pr))(je,qe,se,i.aj(f.transform.zoom),0,E,0,Ze,0,ot,k.offset,k.range,j),gt=f.getOrCreateProgram("raster",{defines:Ee});f.uploadCommonUniforms(le,gt,null),gt.draw(f,ue.TRIANGLES,Ne,z,ye,L,St,E.id,ut,Ue,De)}function CA(v){const l=v._nearZ,f=v.projection.farthestPixelDistance(v),_=f-l,E=.2*v.height,j=l+E;return[l,f,(j-E-l)/_,(j-l)/_]}function mR(v,l,f,_){if(v)return l instanceof xa&&v instanceof Yd?l.getTextureDescriptor(v,f,!0):{texture:v.texture,mix:m1(_.mix),offset:_.offset,buffer:0,tileSize:1}}var gR=i.eh([{name:"a_index",type:"Int16",components:1}]);class Nl{constructor(l,f,_,E){const j={width:_[0],height:_[1],data:null},k=l.gl;this.targetColorTexture=new i.T(l,j,k.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(l,j,k.RGBA8,{useMipmap:!1}),this.context=l,this.updateParticleTexture(f,E),this.lastInvalidatedAt=0}updateParticleTexture(l,f){if(this.particleTextureDimension===f.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,E=f.width*f.height;this.particleTexture0=new i.T(this.context,f,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,f,_.RGBA8,{premultiply:!1,useMipmap:!1});const j=new i.ei;j.reserve(E);for(let k=0;k<E;k++)j.emplaceBack(k);this.particleIndexBuffer=this.context.createVertexBuffer(j,gR.members,!0),this.particleSegment=i.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=f.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function y1(v,l,f){if(!v)return null;const _=l.getTextureDescriptor(v,f,!0);if(!_)return null;let{texture:E,mix:j,offset:k,tileSize:L,buffer:z,format:G}=_;if(!E||!G)return null;let Z=!1;return G==="uint32"&&(Z=!0,j[3]=0,j=M_(i.ej,j,[0,f.paint.get("raster-particle-max-speed")]),k=cd(i.ej,k,[0,f.paint.get("raster-particle-max-speed")])),{texture:E,textureOffset:[z/(L+2*z),L/(L+2*z)],tileSize:L,scalarData:Z,scale:j,offset:k,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function al(v){const l=v._nearZ,f=v.projection.farthestPixelDistance(v),_=f-l,E=.2*v.height,j=l+E;return[l,f,(j-E-l)/_,(j-l)/_]}const ah=new i.ao(1,0,0,1),jA=new i.ao(0,1,0,1),v1=new i.ao(0,0,1,1),_1=new i.ao(1,0,1,1),x1=new i.ao(0,1,1,1);function b1(v,l,f,_,E,j){for(let k=0;k<f.length;k++)if(E){const G=new i.ao(_.r*.8,_.g*.8,_.b*.8,1);Il(v,l,f[k],_,-1,-1,j),Il(v,l,f[k],_,-1,1,j),Il(v,l,f[k],_,1,1,j),Il(v,l,f[k],_,1,-1,j),Il(v,l,f[k],G,0,0,j)}else Il(v,l,f[k],_,0,0,j)}function Il(v,l,f,_,E,j,k){const L=v.context,z=v.transform,G=L.gl,Z=z.projection.name==="globe",Q=Z?["PROJECTION_GLOBE_VIEW"]:[];let X=i.by(f.projMatrix);if(Z&&i.aj(z.zoom)>0){const ot=i.bi(f.canonical,z),St=i.ek(ot);X=i.aB(new Float32Array(16),z.globeMatrix,St),i.aB(X,z.projMatrix,X)}const se=i.bB();se[12]+=2*E/(i.o.devicePixelRatio*z.width),se[13]+=2*j/(i.o.devicePixelRatio*z.height),i.aB(X,se,X);const le=v.getOrCreateProgram("debug",{defines:Q}),ue=l.getTileByID(f.key);v.terrain&&v.terrain.setupElevationDraw(ue,le);const _e=Er.disabled,ye=rn.disabled,Ee=v.colorModeForRenderPass(),Ne="$debug";L.activeTexture.set(G.TEXTURE0),v.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Z?ue._makeGlobeTileDebugBuffers(v.context,z):ue._makeDebugTileBoundsBuffers(v.context,z.projection);const je=ue._tileDebugBuffer||v.debugBuffer,qe=ue._tileDebugIndexBuffer||v.debugIndexBuffer,Ie=ue._tileDebugSegments||v.debugSegments;if(le.draw(v,G.LINE_STRIP,_e,ye,Ee,Xr.disabled,o1(X,_.toPremultipliedRenderColor(null)),Ne,je,qe,Ie,null,null,null,[ue._globeTileDebugBorderBuffer]),k){const ot=ue.latestRawTileData,St=Math.floor((ot&&ot.byteLength||0)/1024);let gt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(gt+=` => ${f.overscaledZ}`),gt+=` ${ue.state}`,gt+=` ${St}kb`,function(kt,Qt){kt.initDebugOverlayCanvas();const mt=kt.debugOverlayCanvas,nt=kt.context.gl,Nt=kt.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,mt.width,mt.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(Qt,5,5),Nt.strokeText(Qt,5,5),kt.debugOverlayTexture.update(mt),kt.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)}(v,gt)}const Ge=l.getTile(f).tileSize,Ue=512/Math.min(Ge,512)*(f.overscaledZ/z.zoom)*.5,De=ue._tileDebugTextBuffer||v.debugBuffer,Ze=ue._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,ut=ue._tileDebugTextSegments||v.debugSegments;le.draw(v,G.TRIANGLES,_e,ye,yn.alphaBlended,Xr.disabled,o1(X,i.ao.transparent.toPremultipliedRenderColor(null),Ue),Ne,De,Ze,ut,null,null,null,[ue._globeTileDebugTextBuffer])}function Ui(v,l,f,_){Up(v,0,l+f/2,v.transform.width,f,_)}function fy(v,l,f,_){Up(v,l-f/2,0,f,v.transform.height,_)}function Up(v,l,f,_,E,j){const k=v.context,L=k.gl;L.enable(L.SCISSOR_TEST),L.scissor(l*i.o.devicePixelRatio,f*i.o.devicePixelRatio,_*i.o.devicePixelRatio,E*i.o.devicePixelRatio),k.clear({color:j}),L.disable(L.SCISSOR_TEST)}const PA=i.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:OA}=PA;function dd(v,l,f,_){v.emplaceBack(l,f,_)}class w1{constructor(l){this.vertexArray=new i.el,this.indices=new i.b0,dd(this.vertexArray,-1,-1,1),dd(this.vertexArray,1,-1,1),dd(this.vertexArray,-1,1,1),dd(this.vertexArray,1,1,1),dd(this.vertexArray,-1,-1,-1),dd(this.vertexArray,1,-1,-1),dd(this.vertexArray,-1,1,-1),dd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,OA),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=i.bf.simpleSegment(0,0,36,12)}}function Pc(v,l,f,_,E,j){const k=v.context.gl,L=l.paint.get("sky-atmosphere-color"),z=l.paint.get("sky-atmosphere-halo-color"),G=l.paint.get("sky-atmosphere-sun-intensity"),Z=((Q,X,se,le,ue)=>({u_matrix_3f:Q,u_sun_direction:X,u_sun_intensity:se,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(i.en(i.dN(),_),E,G,L.toPremultipliedRenderColor(null),z.toPremultipliedRenderColor(null));k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_CUBE_MAP_POSITIVE_X+j,l.skyboxTexture,0),f.draw(v,k.TRIANGLES,Er.disabled,rn.disabled,yn.unblended,Xr.frontCW,Z,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const _f=i.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Zt{constructor(l){const f=new i.eo;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const _=new i.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(f,_f.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=i.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ur=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Vp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class bs{constructor(l){this.colorModeAlphaBlendedWriteRGB=new yn([1,Ds,1,Ds],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new yn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new Vp,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const f=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Zt(f);const _=this.params.sizeRange,E=this.params.intensityRange,j=function(Z){const Q=i.eq(30),X=[];for(let se=0;se<Z;++se){const le=2*Math.PI*Q(),ue=Math.acos(1-2*Q())-.5*Math.PI;X.push(i.d4(Math.cos(ue)*Math.cos(le),Math.cos(ue)*Math.sin(le),Math.sin(ue)))}return X}(this.params.starsCount),k=i.eq(300),L=new i.ep,z=new i.b0;let G=0;for(let Z=0;Z<j.length;++Z){const Q=i.c4([],j[Z],200),X=Math.max(0,1+.01*_*(1*k()-.5)),se=Math.max(0,1+.01*E*(1*k()-.5));L.emplaceBack(Q[0],Q[1],Q[2],-1,-1,X,se),L.emplaceBack(Q[0],Q[1],Q[2],1,-1,X,se),L.emplaceBack(Q[0],Q[1],Q[2],1,1,X,se),L.emplaceBack(Q[0],Q[1],Q[2],-1,1,X,se),z.emplaceBack(G+0,G+1,G+2),z.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=f.createVertexBuffer(L,ur.members),this.starsIdx=f.createIndexBuffer(z),this.starsSegments=i.bf.simpleSegment(0,0,L.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,f){const _=l.context,E=_.gl,j=l.transform,k=new Er(E.LEQUAL,Er.ReadOnly,[0,1]),L=i.aj(j.zoom),z=l.style.getLut(f.scope),G=f.properties.get("color-use-theme")==="none",Z=f.properties.get("color").toNonPremultipliedRenderColor(G?null:z),Q=f.properties.get("high-color-use-theme")==="none",X=f.properties.get("high-color").toNonPremultipliedRenderColor(Q?null:z),se=f.properties.get("space-color-use-theme")==="none",le=f.properties.get("space-color").toNonPremultipliedRenderColor(se?null:z),ue=5e-4,_e=i.er(f.properties.get("horizon-blend"),0,1,ue,.25),ye=i.dD(l,_,j)&&_e===ue?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,Ee=l.frameCounter/1e3%1,Ne=i.ag(j.globeCenterInViewSpace),je=Math.sqrt(Math.pow(Ne,2)-Math.pow(ye,2)),qe=Math.acos(je/Ne),Ie=Ge=>{const Ue=j.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ge&&Ue.push("ALPHA_PASS");const De=l.getOrCreateProgram("globeAtmosphere",{defines:Ue}),Ze=((ot,St,gt,kt,Qt,mt,nt,Nt,yt,$t,nr,xr)=>({u_frustum_tl:ot,u_frustum_tr:St,u_frustum_br:gt,u_frustum_bl:kt,u_horizon:Qt,u_transition:mt,u_fadeout_range:nt,u_atmosphere_fog_color:Nt.toArray01(),u_high_color:yt.toArray01(),u_space_color:$t.toArray01(),u_temporal_offset:nr,u_horizon_angle:xr}))(j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.frustumCorners.horizon,L,_e,Z,X,le,Ee,qe);l.uploadCommonUniforms(_,De);const ut=this.atmosphereBuffer;ut&&De.draw(l,E.TRIANGLES,k,rn.disabled,Ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Xr.backCW,Ze,Ge?"atmosphere_glow_alpha":"atmosphere_glow",ut.vertexBuffer,ut.indexBuffer,ut.segments)};Ie(!1),Ie(!0)}drawStars(l,f){const _=i.aA(f.properties.get("star-intensity"),0,1);if(_===0)return;const E=l.context,j=E.gl,k=l.transform,L=l.getOrCreateProgram("stars"),z=i.c6([]);i.c8(z,z,-k._pitch),i.c7(z,z,-k.angle),i.c8(z,z,i.an(k._center.lat)),i.es(z,z,-i.an(k._center.lng));const G=i.cb(new Float32Array(16),z),Z=i.aB([],k.starsProjMatrix,G),Q=i.en([],G),X=i.et([],Q),se=[0,1,0];i.dP(se,se,X),i.c4(se,se,this.params.sizeMultiplier);const le=[1,0,0];i.dP(le,le,X),i.c4(le,le,this.params.sizeMultiplier);const ue=(_e=se,ye=le,Ee=_,{u_matrix:Float32Array.from(Z),u_up:_e,u_right:ye,u_intensity_multiplier:Ee});var _e,ye,Ee;l.uploadCommonUniforms(E,L),this.starsVx&&this.starsIdx&&L.draw(l,j.TRIANGLES,Er.disabled,rn.disabled,this.colorModeAlphaBlendedWriteRGB,Xr.disabled,ue,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ht{constructor(){this.visibleTiles=[]}updateBorders(l,f){const _=[],E=[],j=l._getRenderableCoordinates(!1,!0);for(const z of j){const G=l.getTile(z);if(!G.hasData())continue;const Z=G.getBucket(f);Z&&(Z.isEmpty()||(_.push(z.key),E.push({bucket:Z,tileID:z.canonical})))}let k=_.length!==this.visibleTiles.length;if(!k){_.sort();for(let z=0;z<_.length;z++)if(_[z]!==this.visibleTiles[z]){k=!0;break}}if(!k)return;const L=new Set;this.visibleTiles=_,E.sort((z,G)=>z.tileID.z-G.tileID.z||z.tileID.x-G.tileID.x||z.tileID.y-G.tileID.y);for(const z of E){const G=new Array,Z=new Array,Q=z.bucket;for(const X of Q.featuresOnBorder)L.has(X.featureId)?Z.push(X.footprintIndex):(L.add(X.featureId),G.push(X.footprintIndex));Q.updateFootprintHiddenFlags(G,i.eu,!1),Q.updateFootprintHiddenFlags(Z,i.eu,!0)}}}function S1(v,l){const f=[...v],_=l.cameraWorldSizeForFog/l.worldSize,E=i.bz([]);return i.cR(E,E,[_,_,1]),i.aB(f,E,f),i.aB(f,l.worldToFogMatrix,f),f}function qp(v,l,f,_,E){const j=f.material,k=_.context,{baseColorTexture:L,metallicRoughnessTexture:z}=j.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:Z,emissionTexture:Q}=j;function X(le,ue,_e){if(le&&(v.push(ue),k.activeTexture.set(k.gl.TEXTURE0+_e),le.gfxTexture)){const{minFilter:ye,magFilter:Ee,wrapS:Ne,wrapT:je}=le.sampler;le.gfxTexture.bindExtraParam(ye,Ee,Ne,je)}}X(L,"HAS_TEXTURE_u_baseColorTexture",Ka.BaseColor),X(z,"HAS_TEXTURE_u_metallicRoughnessTexture",Ka.MetallicRoughness),X(G,"HAS_TEXTURE_u_normalTexture",Ka.Normal),X(Z,"HAS_TEXTURE_u_occlusionTexture",Ka.Occlusion),X(Q,"HAS_TEXTURE_u_emissionTexture",Ka.Emission),E&&(E.texture||(E.texture=new i.d_(_.context,E.image,[E.image.height,E.image.height,E.image.height],k.gl.RGBA8)),k.activeTexture.set(k.gl.TEXTURE0+Ka.LUT),E.texture&&E.texture.bind(k.gl.LINEAR,k.gl.CLAMP_TO_EDGE),v.push("APPLY_LUT_ON_GPU")),f.texcoordBuffer&&(v.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(f.texcoordBuffer)),f.colorBuffer&&(v.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(f.colorBuffer)),f.normalBuffer&&(v.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(f.normalBuffer)),f.pbrBuffer&&(v.push("HAS_ATTRIBUTE_a_pbr"),v.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(f.pbrBuffer)),j.alphaMode!=="OPAQUE"&&j.alphaMode!=="MASK"||v.push("UNPREMULT_TEXTURE_IN_SHADER"),j.defined||v.push("DIFFUSE_SHADED");const se=_.shadowRenderer;se&&(v.push("RENDER_SHADOWS","DEPTH_TEXTURE"),se.useNormalOffset&&v.push("NORMAL_OFFSET"))}function Hp(v,l,f,_,E,j){const k=f.paint.get("model-opacity").constantOr(1),L=l.context,z=new Er(l.context.gl.LEQUAL,v.isLightMesh?Er.ReadOnly:Er.ReadWrite,l.depthRangeFor3D),G=l.transform,Z=v.mesh,Q=Z.material,X=Q.pbrMetallicRoughness,se=l.style.fog;let le;le=l.transform.projection.zAxisUnit==="pixels"?[...v.nodeModelMatrix]:i.aB([],_.zScaleMatrix,v.nodeModelMatrix),i.aB(le,_.negCameraPosMatrix,le);const ue=i.bk([],le);i.ef(ue,ue);const _e=f.paint.get("model-color-use-theme").constantOr("default")==="none",ye=f.paint.get("model-emissive-strength").constantOr(0),Ee=B_(new Float32Array(v.worldViewProjection),new Float32Array(le),new Float32Array(ue),null,l,k,X.baseColorFactor,Q.emissiveFactor,X.metallicFactor,X.roughnessFactor,Q,ye,f,void 0,void 0,v.materialOverride,v.modelColor),Ne={defines:[]},je=[],qe=l.shadowRenderer;qe&&(qe.useNormalOffset=!1),qp(Ne.defines,je,Z,l,_e?null:f.lut);let Ie=null;if(se){const De=S1(v.nodeModelMatrix,l.transform);if(Ie=new Float32Array(De),G.projection.name!=="globe"){const Ze=Z.aabb.min,ut=Z.aabb.max,[ot,St]=se.getOpacityForBounds(De,Ze[0],Ze[1],ut[0],ut[1]);Ne.overrideFog=ot>=vt||St>=vt}}const Ge=ld(l,f.paint.get("model-cutoff-fade-range"));Ge.shouldRenderCutoff&&Ne.defines.push("RENDER_CUTOFF");const Ue=l.getOrCreateProgram("model",Ne);l.uploadCommonUniforms(L,Ue,null,Ie,Ge),l.renderPass!=="shadow"&&qe&&qe.setupShadowsFromMatrix(v.nodeModelMatrix,Ue),Ue.draw(l,L.gl.TRIANGLES,z,E,j,Z.material.doubleSided?Xr.disabled:Xr.backCCW,Ee,f.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,f.paint,l.transform.zoom,void 0,je)}function K_(v,l,f){return v.type==="vector"?l.scope:f?"basemap":""}function Z_(v,l,f,_,E,j,k,L,z){const G=v.transform,Z=!!l.isGeometryBloom&&l.isGeometryBloom;if(Z&&v.renderPass==="shadow")return;const Q=G.projection.name==="globe"?i.eC(f,G):[...f];i.aB(Q,Q,l.globalMatrix);const X=i.aB([],_,Q);if(l.meshes)for(const se of l.meshes){const le=L.get(se.material.name);if(le&&le.opacity<=0)continue;if(se.material.alphaMode!=="BLEND"){k.push({mesh:se,depth:0,modelIndex:E,worldViewProjection:X,nodeModelMatrix:Q,isLightMesh:Z,materialOverride:le,modelColor:z});continue}const ue=i.af([],se.centroid,X);!G.isOrthographic&&ue[2]<=0||j.push({mesh:se,depth:ue[2],modelIndex:E,worldViewProjection:X,nodeModelMatrix:Q,isLightMesh:Z,materialOverride:le,modelColor:z})}if(l.children)for(const se of l.children)Z_(v,se,f,_,E,j,k,L,z)}function Gp(v,l,f,_){const E=f.shadowRenderer;if(!E)return;const j=E.getShadowPassDepthMode(),k=E.getShadowPassColorMode(),L=E.calculateShadowPassMatrixFromMatrix(l),z=Bp(L);f.getOrCreateProgram("modelDepth",{defines:f._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,j,rn.disabled,k,Xr.disabled,z,_.id,v.vertexBuffer,v.indexBuffer,v.segments,_.paint,f.transform.zoom,void 0,void 0)}function Wp(v,l,f,_,E,j){for(const k of E){const L=Object.assign({},_);L.part=k;const z={type:"Unknown",id:l,properties:L},G={orientation:v.paint.get("model-rotation").evaluate(z,f)};j.set(k,G)}}function yR(v,l,f,_,E,j){for(const k of E){const L=Object.assign({},_);L.part=k;const z={type:"Unknown",id:l,properties:L},G={color:v.paint.get("model-color").evaluate(z,f),colorMix:v.paint.get("model-color-mix-intensity").evaluate(z,f),opacity:v.paint.get("model-opacity").evaluate(z,f),emissionStrength:v.paint.get("model-emissive-strength").evaluate(z,f)};j.set(k,G)}}function kA(v,l,f,_,E,j){if(f===1)for(const L of E)Hp(L,v,l,j[L.modelIndex],rn.disabled,v.colorModeForRenderPass());else{for(const L of E)Hp(L,v,l,j[L.modelIndex],rn.disabled,yn.disabled);for(const L of E)Hp(L,v,l,j[L.modelIndex],v.stencilModeFor3D(),v.colorModeForRenderPass());v.resetStencilClippingMasks()}const k=yn.additive;for(const L of _)Hp(L,v,l,j[L.modelIndex],rn.disabled,L.isLightMesh?k:v.colorModeForRenderPass())}function NA(v,l,f){const _=l.updateZoomBasedPaintProperties(),E=function(j,k,L){let z,G,Z,Q=j.terrain?j.terrain.exaggeration():0;if(j.terrain&&Q>0){const X=j.terrain,se=X.findDEMTileFor(L);se&&se.dem?z=i.eE.create(X,L,se):Q=0}if(Q===0&&(k.terrainElevationMin=0,k.terrainElevationMax=0),Q===k.validForExaggeration&&(Q===0||z&&z._demTile&&z._demTile.tileID===k.validForDEMTile.id&&z._dem._timestamp===k.validForDEMTile.timestamp))return!1;for(const X in k.instancesPerModel){const se=k.instancesPerModel[X];for(let le=0;le<se.instancedDataArray.length;++le){const ue=(z?Q*z.getElevationAt(0|se.instancedDataArray.float32[16*le],0|se.instancedDataArray.float32[16*le+1],!0,!0):0)+se.instancesEvaluatedElevation[le];se.instancedDataArray.float32[16*le+6]=ue,G=G?Math.min(k.terrainElevationMin,ue):ue,Z=Z?Math.max(k.terrainElevationMax,ue):ue}}return k.terrainElevationMin=G||0,k.terrainElevationMax=Z||0,k.validForExaggeration=Q,k.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0}(v,l,f);(_||E)&&(l.uploaded=!1,l.upload(v.context))}const Wl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d8([0,0,0],[i.al,i.al,0])};function E1(v,l){const f=1<<v.canonical.z,_=l.getFreeCameraOptions().position,E=l.elevation,j=v.canonical.x/f,k=(v.canonical.x+1)/f,L=v.canonical.y/f,z=(v.canonical.y+1)/f;let G=l._centerAltitude;if(E){const se=E.getMinMaxForTile(v);se&&se.max>G&&(G=se.max)}const Z=i.aA(_.x,j,k)-_.x,Q=i.aA(_.y,L,z)-_.y,X=i.ce(G,l.center.lat)-_.z;return l._zoomFromMercatorZ(Math.sqrt(Z*Z+Q*Q+X*X))}function T1(v,l,f,_,E,j,k){const L=v.context,z=v.renderPass==="shadow",G=v.shadowRenderer,Z=z&&G?G.getShadowPassDepthMode():new Er(L.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D),Q=v.isTileAffectedByFog(j),X=v.transform.projection.name==="globe";if(f.meshes)for(const se of f.meshes){const le=X?[]:["MODEL_POSITION_ON_GPU"],ue=[];let _e,ye,Ee;const Ne=!X&&_.instancedDataArray.length>20;Ne&&le.push("INSTANCED_ARRAYS");const je=ld(v,l.paint.get("model-cutoff-fade-range"));if(je.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),z&&G)_e=v.getOrCreateProgram("modelDepth",{defines:le}),ye=Bp(k.shadowTileMatrix,k.shadowTileMatrix,Float32Array.from(f.globalMatrix)),Ee=G.getShadowPassColorMode();else{qp(le,ue,se,v,l.paint.get("model-color-use-theme").constantOr("default")==="none"?null:l.lut),_e=v.getOrCreateProgram("model",{defines:le,overrideFog:Q});const Ie=se.material,Ge=Ie.pbrMetallicRoughness,Ue=l.paint.get("model-opacity").constantOr(1),De=l.paint.get("model-emissive-strength").constantOr(0);ye=B_(j.expandedProjMatrix,Float32Array.from(f.globalMatrix),new Float32Array(16),null,v,Ue,Ge.baseColorFactor,Ie.emissiveFactor,Ge.metallicFactor,Ge.roughnessFactor,Ie,De,l,E),G&&(k.shadowUniformsInitialized?_e.setShadowUniformValues(L,G.getShadowUniformValues()):(G.setupShadows(j.toUnwrapped(),_e,"model-tile"),k.shadowUniformsInitialized=!0)),Ee=je.shouldRenderCutoff||Ue<1||Ie.alphaMode!=="OPAQUE"?yn.alphaBlended:yn.unblended}v.uploadCommonUniforms(L,_e,j.toUnwrapped(),null,je);const qe=se.material.doubleSided?Xr.disabled:Xr.backCCW;if(Ne)ue.push(_.instancedDataBuffer),_e.draw(v,L.gl.TRIANGLES,Z,rn.disabled,Ee,qe,ye,l.id,se.vertexBuffer,se.indexBuffer,se.segments,l.paint,v.transform.zoom,void 0,ue,_.instancedDataArray.length);else{const Ie=z?"u_instance":"u_normal_matrix";for(let Ge=0;Ge<_.instancedDataArray.length;++Ge)ye[Ie]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Ge,16),_e.draw(v,L.gl.TRIANGLES,Z,rn.disabled,Ee,qe,ye,l.id,se.vertexBuffer,se.indexBuffer,se.segments,l.paint,v.transform.zoom,void 0,ue)}}if(f.children)for(const se of f.children)T1(v,l,se,_,E,j,k)}const IA=[1,-1,1];function X_(v,l,f,_){if(!f.modelManager)return!0;const E=f.modelManager;if(!f.shadowRenderer)return!0;const j=f.shadowRenderer,k=l.aabb;let L=!0,z=v.maxHeight;if(z===0){let Z=0;for(const Q in v.instancesPerModel){const X=E.getModel(Q,_);X?Z=Math.max(Z,Math.max(Math.max(X.aabb.max[0],X.aabb.max[1]),X.aabb.max[2])):L=!1}z=v.maxScale*Z*1.41+v.maxVerticalOffset,L&&(v.maxHeight=z)}k.max[2]=z,k.min[2]+=v.terrainElevationMin,k.max[2]+=v.terrainElevationMax,i.af(k.min,k.min,l.tileMatrix),i.af(k.max,k.max,l.tileMatrix);const G=k.intersects(j.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(v.isInsideFirstShadowMapFrustum=G===2),G===0}function py(v,l){const f=v.uniformValues.u_cutoff_params[0],_=v.uniformValues.u_cutoff_params[1],E=v.uniformValues.u_cutoff_params[2],j=v.uniformValues.u_cutoff_params[3];return _===f||j===E?1:i.aA(((l-f)/(_-f)-E)/(j-E),0,1)}function xf(v,l,f,_){if(l.pitch<20)return 1;const E=l.getWorldToCameraMatrix();i.aB(E,E,v);const j=i.bT(f.min[0],f.min[1],f.min[2],1);let k=i.aC(i.eF(),j,E),L=k,z=k;j[1]=f.max[1],k=i.aC(i.eF(),j,E),L=k[1]<L[1]?k:L,z=k[1]>z[1]?k:z,j[0]=f.max[0],k=i.aC(i.eF(),j,E),L=k[1]<L[1]?k:L,z=k[1]>z[1]?k:z,j[1]=f.min[1],k=i.aC(i.eF(),j,E),L=k[1]<L[1]?k:L,z=k[1]>z[1]?k:z;const G=i.aA(_[0],0,1),Z=100*l.pixelsPerMeter*i.aA(_[1],0,1),Q=i.aA(_[2],0,1),X=i.eG(i.eF(),L,z,G),se=Math.tan(.5*l.fovX),le=-X[2]*se;if(Z===0)return X[1]<-Math.abs(le)?Q:1;const ue=(-Math.abs(le)-X[1])/Z,_e=(Ee,Ne,je)=>(1-je)*Ee+je*Ne,ye=i.aA(_e(1,Q,ue),Q,1);return _e(1,ye,i.aA((l.pitch-20)/20,0,1))}class RA{}class MA{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,f,_){{const Q=this._storage.get(f.id);if(Q)return Q.lastUsedFrameIdx=l,Q.buf}const E=_.gl,j=E.getBufferParameter(E.ELEMENT_ARRAY_BUFFER,E.BUFFER_SIZE),k=new ArrayBuffer(j),L=new Int16Array(k);E.getBufferSubData(E.ELEMENT_ARRAY_BUFFER,0,new Int16Array(k));const z=new i.eI;for(let Q=0;Q<j/2;Q+=3){const X=L[Q],se=L[Q+1],le=L[Q+2];z.emplaceBack(X,se),z.emplaceBack(se,le),z.emplaceBack(le,X)}const G=_.bindVertexArrayOES.current,Z=new RA;return Z.buf=new rh(_,z),Z.lastUsedFrameIdx=l,this._storage.set(f.id,Z),_.bindVertexArrayOES.set(G),Z.buf}update(l){for(const[f,_]of this._storage)l-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(f))}destroy(){for(const[l,f]of this._storage)f.buf.destroy(),this._storage.delete(l)}}class vR{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const DA=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class _R{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class qo{constructor(l,f){this.revealStart=11,this.revealRange=2,l.registerParameter(this,[...f,"Reveal"],"revealStart",{min:0,max:17,step:.05}),l.registerParameter(this,[...f,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const xR=i.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class my{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(l,f){const _=l.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const k=new i.eJ,L=new i.b0;k.emplaceBack(-1,-1),k.emplaceBack(1,-1),k.emplaceBack(1,1),k.emplaceBack(-1,1),L.emplaceBack(0,1,2),L.emplaceBack(0,2,3),this.vignetteVx=l.context.createVertexBuffer(k,xR.members),this.vignetteIdx=l.context.createIndexBuffer(L)}const E=i.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){l.uploadCommonUniforms(l.context,_);const k={u_vignetteShape:(j={vignetteShape:[f.start,f.range,Math.pow(10,f.fadePower)],vignetteColor:[f.color.r,f.color.g,f.color.b,f.color.a*f.strength]}).vignetteShape,u_vignetteColor:j.vignetteColor};_.draw(l,l.context.gl.TRIANGLES,Er.disabled,rn.disabled,yn.alphaBlended,Xr.disabled,k,"vignette",this.vignetteVx,this.vignetteIdx,E)}var j}}class Qi{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(l,f){const _=l.getFreeCameraOptions().position,E=_.toAltitude(),j=_.toLngLat(),k=i.an(j.lng),L=i.an(j.lat),z=l.pixelsPerMeter/f,G=k*i.eL,Z=i.eL*Math.log(Math.tan(Math.PI/4+L/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Q=-this._offsetYPrev+Z,X=-this._elevationPrev+E;this._accumulatedOffsetX+=(-this._offsetXPrev+G)*z,this._accumulatedOffsetY+=Q*z,this._accumulatedElevation+=X*z,this._offsetXPrev=G,this._offsetYPrev=Z,this._elevationPrev=E}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Cn(v,l){return[-(v[0]-Math.floor(v[0]/l)*l),-(v[1]-Math.floor(v[1]/l)*l),-(v[2]-Math.floor(v[2]/l)*l)]}function A1(v){const l=i.eq(1323123451230),f=[];for(let _=0;_<v;++_){const E=2*l()-1,j=2*l()-1,k=2*l()-1;f.push(i.d4(E,j,k))}return f}function _l(v,l,f,_,E){const j=i.aA((E-f)/(_-f),0,1);return(1-j)*v+j*l}class bf{constructor(l){this._movement=new Qi,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new my,this._ppmScaleFactor=l}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(l,f){const _=l.transform;this._movement.update(_,this._ppmScaleFactor);const E=_.starsProjMatrix,j=i.c6([]);i.c8(j,j,i.an(90)-_._pitch),i.c7(j,j,-_.angle);const k=i.cb(new Float32Array(16),j),L=i.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),z=i.ef([],L),G=i.aB([],z,k),Z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(Z-this._prevTime)*f,this._prevTime=Z,{projectionMatrix:E,modelviewMatrix:G}}}class Kp extends bf{constructor(l){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new qo(l.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(l){const f=l.context;if(!this.particlesVx){const _=A1(this.particlesCount),E=new i.eM,j=new i.b0;let k=0;const L=i.eq(1323123451230);for(let z=0;z<_.length;++z){const G=_[z],Z=[2*L()-1,L(),L(),L()];E.emplaceBack(G[0],G[1],G[2],-1,-1,...Z),E.emplaceBack(G[0],G[1],G[2],1,-1,...Z),E.emplaceBack(G[0],G[1],G[2],1,1,...Z),E.emplaceBack(G[0],G[1],G[2],-1,1,...Z),j.emplaceBack(k+0,k+1,k+2),j.emplaceBack(k+0,k+2,k+3),k+=4}this.particlesVx=f.createVertexBuffer(E,DA.members),this.particlesIdx=f.createIndexBuffer(j)}}draw(l){if(!this._params.overrideStyleParameters&&!l.style.rain)return;const f=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=l.transform.zoom;if(f.revealStart>_)return;const E=_l(0,1,f.revealStart,f.revealStart+f.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const j=structuredClone(this._params);let k=[-j.direction.x,j.direction.y,-100];i.aw(k,k);const L=structuredClone(this._vignetteParams);L.strength*=E,j.overrideStyleParameters||(j.intensity=l.style.rain.state.density,j.timeFactor=l.style.rain.state.intensity,j.color=structuredClone(l.style.rain.state.color),k=structuredClone(l.style.rain.state.direction),j.screenThinning.intensity=l.style.rain.state.centerThinning,j.dropletSizeX=l.style.rain.state.dropletSize[0],j.dropletSizeYScale=l.style.rain.state.dropletSize[1]/l.style.rain.state.dropletSize[0],j.distortionStrength=100*l.style.rain.state.distortionStrength,L.strength=1,L.color=structuredClone(l.style.rain.state.vignetteColor));const z=this.updateOnRender(l,j.timeFactor),G=l.context,Z=G.gl,Q=l.transform;this.screenTexture&&this.screenTexture.size[0]===l.width&&this.screenTexture.size[1]===l.height||(this.screenTexture=new i.T(G,{width:l.width,height:l.height,data:null},Z.RGBA8)),j.distortionStrength>0&&(G.activeTexture.set(Z.TEXTURE0),this.screenTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Z.copyTexSubImage2D(Z.TEXTURE_2D,0,0,0,0,0,l.width,l.height));const X=l.getOrCreateProgram("rainParticle");l.uploadCommonUniforms(G,X),G.activeTexture.set(Z.TEXTURE0),this.screenTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const se=[j.color.r,j.color.g,j.color.b,j.color.a],le=(ue,_e)=>{const ye=Cn(this._movement.getPosition(),ue),Ee=j.dropletSizeX,Ne=j.dropletSizeX*j.dropletSizeYScale,je=l.width/2,qe=l.height/2,Ie=_l(0,j.screenThinning.start,0,1,j.screenThinning.intensity),Ge=_l(.001,j.screenThinning.range,0,1,j.screenThinning.intensity),Ue=_l(0,j.screenThinning.particleOffset,0,1,j.screenThinning.intensity),De=(Ze={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ye,velocityConeAperture:j.velocityConeAperture,velocity:j.velocity,boxSize:ue,rainDropletSize:[Ee,Ne],distortionStrength:j.distortionStrength,rainDirection:k,color:se,screenSize:[Q.width,Q.height],thinningCenterPos:[je,qe],thinningShape:[Ie,Ge,Math.pow(10,j.screenThinning.fadePower)],thinningAffectedRatio:j.screenThinning.affectedRatio,thinningParticleOffset:Ue,shapeDirectionalPower:j.shapeDirPower,shapeNormalPower:j.shapeNormalPower,mode:_e?0:1},{u_modelview:Float32Array.from(Ze.modelview),u_projection:Float32Array.from(Ze.projection),u_time:Ze.time,u_cam_pos:Ze.camPos,u_texScreen:0,u_velocityConeAperture:Ze.velocityConeAperture,u_velocity:Ze.velocity,u_boxSize:Ze.boxSize,u_rainDropletSize:Ze.rainDropletSize,u_distortionStrength:Ze.distortionStrength,u_rainDirection:Ze.rainDirection,u_color:Ze.color,u_screenSize:Ze.screenSize,u_thinningCenterPos:Ze.thinningCenterPos,u_thinningShape:Ze.thinningShape,u_thinningAffectedRatio:Ze.thinningAffectedRatio,u_thinningParticleOffset:Ze.thinningParticleOffset,u_shapeDirectionalPower:Ze.shapeDirectionalPower,u_shapeNormalPower:Ze.shapeNormalPower,u_mode:Ze.mode});var Ze;const ut=Math.round(j.intensity*this.particlesCount),ot=i.bf.simpleSegment(0,0,4*ut,2*ut);X.draw(l,Z.TRIANGLES,Er.disabled,rn.disabled,yn.alphaBlended,Xr.disabled,De,"rain_particles",this.particlesVx,this.particlesIdx,ot)};j.distortionStrength>0&&le(j.boxSize,!0),le(j.boxSize,!1),this._vignette.draw(l,L)}}const hd=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class C1 extends bf{constructor(l){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new qo(l.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(l){const f=l.context;if(!this.particlesVx){const _=A1(this.particlesCount),E=new i.eN,j=new i.b0;let k=0;const L=i.eq(1323123451230);for(let z=0;z<_.length;++z){const G=_[z],Z=L(),Q=L(),X=L(),se=[z/_.length,Z,Q,X],le=[L(),L()];E.emplaceBack(G[0],G[1],G[2],-1,-1,...se,...le),E.emplaceBack(G[0],G[1],G[2],1,-1,...se,...le),E.emplaceBack(G[0],G[1],G[2],1,1,...se,...le),E.emplaceBack(G[0],G[1],G[2],-1,1,...se,...le),j.emplaceBack(k+0,k+1,k+2),j.emplaceBack(k+0,k+2,k+3),k+=4}this.particlesVx=f.createVertexBuffer(E,hd.members),this.particlesIdx=f.createIndexBuffer(j)}}draw(l){if(!this._params.overrideStyleParameters&&!l.style.snow)return;const f=structuredClone(this._params);let _=[-f.direction.x,f.direction.y,-100];i.aw(_,_);const E=structuredClone(this._vignetteParams),j=f.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},k=l.transform.zoom;if(j.revealStart>k)return;const L=_l(0,1,j.revealStart,j.revealStart+j.revealRange,k);E.strength*=L,f.overrideStyleParameters||(f.intensity=l.style.snow.state.density,f.timeFactor=l.style.snow.state.intensity,f.color=structuredClone(l.style.snow.state.color),_=structuredClone(l.style.snow.state.direction),f.screenThinning.intensity=l.style.snow.state.centerThinning,f.billboardSize=2.79*l.style.snow.state.flakeSize,E.strength=1,E.color=structuredClone(l.style.snow.state.vignetteColor));const z=this.updateOnRender(l,f.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const G=l.context,Z=G.gl,Q=l.transform,X=l.getOrCreateProgram("snowParticle");l.uploadCommonUniforms(G,X),((se,le,ue)=>{const _e=Cn(this._movement.getPosition(),se),ye=Q.width/2,Ee=Q.height/2,Ne=_l(0,ue.screenThinning.start,0,1,ue.screenThinning.intensity),je=_l(.001,ue.screenThinning.range,0,1,ue.screenThinning.intensity),qe=_l(0,ue.screenThinning.particleOffset,0,1,ue.screenThinning.intensity),Ie=(Ge={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:_e,velocityConeAperture:ue.velocityConeAperture,velocity:ue.velocity,horizontalOscillationRadius:ue.horizontalOscillationRadius,horizontalOscillationRate:ue.horizontalOscillationRate,boxSize:se,billboardSize:1*ue.billboardSize,simpleShapeParameters:[ue.shapeFadeStart,ue.shapeFadePower],screenSize:[Q.width,Q.height],thinningCenterPos:[ye,Ee],thinningShape:[Ne,je,Math.pow(10,ue.screenThinning.fadePower)],thinningAffectedRatio:ue.screenThinning.affectedRatio,thinningParticleOffset:qe,color:[ue.color.r,ue.color.g,ue.color.b,ue.color.a],direction:_},{u_modelview:Float32Array.from(Ge.modelview),u_projection:Float32Array.from(Ge.projection),u_time:Ge.time,u_cam_pos:Ge.camPos,u_velocityConeAperture:Ge.velocityConeAperture,u_velocity:Ge.velocity,u_horizontalOscillationRadius:Ge.horizontalOscillationRadius,u_horizontalOscillationRate:Ge.horizontalOscillationRate,u_boxSize:Ge.boxSize,u_billboardSize:Ge.billboardSize,u_simpleShapeParameters:Ge.simpleShapeParameters,u_screenSize:Ge.screenSize,u_thinningCenterPos:Ge.thinningCenterPos,u_thinningShape:Ge.thinningShape,u_thinningAffectedRatio:Ge.thinningAffectedRatio,u_thinningParticleOffset:Ge.thinningParticleOffset,u_particleColor:Ge.color,u_direction:Ge.direction});var Ge;const Ue=Math.round(ue.intensity*this.particlesCount),De=i.bf.simpleSegment(0,0,4*Ue,2*Ue);this.particlesVx&&this.particlesIdx&&X.draw(l,Z.TRIANGLES,Er.disabled,rn.disabled,yn.alphaBlended,Xr.disabled,Ie,"snow_particles",this.particlesVx,this.particlesIdx,De)})(f.boxSize,0,f),this._vignette.draw(l,E)}}const j1={symbol:function(v,l,f,_,E){if(v.renderPass!=="translucent")return;const j=rn.disabled,k=v.colorModeForRenderPass(),L=f.layout.get("text-variable-anchor"),z=f.layout.get("text-size-scale-range"),G=i.aA(v.scaleFactor,z[0],z[1]);L&&function(X,se,le,ue,_e,ye,Ee,Ne){const je=se.transform,qe=_e==="map",Ie=ye==="map";for(const Ge of X){const Ue=ue.getTile(Ge),De=Ue.getBucket(le);if(!De||!De.text||!De.text.segments.get().length)continue;const Ze=i.bJ(De.textSizeData,je.zoom,Ne),ut=u_(Ge,De.getProjection(),je),ot=je.calculatePixelsToTileUnitsMatrix(Ue),St=wp(ut,Ue.tileID.canonical,Ie,qe,je,De.getProjection(),ot),gt=De.hasIconTextFit()&&De.hasIconData();Ze&&q_(De,qe,Ie,Ee,je,St,Ge,Math.pow(2,je.zoom-Ue.tileID.overscaledZ),Ze,gt)}}(_,v,f,l,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),E,G);const Z=f.paint.get("icon-opacity").constantOr(1)!==0,Q=f.paint.get("text-opacity").constantOr(1)!==0;f.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(Z||Q)?hy(v,l,f,_,j,k):(Z&&hy(v,l,f,_,j,k,{onlyIcons:!0}),Q&&hy(v,l,f,_,j,k,{onlyText:!0})),l.map.showCollisionBoxes&&(dy(v,l,f,_,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),dy(v,l,f,_,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(v,l,f,_){if(v.renderPass!=="translucent")return;const E=f.paint.get("circle-opacity"),j=f.paint.get("circle-stroke-width"),k=f.paint.get("circle-stroke-opacity"),L=f.layout.get("circle-sort-key").constantOr(1)!==void 0,z=f.paint.get("circle-emissive-strength");if(E.constantOr(1)===0&&(j.constantOr(1)===0||k.constantOr(1)===0))return;const G=v.context,Z=G.gl,Q=v.transform,X=!(!v.terrain||!v.terrain.enabled),se=f.layout.get("circle-elevation-reference"),le=v.depthModeForSublayer(0,Er.ReadOnly),ue=new Er(v.context.gl.LEQUAL,Er.ReadOnly,v.depthRangeFor3D),_e=se==="none"||X?le:ue,ye=rn.disabled,Ee=v.colorModeForDrapableLayerRenderPass(z),Ne=Q.projection.name==="globe",je=[i.aF(Q.center.lng),i.aJ(Q.center.lat)],qe=[];for(let Ge=0;Ge<_.length;Ge++){const Ue=_[Ge],De=l.getTile(Ue),Ze=De.getBucket(f);if(!Ze||Ze.projection.name!==Q.projection.name)continue;const ut=Ze.programConfigurations.get(f.id),ot=Ze.layoutVertexBuffer,St=Ze.globeExtVertexBuffer,gt=Ze.indexBuffer,kt=i.d$(f),Qt=[St],mt=v.isTileAffectedByFog(Ue);Ne&&kt.push("PROJECTION_GLOBE_VIEW"),kt.push("DEPTH_D24"),v.terrain&&Q.depthOcclusionForSymbolsAndCircles&&kt.push("DEPTH_OCCLUSION"),Ze.hasElevation&&!v.terrain&&(kt.push("ELEVATED_ROADS"),Qt.push(Ze.elevatedLayoutVertexBuffer));const nt=v.getOrCreateProgram("circle",{config:ut,defines:kt,overrideFog:mt}),Nt=Q.projection.createInversionMatrix(Q,Ue.canonical),yt={programConfiguration:ut,program:nt,layoutVertexBuffer:ot,dynamicBuffers:Qt,indexBuffer:gt,uniformValues:i.e0(v,Ue,De,Nt,je,f),tile:De};if(L){const $t=Ze.segments.get();for(const nr of $t)qe.push({segments:new i.bf([nr]),sortKey:nr.sortKey,state:yt})}else qe.push({segments:Ze.segments,sortKey:0,state:yt})}L&&qe.sort((Ge,Ue)=>Ge.sortKey-Ue.sortKey);const Ie={useDepthForOcclusion:Q.depthOcclusionForSymbolsAndCircles};for(const Ge of qe){const{programConfiguration:Ue,program:De,layoutVertexBuffer:Ze,dynamicBuffers:ut,indexBuffer:ot,uniformValues:St,tile:gt}=Ge.state,kt=Ge.segments;v.terrain&&v.terrain.setupElevationDraw(gt,De,Ie),v.uploadCommonUniforms(G,De,gt.tileID.toUnwrapped()),De.draw(v,Z.TRIANGLES,_e,ye,Ee,Xr.disabled,St,f.id,Ze,ot,kt,f.paint,Q.zoom,Ue,ut)}},heatmap:function(v,l,f,_){if(f.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const E=v.context,j=E.gl,k=rn.disabled,L=new yn([j.ONE,j.ONE,j.ONE,j.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(se,le,ue,_e){const ye=se.gl,Ee=le.width*_e,Ne=le.height*_e;se.activeTexture.set(ye.TEXTURE1),se.viewport.set([0,0,Ee,Ne]);let je=ue.heatmapFbo;if(!je||je&&(je.width!==Ee||je.height!==Ne)){je&&je.destroy();const qe=ye.createTexture();ye.bindTexture(ye.TEXTURE_2D,qe),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MIN_FILTER,ye.LINEAR),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MAG_FILTER,ye.LINEAR),je=ue.heatmapFbo=se.createFramebuffer(Ee,Ne,!0,null),function(Ie,Ge,Ue,De,Ze,ut){const ot=Ie.gl;ot.texImage2D(ot.TEXTURE_2D,0,Ie.extRenderToTextureHalfFloat?ot.RGBA16F:ot.RGBA,Ze,ut,0,ot.RGBA,Ie.extRenderToTextureHalfFloat?ot.HALF_FLOAT:ot.UNSIGNED_BYTE,null),De.colorAttachment.set(Ue)}(se,0,qe,je,Ee,Ne)}else ye.bindTexture(ye.TEXTURE_2D,je.colorAttachment.get()),se.bindFramebuffer.set(je.framebuffer)})(E,v,f,v.transform.projection.name==="globe"?.5:.25),E.clear({color:i.ao.transparent});const z=v.transform,G=z.projection.name==="globe",Z=G?["PROJECTION_GLOBE_VIEW"]:[],Q=G?Xr.frontCCW:Xr.disabled,X=[i.aF(z.center.lng),i.aJ(z.center.lat)];for(let se=0;se<_.length;se++){const le=_[se];if(l.hasRenderableParent(le))continue;const ue=l.getTile(le),_e=ue.getBucket(f);if(!_e||_e.projection.name!==z.projection.name)continue;const ye=v.isTileAffectedByFog(le),Ee=_e.programConfigurations.get(f.id),Ne=v.getOrCreateProgram("heatmap",{config:Ee,defines:Z,overrideFog:ye}),{zoom:je}=v.transform;v.terrain&&v.terrain.setupElevationDraw(ue,Ne),v.uploadCommonUniforms(E,Ne,le.toUnwrapped());const qe=z.projection.createInversionMatrix(z,le.canonical);Ne.draw(v,j.TRIANGLES,Er.disabled,k,L,Q,SA(v,le,ue,qe,X,je,f.paint.get("heatmap-intensity")),f.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,f.paint,v.transform.zoom,Ee,G?[_e.globeExtVertexBuffer]:null)}E.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(E,j){const k=E.context,L=k.gl,z=j.heatmapFbo;if(!z)return;k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,z.colorAttachment.get()),k.activeTexture.set(L.TEXTURE1);let G=j.colorRampTexture;G||(G=j.colorRampTexture=new i.T(k,j.colorRamp,L.RGBA8)),G.bind(L.LINEAR,L.CLAMP_TO_EDGE),E.getOrCreateProgram("heatmapTexture").draw(E,L.TRIANGLES,Er.disabled,rn.disabled,E.colorModeForRenderPass(),Xr.disabled,((Z,Q,X,se)=>({u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}))(0,j),j.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,j.paint,E.transform.zoom)}(v,f))},line:function(v,l,f,_){if(v.renderPass!=="translucent")return;const E=f.paint.get("line-opacity"),j=f.paint.get("line-width");if(E.constantOr(1)===0||j.constantOr(1)===0)return;const k=f.paint.get("line-emissive-strength"),L=f.paint.get("line-occlusion-opacity"),z=f.layout.get("line-elevation-reference"),G=f.layout.get("line-width-unit")==="meters",Z=z==="sea",Q=!(!v.terrain||!v.terrain.enabled),X=v.context,se=X.gl;if(f.hasElevatedBuckets&&v.transform.projection.name==="globe")return;const le=f.layout.get("line-cross-slope"),ue=le!==void 0,_e=le<1,ye=v.colorModeForDrapableLayerRenderPass(k),Ee=v.terrain&&v.terrain.renderingToTexture,Ne=Ee?1:i.o.devicePixelRatio,je=f.paint.get("line-dasharray"),qe=je.constantOr(1),Ie=f.layout.get("line-cap"),Ge=je.constantOr(null),Ue=Ie.constantOr(null),De=f.paint.get("line-pattern"),Ze=De.constantOr(1),ut=f.paint.get("line-pattern-cross-fade"),ot=De.constantOr(null),St=f.paint.get("line-opacity").constantOr(1);let gt=!Ze&&St!==1||v.depthOcclusion&&L>0&&L<1;const kt=f.paint.get("line-gradient"),Qt=Ze?"linePattern":"line",mt=i.e1(f);let nt;if(Ee&&v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(gt=!1),L!==0&&v.depthOcclusion){const nr=f.paint._values["line-opacity"];nr&&nr.value&&nr.value.kind==="constant"?nt=nr.value:i.w(`Occlusion opacity for layer ${f.id} is supported only when line-opacity isn't data-driven.`)}j.value.kind!=="constant"&&j.value.isLineProgressConstant===!1&&mt.push("VARIABLE_LINE_WIDTH");const Nt=(nr,xr,Xt,tr,wr,pr)=>{for(const dr of nr){const mr=l.getTile(dr);if(Ze&&!mr.patternsLoaded())continue;const $r=mr.getBucket(f);if(!$r||$r.elevationType!=="none"&&!wr||$r.elevationType==="none"&&wr)continue;v.prepareDrawTile();const jn=[...xr],Fn=v.shadowRenderer,Ei=$r.elevationType==="road"&&!!Fn&&Fn.enabled;let Yr=[0,0,0];if(Ei){const Qr=v.style.directionalLight,Un=v.style.ambientLight;Qr&&Un&&(Yr=Ac(v.style,Qr,Un)),jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Dn=$r.programConfigurations.get(f.id);let dn=!1;if(ot&&mr.imageAtlas){const Qr=i.e2.from(ot),Un=Qr.getPrimary().scaleSelf(Ne).toString(),os=mr.imageAtlas.patternPositions.get(Un),ks=Qr.getSecondary(),hs=ks?mr.imageAtlas.patternPositions.get(ks.scaleSelf(Ne).toString()):null;dn=!!os&&!!hs,os&&Dn.setConstantPatternPositions(os,hs)}ut>0&&(dn||Dn.getPatternTransitionVertexBuffer("line-pattern"))&&jn.push("LINE_PATTERN_TRANSITION");const yi=v.isTileAffectedByFog(dr),zn=v.getOrCreateProgram(Qt,{config:Dn,defines:jn,overrideFog:yi});if(!Ze&&Ge&&Ue&&mr.lineAtlas){const Qr=mr.lineAtlas.getDash(Ge,Ue);Qr&&Dn.setConstantPatternPositions(Qr)}Ei&&Fn.setupShadows(mr.tileID.toUnwrapped(),zn,"vector-tile");let[Di,Xn]=f.paint.get("line-trim-offset");(Ue==="round"||Ue==="square")&&Di!==Xn&&(Di===0&&(Di-=1),Xn===1&&(Xn+=1));const fn=Ee?dr.projMatrix:null,ai=G?1/$r.tileToMeter/i.ay(mr,1,v.transform.zoom):1,_n=G?1/$r.tileToMeter/i.ay(mr,1,Math.floor(v.transform.zoom)):1,Wi=Ze?i.e3(v,mr,f,fn,Ne,ai,_n,[Di,Xn],Yr,ut):i.e4(v,mr,f,fn,$r.lineClipsArray.length,Ne,ai,_n,[Di,Xn],Yr);if(kt){const Qr=$r.gradients[f.id];let Un=Qr.texture;if(f.gradientVersion!==Qr.version){let os=256;if(f.stepInterpolant){const ks=l.getSource().maxzoom,hs=dr.canonical.z===ks?Math.ceil(1<<v.transform.maxZoom-dr.canonical.z):1;os=i.aA(i.e5($r.maxLineLength/i.al*1024*hs),256,X.maxTextureSize)}Qr.gradient=i.e6({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:os,image:Qr.gradient||void 0,clips:$r.lineClipsArray}),Qr.texture?Qr.texture.update(Qr.gradient):Qr.texture=new i.T(X,Qr.gradient,se.RGBA8),Qr.version=f.gradientVersion,Un=Qr.texture}X.activeTexture.set(se.TEXTURE1),Un.bind(f.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}qe&&(X.activeTexture.set(se.TEXTURE0),mr.lineAtlasTexture&&mr.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Dn.updatePaintBuffers()),Ze&&(X.activeTexture.set(se.TEXTURE0),mr.imageAtlasTexture&&mr.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Dn.updatePaintBuffers()),wr&&!Z&&v.terrain.setupElevationDraw(mr,zn),v.uploadCommonUniforms(X,zn,dr.toUnwrapped());const di=Qr=>{nt!=null&&(nt.value=St*L),zn.draw(v,se.TRIANGLES,Xt,Qr,ye,Xr.disabled,Wi,f.id,$r.layoutVertexBuffer,$r.indexBuffer,$r.segments,f.paint,v.transform.zoom,Dn,[$r.layoutVertexBuffer2,$r.patternVertexBuffer,$r.zOffsetVertexBuffer]),nt!=null&&(nt.value=St)};if(gt&&!wr){const Qr=v.stencilModeForClipping(dr).ref;Qr===0&&Ee&&X.clear({stencil:0});const Un={func:se.EQUAL,mask:255};Wi.u_alpha_discard_threshold=.8,di(new rn(Un,Qr,255,se.KEEP,se.KEEP,se.INVERT)),Wi.u_alpha_discard_threshold=0,di(new rn(Un,Qr,255,se.KEEP,se.KEEP,se.KEEP))}else Wi.u_alpha_discard_threshold=gt&&wr&&pr?.8:0,di(wr?tr:v.stencilModeForClipping(dr))}};let yt=v.depthModeForSublayer(0,Er.ReadOnly);const $t=new Er(v.depthOcclusion?se.GREATER:se.LEQUAL,Er.ReadOnly,v.depthRangeFor3D);if(f.hasNonElevatedBuckets){const nr=!Ee&&v.terrain;L!==0&&nr?i.w(`Occlusion opacity for layer ${f.id} is supported on terrain only if the layer has line-z-offset enabled.`):nr?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${f.id}.`):Nt(_,mt,yt,rn.disabled,!1,!0)}if(f.hasElevatedBuckets){z==="hd-road-markup"?Q||(yt=$t,mt.push("ELEVATED_ROADS")):(mt.push("ELEVATED"),yt=$t,ue&&mt.push(_e?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Z&&mt.push("ELEVATION_REFERENCE_SEA"));const nr=gt?v.stencilModeFor3D():rn.disabled;v.forceTerrainMode=!0,Nt(_,mt,yt,nr,!0,!0),gt&&Nt(_,mt,yt,nr,!0,!1),v.forceTerrainMode=!1}gt&&(v.resetStencilClippingMasks(),Ee&&X.clear({stencil:0})),L===0||v.depthOcclusion||Ee||v.layersWithOcclusionOpacity.push(v.currentLayer)},fill:function(v,l,f,_){const E=f.paint.get("fill-color"),j=f.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const k=f.paint.get("fill-emissive-strength"),L=v.colorModeForDrapableLayerRenderPass(k),z=f.paint.get("fill-pattern"),G=v.opaquePassEnabledForLayer()&&!z.constantOr(1)&&E.constantOr(i.ao.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";let Z="none";f.layout.get("fill-elevation-reference")!=="none"?Z="road":f.paint.get("fill-z-offset").constantOr(1)!==0&&(Z="offset");const Q=!(!v.terrain||!v.terrain.enabled),X={painter:v,sourceCache:l,layer:f,coords:_,colorMode:L,elevationType:Z,terrainEnabled:Q,pass:G};if(v.renderPass!=="shadow")if(Z!=="offset"){if($p(X,!1),Z==="road"){const se=!Q&&v.renderPass==="translucent";se&&vf(v,l,f,_,"geometry"),$p(X,!0,rn.disabled),se&&function(le){const{painter:ue,sourceCache:_e,layer:ye,coords:Ee,colorMode:Ne}=le,je=ue.context.gl,qe=le.painter.shadowRenderer,Ie=!!qe&&qe.enabled,Ge=new Er(ue.context.gl.LEQUAL,Er.ReadOnly,ue.depthRangeFor3D);let Ue=[0,0,0];if(Ie){const Ze=ue.style.directionalLight,ut=ue.style.ambientLight;Ze&&ut&&(Ue=Ac(ue.style,Ze,ut))}const De=Ze=>{for(const ut of Ee){const ot=_e.getTile(ut),St=ot.getBucket(ye);if(!St)continue;const gt=St.elevatedStructures;if(!gt)continue;let kt,Qt;if(Ze?(kt=gt.renderableBridgeSegments,Qt=gt.bridgeProgramConfigurations.get(ye.id)):(kt=gt.renderableTunnelSegments,Qt=gt.tunnelProgramConfigurations.get(ye.id)),!kt||kt.segments[0].primitiveLength===0)continue;Qt.updatePaintBuffers(),ue.prepareDrawTile();const mt=ue.isTileAffectedByFog(ut),nt=[];Ie&&nt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Nt=ue.getOrCreateProgram("elevatedStructures",{config:Qt,overrideFog:mt,defines:nt}),yt=ue.translatePosMatrix(ut.projMatrix,ot,ye.paint.get("fill-translate"),ye.paint.get("fill-translate-anchor"));Ie&&qe.setupShadows(ot.tileID.toUnwrapped(),Nt,"vector-tile");const $t=hR(yt,Ue);ue.uploadCommonUniforms(ue.context,Nt,ut.toUnwrapped()),Nt.draw(ue,je.TRIANGLES,Ge,rn.disabled,Ne,Xr.backCCW,$t,ye.id,gt.vertexBuffer,gt.indexBuffer,kt,ye.paint,ue.transform.zoom,Qt,[gt.vertexBufferNormal])}};De(!0),De(!1)}(X)}}else $p(X,!1,v.stencilModeFor3D());else v.shadowRenderer&&Z==="road"&&!Q&&function(se){const{painter:le,sourceCache:ue,layer:_e,coords:ye}=se,Ee=le.context.gl,Ne=se.painter.shadowRenderer;for(const je of ye){const qe=ue.getTile(je),Ie=qe.getBucket(_e);if(!Ie)continue;const Ge=Ie.elevatedStructures;if(!Ge||!Ge.shadowCasterSegments||Ge.shadowCasterSegments.segments[0].primitiveLength===0)continue;le.prepareDrawTile();const Ue=Ie.bufferData.programConfigurations.get(_e.id),De=le.isTileAffectedByFog(je),Ze=le.getOrCreateProgram("elevatedStructuresDepth",{config:Ue,overrideFog:De}),ut=Ne.calculateShadowPassMatrixFromTile(qe.tileID.toUnwrapped());le.uploadCommonUniforms(le.context,Ze,je.toUnwrapped());const ot={u_matrix:ut,u_depth_bias:0};Ze.draw(le,Ee.TRIANGLES,Ne.getShadowPassDepthMode(),rn.disabled,Ne.getShadowPassColorMode(),Xr.disabled,ot,_e.id,Ge.vertexBuffer,Ge.indexBuffer,Ge.shadowCasterSegments,_e.paint,le.transform.zoom,Ue)}}(X)},"fill-extrusion":function(v,l,f,_){const E=f.paint.get("fill-extrusion-opacity"),j=v.context,k=j.gl,L=v.terrain,z=L&&L.renderingToTexture;if(E===0)return;const G=v.conflationActive&&v.style.isLayerClipped(f,l.getSource()),Z=v.style.order.indexOf(f.fqid);if(G&&function(Q,X,se,le,ue){for(const _e of le){const ye=X.getTile(_e).getBucket(se);ye&&(ye.updateReplacement(_e,Q.replacementSource,ue),ye.uploadCentroid(Q.context))}}(v,l,f,_,Z),L||G)for(const Q of _){const X=l.getTile(Q).getBucket(f);X&&ih(v.context,l,Q,X,f,L,G)}if(v.renderPass==="shadow"&&v.shadowRenderer){const Q=v.shadowRenderer;if(L&&E<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const X=Q.getShadowPassDepthMode(),se=Q.getShadowPassColorMode();_r(v,l,f,_,X,rn.disabled,se,G)}else if(v.renderPass==="translucent"){const Q=!f.paint.get("fill-extrusion-pattern").constantOr(1),X=f.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!z&&X.a!==0){const se=new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D);E===1&&Q?_r(v,l,f,_,se,rn.disabled,yn.unblended,G):(_r(v,l,f,_,se,rn.disabled,yn.disabled,G),_r(v,l,f,_,se,v.stencilModeFor3D(),v.colorModeForRenderPass(),G),v.resetStencilClippingMasks())}if(v.style.enable3dLights()&&Q&&(!L&&v.transform.projection.name!=="globe"||z)){const se=f.paint.get("fill-extrusion-opacity"),le=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_e=f.paint.get("fill-extrusion-flood-light-intensity"),ye=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ee=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ye?null:f.lut).toArray01().slice(0,3),Ne=le>0&&ue>0,je=_e>0,qe=(Ue,De,Ze)=>(1-Ze)*Ue+Ze*De,Ie=new f1;Ie.translate=f.paint.get("fill-extrusion-translate"),Ie.translateAnchor=f.paint.get("fill-extrusion-translate-anchor"),Ie.edgeRadius=f.layout.get("fill-extrusion-edge-radius"),Ie.cutoffFadeRange=f.paint.get("fill-extrusion-cutoff-fade-range");const Ge=Ue=>{const De=v.depthModeForSublayer(1,Er.ReadOnly,k.LEQUAL,!0),Ze=f.paint.get(Ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ut=qe(.1,3,Ze),ot=v._showOverdrawInspector;if(!ot){const St=new rn({func:k.ALWAYS,mask:255},255,255,k.KEEP,k.KEEP,k.REPLACE),gt=new yn([k.ONE,k.ONE,k.ONE,k.ONE],i.ao.transparent,[!1,!1,!1,!0],k.MIN);ud(Ie,v,l,f,_,De,St,gt,Xr.disabled,Ue,"sdf",se,le,ue,_e,Ee,ut,G,!1)}{const St=ot?rn.disabled:new rn({func:k.EQUAL,mask:255},255,255,k.KEEP,k.DECR,k.DECR),gt=ot?v.colorModeForRenderPass():new yn([k.ONE_MINUS_DST_ALPHA,k.DST_ALPHA,k.ONE,k.ONE],i.ao.transparent,[!0,!0,!0,!0]);ud(Ie,v,l,f,_,De,St,gt,Xr.disabled,Ue,"color",se,le,ue,_e,Ee,ut,G,!1)}};if(z){const Ue=(De,Ze,ut)=>{const ot=v.depthModeForSublayer(1,Er.ReadOnly,k.LEQUAL,!1),St=f.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),gt=qe(.1,3,St);{const kt=new yn([k.ONE,k.ONE,k.ONE,k.ONE],i.ao.transparent,[!1,!1,!1,!0]);ud(Ie,v,l,f,_,ot,rn.disabled,kt,Xr.disabled,De,"clear",se,le,ue,_e,Ee,gt,G,Ze)}{const kt=new rn({func:k.ALWAYS,mask:255},255,255,k.KEEP,k.KEEP,k.REPLACE),Qt=new yn([k.ONE,k.ONE,k.ONE,k.ONE],i.ao.transparent,[!1,!1,!1,!0],k.MIN);ud(Ie,v,l,f,_,ot,kt,Qt,Xr.disabled,De,"sdf",se,le,ue,_e,Ee,gt,G,Ze)}{const kt=De?k.ZERO:k.ONE_MINUS_DST_ALPHA,Qt=new rn({func:k.EQUAL,mask:255},255,255,k.KEEP,k.DECR,k.DECR),mt=new yn([kt,k.DST_ALPHA,k.ONE_MINUS_DST_ALPHA,k.ZERO],i.ao.transparent,[!0,!0,!0,!0]);ud(Ie,v,l,f,_,ot,Qt,mt,Xr.disabled,De,"color",se,le,ue,_e,Ee,gt,G,Ze)}{const kt=new yn([k.ONE,k.ONE,k.ONE,De?k.ZERO:k.ONE],i.ao.transparent,[!1,!1,!1,!0],De?k.FUNC_ADD:k.MAX);ud(Ie,v,l,f,_,ot,rn.disabled,kt,Xr.disabled,De,"clear",se,le,ue,_e,Ee,gt,G,Ze,ut)}};if(Ne||je){let De;if(v.prepareDrawTile(),L){const Ze=L.drapeBufferSize[0],ut=L.drapeBufferSize[1];De=L.framebufferCopyTexture,De&&(!De||De.size[0]===Ze&&De.size[1]===ut)||(De&&De.destroy(),De=L.framebufferCopyTexture=new i.T(j,new i.q({width:Ze,height:ut}),k.RGBA8)),De.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,Ze,ut)}Ne&&Ue(!0,!1,De),je&&Ue(!1,!0,De)}}else Ne&&Ge(!0),je&&Ge(!1),(Ne||je)&&v.resetStencilClippingMasks()}}},building:function(v,l,f,_){v.currentLayer<v.firstLightBeamLayer&&(v.firstLightBeamLayer=v.currentLayer);const E=f.paint.get("building-ambient-occlusion-ground-intensity"),j=f.paint.get("building-ambient-occlusion-ground-radius"),k=f.paint.get("building-ambient-occlusion-ground-attenuation"),L=f.paint.get("building-opacity");if(L<=0)return;let z=E>0&&j>0,G=!0;const Z=f.paint.get("building-vertical-scale");if(Z<=0)return;(!v.shadowRenderer||Z<1)&&(G=!1);const Q=v.conflationActive&&v.style.isLayerClipped(f,l.getSource()),X=v.style.order.indexOf(f.fqid);if(function(se,le,ue,_e,ye,Ee){for(const Ne of Ee){const je=le.getTile(Ne).getBucket(ue);je&&(ye&&je.updateReplacement(Ne,se.replacementSource,_e),je.uploadUpdatedIndexBuffer(se.context))}}(v,l,f,X,Q,_),function(se,le,ue,_e){for(const ye of _e){const Ee=le.getTile(ye).getBucket(ue);Ee&&Ee.needsEvaluation()&&Ee.uploadUpdatedColorBuffer(se.context)}}(v,l,f,_),f.resetLayerRenderingStats(v),v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!0),v.renderPass==="shadow"&&v.shadowRenderer){const se=v.shadowRenderer,le=[],ue=se.getShadowPassDepthMode();G_({painter:v,source:l,layer:f,coords:_,defines:le,blendMode:se.getShadowPassColorMode(),depthMode:ue,opacity:L,verticalScale:Z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(v.renderPass==="translucent"){let se=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];G&&(se=se.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),v.shadowRenderer&&v.shadowRenderer.useNormalOffset&&(se=se.concat("NORMAL_OFFSET"));const le=f.paint.get("building-facade-emissive-chance"),ue=f.paint.get("building-ambient-occlusion-intensity"),_e=f.paint.get("building-flood-light-intensity"),ye=f.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Ee=f.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ye?null:f.lut).toArray01().slice(0,3),Ne=f.paint.get("building-flood-light-ground-attenuation"),je=_e>0,qe=new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D);L<1&&G_({painter:v,source:l,layer:f,coords:_,defines:se,blendMode:yn.disabled,depthMode:qe,opacity:L,verticalScale:Z,facadeEmissiveChance:le,facadeAOIntensity:ue,floodLightIntensity:_e,floodLightColor:Ee,depthOnly:!0});const Ie=v.colorModeForRenderPass();G_({painter:v,source:l,layer:f,coords:_,defines:se,blendMode:Ie,depthMode:qe,opacity:L,verticalScale:Z,facadeEmissiveChance:le,facadeAOIntensity:ue,floodLightIntensity:_e,floodLightColor:Ee}),z&&W_(v,l,f,_,!0,L,E,j,_e,Ee,k,Q),je&&W_(v,l,f,_,!1,L,E,j,_e,Ee,Ne,Q)}else if(v.renderPass==="light-beam"){const se=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],le=new Er(v.context.gl.LEQUAL,Er.ReadOnly,v.depthRangeFor3D);G_({painter:v,source:l,layer:f,coords:_,defines:se,blendMode:yn.alphaBlended,depthMode:le,opacity:L,verticalScale:Z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!1),v.resetStencilClippingMasks()},hillshade:function(v,l,f,_){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent"||v.style.disableElevatedTerrain)return;const E=v.context,j=v.terrain&&v.terrain.renderingToTexture,[k,L]=v.renderPass!=="translucent"||j?[{},_]:v.stencilConfigForOverlap(_);for(const z of L){const G=l.getTile(z);if(G.needsHillshadePrepare&&v.renderPass==="offscreen")tR(v,G,f);else if(v.renderPass==="translucent"){const Z=v.depthModeForSublayer(0,Er.ReadOnly),Q=f.paint.get("hillshade-emissive-strength"),X=v.colorModeForDrapableLayerRenderPass(Q),se=j&&v.terrain?v.terrain.stencilModeForRTTOverlap(z):k[z.overscaledZ];eR(v,z,G,f,Z,se,X)}}E.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,l,f,_,E,j){if(v.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const k=v.transform.projection.name==="globe",L=f.paint.get("raster-elevation")!==0,z=L&&k;if(v.renderElevatedRasterBackface&&!z)return;const G=v.context,Z=G.gl,Q=l.getSource(),X=function(Ie,Ge,Ue,De){const Ze=Ge.paint.get("raster-color"),ut=Ie.type==="raster-array",ot=[],St=Ge.paint.get("raster-resampling"),gt=Ge.paint.get("raster-color-mix");let kt=Ge.paint.get("raster-color-range");const Qt=[gt[0],gt[1],gt[2],0],mt=gt[3];let nt=St==="nearest"?De.NEAREST:De.LINEAR;if(ut&&(ot.push("RASTER_ARRAY"),Ze||ot.push("RASTER_COLOR"),St==="linear"&&ot.push("RASTER_ARRAY_LINEAR"),nt=De.NEAREST,!kt&&Ie.rasterLayers)){const Nt=Ie.rasterLayers.find(({id:yt})=>yt===Ge.sourceLayer);Nt&&Nt.fields&&Nt.fields.range&&(kt=Nt.fields.range)}if(kt=kt||[0,1],Ze){ot.push("RASTER_COLOR"),Ue.activeTexture.set(De.TEXTURE2),Ge.updateColorRamp(kt);let Nt=Ge.colorRampTexture;Nt||(Nt=Ge.colorRampTexture=new i.T(Ue,Ge.colorRamp,De.RGBA8)),Nt.bind(De.LINEAR,De.CLAMP_TO_EDGE)}return{mix:Qt,range:kt,offset:mt,defines:ot,resampling:nt}}(Q,f,G,Z);if(Q instanceof i.aT&&!_.length&&!k)return;const se=f.paint.get("raster-emissive-strength"),le=v.colorModeForDrapableLayerRenderPass(se),ue=v.terrain&&v.terrain.renderingToTexture,_e=!v.options.moving,ye=f.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR;if(Q instanceof i.aT&&!_.length&&(Q.onNorthPole||Q.onSouthPole)){const Ie=L?v.stencilModeFor3D():rn.disabled;return void g1(!!Q.onNorthPole,null,v,l,f,se,X,Xr.disabled,Ie)}if(!_.length)return;const[Ee,Ne]=Q instanceof i.aT||ue?[{},_]:v.stencilConfigForOverlap(_),je=Ne[Ne.length-1].overscaledZ;z&&X.defines.push("PROJECTION_GLOBE_VIEW"),L&&X.defines.push("RENDER_CUTOFF");const qe=(Ie,Ge,Ue)=>{for(const De of Ie){const Ze=De.toUnwrapped(),ut=l.getTile(De);if(ue&&(!ut||!ut.hasData()))continue;G.activeTexture.set(Z.TEXTURE0);const ot=mR(ut,Q,f,X);if(!ot||!ot.texture)continue;const{texture:St,mix:gt,offset:kt,tileSize:Qt,buffer:mt}=ot;let nt,Nt;ue?(nt=Er.disabled,Nt=De.projMatrix):L?(nt=new Er(Z.LEQUAL,Er.ReadWrite,v.depthRangeFor3D),Nt=k?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(Ze,_e)):(nt=v.depthModeForSublayer(De.overscaledZ-je,f.paint.get("raster-opacity")===1?Er.ReadWrite:Er.ReadOnly,Z.LESS),Nt=v.transform.calculateProjMatrix(Ze,_e));const yt=v.terrain&&ue?v.terrain.stencilModeForRTTOverlap(De):Ee[De.overscaledZ],$t=j?0:f.paint.get("raster-fade-duration");ut.registerFadeDuration($t);const nr=l.findLoadedParent(De,0),xr=O_(ut,nr,l,v.transform,$t);let Xt,tr;!xr.isFading&&ut.refreshedUponExpiration&&(ut.refreshedUponExpiration=!1),v.terrain&&v.terrain.prepareDrawTile(),G.activeTexture.set(Z.TEXTURE0),St.bind(ye,Z.CLAMP_TO_EDGE),G.activeTexture.set(Z.TEXTURE1),nr?(nr.texture&&nr.texture.bind(ye,Z.CLAMP_TO_EDGE),Xt=Math.pow(2,nr.tileID.overscaledZ-ut.tileID.overscaledZ),tr=[ut.tileID.canonical.x*Xt%1,ut.tileID.canonical.y*Xt%1]):St.bind(ye,Z.CLAMP_TO_EDGE),"useMipmap"in St&&G.extTextureFilterAnisotropic&&v.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const wr=v.transform;let pr;const dr=L?CA(wr):[0,0,0,0];let mr,$r,jn,Fn,Ei,Yr=0;if(z&&Q instanceof i.aT&&Q.coordinates.length>3)mr=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0)))),$r=Float32Array.from(wr.globeMatrix),jn=Float32Array.from(i.dE(wr)),Fn=[i.aF(wr.center.lng),i.aJ(wr.center.lat)],pr=Q.elevatedGlobePerspectiveTransform,Ei=Q.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const zn=i.dF(De.canonical);Yr=i.dG(zn.getCenter().lat),mr=Float32Array.from(i.bj(i.dI(De.canonical))),$r=Float32Array.from(wr.globeMatrix),jn=Float32Array.from(i.dE(wr)),Fn=[i.aF(wr.center.lng),i.aJ(wr.center.lat)],pr=[0,0],Ei=Float32Array.from(i.dH(De.canonical,zn,Yr,wr.worldSize/wr._pixelsPerMercatorPixel))}else pr=Q instanceof i.aT?Q.perspectiveTransform:[0,0],mr=new Float32Array(16),$r=new Float32Array(9),jn=new Float32Array(16),Fn=[0,0],Ei=new Float32Array(9);const Dn=uy(Nt,mr,$r,jn,Ei,tr||[0,0],i.aj(v.transform.zoom),Fn,dr,Xt||1,xr,f,pr,L?f.paint.get("raster-elevation"):0,2,gt,kt,X.range,Qt,mt,se),dn=v.isTileAffectedByFog(De),yi=v.getOrCreateProgram("raster",{defines:X.defines,overrideFog:dn});if(v.uploadCommonUniforms(G,yi,Ze),Q instanceof i.aT){const zn=Q.elevatedGlobeVertexBuffer,Di=Q.elevatedGlobeIndexBuffer;if(ue||!k)Q.boundsBuffer&&Q.boundsSegments&&yi.draw(v,Z.TRIANGLES,nt,rn.disabled,le,Xr.disabled,Dn,f.id,Q.boundsBuffer,v.quadTriangleIndexBuffer,Q.boundsSegments);else if(zn&&Di){const Xn=wr.zoom<=i.cZ?Q.elevatedGlobeSegments:Q.getSegmentsForLongitude(wr.center.lng);Xn&&yi.draw(v,Z.TRIANGLES,nt,rn.disabled,le,Ge,Dn,f.id,zn,Di,Xn)}}else if(z){nt=new Er(Z.LEQUAL,Er.ReadOnly,v.depthRangeFor3D);const zn=v.globeSharedBuffers;if(zn){const[Di,Xn,fn]=zn.getGridBuffers(Yr,!1);yi.draw(v,Z.TRIANGLES,nt,Ue||yt,v.colorModeForRenderPass(),Ge,Dn,f.id,Di,Xn,fn)}}else{const{tileBoundsBuffer:zn,tileBoundsIndexBuffer:Di,tileBoundsSegments:Xn}=v.getTileBoundsBuffers(ut);yi.draw(v,Z.TRIANGLES,nt,yt,le,Xr.disabled,Dn,f.id,zn,Di,Xn)}}if(!(Q instanceof i.aT)&&z)for(const De of Ie){const Ze=De.canonical.y===(1<<De.canonical.z)-1;De.canonical.y===0&&g1(!0,De,v,l,f,se,X,Ge,Ue||rn.disabled),Ze&&g1(!1,De,v,l,f,se,X,Ge===Xr.frontCW?Xr.backCW:Xr.frontCW,Ue||rn.disabled)}};z?qe(Ne,v.renderElevatedRasterBackface?Xr.backCW:Xr.frontCW,v.stencilModeFor3D()):qe(Ne,Xr.disabled,void 0),v.resetStencilClippingMasks()},"raster-particle":function(v,l,f,_,E,j){v.renderPass==="offscreen"&&function(k,L,z,G){if(!G.length)return;const Z=k.context,Q=Z.gl,X=L.getSource();if(!(X instanceof xa))return;const se=Math.ceil(Math.sqrt(z.paint.get("raster-particle-count")));let le=z.particlePositionRGBAImage;if(!le||le.width!==se){const Ne=function(je){const qe=je*je,Ie=new Uint8Array(4*qe),Ge=function(De){return De|=0,De=Math.imul(2747636419^De,2654435769),De=Math.imul(De^De>>>16,2654435769),((De=Math.imul(De^De>>>16,2654435769))>>>0)/4294967296},Ue=1/1.1;for(let De=0;De<qe;De++){const Ze=Ue*(Ge(2*De+0)+yf),ut=Ue*(Ge(2*De+1)+yf),ot=255*Ze%1,St=255*ut%1,gt=ot,kt=ut-St/255,Qt=St;Ie[4*De+0]=255*(Ze-ot/255),Ie[4*De+1]=255*gt,Ie[4*De+2]=255*kt,Ie[4*De+3]=255*Qt}return Ie}(se);le=z.particlePositionRGBAImage=new i.q({width:se,height:se},Ne)}let ue=z.particleFramebuffer;ue?ue.width!==se&&(ue.destroy(),ue=z.particleFramebuffer=Z.createFramebuffer(se,se,!0,null)):ue=z.particleFramebuffer=Z.createFramebuffer(se,se,!0,null);const _e=[];for(const Ne of G){const je=L.getTile(Ne);if(!(je instanceof Yd))continue;const qe=y1(je,X,z);if(!qe)continue;const Ie=[je.tileSize,je.tileSize];let Ge=z.tileFramebuffer;Ge||(Ge=z.tileFramebuffer=Z.createFramebuffer(Ie[0],Ie[1],!0,null));let Ue=je.rasterParticleState;Ue||(Ue=je.rasterParticleState=new Nl(Z,Ne,Ie,le));const De=Ue.update(z.lastInvalidatedAt);Ue.particleTextureDimension!==se&&Ue.updateParticleTexture(Ne,le);const Ze=Ue.targetColorTexture;Ue.targetColorTexture=Ue.backgroundColorTexture,Ue.backgroundColorTexture=Ze;const ut=Ue.particleTexture0;Ue.particleTexture0=Ue.particleTexture1,Ue.particleTexture1=ut,_e.push([Ne,qe,Ue,De])}if(_e.length===0)return;const ye=i.o.now(),Ee=z.previousDrawTimestamp?.001*(ye-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=ye,z.hasColorMap()){Z.activeTexture.set(Q.TEXTURE0+2);let Ne=z.colorRampTexture;Ne||(Ne=z.colorRampTexture=new i.T(Z,z.colorRamp,Q.RGBA8)),Ne.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}Z.bindFramebuffer.set(z.tileFramebuffer.framebuffer),function(Ne,je,qe){const Ie=Ne.context,Ge=Ie.gl,Ue=je.tileFramebuffer;Ie.activeTexture.set(Ge.TEXTURE0);const De={u_texture:0,u_opacity:1.05*(ut=je.paint.get("raster-particle-fade-opacity-factor"))/(ut+.05)},Ze=Ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ut;for(const ot of qe){const[,,St,gt]=ot;Ue.colorAttachment.set(St.targetColorTexture.texture),Ie.viewport.set([0,0,Ue.width,Ue.height]),Ie.clear({color:i.ao.transparent}),gt&&(St.backgroundColorTexture.bind(Ge.NEAREST,Ge.CLAMP_TO_EDGE),Ze.draw(Ne,Ge.TRIANGLES,Er.disabled,rn.disabled,yn.alphaBlended,Xr.disabled,De,je.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments))}}(k,z,_e),function(Ne,je,qe,Ie){const Ge=Ne.context,Ue=Ge.gl,De=qe.tileFramebuffer,Ze=Ne.transform.projection.name==="globe",ut=qe.paint.get("raster-particle-max-speed");for(const ot of Ie){const[St,gt,kt]=ot;Ge.activeTexture.set(Ue.TEXTURE0+0),gt.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),De.colorAttachment.set(kt.targetColorTexture.texture);const Qt=Ne.getOrCreateProgram("rasterParticleDraw",{defines:gt.defines,overrideFog:!1});Ge.activeTexture.set(Ue.TEXTURE0+1);const mt=gt.scalarData?[]:[0,1,2,3].map(yt=>i.e8[yt](St));mt.push(St);const nt=St.canonical.x,Nt=St.canonical.y;for(const yt of mt){const $t=je.getTile(Ze?yt.wrapped():yt);if(!$t)continue;const nr=$t.rasterParticleState;if(!nr)continue;const xr=yt.canonical.x+(1<<yt.canonical.z)*(yt.wrap-St.wrap),Xt=yt.canonical.y;nr.particleTexture0.bind(Ue.NEAREST,Ue.CLAMP_TO_EDGE);const tr=l1(1,nr.particleTexture0.size[0],[xr-nt,Xt-Nt],0,gt.texture.size,2,ut,gt.textureOffset,gt.scale,gt.offset);Qt.draw(Ne,Ue.POINTS,Er.disabled,rn.disabled,yn.alphaBlended,Xr.disabled,tr,qe.id,nr.particleIndexBuffer,void 0,nr.particleSegment)}}}(k,L,z,_e),Z.bindFramebuffer.set(z.particleFramebuffer.framebuffer),function(Ne,je,qe,Ie){const Ge=Ne.context,Ue=Ge.gl,De=je.paint.get("raster-particle-max-speed"),Ze=Ie*je.paint.get("raster-particle-speed-factor")*.15,ut=function(St){return Math.pow(St,6)}(.01+1*je.paint.get("raster-particle-reset-rate-factor")),ot=je.particleFramebuffer;Ge.viewport.set([0,0,ot.width,ot.height]);for(const St of qe){const[,gt,kt]=St;Ge.activeTexture.set(Ue.TEXTURE0+0),gt.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),Ge.activeTexture.set(Ue.TEXTURE0+1);const Qt=kt.particleTexture0;Qt.bind(Ue.NEAREST,Ue.CLAMP_TO_EDGE);const mt=L_(1,Qt.size[0],0,gt.texture.size,De,Ze,ut,gt.textureOffset,gt.scale,gt.offset);ot.colorAttachment.set(kt.particleTexture1.texture),Ge.clear({color:i.ao.transparent}),Ne.getOrCreateProgram("rasterParticleUpdate",{defines:gt.defines}).draw(Ne,Ue.TRIANGLES,Er.disabled,rn.disabled,yn.unblended,Xr.disabled,mt,je.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments)}}(k,z,_e,Ee)}(v,l,f,_),v.renderPass==="translucent"&&(function(k,L,z,G,Z){const Q=k.context,X=Q.gl,se=L.getSource().tileSize,le=5*(1-i.ah(i.cK,i.cK+1,k.transform.zoom))*se+z.paint.get("raster-particle-elevation"),ue=!k.options.moving,_e=k.transform.projection.name==="globe";if(!G.length)return;const[ye,Ee]=k.stencilConfigForOverlap(G),Ne=[];_e&&Ne.push("PROJECTION_GLOBE_VIEW");const je=k.stencilModeFor3D();for(const qe of Ee){const Ie=qe.toUnwrapped(),Ge=L.getTile(qe);if(!Ge.rasterParticleState)continue;const Ue=Ge.rasterParticleState,De=100;Ge.registerFadeDuration(De);const Ze=L.findLoadedParent(qe,0),ut=O_(Ge,Ze,L,k.transform,De);let ot,St;k.terrain&&k.terrain.prepareDrawTile(),Q.activeTexture.set(X.TEXTURE0),Ue.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Q.activeTexture.set(X.TEXTURE1),Ze&&Ze.rasterParticleState?(Ze.rasterParticleState.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ot=Math.pow(2,Ze.tileID.overscaledZ-Ge.tileID.overscaledZ),St=[Ge.tileID.canonical.x*ot%1,Ge.tileID.canonical.y*ot%1]):Ue.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const gt=_e?Float32Array.from(k.transform.expandedFarZProjMatrix):k.transform.calculateProjMatrix(Ie,ue),kt=k.transform,Qt=al(kt),mt=i.dF(qe.canonical),nt=i.dG(mt.getCenter().lat);let Nt,yt,$t,nr,xr;_e?(Nt=Float32Array.from(i.bj(i.dI(qe.canonical))),yt=Float32Array.from(kt.globeMatrix),$t=Float32Array.from(i.dE(kt)),nr=[i.aF(kt.center.lng),i.aJ(kt.center.lat)],xr=Float32Array.from(i.dH(qe.canonical,mt,nt,kt.worldSize/kt._pixelsPerMercatorPixel))):(Nt=new Float32Array(16),yt=new Float32Array(9),$t=new Float32Array(16),nr=[0,0],xr=new Float32Array(9));const Xt=th(gt,Nt,yt,$t,xr,St||[0,0],i.aj(k.transform.zoom),nr,Qt,ot||1,ut,le),tr=k.isTileAffectedByFog(qe),wr=k.getOrCreateProgram("rasterParticle",{defines:Ne,overrideFog:tr});if(k.uploadCommonUniforms(Q,wr,Ie),_e){const pr=new Er(X.LEQUAL,Er.ReadOnly,k.depthRangeFor3D),dr=0,mr=k.globeSharedBuffers;if(mr){const[$r,jn,Fn]=mr.getGridBuffers(nt,dr!==0);wr.draw(k,X.TRIANGLES,pr,je,yn.alphaBlended,k.renderElevatedRasterBackface?Xr.frontCCW:Xr.backCCW,Xt,z.id,$r,jn,Fn)}}else{const pr=k.depthModeForSublayer(0,Er.ReadOnly),dr=ye[qe.overscaledZ],{tileBoundsBuffer:mr,tileBoundsIndexBuffer:$r,tileBoundsSegments:jn}=k.getTileBoundsBuffers(Ge);wr.draw(k,X.TRIANGLES,pr,dr,yn.alphaBlended,Xr.disabled,Xt,z.id,mr,$r,jn)}}k.resetStencilClippingMasks()}(v,l,f,_),v.style.map.triggerRepaint())},background:function(v,l,f,_){const E=f.paint.get("background-color"),j=f.paint.get("background-color-use-theme").constantOr("default")==="none",k=f.paint.get("background-opacity"),L=f.paint.get("background-emissive-strength"),z=f.paint.get("background-pitch-alignment")==="viewport";if(k===0)return;const G=v.context,Z=G.gl,Q=v.transform,X=Q.tileSize,se=f.paint.get("background-pattern");let le;if(se!==void 0&&(se===null||(le=v.imageManager.getPattern(i.I.from(se.toString()),f.scope,v.style.getLut(f.scope)),!le)))return;const ue=!se&&E.a===1&&k===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==ue)return;const _e=rn.disabled,ye=v.depthModeForSublayer(0,ue==="opaque"?Er.ReadWrite:Er.ReadOnly),Ee=v.colorModeForDrapableLayerRenderPass(L),Ne=se?"backgroundPattern":"background";let je,qe=_;if(qe||(je=v.getBackgroundTiles(),qe=Object.values(je).map(Ie=>Ie.tileID)),se&&(G.activeTexture.set(Z.TEXTURE0),v.imageManager.bind(v.context,f.scope)),z){const Ie=v.getOrCreateProgram(Ne,{overrideFog:!1,overrideRtt:!0}),Ge=new Float32Array(i.bz([])),Ue=new i.aP(0,0,0,0,0),De=se?z_(Ge,L,k,v,0,f.scope,le,z,{tileID:Ue,tileSize:X}):F_(Ge,L,k,E.toPremultipliedRenderColor(j?null:f.lut));Ie.draw(v,Z.TRIANGLES,ye,_e,Ee,Xr.disabled,De,f.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments)}else for(const Ie of qe){const Ge=v.isTileAffectedByFog(Ie),Ue=v.getOrCreateProgram(Ne,{overrideFog:Ge}),De=Ie.toUnwrapped(),Ze=_?Ie.projMatrix:v.transform.calculateProjMatrix(De);v.prepareDrawTile();const ut=l?l.getTile(Ie):je?je[Ie.key]:new Au(Ie,X,Q.zoom,v),ot=se?z_(Ze,L,k,v,0,f.scope,le,z,{tileID:Ie,tileSize:X}):F_(Ze,L,k,E.toPremultipliedRenderColor(j?null:f.lut));v.uploadCommonUniforms(G,Ue,De);const{tileBoundsBuffer:St,tileBoundsIndexBuffer:gt,tileBoundsSegments:kt}=v.getTileBoundsBuffers(ut);Ue.draw(v,Z.TRIANGLES,ye,_e,Ee,Xr.disabled,ot,f.id,St,gt,kt)}},sky:function(v,l,f){const _=v._atmosphere?i.aj(v.transform.zoom):1,E=f.paint.get("sky-opacity")*_;if(E===0)return;const j=v.context,k=f.paint.get("sky-type"),L=new Er(j.gl.LEQUAL,Er.ReadOnly,[0,1]),z=v.frameCounter/1e3%1;k==="atmosphere"?v.renderPass==="offscreen"?f.needsSkyboxCapture(v)&&(function(G,Z,Q,X){const se=G.context,le=se.gl;let ue=Z.skyboxFbo;if(!ue){ue=Z.skyboxFbo=se.createFramebuffer(32,32,!0,null),Z.skyboxGeometry=new w1(se),Z.skyboxTexture=se.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,Z.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Ne=0;Ne<6;++Ne)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}se.bindFramebuffer.set(ue.framebuffer),se.viewport.set([0,0,32,32]);const _e=Z.getCenter(G,!0),ye=G.getOrCreateProgram("skyboxCapture"),Ee=new Float64Array(16);i.bz(Ee),i.em(Ee,Ee,.5*-Math.PI),Pc(G,Z,ye,Ee,_e,0),i.bz(Ee),i.em(Ee,Ee,.5*Math.PI),Pc(G,Z,ye,Ee,_e,1),i.bz(Ee),i.cT(Ee,Ee,.5*-Math.PI),Pc(G,Z,ye,Ee,_e,2),i.bz(Ee),i.cT(Ee,Ee,.5*Math.PI),Pc(G,Z,ye,Ee,_e,3),i.bz(Ee),Pc(G,Z,ye,Ee,_e,4),i.bz(Ee),i.em(Ee,Ee,Math.PI),Pc(G,Z,ye,Ee,_e,5),se.viewport.set([0,0,G.width,G.height])}(v,f),f.markSkyboxValid(v)):v.renderPass==="sky"&&function(G,Z,Q,X,se){const le=G.context,ue=le.gl,_e=G.transform,ye=G.getOrCreateProgram("skybox");le.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,Z.skyboxTexture);const Ee=((Ne,je,qe,Ie,Ge)=>({u_matrix:Ne,u_sun_direction:je,u_cubemap:0,u_opacity:Ie,u_temporal_offset:Ge}))(_e.skyboxMatrix,Z.getCenter(G,!1),0,X,se);G.uploadCommonUniforms(le,ye),ye.draw(G,ue.TRIANGLES,Q,rn.disabled,G.colorModeForRenderPass(),Xr.backCW,Ee,"skybox",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(v,f,L,E,z):k==="gradient"&&v.renderPass==="sky"&&function(G,Z,Q,X,se){const le=G.context,ue=le.gl,_e=G.transform,ye=G.getOrCreateProgram("skyboxGradient");Z.skyboxGeometry||(Z.skyboxGeometry=new w1(le)),le.activeTexture.set(ue.TEXTURE0);let Ee=Z.colorRampTexture;Ee||(Ee=Z.colorRampTexture=new i.T(le,Z.colorRamp,ue.RGBA8)),Ee.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ne=((je,qe,Ie,Ge,Ue)=>({u_matrix:je,u_color_ramp:0,u_center_direction:qe,u_radius:i.an(Ie),u_opacity:Ge,u_temporal_offset:Ue}))(_e.skyboxMatrix,Z.getCenter(G,!1),Z.paint.get("sky-gradient-radius"),X,se);G.uploadCommonUniforms(le,ye),ye.draw(G,ue.TRIANGLES,Q,rn.disabled,G.colorModeForRenderPass(),Xr.backCW,Ne,"skyboxGradient",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(v,f,L,E,z)},custom:function(v,l,f,_){const E=v.context,j=f.implementation;if(!v.transform.projection.unsupportedLayers||!v.transform.projection.unsupportedLayers.includes("custom")||v.terrain&&(v.terrain.renderingToTexture||v.renderPass==="offscreen")&&f.isDraped(l)){if(v.renderPass==="offscreen"){const k=j.prerender;if(k){if(v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),v.transform.projection.name==="globe"){const L=v.transform.pointMerc;k.call(j,E.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),i.aj(v.transform.zoom),[L.x,L.y],v.transform.pixelsPerMeterRatio)}else k.call(j,E.gl,v.transform.customLayerMatrix());E.setDirty(),v.setBaseState()}}else if(v.renderPass==="translucent"){if(v.terrain&&v.terrain.renderingToTexture){const L=j.renderToTile;if(L){const z=_[0].canonical,G={x:z.x+_[0].wrap*(j.wrapTileId?0:1<<z.z),y:z.y,z:z.z};E.setDepthMode(Er.disabled),E.setStencilMode(rn.disabled),E.setColorMode(v.colorModeForRenderPass()),v.setCustomLayerDefaults(),L.call(j,E.gl,G),E.setDirty(),v.setBaseState()}return}v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),E.setStencilMode(rn.disabled);const k=j.renderingMode==="3d"?new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Er.ReadOnly);if(E.setDepthMode(k),v.transform.projection.name==="globe"){const L=v.transform.pointMerc;j.render(E.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),i.aj(v.transform.zoom),[L.x,L.y],v.transform.pixelsPerMeterRatio)}else j.render(E.gl,v.transform.customLayerMatrix());E.setDirty(),v.setBaseState(),E.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(v,l,f,_){if(v.renderPass==="opaque")return;const E=f.paint.get("model-opacity").constantOr(1),j=f.paint.get("model-elevation-reference"),k=j==="ground",L=j==="ground";if(E===0)return;const z=f.paint.get("model-cast-shadows");if(v.renderPass==="shadow"&&(!z||v.terrain&&E<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const G=v.shadowRenderer,Z=f.paint.get("model-receive-shadows");G&&(G.useNormalOffset=!0,Z||(G.enabled=!1));const Q=()=>{G&&(G.useNormalOffset=!0,Z||(G.enabled=!0))},X=l.getSource();if(v.renderPass==="light-beam"&&X.type!=="batched-model")return;if(X.type==="vector"||X.type==="geojson")return function(je,qe,Ie,Ge,Ue){const De=je.transform,Ze=De.projection.name==="globe",ut=De.getFreeCameraOptions().position;if(!je.modelManager)return;const ot=je.modelManager;Ie.modelManager=ot;const St=je.shadowRenderer;if(!Ie._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const gt=Ie._unevaluatedLayout._values["model-id"],kt=Object.assign({},Ie.layout.get("model-id").parameters),Qt=je.style.order.indexOf(Ie.fqid);for(const mt of Ge){const nt=qe.getTile(mt).getBucket(Ie);if(!nt||nt.projection.name!==De.projection.name)continue;const Nt=nt.getModelUris();if(Nt&&!nt.modelsRequested&&(ot.addModelsFromBucket(Nt,Ue),nt.modelsRequested=!0),Ze)kt.zoom=mt.overscaledZ;else{const pr=E1(mt,De);kt.zoom=pr}const yt=gt.possiblyEvaluate(kt);if(NA(je,nt,mt),Wl.shadowUniformsInitialized=!1,Wl.useSingleShadowCascade=!!St&&St.getMaxCascadeForTile(mt.toUnwrapped())===0,je.renderPass==="shadow"&&St){if(je.currentShadowCascade===1&&nt.isInsideFirstShadowMapFrustum)continue;const pr=De.calculatePosMatrix(mt.toUnwrapped(),De.worldSize);if(Wl.tileMatrix.set(pr),Wl.shadowTileMatrix=Float32Array.from(St.calculateShadowPassMatrixFromMatrix(pr)),Wl.aabb.min=[0,0,0],Wl.aabb.max[0]=Wl.aabb.max[1]=i.al,Wl.aabb.max[2]=0,X_(nt,Wl,je,Ie.scope))continue}const $t=1<<mt.canonical.z,nr=[((ut.x-mt.wrap)*$t-mt.canonical.x)*i.al,(ut.y*$t-mt.canonical.y)*i.al,ut.z*$t*i.al];je.conflationActive&&Object.keys(nt.instancesPerModel).length>0&&je.style.isLayerClipped(Ie,qe.getSource())&&nt.updateReplacement(mt,je.replacementSource,Qt,Ue)&&(nt.uploaded=!1,nt.upload(je.context));let xr=0;const Xt=new Array,tr=new Array,wr=new Array;for(let pr in nt.instancesPerModel){const dr=nt.instancesPerModel[pr];dr.features.length>0&&!Ze&&(pr=yt.evaluate(dr.features[0].feature,{}));const mr=ot.getModel(pr,Ue);if(mr||ot.hasURLBeenRequested(pr)||nt.modelUris.includes(pr)||(nt.modelUris.push(pr),nt.modelsRequested=!1),mr&&mr.uploaded)if(Ze){const $r=i.c4([],[ut.x,ut.y,ut.z],je.transform.worldSize);i.ev($r,$r);for(let jn=0;jn<dr.instancedDataArray.length;++jn){const Fn=[0,0,0],Ei=[1,1,1],Yr=i.ew(),Dn=dr.tileCoordinatesForInstance(jn),dn=dr.transformForInstance(jn);i.ex(Ei,dn),i.ey(Yr,dn),i.ez(Fn,Yr);const yi=dr.translationForInstance(jn),zn=new i.aS(0,0);i.eA(nt.canonical,zn,Dn.x,Dn.y);const Di=i.bB();i.eB(Di,mr,je.transform,zn,Fn,Ei,yi,!0,!1,!1);const Xn=dr.colorForInstance(jn),fn=i.bz([]),ai=i.ee(zn.lat,je.transform.zoom),_n=i.bp([],[1,1,1/ai]);i.bq(fn,fn,$r),wr.push({zScaleMatrix:_n,negCameraPosMatrix:fn});for(const Wi of mr.nodes)Z_(je,Wi,Di,je.transform.expandedFarZProjMatrix,xr,Xt,tr,mr.materialOverrides,Xn);++xr}}else for(const $r of mr.nodes)T1(je,Ie,$r,dr,nr,mt,Wl)}if(Ze)if(je.renderPass==="shadow"){for(const pr of tr)Gp(pr.mesh,pr.nodeModelMatrix,je,Ie);for(const pr of Xt)Gp(pr.mesh,pr.nodeModelMatrix,je,Ie)}else kA(je,Ie,1,Xt,tr,wr)}}(v,l,f,_,K_(X,f,v.style._importedAsBasemap)),void Q();if(!X.loaded())return;if(X.type==="batched-model")return function(je,qe,Ie,Ge){Ie.resetLayerRenderingStats(je);const Ue=je.context,De=je.transform,Ze=je.style.fog,ut=je.shadowRenderer;if(De.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${De.projection.name} projection is not yet implemented`);const ot=je.transform.getFreeCameraOptions().position,St=i.c4([],[ot.x,ot.y,ot.z],je.transform.worldSize),gt=i.ev([],St),kt=i.bz([]),Qt=i.ee(De.center.lat,De.zoom),mt=i.bp([],[1,1,1/Qt]);i.bq(kt,kt,gt);const nt=Ie.paint.get("model-opacity").constantOr(1),Nt=new Er(Ue.gl.LEQUAL,Er.ReadWrite,je.depthRangeFor3D),yt=new Er(Ue.gl.LEQUAL,Er.ReadOnly,je.depthRangeFor3D),$t=new i.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nr=je.renderPass==="shadow",xr=nr&&ut?ut.getCurrentCascadeFrustum():De.getFrustum(De.scaleZoom(De.worldSize)),Xt=Ie.paint.get("model-front-cutoff"),tr=Xt[2]<1,wr=ld(je,Ie.paint.get("model-cutoff-fade-range")),pr=Ie.getLayerRenderingStats();(function(dr,mr,$r,jn){const Fn=dr.terrain?dr.terrain.exaggeration():0,Ei=dr.transform.zoom;for(const Yr of jn){const Dn=mr.getTile(Yr).getBucket($r);Dn&&(Dn.setFilter($r.filter),dr.conflationActive&&Dn.updateReplacement(Yr,dr.replacementSource),Dn.evaluateTransform(dr,$r),dr.terrain&&Fn>0&&Dn.elevationUpdate(dr.terrain,Fn,Yr,$r.source),Dn.needsReEvaluation(dr,Ei,$r)&&Dn.evaluate($r))}})(je,qe,Ie,Ge),function(){let dr,mr,$r;tr?(dr=Ge.length-1,mr=-1,$r=-1):(dr=0,mr=Ge.length,$r=1);const jn=new Float64Array(16),Fn=i.cz(),Ei=new i.P(0,0);for(let Yr=dr;Yr!==mr;Yr+=$r){const Dn=Ge[Yr],dn=qe.getTile(Dn).getBucket(Ie);if(!dn||!dn.uploaded)continue;let yi=!1;ut&&(yi=ut.getMaxCascadeForTile(Dn.toUnwrapped())===0);const zn=De.calculatePosMatrix(Dn.toUnwrapped(),De.worldSize),Di=dn.modelTraits;!nr&&tr&&(i.bk(jn,zn),i.af(Fn,St,jn),Ei.x=Fn[0],Ei.y=Fn[1]);const Xn=[];dn.setFilter(Ie.filter);for(const fn of dn.getNodesInfo()){if(fn.hiddenByReplacement||!fn.node.meshes)continue;const ai=fn.node;let _n=0;je.terrain&&ai.elevation&&(_n=ai.elevation*je.terrain.exaggeration());const Wi=(()=>{const Eo=fn.aabb;return $t.min=[...Eo.min],$t.max=[...Eo.max],$t.min[2]+=_n,$t.max[2]+=_n,i.af($t.min,$t.min,zn),i.af($t.max,$t.max,zn),$t})(),di=fn.evaluatedScale;if(di[0]<=1&&di[1]<=1&&di[2]<=1&&Wi.intersects(xr)===0)continue;if(!nr&&tr){const Eo=.16666666666666666;fn.cameraCollisionOpacity=St[0]>Wi.min[0]&&St[0]<Wi.max[0]&&St[1]>Wi.min[1]&&St[1]<Wi.max[1]&&St[2]*Qt<Wi.max[2]&&ai.footprint&&i.b$(Ei,ai.footprint)?Math.max(fn.cameraCollisionOpacity-Eo,0):Math.min(1,fn.cameraCollisionOpacity+Eo)}const Qr=[...zn],Un=1/i.d6(Dn.canonical),os=ai.anchor?ai.anchor[0]:0,ks=ai.anchor?ai.anchor[1]:0;i.bq(Qr,Qr,[os*(di[0]-1)+fn.evaluatedTranslation[0]*Un,ks*(di[1]-1)+fn.evaluatedTranslation[1]*Un,_n+fn.evaluatedTranslation[2]]),i.cp(di,i.eD)||i.cR(Qr,Qr,di);const hs=i.aB([],Qr,ai.globalMatrix),ws=i.aB([],De.expandedFarZProjMatrix,hs),bl=i.aB([],De.expandedFarZProjMatrix,Qr),ol=i.aC([],[os,ks,_n,1],ws)[2];ai.hidden=!1;let ao=nt;nr||(tr&&(ao*=fn.cameraCollisionOpacity,ao*=xf(Qr,De,fn.aabb,Xt)),ao*=py(wr,ol)),ao!==0?Xn.push({nodeInfo:fn,depth:ol,opacity:ao,wvpForNode:ws,wvpForTile:bl,nodeModelMatrix:hs,tileModelMatrix:Qr}):ai.hidden=!0}nr||Xn.sort((fn,ai)=>!tr||fn.opacity===1&&ai.opacity===1?fn.depth<ai.depth?-1:1:fn.opacity===1?-1:ai.opacity===1?1:fn.depth>ai.depth?-1:1);for(const fn of Xn){const ai=fn.nodeInfo,_n=ai.node;let Wi=i.aB([],mt,fn.tileModelMatrix);i.aB(Wi,kt,Wi);const di=i.bk([],Wi);i.ef(di,di),i.cR(di,di,IA),Wi=i.aB(Wi,Wi,_n.globalMatrix);const Qr=je.renderPass==="light-beam",Un=Ie.paint.get("model-color-use-theme").constantOr("default")==="none",os=Di&i.eH.HasMapboxMeshFeatures,ks=os?0:ai.evaluatedRMEA[0][2];for(let hs=0;hs<_n.meshes.length;++hs){const ws=_n.meshes[hs],bl=hs===_n.lightMeshIndex;let ol=fn.wvpForNode;if(bl){if(!Qr&&!je.terrain&&je.shadowRenderer){je.currentLayer<je.firstLightBeamLayer&&(je.firstLightBeamLayer=je.currentLayer);continue}ol=fn.wvpForTile}else if(Qr)continue;const ao={defines:[]},Eo=[];if(!nr&&ut&&(ut.useNormalOffset=!!ws.normalBuffer),qp(ao.defines,Eo,ws,je,Un?null:Ie.lut),os||ao.defines.push("DIFFUSE_SHADED"),yi&&ao.defines.push("SHADOWS_SINGLE_CASCADE"),pr&&(nr?pr.numRenderedVerticesInShadowPass+=ws.vertexArray.length:pr.numRenderedVerticesInTransparentPass+=ws.vertexArray.length),nr){Gp(ws,fn.nodeModelMatrix,je,Ie);continue}let Zl=null;if(Ze){const Ns=S1(fn.nodeModelMatrix,je.transform);if(Zl=new Float32Array(Ns),De.projection.name!=="globe"){const ki=ws.aabb.min,Ls=ws.aabb.max,[Ia,ys]=Ze.getOpacityForBounds(Ns,ki[0],ki[1],Ls[0],Ls[1]);ao.overrideFog=Ia>=vt||ys>=vt}}const oo=ws.material;let Xl;oo.occlusionTexture&&oo.occlusionTexture.offsetScale&&(Xl=oo.occlusionTexture.offsetScale,ao.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Nc=je.getOrCreateProgram("model",ao);!nr&&ut&&ut.setupShadowsFromMatrix(fn.tileModelMatrix,Nc,ut.useNormalOffset),je.uploadCommonUniforms(Ue,Nc,null,Zl);const Na=oo.pbrMetallicRoughness;Na.metallicFactor=.9,Na.roughnessFactor=.5;const gs=B_(new Float32Array(ol),new Float32Array(Wi),new Float32Array(di),new Float32Array(_n.globalMatrix),je,fn.opacity,Na.baseColorFactor,oo.emissiveFactor,Na.metallicFactor,Na.roughnessFactor,oo,ks,Ie,[0,0,0],Xl);!bl&&(ai.hasTranslucentParts||fn.opacity<1)&&Nc.draw(je,Ue.gl.TRIANGLES,Nt,rn.disabled,yn.disabled,Xr.backCCW,gs,Ie.id,ws.vertexBuffer,ws.indexBuffer,ws.segments,Ie.paint,je.transform.zoom,void 0,Eo),Nc.draw(je,Ue.gl.TRIANGLES,bl?yt:Nt,rn.disabled,bl||fn.opacity<1||ai.hasTranslucentParts?yn.alphaBlended:yn.unblended,Xr.backCCW,gs,Ie.id,ws.vertexBuffer,ws.indexBuffer,ws.segments,Ie.paint,je.transform.zoom,void 0,Eo)}}}}()}(v,l,f,_),void Q();if(X.type!=="model")return;const se=X.getModels(),le=[],ue=v.transform.getFreeCameraOptions().position,_e=i.c4([],[ue.x,ue.y,ue.z],v.transform.worldSize);i.ev(_e,_e);const ye=[],Ee=[];let Ne=0;for(const je of se){const qe=l.getFeatureState("",je.id),Ie={type:"Unknown",id:je.id,properties:je.featureProperties},Ge=f.paint.get("model-rotation").evaluate(Ie,qe),Ue=f.paint.get("model-scale").evaluate(Ie,qe),De=f.paint.get("model-translation").evaluate(Ie,qe);Wp(f,je.id,qe,je.featureProperties,je.nodeOverrideNames,je.nodeOverrides),yR(f,je.id,qe,je.featureProperties,je.materialOverrideNames,je.materialOverrides),je.nodeOverrides.size>0&&je.computeBoundsAndApplyParent(),je.computeModelMatrix(v,Ge,Ue,De,L,k,!1);const Ze=i.bz([]),ut=i.ee(je.position.lat,v.transform.zoom),ot=i.bp([],[1,1,1/ut]);i.bq(Ze,Ze,_e),le.push({zScaleMatrix:ot,negCameraPosMatrix:Ze});for(const St of je.nodes)Z_(v,St,je.matrix,v.transform.expandedFarZProjMatrix,Ne,ye,Ee,je.materialOverrides);Ne++}if(ye.sort((je,qe)=>qe.depth-je.depth),v.renderPass!=="shadow")kA(v,f,E,ye,Ee,le),Q();else{for(const je of Ee)Gp(je.mesh,je.nodeModelMatrix,v,f);for(const je of ye)Gp(je.mesh,je.nodeModelMatrix,v,f);Q()}}},Y_={line:function(v,l,f){if(v.hasElevatedBuckets=!1,v.hasNonElevatedBuckets=!1,v._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||v._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(l){const _=l.getVisibleCoordinates();for(const E of _){const j=l.getTile(E).getBucket(v);if(j&&(j.elevationType!=="none"?v.hasElevatedBuckets=!0:v.hasNonElevatedBuckets=!0,v.hasElevatedBuckets&&v.hasNonElevatedBuckets))break}}}else v.hasNonElevatedBuckets=!0},model:function(v,l,f){const _=l.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson"){const j=K_(_,v,f.style._importedAsBasemap);return void(f.modelManager&&f.modelManager.upload(f,j))}if(_.type==="batched-model"||_.type!=="model")return;const E=_.getModels();for(const j of E)j.upload(f.context)},raster:function(v,l,f){const _=l.getSource();if(!(_ instanceof xa&&_.loaded()))return;const E=v.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!E)return;const j=v.paint.get("raster-array-band")||_.getInitialBand(E);if(j==null)return;const k=l.getIds().map(L=>l.getTileByID(L));for(const L of k)L.updateNeeded(v.id,j)&&_.prepareTile(L,E,v.id,j)},"raster-particle":function(v,l,f){const _=l.getSource();if(!(_ instanceof xa&&_.loaded()))return;const E=v.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!E)return;const j=v.paint.get("raster-particle-array-band")||_.getInitialBand(E);if(j==null)return;const k=l.getIds().map(L=>l.getTileByID(L));for(const L of k)L.updateNeeded(v.id,j)&&_.prepareTile(L,E,v.id,j)}},J_={fill:vf},Kl={fill:function(v,l,f,_){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const E=v.context.gl,j=new Er(E.LEQUAL,Er.ReadOnly,v.depthRangeFor3D),k=new rn({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),L=v.transform.getFreeCameraOptions().position,z=v.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const G of _){const Z=l.getTile(G),Q=Z.getBucket(f);if(!Q)continue;const X=Q.elevatedStructures;if(!X||X.depthSegments.segments[0].primitiveLength===0)continue;const se=TA(G.toUnwrapped(),L),le=v.translatePosMatrix(G.projMatrix,Z,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),ue=R_(le,se,0,1,0);z.draw(v,E.TRIANGLES,j,k,yn.disabled,Xr.disabled,ue,f.id,X.vertexBuffer,X.indexBuffer,X.depthSegments,f.paint,v.transform.zoom)}}};class oh{constructor(l,f,_,E,j,k){this.context=new U_(l,f),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=j,this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const L=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const G of L)this._debugParams.enabledLayers[G]=!0;j.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),j.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),j.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),j.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),j.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),j.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const G of L)j.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],G);this.occlusionParams=new vR(j),this.setup(),this.numSublayers=Sc.maxUnderzooming+Sc.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Qg(this),this._wireframeDebugCache=new MA,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const z=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,z,l.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=E,this.worldview=k}updateTerrain(l,f){const _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ly(this,l));const E=this._terrain;this.transform.elevation=_?E:null,E.update(l,this.transform,f),this.transform.elevation&&!E.enabled&&(this.transform.elevation=null)}_updateFog(l){const f=l.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,E]=f.getFovAdjustedRange(this.transform._fov);if(_>E)return void(this.transform.fogCullDistSq=null);const j=_+.78*(E-_);this.transform.fogCullDistSq=j*j}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new ly(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,f){if(this.width=l*i.o.devicePixelRatio,this.height=f*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const l=this.context,f=new i.bc;f.emplaceBack(0,0),f.emplaceBack(i.al,0),f.emplaceBack(0,i.al),f.emplaceBack(i.al,i.al),this.tileExtentBuffer=l.createVertexBuffer(f,i.be.members),this.tileExtentSegments=i.bf.simpleSegment(0,0,4,2);const _=new i.bc;_.emplaceBack(0,0),_.emplaceBack(i.al,0),_.emplaceBack(0,i.al),_.emplaceBack(i.al,i.al),this.debugBuffer=l.createVertexBuffer(_,i.be.members),this.debugSegments=i.bf.simpleSegment(0,0,4,5);const E=new i.bc;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,i.be.members),this.viewportSegments=i.bf.simpleSegment(0,0,4,2);const j=new i.a$;j.emplaceBack(0,0,0,0),j.emplaceBack(i.al,0,i.al,0),j.emplaceBack(0,i.al,0,i.al),j.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=l.createVertexBuffer(j,i.bh.members),this.mercatorBoundsSegments=i.bf.simpleSegment(0,0,4,2);const k=new i.b0;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(k);const L=new i.bd;for(const G of[0,1,3,2,0])L.emplaceBack(G);this.debugIndexBuffer=l.createIndexBuffer(L),this.emptyTexture=new i.T(l,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA8),this.identityMat=i.bB();const z=this.context.gl;this.stencilClearMode=new rn({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,Er.disabled,this.stencilClearMode,yn.disabled,Xr.disabled,gf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,f,_){if(!f||this.currentStencilSource===f.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let L=!1;for(const z of _)if(this._tileClippingMaskIDs[z.key]===void 0){L=!0;break}if(!L)return}this.currentStencilSource=f.id;const E=this.context,j=E.gl;this.nextStencilID+_.length>256&&this.clearStencil(),E.setColorMode(yn.disabled),E.setDepthMode(Er.disabled);const k=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of _){const z=f.getTile(L),G=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,{tileBoundsBuffer:Z,tileBoundsIndexBuffer:Q,tileBoundsSegments:X}=this.getTileBoundsBuffers(z);k.draw(this,j.TRIANGLES,Er.disabled,new rn({func:j.ALWAYS,mask:0},G,255,j.KEEP,j.KEEP,j.REPLACE),yn.disabled,Xr.disabled,gf(L.projMatrix),"$clipping",Z,Q,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new rn({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const f=this.context.gl;return new rn({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,_=l.sort((k,L)=>L.overscaledZ-k.overscaledZ),E=_[_.length-1].overscaledZ,j=_[0].overscaledZ-E+1;if(j>1){this.currentStencilSource=void 0,this.nextStencilID+j>256&&this.clearStencil();const k={};for(let L=0;L<j;L++)k[L+E]=new rn({func:f.GEQUAL,mask:255},L+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=j,[k,_]}return[{[E]:rn.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new yn([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?yn.unblended:yn.alphaBlended}colorModeForDrapableLayerRenderPass(l){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new yn([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,f,_,E=!1){if(this.depthOcclusion)return new Er(this.context.gl.GREATER,Er.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!E)return Er.disabled;const j=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Er(_||this.context.gl.LEQUAL,f,[j,j])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,f=Math.ceil(this.width),_=Math.ceil(this.height),E=this.context.bindFramebuffer.get(),j=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===f&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),f!==0&&_!==0&&(this.depthFBO=new $_(this.context,f,_,!1,"texture"),this.depthTexture=new i.T(this.context,{width:f,height:_,data:null},l.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(E),l.bindTexture(l.TEXTURE_2D,j),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,f,_,0,0,f,_,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,f)=>l+f/this._fpsHistory.length,0))}render(l,f){const _=i.o.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=f;const E=this.style._mergedLayers,j=!(!this.terrain||!this.terrain.enabled),k=()=>this.style._getOrder(j).filter(mt=>{const nt=E[mt];return!(nt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[nt.type]});let L=k(),z=!1,G=!1,Z=null;for(const mt of L){const nt=E[mt];nt.type==="circle"?z=!0:nt.type==="building"?Z=nt:nt.type==="symbol"&&(nt.hasOcclusionOpacityProperties?G=!0:z=!0)}let Q=L.map(mt=>E[mt]);const X=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();let se=0,le=!1;for(const mt in X){const nt=X[mt];nt.used&&(nt.prepare(this.context),nt.getSource().usedInConflation&&++se)}let ue=!1;for(const mt of Q)mt.isHidden(this.transform.zoom)||(mt.type==="clip"&&(ue=!0),this.prepareLayer(mt));const _e={},ye={},Ee={},Ne={},je={};for(const mt in X){const nt=X[mt];_e[mt]=nt.getVisibleCoordinates(),ye[mt]=_e[mt].slice().reverse(),Ee[mt]=nt.getVisibleCoordinates(!0).reverse(),Ne[mt]=nt.getShadowCasterCoordinates(),je[mt]=nt.sortCoordinatesByDistance(_e[mt])}const qe=mt=>{const nt=this.style.getLayerSourceCache(mt);return nt&&nt.used?nt.getSource():null};if(se||ue||this._clippingActiveLastFrame){const mt=[],nt=[];let Nt=0;for(const yt of Q)this.isSourceForClippingOrConflation(yt,qe(yt))&&(mt.push(yt),nt.push(Nt)),Nt++;if(mt&&(ue||mt.length>1)||this._clippingActiveLastFrame){ue=!1;const yt=[];for(let $t=0;$t<mt.length;$t++){const nr=mt[$t],xr=nt[$t],Xt=this.style.getLayerSourceCache(nr);if(!Xt||!Xt.used||!Xt.getSource().usedInConflation&&nr.type!=="clip"&&nr.type!=="building")continue;let tr=i.eP,wr=i.bZ.None;const pr=[];let dr=!0;if(nr.type==="building")tr=i.eR;else if(nr.type==="clip"){tr=xr;for(const mr of nr.layout.get("clip-layer-types"))wr|=mr==="model"?i.bZ.Model:mr==="symbol"?i.bZ.Symbol:i.bZ.FillExtrusion;for(const mr of nr.layout.get("clip-layer-scope"))pr.push(mr);nr.isHidden(this.transform.zoom)?dr=!1:ue=!0}dr&&yt.push({layer:nr.fqid,cache:Xt,order:tr,clipMask:wr,clipScope:pr})}this.replacementSource.setSources(yt),le=!0}}this._clippingActiveLastFrame=ue,le||this.replacementSource.clear(),this.conflationActive=le,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let mt=0;mt<Q.length;mt++){const nt=Q[mt],Nt=nt.cutoffRange();if(this.longestCutoffRange=Math.max(Nt,this.longestCutoffRange),Nt>0){const yt=qe(nt);yt&&(this.minCutoffZoom=Math.max(yt.minzoom,this.minCutoffZoom)),nt.minzoom&&(this.minCutoffZoom=Math.max(nt.minzoom,this.minCutoffZoom))}nt.is3D(j)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=mt),this._lastOcclusionLayer=mt)}const Ie=this.style&&this.style.fog;Ie?(this._fogVisible=Ie.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ie.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Ee),this.opaquePassCutoff=0,L=k(),Q=L.map(mt=>E[mt]));const Ge=this._shadowRenderer;if(Ge){Ge.updateShadowParameters(this.transform,this.style.directionalLight);for(const mt in X)for(const nt of _e[mt]){let Nt={min:0,max:0};this.terrain&&(Nt=this.terrain.getMinMaxForTile(nt)||Nt),Ge.addShadowReceiver(nt.toUnwrapped(),Nt.min,Nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new bs(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),De=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ue&&!this._snow&&(this._snow=new C1(this)),!Ue&&this._snow&&(this._snow.destroy(),delete this._snow),De&&!this._rain&&(this._rain=new Kp(this)),!De&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),Z){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ht);const mt=this.style.getLayerSourceCache(Z);this.buildingTileBorderManager.updateBorders(mt,Z)}if(!Dt.has(this.context.gl))return;this.renderPass="offscreen";for(const mt of Q){const nt=l.getLayerSourceCache(mt);if(!mt.hasOffscreenPass()||mt.isHidden(this.transform.zoom))continue;const Nt=nt?ye[nt.id]:void 0;(mt.type==="custom"||mt.type==="raster"||mt.type==="raster-particle"||mt.isSky()||Nt&&Nt.length)&&this.renderLayer(this,nt,mt,Nt)}this.depthRangeFor3D=[0,1-(Q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ne)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ze=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ut=(()=>{if(f.showOverdrawInspector)return i.ao.black;const mt=this.style.fog;if(mt&&this.transform.projection.supportsFog){const nt=this.style.getLut(mt.scope);if(!Ze){const Nt=mt.properties.get("color-use-theme")==="none",yt=mt.properties.get("color").toNonPremultipliedRenderColor(Nt?null:nt).toArray01();return new i.ao(...yt)}if(Ze){const Nt=mt.properties.get("space-color-use-theme")==="none",yt=mt.properties.get("space-color").toNonPremultipliedRenderColor(Nt?null:nt).toArray01();return new i.ao(...yt)}}return i.ao.transparent})();if(this.context.clear({color:ut,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ze&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const mt=Q[this.currentLayer],nt=l.getLayerSourceCache(mt);if(mt.isSky())continue;const Nt=nt?(mt.is3D(j)?je:ye)[nt.id]:void 0;this._renderTileClippingMasks(mt,nt,Nt),this.renderLayer(this,nt,mt,Nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ze&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const mt=Q[this.currentLayer],nt=l.getLayerSourceCache(mt);mt.isSky()&&this.renderLayer(this,nt,mt,nt?ye[nt.id]:void 0)}function ot(mt,nt){let Nt;return nt&&(Nt=(mt.type==="symbol"?Ee:mt.is3D(j)?je:ye)[nt.id]),Nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<L.length;){const mt=Q[this.currentLayer];if(mt.type==="raster"||mt.type==="raster-particle"){const nt=l.getLayerSourceCache(mt);this.renderLayer(this,nt,mt,ot(mt,nt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let St=0;Ge&&(St=Ge.getShadowCastingLayerCount());let gt=!1,kt=-1;for(let mt=0;mt<L.length;++mt){const nt=Q[mt];nt.isHidden(this.transform.zoom)||nt.is3D(j)&&(kt=mt)}G&&kt===-1&&(z=!0);let Qt=!1;for(;this.currentLayer<L.length;){const mt=Q[this.currentLayer],nt=l.getLayerSourceCache(mt);if(mt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(mt)){if(mt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Qt&&mt.is3D(j)&&!j){const Nt=this.currentLayer,yt=$t=>{for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const nr=Q[this.currentLayer];if(J_[nr.type]){const xr=this.style.getLayerSourceCache(nr);J_[nr.type](this,xr,nr,ot(nr,xr),$t)}}};yt("initialize"),yt("reset"),this.currentLayer=Nt,Qt=!0}if(z&&!gt&&this.terrain&&!this.transform.isOrthographic&&(gt=!0,this.blitDepth()),G&&kt!==-1&&this.currentLayer===kt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(mt,nt,nt?_e[nt.id]:void 0),this.renderLayer(this,nt,mt,ot(mt,nt)),!this.terrain&&Ge&&St>0&&mt.hasShadowPass()&&--St==0){{this.clearStencil(),this.resetStencilClippingMasks();const Nt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const yt=Q[this.currentLayer];if(Kl[yt.type]){const $t=this.style.getLayerSourceCache(yt);Kl[yt.type](this,$t,yt,ot(yt,$t))}}this.currentLayer=Nt}if(Ge.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Nt;this.currentLayer++){const yt=Q[this.currentLayer];if(!yt.hasLightBeamPass())continue;const $t=l.getLayerSourceCache(yt);this.renderLayer(this,$t,yt,$t?ye[$t.id]:void 0)}this.currentLayer=Nt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Nt=this.currentLayer;this.depthOcclusion=!0;for(const yt of this.layersWithOcclusionOpacity){this.currentLayer=yt;const $t=Q[this.currentLayer],nr=l.getLayerSourceCache($t),xr=nr?ye[nr.id]:void 0;this.terrain||this._renderTileClippingMasks($t,nr,nr?_e[nr.id]:void 0),this.renderLayer(this,nr,$t,xr)}this.depthOcclusion=!1,this.currentLayer=Nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let mt=null;Q.forEach(nt=>{const Nt=l.getLayerSourceCache(nt);Nt&&!nt.isHidden(this.transform.zoom)&&Nt.getVisibleCoordinates().length&&(!mt||mt.getSource().maxzoom<Nt.getSource().maxzoom)&&(mt=Nt)}),mt&&this.options.showTileBoundaries&&b1(this,mt,mt.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&b1(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(mt){const nt=mt.transform.padding;Ui(mt,mt.transform.height-(nt.top||0),3,ah),Ui(mt,nt.bottom||0,3,jA),fy(mt,nt.left||0,3,v1),fy(mt,mt.transform.width-(nt.right||0),3,_1);const Nt=mt.transform.centerPoint;(function(yt,$t,nr,xr){Up(yt,$t-1,nr-10,2,20,xr),Up(yt,$t-10,nr-1,20,2,xr)})(mt,Nt.x,mt.transform.height-Nt.y,x1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),le||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:f}=this.transform.projection,_=!f||!f.includes(l.type);if(Y_[l.type]&&(_||this.terrain&&l.type==="custom")){const E=this.style.getLayerSourceCache(l);Y_[l.type](l,E,this)}this.gpuTimingEnd()}renderLayer(l,f,_,E){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||E&&E.length)&&(this.id=_.id,this.gpuTimingStart(_),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(_.type)&&(!l.terrain||_.type!=="custom")||_.type==="clip"||j1[_.type](l,f,_,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,_=this.context.gl;let E=this.gpuTimers[l.id];E||(E=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:_.createQuery()}),E.calls++,_.beginQuery(f.TIME_ELAPSED_EXT,E.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,f=this.context.gl,_=f.createQuery();this.deferredRenderGpuTimeQueries.push(_),f.beginQuery(l.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const f={};for(const _ in l){const E=l[_],j=this.context.extTimerQuery,k=j.getQueryParameter(E.query,this.context.gl.QUERY_RESULT)/1e6;j.deleteQueryEXT(E.query),f[_]=k}return f}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.gl;let _=0;for(const E of l)_+=f.getQueryParameter(E,f.QUERY_RESULT)/1e6,f.deleteQuery(E);return _}translatePosMatrix(l,f,_,E,j){if(!_[0]&&!_[1])return l;const k=j?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(k){const G=Math.sin(k),Z=Math.cos(k);_=[_[0]*Z-_[1]*G,_[0]*G+_[1]*Z]}const L=[j?_[0]:i.ay(f,_[0],this.transform.zoom),j?_[1]:i.ay(f,_[1],this.transform.zoom),0],z=new Float32Array(16);return i.bq(z,l,L),z}saveTileTexture(l){if(l.context!==this.context)return;const f=l.size[0],_=this._tileTextures[f];_?_.push(l):this._tileTextures[f]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,f,_){const E=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,j=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(j.push("LIGHTING_3D_MODE"),j.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):E||j.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||j.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(j.push("TERRAIN"),this.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&j.push("GLOBE"),!this._fogVisible||E||f!==void 0&&!f||j.push("FOG","FOG_DITHERING"),E&&j.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&j.push("OVERDRAW_INSPECTOR"),j}getOrCreateProgram(l,f){this.cache=this.cache||{};const _=f&&f.defines||[],E=f&&f.config,j=this.currentGlobalDefines(l,f&&f.overrideFog,f&&f.overrideRtt).concat(_),k=cy.cacheKey(x_[l],l,j,E);return this.cache[k]||(this.cache[k]=new cy(this.context,l,x_[l],E,fR[l],j)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,f){if(this.style.enable3dLights()){const _=this.style.directionalLight,E=this.style.ambientLight;if(_&&E){const j=((k,L,z)=>{const G=k.properties.get("direction"),Z=k.properties.get("color-use-theme")==="none",Q=k.properties.get("color").toNonPremultipliedRenderColor(Z?null:z.getLut(k.scope)).toArray01(),X=k.properties.get("intensity"),se=L.properties.get("color-use-theme")==="none",le=L.properties.get("color").toNonPremultipliedRenderColor(se?null:z.getLut(L.scope)).toArray01(),ue=L.properties.get("intensity"),_e=[G.x,G.y,G.z],ye=i.dM(le,ue),Ee=i.dM(Q,X);return{u_lighting_ambient_color:ye,u_lighting_directional_dir:_e,u_lighting_directional_color:Ee,u_ground_radiance:r1(_e,Ee,ye)}})(_,E,this.style);f.setLightsUniformValues(l,j)}}}uploadCommonUniforms(l,f,_,E,j){if(this.uploadCommonLightUniforms(l,f),this.terrain&&this.terrain.renderingToTexture)return;const k=this.style.fog;if(k){const L=k.getOpacity(this.transform.pitch),z=((G,Z,Q,X,se,le,ue,_e,ye,Ee,Ne,je)=>{const qe=G.transform,Ie=Z.properties.get("color-use-theme")==="none",Ge=Z.properties.get("color").toNonPremultipliedRenderColor(Ie?null:G.style.getLut(Z.scope)).toArray01();Ge[3]=X;const Ue=G.frameCounter/1e3%1,[De,Ze]=Z.properties.get("vertical-range");return{u_fog_matrix:Q?qe.calculateFogTileMatrix(Q):je||G.identityMat,u_fog_range:Z.getFovAdjustedRange(qe._fov),u_fog_color:Ge,u_fog_horizon_blend:Z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(De,Ze),Ze],u_fog_temporal_offset:Ue,u_frustum_tl:se,u_frustum_tr:le,u_frustum_br:ue,u_frustum_bl:_e,u_globe_pos:ye,u_globe_radius:Ee,u_viewport:Ne,u_globe_transition:i.aj(qe.zoom),u_is_globe:+(qe.projection.name==="globe")}})(this,k,_,L,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],E);f.setFogUniformValues(l,z)}j&&f.setCutoffUniformValues(l,j.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,f=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const E of _)f[E.key]=l[E.key]||new Au(E,512,this.transform.tileZoom,this,void 0,this.worldview);return f}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,f){return!(!l.is3D(!(!this.terrain||!this.terrain.enabled))||l.type!=="clip"&&l.type!=="building"&&(l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerPresent||l.sourceLayer!=="building"&&l.sourceLayer!=="procedural_buildings")&&(!f||f.type!=="batched-model")))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[l.key];return f||(this._cachedTileFogOpacities[l.key]=f=this.style.fog.getOpacityForTile(l)),f[0]>=vt||f[1]>=vt}setupDepthForOcclusion(l,f,_){const E=this.context,j=E.gl,k=!!_;var L;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),E.activeTexture.set(j.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(j.NEAREST,j.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((L=this.depthRangeFor3D)[1]-L[0]),-1-2*L[0]/(L[1]-L[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(j.NEAREST,j.CLAMP_TO_EDGE),E.activeTexture.set(j.TEXTURE0),k||f.setTerrainUniformValues(E,_)}}function wf(v,l){let f=!1,_=null;const E=()=>{_=null,f&&(v(),_=setTimeout(E,l),f=!1)};return()=>(f=!0,_||E(),_)}class Q_{constructor(l){this._hashName=l&&encodeURIComponent(l),i.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wf(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const f=ex(l);if(this._hashName){const _=this._hashName;let E=!1;const j=location.hash.slice(1).split("&").map(k=>{const L=k.split("=")[0];return L===_?(E=!0,`${L}=${f}`):k}).filter(k=>k);return E||j.push(`${_}=${f}`),`#${j.join("&")}`}return`#${f}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(f=_)}),(f&&f[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(Number(_)))){const _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(f[3]||0):l.getBearing();return l.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ex(v,l){const f=v.getCenter(),_=Math.round(100*v.getZoom())/100,E=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),j=Math.pow(10,E),k=Math.round(f.lng*j)/j,L=Math.round(f.lat*j)/j,z=v.getBearing(),G=v.getPitch();let Z=l?`/${k}/${L}/${_}`:`${_}/${L}/${k}`;return(z||G)&&(Z+="/"+Math.round(10*z)/10),G&&(Z+=`/${Math.round(G)}`),Z}const Zp={linearity:.3,easing:i.eS(0,0,.3,1)},lh=Object.assign({deceleration:2500,maxSpeed:1400},Zp),P1=Object.assign({deceleration:20,maxSpeed:1400},Zp),Oc=Object.assign({deceleration:1e3,maxSpeed:360},Zp),O1=Object.assign({deceleration:1e3,maxSpeed:90},Zp);class tx{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=i.o.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:j}of this._inertiaBuffer)f.zoom+=j.zoomDelta||0,f.bearing+=j.bearingDelta||0,f.pitch+=j.pitchDelta||0,j.panDelta&&f.pan._add(j.panDelta),j.around&&(f.around=j.around),j.pinchAround&&(f.pinchAround=j.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(f.pan.mag()){const j=Yp(f.pan.mag(),_,Object.assign({},lh,l||{}));E.offset=f.pan.mult(j.amount/f.pan.mag()),E.center=this._map.transform.center,Xp(E,j)}if(f.zoom){const j=Yp(f.zoom,_,P1);E.zoom=this._map.transform.zoom+j.amount,Xp(E,j)}if(f.bearing){const j=Yp(f.bearing,_,Oc);E.bearing=this._map.transform.bearing+i.aA(j.amount,-179,179),Xp(E,j)}if(f.pitch){const j=Yp(f.pitch,_,O1);E.pitch=this._map.transform.pitch+j.amount,Xp(E,j)}if(E.zoom||E.bearing){const j=f.pinchAround===void 0?f.around:f.pinchAround;E.around=j?this._map.unproject(j):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function Xp(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function Yp(v,l,f){const{maxSpeed:_,linearity:E,deceleration:j}=f,k=i.aA(v*E/(l/1e3),-_,_),L=Math.abs(k)/(j*E);return{easing:f.easing,duration:1e3*L,amount:k*(L/2)}}class is extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_,E={}){const j=te(f.getCanvasContainer(),_),k=f.unproject(j);super(l,Object.assign({point:j,lngLat:k,originalEvent:_},E)),this._defaultPrevented=!1,this.target=f}}class Jp extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){const E=l==="touchend"?_.changedTouches:_.touches,j=ne(f.getCanvasContainer(),E),k=j.map(z=>f.unproject(z)),L=j.reduce((z,G,Z,Q)=>z.add(G.div(Q.length)),new i.P(0,0));super(l,{points:j,point:L,lngLats:k,lngLat:f.unproject(L),originalEvent:_}),this._defaultPrevented=!1}}class k1 extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f){super("wheel",{originalEvent:f}),this._defaultPrevented=!1}}class N1{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new k1(this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new is(l.type,this._map,l))}mouseup(l){this._map.fire(new is(l.type,this._map,l))}preclick(l){const f=new MouseEvent("preclick",l);this._map.fire(new is(f.type,this._map,f))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(l),this._map.fire(new is(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new is(l.type,this._map,l))}mouseover(l){this._map.fire(new is(l.type,this._map,l))}mouseout(l){this._map.fire(new is(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Jp(l.type,this._map,l))}touchmove(l){this._map.fire(new Jp(l.type,this._map,l))}touchend(l){this._map.fire(new Jp(l.type,this._map,l))}touchcancel(l){this._map.fire(new Jp(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sf{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new is(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new is("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new is(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class I1{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(B(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const _=f,E=this._startPos,j=this._lastPos;if(!E||!j||j.equals(_)||!this._box&&_.dist(E)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=P("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(E.x,_.x),L=Math.max(E.x,_.x),z=Math.min(E.y,_.y),G=Math.max(E.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${k}px,${z}px)`,this._box.style.width=L-k+"px",this._box.style.height=G-z+"px")})}mouseupWindow(l,f){if(!this._active)return;const _=this._startPos,E=f;if(_&&l.button===0){if(this.reset(),K(),_.x!==E.x||_.y!==E.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:l})),{cameraAnimation:j=>j.fitScreenCoordinates(_,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new i.z(l,{originalEvent:f}))}}function gy(v,l){const f={};for(let _=0;_<v.length;_++)f[v[_].identifier]=l[_];return f}class R1{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(E){const j=new i.P(0,0);for(const k of E)j._add(k);return j.div(E.length)}(f),this.touches=gy(_,f)))}touchmove(l,f,_){if(this.aborted||!this.centroid)return;const E=gy(_,f);for(const j in this.touches){const k=E[j];(!k||k.dist(this.touches[j])>30)&&(this.aborted=!0)}}touchend(l,f,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class ch{constructor(l){this.singleTap=new R1(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,f,_){this.singleTap.touchstart(l,f,_)}touchmove(l,f,_){this.singleTap.touchmove(l,f,_)}touchend(l,f,_){const E=this.singleTap.touchend(l,f,_);if(E){const j=l.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(E)<30;if(j&&k||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class M1{constructor(){this._zoomIn=new ch({numTouches:1,numTaps:2}),this._zoomOut=new ch({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,_){this._zoomIn.touchstart(l,f,_),this._zoomOut.touchstart(l,f,_)}touchmove(l,f,_){this._zoomIn.touchmove(l,f,_),this._zoomOut.touchmove(l,f,_)}touchend(l,f,_){const E=this._zoomIn.touchend(l,f,_),j=this._zoomOut.touchend(l,f,_);return E?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(E)},{originalEvent:l})}):j?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(j)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const rx={0:1,2:2},nx={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Qp{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,f){return!1}_move(l,f){return{}}mousedown(l,f){if(this._lastPoint)return;const _=ae(l);this._correctButton(l,_)&&(this._lastPoint=f,this._eventButton=_)}mousemoveWindow(l,f){const _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(E,j){const k=rx[j];return E.buttons===void 0||(E.buttons&k)!==k}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(_,f)}}mouseupWindow(l){this._lastPoint&&ae(l)===this._eventButton&&(this._moved&&K(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class D1 extends Qp{mousedown(l,f){super.mousedown(l,f),this._lastPoint&&(this._active=!0)}_correctButton(l,f){return f===0&&!l.ctrlKey}_move(l,f){return{around:f,panDelta:f.sub(l)}}}class ix extends Qp{constructor(l){super(l),this._pitchRotateKey=l.pitchRotateKey?nx[l.pitchRotateKey]:void 0}_correctButton(l,f){return this._pitchRotateKey?f===0&&l[this._pitchRotateKey]:f===0&&l.ctrlKey||f===2}_move(l,f){const _=.8*(f.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){this._pitchRotateKey||l.preventDefault()}}class L1 extends Qp{constructor(l){super(l),this._pitchRotateKey=l.pitchRotateKey?nx[l.pitchRotateKey]:void 0}_correctButton(l,f){return this._pitchRotateKey?f===0&&l[this._pitchRotateKey]:f===0&&l.ctrlKey||f===2}_move(l,f){const _=-.5*(f.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){this._pitchRotateKey||l.preventDefault()}}class LA{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),i.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(l,f,_){return this._calculateTransform(l,f,_)}touchmove(l,f,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!i.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,f,_)}}touchend(l,f,_){this._calculateTransform(l,f,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,_){_.length>0&&(this._active=!0);const E=gy(_,f),j=new i.P(0,0),k=new i.P(0,0);let L=0;for(const G in E){const Z=E[G],Q=this._touches[G];Q&&(j._add(Z),k._add(Z.sub(Q)),L++,E[G]=Z)}if(this._touches=E,L<this._minTouches||!k.mag())return;const z=k.div(L);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:j.div(L),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class sx{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,f,_){return{}}touchstart(l,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,_){const E=this._firstTwoTouches;if(!E)return;l.preventDefault();const[j,k]=E,L=yy(_,f,j),z=yy(_,f,k);if(!L||!z)return;const G=this._aroundCenter?null:L.add(z).div(2);return this._move([L,z],G,l)}touchend(l,f,_){if(!this._firstTwoTouches)return;const[E,j]=this._firstTwoTouches,k=yy(_,f,E),L=yy(_,f,j);k&&L||(this._active&&K(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yy(v,l,f){for(let _=0;_<v.length;_++)if(v[_].identifier===f)return l[_]}function F1(v,l){return Math.log2(v/l)}class FA extends sx{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(F1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:F1(this._distance,_),pinchAround:f}}}function z1(v,l){return 180*v.angleWith(l)/Math.PI}class zA extends sx{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f){const _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:z1(this._vector,_),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const E=z1(l,_);return Math.abs(E)<f}}function ax(v){return Math.abs(v.y)>Math.abs(v.x)}class BA extends sx{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,ax(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,_){const E=this._lastPoints;if(!E)return;const j=l[0].sub(E[0]),k=l[1].sub(E[1]);return this._map._cooperativeGestures&&!i.eT()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(j,k,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(j.y+k.y)/2*-.5})}gestureBeginsVertically(l,f,_){if(this._valid!==void 0)return this._valid;const E=l.mag()>=2,j=f.mag()>=2;if(!E&&!j)return;if(!E||!j)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const k=l.y>0==f.y>0;return ax(l)&&ax(f)&&k}}const $A={panStep:100,bearingStep:15,pitchStep:10};class UA{constructor(){const l=$A;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,_=0,E=0,j=0,k=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),j=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),j=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),k=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(_=0,E=0),{cameraAnimation:L=>{const z=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:VA,zoom:f?Math.round(z)+f*(l.shiftKey?2:1):z,bearing:L.getBearing()+_*this._bearingStep,pitch:L.getPitch()+E*this._pitchStep,offset:[-j*this._panStep,-k*this._panStep],center:L.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function VA(v){return v*(2-v)}const qA=4.000244140625,bR=1/450;class wR{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bR,i.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||i.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=i.o.now(),E=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%qA==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=f,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(E*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=te(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>qA?this._wheelZoomRate:this._defaultZoomRate;let Z=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&Z!==0&&(Z=1/Z);const Q=f(),X=Math.pow(2,Q),se=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(se*Z))),this._type==="wheel"&&(this._startZoom=Q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:f(),E=this._startZoom,j=this._easing;let k,L=!1;if(this._type==="wheel"&&E&&j){const G=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),Z=j(G);k=i.ak(E,_,Z),G<1?this._frameId||(this._frameId=!0):L=!0}else k=_,L=!0;this._active=!0,L&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let z=k-f();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!L,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=i.eU;if(this._prevEase){const _=this._prevEase,E=(i.o.now()-_.start)/_.duration,j=_.easing(E+.01)-_.easing(E),k=.27/Math.sqrt(j*j+1e-4)*.01,L=Math.sqrt(.0729-k*k);f=i.eS(k,L,.25,1)}return this._prevEase={start:i.o.now(),duration:l,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ds{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class HA{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,f){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class SR{constructor(){this._tap=new ch({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,f,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=f[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,f,_))}touchmove(l,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const E=f[0],j=E.y-this._swipePoint.y;return this._swipePoint=E,l.preventDefault(),this._active=!0,{zoomDelta:j/128}}}else this._tap.touchmove(l,f,_)}touchend(l,f,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,f,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ER{constructor(l,f,_){this._el=l,this._mousePan=f,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class TR{constructor(l,f,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class vy{constructor(l,f,_,E){this._el=l,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _y=v=>v.zoom||v.drag||v.pitch||v.rotate;class B1 extends i.z{}class ox{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,f){const _=i.av([],f,l);this.radius=i.ag(_[2]<0?i.eW([],_,this.constants):[_[0],_[1],0])}projectRay(l){i.eW(l,l,this.constants),i.aw(l,l),i.eX(l,l,this.constants);const f=i.c4([],l,this.radius);if(f[2]>0){const _=i.c4([],[0,0,1],i.bI(f,[0,0,1])),E=i.c4([],i.aw([],[f[0],f[1],0]),this.radius),j=i.d7([],f,i.c4([],i.av([],i.d7([],E,_),f),2));f[0]=j[0],f[1]=j[1]}return f}}function kc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class lx{constructor(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tx(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ox,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),i.aX(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[E,j,k]of this._listeners){const L=E===document?this.handleWindowEvent:this.handleEvent;E.addEventListener(j,L,k)}}destroy(){for(const[l,f,_]of this._listeners){const E=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(f,E,_)}}_addDefaultHandlers(l){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new N1(f,l));const E=f.boxZoom=new I1(f,l);this._add("boxZoom",E);const j=new M1,k=new HA;f.doubleClickZoom=new ds(k,j),this._add("tapZoom",j),this._add("clickZoom",k);const L=new SR;this._add("tapDragZoom",L);const z=f.touchPitch=new BA(f);this._add("touchPitch",z);const G=new ix(l),Z=new L1(l);f.dragRotate=new TR(l,G,Z),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]);const Q=new D1(l),X=new LA(f,l);f.dragPan=new ER(_,Q,X),this._add("mousePan",Q),this._add("touchPan",X,["touchZoom","touchRotate"]);const se=new zA,le=new FA;f.touchZoomRotate=new vy(_,le,se,L),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sf(f));const ue=f.scrollZoom=new wR(f,this);this._add("scrollZoom",ue,["mousePan"]);const _e=f.keyboard=new UA;this._add("keyboard",_e);for(const ye of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ye]&&f[ye].enable(l[ye])}_add(l,f,_){this._handlers.push({handlerName:l,handler:f,allowed:_}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_y(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,f,_){for(const E in l)if(E!==_&&(!f||f.indexOf(E)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const f=[];for(const _ of l)this._el.contains(_.target)&&f.push(_);return f}handleEvent(l,f){this._updatingCamera=!0;const _=l.type==="renderFrame",E=_?void 0:l,j={needsRenderFrame:!1},k={},L={},z=l.touches?this._getMapTouches(l.touches):void 0,G=z?ne(this._el,z):_?void 0:te(this._el,l);for(const{handlerName:X,handler:se,allowed:le}of this._handlers){if(!se.isEnabled())continue;let ue;this._blockedByActive(L,le,X)?se.reset():se[f||l.type]&&(ue=se[f||l.type](l,G,z),this.mergeHandlerResult(j,k,ue,X,E),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||se.isActive())&&(L[X]=se)}const Z={};for(const X in this._previousActiveHandlers)L[X]||(Z[X]=E);this._previousActiveHandlers=L,(Object.keys(Z).length||kc(j))&&(this._changes.push([j,k,Z]),this._triggerRenderFrame()),(Object.keys(L).length||kc(j))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=j;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(l,f,_,E,j){if(!_)return;Object.assign(l,_);const k={handlerName:E,originalEvent:_.originalEvent||j};_.zoomDelta!==void 0&&(f.zoom=k),_.panDelta!==void 0&&(f.drag=k),_.pitchDelta!==void 0&&(f.pitch=k),_.bearingDelta!==void 0&&(f.rotate=k)}_applyChanges(){const l={},f={},_={};for(const[E,j,k]of this._changes)E.panDelta&&(l.panDelta=(l.panDelta||new i.P(0,0))._add(E.panDelta)),E.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(l.around=E.around),E.aroundCoord!==void 0&&(l.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(l.pinchAround=E.pinchAround),E.noInertia&&(l.noInertia=E.noInertia),Object.assign(f,j),Object.assign(_,k);this._updateMapTransform(l,f,_),this._changes=[]}_updateMapTransform(l,f,_){const E=this._map,j=E.transform,k=Ee=>[Ee.x,Ee.y,Ee.z];if((Ee=>{const Ne=this._eventsInProgress.drag;return Ne&&!this._handlersById[Ne.handlerName].isActive()})()&&!kc(l)){const Ee=j.zoom;j.cameraElevationReference="sea",this._originalZoom!=null&&j._orthographicProjectionAtLowPitch&&j.projection.name!=="globe"&&j.pitch===0?(j.cameraElevationReference="ground",j.zoom=this._originalZoom):(j.recenterOnTerrain(),j.cameraElevationReference="ground"),Ee!==j.zoom&&this._map._update(!0)}if(j._isCameraConstrained&&E._stop(!0),!kc(l))return void this._fireEvents(f,_,!0);let{panDelta:L,zoomDelta:z,bearingDelta:G,pitchDelta:Z,around:Q,aroundCoord:X,pinchAround:se}=l;j._isCameraConstrained&&(z>0&&(z=0),j._isCameraConstrained=!1),se!==void 0&&(Q=se),(z||(Ee=>f[Ee]&&!this._eventsInProgress[Ee])("drag"))&&Q&&(this._dragOrigin=k(j.pointCoordinate3D(Q)),this._originalZoom=j.zoom,this._trackingEllipsoid.setup(j._camera.position,this._dragOrigin)),j.cameraElevationReference="sea",E._stop(!0),Q=Q||E.transform.centerPoint,G&&(j.bearing+=G),Z&&(j.pitch+=Z),j._updateCameraState();const le=[0,0,0];if(L)if(j.projection.name==="mercator"){const Ee=this._trackingEllipsoid.projectRay(j.screenPointToMercatorRay(Q).dir),Ne=this._trackingEllipsoid.projectRay(j.screenPointToMercatorRay(Q.sub(L)).dir);le[0]=Ne[0]-Ee[0],le[1]=Ne[1]-Ee[1]}else{const Ee=j.pointCoordinate(Q);if(j.projection.name==="globe"){L=L.rotate(-j.angle);const Ne=j._pixelsPerMercatorPixel/j.worldSize;le[0]=-L.x*i.eV(i.a_(Ee.y))*Ne,le[1]=-L.y*i.eV(j.center.lat)*Ne}else{const Ne=j.pointCoordinate(Q.sub(L));Ee&&Ne&&(le[0]=Ne.x-Ee.x,le[1]=Ne.y-Ee.y)}}const ue=j.zoom,_e=[0,0,0];if(z){const Ee=k(X||j.pointCoordinate3D(Q)),Ne={dir:i.aw([],i.av([],Ee,j._camera.position))};if(Ne.dir[2]<0){const je=j.zoomDeltaToMovement(Ee,z);i.c4(_e,Ne.dir,je)}}const ye=i.d7(le,le,_e);j._translateCameraConstrained(ye),z&&Math.abs(j.zoom-ue)>1e-4&&j.recenterOnTerrain(),j.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,_,!0)}_fireEvents(l,f,_){const E=_y(this._eventsInProgress),j=_y(l),k={};for(const Z in l){const{originalEvent:Q}=l[Z];this._eventsInProgress[Z]||(k[`${Z}start`]=Q),this._eventsInProgress[Z]=l[Z]}!E&&j&&this._fireEvent("movestart",j.originalEvent);for(const Z in k)this._fireEvent(Z,k[Z]);j&&this._fireEvent("move",j.originalEvent);for(const Z in l){const{originalEvent:Q}=l[Z];this._fireEvent(Z,Q)}const L={};let z;for(const Z in this._eventsInProgress){const{handlerName:Q,originalEvent:X}=this._eventsInProgress[Z];this._handlersById[Q].isActive()||(delete this._eventsInProgress[Z],z=f[Q]||X,L[`${Z}end`]=z)}for(const Z in L)this._fireEvent(Z,L[Z]);const G=_y(this._eventsInProgress);if(_&&(E||j)&&!G){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;Z?(Q(Z.bearing||this._map.getBearing())&&(Z.bearing=0),this._map.easeTo(Z,{originalEvent:z})):(this._map.fire(new i.z("moveend",{originalEvent:z})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new i.z(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new B1("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const $s="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ku extends i.E{constructor(l,f){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,i.aX(["_renderFrameCallback"],this)}getCenter(){return new i.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,_){return l=i.P.convert(l).mult(-1),this.panTo(this.transform.center,Object.assign({offset:l},f),_)}panTo(l,f,_){return this.easeTo(Object.assign({center:l},f),_)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,_){return this.easeTo(Object.assign({zoom:l},f),_)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,_){return this.easeTo(Object.assign({bearing:l},f),_)}resetNorth(l,f){return this.rotateTo(0,Object.assign({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=i.aI.convert(l);const _=f&&f.bearing||0,E=f&&f.pitch||0,j=l.getNorthWest(),k=l.getSouthEast();return this._cameraForBounds(this.transform,j,k,_,E,f)}_extendPadding(l){const f={top:0,right:0,bottom:0,left:0};return l==null?Object.assign({},f,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:Object.assign({},f,l)}_extendCameraOptions(l){return(l=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,f){const _=f.max[0]-f.min[0],E=f.max[1]-f.min[1];return _/E>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):E/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,f,_,E,j,k){const L=l.clone(),z=this._extendCameraOptions(k);L.bearing=E,L.pitch=j;const G=i.aS.convert(f),Z=i.aS.convert(_),Q=.5*(G.lat+Z.lat),X=.5*(G.lng+Z.lng),se=i.eY(Q,X),le=i.aw([],se),ue=i.aw([],i.bH([],le,[0,1,0])),_e=i.bH([],ue,le),ye=[ue[0],ue[1],ue[2],0,_e[0],_e[1],_e[2],0,le[0],le[1],le[2],0,0,0,0,1],Ee=[se,i.eY(G.lat,G.lng),i.eY(Z.lat,G.lng),i.eY(Z.lat,Z.lng),i.eY(G.lat,Z.lng),i.eY(Q,G.lng),i.eY(Q,Z.lng),i.eY(G.lat,X),i.eY(Z.lat,X)];let Ne=i.d8.fromPoints(Ee.map(yt=>[i.bI(ue,yt),i.bI(_e,yt),i.bI(le,yt)]));const je=i.af([],Ne.center,ye);i.eZ(je)===0&&i.e_(je,0,0,1),i.aw(je,je),i.c4(je,je,i.aD),L.center=i.e$(je);const qe=L.getWorldToCameraMatrix(),Ie=i.bk(new Float64Array(16),qe);Ne=i.d8.applyTransform(Ne,i.aB([],qe,ye));const Ge=this._extendAABB(Ne,L,z,E);if(!Ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ne=Ge,i.af(je,je,qe);const Ue=.5*(Ne.max[2]-Ne.min[2]),De=this._minimumAABBFrustumDistance(L,Ne),Ze=i.c4([],[0,0,1],Ue),ut=i.d7(Ze,je,Ze),ot=De+(L.pitch===0?0:i.bF(je,ut)),St=L.globeCenterInViewSpace,gt=i.av([],je,[St[0],St[1],St[2]]);i.aw(gt,gt),i.c4(gt,gt,ot);const kt=i.d7([],je,gt);i.af(kt,kt,Ie);const Qt=i.eL/i.aD,mt=i.ag(kt),nt=i.ce(Math.max(mt*Qt-i.eL,Number.EPSILON),0),Nt=Math.min(L.zoomFromMercatorZAdjusted(nt),z.maxZoom);return Nt>.5*(i.cZ+i.cK)?(L.setProjection({name:"mercator"}),L.zoom=Nt,this._cameraForBounds(L,f,_,E,j,k)):{center:L.center,zoom:Nt,bearing:E,pitch:j}}_extendAABB(l,f,_,E){const j=.5*((_.padding.left||0)+(_.padding.right||0)),k=.5*((_.padding.top||0)+(_.padding.bottom||0)),L=k,z=j,G=j,Z=k,Q=f.width-(z+G),X=f.height-(L+Z),se=i.av([],l.max,l.min),le=Math.min(Q/se[0],X/se[1]),ue=Math.min(f.scaleZoom(f.scale*le),_.maxZoom);if(isNaN(ue))return null;const _e=f.scale/f.zoomScale(ue),ye=new i.d8([l.min[0]-z*_e,l.min[1]-Z*_e,l.min[2]],[l.max[0]+G*_e,l.max[1]+L*_e,l.max[2]]),Ee=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new i.P(_.offset.x,_.offset.y):i.P.convert(_.offset)).rotate(-i.an(E));return ye.center[0]-=Ee.x*_e,ye.center[1]+=Ee.y*_e,ye}queryTerrainElevation(l,f){const _=this.transform.elevation;return _?(f=Object.assign({},{exaggerated:!0},f),_.getAtPoint(i.ae.fromLngLat(l),null,f.exaggerated)):null}_cameraForBounds(l,f,_,E,j,k){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,f,_,E,j,k);const L=l.clone(),z=this._extendCameraOptions(k);L.bearing=E,L.pitch=j;const G=i.aS.convert(f),Z=i.aS.convert(_),Q=new i.aS(G.lng,Z.lat),X=new i.aS(Z.lng,G.lat),se=L.project(G),le=L.project(Z),ue=this.queryTerrainElevation(G),_e=this.queryTerrainElevation(Z),ye=this.queryTerrainElevation(Q),Ee=this.queryTerrainElevation(X),Ne=[[se.x,se.y,Math.min(ue||0,_e||0,ye||0,Ee||0)],[le.x,le.y,Math.max(ue||0,_e||0,ye||0,Ee||0)]];let je=i.d8.fromPoints(Ne);const qe=L.getWorldToCameraMatrix(),Ie=i.bk(new Float64Array(16),qe);je=i.d8.applyTransform(je,qe);const Ge=this._extendAABB(je,L,z,E);if(!Ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");je=Ge;const Ue=.5*i.av([],je.max,je.min)[2],De=this._minimumAABBFrustumDistance(L,je),Ze=[0,0,1,0];i.aC(Ze,Ze,qe),i.f0(Ze,Ze);const ut=i.c4([],Ze,De+Ue),ot=i.d7([],je.center,ut);i.af(je.center,je.center,Ie),i.af(ot,ot,Ie);const St=L.unproject(new i.P(je.center[0],je.center[1])),gt=i.f1(L.projection,St),kt=Math.pow(2,gt),Qt=Math.min(L._zoomFromMercatorZ(ot[2]*L.pixelsPerMeter*kt/L.worldSize),z.maxZoom);return L.mercatorFromTransition&&Qt<.5*(i.cZ+i.cK)?(L.setProjection({name:"globe"}),L.zoom=Qt,this._cameraForBounds(L,f,_,E,j,k)):{center:St,zoom:Qt,bearing:E,pitch:j}}fitBounds(l,f,_){const E=this.cameraForBounds(l,f);return this._fitInternal(E,f,_)}fitScreenCoordinates(l,f,_,E,j){const k=i.P.convert(l),L=i.P.convert(f),z=new i.P(Math.min(k.x,L.x),Math.min(k.y,L.y)),G=new i.P(Math.max(k.x,L.x),Math.max(k.y,L.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(k,L))return this;const Z=this.transform.pointLocation3D(z),Q=this.transform.pointLocation3D(G),X=this.transform.pointLocation3D(new i.P(z.x,G.y)),se=this.transform.pointLocation3D(new i.P(G.x,z.y)),le=[Math.min(Z.lng,Q.lng,X.lng,se.lng),Math.min(Z.lat,Q.lat,X.lat,se.lat)],ue=[Math.max(Z.lng,Q.lng,X.lng,se.lng),Math.max(Z.lat,Q.lat,X.lat,se.lat)],_e=E&&E.pitch?E.pitch:this.getPitch(),ye=this._cameraForBounds(this.transform,le,ue,_,_e,E);return this._fitInternal(ye,E,j)}_fitInternal(l,f,_){return l?(f=Object.assign(l,f)).linear?this.easeTo(f,_):this.flyTo(f,_):this}jumpTo(l,f){this.stop();const _=l.preloadOnly?this.transform.clone():this.transform;let E=!1,j=!1,k=!1;"zoom"in l&&_.zoom!==+l.zoom&&(E=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=i.aS.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(j=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(k=!0,_.pitch=+l.pitch);const L=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;if(l.padding!=null&&!_.isPaddingEqual(L))if(l.retainPadding===!1){const z=_.clone();z.padding=L,_.setLocationAtPoint(_.center,z.centerPoint)}else _.padding=L;return l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new i.z("movestart",f)).fire(new i.z("move",f)),E&&this.fire(new i.z("zoomstart",f)).fire(new i.z("zoom",f)).fire(new i.z("zoomend",f)),j&&this.fire(new i.z("rotatestart",f)).fire(new i.z("rotate",f)).fire(new i.z("rotateend",f)),k&&this.fire(new i.z("pitchstart",f)).fire(new i.z("pitch",f)).fire(new i.z("pitchend",f)),this.fire(new i.z("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w($s),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,f){const _=this.transform;if(!_.projection.supportsFreeCamera)return i.w($s),this;this.stop();const E=_.zoom,j=_.pitch,k=_.bearing;_.setFreeCameraOptions(l);const L=E!==_.zoom,z=j!==_.pitch,G=k!==_.bearing;return this.fire(new i.z("movestart",f)).fire(new i.z("move",f)),L&&this.fire(new i.z("zoomstart",f)).fire(new i.z("zoom",f)).fire(new i.z("zoomend",f)),G&&this.fire(new i.z("rotatestart",f)).fire(new i.z("rotate",f)).fire(new i.z("rotateend",f)),z&&this.fire(new i.z("pitchstart",f)).fire(new i.z("pitch",f)).fire(new i.z("pitchend",f)),this.fire(new i.z("moveend",f)),this}easeTo(l,f){this._stop(!1,l.easeId),((l=Object.assign({offset:[0,0],duration:500,easing:i.eU},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const _=this.transform,E=this.getZoom(),j=this.getBearing(),k=this.getPitch(),L=this.getPadding(),z="zoom"in l?+l.zoom:E,G="bearing"in l?this._normalizeBearing(l.bearing,j):j,Z="pitch"in l?+l.pitch:k,Q=this._extendPadding(l.padding),X=i.P.convert(l.offset);let se,le,ue;if(_.projection.name==="globe"){const Ze=i.ae.fromLngLat(_.center),ut=X.rotate(-_.angle);Ze.x+=ut.x/_.worldSize,Ze.y+=ut.y/_.worldSize;const ot=Ze.toLngLat(),St=i.aS.convert(l.center||ot);this._normalizeCenter(St),se=_.centerPoint.add(ut),le=new i.P(Ze.x,Ze.y).mult(_.worldSize),ue=new i.P(i.aF(St.lng),i.aJ(St.lat)).mult(_.worldSize).sub(le)}else{se=_.centerPoint.add(X);const Ze=_.pointLocation(se),ut=i.aS.convert(l.center||Ze);this._normalizeCenter(ut),le=_.project(Ze),ue=_.project(ut).sub(le)}const _e=_.zoomScale(z-E);let ye,Ee;l.around&&(ye=i.aS.convert(l.around),Ee=_.locationPoint(ye));const Ne=this._zooming||z!==E,je=this._rotating||j!==G,qe=this._pitching||Z!==k,Ie=!_.isPaddingEqual(Q),Ge=l.retainPadding===!1?_.clone():_,Ue=Ze=>ut=>{if(Ne&&(Ze.zoom=i.ak(E,z,ut)),je&&(Ze.bearing=i.ak(j,G,ut)),qe&&(Ze.pitch=i.ak(k,Z,ut)),Ie&&(Ge.interpolatePadding(L,Q,ut),se=Ge.centerPoint.add(X)),ye)Ze.setLocationAtPoint(ye,Ee);else{const ot=Ze.zoomScale(Ze.zoom-E),St=z>E?Math.min(2,_e):Math.max(.5,_e),gt=Math.pow(St,1-ut),kt=Ze.unproject(le.add(ue.mult(ut*gt)).mult(ot));Ze.setLocationAtPoint(Ze.renderWorldCopies?kt.wrap():kt,se)}return l.preloadOnly||this._fireMoveEvents(f),Ze};if(l.preloadOnly){const Ze=this._emulate(Ue,l.duration,_);return this._preloadTiles(Ze),this}const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ne,this._rotating=je,this._pitching=qe,this._padding=Ie,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,De),this._ease(Ue(_),Ze=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(f,Ze)},l),this}_prepareEase(l,f,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||_.moving||this.fire(new i.z("movestart",l)),this._zooming&&!_.zooming&&this.fire(new i.z("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new i.z("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new i.z("pitchstart",l))}_fireMoveEvents(l){this.fire(new i.z("move",l)),this._zooming&&this.fire(new i.z("zoom",l)),this._rotating&&this.fire(new i.z("rotate",l)),this._pitching&&this.fire(new i.z("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,E=this._rotating,j=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new i.z("zoomend",l)),E&&this.fire(new i.z("rotateend",l)),j&&this.fire(new i.z("pitchend",l)),this.fire(new i.z("moveend",l))}flyTo(l,f){if(this._prefersReducedMotion(l)){const yt=i.aH(l,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(yt,f)}this.stop(),l=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eU},l);const _=this.transform,E=this.getZoom(),j=this.getBearing(),k=this.getPitch(),L=this.getPadding(),z="zoom"in l?i.aA(+l.zoom,_.minZoom,_.maxZoom):E,G="bearing"in l?this._normalizeBearing(l.bearing,j):j,Z="pitch"in l?+l.pitch:k,Q=this._extendPadding(l.padding),X=_.zoomScale(z-E),se=i.P.convert(l.offset);let le=_.centerPoint.add(se);const ue=_.pointLocation(le),_e=i.aS.convert(l.center||ue);this._normalizeCenter(_e);const ye=_.project(ue),Ee=_.project(_e).sub(ye);let Ne=l.curve;const je=Math.max(_.width,_.height),qe=je/X,Ie=Ee.mag();if("minZoom"in l){const yt=i.aA(Math.min(l.minZoom,E,z),_.minZoom,_.maxZoom),$t=je/_.zoomScale(yt-E);Ne=Math.sqrt($t/Ie*2)}const Ge=Ne*Ne;function Ue(yt){const $t=(qe*qe-je*je+(yt?-1:1)*Ge*Ge*Ie*Ie)/(2*(yt?qe:je)*Ge*Ie);return Math.log(Math.sqrt($t*$t+1)-$t)}function De(yt){return(Math.exp(yt)-Math.exp(-yt))/2}function Ze(yt){return(Math.exp(yt)+Math.exp(-yt))/2}const ut=Ue(0);let ot=function(yt){return Ze(ut)/Ze(ut+Ne*yt)},St=function(yt){return je*((Ze(ut)*(De($t=ut+Ne*yt)/Ze($t))-De(ut))/Ge)/Ie;var $t},gt=(Ue(1)-ut)/Ne;if(Math.abs(Ie)<1e-6||!isFinite(gt)){if(Math.abs(je-qe)<1e-6)return this.easeTo(l,f);const yt=qe<je?-1:1;gt=Math.abs(Math.log(qe/je))/Ne,St=function(){return 0},ot=function($t){return Math.exp(yt*Ne*$t)}}l.duration="duration"in l?+l.duration:1e3*gt/("screenSpeed"in l?+l.screenSpeed/Ne:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const kt=j!==G,Qt=Z!==k,mt=!_.isPaddingEqual(Q),nt=l.retainPadding===!1?_.clone():_,Nt=yt=>$t=>{const nr=$t*gt,xr=1/ot(nr);yt.zoom=$t===1?z:E+yt.scaleZoom(xr),kt&&(yt.bearing=i.ak(j,G,$t)),Qt&&(yt.pitch=i.ak(k,Z,$t)),mt&&(nt.interpolatePadding(L,Q,$t),le=nt.centerPoint.add(se));const Xt=$t===1?_e:yt.unproject(ye.add(Ee.mult(St(nr))).mult(xr));return yt.setLocationAtPoint(yt.renderWorldCopies?Xt.wrap():Xt,le),yt._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(f),yt};if(l.preloadOnly){const yt=this._emulate(Nt,l.duration,_);return this._preloadTiles(yt),this}return this._zooming=!0,this._rotating=kt,this._pitching=Qt,this._padding=mt,this._prepareEase(f,!1),this._ease(Nt(_),()=>this._afterEase(f),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,f)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,f,_){_.animate===!1||_.duration===0?(l(1),f()):(this._easeStart=i.o.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,f){l=i.bS(l,-180,180);const _=Math.abs(l-f);return Math.abs(l-360-f)<_&&(l-=360),Math.abs(l+360-f)<_&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const _=l.lng-f.center.lng;l.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,f,_){const E=Math.ceil(15*f/1e3),j=[],k=l(_.clone());for(let L=0;L<=E;L++){const z=k(L/E);j.push(z.clone())}return j}_preloadTiles(l,f){}}class em{constructor(l={}){this.options=l,i.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const f=this.options&&this.options.compact,_=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const E=P("span","mapboxgl-ctrl-icon",this._compactButton);return E.setAttribute("aria-hidden","true"),E.setAttribute("title",_),this._innerContainer=P("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(l){const _=f.reduce((E,j,k)=>(j.value&&(E+=`${j.key}=${j.value}${k<f.length-1?"&":""}`),E),"?");l.href=`${i.e.FEEDBACK_URL}/${_}#${ex(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||(l.dataType!=="source"||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility")&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const f=this._map.style._mergedSourceCaches;for(const E in f){const j=f[E];if(j.used){const k=j.getSource();k.attribution&&l.indexOf(k.attribution)<0&&l.push(k.attribution)}}l.sort((E,j)=>E.length-j.length),l=l.filter((E,j)=>{for(let k=j+1;k<l.length;k++)if(l[k].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xy{constructor(){i.aX(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=P("div","mapboxgl-ctrl");const f=P("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const f in l){const _=l[f].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class $1{constructor(){i.aX(["_onIndoorUpdate"],this)}onAdd(l){return this._map=l,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",f=>this._onIndoorUpdate(f)),this._container}_createButton(l,f){const _=P("button",l,this._container);return _.type="button",_.addEventListener("click",f),_}_createSeparator(){return P("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(l,f){this._map&&(l.setAttribute("aria-label",f),l.textContent=f)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(l){if(!l||!l.floors)return this._model=l,void(this._container.style.display="none");const f=this._model;this._model=l,this._container.style.display="inline-block",this._container.style.borderRadius="8px",f&&Array.from(this._container.children).forEach(_=>_.remove()),l.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(l.floors,l.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const l=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const f=this._map;this._model&&f&&f._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});P("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&l.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(l),this._createSeparator()}_updateBuildingsButtonState(){const l=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");l&&this._model&&(this._model.activeFloorsVisible?l.classList.remove("mapboxgl-ctrl-level-button-selected"):l.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(l,f){for(let _=0;_<l.length;_++){const E=l[_],j=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(E.id)});this._setButtonTitle(j,E.zIndex.toString()),this._model&&E.id===this._model.selectedFloorId&&f&&j.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(j),_<l.length-1&&this._createSeparator()}}}class GA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const E of _)if(E.id===l)return void(E.cancelled=!0)}run(l=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class by{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const f=i.dC((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,f,_){this._start=this.getValue(f),this._end=l,this._startTime=f,this._endTime=f+_}}const AR={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class WA extends i.z{constructor(l,f,_,E){const{point:j,lngLat:k,originalEvent:L,target:z}=l;super(l.type,{point:j,lngLat:k,originalEvent:L,target:z}),this.preventDefault=()=>{l.preventDefault()},this.id=f,this.interaction=_,this.feature=E}}class U1{constructor(l){this.map=l,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(l,f){if(this.typeById.has(l))throw new Error(`Interaction id "${l}" already exists.`);const _=f.filter;let E=f.type;_&&this.filters.set(l,i.b5(_)),E==="mouseover"&&(E="mouseenter"),E==="mouseout"&&(E="mouseleave");const j=this.interactionsByType.get(E)||new Map;E==="mouseenter"||E==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(l,f)):j.size===0&&this.map.on(E,this.handleType),j.size===0&&this.interactionsByType.set(E,j),j.set(l,f),this.typeById.set(l,E)}get(l){const f=this.typeById.get(l);if(!f)return;const _=this.interactionsByType.get(f);return _?_.get(l):void 0}remove(l){const f=this.typeById.get(l);if(!f)return;this.typeById.delete(l),this.filters.delete(l);const _=this.interactionsByType.get(f);_&&(_.delete(l),f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.delete(l),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):_.size===0&&this.map.off(f,this.handleType))}queryTargets(l,f){const _=[];for(const[E,j]of f)j.target&&_.push({targetId:E,target:j.target,filter:this.filters.get(E)});return this.map.style.queryRenderedTargets(l,_,this.map.transform)}handleMove(l){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const f=this.queryTargets(l.point,Array.from(this.delegatedInteractions).reverse());f.length&&(l.type="mouseenter",this.handleType(l,f));const _=new Map;for(const[E,{feature:j}]of this.prevHoveredFeatures)this.hoveredFeatures.has(E)||_.set(j.id,j);_.size&&(l.type="mouseleave",this.handleType(l,Array.from(_.values())))}handleOut(l){const f=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);f.length&&(l.type="mouseleave",this.handleType(l,f)),this.hoveredFeatures.clear()}handleType(l,f){const _=l.type==="mouseenter";if(_&&!this.interactionsByType.has(l.type))return void i.w("mouseenter interaction required for mouseleave to work.");const E=Array.from(this.interactionsByType.get(l.type)).reverse(),j=!!f;f=f||this.queryTargets(l.point,E);let k=!1;const L=new Set;for(const z of f){for(const[G,Z]of E){if(!Z.target)continue;const Q=z.variants?z.variants[G]:null;if(Q){for(const X of Q){if(Pl(X,z,L,G))continue;const se=new i.dw(z,X),le=Jc(X,z,G);j&&se.id!==void 0&&(se.state=this.map.getFeatureState(se));const ue=_?this.prevHoveredFeatures.get(le):null,_e=new WA(l,G,Z,se),ye=ue?ue.stop:Z.handler(_e);if(_&&this.hoveredFeatures.set(le,{feature:z,stop:ye}),ye!==!1){k=!0;break}}if(k)break}}if(k)break}if(!k)for(const[z,G]of E){const{handler:Z,target:Q}=G;if(!Q&&Z(new WA(l,z,G,null))!==!1)break}}}function V1(v,l){if(Array.isArray(v)&&Array.isArray(l)){const f=new Set(v),_=new Set(l);return f.size===_.size&&v.every(E=>_.has(E))}return i.bx(v,l)}const cx={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ux={showCompass:!0,showZoom:!0,visualizePitch:!1};class wy{constructor(l,f,_=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new ix({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new L1({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),i.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),B()}move(l,f){const _=this.map,E=this.mouseRotate.mousemoveWindow(l,f),j=E&&E.bearingDelta;if(j&&_.setBearing(_.getBearing()+j),this.mousePitch){const k=this.mousePitch.mousemoveWindow(l,f),L=k&&k.pitchDelta;L&&_.setPitch(_.getPitch()+L)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(Object.assign({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),te(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,te(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ne(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=ne(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function fd(v,l,f){if(v=new i.aS(v.lng,v.lat),l){const _=new i.aS(v.lng-360,v.lat),E=new i.aS(v.lng+360,v.lat),j=360*Math.ceil(Math.abs(v.lng-f.center.lng)/360),k=f.locationPoint3D(v).distSqr(l),L=l.x<0||l.y<0||l.x>f.width||l.y>f.height;f.locationPoint3D(_).distSqr(l)<k&&(L||Math.abs(_.lng-f.center.lng)<j)?v=_:f.locationPoint3D(E).distSqr(l)<k&&(L||Math.abs(E.lng-f.center.lng)<j)&&(v=E)}for(;Math.abs(v.lng-f.center.lng)>180;){const _=f.locationPoint3D(v);if(_.x>=0&&_.y>=0&&_.x<=f.width&&_.y<=f.height)break;v.lng>f.center.lng?v.lng-=360:v.lng+=360}return v}const eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},So={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class pd extends i.E{constructor(l,f){super(),(l instanceof HTMLElement||f)&&(l=Object.assign({element:l},f)),i.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:_="center",color:E="#3FB1CE",scale:j=1,draggable:k=!1,clickTolerance:L=0,rotation:z=So.rotation,rotationAlignment:G=So.rotationAlignment,pitchAlignment:Z=So.pitchAlignment,occludedOpacity:Q=So.occludedOpacity,altitude:X=So.altitude}=l||{};this._anchor=_,this._color=E,this._scale=j,this._draggable=k,this._clickTolerance=L,this._rotation=z,this._rotationAlignment=G,this._pitchAlignment=Z,this._occludedOpacity=Q,this._altitude=X,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),l&&l.element?(this._element=l.element,this._offset=i.P.convert(l&&l.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(l&&l.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ue=>{ue.preventDefault()}),this._element.addEventListener("mousedown",ue=>{ue.preventDefault()});const se=this._element.classList;for(const ue in eu)se.remove(`mapboxgl-marker-anchor-${ue}`);se.add(`mapboxgl-marker-anchor-${this._anchor}`);const le=l&&l.className?l.className.trim().split(/\s+/):[];se.add(...le),this._popup=null}_createDefaultMarker(){const l=P("div"),f=N("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},l);if(this._altitude===0){const _=N("radialGradient",{id:"shadowGradient"},N("defs",{},f));N("stop",{offset:"10%","stop-opacity":.4},_),N("stop",{offset:"100%","stop-opacity":.05},_),N("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},f)}return N("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},f),N("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},f),N("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},f),l}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=i.aS.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(l){return l===this._altitude||(this._defaultMarker&&(this._altitude===0&&l!==0||this._altitude!==0&&l===0)&&(this._element=this._createDefaultMarker()),this._altitude=l||So.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,l._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const f=l.code,_=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){const f=l.originalEvent.target,_=this._element;this._popup&&(f===_||_.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,f=this._pos;if(!l||!f)return!1;const _=l.unproject(f,this._altitude),E=l.getFreeCameraOptions();if(!E.position)return!1;const j=E.position.toLngLat();return j.distanceTo(_)<.9*j.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const f=this._pos;if(!f||f.x<0||f.x>l.transform.width||f.y<0||f.y>l.transform.height)return void this._clearFadeTimer();const _=l.unproject(f,this._altitude);let E;l._showingGlobe()&&i.f4(l.transform,this._lngLat)?E=0:(E=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${eu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const l=this._pos,f=this._map,_=this.getPitchAlignment();if(!f||!l||_!=="map")return"";if(!f._showingGlobe()){const z=f.getPitch();return z?`rotateX(${z}deg)`:""}const E=i.cW(i.f5(f.transform,this._lngLat)),j=l.sub(i.f6(f.transform)),k=Math.abs(j.x)+Math.abs(j.y);if(k===0)return"";const L=E/k;return`rotateX(${-j.y*L}deg) rotateY(${j.x*L}deg)`}_calculateZTransform(){const l=this._pos,f=this._map;if(!f||!l)return"";let _=0;const E=this.getRotationAlignment();if(E==="map")if(f._showingGlobe()){const j=f.project(new i.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),k=f.project(new i.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(j);_=i.cW(Math.atan2(k.y,k.x))-90}else _=-f.getBearing();else if(E==="horizon"){const j=i.ah(4,6,f.getZoom()),k=i.f6(f.transform);k.y+=j*f.transform.height;const L=l.sub(k),z=i.cW(Math.atan2(L.y,L.x));_=(z>90?z-270:z+90)*(1-j)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=fd(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat,this._altitude),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=i.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const f=this._map;if(!f)return;const _=this._pointerdownPos,E=this._positionDelta;if(_&&E){if(!this._isDragging){const j=this._clickTolerance||f._clickTolerance;if(l.point.dist(_)<j)return;this._isDragging=!0}this._pos=l.point.sub(E),this._lngLat=f.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(l){const f=this._map,_=this._pos;f&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const f=this._map;return f&&(l?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||So.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||So.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||So.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||So.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},CR={maxWidth:100,unit:"metric"},jR={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},PR={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},OR=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function q1(v=new i.P(0,0),l="bottom"){if(typeof v=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(l){case"top":return new i.P(0,v);case"top-left":return new i.P(f,f);case"top-right":return new i.P(-f,f);case"bottom":return new i.P(0,-v);case"bottom-left":return new i.P(f,-f);case"bottom-right":return new i.P(-f,-f);case"left":return new i.P(v,0);case"right":return new i.P(-v,0)}return new i.P(0,0)}return v instanceof i.P||Array.isArray(v)?i.P.convert(v):i.P.convert(v[l]||[0,0])}return{version:m,supported:O.supported,setRTLTextPlugin:i.fa,getRTLTextPluginStatus:i.f9,Map:class extends ku{constructor(v){S.mark(y.create);const l=v;if((v=Object.assign({},cx,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&i.f2(window)&&(v.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cp(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies,null,null),v),this._repaint=!!v.repaint,this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._collectResourceTiming=v.collectResourceTiming,this._language=this._parseLanguage(v.language),this._worldview=v.worldview,this._renderTaskQueue=new GA,this._domRenderTaskQueue=new GA,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b1(),this._locale=Object.assign({},AR,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._performanceMetricsCollection=v.performanceMetricsCollection,this._tessellationStep=v.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=v.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new by(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=v.scaleFactor,this._requestManager=new de(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,this._contextCreateOptions=v.contextCreateOptions?Object.assign({},v.contextCreateOptions):{},typeof v.container=="string"){const f=document.getElementById(v.container);if(!f)throw new Error(`Container '${v.container.toString()}' not found.`);this._container=f}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),this._spriteFormat=v.spriteFormat,i.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new _R),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new lx(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,(v.style||!v.testMode)&&this.setStyle(v.style||i.e.DEFAULT_STYLE,{config:v.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),v.hash&&(this._hash=new Q_(typeof v.hash=="string"&&v.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch});const f=v.bounds;f&&(this.resize(),this.fitBounds(f,Object.assign({},v.fitBoundsOptions,{duration:0})))}this.resize(),v.attributionControl&&this.addControl(new em({customAttribution:v.customAttribution})),this._logoControl=new xy,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new i.z(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new i.z(`${f.dataType}dataloading`,f))}),this._interactions=new U1(this)}_getMapId(){return this._mapId}addControl(v,l){if(l===void 0&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=v.onAdd(this);this._controls.push(v);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new i.z("movestart",v)).fire(new i.z("move",v)),this.fire(new i.z("resize",v)),l&&this.fire(new i.z("moveend",v)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(i.aI.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(v){return this._scaleFactor=v,this.painter.scaleFactor=v,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(l=>l.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(v){return v==="auto"?navigator.language:Array.isArray(v)?v.length===0?void 0:v.map(l=>l==="auto"?navigator.language:l):v}setLanguage(v){const l=this._parseLanguage(v);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(v){return this.style&&v!==this._worldview?(this._worldview=v,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(v){return this._lazyInitEmptyStyle(),v?typeof v=="string"&&(v={name:v}):v=null,this._useExplicitProjection=!!v,this._prioritizeAndUpdateProjection(v,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const v=this.transform,l=v.projection.name;let f;l==="globe"&&v.zoom>=i.cK?(v.setMercatorFromTransition(),f=!0):l==="mercator"&&v.zoom<i.cK&&(v.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(v,l){return this._updateProjection(v||l||{name:"mercator"})}_updateProjection(v){let l;const f=this.transform.mercatorFromTransition;l=v.name==="globe"&&this.transform.zoom>=i.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(v),this.style.applyProjectionUpdate();const _=this.transform.getProjection().name==="mercator"&&f!==this.transform.mercatorFromTransition;return(l||_)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(v,l){return this.transform.locationPoint3D(i.aS.convert(v),l)}unproject(v,l){return this.transform.pointLocation3D(i.P.convert(v),l)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(v,l,f){const _=E=>{let j=[];if(Array.isArray(l)){const k=l.filter(L=>this.getLayer(L));j=k.length?this.queryRenderedFeatures(E,{layers:k}):[]}else j=this.queryRenderedFeatures(E,{target:l});return j};if(v==="mouseenter"||v==="mouseover"){let E=!1;return{listener:f,targets:l,delegates:{mousemove:k=>{const L=_(k.point);L.length?E||(E=!0,f.call(this,new is(v,this,k.originalEvent,{features:L}))):E=!1},mouseout:()=>{E=!1}}}}if(v==="mouseleave"||v==="mouseout"){let E=!1;return{listener:f,targets:l,delegates:{mousemove:L=>{_(L.point).length?E=!0:E&&(E=!1,f.call(this,new is(v,this,L.originalEvent)))},mouseout:L=>{E&&(E=!1,f.call(this,new is(v,this,L.originalEvent)))}}}}{const E=j=>{const k=_(j.point);k.length&&(j.features=k,f.call(this,j),delete j.features)};return{listener:f,targets:l,delegates:{[v]:E}}}}on(v,l,f){if(typeof l=="function"||f===void 0)return super.on(v,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const _=this._createDelegatedListener(v,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(_);for(const E in _.delegates)this.on(E,_.delegates[E]);return this}once(v,l,f){if(typeof l=="function"||f===void 0)return super.once(v,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const _=this._createDelegatedListener(v,l,f);for(const E in _.delegates)this.once(E,_.delegates[E]);return this}off(v,l,f){if(typeof l=="function"||f===void 0)return super.off(v,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const _=this._delegatedListeners?this._delegatedListeners[v]:void 0;return _&&(E=>{for(let j=0;j<E.length;j++){const k=E[j];if(k.listener===f&&V1(k.targets,l)){for(const L in k.delegates)this.off(L,k.delegates[L]);return E.splice(j,1),this}}})(_),this}queryRenderedFeatures(v,l){if(!this.style)return[];if(v===void 0||v instanceof i.P||Array.isArray(v)||l!==void 0||(l=v,v=void 0),v=v||[[0,0],[this.transform.width,this.transform.height]],!l){const j=this.style.queryRenderedFeatures(v,void 0,this.transform),k=this.style.queryRenderedFeatureset(v,void 0,this.transform);return j.concat(k)}let f=!0;if(l.target&&(f=this._isTargetValid(l.target),f&&!l.layers))return this.style.queryRenderedFeatureset(v,l,this.transform);let _=!0;if(l.layers&&Array.isArray(l.layers)){for(const j of l.layers)if(!this._isValidId(j)){_=!1;break}if(_&&!l.target)return this.style.queryRenderedFeatures(v,l,this.transform)}let E=[];return _&&(E=E.concat(this.style.queryRenderedFeatures(v,l,this.transform))),f&&(E=E.concat(this.style.queryRenderedFeatureset(v,l,this.transform))),E}querySourceFeatures(v,l){return!v||typeof v=="string"&&!this._isValidId(v)?[]:this.style.querySourceFeatures(v,l)}queryRasterValue(v,l,f){return this._isValidId(v)?this.style.queryRasterValue(v,l,f):Promise.resolve(null)}isPointOnSurface(v){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&i.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(v))}addInteraction(v,l){return this._interactions.add(v,l),this}removeInteraction(v){return this._interactions.remove(v),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(v){return this._cooperativeGestures=v,this}setStyle(v,l){return l=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&v&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(v,(f,_)=>{if(f){const E=typeof f=="string"?f:f instanceof Error?f.message:f.error;i.w(`Unable to perform style diff: ${E}. Rebuilding the style from scratch.`),this._updateStyle(v,l)}else _&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(v,l))}_getUIString(v){const l=this._locale[v];if(l==null)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v){const f=Object.assign({},l);l&&l.config&&(f.initialConfig=l.config,delete f.config),this.style=new Cc(this,f).load(v),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Cc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(v){return v==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dq(v)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${v}".`))),!1)}_isTargetValid(v){return"featuresetId"in v?this._isValidId("importId"in v?v.importId:v.featuresetId):"layerId"in v&&this._isValidId(v.layerId)}_areTargetsValid(v){if(Array.isArray(v)){for(const l of v)if(!this._isValidId(l))return!1;return!0}return this._isTargetValid(v)}addSource(v,l){return this._isValidId(v)?(this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)):this}isSourceLoaded(v){return!!this._isValidId(v)&&!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(v,l,f){this._lazyInitEmptyStyle(),this.style.addSourceType(v,l,f)}removeSource(v){return this._isValidId(v)?(this.style.removeSource(v),this._updateTerrain(),this._update(!0)):this}getSource(v){return this._isValidId(v)?this.style.getOwnSource(v):null}addImage(v,l,{pixelRatio:f=1,sdf:_=!1,stretchX:E,stretchY:j,content:k}={}){this._lazyInitEmptyStyle();const L=i.I.from(v);if(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:z,height:G,data:Z}=i.o.getImageData(l);this.style.addImage(L,{data:new i.q({width:z,height:G},Z),pixelRatio:f,stretchX:E,stretchY:j,content:k,sdf:_,version:0,usvg:!1})}else if(l.width===void 0||l.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:G}=l,Z=l;this.style.addImage(L,{data:new i.q({width:z,height:G},new Uint8Array(Z.data)),pixelRatio:f,stretchX:E,stretchY:j,content:k,sdf:_,usvg:!1,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,v)}}updateImage(v,l){this._lazyInitEmptyStyle();const f=i.I.from(v),_=this.style.getImage(f);if(!_)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const E=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?i.o.getImageData(l):l,{width:j,height:k,data:L}=E;if(j===void 0||k===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(j!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||k!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${j}, ${k})
                must be that same as the previous version of the image
                (${_.data.width}, ${_.data.height})`)));const z=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);let G=!1;_.usvg?(_.data=new i.q({width:j,height:k},new Uint8Array(L)),_.usvg=!1,_.icon=void 0,G=!0):_.data.replace(L,z),this.style.updateImage(f,_,G)}hasImage(v){return v?!!this.style&&!!this.style.getImage(i.I.from(v)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(i.I.from(v))}loadImage(v,l){i.n(this._requestManager.transformRequest(v,i.R.Image),(f,_)=>{l(f,_ instanceof HTMLImageElement?i.o.getImageData(_):_)})}listImages(){return this.style.listImages().map(v=>v.name)}addModel(v,l){this._lazyInitEmptyStyle(),this.style.addModel(v,l)}hasModel(v){return v?this.style.hasModel(v):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(v){this.style.removeModel(v)}listModels(){return this.style.listModels()}addLayer(v,l){return this._isValidId(v.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)):this}getSlot(v){const l=this.getLayer(v);return l&&l.slot||null}setSlot(v,l){return this.style.setSlot(v,l),this.style.mergeLayers(),this._update(!0)}addImport(v,l){return this.style.addImport(v,l).catch(f=>this.fire(new i.y(new Error("Failed to add import",f)))),this}updateImport(v,l){return typeof l!="string"&&l.id!==v?(this.removeImport(v),this.addImport(l)):(this.style.updateImport(v,l),this._update(!0))}removeImport(v){return this.style.removeImport(v),this}moveImport(v,l){return this.style.moveImport(v,l),this._update(!0)}moveLayer(v,l){return this._isValidId(v)?(this.style.moveLayer(v,l),this._update(!0)):this}removeLayer(v){return this._isValidId(v)?(this.style.removeLayer(v),this._update(!0)):this}getLayer(v){if(!this._isValidId(v))return null;const l=this.style.getOwnLayer(v);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(v,l,f){return this._isValidId(v)?(this.style.setLayerZoomRange(v,l,f),this._update(!0)):this}setFilter(v,l,f={}){return this._isValidId(v)?(this.style.setFilter(v,l,f),this._update(!0)):this}getFilter(v){return this._isValidId(v)?this.style.getFilter(v):null}setPaintProperty(v,l,f,_={}){return this._isValidId(v)?(this.style.setPaintProperty(v,l,f,_),this._update(!0)):this}getPaintProperty(v,l){return this._isValidId(v)?this.style.getPaintProperty(v,l):null}setLayoutProperty(v,l,f,_={}){return this._isValidId(v)?(this.style.setLayoutProperty(v,l,f,_),this._update(!0)):this}getLayoutProperty(v,l){return this._isValidId(v)?this.style.getLayoutProperty(v,l):null}setLayerProperty(v,l,f,_={}){return this._isValidId(v)?(this.style.setLayerProperty(v,l,f,_),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(v){return this.style.setGlyphsUrl(v),this._update(!0)}getSchema(v){return this.style.getSchema(v)}setSchema(v,l){return this.style.setSchema(v,l),this._update(!0)}getConfig(v){return this.style.getConfig(v)}setConfig(v,l){return this.style.setConfig(v,l),this._update(!0)}getConfigProperty(v,l){return this.style.getConfigProperty(v,l)}setConfigProperty(v,l,f){return this.style.setConfigProperty(v,l,f),this._update(!0)}getFeaturesetDescriptors(v){return this.style.getFeaturesetDescriptors(v)}setLights(v){if(this._lazyInitEmptyStyle(),v&&v.length===1&&v[0].type==="flat"){const l=v[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(v),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const v=this.style.getLights()||[];return v.length===0&&v.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),v}setLight(v,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:v}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(v){return this._lazyInitEmptyStyle(),this.style.setSnow(v),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(v){return this._lazyInitEmptyStyle(),this.style.setRain(v),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(v){return this._lazyInitEmptyStyle(),this.style.setColorTheme(v),this._update(!0)}setImportColorTheme(v,l){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(v,l),this._update(!0)}setCamera(v){return this.style.setCamera(v),this._triggerCameraUpdate(v)}_triggerCameraUpdate(v){return this._update(this.transform.setOrthographicProjectionAtLowPitch(v["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aS.convert(v),this.transform):0}setFeatureState(v,l){return v.source&&!this._isValidId(v.source)?this:(this.style.setFeatureState(v,l),this._update())}removeFeatureState(v,l){return v.source&&!this._isValidId(v.source)?this:(this.style.removeFeatureState(v,l),this._update())}getFeatureState(v){return v.source&&!this._isValidId(v.source)?null:this.style.getFeatureState(v)}_selectIndoorFloor(v){this.indoor.selectFloor(v)}_setIndoorActiveFloorsVisibility(v){this.indoor.setActiveFloorsVisibility(v)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new $1),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let f,_,E,j=this._container;for(;j&&(!_||!E);){const k=window.getComputedStyle(j).transform;k&&k!=="none"&&(f=k.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(_=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(E=f[3])),j=j.parentElement}this._containerWidth=_?Math.abs(v/_):v,this._containerHeight=E?Math.abs(l/E):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new ff(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=P("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=P("div","mapboxgl-canvas-container",v);this._canvas=P("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=P("div","mapboxgl-control-container",v),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(E=>{_[E]=P("div",`mapboxgl-ctrl-${E}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,l){const f=i.o.devicePixelRatio||1;this._canvas.width=f*Math.ceil(v),this._canvas.height=f*Math.ceil(l),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const l=this._markers.indexOf(v);l!==-1&&this._markers.splice(l,1)}_addPopup(v){this._popups.push(v)}_removePopup(v){const l=this._popups.indexOf(v);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const v=Object.assign({},O.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",v);l?(It(l,!0),this.painter=new oh(l,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(l)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let l;this.fire(new i.z("renderstart")),++this._frameId;const f=this.painter.context.extTimerQuery,_=i.o.now(),E=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=E.createQuery(),E.beginQuery(f.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjectionTransition();const j=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,Z=this.transform.pitch,Q=i.o.now(),X=new i.ac(G,{now:Q,fadeDuration:j,pitch:Z,transition:this.style.transition,worldview:this._worldview});this.style.update(X)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let k=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),k=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):k=this._updateAverageElevation(_);const L=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,j,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),L&&(this._placementDirty=L.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:j,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,S.mark(y.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const G=i.o.now()-_;E.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const Z=E.getQueryParameter(l,E.QUERY_RESULT)/1e6;E.deleteQuery(l),this.fire(new i.z("gpu-timing-frame",{cpuTime:G,gpuTime:Z}))},50)}if(this.listens("gpu-timing-layer")){const G=this.painter.collectGpuTimers();setTimeout(()=>{const Z=this.painter.queryGpuTimers(G);this.fire(new i.z("gpu-timing-layer",{layerTimes:Z}))},50)}if(this.listens("gpu-timing-deferred-render")){const G=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Z=this.painter.queryGpuTimeDeferredRender(G);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:Z}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||k;if(z||this._repaint)this.triggerRepaint();else{const G=this.idle();if(G&&(k=this._updateAverageElevation(_,!0)),k)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Z=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:Z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,S.mark(y.fullLoad),this._performanceMetricsCollection&&st(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(v){for(const l of this._markers)v&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!v||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(v,l=!1){const f=E=>(this.transform.averageElevation=E,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(l||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const E=this.transform.averageElevation;let j=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(j)?j=0:this._averageElevationLastSampledAt=v;const k=Math.abs(E-j);if(k>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(j),f(j);this._averageElevation.easeTo(j,v,300)}else if(k>1e-4)return this._averageElevation.jumpTo(j),f(j)}return!!this._averageElevation.isEasing(v)&&f(this._averageElevation.getValue(v))}_authenticate(){Be(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===ie||v.status===401)){const l=this.painter.context.gl;It(l,!1),this._logoControl instanceof xy&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Xe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&$e(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Le(this._requestManager._customAccessToken)}_updateTerrain(){const v=this._isDragging();this.painter.updateTerrain(this.style,v)}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const f=this.painter.context.gl,_=f.createFramebuffer();function E(j){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,j,0);const k=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,k),k}return f.bindFramebuffer(f.FRAMEBUFFER,_),this._canvasPixelComparison(E(v),l.canvasCopies.map(E),l.timeStamps)}_canvasPixelComparison(v,l,f){let _=f[1]-f[0];const E=v.length/4;for(let j=0;j<l.length;j++){const k=l[j];let L=0;for(let z=0;z<k.length;z+=4)k[z]===v[z]&&k[z+1]===v[z+1]&&k[z+2]===v[z+2]&&k[z+3]===v[z+3]&&(L+=1);_+=(f[j+2]-f[j+1])*(1-L/E)}return _}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Dt.delete(this.painter.context.gl),_t.remove(),Oe.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=i.o.frame(l=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(l)}))}_preloadTiles(v){const l=this.style?this.style.getSourceCaches():[];return i.bv(l,(f,_)=>f._preloadTiles(v,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(v){this._showParseStatus!==v&&(this._showParseStatus=v,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(v){this._showLayers2DWireframe!==v&&(this._showLayers2DWireframe=v,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(v){this._showLayers3DWireframe!==v&&(this._showLayers3DWireframe=v,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,this._tp.refreshUI(),v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(v){this._showTileAABBs!==v&&(this._showTileAABBs=v,this._tp.refreshUI(),v&&this._update())}_setCacheLimits(v,l){i.f3(v,l)}get version(){return m}},NavigationControl:class{constructor(v={}){this.options=Object.assign({},ux,v),this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(i.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),P("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),P("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:l}):f.resetNorth({},{originalEvent:l}))}),this._compassIcon=P("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const l=v.getZoom(),f=l===v.getMaxZoom(),_=l===v.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wy(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,l){const f=P("button",v,this._container);return f.type="button",f.addEventListener("click",l),f}_setButtonTitle(v,l){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${l}`);v.setAttribute("aria-label",f),v.firstElementChild&&v.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends i.E{constructor(v={}){super();const l=navigator.geolocation;this.options=Object.assign({geolocation:l},tu,v),i.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(v){return this._map=v,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(v){const l=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,v(f)};this._supportsGeolocation!==void 0?v(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>l(f.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),f=v.coords;return!!l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:v.coords,timestamp:v.timestamp},v.toJSON?{toJSON:v.toJSON.bind(v)}:{}))),this._finish()}}_updateCamera(v){const l=new i.aS(v.coords.longitude,v.coords.latitude),f=v.coords.accuracy,_=this._map.getBearing(),E=Object.assign({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(f),E,{geolocateSource:!0})}_updateMarker(v){if(v){const l=new i.aS(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map.transform,l=i.ce(1,v._center.lat)*v.worldSize,f=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=P("button","mapboxgl-ctrl-geolocate",this._container),P("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",v===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P("div","mapboxgl-user-location"),this._dotElement.appendChild(P("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(P("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=P("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:v.absolute===!0&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(v={maximumAge:6e5,timeout:0},this._noTimeout=!0):(v=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&v()}).catch(console.error):v()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:em,ScaleControl:class{constructor(v={}){this.options=Object.assign({},CR,v),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const v=this.options.maxWidth||100,l=this._map,f=l._containerHeight/2,_=l._containerWidth/2-v/2,E=l.unproject([_,f]),j=l.unproject([_+v,f]),k=E.distanceTo(j);if(this.options.unit==="imperial"){const L=3.2808*k;L>5280?this._setScale(v,L/5280,"mile"):this._setScale(v,L,"foot")}else this.options.unit==="nautical"?this._setScale(v,k/1852,"nautical-mile"):k>=1e3?this._setScale(v,k/1e3,"kilometer"):this._setScale(v,k,"meter")}_setScale(v,l,f){this._map._requestDomTask(()=>{const _=function(j){const k=Math.pow(10,`${Math.floor(j)}`.length-1);let L=j/k;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(z){const G=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*G)/G}(L),k*L}(l),E=_/l;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(_):`${_}&nbsp;${jR[f]}`,this._container.style.width=v*E+"px"})}onAdd(v){return this._map=v,this._language=v.getLanguage(),this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(v){this._language=v,this._update()}setUnit(v){this.options.unit=v,this._update()}},FullscreenControl:class{constructor(v={}){this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:i.w("Full screen control 'container' must be a DOM element.")),i.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=P("button","mapboxgl-ctrl-fullscreen",this._controlContainer);P("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:$1,Popup:class extends i.E{constructor(v){super(),this.options=Object.assign(Object.create(PR),v),this._altitude=this.options.altitude,i.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),v._addPopup(this),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),v._canvasContainer&&v._canvasContainer.classList.remove("mapboxgl-track-pointer"),v._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=i.aS.convert(v),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(v){return this._altitude=v,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const l=document.createDocumentFragment(),f=document.createElement("body");let _;for(f.innerHTML=v;_=f.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=P("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(v),this.options.closeButton){const f=this._closeButton=P("button","mapboxgl-popup-close-button",l);f.type="button",f.setAttribute("aria-label","Close popup"),f.innerHTML='<span aria-hidden="true">&#215;</span>',f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let l;return this._classList.delete(v)?l=!1:(this._classList.add(v),l=!0),this._updateClassList(),l}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const l=this._map,f=this._container,_=this._pos;if(!l||!f||!_)return"bottom";const E=f.offsetWidth,j=f.offsetHeight,k=_.x<E/2,L=_.x>l.transform.width-E/2;if(_.y+v<j)return k?"top-left":L?"top-right":"top";if(_.y>l.transform.height-j){if(k)return"bottom-left";if(L)return"bottom-right"}return k?"left":L?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),v.className=l.join(" ")}_update(v){const l=this._map,f=this._content;if(!l||!this._lngLat&&!this._trackPointer||!f)return;let _=this._container;if(_||(_=this._container=P("div","mapboxgl-popup",l.getContainer()),this._tip=P("div","mapboxgl-popup-tip",_),_.appendChild(f)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fd(this._lngLat,this._pos,l.transform)),!this._trackPointer||v){const E=this._pos=this._trackPointer&&v instanceof i.P?v:l.project(this._lngLat,this._altitude),j=q1(this.options.offset),k=this._anchor=this._getAnchor(j.y),L=q1(this.options.offset,k),z=E.add(L).round();l._requestDomTask(()=>{this._container&&k&&(this._container.style.transform=`${eu[k]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&l._showingGlobe()){const E=i.f4(l.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(OR);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._container&&(this._container.style.opacity=`${v}`),this._content&&(this._content.style.pointerEvents=v?"auto":"none")}},Marker:pd,Style:Cc,LngLat:i.aS,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:ju,Evented:i.E,config:i.e,prewarm:i.f8,clearPrewarmedResources:i.f7,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(v){i.e.ACCESS_TOKEN=v},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(v){i.e.API_URL=v},get workerCount(){return i.fh.workerCount},set workerCount(v){i.fh.workerCount=v},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){i.e.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){i.fg(v)},get workerUrl(){return i.ff.workerUrl},set workerUrl(v){i.ff.workerUrl=v},get workerClass(){return i.ff.workerClass},set workerClass(v){i.ff.workerClass=v},get workerParams(){return i.ff.workerParams},set workerParams(v){i.ff.workerParams=v},get dracoUrl(){return i.fe()},set dracoUrl(v){i.fd(v)},get meshoptUrl(){return i.fc()},set meshoptUrl(v){i.fb(v)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var d=s;return d})})(Bie);var jPe=Bie.exports;const No=Ps(jPe),Uie=({restaurants:e,onRestaurantClick:t,userLocation:r,radiusFilter:n,onMapInit:s,onMarkerClick:o,showViewDetailsButton:d=!1})=>{const{i18n:i,t:m}=ei(),y=V.useRef(null),S=V.useRef(null),w=V.useRef([]),[T,A]=V.useState(!1),O=V.useRef(null);return V.useEffect(()=>{if(!y.current||S.current)return;const P="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";No.accessToken=P;const N=r?[r.lng,r.lat]:[-9.1393,38.7223];return S.current=new No.Map({container:y.current,style:"mapbox://styles/mapbox/light-v11",center:N,zoom:13,cooperativeGestures:!0,doubleClickZoom:!1}),S.current.addControl(new No.NavigationControl({visualizePitch:!0}),"top-right"),S.current.on("load",()=>{A(!0),s&&S.current&&s(S.current)}),()=>{var R;w.current.forEach(M=>M.remove()),w.current=[],O.current&&(O.current.remove(),O.current=null),(R=S.current)==null||R.remove(),S.current=null,A(!1)}},[]),V.useEffect(()=>{S.current&&r&&T&&S.current.flyTo({center:[r.lng,r.lat],zoom:14,duration:1500})},[r,T]),V.useEffect(()=>{if(!S.current||!T)return;w.current.forEach(N=>N.remove()),w.current=[],O.current&&(O.current.remove(),O.current=null);let P=e;if(r&&n&&(P=e.filter(N=>R2(r.lat,r.lng,N.lat,N.lng)<=n)),P.forEach(N=>{const R=document.createElement("div");R.className="p-3 min-w-[200px]",R.innerHTML=`
        <div class="space-y-2">
          <h3 class="font-bold text-base text-foreground">${N.name}</h3>
          ${N.type&&N.type.length>0?`
            <div class="flex flex-wrap gap-1">
              ${N.type.slice(0,2).map(W=>`<span class="text-xs bg-secondary text-secondary-foreground px-2 py-0.5 rounded">${W}</span>`).join("")}
            </div>
          `:""}
          ${N.rating?`
            <div class="flex items-center gap-1">
              <span style="color: #016450;"></span>
              <span class="font-semibold text-sm">${N.rating.toFixed(1)}</span>
            </div>
          `:""}
          <p class="text-xs text-muted-foreground">${N.address}</p>
          ${d?`
            <button 
              id="view-details-${N.id}" 
              class="w-full mt-2 px-3 py-1.5 text-sm font-medium text-white rounded-md transition-colors"
              style="background-color: #016450;"
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              ${m("restaurants.viewDetails")}
            </button>
          `:""}
        </div>
      `;const M=new No.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([N.lng,N.lat]).setDOMContent(R),F=new No.Marker({color:"#016450",draggable:!1}).setLngLat([N.lng,N.lat]).addTo(S.current),B=F.getElement();B.style.cursor="pointer";const $=W=>{W.stopPropagation(),W.preventDefault(),O.current&&O.current!==M&&O.current.remove(),M.addTo(S.current),O.current=M,S.current.easeTo({center:[N.lng,N.lat],zoom:17,duration:800}),o&&o(N)};B.addEventListener("click",$,!0),d&&M.on("open",()=>{const W=document.getElementById(`view-details-${N.id}`);W&&W.addEventListener("click",K=>{K.stopPropagation(),t(N)})}),M.on("close",()=>{O.current===M&&(O.current=null)}),w.current.push(F)}),P.length>0){const N=new No.LngLatBounds;P.forEach(R=>{N.extend([R.lng,R.lat])}),r&&N.extend([r.lng,r.lat]),S.current.fitBounds(N,{padding:50,maxZoom:15})}},[e,n,r,T,t,i.language,d,m,o]),V.useEffect(()=>{if(!S.current||!r||!T)return;const P=document.createElement("div");P.className="user-location-marker",P.style.backgroundColor="#3b82f6",P.style.width="20px",P.style.height="20px",P.style.borderRadius="50%",P.style.border="3px solid white",P.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const N=new No.Marker(P).setLngLat([r.lng,r.lat]).addTo(S.current);return()=>{N.remove()}},[r,T]),h.jsx("div",{ref:y,className:"w-full h-full rounded-lg overflow-hidden"})},xc=()=>{const{i18n:e}=ei(),t=e.language,r=(o,d)=>{let i;if(t==="zh"){const m=`${d}_zh`;i=o[m]||o[d]}else if(t==="pt"){const m=`${d}_pt`;i=o[m]||o[`${d}_en`]||o[d]}else{const m=`${d}_en`;i=o[m]||o[d]}return(d==="name"||d==="title"||d.startsWith("title_"))&&Array.isArray(i)?i.join(", "):i||""};return{getLocalizedField:r,localizeRestaurant:o=>({...o,name:r(o,"name"),type:r(o,"type"),description:r(o,"description")}),localizeActivity:o=>({...o,title:r(o,"title"),content:r(o,"content"),usage_instructions:r(o,"usage_instructions")}),currentLang:t}},Vie=e=>{if(typeof e=="string")return e;const r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date().getDay()],n=e[r];return n?n.closed?"Closed today":n.splitShift?`${n.open} - ${n.close}, ${n.open2} - ${n.close2}`:`${n.open} - ${n.close}`:"Hours not available"},PPe=e=>(ei(),ci({queryKey:["restaurant-activities",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",e);if(r)throw r;const n=new Date;return t.filter(o=>{const d=o.activities;if(!d)return!1;const i=new Date(d.start_date),m=d.end_date?new Date(d.end_date):null;return i<=n&&(!m||m>=n)}).map(o=>({activity_id:o.activity_id,title_zh:o.activities.title_zh,title_en:o.activities.title_en,title_pt:o.activities.title_pt,intro_zh:o.activities.intro_zh,intro_en:o.activities.intro_en,intro_pt:o.activities.intro_pt,badge_text_zh:o.activities.badge_text_zh,badge_text_en:o.activities.badge_text_en,badge_text_pt:o.activities.badge_text_pt,badge_color:o.activities.badge_color}))},enabled:!!e})),qie=e=>(ei(),ci({queryKey:["batch-restaurant-activities",e.join(",")],queryFn:async()=>{if(e.length===0)return{};const{data:t,error:r}=await Ct.from("activity_restaurants").select(`
          restaurant_id,
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).in("restaurant_id",e);if(r)throw r;const n=new Date,s={};return t.forEach(o=>{const d=o.activities;if(!d)return;const i=new Date(d.start_date),m=d.end_date?new Date(d.end_date):null;i<=n&&(!m||m>=n)&&(s[o.restaurant_id]||(s[o.restaurant_id]=[]),s[o.restaurant_id].push({activity_id:o.activity_id,title_zh:d.title_zh,title_en:d.title_en,title_pt:d.title_pt,intro_zh:d.intro_zh,intro_en:d.intro_en,intro_pt:d.intro_pt,badge_text_zh:d.badge_text_zh,badge_text_en:d.badge_text_en,badge_text_pt:d.badge_text_pt,badge_color:d.badge_color}))}),s},enabled:e.length>0})),OPe=(e,t)=>t==="zh"?e.title_zh:t==="pt"?e.title_pt:e.title_en,yO=(e,t)=>{let r="";return t==="zh"?r=e.badge_text_zh||e.title_zh:t==="pt"?r=e.badge_text_pt||e.title_pt:r=e.badge_text_en||e.title_en,r},kPe=(e,t)=>t==="zh"?e.intro_zh||"":t==="pt"?e.intro_pt||"":e.intro_en||"",MN=()=>ci({queryKey:["activities"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activities").select("*").order("pinned",{ascending:!1}).order("sort_order",{ascending:!0}).order("start_date",{ascending:!1});if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{count:s}=await Ct.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id),{data:o}=await Ct.rpc("get_activity_creator_info",{creator_user_id:n.creator_id}),d=o;return{...n,subscriber_count:s||0,creator:{isAdmin:(d==null?void 0:d.isAdmin)??!0,restaurant:(d==null?void 0:d.restaurant)??null,avatar_url:(d==null?void 0:d.avatar_url)??null}}}))}}),NPe=e=>ci({queryKey:["activity",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("activities").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),IPe=e=>ci({queryKey:["activityRestaurants",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("activity_restaurants").select("*").eq("activity_id",e);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(d=>d.restaurant_id),{data:s,error:o}=await Ct.from("restaurants").select("id, name, name_en, name_pt, type, type_en, type_pt, address, image_url, rating, lat, lng").in("id",n);if(o)throw o;return t.map(d=>({...d,restaurants:(s==null?void 0:s.find(i=>i.id===d.restaurant_id))||{id:d.restaurant_id,name:"",name_en:null,name_pt:null,type:[],type_en:null,type_pt:null,address:"",image_url:null,rating:null,lat:null,lng:null}}))},enabled:!!e}),O5=()=>{const{user:e}=Qn();return ci({queryKey:["subscriptions",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("subscriptions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return await Promise.all((t||[]).map(async s=>{const{data:o}=await Ct.from("activities").select("*").eq("id",s.activity_id).single();return{...s,activity:o}}))},enabled:!!e})},Hie=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s}=await Ct.from("subscriptions").select("id").eq("activity_id",n).eq("user_id",e.id).maybeSingle();if(s){const{error:o}=await Ct.from("subscriptions").delete().eq("id",s.id);if(o)throw o;return{action:"unsubscribed"}}else{const{error:o}=await Ct.from("subscriptions").insert({activity_id:n,user_id:e.id});if(o)throw o;return{action:"subscribed"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["subscriptions"]}),t({title:n.action==="subscribed"?Pr.t("toast.subscribed"):Pr.t("toast.unsubscribed"),description:n.action==="subscribed"?Pr.t("toast.subscribedDesc"):Pr.t("toast.unsubscribedDesc")})},onError:()=>{t({title:Pr.t("common.error"),description:Pr.t("toast.subscriptionFailed"),variant:"destructive"})}})},RPe=e=>ci({queryKey:["subscriberCount",e],queryFn:async()=>{const{count:t,error:r}=await Ct.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",e);if(r)throw r;return t||0},enabled:!!e});function Gie({data:e,initialItemsPerPage:t=12,incrementPerPage:r=12}){const[n,s]=V.useState(t),o=(e==null?void 0:e.length)||0,d=V.useMemo(()=>e?e.slice(0,n):[],[e,n]),i=n<o,m=V.useCallback(()=>{s(S=>{const w=S+r;return Math.min(w,(e==null?void 0:e.length)||S)})},[r,e==null?void 0:e.length]),y=V.useCallback(()=>{s(t)},[t]);return{displayedData:d,hasMore:i,loadMore:m,reset:y,totalItems:o,displayedCount:n}}const MPe=({restaurant:e,activities:t,language:r})=>{const[n,s]=V.useState(999),o=V.useRef(null),d=e.type.map((T,A)=>({key:`type-${A}`,label:T,variant:"secondary",color:void 0})),i=t.map((T,A)=>({key:`activity-${A}`,label:yO(T,r),variant:"default",color:T.badge_color||"#9b87f5"})).sort((T,A)=>T.label.length-A.label.length),m=[...d,...i];V.useEffect(()=>{const T=()=>{var W;if(!o.current)return;const O=o.current,P=Array.from(O.querySelectorAll(".tag-badge"));if(P.length===0){setTimeout(T,50);return}const N=(W=P[0])==null?void 0:W.offsetTop;let R=P.length;for(let K=0;K<P.length;K++)if(P[K].offsetTop>N){R=K;break}if(R===P.length){s(P.length);return}const M=O.offsetWidth,F=40;let B=0,$=R;for(let K=0;K<R;K++)B+=P[K].offsetWidth+8;B+F>M&&($=Math.max(1,R-1)),s($)};s(999);const A=setTimeout(T,100);return window.addEventListener("resize",T),()=>{clearTimeout(A),window.removeEventListener("resize",T)}},[m.length,e.id]);const y=m.slice(0,n),S=m.slice(n),w=S.length>0;return h.jsxs("div",{className:"flex items-center gap-2 -mt-1",children:[h.jsx("div",{ref:o,className:"flex gap-2 flex-wrap flex-1",children:y.map(T=>h.jsx(tn,{variant:T.variant,className:"text-xs whitespace-nowrap tag-badge",style:T.color?{backgroundColor:T.color,color:"white"}:void 0,children:T.label},T.key))}),w&&h.jsxs(mO,{children:[h.jsx(gO,{asChild:!0,children:h.jsx(Mt,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:h.jsx(TB,{className:"h-4 w-4"})})}),h.jsx(_T,{className:"w-auto max-w-80",children:h.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(T=>h.jsx(tn,{variant:T.variant,className:"text-xs",style:T.color?{backgroundColor:T.color,color:"white"}:void 0,children:T.label},T.key))})})]})]})},DPe=()=>{const e=Ju(),{t,i18n:r}=ei(),{toast:n}=Ii(),{localizeRestaurant:s}=xc(),[o,d]=V.useState(""),[i,m]=V.useState([]),[y,S]=V.useState(null),[w,T]=V.useState([]),[A,O]=V.useState("list"),[P,N]=V.useState(null),[R,M]=V.useState(null),[F,B]=V.useState(!1),[$,W]=V.useState(!1),[K,te]=V.useState(!1),{user:ne}=Qn(),{data:ae,isLoading:re}=P5(o,i.length>0?i.join(","):void 0),{data:ee=[]}=Die(),{data:ie=[]}=Fie(),{data:de=[]}=MN(),be=Lie(),Se=(Be,Dt)=>{Dt.preventDefault(),Dt.stopPropagation(),ne&&be.mutate(Be)},Ae=Be=>{m(Dt=>Dt.includes(Be)?Dt.filter(It=>It!==Be):[...Dt,Be])},xe=async()=>{try{const Be=await RN();M({lat:Be.coords.latitude,lng:Be.coords.longitude}),B(!0),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{}},me=Be=>{N(Be),Be&&!R&&xe()},Ce=async Be=>{if(y===Be)S(null),T([]);else{S(Be);const{data:Dt,error:It}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",Be);It?(console.error("Error fetching activity restaurants:",It),T([])):T(Dt.map(ir=>ir.restaurant_id))}},ge=(ae==null?void 0:ae.map(Be=>{const Dt=s(Be);if(R){const It=R2(R.lat,R.lng,Be.lat,Be.lng);return{...Dt,distance:It}}return Dt}))||[],pe=y&&w.length>0?ge.filter(Be=>w.includes(Be.id)):ge,Oe=P&&R?pe.filter(Be=>Be.distance&&Be.distance<=P):pe,Xe=F&&R?[...Oe].sort((Be,Dt)=>(Be.distance||0)-(Dt.distance||0)):Oe,{displayedData:We,hasMore:$e,loadMore:Ke,reset:Le}=Gie({data:Xe,initialItemsPerPage:12,incrementPerPage:12});V.useEffect(()=>{Le()},[o,i,y,P,F,Le]);const ke=(We==null?void 0:We.map(Be=>Be.id))||[],{data:st={}}=qie(ke),_t=Be=>{e(`/restaurant/${Be.id}`)};return h.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:h.jsxs("div",{className:"container mx-auto max-w-7xl",children:[h.jsxs("div",{className:"mb-8",children:[h.jsx("h1",{className:"text-4xl font-bold mb-4 text-foreground",children:t("restaurants.title")}),h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsx(cr,{placeholder:t("restaurants.search"),value:o,onChange:Be=>d(Be.target.value),className:"w-full md:max-w-md"}),h.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[h.jsx(Mt,{variant:A==="list"?"default":"outline",size:"icon",onClick:()=>O("list"),title:t("restaurants.listView"),className:"flex-shrink-0",children:h.jsx(jQ,{className:"w-4 h-4"})}),h.jsx(Mt,{variant:A==="map"?"default":"outline",size:"icon",onClick:()=>O("map"),title:t("restaurants.mapView"),className:"flex-shrink-0",children:h.jsx(OQ,{className:"w-4 h-4"})}),R?h.jsx(Mt,{variant:F?"default":"outline",onClick:()=>B(!F),className:"flex-1 md:flex-initial",children:t("restaurants.sortByDistance")}):h.jsxs(Mt,{variant:"outline",onClick:xe,className:"flex-1 md:flex-initial",children:[h.jsx(Hu,{className:"w-4 h-4 mr-2"}),h.jsx("span",{className:"hidden sm:inline",children:t("restaurants.getLocation")}),h.jsx("span",{className:"sm:hidden",children:t("restaurants.getLocation")})]})]})]}),h.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[h.jsxs("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:[t("restaurants.restaurantTypes"),":"]}),i.length>0&&h.jsx(tn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0.5 text-xs",onClick:()=>m([]),children:t("common.actions.clearFilter")})]}),ie.length>8&&h.jsx(Mt,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-primary hover:text-primary/80 hidden sm:flex transition-all duration-200 flex-shrink-0",onClick:()=>W(!$),children:t($?"common.showLess":"common.showMore")})]}),h.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${$?"animate-expand-height":""}`,children:($?ie:ie.slice(0,8)).map((Be,Dt)=>h.jsx(tn,{variant:i.includes(Be)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${i.includes(Be)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Dt*30}ms`},onClick:()=>Ae(Be),children:Be},Be))}),h.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[h.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:ie.map((Be,Dt)=>h.jsx(tn,{variant:i.includes(Be)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${i.includes(Be)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Dt*30}ms`},onClick:()=>Ae(Be),children:Be},Be))}),h.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),h.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]}),de.length>0&&h.jsxs("div",{className:"space-y-2 pt-2 border-t border-border/30",children:[h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[h.jsxs("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:[t("nav.activities"),":"]}),y&&h.jsx(tn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0.5 text-xs",onClick:()=>{S(null),T([])},children:t("common.actions.clearFilter")})]}),de.length>8&&h.jsx(Mt,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-primary hover:text-primary/80 hidden sm:flex transition-all duration-200 flex-shrink-0",onClick:()=>te(!K),children:t(K?"common.showLess":"common.showMore")})]}),h.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${K?"animate-expand-height":""}`,children:(K?de:de.slice(0,8)).map((Be,Dt)=>{const It=r.language==="zh"?Be.badge_text_zh||Be.title_zh:r.language==="pt"?Be.badge_text_pt||Be.title_pt:Be.badge_text_en||Be.title_en;return h.jsx(tn,{variant:y===Be.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${y===Be.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Dt*30}ms`},onClick:()=>Ce(Be.id),children:It},Be.id)})}),h.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[h.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:de.map((Be,Dt)=>{const It=r.language==="zh"?Be.badge_text_zh||Be.title_zh:r.language==="pt"?Be.badge_text_pt||Be.title_pt:Be.badge_text_en||Be.title_en;return h.jsx(tn,{variant:y===Be.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${y===Be.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Dt*30}ms`},onClick:()=>Ce(Be.id),children:It},Be.id)})}),h.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),h.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]}),R&&h.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[h.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("restaurants.radius"),":"]}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[h.jsx(tn,{variant:P===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(null),children:t("restaurants.allRestaurants")}),h.jsx(tn,{variant:P===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(5),children:t("restaurants.radius5km")}),h.jsx(tn,{variant:P===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(10),children:t("restaurants.radius10km")}),h.jsx(tn,{variant:P===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(20),children:t("restaurants.radius20km")})]})]})]})]})]}),re&&h.jsx("div",{className:"flex justify-center items-center py-20",children:h.jsx(aa,{className:"w-8 h-8 animate-spin text-primary"})}),!re&&Xe&&Xe.length===0&&h.jsxs("div",{className:"text-center py-20",children:[h.jsx("p",{className:"text-xl text-muted-foreground",children:t("restaurants.noResults")}),h.jsx("p",{className:"text-muted-foreground mt-2",children:t("restaurants.noResultsDesc")})]}),!re&&A==="map"&&Xe&&Xe.length>0&&h.jsx("div",{className:"h-[400px] md:h-[500px] lg:h-[600px] xl:h-[700px] rounded-lg overflow-hidden shadow-lg",children:h.jsx(Uie,{restaurants:Xe,onRestaurantClick:_t,userLocation:R,radiusFilter:P,showViewDetailsButton:!0})}),!re&&A==="list"&&Xe&&Xe.length>0&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:We.map(Be=>{var Dt;return h.jsxs(kr,{className:"overflow-hidden hover:shadow-large transition-shadow flex flex-col h-full",children:[h.jsxs("div",{className:"relative h-48 overflow-hidden",children:[h.jsx("img",{src:Be.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600&q=80",alt:Be.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),ne&&h.jsx(Mt,{size:"icon",variant:"secondary",className:"absolute top-3 right-3",onClick:It=>Se(Be.id,It),children:h.jsx(VP,{className:`w-5 h-5 ${ee.includes(Be.id)?"fill-destructive text-destructive":""}`})})]}),h.jsx(Rn,{className:"mb-px pb-[15px]",children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsx("h3",{className:"text-xl font-semibold text-card-foreground",children:Be.name}),h.jsxs("div",{className:"flex items-center gap-2",children:[Be.distance!==void 0&&h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Hu,{className:"w-4 h-4 text-primary"}),h.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[Be.distance.toFixed(1)," km"]})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Cl,{className:"w-5 h-5 fill-accent text-accent"}),h.jsx("span",{className:"font-semibold text-card-foreground",children:((Dt=Be.rating)==null?void 0:Dt.toFixed(1))||"0.0"})]})]})]})}),h.jsxs(Mr,{className:"space-y-2 flex-grow",children:[h.jsx(MPe,{restaurant:Be,activities:st[Be.id]||[],language:r.language}),h.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[h.jsx(ga,{className:"w-4 h-4 flex-shrink-0"}),h.jsx("span",{className:"line-clamp-1",children:Be.address})]}),Be.phone&&h.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[h.jsx(tw,{className:"w-4 h-4 flex-shrink-0"}),h.jsx("span",{children:Be.phone})]}),Be.opening_hours&&h.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[h.jsx(Xv,{className:"w-4 h-4 flex-shrink-0"}),h.jsx("span",{children:Vie(Be.opening_hours)})]})]}),h.jsxs(NN,{className:"gap-2 mt-auto",children:[h.jsx(Mt,{asChild:!0,className:"flex-1",children:h.jsx(Hi,{to:`/restaurant/${Be.id}`,children:t("restaurants.viewDetails")})}),R&&h.jsx(Mt,{variant:"outline",size:"icon",onClick:()=>zie(Be.lat,Be.lng,Be.name),title:t("restaurants.directions"),children:h.jsx(Hu,{className:"w-4 h-4"})})]})]},Be.id)})}),$e&&h.jsx("div",{className:"flex justify-center mt-8",children:h.jsxs(Mt,{onClick:Ke,size:"lg",variant:"outline",children:[t("common.loadMore")," (",We.length," / ",Xe.length,")"]})})]})]})})};var LPe="Separator",SG="horizontal",FPe=["horizontal","vertical"],Wie=V.forwardRef((e,t)=>{const{decorative:r,orientation:n=SG,...s}=e,o=zPe(n)?n:SG,i=r?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return h.jsx(on.div,{"data-orientation":o,...i,...s,ref:t})});Wie.displayName=LPe;function zPe(e){return FPe.includes(e)}var Kie=Wie;const Yo=V.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},s)=>h.jsx(Kie,{ref:s,decorative:r,orientation:t,className:fr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));Yo.displayName=Kie.displayName;var DN="Collapsible",[BPe,cst]=Fo(DN),[$Pe,k5]=BPe(DN),Zie=V.forwardRef((e,t)=>{const{__scopeCollapsible:r,open:n,defaultOpen:s,disabled:o,onOpenChange:d,...i}=e,[m,y]=Zc({prop:n,defaultProp:s??!1,onChange:d,caller:DN});return h.jsx($Pe,{scope:r,disabled:o,contentId:yu(),open:m,onOpenToggle:V.useCallback(()=>y(S=>!S),[y]),children:h.jsx(on.div,{"data-state":I5(m),"data-disabled":o?"":void 0,...i,ref:t})})});Zie.displayName=DN;var Xie="CollapsibleTrigger",Yie=V.forwardRef((e,t)=>{const{__scopeCollapsible:r,...n}=e,s=k5(Xie,r);return h.jsx(on.button,{type:"button","aria-controls":s.contentId,"aria-expanded":s.open||!1,"data-state":I5(s.open),"data-disabled":s.disabled?"":void 0,disabled:s.disabled,...n,ref:t,onClick:Ir(e.onClick,s.onOpenToggle)})});Yie.displayName=Xie;var N5="CollapsibleContent",Jie=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=k5(N5,e.__scopeCollapsible);return h.jsx(zo,{present:r||s.open,children:({present:o})=>h.jsx(UPe,{...n,ref:t,present:o})})});Jie.displayName=N5;var UPe=V.forwardRef((e,t)=>{const{__scopeCollapsible:r,present:n,children:s,...o}=e,d=k5(N5,r),[i,m]=V.useState(n),y=V.useRef(null),S=$n(t,y),w=V.useRef(0),T=w.current,A=V.useRef(0),O=A.current,P=d.open||i,N=V.useRef(P),R=V.useRef(void 0);return V.useEffect(()=>{const M=requestAnimationFrame(()=>N.current=!1);return()=>cancelAnimationFrame(M)},[]),io(()=>{const M=y.current;if(M){R.current=R.current||{transitionDuration:M.style.transitionDuration,animationName:M.style.animationName},M.style.transitionDuration="0s",M.style.animationName="none";const F=M.getBoundingClientRect();w.current=F.height,A.current=F.width,N.current||(M.style.transitionDuration=R.current.transitionDuration,M.style.animationName=R.current.animationName),m(n)}},[d.open,n]),h.jsx(on.div,{"data-state":I5(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!P,...o,ref:S,style:{"--radix-collapsible-content-height":T?`${T}px`:void 0,"--radix-collapsible-content-width":O?`${O}px`:void 0,...e.style},children:P&&s})});function I5(e){return e?"open":"closed"}var VPe=Zie;const m0=VPe,g0=Yie,y0=Jie,R5=(e,t="restaurant")=>ci({queryKey:["comments",e,t],queryFn:async()=>{const{data:r,error:n}=await Ct.from("comments").select("*").eq("target_id",e).eq("target_type",t).order("created_at",{ascending:!1});if(n)throw n;if(!r||r.length===0)return[];const s=[...new Set(r.map(w=>w.user_id))],{data:o}=await Ct.from("profiles").select("id, display_name, avatar_url").in("id",s),d=new Map((o||[]).map(w=>[w.id,{display_name:w.display_name,avatar_url:w.avatar_url}])),i=r.filter(w=>!w.parent_id),m=r.filter(w=>w.parent_id),y=new Map;return m.forEach(w=>{const T=w.parent_id;y.has(T)||y.set(T,[]),y.get(T).push(w)}),i.map(w=>({...w,profiles:d.get(w.user_id),replies:(y.get(w.id)||[]).sort((T,A)=>new Date(T.created_at).getTime()-new Date(A.created_at).getTime()).map(T=>({...T,profiles:d.get(T.user_id)}))}))},enabled:!!e,staleTime:3e4}),qPe=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async({targetId:n,targetType:s,content:o,ratingValue:d,priceRange:i,imageUrl:m,parentId:y})=>{if(!e)throw new Error("User not authenticated");const S={user_id:e.id,target_id:n,target_type:s,content:o,parent_id:y};y||(d&&(S.rating_value=d),i&&(S.price_range=i)),m&&(S.image_url=m);const{data:w,error:T}=await Ct.from("comments").insert(S).select().single();if(T)throw T;return w},onSuccess:(n,s)=>{r.invalidateQueries({queryKey:["comments",s.targetId,s.targetType]}),r.invalidateQueries({queryKey:["restaurants"]}),r.invalidateQueries({queryKey:["restaurant",s.targetId]}),t({title:"Success",description:"Comment added successfully"})},onError:()=>{t({title:"Error",description:"Failed to add comment",variant:"destructive"})}})},HPe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("comments").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["comments"]}),e({title:"Success",description:"Comment deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete comment",variant:"destructive"})}})},GPe=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],WPe=({restaurantId:e})=>{var m;const{t}=ei(),{data:r}=R5(e,"restaurant"),n=(r==null?void 0:r.filter(y=>y.rating_value))||[],s=n.length?n.reduce((y,S)=>y+(S.rating_value||0),0)/n.length:0,o=[5,4,3,2,1].map(y=>({star:y,count:n.filter(S=>S.rating_value===y).length,percentage:n.length?(n.filter(S=>S.rating_value===y).length/n.length*100).toFixed(0):0})),d=n.reduce((y,S)=>(S.price_range&&(y[S.price_range]=(y[S.price_range]||0)+1),y),{}),i=d&&Object.keys(d).length>0?Object.entries(d).sort((y,S)=>S[1]-y[1])[0]:null;return h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsx(Hn,{children:t("restaurant.rating")})}),h.jsxs(Mr,{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center gap-6",children:[h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"text-5xl font-bold",children:s.toFixed(1)}),h.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(y=>h.jsx(Cl,{className:fr("w-5 h-5",y<=Math.round(s)?"fill-accent text-accent":"text-muted-foreground")},y))}),h.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[n.length," ",t("restaurant.ratingsCount")]}),i&&h.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[h.jsx(UP,{className:"w-4 h-4 text-primary"}),h.jsx("span",{className:"font-semibold text-foreground",children:(m=GPe.find(y=>y.value===i[0]))==null?void 0:m.label})]})]}),h.jsx("div",{className:"flex-1 space-y-2",children:o.map(({star:y,count:S,percentage:w})=>h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsxs("span",{className:"w-8",children:[y," "]}),h.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:h.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${w}%`}})}),h.jsx("span",{className:"w-12 text-right text-muted-foreground",children:S})]},y))})]}),h.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:t("restaurant.signInToRate")})]})]})},fl=V.forwardRef(({className:e,...t},r)=>h.jsx("textarea",{className:fr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));fl.displayName="Textarea";function M2(e){const t=V.useRef({value:e,previous:e});return V.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var KPe=[" ","Enter","ArrowUp","ArrowDown"],ZPe=[" ","Enter"],Nv="Select",[LN,FN,XPe]=y2(Nv),[hw,ust]=Fo(Nv,[XPe,bg]),zN=bg(),[YPe,Cg]=hw(Nv),[JPe,QPe]=hw(Nv),Qie=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:s,onOpenChange:o,value:d,defaultValue:i,onValueChange:m,dir:y,name:S,autoComplete:w,disabled:T,required:A,form:O}=e,P=zN(t),[N,R]=V.useState(null),[M,F]=V.useState(null),[B,$]=V.useState(!1),W=Yv(y),[K,te]=Zc({prop:n,defaultProp:s??!1,onChange:o,caller:Nv}),[ne,ae]=Zc({prop:d,defaultProp:i,onChange:m,caller:Nv}),re=V.useRef(null),ee=N?O||!!N.closest("form"):!0,[ie,de]=V.useState(new Set),be=Array.from(ie).map(Se=>Se.props.value).join(";");return h.jsx(lN,{...P,children:h.jsxs(YPe,{required:A,scope:t,trigger:N,onTriggerChange:R,valueNode:M,onValueNodeChange:F,valueNodeHasChildren:B,onValueNodeHasChildrenChange:$,contentId:yu(),value:ne,onValueChange:ae,open:K,onOpenChange:te,dir:W,triggerPointerDownPosRef:re,disabled:T,children:[h.jsx(LN.Provider,{scope:t,children:h.jsx(JPe,{scope:e.__scopeSelect,onNativeOptionAdd:V.useCallback(Se=>{de(Ae=>new Set(Ae).add(Se))},[]),onNativeOptionRemove:V.useCallback(Se=>{de(Ae=>{const xe=new Set(Ae);return xe.delete(Se),xe})},[]),children:r})}),ee?h.jsxs(Sse,{"aria-hidden":!0,required:A,tabIndex:-1,name:S,autoComplete:w,value:ne,onChange:Se=>ae(Se.target.value),disabled:T,form:O,children:[ne===void 0?h.jsx("option",{value:""}):null,Array.from(ie)]},be):null]})})};Qie.displayName=Nv;var ese="SelectTrigger",tse=V.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...s}=e,o=zN(r),d=Cg(ese,r),i=d.disabled||n,m=$n(t,d.onTriggerChange),y=FN(r),S=V.useRef("touch"),[w,T,A]=Tse(P=>{const N=y().filter(F=>!F.disabled),R=N.find(F=>F.value===d.value),M=Ase(N,P,R);M!==void 0&&d.onValueChange(M.value)}),O=P=>{i||(d.onOpenChange(!0),A()),P&&(d.triggerPointerDownPosRef.current={x:Math.round(P.pageX),y:Math.round(P.pageY)})};return h.jsx(w2,{asChild:!0,...o,children:h.jsx(on.button,{type:"button",role:"combobox","aria-controls":d.contentId,"aria-expanded":d.open,"aria-required":d.required,"aria-autocomplete":"none",dir:d.dir,"data-state":d.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Ese(d.value)?"":void 0,...s,ref:m,onClick:Ir(s.onClick,P=>{P.currentTarget.focus(),S.current!=="mouse"&&O(P)}),onPointerDown:Ir(s.onPointerDown,P=>{S.current=P.pointerType;const N=P.target;N.hasPointerCapture(P.pointerId)&&N.releasePointerCapture(P.pointerId),P.button===0&&P.ctrlKey===!1&&P.pointerType==="mouse"&&(O(P),P.preventDefault())}),onKeyDown:Ir(s.onKeyDown,P=>{const N=w.current!=="";!(P.ctrlKey||P.altKey||P.metaKey)&&P.key.length===1&&T(P.key),!(N&&P.key===" ")&&KPe.includes(P.key)&&(O(),P.preventDefault())})})})});tse.displayName=ese;var rse="SelectValue",nse=V.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,children:o,placeholder:d="",...i}=e,m=Cg(rse,r),{onValueNodeHasChildrenChange:y}=m,S=o!==void 0,w=$n(t,m.onValueNodeChange);return io(()=>{y(S)},[y,S]),h.jsx(on.span,{...i,ref:w,style:{pointerEvents:"none"},children:Ese(m.value)?h.jsx(h.Fragment,{children:d}):o})});nse.displayName=rse;var eOe="SelectIcon",ise=V.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...s}=e;return h.jsx(on.span,{"aria-hidden":!0,...s,ref:t,children:n||""})});ise.displayName=eOe;var tOe="SelectPortal",sse=e=>h.jsx(ew,{asChild:!0,...e});sse.displayName=tOe;var Iv="SelectContent",ase=V.forwardRef((e,t)=>{const r=Cg(Iv,e.__scopeSelect),[n,s]=V.useState();if(io(()=>{s(new DocumentFragment)},[]),!r.open){const o=n;return o?xg.createPortal(h.jsx(ose,{scope:e.__scopeSelect,children:h.jsx(LN.Slot,{scope:e.__scopeSelect,children:h.jsx("div",{children:e.children})})}),o):null}return h.jsx(lse,{...e,ref:t})});ase.displayName=Iv;var Ad=10,[ose,jg]=hw(Iv),rOe="SelectContentImpl",nOe=ug("SelectContent.RemoveScroll"),lse=V.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:o,onPointerDownOutside:d,side:i,sideOffset:m,align:y,alignOffset:S,arrowPadding:w,collisionBoundary:T,collisionPadding:A,sticky:O,hideWhenDetached:P,avoidCollisions:N,...R}=e,M=Cg(Iv,r),[F,B]=V.useState(null),[$,W]=V.useState(null),K=$n(t,Ke=>B(Ke)),[te,ne]=V.useState(null),[ae,re]=V.useState(null),ee=FN(r),[ie,de]=V.useState(!1),be=V.useRef(!1);V.useEffect(()=>{if(F)return bN(F)},[F]),_N();const Se=V.useCallback(Ke=>{const[Le,...ke]=ee().map(Be=>Be.ref.current),[st]=ke.slice(-1),_t=document.activeElement;for(const Be of Ke)if(Be===_t||(Be==null||Be.scrollIntoView({block:"nearest"}),Be===Le&&$&&($.scrollTop=0),Be===st&&$&&($.scrollTop=$.scrollHeight),Be==null||Be.focus(),document.activeElement!==_t))return},[ee,$]),Ae=V.useCallback(()=>Se([te,F]),[Se,te,F]);V.useEffect(()=>{ie&&Ae()},[ie,Ae]);const{onOpenChange:xe,triggerPointerDownPosRef:me}=M;V.useEffect(()=>{if(F){let Ke={x:0,y:0};const Le=st=>{var _t,Be;Ke={x:Math.abs(Math.round(st.pageX)-(((_t=me.current)==null?void 0:_t.x)??0)),y:Math.abs(Math.round(st.pageY)-(((Be=me.current)==null?void 0:Be.y)??0))}},ke=st=>{Ke.x<=10&&Ke.y<=10?st.preventDefault():F.contains(st.target)||xe(!1),document.removeEventListener("pointermove",Le),me.current=null};return me.current!==null&&(document.addEventListener("pointermove",Le),document.addEventListener("pointerup",ke,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Le),document.removeEventListener("pointerup",ke,{capture:!0})}}},[F,xe,me]),V.useEffect(()=>{const Ke=()=>xe(!1);return window.addEventListener("blur",Ke),window.addEventListener("resize",Ke),()=>{window.removeEventListener("blur",Ke),window.removeEventListener("resize",Ke)}},[xe]);const[Ce,ge]=Tse(Ke=>{const Le=ee().filter(_t=>!_t.disabled),ke=Le.find(_t=>_t.ref.current===document.activeElement),st=Ase(Le,Ke,ke);st&&setTimeout(()=>st.ref.current.focus())}),pe=V.useCallback((Ke,Le,ke)=>{const st=!be.current&&!ke;(M.value!==void 0&&M.value===Le||st)&&(ne(Ke),st&&(be.current=!0))},[M.value]),Oe=V.useCallback(()=>F==null?void 0:F.focus(),[F]),Xe=V.useCallback((Ke,Le,ke)=>{const st=!be.current&&!ke;(M.value!==void 0&&M.value===Le||st)&&re(Ke)},[M.value]),We=n==="popper"?AF:cse,$e=We===AF?{side:i,sideOffset:m,align:y,alignOffset:S,arrowPadding:w,collisionBoundary:T,collisionPadding:A,sticky:O,hideWhenDetached:P,avoidCollisions:N}:{};return h.jsx(ose,{scope:r,content:F,viewport:$,onViewportChange:W,itemRefCallback:pe,selectedItem:te,onItemLeave:Oe,itemTextRefCallback:Xe,focusSelectedItem:Ae,selectedItemText:ae,position:n,isPositioned:ie,searchRef:Ce,children:h.jsx(T2,{as:nOe,allowPinchZoom:!0,children:h.jsx(E2,{asChild:!0,trapped:M.open,onMountAutoFocus:Ke=>{Ke.preventDefault()},onUnmountAutoFocus:Ir(s,Ke=>{var Le;(Le=M.trigger)==null||Le.focus({preventScroll:!0}),Ke.preventDefault()}),children:h.jsx(Kv,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:d,onFocusOutside:Ke=>Ke.preventDefault(),onDismiss:()=>M.onOpenChange(!1),children:h.jsx(We,{role:"listbox",id:M.contentId,"data-state":M.open?"open":"closed",dir:M.dir,onContextMenu:Ke=>Ke.preventDefault(),...R,...$e,onPlaced:()=>de(!0),ref:K,style:{display:"flex",flexDirection:"column",outline:"none",...R.style},onKeyDown:Ir(R.onKeyDown,Ke=>{const Le=Ke.ctrlKey||Ke.altKey||Ke.metaKey;if(Ke.key==="Tab"&&Ke.preventDefault(),!Le&&Ke.key.length===1&&ge(Ke.key),["ArrowUp","ArrowDown","Home","End"].includes(Ke.key)){let st=ee().filter(_t=>!_t.disabled).map(_t=>_t.ref.current);if(["ArrowUp","End"].includes(Ke.key)&&(st=st.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ke.key)){const _t=Ke.target,Be=st.indexOf(_t);st=st.slice(Be+1)}setTimeout(()=>Se(st)),Ke.preventDefault()}})})})})})})});lse.displayName=rOe;var iOe="SelectItemAlignedPosition",cse=V.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...s}=e,o=Cg(Iv,r),d=jg(Iv,r),[i,m]=V.useState(null),[y,S]=V.useState(null),w=$n(t,K=>S(K)),T=FN(r),A=V.useRef(!1),O=V.useRef(!0),{viewport:P,selectedItem:N,selectedItemText:R,focusSelectedItem:M}=d,F=V.useCallback(()=>{if(o.trigger&&o.valueNode&&i&&y&&P&&N&&R){const K=o.trigger.getBoundingClientRect(),te=y.getBoundingClientRect(),ne=o.valueNode.getBoundingClientRect(),ae=R.getBoundingClientRect();if(o.dir!=="rtl"){const _t=ae.left-te.left,Be=ne.left-_t,Dt=K.left-Be,It=K.width+Dt,ir=Math.max(It,te.width),Dr=window.innerWidth-Ad,Rr=vT(Be,[Ad,Math.max(Ad,Dr-ir)]);i.style.minWidth=It+"px",i.style.left=Rr+"px"}else{const _t=te.right-ae.right,Be=window.innerWidth-ne.right-_t,Dt=window.innerWidth-K.right-Be,It=K.width+Dt,ir=Math.max(It,te.width),Dr=window.innerWidth-Ad,Rr=vT(Be,[Ad,Math.max(Ad,Dr-ir)]);i.style.minWidth=It+"px",i.style.right=Rr+"px"}const re=T(),ee=window.innerHeight-Ad*2,ie=P.scrollHeight,de=window.getComputedStyle(y),be=parseInt(de.borderTopWidth,10),Se=parseInt(de.paddingTop,10),Ae=parseInt(de.borderBottomWidth,10),xe=parseInt(de.paddingBottom,10),me=be+Se+ie+xe+Ae,Ce=Math.min(N.offsetHeight*5,me),ge=window.getComputedStyle(P),pe=parseInt(ge.paddingTop,10),Oe=parseInt(ge.paddingBottom,10),Xe=K.top+K.height/2-Ad,We=ee-Xe,$e=N.offsetHeight/2,Ke=N.offsetTop+$e,Le=be+Se+Ke,ke=me-Le;if(Le<=Xe){const _t=re.length>0&&N===re[re.length-1].ref.current;i.style.bottom="0px";const Be=y.clientHeight-P.offsetTop-P.offsetHeight,Dt=Math.max(We,$e+(_t?Oe:0)+Be+Ae),It=Le+Dt;i.style.height=It+"px"}else{const _t=re.length>0&&N===re[0].ref.current;i.style.top="0px";const Dt=Math.max(Xe,be+P.offsetTop+(_t?pe:0)+$e)+ke;i.style.height=Dt+"px",P.scrollTop=Le-Xe+P.offsetTop}i.style.margin=`${Ad}px 0`,i.style.minHeight=Ce+"px",i.style.maxHeight=ee+"px",n==null||n(),requestAnimationFrame(()=>A.current=!0)}},[T,o.trigger,o.valueNode,i,y,P,N,R,o.dir,n]);io(()=>F(),[F]);const[B,$]=V.useState();io(()=>{y&&$(window.getComputedStyle(y).zIndex)},[y]);const W=V.useCallback(K=>{K&&O.current===!0&&(F(),M==null||M(),O.current=!1)},[F,M]);return h.jsx(aOe,{scope:r,contentWrapper:i,shouldExpandOnScrollRef:A,onScrollButtonChange:W,children:h.jsx("div",{ref:m,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:B},children:h.jsx(on.div,{...s,ref:w,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});cse.displayName=iOe;var sOe="SelectPopperPosition",AF=V.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:s=Ad,...o}=e,d=zN(r);return h.jsx(cN,{...d,...o,ref:t,align:n,collisionPadding:s,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});AF.displayName=sOe;var[aOe,M5]=hw(Iv,{}),CF="SelectViewport",use=V.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...s}=e,o=jg(CF,r),d=M5(CF,r),i=$n(t,o.onViewportChange),m=V.useRef(0);return h.jsxs(h.Fragment,{children:[h.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),h.jsx(LN.Slot,{scope:r,children:h.jsx(on.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:Ir(s.onScroll,y=>{const S=y.currentTarget,{contentWrapper:w,shouldExpandOnScrollRef:T}=d;if(T!=null&&T.current&&w){const A=Math.abs(m.current-S.scrollTop);if(A>0){const O=window.innerHeight-Ad*2,P=parseFloat(w.style.minHeight),N=parseFloat(w.style.height),R=Math.max(P,N);if(R<O){const M=R+A,F=Math.min(O,M),B=M-F;w.style.height=F+"px",w.style.bottom==="0px"&&(S.scrollTop=B>0?B:0,w.style.justifyContent="flex-end")}}}m.current=S.scrollTop})})})]})});use.displayName=CF;var dse="SelectGroup",[oOe,lOe]=hw(dse),cOe=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=yu();return h.jsx(oOe,{scope:r,id:s,children:h.jsx(on.div,{role:"group","aria-labelledby":s,...n,ref:t})})});cOe.displayName=dse;var hse="SelectLabel",fse=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=lOe(hse,r);return h.jsx(on.div,{id:s.id,...n,ref:t})});fse.displayName=hse;var vO="SelectItem",[uOe,pse]=hw(vO),mse=V.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:s=!1,textValue:o,...d}=e,i=Cg(vO,r),m=jg(vO,r),y=i.value===n,[S,w]=V.useState(o??""),[T,A]=V.useState(!1),O=$n(t,M=>{var F;return(F=m.itemRefCallback)==null?void 0:F.call(m,M,n,s)}),P=yu(),N=V.useRef("touch"),R=()=>{s||(i.onValueChange(n),i.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return h.jsx(uOe,{scope:r,value:n,disabled:s,textId:P,isSelected:y,onItemTextChange:V.useCallback(M=>{w(F=>F||((M==null?void 0:M.textContent)??"").trim())},[]),children:h.jsx(LN.ItemSlot,{scope:r,value:n,disabled:s,textValue:S,children:h.jsx(on.div,{role:"option","aria-labelledby":P,"data-highlighted":T?"":void 0,"aria-selected":y&&T,"data-state":y?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...d,ref:O,onFocus:Ir(d.onFocus,()=>A(!0)),onBlur:Ir(d.onBlur,()=>A(!1)),onClick:Ir(d.onClick,()=>{N.current!=="mouse"&&R()}),onPointerUp:Ir(d.onPointerUp,()=>{N.current==="mouse"&&R()}),onPointerDown:Ir(d.onPointerDown,M=>{N.current=M.pointerType}),onPointerMove:Ir(d.onPointerMove,M=>{var F;N.current=M.pointerType,s?(F=m.onItemLeave)==null||F.call(m):N.current==="mouse"&&M.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ir(d.onPointerLeave,M=>{var F;M.currentTarget===document.activeElement&&((F=m.onItemLeave)==null||F.call(m))}),onKeyDown:Ir(d.onKeyDown,M=>{var B;((B=m.searchRef)==null?void 0:B.current)!==""&&M.key===" "||(ZPe.includes(M.key)&&R(),M.key===" "&&M.preventDefault())})})})})});mse.displayName=vO;var pE="SelectItemText",gse=V.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,...o}=e,d=Cg(pE,r),i=jg(pE,r),m=pse(pE,r),y=QPe(pE,r),[S,w]=V.useState(null),T=$n(t,R=>w(R),m.onItemTextChange,R=>{var M;return(M=i.itemTextRefCallback)==null?void 0:M.call(i,R,m.value,m.disabled)}),A=S==null?void 0:S.textContent,O=V.useMemo(()=>h.jsx("option",{value:m.value,disabled:m.disabled,children:A},m.value),[m.disabled,m.value,A]),{onNativeOptionAdd:P,onNativeOptionRemove:N}=y;return io(()=>(P(O),()=>N(O)),[P,N,O]),h.jsxs(h.Fragment,{children:[h.jsx(on.span,{id:m.textId,...o,ref:T}),m.isSelected&&d.valueNode&&!d.valueNodeHasChildren?xg.createPortal(o.children,d.valueNode):null]})});gse.displayName=pE;var yse="SelectItemIndicator",vse=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return pse(yse,r).isSelected?h.jsx(on.span,{"aria-hidden":!0,...n,ref:t}):null});vse.displayName=yse;var jF="SelectScrollUpButton",_se=V.forwardRef((e,t)=>{const r=jg(jF,e.__scopeSelect),n=M5(jF,e.__scopeSelect),[s,o]=V.useState(!1),d=$n(t,n.onScrollButtonChange);return io(()=>{if(r.viewport&&r.isPositioned){let i=function(){const y=m.scrollTop>0;o(y)};const m=r.viewport;return i(),m.addEventListener("scroll",i),()=>m.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),s?h.jsx(bse,{...e,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:m}=r;i&&m&&(i.scrollTop=i.scrollTop-m.offsetHeight)}}):null});_se.displayName=jF;var PF="SelectScrollDownButton",xse=V.forwardRef((e,t)=>{const r=jg(PF,e.__scopeSelect),n=M5(PF,e.__scopeSelect),[s,o]=V.useState(!1),d=$n(t,n.onScrollButtonChange);return io(()=>{if(r.viewport&&r.isPositioned){let i=function(){const y=m.scrollHeight-m.clientHeight,S=Math.ceil(m.scrollTop)<y;o(S)};const m=r.viewport;return i(),m.addEventListener("scroll",i),()=>m.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),s?h.jsx(bse,{...e,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:m}=r;i&&m&&(i.scrollTop=i.scrollTop+m.offsetHeight)}}):null});xse.displayName=PF;var bse=V.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...s}=e,o=jg("SelectScrollButton",r),d=V.useRef(null),i=FN(r),m=V.useCallback(()=>{d.current!==null&&(window.clearInterval(d.current),d.current=null)},[]);return V.useEffect(()=>()=>m(),[m]),io(()=>{var S;const y=i().find(w=>w.ref.current===document.activeElement);(S=y==null?void 0:y.ref.current)==null||S.scrollIntoView({block:"nearest"})},[i]),h.jsx(on.div,{"aria-hidden":!0,...s,ref:t,style:{flexShrink:0,...s.style},onPointerDown:Ir(s.onPointerDown,()=>{d.current===null&&(d.current=window.setInterval(n,50))}),onPointerMove:Ir(s.onPointerMove,()=>{var y;(y=o.onItemLeave)==null||y.call(o),d.current===null&&(d.current=window.setInterval(n,50))}),onPointerLeave:Ir(s.onPointerLeave,()=>{m()})})}),dOe="SelectSeparator",wse=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return h.jsx(on.div,{"aria-hidden":!0,...n,ref:t})});wse.displayName=dOe;var OF="SelectArrow",hOe=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=zN(r),o=Cg(OF,r),d=jg(OF,r);return o.open&&d.position==="popper"?h.jsx(uN,{...s,...n,ref:t}):null});hOe.displayName=OF;var fOe="SelectBubbleInput",Sse=V.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const s=V.useRef(null),o=$n(n,s),d=M2(t);return V.useEffect(()=>{const i=s.current;if(!i)return;const m=window.HTMLSelectElement.prototype,S=Object.getOwnPropertyDescriptor(m,"value").set;if(d!==t&&S){const w=new Event("change",{bubbles:!0});S.call(i,t),i.dispatchEvent(w)}},[d,t]),h.jsx(on.select,{...r,style:{...tQ,...r.style},ref:o,defaultValue:t})});Sse.displayName=fOe;function Ese(e){return e===""||e===void 0}function Tse(e){const t=no(e),r=V.useRef(""),n=V.useRef(0),s=V.useCallback(d=>{const i=r.current+d;t(i),function m(y){r.current=y,window.clearTimeout(n.current),y!==""&&(n.current=window.setTimeout(()=>m(""),1e3))}(i)},[t]),o=V.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return V.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,s,o]}function Ase(e,t,r){const s=t.length>1&&Array.from(t).every(y=>y===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let d=pOe(e,Math.max(o,0));s.length===1&&(d=d.filter(y=>y!==r));const m=d.find(y=>y.textValue.toLowerCase().startsWith(s.toLowerCase()));return m!==r?m:void 0}function pOe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var mOe=Qie,Cse=tse,gOe=nse,yOe=ise,vOe=sse,jse=ase,_Oe=use,Pse=fse,Ose=mse,xOe=gse,bOe=vse,kse=_se,Nse=xse,Ise=wse;const Aa=mOe,Ca=gOe,ya=V.forwardRef(({className:e,children:t,...r},n)=>h.jsxs(Cse,{ref:n,className:fr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,h.jsx(yOe,{asChild:!0,children:h.jsx(Vf,{className:"h-4 w-4 opacity-50"})})]}));ya.displayName=Cse.displayName;const Rse=V.forwardRef(({className:e,...t},r)=>h.jsx(kse,{ref:r,className:fr("flex cursor-default items-center justify-center py-1",e),...t,children:h.jsx(S_e,{className:"h-4 w-4"})}));Rse.displayName=kse.displayName;const Mse=V.forwardRef(({className:e,...t},r)=>h.jsx(Nse,{ref:r,className:fr("flex cursor-default items-center justify-center py-1",e),...t,children:h.jsx(Vf,{className:"h-4 w-4"})}));Mse.displayName=Nse.displayName;const va=V.forwardRef(({className:e,children:t,position:r="popper",...n},s)=>h.jsx(vOe,{children:h.jsxs(jse,{ref:s,className:fr("relative z-[100] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[h.jsx(Rse,{}),h.jsx(_Oe,{className:fr("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),h.jsx(Mse,{})]})}));va.displayName=jse.displayName;const wOe=V.forwardRef(({className:e,...t},r)=>h.jsx(Pse,{ref:r,className:fr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));wOe.displayName=Pse.displayName;const En=V.forwardRef(({className:e,children:t,...r},n)=>h.jsxs(Ose,{ref:n,className:fr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(bOe,{children:h.jsx(sp,{className:"h-4 w-4"})})}),h.jsx(xOe,{children:t})]}));En.displayName=Ose.displayName;const SOe=V.forwardRef(({className:e,...t},r)=>h.jsx(Ise,{ref:r,className:fr("-mx-1 my-1 h-px bg-muted",e),...t}));SOe.displayName=Ise.displayName;var EOe="Label",Dse=V.forwardRef((e,t)=>h.jsx(on.label,{...e,ref:t,onMouseDown:r=>{var s;r.target.closest("button, input, select, textarea")||((s=e.onMouseDown)==null||s.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Dse.displayName=EOe;var Lse=Dse;const TOe=Zv("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),yr=V.forwardRef(({className:e,...t},r)=>h.jsx(Lse,{ref:r,className:fr(TOe(),e),...t}));yr.displayName=Lse.displayName;const Lo=i5,tf=s5,AOe=a5,Fse=V.forwardRef(({className:e,...t},r)=>h.jsx(A2,{ref:r,className:fr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Fse.displayName=A2.displayName;const xo=V.forwardRef(({className:e,children:t,...r},n)=>h.jsxs(AOe,{children:[h.jsx(Fse,{}),h.jsxs(C2,{ref:n,className:fr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,h.jsxs(SN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[h.jsx(wu,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));xo.displayName=C2.displayName;const bo=({className:e,...t})=>h.jsx("div",{className:fr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});bo.displayName="DialogHeader";const r_=({className:e,...t})=>h.jsx("div",{className:fr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});r_.displayName="DialogFooter";const wo=V.forwardRef(({className:e,...t},r)=>h.jsx(j2,{ref:r,className:fr("text-lg font-semibold leading-none tracking-tight",e),...t}));wo.displayName=j2.displayName;const pl=V.forwardRef(({className:e,...t},r)=>h.jsx(P2,{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));pl.displayName=P2.displayName;var zse="AlertDialog",[COe,dst]=Fo(zse,[gre]),yp=gre(),Bse=e=>{const{__scopeAlertDialog:t,...r}=e,n=yp(t);return h.jsx(i5,{...n,...r,modal:!0})};Bse.displayName=zse;var jOe="AlertDialogTrigger",$se=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=yp(r);return h.jsx(s5,{...s,...n,ref:t})});$se.displayName=jOe;var POe="AlertDialogPortal",Use=e=>{const{__scopeAlertDialog:t,...r}=e,n=yp(t);return h.jsx(a5,{...n,...r})};Use.displayName=POe;var OOe="AlertDialogOverlay",Vse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=yp(r);return h.jsx(A2,{...s,...n,ref:t})});Vse.displayName=OOe;var L0="AlertDialogContent",[kOe,NOe]=COe(L0),IOe=YJ("AlertDialogContent"),qse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...s}=e,o=yp(r),d=V.useRef(null),i=$n(t,d),m=V.useRef(null);return h.jsx(OTe,{contentName:L0,titleName:Hse,docsSlug:"alert-dialog",children:h.jsx(kOe,{scope:r,cancelRef:m,children:h.jsxs(C2,{role:"alertdialog",...o,...s,ref:i,onOpenAutoFocus:Ir(s.onOpenAutoFocus,y=>{var S;y.preventDefault(),(S=m.current)==null||S.focus({preventScroll:!0})}),onPointerDownOutside:y=>y.preventDefault(),onInteractOutside:y=>y.preventDefault(),children:[h.jsx(IOe,{children:n}),h.jsx(MOe,{contentRef:d})]})})})});qse.displayName=L0;var Hse="AlertDialogTitle",Gse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=yp(r);return h.jsx(j2,{...s,...n,ref:t})});Gse.displayName=Hse;var Wse="AlertDialogDescription",Kse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=yp(r);return h.jsx(P2,{...s,...n,ref:t})});Kse.displayName=Wse;var ROe="AlertDialogAction",Zse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=yp(r);return h.jsx(SN,{...s,...n,ref:t})});Zse.displayName=ROe;var Xse="AlertDialogCancel",Yse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:s}=NOe(Xse,r),o=yp(r),d=$n(t,s);return h.jsx(SN,{...o,...n,ref:d})});Yse.displayName=Xse;var MOe=({contentRef:e})=>{const t=`\`${L0}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${L0}\` by passing a \`${Wse}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${L0}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return V.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},DOe=Bse,LOe=$se,FOe=Use,Jse=Vse,Qse=qse,eae=Zse,tae=Yse,rae=Gse,nae=Kse;const Io=DOe,_b=LOe,zOe=FOe,iae=V.forwardRef(({className:e,...t},r)=>h.jsx(Jse,{className:fr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));iae.displayName=Jse.displayName;const co=V.forwardRef(({className:e,...t},r)=>h.jsxs(zOe,{children:[h.jsx(iae,{}),h.jsx(Qse,{ref:r,className:fr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));co.displayName=Qse.displayName;const uo=({className:e,...t})=>h.jsx("div",{className:fr("flex flex-col space-y-2 text-center sm:text-left",e),...t});uo.displayName="AlertDialogHeader";const ho=({className:e,...t})=>h.jsx("div",{className:fr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});ho.displayName="AlertDialogFooter";const fo=V.forwardRef(({className:e,...t},r)=>h.jsx(rae,{ref:r,className:fr("text-lg font-semibold",e),...t}));fo.displayName=rae.displayName;const po=V.forwardRef(({className:e,...t},r)=>h.jsx(nae,{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));po.displayName=nae.displayName;const to=V.forwardRef(({className:e,...t},r)=>h.jsx(eae,{ref:r,className:fr(fb(),e),...t}));to.displayName=eae.displayName;const mo=V.forwardRef(({className:e,...t},r)=>h.jsx(tae,{ref:r,className:fr(fb({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));mo.displayName=tae.displayName;var BOe=Object.defineProperty,$Oe=Object.defineProperties,UOe=Object.getOwnPropertyDescriptors,_O=Object.getOwnPropertySymbols,sae=Object.prototype.hasOwnProperty,aae=Object.prototype.propertyIsEnumerable,EG=(e,t,r)=>t in e?BOe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,VOe=(e,t)=>{for(var r in t||(t={}))sae.call(t,r)&&EG(e,r,t[r]);if(_O)for(var r of _O(t))aae.call(t,r)&&EG(e,r,t[r]);return e},qOe=(e,t)=>$Oe(e,UOe(t)),HOe=(e,t)=>{var r={};for(var n in e)sae.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&_O)for(var n of _O(e))t.indexOf(n)<0&&aae.call(e,n)&&(r[n]=e[n]);return r};function GOe(e){let t=setTimeout(e,0),r=setTimeout(e,10),n=setTimeout(e,50);return[t,r,n]}function WOe(e){let t=V.useRef();return V.useEffect(()=>{t.current=e}),t.current}var KOe=18,oae=40,ZOe=`${oae}px`,XOe=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function YOe({containerRef:e,inputRef:t,pushPasswordManagerStrategy:r,isFocused:n}){let[s,o]=V.useState(!1),[d,i]=V.useState(!1),[m,y]=V.useState(!1),S=V.useMemo(()=>r==="none"?!1:(r==="increase-width"||r==="experimental-no-flickering")&&s&&d,[s,d,r]),w=V.useCallback(()=>{let T=e.current,A=t.current;if(!T||!A||m||r==="none")return;let O=T,P=O.getBoundingClientRect().left+O.offsetWidth,N=O.getBoundingClientRect().top+O.offsetHeight/2,R=P-KOe,M=N;document.querySelectorAll(XOe).length===0&&document.elementFromPoint(R,M)===T||(o(!0),y(!0))},[e,t,m,r]);return V.useEffect(()=>{let T=e.current;if(!T||r==="none")return;function A(){let P=window.innerWidth-T.getBoundingClientRect().right;i(P>=oae)}A();let O=setInterval(A,1e3);return()=>{clearInterval(O)}},[e,r]),V.useEffect(()=>{let T=n||document.activeElement===t.current;if(r==="none"||!T)return;let A=setTimeout(w,0),O=setTimeout(w,2e3),P=setTimeout(w,5e3),N=setTimeout(()=>{y(!0)},6e3);return()=>{clearTimeout(A),clearTimeout(O),clearTimeout(P),clearTimeout(N)}},[t,n,r,w]),{hasPWMBadge:s,willPushPWMBadge:S,PWM_BADGE_SPACE_WIDTH:ZOe}}var lae=V.createContext({}),cae=V.forwardRef((e,t)=>{var r=e,{value:n,onChange:s,maxLength:o,textAlign:d="left",pattern:i,placeholder:m,inputMode:y="numeric",onComplete:S,pushPasswordManagerStrategy:w="increase-width",pasteTransformer:T,containerClassName:A,noScriptCSSFallback:O=JOe,render:P,children:N}=r,R=HOe(r,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),M,F,B,$,W;let[K,te]=V.useState(typeof R.defaultValue=="string"?R.defaultValue:""),ne=n??K,ae=WOe(ne),re=V.useCallback(It=>{s==null||s(It),te(It)},[s]),ee=V.useMemo(()=>i?typeof i=="string"?new RegExp(i):i:null,[i]),ie=V.useRef(null),de=V.useRef(null),be=V.useRef({value:ne,onChange:re,isIOS:typeof window<"u"&&((F=(M=window==null?void 0:window.CSS)==null?void 0:M.supports)==null?void 0:F.call(M,"-webkit-touch-callout","none"))}),Se=V.useRef({prev:[(B=ie.current)==null?void 0:B.selectionStart,($=ie.current)==null?void 0:$.selectionEnd,(W=ie.current)==null?void 0:W.selectionDirection]});V.useImperativeHandle(t,()=>ie.current,[]),V.useEffect(()=>{let It=ie.current,ir=de.current;if(!It||!ir)return;be.current.value!==It.value&&be.current.onChange(It.value),Se.current.prev=[It.selectionStart,It.selectionEnd,It.selectionDirection];function Dr(){if(document.activeElement!==It){pe(null),Xe(null);return}let zt=It.selectionStart,Je=It.selectionEnd,pt=It.selectionDirection,rt=It.maxLength,Kt=It.value,Ut=Se.current.prev,Ht=-1,Cr=-1,un;if(Kt.length!==0&&zt!==null&&Je!==null){let Mi=zt===Je,Pa=zt===Kt.length&&Kt.length<rt;if(Mi&&!Pa){let _s=zt;if(_s===0)Ht=0,Cr=1,un="forward";else if(_s===rt)Ht=_s-1,Cr=_s,un="backward";else if(rt>1&&Kt.length>1){let mi=0;if(Ut[0]!==null&&Ut[1]!==null){un=_s<Ut[1]?"backward":"forward";let Ua=Ut[0]===Ut[1]&&Ut[0]<rt;un==="backward"&&!Ua&&(mi=-1)}Ht=mi+_s,Cr=mi+_s+1}}Ht!==-1&&Cr!==-1&&Ht!==Cr&&ie.current.setSelectionRange(Ht,Cr,un)}let hn=Ht!==-1?Ht:zt,Kn=Cr!==-1?Cr:Je,Gn=un??pt;pe(hn),Xe(Kn),Se.current.prev=[hn,Kn,Gn]}if(document.addEventListener("selectionchange",Dr,{capture:!0}),Dr(),document.activeElement===It&&Ce(!0),!document.getElementById("input-otp-style")){let zt=document.createElement("style");if(zt.id="input-otp-style",document.head.appendChild(zt),zt.sheet){let Je="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";qS(zt.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),qS(zt.sheet,`[data-input-otp]:autofill { ${Je} }`),qS(zt.sheet,`[data-input-otp]:-webkit-autofill { ${Je} }`),qS(zt.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),qS(zt.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let Rr=()=>{ir&&ir.style.setProperty("--root-height",`${It.clientHeight}px`)};Rr();let jt=new ResizeObserver(Rr);return jt.observe(It),()=>{document.removeEventListener("selectionchange",Dr,{capture:!0}),jt.disconnect()}},[]);let[Ae,xe]=V.useState(!1),[me,Ce]=V.useState(!1),[ge,pe]=V.useState(null),[Oe,Xe]=V.useState(null);V.useEffect(()=>{GOe(()=>{var It,ir,Dr,Rr;(It=ie.current)==null||It.dispatchEvent(new Event("input"));let jt=(ir=ie.current)==null?void 0:ir.selectionStart,zt=(Dr=ie.current)==null?void 0:Dr.selectionEnd,Je=(Rr=ie.current)==null?void 0:Rr.selectionDirection;jt!==null&&zt!==null&&(pe(jt),Xe(zt),Se.current.prev=[jt,zt,Je])})},[ne,me]),V.useEffect(()=>{ae!==void 0&&ne!==ae&&ae.length<o&&ne.length===o&&(S==null||S(ne))},[o,S,ae,ne]);let We=YOe({containerRef:de,inputRef:ie,pushPasswordManagerStrategy:w,isFocused:me}),$e=V.useCallback(It=>{let ir=It.currentTarget.value.slice(0,o);if(ir.length>0&&ee&&!ee.test(ir)){It.preventDefault();return}typeof ae=="string"&&ir.length<ae.length&&document.dispatchEvent(new Event("selectionchange")),re(ir)},[o,re,ae,ee]),Ke=V.useCallback(()=>{var It;if(ie.current){let ir=Math.min(ie.current.value.length,o-1),Dr=ie.current.value.length;(It=ie.current)==null||It.setSelectionRange(ir,Dr),pe(ir),Xe(Dr)}Ce(!0)},[o]),Le=V.useCallback(It=>{var ir,Dr;let Rr=ie.current;if(!T&&(!be.current.isIOS||!It.clipboardData||!Rr))return;let jt=It.clipboardData.getData("text/plain"),zt=T?T(jt):jt;It.preventDefault();let Je=(ir=ie.current)==null?void 0:ir.selectionStart,pt=(Dr=ie.current)==null?void 0:Dr.selectionEnd,rt=(Je!==pt?ne.slice(0,Je)+zt+ne.slice(pt):ne.slice(0,Je)+zt+ne.slice(Je)).slice(0,o);if(rt.length>0&&ee&&!ee.test(rt))return;Rr.value=rt,re(rt);let Kt=Math.min(rt.length,o-1),Ut=rt.length;Rr.setSelectionRange(Kt,Ut),pe(Kt),Xe(Ut)},[o,re,ee,ne]),ke=V.useMemo(()=>({position:"relative",cursor:R.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[R.disabled]),st=V.useMemo(()=>({position:"absolute",inset:0,width:We.willPushPWMBadge?`calc(100% + ${We.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:We.willPushPWMBadge?`inset(0 ${We.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:d,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[We.PWM_BADGE_SPACE_WIDTH,We.willPushPWMBadge,d]),_t=V.useMemo(()=>V.createElement("input",qOe(VOe({autoComplete:R.autoComplete||"one-time-code"},R),{"data-input-otp":!0,"data-input-otp-placeholder-shown":ne.length===0||void 0,"data-input-otp-mss":ge,"data-input-otp-mse":Oe,inputMode:y,pattern:ee==null?void 0:ee.source,"aria-placeholder":m,style:st,maxLength:o,value:ne,ref:ie,onPaste:It=>{var ir;Le(It),(ir=R.onPaste)==null||ir.call(R,It)},onChange:$e,onMouseOver:It=>{var ir;xe(!0),(ir=R.onMouseOver)==null||ir.call(R,It)},onMouseLeave:It=>{var ir;xe(!1),(ir=R.onMouseLeave)==null||ir.call(R,It)},onFocus:It=>{var ir;Ke(),(ir=R.onFocus)==null||ir.call(R,It)},onBlur:It=>{var ir;Ce(!1),(ir=R.onBlur)==null||ir.call(R,It)}})),[$e,Ke,Le,y,st,o,Oe,ge,R,ee==null?void 0:ee.source,ne]),Be=V.useMemo(()=>({slots:Array.from({length:o}).map((It,ir)=>{var Dr;let Rr=me&&ge!==null&&Oe!==null&&(ge===Oe&&ir===ge||ir>=ge&&ir<Oe),jt=ne[ir]!==void 0?ne[ir]:null,zt=ne[0]!==void 0?null:(Dr=m==null?void 0:m[ir])!=null?Dr:null;return{char:jt,placeholderChar:zt,isActive:Rr,hasFakeCaret:Rr&&jt===null}}),isFocused:me,isHovering:!R.disabled&&Ae}),[me,Ae,o,Oe,ge,R.disabled,ne]),Dt=V.useMemo(()=>P?P(Be):V.createElement(lae.Provider,{value:Be},N),[N,Be,P]);return V.createElement(V.Fragment,null,O!==null&&V.createElement("noscript",null,V.createElement("style",null,O)),V.createElement("div",{ref:de,"data-input-otp-container":!0,style:ke,className:A},Dt,V.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},_t)))});cae.displayName="Input";function qS(e,t){try{e.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var JOe=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const D5=V.forwardRef(({className:e,containerClassName:t,...r},n)=>h.jsx(cae,{ref:n,containerClassName:fr("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:fr("disabled:cursor-not-allowed",e),...r}));D5.displayName="InputOTP";const L5=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,className:fr("flex items-center",e),...t}));L5.displayName="InputOTPGroup";const qf=V.forwardRef(({index:e,className:t,...r},n)=>{const s=V.useContext(lae),{char:o,hasFakeCaret:d,isActive:i}=s.slots[e];return h.jsxs("div",{ref:n,className:fr("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",i&&"z-10 ring-2 ring-ring ring-offset-background",t),...r,children:[o,d&&h.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:h.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});qf.displayName="InputOTPSlot";const QOe=V.forwardRef(({...e},t)=>h.jsx("div",{ref:t,role:"separator",...e,children:h.jsx(j_e,{})}));QOe.displayName="InputOTPSeparator";const F5=({targetType:e,targetId:t,trigger:r})=>{const{t:n}=ei(),{user:s}=Qn(),[o,d]=V.useState(!1),[i,m]=V.useState(!1),[y,S]=V.useState(!1),[w,T]=V.useState(""),[A,O]=V.useState(""),[P,N]=V.useState((s==null?void 0:s.email)||""),[R,M]=V.useState([""]),[F,B]=V.useState([]),[$,W]=V.useState(!1),[K,te]=V.useState("form"),[ne,ae]=V.useState(""),[re,ee]=V.useState(0),[ie,de]=V.useState(!1),be=ke=>{d(ke),ke&&(s!=null&&s.email)&&N(s.email),ke||(te("form"),ae(""),ee(0))};V.useEffect(()=>{let ke;return re>0&&(ke=setTimeout(()=>ee(re-1),1e3)),()=>clearTimeout(ke)},[re]);const Se=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"],Ae=()=>{M([...R,""])},xe=ke=>{M(R.filter((st,_t)=>_t!==ke))},me=(ke,st)=>{const _t=[...R];_t[ke]=st,M(_t)},Ce=ke=>{const st=Array.from(ke.target.files||[]);if(st.filter(It=>It.size>5*1024*1024).length>0){Nr.error(n("report.imageTooLarge"));return}const Be=["image/jpeg","image/png","image/webp","image/gif"];if(st.filter(It=>!Be.includes(It.type)).length>0){Nr.error(n("report.invalidImageType"));return}B(It=>[...It,...st])},ge=ke=>{B(st=>st.filter((_t,Be)=>Be!==ke))},pe=async()=>{if(F.length===0)return[];W(!0);const ke=[];try{for(const st of F){const _t=st.name.split(".").pop(),Dt=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${_t}`}`,{error:It}=await Ct.storage.from("report-evidence").upload(Dt,st);if(It)throw It;const{data:ir}=Ct.storage.from("report-evidence").getPublicUrl(Dt);ke.push(ir.publicUrl)}return ke}catch(st){throw console.error("Error uploading images:",st),st}finally{W(!1)}},Oe=async()=>{if(!P.trim()){Nr.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P)){Nr.error(n("report.invalidEmail"));return}de(!0);try{const{error:ke}=await Ct.functions.invoke("send-verification-code",{body:{email:P}});if(ke){Nr.error(n("auth.verificationCodeFailed")),console.error(ke);return}te("verify"),Nr.success(n("auth.verificationCodeSent")),ee(30)}catch(ke){Nr.error(ke.message||n("error.general"))}finally{de(!1)}},Xe=async()=>{re>0||await Oe()},We=async()=>{if(ne.length!==4){Nr.error(n("auth.invalidVerificationCode"));return}S(!0);try{const{data:ke,error:st}=await Ct.functions.invoke("verify-email-code",{body:{email:P,code:ne}});if(st||!(ke!=null&&ke.success)){(ke==null?void 0:ke.error)==="This verification code has already been used"?Nr.error(n("auth.verificationCodeUsed")):Nr.error((ke==null?void 0:ke.error)||n("auth.invalidVerificationCode")),S(!1);return}te("submitting"),await Ke()}catch(ke){Nr.error(ke.message||n("error.general")),S(!1)}},$e=async()=>{if(!w){Nr.error(n("report.reasonPlaceholder"));return}if(!A||A.length<20){Nr.error(n("report.detailsMin"));return}if(!P.trim()){Nr.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P)){Nr.error(n("report.invalidEmail"));return}if(R.filter(st=>st.trim()!=="").length===0&&F.length===0){Nr.error(n("report.evidenceRequired"));return}s?m(!0):await Oe()},Ke=async()=>{S(!0);try{let ke=[];try{ke=await pe()}catch{Nr.error(n("report.imageUploadFailed")),S(!1);return}const _t=[...R.filter(jt=>jt.trim()!==""),...ke],Be={reporter_id:(s==null?void 0:s.id)||null,target_type:e,target_id:t,reason:w,description:A,evidence_urls:_t,reporter_contact:P};console.log("Attempting to insert report:",Be);const{data:Dt,error:It}=await Ct.from("reports").insert(Be).select().single();if(console.log("Insert result:",{report:Dt,error:It}),It)throw It;let ir="Anonymous",Dr=P;if(s){const{data:jt}=await Ct.from("profiles").select("display_name").eq("id",s.id).single();ir=(jt==null?void 0:jt.display_name)||"Unknown",Dr=s.email||P}await Ct.functions.invoke("send-report-email",{body:{reportId:Dt.id,reporterName:ir,reporterEmail:Dr,targetType:e,targetId:t,reason:w,description:A,evidenceUrls:_t.length>0?_t:void 0,reporterContact:P||void 0}});const Rr=Dt.id.substring(0,8).toUpperCase();Nr.success(n("report.successDetailed",{reference:Rr}),{description:n("report.successDescription"),duration:8e3}),d(!1),m(!1),T(""),O(""),s||N(""),M([""]),B([]),te("form"),ae("")}catch(ke){console.error("Error submitting report:",ke),Nr.error(n("report.failed"))}finally{S(!1)}},Le=()=>{switch(e){case"comment":return n("report.reportComment");case"restaurant":return n("report.reportRestaurant");case"activity":return n("report.reportActivity");case"user":return n("report.reportUser");default:return n("report.title")}};return h.jsxs(h.Fragment,{children:[h.jsxs(Lo,{open:o,onOpenChange:be,children:[h.jsx(tf,{asChild:!0,children:r||h.jsxs(Mt,{variant:"ghost",size:"sm",children:[h.jsx(iN,{className:"w-4 h-4 mr-2"}),n("report.title")]})}),h.jsxs(xo,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[h.jsxs(bo,{children:[h.jsx(wo,{children:Le()}),h.jsx(pl,{children:n(K==="verify"?"auth.verificationCodeSent":"report.description")})]}),K==="form"?h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"space-y-4 py-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"reason",children:n("report.reason")}),h.jsxs(Aa,{value:w,onValueChange:T,children:[h.jsx(ya,{children:h.jsx(Ca,{placeholder:n("report.reasonPlaceholder")})}),h.jsx(va,{children:Se.map(ke=>h.jsx(En,{value:ke,children:n(`report.reasons.${ke}`)},ke))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"description",children:n("report.detailsLabel")}),h.jsx(fl,{id:"description",value:A,onChange:ke=>O(ke.target.value),placeholder:n("report.detailsPlaceholder"),rows:5,className:"resize-none"}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:[A.length,"/20 ",n("common.characters")]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"contact",children:[n("report.contactLabel"),h.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),h.jsx(cr,{id:"contact",type:"email",value:P,onChange:ke=>N(ke.target.value),placeholder:n("report.contactPlaceholder"),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{children:[n("report.evidenceLabel"),h.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),h.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:n("report.evidenceRequiredNote")}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"image-upload",className:"text-sm font-medium",children:n("report.uploadImages")}),h.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:F.map((ke,st)=>h.jsxs("div",{className:"relative group",children:[h.jsx("img",{src:URL.createObjectURL(ke),alt:`Evidence ${st+1}`,className:"w-20 h-20 object-cover rounded border"}),h.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>ge(st),children:h.jsx(wu,{className:"w-3 h-3"})})]},st))}),h.jsx(cr,{id:"image-upload",type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",multiple:!0,onChange:Ce,className:"cursor-pointer"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:n("report.imageUploadHint")})]}),h.jsxs("div",{className:"space-y-2 pt-2",children:[h.jsx(yr,{className:"text-sm font-medium",children:n("report.evidenceUrls")}),R.map((ke,st)=>h.jsxs("div",{className:"flex gap-2",children:[h.jsx(cr,{value:ke,onChange:_t=>me(st,_t.target.value),placeholder:n("report.evidencePlaceholder")}),R.length>1&&h.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>xe(st),children:h.jsx(wu,{className:"w-4 h-4"})})]},st)),h.jsxs(Mt,{variant:"outline",size:"sm",onClick:Ae,className:"w-full",children:[h.jsx(ap,{className:"w-4 h-4 mr-2"}),n("report.addEvidence")]})]})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(Mt,{variant:"outline",onClick:()=>d(!1),children:n("report.cancel")}),h.jsx(Mt,{onClick:$e,disabled:!w||A.length<20||!P.trim()||R.filter(ke=>ke.trim()!=="").length===0&&F.length===0||$||ie,children:n($?"common.uploading":ie?"auth.sendingCode":"report.submit")})]})]}):K==="submitting"?h.jsx("div",{className:"space-y-4 py-8",children:h.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),h.jsx("p",{className:"text-center text-muted-foreground",children:n("report.submitting")})]})}):h.jsxs("div",{className:"space-y-4 py-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:n("auth.verificationCode")}),h.jsx("div",{className:"flex justify-center",children:h.jsx(D5,{maxLength:4,value:ne,onChange:ke=>ae(ke),children:h.jsxs(L5,{children:[h.jsx(qf,{index:0}),h.jsx(qf,{index:1}),h.jsx(qf,{index:2}),h.jsx(qf,{index:3})]})})}),h.jsx("p",{className:"text-xs text-muted-foreground text-center",children:n("auth.verificationCodeHint",{email:P})})]}),h.jsx("div",{className:"flex justify-center",children:h.jsx(Mt,{variant:"link",size:"sm",onClick:Xe,disabled:re>0||y,children:re>0?`${n("auth.resendCode")} (${re}s)`:n("auth.resendCode")})}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Mt,{variant:"outline",className:"w-full",onClick:()=>{te("form"),ae("")},disabled:y,children:n("common.back")}),h.jsx(Mt,{className:"w-full",onClick:We,disabled:ne.length!==4||y,children:n(y?"auth.verifying":"auth.verify")})]})]})]})]}),h.jsx(Io,{open:i,onOpenChange:m,children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:n("report.confirmTitle")}),h.jsx(po,{children:n("report.confirmMessage")})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:n("report.cancel")}),h.jsx(to,{onClick:Ke,disabled:y,children:n(y?"report.submitting":"report.submit")})]})]})})]})},TG=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],uae=({restaurantId:e,targetType:t="restaurant"})=>{var Oe,Xe;const{t:r}=ei(),{user:n}=Qn(),{data:s}=jN(),{toast:o}=Ii(),[d,i]=V.useState(""),[m,y]=V.useState(0),[S,w]=V.useState(0),[T,A]=V.useState(""),[O,P]=V.useState(null),[N,R]=V.useState(""),[M,F]=V.useState(null),[B,$]=V.useState(null),[W,K]=V.useState(null),[te,ne]=V.useState(null),[ae,re]=V.useState(!1),{data:ee,isLoading:ie}=R5(e,t),de=qPe(),be=HPe(),Se=V.useCallback(async We=>{try{const $e=We.name.split(".").pop(),Le=`${`${n==null?void 0:n.id}-${Date.now()}.${$e}`}`,{error:ke,data:st}=await Ct.storage.from("comment-images").upload(Le,We);if(ke)throw ke;const{data:{publicUrl:_t}}=Ct.storage.from("comment-images").getPublicUrl(Le);return _t}catch($e){return console.error("Error uploading image:",$e),o({title:r("common.error"),description:r("restaurant.imageUploadFailed"),variant:"destructive"}),null}},[n,o,r]),Ae=V.useCallback((We,$e=!1)=>{var Le;const Ke=(Le=We.target.files)==null?void 0:Le[0];if(Ke){if(Ke.size>5*1024*1024){o({title:r("common.error"),description:r("restaurant.imageTooLarge"),variant:"destructive"});return}$e?(K(Ke),ne(URL.createObjectURL(Ke))):(F(Ke),$(URL.createObjectURL(Ke)))}},[o,r]),xe=V.useCallback((We=!1)=>{We?(K(null),ne(null)):(F(null),$(null))},[]),me=V.useCallback(async()=>{if(!d.trim()||!n)return;if(t==="restaurant"&&!m){o({title:r("common.error"),description:r("toast.pleaseSelectRating"),variant:"destructive"});return}re(!0);let We;if(M){const $e=await Se(M);$e&&(We=$e)}await de.mutateAsync({targetId:e,targetType:t,content:d,ratingValue:t==="restaurant"?m:void 0,priceRange:t==="restaurant"&&T?T:void 0,imageUrl:We}),i(""),y(0),A(""),F(null),$(null),re(!1)},[d,n,t,m,o,r,M,Se,de,e,T]),Ce=V.useCallback(async We=>{if(!N.trim()||!n)return;re(!0);let $e;if(W){const Ke=await Se(W);Ke&&($e=Ke)}await de.mutateAsync({targetId:e,targetType:t,content:N,parentId:We,imageUrl:$e}),R(""),P(null),K(null),ne(null),re(!1)},[N,n,W,Se,de,e,t]),ge=V.useCallback(async We=>{window.confirm(r("restaurant.confirmDelete"))&&await be.mutateAsync(We)},[be,r]),pe=V.memo(({comment:We,isReply:$e=!1})=>{var Ke,Le,ke,st,_t;return h.jsxs("div",{className:`flex gap-2 sm:gap-3 ${$e?"ml-8 sm:ml-12 mt-3":""}`,children:[h.jsxs(qh,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[h.jsx(Hh,{src:(Ke=We.profiles)==null?void 0:Ke.avatar_url}),h.jsx(Gh,{className:"text-xs sm:text-sm",children:((ke=(Le=We.profiles)==null?void 0:Le.display_name)==null?void 0:ke.charAt(0).toUpperCase())||"U"})]}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[h.jsx("span",{className:"font-semibold text-xs sm:text-sm truncate",children:(st=We.profiles)==null?void 0:st.display_name}),h.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:Tg(new Date(We.created_at),{addSuffix:!0})}),We.edited&&h.jsxs("span",{className:"text-xs text-muted-foreground italic",children:["(",r("restaurant.edited"),")"]})]}),!$e&&We.rating_value&&h.jsxs("div",{className:"flex items-center gap-3 mt-1 mb-2",children:[h.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(Be=>h.jsx(Cl,{className:fr("w-4 h-4",Be<=We.rating_value?"fill-accent text-accent":"text-muted-foreground")},Be))}),We.price_range&&h.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[h.jsx(UP,{className:"w-3 h-3"}),h.jsx("span",{children:(_t=TG.find(Be=>Be.value===We.price_range))==null?void 0:_t.label})]})]}),h.jsx("p",{className:"text-xs sm:text-sm mt-1 text-foreground break-words",children:We.content}),We.image_url&&h.jsx("img",{src:We.image_url,alt:"Comment attachment",className:"mt-2 rounded-lg max-w-full sm:max-w-sm w-full"}),h.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-2",children:[!$e&&n&&h.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>P(We.id),className:"h-7 text-xs px-2 sm:px-3",children:[h.jsx(z_e,{className:"w-3 h-3 mr-1"}),h.jsx("span",{className:"hidden xs:inline",children:r("restaurant.reply")})]}),(n==null?void 0:n.id)===We.user_id&&h.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>ge(We.id),className:"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3",children:[h.jsx(Yh,{className:"w-3 h-3 mr-1"}),h.jsx("span",{className:"hidden xs:inline",children:r("common.delete")})]}),n&&n.id!==We.user_id&&h.jsx(F5,{targetType:"comment",targetId:We.id,trigger:h.jsxs(Mt,{variant:"ghost",size:"sm",className:"h-7 text-xs px-2 sm:px-3",children:[h.jsx(iN,{className:"w-3 h-3 mr-1"}),h.jsx("span",{className:"hidden xs:inline",children:r("report.title")})]})})]}),O===We.id&&h.jsx("div",{className:"mt-3 space-y-2",children:h.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[h.jsxs("div",{className:"flex-1 space-y-2",children:[h.jsx(fl,{value:N,onChange:Be=>R(Be.target.value),placeholder:r("restaurant.writeReply"),className:"min-h-[80px] text-sm"}),te&&h.jsxs("div",{className:"relative inline-block max-w-full",children:[h.jsx("img",{src:te,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),h.jsx(Mt,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>xe(!0),children:h.jsx(wu,{className:"h-4 w-4"})})]})]}),h.jsxs("div",{className:"flex sm:flex-col gap-2",children:[h.jsx(Mt,{size:"sm",onClick:()=>Ce(We.id),disabled:!N.trim()||ae,className:"text-xs",children:r(ae?"common.loading":"restaurant.reply")}),h.jsx(cr,{type:"file",accept:"image/*",onChange:Be=>Ae(Be,!0),className:"hidden",id:`reply-image-${We.id}`,disabled:ae}),h.jsxs(Mt,{size:"sm",variant:"outline",onClick:()=>{var Be;return(Be=document.getElementById(`reply-image-${We.id}`))==null?void 0:Be.click()},disabled:ae,className:"text-xs sm:px-3",children:[h.jsx(L9,{className:"h-4 w-4 sm:mr-1"}),h.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),h.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>{P(null),R(""),xe(!0)},className:"text-xs",children:r("common.cancel")})]})]})}),We.replies&&We.replies.length>0&&h.jsx("div",{className:"mt-3 space-y-3",children:We.replies.map(Be=>h.jsx(pe,{comment:Be,isReply:!0},Be.id))})]})]})});return pe.displayName="CommentItem",ie?h.jsx("div",{className:"text-center py-8",children:r("common.loading")}):h.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(qP,{className:"w-4 sm:w-5 h-4 sm:h-5"}),h.jsxs("h2",{className:"text-xl sm:text-2xl font-bold",children:[r("restaurant.reviews")," (",(ee==null?void 0:ee.length)||0,")"]})]}),n?h.jsx(kr,{children:h.jsx(Mr,{className:"pt-4 sm:pt-6 px-3 sm:px-6",children:h.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[h.jsxs(qh,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[h.jsx(Hh,{src:(s==null?void 0:s.avatar_url)||void 0}),h.jsx(Gh,{className:"text-xs sm:text-sm",children:((Oe=s==null?void 0:s.display_name)==null?void 0:Oe.charAt(0).toUpperCase())||((Xe=n==null?void 0:n.email)==null?void 0:Xe.charAt(0).toUpperCase())||"U"})]}),h.jsxs("div",{className:"flex-1 space-y-2 sm:space-y-3 min-w-0",children:[t==="restaurant"&&h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(Cl,{className:"w-4 h-4 text-accent"})," ",h.jsx("span",{className:"text-destructive",children:"*"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(We=>h.jsx("button",{type:"button",onMouseEnter:()=>w(We),onMouseLeave:()=>w(0),onClick:()=>y(We),className:"transition-transform hover:scale-110",children:h.jsx(Cl,{className:fr("w-7 h-7 cursor-pointer transition-colors",We<=(S||m)?"fill-accent text-accent":"text-muted-foreground hover:text-accent")})},We)),m>0&&h.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",m,"/5)"]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(UP,{className:"w-4 h-4"}),r("restaurant.priceRange")]}),h.jsxs(Aa,{value:T,onValueChange:A,children:[h.jsx(ya,{className:"w-full",children:h.jsx(Ca,{placeholder:r("restaurant.selectPriceRange")})}),h.jsx(va,{className:"bg-background",children:TG.map(We=>h.jsx(En,{value:We.value,children:We.label},We.value))})]})]})]}),h.jsx(fl,{value:d,onChange:We=>i(We.target.value),placeholder:r("restaurant.writeComment"),className:"min-h-[80px] sm:min-h-[100px] text-sm"}),B&&h.jsxs("div",{className:"relative inline-block max-w-full",children:[h.jsx("img",{src:B,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),h.jsx(Mt,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>xe(!1),children:h.jsx(wu,{className:"h-4 w-4"})})]}),h.jsxs("div",{className:"flex flex-wrap gap-2",children:[h.jsx(cr,{type:"file",accept:"image/*",onChange:We=>Ae(We,!1),className:"hidden",id:"comment-image",disabled:ae}),h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{var We;return(We=document.getElementById("comment-image"))==null?void 0:We.click()},disabled:ae,className:"text-xs",children:[h.jsx(L9,{className:"h-4 w-4 sm:mr-2"}),h.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),h.jsx(Mt,{onClick:me,disabled:!d.trim()||de.isPending||ae,size:"sm",className:"text-xs",children:ae||de.isPending?r("common.loading"):r("restaurant.postComment")})]})]})]})})}):h.jsx(kr,{children:h.jsx(Mr,{className:"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.signInToComment")})}),h.jsx("div",{className:"space-y-4 sm:space-y-6",children:ee==null?void 0:ee.map(We=>h.jsx(kr,{children:h.jsx(Rn,{className:"p-3 sm:p-6",children:h.jsx(pe,{comment:We})})},We.id))}),(ee==null?void 0:ee.length)===0&&h.jsx(kr,{children:h.jsx(Mr,{className:"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.noComments")})})]})},D2=()=>{const{user:e}=Qn();return ci({queryKey:["merchantRestaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("merchant_restaurants").select(`
          restaurant_id,
          restaurants:restaurant_id (
            id,
            name,
            name_en,
            name_pt,
            address,
            image_url,
            lat,
            lng,
            rating,
            type,
            type_en,
            type_pt,
            phone,
            website_url,
            description,
            description_en,
            description_pt,
            opening_hours,
            show_website_button,
            created_at,
            updated_at
          )
        `).eq("user_id",e.id);if(r)throw r;return(t==null?void 0:t.map(n=>n.restaurants).filter(Boolean))||[]},enabled:!!e})},eke=e=>{const{user:t}=Qn(),{data:r=[]}=D2();return ci({queryKey:["myParticipatingRestaurants",e,t==null?void 0:t.id],queryFn:async()=>{if(!t||r.length===0)return[];const n=r.map(d=>d.id),{data:s,error:o}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",e).in("restaurant_id",n);if(o)throw o;return(s==null?void 0:s.map(d=>d.restaurant_id))||[]},enabled:!!t&&!!e&&r.length>0})},tke=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async({activityId:n,restaurantId:s,skipTermsCheck:o=!1})=>{if(!e)throw new Error("User not authenticated");if(!o){const{data:i}=await Ct.from("profiles").select("activity_terms_agreed").eq("id",e.id).single(),{data:m}=await Ct.from("activity_restaurants").select("id").eq("activity_id",n).eq("restaurant_id",s).maybeSingle();if(!m&&!(i!=null&&i.activity_terms_agreed))throw new Error("TERMS_NOT_AGREED")}const{data:d}=await Ct.from("activity_restaurants").select("id").eq("activity_id",n).eq("restaurant_id",s).maybeSingle();if(d){const{error:i}=await Ct.from("activity_restaurants").delete().eq("id",d.id);if(i)throw i;return{action:"removed"}}else{const{error:i}=await Ct.from("activity_restaurants").insert({activity_id:n,restaurant_id:s});if(i)throw i;return{action:"added"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["activityRestaurants"]}),r.invalidateQueries({queryKey:["myParticipatingRestaurants"]}),t({title:Pr.t(n.action==="added"?"toast.restaurantJoined":"toast.restaurantLeft"),description:Pr.t(n.action==="added"?"toast.restaurantJoinedDesc":"toast.restaurantLeftDesc")})},onError:n=>{n.message==="TERMS_NOT_AGREED"?t({title:Pr.t("toast.termsNotAgreed"),description:Pr.t("toast.termsNotAgreedDesc"),variant:"destructive"}):t({title:Pr.t("toast.participationUpdateFailed"),description:Pr.t("toast.participationUpdateFailedDesc"),variant:"destructive"})}})};var L2=e=>e.type==="checkbox",Qy=e=>e instanceof Date,uc=e=>e==null;const dae=e=>typeof e=="object";var _o=e=>!uc(e)&&!Array.isArray(e)&&dae(e)&&!Qy(e),hae=e=>_o(e)&&e.target?L2(e.target)?e.target.checked:e.target.value:e,rke=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,fae=(e,t)=>e.has(rke(t)),nke=e=>{const t=e.constructor&&e.constructor.prototype;return _o(t)&&t.hasOwnProperty("isPrototypeOf")},z5=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ko(e){let t;const r=Array.isArray(e),n=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(z5&&(e instanceof Blob||n))&&(r||_o(e)))if(t=r?[]:{},!r&&!nke(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=Ko(e[s]));else return e;return t}var BN=e=>/^\w*$/.test(e),lo=e=>e===void 0,B5=e=>Array.isArray(e)?e.filter(Boolean):[],$5=e=>B5(e.replace(/["|']|\]/g,"").split(/\.|\[/)),sn=(e,t,r)=>{if(!t||!_o(e))return r;const n=(BN(t)?[t]:$5(t)).reduce((s,o)=>uc(s)?s:s[o],e);return lo(n)||n===e?lo(e[t])?r:e[t]:n},cu=e=>typeof e=="boolean",Us=(e,t,r)=>{let n=-1;const s=BN(t)?[t]:$5(t),o=s.length,d=o-1;for(;++n<o;){const i=s[n];let m=r;if(n!==d){const y=e[i];m=_o(y)||Array.isArray(y)?y:isNaN(+s[n+1])?{}:[]}if(i==="__proto__"||i==="constructor"||i==="prototype")return;e[i]=m,e=e[i]}};const xO={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Ld={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Of={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},U5=Ve.createContext(null);U5.displayName="HookFormContext";const $N=()=>Ve.useContext(U5),ike=e=>{const{children:t,...r}=e;return Ve.createElement(U5.Provider,{value:r},t)};var pae=(e,t,r,n=!0)=>{const s={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(s,o,{get:()=>{const d=o;return t._proxyFormState[d]!==Ld.all&&(t._proxyFormState[d]=!n||Ld.all),r&&(r[d]=!0),e[d]}});return s};const V5=typeof window<"u"?Ve.useLayoutEffect:Ve.useEffect;function ske(e){const t=$N(),{control:r=t.control,disabled:n,name:s,exact:o}=e||{},[d,i]=Ve.useState(r._formState),m=Ve.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return V5(()=>r._subscribe({name:s,formState:m.current,exact:o,callback:y=>{!n&&i({...r._formState,...y})}}),[s,n,o]),Ve.useEffect(()=>{m.current.isValid&&r._setValid(!0)},[r]),Ve.useMemo(()=>pae(d,r,m.current,!1),[d,r])}var Oh=e=>typeof e=="string",mae=(e,t,r,n,s)=>Oh(e)?(n&&t.watch.add(e),sn(r,e,s)):Array.isArray(e)?e.map(o=>(n&&t.watch.add(o),sn(r,o))):(n&&(t.watchAll=!0),r),kF=e=>uc(e)||!dae(e);function Bf(e,t,r=new WeakSet){if(kF(e)||kF(t))return e===t;if(Qy(e)&&Qy(t))return e.getTime()===t.getTime();const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const o of n){const d=e[o];if(!s.includes(o))return!1;if(o!=="ref"){const i=t[o];if(Qy(d)&&Qy(i)||_o(d)&&_o(i)||Array.isArray(d)&&Array.isArray(i)?!Bf(d,i,r):d!==i)return!1}}return!0}function ake(e){const t=$N(),{control:r=t.control,name:n,defaultValue:s,disabled:o,exact:d,compute:i}=e||{},m=Ve.useRef(s),y=Ve.useRef(i),S=Ve.useRef(void 0);y.current=i;const w=Ve.useMemo(()=>r._getWatch(n,m.current),[r,n]),[T,A]=Ve.useState(y.current?y.current(w):w);return V5(()=>r._subscribe({name:n,formState:{values:!0},exact:d,callback:O=>{if(!o){const P=mae(n,r._names,O.values||r._formValues,!1,m.current);if(y.current){const N=y.current(P);Bf(N,S.current)||(A(N),S.current=N)}else A(P)}}}),[r,o,n,d]),Ve.useEffect(()=>r._removeUnmounted()),T}function oke(e){const t=$N(),{name:r,disabled:n,control:s=t.control,shouldUnregister:o,defaultValue:d}=e,i=fae(s._names.array,r),m=Ve.useMemo(()=>sn(s._formValues,r,sn(s._defaultValues,r,d)),[s,r,d]),y=ake({control:s,name:r,defaultValue:m,exact:!0}),S=ske({control:s,name:r,exact:!0}),w=Ve.useRef(e),T=Ve.useRef(s.register(r,{...e.rules,value:y,...cu(e.disabled)?{disabled:e.disabled}:{}}));w.current=e;const A=Ve.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!sn(S.errors,r)},isDirty:{enumerable:!0,get:()=>!!sn(S.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!sn(S.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!sn(S.validatingFields,r)},error:{enumerable:!0,get:()=>sn(S.errors,r)}}),[S,r]),O=Ve.useCallback(M=>T.current.onChange({target:{value:hae(M),name:r},type:xO.CHANGE}),[r]),P=Ve.useCallback(()=>T.current.onBlur({target:{value:sn(s._formValues,r),name:r},type:xO.BLUR}),[r,s._formValues]),N=Ve.useCallback(M=>{const F=sn(s._fields,r);F&&M&&(F._f.ref={focus:()=>M.focus&&M.focus(),select:()=>M.select&&M.select(),setCustomValidity:B=>M.setCustomValidity(B),reportValidity:()=>M.reportValidity()})},[s._fields,r]),R=Ve.useMemo(()=>({name:r,value:y,...cu(n)||S.disabled?{disabled:S.disabled||n}:{},onChange:O,onBlur:P,ref:N}),[r,n,S.disabled,O,P,N,y]);return Ve.useEffect(()=>{const M=s._options.shouldUnregister||o;s.register(r,{...w.current.rules,...cu(w.current.disabled)?{disabled:w.current.disabled}:{}});const F=(B,$)=>{const W=sn(s._fields,B);W&&W._f&&(W._f.mount=$)};if(F(r,!0),M){const B=Ko(sn(s._options.defaultValues,r));Us(s._defaultValues,r,B),lo(sn(s._formValues,r))&&Us(s._formValues,r,B)}return!i&&s.register(r),()=>{(i?M&&!s._state.action:M)?s.unregister(r):F(r,!1)}},[r,s,i,o]),Ve.useEffect(()=>{s._setDisabledField({disabled:n,name:r})},[n,r,s]),Ve.useMemo(()=>({field:R,formState:S,fieldState:A}),[R,S,A])}const _m=e=>e.render(oke(e));var gae=(e,t,r,n,s)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:s||!0}}:{},IE=e=>Array.isArray(e)?e:[e],AG=()=>{let e=[];return{get observers(){return e},next:s=>{for(const o of e)o.next&&o.next(s)},subscribe:s=>(e.push(s),{unsubscribe:()=>{e=e.filter(o=>o!==s)}}),unsubscribe:()=>{e=[]}}},Dc=e=>_o(e)&&!Object.keys(e).length,q5=e=>e.type==="file",Fd=e=>typeof e=="function",bO=e=>{if(!z5)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},yae=e=>e.type==="select-multiple",H5=e=>e.type==="radio",lke=e=>H5(e)||L2(e),YD=e=>bO(e)&&e.isConnected;function cke(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=lo(e)?n++:e[t[n++]];return e}function uke(e){for(const t in e)if(e.hasOwnProperty(t)&&!lo(e[t]))return!1;return!0}function jo(e,t){const r=Array.isArray(t)?t:BN(t)?[t]:$5(t),n=r.length===1?e:cke(e,r),s=r.length-1,o=r[s];return n&&delete n[o],s!==0&&(_o(n)&&Dc(n)||Array.isArray(n)&&uke(n))&&jo(e,r.slice(0,-1)),e}var vae=e=>{for(const t in e)if(Fd(e[t]))return!0;return!1};function wO(e,t={}){const r=Array.isArray(e);if(_o(e)||r)for(const n in e)Array.isArray(e[n])||_o(e[n])&&!vae(e[n])?(t[n]=Array.isArray(e[n])?[]:{},wO(e[n],t[n])):uc(e[n])||(t[n]=!0);return t}function _ae(e,t,r){const n=Array.isArray(e);if(_o(e)||n)for(const s in e)Array.isArray(e[s])||_o(e[s])&&!vae(e[s])?lo(t)||kF(r[s])?r[s]=Array.isArray(e[s])?wO(e[s],[]):{...wO(e[s])}:_ae(e[s],uc(t)?{}:t[s],r[s]):r[s]=!Bf(e[s],t[s]);return r}var HS=(e,t)=>_ae(e,t,wO(t));const CG={value:!1,isValid:!1},jG={value:!0,isValid:!0};var xae=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!lo(e[0].attributes.value)?lo(e[0].value)||e[0].value===""?jG:{value:e[0].value,isValid:!0}:jG:CG}return CG},bae=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>lo(e)?e:t?e===""?NaN:e&&+e:r&&Oh(e)?new Date(e):n?n(e):e;const PG={isValid:!1,value:null};var wae=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,PG):PG;function OG(e){const t=e.ref;return q5(t)?t.files:H5(t)?wae(e.refs).value:yae(t)?[...t.selectedOptions].map(({value:r})=>r):L2(t)?xae(e.refs).value:bae(lo(t.value)?e.ref.value:t.value,e)}var dke=(e,t,r,n)=>{const s={};for(const o of e){const d=sn(t,o);d&&Us(s,o,d._f)}return{criteriaMode:r,names:[...e],fields:s,shouldUseNativeValidation:n}},SO=e=>e instanceof RegExp,GS=e=>lo(e)?e:SO(e)?e.source:_o(e)?SO(e.value)?e.value.source:e.value:e,kG=e=>({isOnSubmit:!e||e===Ld.onSubmit,isOnBlur:e===Ld.onBlur,isOnChange:e===Ld.onChange,isOnAll:e===Ld.all,isOnTouch:e===Ld.onTouched});const NG="AsyncFunction";var hke=e=>!!e&&!!e.validate&&!!(Fd(e.validate)&&e.validate.constructor.name===NG||_o(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===NG)),fke=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),IG=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const RE=(e,t,r,n)=>{for(const s of r||Object.keys(e)){const o=sn(e,s);if(o){const{_f:d,...i}=o;if(d){if(d.refs&&d.refs[0]&&t(d.refs[0],s)&&!n)return!0;if(d.ref&&t(d.ref,d.name)&&!n)return!0;if(RE(i,t))break}else if(_o(i)&&RE(i,t))break}}};function RG(e,t,r){const n=sn(e,r);if(n||BN(r))return{error:n,name:r};const s=r.split(".");for(;s.length;){const o=s.join("."),d=sn(t,o),i=sn(e,o);if(d&&!Array.isArray(d)&&r!==o)return{name:r};if(i&&i.type)return{name:o,error:i};if(i&&i.root&&i.root.type)return{name:`${o}.root`,error:i.root};s.pop()}return{name:r}}var pke=(e,t,r,n)=>{r(e);const{name:s,...o}=e;return Dc(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find(d=>t[d]===(!n||Ld.all))},mke=(e,t,r)=>!e||!t||e===t||IE(e).some(n=>n&&(r?n===t:n.startsWith(t)||t.startsWith(n))),gke=(e,t,r,n,s)=>s.isOnAll?!1:!r&&s.isOnTouch?!(t||e):(r?n.isOnBlur:s.isOnBlur)?!e:(r?n.isOnChange:s.isOnChange)?e:!0,yke=(e,t)=>!B5(sn(e,t)).length&&jo(e,t),vke=(e,t,r)=>{const n=IE(sn(e,r));return Us(n,"root",t[r]),Us(e,r,n),e},dP=e=>Oh(e);function MG(e,t,r="validate"){if(dP(e)||Array.isArray(e)&&e.every(dP)||cu(e)&&!e)return{type:r,message:dP(e)?e:"",ref:t}}var Hx=e=>_o(e)&&!SO(e)?e:{value:e,message:""},DG=async(e,t,r,n,s,o)=>{const{ref:d,refs:i,required:m,maxLength:y,minLength:S,min:w,max:T,pattern:A,validate:O,name:P,valueAsNumber:N,mount:R}=e._f,M=sn(r,P);if(!R||t.has(P))return{};const F=i?i[0]:d,B=ee=>{s&&F.reportValidity&&(F.setCustomValidity(cu(ee)?"":ee||""),F.reportValidity())},$={},W=H5(d),K=L2(d),te=W||K,ne=(N||q5(d))&&lo(d.value)&&lo(M)||bO(d)&&d.value===""||M===""||Array.isArray(M)&&!M.length,ae=gae.bind(null,P,n,$),re=(ee,ie,de,be=Of.maxLength,Se=Of.minLength)=>{const Ae=ee?ie:de;$[P]={type:ee?be:Se,message:Ae,ref:d,...ae(ee?be:Se,Ae)}};if(o?!Array.isArray(M)||!M.length:m&&(!te&&(ne||uc(M))||cu(M)&&!M||K&&!xae(i).isValid||W&&!wae(i).isValid)){const{value:ee,message:ie}=dP(m)?{value:!!m,message:m}:Hx(m);if(ee&&($[P]={type:Of.required,message:ie,ref:F,...ae(Of.required,ie)},!n))return B(ie),$}if(!ne&&(!uc(w)||!uc(T))){let ee,ie;const de=Hx(T),be=Hx(w);if(!uc(M)&&!isNaN(M)){const Se=d.valueAsNumber||M&&+M;uc(de.value)||(ee=Se>de.value),uc(be.value)||(ie=Se<be.value)}else{const Se=d.valueAsDate||new Date(M),Ae=Ce=>new Date(new Date().toDateString()+" "+Ce),xe=d.type=="time",me=d.type=="week";Oh(de.value)&&M&&(ee=xe?Ae(M)>Ae(de.value):me?M>de.value:Se>new Date(de.value)),Oh(be.value)&&M&&(ie=xe?Ae(M)<Ae(be.value):me?M<be.value:Se<new Date(be.value))}if((ee||ie)&&(re(!!ee,de.message,be.message,Of.max,Of.min),!n))return B($[P].message),$}if((y||S)&&!ne&&(Oh(M)||o&&Array.isArray(M))){const ee=Hx(y),ie=Hx(S),de=!uc(ee.value)&&M.length>+ee.value,be=!uc(ie.value)&&M.length<+ie.value;if((de||be)&&(re(de,ee.message,ie.message),!n))return B($[P].message),$}if(A&&!ne&&Oh(M)){const{value:ee,message:ie}=Hx(A);if(SO(ee)&&!M.match(ee)&&($[P]={type:Of.pattern,message:ie,ref:d,...ae(Of.pattern,ie)},!n))return B(ie),$}if(O){if(Fd(O)){const ee=await O(M,r),ie=MG(ee,F);if(ie&&($[P]={...ie,...ae(Of.validate,ie.message)},!n))return B(ie.message),$}else if(_o(O)){let ee={};for(const ie in O){if(!Dc(ee)&&!n)break;const de=MG(await O[ie](M,r),F,ie);de&&(ee={...de,...ae(ie,de.message)},B(de.message),n&&($[P]=ee))}if(!Dc(ee)&&($[P]={ref:F,...ee},!n))return $}}return B(!0),$};const _ke={mode:Ld.onSubmit,reValidateMode:Ld.onChange,shouldFocusError:!0};function xke(e={}){let t={..._ke,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:Fd(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},n={},s=_o(t.defaultValues)||_o(t.values)?Ko(t.defaultValues||t.values)||{}:{},o=t.shouldUnregister?{}:Ko(s),d={action:!1,mount:!1,watch:!1},i={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},m,y=0;const S={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let w={...S};const T={array:AG(),state:AG()},A=t.criteriaMode===Ld.all,O=Je=>pt=>{clearTimeout(y),y=setTimeout(Je,pt)},P=async Je=>{if(!t.disabled&&(S.isValid||w.isValid||Je)){const pt=t.resolver?Dc((await K()).errors):await ne(n,!0);pt!==r.isValid&&T.state.next({isValid:pt})}},N=(Je,pt)=>{!t.disabled&&(S.isValidating||S.validatingFields||w.isValidating||w.validatingFields)&&((Je||Array.from(i.mount)).forEach(rt=>{rt&&(pt?Us(r.validatingFields,rt,pt):jo(r.validatingFields,rt))}),T.state.next({validatingFields:r.validatingFields,isValidating:!Dc(r.validatingFields)}))},R=(Je,pt=[],rt,Kt,Ut=!0,Ht=!0)=>{if(Kt&&rt&&!t.disabled){if(d.action=!0,Ht&&Array.isArray(sn(n,Je))){const Cr=rt(sn(n,Je),Kt.argA,Kt.argB);Ut&&Us(n,Je,Cr)}if(Ht&&Array.isArray(sn(r.errors,Je))){const Cr=rt(sn(r.errors,Je),Kt.argA,Kt.argB);Ut&&Us(r.errors,Je,Cr),yke(r.errors,Je)}if((S.touchedFields||w.touchedFields)&&Ht&&Array.isArray(sn(r.touchedFields,Je))){const Cr=rt(sn(r.touchedFields,Je),Kt.argA,Kt.argB);Ut&&Us(r.touchedFields,Je,Cr)}(S.dirtyFields||w.dirtyFields)&&(r.dirtyFields=HS(s,o)),T.state.next({name:Je,isDirty:re(Je,pt),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else Us(o,Je,pt)},M=(Je,pt)=>{Us(r.errors,Je,pt),T.state.next({errors:r.errors})},F=Je=>{r.errors=Je,T.state.next({errors:r.errors,isValid:!1})},B=(Je,pt,rt,Kt)=>{const Ut=sn(n,Je);if(Ut){const Ht=sn(o,Je,lo(rt)?sn(s,Je):rt);lo(Ht)||Kt&&Kt.defaultChecked||pt?Us(o,Je,pt?Ht:OG(Ut._f)):de(Je,Ht),d.mount&&P()}},$=(Je,pt,rt,Kt,Ut)=>{let Ht=!1,Cr=!1;const un={name:Je};if(!t.disabled){if(!rt||Kt){(S.isDirty||w.isDirty)&&(Cr=r.isDirty,r.isDirty=un.isDirty=re(),Ht=Cr!==un.isDirty);const hn=Bf(sn(s,Je),pt);Cr=!!sn(r.dirtyFields,Je),hn?jo(r.dirtyFields,Je):Us(r.dirtyFields,Je,!0),un.dirtyFields=r.dirtyFields,Ht=Ht||(S.dirtyFields||w.dirtyFields)&&Cr!==!hn}if(rt){const hn=sn(r.touchedFields,Je);hn||(Us(r.touchedFields,Je,rt),un.touchedFields=r.touchedFields,Ht=Ht||(S.touchedFields||w.touchedFields)&&hn!==rt)}Ht&&Ut&&T.state.next(un)}return Ht?un:{}},W=(Je,pt,rt,Kt)=>{const Ut=sn(r.errors,Je),Ht=(S.isValid||w.isValid)&&cu(pt)&&r.isValid!==pt;if(t.delayError&&rt?(m=O(()=>M(Je,rt)),m(t.delayError)):(clearTimeout(y),m=null,rt?Us(r.errors,Je,rt):jo(r.errors,Je)),(rt?!Bf(Ut,rt):Ut)||!Dc(Kt)||Ht){const Cr={...Kt,...Ht&&cu(pt)?{isValid:pt}:{},errors:r.errors,name:Je};r={...r,...Cr},T.state.next(Cr)}},K=async Je=>{N(Je,!0);const pt=await t.resolver(o,t.context,dke(Je||i.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return N(Je),pt},te=async Je=>{const{errors:pt}=await K(Je);if(Je)for(const rt of Je){const Kt=sn(pt,rt);Kt?Us(r.errors,rt,Kt):jo(r.errors,rt)}else r.errors=pt;return pt},ne=async(Je,pt,rt={valid:!0})=>{for(const Kt in Je){const Ut=Je[Kt];if(Ut){const{_f:Ht,...Cr}=Ut;if(Ht){const un=i.array.has(Ht.name),hn=Ut._f&&hke(Ut._f);hn&&S.validatingFields&&N([Kt],!0);const Kn=await DG(Ut,i.disabled,o,A,t.shouldUseNativeValidation&&!pt,un);if(hn&&S.validatingFields&&N([Kt]),Kn[Ht.name]&&(rt.valid=!1,pt))break;!pt&&(sn(Kn,Ht.name)?un?vke(r.errors,Kn,Ht.name):Us(r.errors,Ht.name,Kn[Ht.name]):jo(r.errors,Ht.name))}!Dc(Cr)&&await ne(Cr,pt,rt)}}return rt.valid},ae=()=>{for(const Je of i.unMount){const pt=sn(n,Je);pt&&(pt._f.refs?pt._f.refs.every(rt=>!YD(rt)):!YD(pt._f.ref))&&Ke(Je)}i.unMount=new Set},re=(Je,pt)=>!t.disabled&&(Je&&pt&&Us(o,Je,pt),!Bf(Ce(),s)),ee=(Je,pt,rt)=>mae(Je,i,{...d.mount?o:lo(pt)?s:Oh(Je)?{[Je]:pt}:pt},rt,pt),ie=Je=>B5(sn(d.mount?o:s,Je,t.shouldUnregister?sn(s,Je,[]):[])),de=(Je,pt,rt={})=>{const Kt=sn(n,Je);let Ut=pt;if(Kt){const Ht=Kt._f;Ht&&(!Ht.disabled&&Us(o,Je,bae(pt,Ht)),Ut=bO(Ht.ref)&&uc(pt)?"":pt,yae(Ht.ref)?[...Ht.ref.options].forEach(Cr=>Cr.selected=Ut.includes(Cr.value)):Ht.refs?L2(Ht.ref)?Ht.refs.forEach(Cr=>{(!Cr.defaultChecked||!Cr.disabled)&&(Array.isArray(Ut)?Cr.checked=!!Ut.find(un=>un===Cr.value):Cr.checked=Ut===Cr.value||!!Ut)}):Ht.refs.forEach(Cr=>Cr.checked=Cr.value===Ut):q5(Ht.ref)?Ht.ref.value="":(Ht.ref.value=Ut,Ht.ref.type||T.state.next({name:Je,values:Ko(o)})))}(rt.shouldDirty||rt.shouldTouch)&&$(Je,Ut,rt.shouldTouch,rt.shouldDirty,!0),rt.shouldValidate&&me(Je)},be=(Je,pt,rt)=>{for(const Kt in pt){if(!pt.hasOwnProperty(Kt))return;const Ut=pt[Kt],Ht=Je+"."+Kt,Cr=sn(n,Ht);(i.array.has(Je)||_o(Ut)||Cr&&!Cr._f)&&!Qy(Ut)?be(Ht,Ut,rt):de(Ht,Ut,rt)}},Se=(Je,pt,rt={})=>{const Kt=sn(n,Je),Ut=i.array.has(Je),Ht=Ko(pt);Us(o,Je,Ht),Ut?(T.array.next({name:Je,values:Ko(o)}),(S.isDirty||S.dirtyFields||w.isDirty||w.dirtyFields)&&rt.shouldDirty&&T.state.next({name:Je,dirtyFields:HS(s,o),isDirty:re(Je,Ht)})):Kt&&!Kt._f&&!uc(Ht)?be(Je,Ht,rt):de(Je,Ht,rt),IG(Je,i)&&T.state.next({...r,name:Je}),T.state.next({name:d.mount?Je:void 0,values:Ko(o)})},Ae=async Je=>{d.mount=!0;const pt=Je.target;let rt=pt.name,Kt=!0;const Ut=sn(n,rt),Ht=hn=>{Kt=Number.isNaN(hn)||Qy(hn)&&isNaN(hn.getTime())||Bf(hn,sn(o,rt,hn))},Cr=kG(t.mode),un=kG(t.reValidateMode);if(Ut){let hn,Kn;const Gn=pt.type?OG(Ut._f):hae(Je),Mi=Je.type===xO.BLUR||Je.type===xO.FOCUS_OUT,Pa=!fke(Ut._f)&&!t.resolver&&!sn(r.errors,rt)&&!Ut._f.deps||gke(Mi,sn(r.touchedFields,rt),r.isSubmitted,un,Cr),_s=IG(rt,i,Mi);Us(o,rt,Gn),Mi?(Ut._f.onBlur&&Ut._f.onBlur(Je),m&&m(0)):Ut._f.onChange&&Ut._f.onChange(Je);const mi=$(rt,Gn,Mi),Ua=!Dc(mi)||_s;if(!Mi&&T.state.next({name:rt,type:Je.type,values:Ko(o)}),Pa)return(S.isValid||w.isValid)&&(t.mode==="onBlur"?Mi&&P():Mi||P()),Ua&&T.state.next({name:rt,..._s?{}:mi});if(!Mi&&_s&&T.state.next({...r}),t.resolver){const{errors:Va}=await K([rt]);if(Ht(Gn),Kt){const Bo=RG(r.errors,n,rt),qa=RG(Va,n,Bo.name||rt);hn=qa.error,rt=qa.name,Kn=Dc(Va)}}else N([rt],!0),hn=(await DG(Ut,i.disabled,o,A,t.shouldUseNativeValidation))[rt],N([rt]),Ht(Gn),Kt&&(hn?Kn=!1:(S.isValid||w.isValid)&&(Kn=await ne(n,!0)));Kt&&(Ut._f.deps&&me(Ut._f.deps),W(rt,Kn,hn,mi))}},xe=(Je,pt)=>{if(sn(r.errors,pt)&&Je.focus)return Je.focus(),1},me=async(Je,pt={})=>{let rt,Kt;const Ut=IE(Je);if(t.resolver){const Ht=await te(lo(Je)?Je:Ut);rt=Dc(Ht),Kt=Je?!Ut.some(Cr=>sn(Ht,Cr)):rt}else Je?(Kt=(await Promise.all(Ut.map(async Ht=>{const Cr=sn(n,Ht);return await ne(Cr&&Cr._f?{[Ht]:Cr}:Cr)}))).every(Boolean),!(!Kt&&!r.isValid)&&P()):Kt=rt=await ne(n);return T.state.next({...!Oh(Je)||(S.isValid||w.isValid)&&rt!==r.isValid?{}:{name:Je},...t.resolver||!Je?{isValid:rt}:{},errors:r.errors}),pt.shouldFocus&&!Kt&&RE(n,xe,Je?Ut:i.mount),Kt},Ce=Je=>{const pt={...d.mount?o:s};return lo(Je)?pt:Oh(Je)?sn(pt,Je):Je.map(rt=>sn(pt,rt))},ge=(Je,pt)=>({invalid:!!sn((pt||r).errors,Je),isDirty:!!sn((pt||r).dirtyFields,Je),error:sn((pt||r).errors,Je),isValidating:!!sn(r.validatingFields,Je),isTouched:!!sn((pt||r).touchedFields,Je)}),pe=Je=>{Je&&IE(Je).forEach(pt=>jo(r.errors,pt)),T.state.next({errors:Je?r.errors:{}})},Oe=(Je,pt,rt)=>{const Kt=(sn(n,Je,{_f:{}})._f||{}).ref,Ut=sn(r.errors,Je)||{},{ref:Ht,message:Cr,type:un,...hn}=Ut;Us(r.errors,Je,{...hn,...pt,ref:Kt}),T.state.next({name:Je,errors:r.errors,isValid:!1}),rt&&rt.shouldFocus&&Kt&&Kt.focus&&Kt.focus()},Xe=(Je,pt)=>Fd(Je)?T.state.subscribe({next:rt=>"values"in rt&&Je(ee(void 0,pt),rt)}):ee(Je,pt,!0),We=Je=>T.state.subscribe({next:pt=>{mke(Je.name,pt.name,Je.exact)&&pke(pt,Je.formState||S,Rr,Je.reRenderRoot)&&Je.callback({values:{...o},...r,...pt,defaultValues:s})}}).unsubscribe,$e=Je=>(d.mount=!0,w={...w,...Je.formState},We({...Je,formState:w})),Ke=(Je,pt={})=>{for(const rt of Je?IE(Je):i.mount)i.mount.delete(rt),i.array.delete(rt),pt.keepValue||(jo(n,rt),jo(o,rt)),!pt.keepError&&jo(r.errors,rt),!pt.keepDirty&&jo(r.dirtyFields,rt),!pt.keepTouched&&jo(r.touchedFields,rt),!pt.keepIsValidating&&jo(r.validatingFields,rt),!t.shouldUnregister&&!pt.keepDefaultValue&&jo(s,rt);T.state.next({values:Ko(o)}),T.state.next({...r,...pt.keepDirty?{isDirty:re()}:{}}),!pt.keepIsValid&&P()},Le=({disabled:Je,name:pt})=>{(cu(Je)&&d.mount||Je||i.disabled.has(pt))&&(Je?i.disabled.add(pt):i.disabled.delete(pt))},ke=(Je,pt={})=>{let rt=sn(n,Je);const Kt=cu(pt.disabled)||cu(t.disabled);return Us(n,Je,{...rt||{},_f:{...rt&&rt._f?rt._f:{ref:{name:Je}},name:Je,mount:!0,...pt}}),i.mount.add(Je),rt?Le({disabled:cu(pt.disabled)?pt.disabled:t.disabled,name:Je}):B(Je,!0,pt.value),{...Kt?{disabled:pt.disabled||t.disabled}:{},...t.progressive?{required:!!pt.required,min:GS(pt.min),max:GS(pt.max),minLength:GS(pt.minLength),maxLength:GS(pt.maxLength),pattern:GS(pt.pattern)}:{},name:Je,onChange:Ae,onBlur:Ae,ref:Ut=>{if(Ut){ke(Je,pt),rt=sn(n,Je);const Ht=lo(Ut.value)&&Ut.querySelectorAll&&Ut.querySelectorAll("input,select,textarea")[0]||Ut,Cr=lke(Ht),un=rt._f.refs||[];if(Cr?un.find(hn=>hn===Ht):Ht===rt._f.ref)return;Us(n,Je,{_f:{...rt._f,...Cr?{refs:[...un.filter(YD),Ht,...Array.isArray(sn(s,Je))?[{}]:[]],ref:{type:Ht.type,name:Je}}:{ref:Ht}}}),B(Je,!1,void 0,Ht)}else rt=sn(n,Je,{}),rt._f&&(rt._f.mount=!1),(t.shouldUnregister||pt.shouldUnregister)&&!(fae(i.array,Je)&&d.action)&&i.unMount.add(Je)}}},st=()=>t.shouldFocusError&&RE(n,xe,i.mount),_t=Je=>{cu(Je)&&(T.state.next({disabled:Je}),RE(n,(pt,rt)=>{const Kt=sn(n,rt);Kt&&(pt.disabled=Kt._f.disabled||Je,Array.isArray(Kt._f.refs)&&Kt._f.refs.forEach(Ut=>{Ut.disabled=Kt._f.disabled||Je}))},0,!1))},Be=(Je,pt)=>async rt=>{let Kt;rt&&(rt.preventDefault&&rt.preventDefault(),rt.persist&&rt.persist());let Ut=Ko(o);if(T.state.next({isSubmitting:!0}),t.resolver){const{errors:Ht,values:Cr}=await K();r.errors=Ht,Ut=Ko(Cr)}else await ne(n);if(i.disabled.size)for(const Ht of i.disabled)jo(Ut,Ht);if(jo(r.errors,"root"),Dc(r.errors)){T.state.next({errors:{}});try{await Je(Ut,rt)}catch(Ht){Kt=Ht}}else pt&&await pt({...r.errors},rt),st(),setTimeout(st);if(T.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Dc(r.errors)&&!Kt,submitCount:r.submitCount+1,errors:r.errors}),Kt)throw Kt},Dt=(Je,pt={})=>{sn(n,Je)&&(lo(pt.defaultValue)?Se(Je,Ko(sn(s,Je))):(Se(Je,pt.defaultValue),Us(s,Je,Ko(pt.defaultValue))),pt.keepTouched||jo(r.touchedFields,Je),pt.keepDirty||(jo(r.dirtyFields,Je),r.isDirty=pt.defaultValue?re(Je,Ko(sn(s,Je))):re()),pt.keepError||(jo(r.errors,Je),S.isValid&&P()),T.state.next({...r}))},It=(Je,pt={})=>{const rt=Je?Ko(Je):s,Kt=Ko(rt),Ut=Dc(Je),Ht=Ut?s:Kt;if(pt.keepDefaultValues||(s=rt),!pt.keepValues){if(pt.keepDirtyValues){const Cr=new Set([...i.mount,...Object.keys(HS(s,o))]);for(const un of Array.from(Cr))sn(r.dirtyFields,un)?Us(Ht,un,sn(o,un)):Se(un,sn(Ht,un))}else{if(z5&&lo(Je))for(const Cr of i.mount){const un=sn(n,Cr);if(un&&un._f){const hn=Array.isArray(un._f.refs)?un._f.refs[0]:un._f.ref;if(bO(hn)){const Kn=hn.closest("form");if(Kn){Kn.reset();break}}}}if(pt.keepFieldsRef)for(const Cr of i.mount)Se(Cr,sn(Ht,Cr));else n={}}o=t.shouldUnregister?pt.keepDefaultValues?Ko(s):{}:Ko(Ht),T.array.next({values:{...Ht}}),T.state.next({values:{...Ht}})}i={mount:pt.keepDirtyValues?i.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},d.mount=!S.isValid||!!pt.keepIsValid||!!pt.keepDirtyValues,d.watch=!!t.shouldUnregister,T.state.next({submitCount:pt.keepSubmitCount?r.submitCount:0,isDirty:Ut?!1:pt.keepDirty?r.isDirty:!!(pt.keepDefaultValues&&!Bf(Je,s)),isSubmitted:pt.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:Ut?{}:pt.keepDirtyValues?pt.keepDefaultValues&&o?HS(s,o):r.dirtyFields:pt.keepDefaultValues&&Je?HS(s,Je):pt.keepDirty?r.dirtyFields:{},touchedFields:pt.keepTouched?r.touchedFields:{},errors:pt.keepErrors?r.errors:{},isSubmitSuccessful:pt.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},ir=(Je,pt)=>It(Fd(Je)?Je(o):Je,pt),Dr=(Je,pt={})=>{const rt=sn(n,Je),Kt=rt&&rt._f;if(Kt){const Ut=Kt.refs?Kt.refs[0]:Kt.ref;Ut.focus&&(Ut.focus(),pt.shouldSelect&&Fd(Ut.select)&&Ut.select())}},Rr=Je=>{r={...r,...Je}},zt={control:{register:ke,unregister:Ke,getFieldState:ge,handleSubmit:Be,setError:Oe,_subscribe:We,_runSchema:K,_focusError:st,_getWatch:ee,_getDirty:re,_setValid:P,_setFieldArray:R,_setDisabledField:Le,_setErrors:F,_getFieldArray:ie,_reset:It,_resetDefaultValues:()=>Fd(t.defaultValues)&&t.defaultValues().then(Je=>{ir(Je,t.resetOptions),T.state.next({isLoading:!1})}),_removeUnmounted:ae,_disableForm:_t,_subjects:T,_proxyFormState:S,get _fields(){return n},get _formValues(){return o},get _state(){return d},set _state(Je){d=Je},get _defaultValues(){return s},get _names(){return i},set _names(Je){i=Je},get _formState(){return r},get _options(){return t},set _options(Je){t={...t,...Je}}},subscribe:$e,trigger:me,register:ke,handleSubmit:Be,watch:Xe,setValue:Se,getValues:Ce,reset:ir,resetField:Dt,clearErrors:pe,unregister:Ke,setError:Oe,setFocus:Dr,getFieldState:ge};return{...zt,formControl:zt}}function Eh(e={}){const t=Ve.useRef(void 0),r=Ve.useRef(void 0),[n,s]=Ve.useState({isDirty:!1,isValidating:!1,isLoading:Fd(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:Fd(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:n},e.defaultValues&&!Fd(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:d,...i}=xke(e);t.current={...i,formState:n}}const o=t.current.control;return o._options=e,V5(()=>{const d=o._subscribe({formState:o._proxyFormState,callback:()=>s({...o._formState}),reRenderRoot:!0});return s(i=>({...i,isReady:!0})),o._formState.isReady=!0,d},[o]),Ve.useEffect(()=>o._disableForm(e.disabled),[o,e.disabled]),Ve.useEffect(()=>{e.mode&&(o._options.mode=e.mode),e.reValidateMode&&(o._options.reValidateMode=e.reValidateMode)},[o,e.mode,e.reValidateMode]),Ve.useEffect(()=>{e.errors&&(o._setErrors(e.errors),o._focusError())},[o,e.errors]),Ve.useEffect(()=>{e.shouldUnregister&&o._subjects.state.next({values:o._getWatch()})},[o,e.shouldUnregister]),Ve.useEffect(()=>{if(o._proxyFormState.isDirty){const d=o._getDirty();d!==n.isDirty&&o._subjects.state.next({isDirty:d})}},[o,n.isDirty]),Ve.useEffect(()=>{e.values&&!Bf(e.values,r.current)?(o._reset(e.values,{keepFieldsRef:!0,...o._options.resetOptions}),r.current=e.values,s(d=>({...d}))):o._resetDefaultValues()},[o,e.values]),Ve.useEffect(()=>{o._state.mount||(o._setValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),t.current.formState=pae(n,o),t.current}const LG=(e,t,r)=>{if(e&&"reportValidity"in e){const n=sn(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},Sae=(e,t)=>{for(const r in t.fields){const n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?LG(n.ref,r,e):n.refs&&n.refs.forEach(s=>LG(s,r,e))}},bke=(e,t)=>{t.shouldUseNativeValidation&&Sae(e,t);const r={};for(const n in e){const s=sn(t.fields,n),o=Object.assign(e[n]||{},{ref:s&&s.ref});if(wke(t.names||Object.keys(e),n)){const d=Object.assign({},sn(r,n));Us(d,"root",o),Us(r,n,d)}else Us(r,n,o)}return r},wke=(e,t)=>e.some(r=>r.startsWith(t+"."));var Ske=function(e,t){for(var r={};e.length;){var n=e[0],s=n.code,o=n.message,d=n.path.join(".");if(!r[d])if("unionErrors"in n){var i=n.unionErrors[0].errors[0];r[d]={message:i.message,type:i.code}}else r[d]={message:o,type:s};if("unionErrors"in n&&n.unionErrors.forEach(function(S){return S.errors.forEach(function(w){return e.push(w)})}),t){var m=r[d].types,y=m&&m[n.code];r[d]=gae(d,t,r,s,y?[].concat(y,n.message):n.message)}e.shift()}return r},Th=function(e,t,r){return r===void 0&&(r={}),function(n,s,o){try{return Promise.resolve(function(d,i){try{var m=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](n,t)).then(function(y){return o.shouldUseNativeValidation&&Sae({},o),{errors:{},values:r.raw?n:y}})}catch(y){return i(y)}return m&&m.then?m.then(void 0,i):m}(0,function(d){if(function(i){return Array.isArray(i==null?void 0:i.errors)}(d))return{values:{},errors:bke(Ske(d.errors,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw d}))}catch(d){return Promise.reject(d)}}},As;(function(e){e.assertEqual=s=>{};function t(s){}e.assertIs=t;function r(s){throw new Error}e.assertNever=r,e.arrayToEnum=s=>{const o={};for(const d of s)o[d]=d;return o},e.getValidEnumValues=s=>{const o=e.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),d={};for(const i of o)d[i]=s[i];return e.objectValues(d)},e.objectValues=s=>e.objectKeys(s).map(function(o){return s[o]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const o=[];for(const d in s)Object.prototype.hasOwnProperty.call(s,d)&&o.push(d);return o},e.find=(s,o)=>{for(const d of s)if(o(d))return d},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,o=" | "){return s.map(d=>typeof d=="string"?`'${d}'`:d).join(o)}e.joinValues=n,e.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(As||(As={}));var FG;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(FG||(FG={}));const Pn=As.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Tm=e=>{switch(typeof e){case"undefined":return Pn.undefined;case"string":return Pn.string;case"number":return Number.isNaN(e)?Pn.nan:Pn.number;case"boolean":return Pn.boolean;case"function":return Pn.function;case"bigint":return Pn.bigint;case"symbol":return Pn.symbol;case"object":return Array.isArray(e)?Pn.array:e===null?Pn.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Pn.promise:typeof Map<"u"&&e instanceof Map?Pn.map:typeof Set<"u"&&e instanceof Set?Pn.set:typeof Date<"u"&&e instanceof Date?Pn.date:Pn.object;default:return Pn.unknown}},Vr=As.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class cp extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(o){return o.message},n={_errors:[]},s=o=>{for(const d of o.issues)if(d.code==="invalid_union")d.unionErrors.map(s);else if(d.code==="invalid_return_type")s(d.returnTypeError);else if(d.code==="invalid_arguments")s(d.argumentsError);else if(d.path.length===0)n._errors.push(r(d));else{let i=n,m=0;for(;m<d.path.length;){const y=d.path[m];m===d.path.length-1?(i[y]=i[y]||{_errors:[]},i[y]._errors.push(r(d))):i[y]=i[y]||{_errors:[]},i=i[y],m++}}};return s(this),n}static assert(t){if(!(t instanceof cp))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,As.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const s of this.issues)if(s.path.length>0){const o=s.path[0];r[o]=r[o]||[],r[o].push(t(s))}else n.push(t(s));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}cp.create=e=>new cp(e);const NF=(e,t)=>{let r;switch(e.code){case Vr.invalid_type:e.received===Pn.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case Vr.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,As.jsonStringifyReplacer)}`;break;case Vr.unrecognized_keys:r=`Unrecognized key(s) in object: ${As.joinValues(e.keys,", ")}`;break;case Vr.invalid_union:r="Invalid input";break;case Vr.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${As.joinValues(e.options)}`;break;case Vr.invalid_enum_value:r=`Invalid enum value. Expected ${As.joinValues(e.options)}, received '${e.received}'`;break;case Vr.invalid_arguments:r="Invalid function arguments";break;case Vr.invalid_return_type:r="Invalid function return type";break;case Vr.invalid_date:r="Invalid date";break;case Vr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:As.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case Vr.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case Vr.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case Vr.custom:r="Invalid input";break;case Vr.invalid_intersection_types:r="Intersection results could not be merged";break;case Vr.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Vr.not_finite:r="Number must be finite";break;default:r=t.defaultError,As.assertNever(e)}return{message:r}};let Eke=NF;function Tke(){return Eke}const Ake=e=>{const{data:t,path:r,errorMaps:n,issueData:s}=e,o=[...r,...s.path||[]],d={...s,path:o};if(s.message!==void 0)return{...s,path:o,message:s.message};let i="";const m=n.filter(y=>!!y).slice().reverse();for(const y of m)i=y(d,{data:t,defaultError:i}).message;return{...s,path:o,message:i}};function mn(e,t){const r=Tke(),n=Ake({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===NF?void 0:NF].filter(s=>!!s)});e.common.issues.push(n)}class Su{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const s of r){if(s.status==="aborted")return ji;s.status==="dirty"&&t.dirty(),n.push(s.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const s of r){const o=await s.key,d=await s.value;n.push({key:o,value:d})}return Su.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const s of r){const{key:o,value:d}=s;if(o.status==="aborted"||d.status==="aborted")return ji;o.status==="dirty"&&t.dirty(),d.status==="dirty"&&t.dirty(),o.value!=="__proto__"&&(typeof d.value<"u"||s.alwaysSet)&&(n[o.value]=d.value)}return{status:t.value,value:n}}}const ji=Object.freeze({status:"aborted"}),mE=e=>({status:"dirty",value:e}),ed=e=>({status:"valid",value:e}),zG=e=>e.status==="aborted",BG=e=>e.status==="dirty",xb=e=>e.status==="valid",EO=e=>typeof Promise<"u"&&e instanceof Promise;var On;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(On||(On={}));class pg{constructor(t,r,n,s){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const $G=(e,t)=>{if(xb(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new cp(e.common.issues);return this._error=r,this._error}}};function ns(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:s}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(d,i)=>{const{message:m}=e;return d.code==="invalid_enum_value"?{message:m??i.defaultError}:typeof i.data>"u"?{message:m??n??i.defaultError}:d.code!=="invalid_type"?{message:i.defaultError}:{message:m??r??i.defaultError}},description:s}}class Es{get description(){return this._def.description}_getType(t){return Tm(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Tm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Su,ctx:{common:t.parent.common,data:t.data,parsedType:Tm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(EO(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Tm(t)},s=this._parseSync({data:t,path:n.path,parent:n});return $G(n,s)}"~validate"(t){var n,s;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Tm(t)};if(!this["~standard"].async)try{const o=this._parseSync({data:t,path:[],parent:r});return xb(o)?{value:o.value}:{issues:r.common.issues}}catch(o){(s=(n=o==null?void 0:o.message)==null?void 0:n.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(o=>xb(o)?{value:o.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Tm(t)},s=this._parse({data:t,path:n.path,parent:n}),o=await(EO(s)?s:Promise.resolve(s));return $G(n,o)}refine(t,r){const n=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,o)=>{const d=t(s),i=()=>o.addIssue({code:Vr.custom,...n(s)});return typeof Promise<"u"&&d instanceof Promise?d.then(m=>m?!0:(i(),!1)):d?!0:(i(),!1)})}refinement(t,r){return this._refinement((n,s)=>t(n)?!0:(s.addIssue(typeof r=="function"?r(n,s):r),!1))}_refinement(t){return new Sb({schema:this,typeName:Pi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return sg.create(this,this._def)}nullable(){return Eb.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return zh.create(this)}promise(){return jO.create(this,this._def)}or(t){return AO.create([this,t],this._def)}and(t){return CO.create(this,t,this._def)}transform(t){return new Sb({...ns(this._def),schema:this,typeName:Pi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new MF({...ns(this._def),innerType:this,defaultValue:r,typeName:Pi.ZodDefault})}brand(){return new Zke({typeName:Pi.ZodBranded,type:this,...ns(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new DF({...ns(this._def),innerType:this,catchValue:r,typeName:Pi.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return G5.create(this,t)}readonly(){return LF.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Cke=/^c[^\s-]{8,}$/i,jke=/^[0-9a-z]+$/,Pke=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Oke=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,kke=/^[a-z0-9_-]{21}$/i,Nke=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ike=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Rke=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Mke="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let JD;const Dke=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Lke=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Fke=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,zke=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Bke=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$ke=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Eae="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Uke=new RegExp(`^${Eae}$`);function Tae(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function Vke(e){return new RegExp(`^${Tae(e)}$`)}function qke(e){let t=`${Eae}T${Tae(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function Hke(e,t){return!!((t==="v4"||!t)&&Dke.test(e)||(t==="v6"||!t)&&Fke.test(e))}function Gke(e,t){if(!Nke.test(e))return!1;try{const[r]=e.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||t&&s.alg!==t)}catch{return!1}}function Wke(e,t){return!!((t==="v4"||!t)&&Lke.test(e)||(t==="v6"||!t)&&zke.test(e))}class Hf extends Es{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Pn.string){const o=this._getOrReturnCtx(t);return mn(o,{code:Vr.invalid_type,expected:Pn.string,received:o.parsedType}),ji}const n=new Su;let s;for(const o of this._def.checks)if(o.kind==="min")t.data.length<o.value&&(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")t.data.length>o.value&&(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){const d=t.data.length>o.value,i=t.data.length<o.value;(d||i)&&(s=this._getOrReturnCtx(t,s),d?mn(s,{code:Vr.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):i&&mn(s,{code:Vr.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")Rke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"email",code:Vr.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")JD||(JD=new RegExp(Mke,"u")),JD.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"emoji",code:Vr.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")Oke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"uuid",code:Vr.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")kke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"nanoid",code:Vr.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")Cke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"cuid",code:Vr.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")jke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"cuid2",code:Vr.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")Pke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"ulid",code:Vr.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),mn(s,{validation:"url",code:Vr.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"regex",code:Vr.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?t.data=t.data.trim():o.kind==="includes"?t.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?t.data=t.data.toLowerCase():o.kind==="toUpperCase"?t.data=t.data.toUpperCase():o.kind==="startsWith"?t.data.startsWith(o.value)||(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?t.data.endsWith(o.value)||(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?qke(o).test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?Uke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?Vke(o).test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?Ike.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"duration",code:Vr.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?Hke(t.data,o.version)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"ip",code:Vr.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?Gke(t.data,o.alg)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"jwt",code:Vr.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?Wke(t.data,o.version)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"cidr",code:Vr.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?Bke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"base64",code:Vr.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?$ke.test(t.data)||(s=this._getOrReturnCtx(t,s),mn(s,{validation:"base64url",code:Vr.invalid_string,message:o.message}),n.dirty()):As.assertNever(o);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(s=>t.test(s),{validation:r,code:Vr.invalid_string,...On.errToObj(n)})}_addCheck(t){return new Hf({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...On.errToObj(t)})}url(t){return this._addCheck({kind:"url",...On.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...On.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...On.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...On.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...On.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...On.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...On.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...On.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...On.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...On.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...On.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...On.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...On.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...On.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...On.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...On.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...On.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...On.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...On.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...On.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...On.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...On.errToObj(r)})}nonempty(t){return this.min(1,On.errToObj(t))}trim(){return new Hf({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Hf({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Hf({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Hf.create=e=>new Hf({checks:[],typeName:Pi.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...ns(e)});function Kke(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=r>n?r:n,o=Number.parseInt(e.toFixed(s).replace(".","")),d=Number.parseInt(t.toFixed(s).replace(".",""));return o%d/10**s}class Rv extends Es{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Pn.number){const o=this._getOrReturnCtx(t);return mn(o,{code:Vr.invalid_type,expected:Pn.number,received:o.parsedType}),ji}let n;const s=new Su;for(const o of this._def.checks)o.kind==="int"?As.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?Kke(t.data,o.value)!==0&&(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.not_finite,message:o.message}),s.dirty()):As.assertNever(o);return{status:s.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,On.toString(r))}gt(t,r){return this.setLimit("min",t,!1,On.toString(r))}lte(t,r){return this.setLimit("max",t,!0,On.toString(r))}lt(t,r){return this.setLimit("max",t,!1,On.toString(r))}setLimit(t,r,n,s){return new Rv({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:On.toString(s)}]})}_addCheck(t){return new Rv({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:On.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:On.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:On.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:On.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:On.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:On.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:On.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:On.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:On.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&As.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}Rv.create=e=>new Rv({checks:[],typeName:Pi.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...ns(e)});class Mv extends Es{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Pn.bigint)return this._getInvalidInput(t);let n;const s=new Su;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?t.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),mn(n,{code:Vr.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):As.assertNever(o);return{status:s.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return mn(r,{code:Vr.invalid_type,expected:Pn.bigint,received:r.parsedType}),ji}gte(t,r){return this.setLimit("min",t,!0,On.toString(r))}gt(t,r){return this.setLimit("min",t,!1,On.toString(r))}lte(t,r){return this.setLimit("max",t,!0,On.toString(r))}lt(t,r){return this.setLimit("max",t,!1,On.toString(r))}setLimit(t,r,n,s){return new Mv({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:On.toString(s)}]})}_addCheck(t){return new Mv({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:On.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:On.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:On.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:On.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:On.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Mv.create=e=>new Mv({checks:[],typeName:Pi.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...ns(e)});class TO extends Es{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Pn.boolean){const n=this._getOrReturnCtx(t);return mn(n,{code:Vr.invalid_type,expected:Pn.boolean,received:n.parsedType}),ji}return ed(t.data)}}TO.create=e=>new TO({typeName:Pi.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...ns(e)});class bb extends Es{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Pn.date){const o=this._getOrReturnCtx(t);return mn(o,{code:Vr.invalid_type,expected:Pn.date,received:o.parsedType}),ji}if(Number.isNaN(t.data.getTime())){const o=this._getOrReturnCtx(t);return mn(o,{code:Vr.invalid_date}),ji}const n=new Su;let s;for(const o of this._def.checks)o.kind==="min"?t.data.getTime()<o.value&&(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?t.data.getTime()>o.value&&(s=this._getOrReturnCtx(t,s),mn(s,{code:Vr.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):As.assertNever(o);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new bb({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:On.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:On.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}bb.create=e=>new bb({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Pi.ZodDate,...ns(e)});class UG extends Es{_parse(t){if(this._getType(t)!==Pn.symbol){const n=this._getOrReturnCtx(t);return mn(n,{code:Vr.invalid_type,expected:Pn.symbol,received:n.parsedType}),ji}return ed(t.data)}}UG.create=e=>new UG({typeName:Pi.ZodSymbol,...ns(e)});class VG extends Es{_parse(t){if(this._getType(t)!==Pn.undefined){const n=this._getOrReturnCtx(t);return mn(n,{code:Vr.invalid_type,expected:Pn.undefined,received:n.parsedType}),ji}return ed(t.data)}}VG.create=e=>new VG({typeName:Pi.ZodUndefined,...ns(e)});class qG extends Es{_parse(t){if(this._getType(t)!==Pn.null){const n=this._getOrReturnCtx(t);return mn(n,{code:Vr.invalid_type,expected:Pn.null,received:n.parsedType}),ji}return ed(t.data)}}qG.create=e=>new qG({typeName:Pi.ZodNull,...ns(e)});class HG extends Es{constructor(){super(...arguments),this._any=!0}_parse(t){return ed(t.data)}}HG.create=e=>new HG({typeName:Pi.ZodAny,...ns(e)});class GG extends Es{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ed(t.data)}}GG.create=e=>new GG({typeName:Pi.ZodUnknown,...ns(e)});class mg extends Es{_parse(t){const r=this._getOrReturnCtx(t);return mn(r,{code:Vr.invalid_type,expected:Pn.never,received:r.parsedType}),ji}}mg.create=e=>new mg({typeName:Pi.ZodNever,...ns(e)});class WG extends Es{_parse(t){if(this._getType(t)!==Pn.undefined){const n=this._getOrReturnCtx(t);return mn(n,{code:Vr.invalid_type,expected:Pn.void,received:n.parsedType}),ji}return ed(t.data)}}WG.create=e=>new WG({typeName:Pi.ZodVoid,...ns(e)});class zh extends Es{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),s=this._def;if(r.parsedType!==Pn.array)return mn(r,{code:Vr.invalid_type,expected:Pn.array,received:r.parsedType}),ji;if(s.exactLength!==null){const d=r.data.length>s.exactLength.value,i=r.data.length<s.exactLength.value;(d||i)&&(mn(r,{code:d?Vr.too_big:Vr.too_small,minimum:i?s.exactLength.value:void 0,maximum:d?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(mn(r,{code:Vr.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(mn(r,{code:Vr.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((d,i)=>s.type._parseAsync(new pg(r,d,r.path,i)))).then(d=>Su.mergeArray(n,d));const o=[...r.data].map((d,i)=>s.type._parseSync(new pg(r,d,r.path,i)));return Su.mergeArray(n,o)}get element(){return this._def.type}min(t,r){return new zh({...this._def,minLength:{value:t,message:On.toString(r)}})}max(t,r){return new zh({...this._def,maxLength:{value:t,message:On.toString(r)}})}length(t,r){return new zh({...this._def,exactLength:{value:t,message:On.toString(r)}})}nonempty(t){return this.min(1,t)}}zh.create=(e,t)=>new zh({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Pi.ZodArray,...ns(t)});function e0(e){if(e instanceof Qa){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=sg.create(e0(n))}return new Qa({...e._def,shape:()=>t})}else return e instanceof zh?new zh({...e._def,type:e0(e.element)}):e instanceof sg?sg.create(e0(e.unwrap())):e instanceof Eb?Eb.create(e0(e.unwrap())):e instanceof Dv?Dv.create(e.items.map(t=>e0(t))):e}class Qa extends Es{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=As.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==Pn.object){const y=this._getOrReturnCtx(t);return mn(y,{code:Vr.invalid_type,expected:Pn.object,received:y.parsedType}),ji}const{status:n,ctx:s}=this._processInputParams(t),{shape:o,keys:d}=this._getCached(),i=[];if(!(this._def.catchall instanceof mg&&this._def.unknownKeys==="strip"))for(const y in s.data)d.includes(y)||i.push(y);const m=[];for(const y of d){const S=o[y],w=s.data[y];m.push({key:{status:"valid",value:y},value:S._parse(new pg(s,w,s.path,y)),alwaysSet:y in s.data})}if(this._def.catchall instanceof mg){const y=this._def.unknownKeys;if(y==="passthrough")for(const S of i)m.push({key:{status:"valid",value:S},value:{status:"valid",value:s.data[S]}});else if(y==="strict")i.length>0&&(mn(s,{code:Vr.unrecognized_keys,keys:i}),n.dirty());else if(y!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const y=this._def.catchall;for(const S of i){const w=s.data[S];m.push({key:{status:"valid",value:S},value:y._parse(new pg(s,w,s.path,S)),alwaysSet:S in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const y=[];for(const S of m){const w=await S.key,T=await S.value;y.push({key:w,value:T,alwaysSet:S.alwaysSet})}return y}).then(y=>Su.mergeObjectSync(n,y)):Su.mergeObjectSync(n,m)}get shape(){return this._def.shape()}strict(t){return On.errToObj,new Qa({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var o,d;const s=((d=(o=this._def).errorMap)==null?void 0:d.call(o,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:On.errToObj(t).message??s}:{message:s}}}:{}})}strip(){return new Qa({...this._def,unknownKeys:"strip"})}passthrough(){return new Qa({...this._def,unknownKeys:"passthrough"})}extend(t){return new Qa({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Qa({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Pi.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Qa({...this._def,catchall:t})}pick(t){const r={};for(const n of As.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Qa({...this._def,shape:()=>r})}omit(t){const r={};for(const n of As.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new Qa({...this._def,shape:()=>r})}deepPartial(){return e0(this)}partial(t){const r={};for(const n of As.objectKeys(this.shape)){const s=this.shape[n];t&&!t[n]?r[n]=s:r[n]=s.optional()}return new Qa({...this._def,shape:()=>r})}required(t){const r={};for(const n of As.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof sg;)o=o._def.innerType;r[n]=o}return new Qa({...this._def,shape:()=>r})}keyof(){return Aae(As.objectKeys(this.shape))}}Qa.create=(e,t)=>new Qa({shape:()=>e,unknownKeys:"strip",catchall:mg.create(),typeName:Pi.ZodObject,...ns(t)});Qa.strictCreate=(e,t)=>new Qa({shape:()=>e,unknownKeys:"strict",catchall:mg.create(),typeName:Pi.ZodObject,...ns(t)});Qa.lazycreate=(e,t)=>new Qa({shape:e,unknownKeys:"strip",catchall:mg.create(),typeName:Pi.ZodObject,...ns(t)});class AO extends Es{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function s(o){for(const i of o)if(i.result.status==="valid")return i.result;for(const i of o)if(i.result.status==="dirty")return r.common.issues.push(...i.ctx.common.issues),i.result;const d=o.map(i=>new cp(i.ctx.common.issues));return mn(r,{code:Vr.invalid_union,unionErrors:d}),ji}if(r.common.async)return Promise.all(n.map(async o=>{const d={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:d}),ctx:d}})).then(s);{let o;const d=[];for(const m of n){const y={...r,common:{...r.common,issues:[]},parent:null},S=m._parseSync({data:r.data,path:r.path,parent:y});if(S.status==="valid")return S;S.status==="dirty"&&!o&&(o={result:S,ctx:y}),y.common.issues.length&&d.push(y.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;const i=d.map(m=>new cp(m));return mn(r,{code:Vr.invalid_union,unionErrors:i}),ji}}get options(){return this._def.options}}AO.create=(e,t)=>new AO({options:e,typeName:Pi.ZodUnion,...ns(t)});function IF(e,t){const r=Tm(e),n=Tm(t);if(e===t)return{valid:!0,data:e};if(r===Pn.object&&n===Pn.object){const s=As.objectKeys(t),o=As.objectKeys(e).filter(i=>s.indexOf(i)!==-1),d={...e,...t};for(const i of o){const m=IF(e[i],t[i]);if(!m.valid)return{valid:!1};d[i]=m.data}return{valid:!0,data:d}}else if(r===Pn.array&&n===Pn.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let o=0;o<e.length;o++){const d=e[o],i=t[o],m=IF(d,i);if(!m.valid)return{valid:!1};s.push(m.data)}return{valid:!0,data:s}}else return r===Pn.date&&n===Pn.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class CO extends Es{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),s=(o,d)=>{if(zG(o)||zG(d))return ji;const i=IF(o.value,d.value);return i.valid?((BG(o)||BG(d))&&r.dirty(),{status:r.value,value:i.data}):(mn(n,{code:Vr.invalid_intersection_types}),ji)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,d])=>s(o,d)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}CO.create=(e,t,r)=>new CO({left:e,right:t,typeName:Pi.ZodIntersection,...ns(r)});class Dv extends Es{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.array)return mn(n,{code:Vr.invalid_type,expected:Pn.array,received:n.parsedType}),ji;if(n.data.length<this._def.items.length)return mn(n,{code:Vr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ji;!this._def.rest&&n.data.length>this._def.items.length&&(mn(n,{code:Vr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const o=[...n.data].map((d,i)=>{const m=this._def.items[i]||this._def.rest;return m?m._parse(new pg(n,d,n.path,i)):null}).filter(d=>!!d);return n.common.async?Promise.all(o).then(d=>Su.mergeArray(r,d)):Su.mergeArray(r,o)}get items(){return this._def.items}rest(t){return new Dv({...this._def,rest:t})}}Dv.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Dv({items:e,typeName:Pi.ZodTuple,rest:null,...ns(t)})};class KG extends Es{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.map)return mn(n,{code:Vr.invalid_type,expected:Pn.map,received:n.parsedType}),ji;const s=this._def.keyType,o=this._def.valueType,d=[...n.data.entries()].map(([i,m],y)=>({key:s._parse(new pg(n,i,n.path,[y,"key"])),value:o._parse(new pg(n,m,n.path,[y,"value"]))}));if(n.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const m of d){const y=await m.key,S=await m.value;if(y.status==="aborted"||S.status==="aborted")return ji;(y.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(y.value,S.value)}return{status:r.value,value:i}})}else{const i=new Map;for(const m of d){const y=m.key,S=m.value;if(y.status==="aborted"||S.status==="aborted")return ji;(y.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(y.value,S.value)}return{status:r.value,value:i}}}}KG.create=(e,t,r)=>new KG({valueType:t,keyType:e,typeName:Pi.ZodMap,...ns(r)});class xT extends Es{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.set)return mn(n,{code:Vr.invalid_type,expected:Pn.set,received:n.parsedType}),ji;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(mn(n,{code:Vr.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(mn(n,{code:Vr.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());const o=this._def.valueType;function d(m){const y=new Set;for(const S of m){if(S.status==="aborted")return ji;S.status==="dirty"&&r.dirty(),y.add(S.value)}return{status:r.value,value:y}}const i=[...n.data.values()].map((m,y)=>o._parse(new pg(n,m,n.path,y)));return n.common.async?Promise.all(i).then(m=>d(m)):d(i)}min(t,r){return new xT({...this._def,minSize:{value:t,message:On.toString(r)}})}max(t,r){return new xT({...this._def,maxSize:{value:t,message:On.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}xT.create=(e,t)=>new xT({valueType:e,minSize:null,maxSize:null,typeName:Pi.ZodSet,...ns(t)});class ZG extends Es{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}ZG.create=(e,t)=>new ZG({getter:e,typeName:Pi.ZodLazy,...ns(t)});class RF extends Es{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return mn(r,{received:r.data,code:Vr.invalid_literal,expected:this._def.value}),ji}return{status:"valid",value:t.data}}get value(){return this._def.value}}RF.create=(e,t)=>new RF({value:e,typeName:Pi.ZodLiteral,...ns(t)});function Aae(e,t){return new wb({values:e,typeName:Pi.ZodEnum,...ns(t)})}class wb extends Es{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return mn(r,{expected:As.joinValues(n),received:r.parsedType,code:Vr.invalid_type}),ji}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return mn(r,{received:r.data,code:Vr.invalid_enum_value,options:n}),ji}return ed(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return wb.create(t,{...this._def,...r})}exclude(t,r=this._def){return wb.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}wb.create=Aae;class XG extends Es{_parse(t){const r=As.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==Pn.string&&n.parsedType!==Pn.number){const s=As.objectValues(r);return mn(n,{expected:As.joinValues(s),received:n.parsedType,code:Vr.invalid_type}),ji}if(this._cache||(this._cache=new Set(As.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const s=As.objectValues(r);return mn(n,{received:n.data,code:Vr.invalid_enum_value,options:s}),ji}return ed(t.data)}get enum(){return this._def.values}}XG.create=(e,t)=>new XG({values:e,typeName:Pi.ZodNativeEnum,...ns(t)});class jO extends Es{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==Pn.promise&&r.common.async===!1)return mn(r,{code:Vr.invalid_type,expected:Pn.promise,received:r.parsedType}),ji;const n=r.parsedType===Pn.promise?r.data:Promise.resolve(r.data);return ed(n.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}}jO.create=(e,t)=>new jO({type:e,typeName:Pi.ZodPromise,...ns(t)});class Sb extends Es{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Pi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),s=this._def.effect||null,o={addIssue:d=>{mn(n,d),d.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="preprocess"){const d=s.transform(n.data,o);if(n.common.async)return Promise.resolve(d).then(async i=>{if(r.value==="aborted")return ji;const m=await this._def.schema._parseAsync({data:i,path:n.path,parent:n});return m.status==="aborted"?ji:m.status==="dirty"||r.value==="dirty"?mE(m.value):m});{if(r.value==="aborted")return ji;const i=this._def.schema._parseSync({data:d,path:n.path,parent:n});return i.status==="aborted"?ji:i.status==="dirty"||r.value==="dirty"?mE(i.value):i}}if(s.type==="refinement"){const d=i=>{const m=s.refinement(i,o);if(n.common.async)return Promise.resolve(m);if(m instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?ji:(i.status==="dirty"&&r.dirty(),d(i.value),{status:r.value,value:i.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>i.status==="aborted"?ji:(i.status==="dirty"&&r.dirty(),d(i.value).then(()=>({status:r.value,value:i.value}))))}if(s.type==="transform")if(n.common.async===!1){const d=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!xb(d))return ji;const i=s.transform(d.value,o);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:i}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(d=>xb(d)?Promise.resolve(s.transform(d.value,o)).then(i=>({status:r.value,value:i})):ji);As.assertNever(s)}}Sb.create=(e,t,r)=>new Sb({schema:e,typeName:Pi.ZodEffects,effect:t,...ns(r)});Sb.createWithPreprocess=(e,t,r)=>new Sb({schema:t,effect:{type:"preprocess",transform:e},typeName:Pi.ZodEffects,...ns(r)});class sg extends Es{_parse(t){return this._getType(t)===Pn.undefined?ed(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}sg.create=(e,t)=>new sg({innerType:e,typeName:Pi.ZodOptional,...ns(t)});class Eb extends Es{_parse(t){return this._getType(t)===Pn.null?ed(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Eb.create=(e,t)=>new Eb({innerType:e,typeName:Pi.ZodNullable,...ns(t)});class MF extends Es{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===Pn.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}MF.create=(e,t)=>new MF({innerType:e,typeName:Pi.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ns(t)});class DF extends Es{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return EO(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new cp(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new cp(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}DF.create=(e,t)=>new DF({innerType:e,typeName:Pi.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ns(t)});class YG extends Es{_parse(t){if(this._getType(t)!==Pn.nan){const n=this._getOrReturnCtx(t);return mn(n,{code:Vr.invalid_type,expected:Pn.nan,received:n.parsedType}),ji}return{status:"valid",value:t.data}}}YG.create=e=>new YG({typeName:Pi.ZodNaN,...ns(e)});class Zke extends Es{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class G5 extends Es{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?ji:o.status==="dirty"?(r.dirty(),mE(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ji:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(t,r){return new G5({in:t,out:r,typeName:Pi.ZodPipeline})}}class LF extends Es{_parse(t){const r=this._def.innerType._parse(t),n=s=>(xb(s)&&(s.value=Object.freeze(s.value)),s);return EO(r)?r.then(s=>n(s)):n(r)}unwrap(){return this._def.innerType}}LF.create=(e,t)=>new LF({innerType:e,typeName:Pi.ZodReadonly,...ns(t)});Qa.lazycreate;var Pi;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Pi||(Pi={}));const xn=Hf.create,FF=Rv.create;Mv.create;const bT=TO.create,JG=bb.create;mg.create;const hP=zh.create,Ah=Qa.create;Qa.strictCreate;AO.create;CO.create;Dv.create;const Xke=RF.create,wT=wb.create;jO.create;sg.create;Eb.create;const QD={string:e=>Hf.create({...e,coerce:!0}),number:e=>Rv.create({...e,coerce:!0}),boolean:e=>TO.create({...e,coerce:!0}),bigint:e=>Mv.create({...e,coerce:!0}),date:e=>bb.create({...e,coerce:!0})};var UN="Checkbox",[Yke,hst]=Fo(UN),[Jke,W5]=Yke(UN);function Qke(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:s,disabled:o,form:d,name:i,onCheckedChange:m,required:y,value:S="on",internal_do_not_use_render:w}=e,[T,A]=Zc({prop:r,defaultProp:s??!1,onChange:m,caller:UN}),[O,P]=V.useState(null),[N,R]=V.useState(null),M=V.useRef(!1),F=O?!!d||!!O.closest("form"):!0,B={checked:T,disabled:o,setChecked:A,control:O,setControl:P,name:i,form:d,value:S,hasConsumerStoppedPropagationRef:M,required:y,defaultChecked:ag(s)?!1:s,isFormControl:F,bubbleInput:N,setBubbleInput:R};return h.jsx(Jke,{scope:t,...B,children:eNe(w)?w(B):n})}var Cae="CheckboxTrigger",jae=V.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},s)=>{const{control:o,value:d,disabled:i,checked:m,required:y,setControl:S,setChecked:w,hasConsumerStoppedPropagationRef:T,isFormControl:A,bubbleInput:O}=W5(Cae,e),P=$n(s,S),N=V.useRef(m);return V.useEffect(()=>{const R=o==null?void 0:o.form;if(R){const M=()=>w(N.current);return R.addEventListener("reset",M),()=>R.removeEventListener("reset",M)}},[o,w]),h.jsx(on.button,{type:"button",role:"checkbox","aria-checked":ag(m)?"mixed":m,"aria-required":y,"data-state":Iae(m),"data-disabled":i?"":void 0,disabled:i,value:d,...n,ref:P,onKeyDown:Ir(t,R=>{R.key==="Enter"&&R.preventDefault()}),onClick:Ir(r,R=>{w(M=>ag(M)?!0:!M),O&&A&&(T.current=R.isPropagationStopped(),T.current||R.stopPropagation())})})});jae.displayName=Cae;var K5=V.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:s,defaultChecked:o,required:d,disabled:i,value:m,onCheckedChange:y,form:S,...w}=e;return h.jsx(Qke,{__scopeCheckbox:r,checked:s,defaultChecked:o,disabled:i,required:d,onCheckedChange:y,name:n,form:S,value:m,internal_do_not_use_render:({isFormControl:T})=>h.jsxs(h.Fragment,{children:[h.jsx(jae,{...w,ref:t,__scopeCheckbox:r}),T&&h.jsx(Nae,{__scopeCheckbox:r})]})})});K5.displayName=UN;var Pae="CheckboxIndicator",Oae=V.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...s}=e,o=W5(Pae,r);return h.jsx(zo,{present:n||ag(o.checked)||o.checked===!0,children:h.jsx(on.span,{"data-state":Iae(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});Oae.displayName=Pae;var kae="CheckboxBubbleInput",Nae=V.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:s,checked:o,defaultChecked:d,required:i,disabled:m,name:y,value:S,form:w,bubbleInput:T,setBubbleInput:A}=W5(kae,e),O=$n(r,A),P=M2(o),N=b2(n);V.useEffect(()=>{const M=T;if(!M)return;const F=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(F,"checked").set,W=!s.current;if(P!==o&&$){const K=new Event("click",{bubbles:W});M.indeterminate=ag(o),$.call(M,ag(o)?!1:o),M.dispatchEvent(K)}},[T,P,o,s]);const R=V.useRef(ag(o)?!1:o);return h.jsx(on.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??R.current,required:i,disabled:m,name:y,value:S,form:w,...t,tabIndex:-1,ref:O,style:{...t.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Nae.displayName=kae;function eNe(e){return typeof e=="function"}function ag(e){return e==="indeterminate"}function Iae(e){return ag(e)?"indeterminate":e?"checked":"unchecked"}const tl=V.forwardRef(({className:e,...t},r)=>h.jsx(K5,{ref:r,className:fr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:h.jsx(Oae,{className:fr("flex items-center justify-center text-current"),children:h.jsx(sp,{className:"h-4 w-4"})})}));tl.displayName=K5.displayName;var VN="Tabs",[tNe,fst]=Fo(VN,[uw]),Rae=uw(),[rNe,Z5]=tNe(VN),Mae=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:s,defaultValue:o,orientation:d="horizontal",dir:i,activationMode:m="automatic",...y}=e,S=Yv(i),[w,T]=Zc({prop:n,onChange:s,defaultProp:o??"",caller:VN});return h.jsx(rNe,{scope:r,baseId:yu(),value:w,onValueChange:T,orientation:d,dir:S,activationMode:m,children:h.jsx(on.div,{dir:S,"data-orientation":d,...y,ref:t})})});Mae.displayName=VN;var Dae="TabsList",Lae=V.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...s}=e,o=Z5(Dae,r),d=Rae(r);return h.jsx(c5,{asChild:!0,...d,orientation:o.orientation,dir:o.dir,loop:n,children:h.jsx(on.div,{role:"tablist","aria-orientation":o.orientation,...s,ref:t})})});Lae.displayName=Dae;var Fae="TabsTrigger",zae=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:s=!1,...o}=e,d=Z5(Fae,r),i=Rae(r),m=Uae(d.baseId,n),y=Vae(d.baseId,n),S=n===d.value;return h.jsx(u5,{asChild:!0,...i,focusable:!s,active:S,children:h.jsx(on.button,{type:"button",role:"tab","aria-selected":S,"aria-controls":y,"data-state":S?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:m,...o,ref:t,onMouseDown:Ir(e.onMouseDown,w=>{!s&&w.button===0&&w.ctrlKey===!1?d.onValueChange(n):w.preventDefault()}),onKeyDown:Ir(e.onKeyDown,w=>{[" ","Enter"].includes(w.key)&&d.onValueChange(n)}),onFocus:Ir(e.onFocus,()=>{const w=d.activationMode!=="manual";!S&&!s&&w&&d.onValueChange(n)})})})});zae.displayName=Fae;var Bae="TabsContent",$ae=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:s,children:o,...d}=e,i=Z5(Bae,r),m=Uae(i.baseId,n),y=Vae(i.baseId,n),S=n===i.value,w=V.useRef(S);return V.useEffect(()=>{const T=requestAnimationFrame(()=>w.current=!1);return()=>cancelAnimationFrame(T)},[]),h.jsx(zo,{present:s||S,children:({present:T})=>h.jsx(on.div,{"data-state":S?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":m,hidden:!T,id:y,tabIndex:0,...d,ref:t,style:{...e.style,animationDuration:w.current?"0s":void 0},children:T&&o})})});$ae.displayName=Bae;function Uae(e,t){return`${e}-trigger-${t}`}function Vae(e,t){return`${e}-content-${t}`}var nNe=Mae,qae=Lae,Hae=zae,Gae=$ae;const Lv=nNe,gg=V.forwardRef(({className:e,...t},r)=>h.jsx(qae,{ref:r,className:fr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));gg.displayName=qae.displayName;const La=V.forwardRef(({className:e,...t},r)=>h.jsx(Hae,{ref:r,className:fr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));La.displayName=Hae.displayName;const Fa=V.forwardRef(({className:e,...t},r)=>h.jsx(Gae,{ref:r,className:fr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Fa.displayName=Gae.displayName;const iNe=Ah({name:xn().min(1,Pr.t("validation.nameRequired")),name_en:xn().min(1,Pr.t("validation.nameRequired")),name_pt:xn().min(1,Pr.t("validation.nameRequired")),type:hP(xn()).min(1,Pr.t("validation.typeRequired")).max(3,Pr.t("validation.typeMaximum")),type_en:hP(xn()).min(1,Pr.t("validation.typeRequired")).max(3,Pr.t("validation.typeMaximum")),type_pt:hP(xn()).min(1,Pr.t("validation.typeRequired")).max(3,Pr.t("validation.typeMaximum")),description:xn().optional(),description_en:xn().optional(),description_pt:xn().optional(),address:xn().min(1,Pr.t("validation.addressRequired")),lat:FF(),lng:FF(),phone:xn().optional(),website_url:xn().optional(),show_website_button:bT().default(!0)}),QG=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];function PO({restaurant:e,trigger:t}){const{t:r}=ei(),{toast:n}=Ii(),s=Ri(),[o,d]=V.useState(!1),[i,m]=V.useState(null),[y,S]=V.useState((e==null?void 0:e.image_url)||null),[w,T]=V.useState(!1),A=V.useRef(null),O=V.useRef(null),P=V.useRef(null),[N,R]=V.useState(()=>{const me={};return QG.forEach(Ce=>{me[Ce]={open:"12:00",close:"23:00",closed:!1,splitShift:!1,open2:"19:00",close2:"23:00"}}),e!=null&&e.opening_hours?{...me,...e.opening_hours}:me}),[M,F]=V.useState(()=>e!=null&&e.type&&Array.isArray(e.type)?e.type.map((me,Ce)=>{var ge,pe;return{zh:me,en:((ge=e.type_en)==null?void 0:ge[Ce])||"",pt:((pe=e.type_pt)==null?void 0:pe[Ce])||""}}):[{zh:"",en:"",pt:""}]),{register:B,handleSubmit:$,formState:{errors:W},setValue:K,watch:te}=Eh({resolver:Th(iNe),defaultValues:e?{name:e.name,name_en:e.name_en||"",name_pt:e.name_pt||"",type:Array.isArray(e.type)?e.type:[e.type],type_en:Array.isArray(e.type_en)?e.type_en:e.type_en?[e.type_en]:[""],type_pt:Array.isArray(e.type_pt)?e.type_pt:e.type_pt?[e.type_pt]:[""],description:e.description||"",description_en:e.description_en||"",description_pt:e.description_pt||"",address:e.address,lat:typeof e.lat=="number"&&!isNaN(e.lat)?e.lat:38.7223,lng:typeof e.lng=="number"&&!isNaN(e.lng)?e.lng:-9.1393,phone:e.phone||"",website_url:e.website_url||"",show_website_button:e.show_website_button??!0}:{name:"",name_en:"",name_pt:"",type:[""],type_en:[""],type_pt:[""],description:"",description_en:"",description_pt:"",address:"",lat:38.7223,lng:-9.1393,phone:"",website_url:"",show_website_button:!0}}),ne=()=>{M.length<3&&F([...M,{zh:"",en:"",pt:""}])},ae=me=>{M.length>1&&F(M.filter((Ce,ge)=>ge!==me))},re=(me,Ce,ge)=>{const pe=[...M];pe[me][Ce]=ge,F(pe),K("type",pe.map(Oe=>Oe.zh).filter(Boolean)),K("type_en",pe.map(Oe=>Oe.en).filter(Boolean)),K("type_pt",pe.map(Oe=>Oe.pt).filter(Boolean))},ee=te("lat"),ie=te("lng"),de=te("show_website_button"),be=(me,Ce)=>typeof me=="number"&&typeof Ce=="number"&&!isNaN(me)&&!isNaN(Ce)&&isFinite(me)&&isFinite(Ce);V.useEffect(()=>{if(!o){O.current&&(O.current.remove(),O.current=null,P.current=null);return}if(O.current)return;const me="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g",ge=setTimeout(()=>{if(!A.current){console.error("Map container not found");return}try{No.accessToken=me;const pe=be(ee,ie)?ie:-9.1393,Oe=be(ee,ie)?ee:38.7223;O.current=new No.Map({container:A.current,style:"mapbox://styles/mapbox/light-v11",center:[pe,Oe],zoom:15}),O.current.scrollZoom.disable(),O.current.on("load",()=>{O.current&&(be(ee,ie)&&(P.current=new No.Marker({draggable:!0}).setLngLat([ie,ee]).addTo(O.current)),P.current.on("dragend",()=>{const We=P.current.getLngLat();K("lng",We.lng),K("lat",We.lat)}),setTimeout(()=>{var We;(We=O.current)==null||We.resize()},100))});const Xe=We=>{var $e,Ke;We.ctrlKey||We.metaKey?($e=O.current)==null||$e.scrollZoom.enable():(Ke=O.current)==null||Ke.scrollZoom.disable()};A.current.addEventListener("wheel",Xe),O.current.on("click",We=>{var Le;const{lng:$e,lat:Ke}=We.lngLat;K("lng",$e),K("lat",Ke),(Le=P.current)==null||Le.setLngLat([$e,Ke])}),O.current.on("error",We=>{console.error("Map error:",We)})}catch(pe){console.error("Failed to initialize map:",pe)}},500);return()=>{clearTimeout(ge)}},[o,ee,ie]),V.useEffect(()=>{P.current&&O.current&&be(ee,ie)&&(P.current.setLngLat([ie,ee]),O.current.setCenter([ie,ee]))},[ee,ie]);const Se=me=>{var ge;const Ce=(ge=me.target.files)==null?void 0:ge[0];if(Ce){m(Ce);const pe=new FileReader;pe.onloadend=()=>{S(pe.result)},pe.readAsDataURL(Ce)}},Ae=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const me=i.name.split(".").pop(),ge=`${`${Math.random()}.${me}`}`,{error:pe}=await Ct.storage.from("restaurant-images").upload(ge,i);if(pe)throw pe;const{data:{publicUrl:Oe}}=Ct.storage.from("restaurant-images").getPublicUrl(ge);return Oe},xe=async me=>{T(!0);try{const{data:{user:Ce}}=await Ct.auth.getUser();if(!Ce)throw new Error("Not authenticated");const ge=await Ae(),pe={name:me.name,name_en:me.name_en,name_pt:me.name_pt,type:me.type,type_en:me.type_en,type_pt:me.type_pt,description:me.description||null,description_en:me.description_en||null,description_pt:me.description_pt||null,address:me.address,lat:me.lat,lng:me.lng,phone:me.phone||null,website_url:me.website_url||null,show_website_button:me.show_website_button,image_url:ge,opening_hours:N};if(e){const{error:Oe}=await Ct.from("restaurants").update({...pe,updated_by:Ce.id}).eq("id",e.id);if(Oe)throw Oe;n({title:r("common.success"),description:r("admin.restaurantUpdated")})}else{const{error:Oe}=await Ct.from("restaurants").insert([{...pe,created_by:Ce.id}]);if(Oe)throw Oe;n({title:r("common.success"),description:r("admin.restaurantCreated")})}s.invalidateQueries({queryKey:["restaurants"]}),d(!1)}catch(Ce){n({title:r("common.error"),description:Ce.message,variant:"destructive"})}finally{T(!1)}};return h.jsxs(Lo,{open:o,onOpenChange:d,children:[h.jsx(tf,{asChild:!0,children:t}),h.jsxs(xo,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[h.jsxs(bo,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[h.jsxs(wo,{className:"text-2xl flex items-center gap-2",children:[h.jsx(Mo,{className:"w-6 h-6 text-primary"}),r(e?"admin.editRestaurant":"admin.addRestaurant")]}),h.jsx(pl,{className:"text-base",children:r(e?"admin.editRestaurantDetails":"admin.createRestaurantWithInfo")})]}),h.jsx(Ov,{className:"px-6 h-[calc(95vh-220px)]",children:h.jsxs("form",{onSubmit:$(xe),className:"space-y-6 py-6",children:[h.jsx(kr,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:h.jsxs(Mr,{className:"p-6",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[h.jsx(Lh,{className:"w-5 h-5 text-primary"}),r("admin.restaurantImage")]}),h.jsxs("div",{className:"flex items-center gap-6",children:[y&&h.jsxs("div",{className:"relative group",children:[h.jsx("img",{src:y,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),h.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{m(null),S(null)},children:h.jsx(wu,{className:"h-4 w-4"})})]}),h.jsxs(yr,{htmlFor:"image-upload",className:"cursor-pointer",children:[h.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[h.jsx(Lh,{className:"h-8 w-8 text-primary"}),h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),h.jsx(cr,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Se})]})]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[h.jsx(yv,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),h.jsxs(Lv,{defaultValue:"zh",className:"w-full",children:[h.jsxs(gg,{className:"grid w-full grid-cols-3 mb-6",children:[h.jsxs(La,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),h.jsxs(La,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),h.jsxs(La,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),h.jsxs(Fa,{value:"zh",className:"space-y-4 mt-0",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"name",className:"text-sm font-medium",children:r("admin.restaurantName")}),h.jsx(cr,{id:"name",...B("name"),placeholder:r("admin.enterRestaurantName"),className:"text-base"}),W.name&&h.jsx("p",{className:"text-sm text-destructive",children:W.name.message})]}),h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex justify-between items-center",children:[h.jsx(yr,{className:"text-sm font-medium",children:r("admin.restaurantType")}),M.length<3&&h.jsx(Mt,{type:"button",variant:"outline",size:"sm",onClick:ne,children:r("admin.addType")})]}),M.map((me,Ce)=>h.jsxs("div",{className:"flex gap-2 items-center",children:[h.jsx(cr,{placeholder:r("admin.typeExample"),value:me.zh,onChange:ge=>re(Ce,"zh",ge.target.value)}),h.jsx(Mt,{type:"button",variant:"ghost",size:"icon",onClick:()=>ae(Ce),disabled:M.length===1,children:h.jsx(wu,{className:"h-4 w-4"})})]},Ce)),W.type&&h.jsx("p",{className:"text-sm text-destructive",children:W.type.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"description",className:"text-sm font-medium",children:r("admin.description")}),h.jsx(fl,{id:"description",...B("description"),rows:3,placeholder:"..."})]})]}),h.jsxs(Fa,{value:"en",className:"space-y-4 mt-0",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"name_en",className:"text-sm font-medium",children:"Restaurant Name"}),h.jsx(cr,{id:"name_en",...B("name_en"),placeholder:"Enter restaurant name...",className:"text-base"}),W.name_en&&h.jsx("p",{className:"text-sm text-destructive",children:W.name_en.message})]}),h.jsxs("div",{className:"space-y-3",children:[h.jsx(yr,{className:"text-sm font-medium",children:"Restaurant Types (1-3 tags)"}),M.map((me,Ce)=>h.jsx("div",{className:"flex gap-2 items-center",children:h.jsx(cr,{placeholder:"e.g. Cantonese",value:me.en,onChange:ge=>re(Ce,"en",ge.target.value)})},Ce))]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"description_en",className:"text-sm font-medium",children:"Description"}),h.jsx(fl,{id:"description_en",...B("description_en"),rows:3,placeholder:"Enter restaurant description..."})]})]}),h.jsxs(Fa,{value:"pt",className:"space-y-4 mt-0",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"name_pt",className:"text-sm font-medium",children:"Nome do Restaurante"}),h.jsx(cr,{id:"name_pt",...B("name_pt"),placeholder:"Digite o nome do restaurante...",className:"text-base"}),W.name_pt&&h.jsx("p",{className:"text-sm text-destructive",children:W.name_pt.message})]}),h.jsxs("div",{className:"space-y-3",children:[h.jsx(yr,{className:"text-sm font-medium",children:"Tipos de Restaurante (1-3 tags)"}),M.map((me,Ce)=>h.jsx("div",{className:"flex gap-2 items-center",children:h.jsx(cr,{placeholder:"ex: Cantonesa",value:me.pt,onChange:ge=>re(Ce,"pt",ge.target.value)})},Ce))]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"description_pt",className:"text-sm font-medium",children:"Descrio"}),h.jsx(fl,{id:"description_pt",...B("description_pt"),rows:3,placeholder:"Digite a descrio do restaurante..."})]})]})]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6 space-y-4",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2",children:[h.jsx(ga,{className:"w-5 h-5 text-primary"}),""]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"address",className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(ga,{className:"w-4 h-4"}),r("admin.address")]}),h.jsx(cr,{id:"address",...B("address"),placeholder:"..."}),W.address&&h.jsx("p",{className:"text-sm text-destructive",children:W.address.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"phone",className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(tw,{className:"w-4 h-4"}),r("admin.phone")]}),h.jsx(cr,{id:"phone",...B("phone"),placeholder:"+351..."})]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"website_url",className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(yv,{className:"w-4 h-4"}),r("admin.website")]}),h.jsx(cr,{id:"website_url",...B("website_url"),placeholder:"https://"})]}),h.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[h.jsx(tl,{id:"show_website_button",checked:de,onCheckedChange:me=>K("show_website_button",me)}),h.jsx(yr,{htmlFor:"show_website_button",className:"cursor-pointer text-sm",children:r("admin.showWebsiteButton")})]})]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6 space-y-4",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2",children:[h.jsx(ga,{className:"w-5 h-5 text-primary"}),r("admin.location")]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"lat",className:"text-sm font-medium",children:r("admin.latitude")}),h.jsx(cr,{id:"lat",type:"number",step:"any",...B("lat",{valueAsNumber:!0})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"lng",className:"text-sm font-medium",children:r("admin.longitude")}),h.jsx(cr,{id:"lng",type:"number",step:"any",...B("lng",{valueAsNumber:!0})})]})]}),h.jsx("div",{ref:A,className:"h-96 w-full rounded-lg border-2 border-primary/20 shadow-sm",style:{minHeight:"384px"}}),h.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[h.jsx(ga,{className:"w-4 h-4"}),r("admin.clickOrDragToSetLocation")]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6 space-y-4",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2",children:[h.jsx(Xv,{className:"w-5 h-5 text-primary"}),r("admin.openingHours")]}),h.jsx("div",{className:"space-y-3",children:QG.map(me=>h.jsxs("div",{className:"space-y-2 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[h.jsxs("div",{className:"grid grid-cols-[120px_1fr_auto] gap-4 items-center",children:[h.jsx(yr,{className:"capitalize font-semibold",children:r(`admin.day.${me}`)}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(tl,{id:`split-${me}`,checked:N[me].splitShift,onCheckedChange:Ce=>R({...N,[me]:{...N[me],splitShift:Ce}}),disabled:N[me].closed}),h.jsx(yr,{htmlFor:`split-${me}`,className:"cursor-pointer text-sm",children:""})]}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx(tl,{id:`closed-${me}`,checked:N[me].closed,onCheckedChange:Ce=>R({...N,[me]:{...N[me],closed:Ce}})}),h.jsx(yr,{htmlFor:`closed-${me}`,className:"cursor-pointer",children:r("admin.closed")})]})]}),!N[me].closed&&h.jsx("div",{className:"ml-[120px] space-y-2",children:N[me].splitShift?h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),h.jsx(cr,{type:"time",value:N[me].open,onChange:Ce=>R({...N,[me]:{...N[me],open:Ce.target.value}}),className:"w-32"}),h.jsx("span",{className:"text-muted-foreground",children:"-"}),h.jsx(cr,{type:"time",value:N[me].close,onChange:Ce=>R({...N,[me]:{...N[me],close:Ce.target.value}}),className:"w-32"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),h.jsx(cr,{type:"time",value:N[me].open2||"19:00",onChange:Ce=>R({...N,[me]:{...N[me],open2:Ce.target.value}}),className:"w-32"}),h.jsx("span",{className:"text-muted-foreground",children:"-"}),h.jsx(cr,{type:"time",value:N[me].close2||"23:00",onChange:Ce=>R({...N,[me]:{...N[me],close2:Ce.target.value}}),className:"w-32"})]})]}):h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{type:"time",value:N[me].open,onChange:Ce=>R({...N,[me]:{...N[me],open:Ce.target.value}}),className:"w-32"}),h.jsx("span",{className:"text-muted-foreground",children:"-"}),h.jsx(cr,{type:"time",value:N[me].close,onChange:Ce=>R({...N,[me]:{...N[me],close:Ce.target.value}}),className:"w-32"})]})})]},me))})]})})]})}),h.jsxs("div",{className:"flex justify-end gap-2 px-6 py-4 border-t bg-muted/30",children:[h.jsx(Mt,{type:"button",variant:"outline",onClick:()=>d(!1),children:r("common.cancel")}),h.jsxs(Mt,{type:"submit",disabled:w,onClick:$(xe),className:"gap-2",children:[h.jsx(Mo,{className:"w-4 h-4"}),r(w?"common.saving":"common.save")]})]})]})]})}const eL=768;function qN(){const[e,t]=V.useState(void 0);return V.useEffect(()=>{const r=window.matchMedia(`(max-width: ${eL-1}px)`),n=()=>{t(window.innerWidth<eL)};return r.addEventListener("change",n),t(window.innerWidth<eL),()=>r.removeEventListener("change",n)},[]),!!e}const sNe=()=>{var We,$e,Ke;const{id:e}=Bee(),t=Qh(),{t:r,i18n:n}=ei(),{user:s}=Qn(),{localizeRestaurant:o,getLocalizedField:d}=xc(),i=qN(),m=V.useRef(null),y=V.useRef(null),[S,w]=V.useState(null),[T,A]=V.useState(!1),[O,P]=V.useState(!0),[N,R]=V.useState(!1),[M,F]=V.useState(!1),B=(We=t.state)==null?void 0:We.fromActivity,W=(($e=t.state)==null?void 0:$e.from)==="admin"?"/admin/restaurants":B?`/activity/${B}`:"/restaurants",{data:K,isLoading:te}=CPe(e),{data:ne=[]}=Die(),{data:ae}=R5(e,"restaurant"),re=Lie(),{role:ee,isAdmin:ie}=_c(),{data:de=[]}=D2(),{data:be=[]}=PPe(e),Se=K&&de.some(Le=>Le.id===K.id),Ae=K?o(K):null,xe=K?ne.includes(K.id):!1;V.useMemo(()=>[{value:"",label:" (0-10)"},{value:"",label:" (10-20)"},{value:"",label:" (20+)"}],[]);const me=V.useMemo(()=>ae==null?void 0:ae.reduce((Le,ke)=>(ke.price_range&&(Le[ke.price_range]=(Le[ke.price_range]||0)+1),Le),{}),[ae]),Ce=V.useMemo(()=>{var Le;return me?(Le=Object.entries(me).sort(([,ke],[,st])=>st-ke)[0])==null?void 0:Le[0]:null},[me]);V.useEffect(()=>{K&&RN().then(Le=>{const ke=R2(Le.coords.latitude,Le.coords.longitude,K.lat,K.lng);w(ke)}).catch(()=>{w(null)})},[K]);const ge=V.useCallback(()=>{!s||!K||re.mutate(K.id)},[s,K,re]),pe=V.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),Nr.success(r("common.linkCopied"))}catch(Le){console.error("Error copying link:",Le),Nr.error(r("common.shareError"))}},[r]),Oe=V.useCallback(async()=>{if(!K||!Ae)return;const Le={title:Ae.name,text:`${Ae.name} - Xiaoxiong Market

${Ae.description||Ae.address}`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(Le)?(await navigator.share(Le),Nr.success(r("common.shareSuccess"))):pe()}catch(ke){ke.name!=="AbortError"&&(console.error("Error sharing:",ke),Nr.error(r("common.shareError")))}},[K,Ae,pe,r]),Xe=V.useCallback(Le=>{if(!K||!Ae)return;const ke=encodeURIComponent(window.location.href),st=encodeURIComponent(Ae.name);let _t="";switch(Le){case"whatsapp":_t=`https://wa.me/?text=${st}%20${ke}`;break;case"facebook":_t=`https://www.facebook.com/sharer/sharer.php?u=${ke}`;break;case"twitter":_t=`https://twitter.com/intent/tweet?text=${st}&url=${ke}`;break;case"telegram":_t=`https://t.me/share/url?url=${ke}&text=${st}`;break;case"wechat":pe(),Nr.info(r("common.shareVia")+" WeChat");return;default:return}window.open(_t,"_blank","width=600,height=400")},[K,Ae,pe,r]);return V.useEffect(()=>{if(!m.current||y.current||!K)return;const Le="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";return No.accessToken=Le,y.current=new No.Map({container:m.current,style:"mapbox://styles/mapbox/light-v11",center:[K.lng,K.lat],zoom:15,cooperativeGestures:!0}),new No.Marker({color:"#016450"}).setLngLat([K.lng,K.lat]).addTo(y.current),y.current.addControl(new No.NavigationControl),()=>{var ke;(ke=y.current)==null||ke.remove(),y.current=null}},[K]),te?h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsx(aa,{className:"w-8 h-8 animate-spin text-primary"})}):!K||!Ae?h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-xl text-muted-foreground",children:r("error.notFound")}),h.jsx(Mt,{asChild:!0,className:"mt-4",children:h.jsx(Hi,{to:W,children:r("common.back")})})]})}):h.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[h.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[h.jsx("img",{src:K.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:Ae.name,className:"w-full h-full object-cover"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),h.jsx(Mt,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:h.jsx(Hi,{to:W,children:h.jsx(eN,{className:"w-5 h-5"})})}),s&&h.jsx(Mt,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:ge,children:h.jsx(VP,{className:`w-5 h-5 ${xe?"fill-destructive text-destructive":""}`})}),i&&navigator.share?h.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${s?"right-16":"right-4"}`,onClick:Oe,children:h.jsx(Dd,{className:"w-5 h-5"})}):h.jsxs(e_,{children:[h.jsx(t_,{asChild:!0,children:h.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${s?"right-16":"right-4"}`,children:h.jsx(Dd,{className:"w-5 h-5"})})}),h.jsxs(Eg,{align:"end",className:"w-48",children:[navigator.share&&h.jsxs(h.Fragment,{children:[h.jsxs(Is,{onClick:Oe,children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),r("common.moreOptions")]}),h.jsx(Xf,{})]}),h.jsxs(Is,{onClick:()=>Xe("wechat"),children:[h.jsx(Om,{className:"w-4 h-4 mr-2"}),"WeChat"]}),h.jsxs(Is,{onClick:()=>Xe("whatsapp"),children:[h.jsx(Om,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),h.jsxs(Is,{onClick:()=>Xe("facebook"),children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),"Facebook"]}),h.jsxs(Is,{onClick:()=>Xe("twitter"),children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),h.jsxs(Is,{onClick:()=>Xe("telegram"),children:[h.jsx(Om,{className:"w-4 h-4 mr-2"}),"Telegram"]}),h.jsx(Xf,{}),h.jsxs(Is,{onClick:pe,children:[h.jsx(O3,{className:"w-4 h-4 mr-2"}),r("common.copyLink")]})]})]}),(Se||ie)&&K&&h.jsx(PO,{restaurant:K,trigger:h.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 ${s?"right-28":"right-16"}`,children:h.jsx(_2,{className:"w-5 h-5"})})}),K&&h.jsx(F5,{targetType:"restaurant",targetId:K.id,trigger:h.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 ${Se||ie?s?"right-40":"right-28":s?"right-28":"right-16"}`,children:h.jsx(iN,{className:"w-5 h-5"})})})]}),h.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:h.jsxs(kr,{className:"shadow-large",children:[h.jsx(Rn,{children:h.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:h.jsxs("div",{children:[h.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:Ae.type.slice(0,3).map((Le,ke)=>h.jsx(tn,{variant:"secondary",children:Le},ke))}),h.jsx(Hn,{className:"text-3xl mb-2",children:Ae.name}),h.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[S!==null&&h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Hu,{className:"w-4 h-4 text-primary"}),h.jsxs("span",{className:"font-semibold text-base",children:[S.toFixed(1)," km"]})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Cl,{className:"w-5 h-5 fill-accent text-accent"}),h.jsx("span",{className:"font-semibold text-base",children:((Ke=K.rating)==null?void 0:Ke.toFixed(1))||"0.0"})]}),Ce&&h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(U_e,{className:"w-4 h-4 text-primary"}),h.jsx("span",{className:"font-semibold text-base",children:Ce})]})]}),Ae.description&&h.jsx("p",{className:"text-muted-foreground",children:Ae.description})]})})}),h.jsxs(Mr,{className:"space-y-6",children:[h.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[be.length>0&&h.jsxs(m0,{open:M,onOpenChange:F,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[h.jsx(Cl,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),h.jsxs("div",{className:"flex-1",children:[h.jsx(g0,{className:"w-full",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex flex-col items-start",children:[h.jsx("p",{className:"font-medium text-card-foreground",children:r("activities.title")}),!M&&h.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:be.map((Le,ke)=>h.jsx(tn,{variant:"default",className:"text-white",style:{backgroundColor:Le.badge_color||"#9b87f5"},children:yO(Le,n.language)},`activity-${ke}`))})]}),h.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${M?"rotate-180":""}`})]})}),h.jsx(y0,{className:"mt-3 space-y-2",children:be.map((Le,ke)=>{const st=kPe(Le,n.language);return h.jsxs(Hi,{to:`/activity/${Le.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[h.jsx(tn,{variant:"default",className:"text-white mr-2",style:{backgroundColor:Le.badge_color||"#9b87f5"},children:yO(Le,n.language)}),h.jsx("span",{className:"text-sm text-muted-foreground",children:st||OPe(Le,n.language)})]},`activity-detail-${ke}`)})})]})]}),h.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[h.jsx(ga,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.address")}),h.jsx("p",{className:"text-muted-foreground",children:K.address})]})]}),K.phone&&h.jsxs("a",{href:`tel:${K.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[h.jsx(tw,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.phone")}),h.jsx("p",{className:"text-primary underline",children:K.phone})]})]}),K.opening_hours&&h.jsxs(m0,{open:T,onOpenChange:A,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[h.jsx(Xv,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),h.jsxs("div",{className:"flex-1",children:[h.jsx(g0,{className:"w-full",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex flex-col items-start",children:[h.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.hours")}),!T&&h.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[r("restaurant.today")," ",Vie(K.opening_hours)]})]}),h.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${T?"rotate-180":""}`})]})}),h.jsx(y0,{className:"mt-3",children:h.jsx("div",{className:"space-y-2",children:(()=>{const Le=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],ke={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},st=Le[new Date().getDay()===0?6:new Date().getDay()-1];return Le.map(_t=>{const Be=K.opening_hours[_t],Dt=_t===st,It=r(`restaurant.${ke[_t]}`);let ir="N/A";return Be&&(Be.closed?ir=r("restaurant.closed"):Be.splitShift?ir=`${Be.open} - ${Be.close}, ${Be.open2} - ${Be.close2}`:ir=`${Be.open} - ${Be.close}`),h.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${Dt?"bg-primary/10 border border-primary/20":""}`,children:[h.jsxs("span",{className:`text-sm font-medium ${Dt?"text-primary":"text-foreground"}`,children:[It,Dt&&h.jsxs("span",{className:"ml-2 text-xs",children:["(",r("restaurant.today"),")"]})]}),h.jsx("span",{className:`text-sm ${Dt?"text-primary font-semibold":"text-muted-foreground"} ${Be!=null&&Be.closed?"italic":""}`,children:ir})]},_t)})})()})})]})]}),K&&(d(K,"announcement")||K.announcement_zh)&&h.jsxs(m0,{open:N,onOpenChange:R,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[h.jsx(Om,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),h.jsxs("div",{className:"flex-1",children:[h.jsx(g0,{className:"w-full",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.announcement")}),h.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${N?"rotate-180":""}`})]})}),h.jsx(y0,{className:"mt-3",children:h.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:h.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:d(K,"announcement")||K.announcement_zh})})})]})]})]}),h.jsxs("div",{className:"flex flex-col gap-3",children:[h.jsxs(Mt,{variant:"secondary",className:"w-full",onClick:()=>zie(K.lat,K.lng,Ae.name),children:[h.jsx(Hu,{className:"w-4 h-4 mr-2"}),r("restaurant.getDirections")]}),K.show_website_button&&K.website_url&&h.jsxs(Mt,{className:"w-full",onClick:()=>window.open(K.website_url,"_blank"),children:[h.jsx(Om,{className:"w-4 h-4 mr-2"}),r("restaurant.joinPrivate")]})]}),h.jsxs(m0,{open:O,onOpenChange:P,className:"p-4 rounded-lg bg-muted/50",children:[h.jsx(g0,{className:"w-full",children:h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsx("h2",{className:"text-2xl font-bold",children:r("restaurant.address")}),h.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${O?"rotate-180":""}`})]})}),h.jsx(y0,{children:h.jsx("div",{ref:m,className:"h-[350px] rounded-lg overflow-hidden"})})]}),h.jsx(Yo,{}),h.jsx(WPe,{restaurantId:K.id}),h.jsx(Yo,{}),h.jsx(uae,{restaurantId:K.id})]})]})})]})},eW=({restaurant:e,activities:t,language:r})=>{const[n,s]=V.useState(999),o=V.useRef(null),d=[...e.type.slice(0,3).map((y,S)=>({key:`type-${S}`,label:y,variant:"secondary",color:void 0})),...t.map((y,S)=>({key:`activity-${S}`,label:yO(y,r),variant:"default",color:y.badge_color||"#9b87f5"}))];V.useEffect(()=>{const y=()=>{var P;if(!o.current)return;const w=o.current,T=Array.from(w.querySelectorAll(".tag-badge"));if(T.length===0){setTimeout(y,50);return}const A=(P=T[0])==null?void 0:P.offsetTop;let O=T.length;for(let N=0;N<T.length;N++)if(T[N].offsetTop>A){O=N;break}O<T.length&&(O=Math.max(1,O-1)),s(O)};s(999);const S=setTimeout(y,100);return window.addEventListener("resize",y),()=>{clearTimeout(S),window.removeEventListener("resize",y)}},[d.length,e.id]);const i=d.slice(0,n),m=d.length>n;return h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{ref:o,className:"flex gap-1.5 flex-wrap flex-1",children:i.map(y=>h.jsx(tn,{variant:y.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:y.color?{backgroundColor:y.color,color:"white"}:void 0,children:y.label},y.key))}),m&&h.jsxs(mO,{children:[h.jsx(gO,{asChild:!0,children:h.jsx(Mt,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:h.jsx(TB,{className:"h-4 w-4"})})}),h.jsx(_T,{className:"w-80",children:h.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(y=>h.jsx(tn,{variant:y.variant,className:"text-xs font-medium",style:y.color?{backgroundColor:y.color,color:"white"}:void 0,children:y.label},y.key))})})]})]})},aNe=()=>{const e=Ju(),{t,i18n:r}=ei(),{toast:n}=Ii(),{localizeRestaurant:s}=xc(),[o,d]=V.useState(""),[i,m]=V.useState([]),[y,S]=V.useState(null),[w,T]=V.useState([]),[A,O]=V.useState(null),[P,N]=V.useState(null),[R,M]=V.useState(!1),[F,B]=V.useState(!1),[$,W]=V.useState(!1),K=V.useRef(null),te=V.useRef(null),ne=V.useRef({}),[ae,re]=V.useState(null),{data:ee,isLoading:ie}=P5(o,i.length>0?i.join(","):void 0),{data:de=[]}=Fie(),{data:be=[]}=MN(),Se=Le=>{m(ke=>ke.includes(Le)?ke.filter(st=>st!==Le):[...ke,Le])},Ae=async()=>{try{const Le=await RN();N({lat:Le.coords.latitude,lng:Le.coords.longitude}),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{}},xe=Le=>{O(Le),Le&&!P&&Ae()},me=async Le=>{if(y===Le)S(null),T([]);else{S(Le);const{data:ke,error:st}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",Le);st?(console.error("Error fetching activity restaurants:",st),T([])):T(ke.map(_t=>_t.restaurant_id))}},Ce=(ee==null?void 0:ee.map(Le=>{const ke=s(Le);if(P){const st=R2(P.lat,P.lng,Le.lat,Le.lng);return{...ke,distance:st}}return ke}))||[],ge=y&&w.length>0?Ce.filter(Le=>w.includes(Le.id)):Ce,pe=A&&P?ge.filter(Le=>Le.distance&&Le.distance<=A).sort((Le,ke)=>(Le.distance||0)-(ke.distance||0)):P?ge.sort((Le,ke)=>(Le.distance||0)-(ke.distance||0)):ge,Oe=(pe==null?void 0:pe.map(Le=>Le.id))||[],{data:Xe={}}=qie(Oe),We=Le=>{e(`/restaurant/${Le.id}`)},$e=Le=>{re(Le.id);const ke=ne.current[Le.id];ke&&ke.scrollIntoView({behavior:"smooth",block:"center"})},Ke=()=>{const Le=document.getElementById("map-container");if(Le)if(R)document.exitFullscreen&&document.exitFullscreen();else{if(K.current){const ke=K.current.getCenter(),st=K.current.getZoom();te.current={center:[ke.lng,ke.lat],zoom:st}}Le.requestFullscreen&&Le.requestFullscreen()}};return V.useEffect(()=>{const Le=()=>{const ke=!!document.fullscreenElement;M(ke),!ke&&te.current&&K.current&&setTimeout(()=>{var st;(st=K.current)==null||st.jumpTo({center:te.current.center,zoom:te.current.zoom})},100)};return document.addEventListener("fullscreenchange",Le),()=>{document.removeEventListener("fullscreenchange",Le)}},[]),h.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:h.jsxs("div",{className:"container mx-auto max-w-7xl lg:h-screen lg:flex lg:flex-col",children:[h.jsxs("div",{className:"mb-6 flex-shrink-0",children:[h.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:t("nav.mapView")}),h.jsx("p",{className:"text-muted-foreground",children:t("map.subtitle")})]}),h.jsxs("div",{className:"mb-6 space-y-4 flex-shrink-0",children:[h.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[h.jsx("div",{className:"flex-1 max-w-md",children:h.jsx(cr,{placeholder:t("restaurants.search"),value:o,onChange:Le=>d(Le.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),h.jsxs(Mt,{variant:P?"default":"outline",onClick:Ae,className:"gap-2 h-11 px-6",children:[h.jsx(Hu,{className:`w-4 h-4 ${P?"animate-pulse":""}`}),t(P?"restaurants.locationEnabled":"restaurants.getLocation")]})]}),h.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[h.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("restaurants.restaurantTypes"),":"]}),i.length>0&&h.jsx(tn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>m([]),children:t("common.actions.clearFilter")}),de.length>8&&h.jsx(Mt,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>B(!F),children:t(F?"common.showLess":"common.showMore")})]}),h.jsxs("div",{className:"relative overflow-hidden",children:[h.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${F?"animate-expand-height":""}`,children:(F?de:de.slice(0,8)).map((Le,ke)=>h.jsx(tn,{variant:i.includes(Le)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${i.includes(Le)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${ke*30}ms`},onClick:()=>Se(Le),children:Le},Le))}),h.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[h.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:de.map((Le,ke)=>h.jsx(tn,{variant:i.includes(Le)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${i.includes(Le)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${ke*30}ms`},onClick:()=>Se(Le),children:Le},Le))}),h.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),h.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),be.length>0&&h.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[h.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("nav.activities"),":"]}),y&&h.jsx(tn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{S(null),T([])},children:t("common.actions.clearFilter")}),be.length>8&&h.jsx(Mt,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>W(!$),children:t($?"common.showLess":"common.showMore")})]}),h.jsxs("div",{className:"relative overflow-hidden",children:[h.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${$?"animate-expand-height":""}`,children:($?be:be.slice(0,8)).map((Le,ke)=>{const st=r.language==="zh"?Le.title_zh:r.language==="pt"?Le.title_pt:Le.title_en;return h.jsx(tn,{variant:y===Le.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${y===Le.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${ke*30}ms`},onClick:()=>me(Le.id),children:st},Le.id)})}),h.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[h.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:be.map((Le,ke)=>{const st=r.language==="zh"?Le.title_zh:r.language==="pt"?Le.title_pt:Le.title_en;return h.jsx(tn,{variant:y===Le.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${y===Le.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${ke*30}ms`},onClick:()=>me(Le.id),children:st},Le.id)})}),h.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),h.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),P&&h.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[h.jsxs("span",{className:"text-sm font-semibold text-primary",children:[t("restaurants.radius"),":"]}),h.jsx(tn,{variant:A===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>xe(null),children:t("restaurants.allRestaurants")}),h.jsx(tn,{variant:A===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>xe(5),children:t("restaurants.radius5km")}),h.jsx(tn,{variant:A===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>xe(10),children:t("restaurants.radius10km")}),h.jsx(tn,{variant:A===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>xe(20),children:t("restaurants.radius20km")})]})]}),!ie&&pe&&h.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:[h.jsx("div",{className:"w-full lg:flex-1 h-[500px] lg:h-full",children:h.jsxs("div",{id:"map-container",className:`${R?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[h.jsx(Mt,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:Ke,children:R?h.jsx(M_e,{className:"w-5 h-5"}):h.jsx(R_e,{className:"w-5 h-5"})}),h.jsx("div",{className:"h-full",children:h.jsx(Uie,{restaurants:pe,onRestaurantClick:We,userLocation:P,radiusFilter:A,onMarkerClick:$e,showViewDetailsButton:!0,onMapInit:Le=>{K.current=Le}})})]})}),h.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col lg:min-h-0 lg:h-full",children:[h.jsxs("div",{className:"mb-4 pb-4 border-b border-border flex-shrink-0",children:[h.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[h.jsx(ga,{className:"w-6 h-6 text-primary"}),t("restaurants.title"),h.jsx(tn,{variant:"secondary",className:"ml-2",children:pe.length})]}),P&&h.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[h.jsx(Hu,{className:"w-4 h-4"}),t("restaurants.sortedByDistance")]})]}),pe.length===0?h.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[h.jsx(ga,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),h.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:t("restaurants.noResults")}),h.jsx("p",{className:"text-muted-foreground max-w-xs",children:t("restaurants.noResultsDesc")})]}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"lg:hidden space-y-3 pb-4",children:pe.map(Le=>h.jsx(kr,{ref:ke=>ne.current[Le.id]=ke,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${ae===Le.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>We(Le),children:h.jsxs("div",{className:"flex flex-col gap-3",children:[h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Le.name}),h.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[Le.distance!==void 0&&h.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[h.jsx(Hu,{className:"w-4 h-4 text-primary"}),h.jsx("span",{className:"font-bold text-sm text-primary",children:Le.distance<1?`${(Le.distance*1e3).toFixed(0)} m`:`${Le.distance.toFixed(1)} km`})]}),Le.rating>0&&h.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[h.jsx(Cl,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),h.jsx("span",{className:"font-bold text-sm text-primary",children:Le.rating})]})]})]}),Le.type&&Le.type.length>0&&h.jsx(eW,{restaurant:Le,activities:Xe[Le.id]||[],language:r.language}),h.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[h.jsx(ga,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),h.jsx("span",{className:"line-clamp-2",children:Le.address})]})]})},Le.id))}),h.jsx(Ov,{className:"hidden lg:block lg:flex-1 pr-4",children:h.jsx("div",{className:"space-y-3 pb-4",children:pe.map(Le=>h.jsx(kr,{ref:ke=>ne.current[Le.id]=ke,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${ae===Le.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>We(Le),children:h.jsxs("div",{className:"flex flex-col gap-3",children:[h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Le.name}),h.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[Le.distance!==void 0&&h.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[h.jsx(Hu,{className:"w-4 h-4 text-primary"}),h.jsx("span",{className:"font-bold text-sm text-primary",children:Le.distance<1?`${(Le.distance*1e3).toFixed(0)} m`:`${Le.distance.toFixed(1)} km`})]}),Le.rating>0&&h.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[h.jsx(Cl,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),h.jsx("span",{className:"font-bold text-sm text-primary",children:Le.rating})]})]})]}),Le.type&&Le.type.length>0&&h.jsx(eW,{restaurant:Le,activities:Xe[Le.id]||[],language:r.language}),h.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[h.jsx(ga,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),h.jsx("span",{className:"line-clamp-2",children:Le.address})]})]})},Le.id))})})]})]})]})]})})},X5=()=>ci({queryKey:["activity-rules"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activity_rules").select("*").single();if(t)throw t;return e}}),oNe=()=>{const e=Ri();return Gi({mutationFn:async t=>{const{data:r,error:n}=await Ct.from("activity_rules").update({content_zh:t.content_zh,content_en:t.content_en,content_pt:t.content_pt,updated_at:new Date().toISOString()}).eq("id",t.id).select().single();if(n)throw n;return r},onSuccess:()=>{e.invalidateQueries({queryKey:["activity-rules"]})}})},Wae=({children:e})=>{const{t,i18n:r}=ei(),{data:n,isLoading:s}=X5(),o=()=>{if(!n)return"";const d=r.language;return d==="zh"?n.content_zh:d==="pt"?n.content_pt:n.content_en};return h.jsxs(Lo,{children:[h.jsx(tf,{asChild:!0,children:e}),h.jsxs(xo,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[h.jsx(bo,{children:h.jsx(wo,{children:t("activities.rulesTitle")})}),s?h.jsx("div",{className:"flex justify-center py-8",children:h.jsx(aa,{className:"w-6 h-6 animate-spin text-primary"})}):h.jsx("div",{className:`prose prose-sm dark:prose-invert max-w-none\r
              [&_h1]:text-xl [&_h1]:font-bold [&_h1]:mb-4\r
              [&_h2]:text-lg [&_h2]:font-semibold [&_h2]:mb-3\r
              [&_h3]:text-base [&_h3]:font-medium [&_h3]:mb-2\r
              [&_p]:mb-3 [&_p]:text-muted-foreground\r
              [&_ul]:list-disc [&_ul]:ml-4 [&_ul]:mb-3\r
              [&_ol]:list-decimal [&_ol]:ml-4 [&_ol]:mb-3\r
              [&_li]:mb-1`,dangerouslySetInnerHTML:{__html:o()}})]})]})},lNe=e=>{if(!e)return"";const t=Pr.language;return t==="zh"?e.name:t==="pt"?e.name_pt||e.name_en||e.name:e.name_en||e.name},cNe=()=>{const{t:e}=ei(),{user:t}=Qn(),{localizeActivity:r}=xc(),n=Ju(),{data:s,isLoading:o}=MN(),{data:d=[]}=O5(),i=d.map(A=>A.activity_id),m=Hie(),{displayedData:y,hasMore:S,loadMore:w}=Gie({data:s,initialItemsPerPage:6,incrementPerPage:6}),T=(A,O)=>{if(O.preventDefault(),O.stopPropagation(),!t){ko({title:e("activities.signInToSubscribe")||"",description:e("activities.signInToSubscribeDesc")||"",variant:"destructive"});return}m.mutate(A)};return h.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:h.jsxs("div",{className:"container mx-auto max-w-7xl",children:[h.jsxs("div",{className:"mb-8",children:[h.jsx("h1",{className:"text-4xl font-bold mb-2 text-foreground",children:e("activities.title")}),h.jsxs("p",{className:"text-muted-foreground text-lg",children:[e("activities.description"),h.jsx(Wae,{children:h.jsxs("button",{className:"ml-2 text-primary hover:underline inline-flex items-center gap-1",children:[h.jsx(ab,{className:"w-4 h-4"}),e("activities.rules")]})})]})]}),o&&h.jsx("div",{className:"flex justify-center items-center py-20",children:h.jsx(aa,{className:"w-8 h-8 animate-spin text-primary"})}),!o&&(!s||s.length===0)&&h.jsx("div",{className:"text-center py-20",children:h.jsx("p",{className:"text-xl text-muted-foreground",children:e("activities.noActivities")||"No activities available"})}),!o&&s&&s.length>0&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:y.map(A=>{var P,N;const O=r(A);return h.jsx(kr,{className:"overflow-hidden hover:shadow-large transition-shadow",children:h.jsxs(Hi,{to:`/activity/${A.id}`,children:[h.jsxs("div",{className:"relative h-48 overflow-hidden",children:[h.jsx("img",{src:A.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",alt:O.title,className:"w-full h-full object-cover transition-transform hover:scale-105"}),A.pinned&&h.jsx(tn,{className:"absolute top-3 left-3 bg-accent",children:e("activities.pinned")}),A.service_type&&h.jsxs(tn,{className:"absolute bottom-3 left-3 flex items-center gap-1",variant:"secondary",children:[A.service_type==="dine_in"&&h.jsx(ob,{className:"w-3 h-3"}),A.service_type==="takeaway"&&h.jsx(aT,{className:"w-3 h-3"}),A.service_type==="both"&&h.jsxs(h.Fragment,{children:[h.jsx(ob,{className:"w-3 h-3"}),h.jsx(aT,{className:"w-3 h-3"})]}),e(`activities.serviceType.${A.service_type}`)]}),A.end_date&&new Date(A.end_date)<new Date?h.jsx(tn,{className:"absolute top-3 right-3 bg-secondary",children:e("activities.ended")}):A.subscriber_count!==void 0&&h.jsxs(tn,{variant:"secondary",className:"absolute top-3 right-3 flex items-center gap-1.5",children:[h.jsx(Bc,{className:"w-3.5 h-3.5"}),h.jsx("span",{children:A.subscriber_count})]})]}),h.jsx(Rn,{children:h.jsx("h3",{className:"text-xl font-semibold text-card-foreground line-clamp-2",children:O.title})}),h.jsxs(Mr,{className:"space-y-3",children:[h.jsx("div",{className:`text-muted-foreground text-sm line-clamp-3\r
                          [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-foreground\r
                          [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:text-foreground\r
                          [&_h3]:text-sm [&_h3]:font-medium [&_h3]:text-foreground\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_p]:my-1\r
                          [&_ul]:list-disc [&_ul]:ml-4\r
                          [&_ol]:list-decimal [&_ol]:ml-4`,dangerouslySetInnerHTML:{__html:O.content}}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(yo,{className:"w-4 h-4"}),h.jsx("span",{children:Rs(new Date(A.start_date),"PPP")})]}),A.end_date&&h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(Xv,{className:"w-4 h-4"}),h.jsxs("span",{children:[e("activities.until")," ",Rs(new Date(A.end_date),"PPP")]})]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(T_e,{className:"w-4 h-4"}),h.jsx("span",{children:e("activities.creatorLabel")}),(P=A.creator)!=null&&P.isAdmin?h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx("img",{src:aO,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),h.jsx("span",{className:"font-medium",children:e("activities.createdByPlatform")})]}):(N=A.creator)!=null&&N.restaurant?h.jsxs("div",{className:"flex items-center gap-1 cursor-pointer",onClick:R=>{R.preventDefault(),R.stopPropagation(),n(`/restaurant/${A.creator.restaurant.id}`)},children:[A.creator.avatar_url?h.jsxs(qh,{className:"w-4 h-4",children:[h.jsx(Hh,{src:A.creator.avatar_url,alt:"Creator"}),h.jsx(Gh,{className:"text-[8px]",children:A.creator.restaurant.name.charAt(0)})]}):h.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:h.jsx("span",{className:"text-[8px] font-medium",children:A.creator.restaurant.name.charAt(0)})}),h.jsx("span",{className:"text-primary font-medium hover:underline",children:lNe(A.creator.restaurant)})]}):h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx("img",{src:aO,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),h.jsx("span",{className:"font-medium",children:e("activities.createdByPlatform")})]})]})]}),h.jsxs(NN,{className:"gap-2",children:[h.jsx(Mt,{asChild:!0,className:"flex-1",children:h.jsx("span",{children:e("activities.viewDetails")})}),h.jsx(Mt,{variant:i.includes(A.id)?"outline":"default",onClick:R=>T(A.id,R),disabled:m.isPending,title:i.includes(A.id)?e("activities.subscribed"):e("activities.subscribe"),children:i.includes(A.id)?h.jsx(g_e,{className:"w-4 h-4"}):h.jsx(TQ,{className:"w-4 h-4"})})]})]})},A.id)})}),S&&h.jsx("div",{className:"flex justify-center mt-8",children:h.jsxs(Mt,{onClick:w,size:"lg",variant:"outline",children:[e("common.loadMore")," (",y.length," / ",s.length,")"]})})]})]})})},Kae=V.memo(({restaurants:e,onMarkerClick:t})=>{const r=V.useRef(null),n=V.useRef(null),s=V.useRef([]),[o,d]=V.useState(!1),i=V.useRef(null);return V.useEffect(()=>{if(!r.current||n.current)return;const m="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";No.accessToken=m;const y=e.reduce((w,T)=>w+Number(T.restaurants.lat||0),0)/e.length,S=e.reduce((w,T)=>w+Number(T.restaurants.lng||0),0)/e.length;return n.current=new No.Map({container:r.current,style:"mapbox://styles/mapbox/light-v11",center:[S,y],zoom:12,cooperativeGestures:!0,doubleClickZoom:!1}),n.current.addControl(new No.NavigationControl,"top-right"),n.current.on("load",()=>{d(!0)}),()=>{var w;s.current.forEach(T=>T.remove()),s.current=[],i.current&&(i.current.remove(),i.current=null),(w=n.current)==null||w.remove(),n.current=null,d(!1)}},[]),V.useEffect(()=>{if(!n.current||!o||e.length===0)return;(()=>{var y;if(s.current.forEach(S=>S.remove()),s.current=[],i.current&&(i.current.remove(),i.current=null),e.forEach(S=>{const w=Number(S.restaurants.lat),T=Number(S.restaurants.lng);if(isNaN(w)||isNaN(T))return;const A=document.createElement("div");A.className="p-3 min-w-[200px]",A.innerHTML=`
          <div class="space-y-2">
            <h3 class="font-bold text-base text-foreground">${S.restaurants.name}</h3>
            <p class="text-xs text-muted-foreground">${S.restaurants.address}</p>
          </div>
        `;const O=new No.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([T,w]).setDOMContent(A),P=new No.Marker({color:"#016450",draggable:!1}).setLngLat([T,w]).addTo(n.current),N=P.getElement();N.style.cursor="pointer";const R=M=>{M.stopPropagation(),M.preventDefault(),i.current&&i.current!==O&&i.current.remove(),O.addTo(n.current),i.current=O,n.current.easeTo({center:[T,w],zoom:17,duration:800}),t&&t(S.restaurant_id)};N.addEventListener("click",R,!0),O.on("close",()=>{i.current===O&&(i.current=null)}),s.current.push(P)}),e.length>1){const S=new No.LngLatBounds;e.forEach(w=>{const T=Number(w.restaurants.lat),A=Number(w.restaurants.lng);!isNaN(T)&&!isNaN(A)&&S.extend([A,T])}),(y=n.current)==null||y.fitBounds(S,{padding:50,maxZoom:14})}})()},[e,o,t]),e.length===0?null:h.jsx("div",{ref:r,className:"w-full h-[350px] rounded-lg"})});Kae.displayName="ActivityParticipationMap";const uNe=({open:e,onOpenChange:t,restaurants:r,participatingRestaurantIds:n,onConfirm:s,isPending:o,isParticipating:d})=>{const{t:i}=ei(),{localizeRestaurant:m}=xc(),[y,S]=V.useState([]);V.useEffect(()=>{e&&S(n)},[e,n]);const w=O=>{S(P=>P.includes(O)?P.filter(N=>N!==O):[...P,O])},T=()=>{y.length===r.length?S([]):S(r.map(O=>O.id))},A=()=>{s(y)};return h.jsx(Lo,{open:e,onOpenChange:t,children:h.jsxs(xo,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[h.jsxs(bo,{children:[h.jsxs(wo,{className:"flex items-center gap-2",children:[h.jsx(Mo,{className:"w-5 h-5"}),""]}),h.jsx(pl,{children:""})]}),h.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[h.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[h.jsx(tl,{id:"select-all",checked:y.length===r.length,onCheckedChange:T}),h.jsxs(yr,{htmlFor:"select-all",className:"cursor-pointer font-semibold",children:["/ (",y.length,"/",r.length,")"]})]}),h.jsx("div",{className:"space-y-3",children:r.map(O=>{const P=m(O),N=y.includes(O.id),R=n.includes(O.id);return h.jsx(kr,{className:`transition-all ${N?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:h.jsx(Mr,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(tl,{id:O.id,checked:N,onCheckedChange:()=>w(O.id)}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs(yr,{htmlFor:O.id,className:"cursor-pointer flex items-center gap-2",children:[h.jsx("span",{className:"font-semibold truncate",children:P.name}),R&&h.jsxs(tn,{variant:"secondary",className:"text-xs",children:[h.jsx(sp,{className:"w-3 h-3 mr-1"}),""]})]}),h.jsx("p",{className:"text-sm text-muted-foreground truncate",children:O.address}),P.type&&P.type.length>0&&h.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:P.type.slice(0,2).map((M,F)=>h.jsx(tn,{variant:"outline",className:"text-xs",children:M},F))})]})]})})},O.id)})})]}),h.jsxs(r_,{children:[h.jsx(Mt,{variant:"outline",onClick:()=>t(!1),disabled:o,children:i("common.cancel")}),h.jsx(Mt,{onClick:A,disabled:o,children:o?h.jsxs(h.Fragment,{children:[h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}),i("common.loading")]}):h.jsxs(h.Fragment,{children:[h.jsx(sp,{className:"w-4 h-4 mr-2"})," (",y.length,")"]})})]})]})})},dNe=({open:e,onOpenChange:t,activityTitle:r,activityId:n,onShareComplete:s,isProcessing:o=!1})=>{const{t:d}=ei(),[i,m]=V.useState(!1),y=async()=>{try{await navigator.clipboard.writeText(window.location.href),Nr.success(d("common.linkCopied")),m(!0)}catch(A){console.error("Error copying link:",A),Nr.error(d("common.shareError"))}},S=A=>{const O=encodeURIComponent(window.location.href),P=encodeURIComponent(`${r} - Xiaoxiong Market`);let N="";switch(A){case"whatsapp":N=`https://wa.me/?text=${P}%20${O}`;break;case"facebook":N=`https://www.facebook.com/sharer/sharer.php?u=${O}`;break;case"twitter":N=`https://twitter.com/intent/tweet?text=${P}&url=${O}`;break;case"telegram":N=`https://t.me/share/url?url=${O}&text=${P}`;break;case"wechat":y(),Nr.info(d("common.shareVia")+" WeChat");return;default:return}window.open(N,"_blank","noopener,noreferrer"),m(!0)},w=async()=>{const A={title:r,text:`${r} - Xiaoxiong Market`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(A)?(await navigator.share(A),m(!0)):y()}catch(O){O.name!=="AbortError"&&(console.error("Error sharing:",O),Nr.error(d("common.shareError")))}},T=()=>{i&&s()};return h.jsx(Lo,{open:e,onOpenChange:t,children:h.jsxs(xo,{className:"sm:max-w-md",children:[h.jsxs(bo,{children:[h.jsxs(wo,{className:"flex items-center gap-2",children:[h.jsx(p0,{className:"w-5 h-5 text-primary"}),""]}),h.jsxs(pl,{className:"space-y-2",children:[h.jsx("p",{children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:'""'})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsxs(e_,{children:[h.jsx(t_,{asChild:!0,children:h.jsxs(Mt,{className:"w-full",variant:"default",children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),""]})}),h.jsxs(Eg,{className:"w-56",children:[navigator.share&&h.jsxs(h.Fragment,{children:[h.jsxs(Is,{onClick:w,children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),""]}),h.jsx(Xf,{})]}),h.jsxs(Is,{onClick:()=>S("wechat"),children:[h.jsx(Om,{className:"w-4 h-4 mr-2"}),"WeChat"]}),h.jsxs(Is,{onClick:()=>S("whatsapp"),children:[h.jsx(Om,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),h.jsxs(Is,{onClick:()=>S("facebook"),children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),"Facebook"]}),h.jsxs(Is,{onClick:()=>S("twitter"),children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),h.jsxs(Is,{onClick:()=>S("telegram"),children:[h.jsx(Om,{className:"w-4 h-4 mr-2"}),"Telegram"]}),h.jsx(Xf,{}),h.jsxs(Is,{onClick:y,children:[h.jsx(O3,{className:"w-4 h-4 mr-2"}),d("common.copyLink")]})]})]}),h.jsxs(Mt,{onClick:y,variant:"outline",className:"w-full",children:[h.jsx(O3,{className:"w-4 h-4 mr-2"}),""]})]}),h.jsx(Mt,{onClick:T,disabled:!i||o,className:"w-full",variant:i?"default":"secondary",children:o?h.jsxs(h.Fragment,{children:[h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):i?h.jsxs(h.Fragment,{children:[h.jsx(p0,{className:"w-4 h-4 mr-2"}),""]}):""})]})]})})},hNe=()=>ci({queryKey:["couponTemplates"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("coupon_templates").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}}),fNe=e=>ci({queryKey:["activityCouponTemplates",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("coupon_templates").select("*").eq("activity_id",e).eq("is_active",!0).eq("visible",!0).order("created_at",{ascending:!1});if(r)throw r;return t},enabled:!!e}),pNe=e=>{const{user:t}=Qn();return ci({queryKey:["hasSharedCoupon",e,t==null?void 0:t.id],queryFn:async()=>{if(!t)return!1;const{data:r,error:n}=await Ct.from("user_coupons").select("id").eq("user_id",t.id).eq("activity_id",e).eq("source","share").maybeSingle();if(n)throw n;return!!r},enabled:!!t&&!!e})},mNe=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async({templateId:n,activityId:s,source:o="share"})=>{if(!e)throw new Error("User not authenticated");const{data:d,error:i}=await Ct.rpc("generate_coupon_code",{template_id_param:n});if(i)throw i;const m=d,{data:y,error:S}=await Ct.from("coupon_codes").insert({template_id:n,code:m,usage_limit:1,used_count:0,is_active:!0}).select().single();if(S)throw S;const{data:w,error:T}=await Ct.from("user_coupons").insert({user_id:e.id,coupon_code_id:y.id,activity_id:s,source:o}).select().single();if(T)throw T;return{userCoupon:w,couponCode:y}},onSuccess:(n,s)=>{r.invalidateQueries({queryKey:["userCoupons"]}),r.invalidateQueries({queryKey:["hasSharedCoupon",s.activityId]}),t({title:Pr.t("common.success"),description:s.source==="share"?"":""})},onError:n=>{t({title:Pr.t("common.error"),description:n.message||"",variant:"destructive"})}})},gNe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{if(r.id){const{id:n,created_at:s,updated_at:o,...d}=r,{data:i,error:m}=await Ct.from("coupon_templates").update(d).eq("id",n).select().single();if(m)throw m;return i}else{const{id:n,created_at:s,updated_at:o,...d}=r,{data:i,error:m}=await Ct.from("coupon_templates").insert(d).select().single();if(m)throw m;return i}},onSuccess:()=>{t.invalidateQueries({queryKey:["couponTemplates"]}),e({title:Pr.t("common.success"),description:""})},onError:r=>{e({title:Pr.t("common.error"),description:r.message,variant:"destructive"})}})},yNe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("coupon_templates").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["couponTemplates"]}),e({title:Pr.t("common.success"),description:""})},onError:r=>{e({title:Pr.t("common.error"),description:r.message,variant:"destructive"})}})},vNe=()=>{var pt;const{id:e}=Bee(),t=Qh(),r=Ju(),{t:n}=ei(),{user:s}=Qn(),{isMerchant:o,isSupervisor:d}=_c(),{localizeActivity:i,localizeRestaurant:m,currentLang:y}=xc();qN();const[S,w]=Ve.useState(!1),[T,A]=Ve.useState(!1),[O,P]=Ve.useState(null),[N,R]=Ve.useState(!1),[M,F]=Ve.useState(!1),[B,$]=Ve.useState(!1),[W,K]=Ve.useState(!1),{data:te=[]}=fNe(e),{data:ne=!1}=pNe(e),ae=mNe(),re=Ve.useCallback(rt=>{r(`/restaurant/${rt}`,{state:{fromActivity:e}})},[r,e]),ee=((pt=t.state)==null?void 0:pt.from)==="admin"?"/admin/activities":"/activities",{data:ie,isLoading:de}=NPe(e),{data:be,isLoading:Se}=IPe(e),{data:Ae=[]}=O5(),xe=Ae.map(rt=>rt.activity_id),{data:me=0}=RPe(e),Ce=Hie(),{data:ge=[]}=D2(),{data:pe=[]}=eke(e),Oe=tke(),Xe=ie?i(ie):null,We=ie?xe.includes(ie.id):!1,$e=o||d,Ke=V.useCallback(()=>{!s||!ie||Ce.mutate(ie.id)},[s,ie,Ce]),Le=ge.filter(rt=>pe.includes(rt.id)).length,ke=Le>0;ge.length,Le>0&&Le<ge.length;const st=V.useCallback(()=>{if(!(!ie||!$e||ge.length===0))if(d)$(!0);else if(ke)for(const rt of ge)pe.includes(rt.id)&&Oe.mutate({activityId:ie.id,restaurantId:rt.id});else for(const rt of ge)Oe.mutate({activityId:ie.id,restaurantId:rt.id})},[ie,$e,ge,d,ke,pe,Oe]),_t=V.useCallback(rt=>{if(!ie)return;const Kt=rt.filter(Ht=>!pe.includes(Ht)),Ut=pe.filter(Ht=>!rt.includes(Ht));Kt.forEach(Ht=>{Oe.mutate({activityId:ie.id,restaurantId:Ht})}),Ut.forEach(Ht=>{Oe.mutate({activityId:ie.id,restaurantId:Ht})}),$(!1)},[ie,pe,Oe]),Be=V.useCallback(async()=>{F(!0);try{const rt=await RN();P({lat:rt.coords.latitude,lng:rt.coords.longitude}),R(!0),Nr.success(n("map.locationEnabled"))}catch{Nr.error(n("map.locationError")),R(!1)}finally{F(!1)}},[n]);V.useCallback(()=>{P(null),R(!1)},[]);const Dt=V.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),Nr.success(n("common.linkCopied"))}catch(rt){console.error("Error copying link:",rt),Nr.error(n("common.shareError"))}},[n]),It=V.useCallback(()=>{if(!s){Nr.info(""),r("/auth");return}if(te.length===0){ir();return}if(ne){ir();return}K(!0)},[s,te,ne,r]),ir=V.useCallback(async()=>{if(!ie||!Xe)return;const rt={title:Xe.title,text:`${Xe.title} - Xiaoxiong Market

${Xe.content.replace(/<[^>]*>/g,"").substring(0,200)}...`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(rt)?(await navigator.share(rt),Nr.success(n("common.shareSuccess"))):Dt()}catch(Kt){Kt.name!=="AbortError"&&(console.error("Error sharing:",Kt),Nr.error(n("common.shareError")))}},[ie,Xe,Dt,n]),Dr=V.useCallback(async()=>{if(!s||te.length===0)return;const rt=te[0];try{await ae.mutateAsync({templateId:rt.id,activityId:e,source:"share"}),K(!1)}catch(Kt){console.error("Error claiming coupon:",Kt)}},[s,te,e,ae]);V.useCallback(rt=>{const Kt=encodeURIComponent(window.location.href);encodeURIComponent((Xe==null?void 0:Xe.title)||ie.title_zh);const Ut=encodeURIComponent(`${(Xe==null?void 0:Xe.title)||ie.title_zh} - Xiaoxiong Market`);let Ht="";switch(rt){case"whatsapp":Ht=`https://wa.me/?text=${Ut}%20${Kt}`;break;case"facebook":Ht=`https://www.facebook.com/sharer/sharer.php?u=${Kt}`;break;case"twitter":Ht=`https://twitter.com/intent/tweet?text=${Ut}&url=${Kt}`;break;case"telegram":Ht=`https://t.me/share/url?url=${Kt}&text=${Ut}`;break;case"wechat":Dt(),Nr.info(n("common.shareVia")+" WeChat");return;default:return}window.open(Ht,"_blank","noopener,noreferrer")},[ie,Xe,Dt,n]);const Rr=V.useMemo(()=>{if(!be)return[];const rt=be.map(Kt=>{if(O){const Ut=R2(O.lat,O.lng,Number(Kt.restaurants.lat),Number(Kt.restaurants.lng));return{...Kt,distance:Ut}}return{...Kt,distance:void 0}});return N&&O?rt.sort((Kt,Ut)=>Kt.distance!==void 0&&Ut.distance!==void 0?Kt.distance-Ut.distance:0):rt},[be,N,O]);if(de)return h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsx(aa,{className:"w-8 h-8 animate-spin text-primary"})});if(!ie||!Xe)return h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-xl text-muted-foreground",children:n("error.notFound")}),h.jsx(Mt,{asChild:!0,className:"mt-4",children:h.jsx(Hi,{to:ee,children:n("common.back")})})]})});const jt=new Date(ie.start_date),zt=ie.end_date?new Date(ie.end_date):null,Je=zt?new Date<=zt:new Date>=jt;return h.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[h.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[h.jsx("img",{src:ie.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1200&q=80",alt:Xe.title,className:"w-full h-full object-cover"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),h.jsx(Mt,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:h.jsx(Hi,{to:ee,children:h.jsx(eN,{className:"w-5 h-5"})})}),h.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[ie.pinned&&h.jsx(tn,{className:"bg-accent",children:n("activities.pinned")}),h.jsx(F5,{targetType:"activity",targetId:ie.id,trigger:h.jsx(Mt,{variant:"secondary",size:"icon",className:"shadow-lg",children:h.jsx(iN,{className:"w-5 h-5"})})}),h.jsx(Mt,{variant:"secondary",size:"icon",className:"shadow-lg",onClick:It,children:h.jsx(Dd,{className:"w-5 h-5"})})]})]}),h.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:h.jsxs(kr,{className:"shadow-large",children:[h.jsx(Rn,{children:h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[h.jsx(tn,{variant:Je?"default":"secondary",children:n(Je?"activities.ongoing":"activities.ended")}),ie.repeat_mode&&ie.repeat_mode!=="none"&&h.jsx(tn,{variant:"outline",children:n(`activities.repeat.${ie.repeat_mode}`)}),ie.service_type&&h.jsxs(tn,{variant:"outline",className:"flex items-center gap-1.5",children:[ie.service_type==="dine_in"&&h.jsx(ob,{className:"w-3.5 h-3.5"}),ie.service_type==="takeaway"&&h.jsx(aT,{className:"w-3.5 h-3.5"}),ie.service_type==="both"&&h.jsxs(h.Fragment,{children:[h.jsx(ob,{className:"w-3.5 h-3.5"}),h.jsx(aT,{className:"w-3.5 h-3.5"})]}),n(`activities.serviceType.${ie.service_type}`)]})]}),h.jsx(Hn,{className:"text-3xl",children:Xe.title}),h.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 text-sm text-muted-foreground",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(yo,{className:"w-4 h-4"}),h.jsxs("span",{children:[Rs(jt,"PPP"),zt&&` - ${Rs(zt,"PPP")}`]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Bc,{className:"w-4 h-4"}),h.jsxs("span",{children:[me," ",n("activities.subscribersCount")]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Mo,{className:"w-4 h-4"}),h.jsxs("span",{children:[(be==null?void 0:be.length)||0," ",n("activities.restaurantsParticipating")]})]})]}),s&&h.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[$e&&ge.length>0&&h.jsx(Mt,{onClick:st,disabled:Oe.isPending,size:"lg",variant:ke?"outline":"default",className:"w-full sm:w-auto",children:d?h.jsxs(h.Fragment,{children:[h.jsx(Mo,{className:"w-4 h-4 mr-2"}),""]}):ke?h.jsxs(h.Fragment,{children:[h.jsx(sp,{className:"w-4 h-4 mr-2"}),""]}):h.jsxs(h.Fragment,{children:[h.jsx(Mo,{className:"w-4 h-4 mr-2"}),""]})}),h.jsx(Mt,{onClick:Ke,disabled:Ce.isPending,size:"lg",variant:We?"outline":"secondary",className:"w-full sm:w-auto",children:We?h.jsxs(h.Fragment,{children:[h.jsx(sp,{className:"w-4 h-4 mr-2"}),n("activities.subscribed")||""]}):h.jsxs(h.Fragment,{children:[h.jsx(Bc,{className:"w-4 h-4 mr-2"}),n("activities.subscribe")||""]})})]}),!s&&h.jsxs("div",{className:"space-y-2",children:[h.jsx("p",{className:"text-sm text-muted-foreground",children:n("activities.signInToJoin")}),h.jsxs("p",{className:"text-xs text-muted-foreground/80 flex items-center gap-1.5",children:[h.jsx(Bc,{className:"w-3.5 h-3.5"}),n("activities.signInToJoinHint")]})]})]})}),h.jsxs(Mr,{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-2xl font-bold mb-4",children:n("activities.about")}),h.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                  prose-headings:text-foreground prose-headings:font-semibold\r
                  prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                  prose-p:leading-relaxed prose-p:my-3\r
                  prose-strong:text-foreground prose-strong:font-semibold\r
                  prose-ul:my-3 prose-ol:my-3\r
                  prose-li:my-1\r
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:Xe.content}})]}),Xe.usage_instructions&&h.jsxs(h.Fragment,{children:[h.jsx(Yo,{}),h.jsxs("div",{children:[h.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:[h.jsx(y_e,{className:"w-6 h-6 text-primary"}),n("activities.usageInstructions")]}),h.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                      prose-headings:text-foreground prose-headings:font-semibold\r
                      prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                      prose-p:leading-relaxed prose-p:my-3\r
                      prose-strong:text-foreground prose-strong:font-semibold\r
                      prose-ul:my-3 prose-ol:my-3\r
                      prose-li:my-1\r
                      prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:Xe.usage_instructions}})]})]}),te.length>0&&!ne&&s&&h.jsxs(h.Fragment,{children:[h.jsx(Yo,{}),h.jsxs("div",{children:[h.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:[h.jsx(p0,{className:"w-6 h-6 text-primary"}),""]}),h.jsx(kr,{className:"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-transparent",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"space-y-4",children:[te.map(rt=>{const Kt=y==="zh"?rt.title_zh:y==="pt"?rt.title_pt:rt.title_en,Ut=y==="zh"?rt.description_zh:y==="pt"?rt.description_pt:rt.description_en;return h.jsxs("div",{className:"flex items-start gap-4 p-4 bg-background rounded-lg border border-border",children:[h.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:h.jsx(z9,{className:"w-6 h-6 text-primary"})}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h3",{className:"font-semibold text-lg mb-1",children:Kt}),h.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:Ut}),h.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[h.jsx("span",{children:""}),rt.discount_type==="percentage"?h.jsxs("span",{className:"text-primary font-semibold",children:[rt.discount_value,"% OFF"]}):h.jsxs("span",{className:"text-primary font-semibold",children:["",rt.discount_value," OFF"]})]})]})]},rt.id)}),h.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg",children:[h.jsxs("p",{className:"text-sm text-center mb-3",children:[h.jsx(p0,{className:"w-4 h-4 inline mr-1"}),""]}),h.jsxs(Mt,{onClick:It,className:"w-full",size:"lg",children:[h.jsx(Dd,{className:"w-4 h-4 mr-2"}),""]})]})]})})})]})]}),te.length>0&&!s&&h.jsxs(h.Fragment,{children:[h.jsx(Yo,{}),h.jsxs("div",{children:[h.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:[h.jsx(p0,{className:"w-6 h-6 text-primary"}),""]}),h.jsxs(kr,{className:"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-transparent relative overflow-hidden",children:[h.jsx("div",{className:"absolute inset-0 backdrop-blur-[2px] bg-background/30 z-10 flex items-center justify-center",children:h.jsxs("div",{className:"text-center space-y-4 p-6 bg-background/95 rounded-lg shadow-lg border border-border max-w-md mx-4",children:[h.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:h.jsx(p0,{className:"w-8 h-8 text-primary"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-xl font-bold mb-2",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:""})]}),h.jsx(Mt,{onClick:()=>r("/auth"),size:"lg",className:"w-full",children:""})]})}),h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"space-y-4 opacity-60",children:[te.slice(0,2).map(rt=>{const Kt=y==="zh"?rt.title_zh:y==="pt"?rt.title_pt:rt.title_en,Ut=y==="zh"?rt.description_zh:y==="pt"?rt.description_pt:rt.description_en;return h.jsxs("div",{className:"flex items-start gap-4 p-4 bg-background rounded-lg border border-border",children:[h.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:h.jsx(z9,{className:"w-6 h-6 text-primary"})}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h3",{className:"font-semibold text-lg mb-1",children:Kt}),h.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:Ut}),h.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[h.jsx("span",{children:": ****"}),rt.discount_type==="percentage"?h.jsxs("span",{className:"text-primary font-semibold",children:[rt.discount_value,"% OFF"]}):h.jsxs("span",{className:"text-primary font-semibold",children:["",rt.discount_value," OFF"]})]})]})]},rt.id)}),te.length>2&&h.jsxs("div",{className:"text-center text-sm text-muted-foreground py-2",children:[" ",te.length-2," ..."]})]})})]})]})]}),h.jsx(Yo,{}),Se?h.jsx("div",{className:"flex justify-center py-8",children:h.jsx(aa,{className:"w-6 h-6 animate-spin text-primary"})}):be&&be.length>0?h.jsxs("div",{className:"space-y-6",children:[h.jsx(m0,{open:S,onOpenChange:w,children:h.jsxs(kr,{className:"border-primary/20 shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden",children:[h.jsx(Rn,{className:"pb-3",children:h.jsx(g0,{asChild:!0,children:h.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[h.jsxs(Hn,{className:"text-lg font-semibold flex items-center gap-2 transition-colors duration-200 group-hover:text-primary",children:[h.jsx(Mo,{className:"w-5 h-5 transition-transform duration-300 group-hover:scale-110"}),""]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(tn,{variant:"secondary",className:"transition-opacity duration-200",children:S?"":""}),h.jsx("div",{className:"transition-transform duration-300 ease-in-out",style:{transform:S?"rotate(180deg)":"rotate(0deg)"},children:h.jsx(Vf,{className:"w-5 h-5 text-muted-foreground group-hover:text-primary"})})]})]})})}),h.jsx(y0,{className:"overflow-hidden transition-all duration-500 ease-in-out data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",children:h.jsxs(Mr,{className:"pt-0 pb-6 space-y-4",children:[h.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:(T?Rr:Rr.slice(0,6)).map((rt,Kt)=>{var Ht;const Ut=m(rt.restaurants);return h.jsx(kr,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 opacity-0 animate-fade-in h-full flex flex-col",style:{animationDelay:`${Kt*50}ms`,animationFillMode:"forwards"},children:h.jsxs(Hi,{to:`/restaurant/${rt.restaurant_id}`,state:{fromActivity:ie.id},className:"flex flex-col h-full",children:[h.jsxs("div",{className:"relative h-40 overflow-hidden flex-shrink-0",children:[h.jsx("img",{src:rt.restaurants.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&q=80",alt:Ut.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),Ut.type&&Ut.type.length>0&&h.jsx(tn,{className:"absolute top-2 left-2 bg-primary",children:Ut.type[0]})]}),h.jsxs(Mr,{className:"pt-4 pb-4 flex flex-col flex-grow",children:[h.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-1",children:Ut.name}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[h.jsx(ga,{className:"w-4 h-4 flex-shrink-0"}),h.jsx("span",{className:"line-clamp-1",children:rt.restaurants.address})]}),h.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-border/50",children:[h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Cl,{className:"w-4 h-4 fill-accent text-accent"}),h.jsx("span",{className:"font-semibold text-sm",children:((Ht=rt.restaurants.rating)==null?void 0:Ht.toFixed(1))||"0.0"})]}),rt.distance!==void 0&&h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Hu,{className:"w-4 h-4 text-primary"}),h.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[rt.distance.toFixed(1)," km"]})]})]})]})]})},rt.id)})}),Rr.length>6&&!T&&h.jsxs(Mt,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-all duration-200",onClick:()=>A(!0),children:[h.jsx(Vf,{className:"w-4 h-4 mr-2"})," (",Rr.length-6," )"]})]})})]})}),h.jsxs("div",{children:[h.jsxs("div",{className:"flex items-center justify-between mb-4",children:[h.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[h.jsx(ga,{className:"w-6 h-6"}),n("activities.participatingRestaurants")," (",Rr.length,")"]}),N?h.jsxs(tn,{variant:"default",className:"flex items-center gap-1.5",children:[h.jsx(Hu,{className:"w-3.5 h-3.5"}),""]}):h.jsxs(Mt,{variant:"outline",size:"sm",onClick:Be,disabled:M,children:[M?h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}):h.jsx(Hu,{className:"w-4 h-4 mr-2"}),""]})]}),h.jsx(Kae,{restaurants:Rr,onMarkerClick:re})]})]}):null,h.jsx(Yo,{}),h.jsx(uae,{restaurantId:ie.id,targetType:"activity"})]})]})}),d&&h.jsx(uNe,{open:B,onOpenChange:$,restaurants:ge,participatingRestaurantIds:pe,onConfirm:_t,isPending:Oe.isPending,isParticipating:ke}),h.jsx(dNe,{open:W,onOpenChange:K,activityTitle:(Xe==null?void 0:Xe.title)||(ie==null?void 0:ie.title_zh)||"",activityId:e,onShareComplete:Dr,isProcessing:ae.isPending})]})},_Ne=()=>{const{signIn:e,signUp:t,signInWithGoogle:r,signInWithPhone:n,verifyOTP:s,user:o}=Qn(),d=Ju(),[i,m]=V.useState(!1),[y,S]=V.useState("login"),[w,T]=V.useState("phone");V.useState(""),V.useState("+351");const[A,O]=V.useState("info"),[P,N]=V.useState(""),[R,M]=V.useState(null),[F,B]=V.useState(0),[$,W]=V.useState(null),{t:K}=ei(),te=Ah({email:xn().email(K("auth.invalidEmail")),password:xn().min(6,K("auth.passwordMin"))}),ne=Ah({displayName:xn().min(2,K("auth.displayNameMin")),email:xn().email(K("auth.invalidEmail")),password:xn().min(6,K("auth.passwordMin")),confirmPassword:xn()}).refine(ge=>ge.password===ge.confirmPassword,{message:K("auth.passwordsDontMatch"),path:["confirmPassword"]}),ae=Ah({phone:xn().min(6,K("auth.phoneMin"))}),re=Ah({otp:xn().length(6,K("auth.otpLength"))}),ee=Ah({code:xn().length(4,"Verification code must be 4 digits")}),ie=Eh({resolver:Th(te)}),de=Eh({resolver:Th(ne)});Eh({resolver:Th(ae)}),Eh({resolver:Th(re)});const be=Eh({resolver:Th(ee)});V.useEffect(()=>{o&&d("/")},[o,d]),V.useEffect(()=>{let ge;return F>0&&(ge=setTimeout(()=>B(F-1),1e3)),()=>clearTimeout(ge)},[F]);const Se=ge=>{let pe=0;return ge.length>=6&&pe++,ge.length>=8&&pe++,/[a-z]/.test(ge)&&pe++,/[A-Z]/.test(ge)&&pe++,/[0-9]/.test(ge)&&pe++,/[^a-zA-Z0-9]/.test(ge)&&pe++,pe<=2?"weak":pe<=4?"medium":"strong"},Ae=async ge=>{m(!0);try{const{error:pe}=await e(ge.email,ge.password);if(pe){pe.message.includes("Invalid login credentials")?Nr.error(K("auth.invalidCredentials")):Nr.error(pe.message);return}Nr.success(K("auth.signInSuccess"))}catch(pe){Nr.error(pe.message||K("error.general"))}finally{m(!1)}},xe=async ge=>{m(!0);try{M(ge),N(ge.email);const{error:pe}=await Ct.functions.invoke("send-verification-code",{body:{email:ge.email}});if(pe){Nr.error(K("auth.verificationCodeFailed")),console.error(pe);return}O("verify"),Nr.success(K("auth.verificationCodeSent")),B(30)}catch(pe){Nr.error(pe.message||K("error.general"))}finally{m(!1)}},me=async ge=>{if(R){m(!0);try{const{data:pe,error:Oe}=await Ct.functions.invoke("verify-email-code",{body:{email:P,code:ge.code}});if(Oe||!(pe!=null&&pe.success)){Nr.error((pe==null?void 0:pe.error)||K("auth.invalidVerificationCode"));return}const{error:Xe}=await t(R.email,R.password,R.displayName);if(Xe){Xe.message.includes("already registered")?Nr.error(K("auth.emailExists")):Nr.error(Xe.message);return}Nr.success(K("auth.signUpSuccess")),S("login"),O("info"),de.reset(),be.reset(),M(null)}catch(pe){Nr.error(pe.message||K("error.general"))}finally{m(!1)}}},Ce=async()=>{if(!(F>0)){m(!0);try{const{error:ge}=await Ct.functions.invoke("send-verification-code",{body:{email:P}});if(ge){Nr.error(K("toast.resendCodeFailed"));return}Nr.success(K("toast.verificationCodeResent")),B(30)}catch(ge){Nr.error(ge.message||"Failed to resend code")}finally{m(!1)}}};return h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:h.jsxs(kr,{className:"w-full max-w-md shadow-large",children:[h.jsxs(Rn,{className:"text-center",children:[h.jsx("div",{className:"flex justify-center mb-4",children:h.jsx("img",{src:aO,alt:"Logo",style:{width:"35px",height:"35px"},className:"object-contain drop-shadow-md"})}),h.jsx(Hn,{className:"text-2xl",children:K("auth.welcome")}),h.jsx(cs,{children:K("auth.subtitle")})]}),h.jsx(Mr,{children:h.jsxs(Lv,{value:y,onValueChange:ge=>{S(ge),T("phone"),O("info")},className:"w-full",children:[h.jsxs(gg,{className:"grid w-full grid-cols-2",children:[h.jsx(La,{value:"login",children:K("auth.login")}),h.jsx(La,{value:"register",children:K("auth.register")})]}),h.jsx(Fa,{value:"login",children:h.jsxs("form",{onSubmit:ie.handleSubmit(Ae),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"email",children:K("auth.email")}),h.jsx(cr,{id:"email",type:"email",placeholder:"you@example.com",...ie.register("email")}),ie.formState.errors.email&&h.jsx("p",{className:"text-sm text-destructive",children:ie.formState.errors.email.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"password",children:K("auth.password")}),h.jsx(cr,{id:"password",type:"password",placeholder:"",...ie.register("password")}),ie.formState.errors.password&&h.jsx("p",{className:"text-sm text-destructive",children:ie.formState.errors.password.message})]}),h.jsx(Mt,{type:"submit",className:"w-full",disabled:i,children:K(i?"auth.signingIn":"auth.signIn")})]})}),h.jsx(Fa,{value:"register",children:A==="info"?h.jsxs("form",{onSubmit:de.handleSubmit(xe),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"display-name",children:K("auth.displayName")}),h.jsx(cr,{id:"display-name",placeholder:"John Doe",...de.register("displayName")}),de.formState.errors.displayName&&h.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.displayName.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"register-email",children:K("auth.email")}),h.jsx(cr,{id:"register-email",type:"email",placeholder:"you@example.com",...de.register("email")}),de.formState.errors.email&&h.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.email.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"register-password",children:K("auth.password")}),h.jsx(cr,{id:"register-password",type:"password",placeholder:K("auth.passwordPlaceholder"),...de.register("password"),onChange:ge=>{de.setValue("password",ge.target.value),ge.target.value?W(Se(ge.target.value)):W(null)}}),de.formState.errors.password&&h.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.password.message}),$&&h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"flex gap-1",children:[h.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${$==="weak"?"bg-destructive":$==="medium"?"bg-warning":"bg-success"}`}),h.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${$==="medium"||$==="strong"?$==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),h.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${$==="strong"?"bg-success":"bg-muted"}`})]}),h.jsx("p",{className:`text-xs ${$==="weak"?"text-destructive":$==="medium"?"text-warning":"text-success"}`,children:K(`auth.passwordStrength.${$}`)})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"confirm-password",children:K("auth.confirmPassword")}),h.jsx(cr,{id:"confirm-password",type:"password",placeholder:K("auth.passwordPlaceholder"),...de.register("confirmPassword")}),de.formState.errors.confirmPassword&&h.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.confirmPassword.message})]}),h.jsx(Mt,{type:"submit",className:"w-full",disabled:i,children:i?"Sending code...":"Send Verification Code"})]}):h.jsxs("form",{onSubmit:be.handleSubmit(me),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"verification-code",children:"Verification Code"}),h.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the 4-digit code sent to ",P]}),h.jsx("div",{className:"flex justify-center",children:h.jsx(D5,{maxLength:4,...be.register("code"),onChange:ge=>be.setValue("code",ge),children:h.jsxs(L5,{children:[h.jsx(qf,{index:0}),h.jsx(qf,{index:1}),h.jsx(qf,{index:2}),h.jsx(qf,{index:3})]})})}),be.formState.errors.code&&h.jsx("p",{className:"text-sm text-destructive text-center",children:be.formState.errors.code.message})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Mt,{type:"button",variant:"outline",className:"w-full",onClick:()=>{O("info"),be.reset()},children:K("common.back")}),h.jsx(Mt,{type:"submit",className:"w-full",disabled:i,children:i?K("auth.verifying"):"Verify & Register"})]}),h.jsx(Mt,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:Ce,disabled:i||F>0,children:F>0?`Resend Code (${F}s)`:"Resend Code"})]})})]})}),h.jsx(NN,{children:h.jsx("p",{className:"text-sm text-muted-foreground text-center w-full",children:h.jsx(Hi,{to:"/",className:"text-primary hover:underline",children:K("auth.backToHome")})})})]})})};function xNe(e){return Object.prototype.toString.call(e)==="[object Object]"}function tW(e){return xNe(e)||Array.isArray(e)}function bNe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Y5(e,t){const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;const s=JSON.stringify(Object.keys(e.breakpoints||{})),o=JSON.stringify(Object.keys(t.breakpoints||{}));return s!==o?!1:r.every(d=>{const i=e[d],m=t[d];return typeof i=="function"?`${i}`==`${m}`:!tW(i)||!tW(m)?i===m:Y5(i,m)})}function rW(e){return e.concat().sort((t,r)=>t.name>r.name?1:-1).map(t=>t.options)}function wNe(e,t){if(e.length!==t.length)return!1;const r=rW(e),n=rW(t);return r.every((s,o)=>{const d=n[o];return Y5(s,d)})}function J5(e){return typeof e=="number"}function zF(e){return typeof e=="string"}function HN(e){return typeof e=="boolean"}function nW(e){return Object.prototype.toString.call(e)==="[object Object]"}function za(e){return Math.abs(e)}function Q5(e){return Math.sign(e)}function ME(e,t){return za(e-t)}function SNe(e,t){if(e===0||t===0||za(e)<=za(t))return 0;const r=ME(za(e),za(t));return za(r/e)}function ENe(e){return Math.round(e*100)/100}function ST(e){return ET(e).map(Number)}function Ud(e){return e[F2(e)]}function F2(e){return Math.max(0,e.length-1)}function e$(e,t){return t===F2(e)}function iW(e,t=0){return Array.from(Array(e),(r,n)=>t+n)}function ET(e){return Object.keys(e)}function Zae(e,t){return[e,t].reduce((r,n)=>(ET(n).forEach(s=>{const o=r[s],d=n[s],i=nW(o)&&nW(d);r[s]=i?Zae(o,d):d}),r),{})}function BF(e,t){return typeof t.MouseEvent<"u"&&e instanceof t.MouseEvent}function TNe(e,t){const r={start:n,center:s,end:o};function n(){return 0}function s(m){return o(m)/2}function o(m){return t-m}function d(m,y){return zF(e)?r[e](m):e(t,m,y)}return{measure:d}}function TT(){let e=[];function t(s,o,d,i={passive:!0}){let m;if("addEventListener"in s)s.addEventListener(o,d,i),m=()=>s.removeEventListener(o,d,i);else{const y=s;y.addListener(d),m=()=>y.removeListener(d)}return e.push(m),n}function r(){e=e.filter(s=>s())}const n={add:t,clear:r};return n}function ANe(e,t,r,n){const s=TT(),o=1e3/60;let d=null,i=0,m=0;function y(){s.add(e,"visibilitychange",()=>{e.hidden&&O()})}function S(){A(),s.clear()}function w(N){if(!m)return;d||(d=N,r(),r());const R=N-d;for(d=N,i+=R;i>=o;)r(),i-=o;const M=i/o;n(M),m&&(m=t.requestAnimationFrame(w))}function T(){m||(m=t.requestAnimationFrame(w))}function A(){t.cancelAnimationFrame(m),d=null,i=0,m=0}function O(){d=null,i=0}return{init:y,destroy:S,start:T,stop:A,update:r,render:n}}function CNe(e,t){const r=t==="rtl",n=e==="y",s=n?"y":"x",o=n?"x":"y",d=!n&&r?-1:1,i=S(),m=w();function y(O){const{height:P,width:N}=O;return n?P:N}function S(){return n?"top":r?"right":"left"}function w(){return n?"bottom":r?"left":"right"}function T(O){return O*d}return{scroll:s,cross:o,startEdge:i,endEdge:m,measureSize:y,direction:T}}function Fv(e=0,t=0){const r=za(e-t);function n(y){return y<e}function s(y){return y>t}function o(y){return n(y)||s(y)}function d(y){return o(y)?n(y)?e:t:y}function i(y){return r?y-r*Math.ceil((y-t)/r):y}return{length:r,max:t,min:e,constrain:d,reachedAny:o,reachedMax:s,reachedMin:n,removeOffset:i}}function Xae(e,t,r){const{constrain:n}=Fv(0,e),s=e+1;let o=d(t);function d(T){return r?za((s+T)%s):n(T)}function i(){return o}function m(T){return o=d(T),w}function y(T){return S().set(i()+T)}function S(){return Xae(e,i(),r)}const w={get:i,set:m,add:y,clone:S};return w}function jNe(e,t,r,n,s,o,d,i,m,y,S,w,T,A,O,P,N,R,M){const{cross:F,direction:B}=e,$=["INPUT","SELECT","TEXTAREA"],W={passive:!1},K=TT(),te=TT(),ne=Fv(50,225).constrain(A.measure(20)),ae={mouse:300,touch:400},re={mouse:500,touch:600},ee=O?43:25;let ie=!1,de=0,be=0,Se=!1,Ae=!1,xe=!1,me=!1;function Ce(Be){if(!M)return;function Dt(ir){(HN(M)||M(Be,ir))&&$e(ir)}const It=t;K.add(It,"dragstart",ir=>ir.preventDefault(),W).add(It,"touchmove",()=>{},W).add(It,"touchend",()=>{}).add(It,"touchstart",Dt).add(It,"mousedown",Dt).add(It,"touchcancel",Le).add(It,"contextmenu",Le).add(It,"click",ke,!0)}function ge(){K.clear(),te.clear()}function pe(){const Be=me?r:t;te.add(Be,"touchmove",Ke,W).add(Be,"touchend",Le).add(Be,"mousemove",Ke,W).add(Be,"mouseup",Le)}function Oe(Be){const Dt=Be.nodeName||"";return $.includes(Dt)}function Xe(){return(O?re:ae)[me?"mouse":"touch"]}function We(Be,Dt){const It=w.add(Q5(Be)*-1),ir=S.byDistance(Be,!O).distance;return O||za(Be)<ne?ir:N&&Dt?ir*.5:S.byIndex(It.get(),0).distance}function $e(Be){const Dt=BF(Be,n);me=Dt,xe=O&&Dt&&!Be.buttons&&ie,ie=ME(s.get(),d.get())>=2,!(Dt&&Be.button!==0)&&(Oe(Be.target)||(Se=!0,o.pointerDown(Be),y.useFriction(0).useDuration(0),s.set(d),pe(),de=o.readPoint(Be),be=o.readPoint(Be,F),T.emit("pointerDown")))}function Ke(Be){if(!BF(Be,n)&&Be.touches.length>=2)return Le(Be);const It=o.readPoint(Be),ir=o.readPoint(Be,F),Dr=ME(It,de),Rr=ME(ir,be);if(!Ae&&!me&&(!Be.cancelable||(Ae=Dr>Rr,!Ae)))return Le(Be);const jt=o.pointerMove(Be);Dr>P&&(xe=!0),y.useFriction(.3).useDuration(.75),i.start(),s.add(B(jt)),Be.preventDefault()}function Le(Be){const It=S.byDistance(0,!1).index!==w.get(),ir=o.pointerUp(Be)*Xe(),Dr=We(B(ir),It),Rr=SNe(ir,Dr),jt=ee-10*Rr,zt=R+Rr/50;Ae=!1,Se=!1,te.clear(),y.useDuration(jt).useFriction(zt),m.distance(Dr,!O),me=!1,T.emit("pointerUp")}function ke(Be){xe&&(Be.stopPropagation(),Be.preventDefault(),xe=!1)}function st(){return Se}return{init:Ce,destroy:ge,pointerDown:st}}function PNe(e,t){let n,s;function o(w){return w.timeStamp}function d(w,T){const O=`client${(T||e.scroll)==="x"?"X":"Y"}`;return(BF(w,t)?w:w.touches[0])[O]}function i(w){return n=w,s=w,d(w)}function m(w){const T=d(w)-d(s),A=o(w)-o(n)>170;return s=w,A&&(n=w),T}function y(w){if(!n||!s)return 0;const T=d(s)-d(n),A=o(w)-o(n),O=o(w)-o(s)>170,P=T/A;return A&&!O&&za(P)>.1?P:0}return{pointerDown:i,pointerMove:m,pointerUp:y,readPoint:d}}function ONe(){function e(r){const{offsetTop:n,offsetLeft:s,offsetWidth:o,offsetHeight:d}=r;return{top:n,right:s+o,bottom:n+d,left:s,width:o,height:d}}return{measure:e}}function kNe(e){function t(n){return e*(n/100)}return{measure:t}}function NNe(e,t,r,n,s,o,d){const i=[e].concat(n);let m,y,S=[],w=!1;function T(N){return s.measureSize(d.measure(N))}function A(N){if(!o)return;y=T(e),S=n.map(T);function R(M){for(const F of M){if(w)return;const B=F.target===e,$=n.indexOf(F.target),W=B?y:S[$],K=T(B?e:n[$]);if(za(K-W)>=.5){N.reInit(),t.emit("resize");break}}}m=new ResizeObserver(M=>{(HN(o)||o(N,M))&&R(M)}),r.requestAnimationFrame(()=>{i.forEach(M=>m.observe(M))})}function O(){w=!0,m&&m.disconnect()}return{init:A,destroy:O}}function INe(e,t,r,n,s,o){let d=0,i=0,m=s,y=o,S=e.get(),w=0;function T(){const W=n.get()-e.get(),K=!m;let te=0;return K?(d=0,r.set(n),e.set(n),te=W):(r.set(e),d+=W/m,d*=y,S+=d,e.add(d),te=S-w),i=Q5(te),w=S,$}function A(){const W=n.get()-t.get();return za(W)<.001}function O(){return m}function P(){return i}function N(){return d}function R(){return F(s)}function M(){return B(o)}function F(W){return m=W,$}function B(W){return y=W,$}const $={direction:P,duration:O,velocity:N,seek:T,settled:A,useBaseFriction:M,useBaseDuration:R,useFriction:B,useDuration:F};return $}function RNe(e,t,r,n,s){const o=s.measure(10),d=s.measure(50),i=Fv(.1,.99);let m=!1;function y(){return!(m||!e.reachedAny(r.get())||!e.reachedAny(t.get()))}function S(A){if(!y())return;const O=e.reachedMin(t.get())?"min":"max",P=za(e[O]-t.get()),N=r.get()-t.get(),R=i.constrain(P/d);r.subtract(N*R),!A&&za(N)<o&&(r.set(e.constrain(r.get())),n.useDuration(25).useBaseFriction())}function w(A){m=!A}return{shouldConstrain:y,constrain:S,toggleActive:w}}function MNe(e,t,r,n,s){const o=Fv(-t+e,0),d=w(),i=S(),m=T();function y(O,P){return ME(O,P)<=1}function S(){const O=d[0],P=Ud(d),N=d.lastIndexOf(O),R=d.indexOf(P)+1;return Fv(N,R)}function w(){return r.map((O,P)=>{const{min:N,max:R}=o,M=o.constrain(O),F=!P,B=e$(r,P);return F?R:B||y(N,M)?N:y(R,M)?R:M}).map(O=>parseFloat(O.toFixed(3)))}function T(){if(t<=e+s)return[o.max];if(n==="keepSnaps")return d;const{min:O,max:P}=i;return d.slice(O,P)}return{snapsContained:m,scrollContainLimit:i}}function DNe(e,t,r){const n=t[0],s=r?n-e:Ud(t);return{limit:Fv(s,n)}}function LNe(e,t,r,n){const o=t.min+.1,d=t.max+.1,{reachedMin:i,reachedMax:m}=Fv(o,d);function y(T){return T===1?m(r.get()):T===-1?i(r.get()):!1}function S(T){if(!y(T))return;const A=e*(T*-1);n.forEach(O=>O.add(A))}return{loop:S}}function FNe(e){const{max:t,length:r}=e;function n(o){const d=o-t;return r?d/-r:0}return{get:n}}function zNe(e,t,r,n,s){const{startEdge:o,endEdge:d}=e,{groupSlides:i}=s,m=w().map(t.measure),y=T(),S=A();function w(){return i(n).map(P=>Ud(P)[d]-P[0][o]).map(za)}function T(){return n.map(P=>r[o]-P[o]).map(P=>-za(P))}function A(){return i(y).map(P=>P[0]).map((P,N)=>P+m[N])}return{snaps:y,snapsAligned:S}}function BNe(e,t,r,n,s,o){const{groupSlides:d}=s,{min:i,max:m}=n,y=S();function S(){const T=d(o),A=!e||t==="keepSnaps";return r.length===1?[o]:A?T:T.slice(i,m).map((O,P,N)=>{const R=!P,M=e$(N,P);if(R){const F=Ud(N[0])+1;return iW(F)}if(M){const F=F2(o)-Ud(N)[0]+1;return iW(F,Ud(N)[0])}return O})}return{slideRegistry:y}}function $Ne(e,t,r,n,s){const{reachedAny:o,removeOffset:d,constrain:i}=n;function m(O){return O.concat().sort((P,N)=>za(P)-za(N))[0]}function y(O){const P=e?d(O):i(O),N=t.map((M,F)=>({diff:S(M-P,0),index:F})).sort((M,F)=>za(M.diff)-za(F.diff)),{index:R}=N[0];return{index:R,distance:P}}function S(O,P){const N=[O,O+r,O-r];if(!e)return O;if(!P)return m(N);const R=N.filter(M=>Q5(M)===P);return R.length?m(R):Ud(N)-r}function w(O,P){const N=t[O]-s.get(),R=S(N,P);return{index:O,distance:R}}function T(O,P){const N=s.get()+O,{index:R,distance:M}=y(N),F=!e&&o(N);if(!P||F)return{index:R,distance:O};const B=t[R]-M,$=O+S(B,0);return{index:R,distance:$}}return{byDistance:T,byIndex:w,shortcut:S}}function UNe(e,t,r,n,s,o,d){function i(w){const T=w.distance,A=w.index!==t.get();o.add(T),T&&(n.duration()?e.start():(e.update(),e.render(1),e.update())),A&&(r.set(t.get()),t.set(w.index),d.emit("select"))}function m(w,T){const A=s.byDistance(w,T);i(A)}function y(w,T){const A=t.clone().set(w),O=s.byIndex(A.get(),T);i(O)}return{distance:m,index:y}}function VNe(e,t,r,n,s,o,d,i){const m={passive:!0,capture:!0};let y=0;function S(A){if(!i)return;function O(P){if(new Date().getTime()-y>10)return;d.emit("slideFocusStart"),e.scrollLeft=0;const M=r.findIndex(F=>F.includes(P));J5(M)&&(s.useDuration(0),n.index(M,0),d.emit("slideFocus"))}o.add(document,"keydown",w,!1),t.forEach((P,N)=>{o.add(P,"focus",R=>{(HN(i)||i(A,R))&&O(N)},m)})}function w(A){A.code==="Tab"&&(y=new Date().getTime())}return{init:S}}function gE(e){let t=e;function r(){return t}function n(m){t=d(m)}function s(m){t+=d(m)}function o(m){t-=d(m)}function d(m){return J5(m)?m:m.get()}return{get:r,set:n,add:s,subtract:o}}function Yae(e,t){const r=e.scroll==="x"?d:i,n=t.style;let s=null,o=!1;function d(T){return`translate3d(${T}px,0px,0px)`}function i(T){return`translate3d(0px,${T}px,0px)`}function m(T){if(o)return;const A=ENe(e.direction(T));A!==s&&(n.transform=r(A),s=A)}function y(T){o=!T}function S(){o||(n.transform="",t.getAttribute("style")||t.removeAttribute("style"))}return{clear:S,to:m,toggleActive:y}}function qNe(e,t,r,n,s,o,d,i,m){const S=ST(s),w=ST(s).reverse(),T=R().concat(M());function A(K,te){return K.reduce((ne,ae)=>ne-s[ae],te)}function O(K,te){return K.reduce((ne,ae)=>A(ne,te)>0?ne.concat([ae]):ne,[])}function P(K){return o.map((te,ne)=>({start:te-n[ne]+.5+K,end:te+t-.5+K}))}function N(K,te,ne){const ae=P(te);return K.map(re=>{const ee=ne?0:-r,ie=ne?r:0,de=ne?"end":"start",be=ae[re][de];return{index:re,loopPoint:be,slideLocation:gE(-1),translate:Yae(e,m[re]),target:()=>i.get()>be?ee:ie}})}function R(){const K=d[0],te=O(w,K);return N(te,r,!1)}function M(){const K=t-d[0]-1,te=O(S,K);return N(te,-r,!0)}function F(){return T.every(({index:K})=>{const te=S.filter(ne=>ne!==K);return A(te,t)<=.1})}function B(){T.forEach(K=>{const{target:te,translate:ne,slideLocation:ae}=K,re=te();re!==ae.get()&&(ne.to(re),ae.set(re))})}function $(){T.forEach(K=>K.translate.clear())}return{canLoop:F,clear:$,loop:B,loopPoints:T}}function HNe(e,t,r){let n,s=!1;function o(m){if(!r)return;function y(S){for(const w of S)if(w.type==="childList"){m.reInit(),t.emit("slidesChanged");break}}n=new MutationObserver(S=>{s||(HN(r)||r(m,S))&&y(S)}),n.observe(e,{childList:!0})}function d(){n&&n.disconnect(),s=!0}return{init:o,destroy:d}}function GNe(e,t,r,n){const s={};let o=null,d=null,i,m=!1;function y(){i=new IntersectionObserver(O=>{m||(O.forEach(P=>{const N=t.indexOf(P.target);s[N]=P}),o=null,d=null,r.emit("slidesInView"))},{root:e.parentElement,threshold:n}),t.forEach(O=>i.observe(O))}function S(){i&&i.disconnect(),m=!0}function w(O){return ET(s).reduce((P,N)=>{const R=parseInt(N),{isIntersecting:M}=s[R];return(O&&M||!O&&!M)&&P.push(R),P},[])}function T(O=!0){if(O&&o)return o;if(!O&&d)return d;const P=w(O);return O&&(o=P),O||(d=P),P}return{init:y,destroy:S,get:T}}function WNe(e,t,r,n,s,o){const{measureSize:d,startEdge:i,endEdge:m}=e,y=r[0]&&s,S=O(),w=P(),T=r.map(d),A=N();function O(){if(!y)return 0;const M=r[0];return za(t[i]-M[i])}function P(){if(!y)return 0;const M=o.getComputedStyle(Ud(n));return parseFloat(M.getPropertyValue(`margin-${m}`))}function N(){return r.map((M,F,B)=>{const $=!F,W=e$(B,F);return $?T[F]+S:W?T[F]+w:B[F+1][i]-M[i]}).map(za)}return{slideSizes:T,slideSizesWithGaps:A,startGap:S,endGap:w}}function KNe(e,t,r,n,s,o,d,i,m){const{startEdge:y,endEdge:S,direction:w}=e,T=J5(r);function A(R,M){return ST(R).filter(F=>F%M===0).map(F=>R.slice(F,F+M))}function O(R){return R.length?ST(R).reduce((M,F,B)=>{const $=Ud(M)||0,W=$===0,K=F===F2(R),te=s[y]-o[$][y],ne=s[y]-o[F][S],ae=!n&&W?w(d):0,re=!n&&K?w(i):0,ee=za(ne-re-(te+ae));return B&&ee>t+m&&M.push(F),K&&M.push(R.length),M},[]).map((M,F,B)=>{const $=Math.max(B[F-1]||0);return R.slice($,M)}):[]}function P(R){return T?A(R,r):O(R)}return{groupSlides:P}}function ZNe(e,t,r,n,s,o,d){const{align:i,axis:m,direction:y,startIndex:S,loop:w,duration:T,dragFree:A,dragThreshold:O,inViewThreshold:P,slidesToScroll:N,skipSnaps:R,containScroll:M,watchResize:F,watchSlides:B,watchDrag:$,watchFocus:W}=o,K=2,te=ONe(),ne=te.measure(t),ae=r.map(te.measure),re=CNe(m,y),ee=re.measureSize(ne),ie=kNe(ee),de=TNe(i,ee),be=!w&&!!M,Se=w||!!M,{slideSizes:Ae,slideSizesWithGaps:xe,startGap:me,endGap:Ce}=WNe(re,ne,ae,r,Se,s),ge=KNe(re,ee,N,w,ne,ae,me,Ce,K),{snaps:pe,snapsAligned:Oe}=zNe(re,de,ne,ae,ge),Xe=-Ud(pe)+Ud(xe),{snapsContained:We,scrollContainLimit:$e}=MNe(ee,Xe,Oe,M,K),Ke=be?We:Oe,{limit:Le}=DNe(Xe,Ke,w),ke=Xae(F2(Ke),S,w),st=ke.clone(),_t=ST(r),Be=({dragHandler:Gn,scrollBody:Mi,scrollBounds:Pa,options:{loop:_s}})=>{_s||Pa.constrain(Gn.pointerDown()),Mi.seek()},Dt=({scrollBody:Gn,translate:Mi,location:Pa,offsetLocation:_s,previousLocation:mi,scrollLooper:Ua,slideLooper:Va,dragHandler:Bo,animation:qa,eventHandler:Ha,scrollBounds:Li,options:{loop:Ws}},nl)=>{const _a=Gn.settled(),so=!Li.shouldConstrain(),Ln=Ws?_a:_a&&so,Fi=Ln&&!Bo.pointerDown();Fi&&qa.stop();const ps=Pa.get()*nl+mi.get()*(1-nl);_s.set(ps),Ws&&(Ua.loop(Gn.direction()),Va.loop()),Mi.to(_s.get()),Fi&&Ha.emit("settle"),Ln||Ha.emit("scroll")},It=ANe(n,s,()=>Be(Kn),Gn=>Dt(Kn,Gn)),ir=.68,Dr=Ke[ke.get()],Rr=gE(Dr),jt=gE(Dr),zt=gE(Dr),Je=gE(Dr),pt=INe(Rr,zt,jt,Je,T,ir),rt=$Ne(w,Ke,Xe,Le,Je),Kt=UNe(It,ke,st,pt,rt,Je,d),Ut=FNe(Le),Ht=TT(),Cr=GNe(t,r,d,P),{slideRegistry:un}=BNe(be,M,Ke,$e,ge,_t),hn=VNe(e,r,un,Kt,pt,Ht,d,W),Kn={ownerDocument:n,ownerWindow:s,eventHandler:d,containerRect:ne,slideRects:ae,animation:It,axis:re,dragHandler:jNe(re,e,n,s,Je,PNe(re,s),Rr,It,Kt,pt,rt,ke,d,ie,A,O,R,ir,$),eventStore:Ht,percentOfView:ie,index:ke,indexPrevious:st,limit:Le,location:Rr,offsetLocation:zt,previousLocation:jt,options:o,resizeHandler:NNe(t,d,s,r,re,F,te),scrollBody:pt,scrollBounds:RNe(Le,zt,Je,pt,ie),scrollLooper:LNe(Xe,Le,zt,[Rr,zt,jt,Je]),scrollProgress:Ut,scrollSnapList:Ke.map(Ut.get),scrollSnaps:Ke,scrollTarget:rt,scrollTo:Kt,slideLooper:qNe(re,ee,Xe,Ae,xe,pe,Ke,zt,r),slideFocus:hn,slidesHandler:HNe(t,d,B),slidesInView:Cr,slideIndexes:_t,slideRegistry:un,slidesToScroll:ge,target:Je,translate:Yae(re,t)};return Kn}function XNe(){let e={},t;function r(y){t=y}function n(y){return e[y]||[]}function s(y){return n(y).forEach(S=>S(t,y)),m}function o(y,S){return e[y]=n(y).concat([S]),m}function d(y,S){return e[y]=n(y).filter(w=>w!==S),m}function i(){e={}}const m={init:r,emit:s,off:d,on:o,clear:i};return m}const YNe={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function JNe(e){function t(o,d){return Zae(o,d||{})}function r(o){const d=o.breakpoints||{},i=ET(d).filter(m=>e.matchMedia(m).matches).map(m=>d[m]).reduce((m,y)=>t(m,y),{});return t(o,i)}function n(o){return o.map(d=>ET(d.breakpoints||{})).reduce((d,i)=>d.concat(i),[]).map(e.matchMedia)}return{mergeOptions:t,optionsAtMedia:r,optionsMediaQueries:n}}function QNe(e){let t=[];function r(o,d){return t=d.filter(({options:i})=>e.optionsAtMedia(i).active!==!1),t.forEach(i=>i.init(o,e)),d.reduce((i,m)=>Object.assign(i,{[m.name]:m}),{})}function n(){t=t.filter(o=>o.destroy())}return{init:r,destroy:n}}function OO(e,t,r){const n=e.ownerDocument,s=n.defaultView,o=JNe(s),d=QNe(o),i=TT(),m=XNe(),{mergeOptions:y,optionsAtMedia:S,optionsMediaQueries:w}=o,{on:T,off:A,emit:O}=m,P=re;let N=!1,R,M=y(YNe,OO.globalOptions),F=y(M),B=[],$,W,K;function te(){const{container:_t,slides:Be}=F;W=(zF(_t)?e.querySelector(_t):_t)||e.children[0];const It=zF(Be)?W.querySelectorAll(Be):Be;K=[].slice.call(It||W.children)}function ne(_t){const Be=ZNe(e,W,K,n,s,_t,m);if(_t.loop&&!Be.slideLooper.canLoop()){const Dt=Object.assign({},_t,{loop:!1});return ne(Dt)}return Be}function ae(_t,Be){N||(M=y(M,_t),F=S(M),B=Be||B,te(),R=ne(F),w([M,...B.map(({options:Dt})=>Dt)]).forEach(Dt=>i.add(Dt,"change",re)),F.active&&(R.translate.to(R.location.get()),R.animation.init(),R.slidesInView.init(),R.slideFocus.init(st),R.eventHandler.init(st),R.resizeHandler.init(st),R.slidesHandler.init(st),R.options.loop&&R.slideLooper.loop(),W.offsetParent&&K.length&&R.dragHandler.init(st),$=d.init(st,B)))}function re(_t,Be){const Dt=ge();ee(),ae(y({startIndex:Dt},_t),Be),m.emit("reInit")}function ee(){R.dragHandler.destroy(),R.eventStore.clear(),R.translate.clear(),R.slideLooper.clear(),R.resizeHandler.destroy(),R.slidesHandler.destroy(),R.slidesInView.destroy(),R.animation.destroy(),d.destroy(),i.clear()}function ie(){N||(N=!0,i.clear(),ee(),m.emit("destroy"),m.clear())}function de(_t,Be,Dt){!F.active||N||(R.scrollBody.useBaseFriction().useDuration(Be===!0?0:F.duration),R.scrollTo.index(_t,Dt||0))}function be(_t){const Be=R.index.add(1).get();de(Be,_t,-1)}function Se(_t){const Be=R.index.add(-1).get();de(Be,_t,1)}function Ae(){return R.index.add(1).get()!==ge()}function xe(){return R.index.add(-1).get()!==ge()}function me(){return R.scrollSnapList}function Ce(){return R.scrollProgress.get(R.offsetLocation.get())}function ge(){return R.index.get()}function pe(){return R.indexPrevious.get()}function Oe(){return R.slidesInView.get()}function Xe(){return R.slidesInView.get(!1)}function We(){return $}function $e(){return R}function Ke(){return e}function Le(){return W}function ke(){return K}const st={canScrollNext:Ae,canScrollPrev:xe,containerNode:Le,internalEngine:$e,destroy:ie,off:A,on:T,emit:O,plugins:We,previousScrollSnap:pe,reInit:P,rootNode:Ke,scrollNext:be,scrollPrev:Se,scrollProgress:Ce,scrollSnapList:me,scrollTo:de,selectedScrollSnap:ge,slideNodes:ke,slidesInView:Oe,slidesNotInView:Xe};return ae(t,r),setTimeout(()=>m.emit("init"),0),st}OO.globalOptions=void 0;function t$(e={},t=[]){const r=V.useRef(e),n=V.useRef(t),[s,o]=V.useState(),[d,i]=V.useState(),m=V.useCallback(()=>{s&&s.reInit(r.current,n.current)},[s]);return V.useEffect(()=>{Y5(r.current,e)||(r.current=e,m())},[e,m]),V.useEffect(()=>{wNe(n.current,t)||(n.current=t,m())},[t,m]),V.useEffect(()=>{if(bNe()&&d){OO.globalOptions=t$.globalOptions;const y=OO(d,r.current,n.current);return o(y),()=>y.destroy()}else o(void 0)},[d,o]),[i,s]}t$.globalOptions=void 0;const Jae=V.createContext(null);function GN(){const e=V.useContext(Jae);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}const Qae=V.forwardRef(({orientation:e="horizontal",opts:t,setApi:r,plugins:n,className:s,children:o,...d},i)=>{const[m,y]=t$({...t,axis:e==="horizontal"?"x":"y"},n),[S,w]=V.useState(!1),[T,A]=V.useState(!1),O=V.useCallback(M=>{M&&(w(M.canScrollPrev()),A(M.canScrollNext()))},[]),P=V.useCallback(()=>{y==null||y.scrollPrev()},[y]),N=V.useCallback(()=>{y==null||y.scrollNext()},[y]),R=V.useCallback(M=>{M.key==="ArrowLeft"?(M.preventDefault(),P()):M.key==="ArrowRight"&&(M.preventDefault(),N())},[P,N]);return V.useEffect(()=>{!y||!r||r(y)},[y,r]),V.useEffect(()=>{if(y)return O(y),y.on("reInit",O),y.on("select",O),()=>{y==null||y.off("select",O)}},[y,O]),h.jsx(Jae.Provider,{value:{carouselRef:m,api:y,opts:t,orientation:e||((t==null?void 0:t.axis)==="y"?"vertical":"horizontal"),scrollPrev:P,scrollNext:N,canScrollPrev:S,canScrollNext:T},children:h.jsx("div",{ref:i,onKeyDownCapture:R,className:fr("relative",s),role:"region","aria-roledescription":"carousel",...d,children:o})})});Qae.displayName="Carousel";const eoe=V.forwardRef(({className:e,...t},r)=>{const{carouselRef:n,orientation:s}=GN();return h.jsx("div",{ref:n,className:"overflow-hidden",children:h.jsx("div",{ref:r,className:fr("flex",s==="horizontal"?"-ml-4":"-mt-4 flex-col",e),...t})})});eoe.displayName="CarouselContent";const t0=V.forwardRef(({className:e,...t},r)=>{const{orientation:n}=GN();return h.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:fr("min-w-0 shrink-0 grow-0 basis-full",n==="horizontal"?"pl-4":"pt-4",e),...t})});t0.displayName="CarouselItem";const eIe=V.forwardRef(({className:e,variant:t="outline",size:r="icon",...n},s)=>{const{orientation:o,scrollPrev:d,canScrollPrev:i}=GN();return h.jsxs(Mt,{ref:s,variant:t,size:r,className:fr("absolute h-8 w-8 rounded-full",o==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:d,...n,children:[h.jsx(SQ,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Previous slide"})]})});eIe.displayName="CarouselPrevious";const tIe=V.forwardRef(({className:e,variant:t="outline",size:r="icon",...n},s)=>{const{orientation:o,scrollNext:d,canScrollNext:i}=GN();return h.jsxs(Mt,{ref:s,variant:t,size:r,className:fr("absolute h-8 w-8 rounded-full",o==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:d,...n,children:[h.jsx(EQ,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Next slide"})]})});tIe.displayName="CarouselNext";const rIe=()=>{const{user:e}=Qn();return ci({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(d=>d.restaurant_id),{data:s,error:o}=await Ct.from("restaurants").select("*").in("id",n);if(o)throw o;return s||[]},enabled:!!e})},nIe=()=>{const{user:e}=Qn();return ci({queryKey:["user-comments",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("comments").select("*").eq("user_id",e.id).is("parent_id",null).order("created_at",{ascending:!1});if(r)throw r;if(!t||t.length===0)return[];const n=t.filter(i=>i.target_type==="restaurant").map(i=>i.target_id),s=t.filter(i=>i.target_type==="activity").map(i=>i.target_id),o=new Map;if(n.length>0){const{data:i}=await Ct.from("restaurants").select("id, name, name_en, name_pt").in("id",n);i==null||i.forEach(m=>{o.set(m.id,{name:m.name,name_en:m.name_en||void 0,name_pt:m.name_pt||void 0})})}const d=new Map;if(s.length>0){const{data:i}=await Ct.from("activities").select("id, title_zh, title_en, title_pt").in("id",s);i==null||i.forEach(m=>{d.set(m.id,{title_zh:m.title_zh,title_en:m.title_en,title_pt:m.title_pt})})}return t.map(i=>{if(i.target_type==="restaurant"){const m=o.get(i.target_id);return{...i,target_name:(m==null?void 0:m.name)||"Unknown Restaurant",target_name_en:m==null?void 0:m.name_en,target_name_pt:m==null?void 0:m.name_pt}}else if(i.target_type==="activity"){const m=d.get(i.target_id);return{...i,target_name:(m==null?void 0:m.title_zh)||"Unknown Activity",target_name_en:m==null?void 0:m.title_en,target_name_pt:m==null?void 0:m.title_pt}}return i})},enabled:!!e,staleTime:3e4})},iIe=()=>{const{user:e}=Qn(),{data:t=[]}=D2();return ci({queryKey:["merchantActivities",e==null?void 0:e.id],queryFn:async()=>{if(!e||t.length===0)return[];const r=t.map(y=>y.id),{data:n,error:s}=await Ct.from("activity_restaurants").select("*").in("restaurant_id",r).order("created_at",{ascending:!1});if(s)throw s;if(!n||n.length===0)return[];const{data:o}=await Ct.from("restaurants").select("id, name, name_en, name_pt, address").in("id",r),d=[...new Set(n.map(y=>y.activity_id))],{data:i}=await Ct.from("activities").select("*").in("id",d);return n.map(y=>{const S=o==null?void 0:o.find(T=>T.id===y.restaurant_id),w=i==null?void 0:i.find(T=>T.id===y.activity_id);return{activity_id:y.activity_id,restaurant_id:y.restaurant_id,restaurant_name:(S==null?void 0:S.name)||"",restaurant_name_en:(S==null?void 0:S.name_en)||null,restaurant_name_pt:(S==null?void 0:S.name_pt)||null,restaurant_address:(S==null?void 0:S.address)||"",activity:w||null,created_at:y.created_at}})},enabled:!!e&&t.length>0})},sIe="modulepreload",aIe=function(e){return"/"+e},sW={},oIe=function(t,r,n){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),i=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=Promise.allSettled(r.map(m=>{if(m=aIe(m),m in sW)return;sW[m]=!0;const y=m.endsWith(".css"),S=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const w=document.createElement("link");if(w.rel=y?"stylesheet":sIe,y||(w.as="script"),w.crossOrigin="",w.href=m,i&&w.setAttribute("nonce",i),document.head.appendChild(w),y)return new Promise((T,A)=>{w.addEventListener("load",T),w.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(d){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=d,window.dispatchEvent(i),!i.defaultPrevented)throw d}return s.then(d=>{for(const i of d||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})},toe=[{code:"+351",country:"Portugal",flag:""},{code:"+34",country:"Spain",flag:""},{code:"+33",country:"France",flag:""},{code:"+49",country:"Germany",flag:""},{code:"+39",country:"Italy",flag:""},{code:"+44",country:"UK",flag:""},{code:"+31",country:"Netherlands",flag:""},{code:"+32",country:"Belgium",flag:""},{code:"+86",country:"China",flag:""},{code:"+1",country:"USA/Canada",flag:""},{code:"+55",country:"Brazil",flag:""}],aW=e=>{if(!e)return{code:"+351",number:""};for(const t of toe)if(e.startsWith(t.code))return{code:t.code,number:e.slice(t.code.length).trim()};return{code:"+351",number:e}},oW=({profile:e})=>{const{t}=ei(),r=Ju(),{user:n}=Qn(),{isAdmin:s}=_c(),[o,d]=V.useState(!1),[i,m]=V.useState(e.display_name),y=aW(e.phone),[S,w]=V.useState(y.code),[T,A]=V.useState(y.number),[O,P]=V.useState(!1),[N,R]=V.useState(null),[M,F]=V.useState(e.avatar_url||""),[B,$]=V.useState(!1),[W,K]=V.useState(!1),[te,ne]=V.useState(""),[ae,re]=V.useState(!1),ee=V.useRef(!1);V.useEffect(()=>{const at=ee.current;if(ee.current=o,o&&!at){m(e.display_name);const gn=aW(e.phone);w(gn.code),A(gn.number),F(e.avatar_url||""),R(null),P(!1)}},[o,e.display_name,e.phone,e.avatar_url]);const[ie,de]=V.useState(!1),[be,Se]=V.useState(!1),[Ae,xe]=V.useState(!1),[me,Ce]=V.useState(""),[ge,pe]=V.useState(""),[Oe,Xe]=V.useState(""),[We,$e]=V.useState(!1),[Ke,Le]=V.useState(!1),[ke,st]=V.useState(!1),[_t,Be]=V.useState(!1),[Dt,It]=V.useState(!1),[ir,Dr]=V.useState(""),[Rr,jt]=V.useState(""),[zt,Je]=V.useState(""),[pt,rt]=V.useState(!1),[Kt,Ut]=V.useState(""),[Ht,Cr]=V.useState(!1),[un,hn]=V.useState(!1),[Kn,Gn]=V.useState(null),Mi=V.useRef(null),Pa=V.useRef(null),_s=V.useRef(null),mi=Xne(),Ua=oCe();V.useEffect(()=>{We&&Mi.current&&Mi.current.focus()},[We]),V.useEffect(()=>{Ke&&Pa.current&&Pa.current.focus()},[Ke]),V.useEffect(()=>{Ht&&_s.current&&_s.current.focus()},[Ht]);const Va=at=>{var Ks;const gn=(Ks=at.target.files)==null?void 0:Ks[0];if(gn){if(gn.size>2*1024*1024)return;R(gn),F(URL.createObjectURL(gn))}},Bo=async()=>{let at=e.avatar_url;if(N){const Ks=await Ua.mutateAsync(N);Ks&&(at=Ks)}const gn=T?`${S} ${T}`:void 0;await mi.mutateAsync({display_name:i,phone:gn,avatar_url:at||void 0}),P(!1),d(!1)},qa=async()=>{if(!(!n||te.toLowerCase()!=="delete")){re(!0);try{const{error:at}=await Ct.functions.invoke("delete-account",{body:{userId:n.id}});if(at){Nr.error(t("profile.deleteAccountFailed")),console.error(at),re(!1);return}Nr.success(t("profile.deleteAccountSuccess")),K(!1),$(!1),ne(""),await new Promise(gn=>setTimeout(gn,1500)),await Ct.auth.signOut(),r("/auth")}catch(at){Nr.error(at.message||t("profile.deleteAccountFailed")),re(!1)}finally{re(!1)}}},Ha=async()=>{if(n!=null&&n.email)try{const{error:at}=await Ct.functions.invoke("send-verification-code",{body:{email:n.email}});if(at)throw at;$e(!0),Nr.success(t("profile.codeSentToOldEmail"))}catch(at){Nr.error(t("profile.sendCodeFailed")),console.error(at)}},Li=async()=>{if(!ge){Nr.error(t("profile.enterCodePlaceholder"));return}try{const{data:at,error:gn}=await Ct.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:ge}});if(gn||!(at!=null&&at.success)){Nr.error(t("profile.codeIncorrect"));return}Nr.success(t("profile.oldEmailVerified")),de(!1),Se(!0)}catch(at){Nr.error(t("profile.verificationFailed")),console.error(at)}},Ws=async()=>{if(!me||!me.includes("@")){Nr.error(t("profile.enterValidEmail"));return}try{const{error:at}=await Ct.functions.invoke("send-verification-code",{body:{email:me}});if(at)throw at;Nr.success(t("profile.codeSentToNewEmail")),Le(!0)}catch(at){Nr.error(t("profile.sendCodeFailed")),console.error(at)}},nl=async()=>{if(!Oe){Nr.error(t("profile.enterCodePlaceholder"));return}try{const{data:at,error:gn}=await Ct.functions.invoke("verify-email-code",{body:{email:me,code:Oe}});if(gn||!(at!=null&&at.success)){Nr.error(t("profile.codeIncorrect"));return}Nr.success(t("profile.newEmailVerified")),Se(!1),setTimeout(()=>{xe(!0)},100)}catch(at){Nr.error(t("toast.verificationFailed")),console.error(at)}},_a=async()=>{st(!0);try{const{data:{session:at}}=await Ct.auth.getSession();if(!at||!n){Nr.error(t("toast.pleaseSignIn")),st(!1);return}const{data:gn,error:Ks}=await Ct.functions.invoke("update-email",{body:{userId:n.id,oldEmail:n.email,oldEmailCode:ge,newEmail:me,newEmailCode:Oe},headers:{Authorization:`Bearer ${at.access_token}`}});if(Ks||!(gn!=null&&gn.success))throw new Error((gn==null?void 0:gn.error)||"Failed to update email");Nr.success(t("toast.emailUpdatedSuccess")),xe(!1),d(!1),pe(""),Ce(""),Xe(""),$e(!1),Le(!1),await new Promise(Oa=>setTimeout(Oa,1500)),await Ct.auth.signOut(),r("/auth")}catch(at){Nr.error(at.message||t("toast.emailUpdateError")),console.error(at)}finally{st(!1)}},so=at=>{let gn=0;return at.length>=6&&gn++,at.length>=8&&gn++,/[a-z]/.test(at)&&gn++,/[A-Z]/.test(at)&&gn++,/[0-9]/.test(at)&&gn++,/[^a-zA-Z0-9]/.test(at)&&gn++,gn<=2?"weak":gn<=4?"medium":"strong"},Ln=async at=>{if(at==null||at.preventDefault(),at==null||at.stopPropagation(),!ir){Nr.error(t("profile.enterCurrentPassword"));return}try{const{createClient:gn}=await oIe(async()=>{const{createClient:vn}=await Promise.resolve().then(()=>PEe);return{createClient:vn}},void 0),Ks=gn("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:Oa}=await Ks.auth.signInWithPassword({email:(n==null?void 0:n.email)||"",password:ir});if(Oa){Nr.error(t("profile.oldPasswordIncorrect"));return}Nr.success(t("profile.oldPasswordVerified")),Be(!1),It(!0)}catch(gn){Nr.error(t("profile.verificationFailed")),console.error(gn)}},Fi=async()=>{if(n!=null&&n.email)try{const{error:at}=await Ct.functions.invoke("send-verification-code",{body:{email:n.email}});if(at)throw at;Cr(!0),Nr.success(t("profile.codeSentToOldEmail"))}catch(at){Nr.error(t("profile.sendCodeFailed")),console.error(at)}},ps=async at=>{if(at==null||at.preventDefault(),at==null||at.stopPropagation(),!Kt){Nr.error(t("profile.enterCodePlaceholder"));return}try{const{data:gn,error:Ks}=await Ct.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:Kt}});if(Ks||!(gn!=null&&gn.success)){Nr.error(t("profile.codeIncorrect"));return}Nr.success(t("profile.oldEmailVerified")),Be(!1),It(!0)}catch(gn){Nr.error(t("profile.verificationFailed")),console.error(gn)}},Ga=async at=>{if(at==null||at.preventDefault(),at==null||at.stopPropagation(),!Rr||!zt){Nr.error(t("profile.enterNewPassword"));return}if(Rr.length<6){Nr.error(t("profile.passwordTooShort"));return}if(Rr!==zt){Nr.error(t("profile.passwordsDontMatch"));return}hn(!0);try{const{error:gn}=await Ct.auth.updateUser({password:Rr});if(gn)throw gn;Nr.success(t("profile.passwordUpdated")),It(!1),d(!1),Dr(""),jt(""),Je(""),rt(!1),Ut(""),Cr(!1)}catch(gn){Nr.error(gn.message||t("profile.passwordUpdateFailed")),console.error(gn)}finally{hn(!1)}};return h.jsxs(Lo,{open:o,onOpenChange:d,children:[h.jsx(tf,{asChild:!0,children:h.jsxs(Mt,{variant:"outline",children:[h.jsx($_e,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),h.jsxs(xo,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[h.jsxs(bo,{children:[h.jsx(wo,{children:t("profile.editProfile")}),h.jsx(pl,{children:t("profile.editProfileDescription")})]}),h.jsxs("div",{className:"space-y-3 py-3",children:[h.jsxs("div",{className:"flex flex-col items-center gap-3",children:[h.jsxs(qh,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[h.jsx(Hh,{src:M}),h.jsx(Gh,{children:i==null?void 0:i.charAt(0).toUpperCase()})]}),h.jsxs("div",{children:[h.jsx(cr,{type:"file",accept:"image/*",onChange:Va,className:"hidden",id:"avatar-upload"}),h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{var at;return(at=document.getElementById("avatar-upload"))==null?void 0:at.click()},className:"text-xs sm:text-sm",children:[h.jsx(Lh,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),h.jsxs("div",{className:"space-y-1.5",children:[h.jsx(yr,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),h.jsx(cr,{id:"displayName",value:i,onChange:at=>m(at.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),h.jsxs("div",{className:"space-y-1.5",children:[h.jsx(yr,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),!e.phone&&!O?h.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"w-full justify-start h-9",children:t("profile.addPhoneNumber")}):O||!e.phone?h.jsxs("div",{className:"flex gap-2",children:[h.jsxs(Aa,{value:S,onValueChange:w,children:[h.jsx(ya,{className:"w-[110px] h-9",children:h.jsx(Ca,{placeholder:"+351"})}),h.jsx(va,{children:toe.map(at=>h.jsx(En,{value:at.code,children:h.jsxs("span",{className:"flex items-center gap-2",children:[h.jsx("span",{children:at.flag}),h.jsx("span",{children:at.code})]})},at.code))})]}),h.jsx(cr,{id:"phone",className:"flex-1 h-9",value:T,onChange:at=>A(at.target.value),placeholder:t("profile.phonePlaceholder")})]}):h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{value:`${S} ${T}`,disabled:!0,className:"h-9 flex-1"}),h.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"text-xs whitespace-nowrap",children:t("profile.modifyPhoneNumber")})]})]}),!s&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[h.jsx(yr,{className:"text-sm",children:""}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"h-9 flex-1"}),h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>de(!0),className:"text-xs",children:[h.jsx(PQ,{className:"w-3 h-3 mr-1"}),""]})]})]}),h.jsxs("div",{className:"space-y-1.5",children:[h.jsx(yr,{className:"text-sm",children:t("profile.changePassword")}),h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>Be(!0),className:"w-full justify-start h-9",children:[h.jsx(N_e,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]})]}),h.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!s&&h.jsxs(Mt,{variant:"destructive",size:"sm",onClick:()=>$(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[h.jsx(Yh,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),h.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${s?"sm:ml-auto":""}`,children:[h.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>{P(!1),d(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),h.jsx(Mt,{size:"sm",onClick:Bo,disabled:mi.isPending||Ua.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:mi.isPending||Ua.isPending?t("common.loading"):t("common.save")})]})]})]}),h.jsx(Io,{open:B,onOpenChange:$,children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:t("profile.deleteAccountWarning")}),h.jsx(po,{children:t("profile.deleteAccountDescription")})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:t("common.cancel")}),h.jsx(to,{onClick:()=>{$(!1),K(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),h.jsx(Io,{open:W,onOpenChange:K,children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:t("profile.confirmDeleteAccount")}),h.jsxs(po,{className:"space-y-4",children:[h.jsx("p",{children:t("profile.confirmDeleteDescription")}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),h.jsx(cr,{id:"confirm-delete",value:te,onChange:at=>ne(at.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>ne(""),children:t("common.cancel")}),h.jsx(to,{onClick:qa,disabled:te.toLowerCase()!=="delete"||ae,className:"bg-destructive hover:bg-destructive/90",children:t(ae?"common.loading":"profile.deleteAccount")})]})]})}),h.jsx(Io,{open:ie,onOpenChange:de,children:h.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:t("profile.verifyOldEmail")}),h.jsx(po,{children:t("profile.oldEmailStep")})]}),h.jsxs("div",{className:"space-y-4 py-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:t("profile.currentEmail")}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(cr,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),h.jsx(Mt,{variant:"outline",size:"sm",onClick:Ha,disabled:We,children:t(We?"profile.codeSent":"profile.sendCode")})]})]}),We&&h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:t("profile.verificationCode")}),h.jsx(cr,{ref:Mi,value:ge,onChange:at=>pe(at.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>{de(!1),setTimeout(()=>{pe(""),$e(!1)},300)},children:t("common.cancel")}),We&&h.jsx(to,{onClick:Li,children:t("profile.verify")})]})]})}),h.jsx(Io,{open:be,onOpenChange:Se,children:h.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[h.jsxs(uo,{className:"text-center space-y-3",children:[h.jsx(fo,{className:"text-xl",children:t("profile.verifyNewEmail")}),h.jsx(po,{className:"text-center",children:t("profile.newEmailStep")})]}),h.jsxs("div",{className:"space-y-4 py-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{className:"text-sm font-normal",children:t("profile.newEmail")}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(cr,{type:"email",value:me,onChange:at=>Ce(at.target.value),placeholder:t("profile.enterNewEmail"),disabled:Ke,className:"border-2 focus:border-primary flex-1"}),h.jsx(Mt,{variant:"outline",size:"sm",onClick:Ws,disabled:!me||Ke,className:"text-xs whitespace-nowrap px-3",children:t(Ke?"profile.codeSent":"profile.sendCode")})]})]}),Ke&&h.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[h.jsx(yr,{className:"text-sm font-normal",children:t("profile.verificationCode")}),h.jsx(cr,{ref:Pa,value:Oe,onChange:at=>Xe(at.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),h.jsxs(ho,{className:"flex-col sm:flex-col gap-2",children:[Ke&&h.jsx(to,{onClick:nl,disabled:!Oe||Oe.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:""}),h.jsx(mo,{onClick:()=>{Se(!1),setTimeout(()=>{Ce(""),Xe(""),Le(!1)},300)},className:"w-full mt-0",children:""})]})]})}),h.jsx(Io,{open:Ae,onOpenChange:xe,children:h.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:""}),h.jsx(po,{children:" 3/3: "})]}),h.jsxs("div",{className:"space-y-4 py-4",children:[h.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[h.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:""}),h.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'""'})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:":"}),h.jsx("span",{className:"font-medium",children:n==null?void 0:n.email})]}),h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:":"}),h.jsx("span",{className:"font-medium",children:me})]})]})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>{xe(!1),setTimeout(()=>{pe(""),Ce(""),Xe(""),$e(!1),Le(!1)},300)},children:""}),h.jsx(to,{onClick:_a,disabled:ke,children:ke?"...":""})]})]})}),h.jsx(Io,{open:_t,onOpenChange:Be,children:h.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:t("profile.verifyOldPassword")}),h.jsx(po,{children:t("profile.oldPasswordStep")})]}),h.jsx("div",{className:"space-y-4 py-4",children:pt?h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:t("profile.currentEmail")}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(cr,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),h.jsx(Mt,{variant:"outline",size:"sm",onClick:Fi,disabled:Ht,children:t(Ht?"profile.codeSent":"profile.sendCode")})]})]}),Ht&&h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:t("profile.verificationCode")}),h.jsx(cr,{ref:_s,value:Kt,onChange:at=>Ut(at.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:t("profile.currentPassword")}),h.jsx(cr,{type:"password",value:ir,onChange:at=>Dr(at.target.value),placeholder:t("profile.enterCurrentPassword")})]}),h.jsxs(Mt,{variant:"link",size:"sm",onClick:()=>rt(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>{Be(!1),setTimeout(()=>{Dr(""),rt(!1),Ut(""),Cr(!1)},300)},children:t("common.cancel")}),pt?Ht&&h.jsx(to,{onClick:ps,children:t("profile.verify")}):h.jsx(to,{onClick:Ln,children:t("profile.verify")})]})]})}),h.jsx(Io,{open:Dt,onOpenChange:It,children:h.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:t("profile.setNewPassword")}),h.jsx(po,{children:t("profile.newPasswordStep")})]}),h.jsxs("div",{className:"space-y-4 py-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:t("profile.newPassword")}),h.jsx(cr,{type:"password",value:Rr,onChange:at=>{jt(at.target.value),at.target.value?Gn(so(at.target.value)):Gn(null)},placeholder:t("profile.enterNewPassword")}),Kn&&h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"flex gap-1",children:[h.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${Kn==="weak"?"bg-destructive":Kn==="medium"?"bg-warning":"bg-success"}`}),h.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${Kn==="medium"||Kn==="strong"?Kn==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),h.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${Kn==="strong"?"bg-success":"bg-muted"}`})]}),h.jsx("p",{className:`text-xs ${Kn==="weak"?"text-destructive":Kn==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${Kn}`)})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:t("profile.confirmNewPassword")}),h.jsx(cr,{type:"password",value:zt,onChange:at=>Je(at.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),Rr&&zt&&Rr!==zt&&h.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>{It(!1),setTimeout(()=>{jt(""),Je(""),Gn(null)},300)},children:t("common.cancel")}),h.jsx(to,{onClick:Ga,disabled:!Rr||!zt||Rr!==zt||un,children:t(un?"common.loading":"profile.updatePassword")})]})]})})]})},lIe=()=>{const{user:e}=Qn();return ci({queryKey:["user-addresses",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("user_addresses").select("*").eq("user_id",e.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(r)throw r;return t},enabled:!!e})},cIe=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s,error:o}=await Ct.from("user_addresses").insert({user_id:e.id,label:n.label,street:n.street,district:n.district||null,city:n.city,postal_code:n.postal_code||null,country:n.country,phone:n.phone||null,phone_code:n.phone_code||"+351",is_default:n.is_default||!1}).select().single();if(o)throw o;return s},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address added successfully"})},onError:()=>{t({title:"Error",description:"Failed to add address",variant:"destructive"})}})},uIe=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async({id:n,address:s})=>{if(!e)throw new Error("User not authenticated");const{data:o,error:d}=await Ct.from("user_addresses").update({label:s.label,street:s.street,district:s.district||null,city:s.city,postal_code:s.postal_code||null,country:s.country,phone:s.phone||null,phone_code:s.phone_code||"+351",is_default:s.is_default}).eq("id",n).eq("user_id",e.id).select().single();if(d)throw d;return o},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update address",variant:"destructive"})}})},dIe=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{error:s}=await Ct.from("user_addresses").delete().eq("id",n).eq("user_id",e.id);if(s)throw s},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address deleted successfully"})},onError:()=>{t({title:"Error",description:"Failed to delete address",variant:"destructive"})}})},hIe=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s,error:o}=await Ct.from("user_addresses").update({is_default:!0}).eq("id",n).eq("user_id",e.id).select().single();if(o)throw o;return s},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Default address updated"})},onError:()=>{t({title:"Error",description:"Failed to set default address",variant:"destructive"})}})},$F=[{value:"Home",icon:CQ,labelKey:"address.labelHome"},{value:"Work",icon:lE,labelKey:"address.labelWork"},{value:"Office",icon:v_e,labelKey:"address.labelOffice"},{value:"Other",icon:ga,labelKey:"address.labelOther"}],fIe=[{code:"+351",country:"Portugal",flag:""},{code:"+34",country:"Spain",flag:""},{code:"+33",country:"France",flag:""},{code:"+49",country:"Germany",flag:""},{code:"+39",country:"Italy",flag:""},{code:"+44",country:"UK",flag:""},{code:"+31",country:"Netherlands",flag:""},{code:"+32",country:"Belgium",flag:""},{code:"+86",country:"China",flag:""},{code:"+1",country:"USA/Canada",flag:""},{code:"+55",country:"Brazil",flag:""}],pIe=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],lW=({initialData:e,onSubmit:t,onCancel:r,isLoading:n,isEdit:s})=>{const{t:o}=ei(),[d,i]=V.useState({label:(e==null?void 0:e.label)||"Home",street:(e==null?void 0:e.street)||"",district:(e==null?void 0:e.district)||"",city:(e==null?void 0:e.city)||"",postal_code:(e==null?void 0:e.postal_code)||"",country:(e==null?void 0:e.country)||"Portugal",phone:(e==null?void 0:e.phone)||"",phone_code:(e==null?void 0:e.phone_code)||"+351",is_default:(e==null?void 0:e.is_default)||!1}),m=y=>{y.preventDefault(),t(d)};return h.jsxs("form",{onSubmit:m,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"label",children:o("address.label")}),h.jsxs(Aa,{value:d.label,onValueChange:y=>i({...d,label:y}),children:[h.jsx(ya,{children:h.jsx(Ca,{placeholder:o("address.selectLabel")})}),h.jsx(va,{children:$F.map(y=>h.jsx(En,{value:y.value,children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(y.icon,{className:"w-4 h-4"}),o(y.labelKey)]})},y.value))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"street",children:[o("address.street")," *"]}),h.jsx(cr,{id:"street",value:d.street,onChange:y=>i({...d,street:y.target.value}),placeholder:o("address.streetPlaceholder"),required:!0})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"district",children:o("address.district")}),h.jsx(cr,{id:"district",value:d.district,onChange:y=>i({...d,district:y.target.value}),placeholder:o("address.districtPlaceholder")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"city",children:[o("address.city")," *"]}),h.jsx(cr,{id:"city",value:d.city,onChange:y=>i({...d,city:y.target.value}),placeholder:o("address.cityPlaceholder"),required:!0})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"postal_code",children:[o("address.postalCode")," *"]}),h.jsx(cr,{id:"postal_code",value:d.postal_code,onChange:y=>i({...d,postal_code:y.target.value}),placeholder:o("address.postalCodePlaceholder"),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"country",children:[o("address.country")," *"]}),h.jsxs(Aa,{value:d.country,onValueChange:y=>i({...d,country:y}),children:[h.jsx(ya,{children:h.jsx(Ca,{placeholder:o("address.selectCountry")})}),h.jsx(va,{children:pIe.map(y=>h.jsx(En,{value:y,children:y},y))})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"phone",children:[o("address.phone")," *"]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsxs(Aa,{value:d.phone_code,onValueChange:y=>i({...d,phone_code:y}),children:[h.jsx(ya,{className:"w-[130px]",children:h.jsx(Ca,{placeholder:"+351"})}),h.jsx(va,{children:fIe.map(y=>h.jsx(En,{value:y.code,children:h.jsxs("span",{className:"flex items-center gap-2",children:[h.jsx("span",{children:y.flag}),h.jsx("span",{children:y.code})]})},y.code))})]}),h.jsx(cr,{id:"phone",className:"flex-1",value:d.phone,onChange:y=>i({...d,phone:y.target.value}),placeholder:o("address.phonePlaceholder"),required:!0})]})]}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx(tl,{id:"is_default",checked:d.is_default,onCheckedChange:y=>i({...d,is_default:y})}),h.jsx(yr,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:o("address.setAsDefault")})]}),h.jsxs(r_,{className:"gap-2 sm:gap-0",children:[h.jsx(Mt,{type:"button",variant:"outline",onClick:r,children:o("common.cancel")}),h.jsx(Mt,{type:"submit",disabled:n,children:o(n?"common.saving":s?"common.save":"address.add")})]})]})},mIe=({address:e,onEdit:t,onDelete:r,onSetDefault:n,isDeleting:s,isSettingDefault:o,canDelete:d=!0})=>{const{t:i}=ei(),m=$F.find(S=>S.value===e.label)||$F[3],y=m.icon;return h.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${e.is_default?"bg-primary/5 border-primary/20":""}`,children:h.jsxs("div",{className:"flex items-start justify-between gap-4",children:[h.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[h.jsx("div",{className:`p-2 rounded-full ${e.is_default?"bg-primary/20":"bg-primary/10"}`,children:h.jsx(y,{className:"w-5 h-5 text-primary"})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[h.jsx("span",{className:"font-semibold text-foreground",children:i(m.labelKey)}),e.is_default&&h.jsxs(tn,{variant:"secondary",className:"text-xs",children:[h.jsx(Cl,{className:"w-3 h-3 mr-1 fill-current"}),i("address.default")]})]}),h.jsxs("p",{className:"text-sm text-foreground",children:[e.street,e.district&&`, ${e.district}`]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:[e.postal_code,e.city,e.country].filter(Boolean).join(", ")}),e.phone&&h.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[h.jsx(tw,{className:"w-3 h-3"}),e.phone_code," ",e.phone]})]})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[!e.is_default&&h.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>n(e.id),disabled:o,title:i("address.setAsDefault"),children:h.jsx(Cl,{className:"w-4 h-4"})}),h.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>t(e),title:i("common.edit"),children:h.jsx(_2,{className:"w-4 h-4"})}),d&&h.jsxs(Io,{children:[h.jsx(_b,{asChild:!0,children:h.jsx(Mt,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:i("common.delete"),children:h.jsx(Yh,{className:"w-4 h-4"})})}),h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:i("address.deleteTitle")}),h.jsx(po,{children:i("address.deleteDescription")})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:i("common.cancel")}),h.jsx(to,{onClick:()=>r(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:s,children:i(s?"common.deleting":"common.delete")})]})]})]})]})]})})},cW=()=>{const{t:e}=ei(),{data:t,isLoading:r}=lIe(),{data:n}=jN(),s=cIe(),o=uIe(),d=Xne(),i=dIe(),m=hIe(),[y,S]=V.useState(!1),[w,T]=V.useState(null),[A,O]=V.useState(null),[P,N]=V.useState(!1),R=!(n!=null&&n.phone),M=te=>{if(R&&te.phone){O(te),N(!0);return}s.mutate(te,{onSuccess:()=>S(!1)})},F=()=>{if(!A)return;const te=`${A.phone_code||"+351"} ${A.phone}`;d.mutate({phone:te}),s.mutate(A,{onSuccess:()=>{S(!1),O(null),N(!1)}})},B=()=>{O(null),N(!1)},$=te=>{w&&o.mutate({id:w.id,address:te},{onSuccess:()=>T(null)})},W=te=>{i.mutate(te)},K=te=>{m.mutate(te)};return r?h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(ga,{className:"w-5 h-5"}),e("address.myAddresses")]})}),h.jsx(Mr,{children:h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("common.loading")})})]}):h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(ga,{className:"w-5 h-5"}),e("address.myAddresses")]}),h.jsx(cs,{children:e("address.manageDescription")})]}),h.jsxs(Lo,{open:y,onOpenChange:S,children:[h.jsx(tf,{asChild:!0,children:h.jsxs(Mt,{size:"sm",children:[h.jsx(ap,{className:"w-4 h-4 mr-2"}),e("address.addNew")]})}),h.jsxs(xo,{className:"sm:max-w-[500px]",children:[h.jsxs(bo,{children:[h.jsx(wo,{children:e("address.addNew")}),h.jsx(pl,{children:e("address.addDescription")})]}),h.jsx(lW,{onSubmit:M,onCancel:()=>S(!1),isLoading:s.isPending})]})]})]})}),h.jsx(Mr,{children:t&&t.length>0?h.jsx("div",{className:"space-y-4",children:t.map(te=>h.jsx(mIe,{address:te,onEdit:T,onDelete:W,onSetDefault:K,isDeleting:i.isPending,isSettingDefault:m.isPending,canDelete:t.length>1},te.id))}):h.jsxs("div",{className:"text-center py-8",children:[h.jsx(ga,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),h.jsx("p",{className:"text-muted-foreground mb-4",children:e("address.noAddresses")}),h.jsxs(Mt,{onClick:()=>S(!0),children:[h.jsx(ap,{className:"w-4 h-4 mr-2"}),e("address.addFirst")]})]})}),h.jsx(Lo,{open:!!w,onOpenChange:()=>T(null),children:h.jsxs(xo,{className:"sm:max-w-[500px]",children:[h.jsxs(bo,{children:[h.jsx(wo,{children:e("address.editAddress")}),h.jsx(pl,{children:e("address.editDescription")})]}),w&&h.jsx(lW,{initialData:w,onSubmit:$,onCancel:()=>T(null),isLoading:o.isPending,isEdit:!0})]})}),h.jsx(Io,{open:P,onOpenChange:N,children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:e("address.phoneConfirmTitle")}),h.jsx(po,{children:e("address.phoneConfirmDescription")})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:B,children:e("common.cancel")}),h.jsx(to,{onClick:F,disabled:s.isPending||d.isPending,children:s.isPending||d.isPending?e("common.saving"):e("common.confirm")})]})]})})]})};var WN="Switch",[gIe,pst]=Fo(WN),[yIe,vIe]=gIe(WN),roe=V.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:s,defaultChecked:o,required:d,disabled:i,value:m="on",onCheckedChange:y,form:S,...w}=e,[T,A]=V.useState(null),O=$n(t,F=>A(F)),P=V.useRef(!1),N=T?S||!!T.closest("form"):!0,[R,M]=Zc({prop:s,defaultProp:o??!1,onChange:y,caller:WN});return h.jsxs(yIe,{scope:r,checked:R,disabled:i,children:[h.jsx(on.button,{type:"button",role:"switch","aria-checked":R,"aria-required":d,"data-state":aoe(R),"data-disabled":i?"":void 0,disabled:i,value:m,...w,ref:O,onClick:Ir(e.onClick,F=>{M(B=>!B),N&&(P.current=F.isPropagationStopped(),P.current||F.stopPropagation())})}),N&&h.jsx(soe,{control:T,bubbles:!P.current,name:n,value:m,checked:R,required:d,disabled:i,form:S,style:{transform:"translateX(-100%)"}})]})});roe.displayName=WN;var noe="SwitchThumb",ioe=V.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,s=vIe(noe,r);return h.jsx(on.span,{"data-state":aoe(s.checked),"data-disabled":s.disabled?"":void 0,...n,ref:t})});ioe.displayName=noe;var _Ie="SwitchBubbleInput",soe=V.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...s},o)=>{const d=V.useRef(null),i=$n(d,o),m=M2(r),y=b2(t);return V.useEffect(()=>{const S=d.current;if(!S)return;const w=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(w,"checked").set;if(m!==r&&A){const O=new Event("click",{bubbles:n});A.call(S,r),S.dispatchEvent(O)}},[m,r,n]),h.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...s,tabIndex:-1,ref:i,style:{...s.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});soe.displayName=_Ie;function aoe(e){return e?"checked":"unchecked"}var ooe=roe,xIe=ioe;const Tb=V.forwardRef(({className:e,...t},r)=>h.jsx(ooe,{className:fr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:r,children:h.jsx(xIe,{className:fr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Tb.displayName=ooe.displayName;const uW=({isAgreed:e,agreedAt:t})=>{const{t:r,i18n:n}=ei(),{data:s,isLoading:o}=X5(),d=lCe(),[i,m]=V.useState(null),y=async T=>{m(T);try{await d.mutateAsync(T),ko({title:r("common.success"),description:r(T?"profile.activityTermsAgreed":"profile.activityTermsRevoked")})}catch{ko({title:r("common.error"),description:r("profile.activityTermsUpdateFailed"),variant:"destructive"})}finally{m(null)}},S=()=>{if(!s)return"";const T=n.language;return T==="zh"?s.content_zh:T==="pt"?s.content_pt:s.content_en},w=i!==null?i:e;return h.jsxs(kr,{children:[h.jsxs(Rn,{className:"pb-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ab,{className:"w-5 h-5 text-primary"}),h.jsx(Hn,{className:"text-lg",children:r("profile.activityTermsTitle")})]}),e?h.jsxs(tn,{className:"bg-green-500/10 text-green-600 hover:bg-green-500/20",children:[h.jsx(sp,{className:"w-3 h-3 mr-1"}),r("profile.activityTermsAgreedStatus")]}):h.jsxs(tn,{variant:"secondary",className:"bg-amber-500/10 text-amber-600",children:[h.jsx(rN,{className:"w-3 h-3 mr-1"}),r("profile.activityTermsNotAgreed")]})]}),h.jsx(cs,{children:r("profile.activityTermsDescription")})]}),h.jsx(Mr,{className:"space-y-4",children:o?h.jsx("div",{className:"flex justify-center py-4",children:h.jsx(aa,{className:"w-5 h-5 animate-spin text-primary"})}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"rounded-lg border bg-muted/30 p-4 max-h-48 overflow-y-auto",children:h.jsx("div",{className:`prose prose-sm dark:prose-invert max-w-none text-sm\r
                  [&_h1]:text-base [&_h1]:font-bold [&_h1]:mb-2\r
                  [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:mb-2\r
                  [&_p]:mb-2 [&_p]:text-muted-foreground\r
                  [&_ul]:list-disc [&_ul]:ml-4 [&_ul]:mb-2\r
                  [&_li]:mb-0.5`,dangerouslySetInnerHTML:{__html:S()}})}),h.jsx(Wae,{children:h.jsxs(Mt,{variant:"outline",size:"sm",className:"w-full",children:[h.jsx(ab,{className:"w-4 h-4 mr-2"}),r("profile.viewFullRules")]})}),h.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[h.jsxs("div",{className:"flex-1",children:[h.jsx("p",{className:"font-medium text-sm",children:r("profile.agreeToTerms")}),t&&e&&h.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r("profile.agreedOn"),": ",Tg(new Date(t),{addSuffix:!0})]})]}),h.jsx(Tb,{checked:w,onCheckedChange:y,disabled:d.isPending})]})]})})]})},UF=V.memo(({comment:e,getLocalizedField:t})=>h.jsxs(Hi,{to:`/${e.target_type}/${e.target_id}`,className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[h.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[h.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:t(e,"target_name")}),h.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:Tg(new Date(e.created_at),{addSuffix:!0})})]}),h.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:e.content}),e.image_url&&h.jsx("img",{src:e.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}));UF.displayName="CommentItem";const VF=V.memo(({restaurant:e,getLocalizedField:t})=>h.jsxs(Hi,{to:`/restaurant/${e.id}`,className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[h.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:h.jsx("img",{src:e.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t(e,"name")),className:"w-full h-full object-cover",loading:"lazy",onError:r=>{r.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:t(e,"name")}),h.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:t(e,"type")}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Cl,{className:"w-4 h-4 fill-accent text-accent"}),h.jsx("span",{className:"font-medium",children:e.rating||0})]})]})]}));VF.displayName="FavoriteRestaurantItem";const yE=V.memo(({subscription:e,getLocalizedField:t,t:r,isMobile:n})=>{var s;return h.jsx(Hi,{to:`/activity/${e.activity_id}`,className:`block rounded-lg border hover:shadow-medium transition-shadow ${n?"p-3":"p-4"}`,children:h.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[((s=e.activity)==null?void 0:s.image_url)&&h.jsx("img",{src:e.activity.image_url,alt:String(t(e.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(e.activity,"title")}),h.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(e.activity,"content")}}),h.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[r("profile.joinedOn"),":"," ",Tg(new Date(e.created_at),{addSuffix:!0})]})]}),h.jsx(yo,{className:`text-primary flex-shrink-0 ${n?"w-4 h-4":"w-5 h-5"}`})]})})});yE.displayName="ActivitySubscriptionItem";const qF=V.memo(({activityGroup:e,getLocalizedField:t,t:r,isMobile:n})=>{const s=e.activity,o=e.restaurants;return h.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${n?"p-3":"p-4"}`,children:[h.jsx(Hi,{to:`/activity/${s.id}`,className:n?"block mb-2":"block mb-3",children:h.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[s.image_url&&h.jsx("img",{src:s.image_url,alt:String(t(s,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(s,"title")}),h.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(s,"content")}}),h.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(yo,{className:"w-3 h-3"}),new Date(s.start_date).toLocaleDateString()]}),s.end_date&&h.jsxs("span",{children:["- ",new Date(s.end_date).toLocaleDateString()]})]})]})]})}),h.jsxs("div",{className:`pt-2 md:pt-3 border-t ${n?"mt-2":"mt-3"}`,children:[h.jsxs("div",{className:`flex items-center gap-2 ${n?"mb-1.5":"mb-2"}`,children:[h.jsx(Mo,{className:`text-primary ${n?"w-3.5 h-3.5":"w-4 h-4"}`}),h.jsxs("span",{className:`font-medium text-foreground ${n?"text-xs":"text-sm"}`,children:[r("profile.participatingRestaurants")," (",o.length,")"]})]}),h.jsx("div",{className:`flex flex-wrap ${n?"gap-1.5":"gap-2"}`,children:o.map(d=>h.jsx(tn,{variant:"secondary",className:n?"text-xs px-2 py-0.5":"text-xs",children:t(d,"name")},d.id))})]})]})});qF.displayName="MerchantActivityItem";const bIe=()=>{var ne,ae;const{t:e}=ei(),{user:t}=Qn(),r=qN(),{data:n,isLoading:s}=jN(),{data:o,isLoading:d}=rIe(),{data:i,isLoading:m}=nIe(),{data:y,isLoading:S}=O5(),{data:w,isLoading:T}=iIe(),{role:A,isMerchant:O,isSupervisor:P}=_c(),{getLocalizedField:N}=xc(),R=O||P,[M,F]=V.useState("profile"),[B,$]=V.useState(),W=[{value:"profile",label:e("profile.profile"),icon:P0},{value:"favorites",label:e("profile.favorites"),icon:VP},{value:"comments",label:e("profile.comments"),icon:qP},{value:"activities",label:e("profile.activities"),icon:yo},{value:"addresses",label:e("address.myAddresses"),icon:ga}];V.useEffect(()=>{B&&B.on("select",()=>{const re=B.selectedScrollSnap();F(W[re].value)})},[B]);const K=re=>{const ee=W.findIndex(ie=>ie.value===re);ee!==-1&&B&&B.scrollTo(ee),F(re)};if(!t||s)return h.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:h.jsx("div",{className:"container mx-auto max-w-6xl",children:h.jsx("div",{className:"text-center",children:e("common.loading")})})});const te=e(A?`profile.role.${A}`:"profile.role.user");return h.jsx("div",{className:`min-h-screen bg-secondary/20 ${r?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:h.jsxs("div",{className:`container mx-auto max-w-6xl ${r?"px-3":""}`,children:[!r&&h.jsxs(h.Fragment,{children:[h.jsx(kr,{className:"mb-6 md:mb-8",children:h.jsx(Mr,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:h.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[h.jsxs(qh,{className:"w-24 h-24",children:[h.jsx(Hh,{src:(n==null?void 0:n.avatar_url)||""}),h.jsx(Gh,{className:"text-3xl",children:((ne=n==null?void 0:n.display_name)==null?void 0:ne.charAt(0).toUpperCase())||"U"})]}),h.jsxs("div",{className:"flex-1 text-center md:text-left",children:[h.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:n==null?void 0:n.display_name}),h.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.email}),(n==null?void 0:n.phone)&&h.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:n.phone}),A&&A!=="user"&&h.jsx(tn,{className:"bg-primary capitalize",children:te})]}),n&&h.jsx(oW,{profile:n})]})})}),R&&h.jsx(uW,{isAgreed:(n==null?void 0:n.activity_terms_agreed)||!1,agreedAt:(n==null?void 0:n.activity_terms_agreed_at)||null})]}),r?h.jsxs(h.Fragment,{children:[h.jsx(Qae,{setApi:$,opts:{align:"start",loop:!1},className:"w-full",children:h.jsxs(eoe,{className:"-ml-0",children:[h.jsx(t0,{className:"pl-0",children:h.jsxs("div",{className:"pb-4",children:[h.jsx(kr,{children:h.jsx(Mr,{className:"pt-6 pb-6",children:h.jsxs("div",{className:"flex flex-col items-center gap-4",children:[h.jsxs(qh,{className:"w-20 h-20",children:[h.jsx(Hh,{src:(n==null?void 0:n.avatar_url)||""}),h.jsx(Gh,{className:"text-2xl",children:((ae=n==null?void 0:n.display_name)==null?void 0:ae.charAt(0).toUpperCase())||"U"})]}),h.jsxs("div",{className:"flex-1 text-center w-full",children:[h.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:n==null?void 0:n.display_name}),h.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:t.email}),(n==null?void 0:n.phone)&&h.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:n.phone}),A&&A!=="user"&&h.jsx(tn,{className:"bg-primary capitalize text-xs mb-4",children:te}),n&&h.jsx("div",{className:"mt-4",children:h.jsx(oW,{profile:n})})]})]})})}),R&&h.jsx("div",{className:"mt-4",children:h.jsx(uW,{isAgreed:(n==null?void 0:n.activity_terms_agreed)||!1,agreedAt:(n==null?void 0:n.activity_terms_agreed_at)||null})})]})}),h.jsx(t0,{className:"pl-0",children:h.jsx("div",{className:"pb-4",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:"pb-3",children:[h.jsx(Hn,{className:"text-lg",children:e("profile.favoriteRestaurants")}),h.jsx(cs,{className:"text-xs",children:e("profile.favoritesDesc")})]}),h.jsx(Mr,{className:"px-3",children:d?h.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):o&&o.length>0?h.jsx("div",{className:"grid gap-3 grid-cols-1",children:o.map(re=>h.jsx(VF,{restaurant:re,getLocalizedField:N},re.id))}):h.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:e("profile.noFavorites")})})]})})}),h.jsx(t0,{className:"pl-0",children:h.jsx("div",{className:"pb-4",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:"pb-3",children:[h.jsx(Hn,{className:"text-lg",children:e("profile.myComments")}),h.jsx(cs,{className:"text-xs",children:e("profile.commentsDesc")})]}),h.jsx(Mr,{className:"space-y-3 px-3",children:m?h.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):i&&i.length>0?i.map(re=>h.jsx(UF,{comment:re,getLocalizedField:N},re.id)):h.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:e("profile.noComments")})})]})})}),h.jsx(t0,{className:"pl-0",children:h.jsx("div",{className:"pb-4",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:"pb-3",children:[h.jsx(Hn,{className:"text-lg",children:e(R?"profile.participatedActivities":"profile.joinedActivities")}),h.jsx(cs,{className:"text-xs",children:e(R?"profile.participatedActivitiesDesc":"profile.activitiesDesc")})]}),h.jsx(Mr,{className:"px-3",children:R?h.jsxs("div",{className:"space-y-4",children:[S?h.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):y&&y.length>0?h.jsxs("div",{children:[h.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[h.jsx(Bc,{className:"w-4 h-4"}),e("profile.personalActivities")]}),h.jsx("div",{className:"space-y-3",children:y.map(re=>h.jsx(yE,{subscription:re,getLocalizedField:N,t:e,isMobile:!0},re.activity_id))})]}):null,T?h.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):w&&w.length>0?h.jsxs("div",{children:[h.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[h.jsx(Mo,{className:"w-4 h-4"}),e("profile.restaurantActivities")]}),h.jsx("div",{className:"space-y-3",children:(()=>{const re=w.reduce((ee,ie)=>{const de=ie.activity_id;return ee[de]||(ee[de]={activity:ie.activity,restaurants:[],participationDate:ie.created_at}),ee[de].restaurants.push({id:ie.restaurant_id,name:ie.restaurant_name,name_en:ie.restaurant_name_en,name_pt:ie.restaurant_name_pt}),ee},{});return Object.values(re).map(ee=>h.jsx(qF,{activityGroup:ee,getLocalizedField:N,t:e,isMobile:!0},ee.activity.id))})()})]}):null,(!y||y.length===0)&&(!w||w.length===0)&&h.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[e("profile.noParticipatedActivities")," ",h.jsx(Hi,{to:"/activities",className:"text-primary hover:underline",children:e("profile.browseActivities")})]})]}):S?h.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):y&&y.length>0?h.jsx("div",{className:"space-y-3",children:y.map(re=>h.jsx(yE,{subscription:re,getLocalizedField:N,t:e,isMobile:!0},re.activity_id))}):h.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[e("profile.noActivities")," ",h.jsx(Hi,{to:"/activities",className:"text-primary hover:underline",children:e("profile.upcomingEvents")})]})})]})})}),h.jsx(t0,{className:"pl-0",children:h.jsx("div",{className:"pb-4",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:"pb-3",children:[h.jsx(Hn,{className:"text-lg",children:e("address.myAddresses")}),h.jsx(cs,{className:"text-xs",children:e("address.addressesDesc")})]}),h.jsx(Mr,{className:"px-3",children:h.jsx(cW,{})})]})})})]})}),h.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t z-50",children:h.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:W.map(re=>{const ee=re.icon;return h.jsxs("button",{onClick:()=>K(re.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${M===re.value?"text-primary":"text-muted-foreground"}`,children:[h.jsx(ee,{className:`${M===re.value?"w-6 h-6":"w-5 h-5"}`}),h.jsx("span",{className:"text-xs font-medium",children:re.label})]},re.value)})})})]}):h.jsxs(Lv,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[h.jsxs(gg,{className:"grid w-full grid-cols-4",children:[h.jsxs(La,{value:"favorites",children:[h.jsx(VP,{className:"w-4 h-4 mr-2"}),e("profile.favorites")]}),h.jsxs(La,{value:"comments",children:[h.jsx(qP,{className:"w-4 h-4 mr-2"}),e("profile.comments")]}),h.jsxs(La,{value:"activities",children:[h.jsx(yo,{className:"w-4 h-4 mr-2"}),e("profile.activities")]}),h.jsxs(La,{value:"addresses",children:[h.jsx(ga,{className:"w-4 h-4 mr-2"}),e("address.myAddresses")]})]}),h.jsx(Fa,{value:"favorites",className:"space-y-4",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:r?"pb-3":"",children:[h.jsx(Hn,{className:r?"text-lg":"",children:e("profile.favoriteRestaurants")}),h.jsx(cs,{className:r?"text-xs":"",children:e("profile.favoritesDesc")})]}),h.jsx(Mr,{className:r?"px-3":"",children:d?h.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):o&&o.length>0?h.jsx("div",{className:`grid gap-3 md:gap-4 ${r?"grid-cols-1":"md:grid-cols-2"}`,children:o.map(re=>h.jsx(VF,{restaurant:re,getLocalizedField:N},re.id))}):h.jsx("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:e("profile.noFavorites")})})]})}),h.jsx(Fa,{value:"comments",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:r?"pb-3":"",children:[h.jsx(Hn,{className:r?"text-lg":"",children:e("profile.myComments")}),h.jsx(cs,{className:r?"text-xs":"",children:e("profile.commentsDesc")})]}),h.jsx(Mr,{className:`space-y-3 md:space-y-4 ${r?"px-3":""}`,children:m?h.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):i&&i.length>0?i.map(re=>h.jsx(UF,{comment:re,getLocalizedField:N},re.id)):h.jsx("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:e("profile.noComments")})})]})}),h.jsx(Fa,{value:"activities",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:r?"pb-3":"",children:[h.jsx(Hn,{className:r?"text-lg":"",children:e(R?"profile.participatedActivities":"profile.joinedActivities")}),h.jsx(cs,{className:r?"text-xs":"",children:e(R?"profile.participatedActivitiesDesc":"profile.activitiesDesc")})]}),h.jsx(Mr,{className:r?"px-3":"",children:R?h.jsxs("div",{className:r?"space-y-4":"space-y-6",children:[S?h.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):y&&y.length>0?h.jsxs("div",{children:[h.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${r?"text-base":"text-lg"}`,children:[h.jsx(Bc,{className:r?"w-4 h-4":"w-5 h-5"}),e("profile.personalActivities")]}),h.jsx("div",{className:r?"space-y-3":"space-y-4",children:y.map(re=>h.jsx(yE,{subscription:re,getLocalizedField:N,t:e,isMobile:r},re.activity_id))})]}):null,T?h.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):w&&w.length>0?h.jsxs("div",{children:[h.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${r?"text-base":"text-lg"}`,children:[h.jsx(Mo,{className:r?"w-4 h-4":"w-5 h-5"}),e("profile.restaurantActivities")]}),h.jsx("div",{className:r?"space-y-3":"space-y-4",children:(()=>{const re=w.reduce((ee,ie)=>{const de=ie.activity_id;return ee[de]||(ee[de]={activity:ie.activity,restaurants:[],participationDate:ie.created_at}),ee[de].restaurants.push({id:ie.restaurant_id,name:ie.restaurant_name,name_en:ie.restaurant_name_en,name_pt:ie.restaurant_name_pt}),ee},{});return Object.values(re).map(ee=>h.jsx(qF,{activityGroup:ee,getLocalizedField:N,t:e,isMobile:r},ee.activity.id))})()})]}):null,(!y||y.length===0)&&(!w||w.length===0)&&h.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[e("profile.noParticipatedActivities")," ",h.jsx(Hi,{to:"/activities",className:"text-primary hover:underline",children:e("profile.browseActivities")})]})]}):S?h.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):y&&y.length>0?h.jsx("div",{className:r?"space-y-3":"space-y-4",children:y.map(re=>h.jsx(yE,{subscription:re,getLocalizedField:N,t:e,isMobile:r},re.activity_id))}):h.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[e("profile.noActivities")," ",h.jsx(Hi,{to:"/activities",className:"text-primary hover:underline",children:e("profile.upcomingEvents")})]})})]})}),h.jsx(Fa,{value:"addresses",children:h.jsx(cW,{})})]})]})})},r$=ike,loe=V.createContext({}),Ki=({...e})=>h.jsx(loe.Provider,{value:{name:e.name},children:h.jsx(_m,{...e})}),KN=()=>{const e=V.useContext(loe),t=V.useContext(coe),{getFieldState:r,formState:n}=$N(),s=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:o}=t;return{id:o,name:e.name,formItemId:`${o}-form-item`,formDescriptionId:`${o}-form-item-description`,formMessageId:`${o}-form-item-message`,...s}},coe=V.createContext({}),qi=V.forwardRef(({className:e,...t},r)=>{const n=V.useId();return h.jsx(coe.Provider,{value:{id:n},children:h.jsx("div",{ref:r,className:fr("space-y-2",e),...t})})});qi.displayName="FormItem";const Xi=V.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:s}=KN();return h.jsx(yr,{ref:r,className:fr(n&&"text-destructive",e),htmlFor:s,...t})});Xi.displayName="FormLabel";const Zi=V.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:s,formMessageId:o}=KN();return h.jsx(Wv,{ref:t,id:n,"aria-describedby":r?`${s} ${o}`:`${s}`,"aria-invalid":!!r,...e})});Zi.displayName="FormControl";const ev=V.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=KN();return h.jsx("p",{ref:r,id:n,className:fr("text-sm text-muted-foreground",e),...t})});ev.displayName="FormDescription";const ss=V.forwardRef(({className:e,children:t,...r},n)=>{const{error:s,formMessageId:o}=KN(),d=s?String(s==null?void 0:s.message):t;return d?h.jsx("p",{ref:n,id:o,className:fr("text-sm font-medium text-destructive",e),...r,children:d}):null});ss.displayName="FormMessage";const dW=["booking","delivery","qrcode"],wIe=()=>{const{t:e}=ei(),[t,r]=V.useState(!1),[n,s]=V.useState(!1),o=V.useMemo(()=>Ah({name:xn().min(2,{message:e("joinUs.nameMin")}),email:xn().email({message:e("joinUs.emailInvalid")}),phone:xn().min(6,{message:e("joinUs.phoneMin")}),restaurant_name:xn().min(2,{message:e("joinUs.restaurantNameMin")}),restaurant_address:xn().min(2,{message:e("joinUs.addressMin")}),features_selected:hP(wT(dW)).min(1,{message:e("joinUs.featuresMin")})}),[e]),d=Eh({resolver:Th(o),defaultValues:{name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[]}}),i=async m=>{r(!0);try{const{error:y}=await Ct.functions.invoke("send-join-request-email",{body:m});if(y){if(y.message.includes("rate_limit_exceeded"))ko({title:e("joinUs.rateLimitError"),description:e("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw y;return}s(!0),d.reset(),ko({title:e("joinUs.successTitle"),description:e("joinUs.successDescription")})}catch(y){console.error("Error submitting join request:",y),ko({title:e("common.error"),description:e("joinUs.submitError"),variant:"destructive"})}finally{r(!1)}};return n?h.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:h.jsx("div",{className:"container mx-auto max-w-2xl",children:h.jsx(kr,{className:"border-primary",children:h.jsxs(Mr,{className:"pt-12 pb-12 text-center",children:[h.jsx(BP,{className:"w-16 h-16 text-primary mx-auto mb-4"}),h.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:e("joinUs.successTitle")}),h.jsx("p",{className:"text-lg font-semibold text-foreground mb-2",children:e("joinUs.successDescription")}),h.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:e("joinUs.successMessage")}),h.jsx(Mt,{onClick:()=>s(!1),children:e("joinUs.submitAnother")})]})})})}):h.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:h.jsx("div",{className:"container mx-auto max-w-3xl",children:h.jsxs(kr,{children:[h.jsxs(Rn,{className:"text-center space-y-2",children:[h.jsx("div",{className:"flex justify-center mb-4",children:h.jsx(Mo,{className:"w-12 h-12 text-primary"})}),h.jsx(Hn,{className:"text-3xl font-bold",children:e("joinUs.title")}),h.jsx(cs,{className:"text-base",children:e("joinUs.description")})]}),h.jsx(Mr,{children:h.jsx(r$,{...d,children:h.jsxs("form",{onSubmit:d.handleSubmit(i),className:"space-y-6",children:[h.jsx(Ki,{control:d.control,name:"name",render:({field:m})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:e("joinUs.name")}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:e("joinUs.namePlaceholder"),...m})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"email",render:({field:m})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:e("joinUs.email")}),h.jsx(Zi,{children:h.jsx(cr,{type:"email",placeholder:e("joinUs.emailPlaceholder"),...m})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"phone",render:({field:m})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:e("joinUs.phone")}),h.jsx(Zi,{children:h.jsx(cr,{type:"tel",placeholder:e("joinUs.phonePlaceholder"),...m})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"restaurant_name",render:({field:m})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:e("joinUs.restaurantName")}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:e("joinUs.restaurantNamePlaceholder"),...m})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"restaurant_address",render:({field:m})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:e("joinUs.restaurantAddress")}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:e("joinUs.restaurantAddressPlaceholder"),...m})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"features_selected",render:()=>h.jsxs(qi,{children:[h.jsxs("div",{className:"mb-4",children:[h.jsx(Xi,{children:e("joinUs.featuresNeeded")}),h.jsx(ev,{children:e("joinUs.featuresDescription")})]}),dW.map(m=>h.jsx(Ki,{control:d.control,name:"features_selected",render:({field:y})=>{var S;return h.jsxs(qi,{className:"flex flex-row items-start space-x-3 space-y-0",children:[h.jsx(Zi,{children:h.jsx(tl,{checked:(S=y.value)==null?void 0:S.includes(m),onCheckedChange:w=>{var T;return w?y.onChange([...y.value,m]):y.onChange((T=y.value)==null?void 0:T.filter(A=>A!==m))}})}),h.jsx(Xi,{className:"font-normal cursor-pointer",children:e(`joinUs.feature.${m}`)})]},m)}},m)),h.jsx(ss,{})]})}),h.jsx("div",{className:"text-xs text-muted-foreground text-center pb-4",children:e("joinUs.consentText")}),h.jsxs(Mt,{type:"submit",className:"w-full",size:"lg",disabled:t,children:[t&&h.jsx(aa,{className:"mr-2 h-4 w-4 animate-spin"}),e("joinUs.submit")]})]})})})]})})})},SIe=()=>{const e=Qh();return V.useEffect(()=>{},[e.pathname]),h.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:h.jsxs("div",{className:"text-center",children:[h.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),h.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),h.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},z2=async e=>{const{data:t}=await Ct.from("user_roles").select("role").eq("user_id",e).single();return t==null?void 0:t.role},EIe=()=>{const{user:e}=Qn();return ci({queryKey:["admin-users",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("profiles").select("*").order("created_at",{ascending:!1});if(r)throw r;const n=await Promise.all((t||[]).map(async o=>{const{data:d}=await Ct.from("user_roles").select("role").eq("user_id",o.id).single();return{...o,role:(d==null?void 0:d.role)||"user"}})),{data:s}=await Ct.from("user_roles").select("role").eq("user_id",e.id).single();if((s==null?void 0:s.role)==="supervisor"){const{data:o,error:d}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(d)throw d;if(!o||o.length===0)return[];const i=o.map(O=>O.restaurant_id),{data:m,error:y}=await Ct.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",i);if(y)throw y;if(!m||m.length===0)return[];const S=[...new Set(m.map(O=>O.user_id).filter(O=>O!==e.id))];if(S.length===0)return[];const{data:w,error:T}=await Ct.from("user_roles").select("user_id").in("user_id",S).eq("role","merchant");if(T)throw T;const A=(w==null?void 0:w.map(O=>O.user_id))||[];return n.filter(O=>A.includes(O.id))}return n}})},TIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async({userId:r,role:n})=>{const{error:s}=await Ct.from("user_roles").upsert({user_id:r,role:n},{onConflict:"user_id"});if(s)throw s},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),t.invalidateQueries({queryKey:["user-roles"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.roleChanged")})},onError:r=>{console.error("Role change error:",r),e({title:Pr.t("common.error"),description:r.message||Pr.t("toast.roleChangeFailed"),variant:"destructive"})}})},AIe=()=>{const{user:e}=Qn();return ci({queryKey:["admin-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];if(await z2(e.id)==="supervisor"){const{data:n,error:s}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(s)throw s;const o=(n==null?void 0:n.map(m=>m.restaurant_id))||[];if(o.length===0)return[];const{data:d,error:i}=await Ct.from("restaurants").select("*").in("id",o).order("rating",{ascending:!1});if(i)throw i;return d||[]}else{const{data:n,error:s}=await Ct.from("restaurants").select("*").order("rating",{ascending:!1});if(s)throw s;return n||[]}},enabled:!!e})},CIe=()=>ci({queryKey:["operation-logs"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("operation_logs").select("*").order("created_at",{ascending:!1}).limit(100);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{data:s}=await Ct.from("profiles").select("display_name").eq("id",n.user_id).single();return{...n,user_name:(s==null?void 0:s.display_name)||"Unknown User"}}))}}),jIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async({userId:r,display_name:n,phone:s,avatar_url:o})=>{const{data:d,error:i}=await Ct.from("profiles").update({display_name:n,phone:s,avatar_url:o}).eq("id",r).select().single();if(i)throw i;return d},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.profileUpdated")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.profileUpdateFailed"),variant:"destructive"})}})},PIe=()=>{const{toast:e}=Ii();return Gi({mutationFn:async({file:t,userId:r})=>{const n=t.name.split(".").pop(),s=`${Date.now()}.${n}`,o=`${r}/${s}`,{error:d}=await Ct.storage.from("avatars").upload(o,t,{upsert:!0});if(d)throw d;const{data:{publicUrl:i}}=Ct.storage.from("avatars").getPublicUrl(o);return i},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.avatarUploadFailed"),variant:"destructive"})}})},OIe=()=>{const{user:e}=Qn();return ci({queryKey:["admin-stats",e==null?void 0:e.id],queryFn:async()=>{if(!e)return{totalUsers:0,totalRestaurants:0,totalActivities:0,totalComments:0};if(await z2(e.id)==="supervisor"){const{data:i}=await Ct.from("merchant_restaurants").select("restaurant_id, user_id").eq("user_id",e.id),m=(i==null?void 0:i.map(A=>A.restaurant_id))||[],S=(Array.from(new Set(i==null?void 0:i.map(A=>A.user_id)))||[]).length,w=m.length;let T=0;if(m.length>0){const{count:A}=await Ct.from("comments").select("*",{count:"exact",head:!0}).eq("target_type","restaurant").in("target_id",m);T=A||0}return{totalUsers:S,totalRestaurants:w,totalActivities:0,totalComments:T}}const[n,s,o,d]=await Promise.all([Ct.from("profiles").select("*",{count:"exact",head:!0}),Ct.from("restaurants").select("*",{count:"exact",head:!0}),Ct.from("activities").select("*",{count:"exact",head:!0}),Ct.from("comments").select("*",{count:"exact",head:!0})]);return{totalUsers:n.count||0,totalRestaurants:s.count||0,totalActivities:o.count||0,totalComments:d.count||0}}})},kIe=()=>{const{user:e}=Qn();return ci({queryKey:["top-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await z2(e.id)==="supervisor";let n=Ct.from("restaurants").select("id, name, rating").order("rating",{ascending:!1,nullsFirst:!1}).limit(10);if(r){const{data:i}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id),m=(i==null?void 0:i.map(y=>y.restaurant_id))||[];if(m.length===0)return[];n=Ct.from("restaurants").select("id, name, rating").in("id",m).order("rating",{ascending:!1,nullsFirst:!1}).limit(10)}const{data:s,error:o}=await n;if(o)throw o;return await Promise.all((s||[]).map(async i=>{const{count:m}=await Ct.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",i.id).eq("target_type","restaurant");return{name:i.name,rating:i.rating||0,comments:m||0}}))}})},NIe=()=>{const{user:e}=Qn();return ci({queryKey:["restaurant-rating-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await z2(e.id)==="supervisor";let n=[],s={};if(r){const{data:y}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(y==null?void 0:y.map(S=>S.restaurant_id))||[]}else{const{data:y}=await Ct.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(y==null?void 0:y.map(S=>S.id))||[],y==null||y.forEach(S=>{s[S.id]=S.name})}if(n.length===0)return[];const{data:o}=await Ct.from("comments").select("target_id, rating_value, created_at").eq("target_type","restaurant").in("target_id",n).not("rating_value","is",null).order("created_at",{ascending:!0});if(!o||o.length===0)return[];if(Object.keys(s).length===0){const{data:y}=await Ct.from("restaurants").select("id, name").in("id",n);y==null||y.forEach(S=>{s[S.id]=S.name})}const d={};o.forEach(y=>{const S=new Date(y.created_at),w=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;d[y.target_id]||(d[y.target_id]={}),d[y.target_id][w]||(d[y.target_id][w]={sum:0,count:0}),d[y.target_id][w].sum+=y.rating_value,d[y.target_id][w].count+=1});const i=new Set;return Object.values(d).forEach(y=>{Object.keys(y).forEach(S=>i.add(S))}),Array.from(i).sort().map(y=>{const S={month:y};return Object.keys(d).forEach(w=>{const T=d[w][y],A=T?(T.sum/T.count).toFixed(1):null;S[s[w]||w]=A}),S})}})},IIe=()=>{const{user:e}=Qn();return ci({queryKey:["restaurant-comment-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await z2(e.id)==="supervisor";let n=[],s={};if(r){const{data:y}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(y==null?void 0:y.map(S=>S.restaurant_id))||[]}else{const{data:y}=await Ct.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(y==null?void 0:y.map(S=>S.id))||[],y==null||y.forEach(S=>{s[S.id]=S.name})}if(n.length===0)return[];const{data:o}=await Ct.from("comments").select("target_id, created_at").eq("target_type","restaurant").in("target_id",n).order("created_at",{ascending:!0});if(!o||o.length===0)return[];if(Object.keys(s).length===0){const{data:y}=await Ct.from("restaurants").select("id, name").in("id",n);y==null||y.forEach(S=>{s[S.id]=S.name})}const d={};o.forEach(y=>{const S=new Date(y.created_at),w=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;d[y.target_id]||(d[y.target_id]={}),d[y.target_id][w]=(d[y.target_id][w]||0)+1});const i=new Set;return Object.values(d).forEach(y=>{Object.keys(y).forEach(S=>i.add(S))}),Array.from(i).sort().map(y=>{const S={month:y};return Object.keys(d).forEach(w=>{const T=d[w][y]||0;S[s[w]||w]=T}),S})}})},RIe=()=>ci({queryKey:["activity-engagement"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activities").select("id, title_en").order("created_at",{ascending:!1}).limit(10);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const[s,o]=await Promise.all([Ct.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id),Ct.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",n.id).eq("target_type","activity")]);return{name:n.title_en,subscribers:s.count||0,comments:o.count||0}}))}}),MIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{await Ct.from("activity_restaurants").delete().eq("activity_id",r);const{error:n}=await Ct.from("activities").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.activityDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.activityDeleteFailed"),variant:"destructive"})}})},DIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("restaurants").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.restaurantDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.restaurantDeleteFailed"),variant:"destructive"})}})},LIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{const n=r.map(async s=>{const{error:o}=await Ct.functions.invoke("delete-account",{body:{userId:s}});if(o)throw o});await Promise.all(n)},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.usersDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.usersDeleteFailed"),variant:"destructive"})}})},FIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("restaurants").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.restaurantsDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.restaurantsDeleteFailed"),variant:"destructive"})}})},zIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{await Ct.from("activity_restaurants").delete().in("activity_id",r);const{error:n}=await Ct.from("activities").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.activitiesDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.activitiesDeleteFailed"),variant:"destructive"})}})},BIe=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async({userIds:r,role:n})=>{const s=r.map(d=>({user_id:d,role:n})),{error:o}=await Ct.from("user_roles").upsert(s,{onConflict:"user_id"});if(o)throw o},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.rolesChanged")})},onError:r=>{console.error("Batch role change error:",r),e({title:Pr.t("common.error"),description:r.message||Pr.t("toast.rolesChangeFailed"),variant:"destructive"})}})},$Ie=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async({restaurantId:r,visible:n})=>{const{error:s}=await Ct.from("restaurants").update({visible:n}).eq("id",r);if(s)throw s},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-restaurants"]}),t.invalidateQueries({queryKey:["restaurants"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.visibilityUpdated")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.visibilityUpdateFailed"),variant:"destructive"})}})};function hW({className:e,...t}){return h.jsx("div",{className:fr("animate-pulse rounded-md bg-muted",e),...t})}const UIe="sidebar:state",VIe=60*60*24*7,qIe="16rem",HIe="18rem",GIe="3rem",WIe="b",uoe=V.createContext(null);function B2(){const e=V.useContext(uoe);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const doe=V.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:r,className:n,style:s,children:o,...d},i)=>{const m=qN(),[y,S]=V.useState(!1),[w,T]=V.useState(e),A=t??w,O=V.useCallback(M=>{const F=typeof M=="function"?M(A):M;r?r(F):T(F),document.cookie=`${UIe}=${F}; path=/; max-age=${VIe}`},[r,A]),P=V.useCallback(()=>m?S(M=>!M):O(M=>!M),[m,O,S]);V.useEffect(()=>{const M=F=>{F.key===WIe&&(F.metaKey||F.ctrlKey)&&(F.preventDefault(),P())};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[P]);const N=A?"expanded":"collapsed",R=V.useMemo(()=>({state:N,open:A,setOpen:O,isMobile:m,openMobile:y,setOpenMobile:S,toggleSidebar:P}),[N,A,O,m,y,S,P]);return h.jsx(uoe.Provider,{value:R,children:h.jsx(_ee,{delayDuration:0,children:h.jsx("div",{style:{"--sidebar-width":qIe,"--sidebar-width-icon":GIe,...s},className:fr("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:i,...d,children:o})})})});doe.displayName="SidebarProvider";const hoe=V.forwardRef(({side:e="left",variant:t="sidebar",collapsible:r="offcanvas",className:n,children:s,...o},d)=>{const{isMobile:i,state:m,openMobile:y,setOpenMobile:S}=B2();return r==="none"?h.jsx("div",{className:fr("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:d,...o,children:s}):i?h.jsx(Nre,{open:y,onOpenChange:S,...o,children:h.jsx(o5,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":HIe},side:e,children:h.jsx("div",{className:"flex h-full w-full flex-col",children:s})})}):h.jsxs("div",{ref:d,className:"group peer hidden text-sidebar-foreground md:block","data-state":m,"data-collapsible":m==="collapsed"?r:"","data-variant":t,"data-side":e,children:[h.jsx("div",{className:fr("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),h.jsx("div",{className:fr("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...o,children:h.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:s})})]})});hoe.displayName="Sidebar";const foe=V.forwardRef(({className:e,onClick:t,...r},n)=>{const{toggleSidebar:s}=B2();return h.jsxs(Mt,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:fr("h-7 w-7",e),onClick:o=>{t==null||t(o),s()},...r,children:[h.jsx(D_e,{}),h.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});foe.displayName="SidebarTrigger";const KIe=V.forwardRef(({className:e,...t},r)=>{const{toggleSidebar:n}=B2();return h.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:fr("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});KIe.displayName="SidebarRail";const ZIe=V.forwardRef(({className:e,...t},r)=>h.jsx("main",{ref:r,className:fr("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));ZIe.displayName="SidebarInset";const XIe=V.forwardRef(({className:e,...t},r)=>h.jsx(cr,{ref:r,"data-sidebar":"input",className:fr("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));XIe.displayName="SidebarInput";const YIe=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,"data-sidebar":"header",className:fr("flex flex-col gap-2 p-2",e),...t}));YIe.displayName="SidebarHeader";const JIe=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,"data-sidebar":"footer",className:fr("flex flex-col gap-2 p-2",e),...t}));JIe.displayName="SidebarFooter";const QIe=V.forwardRef(({className:e,...t},r)=>h.jsx(Yo,{ref:r,"data-sidebar":"separator",className:fr("mx-2 w-auto bg-sidebar-border",e),...t}));QIe.displayName="SidebarSeparator";const poe=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,"data-sidebar":"content",className:fr("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));poe.displayName="SidebarContent";const moe=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,"data-sidebar":"group",className:fr("relative flex w-full min-w-0 flex-col p-2",e),...t}));moe.displayName="SidebarGroup";const goe=V.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const s=t?Wv:"div";return h.jsx(s,{ref:n,"data-sidebar":"group-label",className:fr("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...r})});goe.displayName="SidebarGroupLabel";const eRe=V.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const s=t?Wv:"button";return h.jsx(s,{ref:n,"data-sidebar":"group-action",className:fr("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...r})});eRe.displayName="SidebarGroupAction";const yoe=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,"data-sidebar":"group-content",className:fr("w-full text-sm",e),...t}));yoe.displayName="SidebarGroupContent";const voe=V.forwardRef(({className:e,...t},r)=>h.jsx("ul",{ref:r,"data-sidebar":"menu",className:fr("flex w-full min-w-0 flex-col gap-1",e),...t}));voe.displayName="SidebarMenu";const _oe=V.forwardRef(({className:e,...t},r)=>h.jsx("li",{ref:r,"data-sidebar":"menu-item",className:fr("group/menu-item relative",e),...t}));_oe.displayName="SidebarMenuItem";const tRe=Zv("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),xoe=V.forwardRef(({asChild:e=!1,isActive:t=!1,variant:r="default",size:n="default",tooltip:s,className:o,...d},i)=>{const m=e?Wv:"button",{isMobile:y,state:S}=B2(),w=h.jsx(m,{ref:i,"data-sidebar":"menu-button","data-size":n,"data-active":t,className:fr(tRe({variant:r,size:n}),o),...d});return s?(typeof s=="string"&&(s={children:s}),h.jsxs(Ube,{children:[h.jsx(Vbe,{asChild:!0,children:w}),h.jsx(xee,{side:"right",align:"center",hidden:S!=="collapsed"||y,...s})]})):w});xoe.displayName="SidebarMenuButton";const rRe=V.forwardRef(({className:e,asChild:t=!1,showOnHover:r=!1,...n},s)=>{const o=t?Wv:"button";return h.jsx(o,{ref:s,"data-sidebar":"menu-action",className:fr("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...n})});rRe.displayName="SidebarMenuAction";const nRe=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:fr("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));nRe.displayName="SidebarMenuBadge";const iRe=V.forwardRef(({className:e,showIcon:t=!1,...r},n)=>{const s=V.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return h.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:fr("flex h-8 items-center gap-2 rounded-md px-2",e),...r,children:[t&&h.jsx(hW,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),h.jsx(hW,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":s}})]})});iRe.displayName="SidebarMenuSkeleton";const sRe=V.forwardRef(({className:e,...t},r)=>h.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:fr("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));sRe.displayName="SidebarMenuSub";const aRe=V.forwardRef(({...e},t)=>h.jsx("li",{ref:t,...e}));aRe.displayName="SidebarMenuSubItem";const oRe=V.forwardRef(({asChild:e=!1,size:t="md",isActive:r,className:n,...s},o)=>{const d=e?Wv:"a";return h.jsx(d,{ref:o,"data-sidebar":"menu-sub-button","data-size":t,"data-active":r,className:fr("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...s})});oRe.displayName="SidebarMenuSubButton";const lRe=()=>{const{t:e}=ei(),{state:t}=B2(),{isAdmin:r}=_c(),s=Qh().pathname,d=[{title:e("admin.dashboard"),url:"/admin",icon:O_e,allowedRoles:["admin","supervisor"]},{title:e("admin.users"),url:"/admin/users",icon:Bc,allowedRoles:["admin","supervisor"]},{title:e("admin.restaurants"),url:"/admin/restaurants",icon:ob,allowedRoles:["admin","supervisor"]},{title:e("admin.activities"),url:"/admin/activities",icon:yo,allowedRoles:["admin"]},{title:"",url:"/admin/coupons",icon:oT,allowedRoles:["admin"]},{title:"",url:"/admin/activity-requests",icon:P3,allowedRoles:["admin"]},{title:"",url:"/admin/homepage",icon:CQ,allowedRoles:["admin"]},{title:e("admin.reports"),url:"/admin/reports",icon:tP,allowedRoles:["admin"]},{title:e("joinUs.adminTitle"),url:"/admin/join-requests",icon:Mo,allowedRoles:["admin"]},{title:e("admin.logs"),url:"/admin/logs",icon:ab,allowedRoles:["admin"]}].filter(m=>r||m.allowedRoles.includes("supervisor")),i=m=>m==="/admin"?s===m:s.startsWith(m);return h.jsx(hoe,{className:t==="collapsed"?"w-14":"w-60",children:h.jsx(poe,{children:h.jsxs(moe,{children:[h.jsx(goe,{className:t==="collapsed"?"text-center":"",children:t==="collapsed"?h.jsx(kQ,{className:"h-4 w-4"}):e("admin.management")}),h.jsx(yoe,{children:h.jsx(voe,{className:"mt-[30px]",children:d.map(m=>h.jsx(_oe,{children:h.jsx(xoe,{asChild:!0,isActive:i(m.url),children:h.jsxs(Hi,{to:m.url,children:[h.jsx(m.icon,{className:"h-4 w-4"}),t!=="collapsed"&&h.jsx("span",{children:m.title})]})})},m.url))})})]})})})},ml=({children:e})=>{const{t}=ei(),{user:r}=Qn(),{isAdmin:n,isSupervisor:s,isLoading:o}=_c();return o?h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsx("div",{className:"text-center",children:t("common.loading")})}):!r||!n&&!s?h.jsx(c1e,{to:"/",replace:!0}):h.jsx(doe,{children:h.jsxs("div",{className:"min-h-screen flex flex-col w-full",children:[h.jsx("header",{className:"h-14 flex items-center border-b bg-background px-4 sticky top-0 z-10",children:h.jsx(foe,{})}),h.jsxs("div",{className:"flex flex-1 w-full",children:[h.jsx(lRe,{}),h.jsx("main",{className:"flex-1 p-3 md:p-6 bg-secondary/20 overflow-x-hidden",children:h.jsx("div",{className:"max-w-full overflow-x-hidden",children:e})})]})]})})};var cRe=Array.isArray,Yc=cRe,uRe=typeof $c=="object"&&$c&&$c.Object===Object&&$c,boe=uRe,dRe=boe,hRe=typeof self=="object"&&self&&self.Object===Object&&self,fRe=dRe||hRe||Function("return this")(),rf=fRe,pRe=rf,mRe=pRe.Symbol,$2=mRe,fW=$2,woe=Object.prototype,gRe=woe.hasOwnProperty,yRe=woe.toString,WS=fW?fW.toStringTag:void 0;function vRe(e){var t=gRe.call(e,WS),r=e[WS];try{e[WS]=void 0;var n=!0}catch{}var s=yRe.call(e);return n&&(t?e[WS]=r:delete e[WS]),s}var _Re=vRe,xRe=Object.prototype,bRe=xRe.toString;function wRe(e){return bRe.call(e)}var SRe=wRe,pW=$2,ERe=_Re,TRe=SRe,ARe="[object Null]",CRe="[object Undefined]",mW=pW?pW.toStringTag:void 0;function jRe(e){return e==null?e===void 0?CRe:ARe:mW&&mW in Object(e)?ERe(e):TRe(e)}var vp=jRe;function PRe(e){return e!=null&&typeof e=="object"}var _p=PRe,ORe=vp,kRe=_p,NRe="[object Symbol]";function IRe(e){return typeof e=="symbol"||kRe(e)&&ORe(e)==NRe}var fw=IRe,RRe=Yc,MRe=fw,DRe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,LRe=/^\w*$/;function FRe(e,t){if(RRe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||MRe(e)?!0:LRe.test(e)||!DRe.test(e)||t!=null&&e in Object(t)}var n$=FRe;function zRe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Pg=zRe;const pw=Ps(Pg);var BRe=vp,$Re=Pg,URe="[object AsyncFunction]",VRe="[object Function]",qRe="[object GeneratorFunction]",HRe="[object Proxy]";function GRe(e){if(!$Re(e))return!1;var t=BRe(e);return t==VRe||t==qRe||t==URe||t==HRe}var i$=GRe;const vi=Ps(i$);var WRe=rf,KRe=WRe["__core-js_shared__"],ZRe=KRe,tL=ZRe,gW=function(){var e=/[^.]+$/.exec(tL&&tL.keys&&tL.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function XRe(e){return!!gW&&gW in e}var YRe=XRe,JRe=Function.prototype,QRe=JRe.toString;function eMe(e){if(e!=null){try{return QRe.call(e)}catch{}try{return e+""}catch{}}return""}var Soe=eMe,tMe=i$,rMe=YRe,nMe=Pg,iMe=Soe,sMe=/[\\^$.*+?()[\]{}|]/g,aMe=/^\[object .+?Constructor\]$/,oMe=Function.prototype,lMe=Object.prototype,cMe=oMe.toString,uMe=lMe.hasOwnProperty,dMe=RegExp("^"+cMe.call(uMe).replace(sMe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function hMe(e){if(!nMe(e)||rMe(e))return!1;var t=tMe(e)?dMe:aMe;return t.test(iMe(e))}var fMe=hMe;function pMe(e,t){return e==null?void 0:e[t]}var mMe=pMe,gMe=fMe,yMe=mMe;function vMe(e,t){var r=yMe(e,t);return gMe(r)?r:void 0}var n_=vMe,_Me=n_,xMe=_Me(Object,"create"),ZN=xMe,yW=ZN;function bMe(){this.__data__=yW?yW(null):{},this.size=0}var wMe=bMe;function SMe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var EMe=SMe,TMe=ZN,AMe="__lodash_hash_undefined__",CMe=Object.prototype,jMe=CMe.hasOwnProperty;function PMe(e){var t=this.__data__;if(TMe){var r=t[e];return r===AMe?void 0:r}return jMe.call(t,e)?t[e]:void 0}var OMe=PMe,kMe=ZN,NMe=Object.prototype,IMe=NMe.hasOwnProperty;function RMe(e){var t=this.__data__;return kMe?t[e]!==void 0:IMe.call(t,e)}var MMe=RMe,DMe=ZN,LMe="__lodash_hash_undefined__";function FMe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=DMe&&t===void 0?LMe:t,this}var zMe=FMe,BMe=wMe,$Me=EMe,UMe=OMe,VMe=MMe,qMe=zMe;function mw(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}mw.prototype.clear=BMe;mw.prototype.delete=$Me;mw.prototype.get=UMe;mw.prototype.has=VMe;mw.prototype.set=qMe;var HMe=mw;function GMe(){this.__data__=[],this.size=0}var WMe=GMe;function KMe(e,t){return e===t||e!==e&&t!==t}var s$=KMe,ZMe=s$;function XMe(e,t){for(var r=e.length;r--;)if(ZMe(e[r][0],t))return r;return-1}var XN=XMe,YMe=XN,JMe=Array.prototype,QMe=JMe.splice;function eDe(e){var t=this.__data__,r=YMe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():QMe.call(t,r,1),--this.size,!0}var tDe=eDe,rDe=XN;function nDe(e){var t=this.__data__,r=rDe(t,e);return r<0?void 0:t[r][1]}var iDe=nDe,sDe=XN;function aDe(e){return sDe(this.__data__,e)>-1}var oDe=aDe,lDe=XN;function cDe(e,t){var r=this.__data__,n=lDe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var uDe=cDe,dDe=WMe,hDe=tDe,fDe=iDe,pDe=oDe,mDe=uDe;function gw(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}gw.prototype.clear=dDe;gw.prototype.delete=hDe;gw.prototype.get=fDe;gw.prototype.has=pDe;gw.prototype.set=mDe;var YN=gw,gDe=n_,yDe=rf,vDe=gDe(yDe,"Map"),a$=vDe,vW=HMe,_De=YN,xDe=a$;function bDe(){this.size=0,this.__data__={hash:new vW,map:new(xDe||_De),string:new vW}}var wDe=bDe;function SDe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var EDe=SDe,TDe=EDe;function ADe(e,t){var r=e.__data__;return TDe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var JN=ADe,CDe=JN;function jDe(e){var t=CDe(this,e).delete(e);return this.size-=t?1:0,t}var PDe=jDe,ODe=JN;function kDe(e){return ODe(this,e).get(e)}var NDe=kDe,IDe=JN;function RDe(e){return IDe(this,e).has(e)}var MDe=RDe,DDe=JN;function LDe(e,t){var r=DDe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var FDe=LDe,zDe=wDe,BDe=PDe,$De=NDe,UDe=MDe,VDe=FDe;function yw(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}yw.prototype.clear=zDe;yw.prototype.delete=BDe;yw.prototype.get=$De;yw.prototype.has=UDe;yw.prototype.set=VDe;var o$=yw,Eoe=o$,qDe="Expected a function";function l$(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(qDe);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],o=r.cache;if(o.has(s))return o.get(s);var d=e.apply(this,n);return r.cache=o.set(s,d)||o,d};return r.cache=new(l$.Cache||Eoe),r}l$.Cache=Eoe;var Toe=l$;const HDe=Ps(Toe);var GDe=Toe,WDe=500;function KDe(e){var t=GDe(e,function(n){return r.size===WDe&&r.clear(),n}),r=t.cache;return t}var ZDe=KDe,XDe=ZDe,YDe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,JDe=/\\(\\)?/g,QDe=XDe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(YDe,function(r,n,s,o){t.push(s?o.replace(JDe,"$1"):n||r)}),t}),eLe=QDe;function tLe(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var c$=tLe,_W=$2,rLe=c$,nLe=Yc,iLe=fw,sLe=1/0,xW=_W?_W.prototype:void 0,bW=xW?xW.toString:void 0;function Aoe(e){if(typeof e=="string")return e;if(nLe(e))return rLe(e,Aoe)+"";if(iLe(e))return bW?bW.call(e):"";var t=e+"";return t=="0"&&1/e==-sLe?"-0":t}var aLe=Aoe,oLe=aLe;function lLe(e){return e==null?"":oLe(e)}var Coe=lLe,cLe=Yc,uLe=n$,dLe=eLe,hLe=Coe;function fLe(e,t){return cLe(e)?e:uLe(e,t)?[e]:dLe(hLe(e))}var joe=fLe,pLe=fw,mLe=1/0;function gLe(e){if(typeof e=="string"||pLe(e))return e;var t=e+"";return t=="0"&&1/e==-mLe?"-0":t}var QN=gLe,yLe=joe,vLe=QN;function _Le(e,t){t=yLe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[vLe(t[r++])];return r&&r==n?e:void 0}var u$=_Le,xLe=u$;function bLe(e,t,r){var n=e==null?void 0:xLe(e,t);return n===void 0?r:n}var Poe=bLe;const _u=Ps(Poe);function wLe(e){return e==null}var SLe=wLe;const Oi=Ps(SLe);var ELe=vp,TLe=Yc,ALe=_p,CLe="[object String]";function jLe(e){return typeof e=="string"||!TLe(e)&&ALe(e)&&ELe(e)==CLe}var PLe=jLe;const zv=Ps(PLe);var Ooe={exports:{}},Hs={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d$=Symbol.for("react.element"),h$=Symbol.for("react.portal"),eI=Symbol.for("react.fragment"),tI=Symbol.for("react.strict_mode"),rI=Symbol.for("react.profiler"),nI=Symbol.for("react.provider"),iI=Symbol.for("react.context"),OLe=Symbol.for("react.server_context"),sI=Symbol.for("react.forward_ref"),aI=Symbol.for("react.suspense"),oI=Symbol.for("react.suspense_list"),lI=Symbol.for("react.memo"),cI=Symbol.for("react.lazy"),kLe=Symbol.for("react.offscreen"),koe;koe=Symbol.for("react.module.reference");function td(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case d$:switch(e=e.type,e){case eI:case rI:case tI:case aI:case oI:return e;default:switch(e=e&&e.$$typeof,e){case OLe:case iI:case sI:case cI:case lI:case nI:return e;default:return t}}case h$:return t}}}Hs.ContextConsumer=iI;Hs.ContextProvider=nI;Hs.Element=d$;Hs.ForwardRef=sI;Hs.Fragment=eI;Hs.Lazy=cI;Hs.Memo=lI;Hs.Portal=h$;Hs.Profiler=rI;Hs.StrictMode=tI;Hs.Suspense=aI;Hs.SuspenseList=oI;Hs.isAsyncMode=function(){return!1};Hs.isConcurrentMode=function(){return!1};Hs.isContextConsumer=function(e){return td(e)===iI};Hs.isContextProvider=function(e){return td(e)===nI};Hs.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===d$};Hs.isForwardRef=function(e){return td(e)===sI};Hs.isFragment=function(e){return td(e)===eI};Hs.isLazy=function(e){return td(e)===cI};Hs.isMemo=function(e){return td(e)===lI};Hs.isPortal=function(e){return td(e)===h$};Hs.isProfiler=function(e){return td(e)===rI};Hs.isStrictMode=function(e){return td(e)===tI};Hs.isSuspense=function(e){return td(e)===aI};Hs.isSuspenseList=function(e){return td(e)===oI};Hs.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===eI||e===rI||e===tI||e===aI||e===oI||e===kLe||typeof e=="object"&&e!==null&&(e.$$typeof===cI||e.$$typeof===lI||e.$$typeof===nI||e.$$typeof===iI||e.$$typeof===sI||e.$$typeof===koe||e.getModuleId!==void 0)};Hs.typeOf=td;Ooe.exports=Hs;var NLe=Ooe.exports,ILe=vp,RLe=_p,MLe="[object Number]";function DLe(e){return typeof e=="number"||RLe(e)&&ILe(e)==MLe}var Noe=DLe;const LLe=Ps(Noe);var FLe=Noe;function zLe(e){return FLe(e)&&e!=+e}var BLe=zLe;const U2=Ps(BLe);var hc=function(t){return t===0?0:t>0?1:-1},tv=function(t){return zv(t)&&t.indexOf("%")===t.length-1},Gr=function(t){return LLe(t)&&!U2(t)},$Le=function(t){return Oi(t)},el=function(t){return Gr(t)||zv(t)},ULe=0,vw=function(t){var r=++ULe;return"".concat(t||"").concat(r)},fc=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Gr(t)&&!zv(t))return n;var o;if(tv(t)){var d=t.indexOf("%");o=r*parseFloat(t.slice(0,d))/100}else o=+t;return U2(o)&&(o=n),s&&o>r&&(o=r),o},Im=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},VLe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},s=0;s<r;s++)if(!n[t[s]])n[t[s]]=!0;else return!0;return!1},du=function(t,r){return Gr(t)&&Gr(r)?function(n){return t+n*(r-t)}:function(){return r}};function kO(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):_u(n,t))===r})}var qLe=function(t,r){return Gr(t)&&Gr(r)?t-r:zv(t)&&zv(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function F0(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function HF(e){"@babel/helpers - typeof";return HF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HF(e)}var HLe=["viewBox","children"],GLe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],wW=["points","pathLength"],rL={svg:HLe,polygon:wW,polyline:wW},f$=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],NO=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(V.isValidElement(t)&&(n=t.props),!pw(n))return null;var s={};return Object.keys(n).forEach(function(o){f$.includes(o)&&(s[o]=r||function(d){return n[o](n,d)})}),s},WLe=function(t,r,n){return function(s){return t(r,n,s),null}},Bv=function(t,r,n){if(!pw(t)||HF(t)!=="object")return null;var s=null;return Object.keys(t).forEach(function(o){var d=t[o];f$.includes(o)&&typeof d=="function"&&(s||(s={}),s[o]=WLe(d,r,n))}),s},KLe=["children"],ZLe=["children"];function SW(e,t){if(e==null)return{};var r=XLe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function XLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function GF(e){"@babel/helpers - typeof";return GF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},GF(e)}var EW={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Yf=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},TW=null,nL=null,p$=function e(t){if(t===TW&&Array.isArray(nL))return nL;var r=[];return V.Children.forEach(t,function(n){Oi(n)||(NLe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),nL=r,TW=t,r};function xu(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(s){return Yf(s)}):n=[Yf(t)],p$(e).forEach(function(s){var o=_u(s,"type.displayName")||_u(s,"type.name");n.indexOf(o)!==-1&&r.push(s)}),r}function lu(e,t){var r=xu(e,t);return r&&r[0]}var AW=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,s=r.height;return!(!Gr(n)||n<=0||!Gr(s)||s<=0)},YLe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],JLe=function(t){return t&&t.type&&zv(t.type)&&YLe.indexOf(t.type)>=0},QLe=function(t){return t&&GF(t)==="object"&&"clipDot"in t},e3e=function(t,r,n,s){var o,d=(o=rL==null?void 0:rL[s])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!vi(t)&&(s&&d.includes(r)||GLe.includes(r))||n&&f$.includes(r)},Jn=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var s=t;if(V.isValidElement(t)&&(s=t.props),!pw(s))return null;var o={};return Object.keys(s).forEach(function(d){var i;e3e((i=s)===null||i===void 0?void 0:i[d],d,r,n)&&(o[d]=s[d])}),o},WF=function e(t,r){if(t===r)return!0;var n=V.Children.count(t);if(n!==V.Children.count(r))return!1;if(n===0)return!0;if(n===1)return CW(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var s=0;s<n;s++){var o=t[s],d=r[s];if(Array.isArray(o)||Array.isArray(d)){if(!e(o,d))return!1}else if(!CW(o,d))return!1}return!0},CW=function(t,r){if(Oi(t)&&Oi(r))return!0;if(!Oi(t)&&!Oi(r)){var n=t.props||{},s=n.children,o=SW(n,KLe),d=r.props||{},i=d.children,m=SW(d,ZLe);return s&&i?F0(o,m)&&WF(s,i):!s&&!i?F0(o,m):!1}return!1},jW=function(t,r){var n=[],s={};return p$(t).forEach(function(o,d){if(JLe(o))n.push(o);else if(o){var i=Yf(o.type),m=r[i]||{},y=m.handler,S=m.once;if(y&&(!S||!s[i])){var w=y(o,i,d);n.push(w),s[i]=!0}}}),n},t3e=function(t){var r=t&&t.type;return r&&EW[r]?EW[r]:null},r3e=function(t,r){return p$(r).indexOf(t)},n3e=["children","width","height","viewBox","className","style","title","desc"];function KF(){return KF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KF.apply(this,arguments)}function i3e(e,t){if(e==null)return{};var r=s3e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function s3e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function ZF(e){var t=e.children,r=e.width,n=e.height,s=e.viewBox,o=e.className,d=e.style,i=e.title,m=e.desc,y=i3e(e,n3e),S=s||{width:r,height:n,x:0,y:0},w=Ni("recharts-surface",o);return Ve.createElement("svg",KF({},Jn(y,!0,"svg"),{className:w,width:r,height:n,style:d,viewBox:"".concat(S.x," ").concat(S.y," ").concat(S.width," ").concat(S.height)}),Ve.createElement("title",null,i),Ve.createElement("desc",null,m),t)}var a3e=["children","className"];function XF(){return XF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},XF.apply(this,arguments)}function o3e(e,t){if(e==null)return{};var r=l3e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function l3e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Cs=Ve.forwardRef(function(e,t){var r=e.children,n=e.className,s=o3e(e,a3e),o=Ni("recharts-layer",n);return Ve.createElement("g",XF({className:o},Jn(s,!0),{ref:t}),r)}),Vd=function(t,r){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o]};function c3e(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),r=r>s?s:r,r<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(s);++n<s;)o[n]=e[n+t];return o}var u3e=c3e,d3e=u3e;function h3e(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:d3e(e,t,r)}var f3e=h3e,p3e="\\ud800-\\udfff",m3e="\\u0300-\\u036f",g3e="\\ufe20-\\ufe2f",y3e="\\u20d0-\\u20ff",v3e=m3e+g3e+y3e,_3e="\\ufe0e\\ufe0f",x3e="\\u200d",b3e=RegExp("["+x3e+p3e+v3e+_3e+"]");function w3e(e){return b3e.test(e)}var Ioe=w3e;function S3e(e){return e.split("")}var E3e=S3e,Roe="\\ud800-\\udfff",T3e="\\u0300-\\u036f",A3e="\\ufe20-\\ufe2f",C3e="\\u20d0-\\u20ff",j3e=T3e+A3e+C3e,P3e="\\ufe0e\\ufe0f",O3e="["+Roe+"]",YF="["+j3e+"]",JF="\\ud83c[\\udffb-\\udfff]",k3e="(?:"+YF+"|"+JF+")",Moe="[^"+Roe+"]",Doe="(?:\\ud83c[\\udde6-\\uddff]){2}",Loe="[\\ud800-\\udbff][\\udc00-\\udfff]",N3e="\\u200d",Foe=k3e+"?",zoe="["+P3e+"]?",I3e="(?:"+N3e+"(?:"+[Moe,Doe,Loe].join("|")+")"+zoe+Foe+")*",R3e=zoe+Foe+I3e,M3e="(?:"+[Moe+YF+"?",YF,Doe,Loe,O3e].join("|")+")",D3e=RegExp(JF+"(?="+JF+")|"+M3e+R3e,"g");function L3e(e){return e.match(D3e)||[]}var F3e=L3e,z3e=E3e,B3e=Ioe,$3e=F3e;function U3e(e){return B3e(e)?$3e(e):z3e(e)}var V3e=U3e,q3e=f3e,H3e=Ioe,G3e=V3e,W3e=Coe;function K3e(e){return function(t){t=W3e(t);var r=H3e(t)?G3e(t):void 0,n=r?r[0]:t.charAt(0),s=r?q3e(r,1).join(""):t.slice(1);return n[e]()+s}}var Z3e=K3e,X3e=Z3e,Y3e=X3e("toUpperCase"),J3e=Y3e;const uI=Ps(J3e);function na(e){return function(){return e}}const Boe=Math.cos,IO=Math.sin,Xd=Math.sqrt,RO=Math.PI,dI=2*RO,QF=Math.PI,ez=2*QF,Vy=1e-6,Q3e=ez-Vy;function $oe(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function eFe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return $oe;const r=10**t;return function(n){this._+=n[0];for(let s=1,o=n.length;s<o;++s)this._+=Math.round(arguments[s]*r)/r+n[s]}}class tFe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?$oe:eFe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,s){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+s}`}bezierCurveTo(t,r,n,s,o,d){this._append`C${+t},${+r},${+n},${+s},${this._x1=+o},${this._y1=+d}`}arcTo(t,r,n,s,o){if(t=+t,r=+r,n=+n,s=+s,o=+o,o<0)throw new Error(`negative radius: ${o}`);let d=this._x1,i=this._y1,m=n-t,y=s-r,S=d-t,w=i-r,T=S*S+w*w;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(T>Vy)if(!(Math.abs(w*m-y*S)>Vy)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let A=n-d,O=s-i,P=m*m+y*y,N=A*A+O*O,R=Math.sqrt(P),M=Math.sqrt(T),F=o*Math.tan((QF-Math.acos((P+T-N)/(2*R*M)))/2),B=F/M,$=F/R;Math.abs(B-1)>Vy&&this._append`L${t+B*S},${r+B*w}`,this._append`A${o},${o},0,0,${+(w*A>S*O)},${this._x1=t+$*m},${this._y1=r+$*y}`}}arc(t,r,n,s,o,d){if(t=+t,r=+r,n=+n,d=!!d,n<0)throw new Error(`negative radius: ${n}`);let i=n*Math.cos(s),m=n*Math.sin(s),y=t+i,S=r+m,w=1^d,T=d?s-o:o-s;this._x1===null?this._append`M${y},${S}`:(Math.abs(this._x1-y)>Vy||Math.abs(this._y1-S)>Vy)&&this._append`L${y},${S}`,n&&(T<0&&(T=T%ez+ez),T>Q3e?this._append`A${n},${n},0,1,${w},${t-i},${r-m}A${n},${n},0,1,${w},${this._x1=y},${this._y1=S}`:T>Vy&&this._append`A${n},${n},0,${+(T>=QF)},${w},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+s}h${-n}Z`}toString(){return this._}}function m$(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new tFe(t)}function g$(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Uoe(e){this._context=e}Uoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function hI(e){return new Uoe(e)}function Voe(e){return e[0]}function qoe(e){return e[1]}function Hoe(e,t){var r=na(!0),n=null,s=hI,o=null,d=m$(i);e=typeof e=="function"?e:e===void 0?Voe:na(e),t=typeof t=="function"?t:t===void 0?qoe:na(t);function i(m){var y,S=(m=g$(m)).length,w,T=!1,A;for(n==null&&(o=s(A=d())),y=0;y<=S;++y)!(y<S&&r(w=m[y],y,m))===T&&((T=!T)?o.lineStart():o.lineEnd()),T&&o.point(+e(w,y,m),+t(w,y,m));if(A)return o=null,A+""||null}return i.x=function(m){return arguments.length?(e=typeof m=="function"?m:na(+m),i):e},i.y=function(m){return arguments.length?(t=typeof m=="function"?m:na(+m),i):t},i.defined=function(m){return arguments.length?(r=typeof m=="function"?m:na(!!m),i):r},i.curve=function(m){return arguments.length?(s=m,n!=null&&(o=s(n)),i):s},i.context=function(m){return arguments.length?(m==null?n=o=null:o=s(n=m),i):n},i}function Cj(e,t,r){var n=null,s=na(!0),o=null,d=hI,i=null,m=m$(y);e=typeof e=="function"?e:e===void 0?Voe:na(+e),t=typeof t=="function"?t:na(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?qoe:na(+r);function y(w){var T,A,O,P=(w=g$(w)).length,N,R=!1,M,F=new Array(P),B=new Array(P);for(o==null&&(i=d(M=m())),T=0;T<=P;++T){if(!(T<P&&s(N=w[T],T,w))===R)if(R=!R)A=T,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),O=T-1;O>=A;--O)i.point(F[O],B[O]);i.lineEnd(),i.areaEnd()}R&&(F[T]=+e(N,T,w),B[T]=+t(N,T,w),i.point(n?+n(N,T,w):F[T],r?+r(N,T,w):B[T]))}if(M)return i=null,M+""||null}function S(){return Hoe().defined(s).curve(d).context(o)}return y.x=function(w){return arguments.length?(e=typeof w=="function"?w:na(+w),n=null,y):e},y.x0=function(w){return arguments.length?(e=typeof w=="function"?w:na(+w),y):e},y.x1=function(w){return arguments.length?(n=w==null?null:typeof w=="function"?w:na(+w),y):n},y.y=function(w){return arguments.length?(t=typeof w=="function"?w:na(+w),r=null,y):t},y.y0=function(w){return arguments.length?(t=typeof w=="function"?w:na(+w),y):t},y.y1=function(w){return arguments.length?(r=w==null?null:typeof w=="function"?w:na(+w),y):r},y.lineX0=y.lineY0=function(){return S().x(e).y(t)},y.lineY1=function(){return S().x(e).y(r)},y.lineX1=function(){return S().x(n).y(t)},y.defined=function(w){return arguments.length?(s=typeof w=="function"?w:na(!!w),y):s},y.curve=function(w){return arguments.length?(d=w,o!=null&&(i=d(o)),y):d},y.context=function(w){return arguments.length?(w==null?o=i=null:i=d(o=w),y):o},y}class Goe{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function rFe(e){return new Goe(e,!0)}function nFe(e){return new Goe(e,!1)}const y$={draw(e,t){const r=Xd(t/RO);e.moveTo(r,0),e.arc(0,0,r,0,dI)}},iFe={draw(e,t){const r=Xd(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},Woe=Xd(1/3),sFe=Woe*2,aFe={draw(e,t){const r=Xd(t/sFe),n=r*Woe;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},oFe={draw(e,t){const r=Xd(t),n=-r/2;e.rect(n,n,r,r)}},lFe=.8908130915292852,Koe=IO(RO/10)/IO(7*RO/10),cFe=IO(dI/10)*Koe,uFe=-Boe(dI/10)*Koe,dFe={draw(e,t){const r=Xd(t*lFe),n=cFe*r,s=uFe*r;e.moveTo(0,-r),e.lineTo(n,s);for(let o=1;o<5;++o){const d=dI*o/5,i=Boe(d),m=IO(d);e.lineTo(m*r,-i*r),e.lineTo(i*n-m*s,m*n+i*s)}e.closePath()}},iL=Xd(3),hFe={draw(e,t){const r=-Xd(t/(iL*3));e.moveTo(0,r*2),e.lineTo(-iL*r,-r),e.lineTo(iL*r,-r),e.closePath()}},Ru=-.5,Mu=Xd(3)/2,tz=1/Xd(12),fFe=(tz/2+1)*3,pFe={draw(e,t){const r=Xd(t/fFe),n=r/2,s=r*tz,o=n,d=r*tz+r,i=-o,m=d;e.moveTo(n,s),e.lineTo(o,d),e.lineTo(i,m),e.lineTo(Ru*n-Mu*s,Mu*n+Ru*s),e.lineTo(Ru*o-Mu*d,Mu*o+Ru*d),e.lineTo(Ru*i-Mu*m,Mu*i+Ru*m),e.lineTo(Ru*n+Mu*s,Ru*s-Mu*n),e.lineTo(Ru*o+Mu*d,Ru*d-Mu*o),e.lineTo(Ru*i+Mu*m,Ru*m-Mu*i),e.closePath()}};function mFe(e,t){let r=null,n=m$(s);e=typeof e=="function"?e:na(e||y$),t=typeof t=="function"?t:na(t===void 0?64:+t);function s(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return s.type=function(o){return arguments.length?(e=typeof o=="function"?o:na(o),s):e},s.size=function(o){return arguments.length?(t=typeof o=="function"?o:na(+o),s):t},s.context=function(o){return arguments.length?(r=o??null,s):r},s}function MO(){}function DO(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function Zoe(e){this._context=e}Zoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:DO(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:DO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function gFe(e){return new Zoe(e)}function Xoe(e){this._context=e}Xoe.prototype={areaStart:MO,areaEnd:MO,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:DO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function yFe(e){return new Xoe(e)}function Yoe(e){this._context=e}Yoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:DO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function vFe(e){return new Yoe(e)}function Joe(e){this._context=e}Joe.prototype={areaStart:MO,areaEnd:MO,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function _Fe(e){return new Joe(e)}function PW(e){return e<0?-1:1}function OW(e,t,r){var n=e._x1-e._x0,s=t-e._x1,o=(e._y1-e._y0)/(n||s<0&&-0),d=(r-e._y1)/(s||n<0&&-0),i=(o*s+d*n)/(n+s);return(PW(o)+PW(d))*Math.min(Math.abs(o),Math.abs(d),.5*Math.abs(i))||0}function kW(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function sL(e,t,r){var n=e._x0,s=e._y0,o=e._x1,d=e._y1,i=(o-n)/3;e._context.bezierCurveTo(n+i,s+i*t,o-i,d-i*r,o,d)}function LO(e){this._context=e}LO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:sL(this,this._t0,kW(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,sL(this,kW(this,r=OW(this,e,t)),r);break;default:sL(this,this._t0,r=OW(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function Qoe(e){this._context=new ele(e)}(Qoe.prototype=Object.create(LO.prototype)).point=function(e,t){LO.prototype.point.call(this,t,e)};function ele(e){this._context=e}ele.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,s,o){this._context.bezierCurveTo(t,e,n,r,o,s)}};function xFe(e){return new LO(e)}function bFe(e){return new Qoe(e)}function tle(e){this._context=e}tle.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=NW(e),s=NW(t),o=0,d=1;d<r;++o,++d)this._context.bezierCurveTo(n[0][o],s[0][o],n[1][o],s[1][o],e[d],t[d]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function NW(e){var t,r=e.length-1,n,s=new Array(r),o=new Array(r),d=new Array(r);for(s[0]=0,o[0]=2,d[0]=e[0]+2*e[1],t=1;t<r-1;++t)s[t]=1,o[t]=4,d[t]=4*e[t]+2*e[t+1];for(s[r-1]=2,o[r-1]=7,d[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=s[t]/o[t-1],o[t]-=n,d[t]-=n*d[t-1];for(s[r-1]=d[r-1]/o[r-1],t=r-2;t>=0;--t)s[t]=(d[t]-s[t+1])/o[t];for(o[r-1]=(e[r]+s[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-s[t+1];return[s,o]}function wFe(e){return new tle(e)}function fI(e,t){this._context=e,this._t=t}fI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function SFe(e){return new fI(e,.5)}function EFe(e){return new fI(e,0)}function TFe(e){return new fI(e,1)}function Ab(e,t){if((d=e.length)>1)for(var r=1,n,s,o=e[t[0]],d,i=o.length;r<d;++r)for(s=o,o=e[t[r]],n=0;n<i;++n)o[n][1]+=o[n][0]=isNaN(s[n][1])?s[n][0]:s[n][1]}function rz(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function AFe(e,t){return e[t]}function CFe(e){const t=[];return t.key=e,t}function jFe(){var e=na([]),t=rz,r=Ab,n=AFe;function s(o){var d=Array.from(e.apply(this,arguments),CFe),i,m=d.length,y=-1,S;for(const w of o)for(i=0,++y;i<m;++i)(d[i][y]=[0,+n(w,d[i].key,y,o)]).data=w;for(i=0,S=g$(t(d));i<m;++i)d[S[i]].index=i;return r(d,S),d}return s.keys=function(o){return arguments.length?(e=typeof o=="function"?o:na(Array.from(o)),s):e},s.value=function(o){return arguments.length?(n=typeof o=="function"?o:na(+o),s):n},s.order=function(o){return arguments.length?(t=o==null?rz:typeof o=="function"?o:na(Array.from(o)),s):t},s.offset=function(o){return arguments.length?(r=o??Ab,s):r},s}function PFe(e,t){if((n=e.length)>0){for(var r,n,s=0,o=e[0].length,d;s<o;++s){for(d=r=0;r<n;++r)d+=e[r][s][1]||0;if(d)for(r=0;r<n;++r)e[r][s][1]/=d}Ab(e,t)}}function OFe(e,t){if((s=e.length)>0){for(var r=0,n=e[t[0]],s,o=n.length;r<o;++r){for(var d=0,i=0;d<s;++d)i+=e[d][r][1]||0;n[r][1]+=n[r][0]=-i/2}Ab(e,t)}}function kFe(e,t){if(!(!((d=e.length)>0)||!((o=(s=e[t[0]]).length)>0))){for(var r=0,n=1,s,o,d;n<o;++n){for(var i=0,m=0,y=0;i<d;++i){for(var S=e[t[i]],w=S[n][1]||0,T=S[n-1][1]||0,A=(w-T)/2,O=0;O<i;++O){var P=e[t[O]],N=P[n][1]||0,R=P[n-1][1]||0;A+=N-R}m+=w,y+=A*w}s[n-1][1]+=s[n-1][0]=r,m&&(r-=y/m)}s[n-1][1]+=s[n-1][0]=r,Ab(e,t)}}function AT(e){"@babel/helpers - typeof";return AT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},AT(e)}var NFe=["type","size","sizeType"];function nz(){return nz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nz.apply(this,arguments)}function IW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function RW(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IW(Object(r),!0).forEach(function(n){IFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IW(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function IFe(e,t,r){return t=RFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RFe(e){var t=MFe(e,"string");return AT(t)=="symbol"?t:t+""}function MFe(e,t){if(AT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(AT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function DFe(e,t){if(e==null)return{};var r=LFe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function LFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var rle={symbolCircle:y$,symbolCross:iFe,symbolDiamond:aFe,symbolSquare:oFe,symbolStar:dFe,symbolTriangle:hFe,symbolWye:pFe},FFe=Math.PI/180,zFe=function(t){var r="symbol".concat(uI(t));return rle[r]||y$},BFe=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var s=18*FFe;return 1.25*t*t*(Math.tan(s)-Math.tan(s*2)*Math.pow(Math.tan(s),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},$Fe=function(t,r){rle["symbol".concat(uI(t))]=r},v$=function(t){var r=t.type,n=r===void 0?"circle":r,s=t.size,o=s===void 0?64:s,d=t.sizeType,i=d===void 0?"area":d,m=DFe(t,NFe),y=RW(RW({},m),{},{type:n,size:o,sizeType:i}),S=function(){var N=zFe(n),R=mFe().type(N).size(BFe(o,i,n));return R()},w=y.className,T=y.cx,A=y.cy,O=Jn(y,!0);return T===+T&&A===+A&&o===+o?Ve.createElement("path",nz({},O,{className:Ni("recharts-symbols",w),transform:"translate(".concat(T,", ").concat(A,")"),d:S()})):null};v$.registerSymbol=$Fe;function Cb(e){"@babel/helpers - typeof";return Cb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cb(e)}function iz(){return iz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iz.apply(this,arguments)}function MW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function UFe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MW(Object(r),!0).forEach(function(n){CT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MW(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VFe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qFe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ile(n.key),n)}}function HFe(e,t,r){return t&&qFe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function GFe(e,t,r){return t=FO(t),WFe(e,nle()?Reflect.construct(t,r||[],FO(e).constructor):t.apply(e,r))}function WFe(e,t){if(t&&(Cb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KFe(e)}function KFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nle=function(){return!!e})()}function FO(e){return FO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},FO(e)}function ZFe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sz(e,t)}function sz(e,t){return sz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},sz(e,t)}function CT(e,t,r){return t=ile(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ile(e){var t=XFe(e,"string");return Cb(t)=="symbol"?t:t+""}function XFe(e,t){if(Cb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Cb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Du=32,_$=function(e){function t(){return VFe(this,t),GFe(this,t,arguments)}return ZFe(t,e),HFe(t,[{key:"renderIcon",value:function(n){var s=this.props.inactiveColor,o=Du/2,d=Du/6,i=Du/3,m=n.inactive?s:n.color;if(n.type==="plainline")return Ve.createElement("line",{strokeWidth:4,fill:"none",stroke:m,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Du,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ve.createElement("path",{strokeWidth:4,fill:"none",stroke:m,d:"M0,".concat(o,"h").concat(i,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(2*i,",").concat(o,`
            H`).concat(Du,"M").concat(2*i,",").concat(o,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(i,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ve.createElement("path",{stroke:"none",fill:m,d:"M0,".concat(Du/8,"h").concat(Du,"v").concat(Du*3/4,"h").concat(-Du,"z"),className:"recharts-legend-icon"});if(Ve.isValidElement(n.legendIcon)){var y=UFe({},n);return delete y.legendIcon,Ve.cloneElement(n.legendIcon,y)}return Ve.createElement(v$,{fill:m,cx:o,cy:o,size:Du,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,s=this.props,o=s.payload,d=s.iconSize,i=s.layout,m=s.formatter,y=s.inactiveColor,S={x:0,y:0,width:Du,height:Du},w={display:i==="horizontal"?"inline-block":"block",marginRight:10},T={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(A,O){var P=A.formatter||m,N=Ni(CT(CT({"recharts-legend-item":!0},"legend-item-".concat(O),!0),"inactive",A.inactive));if(A.type==="none")return null;var R=vi(A.value)?null:A.value;Vd(!vi(A.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var M=A.inactive?y:A.color;return Ve.createElement("li",iz({className:N,style:w,key:"legend-item-".concat(O)},Bv(n.props,A,O)),Ve.createElement(ZF,{width:d,height:d,viewBox:S,style:T},n.renderIcon(A)),Ve.createElement("span",{className:"recharts-legend-item-text",style:{color:M}},P?P(R,A,O):R))})}},{key:"render",value:function(){var n=this.props,s=n.payload,o=n.layout,d=n.align;if(!s||!s.length)return null;var i={padding:0,margin:0,textAlign:o==="horizontal"?d:"left"};return Ve.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(V.PureComponent);CT(_$,"displayName","Legend");CT(_$,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var YFe=YN;function JFe(){this.__data__=new YFe,this.size=0}var QFe=JFe;function eze(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var tze=eze;function rze(e){return this.__data__.get(e)}var nze=rze;function ize(e){return this.__data__.has(e)}var sze=ize,aze=YN,oze=a$,lze=o$,cze=200;function uze(e,t){var r=this.__data__;if(r instanceof aze){var n=r.__data__;if(!oze||n.length<cze-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new lze(n)}return r.set(e,t),this.size=r.size,this}var dze=uze,hze=YN,fze=QFe,pze=tze,mze=nze,gze=sze,yze=dze;function _w(e){var t=this.__data__=new hze(e);this.size=t.size}_w.prototype.clear=fze;_w.prototype.delete=pze;_w.prototype.get=mze;_w.prototype.has=gze;_w.prototype.set=yze;var sle=_w,vze="__lodash_hash_undefined__";function _ze(e){return this.__data__.set(e,vze),this}var xze=_ze;function bze(e){return this.__data__.has(e)}var wze=bze,Sze=o$,Eze=xze,Tze=wze;function zO(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Sze;++t<r;)this.add(e[t])}zO.prototype.add=zO.prototype.push=Eze;zO.prototype.has=Tze;var ale=zO;function Aze(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var ole=Aze;function Cze(e,t){return e.has(t)}var lle=Cze,jze=ale,Pze=ole,Oze=lle,kze=1,Nze=2;function Ize(e,t,r,n,s,o){var d=r&kze,i=e.length,m=t.length;if(i!=m&&!(d&&m>i))return!1;var y=o.get(e),S=o.get(t);if(y&&S)return y==t&&S==e;var w=-1,T=!0,A=r&Nze?new jze:void 0;for(o.set(e,t),o.set(t,e);++w<i;){var O=e[w],P=t[w];if(n)var N=d?n(P,O,w,t,e,o):n(O,P,w,e,t,o);if(N!==void 0){if(N)continue;T=!1;break}if(A){if(!Pze(t,function(R,M){if(!Oze(A,M)&&(O===R||s(O,R,r,n,o)))return A.push(M)})){T=!1;break}}else if(!(O===P||s(O,P,r,n,o))){T=!1;break}}return o.delete(e),o.delete(t),T}var cle=Ize,Rze=rf,Mze=Rze.Uint8Array,Dze=Mze;function Lze(e){var t=-1,r=Array(e.size);return e.forEach(function(n,s){r[++t]=[s,n]}),r}var Fze=Lze;function zze(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var x$=zze,DW=$2,LW=Dze,Bze=s$,$ze=cle,Uze=Fze,Vze=x$,qze=1,Hze=2,Gze="[object Boolean]",Wze="[object Date]",Kze="[object Error]",Zze="[object Map]",Xze="[object Number]",Yze="[object RegExp]",Jze="[object Set]",Qze="[object String]",e4e="[object Symbol]",t4e="[object ArrayBuffer]",r4e="[object DataView]",FW=DW?DW.prototype:void 0,aL=FW?FW.valueOf:void 0;function n4e(e,t,r,n,s,o,d){switch(r){case r4e:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case t4e:return!(e.byteLength!=t.byteLength||!o(new LW(e),new LW(t)));case Gze:case Wze:case Xze:return Bze(+e,+t);case Kze:return e.name==t.name&&e.message==t.message;case Yze:case Qze:return e==t+"";case Zze:var i=Uze;case Jze:var m=n&qze;if(i||(i=Vze),e.size!=t.size&&!m)return!1;var y=d.get(e);if(y)return y==t;n|=Hze,d.set(e,t);var S=$ze(i(e),i(t),n,s,o,d);return d.delete(e),S;case e4e:if(aL)return aL.call(e)==aL.call(t)}return!1}var i4e=n4e;function s4e(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var ule=s4e,a4e=ule,o4e=Yc;function l4e(e,t,r){var n=t(e);return o4e(e)?n:a4e(n,r(e))}var c4e=l4e;function u4e(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var d=e[r];t(d,r,e)&&(o[s++]=d)}return o}var d4e=u4e;function h4e(){return[]}var f4e=h4e,p4e=d4e,m4e=f4e,g4e=Object.prototype,y4e=g4e.propertyIsEnumerable,zW=Object.getOwnPropertySymbols,v4e=zW?function(e){return e==null?[]:(e=Object(e),p4e(zW(e),function(t){return y4e.call(e,t)}))}:m4e,_4e=v4e;function x4e(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var b4e=x4e,w4e=vp,S4e=_p,E4e="[object Arguments]";function T4e(e){return S4e(e)&&w4e(e)==E4e}var A4e=T4e,BW=A4e,C4e=_p,dle=Object.prototype,j4e=dle.hasOwnProperty,P4e=dle.propertyIsEnumerable,O4e=BW(function(){return arguments}())?BW:function(e){return C4e(e)&&j4e.call(e,"callee")&&!P4e.call(e,"callee")},b$=O4e,BO={exports:{}};function k4e(){return!1}var N4e=k4e;BO.exports;(function(e,t){var r=rf,n=N4e,s=t&&!t.nodeType&&t,o=s&&!0&&e&&!e.nodeType&&e,d=o&&o.exports===s,i=d?r.Buffer:void 0,m=i?i.isBuffer:void 0,y=m||n;e.exports=y})(BO,BO.exports);var hle=BO.exports,I4e=9007199254740991,R4e=/^(?:0|[1-9]\d*)$/;function M4e(e,t){var r=typeof e;return t=t??I4e,!!t&&(r=="number"||r!="symbol"&&R4e.test(e))&&e>-1&&e%1==0&&e<t}var w$=M4e,D4e=9007199254740991;function L4e(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=D4e}var S$=L4e,F4e=vp,z4e=S$,B4e=_p,$4e="[object Arguments]",U4e="[object Array]",V4e="[object Boolean]",q4e="[object Date]",H4e="[object Error]",G4e="[object Function]",W4e="[object Map]",K4e="[object Number]",Z4e="[object Object]",X4e="[object RegExp]",Y4e="[object Set]",J4e="[object String]",Q4e="[object WeakMap]",eBe="[object ArrayBuffer]",tBe="[object DataView]",rBe="[object Float32Array]",nBe="[object Float64Array]",iBe="[object Int8Array]",sBe="[object Int16Array]",aBe="[object Int32Array]",oBe="[object Uint8Array]",lBe="[object Uint8ClampedArray]",cBe="[object Uint16Array]",uBe="[object Uint32Array]",fa={};fa[rBe]=fa[nBe]=fa[iBe]=fa[sBe]=fa[aBe]=fa[oBe]=fa[lBe]=fa[cBe]=fa[uBe]=!0;fa[$4e]=fa[U4e]=fa[eBe]=fa[V4e]=fa[tBe]=fa[q4e]=fa[H4e]=fa[G4e]=fa[W4e]=fa[K4e]=fa[Z4e]=fa[X4e]=fa[Y4e]=fa[J4e]=fa[Q4e]=!1;function dBe(e){return B4e(e)&&z4e(e.length)&&!!fa[F4e(e)]}var hBe=dBe;function fBe(e){return function(t){return e(t)}}var fle=fBe,$O={exports:{}};$O.exports;(function(e,t){var r=boe,n=t&&!t.nodeType&&t,s=n&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===n,d=o&&r.process,i=function(){try{var m=s&&s.require&&s.require("util").types;return m||d&&d.binding&&d.binding("util")}catch{}}();e.exports=i})($O,$O.exports);var pBe=$O.exports,mBe=hBe,gBe=fle,$W=pBe,UW=$W&&$W.isTypedArray,yBe=UW?gBe(UW):mBe,ple=yBe,vBe=b4e,_Be=b$,xBe=Yc,bBe=hle,wBe=w$,SBe=ple,EBe=Object.prototype,TBe=EBe.hasOwnProperty;function ABe(e,t){var r=xBe(e),n=!r&&_Be(e),s=!r&&!n&&bBe(e),o=!r&&!n&&!s&&SBe(e),d=r||n||s||o,i=d?vBe(e.length,String):[],m=i.length;for(var y in e)(t||TBe.call(e,y))&&!(d&&(y=="length"||s&&(y=="offset"||y=="parent")||o&&(y=="buffer"||y=="byteLength"||y=="byteOffset")||wBe(y,m)))&&i.push(y);return i}var CBe=ABe,jBe=Object.prototype;function PBe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||jBe;return e===r}var OBe=PBe;function kBe(e,t){return function(r){return e(t(r))}}var mle=kBe,NBe=mle,IBe=NBe(Object.keys,Object),RBe=IBe,MBe=OBe,DBe=RBe,LBe=Object.prototype,FBe=LBe.hasOwnProperty;function zBe(e){if(!MBe(e))return DBe(e);var t=[];for(var r in Object(e))FBe.call(e,r)&&r!="constructor"&&t.push(r);return t}var BBe=zBe,$Be=i$,UBe=S$;function VBe(e){return e!=null&&UBe(e.length)&&!$Be(e)}var V2=VBe,qBe=CBe,HBe=BBe,GBe=V2;function WBe(e){return GBe(e)?qBe(e):HBe(e)}var pI=WBe,KBe=c4e,ZBe=_4e,XBe=pI;function YBe(e){return KBe(e,XBe,ZBe)}var JBe=YBe,VW=JBe,QBe=1,e5e=Object.prototype,t5e=e5e.hasOwnProperty;function r5e(e,t,r,n,s,o){var d=r&QBe,i=VW(e),m=i.length,y=VW(t),S=y.length;if(m!=S&&!d)return!1;for(var w=m;w--;){var T=i[w];if(!(d?T in t:t5e.call(t,T)))return!1}var A=o.get(e),O=o.get(t);if(A&&O)return A==t&&O==e;var P=!0;o.set(e,t),o.set(t,e);for(var N=d;++w<m;){T=i[w];var R=e[T],M=t[T];if(n)var F=d?n(M,R,T,t,e,o):n(R,M,T,e,t,o);if(!(F===void 0?R===M||s(R,M,r,n,o):F)){P=!1;break}N||(N=T=="constructor")}if(P&&!N){var B=e.constructor,$=t.constructor;B!=$&&"constructor"in e&&"constructor"in t&&!(typeof B=="function"&&B instanceof B&&typeof $=="function"&&$ instanceof $)&&(P=!1)}return o.delete(e),o.delete(t),P}var n5e=r5e,i5e=n_,s5e=rf,a5e=i5e(s5e,"DataView"),o5e=a5e,l5e=n_,c5e=rf,u5e=l5e(c5e,"Promise"),d5e=u5e,h5e=n_,f5e=rf,p5e=h5e(f5e,"Set"),gle=p5e,m5e=n_,g5e=rf,y5e=m5e(g5e,"WeakMap"),v5e=y5e,az=o5e,oz=a$,lz=d5e,cz=gle,uz=v5e,yle=vp,xw=Soe,qW="[object Map]",_5e="[object Object]",HW="[object Promise]",GW="[object Set]",WW="[object WeakMap]",KW="[object DataView]",x5e=xw(az),b5e=xw(oz),w5e=xw(lz),S5e=xw(cz),E5e=xw(uz),qy=yle;(az&&qy(new az(new ArrayBuffer(1)))!=KW||oz&&qy(new oz)!=qW||lz&&qy(lz.resolve())!=HW||cz&&qy(new cz)!=GW||uz&&qy(new uz)!=WW)&&(qy=function(e){var t=yle(e),r=t==_5e?e.constructor:void 0,n=r?xw(r):"";if(n)switch(n){case x5e:return KW;case b5e:return qW;case w5e:return HW;case S5e:return GW;case E5e:return WW}return t});var T5e=qy,oL=sle,A5e=cle,C5e=i4e,j5e=n5e,ZW=T5e,XW=Yc,YW=hle,P5e=ple,O5e=1,JW="[object Arguments]",QW="[object Array]",jj="[object Object]",k5e=Object.prototype,e7=k5e.hasOwnProperty;function N5e(e,t,r,n,s,o){var d=XW(e),i=XW(t),m=d?QW:ZW(e),y=i?QW:ZW(t);m=m==JW?jj:m,y=y==JW?jj:y;var S=m==jj,w=y==jj,T=m==y;if(T&&YW(e)){if(!YW(t))return!1;d=!0,S=!1}if(T&&!S)return o||(o=new oL),d||P5e(e)?A5e(e,t,r,n,s,o):C5e(e,t,m,r,n,s,o);if(!(r&O5e)){var A=S&&e7.call(e,"__wrapped__"),O=w&&e7.call(t,"__wrapped__");if(A||O){var P=A?e.value():e,N=O?t.value():t;return o||(o=new oL),s(P,N,r,n,o)}}return T?(o||(o=new oL),j5e(e,t,r,n,s,o)):!1}var I5e=N5e,R5e=I5e,t7=_p;function vle(e,t,r,n,s){return e===t?!0:e==null||t==null||!t7(e)&&!t7(t)?e!==e&&t!==t:R5e(e,t,r,n,vle,s)}var E$=vle,M5e=sle,D5e=E$,L5e=1,F5e=2;function z5e(e,t,r,n){var s=r.length,o=s,d=!n;if(e==null)return!o;for(e=Object(e);s--;){var i=r[s];if(d&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++s<o;){i=r[s];var m=i[0],y=e[m],S=i[1];if(d&&i[2]){if(y===void 0&&!(m in e))return!1}else{var w=new M5e;if(n)var T=n(y,S,m,e,t,w);if(!(T===void 0?D5e(S,y,L5e|F5e,n,w):T))return!1}}return!0}var B5e=z5e,$5e=Pg;function U5e(e){return e===e&&!$5e(e)}var _le=U5e,V5e=_le,q5e=pI;function H5e(e){for(var t=q5e(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,V5e(s)]}return t}var G5e=H5e;function W5e(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var xle=W5e,K5e=B5e,Z5e=G5e,X5e=xle;function Y5e(e){var t=Z5e(e);return t.length==1&&t[0][2]?X5e(t[0][0],t[0][1]):function(r){return r===e||K5e(r,e,t)}}var J5e=Y5e;function Q5e(e,t){return e!=null&&t in Object(e)}var e$e=Q5e,t$e=joe,r$e=b$,n$e=Yc,i$e=w$,s$e=S$,a$e=QN;function o$e(e,t,r){t=t$e(t,e);for(var n=-1,s=t.length,o=!1;++n<s;){var d=a$e(t[n]);if(!(o=e!=null&&r(e,d)))break;e=e[d]}return o||++n!=s?o:(s=e==null?0:e.length,!!s&&s$e(s)&&i$e(d,s)&&(n$e(e)||r$e(e)))}var l$e=o$e,c$e=e$e,u$e=l$e;function d$e(e,t){return e!=null&&u$e(e,t,c$e)}var h$e=d$e,f$e=E$,p$e=Poe,m$e=h$e,g$e=n$,y$e=_le,v$e=xle,_$e=QN,x$e=1,b$e=2;function w$e(e,t){return g$e(e)&&y$e(t)?v$e(_$e(e),t):function(r){var n=p$e(r,e);return n===void 0&&n===t?m$e(r,e):f$e(t,n,x$e|b$e)}}var S$e=w$e;function E$e(e){return e}var bw=E$e;function T$e(e){return function(t){return t==null?void 0:t[e]}}var A$e=T$e,C$e=u$;function j$e(e){return function(t){return C$e(t,e)}}var P$e=j$e,O$e=A$e,k$e=P$e,N$e=n$,I$e=QN;function R$e(e){return N$e(e)?O$e(I$e(e)):k$e(e)}var M$e=R$e,D$e=J5e,L$e=S$e,F$e=bw,z$e=Yc,B$e=M$e;function $$e(e){return typeof e=="function"?e:e==null?F$e:typeof e=="object"?z$e(e)?L$e(e[0],e[1]):D$e(e):B$e(e)}var nf=$$e;function U$e(e,t,r,n){for(var s=e.length,o=r+(n?1:-1);n?o--:++o<s;)if(t(e[o],o,e))return o;return-1}var ble=U$e;function V$e(e){return e!==e}var q$e=V$e;function H$e(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}var G$e=H$e,W$e=ble,K$e=q$e,Z$e=G$e;function X$e(e,t,r){return t===t?Z$e(e,t,r):W$e(e,K$e,r)}var Y$e=X$e,J$e=Y$e;function Q$e(e,t){var r=e==null?0:e.length;return!!r&&J$e(e,t,0)>-1}var eUe=Q$e;function tUe(e,t,r){for(var n=-1,s=e==null?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}var rUe=tUe;function nUe(){}var iUe=nUe,lL=gle,sUe=iUe,aUe=x$,oUe=1/0,lUe=lL&&1/aUe(new lL([,-0]))[1]==oUe?function(e){return new lL(e)}:sUe,cUe=lUe,uUe=ale,dUe=eUe,hUe=rUe,fUe=lle,pUe=cUe,mUe=x$,gUe=200;function yUe(e,t,r){var n=-1,s=dUe,o=e.length,d=!0,i=[],m=i;if(r)d=!1,s=hUe;else if(o>=gUe){var y=t?null:pUe(e);if(y)return mUe(y);d=!1,s=fUe,m=new uUe}else m=t?[]:i;e:for(;++n<o;){var S=e[n],w=t?t(S):S;if(S=r||S!==0?S:0,d&&w===w){for(var T=m.length;T--;)if(m[T]===w)continue e;t&&m.push(w),i.push(S)}else s(m,w,r)||(m!==i&&m.push(w),i.push(S))}return i}var vUe=yUe,_Ue=nf,xUe=vUe;function bUe(e,t){return e&&e.length?xUe(e,_Ue(t)):[]}var wUe=bUe;const r7=Ps(wUe);function wle(e,t,r){return t===!0?r7(e,r):vi(t)?r7(e,t):e}function jb(e){"@babel/helpers - typeof";return jb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jb(e)}var SUe=["ref"];function n7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function kf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n7(Object(r),!0).forEach(function(n){mI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ele(n.key),n)}}function TUe(e,t,r){return t&&i7(e.prototype,t),r&&i7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function AUe(e,t,r){return t=UO(t),CUe(e,Sle()?Reflect.construct(t,r||[],UO(e).constructor):t.apply(e,r))}function CUe(e,t){if(t&&(jb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jUe(e)}function jUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Sle=function(){return!!e})()}function UO(e){return UO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},UO(e)}function PUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dz(e,t)}function dz(e,t){return dz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},dz(e,t)}function mI(e,t,r){return t=Ele(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ele(e){var t=OUe(e,"string");return jb(t)=="symbol"?t:t+""}function OUe(e,t){if(jb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(jb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function kUe(e,t){if(e==null)return{};var r=NUe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function NUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function IUe(e){return e.value}function RUe(e,t){if(Ve.isValidElement(e))return Ve.cloneElement(e,t);if(typeof e=="function")return Ve.createElement(e,t);t.ref;var r=kUe(t,SUe);return Ve.createElement(_$,r)}var s7=1,kh=function(e){function t(){var r;EUe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=AUe(this,t,[].concat(s)),mI(r,"lastBoundingBox",{width:-1,height:-1}),r}return PUe(t,e),TUe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,s=this.getBBox();s?(Math.abs(s.width-this.lastBoundingBox.width)>s7||Math.abs(s.height-this.lastBoundingBox.height)>s7)&&(this.lastBoundingBox.width=s.width,this.lastBoundingBox.height=s.height,n&&n(s)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?kf({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var s=this.props,o=s.layout,d=s.align,i=s.verticalAlign,m=s.margin,y=s.chartWidth,S=s.chartHeight,w,T;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(d==="center"&&o==="vertical"){var A=this.getBBoxSnapshot();w={left:((y||0)-A.width)/2}}else w=d==="right"?{right:m&&m.right||0}:{left:m&&m.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(i==="middle"){var O=this.getBBoxSnapshot();T={top:((S||0)-O.height)/2}}else T=i==="bottom"?{bottom:m&&m.bottom||0}:{top:m&&m.top||0};return kf(kf({},w),T)}},{key:"render",value:function(){var n=this,s=this.props,o=s.content,d=s.width,i=s.height,m=s.wrapperStyle,y=s.payloadUniqBy,S=s.payload,w=kf(kf({position:"absolute",width:d||"auto",height:i||"auto"},this.getDefaultPosition(m)),m);return Ve.createElement("div",{className:"recharts-legend-wrapper",style:w,ref:function(A){n.wrapperNode=A}},RUe(o,kf(kf({},this.props),{},{payload:wle(S,y,IUe)})))}}],[{key:"getWithHeight",value:function(n,s){var o=kf(kf({},this.defaultProps),n.props),d=o.layout;return d==="vertical"&&Gr(n.props.height)?{height:n.props.height}:d==="horizontal"?{width:n.props.width||s}:null}}])}(V.PureComponent);mI(kh,"displayName","Legend");mI(kh,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var a7=$2,MUe=b$,DUe=Yc,o7=a7?a7.isConcatSpreadable:void 0;function LUe(e){return DUe(e)||MUe(e)||!!(o7&&e&&e[o7])}var FUe=LUe,zUe=ule,BUe=FUe;function Tle(e,t,r,n,s){var o=-1,d=e.length;for(r||(r=BUe),s||(s=[]);++o<d;){var i=e[o];t>0&&r(i)?t>1?Tle(i,t-1,r,n,s):zUe(s,i):n||(s[s.length]=i)}return s}var Ale=Tle;function $Ue(e){return function(t,r,n){for(var s=-1,o=Object(t),d=n(t),i=d.length;i--;){var m=d[e?i:++s];if(r(o[m],m,o)===!1)break}return t}}var UUe=$Ue,VUe=UUe,qUe=VUe(),HUe=qUe,GUe=HUe,WUe=pI;function KUe(e,t){return e&&GUe(e,t,WUe)}var Cle=KUe,ZUe=V2;function XUe(e,t){return function(r,n){if(r==null)return r;if(!ZUe(r))return e(r,n);for(var s=r.length,o=t?s:-1,d=Object(r);(t?o--:++o<s)&&n(d[o],o,d)!==!1;);return r}}var YUe=XUe,JUe=Cle,QUe=YUe,eVe=QUe(JUe),T$=eVe,tVe=T$,rVe=V2;function nVe(e,t){var r=-1,n=rVe(e)?Array(e.length):[];return tVe(e,function(s,o,d){n[++r]=t(s,o,d)}),n}var jle=nVe;function iVe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var sVe=iVe,l7=fw;function aVe(e,t){if(e!==t){var r=e!==void 0,n=e===null,s=e===e,o=l7(e),d=t!==void 0,i=t===null,m=t===t,y=l7(t);if(!i&&!y&&!o&&e>t||o&&d&&m&&!i&&!y||n&&d&&m||!r&&m||!s)return 1;if(!n&&!o&&!y&&e<t||y&&r&&s&&!n&&!o||i&&r&&s||!d&&s||!m)return-1}return 0}var oVe=aVe,lVe=oVe;function cVe(e,t,r){for(var n=-1,s=e.criteria,o=t.criteria,d=s.length,i=r.length;++n<d;){var m=lVe(s[n],o[n]);if(m){if(n>=i)return m;var y=r[n];return m*(y=="desc"?-1:1)}}return e.index-t.index}var uVe=cVe,cL=c$,dVe=u$,hVe=nf,fVe=jle,pVe=sVe,mVe=fle,gVe=uVe,yVe=bw,vVe=Yc;function _Ve(e,t,r){t.length?t=cL(t,function(o){return vVe(o)?function(d){return dVe(d,o.length===1?o[0]:o)}:o}):t=[yVe];var n=-1;t=cL(t,mVe(hVe));var s=fVe(e,function(o,d,i){var m=cL(t,function(y){return y(o)});return{criteria:m,index:++n,value:o}});return pVe(s,function(o,d){return gVe(o,d,r)})}var xVe=_Ve;function bVe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var wVe=bVe,SVe=wVe,c7=Math.max;function EVe(e,t,r){return t=c7(t===void 0?e.length-1:t,0),function(){for(var n=arguments,s=-1,o=c7(n.length-t,0),d=Array(o);++s<o;)d[s]=n[t+s];s=-1;for(var i=Array(t+1);++s<t;)i[s]=n[s];return i[t]=r(d),SVe(e,this,i)}}var TVe=EVe;function AVe(e){return function(){return e}}var CVe=AVe,jVe=n_,PVe=function(){try{var e=jVe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Ple=PVe,OVe=CVe,u7=Ple,kVe=bw,NVe=u7?function(e,t){return u7(e,"toString",{configurable:!0,enumerable:!1,value:OVe(t),writable:!0})}:kVe,IVe=NVe,RVe=800,MVe=16,DVe=Date.now;function LVe(e){var t=0,r=0;return function(){var n=DVe(),s=MVe-(n-r);if(r=n,s>0){if(++t>=RVe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var FVe=LVe,zVe=IVe,BVe=FVe,$Ve=BVe(zVe),UVe=$Ve,VVe=bw,qVe=TVe,HVe=UVe;function GVe(e,t){return HVe(qVe(e,t,VVe),e+"")}var WVe=GVe,KVe=s$,ZVe=V2,XVe=w$,YVe=Pg;function JVe(e,t,r){if(!YVe(r))return!1;var n=typeof t;return(n=="number"?ZVe(r)&&XVe(t,r.length):n=="string"&&t in r)?KVe(r[t],e):!1}var gI=JVe,QVe=Ale,e6e=xVe,t6e=WVe,d7=gI,r6e=t6e(function(e,t){if(e==null)return[];var r=t.length;return r>1&&d7(e,t[0],t[1])?t=[]:r>2&&d7(t[0],t[1],t[2])&&(t=[t[0]]),e6e(e,QVe(t,1),[])}),n6e=r6e;const A$=Ps(n6e);function jT(e){"@babel/helpers - typeof";return jT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jT(e)}function hz(){return hz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hz.apply(this,arguments)}function i6e(e,t){return l6e(e)||o6e(e,t)||a6e(e,t)||s6e()}function s6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a6e(e,t){if(e){if(typeof e=="string")return h7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h7(e,t)}}function h7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function l6e(e){if(Array.isArray(e))return e}function f7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function uL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?f7(Object(r),!0).forEach(function(n){c6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c6e(e,t,r){return t=u6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u6e(e){var t=d6e(e,"string");return jT(t)=="symbol"?t:t+""}function d6e(e,t){if(jT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(jT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h6e(e){return Array.isArray(e)&&el(e[0])&&el(e[1])?e.join(" ~ "):e}var f6e=function(t){var r=t.separator,n=r===void 0?" : ":r,s=t.contentStyle,o=s===void 0?{}:s,d=t.itemStyle,i=d===void 0?{}:d,m=t.labelStyle,y=m===void 0?{}:m,S=t.payload,w=t.formatter,T=t.itemSorter,A=t.wrapperClassName,O=t.labelClassName,P=t.label,N=t.labelFormatter,R=t.accessibilityLayer,M=R===void 0?!1:R,F=function(){if(S&&S.length){var ee={padding:0,margin:0},ie=(T?A$(S,T):S).map(function(de,be){if(de.type==="none")return null;var Se=uL({display:"block",paddingTop:4,paddingBottom:4,color:de.color||"#000"},i),Ae=de.formatter||w||h6e,xe=de.value,me=de.name,Ce=xe,ge=me;if(Ae&&Ce!=null&&ge!=null){var pe=Ae(xe,me,de,be,S);if(Array.isArray(pe)){var Oe=i6e(pe,2);Ce=Oe[0],ge=Oe[1]}else Ce=pe}return Ve.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(be),style:Se},el(ge)?Ve.createElement("span",{className:"recharts-tooltip-item-name"},ge):null,el(ge)?Ve.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ve.createElement("span",{className:"recharts-tooltip-item-value"},Ce),Ve.createElement("span",{className:"recharts-tooltip-item-unit"},de.unit||""))});return Ve.createElement("ul",{className:"recharts-tooltip-item-list",style:ee},ie)}return null},B=uL({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),$=uL({margin:0},y),W=!Oi(P),K=W?P:"",te=Ni("recharts-default-tooltip",A),ne=Ni("recharts-tooltip-label",O);W&&N&&S!==void 0&&S!==null&&(K=N(P,S));var ae=M?{role:"status","aria-live":"assertive"}:{};return Ve.createElement("div",hz({className:te,style:B},ae),Ve.createElement("p",{className:ne,style:$},Ve.isValidElement(K)?K:"".concat(K)),F())};function PT(e){"@babel/helpers - typeof";return PT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},PT(e)}function Pj(e,t,r){return t=p6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p6e(e){var t=m6e(e,"string");return PT(t)=="symbol"?t:t+""}function m6e(e,t){if(PT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(PT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var KS="recharts-tooltip-wrapper",g6e={visibility:"hidden"};function y6e(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Ni(KS,Pj(Pj(Pj(Pj({},"".concat(KS,"-right"),Gr(r)&&t&&Gr(t.x)&&r>=t.x),"".concat(KS,"-left"),Gr(r)&&t&&Gr(t.x)&&r<t.x),"".concat(KS,"-bottom"),Gr(n)&&t&&Gr(t.y)&&n>=t.y),"".concat(KS,"-top"),Gr(n)&&t&&Gr(t.y)&&n<t.y))}function p7(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,s=e.offsetTopLeft,o=e.position,d=e.reverseDirection,i=e.tooltipDimension,m=e.viewBox,y=e.viewBoxDimension;if(o&&Gr(o[n]))return o[n];var S=r[n]-i-s,w=r[n]+s;if(t[n])return d[n]?S:w;if(d[n]){var T=S,A=m[n];return T<A?Math.max(w,m[n]):Math.max(S,m[n])}var O=w+i,P=m[n]+y;return O>P?Math.max(S,m[n]):Math.max(w,m[n])}function v6e(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function _6e(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,s=e.position,o=e.reverseDirection,d=e.tooltipBox,i=e.useTranslate3d,m=e.viewBox,y,S,w;return d.height>0&&d.width>0&&r?(S=p7({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:d.width,viewBox:m,viewBoxDimension:m.width}),w=p7({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:d.height,viewBox:m,viewBoxDimension:m.height}),y=v6e({translateX:S,translateY:w,useTranslate3d:i})):y=g6e,{cssProperties:y,cssClasses:y6e({translateX:S,translateY:w,coordinate:r})}}function Pb(e){"@babel/helpers - typeof";return Pb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pb(e)}function m7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function g7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m7(Object(r),!0).forEach(function(n){pz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kle(n.key),n)}}function w6e(e,t,r){return t&&b6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function S6e(e,t,r){return t=VO(t),E6e(e,Ole()?Reflect.construct(t,r||[],VO(e).constructor):t.apply(e,r))}function E6e(e,t){if(t&&(Pb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return T6e(e)}function T6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ole(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ole=function(){return!!e})()}function VO(e){return VO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},VO(e)}function A6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fz(e,t)}function fz(e,t){return fz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},fz(e,t)}function pz(e,t,r){return t=kle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kle(e){var t=C6e(e,"string");return Pb(t)=="symbol"?t:t+""}function C6e(e,t){if(Pb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Pb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var y7=1,j6e=function(e){function t(){var r;x6e(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=S6e(this,t,[].concat(s)),pz(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),pz(r,"handleKeyDown",function(d){if(d.key==="Escape"){var i,m,y,S;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(m=r.props.coordinate)===null||m===void 0?void 0:m.x)!==null&&i!==void 0?i:0,y:(y=(S=r.props.coordinate)===null||S===void 0?void 0:S.y)!==null&&y!==void 0?y:0}})}}),r}return A6e(t,e),w6e(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>y7||Math.abs(n.height-this.state.lastBoundingBox.height)>y7)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,s;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,s=this.props,o=s.active,d=s.allowEscapeViewBox,i=s.animationDuration,m=s.animationEasing,y=s.children,S=s.coordinate,w=s.hasPayload,T=s.isAnimationActive,A=s.offset,O=s.position,P=s.reverseDirection,N=s.useTranslate3d,R=s.viewBox,M=s.wrapperStyle,F=_6e({allowEscapeViewBox:d,coordinate:S,offsetTopLeft:A,position:O,reverseDirection:P,tooltipBox:this.state.lastBoundingBox,useTranslate3d:N,viewBox:R}),B=F.cssClasses,$=F.cssProperties,W=g7(g7({transition:T&&o?"transform ".concat(i,"ms ").concat(m):void 0},$),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&w?"visible":"hidden",position:"absolute",top:0,left:0},M);return Ve.createElement("div",{tabIndex:-1,className:B,style:W,ref:function(te){n.wrapperNode=te}},y)}}])}(V.PureComponent),P6e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Bh={isSsr:P6e(),get:function(t){return Bh[t]},set:function(t,r){if(typeof t=="string")Bh[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(s){Bh[s]=t[s]})}}};function Ob(e){"@babel/helpers - typeof";return Ob=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ob(e)}function v7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function _7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v7(Object(r),!0).forEach(function(n){C$(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function O6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ile(n.key),n)}}function N6e(e,t,r){return t&&k6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function I6e(e,t,r){return t=qO(t),R6e(e,Nle()?Reflect.construct(t,r||[],qO(e).constructor):t.apply(e,r))}function R6e(e,t){if(t&&(Ob(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return M6e(e)}function M6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Nle=function(){return!!e})()}function qO(e){return qO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qO(e)}function D6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mz(e,t)}function mz(e,t){return mz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},mz(e,t)}function C$(e,t,r){return t=Ile(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ile(e){var t=L6e(e,"string");return Ob(t)=="symbol"?t:t+""}function L6e(e,t){if(Ob(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ob(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function F6e(e){return e.dataKey}function z6e(e,t){return Ve.isValidElement(e)?Ve.cloneElement(e,t):typeof e=="function"?Ve.createElement(e,t):Ve.createElement(f6e,t)}var Tl=function(e){function t(){return O6e(this,t),I6e(this,t,arguments)}return D6e(t,e),N6e(t,[{key:"render",value:function(){var n=this,s=this.props,o=s.active,d=s.allowEscapeViewBox,i=s.animationDuration,m=s.animationEasing,y=s.content,S=s.coordinate,w=s.filterNull,T=s.isAnimationActive,A=s.offset,O=s.payload,P=s.payloadUniqBy,N=s.position,R=s.reverseDirection,M=s.useTranslate3d,F=s.viewBox,B=s.wrapperStyle,$=O??[];w&&$.length&&($=wle(O.filter(function(K){return K.value!=null&&(K.hide!==!0||n.props.includeHidden)}),P,F6e));var W=$.length>0;return Ve.createElement(j6e,{allowEscapeViewBox:d,animationDuration:i,animationEasing:m,isAnimationActive:T,active:o,coordinate:S,hasPayload:W,offset:A,position:N,reverseDirection:R,useTranslate3d:M,viewBox:F,wrapperStyle:B},z6e(y,_7(_7({},this.props),{},{payload:$})))}}])}(V.PureComponent);C$(Tl,"displayName","Tooltip");C$(Tl,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Bh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var B6e=rf,$6e=function(){return B6e.Date.now()},U6e=$6e,V6e=/\s/;function q6e(e){for(var t=e.length;t--&&V6e.test(e.charAt(t)););return t}var H6e=q6e,G6e=H6e,W6e=/^\s+/;function K6e(e){return e&&e.slice(0,G6e(e)+1).replace(W6e,"")}var Z6e=K6e,X6e=Z6e,x7=Pg,Y6e=fw,b7=NaN,J6e=/^[-+]0x[0-9a-f]+$/i,Q6e=/^0b[01]+$/i,e8e=/^0o[0-7]+$/i,t8e=parseInt;function r8e(e){if(typeof e=="number")return e;if(Y6e(e))return b7;if(x7(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=x7(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=X6e(e);var r=Q6e.test(e);return r||e8e.test(e)?t8e(e.slice(2),r?2:8):J6e.test(e)?b7:+e}var Rle=r8e,n8e=Pg,dL=U6e,w7=Rle,i8e="Expected a function",s8e=Math.max,a8e=Math.min;function o8e(e,t,r){var n,s,o,d,i,m,y=0,S=!1,w=!1,T=!0;if(typeof e!="function")throw new TypeError(i8e);t=w7(t)||0,n8e(r)&&(S=!!r.leading,w="maxWait"in r,o=w?s8e(w7(r.maxWait)||0,t):o,T="trailing"in r?!!r.trailing:T);function A(W){var K=n,te=s;return n=s=void 0,y=W,d=e.apply(te,K),d}function O(W){return y=W,i=setTimeout(R,t),S?A(W):d}function P(W){var K=W-m,te=W-y,ne=t-K;return w?a8e(ne,o-te):ne}function N(W){var K=W-m,te=W-y;return m===void 0||K>=t||K<0||w&&te>=o}function R(){var W=dL();if(N(W))return M(W);i=setTimeout(R,P(W))}function M(W){return i=void 0,T&&n?A(W):(n=s=void 0,d)}function F(){i!==void 0&&clearTimeout(i),y=0,n=m=s=i=void 0}function B(){return i===void 0?d:M(dL())}function $(){var W=dL(),K=N(W);if(n=arguments,s=this,m=W,K){if(i===void 0)return O(m);if(w)return clearTimeout(i),i=setTimeout(R,t),A(m)}return i===void 0&&(i=setTimeout(R,t)),d}return $.cancel=F,$.flush=B,$}var l8e=o8e,c8e=l8e,u8e=Pg,d8e="Expected a function";function h8e(e,t,r){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(d8e);return u8e(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),c8e(e,t,{leading:n,maxWait:t,trailing:s})}var f8e=h8e;const Mle=Ps(f8e);function OT(e){"@babel/helpers - typeof";return OT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},OT(e)}function S7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Oj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S7(Object(r),!0).forEach(function(n){p8e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function p8e(e,t,r){return t=m8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m8e(e){var t=g8e(e,"string");return OT(t)=="symbol"?t:t+""}function g8e(e,t){if(OT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(OT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function y8e(e,t){return b8e(e)||x8e(e,t)||_8e(e,t)||v8e()}function v8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _8e(e,t){if(e){if(typeof e=="string")return E7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E7(e,t)}}function E7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function x8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function b8e(e){if(Array.isArray(e))return e}var Wm=V.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,s=n===void 0?{width:-1,height:-1}:n,o=e.width,d=o===void 0?"100%":o,i=e.height,m=i===void 0?"100%":i,y=e.minWidth,S=y===void 0?0:y,w=e.minHeight,T=e.maxHeight,A=e.children,O=e.debounce,P=O===void 0?0:O,N=e.id,R=e.className,M=e.onResize,F=e.style,B=F===void 0?{}:F,$=V.useRef(null),W=V.useRef();W.current=M,V.useImperativeHandle(t,function(){return Object.defineProperty($.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),$.current},configurable:!0})});var K=V.useState({containerWidth:s.width,containerHeight:s.height}),te=y8e(K,2),ne=te[0],ae=te[1],re=V.useCallback(function(ie,de){ae(function(be){var Se=Math.round(ie),Ae=Math.round(de);return be.containerWidth===Se&&be.containerHeight===Ae?be:{containerWidth:Se,containerHeight:Ae}})},[]);V.useEffect(function(){var ie=function(me){var Ce,ge=me[0].contentRect,pe=ge.width,Oe=ge.height;re(pe,Oe),(Ce=W.current)===null||Ce===void 0||Ce.call(W,pe,Oe)};P>0&&(ie=Mle(ie,P,{trailing:!0,leading:!1}));var de=new ResizeObserver(ie),be=$.current.getBoundingClientRect(),Se=be.width,Ae=be.height;return re(Se,Ae),de.observe($.current),function(){de.disconnect()}},[re,P]);var ee=V.useMemo(function(){var ie=ne.containerWidth,de=ne.containerHeight;if(ie<0||de<0)return null;Vd(tv(d)||tv(m),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,d,m),Vd(!r||r>0,"The aspect(%s) must be greater than zero.",r);var be=tv(d)?ie:d,Se=tv(m)?de:m;r&&r>0&&(be?Se=be/r:Se&&(be=Se*r),T&&Se>T&&(Se=T)),Vd(be>0||Se>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,be,Se,d,m,S,w,r);var Ae=!Array.isArray(A)&&Yf(A.type).endsWith("Chart");return Ve.Children.map(A,function(xe){return Ve.isValidElement(xe)?V.cloneElement(xe,Oj({width:be,height:Se},Ae?{style:Oj({height:"100%",width:"100%",maxHeight:Se,maxWidth:be},xe.props.style)}:{})):xe})},[r,A,m,T,w,S,ne,d]);return Ve.createElement("div",{id:N?"".concat(N):void 0,className:Ni("recharts-responsive-container",R),style:Oj(Oj({},B),{},{width:d,height:m,minWidth:S,minHeight:w,maxHeight:T}),ref:$},ee)}),kT=function(t){return null};kT.displayName="Cell";function NT(e){"@babel/helpers - typeof";return NT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NT(e)}function T7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function gz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T7(Object(r),!0).forEach(function(n){w8e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function w8e(e,t,r){return t=S8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S8e(e){var t=E8e(e,"string");return NT(t)=="symbol"?t:t+""}function E8e(e,t){if(NT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(NT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Gx={widthCache:{},cacheCount:0},T8e=2e3,A8e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},A7="recharts_measurement_span";function C8e(e){var t=gz({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var DE=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Bh.isSsr)return{width:0,height:0};var n=C8e(r),s=JSON.stringify({text:t,copyStyle:n});if(Gx.widthCache[s])return Gx.widthCache[s];try{var o=document.getElementById(A7);o||(o=document.createElement("span"),o.setAttribute("id",A7),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var d=gz(gz({},A8e),n);Object.assign(o.style,d),o.textContent="".concat(t);var i=o.getBoundingClientRect(),m={width:i.width,height:i.height};return Gx.widthCache[s]=m,++Gx.cacheCount>T8e&&(Gx.cacheCount=0,Gx.widthCache={}),m}catch{return{width:0,height:0}}},j8e=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function IT(e){"@babel/helpers - typeof";return IT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},IT(e)}function HO(e,t){return N8e(e)||k8e(e,t)||O8e(e,t)||P8e()}function P8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function O8e(e,t){if(e){if(typeof e=="string")return C7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C7(e,t)}}function C7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;m=!1}else for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function N8e(e){if(Array.isArray(e))return e}function I8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,M8e(n.key),n)}}function R8e(e,t,r){return t&&j7(e.prototype,t),r&&j7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function M8e(e){var t=D8e(e,"string");return IT(t)=="symbol"?t:t+""}function D8e(e,t){if(IT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(IT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var P7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,O7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,L8e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,F8e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Dle={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},z8e=Object.keys(Dle),v0="NaN";function B8e(e,t){return e*Dle[t]}var kj=function(){function e(t,r){I8e(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!L8e.test(r)&&(this.num=NaN,this.unit=""),z8e.includes(r)&&(this.num=B8e(t,r),this.unit="px")}return R8e(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,s=(n=F8e.exec(r))!==null&&n!==void 0?n:[],o=HO(s,3),d=o[1],i=o[2];return new e(parseFloat(d),i??"")}}])}();function Lle(e){if(e.includes(v0))return v0;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=P7.exec(t))!==null&&r!==void 0?r:[],s=HO(n,4),o=s[1],d=s[2],i=s[3],m=kj.parse(o??""),y=kj.parse(i??""),S=d==="*"?m.multiply(y):m.divide(y);if(S.isNaN())return v0;t=t.replace(P7,S.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var w,T=(w=O7.exec(t))!==null&&w!==void 0?w:[],A=HO(T,4),O=A[1],P=A[2],N=A[3],R=kj.parse(O??""),M=kj.parse(N??""),F=P==="+"?R.add(M):R.subtract(M);if(F.isNaN())return v0;t=t.replace(O7,F.toString())}return t}var k7=/\(([^()]*)\)/;function $8e(e){for(var t=e;t.includes("(");){var r=k7.exec(t),n=HO(r,2),s=n[1];t=t.replace(k7,Lle(s))}return t}function U8e(e){var t=e.replace(/\s+/g,"");return t=$8e(t),t=Lle(t),t}function V8e(e){try{return U8e(e)}catch{return v0}}function hL(e){var t=V8e(e.slice(5,-1));return t===v0?"":t}var q8e=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],H8e=["dx","dy","angle","className","breakAll"];function yz(){return yz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yz.apply(this,arguments)}function N7(e,t){if(e==null)return{};var r=G8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function G8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function I7(e,t){return X8e(e)||Z8e(e,t)||K8e(e,t)||W8e()}function W8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K8e(e,t){if(e){if(typeof e=="string")return R7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R7(e,t)}}function R7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Z8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;m=!1}else for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function X8e(e){if(Array.isArray(e))return e}var Fle=/[ \f\n\r\t\v\u2028\u2029]+/,zle=function(t){var r=t.children,n=t.breakAll,s=t.style;try{var o=[];Oi(r)||(n?o=r.toString().split(""):o=r.toString().split(Fle));var d=o.map(function(m){return{word:m,width:DE(m,s).width}}),i=n?0:DE("",s).width;return{wordsWithComputedWidth:d,spaceWidth:i}}catch{return null}},Y8e=function(t,r,n,s,o){var d=t.maxLines,i=t.children,m=t.style,y=t.breakAll,S=Gr(d),w=i,T=function(){var be=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return be.reduce(function(Se,Ae){var xe=Ae.word,me=Ae.width,Ce=Se[Se.length-1];if(Ce&&(s==null||o||Ce.width+me+n<Number(s)))Ce.words.push(xe),Ce.width+=me+n;else{var ge={words:[xe],width:me};Se.push(ge)}return Se},[])},A=T(r),O=function(be){return be.reduce(function(Se,Ae){return Se.width>Ae.width?Se:Ae})};if(!S)return A;for(var P="",N=function(be){var Se=w.slice(0,be),Ae=zle({breakAll:y,style:m,children:Se+P}).wordsWithComputedWidth,xe=T(Ae),me=xe.length>d||O(xe).width>Number(s);return[me,xe]},R=0,M=w.length-1,F=0,B;R<=M&&F<=w.length-1;){var $=Math.floor((R+M)/2),W=$-1,K=N(W),te=I7(K,2),ne=te[0],ae=te[1],re=N($),ee=I7(re,1),ie=ee[0];if(!ne&&!ie&&(R=$+1),ne&&ie&&(M=$-1),!ne&&ie){B=ae;break}F++}return B||A},M7=function(t){var r=Oi(t)?[]:t.toString().split(Fle);return[{words:r}]},J8e=function(t){var r=t.width,n=t.scaleToFit,s=t.children,o=t.style,d=t.breakAll,i=t.maxLines;if((r||n)&&!Bh.isSsr){var m,y,S=zle({breakAll:d,children:s,style:o});if(S){var w=S.wordsWithComputedWidth,T=S.spaceWidth;m=w,y=T}else return M7(s);return Y8e({breakAll:d,children:s,maxLines:i,style:o},m,y,r,n)}return M7(s)},D7="#808080",$v=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,d=t.lineHeight,i=d===void 0?"1em":d,m=t.capHeight,y=m===void 0?"0.71em":m,S=t.scaleToFit,w=S===void 0?!1:S,T=t.textAnchor,A=T===void 0?"start":T,O=t.verticalAnchor,P=O===void 0?"end":O,N=t.fill,R=N===void 0?D7:N,M=N7(t,q8e),F=V.useMemo(function(){return J8e({breakAll:M.breakAll,children:M.children,maxLines:M.maxLines,scaleToFit:w,style:M.style,width:M.width})},[M.breakAll,M.children,M.maxLines,w,M.style,M.width]),B=M.dx,$=M.dy,W=M.angle,K=M.className,te=M.breakAll,ne=N7(M,H8e);if(!el(n)||!el(o))return null;var ae=n+(Gr(B)?B:0),re=o+(Gr($)?$:0),ee;switch(P){case"start":ee=hL("calc(".concat(y,")"));break;case"middle":ee=hL("calc(".concat((F.length-1)/2," * -").concat(i," + (").concat(y," / 2))"));break;default:ee=hL("calc(".concat(F.length-1," * -").concat(i,")"));break}var ie=[];if(w){var de=F[0].width,be=M.width;ie.push("scale(".concat((Gr(be)?be/de:1)/de,")"))}return W&&ie.push("rotate(".concat(W,", ").concat(ae,", ").concat(re,")")),ie.length&&(ne.transform=ie.join(" ")),Ve.createElement("text",yz({},Jn(ne,!0),{x:ae,y:re,className:Ni("recharts-text",K),textAnchor:A,fill:R.includes("url")?D7:R}),F.map(function(Se,Ae){var xe=Se.words.join(te?"":" ");return Ve.createElement("tspan",{x:ae,dy:Ae===0?ee:i,key:"".concat(xe,"-").concat(Ae)},xe)}))};function og(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Q8e(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function j$(e){let t,r,n;e.length!==2?(t=og,r=(i,m)=>og(e(i),m),n=(i,m)=>e(i)-m):(t=e===og||e===Q8e?e:eqe,r=e,n=e);function s(i,m,y=0,S=i.length){if(y<S){if(t(m,m)!==0)return S;do{const w=y+S>>>1;r(i[w],m)<0?y=w+1:S=w}while(y<S)}return y}function o(i,m,y=0,S=i.length){if(y<S){if(t(m,m)!==0)return S;do{const w=y+S>>>1;r(i[w],m)<=0?y=w+1:S=w}while(y<S)}return y}function d(i,m,y=0,S=i.length){const w=s(i,m,y,S-1);return w>y&&n(i[w-1],m)>-n(i[w],m)?w-1:w}return{left:s,center:d,right:o}}function eqe(){return 0}function Ble(e){return e===null?NaN:+e}function*tqe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const rqe=j$(og),q2=rqe.right;j$(Ble).center;class L7 extends Map{constructor(t,r=sqe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,s]of t)this.set(n,s)}get(t){return super.get(F7(this,t))}has(t){return super.has(F7(this,t))}set(t,r){return super.set(nqe(this,t),r)}delete(t){return super.delete(iqe(this,t))}}function F7({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function nqe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function iqe({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function sqe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function aqe(e=og){if(e===og)return $le;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function $le(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const oqe=Math.sqrt(50),lqe=Math.sqrt(10),cqe=Math.sqrt(2);function GO(e,t,r){const n=(t-e)/Math.max(0,r),s=Math.floor(Math.log10(n)),o=n/Math.pow(10,s),d=o>=oqe?10:o>=lqe?5:o>=cqe?2:1;let i,m,y;return s<0?(y=Math.pow(10,-s)/d,i=Math.round(e*y),m=Math.round(t*y),i/y<e&&++i,m/y>t&&--m,y=-y):(y=Math.pow(10,s)*d,i=Math.round(e/y),m=Math.round(t/y),i*y<e&&++i,m*y>t&&--m),m<i&&.5<=r&&r<2?GO(e,t,r*2):[i,m,y]}function vz(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[s,o,d]=n?GO(t,e,r):GO(e,t,r);if(!(o>=s))return[];const i=o-s+1,m=new Array(i);if(n)if(d<0)for(let y=0;y<i;++y)m[y]=(o-y)/-d;else for(let y=0;y<i;++y)m[y]=(o-y)*d;else if(d<0)for(let y=0;y<i;++y)m[y]=(s+y)/-d;else for(let y=0;y<i;++y)m[y]=(s+y)*d;return m}function _z(e,t,r){return t=+t,e=+e,r=+r,GO(e,t,r)[2]}function xz(e,t,r){t=+t,e=+e,r=+r;const n=t<e,s=n?_z(t,e,r):_z(e,t,r);return(n?-1:1)*(s<0?1/-s:s)}function z7(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function B7(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function Ule(e,t,r=0,n=1/0,s){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(s=s===void 0?$le:aqe(s);n>r;){if(n-r>600){const m=n-r+1,y=t-r+1,S=Math.log(m),w=.5*Math.exp(2*S/3),T=.5*Math.sqrt(S*w*(m-w)/m)*(y-m/2<0?-1:1),A=Math.max(r,Math.floor(t-y*w/m+T)),O=Math.min(n,Math.floor(t+(m-y)*w/m+T));Ule(e,t,A,O,s)}const o=e[t];let d=r,i=n;for(ZS(e,r,t),s(e[n],o)>0&&ZS(e,r,n);d<i;){for(ZS(e,d,i),++d,--i;s(e[d],o)<0;)++d;for(;s(e[i],o)>0;)--i}s(e[r],o)===0?ZS(e,r,i):(++i,ZS(e,i,n)),i<=t&&(r=i+1),t<=i&&(n=i-1)}return e}function ZS(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function uqe(e,t,r){if(e=Float64Array.from(tqe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return B7(e);if(t>=1)return z7(e);var n,s=(n-1)*t,o=Math.floor(s),d=z7(Ule(e,o).subarray(0,o+1)),i=B7(e.subarray(o+1));return d+(i-d)*(s-o)}}function dqe(e,t,r=Ble){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,s=(n-1)*t,o=Math.floor(s),d=+r(e[o],o,e),i=+r(e[o+1],o+1,e);return d+(i-d)*(s-o)}}function hqe(e,t,r){e=+e,t=+t,r=(s=arguments.length)<2?(t=e,e=0,1):s<3?1:+r;for(var n=-1,s=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(s);++n<s;)o[n]=e+n*r;return o}function rd(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function xp(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const bz=Symbol("implicit");function P$(){var e=new L7,t=[],r=[],n=bz;function s(o){let d=e.get(o);if(d===void 0){if(n!==bz)return n;e.set(o,d=t.push(o)-1)}return r[d%r.length]}return s.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new L7;for(const d of o)e.has(d)||e.set(d,t.push(d)-1);return s},s.range=function(o){return arguments.length?(r=Array.from(o),s):r.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return P$(t,r).unknown(n)},rd.apply(s,arguments),s}function RT(){var e=P$().unknown(void 0),t=e.domain,r=e.range,n=0,s=1,o,d,i=!1,m=0,y=0,S=.5;delete e.unknown;function w(){var T=t().length,A=s<n,O=A?s:n,P=A?n:s;o=(P-O)/Math.max(1,T-m+y*2),i&&(o=Math.floor(o)),O+=(P-O-o*(T-m))*S,d=o*(1-m),i&&(O=Math.round(O),d=Math.round(d));var N=hqe(T).map(function(R){return O+o*R});return r(A?N.reverse():N)}return e.domain=function(T){return arguments.length?(t(T),w()):t()},e.range=function(T){return arguments.length?([n,s]=T,n=+n,s=+s,w()):[n,s]},e.rangeRound=function(T){return[n,s]=T,n=+n,s=+s,i=!0,w()},e.bandwidth=function(){return d},e.step=function(){return o},e.round=function(T){return arguments.length?(i=!!T,w()):i},e.padding=function(T){return arguments.length?(m=Math.min(1,y=+T),w()):m},e.paddingInner=function(T){return arguments.length?(m=Math.min(1,T),w()):m},e.paddingOuter=function(T){return arguments.length?(y=+T,w()):y},e.align=function(T){return arguments.length?(S=Math.max(0,Math.min(1,T)),w()):S},e.copy=function(){return RT(t(),[n,s]).round(i).paddingInner(m).paddingOuter(y).align(S)},rd.apply(w(),arguments)}function Vle(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Vle(t())},e}function LE(){return Vle(RT.apply(null,arguments).paddingInner(1))}function O$(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function qle(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function H2(){}var MT=.7,WO=1/MT,z0="\\s*([+-]?\\d+)\\s*",DT="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$h="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",fqe=/^#([0-9a-f]{3,8})$/,pqe=new RegExp(`^rgb\\(${z0},${z0},${z0}\\)$`),mqe=new RegExp(`^rgb\\(${$h},${$h},${$h}\\)$`),gqe=new RegExp(`^rgba\\(${z0},${z0},${z0},${DT}\\)$`),yqe=new RegExp(`^rgba\\(${$h},${$h},${$h},${DT}\\)$`),vqe=new RegExp(`^hsl\\(${DT},${$h},${$h}\\)$`),_qe=new RegExp(`^hsla\\(${DT},${$h},${$h},${DT}\\)$`),$7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};O$(H2,LT,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:U7,formatHex:U7,formatHex8:xqe,formatHsl:bqe,formatRgb:V7,toString:V7});function U7(){return this.rgb().formatHex()}function xqe(){return this.rgb().formatHex8()}function bqe(){return Hle(this).formatHsl()}function V7(){return this.rgb().formatRgb()}function LT(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=fqe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?q7(t):r===3?new qc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Nj(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Nj(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=pqe.exec(e))?new qc(t[1],t[2],t[3],1):(t=mqe.exec(e))?new qc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=gqe.exec(e))?Nj(t[1],t[2],t[3],t[4]):(t=yqe.exec(e))?Nj(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=vqe.exec(e))?W7(t[1],t[2]/100,t[3]/100,1):(t=_qe.exec(e))?W7(t[1],t[2]/100,t[3]/100,t[4]):$7.hasOwnProperty(e)?q7($7[e]):e==="transparent"?new qc(NaN,NaN,NaN,0):null}function q7(e){return new qc(e>>16&255,e>>8&255,e&255,1)}function Nj(e,t,r,n){return n<=0&&(e=t=r=NaN),new qc(e,t,r,n)}function wqe(e){return e instanceof H2||(e=LT(e)),e?(e=e.rgb(),new qc(e.r,e.g,e.b,e.opacity)):new qc}function wz(e,t,r,n){return arguments.length===1?wqe(e):new qc(e,t,r,n??1)}function qc(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}O$(qc,wz,qle(H2,{brighter(e){return e=e==null?WO:Math.pow(WO,e),new qc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?MT:Math.pow(MT,e),new qc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new qc(vv(this.r),vv(this.g),vv(this.b),KO(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:H7,formatHex:H7,formatHex8:Sqe,formatRgb:G7,toString:G7}));function H7(){return`#${rv(this.r)}${rv(this.g)}${rv(this.b)}`}function Sqe(){return`#${rv(this.r)}${rv(this.g)}${rv(this.b)}${rv((isNaN(this.opacity)?1:this.opacity)*255)}`}function G7(){const e=KO(this.opacity);return`${e===1?"rgb(":"rgba("}${vv(this.r)}, ${vv(this.g)}, ${vv(this.b)}${e===1?")":`, ${e})`}`}function KO(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function vv(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rv(e){return e=vv(e),(e<16?"0":"")+e.toString(16)}function W7(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new zd(e,t,r,n)}function Hle(e){if(e instanceof zd)return new zd(e.h,e.s,e.l,e.opacity);if(e instanceof H2||(e=LT(e)),!e)return new zd;if(e instanceof zd)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,s=Math.min(t,r,n),o=Math.max(t,r,n),d=NaN,i=o-s,m=(o+s)/2;return i?(t===o?d=(r-n)/i+(r<n)*6:r===o?d=(n-t)/i+2:d=(t-r)/i+4,i/=m<.5?o+s:2-o-s,d*=60):i=m>0&&m<1?0:d,new zd(d,i,m,e.opacity)}function Eqe(e,t,r,n){return arguments.length===1?Hle(e):new zd(e,t,r,n??1)}function zd(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}O$(zd,Eqe,qle(H2,{brighter(e){return e=e==null?WO:Math.pow(WO,e),new zd(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?MT:Math.pow(MT,e),new zd(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,s=2*r-n;return new qc(fL(e>=240?e-240:e+120,s,n),fL(e,s,n),fL(e<120?e+240:e-120,s,n),this.opacity)},clamp(){return new zd(K7(this.h),Ij(this.s),Ij(this.l),KO(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=KO(this.opacity);return`${e===1?"hsl(":"hsla("}${K7(this.h)}, ${Ij(this.s)*100}%, ${Ij(this.l)*100}%${e===1?")":`, ${e})`}`}}));function K7(e){return e=(e||0)%360,e<0?e+360:e}function Ij(e){return Math.max(0,Math.min(1,e||0))}function fL(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const k$=e=>()=>e;function Tqe(e,t){return function(r){return e+r*t}}function Aqe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Cqe(e){return(e=+e)==1?Gle:function(t,r){return r-t?Aqe(t,r,e):k$(isNaN(t)?r:t)}}function Gle(e,t){var r=t-e;return r?Tqe(e,r):k$(isNaN(e)?t:e)}const Z7=function e(t){var r=Cqe(t);function n(s,o){var d=r((s=wz(s)).r,(o=wz(o)).r),i=r(s.g,o.g),m=r(s.b,o.b),y=Gle(s.opacity,o.opacity);return function(S){return s.r=d(S),s.g=i(S),s.b=m(S),s.opacity=y(S),s+""}}return n.gamma=e,n}(1);function jqe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),s;return function(o){for(s=0;s<r;++s)n[s]=e[s]*(1-o)+t[s]*o;return n}}function Pqe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Oqe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,s=new Array(n),o=new Array(r),d;for(d=0;d<n;++d)s[d]=ww(e[d],t[d]);for(;d<r;++d)o[d]=t[d];return function(i){for(d=0;d<n;++d)o[d]=s[d](i);return o}}function kqe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function ZO(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Nqe(e,t){var r={},n={},s;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in e?r[s]=ww(e[s],t[s]):n[s]=t[s];return function(o){for(s in r)n[s]=r[s](o);return n}}var Sz=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pL=new RegExp(Sz.source,"g");function Iqe(e){return function(){return e}}function Rqe(e){return function(t){return e(t)+""}}function Mqe(e,t){var r=Sz.lastIndex=pL.lastIndex=0,n,s,o,d=-1,i=[],m=[];for(e=e+"",t=t+"";(n=Sz.exec(e))&&(s=pL.exec(t));)(o=s.index)>r&&(o=t.slice(r,o),i[d]?i[d]+=o:i[++d]=o),(n=n[0])===(s=s[0])?i[d]?i[d]+=s:i[++d]=s:(i[++d]=null,m.push({i:d,x:ZO(n,s)})),r=pL.lastIndex;return r<t.length&&(o=t.slice(r),i[d]?i[d]+=o:i[++d]=o),i.length<2?m[0]?Rqe(m[0].x):Iqe(t):(t=m.length,function(y){for(var S=0,w;S<t;++S)i[(w=m[S]).i]=w.x(y);return i.join("")})}function ww(e,t){var r=typeof t,n;return t==null||r==="boolean"?k$(t):(r==="number"?ZO:r==="string"?(n=LT(t))?(t=n,Z7):Mqe:t instanceof LT?Z7:t instanceof Date?kqe:Pqe(t)?jqe:Array.isArray(t)?Oqe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Nqe:ZO)(e,t)}function N$(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function Dqe(e,t){t===void 0&&(t=e,e=ww);for(var r=0,n=t.length-1,s=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(s,s=t[++r]);return function(d){var i=Math.max(0,Math.min(n-1,Math.floor(d*=n)));return o[i](d-i)}}function Lqe(e){return function(){return e}}function XO(e){return+e}var X7=[0,1];function pc(e){return e}function Ez(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:Lqe(isNaN(t)?NaN:.5)}function Fqe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function zqe(e,t,r){var n=e[0],s=e[1],o=t[0],d=t[1];return s<n?(n=Ez(s,n),o=r(d,o)):(n=Ez(n,s),o=r(o,d)),function(i){return o(n(i))}}function Bqe(e,t,r){var n=Math.min(e.length,t.length)-1,s=new Array(n),o=new Array(n),d=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++d<n;)s[d]=Ez(e[d],e[d+1]),o[d]=r(t[d],t[d+1]);return function(i){var m=q2(e,i,1,n)-1;return o[m](s[m](i))}}function G2(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yI(){var e=X7,t=X7,r=ww,n,s,o,d=pc,i,m,y;function S(){var T=Math.min(e.length,t.length);return d!==pc&&(d=Fqe(e[0],e[T-1])),i=T>2?Bqe:zqe,m=y=null,w}function w(T){return T==null||isNaN(T=+T)?o:(m||(m=i(e.map(n),t,r)))(n(d(T)))}return w.invert=function(T){return d(s((y||(y=i(t,e.map(n),ZO)))(T)))},w.domain=function(T){return arguments.length?(e=Array.from(T,XO),S()):e.slice()},w.range=function(T){return arguments.length?(t=Array.from(T),S()):t.slice()},w.rangeRound=function(T){return t=Array.from(T),r=N$,S()},w.clamp=function(T){return arguments.length?(d=T?!0:pc,S()):d!==pc},w.interpolate=function(T){return arguments.length?(r=T,S()):r},w.unknown=function(T){return arguments.length?(o=T,w):o},function(T,A){return n=T,s=A,S()}}function I$(){return yI()(pc,pc)}function $qe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function YO(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function kb(e){return e=YO(Math.abs(e)),e?e[1]:NaN}function Uqe(e,t){return function(r,n){for(var s=r.length,o=[],d=0,i=e[0],m=0;s>0&&i>0&&(m+i+1>n&&(i=Math.max(1,n-m)),o.push(r.substring(s-=i,s+i)),!((m+=i+1)>n));)i=e[d=(d+1)%e.length];return o.reverse().join(t)}}function Vqe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var qqe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function FT(e){if(!(t=qqe.exec(e)))throw new Error("invalid format: "+e);var t;return new R$({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}FT.prototype=R$.prototype;function R$(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}R$.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Hqe(e){e:for(var t=e.length,r=1,n=-1,s;r<t;++r)switch(e[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(s+1):e}var Wle;function Gqe(e,t){var r=YO(e,t);if(!r)return e+"";var n=r[0],s=r[1],o=s-(Wle=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,d=n.length;return o===d?n:o>d?n+new Array(o-d+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+YO(e,Math.max(0,t+o-1))[0]}function Y7(e,t){var r=YO(e,t);if(!r)return e+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const J7={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:$qe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Y7(e*100,t),r:Y7,s:Gqe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Q7(e){return e}var eK=Array.prototype.map,tK=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Wqe(e){var t=e.grouping===void 0||e.thousands===void 0?Q7:Uqe(eK.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",s=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Q7:Vqe(eK.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",m=e.nan===void 0?"NaN":e.nan+"";function y(w){w=FT(w);var T=w.fill,A=w.align,O=w.sign,P=w.symbol,N=w.zero,R=w.width,M=w.comma,F=w.precision,B=w.trim,$=w.type;$==="n"?(M=!0,$="g"):J7[$]||(F===void 0&&(F=12),B=!0,$="g"),(N||T==="0"&&A==="=")&&(N=!0,T="0",A="=");var W=P==="$"?r:P==="#"&&/[boxX]/.test($)?"0"+$.toLowerCase():"",K=P==="$"?n:/[%p]/.test($)?d:"",te=J7[$],ne=/[defgprs%]/.test($);F=F===void 0?6:/[gprs]/.test($)?Math.max(1,Math.min(21,F)):Math.max(0,Math.min(20,F));function ae(re){var ee=W,ie=K,de,be,Se;if($==="c")ie=te(re)+ie,re="";else{re=+re;var Ae=re<0||1/re<0;if(re=isNaN(re)?m:te(Math.abs(re),F),B&&(re=Hqe(re)),Ae&&+re==0&&O!=="+"&&(Ae=!1),ee=(Ae?O==="("?O:i:O==="-"||O==="("?"":O)+ee,ie=($==="s"?tK[8+Wle/3]:"")+ie+(Ae&&O==="("?")":""),ne){for(de=-1,be=re.length;++de<be;)if(Se=re.charCodeAt(de),48>Se||Se>57){ie=(Se===46?s+re.slice(de+1):re.slice(de))+ie,re=re.slice(0,de);break}}}M&&!N&&(re=t(re,1/0));var xe=ee.length+re.length+ie.length,me=xe<R?new Array(R-xe+1).join(T):"";switch(M&&N&&(re=t(me+re,me.length?R-ie.length:1/0),me=""),A){case"<":re=ee+re+ie+me;break;case"=":re=ee+me+re+ie;break;case"^":re=me.slice(0,xe=me.length>>1)+ee+re+ie+me.slice(xe);break;default:re=me+ee+re+ie;break}return o(re)}return ae.toString=function(){return w+""},ae}function S(w,T){var A=y((w=FT(w),w.type="f",w)),O=Math.max(-8,Math.min(8,Math.floor(kb(T)/3)))*3,P=Math.pow(10,-O),N=tK[8+O/3];return function(R){return A(P*R)+N}}return{format:y,formatPrefix:S}}var Rj,M$,Kle;Kqe({thousands:",",grouping:[3],currency:["$",""]});function Kqe(e){return Rj=Wqe(e),M$=Rj.format,Kle=Rj.formatPrefix,Rj}function Zqe(e){return Math.max(0,-kb(Math.abs(e)))}function Xqe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kb(t)/3)))*3-kb(Math.abs(e)))}function Yqe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,kb(t)-kb(e))+1}function Zle(e,t,r,n){var s=xz(e,t,r),o;switch(n=FT(n??",f"),n.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=Xqe(s,d))&&(n.precision=o),Kle(n,d)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=Yqe(s,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=Zqe(s))&&(n.precision=o-(n.type==="%")*2);break}}return M$(n)}function Og(e){var t=e.domain;return e.ticks=function(r){var n=t();return vz(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var s=t();return Zle(s[0],s[s.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),s=0,o=n.length-1,d=n[s],i=n[o],m,y,S=10;for(i<d&&(y=d,d=i,i=y,y=s,s=o,o=y);S-- >0;){if(y=_z(d,i,r),y===m)return n[s]=d,n[o]=i,t(n);if(y>0)d=Math.floor(d/y)*y,i=Math.ceil(i/y)*y;else if(y<0)d=Math.ceil(d*y)/y,i=Math.floor(i*y)/y;else break;m=y}return e},e}function JO(){var e=I$();return e.copy=function(){return G2(e,JO())},rd.apply(e,arguments),Og(e)}function Xle(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,XO),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return Xle(e).unknown(t)},e=arguments.length?Array.from(e,XO):[0,1],Og(r)}function Yle(e,t){e=e.slice();var r=0,n=e.length-1,s=e[r],o=e[n],d;return o<s&&(d=r,r=n,n=d,d=s,s=o,o=d),e[r]=t.floor(s),e[n]=t.ceil(o),e}function rK(e){return Math.log(e)}function nK(e){return Math.exp(e)}function Jqe(e){return-Math.log(-e)}function Qqe(e){return-Math.exp(-e)}function e9e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function t9e(e){return e===10?e9e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function r9e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function iK(e){return(t,r)=>-e(-t,r)}function D$(e){const t=e(rK,nK),r=t.domain;let n=10,s,o;function d(){return s=r9e(n),o=t9e(n),r()[0]<0?(s=iK(s),o=iK(o),e(Jqe,Qqe)):e(rK,nK),t}return t.base=function(i){return arguments.length?(n=+i,d()):n},t.domain=function(i){return arguments.length?(r(i),d()):r()},t.ticks=i=>{const m=r();let y=m[0],S=m[m.length-1];const w=S<y;w&&([y,S]=[S,y]);let T=s(y),A=s(S),O,P;const N=i==null?10:+i;let R=[];if(!(n%1)&&A-T<N){if(T=Math.floor(T),A=Math.ceil(A),y>0){for(;T<=A;++T)for(O=1;O<n;++O)if(P=T<0?O/o(-T):O*o(T),!(P<y)){if(P>S)break;R.push(P)}}else for(;T<=A;++T)for(O=n-1;O>=1;--O)if(P=T>0?O/o(-T):O*o(T),!(P<y)){if(P>S)break;R.push(P)}R.length*2<N&&(R=vz(y,S,N))}else R=vz(T,A,Math.min(A-T,N)).map(o);return w?R.reverse():R},t.tickFormat=(i,m)=>{if(i==null&&(i=10),m==null&&(m=n===10?"s":","),typeof m!="function"&&(!(n%1)&&(m=FT(m)).precision==null&&(m.trim=!0),m=M$(m)),i===1/0)return m;const y=Math.max(1,n*i/t.ticks().length);return S=>{let w=S/o(Math.round(s(S)));return w*n<n-.5&&(w*=n),w<=y?m(S):""}},t.nice=()=>r(Yle(r(),{floor:i=>o(Math.floor(s(i))),ceil:i=>o(Math.ceil(s(i)))})),t}function Jle(){const e=D$(yI()).domain([1,10]);return e.copy=()=>G2(e,Jle()).base(e.base()),rd.apply(e,arguments),e}function sK(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function aK(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function L$(e){var t=1,r=e(sK(t),aK(t));return r.constant=function(n){return arguments.length?e(sK(t=+n),aK(t)):t},Og(r)}function Qle(){var e=L$(yI());return e.copy=function(){return G2(e,Qle()).constant(e.constant())},rd.apply(e,arguments)}function oK(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function n9e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function i9e(e){return e<0?-e*e:e*e}function F$(e){var t=e(pc,pc),r=1;function n(){return r===1?e(pc,pc):r===.5?e(n9e,i9e):e(oK(r),oK(1/r))}return t.exponent=function(s){return arguments.length?(r=+s,n()):r},Og(t)}function z$(){var e=F$(yI());return e.copy=function(){return G2(e,z$()).exponent(e.exponent())},rd.apply(e,arguments),e}function s9e(){return z$.apply(null,arguments).exponent(.5)}function lK(e){return Math.sign(e)*e*e}function a9e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function ece(){var e=I$(),t=[0,1],r=!1,n;function s(o){var d=a9e(e(o));return isNaN(d)?n:r?Math.round(d):d}return s.invert=function(o){return e.invert(lK(o))},s.domain=function(o){return arguments.length?(e.domain(o),s):e.domain()},s.range=function(o){return arguments.length?(e.range((t=Array.from(o,XO)).map(lK)),s):t.slice()},s.rangeRound=function(o){return s.range(o).round(!0)},s.round=function(o){return arguments.length?(r=!!o,s):r},s.clamp=function(o){return arguments.length?(e.clamp(o),s):e.clamp()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return ece(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},rd.apply(s,arguments),Og(s)}function tce(){var e=[],t=[],r=[],n;function s(){var d=0,i=Math.max(1,t.length);for(r=new Array(i-1);++d<i;)r[d-1]=dqe(e,d/i);return o}function o(d){return d==null||isNaN(d=+d)?n:t[q2(r,d)]}return o.invertExtent=function(d){var i=t.indexOf(d);return i<0?[NaN,NaN]:[i>0?r[i-1]:e[0],i<r.length?r[i]:e[e.length-1]]},o.domain=function(d){if(!arguments.length)return e.slice();e=[];for(let i of d)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(og),s()},o.range=function(d){return arguments.length?(t=Array.from(d),s()):t.slice()},o.unknown=function(d){return arguments.length?(n=d,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return tce().domain(e).range(t).unknown(n)},rd.apply(o,arguments)}function rce(){var e=0,t=1,r=1,n=[.5],s=[0,1],o;function d(m){return m!=null&&m<=m?s[q2(n,m,0,r)]:o}function i(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*t-(m-r)*e)/(r+1);return d}return d.domain=function(m){return arguments.length?([e,t]=m,e=+e,t=+t,i()):[e,t]},d.range=function(m){return arguments.length?(r=(s=Array.from(m)).length-1,i()):s.slice()},d.invertExtent=function(m){var y=s.indexOf(m);return y<0?[NaN,NaN]:y<1?[e,n[0]]:y>=r?[n[r-1],t]:[n[y-1],n[y]]},d.unknown=function(m){return arguments.length&&(o=m),d},d.thresholds=function(){return n.slice()},d.copy=function(){return rce().domain([e,t]).range(s).unknown(o)},rd.apply(Og(d),arguments)}function nce(){var e=[.5],t=[0,1],r,n=1;function s(o){return o!=null&&o<=o?t[q2(e,o,0,n)]:r}return s.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),s):e.slice()},s.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),s):t.slice()},s.invertExtent=function(o){var d=t.indexOf(o);return[e[d-1],e[d]]},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return nce().domain(e).range(t).unknown(r)},rd.apply(s,arguments)}const mL=new Date,gL=new Date;function rl(e,t,r,n){function s(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return s.floor=o=>(e(o=new Date(+o)),o),s.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),s.round=o=>{const d=s(o),i=s.ceil(o);return o-d<i-o?d:i},s.offset=(o,d)=>(t(o=new Date(+o),d==null?1:Math.floor(d)),o),s.range=(o,d,i)=>{const m=[];if(o=s.ceil(o),i=i==null?1:Math.floor(i),!(o<d)||!(i>0))return m;let y;do m.push(y=new Date(+o)),t(o,i),e(o);while(y<o&&o<d);return m},s.filter=o=>rl(d=>{if(d>=d)for(;e(d),!o(d);)d.setTime(d-1)},(d,i)=>{if(d>=d)if(i<0)for(;++i<=0;)for(;t(d,-1),!o(d););else for(;--i>=0;)for(;t(d,1),!o(d););}),r&&(s.count=(o,d)=>(mL.setTime(+o),gL.setTime(+d),e(mL),e(gL),Math.floor(r(mL,gL))),s.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?s.filter(n?d=>n(d)%o===0:d=>s.count(0,d)%o===0):s)),s}const QO=rl(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);QO.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?rl(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):QO);QO.range;const Gf=1e3,Gu=Gf*60,Wf=Gu*60,up=Wf*24,B$=up*7,cK=up*30,yL=up*365,nv=rl(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Gf)},(e,t)=>(t-e)/Gf,e=>e.getUTCSeconds());nv.range;const $$=rl(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gf)},(e,t)=>{e.setTime(+e+t*Gu)},(e,t)=>(t-e)/Gu,e=>e.getMinutes());$$.range;const U$=rl(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Gu)},(e,t)=>(t-e)/Gu,e=>e.getUTCMinutes());U$.range;const V$=rl(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gf-e.getMinutes()*Gu)},(e,t)=>{e.setTime(+e+t*Wf)},(e,t)=>(t-e)/Wf,e=>e.getHours());V$.range;const q$=rl(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Wf)},(e,t)=>(t-e)/Wf,e=>e.getUTCHours());q$.range;const W2=rl(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Gu)/up,e=>e.getDate()-1);W2.range;const vI=rl(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/up,e=>e.getUTCDate()-1);vI.range;const ice=rl(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/up,e=>Math.floor(e/up));ice.range;function i_(e){return rl(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Gu)/B$)}const _I=i_(0),ek=i_(1),o9e=i_(2),l9e=i_(3),Nb=i_(4),c9e=i_(5),u9e=i_(6);_I.range;ek.range;o9e.range;l9e.range;Nb.range;c9e.range;u9e.range;function s_(e){return rl(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/B$)}const xI=s_(0),tk=s_(1),d9e=s_(2),h9e=s_(3),Ib=s_(4),f9e=s_(5),p9e=s_(6);xI.range;tk.range;d9e.range;h9e.range;Ib.range;f9e.range;p9e.range;const H$=rl(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());H$.range;const G$=rl(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());G$.range;const dp=rl(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());dp.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:rl(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});dp.range;const hp=rl(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());hp.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:rl(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});hp.range;function sce(e,t,r,n,s,o){const d=[[nv,1,Gf],[nv,5,5*Gf],[nv,15,15*Gf],[nv,30,30*Gf],[o,1,Gu],[o,5,5*Gu],[o,15,15*Gu],[o,30,30*Gu],[s,1,Wf],[s,3,3*Wf],[s,6,6*Wf],[s,12,12*Wf],[n,1,up],[n,2,2*up],[r,1,B$],[t,1,cK],[t,3,3*cK],[e,1,yL]];function i(y,S,w){const T=S<y;T&&([y,S]=[S,y]);const A=w&&typeof w.range=="function"?w:m(y,S,w),O=A?A.range(y,+S+1):[];return T?O.reverse():O}function m(y,S,w){const T=Math.abs(S-y)/w,A=j$(([,,N])=>N).right(d,T);if(A===d.length)return e.every(xz(y/yL,S/yL,w));if(A===0)return QO.every(Math.max(xz(y,S,w),1));const[O,P]=d[T/d[A-1][2]<d[A][2]/T?A-1:A];return O.every(P)}return[i,m]}const[m9e,g9e]=sce(hp,G$,xI,ice,q$,U$),[y9e,v9e]=sce(dp,H$,_I,W2,V$,$$);function vL(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function _L(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function XS(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function _9e(e){var t=e.dateTime,r=e.date,n=e.time,s=e.periods,o=e.days,d=e.shortDays,i=e.months,m=e.shortMonths,y=YS(s),S=JS(s),w=YS(o),T=JS(o),A=YS(d),O=JS(d),P=YS(i),N=JS(i),R=YS(m),M=JS(m),F={a:Ae,A:xe,b:me,B:Ce,c:null,d:mK,e:mK,f:U9e,g:J9e,G:eHe,H:z9e,I:B9e,j:$9e,L:ace,m:V9e,M:q9e,p:ge,q:pe,Q:vK,s:_K,S:H9e,u:G9e,U:W9e,V:K9e,w:Z9e,W:X9e,x:null,X:null,y:Y9e,Y:Q9e,Z:tHe,"%":yK},B={a:Oe,A:Xe,b:We,B:$e,c:null,d:gK,e:gK,f:sHe,g:mHe,G:yHe,H:rHe,I:nHe,j:iHe,L:lce,m:aHe,M:oHe,p:Ke,q:Le,Q:vK,s:_K,S:lHe,u:cHe,U:uHe,V:dHe,w:hHe,W:fHe,x:null,X:null,y:pHe,Y:gHe,Z:vHe,"%":yK},$={a:ae,A:re,b:ee,B:ie,c:de,d:fK,e:fK,f:M9e,g:hK,G:dK,H:pK,I:pK,j:k9e,L:R9e,m:O9e,M:N9e,p:ne,q:P9e,Q:L9e,s:F9e,S:I9e,u:E9e,U:T9e,V:A9e,w:S9e,W:C9e,x:be,X:Se,y:hK,Y:dK,Z:j9e,"%":D9e};F.x=W(r,F),F.X=W(n,F),F.c=W(t,F),B.x=W(r,B),B.X=W(n,B),B.c=W(t,B);function W(ke,st){return function(_t){var Be=[],Dt=-1,It=0,ir=ke.length,Dr,Rr,jt;for(_t instanceof Date||(_t=new Date(+_t));++Dt<ir;)ke.charCodeAt(Dt)===37&&(Be.push(ke.slice(It,Dt)),(Rr=uK[Dr=ke.charAt(++Dt)])!=null?Dr=ke.charAt(++Dt):Rr=Dr==="e"?" ":"0",(jt=st[Dr])&&(Dr=jt(_t,Rr)),Be.push(Dr),It=Dt+1);return Be.push(ke.slice(It,Dt)),Be.join("")}}function K(ke,st){return function(_t){var Be=XS(1900,void 0,1),Dt=te(Be,ke,_t+="",0),It,ir;if(Dt!=_t.length)return null;if("Q"in Be)return new Date(Be.Q);if("s"in Be)return new Date(Be.s*1e3+("L"in Be?Be.L:0));if(st&&!("Z"in Be)&&(Be.Z=0),"p"in Be&&(Be.H=Be.H%12+Be.p*12),Be.m===void 0&&(Be.m="q"in Be?Be.q:0),"V"in Be){if(Be.V<1||Be.V>53)return null;"w"in Be||(Be.w=1),"Z"in Be?(It=_L(XS(Be.y,0,1)),ir=It.getUTCDay(),It=ir>4||ir===0?tk.ceil(It):tk(It),It=vI.offset(It,(Be.V-1)*7),Be.y=It.getUTCFullYear(),Be.m=It.getUTCMonth(),Be.d=It.getUTCDate()+(Be.w+6)%7):(It=vL(XS(Be.y,0,1)),ir=It.getDay(),It=ir>4||ir===0?ek.ceil(It):ek(It),It=W2.offset(It,(Be.V-1)*7),Be.y=It.getFullYear(),Be.m=It.getMonth(),Be.d=It.getDate()+(Be.w+6)%7)}else("W"in Be||"U"in Be)&&("w"in Be||(Be.w="u"in Be?Be.u%7:"W"in Be?1:0),ir="Z"in Be?_L(XS(Be.y,0,1)).getUTCDay():vL(XS(Be.y,0,1)).getDay(),Be.m=0,Be.d="W"in Be?(Be.w+6)%7+Be.W*7-(ir+5)%7:Be.w+Be.U*7-(ir+6)%7);return"Z"in Be?(Be.H+=Be.Z/100|0,Be.M+=Be.Z%100,_L(Be)):vL(Be)}}function te(ke,st,_t,Be){for(var Dt=0,It=st.length,ir=_t.length,Dr,Rr;Dt<It;){if(Be>=ir)return-1;if(Dr=st.charCodeAt(Dt++),Dr===37){if(Dr=st.charAt(Dt++),Rr=$[Dr in uK?st.charAt(Dt++):Dr],!Rr||(Be=Rr(ke,_t,Be))<0)return-1}else if(Dr!=_t.charCodeAt(Be++))return-1}return Be}function ne(ke,st,_t){var Be=y.exec(st.slice(_t));return Be?(ke.p=S.get(Be[0].toLowerCase()),_t+Be[0].length):-1}function ae(ke,st,_t){var Be=A.exec(st.slice(_t));return Be?(ke.w=O.get(Be[0].toLowerCase()),_t+Be[0].length):-1}function re(ke,st,_t){var Be=w.exec(st.slice(_t));return Be?(ke.w=T.get(Be[0].toLowerCase()),_t+Be[0].length):-1}function ee(ke,st,_t){var Be=R.exec(st.slice(_t));return Be?(ke.m=M.get(Be[0].toLowerCase()),_t+Be[0].length):-1}function ie(ke,st,_t){var Be=P.exec(st.slice(_t));return Be?(ke.m=N.get(Be[0].toLowerCase()),_t+Be[0].length):-1}function de(ke,st,_t){return te(ke,t,st,_t)}function be(ke,st,_t){return te(ke,r,st,_t)}function Se(ke,st,_t){return te(ke,n,st,_t)}function Ae(ke){return d[ke.getDay()]}function xe(ke){return o[ke.getDay()]}function me(ke){return m[ke.getMonth()]}function Ce(ke){return i[ke.getMonth()]}function ge(ke){return s[+(ke.getHours()>=12)]}function pe(ke){return 1+~~(ke.getMonth()/3)}function Oe(ke){return d[ke.getUTCDay()]}function Xe(ke){return o[ke.getUTCDay()]}function We(ke){return m[ke.getUTCMonth()]}function $e(ke){return i[ke.getUTCMonth()]}function Ke(ke){return s[+(ke.getUTCHours()>=12)]}function Le(ke){return 1+~~(ke.getUTCMonth()/3)}return{format:function(ke){var st=W(ke+="",F);return st.toString=function(){return ke},st},parse:function(ke){var st=K(ke+="",!1);return st.toString=function(){return ke},st},utcFormat:function(ke){var st=W(ke+="",B);return st.toString=function(){return ke},st},utcParse:function(ke){var st=K(ke+="",!0);return st.toString=function(){return ke},st}}}var uK={"-":"",_:" ",0:"0"},gl=/^\s*\d+/,x9e=/^%/,b9e=/[\\^$*+?|[\]().{}]/g;function js(e,t,r){var n=e<0?"-":"",s=(n?-e:e)+"",o=s.length;return n+(o<r?new Array(r-o+1).join(t)+s:s)}function w9e(e){return e.replace(b9e,"\\$&")}function YS(e){return new RegExp("^(?:"+e.map(w9e).join("|")+")","i")}function JS(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function S9e(e,t,r){var n=gl.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function E9e(e,t,r){var n=gl.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function T9e(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function A9e(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function C9e(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function dK(e,t,r){var n=gl.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function hK(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function j9e(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function P9e(e,t,r){var n=gl.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function O9e(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function fK(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function k9e(e,t,r){var n=gl.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function pK(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function N9e(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function I9e(e,t,r){var n=gl.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function R9e(e,t,r){var n=gl.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function M9e(e,t,r){var n=gl.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function D9e(e,t,r){var n=x9e.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function L9e(e,t,r){var n=gl.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function F9e(e,t,r){var n=gl.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function mK(e,t){return js(e.getDate(),t,2)}function z9e(e,t){return js(e.getHours(),t,2)}function B9e(e,t){return js(e.getHours()%12||12,t,2)}function $9e(e,t){return js(1+W2.count(dp(e),e),t,3)}function ace(e,t){return js(e.getMilliseconds(),t,3)}function U9e(e,t){return ace(e,t)+"000"}function V9e(e,t){return js(e.getMonth()+1,t,2)}function q9e(e,t){return js(e.getMinutes(),t,2)}function H9e(e,t){return js(e.getSeconds(),t,2)}function G9e(e){var t=e.getDay();return t===0?7:t}function W9e(e,t){return js(_I.count(dp(e)-1,e),t,2)}function oce(e){var t=e.getDay();return t>=4||t===0?Nb(e):Nb.ceil(e)}function K9e(e,t){return e=oce(e),js(Nb.count(dp(e),e)+(dp(e).getDay()===4),t,2)}function Z9e(e){return e.getDay()}function X9e(e,t){return js(ek.count(dp(e)-1,e),t,2)}function Y9e(e,t){return js(e.getFullYear()%100,t,2)}function J9e(e,t){return e=oce(e),js(e.getFullYear()%100,t,2)}function Q9e(e,t){return js(e.getFullYear()%1e4,t,4)}function eHe(e,t){var r=e.getDay();return e=r>=4||r===0?Nb(e):Nb.ceil(e),js(e.getFullYear()%1e4,t,4)}function tHe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+js(t/60|0,"0",2)+js(t%60,"0",2)}function gK(e,t){return js(e.getUTCDate(),t,2)}function rHe(e,t){return js(e.getUTCHours(),t,2)}function nHe(e,t){return js(e.getUTCHours()%12||12,t,2)}function iHe(e,t){return js(1+vI.count(hp(e),e),t,3)}function lce(e,t){return js(e.getUTCMilliseconds(),t,3)}function sHe(e,t){return lce(e,t)+"000"}function aHe(e,t){return js(e.getUTCMonth()+1,t,2)}function oHe(e,t){return js(e.getUTCMinutes(),t,2)}function lHe(e,t){return js(e.getUTCSeconds(),t,2)}function cHe(e){var t=e.getUTCDay();return t===0?7:t}function uHe(e,t){return js(xI.count(hp(e)-1,e),t,2)}function cce(e){var t=e.getUTCDay();return t>=4||t===0?Ib(e):Ib.ceil(e)}function dHe(e,t){return e=cce(e),js(Ib.count(hp(e),e)+(hp(e).getUTCDay()===4),t,2)}function hHe(e){return e.getUTCDay()}function fHe(e,t){return js(tk.count(hp(e)-1,e),t,2)}function pHe(e,t){return js(e.getUTCFullYear()%100,t,2)}function mHe(e,t){return e=cce(e),js(e.getUTCFullYear()%100,t,2)}function gHe(e,t){return js(e.getUTCFullYear()%1e4,t,4)}function yHe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Ib(e):Ib.ceil(e),js(e.getUTCFullYear()%1e4,t,4)}function vHe(){return"+0000"}function yK(){return"%"}function vK(e){return+e}function _K(e){return Math.floor(+e/1e3)}var Wx,uce,dce;_He({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function _He(e){return Wx=_9e(e),uce=Wx.format,Wx.parse,dce=Wx.utcFormat,Wx.utcParse,Wx}function xHe(e){return new Date(e)}function bHe(e){return e instanceof Date?+e:+new Date(+e)}function W$(e,t,r,n,s,o,d,i,m,y){var S=I$(),w=S.invert,T=S.domain,A=y(".%L"),O=y(":%S"),P=y("%I:%M"),N=y("%I %p"),R=y("%a %d"),M=y("%b %d"),F=y("%B"),B=y("%Y");function $(W){return(m(W)<W?A:i(W)<W?O:d(W)<W?P:o(W)<W?N:n(W)<W?s(W)<W?R:M:r(W)<W?F:B)(W)}return S.invert=function(W){return new Date(w(W))},S.domain=function(W){return arguments.length?T(Array.from(W,bHe)):T().map(xHe)},S.ticks=function(W){var K=T();return e(K[0],K[K.length-1],W??10)},S.tickFormat=function(W,K){return K==null?$:y(K)},S.nice=function(W){var K=T();return(!W||typeof W.range!="function")&&(W=t(K[0],K[K.length-1],W??10)),W?T(Yle(K,W)):S},S.copy=function(){return G2(S,W$(e,t,r,n,s,o,d,i,m,y))},S}function wHe(){return rd.apply(W$(y9e,v9e,dp,H$,_I,W2,V$,$$,nv,uce).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function SHe(){return rd.apply(W$(m9e,g9e,hp,G$,xI,vI,q$,U$,nv,dce).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function bI(){var e=0,t=1,r,n,s,o,d=pc,i=!1,m;function y(w){return w==null||isNaN(w=+w)?m:d(s===0?.5:(w=(o(w)-r)*s,i?Math.max(0,Math.min(1,w)):w))}y.domain=function(w){return arguments.length?([e,t]=w,r=o(e=+e),n=o(t=+t),s=r===n?0:1/(n-r),y):[e,t]},y.clamp=function(w){return arguments.length?(i=!!w,y):i},y.interpolator=function(w){return arguments.length?(d=w,y):d};function S(w){return function(T){var A,O;return arguments.length?([A,O]=T,d=w(A,O),y):[d(0),d(1)]}}return y.range=S(ww),y.rangeRound=S(N$),y.unknown=function(w){return arguments.length?(m=w,y):m},function(w){return o=w,r=w(e),n=w(t),s=r===n?0:1/(n-r),y}}function kg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function hce(){var e=Og(bI()(pc));return e.copy=function(){return kg(e,hce())},xp.apply(e,arguments)}function fce(){var e=D$(bI()).domain([1,10]);return e.copy=function(){return kg(e,fce()).base(e.base())},xp.apply(e,arguments)}function pce(){var e=L$(bI());return e.copy=function(){return kg(e,pce()).constant(e.constant())},xp.apply(e,arguments)}function K$(){var e=F$(bI());return e.copy=function(){return kg(e,K$()).exponent(e.exponent())},xp.apply(e,arguments)}function EHe(){return K$.apply(null,arguments).exponent(.5)}function mce(){var e=[],t=pc;function r(n){if(n!=null&&!isNaN(n=+n))return t((q2(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let s of n)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(og),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,s)=>t(s/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(s,o)=>uqe(e,o/n))},r.copy=function(){return mce(t).domain(e)},xp.apply(r,arguments)}function wI(){var e=0,t=.5,r=1,n=1,s,o,d,i,m,y=pc,S,w=!1,T;function A(P){return isNaN(P=+P)?T:(P=.5+((P=+S(P))-o)*(n*P<n*o?i:m),y(w?Math.max(0,Math.min(1,P)):P))}A.domain=function(P){return arguments.length?([e,t,r]=P,s=S(e=+e),o=S(t=+t),d=S(r=+r),i=s===o?0:.5/(o-s),m=o===d?0:.5/(d-o),n=o<s?-1:1,A):[e,t,r]},A.clamp=function(P){return arguments.length?(w=!!P,A):w},A.interpolator=function(P){return arguments.length?(y=P,A):y};function O(P){return function(N){var R,M,F;return arguments.length?([R,M,F]=N,y=Dqe(P,[R,M,F]),A):[y(0),y(.5),y(1)]}}return A.range=O(ww),A.rangeRound=O(N$),A.unknown=function(P){return arguments.length?(T=P,A):T},function(P){return S=P,s=P(e),o=P(t),d=P(r),i=s===o?0:.5/(o-s),m=o===d?0:.5/(d-o),n=o<s?-1:1,A}}function gce(){var e=Og(wI()(pc));return e.copy=function(){return kg(e,gce())},xp.apply(e,arguments)}function yce(){var e=D$(wI()).domain([.1,1,10]);return e.copy=function(){return kg(e,yce()).base(e.base())},xp.apply(e,arguments)}function vce(){var e=L$(wI());return e.copy=function(){return kg(e,vce()).constant(e.constant())},xp.apply(e,arguments)}function Z$(){var e=F$(wI());return e.copy=function(){return kg(e,Z$()).exponent(e.exponent())},xp.apply(e,arguments)}function THe(){return Z$.apply(null,arguments).exponent(.5)}const xK=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:RT,scaleDiverging:gce,scaleDivergingLog:yce,scaleDivergingPow:Z$,scaleDivergingSqrt:THe,scaleDivergingSymlog:vce,scaleIdentity:Xle,scaleImplicit:bz,scaleLinear:JO,scaleLog:Jle,scaleOrdinal:P$,scalePoint:LE,scalePow:z$,scaleQuantile:tce,scaleQuantize:rce,scaleRadial:ece,scaleSequential:hce,scaleSequentialLog:fce,scaleSequentialPow:K$,scaleSequentialQuantile:mce,scaleSequentialSqrt:EHe,scaleSequentialSymlog:pce,scaleSqrt:s9e,scaleSymlog:Qle,scaleThreshold:nce,scaleTime:wHe,scaleUtc:SHe,tickFormat:Zle},Symbol.toStringTag,{value:"Module"}));var AHe=fw;function CHe(e,t,r){for(var n=-1,s=e.length;++n<s;){var o=e[n],d=t(o);if(d!=null&&(i===void 0?d===d&&!AHe(d):r(d,i)))var i=d,m=o}return m}var SI=CHe;function jHe(e,t){return e>t}var _ce=jHe,PHe=SI,OHe=_ce,kHe=bw;function NHe(e){return e&&e.length?PHe(e,kHe,OHe):void 0}var IHe=NHe;const EI=Ps(IHe);function RHe(e,t){return e<t}var xce=RHe,MHe=SI,DHe=xce,LHe=bw;function FHe(e){return e&&e.length?MHe(e,LHe,DHe):void 0}var zHe=FHe;const TI=Ps(zHe);var BHe=c$,$He=nf,UHe=jle,VHe=Yc;function qHe(e,t){var r=VHe(e)?BHe:UHe;return r(e,$He(t))}var HHe=qHe,GHe=Ale,WHe=HHe;function KHe(e,t){return GHe(WHe(e,t),1)}var ZHe=KHe;const XHe=Ps(ZHe);var YHe=E$;function JHe(e,t){return YHe(e,t)}var bce=JHe;const K2=Ps(bce);var Sw=1e9,QHe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Y$,ja=!0,Yu="[DecimalError] ",_v=Yu+"Invalid argument: ",X$=Yu+"Exponent out of range: ",Ew=Math.floor,Hy=Math.pow,eGe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,pu,cl=1e7,pa=7,wce=9007199254740991,rk=Ew(wce/pa),Tn={};Tn.absoluteValue=Tn.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Tn.comparedTo=Tn.cmp=function(e){var t,r,n,s,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,s=e.d.length,t=0,r=n<s?n:s;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===s?0:n>s^o.s<0?1:-1};Tn.decimalPlaces=Tn.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*pa;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Tn.dividedBy=Tn.div=function(e){return Jf(this,new this.constructor(e))};Tn.dividedToIntegerBy=Tn.idiv=function(e){var t=this,r=t.constructor;return Js(Jf(t,new r(e),0,1),r.precision)};Tn.equals=Tn.eq=function(e){return!this.cmp(e)};Tn.exponent=function(){return Do(this)};Tn.greaterThan=Tn.gt=function(e){return this.cmp(e)>0};Tn.greaterThanOrEqualTo=Tn.gte=function(e){return this.cmp(e)>=0};Tn.isInteger=Tn.isint=function(){return this.e>this.d.length-2};Tn.isNegative=Tn.isneg=function(){return this.s<0};Tn.isPositive=Tn.ispos=function(){return this.s>0};Tn.isZero=function(){return this.s===0};Tn.lessThan=Tn.lt=function(e){return this.cmp(e)<0};Tn.lessThanOrEqualTo=Tn.lte=function(e){return this.cmp(e)<1};Tn.logarithm=Tn.log=function(e){var t,r=this,n=r.constructor,s=n.precision,o=s+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(pu))throw Error(Yu+"NaN");if(r.s<1)throw Error(Yu+(r.s?"NaN":"-Infinity"));return r.eq(pu)?new n(0):(ja=!1,t=Jf(zT(r,o),zT(e,o),o),ja=!0,Js(t,s))};Tn.minus=Tn.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Tce(t,e):Sce(t,(e.s=-e.s,e))};Tn.modulo=Tn.mod=function(e){var t,r=this,n=r.constructor,s=n.precision;if(e=new n(e),!e.s)throw Error(Yu+"NaN");return r.s?(ja=!1,t=Jf(r,e,0,1).times(e),ja=!0,r.minus(t)):Js(new n(r),s)};Tn.naturalExponential=Tn.exp=function(){return Ece(this)};Tn.naturalLogarithm=Tn.ln=function(){return zT(this)};Tn.negated=Tn.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Tn.plus=Tn.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Sce(t,e):Tce(t,(e.s=-e.s,e))};Tn.precision=Tn.sd=function(e){var t,r,n,s=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(_v+e);if(t=Do(s)+1,n=s.d.length-1,r=n*pa+1,n=s.d[n],n){for(;n%10==0;n/=10)r--;for(n=s.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Tn.squareRoot=Tn.sqrt=function(){var e,t,r,n,s,o,d,i=this,m=i.constructor;if(i.s<1){if(!i.s)return new m(0);throw Error(Yu+"NaN")}for(e=Do(i),ja=!1,s=Math.sqrt(+i),s==0||s==1/0?(t=Nh(i.d),(t.length+e)%2==0&&(t+="0"),s=Math.sqrt(t),e=Ew((e+1)/2)-(e<0||e%2),s==1/0?t="5e"+e:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new m(t)):n=new m(s.toString()),r=m.precision,s=d=r+3;;)if(o=n,n=o.plus(Jf(i,o,d+2)).times(.5),Nh(o.d).slice(0,d)===(t=Nh(n.d)).slice(0,d)){if(t=t.slice(d-3,d+1),s==d&&t=="4999"){if(Js(o,r+1,0),o.times(o).eq(i)){n=o;break}}else if(t!="9999")break;d+=4}return ja=!0,Js(n,r)};Tn.times=Tn.mul=function(e){var t,r,n,s,o,d,i,m,y,S=this,w=S.constructor,T=S.d,A=(e=new w(e)).d;if(!S.s||!e.s)return new w(0);for(e.s*=S.s,r=S.e+e.e,m=T.length,y=A.length,m<y&&(o=T,T=A,A=o,d=m,m=y,y=d),o=[],d=m+y,n=d;n--;)o.push(0);for(n=y;--n>=0;){for(t=0,s=m+n;s>n;)i=o[s]+A[n]*T[s-n-1]+t,o[s--]=i%cl|0,t=i/cl|0;o[s]=(o[s]+t)%cl|0}for(;!o[--d];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,ja?Js(e,w.precision):e};Tn.toDecimalPlaces=Tn.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Kh(e,0,Sw),t===void 0?t=n.rounding:Kh(t,0,8),Js(r,e+Do(r)+1,t))};Tn.toExponential=function(e,t){var r,n=this,s=n.constructor;return e===void 0?r=Uv(n,!0):(Kh(e,0,Sw),t===void 0?t=s.rounding:Kh(t,0,8),n=Js(new s(n),e+1,t),r=Uv(n,!0,e+1)),r};Tn.toFixed=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?Uv(s):(Kh(e,0,Sw),t===void 0?t=o.rounding:Kh(t,0,8),n=Js(new o(s),e+Do(s)+1,t),r=Uv(n.abs(),!1,e+Do(n)+1),s.isneg()&&!s.isZero()?"-"+r:r)};Tn.toInteger=Tn.toint=function(){var e=this,t=e.constructor;return Js(new t(e),Do(e)+1,t.rounding)};Tn.toNumber=function(){return+this};Tn.toPower=Tn.pow=function(e){var t,r,n,s,o,d,i=this,m=i.constructor,y=12,S=+(e=new m(e));if(!e.s)return new m(pu);if(i=new m(i),!i.s){if(e.s<1)throw Error(Yu+"Infinity");return i}if(i.eq(pu))return i;if(n=m.precision,e.eq(pu))return Js(i,n);if(t=e.e,r=e.d.length-1,d=t>=r,o=i.s,d){if((r=S<0?-S:S)<=wce){for(s=new m(pu),t=Math.ceil(n/pa+4),ja=!1;r%2&&(s=s.times(i),wK(s.d,t)),r=Ew(r/2),r!==0;)i=i.times(i),wK(i.d,t);return ja=!0,e.s<0?new m(pu).div(s):Js(s,n)}}else if(o<0)throw Error(Yu+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,i.s=1,ja=!1,s=e.times(zT(i,n+y)),ja=!0,s=Ece(s),s.s=o,s};Tn.toPrecision=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?(r=Do(s),n=Uv(s,r<=o.toExpNeg||r>=o.toExpPos)):(Kh(e,1,Sw),t===void 0?t=o.rounding:Kh(t,0,8),s=Js(new o(s),e,t),r=Do(s),n=Uv(s,e<=r||r<=o.toExpNeg,e)),n};Tn.toSignificantDigits=Tn.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Kh(e,1,Sw),t===void 0?t=n.rounding:Kh(t,0,8)),Js(new n(r),e,t)};Tn.toString=Tn.valueOf=Tn.val=Tn.toJSON=Tn[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Do(e),r=e.constructor;return Uv(e,t<=r.toExpNeg||t>=r.toExpPos)};function Sce(e,t){var r,n,s,o,d,i,m,y,S=e.constructor,w=S.precision;if(!e.s||!t.s)return t.s||(t=new S(e)),ja?Js(t,w):t;if(m=e.d,y=t.d,d=e.e,s=t.e,m=m.slice(),o=d-s,o){for(o<0?(n=m,o=-o,i=y.length):(n=y,s=d,i=m.length),d=Math.ceil(w/pa),i=d>i?d+1:i+1,o>i&&(o=i,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(i=m.length,o=y.length,i-o<0&&(o=i,n=y,y=m,m=n),r=0;o;)r=(m[--o]=m[o]+y[o]+r)/cl|0,m[o]%=cl;for(r&&(m.unshift(r),++s),i=m.length;m[--i]==0;)m.pop();return t.d=m,t.e=s,ja?Js(t,w):t}function Kh(e,t,r){if(e!==~~e||e<t||e>r)throw Error(_v+e)}function Nh(e){var t,r,n,s=e.length-1,o="",d=e[0];if(s>0){for(o+=d,t=1;t<s;t++)n=e[t]+"",r=pa-n.length,r&&(o+=Am(r)),o+=n;d=e[t],n=d+"",r=pa-n.length,r&&(o+=Am(r))}else if(d===0)return"0";for(;d%10===0;)d/=10;return o+d}var Jf=function(){function e(n,s){var o,d=0,i=n.length;for(n=n.slice();i--;)o=n[i]*s+d,n[i]=o%cl|0,d=o/cl|0;return d&&n.unshift(d),n}function t(n,s,o,d){var i,m;if(o!=d)m=o>d?1:-1;else for(i=m=0;i<o;i++)if(n[i]!=s[i]){m=n[i]>s[i]?1:-1;break}return m}function r(n,s,o){for(var d=0;o--;)n[o]-=d,d=n[o]<s[o]?1:0,n[o]=d*cl+n[o]-s[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,s,o,d){var i,m,y,S,w,T,A,O,P,N,R,M,F,B,$,W,K,te,ne=n.constructor,ae=n.s==s.s?1:-1,re=n.d,ee=s.d;if(!n.s)return new ne(n);if(!s.s)throw Error(Yu+"Division by zero");for(m=n.e-s.e,K=ee.length,$=re.length,A=new ne(ae),O=A.d=[],y=0;ee[y]==(re[y]||0);)++y;if(ee[y]>(re[y]||0)&&--m,o==null?M=o=ne.precision:d?M=o+(Do(n)-Do(s))+1:M=o,M<0)return new ne(0);if(M=M/pa+2|0,y=0,K==1)for(S=0,ee=ee[0],M++;(y<$||S)&&M--;y++)F=S*cl+(re[y]||0),O[y]=F/ee|0,S=F%ee|0;else{for(S=cl/(ee[0]+1)|0,S>1&&(ee=e(ee,S),re=e(re,S),K=ee.length,$=re.length),B=K,P=re.slice(0,K),N=P.length;N<K;)P[N++]=0;te=ee.slice(),te.unshift(0),W=ee[0],ee[1]>=cl/2&&++W;do S=0,i=t(ee,P,K,N),i<0?(R=P[0],K!=N&&(R=R*cl+(P[1]||0)),S=R/W|0,S>1?(S>=cl&&(S=cl-1),w=e(ee,S),T=w.length,N=P.length,i=t(w,P,T,N),i==1&&(S--,r(w,K<T?te:ee,T))):(S==0&&(i=S=1),w=ee.slice()),T=w.length,T<N&&w.unshift(0),r(P,w,N),i==-1&&(N=P.length,i=t(ee,P,K,N),i<1&&(S++,r(P,K<N?te:ee,N))),N=P.length):i===0&&(S++,P=[0]),O[y++]=S,i&&P[0]?P[N++]=re[B]||0:(P=[re[B]],N=1);while((B++<$||P[0]!==void 0)&&M--)}return O[0]||O.shift(),A.e=m,Js(A,d?o+Do(A)+1:o)}}();function Ece(e,t){var r,n,s,o,d,i,m=0,y=0,S=e.constructor,w=S.precision;if(Do(e)>16)throw Error(X$+Do(e));if(!e.s)return new S(pu);for(t==null?(ja=!1,i=w):i=t,d=new S(.03125);e.abs().gte(.1);)e=e.times(d),y+=5;for(n=Math.log(Hy(2,y))/Math.LN10*2+5|0,i+=n,r=s=o=new S(pu),S.precision=i;;){if(s=Js(s.times(e),i),r=r.times(++m),d=o.plus(Jf(s,r,i)),Nh(d.d).slice(0,i)===Nh(o.d).slice(0,i)){for(;y--;)o=Js(o.times(o),i);return S.precision=w,t==null?(ja=!0,Js(o,w)):o}o=d}}function Do(e){for(var t=e.e*pa,r=e.d[0];r>=10;r/=10)t++;return t}function xL(e,t,r){if(t>e.LN10.sd())throw ja=!0,r&&(e.precision=r),Error(Yu+"LN10 precision limit exceeded");return Js(new e(e.LN10),t)}function Am(e){for(var t="";e--;)t+="0";return t}function zT(e,t){var r,n,s,o,d,i,m,y,S,w=1,T=10,A=e,O=A.d,P=A.constructor,N=P.precision;if(A.s<1)throw Error(Yu+(A.s?"NaN":"-Infinity"));if(A.eq(pu))return new P(0);if(t==null?(ja=!1,y=N):y=t,A.eq(10))return t==null&&(ja=!0),xL(P,y);if(y+=T,P.precision=y,r=Nh(O),n=r.charAt(0),o=Do(A),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)A=A.times(e),r=Nh(A.d),n=r.charAt(0),w++;o=Do(A),n>1?(A=new P("0."+r),o++):A=new P(n+"."+r.slice(1))}else return m=xL(P,y+2,N).times(o+""),A=zT(new P(n+"."+r.slice(1)),y-T).plus(m),P.precision=N,t==null?(ja=!0,Js(A,N)):A;for(i=d=A=Jf(A.minus(pu),A.plus(pu),y),S=Js(A.times(A),y),s=3;;){if(d=Js(d.times(S),y),m=i.plus(Jf(d,new P(s),y)),Nh(m.d).slice(0,y)===Nh(i.d).slice(0,y))return i=i.times(2),o!==0&&(i=i.plus(xL(P,y+2,N).times(o+""))),i=Jf(i,new P(w),y),P.precision=N,t==null?(ja=!0,Js(i,N)):i;i=m,s+=2}}function bK(e,t){var r,n,s;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(s=t.length;t.charCodeAt(s-1)===48;)--s;if(t=t.slice(n,s),t){if(s-=n,r=r-n-1,e.e=Ew(r/pa),e.d=[],n=(r+1)%pa,r<0&&(n+=pa),n<s){for(n&&e.d.push(+t.slice(0,n)),s-=pa;n<s;)e.d.push(+t.slice(n,n+=pa));t=t.slice(n),n=pa-t.length}else n-=s;for(;n--;)t+="0";if(e.d.push(+t),ja&&(e.e>rk||e.e<-rk))throw Error(X$+r)}else e.s=0,e.e=0,e.d=[0];return e}function Js(e,t,r){var n,s,o,d,i,m,y,S,w=e.d;for(d=1,o=w[0];o>=10;o/=10)d++;if(n=t-d,n<0)n+=pa,s=t,y=w[S=0];else{if(S=Math.ceil((n+1)/pa),o=w.length,S>=o)return e;for(y=o=w[S],d=1;o>=10;o/=10)d++;n%=pa,s=n-pa+d}if(r!==void 0&&(o=Hy(10,d-s-1),i=y/o%10|0,m=t<0||w[S+1]!==void 0||y%o,m=r<4?(i||m)&&(r==0||r==(e.s<0?3:2)):i>5||i==5&&(r==4||m||r==6&&(n>0?s>0?y/Hy(10,d-s):0:w[S-1])%10&1||r==(e.s<0?8:7))),t<1||!w[0])return m?(o=Do(e),w.length=1,t=t-o-1,w[0]=Hy(10,(pa-t%pa)%pa),e.e=Ew(-t/pa)||0):(w.length=1,w[0]=e.e=e.s=0),e;if(n==0?(w.length=S,o=1,S--):(w.length=S+1,o=Hy(10,pa-n),w[S]=s>0?(y/Hy(10,d-s)%Hy(10,s)|0)*o:0),m)for(;;)if(S==0){(w[0]+=o)==cl&&(w[0]=1,++e.e);break}else{if(w[S]+=o,w[S]!=cl)break;w[S--]=0,o=1}for(n=w.length;w[--n]===0;)w.pop();if(ja&&(e.e>rk||e.e<-rk))throw Error(X$+Do(e));return e}function Tce(e,t){var r,n,s,o,d,i,m,y,S,w,T=e.constructor,A=T.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new T(e),ja?Js(t,A):t;if(m=e.d,w=t.d,n=t.e,y=e.e,m=m.slice(),d=y-n,d){for(S=d<0,S?(r=m,d=-d,i=w.length):(r=w,n=y,i=m.length),s=Math.max(Math.ceil(A/pa),i)+2,d>s&&(d=s,r.length=1),r.reverse(),s=d;s--;)r.push(0);r.reverse()}else{for(s=m.length,i=w.length,S=s<i,S&&(i=s),s=0;s<i;s++)if(m[s]!=w[s]){S=m[s]<w[s];break}d=0}for(S&&(r=m,m=w,w=r,t.s=-t.s),i=m.length,s=w.length-i;s>0;--s)m[i++]=0;for(s=w.length;s>d;){if(m[--s]<w[s]){for(o=s;o&&m[--o]===0;)m[o]=cl-1;--m[o],m[s]+=cl}m[s]-=w[s]}for(;m[--i]===0;)m.pop();for(;m[0]===0;m.shift())--n;return m[0]?(t.d=m,t.e=n,ja?Js(t,A):t):new T(0)}function Uv(e,t,r){var n,s=Do(e),o=Nh(e.d),d=o.length;return t?(r&&(n=r-d)>0?o=o.charAt(0)+"."+o.slice(1)+Am(n):d>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(s<0?"e":"e+")+s):s<0?(o="0."+Am(-s-1)+o,r&&(n=r-d)>0&&(o+=Am(n))):s>=d?(o+=Am(s+1-d),r&&(n=r-s-1)>0&&(o=o+"."+Am(n))):((n=s+1)<d&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-d)>0&&(s+1===d&&(o+="."),o+=Am(n))),e.s<0?"-"+o:o}function wK(e,t){if(e.length>t)return e.length=t,!0}function Ace(e){var t,r,n;function s(o){var d=this;if(!(d instanceof s))return new s(o);if(d.constructor=s,o instanceof s){d.s=o.s,d.e=o.e,d.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(_v+o);if(o>0)d.s=1;else if(o<0)o=-o,d.s=-1;else{d.s=0,d.e=0,d.d=[0];return}if(o===~~o&&o<1e7){d.e=0,d.d=[o];return}return bK(d,o.toString())}else if(typeof o!="string")throw Error(_v+o);if(o.charCodeAt(0)===45?(o=o.slice(1),d.s=-1):d.s=1,eGe.test(o))bK(d,o);else throw Error(_v+o)}if(s.prototype=Tn,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=Ace,s.config=s.set=tGe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return s.config(e),s}function tGe(e){if(!e||typeof e!="object")throw Error(Yu+"Object expected");var t,r,n,s=["precision",1,Sw,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<s.length;t+=3)if((n=e[r=s[t]])!==void 0)if(Ew(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(_v+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(_v+r+": "+n);return this}var Y$=Ace(QHe);pu=new Y$(1);const Gs=Y$;function rGe(e){return aGe(e)||sGe(e)||iGe(e)||nGe()}function nGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iGe(e,t){if(e){if(typeof e=="string")return Tz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tz(e,t)}}function sGe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function aGe(e){if(Array.isArray(e))return Tz(e)}function Tz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var oGe=function(t){return t},Cce={"@@functional/placeholder":!0},jce=function(t){return t===Cce},SK=function(t){return function r(){return arguments.length===0||arguments.length===1&&jce(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},lGe=function e(t,r){return t===1?r:SK(function(){for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];var d=s.filter(function(i){return i!==Cce}).length;return d>=t?r.apply(void 0,s):e(t-d,SK(function(){for(var i=arguments.length,m=new Array(i),y=0;y<i;y++)m[y]=arguments[y];var S=s.map(function(w){return jce(w)?m.shift():w});return r.apply(void 0,rGe(S).concat(m))}))})},AI=function(t){return lGe(t.length,t)},Az=function(t,r){for(var n=[],s=t;s<r;++s)n[s-t]=s;return n},cGe=AI(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),uGe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return oGe;var s=r.reverse(),o=s[0],d=s.slice(1);return function(){return d.reduce(function(i,m){return m(i)},o.apply(void 0,arguments))}},Cz=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},Pce=function(t){var r=null,n=null;return function(){for(var s=arguments.length,o=new Array(s),d=0;d<s;d++)o[d]=arguments[d];return r&&o.every(function(i,m){return i===r[m]})||(r=o,n=t.apply(void 0,o)),n}};function dGe(e){var t;return e===0?t=1:t=Math.floor(new Gs(e).abs().log(10).toNumber())+1,t}function hGe(e,t,r){for(var n=new Gs(e),s=0,o=[];n.lt(t)&&s<1e5;)o.push(n.toNumber()),n=n.add(r),s++;return o}var fGe=AI(function(e,t,r){var n=+e,s=+t;return n+r*(s-n)}),pGe=AI(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),mGe=AI(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const CI={rangeStep:hGe,getDigitCount:dGe,interpolateNumber:fGe,uninterpolateNumber:pGe,uninterpolateTruncation:mGe};function jz(e){return vGe(e)||yGe(e)||Oce(e)||gGe()}function gGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yGe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function vGe(e){if(Array.isArray(e))return Pz(e)}function BT(e,t){return bGe(e)||xGe(e,t)||Oce(e,t)||_Ge()}function _Ge(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Oce(e,t){if(e){if(typeof e=="string")return Pz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pz(e,t)}}function Pz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xGe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,s=!1,o=void 0;try{for(var d=e[Symbol.iterator](),i;!(n=(i=d.next()).done)&&(r.push(i.value),!(t&&r.length===t));n=!0);}catch(m){s=!0,o=m}finally{try{!n&&d.return!=null&&d.return()}finally{if(s)throw o}}return r}}function bGe(e){if(Array.isArray(e))return e}function kce(e){var t=BT(e,2),r=t[0],n=t[1],s=r,o=n;return r>n&&(s=n,o=r),[s,o]}function Nce(e,t,r){if(e.lte(0))return new Gs(0);var n=CI.getDigitCount(e.toNumber()),s=new Gs(10).pow(n),o=e.div(s),d=n!==1?.05:.1,i=new Gs(Math.ceil(o.div(d).toNumber())).add(r).mul(d),m=i.mul(s);return t?m:new Gs(Math.ceil(m))}function wGe(e,t,r){var n=1,s=new Gs(e);if(!s.isint()&&r){var o=Math.abs(e);o<1?(n=new Gs(10).pow(CI.getDigitCount(e)-1),s=new Gs(Math.floor(s.div(n).toNumber())).mul(n)):o>1&&(s=new Gs(Math.floor(e)))}else e===0?s=new Gs(Math.floor((t-1)/2)):r||(s=new Gs(Math.floor(e)));var d=Math.floor((t-1)/2),i=uGe(cGe(function(m){return s.add(new Gs(m-d).mul(n)).toNumber()}),Az);return i(0,t)}function Ice(e,t,r,n){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Gs(0),tickMin:new Gs(0),tickMax:new Gs(0)};var o=Nce(new Gs(t).sub(e).div(r-1),n,s),d;e<=0&&t>=0?d=new Gs(0):(d=new Gs(e).add(t).div(2),d=d.sub(new Gs(d).mod(o)));var i=Math.ceil(d.sub(e).div(o).toNumber()),m=Math.ceil(new Gs(t).sub(d).div(o).toNumber()),y=i+m+1;return y>r?Ice(e,t,r,n,s+1):(y<r&&(m=t>0?m+(r-y):m,i=t>0?i:i+(r-y)),{step:o,tickMin:d.sub(new Gs(i).mul(o)),tickMax:d.add(new Gs(m).mul(o))})}function SGe(e){var t=BT(e,2),r=t[0],n=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,d=Math.max(s,2),i=kce([r,n]),m=BT(i,2),y=m[0],S=m[1];if(y===-1/0||S===1/0){var w=S===1/0?[y].concat(jz(Az(0,s-1).map(function(){return 1/0}))):[].concat(jz(Az(0,s-1).map(function(){return-1/0})),[S]);return r>n?Cz(w):w}if(y===S)return wGe(y,s,o);var T=Ice(y,S,d,o),A=T.step,O=T.tickMin,P=T.tickMax,N=CI.rangeStep(O,P.add(new Gs(.1).mul(A)),A);return r>n?Cz(N):N}function EGe(e,t){var r=BT(e,2),n=r[0],s=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,d=kce([n,s]),i=BT(d,2),m=i[0],y=i[1];if(m===-1/0||y===1/0)return[n,s];if(m===y)return[m];var S=Math.max(t,2),w=Nce(new Gs(y).sub(m).div(S-1),o,0),T=[].concat(jz(CI.rangeStep(new Gs(m),new Gs(y).sub(new Gs(.99).mul(w)),w)),[y]);return n>s?Cz(T):T}var TGe=Pce(SGe),AGe=Pce(EGe),CGe="Invariant failed";function Vv(e,t){throw new Error(CGe)}var jGe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Rb(e){"@babel/helpers - typeof";return Rb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rb(e)}function nk(){return nk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nk.apply(this,arguments)}function PGe(e,t){return IGe(e)||NGe(e,t)||kGe(e,t)||OGe()}function OGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kGe(e,t){if(e){if(typeof e=="string")return EK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return EK(e,t)}}function EK(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function NGe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function IGe(e){if(Array.isArray(e))return e}function RGe(e,t){if(e==null)return{};var r=MGe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function MGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function DGe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LGe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dce(n.key),n)}}function FGe(e,t,r){return t&&LGe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function zGe(e,t,r){return t=ik(t),BGe(e,Rce()?Reflect.construct(t,r||[],ik(e).constructor):t.apply(e,r))}function BGe(e,t){if(t&&(Rb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $Ge(e)}function $Ge(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Rce=function(){return!!e})()}function ik(e){return ik=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ik(e)}function UGe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oz(e,t)}function Oz(e,t){return Oz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Oz(e,t)}function Mce(e,t,r){return t=Dce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dce(e){var t=VGe(e,"string");return Rb(t)=="symbol"?t:t+""}function VGe(e,t){if(Rb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Rb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Z2=function(e){function t(){return DGe(this,t),zGe(this,t,arguments)}return UGe(t,e),FGe(t,[{key:"render",value:function(){var n=this.props,s=n.offset,o=n.layout,d=n.width,i=n.dataKey,m=n.data,y=n.dataPointFormatter,S=n.xAxis,w=n.yAxis,T=RGe(n,jGe),A=Jn(T,!1);this.props.direction==="x"&&S.type!=="number"&&Vv();var O=m.map(function(P){var N=y(P,i),R=N.x,M=N.y,F=N.value,B=N.errorVal;if(!B)return null;var $=[],W,K;if(Array.isArray(B)){var te=PGe(B,2);W=te[0],K=te[1]}else W=K=B;if(o==="vertical"){var ne=S.scale,ae=M+s,re=ae+d,ee=ae-d,ie=ne(F-W),de=ne(F+K);$.push({x1:de,y1:re,x2:de,y2:ee}),$.push({x1:ie,y1:ae,x2:de,y2:ae}),$.push({x1:ie,y1:re,x2:ie,y2:ee})}else if(o==="horizontal"){var be=w.scale,Se=R+s,Ae=Se-d,xe=Se+d,me=be(F-W),Ce=be(F+K);$.push({x1:Ae,y1:Ce,x2:xe,y2:Ce}),$.push({x1:Se,y1:me,x2:Se,y2:Ce}),$.push({x1:Ae,y1:me,x2:xe,y2:me})}return Ve.createElement(Cs,nk({className:"recharts-errorBar",key:"bar-".concat($.map(function(ge){return"".concat(ge.x1,"-").concat(ge.x2,"-").concat(ge.y1,"-").concat(ge.y2)}))},A),$.map(function(ge){return Ve.createElement("line",nk({},ge,{key:"line-".concat(ge.x1,"-").concat(ge.x2,"-").concat(ge.y1,"-").concat(ge.y2)}))}))});return Ve.createElement(Cs,{className:"recharts-errorBars"},O)}}])}(Ve.Component);Mce(Z2,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});Mce(Z2,"displayName","ErrorBar");function $T(e){"@babel/helpers - typeof";return $T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$T(e)}function TK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ry(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TK(Object(r),!0).forEach(function(n){qGe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qGe(e,t,r){return t=HGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HGe(e){var t=GGe(e,"string");return $T(t)=="symbol"?t:t+""}function GGe(e,t){if($T(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($T(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Lce=function(t){var r=t.children,n=t.formattedGraphicalItems,s=t.legendWidth,o=t.legendContent,d=lu(r,kh);if(!d)return null;var i=kh.defaultProps,m=i!==void 0?Ry(Ry({},i),d.props):{},y;return d.props&&d.props.payload?y=d.props&&d.props.payload:o==="children"?y=(n||[]).reduce(function(S,w){var T=w.item,A=w.props,O=A.sectors||A.data||[];return S.concat(O.map(function(P){return{type:d.props.iconType||T.props.legendType,value:P.name,color:P.fill,payload:P}}))},[]):y=(n||[]).map(function(S){var w=S.item,T=w.type.defaultProps,A=T!==void 0?Ry(Ry({},T),w.props):{},O=A.dataKey,P=A.name,N=A.legendType,R=A.hide;return{inactive:R,dataKey:O,type:m.iconType||N||"square",color:J$(w),value:P||O,payload:A}}),Ry(Ry(Ry({},m),kh.getWithHeight(d,s)),{},{payload:y,item:d})};function UT(e){"@babel/helpers - typeof";return UT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},UT(e)}function AK(e){return XGe(e)||ZGe(e)||KGe(e)||WGe()}function WGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KGe(e,t){if(e){if(typeof e=="string")return kz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kz(e,t)}}function ZGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function XGe(e){if(Array.isArray(e))return kz(e)}function kz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function CK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ro(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CK(Object(r),!0).forEach(function(n){B0(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function B0(e,t,r){return t=YGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YGe(e){var t=JGe(e,"string");return UT(t)=="symbol"?t:t+""}function JGe(e,t){if(UT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(UT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jo(e,t,r){return Oi(e)||Oi(t)?r:el(t)?_u(e,t,r):vi(t)?t(e):r}function FE(e,t,r,n){var s=XHe(e,function(i){return Jo(i,t)});if(r==="number"){var o=s.filter(function(i){return Gr(i)||parseFloat(i)});return o.length?[TI(o),EI(o)]:[1/0,-1/0]}var d=n?s.filter(function(i){return!Oi(i)}):s;return d.map(function(i){return el(i)||i instanceof Date?i:""})}var QGe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,d=-1,i=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(i<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var m=o.range,y=0;y<i;y++){var S=y>0?s[y-1].coordinate:s[i-1].coordinate,w=s[y].coordinate,T=y>=i-1?s[0].coordinate:s[y+1].coordinate,A=void 0;if(hc(w-S)!==hc(T-w)){var O=[];if(hc(T-w)===hc(m[1]-m[0])){A=T;var P=w+m[1]-m[0];O[0]=Math.min(P,(P+S)/2),O[1]=Math.max(P,(P+S)/2)}else{A=S;var N=T+m[1]-m[0];O[0]=Math.min(w,(N+w)/2),O[1]=Math.max(w,(N+w)/2)}var R=[Math.min(w,(A+w)/2),Math.max(w,(A+w)/2)];if(t>R[0]&&t<=R[1]||t>=O[0]&&t<=O[1]){d=s[y].index;break}}else{var M=Math.min(S,T),F=Math.max(S,T);if(t>(M+w)/2&&t<=(F+w)/2){d=s[y].index;break}}}else for(var B=0;B<i;B++)if(B===0&&t<=(n[B].coordinate+n[B+1].coordinate)/2||B>0&&B<i-1&&t>(n[B].coordinate+n[B-1].coordinate)/2&&t<=(n[B].coordinate+n[B+1].coordinate)/2||B===i-1&&t>(n[B].coordinate+n[B-1].coordinate)/2){d=n[B].index;break}return d},J$=function(t){var r,n=t,s=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?ro(ro({},t.type.defaultProps),t.props):t.props,d=o.stroke,i=o.fill,m;switch(s){case"Line":m=d;break;case"Area":case"Radar":m=d&&d!=="none"?d:i;break;default:m=i;break}return m},eWe=function(t){var r=t.barSize,n=t.totalSize,s=t.stackGroups,o=s===void 0?{}:s;if(!o)return{};for(var d={},i=Object.keys(o),m=0,y=i.length;m<y;m++)for(var S=o[i[m]].stackGroups,w=Object.keys(S),T=0,A=w.length;T<A;T++){var O=S[w[T]],P=O.items,N=O.cateAxisId,R=P.filter(function(K){return Yf(K.type).indexOf("Bar")>=0});if(R&&R.length){var M=R[0].type.defaultProps,F=M!==void 0?ro(ro({},M),R[0].props):R[0].props,B=F.barSize,$=F[N];d[$]||(d[$]=[]);var W=Oi(B)?r:B;d[$].push({item:R[0],stackList:R.slice(1),barSize:Oi(W)?void 0:fc(W,n,0)})}}return d},tWe=function(t){var r=t.barGap,n=t.barCategoryGap,s=t.bandSize,o=t.sizeList,d=o===void 0?[]:o,i=t.maxBarSize,m=d.length;if(m<1)return null;var y=fc(r,s,0,!0),S,w=[];if(d[0].barSize===+d[0].barSize){var T=!1,A=s/m,O=d.reduce(function(B,$){return B+$.barSize||0},0);O+=(m-1)*y,O>=s&&(O-=(m-1)*y,y=0),O>=s&&A>0&&(T=!0,A*=.9,O=m*A);var P=(s-O)/2>>0,N={offset:P-y,size:0};S=d.reduce(function(B,$){var W={item:$.item,position:{offset:N.offset+N.size+y,size:T?A:$.barSize}},K=[].concat(AK(B),[W]);return N=K[K.length-1].position,$.stackList&&$.stackList.length&&$.stackList.forEach(function(te){K.push({item:te,position:N})}),K},w)}else{var R=fc(n,s,0,!0);s-2*R-(m-1)*y<=0&&(y=0);var M=(s-2*R-(m-1)*y)/m;M>1&&(M>>=0);var F=i===+i?Math.min(M,i):M;S=d.reduce(function(B,$,W){var K=[].concat(AK(B),[{item:$.item,position:{offset:R+(M+y)*W+(M-F)/2,size:F}}]);return $.stackList&&$.stackList.length&&$.stackList.forEach(function(te){K.push({item:te,position:K[K.length-1].position})}),K},w)}return S},rWe=function(t,r,n,s){var o=n.children,d=n.width,i=n.margin,m=d-(i.left||0)-(i.right||0),y=Lce({children:o,legendWidth:m});if(y){var S=s||{},w=S.width,T=S.height,A=y.align,O=y.verticalAlign,P=y.layout;if((P==="vertical"||P==="horizontal"&&O==="middle")&&A!=="center"&&Gr(t[A]))return ro(ro({},t),{},B0({},A,t[A]+(w||0)));if((P==="horizontal"||P==="vertical"&&A==="center")&&O!=="middle"&&Gr(t[O]))return ro(ro({},t),{},B0({},O,t[O]+(T||0)))}return t},nWe=function(t,r,n){return Oi(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},Fce=function(t,r,n,s,o){var d=r.props.children,i=xu(d,Z2).filter(function(y){return nWe(s,o,y.props.direction)});if(i&&i.length){var m=i.map(function(y){return y.props.dataKey});return t.reduce(function(y,S){var w=Jo(S,n);if(Oi(w))return y;var T=Array.isArray(w)?[TI(w),EI(w)]:[w,w],A=m.reduce(function(O,P){var N=Jo(S,P,0),R=T[0]-Math.abs(Array.isArray(N)?N[0]:N),M=T[1]+Math.abs(Array.isArray(N)?N[1]:N);return[Math.min(R,O[0]),Math.max(M,O[1])]},[1/0,-1/0]);return[Math.min(A[0],y[0]),Math.max(A[1],y[1])]},[1/0,-1/0])}return null},iWe=function(t,r,n,s,o){var d=r.map(function(i){return Fce(t,i,n,o,s)}).filter(function(i){return!Oi(i)});return d&&d.length?d.reduce(function(i,m){return[Math.min(i[0],m[0]),Math.max(i[1],m[1])]},[1/0,-1/0]):null},zce=function(t,r,n,s,o){var d=r.map(function(m){var y=m.props.dataKey;return n==="number"&&y&&Fce(t,m,y,s)||FE(t,y,n,o)});if(n==="number")return d.reduce(function(m,y){return[Math.min(m[0],y[0]),Math.max(m[1],y[1])]},[1/0,-1/0]);var i={};return d.reduce(function(m,y){for(var S=0,w=y.length;S<w;S++)i[y[S]]||(i[y[S]]=!0,m.push(y[S]));return m},[])},Bce=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},$ce=function(t,r,n,s){if(s)return t.map(function(m){return m.coordinate});var o,d,i=t.map(function(m){return m.coordinate===r&&(o=!0),m.coordinate===n&&(d=!0),m.coordinate});return o||i.push(r),d||i.push(n),i},Kf=function(t,r,n){if(!t)return null;var s=t.scale,o=t.duplicateDomain,d=t.type,i=t.range,m=t.realScaleType==="scaleBand"?s.bandwidth()/2:2,y=(r||n)&&d==="category"&&s.bandwidth?s.bandwidth()/m:0;if(y=t.axisType==="angleAxis"&&(i==null?void 0:i.length)>=2?hc(i[0]-i[1])*2*y:y,r&&(t.ticks||t.niceTicks)){var S=(t.ticks||t.niceTicks).map(function(w){var T=o?o.indexOf(w):w;return{coordinate:s(T)+y,value:w,offset:y}});return S.filter(function(w){return!U2(w.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(w,T){return{coordinate:s(w)+y,value:w,index:T,offset:y}}):s.ticks&&!n?s.ticks(t.tickCount).map(function(w){return{coordinate:s(w)+y,value:w,offset:y}}):s.domain().map(function(w,T){return{coordinate:s(w)+y,value:o?o[w]:w,index:T,offset:y}})},bL=new WeakMap,Mj=function(t,r){if(typeof r!="function")return t;bL.has(t)||bL.set(t,new WeakMap);var n=bL.get(t);if(n.has(r))return n.get(r);var s=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,s),s},Uce=function(t,r,n){var s=t.scale,o=t.type,d=t.layout,i=t.axisType;if(s==="auto")return d==="radial"&&i==="radiusAxis"?{scale:RT(),realScaleType:"band"}:d==="radial"&&i==="angleAxis"?{scale:JO(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:LE(),realScaleType:"point"}:o==="category"?{scale:RT(),realScaleType:"band"}:{scale:JO(),realScaleType:"linear"};if(zv(s)){var m="scale".concat(uI(s));return{scale:(xK[m]||LE)(),realScaleType:xK[m]?m:"point"}}return vi(s)?{scale:s}:{scale:LE(),realScaleType:"point"}},jK=1e-4,Vce=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,s=t.range(),o=Math.min(s[0],s[1])-jK,d=Math.max(s[0],s[1])+jK,i=t(r[0]),m=t(r[n-1]);(i<o||i>d||m<o||m>d)&&t.domain([r[0],r[n-1]])}},sWe=function(t,r){if(!t)return null;for(var n=0,s=t.length;n<s;n++)if(t[n].item===r)return t[n].position;return null},aWe=function(t,r){if(!r||r.length!==2||!Gr(r[0])||!Gr(r[1]))return t;var n=Math.min(r[0],r[1]),s=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!Gr(t[0])||t[0]<n)&&(o[0]=n),(!Gr(t[1])||t[1]>s)&&(o[1]=s),o[0]>s&&(o[0]=s),o[1]<n&&(o[1]=n),o},oWe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,d=0,i=0;i<r;++i){var m=U2(t[i][n][1])?t[i][n][0]:t[i][n][1];m>=0?(t[i][n][0]=o,t[i][n][1]=o+m,o=t[i][n][1]):(t[i][n][0]=d,t[i][n][1]=d+m,d=t[i][n][1])}},lWe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,d=0;d<r;++d){var i=U2(t[d][n][1])?t[d][n][0]:t[d][n][1];i>=0?(t[d][n][0]=o,t[d][n][1]=o+i,o=t[d][n][1]):(t[d][n][0]=0,t[d][n][1]=0)}},cWe={sign:oWe,expand:PFe,none:Ab,silhouette:OFe,wiggle:kFe,positive:lWe},uWe=function(t,r,n){var s=r.map(function(i){return i.props.dataKey}),o=cWe[n],d=jFe().keys(s).value(function(i,m){return+Jo(i,m,0)}).order(rz).offset(o);return d(t)},dWe=function(t,r,n,s,o,d){if(!t)return null;var i=d?r.reverse():r,m={},y=i.reduce(function(w,T){var A,O=(A=T.type)!==null&&A!==void 0&&A.defaultProps?ro(ro({},T.type.defaultProps),T.props):T.props,P=O.stackId,N=O.hide;if(N)return w;var R=O[n],M=w[R]||{hasStack:!1,stackGroups:{}};if(el(P)){var F=M.stackGroups[P]||{numericAxisId:n,cateAxisId:s,items:[]};F.items.push(T),M.hasStack=!0,M.stackGroups[P]=F}else M.stackGroups[vw("_stackId_")]={numericAxisId:n,cateAxisId:s,items:[T]};return ro(ro({},w),{},B0({},R,M))},m),S={};return Object.keys(y).reduce(function(w,T){var A=y[T];if(A.hasStack){var O={};A.stackGroups=Object.keys(A.stackGroups).reduce(function(P,N){var R=A.stackGroups[N];return ro(ro({},P),{},B0({},N,{numericAxisId:n,cateAxisId:s,items:R.items,stackedData:uWe(t,R.items,o)}))},O)}return ro(ro({},w),{},B0({},T,A))},S)},qce=function(t,r){var n=r.realScaleType,s=r.type,o=r.tickCount,d=r.originalDomain,i=r.allowDecimals,m=n||r.scale;if(m!=="auto"&&m!=="linear")return null;if(o&&s==="number"&&d&&(d[0]==="auto"||d[1]==="auto")){var y=t.domain();if(!y.length)return null;var S=TGe(y,o,i);return t.domain([TI(S),EI(S)]),{niceTicks:S}}if(o&&s==="number"){var w=t.domain(),T=AGe(w,o,i);return{niceTicks:T}}return null};function PK(e){var t=e.axis,r=e.ticks,n=e.bandSize,s=e.entry,o=e.index,d=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Oi(s[t.dataKey])){var i=kO(r,"value",s[t.dataKey]);if(i)return i.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var m=Jo(s,Oi(d)?t.dataKey:d);return Oi(m)?null:t.scale(m)}var OK=function(t){var r=t.axis,n=t.ticks,s=t.offset,o=t.bandSize,d=t.entry,i=t.index;if(r.type==="category")return n[i]?n[i].coordinate+s:null;var m=Jo(d,r.dataKey,r.domain[i]);return Oi(m)?null:r.scale(m)-o/2+s},hWe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var s=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return s<=0&&o>=0?0:o<0?o:s}return n[0]},fWe=function(t,r){var n,s=(n=t.type)!==null&&n!==void 0&&n.defaultProps?ro(ro({},t.type.defaultProps),t.props):t.props,o=s.stackId;if(el(o)){var d=r[o];if(d){var i=d.items.indexOf(t);return i>=0?d.stackedData[i]:null}}return null},pWe=function(t){return t.reduce(function(r,n){return[TI(n.concat([r[0]]).filter(Gr)),EI(n.concat([r[1]]).filter(Gr))]},[1/0,-1/0])},Hce=function(t,r,n){return Object.keys(t).reduce(function(s,o){var d=t[o],i=d.stackedData,m=i.reduce(function(y,S){var w=pWe(S.slice(r,n+1));return[Math.min(y[0],w[0]),Math.max(y[1],w[1])]},[1/0,-1/0]);return[Math.min(m[0],s[0]),Math.max(m[1],s[1])]},[1/0,-1/0]).map(function(s){return s===1/0||s===-1/0?0:s})},kK=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,NK=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Nz=function(t,r,n){if(vi(t))return t(r,n);if(!Array.isArray(t))return r;var s=[];if(Gr(t[0]))s[0]=n?t[0]:Math.min(t[0],r[0]);else if(kK.test(t[0])){var o=+kK.exec(t[0])[1];s[0]=r[0]-o}else vi(t[0])?s[0]=t[0](r[0]):s[0]=r[0];if(Gr(t[1]))s[1]=n?t[1]:Math.max(t[1],r[1]);else if(NK.test(t[1])){var d=+NK.exec(t[1])[1];s[1]=r[1]+d}else vi(t[1])?s[1]=t[1](r[1]):s[1]=r[1];return s},sk=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var s=t.scale.bandwidth();if(!n||s>0)return s}if(t&&r&&r.length>=2){for(var o=A$(r,function(w){return w.coordinate}),d=1/0,i=1,m=o.length;i<m;i++){var y=o[i],S=o[i-1];d=Math.min((y.coordinate||0)-(S.coordinate||0),d)}return d===1/0?0:d}return n?void 0:0},IK=function(t,r,n){return!t||!t.length||K2(t,_u(n,"type.defaultProps.domain"))?r:t},Gce=function(t,r){var n=t.type.defaultProps?ro(ro({},t.type.defaultProps),t.props):t.props,s=n.dataKey,o=n.name,d=n.unit,i=n.formatter,m=n.tooltipType,y=n.chartType,S=n.hide;return ro(ro({},Jn(t,!1)),{},{dataKey:s,unit:d,formatter:i,name:o||s,color:J$(t),value:Jo(r,s),type:m,payload:r,chartType:y,hide:S})};function VT(e){"@babel/helpers - typeof";return VT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},VT(e)}function RK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Mf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RK(Object(r),!0).forEach(function(n){Wce(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wce(e,t,r){return t=mWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mWe(e){var t=gWe(e,"string");return VT(t)=="symbol"?t:t+""}function gWe(e,t){if(VT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(VT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yWe(e,t){return bWe(e)||xWe(e,t)||_We(e,t)||vWe()}function vWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _We(e,t){if(e){if(typeof e=="string")return MK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return MK(e,t)}}function MK(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xWe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function bWe(e){if(Array.isArray(e))return e}var ak=Math.PI/180,wWe=function(t){return t*180/Math.PI},sa=function(t,r,n,s){return{x:t+Math.cos(-ak*s)*n,y:r+Math.sin(-ak*s)*n}},Kce=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},SWe=function(t,r,n,s,o){var d=t.width,i=t.height,m=t.startAngle,y=t.endAngle,S=fc(t.cx,d,d/2),w=fc(t.cy,i,i/2),T=Kce(d,i,n),A=fc(t.innerRadius,T,0),O=fc(t.outerRadius,T,T*.8),P=Object.keys(r);return P.reduce(function(N,R){var M=r[R],F=M.domain,B=M.reversed,$;if(Oi(M.range))s==="angleAxis"?$=[m,y]:s==="radiusAxis"&&($=[A,O]),B&&($=[$[1],$[0]]);else{$=M.range;var W=$,K=yWe(W,2);m=K[0],y=K[1]}var te=Uce(M,o),ne=te.realScaleType,ae=te.scale;ae.domain(F).range($),Vce(ae);var re=qce(ae,Mf(Mf({},M),{},{realScaleType:ne})),ee=Mf(Mf(Mf({},M),re),{},{range:$,radius:O,realScaleType:ne,scale:ae,cx:S,cy:w,innerRadius:A,outerRadius:O,startAngle:m,endAngle:y});return Mf(Mf({},N),{},Wce({},R,ee))},{})},EWe=function(t,r){var n=t.x,s=t.y,o=r.x,d=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(s-d,2))},TWe=function(t,r){var n=t.x,s=t.y,o=r.cx,d=r.cy,i=EWe({x:n,y:s},{x:o,y:d});if(i<=0)return{radius:i};var m=(n-o)/i,y=Math.acos(m);return s>d&&(y=2*Math.PI-y),{radius:i,angle:wWe(y),angleInRadian:y}},AWe=function(t){var r=t.startAngle,n=t.endAngle,s=Math.floor(r/360),o=Math.floor(n/360),d=Math.min(s,o);return{startAngle:r-d*360,endAngle:n-d*360}},CWe=function(t,r){var n=r.startAngle,s=r.endAngle,o=Math.floor(n/360),d=Math.floor(s/360),i=Math.min(o,d);return t+i*360},DK=function(t,r){var n=t.x,s=t.y,o=TWe({x:n,y:s},r),d=o.radius,i=o.angle,m=r.innerRadius,y=r.outerRadius;if(d<m||d>y)return!1;if(d===0)return!0;var S=AWe(r),w=S.startAngle,T=S.endAngle,A=i,O;if(w<=T){for(;A>T;)A-=360;for(;A<w;)A+=360;O=A>=w&&A<=T}else{for(;A>w;)A-=360;for(;A<T;)A+=360;O=A>=T&&A<=w}return O?Mf(Mf({},r),{},{radius:d,angle:CWe(A,r)}):null},Zce=function(t){return!V.isValidElement(t)&&!vi(t)&&typeof t!="boolean"?t.className:""};function qT(e){"@babel/helpers - typeof";return qT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qT(e)}var jWe=["offset"];function PWe(e){return IWe(e)||NWe(e)||kWe(e)||OWe()}function OWe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kWe(e,t){if(e){if(typeof e=="string")return Iz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Iz(e,t)}}function NWe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function IWe(e){if(Array.isArray(e))return Iz(e)}function Iz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function RWe(e,t){if(e==null)return{};var r=MWe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function MWe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function LK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Go(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LK(Object(r),!0).forEach(function(n){DWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DWe(e,t,r){return t=LWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function LWe(e){var t=FWe(e,"string");return qT(t)=="symbol"?t:t+""}function FWe(e,t){if(qT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(qT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HT(){return HT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HT.apply(this,arguments)}var zWe=function(t){var r=t.value,n=t.formatter,s=Oi(t.children)?r:t.children;return vi(n)?n(s):s},BWe=function(t,r){var n=hc(r-t),s=Math.min(Math.abs(r-t),360);return n*s},$We=function(t,r,n){var s=t.position,o=t.viewBox,d=t.offset,i=t.className,m=o,y=m.cx,S=m.cy,w=m.innerRadius,T=m.outerRadius,A=m.startAngle,O=m.endAngle,P=m.clockWise,N=(w+T)/2,R=BWe(A,O),M=R>=0?1:-1,F,B;s==="insideStart"?(F=A+M*d,B=P):s==="insideEnd"?(F=O-M*d,B=!P):s==="end"&&(F=O+M*d,B=P),B=R<=0?B:!B;var $=sa(y,S,N,F),W=sa(y,S,N,F+(B?1:-1)*359),K="M".concat($.x,",").concat($.y,`
    A`).concat(N,",").concat(N,",0,1,").concat(B?0:1,`,
    `).concat(W.x,",").concat(W.y),te=Oi(t.id)?vw("recharts-radial-line-"):t.id;return Ve.createElement("text",HT({},n,{dominantBaseline:"central",className:Ni("recharts-radial-bar-label",i)}),Ve.createElement("defs",null,Ve.createElement("path",{id:te,d:K})),Ve.createElement("textPath",{xlinkHref:"#".concat(te)},r))},UWe=function(t){var r=t.viewBox,n=t.offset,s=t.position,o=r,d=o.cx,i=o.cy,m=o.innerRadius,y=o.outerRadius,S=o.startAngle,w=o.endAngle,T=(S+w)/2;if(s==="outside"){var A=sa(d,i,y+n,T),O=A.x,P=A.y;return{x:O,y:P,textAnchor:O>=d?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"end"};var N=(m+y)/2,R=sa(d,i,N,T),M=R.x,F=R.y;return{x:M,y:F,textAnchor:"middle",verticalAnchor:"middle"}},VWe=function(t){var r=t.viewBox,n=t.parentViewBox,s=t.offset,o=t.position,d=r,i=d.x,m=d.y,y=d.width,S=d.height,w=S>=0?1:-1,T=w*s,A=w>0?"end":"start",O=w>0?"start":"end",P=y>=0?1:-1,N=P*s,R=P>0?"end":"start",M=P>0?"start":"end";if(o==="top"){var F={x:i+y/2,y:m-w*s,textAnchor:"middle",verticalAnchor:A};return Go(Go({},F),n?{height:Math.max(m-n.y,0),width:y}:{})}if(o==="bottom"){var B={x:i+y/2,y:m+S+T,textAnchor:"middle",verticalAnchor:O};return Go(Go({},B),n?{height:Math.max(n.y+n.height-(m+S),0),width:y}:{})}if(o==="left"){var $={x:i-N,y:m+S/2,textAnchor:R,verticalAnchor:"middle"};return Go(Go({},$),n?{width:Math.max($.x-n.x,0),height:S}:{})}if(o==="right"){var W={x:i+y+N,y:m+S/2,textAnchor:M,verticalAnchor:"middle"};return Go(Go({},W),n?{width:Math.max(n.x+n.width-W.x,0),height:S}:{})}var K=n?{width:y,height:S}:{};return o==="insideLeft"?Go({x:i+N,y:m+S/2,textAnchor:M,verticalAnchor:"middle"},K):o==="insideRight"?Go({x:i+y-N,y:m+S/2,textAnchor:R,verticalAnchor:"middle"},K):o==="insideTop"?Go({x:i+y/2,y:m+T,textAnchor:"middle",verticalAnchor:O},K):o==="insideBottom"?Go({x:i+y/2,y:m+S-T,textAnchor:"middle",verticalAnchor:A},K):o==="insideTopLeft"?Go({x:i+N,y:m+T,textAnchor:M,verticalAnchor:O},K):o==="insideTopRight"?Go({x:i+y-N,y:m+T,textAnchor:R,verticalAnchor:O},K):o==="insideBottomLeft"?Go({x:i+N,y:m+S-T,textAnchor:M,verticalAnchor:A},K):o==="insideBottomRight"?Go({x:i+y-N,y:m+S-T,textAnchor:R,verticalAnchor:A},K):pw(o)&&(Gr(o.x)||tv(o.x))&&(Gr(o.y)||tv(o.y))?Go({x:i+fc(o.x,y),y:m+fc(o.y,S),textAnchor:"end",verticalAnchor:"end"},K):Go({x:i+y/2,y:m+S/2,textAnchor:"middle",verticalAnchor:"middle"},K)},qWe=function(t){return"cx"in t&&Gr(t.cx)};function dl(e){var t=e.offset,r=t===void 0?5:t,n=RWe(e,jWe),s=Go({offset:r},n),o=s.viewBox,d=s.position,i=s.value,m=s.children,y=s.content,S=s.className,w=S===void 0?"":S,T=s.textBreakAll;if(!o||Oi(i)&&Oi(m)&&!V.isValidElement(y)&&!vi(y))return null;if(V.isValidElement(y))return V.cloneElement(y,s);var A;if(vi(y)){if(A=V.createElement(y,s),V.isValidElement(A))return A}else A=zWe(s);var O=qWe(o),P=Jn(s,!0);if(O&&(d==="insideStart"||d==="insideEnd"||d==="end"))return $We(s,A,P);var N=O?UWe(s):VWe(s);return Ve.createElement($v,HT({className:Ni("recharts-label",w)},P,N,{breakAll:T}),A)}dl.displayName="Label";var Xce=function(t){var r=t.cx,n=t.cy,s=t.angle,o=t.startAngle,d=t.endAngle,i=t.r,m=t.radius,y=t.innerRadius,S=t.outerRadius,w=t.x,T=t.y,A=t.top,O=t.left,P=t.width,N=t.height,R=t.clockWise,M=t.labelViewBox;if(M)return M;if(Gr(P)&&Gr(N)){if(Gr(w)&&Gr(T))return{x:w,y:T,width:P,height:N};if(Gr(A)&&Gr(O))return{x:A,y:O,width:P,height:N}}return Gr(w)&&Gr(T)?{x:w,y:T,width:0,height:0}:Gr(r)&&Gr(n)?{cx:r,cy:n,startAngle:o||s||0,endAngle:d||s||0,innerRadius:y||0,outerRadius:S||m||i||0,clockWise:R}:t.viewBox?t.viewBox:{}},HWe=function(t,r){return t?t===!0?Ve.createElement(dl,{key:"label-implicit",viewBox:r}):el(t)?Ve.createElement(dl,{key:"label-implicit",viewBox:r,value:t}):V.isValidElement(t)?t.type===dl?V.cloneElement(t,{key:"label-implicit",viewBox:r}):Ve.createElement(dl,{key:"label-implicit",content:t,viewBox:r}):vi(t)?Ve.createElement(dl,{key:"label-implicit",content:t,viewBox:r}):pw(t)?Ve.createElement(dl,HT({viewBox:r},t,{key:"label-implicit"})):null:null},GWe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var s=t.children,o=Xce(t),d=xu(s,dl).map(function(m,y){return V.cloneElement(m,{viewBox:r||o,key:"label-".concat(y)})});if(!n)return d;var i=HWe(t.label,r||o);return[i].concat(PWe(d))};dl.parseViewBox=Xce;dl.renderCallByParent=GWe;function WWe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var KWe=WWe;const ZWe=Ps(KWe);function GT(e){"@babel/helpers - typeof";return GT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},GT(e)}var XWe=["valueAccessor"],YWe=["data","dataKey","clockWise","id","textBreakAll"];function JWe(e){return r7e(e)||t7e(e)||e7e(e)||QWe()}function QWe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e7e(e,t){if(e){if(typeof e=="string")return Rz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rz(e,t)}}function t7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function r7e(e){if(Array.isArray(e))return Rz(e)}function Rz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ok(){return ok=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ok.apply(this,arguments)}function FK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function zK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FK(Object(r),!0).forEach(function(n){n7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function n7e(e,t,r){return t=i7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i7e(e){var t=s7e(e,"string");return GT(t)=="symbol"?t:t+""}function s7e(e,t){if(GT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(GT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function BK(e,t){if(e==null)return{};var r=a7e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function a7e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var o7e=function(t){return Array.isArray(t.value)?ZWe(t.value):t.value};function Qf(e){var t=e.valueAccessor,r=t===void 0?o7e:t,n=BK(e,XWe),s=n.data,o=n.dataKey,d=n.clockWise,i=n.id,m=n.textBreakAll,y=BK(n,YWe);return!s||!s.length?null:Ve.createElement(Cs,{className:"recharts-label-list"},s.map(function(S,w){var T=Oi(o)?r(S,w):Jo(S&&S.payload,o),A=Oi(i)?{}:{id:"".concat(i,"-").concat(w)};return Ve.createElement(dl,ok({},Jn(S,!0),y,A,{parentViewBox:S.parentViewBox,value:T,textBreakAll:m,viewBox:dl.parseViewBox(Oi(d)?S:zK(zK({},S),{},{clockWise:d})),key:"label-".concat(w),index:w}))}))}Qf.displayName="LabelList";function l7e(e,t){return e?e===!0?Ve.createElement(Qf,{key:"labelList-implicit",data:t}):Ve.isValidElement(e)||vi(e)?Ve.createElement(Qf,{key:"labelList-implicit",data:t,content:e}):pw(e)?Ve.createElement(Qf,ok({data:t},e,{key:"labelList-implicit"})):null:null}function c7e(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,s=xu(n,Qf).map(function(d,i){return V.cloneElement(d,{data:t,key:"labelList-".concat(i)})});if(!r)return s;var o=l7e(e.label,t);return[o].concat(JWe(s))}Qf.renderCallByParent=c7e;function WT(e){"@babel/helpers - typeof";return WT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},WT(e)}function Mz(){return Mz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mz.apply(this,arguments)}function $K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function UK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$K(Object(r),!0).forEach(function(n){u7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$K(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u7e(e,t,r){return t=d7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d7e(e){var t=h7e(e,"string");return WT(t)=="symbol"?t:t+""}function h7e(e,t){if(WT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(WT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var f7e=function(t,r){var n=hc(r-t),s=Math.min(Math.abs(r-t),359.999);return n*s},Dj=function(t){var r=t.cx,n=t.cy,s=t.radius,o=t.angle,d=t.sign,i=t.isExternal,m=t.cornerRadius,y=t.cornerIsExternal,S=m*(i?1:-1)+s,w=Math.asin(m/S)/ak,T=y?o:o+d*w,A=sa(r,n,S,T),O=sa(r,n,s,T),P=y?o-d*w:o,N=sa(r,n,S*Math.cos(w*ak),P);return{center:A,circleTangency:O,lineTangency:N,theta:w}},Yce=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,d=t.startAngle,i=t.endAngle,m=f7e(d,i),y=d+m,S=sa(r,n,o,d),w=sa(r,n,o,y),T="M ".concat(S.x,",").concat(S.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(m)>180),",").concat(+(d>y),`,
    `).concat(w.x,",").concat(w.y,`
  `);if(s>0){var A=sa(r,n,s,d),O=sa(r,n,s,y);T+="L ".concat(O.x,",").concat(O.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(m)>180),",").concat(+(d<=y),`,
            `).concat(A.x,",").concat(A.y," Z")}else T+="L ".concat(r,",").concat(n," Z");return T},p7e=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,d=t.cornerRadius,i=t.forceCornerRadius,m=t.cornerIsExternal,y=t.startAngle,S=t.endAngle,w=hc(S-y),T=Dj({cx:r,cy:n,radius:o,angle:y,sign:w,cornerRadius:d,cornerIsExternal:m}),A=T.circleTangency,O=T.lineTangency,P=T.theta,N=Dj({cx:r,cy:n,radius:o,angle:S,sign:-w,cornerRadius:d,cornerIsExternal:m}),R=N.circleTangency,M=N.lineTangency,F=N.theta,B=m?Math.abs(y-S):Math.abs(y-S)-P-F;if(B<0)return i?"M ".concat(O.x,",").concat(O.y,`
        a`).concat(d,",").concat(d,",0,0,1,").concat(d*2,`,0
        a`).concat(d,",").concat(d,",0,0,1,").concat(-d*2,`,0
      `):Yce({cx:r,cy:n,innerRadius:s,outerRadius:o,startAngle:y,endAngle:S});var $="M ".concat(O.x,",").concat(O.y,`
    A`).concat(d,",").concat(d,",0,0,").concat(+(w<0),",").concat(A.x,",").concat(A.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(B>180),",").concat(+(w<0),",").concat(R.x,",").concat(R.y,`
    A`).concat(d,",").concat(d,",0,0,").concat(+(w<0),",").concat(M.x,",").concat(M.y,`
  `);if(s>0){var W=Dj({cx:r,cy:n,radius:s,angle:y,sign:w,isExternal:!0,cornerRadius:d,cornerIsExternal:m}),K=W.circleTangency,te=W.lineTangency,ne=W.theta,ae=Dj({cx:r,cy:n,radius:s,angle:S,sign:-w,isExternal:!0,cornerRadius:d,cornerIsExternal:m}),re=ae.circleTangency,ee=ae.lineTangency,ie=ae.theta,de=m?Math.abs(y-S):Math.abs(y-S)-ne-ie;if(de<0&&d===0)return"".concat($,"L").concat(r,",").concat(n,"Z");$+="L".concat(ee.x,",").concat(ee.y,`
      A`).concat(d,",").concat(d,",0,0,").concat(+(w<0),",").concat(re.x,",").concat(re.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(de>180),",").concat(+(w>0),",").concat(K.x,",").concat(K.y,`
      A`).concat(d,",").concat(d,",0,0,").concat(+(w<0),",").concat(te.x,",").concat(te.y,"Z")}else $+="L".concat(r,",").concat(n,"Z");return $},m7e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},Jce=function(t){var r=UK(UK({},m7e),t),n=r.cx,s=r.cy,o=r.innerRadius,d=r.outerRadius,i=r.cornerRadius,m=r.forceCornerRadius,y=r.cornerIsExternal,S=r.startAngle,w=r.endAngle,T=r.className;if(d<o||S===w)return null;var A=Ni("recharts-sector",T),O=d-o,P=fc(i,O,0,!0),N;return P>0&&Math.abs(S-w)<360?N=p7e({cx:n,cy:s,innerRadius:o,outerRadius:d,cornerRadius:Math.min(P,O/2),forceCornerRadius:m,cornerIsExternal:y,startAngle:S,endAngle:w}):N=Yce({cx:n,cy:s,innerRadius:o,outerRadius:d,startAngle:S,endAngle:w}),Ve.createElement("path",Mz({},Jn(r,!0),{className:A,d:N,role:"img"}))};function KT(e){"@babel/helpers - typeof";return KT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KT(e)}function Dz(){return Dz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dz.apply(this,arguments)}function VK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function qK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VK(Object(r),!0).forEach(function(n){g7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function g7e(e,t,r){return t=y7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y7e(e){var t=v7e(e,"string");return KT(t)=="symbol"?t:t+""}function v7e(e,t){if(KT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(KT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var HK={curveBasisClosed:yFe,curveBasisOpen:vFe,curveBasis:gFe,curveBumpX:rFe,curveBumpY:nFe,curveLinearClosed:_Fe,curveLinear:hI,curveMonotoneX:xFe,curveMonotoneY:bFe,curveNatural:wFe,curveStep:SFe,curveStepAfter:TFe,curveStepBefore:EFe},Lj=function(t){return t.x===+t.x&&t.y===+t.y},QS=function(t){return t.x},eE=function(t){return t.y},_7e=function(t,r){if(vi(t))return t;var n="curve".concat(uI(t));return(n==="curveMonotone"||n==="curveBump")&&r?HK["".concat(n).concat(r==="vertical"?"Y":"X")]:HK[n]||hI},x7e=function(t){var r=t.type,n=r===void 0?"linear":r,s=t.points,o=s===void 0?[]:s,d=t.baseLine,i=t.layout,m=t.connectNulls,y=m===void 0?!1:m,S=_7e(n,i),w=y?o.filter(function(P){return Lj(P)}):o,T;if(Array.isArray(d)){var A=y?d.filter(function(P){return Lj(P)}):d,O=w.map(function(P,N){return qK(qK({},P),{},{base:A[N]})});return i==="vertical"?T=Cj().y(eE).x1(QS).x0(function(P){return P.base.x}):T=Cj().x(QS).y1(eE).y0(function(P){return P.base.y}),T.defined(Lj).curve(S),T(O)}return i==="vertical"&&Gr(d)?T=Cj().y(eE).x1(QS).x0(d):Gr(d)?T=Cj().x(QS).y1(eE).y0(d):T=Hoe().x(QS).y(eE),T.defined(Lj).curve(S),T(w)},lk=function(t){var r=t.className,n=t.points,s=t.path,o=t.pathRef;if((!n||!n.length)&&!s)return null;var d=n&&n.length?x7e(t):s;return V.createElement("path",Dz({},Jn(t,!1),NO(t),{className:Ni("recharts-curve",r),d,ref:o}))},Qce={exports:{}},b7e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",w7e=b7e,S7e=w7e;function eue(){}function tue(){}tue.resetWarningCache=eue;var E7e=function(){function e(n,s,o,d,i,m){if(m!==S7e){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:tue,resetWarningCache:eue};return r.PropTypes=r,r};Qce.exports=E7e();var T7e=Qce.exports;const zs=Ps(T7e);var A7e=Object.getOwnPropertyNames,C7e=Object.getOwnPropertySymbols,j7e=Object.prototype.hasOwnProperty;function GK(e,t){return function(n,s,o){return e(n,s,o)&&t(n,s,o)}}function Fj(e){return function(r,n,s){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,s);var o=s.cache,d=o.get(r),i=o.get(n);if(d&&i)return d===n&&i===r;o.set(r,n),o.set(n,r);var m=e(r,n,s);return o.delete(r),o.delete(n),m}}function WK(e){return A7e(e).concat(C7e(e))}var P7e=Object.hasOwn||function(e,t){return j7e.call(e,t)};function a_(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var O7e="__v",k7e="__o",N7e="_owner",KK=Object.getOwnPropertyDescriptor,ZK=Object.keys;function I7e(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function R7e(e,t){return a_(e.getTime(),t.getTime())}function M7e(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function D7e(e,t){return e===t}function XK(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.entries(),d,i,m=0;(d=o.next())&&!d.done;){for(var y=t.entries(),S=!1,w=0;(i=y.next())&&!i.done;){if(s[w]){w++;continue}var T=d.value,A=i.value;if(r.equals(T[0],A[0],m,w,e,t,r)&&r.equals(T[1],A[1],T[0],A[0],e,t,r)){S=s[w]=!0;break}w++}if(!S)return!1;m++}return!0}var L7e=a_;function F7e(e,t,r){var n=ZK(e),s=n.length;if(ZK(t).length!==s)return!1;for(;s-- >0;)if(!rue(e,t,r,n[s]))return!1;return!0}function tE(e,t,r){var n=WK(e),s=n.length;if(WK(t).length!==s)return!1;for(var o,d,i;s-- >0;)if(o=n[s],!rue(e,t,r,o)||(d=KK(e,o),i=KK(t,o),(d||i)&&(!d||!i||d.configurable!==i.configurable||d.enumerable!==i.enumerable||d.writable!==i.writable)))return!1;return!0}function z7e(e,t){return a_(e.valueOf(),t.valueOf())}function B7e(e,t){return e.source===t.source&&e.flags===t.flags}function YK(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.values(),d,i;(d=o.next())&&!d.done;){for(var m=t.values(),y=!1,S=0;(i=m.next())&&!i.done;){if(!s[S]&&r.equals(d.value,i.value,d.value,i.value,e,t,r)){y=s[S]=!0;break}S++}if(!y)return!1}return!0}function $7e(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function U7e(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function rue(e,t,r,n){return(n===N7e||n===k7e||n===O7e)&&(e.$$typeof||t.$$typeof)?!0:P7e(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var V7e="[object Arguments]",q7e="[object Boolean]",H7e="[object Date]",G7e="[object Error]",W7e="[object Map]",K7e="[object Number]",Z7e="[object Object]",X7e="[object RegExp]",Y7e="[object Set]",J7e="[object String]",Q7e="[object URL]",eKe=Array.isArray,JK=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,QK=Object.assign,tKe=Object.prototype.toString.call.bind(Object.prototype.toString);function rKe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,s=e.areFunctionsEqual,o=e.areMapsEqual,d=e.areNumbersEqual,i=e.areObjectsEqual,m=e.arePrimitiveWrappersEqual,y=e.areRegExpsEqual,S=e.areSetsEqual,w=e.areTypedArraysEqual,T=e.areUrlsEqual;return function(O,P,N){if(O===P)return!0;if(O==null||P==null)return!1;var R=typeof O;if(R!==typeof P)return!1;if(R!=="object")return R==="number"?d(O,P,N):R==="function"?s(O,P,N):!1;var M=O.constructor;if(M!==P.constructor)return!1;if(M===Object)return i(O,P,N);if(eKe(O))return t(O,P,N);if(JK!=null&&JK(O))return w(O,P,N);if(M===Date)return r(O,P,N);if(M===RegExp)return y(O,P,N);if(M===Map)return o(O,P,N);if(M===Set)return S(O,P,N);var F=tKe(O);return F===H7e?r(O,P,N):F===X7e?y(O,P,N):F===W7e?o(O,P,N):F===Y7e?S(O,P,N):F===Z7e?typeof O.then!="function"&&typeof P.then!="function"&&i(O,P,N):F===Q7e?T(O,P,N):F===G7e?n(O,P,N):F===V7e?i(O,P,N):F===q7e||F===K7e||F===J7e?m(O,P,N):!1}}function nKe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,s={areArraysEqual:n?tE:I7e,areDatesEqual:R7e,areErrorsEqual:M7e,areFunctionsEqual:D7e,areMapsEqual:n?GK(XK,tE):XK,areNumbersEqual:L7e,areObjectsEqual:n?tE:F7e,arePrimitiveWrappersEqual:z7e,areRegExpsEqual:B7e,areSetsEqual:n?GK(YK,tE):YK,areTypedArraysEqual:n?tE:$7e,areUrlsEqual:U7e};if(r&&(s=QK({},s,r(s))),t){var o=Fj(s.areArraysEqual),d=Fj(s.areMapsEqual),i=Fj(s.areObjectsEqual),m=Fj(s.areSetsEqual);s=QK({},s,{areArraysEqual:o,areMapsEqual:d,areObjectsEqual:i,areSetsEqual:m})}return s}function iKe(e){return function(t,r,n,s,o,d,i){return e(t,r,i)}}function sKe(e){var t=e.circular,r=e.comparator,n=e.createState,s=e.equals,o=e.strict;if(n)return function(m,y){var S=n(),w=S.cache,T=w===void 0?t?new WeakMap:void 0:w,A=S.meta;return r(m,y,{cache:T,equals:s,meta:A,strict:o})};if(t)return function(m,y){return r(m,y,{cache:new WeakMap,equals:s,meta:void 0,strict:o})};var d={cache:void 0,equals:s,meta:void 0,strict:o};return function(m,y){return r(m,y,d)}}var aKe=Ng();Ng({strict:!0});Ng({circular:!0});Ng({circular:!0,strict:!0});Ng({createInternalComparator:function(){return a_}});Ng({strict:!0,createInternalComparator:function(){return a_}});Ng({circular:!0,createInternalComparator:function(){return a_}});Ng({circular:!0,createInternalComparator:function(){return a_},strict:!0});function Ng(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,s=e.createState,o=e.strict,d=o===void 0?!1:o,i=nKe(e),m=rKe(i),y=n?n(m):iKe(m);return sKe({circular:r,comparator:m,createState:s,equals:y,strict:d})}function oKe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function eZ(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function s(o){r<0&&(r=o),o-r>t?(e(o),r=-1):oKe(s)};requestAnimationFrame(n)}function Lz(e){"@babel/helpers - typeof";return Lz=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lz(e)}function lKe(e){return hKe(e)||dKe(e)||uKe(e)||cKe()}function cKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uKe(e,t){if(e){if(typeof e=="string")return tZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tZ(e,t)}}function tZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function dKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function hKe(e){if(Array.isArray(e))return e}function fKe(){var e={},t=function(){return null},r=!1,n=function s(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var d=o,i=lKe(d),m=i[0],y=i.slice(1);if(typeof m=="number"){eZ(s.bind(null,y),m);return}s(m),eZ(s.bind(null,y));return}Lz(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function ZT(e){"@babel/helpers - typeof";return ZT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZT(e)}function rZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function nZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rZ(Object(r),!0).forEach(function(n){nue(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nue(e,t,r){return t=pKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pKe(e){var t=mKe(e,"string");return ZT(t)==="symbol"?t:String(t)}function mKe(e,t){if(ZT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ZT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gKe=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,s){return n.filter(function(o){return s.includes(o)})})},yKe=function(t){return t},vKe=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},zE=function(t,r){return Object.keys(r).reduce(function(n,s){return nZ(nZ({},n),{},nue({},s,t(s,r[s])))},{})},iZ=function(t,r,n){return t.map(function(s){return"".concat(vKe(s)," ").concat(r,"ms ").concat(n)}).join(",")};function _Ke(e,t){return wKe(e)||bKe(e,t)||iue(e,t)||xKe()}function xKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bKe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function wKe(e){if(Array.isArray(e))return e}function SKe(e){return AKe(e)||TKe(e)||iue(e)||EKe()}function EKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iue(e,t){if(e){if(typeof e=="string")return Fz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fz(e,t)}}function TKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function AKe(e){if(Array.isArray(e))return Fz(e)}function Fz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ck=1e-4,sue=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},aue=function(t,r){return t.map(function(n,s){return n*Math.pow(r,s)}).reduce(function(n,s){return n+s})},sZ=function(t,r){return function(n){var s=sue(t,r);return aue(s,n)}},CKe=function(t,r){return function(n){var s=sue(t,r),o=[].concat(SKe(s.map(function(d,i){return d*i}).slice(1)),[0]);return aue(o,n)}},aZ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0],o=r[1],d=r[2],i=r[3];if(r.length===1)switch(r[0]){case"linear":s=0,o=0,d=1,i=1;break;case"ease":s=.25,o=.1,d=.25,i=1;break;case"ease-in":s=.42,o=0,d=1,i=1;break;case"ease-out":s=.42,o=0,d=.58,i=1;break;case"ease-in-out":s=0,o=0,d=.58,i=1;break;default:{var m=r[0].split("(");if(m[0]==="cubic-bezier"&&m[1].split(")")[0].split(",").length===4){var y=m[1].split(")")[0].split(",").map(function(N){return parseFloat(N)}),S=_Ke(y,4);s=S[0],o=S[1],d=S[2],i=S[3]}}}var w=sZ(s,d),T=sZ(o,i),A=CKe(s,d),O=function(R){return R>1?1:R<0?0:R},P=function(R){for(var M=R>1?1:R,F=M,B=0;B<8;++B){var $=w(F)-M,W=A(F);if(Math.abs($-M)<ck||W<ck)return T(F);F=O(F-$/W)}return T(F)};return P.isStepper=!1,P},jKe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,s=t.damping,o=s===void 0?8:s,d=t.dt,i=d===void 0?17:d,m=function(S,w,T){var A=-(S-w)*n,O=T*o,P=T+(A-O)*i/1e3,N=T*i/1e3+S;return Math.abs(N-w)<ck&&Math.abs(P)<ck?[w,0]:[N,P]};return m.isStepper=!0,m.dt=i,m},PKe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0];if(typeof s=="string")switch(s){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return aZ(s);case"spring":return jKe();default:if(s.split("(")[0]==="cubic-bezier")return aZ(s)}return typeof s=="function"?s:null};function XT(e){"@babel/helpers - typeof";return XT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XT(e)}function oZ(e){return NKe(e)||kKe(e)||oue(e)||OKe()}function OKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function NKe(e){if(Array.isArray(e))return Bz(e)}function lZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Sl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lZ(Object(r),!0).forEach(function(n){zz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zz(e,t,r){return t=IKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IKe(e){var t=RKe(e,"string");return XT(t)==="symbol"?t:String(t)}function RKe(e,t){if(XT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(XT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function MKe(e,t){return FKe(e)||LKe(e,t)||oue(e,t)||DKe()}function DKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oue(e,t){if(e){if(typeof e=="string")return Bz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bz(e,t)}}function Bz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function LKe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function FKe(e){if(Array.isArray(e))return e}var uk=function(t,r,n){return t+(r-t)*n},$z=function(t){var r=t.from,n=t.to;return r!==n},zKe=function e(t,r,n){var s=zE(function(o,d){if($z(d)){var i=t(d.from,d.to,d.velocity),m=MKe(i,2),y=m[0],S=m[1];return Sl(Sl({},d),{},{from:y,velocity:S})}return d},r);return n<1?zE(function(o,d){return $z(d)?Sl(Sl({},d),{},{velocity:uk(d.velocity,s[o].velocity,n),from:uk(d.from,s[o].from,n)}):d},r):e(t,s,n-1)};const BKe=function(e,t,r,n,s){var o=gKe(e,t),d=o.reduce(function(N,R){return Sl(Sl({},N),{},zz({},R,[e[R],t[R]]))},{}),i=o.reduce(function(N,R){return Sl(Sl({},N),{},zz({},R,{from:e[R],velocity:0,to:t[R]}))},{}),m=-1,y,S,w=function(){return null},T=function(){return zE(function(R,M){return M.from},i)},A=function(){return!Object.values(i).filter($z).length},O=function(R){y||(y=R);var M=R-y,F=M/r.dt;i=zKe(r,i,F),s(Sl(Sl(Sl({},e),t),T())),y=R,A()||(m=requestAnimationFrame(w))},P=function(R){S||(S=R);var M=(R-S)/n,F=zE(function($,W){return uk.apply(void 0,oZ(W).concat([r(M)]))},d);if(s(Sl(Sl(Sl({},e),t),F)),M<1)m=requestAnimationFrame(w);else{var B=zE(function($,W){return uk.apply(void 0,oZ(W).concat([r(1)]))},d);s(Sl(Sl(Sl({},e),t),B))}};return w=r.isStepper?O:P,function(){return requestAnimationFrame(w),function(){cancelAnimationFrame(m)}}};function Mb(e){"@babel/helpers - typeof";return Mb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mb(e)}var $Ke=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function UKe(e,t){if(e==null)return{};var r=VKe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function VKe(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function wL(e){return WKe(e)||GKe(e)||HKe(e)||qKe()}function qKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HKe(e,t){if(e){if(typeof e=="string")return Uz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uz(e,t)}}function GKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function WKe(e){if(Array.isArray(e))return Uz(e)}function Uz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function cZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Sd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cZ(Object(r),!0).forEach(function(n){vE(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vE(e,t,r){return t=lue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ZKe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,lue(n.key),n)}}function XKe(e,t,r){return t&&ZKe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function lue(e){var t=YKe(e,"string");return Mb(t)==="symbol"?t:String(t)}function YKe(e,t){if(Mb(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Mb(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function JKe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vz(e,t)}function Vz(e,t){return Vz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Vz(e,t)}function QKe(e){var t=eZe();return function(){var n=dk(e),s;if(t){var o=dk(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return qz(this,s)}}function qz(e,t){if(t&&(Mb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Hz(e)}function Hz(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eZe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dk(e){return dk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dk(e)}var Zh=function(e){JKe(r,e);var t=QKe(r);function r(n,s){var o;KKe(this,r),o=t.call(this,n,s);var d=o.props,i=d.isActive,m=d.attributeName,y=d.from,S=d.to,w=d.steps,T=d.children,A=d.duration;if(o.handleStyleChange=o.handleStyleChange.bind(Hz(o)),o.changeStyle=o.changeStyle.bind(Hz(o)),!i||A<=0)return o.state={style:{}},typeof T=="function"&&(o.state={style:S}),qz(o);if(w&&w.length)o.state={style:w[0].style};else if(y){if(typeof T=="function")return o.state={style:y},qz(o);o.state={style:m?vE({},m,y):y}}else o.state={style:{}};return o}return XKe(r,[{key:"componentDidMount",value:function(){var s=this.props,o=s.isActive,d=s.canBegin;this.mounted=!0,!(!o||!d)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(s){var o=this.props,d=o.isActive,i=o.canBegin,m=o.attributeName,y=o.shouldReAnimate,S=o.to,w=o.from,T=this.state.style;if(i){if(!d){var A={style:m?vE({},m,S):S};this.state&&T&&(m&&T[m]!==S||!m&&T!==S)&&this.setState(A);return}if(!(aKe(s.to,S)&&s.canBegin&&s.isActive)){var O=!s.canBegin||!s.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var P=O||y?w:s.to;if(this.state&&T){var N={style:m?vE({},m,P):P};(m&&T[m]!==P||!m&&T!==P)&&this.setState(N)}this.runAnimation(Sd(Sd({},this.props),{},{from:P,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var s=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),s&&s()}},{key:"handleStyleChange",value:function(s){this.changeStyle(s)}},{key:"changeStyle",value:function(s){this.mounted&&this.setState({style:s})}},{key:"runJSAnimation",value:function(s){var o=this,d=s.from,i=s.to,m=s.duration,y=s.easing,S=s.begin,w=s.onAnimationEnd,T=s.onAnimationStart,A=BKe(d,i,PKe(y),m,this.changeStyle),O=function(){o.stopJSAnimation=A()};this.manager.start([T,S,O,m,w])}},{key:"runStepAnimation",value:function(s){var o=this,d=s.steps,i=s.begin,m=s.onAnimationStart,y=d[0],S=y.style,w=y.duration,T=w===void 0?0:w,A=function(P,N,R){if(R===0)return P;var M=N.duration,F=N.easing,B=F===void 0?"ease":F,$=N.style,W=N.properties,K=N.onAnimationEnd,te=R>0?d[R-1]:N,ne=W||Object.keys($);if(typeof B=="function"||B==="spring")return[].concat(wL(P),[o.runJSAnimation.bind(o,{from:te.style,to:$,duration:M,easing:B}),M]);var ae=iZ(ne,M,B),re=Sd(Sd(Sd({},te.style),$),{},{transition:ae});return[].concat(wL(P),[re,M,K]).filter(yKe)};return this.manager.start([m].concat(wL(d.reduce(A,[S,Math.max(T,i)])),[s.onAnimationEnd]))}},{key:"runAnimation",value:function(s){this.manager||(this.manager=fKe());var o=s.begin,d=s.duration,i=s.attributeName,m=s.to,y=s.easing,S=s.onAnimationStart,w=s.onAnimationEnd,T=s.steps,A=s.children,O=this.manager;if(this.unSubscribe=O.subscribe(this.handleStyleChange),typeof y=="function"||typeof A=="function"||y==="spring"){this.runJSAnimation(s);return}if(T.length>1){this.runStepAnimation(s);return}var P=i?vE({},i,m):m,N=iZ(Object.keys(P),d,y);O.start([S,o,Sd(Sd({},P),{},{transition:N}),d,w])}},{key:"render",value:function(){var s=this.props,o=s.children;s.begin;var d=s.duration;s.attributeName,s.easing;var i=s.isActive;s.steps,s.from,s.to,s.canBegin,s.onAnimationEnd,s.shouldReAnimate,s.onAnimationReStart;var m=UKe(s,$Ke),y=V.Children.count(o),S=this.state.style;if(typeof o=="function")return o(S);if(!i||y===0||d<=0)return o;var w=function(A){var O=A.props,P=O.style,N=P===void 0?{}:P,R=O.className,M=V.cloneElement(A,Sd(Sd({},m),{},{style:Sd(Sd({},N),S),className:R}));return M};return y===1?w(V.Children.only(o)):Ve.createElement("div",null,V.Children.map(o,function(T){return w(T)}))}}]),r}(V.PureComponent);Zh.displayName="Animate";Zh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Zh.propTypes={from:zs.oneOfType([zs.object,zs.string]),to:zs.oneOfType([zs.object,zs.string]),attributeName:zs.string,duration:zs.number,begin:zs.number,easing:zs.oneOfType([zs.string,zs.func]),steps:zs.arrayOf(zs.shape({duration:zs.number.isRequired,style:zs.object.isRequired,easing:zs.oneOfType([zs.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),zs.func]),properties:zs.arrayOf("string"),onAnimationEnd:zs.func})),children:zs.oneOfType([zs.node,zs.func]),isActive:zs.bool,canBegin:zs.bool,onAnimationEnd:zs.func,shouldReAnimate:zs.bool,onAnimationStart:zs.func,onAnimationReStart:zs.func};function YT(e){"@babel/helpers - typeof";return YT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YT(e)}function hk(){return hk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hk.apply(this,arguments)}function tZe(e,t){return sZe(e)||iZe(e,t)||nZe(e,t)||rZe()}function rZe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nZe(e,t){if(e){if(typeof e=="string")return uZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uZ(e,t)}}function uZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function iZe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function sZe(e){if(Array.isArray(e))return e}function dZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function hZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dZ(Object(r),!0).forEach(function(n){aZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aZe(e,t,r){return t=oZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oZe(e){var t=lZe(e,"string");return YT(t)=="symbol"?t:t+""}function lZe(e,t){if(YT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(YT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fZ=function(t,r,n,s,o){var d=Math.min(Math.abs(n)/2,Math.abs(s)/2),i=s>=0?1:-1,m=n>=0?1:-1,y=s>=0&&n>=0||s<0&&n<0?1:0,S;if(d>0&&o instanceof Array){for(var w=[0,0,0,0],T=0,A=4;T<A;T++)w[T]=o[T]>d?d:o[T];S="M".concat(t,",").concat(r+i*w[0]),w[0]>0&&(S+="A ".concat(w[0],",").concat(w[0],",0,0,").concat(y,",").concat(t+m*w[0],",").concat(r)),S+="L ".concat(t+n-m*w[1],",").concat(r),w[1]>0&&(S+="A ".concat(w[1],",").concat(w[1],",0,0,").concat(y,`,
        `).concat(t+n,",").concat(r+i*w[1])),S+="L ".concat(t+n,",").concat(r+s-i*w[2]),w[2]>0&&(S+="A ".concat(w[2],",").concat(w[2],",0,0,").concat(y,`,
        `).concat(t+n-m*w[2],",").concat(r+s)),S+="L ".concat(t+m*w[3],",").concat(r+s),w[3]>0&&(S+="A ".concat(w[3],",").concat(w[3],",0,0,").concat(y,`,
        `).concat(t,",").concat(r+s-i*w[3])),S+="Z"}else if(d>0&&o===+o&&o>0){var O=Math.min(d,o);S="M ".concat(t,",").concat(r+i*O,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t+m*O,",").concat(r,`
            L `).concat(t+n-m*O,",").concat(r,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t+n,",").concat(r+i*O,`
            L `).concat(t+n,",").concat(r+s-i*O,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t+n-m*O,",").concat(r+s,`
            L `).concat(t+m*O,",").concat(r+s,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t,",").concat(r+s-i*O," Z")}else S="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(s," h ").concat(-n," Z");return S},cZe=function(t,r){if(!t||!r)return!1;var n=t.x,s=t.y,o=r.x,d=r.y,i=r.width,m=r.height;if(Math.abs(i)>0&&Math.abs(m)>0){var y=Math.min(o,o+i),S=Math.max(o,o+i),w=Math.min(d,d+m),T=Math.max(d,d+m);return n>=y&&n<=S&&s>=w&&s<=T}return!1},uZe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Q$=function(t){var r=hZ(hZ({},uZe),t),n=V.useRef(),s=V.useState(-1),o=tZe(s,2),d=o[0],i=o[1];V.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var B=n.current.getTotalLength();B&&i(B)}catch{}},[]);var m=r.x,y=r.y,S=r.width,w=r.height,T=r.radius,A=r.className,O=r.animationEasing,P=r.animationDuration,N=r.animationBegin,R=r.isAnimationActive,M=r.isUpdateAnimationActive;if(m!==+m||y!==+y||S!==+S||w!==+w||S===0||w===0)return null;var F=Ni("recharts-rectangle",A);return M?Ve.createElement(Zh,{canBegin:d>0,from:{width:S,height:w,x:m,y},to:{width:S,height:w,x:m,y},duration:P,animationEasing:O,isActive:M},function(B){var $=B.width,W=B.height,K=B.x,te=B.y;return Ve.createElement(Zh,{canBegin:d>0,from:"0px ".concat(d===-1?1:d,"px"),to:"".concat(d,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:P,isActive:R,easing:O},Ve.createElement("path",hk({},Jn(r,!0),{className:F,d:fZ(K,te,$,W,T),ref:n})))}):Ve.createElement("path",hk({},Jn(r,!0),{className:F,d:fZ(m,y,S,w,T)}))},dZe=["points","className","baseLinePoints","connectNulls"];function _0(){return _0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_0.apply(this,arguments)}function hZe(e,t){if(e==null)return{};var r=fZe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function pZ(e){return yZe(e)||gZe(e)||mZe(e)||pZe()}function pZe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mZe(e,t){if(e){if(typeof e=="string")return Gz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gz(e,t)}}function gZe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function yZe(e){if(Array.isArray(e))return Gz(e)}function Gz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var mZ=function(t){return t&&t.x===+t.x&&t.y===+t.y},vZe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){mZ(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),mZ(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},BE=function(t,r){var n=vZe(t);r&&(n=[n.reduce(function(o,d){return[].concat(pZ(o),pZ(d))},[])]);var s=n.map(function(o){return o.reduce(function(d,i,m){return"".concat(d).concat(m===0?"M":"L").concat(i.x,",").concat(i.y)},"")}).join("");return n.length===1?"".concat(s,"Z"):s},_Ze=function(t,r,n){var s=BE(t,n);return"".concat(s.slice(-1)==="Z"?s.slice(0,-1):s,"L").concat(BE(r.reverse(),n).slice(1))},xZe=function(t){var r=t.points,n=t.className,s=t.baseLinePoints,o=t.connectNulls,d=hZe(t,dZe);if(!r||!r.length)return null;var i=Ni("recharts-polygon",n);if(s&&s.length){var m=d.stroke&&d.stroke!=="none",y=_Ze(r,s,o);return Ve.createElement("g",{className:i},Ve.createElement("path",_0({},Jn(d,!0),{fill:y.slice(-1)==="Z"?d.fill:"none",stroke:"none",d:y})),m?Ve.createElement("path",_0({},Jn(d,!0),{fill:"none",d:BE(r,o)})):null,m?Ve.createElement("path",_0({},Jn(d,!0),{fill:"none",d:BE(s,o)})):null)}var S=BE(r,o);return Ve.createElement("path",_0({},Jn(d,!0),{fill:S.slice(-1)==="Z"?d.fill:"none",className:i,d:S}))};function Wz(){return Wz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Wz.apply(this,arguments)}var jI=function(t){var r=t.cx,n=t.cy,s=t.r,o=t.className,d=Ni("recharts-dot",o);return r===+r&&n===+n&&s===+s?V.createElement("circle",Wz({},Jn(t,!1),NO(t),{className:d,cx:r,cy:n,r:s})):null};function JT(e){"@babel/helpers - typeof";return JT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},JT(e)}var bZe=["x","y","top","left","width","height","className"];function Kz(){return Kz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Kz.apply(this,arguments)}function gZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function wZe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gZ(Object(r),!0).forEach(function(n){SZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SZe(e,t,r){return t=EZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EZe(e){var t=TZe(e,"string");return JT(t)=="symbol"?t:t+""}function TZe(e,t){if(JT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(JT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function AZe(e,t){if(e==null)return{};var r=CZe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function CZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var jZe=function(t,r,n,s,o,d){return"M".concat(t,",").concat(o,"v").concat(s,"M").concat(d,",").concat(r,"h").concat(n)},PZe=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,d=t.top,i=d===void 0?0:d,m=t.left,y=m===void 0?0:m,S=t.width,w=S===void 0?0:S,T=t.height,A=T===void 0?0:T,O=t.className,P=AZe(t,bZe),N=wZe({x:n,y:o,top:i,left:y,width:w,height:A},P);return!Gr(n)||!Gr(o)||!Gr(w)||!Gr(A)||!Gr(i)||!Gr(y)?null:Ve.createElement("path",Kz({},Jn(N,!0),{className:Ni("recharts-cross",O),d:jZe(n,o,w,A,i,y)}))},OZe=SI,kZe=_ce,NZe=nf;function IZe(e,t){return e&&e.length?OZe(e,NZe(t),kZe):void 0}var RZe=IZe;const MZe=Ps(RZe);var DZe=SI,LZe=nf,FZe=xce;function zZe(e,t){return e&&e.length?DZe(e,LZe(t),FZe):void 0}var BZe=zZe;const $Ze=Ps(BZe);var UZe=["cx","cy","angle","ticks","axisLine"],VZe=["ticks","tick","angle","tickFormatter","stroke"];function Db(e){"@babel/helpers - typeof";return Db=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Db(e)}function $E(){return $E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$E.apply(this,arguments)}function yZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function My(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yZ(Object(r),!0).forEach(function(n){PI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vZ(e,t){if(e==null)return{};var r=qZe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function qZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function HZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,uue(n.key),n)}}function GZe(e,t,r){return t&&_Z(e.prototype,t),r&&_Z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function WZe(e,t,r){return t=fk(t),KZe(e,cue()?Reflect.construct(t,r||[],fk(e).constructor):t.apply(e,r))}function KZe(e,t){if(t&&(Db(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ZZe(e)}function ZZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cue=function(){return!!e})()}function fk(e){return fk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fk(e)}function XZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zz(e,t)}function Zz(e,t){return Zz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Zz(e,t)}function PI(e,t,r){return t=uue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uue(e){var t=YZe(e,"string");return Db(t)=="symbol"?t:t+""}function YZe(e,t){if(Db(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Db(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var OI=function(e){function t(){return HZe(this,t),WZe(this,t,arguments)}return XZe(t,e),GZe(t,[{key:"getTickValueCoord",value:function(n){var s=n.coordinate,o=this.props,d=o.angle,i=o.cx,m=o.cy;return sa(i,m,s,d)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,s;switch(n){case"left":s="end";break;case"right":s="start";break;default:s="middle";break}return s}},{key:"getViewBox",value:function(){var n=this.props,s=n.cx,o=n.cy,d=n.angle,i=n.ticks,m=MZe(i,function(S){return S.coordinate||0}),y=$Ze(i,function(S){return S.coordinate||0});return{cx:s,cy:o,startAngle:d,endAngle:d,innerRadius:y.coordinate||0,outerRadius:m.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,d=n.angle,i=n.ticks,m=n.axisLine,y=vZ(n,UZe),S=i.reduce(function(O,P){return[Math.min(O[0],P.coordinate),Math.max(O[1],P.coordinate)]},[1/0,-1/0]),w=sa(s,o,S[0],d),T=sa(s,o,S[1],d),A=My(My(My({},Jn(y,!1)),{},{fill:"none"},Jn(m,!1)),{},{x1:w.x,y1:w.y,x2:T.x,y2:T.y});return Ve.createElement("line",$E({className:"recharts-polar-radius-axis-line"},A))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,d=s.tick,i=s.angle,m=s.tickFormatter,y=s.stroke,S=vZ(s,VZe),w=this.getTickTextAnchor(),T=Jn(S,!1),A=Jn(d,!1),O=o.map(function(P,N){var R=n.getTickValueCoord(P),M=My(My(My(My({textAnchor:w,transform:"rotate(".concat(90-i,", ").concat(R.x,", ").concat(R.y,")")},T),{},{stroke:"none",fill:y},A),{},{index:N},R),{},{payload:P});return Ve.createElement(Cs,$E({className:Ni("recharts-polar-radius-axis-tick",Zce(d)),key:"tick-".concat(P.coordinate)},Bv(n.props,P,N)),t.renderTickItem(d,M,m?m(P.value,N):P.value))});return Ve.createElement(Cs,{className:"recharts-polar-radius-axis-ticks"},O)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.axisLine,d=n.tick;return!s||!s.length?null:Ve.createElement(Cs,{className:Ni("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),d&&this.renderTicks(),dl.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,s,o){var d;return Ve.isValidElement(n)?d=Ve.cloneElement(n,s):vi(n)?d=n(s):d=Ve.createElement($v,$E({},s,{className:"recharts-polar-radius-axis-tick-value"}),o),d}}])}(V.PureComponent);PI(OI,"displayName","PolarRadiusAxis");PI(OI,"axisType","radiusAxis");PI(OI,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Lb(e){"@babel/helpers - typeof";return Lb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lb(e)}function Ky(){return Ky=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ky.apply(this,arguments)}function xZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Dy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xZ(Object(r),!0).forEach(function(n){kI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hue(n.key),n)}}function QZe(e,t,r){return t&&bZ(e.prototype,t),r&&bZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function eXe(e,t,r){return t=pk(t),tXe(e,due()?Reflect.construct(t,r||[],pk(e).constructor):t.apply(e,r))}function tXe(e,t){if(t&&(Lb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rXe(e)}function rXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function due(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(due=function(){return!!e})()}function pk(e){return pk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pk(e)}function nXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xz(e,t)}function Xz(e,t){return Xz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Xz(e,t)}function kI(e,t,r){return t=hue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hue(e){var t=iXe(e,"string");return Lb(t)=="symbol"?t:t+""}function iXe(e,t){if(Lb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Lb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sXe=Math.PI/180,wZ=1e-5,NI=function(e){function t(){return JZe(this,t),eXe(this,t,arguments)}return nXe(t,e),QZe(t,[{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.cx,d=s.cy,i=s.radius,m=s.orientation,y=s.tickSize,S=y||8,w=sa(o,d,i,n.coordinate),T=sa(o,d,i+(m==="inner"?-1:1)*S,n.coordinate);return{x1:w.x,y1:w.y,x2:T.x,y2:T.y}}},{key:"getTickTextAnchor",value:function(n){var s=this.props.orientation,o=Math.cos(-n.coordinate*sXe),d;return o>wZ?d=s==="outer"?"start":"end":o<-wZ?d=s==="outer"?"end":"start":d="middle",d}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,d=n.radius,i=n.axisLine,m=n.axisLineType,y=Dy(Dy({},Jn(this.props,!1)),{},{fill:"none"},Jn(i,!1));if(m==="circle")return Ve.createElement(jI,Ky({className:"recharts-polar-angle-axis-line"},y,{cx:s,cy:o,r:d}));var S=this.props.ticks,w=S.map(function(T){return sa(s,o,d,T.coordinate)});return Ve.createElement(xZe,Ky({className:"recharts-polar-angle-axis-line"},y,{points:w}))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,d=s.tick,i=s.tickLine,m=s.tickFormatter,y=s.stroke,S=Jn(this.props,!1),w=Jn(d,!1),T=Dy(Dy({},S),{},{fill:"none"},Jn(i,!1)),A=o.map(function(O,P){var N=n.getTickLineCoord(O),R=n.getTickTextAnchor(O),M=Dy(Dy(Dy({textAnchor:R},S),{},{stroke:"none",fill:y},w),{},{index:P,payload:O,x:N.x2,y:N.y2});return Ve.createElement(Cs,Ky({className:Ni("recharts-polar-angle-axis-tick",Zce(d)),key:"tick-".concat(O.coordinate)},Bv(n.props,O,P)),i&&Ve.createElement("line",Ky({className:"recharts-polar-angle-axis-tick-line"},T,N)),d&&t.renderTickItem(d,M,m?m(O.value,P):O.value))});return Ve.createElement(Cs,{className:"recharts-polar-angle-axis-ticks"},A)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.radius,d=n.axisLine;return o<=0||!s||!s.length?null:Ve.createElement(Cs,{className:Ni("recharts-polar-angle-axis",this.props.className)},d&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,s,o){var d;return Ve.isValidElement(n)?d=Ve.cloneElement(n,s):vi(n)?d=n(s):d=Ve.createElement($v,Ky({},s,{className:"recharts-polar-angle-axis-tick-value"}),o),d}}])}(V.PureComponent);kI(NI,"displayName","PolarAngleAxis");kI(NI,"axisType","angleAxis");kI(NI,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var aXe=mle,oXe=aXe(Object.getPrototypeOf,Object),lXe=oXe,cXe=vp,uXe=lXe,dXe=_p,hXe="[object Object]",fXe=Function.prototype,pXe=Object.prototype,fue=fXe.toString,mXe=pXe.hasOwnProperty,gXe=fue.call(Object);function yXe(e){if(!dXe(e)||cXe(e)!=hXe)return!1;var t=uXe(e);if(t===null)return!0;var r=mXe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&fue.call(r)==gXe}var vXe=yXe;const _Xe=Ps(vXe);var xXe=vp,bXe=_p,wXe="[object Boolean]";function SXe(e){return e===!0||e===!1||bXe(e)&&xXe(e)==wXe}var EXe=SXe;const TXe=Ps(EXe);function QT(e){"@babel/helpers - typeof";return QT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},QT(e)}function mk(){return mk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mk.apply(this,arguments)}function AXe(e,t){return OXe(e)||PXe(e,t)||jXe(e,t)||CXe()}function CXe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jXe(e,t){if(e){if(typeof e=="string")return SZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SZ(e,t)}}function SZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function PXe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function OXe(e){if(Array.isArray(e))return e}function EZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function TZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EZ(Object(r),!0).forEach(function(n){kXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kXe(e,t,r){return t=NXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NXe(e){var t=IXe(e,"string");return QT(t)=="symbol"?t:t+""}function IXe(e,t){if(QT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(QT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AZ=function(t,r,n,s,o){var d=n-s,i;return i="M ".concat(t,",").concat(r),i+="L ".concat(t+n,",").concat(r),i+="L ".concat(t+n-d/2,",").concat(r+o),i+="L ".concat(t+n-d/2-s,",").concat(r+o),i+="L ".concat(t,",").concat(r," Z"),i},RXe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},MXe=function(t){var r=TZ(TZ({},RXe),t),n=V.useRef(),s=V.useState(-1),o=AXe(s,2),d=o[0],i=o[1];V.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var F=n.current.getTotalLength();F&&i(F)}catch{}},[]);var m=r.x,y=r.y,S=r.upperWidth,w=r.lowerWidth,T=r.height,A=r.className,O=r.animationEasing,P=r.animationDuration,N=r.animationBegin,R=r.isUpdateAnimationActive;if(m!==+m||y!==+y||S!==+S||w!==+w||T!==+T||S===0&&w===0||T===0)return null;var M=Ni("recharts-trapezoid",A);return R?Ve.createElement(Zh,{canBegin:d>0,from:{upperWidth:0,lowerWidth:0,height:T,x:m,y},to:{upperWidth:S,lowerWidth:w,height:T,x:m,y},duration:P,animationEasing:O,isActive:R},function(F){var B=F.upperWidth,$=F.lowerWidth,W=F.height,K=F.x,te=F.y;return Ve.createElement(Zh,{canBegin:d>0,from:"0px ".concat(d===-1?1:d,"px"),to:"".concat(d,"px 0px"),attributeName:"strokeDasharray",begin:N,duration:P,easing:O},Ve.createElement("path",mk({},Jn(r,!0),{className:M,d:AZ(K,te,B,$,W),ref:n})))}):Ve.createElement("g",null,Ve.createElement("path",mk({},Jn(r,!0),{className:M,d:AZ(m,y,S,w,T)})))},DXe=["option","shapeType","propTransformer","activeClassName","isActive"];function e2(e){"@babel/helpers - typeof";return e2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e2(e)}function LXe(e,t){if(e==null)return{};var r=FXe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function FXe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function CZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function gk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CZ(Object(r),!0).forEach(function(n){zXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zXe(e,t,r){return t=BXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BXe(e){var t=$Xe(e,"string");return e2(t)=="symbol"?t:t+""}function $Xe(e,t){if(e2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(e2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function UXe(e,t){return gk(gk({},t),e)}function VXe(e,t){return e==="symbols"}function jZ(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ve.createElement(Q$,r);case"trapezoid":return Ve.createElement(MXe,r);case"sector":return Ve.createElement(Jce,r);case"symbols":if(VXe(t))return Ve.createElement(v$,r);break;default:return null}}function qXe(e){return V.isValidElement(e)?e.props:e}function pue(e){var t=e.option,r=e.shapeType,n=e.propTransformer,s=n===void 0?UXe:n,o=e.activeClassName,d=o===void 0?"recharts-active-shape":o,i=e.isActive,m=LXe(e,DXe),y;if(V.isValidElement(t))y=V.cloneElement(t,gk(gk({},m),qXe(t)));else if(vi(t))y=t(m);else if(_Xe(t)&&!TXe(t)){var S=s(t,m);y=Ve.createElement(jZ,{shapeType:r,elementProps:S})}else{var w=m;y=Ve.createElement(jZ,{shapeType:r,elementProps:w})}return i?Ve.createElement(Cs,{className:d},y):y}function II(e,t){return t!=null&&"trapezoids"in e.props}function RI(e,t){return t!=null&&"sectors"in e.props}function t2(e,t){return t!=null&&"points"in e.props}function HXe(e,t){var r,n,s=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return s&&o}function GXe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function WXe(e,t){var r=e.x===t.x,n=e.y===t.y,s=e.z===t.z;return r&&n&&s}function KXe(e,t){var r;return II(e,t)?r=HXe:RI(e,t)?r=GXe:t2(e,t)&&(r=WXe),r}function ZXe(e,t){var r;return II(e,t)?r="trapezoids":RI(e,t)?r="sectors":t2(e,t)&&(r="points"),r}function XXe(e,t){if(II(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(RI(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return t2(e,t)?t.payload:{}}function YXe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,s=ZXe(r,t),o=XXe(r,t),d=n.filter(function(m,y){var S=K2(o,m),w=r.props[s].filter(function(O){var P=KXe(r,t);return P(O,t)}),T=r.props[s].indexOf(w[w.length-1]),A=y===T;return S&&A}),i=n.indexOf(d[d.length-1]);return i}var fP;function Fb(e){"@babel/helpers - typeof";return Fb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fb(e)}function x0(){return x0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},x0.apply(this,arguments)}function PZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ra(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PZ(Object(r),!0).forEach(function(n){Uu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gue(n.key),n)}}function QXe(e,t,r){return t&&OZ(e.prototype,t),r&&OZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function eYe(e,t,r){return t=yk(t),tYe(e,mue()?Reflect.construct(t,r||[],yk(e).constructor):t.apply(e,r))}function tYe(e,t){if(t&&(Fb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rYe(e)}function rYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mue=function(){return!!e})()}function yk(e){return yk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},yk(e)}function nYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yz(e,t)}function Yz(e,t){return Yz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Yz(e,t)}function Uu(e,t,r){return t=gue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gue(e){var t=iYe(e,"string");return Fb(t)=="symbol"?t:t+""}function iYe(e,t){if(Fb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Fb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Xh=function(e){function t(r){var n;return JXe(this,t),n=eYe(this,t,[r]),Uu(n,"pieRef",null),Uu(n,"sectorRefs",[]),Uu(n,"id",vw("recharts-pie-")),Uu(n,"handleAnimationEnd",function(){var s=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),vi(s)&&s()}),Uu(n,"handleAnimationStart",function(){var s=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),vi(s)&&s()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return nYe(t,e),QXe(t,[{key:"isActiveIndex",value:function(n){var s=this.props.activeIndex;return Array.isArray(s)?s.indexOf(n)!==-1:n===s}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var o=this.props,d=o.label,i=o.labelLine,m=o.dataKey,y=o.valueKey,S=Jn(this.props,!1),w=Jn(d,!1),T=Jn(i,!1),A=d&&d.offsetRadius||20,O=n.map(function(P,N){var R=(P.startAngle+P.endAngle)/2,M=sa(P.cx,P.cy,P.outerRadius+A,R),F=ra(ra(ra(ra({},S),P),{},{stroke:"none"},w),{},{index:N,textAnchor:t.getTextAnchor(M.x,P.cx)},M),B=ra(ra(ra(ra({},S),P),{},{fill:"none",stroke:P.fill},T),{},{index:N,points:[sa(P.cx,P.cy,P.outerRadius,R),M]}),$=m;return Oi(m)&&Oi(y)?$="value":Oi(m)&&($=y),Ve.createElement(Cs,{key:"label-".concat(P.startAngle,"-").concat(P.endAngle,"-").concat(P.midAngle,"-").concat(N)},i&&t.renderLabelLineItem(i,B,"line"),t.renderLabelItem(d,F,Jo(P,$)))});return Ve.createElement(Cs,{className:"recharts-pie-labels"},O)}},{key:"renderSectorsStatically",value:function(n){var s=this,o=this.props,d=o.activeShape,i=o.blendStroke,m=o.inactiveShape;return n.map(function(y,S){if((y==null?void 0:y.startAngle)===0&&(y==null?void 0:y.endAngle)===0&&n.length!==1)return null;var w=s.isActiveIndex(S),T=m&&s.hasActiveIndex()?m:null,A=w?d:T,O=ra(ra({},y),{},{stroke:i?y.fill:y.stroke,tabIndex:-1});return Ve.createElement(Cs,x0({ref:function(N){N&&!s.sectorRefs.includes(N)&&s.sectorRefs.push(N)},tabIndex:-1,className:"recharts-pie-sector"},Bv(s.props,y,S),{key:"sector-".concat(y==null?void 0:y.startAngle,"-").concat(y==null?void 0:y.endAngle,"-").concat(y.midAngle,"-").concat(S)}),Ve.createElement(pue,x0({option:A,isActive:w,shapeType:"sector"},O)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,s=this.props,o=s.sectors,d=s.isAnimationActive,i=s.animationBegin,m=s.animationDuration,y=s.animationEasing,S=s.animationId,w=this.state,T=w.prevSectors,A=w.prevIsAnimationActive;return Ve.createElement(Zh,{begin:i,duration:m,isActive:d,easing:y,from:{t:0},to:{t:1},key:"pie-".concat(S,"-").concat(A),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(O){var P=O.t,N=[],R=o&&o[0],M=R.startAngle;return o.forEach(function(F,B){var $=T&&T[B],W=B>0?_u(F,"paddingAngle",0):0;if($){var K=du($.endAngle-$.startAngle,F.endAngle-F.startAngle),te=ra(ra({},F),{},{startAngle:M+W,endAngle:M+K(P)+W});N.push(te),M=te.endAngle}else{var ne=F.endAngle,ae=F.startAngle,re=du(0,ne-ae),ee=re(P),ie=ra(ra({},F),{},{startAngle:M+W,endAngle:M+ee+W});N.push(ie),M=ie.endAngle}}),Ve.createElement(Cs,null,n.renderSectorsStatically(N))})}},{key:"attachKeyboardHandlers",value:function(n){var s=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var d=++s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[d].focus(),s.setState({sectorToFocus:d});break}case"ArrowRight":{var i=--s.state.sectorToFocus<0?s.sectorRefs.length-1:s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[i].focus(),s.setState({sectorToFocus:i});break}case"Escape":{s.sectorRefs[s.state.sectorToFocus].blur(),s.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,s=n.sectors,o=n.isAnimationActive,d=this.state.prevSectors;return o&&s&&s.length&&(!d||!K2(d,s))?this.renderSectorsWithAnimation():this.renderSectorsStatically(s)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,s=this.props,o=s.hide,d=s.sectors,i=s.className,m=s.label,y=s.cx,S=s.cy,w=s.innerRadius,T=s.outerRadius,A=s.isAnimationActive,O=this.state.isAnimationFinished;if(o||!d||!d.length||!Gr(y)||!Gr(S)||!Gr(w)||!Gr(T))return null;var P=Ni("recharts-pie",i);return Ve.createElement(Cs,{tabIndex:this.props.rootTabIndex,className:P,ref:function(R){n.pieRef=R}},this.renderSectors(),m&&this.renderLabels(d),dl.renderCallByParent(this.props,null,!1),(!A||O)&&Qf.renderCallByParent(this.props,d,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return s.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:s.curSectors,isAnimationFinished:!0}:n.sectors!==s.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,s){return n>s?"start":n<s?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,s,o){if(Ve.isValidElement(n))return Ve.cloneElement(n,s);if(vi(n))return n(s);var d=Ni("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ve.createElement(lk,x0({},s,{key:o,type:"linear",className:d}))}},{key:"renderLabelItem",value:function(n,s,o){if(Ve.isValidElement(n))return Ve.cloneElement(n,s);var d=o;if(vi(n)&&(d=n(s),Ve.isValidElement(d)))return d;var i=Ni("recharts-pie-label-text",typeof n!="boolean"&&!vi(n)?n.className:"");return Ve.createElement($v,x0({},s,{alignmentBaseline:"middle",className:i}),d)}}])}(V.PureComponent);fP=Xh;Uu(Xh,"displayName","Pie");Uu(Xh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Bh.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Uu(Xh,"parseDeltaAngle",function(e,t){var r=hc(t-e),n=Math.min(Math.abs(t-e),360);return r*n});Uu(Xh,"getRealPieData",function(e){var t=e.data,r=e.children,n=Jn(e,!1),s=xu(r,kT);return t&&t.length?t.map(function(o,d){return ra(ra(ra({payload:o},n),o),s&&s[d]&&s[d].props)}):s&&s.length?s.map(function(o){return ra(ra({},n),o.props)}):[]});Uu(Xh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,s=t.width,o=t.height,d=Kce(s,o),i=n+fc(e.cx,s,s/2),m=r+fc(e.cy,o,o/2),y=fc(e.innerRadius,d,0),S=fc(e.outerRadius,d,d*.8),w=e.maxRadius||Math.sqrt(s*s+o*o)/2;return{cx:i,cy:m,innerRadius:y,outerRadius:S,maxRadius:w}});Uu(Xh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?ra(ra({},t.type.defaultProps),t.props):t.props,s=fP.getRealPieData(n);if(!s||!s.length)return null;var o=n.cornerRadius,d=n.startAngle,i=n.endAngle,m=n.paddingAngle,y=n.dataKey,S=n.nameKey,w=n.valueKey,T=n.tooltipType,A=Math.abs(n.minAngle),O=fP.parseCoordinateOfPie(n,r),P=fP.parseDeltaAngle(d,i),N=Math.abs(P),R=y;Oi(y)&&Oi(w)?(Vd(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),R="value"):Oi(y)&&(Vd(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),R=w);var M=s.filter(function(te){return Jo(te,R,0)!==0}).length,F=(N>=360?M:M-1)*m,B=N-M*A-F,$=s.reduce(function(te,ne){var ae=Jo(ne,R,0);return te+(Gr(ae)?ae:0)},0),W;if($>0){var K;W=s.map(function(te,ne){var ae=Jo(te,R,0),re=Jo(te,S,ne),ee=(Gr(ae)?ae:0)/$,ie;ne?ie=K.endAngle+hc(P)*m*(ae!==0?1:0):ie=d;var de=ie+hc(P)*((ae!==0?A:0)+ee*B),be=(ie+de)/2,Se=(O.innerRadius+O.outerRadius)/2,Ae=[{name:re,value:ae,payload:te,dataKey:R,type:T}],xe=sa(O.cx,O.cy,Se,be);return K=ra(ra(ra({percent:ee,cornerRadius:o,name:re,tooltipPayload:Ae,midAngle:be,middleRadius:Se,tooltipPosition:xe},te),O),{},{value:Jo(te,R),startAngle:ie,endAngle:de,payload:te,paddingAngle:hc(P)*m}),K})}return ra(ra({},O),{},{sectors:W,data:s})});var sYe=Math.ceil,aYe=Math.max;function oYe(e,t,r,n){for(var s=-1,o=aYe(sYe((t-e)/(r||1)),0),d=Array(o);o--;)d[n?o:++s]=e,e+=r;return d}var lYe=oYe,cYe=Rle,kZ=1/0,uYe=17976931348623157e292;function dYe(e){if(!e)return e===0?e:0;if(e=cYe(e),e===kZ||e===-kZ){var t=e<0?-1:1;return t*uYe}return e===e?e:0}var yue=dYe,hYe=lYe,fYe=gI,SL=yue;function pYe(e){return function(t,r,n){return n&&typeof n!="number"&&fYe(t,r,n)&&(r=n=void 0),t=SL(t),r===void 0?(r=t,t=0):r=SL(r),n=n===void 0?t<r?1:-1:SL(n),hYe(t,r,n,e)}}var mYe=pYe,gYe=mYe,yYe=gYe(),vYe=yYe;const vk=Ps(vYe);function r2(e){"@babel/helpers - typeof";return r2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r2(e)}function NZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function IZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NZ(Object(r),!0).forEach(function(n){vue(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vue(e,t,r){return t=_Ye(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _Ye(e){var t=xYe(e,"string");return r2(t)=="symbol"?t:t+""}function xYe(e,t){if(r2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(r2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var bYe=["Webkit","Moz","O","ms"],wYe=function(t,r){var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),s=bYe.reduce(function(o,d){return IZ(IZ({},o),{},vue({},d+n,r))},{});return s[t]=r,s};function zb(e){"@babel/helpers - typeof";return zb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zb(e)}function _k(){return _k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_k.apply(this,arguments)}function RZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function EL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RZ(Object(r),!0).forEach(function(n){au(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function MZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xue(n.key),n)}}function EYe(e,t,r){return t&&MZ(e.prototype,t),r&&MZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function TYe(e,t,r){return t=xk(t),AYe(e,_ue()?Reflect.construct(t,r||[],xk(e).constructor):t.apply(e,r))}function AYe(e,t){if(t&&(zb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CYe(e)}function CYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _ue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_ue=function(){return!!e})()}function xk(e){return xk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},xk(e)}function jYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Jz(e,t)}function Jz(e,t){return Jz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Jz(e,t)}function au(e,t,r){return t=xue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xue(e){var t=PYe(e,"string");return zb(t)=="symbol"?t:t+""}function PYe(e,t){if(zb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(zb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var OYe=function(t){var r=t.data,n=t.startIndex,s=t.endIndex,o=t.x,d=t.width,i=t.travellerWidth;if(!r||!r.length)return{};var m=r.length,y=LE().domain(vk(0,m)).range([o,o+d-i]),S=y.domain().map(function(w){return y(w)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:y(n),endX:y(s),scale:y,scaleValues:S}},DZ=function(t){return t.changedTouches&&!!t.changedTouches.length},Bb=function(e){function t(r){var n;return SYe(this,t),n=TYe(this,t,[r]),au(n,"handleDrag",function(s){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(s):n.state.isSlideMoving&&n.handleSlideDrag(s)}),au(n,"handleTouchMove",function(s){s.changedTouches!=null&&s.changedTouches.length>0&&n.handleDrag(s.changedTouches[0])}),au(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var s=n.props,o=s.endIndex,d=s.onDragEnd,i=s.startIndex;d==null||d({endIndex:o,startIndex:i})}),n.detachDragEndListener()}),au(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),au(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),au(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),au(n,"handleSlideDragStart",function(s){var o=DZ(s)?s.changedTouches[0]:s;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return jYe(t,e),EYe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var s=n.startX,o=n.endX,d=this.state.scaleValues,i=this.props,m=i.gap,y=i.data,S=y.length-1,w=Math.min(s,o),T=Math.max(s,o),A=t.getIndexInRange(d,w),O=t.getIndexInRange(d,T);return{startIndex:A-A%m,endIndex:O===S?S:O-O%m}}},{key:"getTextOfTick",value:function(n){var s=this.props,o=s.data,d=s.tickFormatter,i=s.dataKey,m=Jo(o[n],i,n);return vi(d)?d(m,n):m}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var s=this.state,o=s.slideMoveStartX,d=s.startX,i=s.endX,m=this.props,y=m.x,S=m.width,w=m.travellerWidth,T=m.startIndex,A=m.endIndex,O=m.onChange,P=n.pageX-o;P>0?P=Math.min(P,y+S-w-i,y+S-w-d):P<0&&(P=Math.max(P,y-d,y-i));var N=this.getIndex({startX:d+P,endX:i+P});(N.startIndex!==T||N.endIndex!==A)&&O&&O(N),this.setState({startX:d+P,endX:i+P,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,s){var o=DZ(s)?s.changedTouches[0]:s;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var s=this.state,o=s.brushMoveStartX,d=s.movingTravellerId,i=s.endX,m=s.startX,y=this.state[d],S=this.props,w=S.x,T=S.width,A=S.travellerWidth,O=S.onChange,P=S.gap,N=S.data,R={startX:this.state.startX,endX:this.state.endX},M=n.pageX-o;M>0?M=Math.min(M,w+T-A-y):M<0&&(M=Math.max(M,w-y)),R[d]=y+M;var F=this.getIndex(R),B=F.startIndex,$=F.endIndex,W=function(){var te=N.length-1;return d==="startX"&&(i>m?B%P===0:$%P===0)||i<m&&$===te||d==="endX"&&(i>m?$%P===0:B%P===0)||i>m&&$===te};this.setState(au(au({},d,y+M),"brushMoveStartX",n.pageX),function(){O&&W()&&O(F)})}},{key:"handleTravellerMoveKeyboard",value:function(n,s){var o=this,d=this.state,i=d.scaleValues,m=d.startX,y=d.endX,S=this.state[s],w=i.indexOf(S);if(w!==-1){var T=w+n;if(!(T===-1||T>=i.length)){var A=i[T];s==="startX"&&A>=y||s==="endX"&&A<=m||this.setState(au({},s,A),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,s=n.x,o=n.y,d=n.width,i=n.height,m=n.fill,y=n.stroke;return Ve.createElement("rect",{stroke:y,fill:m,x:s,y:o,width:d,height:i})}},{key:"renderPanorama",value:function(){var n=this.props,s=n.x,o=n.y,d=n.width,i=n.height,m=n.data,y=n.children,S=n.padding,w=V.Children.only(y);return w?Ve.cloneElement(w,{x:s,y:o,width:d,height:i,margin:S,compact:!0,data:m}):null}},{key:"renderTravellerLayer",value:function(n,s){var o,d,i=this,m=this.props,y=m.y,S=m.travellerWidth,w=m.height,T=m.traveller,A=m.ariaLabel,O=m.data,P=m.startIndex,N=m.endIndex,R=Math.max(n,this.props.x),M=EL(EL({},Jn(this.props,!1)),{},{x:R,y,width:S,height:w}),F=A||"Min value: ".concat((o=O[P])===null||o===void 0?void 0:o.name,", Max value: ").concat((d=O[N])===null||d===void 0?void 0:d.name);return Ve.createElement(Cs,{tabIndex:0,role:"slider","aria-label":F,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[s],onTouchStart:this.travellerDragStartHandlers[s],onKeyDown:function($){["ArrowLeft","ArrowRight"].includes($.key)&&($.preventDefault(),$.stopPropagation(),i.handleTravellerMoveKeyboard($.key==="ArrowRight"?1:-1,s))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(T,M))}},{key:"renderSlide",value:function(n,s){var o=this.props,d=o.y,i=o.height,m=o.stroke,y=o.travellerWidth,S=Math.min(n,s)+y,w=Math.max(Math.abs(s-n)-y,0);return Ve.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:m,fillOpacity:.2,x:S,y:d,width:w,height:i})}},{key:"renderText",value:function(){var n=this.props,s=n.startIndex,o=n.endIndex,d=n.y,i=n.height,m=n.travellerWidth,y=n.stroke,S=this.state,w=S.startX,T=S.endX,A=5,O={pointerEvents:"none",fill:y};return Ve.createElement(Cs,{className:"recharts-brush-texts"},Ve.createElement($v,_k({textAnchor:"end",verticalAnchor:"middle",x:Math.min(w,T)-A,y:d+i/2},O),this.getTextOfTick(s)),Ve.createElement($v,_k({textAnchor:"start",verticalAnchor:"middle",x:Math.max(w,T)+m+A,y:d+i/2},O),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,s=n.data,o=n.className,d=n.children,i=n.x,m=n.y,y=n.width,S=n.height,w=n.alwaysShowText,T=this.state,A=T.startX,O=T.endX,P=T.isTextActive,N=T.isSlideMoving,R=T.isTravellerMoving,M=T.isTravellerFocused;if(!s||!s.length||!Gr(i)||!Gr(m)||!Gr(y)||!Gr(S)||y<=0||S<=0)return null;var F=Ni("recharts-brush",o),B=Ve.Children.count(d)===1,$=wYe("userSelect","none");return Ve.createElement(Cs,{className:F,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:$},this.renderBackground(),B&&this.renderPanorama(),this.renderSlide(A,O),this.renderTravellerLayer(A,"startX"),this.renderTravellerLayer(O,"endX"),(P||N||R||M||w)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var s=n.x,o=n.y,d=n.width,i=n.height,m=n.stroke,y=Math.floor(o+i/2)-1;return Ve.createElement(Ve.Fragment,null,Ve.createElement("rect",{x:s,y:o,width:d,height:i,fill:m,stroke:"none"}),Ve.createElement("line",{x1:s+1,y1:y,x2:s+d-1,y2:y,fill:"none",stroke:"#fff"}),Ve.createElement("line",{x1:s+1,y1:y+2,x2:s+d-1,y2:y+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,s){var o;return Ve.isValidElement(n)?o=Ve.cloneElement(n,s):vi(n)?o=n(s):o=t.renderDefaultTraveller(s),o}},{key:"getDerivedStateFromProps",value:function(n,s){var o=n.data,d=n.width,i=n.x,m=n.travellerWidth,y=n.updateId,S=n.startIndex,w=n.endIndex;if(o!==s.prevData||y!==s.prevUpdateId)return EL({prevData:o,prevTravellerWidth:m,prevUpdateId:y,prevX:i,prevWidth:d},o&&o.length?OYe({data:o,width:d,x:i,travellerWidth:m,startIndex:S,endIndex:w}):{scale:null,scaleValues:null});if(s.scale&&(d!==s.prevWidth||i!==s.prevX||m!==s.prevTravellerWidth)){s.scale.range([i,i+d-m]);var T=s.scale.domain().map(function(A){return s.scale(A)});return{prevData:o,prevTravellerWidth:m,prevUpdateId:y,prevX:i,prevWidth:d,startX:s.scale(n.startIndex),endX:s.scale(n.endIndex),scaleValues:T}}return null}},{key:"getIndexInRange",value:function(n,s){for(var o=n.length,d=0,i=o-1;i-d>1;){var m=Math.floor((d+i)/2);n[m]>s?i=m:d=m}return s>=n[i]?i:d}}])}(V.PureComponent);au(Bb,"displayName","Brush");au(Bb,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var kYe=T$;function NYe(e,t){var r;return kYe(e,function(n,s,o){return r=t(n,s,o),!r}),!!r}var IYe=NYe,RYe=ole,MYe=nf,DYe=IYe,LYe=Yc,FYe=gI;function zYe(e,t,r){var n=LYe(e)?RYe:DYe;return r&&FYe(e,t,r)&&(t=void 0),n(e,MYe(t))}var BYe=zYe;const $Ye=Ps(BYe);var Uh=function(t,r){var n=t.alwaysShow,s=t.ifOverflow;return n&&(s="extendDomain"),s===r},LZ=Ple;function UYe(e,t,r){t=="__proto__"&&LZ?LZ(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var VYe=UYe,qYe=VYe,HYe=Cle,GYe=nf;function WYe(e,t){var r={};return t=GYe(t),HYe(e,function(n,s,o){qYe(r,s,t(n,s,o))}),r}var KYe=WYe;const ZYe=Ps(KYe);function XYe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var YYe=XYe,JYe=T$;function QYe(e,t){var r=!0;return JYe(e,function(n,s,o){return r=!!t(n,s,o),r}),r}var eJe=QYe,tJe=YYe,rJe=eJe,nJe=nf,iJe=Yc,sJe=gI;function aJe(e,t,r){var n=iJe(e)?tJe:rJe;return r&&sJe(e,t,r)&&(t=void 0),n(e,nJe(t))}var oJe=aJe;const bue=Ps(oJe);var lJe=["x","y"];function n2(e){"@babel/helpers - typeof";return n2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n2(e)}function Qz(){return Qz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qz.apply(this,arguments)}function FZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function rE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FZ(Object(r),!0).forEach(function(n){cJe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cJe(e,t,r){return t=uJe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uJe(e){var t=dJe(e,"string");return n2(t)=="symbol"?t:t+""}function dJe(e,t){if(n2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(n2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hJe(e,t){if(e==null)return{};var r=fJe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fJe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function pJe(e,t){var r=e.x,n=e.y,s=hJe(e,lJe),o="".concat(r),d=parseInt(o,10),i="".concat(n),m=parseInt(i,10),y="".concat(t.height||s.height),S=parseInt(y,10),w="".concat(t.width||s.width),T=parseInt(w,10);return rE(rE(rE(rE(rE({},t),s),d?{x:d}:{}),m?{y:m}:{}),{},{height:S,width:T,name:t.name,radius:t.radius})}function zZ(e){return Ve.createElement(pue,Qz({shapeType:"rectangle",propTransformer:pJe,activeClassName:"recharts-active-bar"},e))}var mJe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,s){if(typeof t=="number")return t;var o=Gr(n)||$Le(n);return o?t(n,s):(o||Vv(),r)}},gJe=["value","background"],wue;function $b(e){"@babel/helpers - typeof";return $b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$b(e)}function yJe(e,t){if(e==null)return{};var r=vJe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function vJe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function bk(){return bk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bk.apply(this,arguments)}function BZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Po(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BZ(Object(r),!0).forEach(function(n){Km(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Eue(n.key),n)}}function xJe(e,t,r){return t&&$Z(e.prototype,t),r&&$Z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function bJe(e,t,r){return t=wk(t),wJe(e,Sue()?Reflect.construct(t,r||[],wk(e).constructor):t.apply(e,r))}function wJe(e,t){if(t&&($b(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SJe(e)}function SJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Sue=function(){return!!e})()}function wk(e){return wk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wk(e)}function EJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e4(e,t)}function e4(e,t){return e4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},e4(e,t)}function Km(e,t,r){return t=Eue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Eue(e){var t=TJe(e,"string");return $b(t)=="symbol"?t:t+""}function TJe(e,t){if($b(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($b(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Vu=function(e){function t(){var r;_Je(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=bJe(this,t,[].concat(s)),Km(r,"state",{isAnimationFinished:!1}),Km(r,"id",vw("recharts-bar-")),Km(r,"handleAnimationEnd",function(){var d=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),d&&d()}),Km(r,"handleAnimationStart",function(){var d=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),d&&d()}),r}return EJe(t,e),xJe(t,[{key:"renderRectanglesStatically",value:function(n){var s=this,o=this.props,d=o.shape,i=o.dataKey,m=o.activeIndex,y=o.activeBar,S=Jn(this.props,!1);return n&&n.map(function(w,T){var A=T===m,O=A?y:d,P=Po(Po(Po({},S),w),{},{isActive:A,option:O,index:T,dataKey:i,onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd});return Ve.createElement(Cs,bk({className:"recharts-bar-rectangle"},Bv(s.props,w,T),{key:"rectangle-".concat(w==null?void 0:w.x,"-").concat(w==null?void 0:w.y,"-").concat(w==null?void 0:w.value,"-").concat(T)}),Ve.createElement(zZ,P))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,s=this.props,o=s.data,d=s.layout,i=s.isAnimationActive,m=s.animationBegin,y=s.animationDuration,S=s.animationEasing,w=s.animationId,T=this.state.prevData;return Ve.createElement(Zh,{begin:m,duration:y,isActive:i,easing:S,from:{t:0},to:{t:1},key:"bar-".concat(w),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(A){var O=A.t,P=o.map(function(N,R){var M=T&&T[R];if(M){var F=du(M.x,N.x),B=du(M.y,N.y),$=du(M.width,N.width),W=du(M.height,N.height);return Po(Po({},N),{},{x:F(O),y:B(O),width:$(O),height:W(O)})}if(d==="horizontal"){var K=du(0,N.height),te=K(O);return Po(Po({},N),{},{y:N.y+N.height-te,height:te})}var ne=du(0,N.width),ae=ne(O);return Po(Po({},N),{},{width:ae})});return Ve.createElement(Cs,null,n.renderRectanglesStatically(P))})}},{key:"renderRectangles",value:function(){var n=this.props,s=n.data,o=n.isAnimationActive,d=this.state.prevData;return o&&s&&s.length&&(!d||!K2(d,s))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(s)}},{key:"renderBackground",value:function(){var n=this,s=this.props,o=s.data,d=s.dataKey,i=s.activeIndex,m=Jn(this.props.background,!1);return o.map(function(y,S){y.value;var w=y.background,T=yJe(y,gJe);if(!w)return null;var A=Po(Po(Po(Po(Po({},T),{},{fill:"#eee"},w),m),Bv(n.props,y,S)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:d,index:S,className:"recharts-bar-background-rectangle"});return Ve.createElement(zZ,bk({key:"background-bar-".concat(S),option:n.props.background,isActive:S===i},A))})}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,d=o.data,i=o.xAxis,m=o.yAxis,y=o.layout,S=o.children,w=xu(S,Z2);if(!w)return null;var T=y==="vertical"?d[0].height/2:d[0].width/2,A=function(N,R){var M=Array.isArray(N.value)?N.value[1]:N.value;return{x:N.x,y:N.y,value:M,errorVal:Jo(N,R)}},O={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ve.createElement(Cs,O,w.map(function(P){return Ve.cloneElement(P,{key:"error-bar-".concat(s,"-").concat(P.props.dataKey),data:d,xAxis:i,yAxis:m,layout:y,offset:T,dataPointFormatter:A})}))}},{key:"render",value:function(){var n=this.props,s=n.hide,o=n.data,d=n.className,i=n.xAxis,m=n.yAxis,y=n.left,S=n.top,w=n.width,T=n.height,A=n.isAnimationActive,O=n.background,P=n.id;if(s||!o||!o.length)return null;var N=this.state.isAnimationFinished,R=Ni("recharts-bar",d),M=i&&i.allowDataOverflow,F=m&&m.allowDataOverflow,B=M||F,$=Oi(P)?this.id:P;return Ve.createElement(Cs,{className:R},M||F?Ve.createElement("defs",null,Ve.createElement("clipPath",{id:"clipPath-".concat($)},Ve.createElement("rect",{x:M?y:y-w/2,y:F?S:S-T/2,width:M?w:w*2,height:F?T:T*2}))):null,Ve.createElement(Cs,{className:"recharts-bar-rectangles",clipPath:B?"url(#clipPath-".concat($,")"):null},O?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(B,$),(!A||N)&&Qf.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:s.curData}:n.data!==s.curData?{curData:n.data}:null}}])}(V.PureComponent);wue=Vu;Km(Vu,"displayName","Bar");Km(Vu,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Bh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Km(Vu,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,s=e.bandSize,o=e.xAxis,d=e.yAxis,i=e.xAxisTicks,m=e.yAxisTicks,y=e.stackedData,S=e.dataStartIndex,w=e.displayedData,T=e.offset,A=sWe(n,r);if(!A)return null;var O=t.layout,P=r.type.defaultProps,N=P!==void 0?Po(Po({},P),r.props):r.props,R=N.dataKey,M=N.children,F=N.minPointSize,B=O==="horizontal"?d:o,$=y?B.scale.domain():null,W=hWe({numericAxis:B}),K=xu(M,kT),te=w.map(function(ne,ae){var re,ee,ie,de,be,Se;y?re=aWe(y[S+ae],$):(re=Jo(ne,R),Array.isArray(re)||(re=[W,re]));var Ae=mJe(F,wue.defaultProps.minPointSize)(re[1],ae);if(O==="horizontal"){var xe,me=[d.scale(re[0]),d.scale(re[1])],Ce=me[0],ge=me[1];ee=OK({axis:o,ticks:i,bandSize:s,offset:A.offset,entry:ne,index:ae}),ie=(xe=ge??Ce)!==null&&xe!==void 0?xe:void 0,de=A.size;var pe=Ce-ge;if(be=Number.isNaN(pe)?0:pe,Se={x:ee,y:d.y,width:de,height:d.height},Math.abs(Ae)>0&&Math.abs(be)<Math.abs(Ae)){var Oe=hc(be||Ae)*(Math.abs(Ae)-Math.abs(be));ie-=Oe,be+=Oe}}else{var Xe=[o.scale(re[0]),o.scale(re[1])],We=Xe[0],$e=Xe[1];if(ee=We,ie=OK({axis:d,ticks:m,bandSize:s,offset:A.offset,entry:ne,index:ae}),de=$e-We,be=A.size,Se={x:o.x,y:ie,width:o.width,height:be},Math.abs(Ae)>0&&Math.abs(de)<Math.abs(Ae)){var Ke=hc(de||Ae)*(Math.abs(Ae)-Math.abs(de));de+=Ke}}return Po(Po(Po({},ne),{},{x:ee,y:ie,width:de,height:be,value:y?re:re[1],payload:ne,background:Se},K&&K[ae]&&K[ae].props),{},{tooltipPayload:[Gce(r,ne)],tooltipPosition:{x:ee+de/2,y:ie+be/2}})});return Po({data:te,layout:O},T)});function i2(e){"@babel/helpers - typeof";return i2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i2(e)}function AJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function UZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Tue(n.key),n)}}function CJe(e,t,r){return t&&UZ(e.prototype,t),r&&UZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function VZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Id(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VZ(Object(r),!0).forEach(function(n){MI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MI(e,t,r){return t=Tue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tue(e){var t=jJe(e,"string");return i2(t)=="symbol"?t:t+""}function jJe(e,t){if(i2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(i2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Aue=function(t,r,n,s,o){var d=t.width,i=t.height,m=t.layout,y=t.children,S=Object.keys(r),w={left:n.left,leftMirror:n.left,right:d-n.right,rightMirror:d-n.right,top:n.top,topMirror:n.top,bottom:i-n.bottom,bottomMirror:i-n.bottom},T=!!lu(y,Vu);return S.reduce(function(A,O){var P=r[O],N=P.orientation,R=P.domain,M=P.padding,F=M===void 0?{}:M,B=P.mirror,$=P.reversed,W="".concat(N).concat(B?"Mirror":""),K,te,ne,ae,re;if(P.type==="number"&&(P.padding==="gap"||P.padding==="no-gap")){var ee=R[1]-R[0],ie=1/0,de=P.categoricalDomain.sort(qLe);if(de.forEach(function(Xe,We){We>0&&(ie=Math.min((Xe||0)-(de[We-1]||0),ie))}),Number.isFinite(ie)){var be=ie/ee,Se=P.layout==="vertical"?n.height:n.width;if(P.padding==="gap"&&(K=be*Se/2),P.padding==="no-gap"){var Ae=fc(t.barCategoryGap,be*Se),xe=be*Se/2;K=xe-Ae-(xe-Ae)/Se*Ae}}}s==="xAxis"?te=[n.left+(F.left||0)+(K||0),n.left+n.width-(F.right||0)-(K||0)]:s==="yAxis"?te=m==="horizontal"?[n.top+n.height-(F.bottom||0),n.top+(F.top||0)]:[n.top+(F.top||0)+(K||0),n.top+n.height-(F.bottom||0)-(K||0)]:te=P.range,$&&(te=[te[1],te[0]]);var me=Uce(P,o,T),Ce=me.scale,ge=me.realScaleType;Ce.domain(R).range(te),Vce(Ce);var pe=qce(Ce,Id(Id({},P),{},{realScaleType:ge}));s==="xAxis"?(re=N==="top"&&!B||N==="bottom"&&B,ne=n.left,ae=w[W]-re*P.height):s==="yAxis"&&(re=N==="left"&&!B||N==="right"&&B,ne=w[W]-re*P.width,ae=n.top);var Oe=Id(Id(Id({},P),pe),{},{realScaleType:ge,x:ne,y:ae,scale:Ce,width:s==="xAxis"?n.width:P.width,height:s==="yAxis"?n.height:P.height});return Oe.bandSize=sk(Oe,pe),!P.hide&&s==="xAxis"?w[W]+=(re?-1:1)*Oe.height:P.hide||(w[W]+=(re?-1:1)*Oe.width),Id(Id({},A),{},MI({},O,Oe))},{})},Cue=function(t,r){var n=t.x,s=t.y,o=r.x,d=r.y;return{x:Math.min(n,o),y:Math.min(s,d),width:Math.abs(o-n),height:Math.abs(d-s)}},PJe=function(t){var r=t.x1,n=t.y1,s=t.x2,o=t.y2;return Cue({x:r,y:n},{x:s,y:o})},jue=function(){function e(t){AJe(this,e),this.scale=t}return CJe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var d=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+d}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(r)+i}default:return this.scale(r)}if(s){var m=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+m}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),s=n[0],o=n[n.length-1];return s<=o?r>=s&&r<=o:r>=o&&r<=s}}],[{key:"create",value:function(r){return new e(r)}}])}();MI(jue,"EPS",1e-4);var eU=function(t){var r=Object.keys(t).reduce(function(n,s){return Id(Id({},n),{},MI({},s,jue.create(t[s])))},{});return Id(Id({},r),{},{apply:function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=o.bandAware,i=o.position;return ZYe(s,function(m,y){return r[y].apply(m,{bandAware:d,position:i})})},isInRange:function(s){return bue(s,function(o,d){return r[d].isInRange(o)})}})};function OJe(e){return(e%180+180)%180}var kJe=function(t){var r=t.width,n=t.height,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=OJe(s),d=o*Math.PI/180,i=Math.atan(n/r),m=d>i&&d<Math.PI-i?n/Math.sin(d):r/Math.cos(d);return Math.abs(m)},NJe=nf,IJe=V2,RJe=pI;function MJe(e){return function(t,r,n){var s=Object(t);if(!IJe(t)){var o=NJe(r);t=RJe(t),r=function(i){return o(s[i],i,s)}}var d=e(t,r,n);return d>-1?s[o?t[d]:d]:void 0}}var DJe=MJe,LJe=yue;function FJe(e){var t=LJe(e),r=t%1;return t===t?r?t-r:t:0}var zJe=FJe,BJe=ble,$Je=nf,UJe=zJe,VJe=Math.max;function qJe(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var s=r==null?0:UJe(r);return s<0&&(s=VJe(n+s,0)),BJe(e,$Je(t),s)}var HJe=qJe,GJe=DJe,WJe=HJe,KJe=GJe(WJe),ZJe=KJe;const XJe=Ps(ZJe);var YJe=HDe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),tU=V.createContext(void 0),rU=V.createContext(void 0),Pue=V.createContext(void 0),Oue=V.createContext({}),kue=V.createContext(void 0),Nue=V.createContext(0),Iue=V.createContext(0),qZ=function(t){var r=t.state,n=r.xAxisMap,s=r.yAxisMap,o=r.offset,d=t.clipPathId,i=t.children,m=t.width,y=t.height,S=YJe(o);return Ve.createElement(tU.Provider,{value:n},Ve.createElement(rU.Provider,{value:s},Ve.createElement(Oue.Provider,{value:o},Ve.createElement(Pue.Provider,{value:S},Ve.createElement(kue.Provider,{value:d},Ve.createElement(Nue.Provider,{value:y},Ve.createElement(Iue.Provider,{value:m},i)))))))},JJe=function(){return V.useContext(kue)},Rue=function(t){var r=V.useContext(tU);r==null&&Vv();var n=r[t];return n==null&&Vv(),n},QJe=function(){var t=V.useContext(tU);return Im(t)},eQe=function(){var t=V.useContext(rU),r=XJe(t,function(n){return bue(n.domain,Number.isFinite)});return r||Im(t)},Mue=function(t){var r=V.useContext(rU);r==null&&Vv();var n=r[t];return n==null&&Vv(),n},tQe=function(){var t=V.useContext(Pue);return t},rQe=function(){return V.useContext(Oue)},nU=function(){return V.useContext(Iue)},iU=function(){return V.useContext(Nue)};function Ub(e){"@babel/helpers - typeof";return Ub=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ub(e)}function nQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function iQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Lue(n.key),n)}}function sQe(e,t,r){return t&&iQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function aQe(e,t,r){return t=Sk(t),oQe(e,Due()?Reflect.construct(t,r||[],Sk(e).constructor):t.apply(e,r))}function oQe(e,t){if(t&&(Ub(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lQe(e)}function lQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Due(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Due=function(){return!!e})()}function Sk(e){return Sk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sk(e)}function cQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&t4(e,t)}function t4(e,t){return t4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},t4(e,t)}function HZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function GZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HZ(Object(r),!0).forEach(function(n){sU(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sU(e,t,r){return t=Lue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lue(e){var t=uQe(e,"string");return Ub(t)=="symbol"?t:t+""}function uQe(e,t){if(Ub(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ub(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dQe(e,t){return mQe(e)||pQe(e,t)||fQe(e,t)||hQe()}function hQe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fQe(e,t){if(e){if(typeof e=="string")return WZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WZ(e,t)}}function WZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pQe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function mQe(e){if(Array.isArray(e))return e}function r4(){return r4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r4.apply(this,arguments)}var gQe=function(t,r){var n;return Ve.isValidElement(t)?n=Ve.cloneElement(t,r):vi(t)?n=t(r):n=Ve.createElement("line",r4({},r,{className:"recharts-reference-line-line"})),n},yQe=function(t,r,n,s,o,d,i,m,y){var S=o.x,w=o.y,T=o.width,A=o.height;if(n){var O=y.y,P=t.y.apply(O,{position:d});if(Uh(y,"discard")&&!t.y.isInRange(P))return null;var N=[{x:S+T,y:P},{x:S,y:P}];return m==="left"?N.reverse():N}if(r){var R=y.x,M=t.x.apply(R,{position:d});if(Uh(y,"discard")&&!t.x.isInRange(M))return null;var F=[{x:M,y:w+A},{x:M,y:w}];return i==="top"?F.reverse():F}if(s){var B=y.segment,$=B.map(function(W){return t.apply(W,{position:d})});return Uh(y,"discard")&&$Ye($,function(W){return!t.isInRange(W)})?null:$}return null};function vQe(e){var t=e.x,r=e.y,n=e.segment,s=e.xAxisId,o=e.yAxisId,d=e.shape,i=e.className,m=e.alwaysShow,y=JJe(),S=Rue(s),w=Mue(o),T=tQe();if(!y||!T)return null;Vd(m===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var A=eU({x:S.scale,y:w.scale}),O=el(t),P=el(r),N=n&&n.length===2,R=yQe(A,O,P,N,T,e.position,S.orientation,w.orientation,e);if(!R)return null;var M=dQe(R,2),F=M[0],B=F.x,$=F.y,W=M[1],K=W.x,te=W.y,ne=Uh(e,"hidden")?"url(#".concat(y,")"):void 0,ae=GZ(GZ({clipPath:ne},Jn(e,!0)),{},{x1:B,y1:$,x2:K,y2:te});return Ve.createElement(Cs,{className:Ni("recharts-reference-line",i)},gQe(d,ae),dl.renderCallByParent(e,PJe({x1:B,y1:$,x2:K,y2:te})))}var aU=function(e){function t(){return nQe(this,t),aQe(this,t,arguments)}return cQe(t,e),sQe(t,[{key:"render",value:function(){return Ve.createElement(vQe,this.props)}}])}(Ve.Component);sU(aU,"displayName","ReferenceLine");sU(aU,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function n4(){return n4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n4.apply(this,arguments)}function Vb(e){"@babel/helpers - typeof";return Vb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vb(e)}function KZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ZZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KZ(Object(r),!0).forEach(function(n){DI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _Qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zue(n.key),n)}}function bQe(e,t,r){return t&&xQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function wQe(e,t,r){return t=Ek(t),SQe(e,Fue()?Reflect.construct(t,r||[],Ek(e).constructor):t.apply(e,r))}function SQe(e,t){if(t&&(Vb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return EQe(e)}function EQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Fue=function(){return!!e})()}function Ek(e){return Ek=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ek(e)}function TQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i4(e,t)}function i4(e,t){return i4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},i4(e,t)}function DI(e,t,r){return t=zue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zue(e){var t=AQe(e,"string");return Vb(t)=="symbol"?t:t+""}function AQe(e,t){if(Vb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Vb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var CQe=function(t){var r=t.x,n=t.y,s=t.xAxis,o=t.yAxis,d=eU({x:s.scale,y:o.scale}),i=d.apply({x:r,y:n},{bandAware:!0});return Uh(t,"discard")&&!d.isInRange(i)?null:i},LI=function(e){function t(){return _Qe(this,t),wQe(this,t,arguments)}return TQe(t,e),bQe(t,[{key:"render",value:function(){var n=this.props,s=n.x,o=n.y,d=n.r,i=n.alwaysShow,m=n.clipPathId,y=el(s),S=el(o);if(Vd(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!y||!S)return null;var w=CQe(this.props);if(!w)return null;var T=w.x,A=w.y,O=this.props,P=O.shape,N=O.className,R=Uh(this.props,"hidden")?"url(#".concat(m,")"):void 0,M=ZZ(ZZ({clipPath:R},Jn(this.props,!0)),{},{cx:T,cy:A});return Ve.createElement(Cs,{className:Ni("recharts-reference-dot",N)},t.renderDot(P,M),dl.renderCallByParent(this.props,{x:T-d,y:A-d,width:2*d,height:2*d}))}}])}(Ve.Component);DI(LI,"displayName","ReferenceDot");DI(LI,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});DI(LI,"renderDot",function(e,t){var r;return Ve.isValidElement(e)?r=Ve.cloneElement(e,t):vi(e)?r=e(t):r=Ve.createElement(jI,n4({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function s4(){return s4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s4.apply(this,arguments)}function qb(e){"@babel/helpers - typeof";return qb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qb(e)}function XZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function YZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XZ(Object(r),!0).forEach(function(n){FI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$ue(n.key),n)}}function OQe(e,t,r){return t&&PQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function kQe(e,t,r){return t=Tk(t),NQe(e,Bue()?Reflect.construct(t,r||[],Tk(e).constructor):t.apply(e,r))}function NQe(e,t){if(t&&(qb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return IQe(e)}function IQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Bue=function(){return!!e})()}function Tk(e){return Tk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Tk(e)}function RQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a4(e,t)}function a4(e,t){return a4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},a4(e,t)}function FI(e,t,r){return t=$ue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $ue(e){var t=MQe(e,"string");return qb(t)=="symbol"?t:t+""}function MQe(e,t){if(qb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(qb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var DQe=function(t,r,n,s,o){var d=o.x1,i=o.x2,m=o.y1,y=o.y2,S=o.xAxis,w=o.yAxis;if(!S||!w)return null;var T=eU({x:S.scale,y:w.scale}),A={x:t?T.x.apply(d,{position:"start"}):T.x.rangeMin,y:n?T.y.apply(m,{position:"start"}):T.y.rangeMin},O={x:r?T.x.apply(i,{position:"end"}):T.x.rangeMax,y:s?T.y.apply(y,{position:"end"}):T.y.rangeMax};return Uh(o,"discard")&&(!T.isInRange(A)||!T.isInRange(O))?null:Cue(A,O)},zI=function(e){function t(){return jQe(this,t),kQe(this,t,arguments)}return RQe(t,e),OQe(t,[{key:"render",value:function(){var n=this.props,s=n.x1,o=n.x2,d=n.y1,i=n.y2,m=n.className,y=n.alwaysShow,S=n.clipPathId;Vd(y===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var w=el(s),T=el(o),A=el(d),O=el(i),P=this.props.shape;if(!w&&!T&&!A&&!O&&!P)return null;var N=DQe(w,T,A,O,this.props);if(!N&&!P)return null;var R=Uh(this.props,"hidden")?"url(#".concat(S,")"):void 0;return Ve.createElement(Cs,{className:Ni("recharts-reference-area",m)},t.renderRect(P,YZ(YZ({clipPath:R},Jn(this.props,!0)),N)),dl.renderCallByParent(this.props,N))}}])}(Ve.Component);FI(zI,"displayName","ReferenceArea");FI(zI,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});FI(zI,"renderRect",function(e,t){var r;return Ve.isValidElement(e)?r=Ve.cloneElement(e,t):vi(e)?r=e(t):r=Ve.createElement(Q$,s4({},t,{className:"recharts-reference-area-rect"})),r});function Uue(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],s=0;s<e.length;s+=t)n.push(e[s]);return n}function LQe(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return kJe(n,r)}function FQe(e,t,r){var n=r==="width",s=e.x,o=e.y,d=e.width,i=e.height;return t===1?{start:n?s:o,end:n?s+d:o+i}:{start:n?s+d:o+i,end:n?s:o}}function Ak(e,t,r,n,s){if(e*t<e*n||e*t>e*s)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-s)<=0}function zQe(e,t){return Uue(e,t+1)}function BQe(e,t,r,n,s){for(var o=(n||[]).slice(),d=t.start,i=t.end,m=0,y=1,S=d,w=function(){var O=n==null?void 0:n[m];if(O===void 0)return{v:Uue(n,y)};var P=m,N,R=function(){return N===void 0&&(N=r(O,P)),N},M=O.coordinate,F=m===0||Ak(e,M,R,S,i);F||(m=0,S=d,y+=1),F&&(S=M+e*(R()/2+s),m+=y)},T;y<=o.length;)if(T=w(),T)return T.v;return[]}function s2(e){"@babel/helpers - typeof";return s2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s2(e)}function JZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function zl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?JZ(Object(r),!0).forEach(function(n){$Qe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):JZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $Qe(e,t,r){return t=UQe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UQe(e){var t=VQe(e,"string");return s2(t)=="symbol"?t:t+""}function VQe(e,t){if(s2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(s2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qQe(e,t,r,n,s){for(var o=(n||[]).slice(),d=o.length,i=t.start,m=t.end,y=function(T){var A=o[T],O,P=function(){return O===void 0&&(O=r(A,T)),O};if(T===d-1){var N=e*(A.coordinate+e*P()/2-m);o[T]=A=zl(zl({},A),{},{tickCoord:N>0?A.coordinate-N*e:A.coordinate})}else o[T]=A=zl(zl({},A),{},{tickCoord:A.coordinate});var R=Ak(e,A.tickCoord,P,i,m);R&&(m=A.tickCoord-e*(P()/2+s),o[T]=zl(zl({},A),{},{isShow:!0}))},S=d-1;S>=0;S--)y(S);return o}function HQe(e,t,r,n,s,o){var d=(n||[]).slice(),i=d.length,m=t.start,y=t.end;if(o){var S=n[i-1],w=r(S,i-1),T=e*(S.coordinate+e*w/2-y);d[i-1]=S=zl(zl({},S),{},{tickCoord:T>0?S.coordinate-T*e:S.coordinate});var A=Ak(e,S.tickCoord,function(){return w},m,y);A&&(y=S.tickCoord-e*(w/2+s),d[i-1]=zl(zl({},S),{},{isShow:!0}))}for(var O=o?i-1:i,P=function(M){var F=d[M],B,$=function(){return B===void 0&&(B=r(F,M)),B};if(M===0){var W=e*(F.coordinate-e*$()/2-m);d[M]=F=zl(zl({},F),{},{tickCoord:W<0?F.coordinate-W*e:F.coordinate})}else d[M]=F=zl(zl({},F),{},{tickCoord:F.coordinate});var K=Ak(e,F.tickCoord,$,m,y);K&&(m=F.tickCoord+e*($()/2+s),d[M]=zl(zl({},F),{},{isShow:!0}))},N=0;N<O;N++)P(N);return d}function oU(e,t,r){var n=e.tick,s=e.ticks,o=e.viewBox,d=e.minTickGap,i=e.orientation,m=e.interval,y=e.tickFormatter,S=e.unit,w=e.angle;if(!s||!s.length||!n)return[];if(Gr(m)||Bh.isSsr)return zQe(s,typeof m=="number"&&Gr(m)?m:0);var T=[],A=i==="top"||i==="bottom"?"width":"height",O=S&&A==="width"?DE(S,{fontSize:t,letterSpacing:r}):{width:0,height:0},P=function(F,B){var $=vi(y)?y(F.value,B):F.value;return A==="width"?LQe(DE($,{fontSize:t,letterSpacing:r}),O,w):DE($,{fontSize:t,letterSpacing:r})[A]},N=s.length>=2?hc(s[1].coordinate-s[0].coordinate):1,R=FQe(o,N,A);return m==="equidistantPreserveStart"?BQe(N,R,P,s,d):(m==="preserveStart"||m==="preserveStartEnd"?T=HQe(N,R,P,s,d,m==="preserveStartEnd"):T=qQe(N,R,P,s,d),T.filter(function(M){return M.isShow}))}var GQe=["viewBox"],WQe=["viewBox"],KQe=["ticks"];function Hb(e){"@babel/helpers - typeof";return Hb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hb(e)}function b0(){return b0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},b0.apply(this,arguments)}function QZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ho(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QZ(Object(r),!0).forEach(function(n){lU(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TL(e,t){if(e==null)return{};var r=ZQe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ZQe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function XQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,que(n.key),n)}}function YQe(e,t,r){return t&&eX(e.prototype,t),r&&eX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function JQe(e,t,r){return t=Ck(t),QQe(e,Vue()?Reflect.construct(t,r||[],Ck(e).constructor):t.apply(e,r))}function QQe(e,t){if(t&&(Hb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eet(e)}function eet(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Vue=function(){return!!e})()}function Ck(e){return Ck=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ck(e)}function tet(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o4(e,t)}function o4(e,t){return o4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},o4(e,t)}function lU(e,t,r){return t=que(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function que(e){var t=ret(e,"string");return Hb(t)=="symbol"?t:t+""}function ret(e,t){if(Hb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Hb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Tw=function(e){function t(r){var n;return XQe(this,t),n=JQe(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return tet(t,e),YQe(t,[{key:"shouldComponentUpdate",value:function(n,s){var o=n.viewBox,d=TL(n,GQe),i=this.props,m=i.viewBox,y=TL(i,WQe);return!F0(o,m)||!F0(d,y)||!F0(s,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var s=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];s&&this.setState({fontSize:window.getComputedStyle(s).fontSize,letterSpacing:window.getComputedStyle(s).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.x,d=s.y,i=s.width,m=s.height,y=s.orientation,S=s.tickSize,w=s.mirror,T=s.tickMargin,A,O,P,N,R,M,F=w?-1:1,B=n.tickSize||S,$=Gr(n.tickCoord)?n.tickCoord:n.coordinate;switch(y){case"top":A=O=n.coordinate,N=d+ +!w*m,P=N-F*B,M=P-F*T,R=$;break;case"left":P=N=n.coordinate,O=o+ +!w*i,A=O-F*B,R=A-F*T,M=$;break;case"right":P=N=n.coordinate,O=o+ +w*i,A=O+F*B,R=A+F*T,M=$;break;default:A=O=n.coordinate,N=d+ +w*m,P=N+F*B,M=P+F*T,R=$;break}return{line:{x1:A,y1:P,x2:O,y2:N},tick:{x:R,y:M}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,d;switch(s){case"left":d=o?"start":"end";break;case"right":d=o?"end":"start";break;default:d="middle";break}return d}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,d="end";switch(s){case"left":case"right":d="middle";break;case"top":d=o?"start":"end";break;default:d=o?"end":"start";break}return d}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.x,o=n.y,d=n.width,i=n.height,m=n.orientation,y=n.mirror,S=n.axisLine,w=Ho(Ho(Ho({},Jn(this.props,!1)),Jn(S,!1)),{},{fill:"none"});if(m==="top"||m==="bottom"){var T=+(m==="top"&&!y||m==="bottom"&&y);w=Ho(Ho({},w),{},{x1:s,y1:o+T*i,x2:s+d,y2:o+T*i})}else{var A=+(m==="left"&&!y||m==="right"&&y);w=Ho(Ho({},w),{},{x1:s+A*d,y1:o,x2:s+A*d,y2:o+i})}return Ve.createElement("line",b0({},w,{className:Ni("recharts-cartesian-axis-line",_u(S,"className"))}))}},{key:"renderTicks",value:function(n,s,o){var d=this,i=this.props,m=i.tickLine,y=i.stroke,S=i.tick,w=i.tickFormatter,T=i.unit,A=oU(Ho(Ho({},this.props),{},{ticks:n}),s,o),O=this.getTickTextAnchor(),P=this.getTickVerticalAnchor(),N=Jn(this.props,!1),R=Jn(S,!1),M=Ho(Ho({},N),{},{fill:"none"},Jn(m,!1)),F=A.map(function(B,$){var W=d.getTickLineCoord(B),K=W.line,te=W.tick,ne=Ho(Ho(Ho(Ho({textAnchor:O,verticalAnchor:P},N),{},{stroke:"none",fill:y},R),te),{},{index:$,payload:B,visibleTicksCount:A.length,tickFormatter:w});return Ve.createElement(Cs,b0({className:"recharts-cartesian-axis-tick",key:"tick-".concat(B.value,"-").concat(B.coordinate,"-").concat(B.tickCoord)},Bv(d.props,B,$)),m&&Ve.createElement("line",b0({},M,K,{className:Ni("recharts-cartesian-axis-tick-line",_u(m,"className"))})),S&&t.renderTickItem(S,ne,"".concat(vi(w)?w(B.value,$):B.value).concat(T||"")))});return Ve.createElement("g",{className:"recharts-cartesian-axis-ticks"},F)}},{key:"render",value:function(){var n=this,s=this.props,o=s.axisLine,d=s.width,i=s.height,m=s.ticksGenerator,y=s.className,S=s.hide;if(S)return null;var w=this.props,T=w.ticks,A=TL(w,KQe),O=T;return vi(m)&&(O=T&&T.length>0?m(this.props):m(A)),d<=0||i<=0||!O||!O.length?null:Ve.createElement(Cs,{className:Ni("recharts-cartesian-axis",y),ref:function(N){n.layerReference=N}},o&&this.renderAxisLine(),this.renderTicks(O,this.state.fontSize,this.state.letterSpacing),dl.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,s,o){var d,i=Ni(s.className,"recharts-cartesian-axis-tick-value");return Ve.isValidElement(n)?d=Ve.cloneElement(n,Ho(Ho({},s),{},{className:i})):vi(n)?d=n(Ho(Ho({},s),{},{className:i})):d=Ve.createElement($v,b0({},s,{className:"recharts-cartesian-axis-tick-value"}),o),d}}])}(V.Component);lU(Tw,"displayName","CartesianAxis");lU(Tw,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var net=["x1","y1","x2","y2","key"],iet=["offset"];function qv(e){"@babel/helpers - typeof";return qv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qv(e)}function tX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function $l(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tX(Object(r),!0).forEach(function(n){set(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function set(e,t,r){return t=aet(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aet(e){var t=oet(e,"string");return qv(t)=="symbol"?t:t+""}function oet(e,t){if(qv(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(qv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function iv(){return iv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iv.apply(this,arguments)}function rX(e,t){if(e==null)return{};var r=cet(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function cet(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var uet=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,s=t.x,o=t.y,d=t.width,i=t.height,m=t.ry;return Ve.createElement("rect",{x:s,y:o,ry:m,width:d,height:i,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function Hue(e,t){var r;if(Ve.isValidElement(e))r=Ve.cloneElement(e,t);else if(vi(e))r=e(t);else{var n=t.x1,s=t.y1,o=t.x2,d=t.y2,i=t.key,m=rX(t,net),y=Jn(m,!1);y.offset;var S=rX(y,iet);r=Ve.createElement("line",iv({},S,{x1:n,y1:s,x2:o,y2:d,fill:"none",key:i}))}return r}function det(e){var t=e.x,r=e.width,n=e.horizontal,s=n===void 0?!0:n,o=e.horizontalPoints;if(!s||!o||!o.length)return null;var d=o.map(function(i,m){var y=$l($l({},e),{},{x1:t,y1:i,x2:t+r,y2:i,key:"line-".concat(m),index:m});return Hue(s,y)});return Ve.createElement("g",{className:"recharts-cartesian-grid-horizontal"},d)}function het(e){var t=e.y,r=e.height,n=e.vertical,s=n===void 0?!0:n,o=e.verticalPoints;if(!s||!o||!o.length)return null;var d=o.map(function(i,m){var y=$l($l({},e),{},{x1:i,y1:t,x2:i,y2:t+r,key:"line-".concat(m),index:m});return Hue(s,y)});return Ve.createElement("g",{className:"recharts-cartesian-grid-vertical"},d)}function fet(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,s=e.y,o=e.width,d=e.height,i=e.horizontalPoints,m=e.horizontal,y=m===void 0?!0:m;if(!y||!t||!t.length)return null;var S=i.map(function(T){return Math.round(T+s-s)}).sort(function(T,A){return T-A});s!==S[0]&&S.unshift(0);var w=S.map(function(T,A){var O=!S[A+1],P=O?s+d-T:S[A+1]-T;if(P<=0)return null;var N=A%t.length;return Ve.createElement("rect",{key:"react-".concat(A),y:T,x:n,height:P,width:o,stroke:"none",fill:t[N],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ve.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},w)}function pet(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,s=e.fillOpacity,o=e.x,d=e.y,i=e.width,m=e.height,y=e.verticalPoints;if(!r||!n||!n.length)return null;var S=y.map(function(T){return Math.round(T+o-o)}).sort(function(T,A){return T-A});o!==S[0]&&S.unshift(0);var w=S.map(function(T,A){var O=!S[A+1],P=O?o+i-T:S[A+1]-T;if(P<=0)return null;var N=A%n.length;return Ve.createElement("rect",{key:"react-".concat(A),x:T,y:d,width:P,height:m,stroke:"none",fill:n[N],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return Ve.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},w)}var met=function(t,r){var n=t.xAxis,s=t.width,o=t.height,d=t.offset;return $ce(oU($l($l($l({},Tw.defaultProps),n),{},{ticks:Kf(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),d.left,d.left+d.width,r)},get=function(t,r){var n=t.yAxis,s=t.width,o=t.height,d=t.offset;return $ce(oU($l($l($l({},Tw.defaultProps),n),{},{ticks:Kf(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),d.top,d.top+d.height,r)},Kx={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function sv(e){var t,r,n,s,o,d,i=nU(),m=iU(),y=rQe(),S=$l($l({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Kx.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:Kx.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:Kx.horizontal,horizontalFill:(s=e.horizontalFill)!==null&&s!==void 0?s:Kx.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:Kx.vertical,verticalFill:(d=e.verticalFill)!==null&&d!==void 0?d:Kx.verticalFill,x:Gr(e.x)?e.x:y.left,y:Gr(e.y)?e.y:y.top,width:Gr(e.width)?e.width:y.width,height:Gr(e.height)?e.height:y.height}),w=S.x,T=S.y,A=S.width,O=S.height,P=S.syncWithTicks,N=S.horizontalValues,R=S.verticalValues,M=QJe(),F=eQe();if(!Gr(A)||A<=0||!Gr(O)||O<=0||!Gr(w)||w!==+w||!Gr(T)||T!==+T)return null;var B=S.verticalCoordinatesGenerator||met,$=S.horizontalCoordinatesGenerator||get,W=S.horizontalPoints,K=S.verticalPoints;if((!W||!W.length)&&vi($)){var te=N&&N.length,ne=$({yAxis:F?$l($l({},F),{},{ticks:te?N:F.ticks}):void 0,width:i,height:m,offset:y},te?!0:P);Vd(Array.isArray(ne),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(qv(ne),"]")),Array.isArray(ne)&&(W=ne)}if((!K||!K.length)&&vi(B)){var ae=R&&R.length,re=B({xAxis:M?$l($l({},M),{},{ticks:ae?R:M.ticks}):void 0,width:i,height:m,offset:y},ae?!0:P);Vd(Array.isArray(re),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(qv(re),"]")),Array.isArray(re)&&(K=re)}return Ve.createElement("g",{className:"recharts-cartesian-grid"},Ve.createElement(uet,{fill:S.fill,fillOpacity:S.fillOpacity,x:S.x,y:S.y,width:S.width,height:S.height,ry:S.ry}),Ve.createElement(det,iv({},S,{offset:y,horizontalPoints:W,xAxis:M,yAxis:F})),Ve.createElement(het,iv({},S,{offset:y,verticalPoints:K,xAxis:M,yAxis:F})),Ve.createElement(fet,iv({},S,{horizontalPoints:W})),Ve.createElement(pet,iv({},S,{verticalPoints:K})))}sv.displayName="CartesianGrid";var yet=["type","layout","connectNulls","ref"],vet=["key"];function Gb(e){"@babel/helpers - typeof";return Gb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gb(e)}function nX(e,t){if(e==null)return{};var r=_et(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _et(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function UE(){return UE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},UE.apply(this,arguments)}function iX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function su(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iX(Object(r),!0).forEach(function(n){Rd(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Zx(e){return Eet(e)||wet(e)||bet(e)||xet()}function xet(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bet(e,t){if(e){if(typeof e=="string")return l4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l4(e,t)}}function wet(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Eet(e){if(Array.isArray(e))return l4(e)}function l4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Tet(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wue(n.key),n)}}function Aet(e,t,r){return t&&sX(e.prototype,t),r&&sX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cet(e,t,r){return t=jk(t),jet(e,Gue()?Reflect.construct(t,r||[],jk(e).constructor):t.apply(e,r))}function jet(e,t){if(t&&(Gb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pet(e)}function Pet(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Gue=function(){return!!e})()}function jk(e){return jk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jk(e)}function Oet(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c4(e,t)}function c4(e,t){return c4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},c4(e,t)}function Rd(e,t,r){return t=Wue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wue(e){var t=ket(e,"string");return Gb(t)=="symbol"?t:t+""}function ket(e,t){if(Gb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Gb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Aw=function(e){function t(){var r;Tet(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=Cet(this,t,[].concat(s)),Rd(r,"state",{isAnimationFinished:!0,totalLength:0}),Rd(r,"generateSimpleStrokeDasharray",function(d,i){return"".concat(i,"px ").concat(d-i,"px")}),Rd(r,"getStrokeDasharray",function(d,i,m){var y=m.reduce(function(R,M){return R+M});if(!y)return r.generateSimpleStrokeDasharray(i,d);for(var S=Math.floor(d/y),w=d%y,T=i-d,A=[],O=0,P=0;O<m.length;P+=m[O],++O)if(P+m[O]>w){A=[].concat(Zx(m.slice(0,O)),[w-P]);break}var N=A.length%2===0?[0,T]:[T];return[].concat(Zx(t.repeat(m,S)),Zx(A),N).map(function(R){return"".concat(R,"px")}).join(", ")}),Rd(r,"id",vw("recharts-line-")),Rd(r,"pathRef",function(d){r.mainCurve=d}),Rd(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Rd(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Oet(t,e),Aet(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,d=o.points,i=o.xAxis,m=o.yAxis,y=o.layout,S=o.children,w=xu(S,Z2);if(!w)return null;var T=function(P,N){return{x:P.x,y:P.y,value:P.value,errorVal:Jo(P.payload,N)}},A={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ve.createElement(Cs,A,w.map(function(O){return Ve.cloneElement(O,{key:"bar-".concat(O.props.dataKey),data:d,xAxis:i,yAxis:m,layout:y,dataPointFormatter:T})}))}},{key:"renderDots",value:function(n,s,o){var d=this.props.isAnimationActive;if(d&&!this.state.isAnimationFinished)return null;var i=this.props,m=i.dot,y=i.points,S=i.dataKey,w=Jn(this.props,!1),T=Jn(m,!0),A=y.map(function(P,N){var R=su(su(su({key:"dot-".concat(N),r:3},w),T),{},{index:N,cx:P.x,cy:P.y,value:P.value,dataKey:S,payload:P.payload,points:y});return t.renderDotItem(m,R)}),O={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ve.createElement(Cs,UE({className:"recharts-line-dots",key:"dots"},O),A)}},{key:"renderCurveStatically",value:function(n,s,o,d){var i=this.props,m=i.type,y=i.layout,S=i.connectNulls;i.ref;var w=nX(i,yet),T=su(su(su({},Jn(w,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(o,")"):null,points:n},d),{},{type:m,layout:y,connectNulls:S});return Ve.createElement(lk,UE({},T,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,s){var o=this,d=this.props,i=d.points,m=d.strokeDasharray,y=d.isAnimationActive,S=d.animationBegin,w=d.animationDuration,T=d.animationEasing,A=d.animationId,O=d.animateNewValues,P=d.width,N=d.height,R=this.state,M=R.prevPoints,F=R.totalLength;return Ve.createElement(Zh,{begin:S,duration:w,isActive:y,easing:T,from:{t:0},to:{t:1},key:"line-".concat(A),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(B){var $=B.t;if(M){var W=M.length/i.length,K=i.map(function(ee,ie){var de=Math.floor(ie*W);if(M[de]){var be=M[de],Se=du(be.x,ee.x),Ae=du(be.y,ee.y);return su(su({},ee),{},{x:Se($),y:Ae($)})}if(O){var xe=du(P*2,ee.x),me=du(N/2,ee.y);return su(su({},ee),{},{x:xe($),y:me($)})}return su(su({},ee),{},{x:ee.x,y:ee.y})});return o.renderCurveStatically(K,n,s)}var te=du(0,F),ne=te($),ae;if(m){var re="".concat(m).split(/[,\s]+/gim).map(function(ee){return parseFloat(ee)});ae=o.getStrokeDasharray(ne,F,re)}else ae=o.generateSimpleStrokeDasharray(F,ne);return o.renderCurveStatically(i,n,s,{strokeDasharray:ae})})}},{key:"renderCurve",value:function(n,s){var o=this.props,d=o.points,i=o.isAnimationActive,m=this.state,y=m.prevPoints,S=m.totalLength;return i&&d&&d.length&&(!y&&S>0||!K2(y,d))?this.renderCurveWithAnimation(n,s):this.renderCurveStatically(d,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,d=s.dot,i=s.points,m=s.className,y=s.xAxis,S=s.yAxis,w=s.top,T=s.left,A=s.width,O=s.height,P=s.isAnimationActive,N=s.id;if(o||!i||!i.length)return null;var R=this.state.isAnimationFinished,M=i.length===1,F=Ni("recharts-line",m),B=y&&y.allowDataOverflow,$=S&&S.allowDataOverflow,W=B||$,K=Oi(N)?this.id:N,te=(n=Jn(d,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},ne=te.r,ae=ne===void 0?3:ne,re=te.strokeWidth,ee=re===void 0?2:re,ie=QLe(d)?d:{},de=ie.clipDot,be=de===void 0?!0:de,Se=ae*2+ee;return Ve.createElement(Cs,{className:F},B||$?Ve.createElement("defs",null,Ve.createElement("clipPath",{id:"clipPath-".concat(K)},Ve.createElement("rect",{x:B?T:T-A/2,y:$?w:w-O/2,width:B?A:A*2,height:$?O:O*2})),!be&&Ve.createElement("clipPath",{id:"clipPath-dots-".concat(K)},Ve.createElement("rect",{x:T-Se/2,y:w-Se/2,width:A+Se,height:O+Se}))):null,!M&&this.renderCurve(W,K),this.renderErrorBar(W,K),(M||d)&&this.renderDots(W,be,K),(!P||R)&&Qf.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:s.curPoints}:n.points!==s.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,s){for(var o=n.length%2!==0?[].concat(Zx(n),[0]):n,d=[],i=0;i<s;++i)d=[].concat(Zx(d),Zx(o));return d}},{key:"renderDotItem",value:function(n,s){var o;if(Ve.isValidElement(n))o=Ve.cloneElement(n,s);else if(vi(n))o=n(s);else{var d=s.key,i=nX(s,vet),m=Ni("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ve.createElement(jI,UE({key:d},i,{className:m}))}return o}}])}(V.PureComponent);Rd(Aw,"displayName","Line");Rd(Aw,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Bh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Rd(Aw,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,s=e.xAxisTicks,o=e.yAxisTicks,d=e.dataKey,i=e.bandSize,m=e.displayedData,y=e.offset,S=t.layout,w=m.map(function(T,A){var O=Jo(T,d);return S==="horizontal"?{x:PK({axis:r,ticks:s,bandSize:i,entry:T,index:A}),y:Oi(O)?null:n.scale(O),value:O,payload:T}:{x:Oi(O)?null:r.scale(O),y:PK({axis:n,ticks:o,bandSize:i,entry:T,index:A}),value:O,payload:T}});return su({points:w,layout:S},y)});function Wb(e){"@babel/helpers - typeof";return Wb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wb(e)}function Net(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Iet(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xue(n.key),n)}}function Ret(e,t,r){return t&&Iet(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Met(e,t,r){return t=Pk(t),Det(e,Kue()?Reflect.construct(t,r||[],Pk(e).constructor):t.apply(e,r))}function Det(e,t){if(t&&(Wb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Let(e)}function Let(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Kue=function(){return!!e})()}function Pk(e){return Pk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Pk(e)}function Fet(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u4(e,t)}function u4(e,t){return u4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},u4(e,t)}function Zue(e,t,r){return t=Xue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xue(e){var t=zet(e,"string");return Wb(t)=="symbol"?t:t+""}function zet(e,t){if(Wb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Wb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function d4(){return d4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d4.apply(this,arguments)}function Bet(e){var t=e.xAxisId,r=nU(),n=iU(),s=Rue(t);return s==null?null:V.createElement(Tw,d4({},s,{className:Ni("recharts-".concat(s.axisType," ").concat(s.axisType),s.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(d){return Kf(d,!0)}}))}var Ih=function(e){function t(){return Net(this,t),Met(this,t,arguments)}return Fet(t,e),Ret(t,[{key:"render",value:function(){return V.createElement(Bet,this.props)}}])}(V.Component);Zue(Ih,"displayName","XAxis");Zue(Ih,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Kb(e){"@babel/helpers - typeof";return Kb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kb(e)}function $et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Uet(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Que(n.key),n)}}function Vet(e,t,r){return t&&Uet(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function qet(e,t,r){return t=Ok(t),Het(e,Yue()?Reflect.construct(t,r||[],Ok(e).constructor):t.apply(e,r))}function Het(e,t){if(t&&(Kb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Get(e)}function Get(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yue=function(){return!!e})()}function Ok(e){return Ok=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ok(e)}function Wet(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h4(e,t)}function h4(e,t){return h4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},h4(e,t)}function Jue(e,t,r){return t=Que(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Que(e){var t=Ket(e,"string");return Kb(t)=="symbol"?t:t+""}function Ket(e,t){if(Kb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Kb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function f4(){return f4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f4.apply(this,arguments)}var Zet=function(t){var r=t.yAxisId,n=nU(),s=iU(),o=Mue(r);return o==null?null:V.createElement(Tw,f4({},o,{className:Ni("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:s},ticksGenerator:function(i){return Kf(i,!0)}}))},Rh=function(e){function t(){return $et(this,t),qet(this,t,arguments)}return Wet(t,e),Vet(t,[{key:"render",value:function(){return V.createElement(Zet,this.props)}}])}(V.Component);Jue(Rh,"displayName","YAxis");Jue(Rh,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function aX(e){return Qet(e)||Jet(e)||Yet(e)||Xet()}function Xet(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yet(e,t){if(e){if(typeof e=="string")return p4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p4(e,t)}}function Jet(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Qet(e){if(Array.isArray(e))return p4(e)}function p4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m4=function(t,r,n,s,o){var d=xu(t,aU),i=xu(t,LI),m=[].concat(aX(d),aX(i)),y=xu(t,zI),S="".concat(s,"Id"),w=s[0],T=r;if(m.length&&(T=m.reduce(function(P,N){if(N.props[S]===n&&Uh(N.props,"extendDomain")&&Gr(N.props[w])){var R=N.props[w];return[Math.min(P[0],R),Math.max(P[1],R)]}return P},T)),y.length){var A="".concat(w,"1"),O="".concat(w,"2");T=y.reduce(function(P,N){if(N.props[S]===n&&Uh(N.props,"extendDomain")&&Gr(N.props[A])&&Gr(N.props[O])){var R=N.props[A],M=N.props[O];return[Math.min(P[0],R,M),Math.max(P[1],R,M)]}return P},T)}return o&&o.length&&(T=o.reduce(function(P,N){return Gr(N)?[Math.min(P[0],N),Math.max(P[1],N)]:P},T)),T},ede={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function s(m,y,S){this.fn=m,this.context=y,this.once=S||!1}function o(m,y,S,w,T){if(typeof S!="function")throw new TypeError("The listener must be a function");var A=new s(S,w||m,T),O=r?r+y:y;return m._events[O]?m._events[O].fn?m._events[O]=[m._events[O],A]:m._events[O].push(A):(m._events[O]=A,m._eventsCount++),m}function d(m,y){--m._eventsCount===0?m._events=new n:delete m._events[y]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var y=[],S,w;if(this._eventsCount===0)return y;for(w in S=this._events)t.call(S,w)&&y.push(r?w.slice(1):w);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(S)):y},i.prototype.listeners=function(y){var S=r?r+y:y,w=this._events[S];if(!w)return[];if(w.fn)return[w.fn];for(var T=0,A=w.length,O=new Array(A);T<A;T++)O[T]=w[T].fn;return O},i.prototype.listenerCount=function(y){var S=r?r+y:y,w=this._events[S];return w?w.fn?1:w.length:0},i.prototype.emit=function(y,S,w,T,A,O){var P=r?r+y:y;if(!this._events[P])return!1;var N=this._events[P],R=arguments.length,M,F;if(N.fn){switch(N.once&&this.removeListener(y,N.fn,void 0,!0),R){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,S),!0;case 3:return N.fn.call(N.context,S,w),!0;case 4:return N.fn.call(N.context,S,w,T),!0;case 5:return N.fn.call(N.context,S,w,T,A),!0;case 6:return N.fn.call(N.context,S,w,T,A,O),!0}for(F=1,M=new Array(R-1);F<R;F++)M[F-1]=arguments[F];N.fn.apply(N.context,M)}else{var B=N.length,$;for(F=0;F<B;F++)switch(N[F].once&&this.removeListener(y,N[F].fn,void 0,!0),R){case 1:N[F].fn.call(N[F].context);break;case 2:N[F].fn.call(N[F].context,S);break;case 3:N[F].fn.call(N[F].context,S,w);break;case 4:N[F].fn.call(N[F].context,S,w,T);break;default:if(!M)for($=1,M=new Array(R-1);$<R;$++)M[$-1]=arguments[$];N[F].fn.apply(N[F].context,M)}}return!0},i.prototype.on=function(y,S,w){return o(this,y,S,w,!1)},i.prototype.once=function(y,S,w){return o(this,y,S,w,!0)},i.prototype.removeListener=function(y,S,w,T){var A=r?r+y:y;if(!this._events[A])return this;if(!S)return d(this,A),this;var O=this._events[A];if(O.fn)O.fn===S&&(!T||O.once)&&(!w||O.context===w)&&d(this,A);else{for(var P=0,N=[],R=O.length;P<R;P++)(O[P].fn!==S||T&&!O[P].once||w&&O[P].context!==w)&&N.push(O[P]);N.length?this._events[A]=N.length===1?N[0]:N:d(this,A)}return this},i.prototype.removeAllListeners=function(y){var S;return y?(S=r?r+y:y,this._events[S]&&d(this,S)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i})(ede);var ett=ede.exports;const ttt=Ps(ett);var AL=new ttt,CL="recharts.syncMouseEvents";function a2(e){"@babel/helpers - typeof";return a2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a2(e)}function rtt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ntt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,tde(n.key),n)}}function itt(e,t,r){return t&&ntt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function jL(e,t,r){return t=tde(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tde(e){var t=stt(e,"string");return a2(t)=="symbol"?t:t+""}function stt(e,t){if(a2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(a2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var att=function(){function e(){rtt(this,e),jL(this,"activeIndex",0),jL(this,"coordinateList",[]),jL(this,"layout","horizontal")}return itt(e,[{key:"setDetails",value:function(r){var n,s=r.coordinateList,o=s===void 0?null:s,d=r.container,i=d===void 0?null:d,m=r.layout,y=m===void 0?null:m,S=r.offset,w=S===void 0?null:S,T=r.mouseHandlerCallback,A=T===void 0?null:T;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=i??this.container,this.layout=y??this.layout,this.offset=w??this.offset,this.mouseHandlerCallback=A??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var s=this.container.getBoundingClientRect(),o=s.x,d=s.y,i=s.height,m=this.coordinateList[this.activeIndex].coordinate,y=((r=window)===null||r===void 0?void 0:r.scrollX)||0,S=((n=window)===null||n===void 0?void 0:n.scrollY)||0,w=o+m+y,T=d+this.offset.top+i/2+S;this.mouseHandlerCallback({pageX:w,pageY:T})}}}])}();function ott(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],s=e==null?void 0:e[1];if(n&&s&&Gr(n)&&Gr(s))return!0}return!1}function ltt(e,t,r,n){var s=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-s:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-s,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function rde(e){var t=e.cx,r=e.cy,n=e.radius,s=e.startAngle,o=e.endAngle,d=sa(t,r,n,s),i=sa(t,r,n,o);return{points:[d,i],cx:t,cy:r,radius:n,startAngle:s,endAngle:o}}function ctt(e,t,r){var n,s,o,d;if(e==="horizontal")n=t.x,o=n,s=r.top,d=r.top+r.height;else if(e==="vertical")s=t.y,d=s,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,m=t.cy,y=t.innerRadius,S=t.outerRadius,w=t.angle,T=sa(i,m,y,w),A=sa(i,m,S,w);n=T.x,s=T.y,o=A.x,d=A.y}else return rde(t);return[{x:n,y:s},{x:o,y:d}]}function o2(e){"@babel/helpers - typeof";return o2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o2(e)}function oX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function zj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oX(Object(r),!0).forEach(function(n){utt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function utt(e,t,r){return t=dtt(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dtt(e){var t=htt(e,"string");return o2(t)=="symbol"?t:t+""}function htt(e,t){if(o2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(o2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ftt(e){var t,r,n=e.element,s=e.tooltipEventType,o=e.isActive,d=e.activeCoordinate,i=e.activePayload,m=e.offset,y=e.activeTooltipIndex,S=e.tooltipAxisBandSize,w=e.layout,T=e.chartName,A=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!A||!o||!d||T!=="ScatterChart"&&s!=="axis")return null;var O,P=lk;if(T==="ScatterChart")O=d,P=PZe;else if(T==="BarChart")O=ltt(w,d,m,S),P=Q$;else if(w==="radial"){var N=rde(d),R=N.cx,M=N.cy,F=N.radius,B=N.startAngle,$=N.endAngle;O={cx:R,cy:M,startAngle:B,endAngle:$,innerRadius:F,outerRadius:F},P=Jce}else O={points:ctt(w,d,m)},P=lk;var W=zj(zj(zj(zj({stroke:"#ccc",pointerEvents:"none"},m),O),Jn(A,!1)),{},{payload:i,payloadIndex:y,className:Ni("recharts-tooltip-cursor",A.className)});return V.isValidElement(A)?V.cloneElement(A,W):V.createElement(P,W)}var ptt=["item"],mtt=["children","className","width","height","style","compact","title","desc"];function Zb(e){"@babel/helpers - typeof";return Zb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zb(e)}function w0(){return w0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},w0.apply(this,arguments)}function lX(e,t){return vtt(e)||ytt(e,t)||ide(e,t)||gtt()}function gtt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ytt(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,d,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(y)throw s}}return i}}function vtt(e){if(Array.isArray(e))return e}function cX(e,t){if(e==null)return{};var r=_tt(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _tt(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function xtt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function btt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sde(n.key),n)}}function wtt(e,t,r){return t&&btt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Stt(e,t,r){return t=kk(t),Ett(e,nde()?Reflect.construct(t,r||[],kk(e).constructor):t.apply(e,r))}function Ett(e,t){if(t&&(Zb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ttt(e)}function Ttt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nde(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nde=function(){return!!e})()}function kk(e){return kk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},kk(e)}function Att(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g4(e,t)}function g4(e,t){return g4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},g4(e,t)}function Xb(e){return Ptt(e)||jtt(e)||ide(e)||Ctt()}function Ctt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ide(e,t){if(e){if(typeof e=="string")return y4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y4(e,t)}}function jtt(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ptt(e){if(Array.isArray(e))return y4(e)}function y4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function uX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function vr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uX(Object(r),!0).forEach(function(n){oi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oi(e,t,r){return t=sde(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sde(e){var t=Ott(e,"string");return Zb(t)=="symbol"?t:t+""}function Ott(e,t){if(Zb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Zb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ktt={xAxis:["bottom","top"],yAxis:["left","right"]},Ntt={width:"100%",height:"100%"},ade={x:0,y:0};function Bj(e){return e}var Itt=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},Rtt=function(t,r,n,s){var o=r.find(function(S){return S&&S.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:s.y};if(t==="vertical")return{x:s.x,y:o.coordinate};if(t==="centric"){var d=o.coordinate,i=s.radius;return vr(vr(vr({},s),sa(s.cx,s.cy,i,d)),{},{angle:d,radius:i})}var m=o.coordinate,y=s.angle;return vr(vr(vr({},s),sa(s.cx,s.cy,m,y)),{},{angle:y,radius:m})}return ade},BI=function(t,r){var n=r.graphicalItems,s=r.dataStartIndex,o=r.dataEndIndex,d=(n??[]).reduce(function(i,m){var y=m.props.data;return y&&y.length?[].concat(Xb(i),Xb(y)):i},[]);return d.length>0?d:t&&t.length&&Gr(s)&&Gr(o)?t.slice(s,o+1):[]};function ode(e){return e==="number"?[0,"auto"]:void 0}var v4=function(t,r,n,s){var o=t.graphicalItems,d=t.tooltipAxis,i=BI(r,t);return n<0||!o||!o.length||n>=i.length?null:o.reduce(function(m,y){var S,w=(S=y.props.data)!==null&&S!==void 0?S:r;w&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(w=w.slice(t.dataStartIndex,t.dataEndIndex+1));var T;if(d.dataKey&&!d.allowDuplicatedCategory){var A=w===void 0?i:w;T=kO(A,d.dataKey,s)}else T=w&&w[n]||i[n];return T?[].concat(Xb(m),[Gce(y,T)]):m},[])},dX=function(t,r,n,s){var o=s||{x:t.chartX,y:t.chartY},d=Itt(o,n),i=t.orderedTooltipTicks,m=t.tooltipAxis,y=t.tooltipTicks,S=QGe(d,i,y,m);if(S>=0&&y){var w=y[S]&&y[S].value,T=v4(t,r,S,w),A=Rtt(n,i,S,o);return{activeTooltipIndex:S,activeLabel:w,activePayload:T,activeCoordinate:A}}return null},Mtt=function(t,r){var n=r.axes,s=r.graphicalItems,o=r.axisType,d=r.axisIdKey,i=r.stackGroups,m=r.dataStartIndex,y=r.dataEndIndex,S=t.layout,w=t.children,T=t.stackOffset,A=Bce(S,o);return n.reduce(function(O,P){var N,R=P.type.defaultProps!==void 0?vr(vr({},P.type.defaultProps),P.props):P.props,M=R.type,F=R.dataKey,B=R.allowDataOverflow,$=R.allowDuplicatedCategory,W=R.scale,K=R.ticks,te=R.includeHidden,ne=R[d];if(O[ne])return O;var ae=BI(t.data,{graphicalItems:s.filter(function(pe){var Oe,Xe=d in pe.props?pe.props[d]:(Oe=pe.type.defaultProps)===null||Oe===void 0?void 0:Oe[d];return Xe===ne}),dataStartIndex:m,dataEndIndex:y}),re=ae.length,ee,ie,de;ott(R.domain,B,M)&&(ee=Nz(R.domain,null,B),A&&(M==="number"||W!=="auto")&&(de=FE(ae,F,"category")));var be=ode(M);if(!ee||ee.length===0){var Se,Ae=(Se=R.domain)!==null&&Se!==void 0?Se:be;if(F){if(ee=FE(ae,F,M),M==="category"&&A){var xe=VLe(ee);$&&xe?(ie=ee,ee=vk(0,re)):$||(ee=IK(Ae,ee,P).reduce(function(pe,Oe){return pe.indexOf(Oe)>=0?pe:[].concat(Xb(pe),[Oe])},[]))}else if(M==="category")$?ee=ee.filter(function(pe){return pe!==""&&!Oi(pe)}):ee=IK(Ae,ee,P).reduce(function(pe,Oe){return pe.indexOf(Oe)>=0||Oe===""||Oi(Oe)?pe:[].concat(Xb(pe),[Oe])},[]);else if(M==="number"){var me=iWe(ae,s.filter(function(pe){var Oe,Xe,We=d in pe.props?pe.props[d]:(Oe=pe.type.defaultProps)===null||Oe===void 0?void 0:Oe[d],$e="hide"in pe.props?pe.props.hide:(Xe=pe.type.defaultProps)===null||Xe===void 0?void 0:Xe.hide;return We===ne&&(te||!$e)}),F,o,S);me&&(ee=me)}A&&(M==="number"||W!=="auto")&&(de=FE(ae,F,"category"))}else A?ee=vk(0,re):i&&i[ne]&&i[ne].hasStack&&M==="number"?ee=T==="expand"?[0,1]:Hce(i[ne].stackGroups,m,y):ee=zce(ae,s.filter(function(pe){var Oe=d in pe.props?pe.props[d]:pe.type.defaultProps[d],Xe="hide"in pe.props?pe.props.hide:pe.type.defaultProps.hide;return Oe===ne&&(te||!Xe)}),M,S,!0);if(M==="number")ee=m4(w,ee,ne,o,K),Ae&&(ee=Nz(Ae,ee,B));else if(M==="category"&&Ae){var Ce=Ae,ge=ee.every(function(pe){return Ce.indexOf(pe)>=0});ge&&(ee=Ce)}}return vr(vr({},O),{},oi({},ne,vr(vr({},R),{},{axisType:o,domain:ee,categoricalDomain:de,duplicateDomain:ie,originalDomain:(N=R.domain)!==null&&N!==void 0?N:be,isCategorical:A,layout:S})))},{})},Dtt=function(t,r){var n=r.graphicalItems,s=r.Axis,o=r.axisType,d=r.axisIdKey,i=r.stackGroups,m=r.dataStartIndex,y=r.dataEndIndex,S=t.layout,w=t.children,T=BI(t.data,{graphicalItems:n,dataStartIndex:m,dataEndIndex:y}),A=T.length,O=Bce(S,o),P=-1;return n.reduce(function(N,R){var M=R.type.defaultProps!==void 0?vr(vr({},R.type.defaultProps),R.props):R.props,F=M[d],B=ode("number");if(!N[F]){P++;var $;return O?$=vk(0,A):i&&i[F]&&i[F].hasStack?($=Hce(i[F].stackGroups,m,y),$=m4(w,$,F,o)):($=Nz(B,zce(T,n.filter(function(W){var K,te,ne=d in W.props?W.props[d]:(K=W.type.defaultProps)===null||K===void 0?void 0:K[d],ae="hide"in W.props?W.props.hide:(te=W.type.defaultProps)===null||te===void 0?void 0:te.hide;return ne===F&&!ae}),"number",S),s.defaultProps.allowDataOverflow),$=m4(w,$,F,o)),vr(vr({},N),{},oi({},F,vr(vr({axisType:o},s.defaultProps),{},{hide:!0,orientation:_u(ktt,"".concat(o,".").concat(P%2),null),domain:$,originalDomain:B,isCategorical:O,layout:S})))}return N},{})},Ltt=function(t,r){var n=r.axisType,s=n===void 0?"xAxis":n,o=r.AxisComp,d=r.graphicalItems,i=r.stackGroups,m=r.dataStartIndex,y=r.dataEndIndex,S=t.children,w="".concat(s,"Id"),T=xu(S,o),A={};return T&&T.length?A=Mtt(t,{axes:T,graphicalItems:d,axisType:s,axisIdKey:w,stackGroups:i,dataStartIndex:m,dataEndIndex:y}):d&&d.length&&(A=Dtt(t,{Axis:o,graphicalItems:d,axisType:s,axisIdKey:w,stackGroups:i,dataStartIndex:m,dataEndIndex:y})),A},Ftt=function(t){var r=Im(t),n=Kf(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:A$(n,function(s){return s.coordinate}),tooltipAxis:r,tooltipAxisBandSize:sk(r,n)}},hX=function(t){var r=t.children,n=t.defaultShowTooltip,s=lu(r,Bb),o=0,d=0;return t.data&&t.data.length!==0&&(d=t.data.length-1),s&&s.props&&(s.props.startIndex>=0&&(o=s.props.startIndex),s.props.endIndex>=0&&(d=s.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:d,activeTooltipIndex:-1,isTooltipActive:!!n}},ztt=function(t){return!t||!t.length?!1:t.some(function(r){var n=Yf(r&&r.type);return n&&n.indexOf("Bar")>=0})},fX=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Btt=function(t,r){var n=t.props,s=t.graphicalItems,o=t.xAxisMap,d=o===void 0?{}:o,i=t.yAxisMap,m=i===void 0?{}:i,y=n.width,S=n.height,w=n.children,T=n.margin||{},A=lu(w,Bb),O=lu(w,kh),P=Object.keys(m).reduce(function($,W){var K=m[W],te=K.orientation;return!K.mirror&&!K.hide?vr(vr({},$),{},oi({},te,$[te]+K.width)):$},{left:T.left||0,right:T.right||0}),N=Object.keys(d).reduce(function($,W){var K=d[W],te=K.orientation;return!K.mirror&&!K.hide?vr(vr({},$),{},oi({},te,_u($,"".concat(te))+K.height)):$},{top:T.top||0,bottom:T.bottom||0}),R=vr(vr({},N),P),M=R.bottom;A&&(R.bottom+=A.props.height||Bb.defaultProps.height),O&&r&&(R=rWe(R,s,n,r));var F=y-R.left-R.right,B=S-R.top-R.bottom;return vr(vr({brushBottom:M},R),{},{width:Math.max(F,0),height:Math.max(B,0)})},$tt=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},cU=function(t){var r=t.chartName,n=t.GraphicalChild,s=t.defaultTooltipEventType,o=s===void 0?"axis":s,d=t.validateTooltipEventTypes,i=d===void 0?["axis"]:d,m=t.axisComponents,y=t.legendContent,S=t.formatAxisMap,w=t.defaultProps,T=function(R,M){var F=M.graphicalItems,B=M.stackGroups,$=M.offset,W=M.updateId,K=M.dataStartIndex,te=M.dataEndIndex,ne=R.barSize,ae=R.layout,re=R.barGap,ee=R.barCategoryGap,ie=R.maxBarSize,de=fX(ae),be=de.numericAxisName,Se=de.cateAxisName,Ae=ztt(F),xe=[];return F.forEach(function(me,Ce){var ge=BI(R.data,{graphicalItems:[me],dataStartIndex:K,dataEndIndex:te}),pe=me.type.defaultProps!==void 0?vr(vr({},me.type.defaultProps),me.props):me.props,Oe=pe.dataKey,Xe=pe.maxBarSize,We=pe["".concat(be,"Id")],$e=pe["".concat(Se,"Id")],Ke={},Le=m.reduce(function(pt,rt){var Kt=M["".concat(rt.axisType,"Map")],Ut=pe["".concat(rt.axisType,"Id")];Kt&&Kt[Ut]||rt.axisType==="zAxis"||Vv();var Ht=Kt[Ut];return vr(vr({},pt),{},oi(oi({},rt.axisType,Ht),"".concat(rt.axisType,"Ticks"),Kf(Ht)))},Ke),ke=Le[Se],st=Le["".concat(Se,"Ticks")],_t=B&&B[We]&&B[We].hasStack&&fWe(me,B[We].stackGroups),Be=Yf(me.type).indexOf("Bar")>=0,Dt=sk(ke,st),It=[],ir=Ae&&eWe({barSize:ne,stackGroups:B,totalSize:$tt(Le,Se)});if(Be){var Dr,Rr,jt=Oi(Xe)?ie:Xe,zt=(Dr=(Rr=sk(ke,st,!0))!==null&&Rr!==void 0?Rr:jt)!==null&&Dr!==void 0?Dr:0;It=tWe({barGap:re,barCategoryGap:ee,bandSize:zt!==Dt?zt:Dt,sizeList:ir[$e],maxBarSize:jt}),zt!==Dt&&(It=It.map(function(pt){return vr(vr({},pt),{},{position:vr(vr({},pt.position),{},{offset:pt.position.offset-zt/2})})}))}var Je=me&&me.type&&me.type.getComposedData;Je&&xe.push({props:vr(vr({},Je(vr(vr({},Le),{},{displayedData:ge,props:R,dataKey:Oe,item:me,bandSize:Dt,barPosition:It,offset:$,stackedData:_t,layout:ae,dataStartIndex:K,dataEndIndex:te}))),{},oi(oi(oi({key:me.key||"item-".concat(Ce)},be,Le[be]),Se,Le[Se]),"animationId",W)),childIndex:r3e(me,R.children),item:me})}),xe},A=function(R,M){var F=R.props,B=R.dataStartIndex,$=R.dataEndIndex,W=R.updateId;if(!AW({props:F}))return null;var K=F.children,te=F.layout,ne=F.stackOffset,ae=F.data,re=F.reverseStackOrder,ee=fX(te),ie=ee.numericAxisName,de=ee.cateAxisName,be=xu(K,n),Se=dWe(ae,be,"".concat(ie,"Id"),"".concat(de,"Id"),ne,re),Ae=m.reduce(function(pe,Oe){var Xe="".concat(Oe.axisType,"Map");return vr(vr({},pe),{},oi({},Xe,Ltt(F,vr(vr({},Oe),{},{graphicalItems:be,stackGroups:Oe.axisType===ie&&Se,dataStartIndex:B,dataEndIndex:$}))))},{}),xe=Btt(vr(vr({},Ae),{},{props:F,graphicalItems:be}),M==null?void 0:M.legendBBox);Object.keys(Ae).forEach(function(pe){Ae[pe]=S(F,Ae[pe],xe,pe.replace("Map",""),r)});var me=Ae["".concat(de,"Map")],Ce=Ftt(me),ge=T(F,vr(vr({},Ae),{},{dataStartIndex:B,dataEndIndex:$,updateId:W,graphicalItems:be,stackGroups:Se,offset:xe}));return vr(vr({formattedGraphicalItems:ge,graphicalItems:be,offset:xe,stackGroups:Se},Ce),Ae)},O=function(N){function R(M){var F,B,$;return xtt(this,R),$=Stt(this,R,[M]),oi($,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),oi($,"accessibilityManager",new att),oi($,"handleLegendBBoxUpdate",function(W){if(W){var K=$.state,te=K.dataStartIndex,ne=K.dataEndIndex,ae=K.updateId;$.setState(vr({legendBBox:W},A({props:$.props,dataStartIndex:te,dataEndIndex:ne,updateId:ae},vr(vr({},$.state),{},{legendBBox:W}))))}}),oi($,"handleReceiveSyncEvent",function(W,K,te){if($.props.syncId===W){if(te===$.eventEmitterSymbol&&typeof $.props.syncMethod!="function")return;$.applySyncEvent(K)}}),oi($,"handleBrushChange",function(W){var K=W.startIndex,te=W.endIndex;if(K!==$.state.dataStartIndex||te!==$.state.dataEndIndex){var ne=$.state.updateId;$.setState(function(){return vr({dataStartIndex:K,dataEndIndex:te},A({props:$.props,dataStartIndex:K,dataEndIndex:te,updateId:ne},$.state))}),$.triggerSyncEvent({dataStartIndex:K,dataEndIndex:te})}}),oi($,"handleMouseEnter",function(W){var K=$.getMouseInfo(W);if(K){var te=vr(vr({},K),{},{isTooltipActive:!0});$.setState(te),$.triggerSyncEvent(te);var ne=$.props.onMouseEnter;vi(ne)&&ne(te,W)}}),oi($,"triggeredAfterMouseMove",function(W){var K=$.getMouseInfo(W),te=K?vr(vr({},K),{},{isTooltipActive:!0}):{isTooltipActive:!1};$.setState(te),$.triggerSyncEvent(te);var ne=$.props.onMouseMove;vi(ne)&&ne(te,W)}),oi($,"handleItemMouseEnter",function(W){$.setState(function(){return{isTooltipActive:!0,activeItem:W,activePayload:W.tooltipPayload,activeCoordinate:W.tooltipPosition||{x:W.cx,y:W.cy}}})}),oi($,"handleItemMouseLeave",function(){$.setState(function(){return{isTooltipActive:!1}})}),oi($,"handleMouseMove",function(W){W.persist(),$.throttleTriggeredAfterMouseMove(W)}),oi($,"handleMouseLeave",function(W){$.throttleTriggeredAfterMouseMove.cancel();var K={isTooltipActive:!1};$.setState(K),$.triggerSyncEvent(K);var te=$.props.onMouseLeave;vi(te)&&te(K,W)}),oi($,"handleOuterEvent",function(W){var K=t3e(W),te=_u($.props,"".concat(K));if(K&&vi(te)){var ne,ae;/.*touch.*/i.test(K)?ae=$.getMouseInfo(W.changedTouches[0]):ae=$.getMouseInfo(W),te((ne=ae)!==null&&ne!==void 0?ne:{},W)}}),oi($,"handleClick",function(W){var K=$.getMouseInfo(W);if(K){var te=vr(vr({},K),{},{isTooltipActive:!0});$.setState(te),$.triggerSyncEvent(te);var ne=$.props.onClick;vi(ne)&&ne(te,W)}}),oi($,"handleMouseDown",function(W){var K=$.props.onMouseDown;if(vi(K)){var te=$.getMouseInfo(W);K(te,W)}}),oi($,"handleMouseUp",function(W){var K=$.props.onMouseUp;if(vi(K)){var te=$.getMouseInfo(W);K(te,W)}}),oi($,"handleTouchMove",function(W){W.changedTouches!=null&&W.changedTouches.length>0&&$.throttleTriggeredAfterMouseMove(W.changedTouches[0])}),oi($,"handleTouchStart",function(W){W.changedTouches!=null&&W.changedTouches.length>0&&$.handleMouseDown(W.changedTouches[0])}),oi($,"handleTouchEnd",function(W){W.changedTouches!=null&&W.changedTouches.length>0&&$.handleMouseUp(W.changedTouches[0])}),oi($,"handleDoubleClick",function(W){var K=$.props.onDoubleClick;if(vi(K)){var te=$.getMouseInfo(W);K(te,W)}}),oi($,"handleContextMenu",function(W){var K=$.props.onContextMenu;if(vi(K)){var te=$.getMouseInfo(W);K(te,W)}}),oi($,"triggerSyncEvent",function(W){$.props.syncId!==void 0&&AL.emit(CL,$.props.syncId,W,$.eventEmitterSymbol)}),oi($,"applySyncEvent",function(W){var K=$.props,te=K.layout,ne=K.syncMethod,ae=$.state.updateId,re=W.dataStartIndex,ee=W.dataEndIndex;if(W.dataStartIndex!==void 0||W.dataEndIndex!==void 0)$.setState(vr({dataStartIndex:re,dataEndIndex:ee},A({props:$.props,dataStartIndex:re,dataEndIndex:ee,updateId:ae},$.state)));else if(W.activeTooltipIndex!==void 0){var ie=W.chartX,de=W.chartY,be=W.activeTooltipIndex,Se=$.state,Ae=Se.offset,xe=Se.tooltipTicks;if(!Ae)return;if(typeof ne=="function")be=ne(xe,W);else if(ne==="value"){be=-1;for(var me=0;me<xe.length;me++)if(xe[me].value===W.activeLabel){be=me;break}}var Ce=vr(vr({},Ae),{},{x:Ae.left,y:Ae.top}),ge=Math.min(ie,Ce.x+Ce.width),pe=Math.min(de,Ce.y+Ce.height),Oe=xe[be]&&xe[be].value,Xe=v4($.state,$.props.data,be),We=xe[be]?{x:te==="horizontal"?xe[be].coordinate:ge,y:te==="horizontal"?pe:xe[be].coordinate}:ade;$.setState(vr(vr({},W),{},{activeLabel:Oe,activeCoordinate:We,activePayload:Xe,activeTooltipIndex:be}))}else $.setState(W)}),oi($,"renderCursor",function(W){var K,te=$.state,ne=te.isTooltipActive,ae=te.activeCoordinate,re=te.activePayload,ee=te.offset,ie=te.activeTooltipIndex,de=te.tooltipAxisBandSize,be=$.getTooltipEventType(),Se=(K=W.props.active)!==null&&K!==void 0?K:ne,Ae=$.props.layout,xe=W.key||"_recharts-cursor";return Ve.createElement(ftt,{key:xe,activeCoordinate:ae,activePayload:re,activeTooltipIndex:ie,chartName:r,element:W,isActive:Se,layout:Ae,offset:ee,tooltipAxisBandSize:de,tooltipEventType:be})}),oi($,"renderPolarAxis",function(W,K,te){var ne=_u(W,"type.axisType"),ae=_u($.state,"".concat(ne,"Map")),re=W.type.defaultProps,ee=re!==void 0?vr(vr({},re),W.props):W.props,ie=ae&&ae[ee["".concat(ne,"Id")]];return V.cloneElement(W,vr(vr({},ie),{},{className:Ni(ne,ie.className),key:W.key||"".concat(K,"-").concat(te),ticks:Kf(ie,!0)}))}),oi($,"renderPolarGrid",function(W){var K=W.props,te=K.radialLines,ne=K.polarAngles,ae=K.polarRadius,re=$.state,ee=re.radiusAxisMap,ie=re.angleAxisMap,de=Im(ee),be=Im(ie),Se=be.cx,Ae=be.cy,xe=be.innerRadius,me=be.outerRadius;return V.cloneElement(W,{polarAngles:Array.isArray(ne)?ne:Kf(be,!0).map(function(Ce){return Ce.coordinate}),polarRadius:Array.isArray(ae)?ae:Kf(de,!0).map(function(Ce){return Ce.coordinate}),cx:Se,cy:Ae,innerRadius:xe,outerRadius:me,key:W.key||"polar-grid",radialLines:te})}),oi($,"renderLegend",function(){var W=$.state.formattedGraphicalItems,K=$.props,te=K.children,ne=K.width,ae=K.height,re=$.props.margin||{},ee=ne-(re.left||0)-(re.right||0),ie=Lce({children:te,formattedGraphicalItems:W,legendWidth:ee,legendContent:y});if(!ie)return null;var de=ie.item,be=cX(ie,ptt);return V.cloneElement(de,vr(vr({},be),{},{chartWidth:ne,chartHeight:ae,margin:re,onBBoxUpdate:$.handleLegendBBoxUpdate}))}),oi($,"renderTooltip",function(){var W,K=$.props,te=K.children,ne=K.accessibilityLayer,ae=lu(te,Tl);if(!ae)return null;var re=$.state,ee=re.isTooltipActive,ie=re.activeCoordinate,de=re.activePayload,be=re.activeLabel,Se=re.offset,Ae=(W=ae.props.active)!==null&&W!==void 0?W:ee;return V.cloneElement(ae,{viewBox:vr(vr({},Se),{},{x:Se.left,y:Se.top}),active:Ae,label:be,payload:Ae?de:[],coordinate:ie,accessibilityLayer:ne})}),oi($,"renderBrush",function(W){var K=$.props,te=K.margin,ne=K.data,ae=$.state,re=ae.offset,ee=ae.dataStartIndex,ie=ae.dataEndIndex,de=ae.updateId;return V.cloneElement(W,{key:W.key||"_recharts-brush",onChange:Mj($.handleBrushChange,W.props.onChange),data:ne,x:Gr(W.props.x)?W.props.x:re.left,y:Gr(W.props.y)?W.props.y:re.top+re.height+re.brushBottom-(te.bottom||0),width:Gr(W.props.width)?W.props.width:re.width,startIndex:ee,endIndex:ie,updateId:"brush-".concat(de)})}),oi($,"renderReferenceElement",function(W,K,te){if(!W)return null;var ne=$,ae=ne.clipPathId,re=$.state,ee=re.xAxisMap,ie=re.yAxisMap,de=re.offset,be=W.type.defaultProps||{},Se=W.props,Ae=Se.xAxisId,xe=Ae===void 0?be.xAxisId:Ae,me=Se.yAxisId,Ce=me===void 0?be.yAxisId:me;return V.cloneElement(W,{key:W.key||"".concat(K,"-").concat(te),xAxis:ee[xe],yAxis:ie[Ce],viewBox:{x:de.left,y:de.top,width:de.width,height:de.height},clipPathId:ae})}),oi($,"renderActivePoints",function(W){var K=W.item,te=W.activePoint,ne=W.basePoint,ae=W.childIndex,re=W.isRange,ee=[],ie=K.props.key,de=K.item.type.defaultProps!==void 0?vr(vr({},K.item.type.defaultProps),K.item.props):K.item.props,be=de.activeDot,Se=de.dataKey,Ae=vr(vr({index:ae,dataKey:Se,cx:te.x,cy:te.y,r:4,fill:J$(K.item),strokeWidth:2,stroke:"#fff",payload:te.payload,value:te.value},Jn(be,!1)),NO(be));return ee.push(R.renderActiveDot(be,Ae,"".concat(ie,"-activePoint-").concat(ae))),ne?ee.push(R.renderActiveDot(be,vr(vr({},Ae),{},{cx:ne.x,cy:ne.y}),"".concat(ie,"-basePoint-").concat(ae))):re&&ee.push(null),ee}),oi($,"renderGraphicChild",function(W,K,te){var ne=$.filterFormatItem(W,K,te);if(!ne)return null;var ae=$.getTooltipEventType(),re=$.state,ee=re.isTooltipActive,ie=re.tooltipAxis,de=re.activeTooltipIndex,be=re.activeLabel,Se=$.props.children,Ae=lu(Se,Tl),xe=ne.props,me=xe.points,Ce=xe.isRange,ge=xe.baseLine,pe=ne.item.type.defaultProps!==void 0?vr(vr({},ne.item.type.defaultProps),ne.item.props):ne.item.props,Oe=pe.activeDot,Xe=pe.hide,We=pe.activeBar,$e=pe.activeShape,Ke=!!(!Xe&&ee&&Ae&&(Oe||We||$e)),Le={};ae!=="axis"&&Ae&&Ae.props.trigger==="click"?Le={onClick:Mj($.handleItemMouseEnter,W.props.onClick)}:ae!=="axis"&&(Le={onMouseLeave:Mj($.handleItemMouseLeave,W.props.onMouseLeave),onMouseEnter:Mj($.handleItemMouseEnter,W.props.onMouseEnter)});var ke=V.cloneElement(W,vr(vr({},ne.props),Le));function st(rt){return typeof ie.dataKey=="function"?ie.dataKey(rt.payload):null}if(Ke)if(de>=0){var _t,Be;if(ie.dataKey&&!ie.allowDuplicatedCategory){var Dt=typeof ie.dataKey=="function"?st:"payload.".concat(ie.dataKey.toString());_t=kO(me,Dt,be),Be=Ce&&ge&&kO(ge,Dt,be)}else _t=me==null?void 0:me[de],Be=Ce&&ge&&ge[de];if($e||We){var It=W.props.activeIndex!==void 0?W.props.activeIndex:de;return[V.cloneElement(W,vr(vr(vr({},ne.props),Le),{},{activeIndex:It})),null,null]}if(!Oi(_t))return[ke].concat(Xb($.renderActivePoints({item:ne,activePoint:_t,basePoint:Be,childIndex:de,isRange:Ce})))}else{var ir,Dr=(ir=$.getItemByXY($.state.activeCoordinate))!==null&&ir!==void 0?ir:{graphicalItem:ke},Rr=Dr.graphicalItem,jt=Rr.item,zt=jt===void 0?W:jt,Je=Rr.childIndex,pt=vr(vr(vr({},ne.props),Le),{},{activeIndex:Je});return[V.cloneElement(zt,pt),null,null]}return Ce?[ke,null,null]:[ke,null]}),oi($,"renderCustomized",function(W,K,te){return V.cloneElement(W,vr(vr({key:"recharts-customized-".concat(te)},$.props),$.state))}),oi($,"renderMap",{CartesianGrid:{handler:Bj,once:!0},ReferenceArea:{handler:$.renderReferenceElement},ReferenceLine:{handler:Bj},ReferenceDot:{handler:$.renderReferenceElement},XAxis:{handler:Bj},YAxis:{handler:Bj},Brush:{handler:$.renderBrush,once:!0},Bar:{handler:$.renderGraphicChild},Line:{handler:$.renderGraphicChild},Area:{handler:$.renderGraphicChild},Radar:{handler:$.renderGraphicChild},RadialBar:{handler:$.renderGraphicChild},Scatter:{handler:$.renderGraphicChild},Pie:{handler:$.renderGraphicChild},Funnel:{handler:$.renderGraphicChild},Tooltip:{handler:$.renderCursor,once:!0},PolarGrid:{handler:$.renderPolarGrid,once:!0},PolarAngleAxis:{handler:$.renderPolarAxis},PolarRadiusAxis:{handler:$.renderPolarAxis},Customized:{handler:$.renderCustomized}}),$.clipPathId="".concat((F=M.id)!==null&&F!==void 0?F:vw("recharts"),"-clip"),$.throttleTriggeredAfterMouseMove=Mle($.triggeredAfterMouseMove,(B=M.throttleDelay)!==null&&B!==void 0?B:1e3/60),$.state={},$}return Att(R,N),wtt(R,[{key:"componentDidMount",value:function(){var F,B;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(F=this.props.margin.left)!==null&&F!==void 0?F:0,top:(B=this.props.margin.top)!==null&&B!==void 0?B:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var F=this.props,B=F.children,$=F.data,W=F.height,K=F.layout,te=lu(B,Tl);if(te){var ne=te.props.defaultIndex;if(!(typeof ne!="number"||ne<0||ne>this.state.tooltipTicks.length-1)){var ae=this.state.tooltipTicks[ne]&&this.state.tooltipTicks[ne].value,re=v4(this.state,$,ne,ae),ee=this.state.tooltipTicks[ne].coordinate,ie=(this.state.offset.top+W)/2,de=K==="horizontal",be=de?{x:ee,y:ie}:{y:ee,x:ie},Se=this.state.formattedGraphicalItems.find(function(xe){var me=xe.item;return me.type.name==="Scatter"});Se&&(be=vr(vr({},be),Se.props.points[ne].tooltipPosition),re=Se.props.points[ne].tooltipPayload);var Ae={activeTooltipIndex:ne,isTooltipActive:!0,activeLabel:ae,activePayload:re,activeCoordinate:be};this.setState(Ae),this.renderCursor(te),this.accessibilityManager.setIndex(ne)}}}},{key:"getSnapshotBeforeUpdate",value:function(F,B){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==B.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==F.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==F.margin){var $,W;this.accessibilityManager.setDetails({offset:{left:($=this.props.margin.left)!==null&&$!==void 0?$:0,top:(W=this.props.margin.top)!==null&&W!==void 0?W:0}})}return null}},{key:"componentDidUpdate",value:function(F){WF([lu(F.children,Tl)],[lu(this.props.children,Tl)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var F=lu(this.props.children,Tl);if(F&&typeof F.props.shared=="boolean"){var B=F.props.shared?"axis":"item";return i.indexOf(B)>=0?B:o}return o}},{key:"getMouseInfo",value:function(F){if(!this.container)return null;var B=this.container,$=B.getBoundingClientRect(),W=j8e($),K={chartX:Math.round(F.pageX-W.left),chartY:Math.round(F.pageY-W.top)},te=$.width/B.offsetWidth||1,ne=this.inRange(K.chartX,K.chartY,te);if(!ne)return null;var ae=this.state,re=ae.xAxisMap,ee=ae.yAxisMap,ie=this.getTooltipEventType(),de=dX(this.state,this.props.data,this.props.layout,ne);if(ie!=="axis"&&re&&ee){var be=Im(re).scale,Se=Im(ee).scale,Ae=be&&be.invert?be.invert(K.chartX):null,xe=Se&&Se.invert?Se.invert(K.chartY):null;return vr(vr({},K),{},{xValue:Ae,yValue:xe},de)}return de?vr(vr({},K),de):null}},{key:"inRange",value:function(F,B){var $=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,W=this.props.layout,K=F/$,te=B/$;if(W==="horizontal"||W==="vertical"){var ne=this.state.offset,ae=K>=ne.left&&K<=ne.left+ne.width&&te>=ne.top&&te<=ne.top+ne.height;return ae?{x:K,y:te}:null}var re=this.state,ee=re.angleAxisMap,ie=re.radiusAxisMap;if(ee&&ie){var de=Im(ee);return DK({x:K,y:te},de)}return null}},{key:"parseEventsOfWrapper",value:function(){var F=this.props.children,B=this.getTooltipEventType(),$=lu(F,Tl),W={};$&&B==="axis"&&($.props.trigger==="click"?W={onClick:this.handleClick}:W={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var K=NO(this.props,this.handleOuterEvent);return vr(vr({},K),W)}},{key:"addListener",value:function(){AL.on(CL,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){AL.removeListener(CL,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(F,B,$){for(var W=this.state.formattedGraphicalItems,K=0,te=W.length;K<te;K++){var ne=W[K];if(ne.item===F||ne.props.key===F.key||B===Yf(ne.item.type)&&$===ne.childIndex)return ne}return null}},{key:"renderClipPath",value:function(){var F=this.clipPathId,B=this.state.offset,$=B.left,W=B.top,K=B.height,te=B.width;return Ve.createElement("defs",null,Ve.createElement("clipPath",{id:F},Ve.createElement("rect",{x:$,y:W,height:K,width:te})))}},{key:"getXScales",value:function(){var F=this.state.xAxisMap;return F?Object.entries(F).reduce(function(B,$){var W=lX($,2),K=W[0],te=W[1];return vr(vr({},B),{},oi({},K,te.scale))},{}):null}},{key:"getYScales",value:function(){var F=this.state.yAxisMap;return F?Object.entries(F).reduce(function(B,$){var W=lX($,2),K=W[0],te=W[1];return vr(vr({},B),{},oi({},K,te.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(F){var B;return(B=this.state.xAxisMap)===null||B===void 0||(B=B[F])===null||B===void 0?void 0:B.scale}},{key:"getYScaleByAxisId",value:function(F){var B;return(B=this.state.yAxisMap)===null||B===void 0||(B=B[F])===null||B===void 0?void 0:B.scale}},{key:"getItemByXY",value:function(F){var B=this.state,$=B.formattedGraphicalItems,W=B.activeItem;if($&&$.length)for(var K=0,te=$.length;K<te;K++){var ne=$[K],ae=ne.props,re=ne.item,ee=re.type.defaultProps!==void 0?vr(vr({},re.type.defaultProps),re.props):re.props,ie=Yf(re.type);if(ie==="Bar"){var de=(ae.data||[]).find(function(xe){return cZe(F,xe)});if(de)return{graphicalItem:ne,payload:de}}else if(ie==="RadialBar"){var be=(ae.data||[]).find(function(xe){return DK(F,xe)});if(be)return{graphicalItem:ne,payload:be}}else if(II(ne,W)||RI(ne,W)||t2(ne,W)){var Se=YXe({graphicalItem:ne,activeTooltipItem:W,itemData:ee.data}),Ae=ee.activeIndex===void 0?Se:ee.activeIndex;return{graphicalItem:vr(vr({},ne),{},{childIndex:Ae}),payload:t2(ne,W)?ee.data[Se]:ne.props.data[Se]}}}return null}},{key:"render",value:function(){var F=this;if(!AW(this))return null;var B=this.props,$=B.children,W=B.className,K=B.width,te=B.height,ne=B.style,ae=B.compact,re=B.title,ee=B.desc,ie=cX(B,mtt),de=Jn(ie,!1);if(ae)return Ve.createElement(qZ,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ve.createElement(ZF,w0({},de,{width:K,height:te,title:re,desc:ee}),this.renderClipPath(),jW($,this.renderMap)));if(this.props.accessibilityLayer){var be,Se;de.tabIndex=(be=this.props.tabIndex)!==null&&be!==void 0?be:0,de.role=(Se=this.props.role)!==null&&Se!==void 0?Se:"application",de.onKeyDown=function(xe){F.accessibilityManager.keyboardEvent(xe)},de.onFocus=function(){F.accessibilityManager.focus()}}var Ae=this.parseEventsOfWrapper();return Ve.createElement(qZ,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ve.createElement("div",w0({className:Ni("recharts-wrapper",W),style:vr({position:"relative",cursor:"default",width:K,height:te},ne)},Ae,{ref:function(me){F.container=me}}),Ve.createElement(ZF,w0({},de,{width:K,height:te,title:re,desc:ee,style:Ntt}),this.renderClipPath(),jW($,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(V.Component);oi(O,"displayName",r),oi(O,"defaultProps",vr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},w)),oi(O,"getDerivedStateFromProps",function(N,R){var M=N.dataKey,F=N.data,B=N.children,$=N.width,W=N.height,K=N.layout,te=N.stackOffset,ne=N.margin,ae=R.dataStartIndex,re=R.dataEndIndex;if(R.updateId===void 0){var ee=hX(N);return vr(vr(vr({},ee),{},{updateId:0},A(vr(vr({props:N},ee),{},{updateId:0}),R)),{},{prevDataKey:M,prevData:F,prevWidth:$,prevHeight:W,prevLayout:K,prevStackOffset:te,prevMargin:ne,prevChildren:B})}if(M!==R.prevDataKey||F!==R.prevData||$!==R.prevWidth||W!==R.prevHeight||K!==R.prevLayout||te!==R.prevStackOffset||!F0(ne,R.prevMargin)){var ie=hX(N),de={chartX:R.chartX,chartY:R.chartY,isTooltipActive:R.isTooltipActive},be=vr(vr({},dX(R,F,K)),{},{updateId:R.updateId+1}),Se=vr(vr(vr({},ie),de),be);return vr(vr(vr({},Se),A(vr({props:N},Se),R)),{},{prevDataKey:M,prevData:F,prevWidth:$,prevHeight:W,prevLayout:K,prevStackOffset:te,prevMargin:ne,prevChildren:B})}if(!WF(B,R.prevChildren)){var Ae,xe,me,Ce,ge=lu(B,Bb),pe=ge&&(Ae=(xe=ge.props)===null||xe===void 0?void 0:xe.startIndex)!==null&&Ae!==void 0?Ae:ae,Oe=ge&&(me=(Ce=ge.props)===null||Ce===void 0?void 0:Ce.endIndex)!==null&&me!==void 0?me:re,Xe=pe!==ae||Oe!==re,We=!Oi(F),$e=We&&!Xe?R.updateId:R.updateId+1;return vr(vr({updateId:$e},A(vr(vr({props:N},R),{},{updateId:$e,dataStartIndex:pe,dataEndIndex:Oe}),R)),{},{prevChildren:B,dataStartIndex:pe,dataEndIndex:Oe})}return null}),oi(O,"renderActiveDot",function(N,R,M){var F;return V.isValidElement(N)?F=V.cloneElement(N,R):vi(N)?F=N(R):F=Ve.createElement(jI,R),Ve.createElement(Cs,{className:"recharts-active-dot",key:M},F)});var P=V.forwardRef(function(R,M){return Ve.createElement(O,w0({},R,{ref:M}))});return P.displayName=O.displayName,P},lde=cU({chartName:"LineChart",GraphicalChild:Aw,axisComponents:[{axisType:"xAxis",AxisComp:Ih},{axisType:"yAxis",AxisComp:Rh}],formatAxisMap:Aue}),pP=cU({chartName:"BarChart",GraphicalChild:Vu,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Ih},{axisType:"yAxis",AxisComp:Rh}],formatAxisMap:Aue}),pX=cU({chartName:"PieChart",GraphicalChild:Xh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:NI},{axisType:"radiusAxis",AxisComp:OI}],formatAxisMap:SWe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const Utt=()=>{const{t:e}=ei(),{isSupervisor:t}=_c(),{data:r,isLoading:n}=OIe(),{data:s}=kIe(),{data:o}=RIe(),{data:d}=NIe(),{data:i}=IIe();return n?h.jsx(ml,{children:h.jsx("div",{className:"text-center",children:e("common.loading")})}):h.jsx(ml,{children:h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.dashboard")}),h.jsx("p",{className:"text-muted-foreground",children:e("admin.dashboardDescription")})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:t?"":e("admin.totalUsers")}),h.jsx(Bc,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalUsers)||0}),h.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.registeredUsers")})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:t?"":e("admin.totalRestaurants")}),h.jsx(Mo,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalRestaurants)||0}),h.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.listedRestaurants")})]})]}),!t&&h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:e("admin.totalActivities")}),h.jsx(yo,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalActivities)||0}),h.jsx("p",{className:"text-xs text-muted-foreground",children:e("admin.activeEvents")})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:t?"":e("admin.totalComments")}),h.jsx(qP,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalComments)||0}),h.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.userReviews")})]})]})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(NQ,{className:"h-5 w-5"}),""]}),h.jsx(cs,{children:t?"":"Top 5 "})]}),h.jsx(Mr,{children:d&&d.length>0?h.jsx(Wm,{width:"100%",height:300,children:h.jsxs(lde,{data:d,children:[h.jsx(sv,{strokeDasharray:"3 3"}),h.jsx(Ih,{dataKey:"month"}),h.jsx(Rh,{domain:[0,5]}),h.jsx(Tl,{}),h.jsx(kh,{}),Object.keys(d[0]).filter(m=>m!=="month").map((m,y)=>h.jsx(Aw,{type:"monotone",dataKey:m,stroke:`hsl(${y*360/5}, 70%, 50%)`,strokeWidth:2},m))]})}):h.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(x_e,{className:"h-5 w-5"}),""]}),h.jsx(cs,{children:t?"":"Top 5 "})]}),h.jsx(Mr,{children:i&&i.length>0?h.jsx(Wm,{width:"100%",height:300,children:h.jsxs(pP,{data:i,children:[h.jsx(sv,{strokeDasharray:"3 3"}),h.jsx(Ih,{dataKey:"month"}),h.jsx(Rh,{}),h.jsx(Tl,{}),h.jsx(kh,{}),Object.keys(i[0]).filter(m=>m!=="month").map((m,y)=>h.jsx(Vu,{dataKey:m,fill:`hsl(${y*360/5}, 70%, 50%)`},m))]})}):h.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),!t&&o&&o.length>0&&h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(OE,{className:"h-5 w-5"}),e("admin.activityEngagement")]}),h.jsx(cs,{children:e("admin.activityEngagementDescription")})]}),h.jsx(Mr,{children:h.jsx(Wm,{width:"100%",height:300,children:h.jsxs(pP,{data:o,children:[h.jsx(sv,{strokeDasharray:"3 3"}),h.jsx(Ih,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),h.jsx(Rh,{}),h.jsx(Tl,{}),h.jsx(kh,{}),h.jsx(Vu,{dataKey:"subscribers",name:e("admin.subscribers"),fill:"hsl(var(--primary))"}),h.jsx(Vu,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})})})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(Cl,{className:"h-5 w-5"}),t?"":e("admin.topRestaurants")]}),h.jsx(cs,{children:t?"":e("admin.topRestaurantsDescription")})]}),h.jsx(Mr,{children:s&&s.length>0?h.jsx(Wm,{width:"100%",height:400,children:h.jsxs(pP,{data:s,layout:"horizontal",children:[h.jsx(sv,{strokeDasharray:"3 3"}),h.jsx(Ih,{type:"number"}),h.jsx(Rh,{dataKey:"name",type:"category",width:150}),h.jsx(Tl,{}),h.jsx(kh,{}),h.jsx(Vu,{dataKey:"rating",name:e("admin.rating"),fill:"hsl(var(--primary))"}),h.jsx(Vu,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})}):h.jsx("div",{className:"h-[400px] flex items-center justify-center text-muted-foreground",children:t?"":e("admin.noData")})})]})]})})},Vtt=({trigger:e})=>{const{t}=ei(),{toast:r}=Ii(),n=Ri(),{isSupervisor:s}=_c(),[o,d]=V.useState(!1),[i,m]=V.useState(!1),[y,S]=V.useState({email:"",password:"",displayName:"",phone:"",role:"merchant"}),w=async T=>{T.preventDefault(),m(!0);try{const{data:{session:A}}=await Ct.auth.getSession(),O=await fetch("https://tzdgqhwyzsxkxnncgzap.supabase.co/functions/v1/admin-create-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A==null?void 0:A.access_token}`},body:JSON.stringify({email:y.email,password:y.password,displayName:y.displayName,phone:y.phone,role:y.role})}),P=await O.json();if(!O.ok)throw new Error(P.error||"Failed to create user");r({title:t("common.success"),description:t("admin.userCreated")}),d(!1),S({email:"",password:"",displayName:"",phone:"",role:"merchant"}),n.invalidateQueries({queryKey:["admin-users"]})}catch(A){console.error("Error creating user:",A),r({title:t("common.error"),description:A.message||t("admin.createUserError"),variant:"destructive"})}finally{m(!1)}};return h.jsxs(Lo,{open:o,onOpenChange:d,children:[h.jsx(tf,{asChild:!0,children:e||h.jsxs(Mt,{children:[h.jsx(OE,{className:"mr-2 h-4 w-4"}),t("admin.createUser")]})}),h.jsx(xo,{className:"max-w-[90vw] sm:max-w-[500px]",children:h.jsxs("form",{onSubmit:w,children:[h.jsxs(bo,{children:[h.jsx(wo,{children:t("admin.createNewUser")}),h.jsx(pl,{children:t("admin.createUserDescription")})]}),h.jsxs("div",{className:"grid gap-4 py-4",children:[h.jsxs("div",{className:"grid gap-2",children:[h.jsx(yr,{htmlFor:"email",children:t("auth.email")}),h.jsx(cr,{id:"email",type:"email",required:!0,value:y.email,onChange:T=>S({...y,email:T.target.value}),placeholder:"user@example.com"})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx(yr,{htmlFor:"password",children:t("auth.password")}),h.jsx(cr,{id:"password",type:"password",required:!0,value:y.password,onChange:T=>S({...y,password:T.target.value}),placeholder:"",minLength:6})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx(yr,{htmlFor:"displayName",children:t("profile.displayName")}),h.jsx(cr,{id:"displayName",required:!0,value:y.displayName,onChange:T=>S({...y,displayName:T.target.value}),placeholder:t("profile.displayName")})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx(yr,{htmlFor:"phone",children:t("profile.phone")}),h.jsx(cr,{id:"phone",type:"tel",value:y.phone,onChange:T=>S({...y,phone:T.target.value}),placeholder:"+351 XXX XXX XXX"})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx(yr,{htmlFor:"role",children:t("admin.role")}),s?h.jsx(cr,{id:"role",value:t("admin.merchant"),disabled:!0,className:"bg-muted"}):h.jsxs(Aa,{value:y.role,onValueChange:T=>S({...y,role:T}),children:[h.jsx(ya,{children:h.jsx(Ca,{})}),h.jsxs(va,{children:[h.jsx(En,{value:"merchant",children:t("admin.merchant")}),h.jsx(En,{value:"supervisor",children:t("admin.supervisor")})]})]})]})]}),h.jsxs(r_,{children:[h.jsx(Mt,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:i,children:t("common.cancel")}),h.jsxs(Mt,{type:"submit",disabled:i,children:[i&&h.jsx(aa,{className:"mr-2 h-4 w-4 animate-spin"}),t("admin.create")]})]})]})})]})},qtt=({open:e,onOpenChange:t,merchantId:r,merchantName:n,userRole:s})=>{const{t:o}=ei(),{toast:d}=Ii(),i=Ri(),{localizeRestaurant:m}=xc(),{user:y}=Qn(),{isSupervisor:S}=_c(),[w,T]=V.useState([]),[A,O]=V.useState(""),{data:P}=ci({queryKey:["supervisorRestaurants",y==null?void 0:y.id],queryFn:async()=>{if(!y||!S)return null;const{data:ne,error:ae}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",y.id);if(ae)throw ae;return(ne==null?void 0:ne.map(re=>re.restaurant_id))||[]},enabled:e&&S&&!!y}),{data:N,isLoading:R}=ci({queryKey:["allRestaurants",P],queryFn:async()=>{let ne=Ct.from("restaurants").select("*").order("name");S&&P&&P.length>0&&(ne=ne.in("id",P));const{data:ae,error:re}=await ne;if(re)throw re;return ae},enabled:!S||S&&P!==void 0}),{data:M,isLoading:F}=ci({queryKey:["merchantRestaurants",r],queryFn:async()=>{const{data:ne,error:ae}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",r);if(ae)throw ae;return(ne==null?void 0:ne.map(re=>re.restaurant_id))||[]},enabled:e});V.useEffect(()=>{M&&T(M)},[M]);const B=Gi({mutationFn:async()=>{const{error:ne}=await Ct.from("merchant_restaurants").delete().eq("user_id",r);if(ne)throw ne;if(w.length>0){const{error:ae}=await Ct.from("merchant_restaurants").insert(w.map(re=>({user_id:r,restaurant_id:re})));if(ae)throw ae}},onSuccess:()=>{d({title:o("toast.merchantRestaurantsSaved"),description:o("toast.merchantRestaurantsDescription")}),i.invalidateQueries({queryKey:["merchantRestaurants"]}),i.invalidateQueries({queryKey:["adminUsers"]}),t(!1)},onError:ne=>{console.error("Error saving merchant restaurants:",ne),d({title:o("toast.merchantRestaurantsSaveFailed"),description:o("toast.merchantRestaurantsDescriptionFailed"),variant:"destructive"})}}),$=ne=>{T(s==="merchant"?[ne]:ae=>ae.includes(ne)?ae.filter(re=>re!==ne):[...ae,ne])},W=()=>{B.mutate()},K=R||F,te=N==null?void 0:N.filter(ne=>A.trim()?m(ne).name.toLowerCase().includes(A.toLowerCase())||ne.address.toLowerCase().includes(A.toLowerCase()):!0);return h.jsx(Lo,{open:e,onOpenChange:t,children:h.jsxs(xo,{className:"max-w-2xl max-h-[80vh]",children:[h.jsxs(bo,{children:[h.jsxs(wo,{className:"flex items-center gap-2",children:[h.jsx(Mo,{className:"w-5 h-5"}),o(s==="merchant"?"merchant.manageRestaurants":"merchant.manageSupervisorRestaurants")]}),h.jsxs(pl,{children:[o("merchant.assignRestaurantsTo",{name:n}),s==="merchant"&&h.jsx("span",{className:"block mt-1 text-amber-600 dark:text-amber-500 font-medium",children:o("merchant.merchantOnlyOne")}),h.jsx("span",{className:"block mt-1 text-muted-foreground text-xs",children:o("merchant.saveReminder")})]})]}),K?h.jsx("div",{className:"flex justify-center py-8",children:h.jsx(aa,{className:"w-6 h-6 animate-spin text-primary"})}):h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"relative mb-4",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),h.jsx(cr,{placeholder:o("merchant.searchRestaurants"),value:A,onChange:ne=>O(ne.target.value),className:"pl-9"})]}),h.jsx(Ov,{className:"h-[400px] pr-4",children:h.jsx("div",{className:"space-y-3",children:te==null?void 0:te.map(ne=>{const ae=w.includes(ne.id),re=m(ne);return h.jsxs("div",{className:"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-all cursor-pointer",onClick:()=>$(ne.id),children:[s==="supervisor"?h.jsx(tl,{checked:ae,className:"mt-1"}):h.jsx("input",{type:"radio",checked:ae,onChange:()=>{},className:"mt-1 h-4 w-4 text-primary focus:ring-primary"}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[h.jsx("p",{className:"text-sm font-medium leading-none",children:re.name}),ae&&h.jsx(tn,{variant:"secondary",className:"text-xs",children:o("merchant.selected")})]}),h.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[h.jsx(ga,{className:"w-3 h-3"}),h.jsx("span",{className:"line-clamp-1",children:ne.address})]}),ne.type&&ne.type.length>0&&h.jsx("div",{className:"flex gap-1 mt-2",children:ne.type.slice(0,2).map((ee,ie)=>h.jsx(tn,{variant:"outline",className:"text-xs",children:ee},ie))})]})]},ne.id)})})}),h.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[h.jsx("div",{className:"text-sm text-muted-foreground",children:s==="merchant"?o("merchant.selectedCountOne",{count:w.length}):o("merchant.selectedCountMulti",{count:w.length})}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Mt,{variant:"outline",onClick:()=>t(!1),disabled:B.isPending,children:o("common.cancel")}),h.jsxs(Mt,{onClick:W,disabled:B.isPending,children:[B.isPending&&h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}),o("common.save")]})]})]})]})]})})},Htt=({merchantId:e,merchantName:t,trigger:r})=>{ei();const{toast:n}=Ii(),s=Ri(),[o,d]=V.useState(!1),[i,m]=V.useState(""),{data:y=[],isLoading:S}=ci({queryKey:["supervisors"],queryFn:async()=>{const{data:R,error:M}=await Ct.from("user_roles").select("user_id").eq("role","supervisor");if(M)throw M;const F=R.map(W=>W.user_id);if(F.length===0)return[];const{data:B,error:$}=await Ct.from("profiles").select("id, display_name").in("id",F);if($)throw $;return B},enabled:o}),{data:w=[]}=ci({queryKey:["merchant-restaurants",e],queryFn:async()=>{const{data:R,error:M}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e);if(M)throw M;return R.map(F=>F.restaurant_id)},enabled:o}),{data:T=[]}=ci({queryKey:["merchant-supervisors",e],queryFn:async()=>{if(w.length===0)return[];const{data:R,error:M}=await Ct.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",w).neq("user_id",e);if(M)throw M;const F=[...new Set(R.map(ne=>ne.user_id))];if(F.length===0)return[];const{data:B,error:$}=await Ct.from("user_roles").select("user_id").in("user_id",F).eq("role","supervisor");if($)throw $;const W=B.map(ne=>ne.user_id);if(W.length===0)return[];const{data:K,error:te}=await Ct.from("profiles").select("id, display_name").in("id",W);if(te)throw te;return K},enabled:o&&w.length>0}),A=Gi({mutationFn:async R=>{if(w.length===0)throw new Error("");const M=w.map(B=>({user_id:R,restaurant_id:B})),{error:F}=await Ct.from("merchant_restaurants").upsert(M,{onConflict:"user_id,restaurant_id"});if(F)throw F},onSuccess:()=>{n({title:"",description:""}),s.invalidateQueries({queryKey:["merchant-supervisors"]}),m(""),d(!1)},onError:R=>{n({title:"",description:R.message,variant:"destructive"})}}),O=Gi({mutationFn:async R=>{const{error:M}=await Ct.from("merchant_restaurants").delete().eq("user_id",R).in("restaurant_id",w);if(M)throw M},onSuccess:()=>{n({title:"",description:""}),s.invalidateQueries({queryKey:["merchant-supervisors"]})},onError:R=>{n({title:"",description:R.message,variant:"destructive"})}}),P=()=>{i&&A.mutate(i)},N=R=>{O.mutate(R)};return h.jsxs(Lo,{open:o,onOpenChange:d,children:[h.jsx(tf,{asChild:!0,children:r||h.jsxs(Mt,{variant:"outline",size:"sm",children:[h.jsx(IQ,{className:"w-4 h-4 mr-2"}),""]})}),h.jsxs(xo,{className:"max-w-md",children:[h.jsxs(bo,{children:[h.jsxs(wo,{className:"flex items-center gap-2",children:[h.jsx(Lc,{className:"w-5 h-5"}),""]}),h.jsxs(pl,{children:[" ",h.jsx("strong",{children:t})," "]})]}),h.jsxs("div",{className:"space-y-4",children:[T.length>0&&h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium",children:""}),h.jsx("div",{className:"space-y-2",children:T.map(R=>h.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Lc,{className:"w-4 h-4 text-blue-500"}),h.jsx("span",{className:"text-sm",children:R.display_name})]}),h.jsx(Mt,{variant:"ghost",size:"sm",onClick:()=>N(R.id),disabled:O.isPending,children:""})]},R.id))})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium",children:""}),h.jsxs(Aa,{value:i,onValueChange:m,children:[h.jsx(ya,{children:h.jsx(Ca,{placeholder:""})}),h.jsx(va,{children:S?h.jsx("div",{className:"p-2 text-center",children:h.jsx(aa,{className:"w-4 h-4 animate-spin mx-auto"})}):y.length===0?h.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:""}):y.filter(R=>!T.find(M=>M.id===R.id)).map(R=>h.jsx(En,{value:R.id,children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Lc,{className:"w-4 h-4 text-blue-500"}),R.display_name]})},R.id))})]})]}),w.length===0&&h.jsx(tn,{variant:"secondary",className:"w-full justify-center",children:""}),h.jsxs("div",{className:"flex gap-2 justify-end",children:[h.jsx(Mt,{variant:"outline",onClick:()=>d(!1),children:""}),h.jsx(Mt,{onClick:P,disabled:!i||A.isPending||w.length===0,children:A.isPending?h.jsxs(h.Fragment,{children:[h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):""})]})]})]})]})},Gtt=({merchant:e,trigger:t})=>{const{t:r}=ei(),[n,s]=V.useState(!1),[o,d]=V.useState(e.display_name),[i,m]=V.useState(e.phone||""),[y,S]=V.useState(null),[w,T]=V.useState(e.avatar_url||""),A=jIe(),O=PIe(),P=R=>{var F;const M=(F=R.target.files)==null?void 0:F[0];if(M){if(M.size>2*1024*1024)return;S(M),T(URL.createObjectURL(M))}},N=async()=>{let R=e.avatar_url;if(y){const M=await O.mutateAsync({file:y,userId:e.id});M&&(R=M)}await A.mutateAsync({userId:e.id,display_name:o,phone:i||void 0,avatar_url:R||void 0}),s(!1)};return h.jsxs(Lo,{open:n,onOpenChange:s,children:[h.jsx(tf,{asChild:!0,children:t||h.jsxs(Mt,{variant:"outline",size:"sm",children:[h.jsx(_2,{className:"w-4 h-4 mr-2"}),""]})}),h.jsxs(xo,{className:"max-w-[90vw] sm:max-w-[425px]",children:[h.jsxs(bo,{children:[h.jsx(wo,{children:""}),h.jsx(pl,{children:""})]}),h.jsxs("div",{className:"space-y-4 py-4",children:[h.jsxs("div",{className:"flex flex-col items-center gap-4",children:[h.jsxs(qh,{className:"w-24 h-24",children:[h.jsx(Hh,{src:w}),h.jsx(Gh,{children:o==null?void 0:o.charAt(0).toUpperCase()})]}),h.jsxs("div",{children:[h.jsx(cr,{type:"file",accept:"image/*",onChange:P,className:"hidden",id:"avatar-upload"}),h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{var R;return(R=document.getElementById("avatar-upload"))==null?void 0:R.click()},children:[h.jsx(Lh,{className:"w-4 h-4 mr-2"}),r("profile.uploadAvatar")]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"displayName",children:r("profile.displayName")}),h.jsx(cr,{id:"displayName",value:o,onChange:R=>d(R.target.value),placeholder:r("profile.displayName")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"phone",children:r("profile.phone")}),h.jsx(cr,{id:"phone",value:i,onChange:R=>m(R.target.value),placeholder:r("profile.phone")})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(Mt,{variant:"outline",onClick:()=>s(!1),children:r("common.cancel")}),h.jsx(Mt,{onClick:N,disabled:A.isPending||O.isPending,children:A.isPending||O.isPending?h.jsxs(h.Fragment,{children:[h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}),r("common.loading")]}):r("common.save")})]})]})]})};function uU(e,t){if(!e||e.length===0)return t.join(",");const r=[];r.push(t.join(","));for(const n of e){const s=t.map(o=>{const d=n[o];if(d==null)return"";if(Array.isArray(d))return`"${d.join(", ")}"`;if(typeof d=="object")return`"${JSON.stringify(d)}"`;const i=String(d);return i.includes(",")||i.includes('"')||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i});r.push(s.join(","))}return r.join(`
`)}function dU(e,t){const r="\uFEFF",n=new Blob([r+e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(s.download!==void 0){const o=URL.createObjectURL(n);s.setAttribute("href",o),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}}function Wtt(e){const t=["id","display_name","phone","created_at","roles"],r=e.map(o=>{var d;return{id:o.id,display_name:o.display_name,phone:o.phone||"",created_at:new Date(o.created_at).toLocaleDateString(),roles:((d=o.roles)==null?void 0:d.join(", "))||"user"}}),n=uU(r,t),s=`users_export_${new Date().toISOString().split("T")[0]}.csv`;dU(n,s)}function Ktt(e){const t=["id","name","name_en","name_pt","type","type_en","type_pt","address","phone","website_url","rating","lat","lng","created_at"],r=e.map(o=>({id:o.id,name:o.name,name_en:o.name_en||"",name_pt:o.name_pt||"",type:o.type,type_en:o.type_en||"",type_pt:o.type_pt||"",address:o.address,phone:o.phone||"",website_url:o.website_url||"",rating:o.rating||0,lat:o.lat,lng:o.lng,created_at:new Date(o.created_at).toLocaleDateString()})),n=uU(r,t),s=`restaurants_export_${new Date().toISOString().split("T")[0]}.csv`;dU(n,s)}function Ztt(e){const t=["id","title_en","title_zh","title_pt","start_date","end_date","repeat_mode","pinned","sort_order","created_at"],r=e.map(o=>({id:o.id,title_en:o.title_en,title_zh:o.title_zh,title_pt:o.title_pt,start_date:new Date(o.start_date).toLocaleDateString(),end_date:o.end_date?new Date(o.end_date).toLocaleDateString():"",repeat_mode:o.repeat_mode||"none",pinned:o.pinned?"Yes":"No",sort_order:o.sort_order||0,created_at:new Date(o.created_at).toLocaleDateString()})),n=uU(r,t),s=`activities_export_${new Date().toISOString().split("T")[0]}.csv`;dU(n,s)}const Xtt=()=>{const{t:e}=ei(),{toast:t}=Ii(),{isSupervisor:r,isAdmin:n}=_c(),{data:s,isLoading:o}=EIe(),d=TIe(),i=LIe(),m=BIe(),[y,S]=V.useState(null),[w,T]=V.useState(""),[A,O]=V.useState([]),[P,N]=V.useState("user"),[R,M]=V.useState(""),[F,B]=V.useState("all"),[$,W]=V.useState({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),[K,te]=V.useState({open:!1,merchantId:"",merchantName:"",userRole:"merchant"}),ne=["user","merchant","supervisor","admin"],ae=r?ne.filter(pe=>pe==="user"||pe==="merchant"):ne,re=V.useMemo(()=>s?{total:s.length,admins:s.filter(pe=>pe.role==="admin").length,supervisors:s.filter(pe=>pe.role==="supervisor").length,merchants:s.filter(pe=>pe.role==="merchant").length,regularUsers:s.filter(pe=>pe.role==="user").length}:{total:0,admins:0,supervisors:0,merchants:0,regularUsers:0},[s]),ee=V.useMemo(()=>s?s.filter(pe=>{var We;const Oe=R===""||pe.display_name.toLowerCase().includes(R.toLowerCase())||((We=pe.phone)==null?void 0:We.toLowerCase().includes(R.toLowerCase())),Xe=F==="all"||pe.role===F;return Oe&&Xe}):[],[s,R,F]),ie=()=>{if(!s||s.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}Wtt(s),t({title:e("common.success"),description:e("admin.exportSuccess")})},de=pe=>{O(Oe=>Oe.includes(pe)?Oe.filter(Xe=>Xe!==pe):[...Oe,pe])},be=()=>{A.length===(ee==null?void 0:ee.length)?O([]):O((ee==null?void 0:ee.map(pe=>pe.id))||[])},Se=()=>{A.length!==0&&(i.mutate(A),O([]))},Ae=()=>{A.length!==0&&(m.mutate({userIds:A,role:P}),O([]))},xe=()=>{$.userId&&$.newRole&&d.mutate({userId:$.userId,role:$.newRole},{onSuccess:()=>{W({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),S(null),T("")}})},me=(pe,Oe,Xe,We)=>{W({open:!0,userId:pe,userName:Oe,currentRole:Xe,newRole:We})},Ce=pe=>{switch(pe){case"admin":return"bg-primary text-primary-foreground hover:bg-primary/90";case"supervisor":return"bg-blue-500 text-white hover:bg-blue-600";case"merchant":return"bg-emerald-500 text-white hover:bg-emerald-600";default:return"bg-muted text-muted-foreground hover:bg-muted/80"}},ge=pe=>{switch(pe){case"admin":return h.jsx(Lc,{className:"h-3.5 w-3.5"});case"supervisor":return h.jsx(Lc,{className:"h-3.5 w-3.5"});case"merchant":return h.jsx(lE,{className:"h-3.5 w-3.5"});default:return h.jsx(Bc,{className:"h-3.5 w-3.5"})}};return o?h.jsx(ml,{children:h.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:h.jsxs("div",{className:"text-center space-y-3",children:[h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),h.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})]})})}):h.jsx(ml,{children:h.jsxs("div",{className:"space-y-6",children:[h.jsx("div",{children:h.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[h.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:h.jsx(IQ,{className:"h-6 w-6 text-primary"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:e("admin.userManagement")}),h.jsx("p",{className:"text-muted-foreground",children:e("admin.manageUserRoles")})]})]})}),r?h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.jsx(kr,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsx("p",{className:"text-2xl font-bold",children:re.merchants})]}),h.jsx(lE,{className:"h-8 w-8 text-emerald-500"})]})})})}):h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[h.jsx(kr,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsx("p",{className:"text-2xl font-bold",children:re.total})]}),h.jsx(Bc,{className:"h-8 w-8 text-primary/60"})]})})}),h.jsx(kr,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 dark:from-red-950/20 dark:to-red-900/20 dark:border-red-900/30",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsx("p",{className:"text-2xl font-bold",children:re.admins})]}),h.jsx(Lc,{className:"h-8 w-8 text-red-500"})]})})}),h.jsx(kr,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 dark:from-blue-950/20 dark:to-blue-900/20 dark:border-blue-900/30",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsx("p",{className:"text-2xl font-bold",children:re.supervisors})]}),h.jsx(Lc,{className:"h-8 w-8 text-blue-500"})]})})}),h.jsx(kr,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsx("p",{className:"text-2xl font-bold",children:re.merchants})]}),h.jsx(lE,{className:"h-8 w-8 text-emerald-500"})]})})}),h.jsx(kr,{className:"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 dark:from-gray-950/20 dark:to-gray-900/20 dark:border-gray-900/30",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsx("p",{className:"text-2xl font-bold",children:re.regularUsers})]}),h.jsx(Bc,{className:"h-8 w-8 text-gray-500"})]})})})]}),h.jsx(kr,{children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[h.jsx("div",{className:"flex-1",children:h.jsxs("div",{className:"relative",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(cr,{placeholder:"...",value:R,onChange:pe=>M(pe.target.value),className:"pl-10 pr-10"}),R&&h.jsx(Mt,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>M(""),children:h.jsx(wu,{className:"h-4 w-4"})})]})}),!r&&h.jsxs(Aa,{value:F,onValueChange:B,children:[h.jsxs(ya,{className:"w-full md:w-[200px]",children:[h.jsx(CB,{className:"h-4 w-4 mr-2"}),h.jsx(Ca,{placeholder:""})]}),h.jsxs(va,{children:[h.jsx(En,{value:"all",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Bc,{className:"h-4 w-4"}),""]})}),h.jsx(En,{value:"admin",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Lc,{className:"h-4 w-4 text-red-500"}),""]})}),h.jsx(En,{value:"supervisor",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Lc,{className:"h-4 w-4 text-blue-500"}),""]})}),h.jsx(En,{value:"merchant",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(lE,{className:"h-4 w-4 text-emerald-500"}),""]})}),h.jsx(En,{value:"user",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Bc,{className:"h-4 w-4 text-gray-500"}),""]})})]})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Vtt,{trigger:h.jsxs(Mt,{variant:"default",size:"default",children:[h.jsx(OE,{className:"mr-2 h-4 w-4"}),h.jsx("span",{className:"hidden sm:inline",children:e("admin.createUser")}),h.jsx("span",{className:"sm:hidden",children:e("admin.create")})]})}),h.jsxs(Mt,{variant:"outline",onClick:ie,children:[h.jsx(nN,{className:"h-4 w-4 md:mr-2"}),h.jsx("span",{className:"hidden md:inline",children:""})]})]})]})})}),A.length>0&&h.jsx(kr,{className:"border-primary/50 bg-primary/5",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(tl,{checked:!0,onCheckedChange:()=>O([])}),h.jsxs("span",{className:"font-semibold",children:[" ",A.length," "]})]}),h.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>O([]),children:[h.jsx(wu,{className:"h-4 w-4 mr-1"}),""]})]}),h.jsx(Yo,{}),h.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[h.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:""}),h.jsxs(Aa,{value:P,onValueChange:pe=>N(pe),children:[h.jsx(ya,{className:"w-full sm:w-[160px]",children:h.jsx(Ca,{})}),h.jsx(va,{children:ae.map(pe=>h.jsx(En,{value:pe,children:h.jsxs("div",{className:"flex items-center gap-2",children:[ge(pe),h.jsx("span",{className:"capitalize",children:pe})]})},pe))})]}),h.jsxs(Mt,{onClick:Ae,size:"default",children:[h.jsx(OE,{className:"mr-2 h-4 w-4"}),""]})]}),h.jsxs(Io,{children:[h.jsx(_b,{asChild:!0,children:h.jsxs(Mt,{variant:"destructive",size:"default",children:[h.jsx(Yh,{className:"mr-2 h-4 w-4"}),""]})}),h.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:""}),h.jsxs(po,{children:[" ",A.length," "]})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:""}),h.jsx(to,{onClick:Se,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:""})]})]})]})]})]})})}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(tl,{checked:A.length===(ee==null?void 0:ee.length)&&ee.length>0,onCheckedChange:be}),h.jsx("span",{className:"font-semibold",children:""})]}),h.jsxs(tn,{variant:"secondary",className:"text-sm font-normal",children:[" ",ee==null?void 0:ee.length," / ",(s==null?void 0:s.length)||0," "]})]}),ee&&ee.length>0?h.jsx("div",{className:"grid gap-4",children:ee.map(pe=>{var Oe;return h.jsx(kr,{className:"hover:shadow-lg transition-all duration-200 border-l-4 border-l-transparent hover:border-l-primary",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4",children:[h.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[h.jsx(tl,{checked:A.includes(pe.id),onCheckedChange:()=>de(pe.id)}),h.jsxs(qh,{className:"h-16 w-16 border-2 border-border",children:[h.jsx(Hh,{src:pe.avatar_url||""}),h.jsx(Gh,{className:"text-lg font-semibold bg-primary/10 text-primary",children:((Oe=pe.display_name)==null?void 0:Oe.charAt(0).toUpperCase())||"U"})]}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("h3",{className:"font-bold text-lg truncate",children:pe.display_name}),h.jsx("p",{className:"text-sm text-muted-foreground truncate",children:pe.phone||""})]})]}),h.jsxs(tn,{className:`${Ce(pe.role)} px-3 py-1.5 font-medium`,children:[ge(pe.role),h.jsx("span",{className:"ml-1.5 capitalize",children:pe.role})]})]}),h.jsx(Yo,{}),h.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[h.jsxs("div",{className:"flex-1",children:[h.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:""}),h.jsxs(Aa,{value:y===pe.id?w:"",onValueChange:Xe=>{S(pe.id),T(Xe)},children:[h.jsx(ya,{className:"w-full",children:h.jsx(Ca,{placeholder:"..."})}),h.jsx(va,{children:ae.filter(Xe=>Xe!==pe.role).map(Xe=>h.jsx(En,{value:Xe,children:h.jsxs("div",{className:"flex items-center gap-2",children:[ge(Xe),h.jsx("span",{className:"capitalize",children:Xe})]})},Xe))})]})]}),h.jsx("div",{className:"flex items-end",children:h.jsxs(Mt,{onClick:()=>{y===pe.id&&w&&me(pe.id,pe.display_name,pe.role,w)},disabled:y!==pe.id||!w,className:"w-full sm:w-auto",size:"default",children:[h.jsx(OE,{className:"mr-2 h-4 w-4"}),""]})})]}),r&&pe.role==="merchant"&&h.jsxs(h.Fragment,{children:[h.jsx(Yo,{}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),h.jsx(Gtt,{merchant:{id:pe.id,display_name:pe.display_name,phone:pe.phone,avatar_url:pe.avatar_url}})]})]}),(pe.role==="merchant"||pe.role==="supervisor")&&h.jsxs(h.Fragment,{children:[h.jsx(Yo,{}),h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:pe.role==="merchant"?"1":""})]}),h.jsxs(Mt,{variant:"outline",size:"default",onClick:()=>te({open:!0,merchantId:pe.id,merchantName:pe.display_name,userRole:pe.role}),children:[h.jsx(Mo,{className:"mr-2 h-4 w-4"}),""]})]}),n&&pe.role==="merchant"&&h.jsxs(h.Fragment,{children:[h.jsx(Yo,{}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),h.jsx(Htt,{merchantId:pe.id,merchantName:pe.display_name})]})]})]})]})]})})},pe.id)})}):h.jsx(kr,{children:h.jsx(Mr,{className:"pt-12 pb-12",children:h.jsxs("div",{className:"text-center space-y-3",children:[h.jsx(Bc,{className:"h-16 w-16 text-muted-foreground/50 mx-auto"}),h.jsx("h3",{className:"text-lg font-semibold",children:""}),h.jsx("p",{className:"text-muted-foreground",children:R||F!=="all"?"":""})]})})})]}),h.jsx(Io,{open:$.open,onOpenChange:pe=>{pe||W({open:!1,userId:"",userName:"",currentRole:"",newRole:""})},children:h.jsxs(co,{className:"max-w-[90vw] sm:max-w-[500px]",children:[h.jsxs(uo,{children:[h.jsxs(fo,{className:"flex items-center gap-2",children:[h.jsx(Lc,{className:"h-5 w-5 text-primary"}),""]}),h.jsxs(po,{className:"space-y-4 pt-4",children:[h.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsx("span",{className:"font-semibold text-foreground",children:$.userName})]}),h.jsx(Yo,{}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsxs(tn,{className:Ce($.currentRole),children:[ge($.currentRole),h.jsx("span",{className:"ml-1.5 capitalize",children:$.currentRole})]})]}),h.jsx("div",{className:"flex items-center justify-center",children:h.jsx("div",{className:"text-2xl text-primary",children:""})}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),h.jsxs(tn,{className:Ce($.newRole),children:[ge($.newRole),h.jsx("span",{className:"ml-1.5 capitalize",children:$.newRole})]})]})]}),$.newRole==="admin"&&h.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[h.jsx(Lc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),h.jsxs("div",{className:"space-y-1",children:[h.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),h.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),$.currentRole==="admin"&&h.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[h.jsx(Lc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),h.jsxs("div",{className:"space-y-1",children:[h.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),h.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),h.jsx("p",{className:"text-sm text-center text-muted-foreground",children:""})]})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:""}),h.jsx(to,{onClick:xe,className:"bg-primary",children:""})]})]})}),h.jsx(qtt,{open:K.open,onOpenChange:pe=>te({...K,open:pe}),merchantId:K.merchantId,merchantName:K.merchantName,userRole:K.userRole})]})})},cde=({className:e,...t})=>h.jsx("nav",{role:"navigation","aria-label":"pagination",className:fr("mx-auto flex w-full justify-center",e),...t});cde.displayName="Pagination";const ude=V.forwardRef(({className:e,...t},r)=>h.jsx("ul",{ref:r,className:fr("flex flex-row items-center gap-1",e),...t}));ude.displayName="PaginationContent";const _E=V.forwardRef(({className:e,...t},r)=>h.jsx("li",{ref:r,className:fr("",e),...t}));_E.displayName="PaginationItem";const $I=({className:e,isActive:t,size:r="icon",...n})=>h.jsx("a",{"aria-current":t?"page":void 0,className:fr(fb({variant:t?"outline":"ghost",size:r}),e),...n});$I.displayName="PaginationLink";const dde=({className:e,...t})=>h.jsxs($I,{"aria-label":"Go to previous page",size:"default",className:fr("gap-1 pl-2.5",e),...t,children:[h.jsx(eN,{className:"h-4 w-4"}),h.jsx("span",{children:"Previous"})]});dde.displayName="PaginationPrevious";const hde=({className:e,...t})=>h.jsxs($I,{"aria-label":"Go to next page",size:"default",className:fr("gap-1 pr-2.5",e),...t,children:[h.jsx("span",{children:"Next"}),h.jsx(tN,{className:"h-4 w-4"})]});hde.displayName="PaginationNext";const fde=({className:e,...t})=>h.jsxs("span",{"aria-hidden":!0,className:fr("flex h-9 w-9 items-center justify-center",e),...t,children:[h.jsx(TB,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"More pages"})]});fde.displayName="PaginationEllipsis";function Ytt({data:e,itemsPerPage:t=10}){const[r,n]=V.useState(1),s=(e==null?void 0:e.length)||0,o=Math.ceil(s/t),d=V.useMemo(()=>{if(!e)return[];const O=(r-1)*t,P=O+t;return e.slice(O,P)},[e,r,t]),i=O=>{const P=Math.max(1,Math.min(O,o));n(P),window.scrollTo({top:0,behavior:"smooth"})},m=()=>i(r+1),y=()=>i(r-1),S=r<o,w=r>1,T=s===0?0:(r-1)*t+1,A=Math.min(r*t,s);return{currentPage:r,totalPages:o,paginatedData:d,goToPage:i,nextPage:m,previousPage:y,canGoNext:S,canGoPrevious:w,startIndex:T,endIndex:A,totalItems:s}}const Jtt=()=>{const{t:e}=ei(),{toast:t}=Ii(),{isSupervisor:r}=_c(),{data:n,isLoading:s}=AIe(),{getLocalizedField:o}=xc(),d=DIe(),i=FIe(),m=$Ie(),[y,S]=V.useState([]),[w,T]=V.useState(""),[A,O]=V.useState("all"),P=V.useMemo(()=>{if(!n)return[];const Se=new Set;return n.forEach(Ae=>{const xe=o(Ae,"type");Array.isArray(xe)?xe.forEach(me=>Se.add(me)):xe&&Se.add(xe)}),Array.from(Se)},[n,o]),N=V.useMemo(()=>n?n.filter(Se=>{const Ae=w===""||o(Se,"name").toString().toLowerCase().includes(w.toLowerCase())||Se.address.toLowerCase().includes(w.toLowerCase()),xe=o(Se,"type"),me=A==="all"||(Array.isArray(xe)?xe.includes(A):xe===A);return Ae&&me}):[],[n,w,A,o]),{currentPage:R,totalPages:M,paginatedData:F,goToPage:B,nextPage:$,previousPage:W,canGoNext:K,canGoPrevious:te,startIndex:ne,endIndex:ae,totalItems:re}=Ytt({data:N,itemsPerPage:10}),ee=()=>{if(!n||n.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}Ktt(n),t({title:e("common.success"),description:e("admin.exportSuccess")})},ie=Se=>{S(Ae=>Ae.includes(Se)?Ae.filter(xe=>xe!==Se):[...Ae,Se])},de=()=>{y.length===(F==null?void 0:F.length)?S([]):S((F==null?void 0:F.map(Se=>Se.id))||[])},be=()=>{y.length!==0&&(i.mutate(y),S([]))};return s?h.jsx(ml,{children:h.jsx("div",{className:"text-center",children:e("common.loading")})}):h.jsx(ml,{children:h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.restaurantManagement")}),h.jsx("p",{className:"text-muted-foreground",children:e("admin.manageRestaurants")})]}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[h.jsxs(Mt,{variant:"outline",onClick:ee,className:"flex-1 sm:flex-initial",children:[h.jsx(nN,{className:"mr-2 h-4 w-4"}),h.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),h.jsx(PO,{trigger:h.jsxs(Mt,{className:"flex-1 sm:flex-initial",children:[h.jsx(ap,{className:"mr-2 h-4 w-4"}),e("admin.addRestaurant")]})})]})]}),h.jsx(kr,{children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex gap-4 flex-wrap",children:[h.jsx("div",{className:"flex-1 min-w-[200px]",children:h.jsxs("div",{className:"relative",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(cr,{placeholder:e("admin.searchRestaurants"),value:w,onChange:Se=>T(Se.target.value),className:"pl-9"})]})}),h.jsxs(Aa,{value:A,onValueChange:O,children:[h.jsx(ya,{className:"w-[180px]",children:h.jsx(Ca,{placeholder:e("admin.filterByType")})}),h.jsxs(va,{children:[h.jsx(En,{value:"all",children:e("admin.allTypes")}),P.map(Se=>h.jsx(En,{value:Se,children:Se},Se))]})]})]})})}),!r&&y.length>0&&h.jsx(kr,{className:"bg-muted/50",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[h.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:y.length})}),h.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[h.jsxs(Io,{children:[h.jsx(_b,{asChild:!0,children:h.jsxs(Mt,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[h.jsx(Yh,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),h.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:e("admin.confirmBatchDelete")}),h.jsx(po,{children:e("admin.batchDeleteWarning",{count:y.length})})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:e("common.cancel")}),h.jsx(to,{onClick:be,children:e("common.delete")})]})]})]}),h.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>S([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),h.jsxs("div",{className:"flex items-center justify-between pb-2 border-b",children:[h.jsx("div",{className:"flex items-center gap-2",children:!r&&h.jsxs(h.Fragment,{children:[h.jsx(tl,{checked:y.length===(F==null?void 0:F.length)&&F.length>0,onCheckedChange:de}),h.jsx("span",{className:"font-medium",children:e("admin.selectAll")})]})}),h.jsxs("span",{className:"text-sm text-muted-foreground",children:[e("admin.showing")," ",ne,"-",ae," ",e("admin.of")," ",re]})]}),h.jsx("div",{className:"grid gap-4",children:F==null?void 0:F.map(Se=>h.jsx(kr,{children:h.jsxs("div",{className:"flex flex-col md:flex-row",children:[h.jsx("div",{className:"p-4 flex items-start",children:!r&&h.jsx(tl,{checked:y.includes(Se.id),onCheckedChange:()=>ie(Se.id),className:"mt-1"})}),Se.image_url&&h.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden",children:h.jsx("img",{src:Se.image_url,alt:String(o(Se,"name")),className:"object-cover object-center w-full h-full"})}),h.jsxs("div",{className:"flex-1",children:[h.jsxs(Rn,{children:[h.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[h.jsx(Hn,{className:"text-lg md:text-xl",children:o(Se,"name")}),h.jsx("div",{className:"flex items-center gap-2",children:h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(Cl,{className:"h-4 w-4 fill-accent text-accent"}),h.jsx("span",{className:"font-medium",children:Se.rating||0})]})})]}),h.jsx(cs,{children:h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ga,{className:"h-3 w-3 flex-shrink-0"}),h.jsx("span",{className:"text-xs sm:text-sm",children:Se.address})]}),o(Se,"description")&&h.jsx("div",{className:`prose prose-sm max-w-none line-clamp-2\r
                              [&_p]:inline [&_p]:m-0\r
                              [&_strong]:font-semibold [&_strong]:text-foreground\r
                              [&_em]:italic\r
                              [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                              [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:o(Se,"description")}})]})})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:(Array.isArray(o(Se,"type"))?o(Se,"type"):[o(Se,"type")]).map((Ae,xe)=>h.jsx(tn,{children:Ae},xe))}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(yr,{htmlFor:`visible-${Se.id}`,className:"text-sm font-medium",children:""}),h.jsx("div",{className:"text-xs text-muted-foreground",children:Se.visible?"":""})]}),h.jsx(Tb,{id:`visible-${Se.id}`,checked:Se.visible??!0,onCheckedChange:Ae=>m.mutate({restaurantId:Se.id,visible:Ae})})]}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[h.jsx(Mt,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:h.jsx(Hi,{to:`/restaurant/${Se.id}`,state:{from:"admin"},children:e("admin.view")})}),h.jsx(PO,{restaurant:Se,trigger:h.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),!r&&h.jsxs(Io,{children:[h.jsx(_b,{asChild:!0,children:h.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),h.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:e("admin.confirmDelete")}),h.jsx(po,{children:e("admin.deleteRestaurantWarning")})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:e("common.cancel")}),h.jsx(to,{onClick:()=>d.mutate(Se.id),children:e("common.delete")})]})]})]})]})]})]})]})]})},Se.id))}),M>1&&h.jsx(cde,{className:"mt-6",children:h.jsxs(ude,{children:[h.jsx(_E,{children:h.jsx(dde,{onClick:W,className:te?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:M},(Se,Ae)=>Ae+1).map(Se=>Se===1||Se===M||Se>=R-1&&Se<=R+1?h.jsx(_E,{children:h.jsx($I,{onClick:()=>B(Se),isActive:R===Se,className:"cursor-pointer",children:Se})},Se):Se===R-2||Se===R+2?h.jsx(_E,{children:h.jsx(fde,{})},Se):null),h.jsx(_E,{children:h.jsx(hde,{onClick:$,className:K?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})})};var pi=function(){return pi=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},pi.apply(this,arguments)};function Qtt(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function pde(e,t,r){for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function X2(e){return e.mode==="multiple"}function Y2(e){return e.mode==="range"}function UI(e){return e.mode==="single"}var ert={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function trt(e,t){return Rs(e,"LLLL y",t)}function rrt(e,t){return Rs(e,"d",t)}function nrt(e,t){return Rs(e,"LLLL",t)}function irt(e){return"".concat(e)}function srt(e,t){return Rs(e,"cccccc",t)}function art(e,t){return Rs(e,"yyyy",t)}var ort=Object.freeze({__proto__:null,formatCaption:trt,formatDay:rrt,formatMonthCaption:nrt,formatWeekNumber:irt,formatWeekdayName:srt,formatYearCaption:art}),lrt=function(e,t,r){return Rs(e,"do MMMM (EEEE)",r)},crt=function(){return"Month: "},urt=function(){return"Go to next month"},drt=function(){return"Go to previous month"},hrt=function(e,t){return Rs(e,"cccc",t)},frt=function(e){return"Week n. ".concat(e)},prt=function(){return"Year: "},mrt=Object.freeze({__proto__:null,labelDay:lrt,labelMonthDropdown:crt,labelNext:urt,labelPrevious:drt,labelWeekNumber:frt,labelWeekday:hrt,labelYearDropdown:prt});function grt(){var e="buttons",t=ert,r=A5,n={},s={},o=1,d={},i=new Date;return{captionLayout:e,classNames:t,formatters:ort,labels:mrt,locale:r,modifiersClassNames:n,modifiers:s,numberOfMonths:o,styles:d,today:i,mode:"default"}}function yrt(e){var t=e.fromYear,r=e.toYear,n=e.fromMonth,s=e.toMonth,o=e.fromDate,d=e.toDate;return n?o=Kc(n):t&&(o=new Date(t,0,1)),s?d=kN(s):r&&(d=new Date(r,11,31)),{fromDate:o?fg(o):void 0,toDate:d?fg(d):void 0}}var mde=V.createContext(void 0);function vrt(e){var t,r=e.initialProps,n=grt(),s=yrt(r),o=s.fromDate,d=s.toDate,i=(t=r.captionLayout)!==null&&t!==void 0?t:n.captionLayout;i!=="buttons"&&(!o||!d)&&(i="buttons");var m;(UI(r)||X2(r)||Y2(r))&&(m=r.onSelect);var y=pi(pi(pi({},n),r),{captionLayout:i,classNames:pi(pi({},n.classNames),r.classNames),components:pi({},r.components),formatters:pi(pi({},n.formatters),r.formatters),fromDate:o,labels:pi(pi({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:pi(pi({},n.modifiers),r.modifiers),modifiersClassNames:pi(pi({},n.modifiersClassNames),r.modifiersClassNames),onSelect:m,styles:pi(pi({},n.styles),r.styles),toDate:d});return h.jsx(mde.Provider,{value:y,children:e.children})}function oa(){var e=V.useContext(mde);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function gde(e){var t=oa(),r=t.locale,n=t.classNames,s=t.styles,o=t.formatters.formatCaption;return h.jsx("div",{className:n.caption_label,style:s.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:r})})}function _rt(e){return h.jsx("svg",pi({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:h.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function yde(e){var t,r,n=e.onChange,s=e.value,o=e.children,d=e.caption,i=e.className,m=e.style,y=oa(),S=(r=(t=y.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:_rt;return h.jsxs("div",{className:i,style:m,children:[h.jsx("span",{className:y.classNames.vhidden,children:e["aria-label"]}),h.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:y.classNames.dropdown,style:y.styles.dropdown,value:s,onChange:n,children:o}),h.jsxs("div",{className:y.classNames.caption_label,style:y.styles.caption_label,"aria-hidden":"true",children:[d,h.jsx(S,{className:y.classNames.dropdown_icon,style:y.styles.dropdown_icon})]})]})}function xrt(e){var t,r=oa(),n=r.fromDate,s=r.toDate,o=r.styles,d=r.locale,i=r.formatters.formatMonthCaption,m=r.classNames,y=r.components,S=r.labels.labelMonthDropdown;if(!n)return h.jsx(h.Fragment,{});if(!s)return h.jsx(h.Fragment,{});var w=[];if(sPe(n,s))for(var T=Kc(n),A=n.getMonth();A<=s.getMonth();A++)w.push(XD(T,A));else for(var T=Kc(new Date),A=0;A<=11;A++)w.push(XD(T,A));var O=function(N){var R=Number(N.target.value),M=XD(Kc(e.displayMonth),R);e.onChange(M)},P=(t=y==null?void 0:y.Dropdown)!==null&&t!==void 0?t:yde;return h.jsx(P,{name:"months","aria-label":S(),className:m.dropdown_month,style:o.dropdown_month,onChange:O,value:e.displayMonth.getMonth(),caption:i(e.displayMonth,{locale:d}),children:w.map(function(N){return h.jsx("option",{value:N.getMonth(),children:i(N,{locale:d})},N.getMonth())})})}function brt(e){var t,r=e.displayMonth,n=oa(),s=n.fromDate,o=n.toDate,d=n.locale,i=n.styles,m=n.classNames,y=n.components,S=n.formatters.formatYearCaption,w=n.labels.labelYearDropdown,T=[];if(!s)return h.jsx(h.Fragment,{});if(!o)return h.jsx(h.Fragment,{});for(var A=s.getFullYear(),O=o.getFullYear(),P=A;P<=O;P++)T.push(wG(mie(new Date),P));var N=function(M){var F=wG(Kc(r),Number(M.target.value));e.onChange(F)},R=(t=y==null?void 0:y.Dropdown)!==null&&t!==void 0?t:yde;return h.jsx(R,{name:"years","aria-label":w(),className:m.dropdown_year,style:i.dropdown_year,onChange:N,value:r.getFullYear(),caption:S(r,{locale:d}),children:T.map(function(M){return h.jsx("option",{value:M.getFullYear(),children:S(M,{locale:d})},M.getFullYear())})})}function wrt(e,t){var r=V.useState(e),n=r[0],s=r[1],o=t===void 0?n:t;return[o,s]}function Srt(e){var t=e.month,r=e.defaultMonth,n=e.today,s=t||r||n||new Date,o=e.toDate,d=e.fromDate,i=e.numberOfMonths,m=i===void 0?1:i;if(o&&yb(o,s)<0){var y=-1*(m-1);s=Wd(o,y)}return d&&yb(s,d)<0&&(s=d),Kc(s)}function Ert(){var e=oa(),t=Srt(e),r=wrt(t,e.month),n=r[0],s=r[1],o=function(d){var i;if(!e.disableNavigation){var m=Kc(d);s(m),(i=e.onMonthChange)===null||i===void 0||i.call(e,m)}};return[n,o]}function Trt(e,t){for(var r=t.reverseMonths,n=t.numberOfMonths,s=Kc(e),o=Kc(Wd(s,n)),d=yb(o,s),i=[],m=0;m<d;m++){var y=Wd(s,m);i.push(y)}return r&&(i=i.reverse()),i}function Art(e,t){if(!t.disableNavigation){var r=t.toDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,d=n?o:1,i=Kc(e);if(!r)return Wd(i,d);var m=yb(r,e);if(!(m<o))return Wd(i,d)}}function Crt(e,t){if(!t.disableNavigation){var r=t.fromDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,d=n?o:1,i=Kc(e);if(!r)return Wd(i,-d);var m=yb(i,r);if(!(m<=0))return Wd(i,-d)}}var vde=V.createContext(void 0);function jrt(e){var t=oa(),r=Ert(),n=r[0],s=r[1],o=Trt(n,t),d=Art(n,t),i=Crt(n,t),m=function(w){return o.some(function(T){return C5(w,T)})},y=function(w,T){m(w)||(T&&bie(w,T)?s(Wd(w,1+t.numberOfMonths*-1)):s(w))},S={currentMonth:n,displayMonths:o,goToMonth:s,goToDate:y,previousMonth:i,nextMonth:d,isDateDisplayed:m};return h.jsx(vde.Provider,{value:S,children:e.children})}function J2(){var e=V.useContext(vde);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function mX(e){var t,r=oa(),n=r.classNames,s=r.styles,o=r.components,d=J2().goToMonth,i=function(S){d(Wd(S,e.displayIndex?-e.displayIndex:0))},m=(t=o==null?void 0:o.CaptionLabel)!==null&&t!==void 0?t:gde,y=h.jsx(m,{id:e.id,displayMonth:e.displayMonth});return h.jsxs("div",{className:n.caption_dropdowns,style:s.caption_dropdowns,children:[h.jsx("div",{className:n.vhidden,children:y}),h.jsx(xrt,{onChange:i,displayMonth:e.displayMonth}),h.jsx(brt,{onChange:i,displayMonth:e.displayMonth})]})}function Prt(e){return h.jsx("svg",pi({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:h.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Ort(e){return h.jsx("svg",pi({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:h.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Nk=V.forwardRef(function(e,t){var r=oa(),n=r.classNames,s=r.styles,o=[n.button_reset,n.button];e.className&&o.push(e.className);var d=o.join(" "),i=pi(pi({},s.button_reset),s.button);return e.style&&Object.assign(i,e.style),h.jsx("button",pi({},e,{ref:t,type:"button",className:d,style:i}))});function krt(e){var t,r,n=oa(),s=n.dir,o=n.locale,d=n.classNames,i=n.styles,m=n.labels,y=m.labelPrevious,S=m.labelNext,w=n.components;if(!e.nextMonth&&!e.previousMonth)return h.jsx(h.Fragment,{});var T=y(e.previousMonth,{locale:o}),A=[d.nav_button,d.nav_button_previous].join(" "),O=S(e.nextMonth,{locale:o}),P=[d.nav_button,d.nav_button_next].join(" "),N=(t=w==null?void 0:w.IconRight)!==null&&t!==void 0?t:Ort,R=(r=w==null?void 0:w.IconLeft)!==null&&r!==void 0?r:Prt;return h.jsxs("div",{className:d.nav,style:i.nav,children:[!e.hidePrevious&&h.jsx(Nk,{name:"previous-month","aria-label":T,className:A,style:i.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:s==="rtl"?h.jsx(N,{className:d.nav_icon,style:i.nav_icon}):h.jsx(R,{className:d.nav_icon,style:i.nav_icon})}),!e.hideNext&&h.jsx(Nk,{name:"next-month","aria-label":O,className:P,style:i.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:s==="rtl"?h.jsx(R,{className:d.nav_icon,style:i.nav_icon}):h.jsx(N,{className:d.nav_icon,style:i.nav_icon})})]})}function gX(e){var t=oa().numberOfMonths,r=J2(),n=r.previousMonth,s=r.nextMonth,o=r.goToMonth,d=r.displayMonths,i=d.findIndex(function(O){return C5(e.displayMonth,O)}),m=i===0,y=i===d.length-1,S=t>1&&(m||!y),w=t>1&&(y||!m),T=function(){n&&o(n)},A=function(){s&&o(s)};return h.jsx(krt,{displayMonth:e.displayMonth,hideNext:S,hidePrevious:w,nextMonth:s,previousMonth:n,onPreviousClick:T,onNextClick:A})}function Nrt(e){var t,r=oa(),n=r.classNames,s=r.disableNavigation,o=r.styles,d=r.captionLayout,i=r.components,m=(t=i==null?void 0:i.CaptionLabel)!==null&&t!==void 0?t:gde,y;return s?y=h.jsx(m,{id:e.id,displayMonth:e.displayMonth}):d==="dropdown"?y=h.jsx(mX,{displayMonth:e.displayMonth,id:e.id}):d==="dropdown-buttons"?y=h.jsxs(h.Fragment,{children:[h.jsx(mX,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),h.jsx(gX,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):y=h.jsxs(h.Fragment,{children:[h.jsx(m,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),h.jsx(gX,{displayMonth:e.displayMonth,id:e.id})]}),h.jsx("div",{className:n.caption,style:o.caption,children:y})}function Irt(e){var t=oa(),r=t.footer,n=t.styles,s=t.classNames.tfoot;return r?h.jsx("tfoot",{className:s,style:n.tfoot,children:h.jsx("tr",{children:h.jsx("td",{colSpan:8,children:r})})}):h.jsx(h.Fragment,{})}function Rrt(e,t,r){for(var n=r?kv(new Date):Wh(new Date,{locale:e,weekStartsOn:t}),s=[],o=0;o<7;o++){var d=cc(n,o);s.push(d)}return s}function Mrt(){var e=oa(),t=e.classNames,r=e.styles,n=e.showWeekNumber,s=e.locale,o=e.weekStartsOn,d=e.ISOWeek,i=e.formatters.formatWeekdayName,m=e.labels.labelWeekday,y=Rrt(s,o,d);return h.jsxs("tr",{style:r.head_row,className:t.head_row,children:[n&&h.jsx("td",{style:r.head_cell,className:t.head_cell}),y.map(function(S,w){return h.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":m(S,{locale:s}),children:i(S,{locale:s})},w)})]})}function Drt(){var e,t=oa(),r=t.classNames,n=t.styles,s=t.components,o=(e=s==null?void 0:s.HeadRow)!==null&&e!==void 0?e:Mrt;return h.jsx("thead",{style:n.head,className:r.head,children:h.jsx(o,{})})}function Lrt(e){var t=oa(),r=t.locale,n=t.formatters.formatDay;return h.jsx(h.Fragment,{children:n(e.date,{locale:r})})}var hU=V.createContext(void 0);function Frt(e){if(!X2(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return h.jsx(hU.Provider,{value:t,children:e.children})}return h.jsx(zrt,{initialProps:e.initialProps,children:e.children})}function zrt(e){var t=e.initialProps,r=e.children,n=t.selected,s=t.min,o=t.max,d=function(y,S,w){var T,A;(T=t.onDayClick)===null||T===void 0||T.call(t,y,S,w);var O=!!(S.selected&&s&&(n==null?void 0:n.length)===s);if(!O){var P=!!(!S.selected&&o&&(n==null?void 0:n.length)===o);if(!P){var N=n?pde([],n):[];if(S.selected){var R=N.findIndex(function(M){return Vc(y,M)});N.splice(R,1)}else N.push(y);(A=t.onSelect)===null||A===void 0||A.call(t,N,y,S,w)}}},i={disabled:[]};n&&i.disabled.push(function(y){var S=o&&n.length>o-1,w=n.some(function(T){return Vc(T,y)});return!!(S&&!w)});var m={selected:n,onDayClick:d,modifiers:i};return h.jsx(hU.Provider,{value:m,children:r})}function fU(){var e=V.useContext(hU);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function Brt(e,t){var r=t||{},n=r.from,s=r.to;return n&&s?Vc(s,e)&&Vc(n,e)?void 0:Vc(s,e)?{from:s,to:void 0}:Vc(n,e)?void 0:TF(n,e)?{from:e,to:s}:{from:n,to:e}:s?TF(e,s)?{from:s,to:e}:{from:e,to:s}:n?bie(e,n)?{from:e,to:n}:{from:n,to:e}:{from:e,to:void 0}}var pU=V.createContext(void 0);function $rt(e){if(!Y2(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return h.jsx(pU.Provider,{value:t,children:e.children})}return h.jsx(Urt,{initialProps:e.initialProps,children:e.children})}function Urt(e){var t=e.initialProps,r=e.children,n=t.selected,s=n||{},o=s.from,d=s.to,i=t.min,m=t.max,y=function(A,O,P){var N,R;(N=t.onDayClick)===null||N===void 0||N.call(t,A,O,P);var M=Brt(A,n);(R=t.onSelect)===null||R===void 0||R.call(t,M,A,O,P)},S={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(S.range_start=[o],d?(S.range_end=[d],Vc(o,d)||(S.range_middle=[{after:o,before:d}])):S.range_end=[o]):d&&(S.range_start=[d],S.range_end=[d]),i&&(o&&!d&&S.disabled.push({after:cP(o,i-1),before:cc(o,i-1)}),o&&d&&S.disabled.push({after:o,before:cc(o,i-1)}),!o&&d&&S.disabled.push({after:cP(d,i-1),before:cc(d,i-1)})),m){if(o&&!d&&(S.disabled.push({before:cc(o,-m+1)}),S.disabled.push({after:cc(o,m-1)})),o&&d){var w=Ph(d,o)+1,T=m-w;S.disabled.push({before:cP(o,T)}),S.disabled.push({after:cc(d,T)})}!o&&d&&(S.disabled.push({before:cc(d,-m+1)}),S.disabled.push({after:cc(d,m-1)}))}return h.jsx(pU.Provider,{value:{selected:n,onDayClick:y,modifiers:S},children:r})}function mU(){var e=V.useContext(pU);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function mP(e){return Array.isArray(e)?pde([],e):e!==void 0?[e]:[]}function Vrt(e){var t={};return Object.entries(e).forEach(function(r){var n=r[0],s=r[1];t[n]=mP(s)}),t}var Kd;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Kd||(Kd={}));var qrt=Kd.Selected,Nf=Kd.Disabled,Hrt=Kd.Hidden,Grt=Kd.Today,PL=Kd.RangeEnd,OL=Kd.RangeMiddle,kL=Kd.RangeStart,Wrt=Kd.Outside;function Krt(e,t,r){var n,s=(n={},n[qrt]=mP(e.selected),n[Nf]=mP(e.disabled),n[Hrt]=mP(e.hidden),n[Grt]=[e.today],n[PL]=[],n[OL]=[],n[kL]=[],n[Wrt]=[],n);return e.fromDate&&s[Nf].push({before:e.fromDate}),e.toDate&&s[Nf].push({after:e.toDate}),X2(e)?s[Nf]=s[Nf].concat(t.modifiers[Nf]):Y2(e)&&(s[Nf]=s[Nf].concat(r.modifiers[Nf]),s[kL]=r.modifiers[kL],s[OL]=r.modifiers[OL],s[PL]=r.modifiers[PL]),s}var _de=V.createContext(void 0);function Zrt(e){var t=oa(),r=fU(),n=mU(),s=Krt(t,r,n),o=Vrt(t.modifiers),d=pi(pi({},s),o);return h.jsx(_de.Provider,{value:d,children:e.children})}function xde(){var e=V.useContext(_de);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Xrt(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function Yrt(e){return!!(e&&typeof e=="object"&&"from"in e)}function Jrt(e){return!!(e&&typeof e=="object"&&"after"in e)}function Qrt(e){return!!(e&&typeof e=="object"&&"before"in e)}function ent(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function tnt(e,t){var r,n=t.from,s=t.to;if(n&&s){var o=Ph(s,n)<0;o&&(r=[s,n],n=r[0],s=r[1]);var d=Ph(e,n)>=0&&Ph(s,e)>=0;return d}return s?Vc(s,e):n?Vc(n,e):!1}function rnt(e){return E5(e)}function nnt(e){return Array.isArray(e)&&e.every(E5)}function int(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(rnt(r))return Vc(e,r);if(nnt(r))return r.includes(e);if(Yrt(r))return tnt(e,r);if(ent(r))return r.dayOfWeek.includes(e.getDay());if(Xrt(r)){var n=Ph(r.before,e),s=Ph(r.after,e),o=n>0,d=s<0,i=TF(r.before,r.after);return i?d&&o:o||d}return Jrt(r)?Ph(e,r.after)>0:Qrt(r)?Ph(r.before,e)>0:typeof r=="function"?r(e):!1})}function gU(e,t,r){var n=Object.keys(t).reduce(function(o,d){var i=t[d];return int(e,i)&&o.push(d),o},[]),s={};return n.forEach(function(o){return s[o]=!0}),r&&!C5(e,r)&&(s.outside=!0),s}function snt(e,t){for(var r=Kc(e[0]),n=kN(e[e.length-1]),s,o,d=r;d<=n;){var i=gU(d,t),m=!i.disabled&&!i.hidden;if(!m){d=cc(d,1);continue}if(i.selected)return d;i.today&&!o&&(o=d),s||(s=d),d=cc(d,1)}return o||s}var ant=365;function bde(e,t){var r=t.moveBy,n=t.direction,s=t.context,o=t.modifiers,d=t.retry,i=d===void 0?{count:0,lastFocused:e}:d,m=s.weekStartsOn,y=s.fromDate,S=s.toDate,w=s.locale,T={day:cc,week:EF,month:Wd,year:WCe,startOfWeek:function(N){return s.ISOWeek?kv(N):Wh(N,{locale:w,weekStartsOn:m})},endOfWeek:function(N){return s.ISOWeek?gie(N):T5(N,{locale:w,weekStartsOn:m})}},A=T[r](e,n==="after"?1:-1);n==="before"&&y?A=KCe([y,A]):n==="after"&&S&&(A=ZCe([S,A]));var O=!0;if(o){var P=gU(A,o);O=!P.disabled&&!P.hidden}return O?A:i.count>ant?i.lastFocused:bde(A,{moveBy:r,direction:n,context:s,modifiers:o,retry:pi(pi({},i),{count:i.count+1})})}var wde=V.createContext(void 0);function ont(e){var t=J2(),r=xde(),n=V.useState(),s=n[0],o=n[1],d=V.useState(),i=d[0],m=d[1],y=snt(t.displayMonths,r),S=s??(i&&t.isDateDisplayed(i))?i:y,w=function(){m(s),o(void 0)},T=function(N){o(N)},A=oa(),O=function(N,R){if(s){var M=bde(s,{moveBy:N,direction:R,context:A,modifiers:r});Vc(s,M)||(t.goToDate(M,s),T(M))}},P={focusedDay:s,focusTarget:S,blur:w,focus:T,focusDayAfter:function(){return O("day","after")},focusDayBefore:function(){return O("day","before")},focusWeekAfter:function(){return O("week","after")},focusWeekBefore:function(){return O("week","before")},focusMonthBefore:function(){return O("month","before")},focusMonthAfter:function(){return O("month","after")},focusYearBefore:function(){return O("year","before")},focusYearAfter:function(){return O("year","after")},focusStartOfWeek:function(){return O("startOfWeek","before")},focusEndOfWeek:function(){return O("endOfWeek","after")}};return h.jsx(wde.Provider,{value:P,children:e.children})}function yU(){var e=V.useContext(wde);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function lnt(e,t){var r=xde(),n=gU(e,r,t);return n}var vU=V.createContext(void 0);function cnt(e){if(!UI(e.initialProps)){var t={selected:void 0};return h.jsx(vU.Provider,{value:t,children:e.children})}return h.jsx(unt,{initialProps:e.initialProps,children:e.children})}function unt(e){var t=e.initialProps,r=e.children,n=function(o,d,i){var m,y,S;if((m=t.onDayClick)===null||m===void 0||m.call(t,o,d,i),d.selected&&!t.required){(y=t.onSelect)===null||y===void 0||y.call(t,void 0,o,d,i);return}(S=t.onSelect)===null||S===void 0||S.call(t,o,o,d,i)},s={selected:t.selected,onDayClick:n};return h.jsx(vU.Provider,{value:s,children:r})}function Sde(){var e=V.useContext(vU);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function dnt(e,t){var r=oa(),n=Sde(),s=fU(),o=mU(),d=yU(),i=d.focusDayAfter,m=d.focusDayBefore,y=d.focusWeekAfter,S=d.focusWeekBefore,w=d.blur,T=d.focus,A=d.focusMonthBefore,O=d.focusMonthAfter,P=d.focusYearBefore,N=d.focusYearAfter,R=d.focusStartOfWeek,M=d.focusEndOfWeek,F=function(Ae){var xe,me,Ce,ge;UI(r)?(xe=n.onDayClick)===null||xe===void 0||xe.call(n,e,t,Ae):X2(r)?(me=s.onDayClick)===null||me===void 0||me.call(s,e,t,Ae):Y2(r)?(Ce=o.onDayClick)===null||Ce===void 0||Ce.call(o,e,t,Ae):(ge=r.onDayClick)===null||ge===void 0||ge.call(r,e,t,Ae)},B=function(Ae){var xe;T(e),(xe=r.onDayFocus)===null||xe===void 0||xe.call(r,e,t,Ae)},$=function(Ae){var xe;w(),(xe=r.onDayBlur)===null||xe===void 0||xe.call(r,e,t,Ae)},W=function(Ae){var xe;(xe=r.onDayMouseEnter)===null||xe===void 0||xe.call(r,e,t,Ae)},K=function(Ae){var xe;(xe=r.onDayMouseLeave)===null||xe===void 0||xe.call(r,e,t,Ae)},te=function(Ae){var xe;(xe=r.onDayPointerEnter)===null||xe===void 0||xe.call(r,e,t,Ae)},ne=function(Ae){var xe;(xe=r.onDayPointerLeave)===null||xe===void 0||xe.call(r,e,t,Ae)},ae=function(Ae){var xe;(xe=r.onDayTouchCancel)===null||xe===void 0||xe.call(r,e,t,Ae)},re=function(Ae){var xe;(xe=r.onDayTouchEnd)===null||xe===void 0||xe.call(r,e,t,Ae)},ee=function(Ae){var xe;(xe=r.onDayTouchMove)===null||xe===void 0||xe.call(r,e,t,Ae)},ie=function(Ae){var xe;(xe=r.onDayTouchStart)===null||xe===void 0||xe.call(r,e,t,Ae)},de=function(Ae){var xe;(xe=r.onDayKeyUp)===null||xe===void 0||xe.call(r,e,t,Ae)},be=function(Ae){var xe;switch(Ae.key){case"ArrowLeft":Ae.preventDefault(),Ae.stopPropagation(),r.dir==="rtl"?i():m();break;case"ArrowRight":Ae.preventDefault(),Ae.stopPropagation(),r.dir==="rtl"?m():i();break;case"ArrowDown":Ae.preventDefault(),Ae.stopPropagation(),y();break;case"ArrowUp":Ae.preventDefault(),Ae.stopPropagation(),S();break;case"PageUp":Ae.preventDefault(),Ae.stopPropagation(),Ae.shiftKey?P():A();break;case"PageDown":Ae.preventDefault(),Ae.stopPropagation(),Ae.shiftKey?N():O();break;case"Home":Ae.preventDefault(),Ae.stopPropagation(),R();break;case"End":Ae.preventDefault(),Ae.stopPropagation(),M();break}(xe=r.onDayKeyDown)===null||xe===void 0||xe.call(r,e,t,Ae)},Se={onClick:F,onFocus:B,onBlur:$,onKeyDown:be,onKeyUp:de,onMouseEnter:W,onMouseLeave:K,onPointerEnter:te,onPointerLeave:ne,onTouchCancel:ae,onTouchEnd:re,onTouchMove:ee,onTouchStart:ie};return Se}function hnt(){var e=oa(),t=Sde(),r=fU(),n=mU(),s=UI(e)?t.selected:X2(e)?r.selected:Y2(e)?n.selected:void 0;return s}function fnt(e){return Object.values(Kd).includes(e)}function pnt(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(n){var s=e.modifiersClassNames[n];if(s)r.push(s);else if(fnt(n)){var o=e.classNames["day_".concat(n)];o&&r.push(o)}}),r}function mnt(e,t){var r=pi({},e.styles.day);return Object.keys(t).forEach(function(n){var s;r=pi(pi({},r),(s=e.modifiersStyles)===null||s===void 0?void 0:s[n])}),r}function gnt(e,t,r){var n,s,o,d=oa(),i=yU(),m=lnt(e,t),y=dnt(e,m),S=hnt(),w=!!(d.onDayClick||d.mode!=="default");V.useEffect(function(){var W;m.outside||i.focusedDay&&w&&Vc(i.focusedDay,e)&&((W=r.current)===null||W===void 0||W.focus())},[i.focusedDay,e,r,w,m.outside]);var T=pnt(d,m).join(" "),A=mnt(d,m),O=!!(m.outside&&!d.showOutsideDays||m.hidden),P=(o=(s=d.components)===null||s===void 0?void 0:s.DayContent)!==null&&o!==void 0?o:Lrt,N=h.jsx(P,{date:e,displayMonth:t,activeModifiers:m}),R={style:A,className:T,children:N,role:"gridcell"},M=i.focusTarget&&Vc(i.focusTarget,e)&&!m.outside,F=i.focusedDay&&Vc(i.focusedDay,e),B=pi(pi(pi({},R),(n={disabled:m.disabled,role:"gridcell"},n["aria-selected"]=m.selected,n.tabIndex=F||M?0:-1,n)),y),$={isButton:w,isHidden:O,activeModifiers:m,selectedDays:S,buttonProps:B,divProps:R};return $}function ynt(e){var t=V.useRef(null),r=gnt(e.date,e.displayMonth,t);return r.isHidden?h.jsx("div",{role:"gridcell"}):r.isButton?h.jsx(Nk,pi({name:"day",ref:t},r.buttonProps)):h.jsx("div",pi({},r.divProps))}function vnt(e){var t=e.number,r=e.dates,n=oa(),s=n.onWeekNumberClick,o=n.styles,d=n.classNames,i=n.locale,m=n.labels.labelWeekNumber,y=n.formatters.formatWeekNumber,S=y(Number(t),{locale:i});if(!s)return h.jsx("span",{className:d.weeknumber,style:o.weeknumber,children:S});var w=m(Number(t),{locale:i}),T=function(A){s(t,r,A)};return h.jsx(Nk,{name:"week-number","aria-label":w,className:d.weeknumber,style:o.weeknumber,onClick:T,children:S})}function _nt(e){var t,r,n=oa(),s=n.styles,o=n.classNames,d=n.showWeekNumber,i=n.components,m=(t=i==null?void 0:i.Day)!==null&&t!==void 0?t:ynt,y=(r=i==null?void 0:i.WeekNumber)!==null&&r!==void 0?r:vnt,S;return d&&(S=h.jsx("td",{className:o.cell,style:s.cell,children:h.jsx(y,{number:e.weekNumber,dates:e.dates})})),h.jsxs("tr",{className:o.row,style:s.row,children:[S,e.dates.map(function(w){return h.jsx("td",{className:o.cell,style:s.cell,role:"presentation",children:h.jsx(m,{displayMonth:e.displayMonth,date:w})},rPe(w))})]})}function yX(e,t,r){for(var n=r!=null&&r.ISOWeek?gie(t):T5(t,r),s=r!=null&&r.ISOWeek?kv(e):Wh(e,r),o=Ph(n,s),d=[],i=0;i<=o;i++)d.push(cc(s,i));var m=d.reduce(function(y,S){var w=r!=null&&r.ISOWeek?yie(S):_ie(S,r),T=y.find(function(A){return A.weekNumber===w});return T?(T.dates.push(S),y):(y.push({weekNumber:w,dates:[S]}),y)},[]);return m}function xnt(e,t){var r=yX(Kc(e),kN(e),t);if(t!=null&&t.useFixedWeeks){var n=iPe(e,t);if(n<6){var s=r[r.length-1],o=s.dates[s.dates.length-1],d=EF(o,6-n),i=yX(EF(o,1),d,t);r.push.apply(r,i)}}return r}function bnt(e){var t,r,n,s=oa(),o=s.locale,d=s.classNames,i=s.styles,m=s.hideHead,y=s.fixedWeeks,S=s.components,w=s.weekStartsOn,T=s.firstWeekContainsDate,A=s.ISOWeek,O=xnt(e.displayMonth,{useFixedWeeks:!!y,ISOWeek:A,locale:o,weekStartsOn:w,firstWeekContainsDate:T}),P=(t=S==null?void 0:S.Head)!==null&&t!==void 0?t:Drt,N=(r=S==null?void 0:S.Row)!==null&&r!==void 0?r:_nt,R=(n=S==null?void 0:S.Footer)!==null&&n!==void 0?n:Irt;return h.jsxs("table",{id:e.id,className:d.table,style:i.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!m&&h.jsx(P,{}),h.jsx("tbody",{className:d.tbody,style:i.tbody,children:O.map(function(M){return h.jsx(N,{displayMonth:e.displayMonth,dates:M.dates,weekNumber:M.weekNumber},M.weekNumber)})}),h.jsx(R,{displayMonth:e.displayMonth})]})}function wnt(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Snt=wnt()?V.useLayoutEffect:V.useEffect,NL=!1,Ent=0;function vX(){return"react-day-picker-".concat(++Ent)}function Tnt(e){var t,r=e??(NL?vX():null),n=V.useState(r),s=n[0],o=n[1];return Snt(function(){s===null&&o(vX())},[]),V.useEffect(function(){NL===!1&&(NL=!0)},[]),(t=e??s)!==null&&t!==void 0?t:void 0}function Ant(e){var t,r,n=oa(),s=n.dir,o=n.classNames,d=n.styles,i=n.components,m=J2().displayMonths,y=Tnt(n.id?"".concat(n.id,"-").concat(e.displayIndex):void 0),S=n.id?"".concat(n.id,"-grid-").concat(e.displayIndex):void 0,w=[o.month],T=d.month,A=e.displayIndex===0,O=e.displayIndex===m.length-1,P=!A&&!O;s==="rtl"&&(t=[A,O],O=t[0],A=t[1]),A&&(w.push(o.caption_start),T=pi(pi({},T),d.caption_start)),O&&(w.push(o.caption_end),T=pi(pi({},T),d.caption_end)),P&&(w.push(o.caption_between),T=pi(pi({},T),d.caption_between));var N=(r=i==null?void 0:i.Caption)!==null&&r!==void 0?r:Nrt;return h.jsxs("div",{className:w.join(" "),style:T,children:[h.jsx(N,{id:y,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),h.jsx(bnt,{id:S,"aria-labelledby":y,displayMonth:e.displayMonth})]},e.displayIndex)}function Cnt(e){var t=oa(),r=t.classNames,n=t.styles;return h.jsx("div",{className:r.months,style:n.months,children:e.children})}function jnt(e){var t,r,n=e.initialProps,s=oa(),o=yU(),d=J2(),i=V.useState(!1),m=i[0],y=i[1];V.useEffect(function(){s.initialFocus&&o.focusTarget&&(m||(o.focus(o.focusTarget),y(!0)))},[s.initialFocus,m,o.focus,o.focusTarget,o]);var S=[s.classNames.root,s.className];s.numberOfMonths>1&&S.push(s.classNames.multiple_months),s.showWeekNumber&&S.push(s.classNames.with_weeknumber);var w=pi(pi({},s.styles.root),s.style),T=Object.keys(n).filter(function(O){return O.startsWith("data-")}).reduce(function(O,P){var N;return pi(pi({},O),(N={},N[P]=n[P],N))},{}),A=(r=(t=n.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:Cnt;return h.jsx("div",pi({className:S.join(" "),style:w,dir:s.dir,id:s.id,nonce:n.nonce,title:n.title,lang:n.lang},T,{children:h.jsx(A,{children:d.displayMonths.map(function(O,P){return h.jsx(Ant,{displayIndex:P,displayMonth:O},P)})})}))}function Pnt(e){var t=e.children,r=Qtt(e,["children"]);return h.jsx(vrt,{initialProps:r,children:h.jsx(jrt,{children:h.jsx(cnt,{initialProps:r,children:h.jsx(Frt,{initialProps:r,children:h.jsx($rt,{initialProps:r,children:h.jsx(Zrt,{children:h.jsx(ont,{children:t})})})})})})})}function Ont(e){return h.jsx(Pnt,pi({},e,{children:h.jsx(jnt,{initialProps:e})}))}function _4({className:e,classNames:t,showOutsideDays:r=!0,...n}){return h.jsx(Ont,{showOutsideDays:r,className:fr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:fr(fb({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:fr(fb({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...s})=>h.jsx(eN,{className:"h-4 w-4"}),IconRight:({...s})=>h.jsx(tN,{className:"h-4 w-4"})},...n})}_4.displayName="Calendar";var Ede={exports:{}};/*!
 * Quill Editor v1.3.7
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */(function(e,t){(function(n,s){e.exports=s()})(typeof self<"u"?self:$c,function(){return function(r){var n={};function s(o){if(n[o])return n[o].exports;var d=n[o]={i:o,l:!1,exports:{}};return r[o].call(d.exports,d,d.exports,s),d.l=!0,d.exports}return s.m=r,s.c=n,s.d=function(o,d,i){s.o(o,d)||Object.defineProperty(o,d,{configurable:!1,enumerable:!0,get:i})},s.n=function(o){var d=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(d,"a",d),d},s.o=function(o,d){return Object.prototype.hasOwnProperty.call(o,d)},s.p="",s(s.s=109)}([function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(17),d=s(18),i=s(19),m=s(45),y=s(46),S=s(47),w=s(48),T=s(49),A=s(12),O=s(32),P=s(33),N=s(31),R=s(1),M={Scope:R.Scope,create:R.create,find:R.find,query:R.query,register:R.register,Container:o.default,Format:d.default,Leaf:i.default,Embed:w.default,Scroll:m.default,Block:S.default,Inline:y.default,Text:T.default,Attributor:{Attribute:A.default,Class:O.default,Style:P.default,Store:N.default}};n.default=M},function(r,n,s){var o=this&&this.__extends||function(){var N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,M){R.__proto__=M}||function(R,M){for(var F in M)M.hasOwnProperty(F)&&(R[F]=M[F])};return function(R,M){N(R,M);function F(){this.constructor=R}R.prototype=M===null?Object.create(M):(F.prototype=M.prototype,new F)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=function(N){o(R,N);function R(M){var F=this;return M="[Parchment] "+M,F=N.call(this,M)||this,F.message=M,F.name=F.constructor.name,F}return R}(Error);n.ParchmentError=d;var i={},m={},y={},S={};n.DATA_KEY="__blot";var w;(function(N){N[N.TYPE=3]="TYPE",N[N.LEVEL=12]="LEVEL",N[N.ATTRIBUTE=13]="ATTRIBUTE",N[N.BLOT=14]="BLOT",N[N.INLINE=7]="INLINE",N[N.BLOCK=11]="BLOCK",N[N.BLOCK_BLOT=10]="BLOCK_BLOT",N[N.INLINE_BLOT=6]="INLINE_BLOT",N[N.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",N[N.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",N[N.ANY=15]="ANY"})(w=n.Scope||(n.Scope={}));function T(N,R){var M=O(N);if(M==null)throw new d("Unable to create "+N+" blot");var F=M,B=N instanceof Node||N.nodeType===Node.TEXT_NODE?N:F.create(R);return new F(B,R)}n.create=T;function A(N,R){return R===void 0&&(R=!1),N==null?null:N[n.DATA_KEY]!=null?N[n.DATA_KEY].blot:R?A(N.parentNode,R):null}n.find=A;function O(N,R){R===void 0&&(R=w.ANY);var M;if(typeof N=="string")M=S[N]||i[N];else if(N instanceof Text||N.nodeType===Node.TEXT_NODE)M=S.text;else if(typeof N=="number")N&w.LEVEL&w.BLOCK?M=S.block:N&w.LEVEL&w.INLINE&&(M=S.inline);else if(N instanceof HTMLElement){var F=(N.getAttribute("class")||"").split(/\s+/);for(var B in F)if(M=m[F[B]],M)break;M=M||y[N.tagName]}return M==null?null:R&w.LEVEL&M.scope&&R&w.TYPE&M.scope?M:null}n.query=O;function P(){for(var N=[],R=0;R<arguments.length;R++)N[R]=arguments[R];if(N.length>1)return N.map(function(B){return P(B)});var M=N[0];if(typeof M.blotName!="string"&&typeof M.attrName!="string")throw new d("Invalid definition");if(M.blotName==="abstract")throw new d("Cannot register abstract class");if(S[M.blotName||M.attrName]=M,typeof M.keyName=="string")i[M.keyName]=M;else if(M.className!=null&&(m[M.className]=M),M.tagName!=null){Array.isArray(M.tagName)?M.tagName=M.tagName.map(function(B){return B.toUpperCase()}):M.tagName=M.tagName.toUpperCase();var F=Array.isArray(M.tagName)?M.tagName:[M.tagName];F.forEach(function(B){(y[B]==null||M.className==null)&&(y[B]=M)})}return M}n.register=P},function(r,n,s){var o=s(51),d=s(11),i=s(3),m=s(20),y="\0",S=function(w){Array.isArray(w)?this.ops=w:w!=null&&Array.isArray(w.ops)?this.ops=w.ops:this.ops=[]};S.prototype.insert=function(w,T){var A={};return w.length===0?this:(A.insert=w,T!=null&&typeof T=="object"&&Object.keys(T).length>0&&(A.attributes=T),this.push(A))},S.prototype.delete=function(w){return w<=0?this:this.push({delete:w})},S.prototype.retain=function(w,T){if(w<=0)return this;var A={retain:w};return T!=null&&typeof T=="object"&&Object.keys(T).length>0&&(A.attributes=T),this.push(A)},S.prototype.push=function(w){var T=this.ops.length,A=this.ops[T-1];if(w=i(!0,{},w),typeof A=="object"){if(typeof w.delete=="number"&&typeof A.delete=="number")return this.ops[T-1]={delete:A.delete+w.delete},this;if(typeof A.delete=="number"&&w.insert!=null&&(T-=1,A=this.ops[T-1],typeof A!="object"))return this.ops.unshift(w),this;if(d(w.attributes,A.attributes)){if(typeof w.insert=="string"&&typeof A.insert=="string")return this.ops[T-1]={insert:A.insert+w.insert},typeof w.attributes=="object"&&(this.ops[T-1].attributes=w.attributes),this;if(typeof w.retain=="number"&&typeof A.retain=="number")return this.ops[T-1]={retain:A.retain+w.retain},typeof w.attributes=="object"&&(this.ops[T-1].attributes=w.attributes),this}}return T===this.ops.length?this.ops.push(w):this.ops.splice(T,0,w),this},S.prototype.chop=function(){var w=this.ops[this.ops.length-1];return w&&w.retain&&!w.attributes&&this.ops.pop(),this},S.prototype.filter=function(w){return this.ops.filter(w)},S.prototype.forEach=function(w){this.ops.forEach(w)},S.prototype.map=function(w){return this.ops.map(w)},S.prototype.partition=function(w){var T=[],A=[];return this.forEach(function(O){var P=w(O)?T:A;P.push(O)}),[T,A]},S.prototype.reduce=function(w,T){return this.ops.reduce(w,T)},S.prototype.changeLength=function(){return this.reduce(function(w,T){return T.insert?w+m.length(T):T.delete?w-T.delete:w},0)},S.prototype.length=function(){return this.reduce(function(w,T){return w+m.length(T)},0)},S.prototype.slice=function(w,T){w=w||0,typeof T!="number"&&(T=1/0);for(var A=[],O=m.iterator(this.ops),P=0;P<T&&O.hasNext();){var N;P<w?N=O.next(w-P):(N=O.next(T-P),A.push(N)),P+=m.length(N)}return new S(A)},S.prototype.compose=function(w){var T=m.iterator(this.ops),A=m.iterator(w.ops),O=[],P=A.peek();if(P!=null&&typeof P.retain=="number"&&P.attributes==null){for(var N=P.retain;T.peekType()==="insert"&&T.peekLength()<=N;)N-=T.peekLength(),O.push(T.next());P.retain-N>0&&A.next(P.retain-N)}for(var R=new S(O);T.hasNext()||A.hasNext();)if(A.peekType()==="insert")R.push(A.next());else if(T.peekType()==="delete")R.push(T.next());else{var M=Math.min(T.peekLength(),A.peekLength()),F=T.next(M),B=A.next(M);if(typeof B.retain=="number"){var $={};typeof F.retain=="number"?$.retain=M:$.insert=F.insert;var W=m.attributes.compose(F.attributes,B.attributes,typeof F.retain=="number");if(W&&($.attributes=W),R.push($),!A.hasNext()&&d(R.ops[R.ops.length-1],$)){var K=new S(T.rest());return R.concat(K).chop()}}else typeof B.delete=="number"&&typeof F.retain=="number"&&R.push(B)}return R.chop()},S.prototype.concat=function(w){var T=new S(this.ops.slice());return w.ops.length>0&&(T.push(w.ops[0]),T.ops=T.ops.concat(w.ops.slice(1))),T},S.prototype.diff=function(w,T){if(this.ops===w.ops)return new S;var A=[this,w].map(function(M){return M.map(function(F){if(F.insert!=null)return typeof F.insert=="string"?F.insert:y;var B=M===w?"on":"with";throw new Error("diff() called "+B+" non-document")}).join("")}),O=new S,P=o(A[0],A[1],T),N=m.iterator(this.ops),R=m.iterator(w.ops);return P.forEach(function(M){for(var F=M[1].length;F>0;){var B=0;switch(M[0]){case o.INSERT:B=Math.min(R.peekLength(),F),O.push(R.next(B));break;case o.DELETE:B=Math.min(F,N.peekLength()),N.next(B),O.delete(B);break;case o.EQUAL:B=Math.min(N.peekLength(),R.peekLength(),F);var $=N.next(B),W=R.next(B);d($.insert,W.insert)?O.retain(B,m.attributes.diff($.attributes,W.attributes)):O.push(W).delete(B);break}F-=B}}),O.chop()},S.prototype.eachLine=function(w,T){T=T||`
`;for(var A=m.iterator(this.ops),O=new S,P=0;A.hasNext();){if(A.peekType()!=="insert")return;var N=A.peek(),R=m.length(N)-A.peekLength(),M=typeof N.insert=="string"?N.insert.indexOf(T,R)-R:-1;if(M<0)O.push(A.next());else if(M>0)O.push(A.next(M));else{if(w(O,A.next(1).attributes||{},P)===!1)return;P+=1,O=new S}}O.length()>0&&w(O,{},P)},S.prototype.transform=function(w,T){if(T=!!T,typeof w=="number")return this.transformPosition(w,T);for(var A=m.iterator(this.ops),O=m.iterator(w.ops),P=new S;A.hasNext()||O.hasNext();)if(A.peekType()==="insert"&&(T||O.peekType()!=="insert"))P.retain(m.length(A.next()));else if(O.peekType()==="insert")P.push(O.next());else{var N=Math.min(A.peekLength(),O.peekLength()),R=A.next(N),M=O.next(N);if(R.delete)continue;M.delete?P.push(M):P.retain(N,m.attributes.transform(R.attributes,M.attributes,T))}return P.chop()},S.prototype.transformPosition=function(w,T){T=!!T;for(var A=m.iterator(this.ops),O=0;A.hasNext()&&O<=w;){var P=A.peekLength(),N=A.peekType();if(A.next(),N==="delete"){w-=Math.min(P,w-O);continue}else N==="insert"&&(O<w||!T)&&(w+=P);O+=P}return w},r.exports=S},function(r,n){var s=Object.prototype.hasOwnProperty,o=Object.prototype.toString,d=Object.defineProperty,i=Object.getOwnPropertyDescriptor,m=function(A){return typeof Array.isArray=="function"?Array.isArray(A):o.call(A)==="[object Array]"},y=function(A){if(!A||o.call(A)!=="[object Object]")return!1;var O=s.call(A,"constructor"),P=A.constructor&&A.constructor.prototype&&s.call(A.constructor.prototype,"isPrototypeOf");if(A.constructor&&!O&&!P)return!1;var N;for(N in A);return typeof N>"u"||s.call(A,N)},S=function(A,O){d&&O.name==="__proto__"?d(A,O.name,{enumerable:!0,configurable:!0,value:O.newValue,writable:!0}):A[O.name]=O.newValue},w=function(A,O){if(O==="__proto__")if(s.call(A,O)){if(i)return i(A,O).value}else return;return A[O]};r.exports=function T(){var A,O,P,N,R,M,F=arguments[0],B=1,$=arguments.length,W=!1;for(typeof F=="boolean"&&(W=F,F=arguments[1]||{},B=2),(F==null||typeof F!="object"&&typeof F!="function")&&(F={});B<$;++B)if(A=arguments[B],A!=null)for(O in A)P=w(F,O),N=w(A,O),F!==N&&(W&&N&&(y(N)||(R=m(N)))?(R?(R=!1,M=P&&m(P)?P:[]):M=P&&y(P)?P:{},S(F,{name:O,newValue:T(W,M,N)})):typeof N<"u"&&S(F,{name:O,newValue:N}));return F}},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BlockEmbed=n.bubbleFormats=void 0;var o=function(){function re(ee,ie){for(var de=0;de<ie.length;de++){var be=ie[de];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(ee,be.key,be)}}return function(ee,ie,de){return ie&&re(ee.prototype,ie),de&&re(ee,de),ee}}(),d=function re(ee,ie,de){ee===null&&(ee=Function.prototype);var be=Object.getOwnPropertyDescriptor(ee,ie);if(be===void 0){var Se=Object.getPrototypeOf(ee);return Se===null?void 0:re(Se,ie,de)}else{if("value"in be)return be.value;var Ae=be.get;return Ae===void 0?void 0:Ae.call(de)}},i=s(3),m=F(i),y=s(2),S=F(y),w=s(0),T=F(w),A=s(16),O=F(A),P=s(6),N=F(P),R=s(7),M=F(R);function F(re){return re&&re.__esModule?re:{default:re}}function B(re,ee){if(!(re instanceof ee))throw new TypeError("Cannot call a class as a function")}function $(re,ee){if(!re)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee&&(typeof ee=="object"||typeof ee=="function")?ee:re}function W(re,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ee);re.prototype=Object.create(ee&&ee.prototype,{constructor:{value:re,enumerable:!1,writable:!0,configurable:!0}}),ee&&(Object.setPrototypeOf?Object.setPrototypeOf(re,ee):re.__proto__=ee)}var K=1,te=function(re){W(ee,re);function ee(){return B(this,ee),$(this,(ee.__proto__||Object.getPrototypeOf(ee)).apply(this,arguments))}return o(ee,[{key:"attach",value:function(){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"attach",this).call(this),this.attributes=new T.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return new S.default().insert(this.value(),(0,m.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(de,be){var Se=T.default.query(de,T.default.Scope.BLOCK_ATTRIBUTE);Se!=null&&this.attributes.attribute(Se,be)}},{key:"formatAt",value:function(de,be,Se,Ae){this.format(Se,Ae)}},{key:"insertAt",value:function(de,be,Se){if(typeof be=="string"&&be.endsWith(`
`)){var Ae=T.default.create(ne.blotName);this.parent.insertBefore(Ae,de===0?this:this.next),Ae.insertAt(0,be.slice(0,-1))}else d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,de,be,Se)}}]),ee}(T.default.Embed);te.scope=T.default.Scope.BLOCK_BLOT;var ne=function(re){W(ee,re);function ee(ie){B(this,ee);var de=$(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,ie));return de.cache={},de}return o(ee,[{key:"delta",value:function(){return this.cache.delta==null&&(this.cache.delta=this.descendants(T.default.Leaf).reduce(function(de,be){return be.length()===0?de:de.insert(be.value(),ae(be))},new S.default).insert(`
`,ae(this))),this.cache.delta}},{key:"deleteAt",value:function(de,be){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"deleteAt",this).call(this,de,be),this.cache={}}},{key:"formatAt",value:function(de,be,Se,Ae){be<=0||(T.default.query(Se,T.default.Scope.BLOCK)?de+be===this.length()&&this.format(Se,Ae):d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"formatAt",this).call(this,de,Math.min(be,this.length()-de-1),Se,Ae),this.cache={})}},{key:"insertAt",value:function(de,be,Se){if(Se!=null)return d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,de,be,Se);if(be.length!==0){var Ae=be.split(`
`),xe=Ae.shift();xe.length>0&&(de<this.length()-1||this.children.tail==null?d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,Math.min(de,this.length()-1),xe):this.children.tail.insertAt(this.children.tail.length(),xe),this.cache={});var me=this;Ae.reduce(function(Ce,ge){return me=me.split(Ce,!0),me.insertAt(0,ge),ge.length},de+xe.length)}}},{key:"insertBefore",value:function(de,be){var Se=this.children.head;d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertBefore",this).call(this,de,be),Se instanceof O.default&&Se.remove(),this.cache={}}},{key:"length",value:function(){return this.cache.length==null&&(this.cache.length=d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"length",this).call(this)+K),this.cache.length}},{key:"moveChildren",value:function(de,be){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"moveChildren",this).call(this,de,be),this.cache={}}},{key:"optimize",value:function(de){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"optimize",this).call(this,de),this.cache={}}},{key:"path",value:function(de){return d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"path",this).call(this,de,!0)}},{key:"removeChild",value:function(de){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"removeChild",this).call(this,de),this.cache={}}},{key:"split",value:function(de){var be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(be&&(de===0||de>=this.length()-K)){var Se=this.clone();return de===0?(this.parent.insertBefore(Se,this),this):(this.parent.insertBefore(Se,this.next),Se)}else{var Ae=d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"split",this).call(this,de,be);return this.cache={},Ae}}}]),ee}(T.default.Block);ne.blotName="block",ne.tagName="P",ne.defaultChild="break",ne.allowedChildren=[N.default,T.default.Embed,M.default];function ae(re){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return re==null||(typeof re.formats=="function"&&(ee=(0,m.default)(ee,re.formats())),re.parent==null||re.parent.blotName=="scroll"||re.parent.statics.scope!==re.statics.scope)?ee:ae(re.parent,ee)}n.bubbleFormats=ae,n.BlockEmbed=te,n.default=ne},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.overload=n.expandConfig=void 0;var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},d=function(){function me(Ce,ge){var pe=[],Oe=!0,Xe=!1,We=void 0;try{for(var $e=Ce[Symbol.iterator](),Ke;!(Oe=(Ke=$e.next()).done)&&(pe.push(Ke.value),!(ge&&pe.length===ge));Oe=!0);}catch(Le){Xe=!0,We=Le}finally{try{!Oe&&$e.return&&$e.return()}finally{if(Xe)throw We}}return pe}return function(Ce,ge){if(Array.isArray(Ce))return Ce;if(Symbol.iterator in Object(Ce))return me(Ce,ge);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function me(Ce,ge){for(var pe=0;pe<ge.length;pe++){var Oe=ge[pe];Oe.enumerable=Oe.enumerable||!1,Oe.configurable=!0,"value"in Oe&&(Oe.writable=!0),Object.defineProperty(Ce,Oe.key,Oe)}}return function(Ce,ge,pe){return ge&&me(Ce.prototype,ge),pe&&me(Ce,pe),Ce}}();s(50);var m=s(2),y=ae(m),S=s(14),w=ae(S),T=s(8),A=ae(T),O=s(9),P=ae(O),N=s(0),R=ae(N),M=s(15),F=ae(M),B=s(3),$=ae(B),W=s(10),K=ae(W),te=s(34),ne=ae(te);function ae(me){return me&&me.__esModule?me:{default:me}}function re(me,Ce,ge){return Ce in me?Object.defineProperty(me,Ce,{value:ge,enumerable:!0,configurable:!0,writable:!0}):me[Ce]=ge,me}function ee(me,Ce){if(!(me instanceof Ce))throw new TypeError("Cannot call a class as a function")}var ie=(0,K.default)("quill"),de=function(){i(me,null,[{key:"debug",value:function(ge){ge===!0&&(ge="log"),K.default.level(ge)}},{key:"find",value:function(ge){return ge.__quill||R.default.find(ge)}},{key:"import",value:function(ge){return this.imports[ge]==null&&ie.error("Cannot import "+ge+". Are you sure it was registered?"),this.imports[ge]}},{key:"register",value:function(ge,pe){var Oe=this,Xe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof ge!="string"){var We=ge.attrName||ge.blotName;typeof We=="string"?this.register("formats/"+We,ge,pe):Object.keys(ge).forEach(function($e){Oe.register($e,ge[$e],pe)})}else this.imports[ge]!=null&&!Xe&&ie.warn("Overwriting "+ge+" with",pe),this.imports[ge]=pe,(ge.startsWith("blots/")||ge.startsWith("formats/"))&&pe.blotName!=="abstract"?R.default.register(pe):ge.startsWith("modules")&&typeof pe.register=="function"&&pe.register()}}]);function me(Ce){var ge=this,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ee(this,me),this.options=be(Ce,pe),this.container=this.options.container,this.container==null)return ie.error("Invalid Quill container",Ce);this.options.debug&&me.debug(this.options.debug);var Oe=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new A.default,this.scroll=R.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new w.default(this.scroll),this.selection=new F.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(A.default.events.EDITOR_CHANGE,function(We){We===A.default.events.TEXT_CHANGE&&ge.root.classList.toggle("ql-blank",ge.editor.isBlank())}),this.emitter.on(A.default.events.SCROLL_UPDATE,function(We,$e){var Ke=ge.selection.lastRange,Le=Ke&&Ke.length===0?Ke.index:void 0;Se.call(ge,function(){return ge.editor.update(null,$e,Le)},We)});var Xe=this.clipboard.convert(`<div class='ql-editor' style="white-space: normal;">`+Oe+"<p><br></p></div>");this.setContents(Xe),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return i(me,[{key:"addContainer",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof ge=="string"){var Oe=ge;ge=document.createElement("div"),ge.classList.add(Oe)}return this.container.insertBefore(ge,pe),ge}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function(ge,pe,Oe){var Xe=this,We=Ae(ge,pe,Oe),$e=d(We,4);return ge=$e[0],pe=$e[1],Oe=$e[3],Se.call(this,function(){return Xe.editor.deleteText(ge,pe)},Oe,ge,-1*pe)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(ge),this.container.classList.toggle("ql-disabled",!ge)}},{key:"focus",value:function(){var ge=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=ge,this.scrollIntoView()}},{key:"format",value:function(ge,pe){var Oe=this,Xe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:A.default.sources.API;return Se.call(this,function(){var We=Oe.getSelection(!0),$e=new y.default;if(We==null)return $e;if(R.default.query(ge,R.default.Scope.BLOCK))$e=Oe.editor.formatLine(We.index,We.length,re({},ge,pe));else{if(We.length===0)return Oe.selection.format(ge,pe),$e;$e=Oe.editor.formatText(We.index,We.length,re({},ge,pe))}return Oe.setSelection(We,A.default.sources.SILENT),$e},Xe)}},{key:"formatLine",value:function(ge,pe,Oe,Xe,We){var $e=this,Ke=void 0,Le=Ae(ge,pe,Oe,Xe,We),ke=d(Le,4);return ge=ke[0],pe=ke[1],Ke=ke[2],We=ke[3],Se.call(this,function(){return $e.editor.formatLine(ge,pe,Ke)},We,ge,0)}},{key:"formatText",value:function(ge,pe,Oe,Xe,We){var $e=this,Ke=void 0,Le=Ae(ge,pe,Oe,Xe,We),ke=d(Le,4);return ge=ke[0],pe=ke[1],Ke=ke[2],We=ke[3],Se.call(this,function(){return $e.editor.formatText(ge,pe,Ke)},We,ge,0)}},{key:"getBounds",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Oe=void 0;typeof ge=="number"?Oe=this.selection.getBounds(ge,pe):Oe=this.selection.getBounds(ge.index,ge.length);var Xe=this.container.getBoundingClientRect();return{bottom:Oe.bottom-Xe.top,height:Oe.height,left:Oe.left-Xe.left,right:Oe.right-Xe.left,top:Oe.top-Xe.top,width:Oe.width}}},{key:"getContents",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ge,Oe=Ae(ge,pe),Xe=d(Oe,2);return ge=Xe[0],pe=Xe[1],this.editor.getContents(ge,pe)}},{key:"getFormat",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof ge=="number"?this.editor.getFormat(ge,pe):this.editor.getFormat(ge.index,ge.length)}},{key:"getIndex",value:function(ge){return ge.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function(ge){return this.scroll.leaf(ge)}},{key:"getLine",value:function(ge){return this.scroll.line(ge)}},{key:"getLines",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof ge!="number"?this.scroll.lines(ge.index,ge.length):this.scroll.lines(ge,pe)}},{key:"getModule",value:function(ge){return this.theme.modules[ge]}},{key:"getSelection",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return ge&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ge,Oe=Ae(ge,pe),Xe=d(Oe,2);return ge=Xe[0],pe=Xe[1],this.editor.getText(ge,pe)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function(ge,pe,Oe){var Xe=this,We=arguments.length>3&&arguments[3]!==void 0?arguments[3]:me.sources.API;return Se.call(this,function(){return Xe.editor.insertEmbed(ge,pe,Oe)},We,ge)}},{key:"insertText",value:function(ge,pe,Oe,Xe,We){var $e=this,Ke=void 0,Le=Ae(ge,0,Oe,Xe,We),ke=d(Le,4);return ge=ke[0],Ke=ke[2],We=ke[3],Se.call(this,function(){return $e.editor.insertText(ge,pe,Ke)},We,ge,pe.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function(ge,pe,Oe){this.clipboard.dangerouslyPasteHTML(ge,pe,Oe)}},{key:"removeFormat",value:function(ge,pe,Oe){var Xe=this,We=Ae(ge,pe,Oe),$e=d(We,4);return ge=$e[0],pe=$e[1],Oe=$e[3],Se.call(this,function(){return Xe.editor.removeFormat(ge,pe)},Oe,ge)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function(ge){var pe=this,Oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A.default.sources.API;return Se.call(this,function(){ge=new y.default(ge);var Xe=pe.getLength(),We=pe.editor.deleteText(0,Xe),$e=pe.editor.applyDelta(ge),Ke=$e.ops[$e.ops.length-1];Ke!=null&&typeof Ke.insert=="string"&&Ke.insert[Ke.insert.length-1]===`
`&&(pe.editor.deleteText(pe.getLength()-1,1),$e.delete(1));var Le=We.compose($e);return Le},Oe)}},{key:"setSelection",value:function(ge,pe,Oe){if(ge==null)this.selection.setRange(null,pe||me.sources.API);else{var Xe=Ae(ge,pe,Oe),We=d(Xe,4);ge=We[0],pe=We[1],Oe=We[3],this.selection.setRange(new M.Range(ge,pe),Oe),Oe!==A.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A.default.sources.API,Oe=new y.default().insert(ge);return this.setContents(Oe,pe)}},{key:"update",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A.default.sources.USER,pe=this.scroll.update(ge);return this.selection.update(ge),pe}},{key:"updateContents",value:function(ge){var pe=this,Oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A.default.sources.API;return Se.call(this,function(){return ge=new y.default(ge),pe.editor.applyDelta(ge,Oe)},Oe,!0)}}]),me}();de.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},de.events=A.default.events,de.sources=A.default.sources,de.version="1.3.7",de.imports={delta:y.default,parchment:R.default,"core/module":P.default,"core/theme":ne.default};function be(me,Ce){if(Ce=(0,$.default)(!0,{container:me,modules:{clipboard:!0,keyboard:!0,history:!0}},Ce),!Ce.theme||Ce.theme===de.DEFAULTS.theme)Ce.theme=ne.default;else if(Ce.theme=de.import("themes/"+Ce.theme),Ce.theme==null)throw new Error("Invalid theme "+Ce.theme+". Did you register it?");var ge=(0,$.default)(!0,{},Ce.theme.DEFAULTS);[ge,Ce].forEach(function(Xe){Xe.modules=Xe.modules||{},Object.keys(Xe.modules).forEach(function(We){Xe.modules[We]===!0&&(Xe.modules[We]={})})});var pe=Object.keys(ge.modules).concat(Object.keys(Ce.modules)),Oe=pe.reduce(function(Xe,We){var $e=de.import("modules/"+We);return $e==null?ie.error("Cannot load "+We+" module. Are you sure you registered it?"):Xe[We]=$e.DEFAULTS||{},Xe},{});return Ce.modules!=null&&Ce.modules.toolbar&&Ce.modules.toolbar.constructor!==Object&&(Ce.modules.toolbar={container:Ce.modules.toolbar}),Ce=(0,$.default)(!0,{},de.DEFAULTS,{modules:Oe},ge,Ce),["bounds","container","scrollingContainer"].forEach(function(Xe){typeof Ce[Xe]=="string"&&(Ce[Xe]=document.querySelector(Ce[Xe]))}),Ce.modules=Object.keys(Ce.modules).reduce(function(Xe,We){return Ce.modules[We]&&(Xe[We]=Ce.modules[We]),Xe},{}),Ce}function Se(me,Ce,ge,pe){if(this.options.strict&&!this.isEnabled()&&Ce===A.default.sources.USER)return new y.default;var Oe=ge==null?null:this.getSelection(),Xe=this.editor.delta,We=me();if(Oe!=null&&(ge===!0&&(ge=Oe.index),pe==null?Oe=xe(Oe,We,Ce):pe!==0&&(Oe=xe(Oe,ge,pe,Ce)),this.setSelection(Oe,A.default.sources.SILENT)),We.length()>0){var $e,Ke=[A.default.events.TEXT_CHANGE,We,Xe,Ce];if(($e=this.emitter).emit.apply($e,[A.default.events.EDITOR_CHANGE].concat(Ke)),Ce!==A.default.sources.SILENT){var Le;(Le=this.emitter).emit.apply(Le,Ke)}}return We}function Ae(me,Ce,ge,pe,Oe){var Xe={};return typeof me.index=="number"&&typeof me.length=="number"?typeof Ce!="number"?(Oe=pe,pe=ge,ge=Ce,Ce=me.length,me=me.index):(Ce=me.length,me=me.index):typeof Ce!="number"&&(Oe=pe,pe=ge,ge=Ce,Ce=0),(typeof ge>"u"?"undefined":o(ge))==="object"?(Xe=ge,Oe=pe):typeof ge=="string"&&(pe!=null?Xe[ge]=pe:Oe=ge),Oe=Oe||A.default.sources.API,[me,Ce,Xe,Oe]}function xe(me,Ce,ge,pe){if(me==null)return null;var Oe=void 0,Xe=void 0;if(Ce instanceof y.default){var We=[me.index,me.index+me.length].map(function(ke){return Ce.transformPosition(ke,pe!==A.default.sources.USER)}),$e=d(We,2);Oe=$e[0],Xe=$e[1]}else{var Ke=[me.index,me.index+me.length].map(function(ke){return ke<Ce||ke===Ce&&pe===A.default.sources.USER?ke:ge>=0?ke+ge:Math.max(Ce,ke+ge)}),Le=d(Ke,2);Oe=Le[0],Xe=Le[1]}return new M.Range(Oe,Xe-Oe)}n.expandConfig=be,n.overload=Ae,n.default=de},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function N(R,M){for(var F=0;F<M.length;F++){var B=M[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(R,B.key,B)}}return function(R,M,F){return M&&N(R.prototype,M),F&&N(R,F),R}}(),d=function N(R,M,F){R===null&&(R=Function.prototype);var B=Object.getOwnPropertyDescriptor(R,M);if(B===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:N($,M,F)}else{if("value"in B)return B.value;var W=B.get;return W===void 0?void 0:W.call(F)}},i=s(7),m=w(i),y=s(0),S=w(y);function w(N){return N&&N.__esModule?N:{default:N}}function T(N,R){if(!(N instanceof R))throw new TypeError("Cannot call a class as a function")}function A(N,R){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:N}function O(N,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);N.prototype=Object.create(R&&R.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(N,R):N.__proto__=R)}var P=function(N){O(R,N);function R(){return T(this,R),A(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"formatAt",value:function(F,B,$,W){if(R.compare(this.statics.blotName,$)<0&&S.default.query($,S.default.Scope.BLOT)){var K=this.isolate(F,B);W&&K.wrap($,W)}else d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"formatAt",this).call(this,F,B,$,W)}},{key:"optimize",value:function(F){if(d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"optimize",this).call(this,F),this.parent instanceof R&&R.compare(this.statics.blotName,this.parent.statics.blotName)>0){var B=this.parent.isolate(this.offset(),this.length());this.moveChildren(B),B.wrap(this)}}}],[{key:"compare",value:function(F,B){var $=R.order.indexOf(F),W=R.order.indexOf(B);return $>=0||W>=0?$-W:F===B?0:F<B?-1:1}}]),R}(S.default.Inline);P.allowedChildren=[P,S.default.Embed,m.default],P.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),d=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var w=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(d.default.Text);n.default=w},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function M(F,B){for(var $=0;$<B.length;$++){var W=B[$];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(F,W.key,W)}}return function(F,B,$){return B&&M(F.prototype,B),$&&M(F,$),F}}(),d=function M(F,B,$){F===null&&(F=Function.prototype);var W=Object.getOwnPropertyDescriptor(F,B);if(W===void 0){var K=Object.getPrototypeOf(F);return K===null?void 0:M(K,B,$)}else{if("value"in W)return W.value;var te=W.get;return te===void 0?void 0:te.call($)}},i=s(54),m=w(i),y=s(10),S=w(y);function w(M){return M&&M.__esModule?M:{default:M}}function T(M,F){if(!(M instanceof F))throw new TypeError("Cannot call a class as a function")}function A(M,F){if(!M)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F&&(typeof F=="object"||typeof F=="function")?F:M}function O(M,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof F);M.prototype=Object.create(F&&F.prototype,{constructor:{value:M,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(M,F):M.__proto__=F)}var P=(0,S.default)("quill:events"),N=["selectionchange","mousedown","mouseup","click"];N.forEach(function(M){document.addEventListener(M,function(){for(var F=arguments.length,B=Array(F),$=0;$<F;$++)B[$]=arguments[$];[].slice.call(document.querySelectorAll(".ql-container")).forEach(function(W){if(W.__quill&&W.__quill.emitter){var K;(K=W.__quill.emitter).handleDOM.apply(K,B)}})})});var R=function(M){O(F,M);function F(){T(this,F);var B=A(this,(F.__proto__||Object.getPrototypeOf(F)).call(this));return B.listeners={},B.on("error",P.error),B}return o(F,[{key:"emit",value:function(){P.log.apply(P,arguments),d(F.prototype.__proto__||Object.getPrototypeOf(F.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function($){for(var W=arguments.length,K=Array(W>1?W-1:0),te=1;te<W;te++)K[te-1]=arguments[te];(this.listeners[$.type]||[]).forEach(function(ne){var ae=ne.node,re=ne.handler;($.target===ae||ae.contains($.target))&&re.apply(void 0,[$].concat(K))})}},{key:"listenDOM",value:function($,W,K){this.listeners[$]||(this.listeners[$]=[]),this.listeners[$].push({node:W,handler:K})}}]),F}(m.default);R.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},R.sources={API:"api",SILENT:"silent",USER:"user"},n.default=R},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});function o(i,m){if(!(i instanceof m))throw new TypeError("Cannot call a class as a function")}var d=function i(m){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};o(this,i),this.quill=m,this.options=y};d.DEFAULTS={},n.default=d},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=["error","warn","log","info"],d="warn";function i(y){if(o.indexOf(y)<=o.indexOf(d)){for(var S,w=arguments.length,T=Array(w>1?w-1:0),A=1;A<w;A++)T[A-1]=arguments[A];(S=console)[y].apply(S,T)}}function m(y){return o.reduce(function(S,w){return S[w]=i.bind(console,w,y),S},{})}i.level=m.level=function(y){d=y},n.default=m},function(r,n,s){var o=Array.prototype.slice,d=s(52),i=s(53),m=r.exports=function(T,A,O){return O||(O={}),T===A?!0:T instanceof Date&&A instanceof Date?T.getTime()===A.getTime():!T||!A||typeof T!="object"&&typeof A!="object"?O.strict?T===A:T==A:w(T,A,O)};function y(T){return T==null}function S(T){return!(!T||typeof T!="object"||typeof T.length!="number"||typeof T.copy!="function"||typeof T.slice!="function"||T.length>0&&typeof T[0]!="number")}function w(T,A,O){var P,N;if(y(T)||y(A)||T.prototype!==A.prototype)return!1;if(i(T))return i(A)?(T=o.call(T),A=o.call(A),m(T,A,O)):!1;if(S(T)){if(!S(A)||T.length!==A.length)return!1;for(P=0;P<T.length;P++)if(T[P]!==A[P])return!1;return!0}try{var R=d(T),M=d(A)}catch{return!1}if(R.length!=M.length)return!1;for(R.sort(),M.sort(),P=R.length-1;P>=0;P--)if(R[P]!=M[P])return!1;for(P=R.length-1;P>=0;P--)if(N=R[P],!m(T[N],A[N],O))return!1;return typeof T==typeof A}},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(1),d=function(){function i(m,y,S){S===void 0&&(S={}),this.attrName=m,this.keyName=y;var w=o.Scope.TYPE&o.Scope.ATTRIBUTE;S.scope!=null?this.scope=S.scope&o.Scope.LEVEL|w:this.scope=o.Scope.ATTRIBUTE,S.whitelist!=null&&(this.whitelist=S.whitelist)}return i.keys=function(m){return[].map.call(m.attributes,function(y){return y.name})},i.prototype.add=function(m,y){return this.canAdd(m,y)?(m.setAttribute(this.keyName,y),!0):!1},i.prototype.canAdd=function(m,y){var S=o.query(m,o.Scope.BLOT&(this.scope|o.Scope.TYPE));return S==null?!1:this.whitelist==null?!0:typeof y=="string"?this.whitelist.indexOf(y.replace(/["']/g,""))>-1:this.whitelist.indexOf(y)>-1},i.prototype.remove=function(m){m.removeAttribute(this.keyName)},i.prototype.value=function(m){var y=m.getAttribute(this.keyName);return this.canAdd(m,y)&&y?y:""},i}();n.default=d},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Code=void 0;var o=function(){function te(ne,ae){var re=[],ee=!0,ie=!1,de=void 0;try{for(var be=ne[Symbol.iterator](),Se;!(ee=(Se=be.next()).done)&&(re.push(Se.value),!(ae&&re.length===ae));ee=!0);}catch(Ae){ie=!0,de=Ae}finally{try{!ee&&be.return&&be.return()}finally{if(ie)throw de}}return re}return function(ne,ae){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return te(ne,ae);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function te(ne,ae){for(var re=0;re<ae.length;re++){var ee=ae[re];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(ne,ee.key,ee)}}return function(ne,ae,re){return ae&&te(ne.prototype,ae),re&&te(ne,re),ne}}(),i=function te(ne,ae,re){ne===null&&(ne=Function.prototype);var ee=Object.getOwnPropertyDescriptor(ne,ae);if(ee===void 0){var ie=Object.getPrototypeOf(ne);return ie===null?void 0:te(ie,ae,re)}else{if("value"in ee)return ee.value;var de=ee.get;return de===void 0?void 0:de.call(re)}},m=s(2),y=M(m),S=s(0),w=M(S),T=s(4),A=M(T),O=s(6),P=M(O),N=s(7),R=M(N);function M(te){return te&&te.__esModule?te:{default:te}}function F(te,ne){if(!(te instanceof ne))throw new TypeError("Cannot call a class as a function")}function B(te,ne){if(!te)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ne&&(typeof ne=="object"||typeof ne=="function")?ne:te}function $(te,ne){if(typeof ne!="function"&&ne!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ne);te.prototype=Object.create(ne&&ne.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),ne&&(Object.setPrototypeOf?Object.setPrototypeOf(te,ne):te.__proto__=ne)}var W=function(te){$(ne,te);function ne(){return F(this,ne),B(this,(ne.__proto__||Object.getPrototypeOf(ne)).apply(this,arguments))}return ne}(P.default);W.blotName="code",W.tagName="CODE";var K=function(te){$(ne,te);function ne(){return F(this,ne),B(this,(ne.__proto__||Object.getPrototypeOf(ne)).apply(this,arguments))}return d(ne,[{key:"delta",value:function(){var re=this,ee=this.domNode.textContent;return ee.endsWith(`
`)&&(ee=ee.slice(0,-1)),ee.split(`
`).reduce(function(ie,de){return ie.insert(de).insert(`
`,re.formats())},new y.default)}},{key:"format",value:function(re,ee){if(!(re===this.statics.blotName&&ee)){var ie=this.descendant(R.default,this.length()-1),de=o(ie,1),be=de[0];be!=null&&be.deleteAt(be.length()-1,1),i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"format",this).call(this,re,ee)}}},{key:"formatAt",value:function(re,ee,ie,de){if(ee!==0&&!(w.default.query(ie,w.default.Scope.BLOCK)==null||ie===this.statics.blotName&&de===this.statics.formats(this.domNode))){var be=this.newlineIndex(re);if(!(be<0||be>=re+ee)){var Se=this.newlineIndex(re,!0)+1,Ae=be-Se+1,xe=this.isolate(Se,Ae),me=xe.next;xe.format(ie,de),me instanceof ne&&me.formatAt(0,re-Se+ee-Ae,ie,de)}}}},{key:"insertAt",value:function(re,ee,ie){if(ie==null){var de=this.descendant(R.default,re),be=o(de,2),Se=be[0],Ae=be[1];Se.insertAt(Ae,ee)}}},{key:"length",value:function(){var re=this.domNode.textContent.length;return this.domNode.textContent.endsWith(`
`)?re:re+1}},{key:"newlineIndex",value:function(re){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(ee)return this.domNode.textContent.slice(0,re).lastIndexOf(`
`);var ie=this.domNode.textContent.slice(re).indexOf(`
`);return ie>-1?re+ie:-1}},{key:"optimize",value:function(re){this.domNode.textContent.endsWith(`
`)||this.appendChild(w.default.create("text",`
`)),i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"optimize",this).call(this,re);var ee=this.next;ee!=null&&ee.prev===this&&ee.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===ee.statics.formats(ee.domNode)&&(ee.optimize(re),ee.moveChildren(this),ee.remove())}},{key:"replace",value:function(re){i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"replace",this).call(this,re),[].slice.call(this.domNode.querySelectorAll("*")).forEach(function(ee){var ie=w.default.find(ee);ie==null?ee.parentNode.removeChild(ee):ie instanceof w.default.Embed?ie.remove():ie.unwrap()})}}],[{key:"create",value:function(re){var ee=i(ne.__proto__||Object.getPrototypeOf(ne),"create",this).call(this,re);return ee.setAttribute("spellcheck",!1),ee}},{key:"formats",value:function(){return!0}}]),ne}(A.default);K.blotName="code-block",K.tagName="PRE",K.TAB="  ",n.Code=W,n.default=K},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},d=function(){function me(Ce,ge){var pe=[],Oe=!0,Xe=!1,We=void 0;try{for(var $e=Ce[Symbol.iterator](),Ke;!(Oe=(Ke=$e.next()).done)&&(pe.push(Ke.value),!(ge&&pe.length===ge));Oe=!0);}catch(Le){Xe=!0,We=Le}finally{try{!Oe&&$e.return&&$e.return()}finally{if(Xe)throw We}}return pe}return function(Ce,ge){if(Array.isArray(Ce))return Ce;if(Symbol.iterator in Object(Ce))return me(Ce,ge);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function me(Ce,ge){for(var pe=0;pe<ge.length;pe++){var Oe=ge[pe];Oe.enumerable=Oe.enumerable||!1,Oe.configurable=!0,"value"in Oe&&(Oe.writable=!0),Object.defineProperty(Ce,Oe.key,Oe)}}return function(Ce,ge,pe){return ge&&me(Ce.prototype,ge),pe&&me(Ce,pe),Ce}}(),m=s(2),y=ee(m),S=s(20),w=ee(S),T=s(0),A=ee(T),O=s(13),P=ee(O),N=s(24),R=ee(N),M=s(4),F=ee(M),B=s(16),$=ee(B),W=s(21),K=ee(W),te=s(11),ne=ee(te),ae=s(3),re=ee(ae);function ee(me){return me&&me.__esModule?me:{default:me}}function ie(me,Ce,ge){return Ce in me?Object.defineProperty(me,Ce,{value:ge,enumerable:!0,configurable:!0,writable:!0}):me[Ce]=ge,me}function de(me,Ce){if(!(me instanceof Ce))throw new TypeError("Cannot call a class as a function")}var be=/^[ -~]*$/,Se=function(){function me(Ce){de(this,me),this.scroll=Ce,this.delta=this.getDelta()}return i(me,[{key:"applyDelta",value:function(ge){var pe=this,Oe=!1;this.scroll.update();var Xe=this.scroll.length();return this.scroll.batchStart(),ge=xe(ge),ge.reduce(function(We,$e){var Ke=$e.retain||$e.delete||$e.insert.length||1,Le=$e.attributes||{};if($e.insert!=null){if(typeof $e.insert=="string"){var ke=$e.insert;ke.endsWith(`
`)&&Oe&&(Oe=!1,ke=ke.slice(0,-1)),We>=Xe&&!ke.endsWith(`
`)&&(Oe=!0),pe.scroll.insertAt(We,ke);var st=pe.scroll.line(We),_t=d(st,2),Be=_t[0],Dt=_t[1],It=(0,re.default)({},(0,M.bubbleFormats)(Be));if(Be instanceof F.default){var ir=Be.descendant(A.default.Leaf,Dt),Dr=d(ir,1),Rr=Dr[0];It=(0,re.default)(It,(0,M.bubbleFormats)(Rr))}Le=w.default.attributes.diff(It,Le)||{}}else if(o($e.insert)==="object"){var jt=Object.keys($e.insert)[0];if(jt==null)return We;pe.scroll.insertAt(We,jt,$e.insert[jt])}Xe+=Ke}return Object.keys(Le).forEach(function(zt){pe.scroll.formatAt(We,Ke,zt,Le[zt])}),We+Ke},0),ge.reduce(function(We,$e){return typeof $e.delete=="number"?(pe.scroll.deleteAt(We,$e.delete),We):We+($e.retain||$e.insert.length||1)},0),this.scroll.batchEnd(),this.update(ge)}},{key:"deleteText",value:function(ge,pe){return this.scroll.deleteAt(ge,pe),this.update(new y.default().retain(ge).delete(pe))}},{key:"formatLine",value:function(ge,pe){var Oe=this,Xe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.scroll.update(),Object.keys(Xe).forEach(function(We){if(!(Oe.scroll.whitelist!=null&&!Oe.scroll.whitelist[We])){var $e=Oe.scroll.lines(ge,Math.max(pe,1)),Ke=pe;$e.forEach(function(Le){var ke=Le.length();if(!(Le instanceof P.default))Le.format(We,Xe[We]);else{var st=ge-Le.offset(Oe.scroll),_t=Le.newlineIndex(st+Ke)-st+1;Le.formatAt(st,_t,We,Xe[We])}Ke-=ke})}}),this.scroll.optimize(),this.update(new y.default().retain(ge).retain(pe,(0,K.default)(Xe)))}},{key:"formatText",value:function(ge,pe){var Oe=this,Xe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Object.keys(Xe).forEach(function(We){Oe.scroll.formatAt(ge,pe,We,Xe[We])}),this.update(new y.default().retain(ge).retain(pe,(0,K.default)(Xe)))}},{key:"getContents",value:function(ge,pe){return this.delta.slice(ge,ge+pe)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce(function(ge,pe){return ge.concat(pe.delta())},new y.default)}},{key:"getFormat",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Oe=[],Xe=[];pe===0?this.scroll.path(ge).forEach(function($e){var Ke=d($e,1),Le=Ke[0];Le instanceof F.default?Oe.push(Le):Le instanceof A.default.Leaf&&Xe.push(Le)}):(Oe=this.scroll.lines(ge,pe),Xe=this.scroll.descendants(A.default.Leaf,ge,pe));var We=[Oe,Xe].map(function($e){if($e.length===0)return{};for(var Ke=(0,M.bubbleFormats)($e.shift());Object.keys(Ke).length>0;){var Le=$e.shift();if(Le==null)return Ke;Ke=Ae((0,M.bubbleFormats)(Le),Ke)}return Ke});return re.default.apply(re.default,We)}},{key:"getText",value:function(ge,pe){return this.getContents(ge,pe).filter(function(Oe){return typeof Oe.insert=="string"}).map(function(Oe){return Oe.insert}).join("")}},{key:"insertEmbed",value:function(ge,pe,Oe){return this.scroll.insertAt(ge,pe,Oe),this.update(new y.default().retain(ge).insert(ie({},pe,Oe)))}},{key:"insertText",value:function(ge,pe){var Oe=this,Xe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return pe=pe.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(ge,pe),Object.keys(Xe).forEach(function(We){Oe.scroll.formatAt(ge,pe.length,We,Xe[We])}),this.update(new y.default().retain(ge).insert(pe,(0,K.default)(Xe)))}},{key:"isBlank",value:function(){if(this.scroll.children.length==0)return!0;if(this.scroll.children.length>1)return!1;var ge=this.scroll.children.head;return ge.statics.blotName!==F.default.blotName||ge.children.length>1?!1:ge.children.head instanceof $.default}},{key:"removeFormat",value:function(ge,pe){var Oe=this.getText(ge,pe),Xe=this.scroll.line(ge+pe),We=d(Xe,2),$e=We[0],Ke=We[1],Le=0,ke=new y.default;$e!=null&&($e instanceof P.default?Le=$e.newlineIndex(Ke)-Ke+1:Le=$e.length()-Ke,ke=$e.delta().slice(Ke,Ke+Le-1).insert(`
`));var st=this.getContents(ge,pe+Le),_t=st.diff(new y.default().insert(Oe).concat(ke)),Be=new y.default().retain(ge).concat(_t);return this.applyDelta(Be)}},{key:"update",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],Oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,Xe=this.delta;if(pe.length===1&&pe[0].type==="characterData"&&pe[0].target.data.match(be)&&A.default.find(pe[0].target)){var We=A.default.find(pe[0].target),$e=(0,M.bubbleFormats)(We),Ke=We.offset(this.scroll),Le=pe[0].oldValue.replace(R.default.CONTENTS,""),ke=new y.default().insert(Le),st=new y.default().insert(We.value()),_t=new y.default().retain(Ke).concat(ke.diff(st,Oe));ge=_t.reduce(function(Be,Dt){return Dt.insert?Be.insert(Dt.insert,$e):Be.push(Dt)},new y.default),this.delta=Xe.compose(ge)}else this.delta=this.getDelta(),(!ge||!(0,ne.default)(Xe.compose(ge),this.delta))&&(ge=Xe.diff(this.delta,Oe));return ge}}]),me}();function Ae(me,Ce){return Object.keys(Ce).reduce(function(ge,pe){return me[pe]==null||(Ce[pe]===me[pe]?ge[pe]=Ce[pe]:Array.isArray(Ce[pe])?Ce[pe].indexOf(me[pe])<0&&(ge[pe]=Ce[pe].concat([me[pe]])):ge[pe]=[Ce[pe],me[pe]]),ge},{})}function xe(me){return me.reduce(function(Ce,ge){if(ge.insert===1){var pe=(0,K.default)(ge.attributes);return delete pe.image,Ce.insert({image:ge.attributes.image},pe)}if(ge.attributes!=null&&(ge.attributes.list===!0||ge.attributes.bullet===!0)&&(ge=(0,K.default)(ge),ge.attributes.list?ge.attributes.list="ordered":(ge.attributes.list="bullet",delete ge.attributes.bullet)),typeof ge.insert=="string"){var Oe=ge.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return Ce.insert(Oe,ge.attributes)}return Ce.push(ge)},new y.default)}n.default=Se},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Range=void 0;var o=function(){function te(ne,ae){var re=[],ee=!0,ie=!1,de=void 0;try{for(var be=ne[Symbol.iterator](),Se;!(ee=(Se=be.next()).done)&&(re.push(Se.value),!(ae&&re.length===ae));ee=!0);}catch(Ae){ie=!0,de=Ae}finally{try{!ee&&be.return&&be.return()}finally{if(ie)throw de}}return re}return function(ne,ae){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return te(ne,ae);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function te(ne,ae){for(var re=0;re<ae.length;re++){var ee=ae[re];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(ne,ee.key,ee)}}return function(ne,ae,re){return ae&&te(ne.prototype,ae),re&&te(ne,re),ne}}(),i=s(0),m=R(i),y=s(21),S=R(y),w=s(11),T=R(w),A=s(8),O=R(A),P=s(10),N=R(P);function R(te){return te&&te.__esModule?te:{default:te}}function M(te){if(Array.isArray(te)){for(var ne=0,ae=Array(te.length);ne<te.length;ne++)ae[ne]=te[ne];return ae}else return Array.from(te)}function F(te,ne){if(!(te instanceof ne))throw new TypeError("Cannot call a class as a function")}var B=(0,N.default)("quill:selection"),$=function te(ne){var ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;F(this,te),this.index=ne,this.length=ae},W=function(){function te(ne,ae){var re=this;F(this,te),this.emitter=ae,this.scroll=ne,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=m.default.create("cursor",this),this.lastRange=this.savedRange=new $(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,function(){re.mouseDown||setTimeout(re.update.bind(re,O.default.sources.USER),1)}),this.emitter.on(O.default.events.EDITOR_CHANGE,function(ee,ie){ee===O.default.events.TEXT_CHANGE&&ie.length()>0&&re.update(O.default.sources.SILENT)}),this.emitter.on(O.default.events.SCROLL_BEFORE_UPDATE,function(){if(re.hasFocus()){var ee=re.getNativeRange();ee!=null&&ee.start.node!==re.cursor.textNode&&re.emitter.once(O.default.events.SCROLL_UPDATE,function(){try{re.setNativeRange(ee.start.node,ee.start.offset,ee.end.node,ee.end.offset)}catch{}})}}),this.emitter.on(O.default.events.SCROLL_OPTIMIZE,function(ee,ie){if(ie.range){var de=ie.range,be=de.startNode,Se=de.startOffset,Ae=de.endNode,xe=de.endOffset;re.setNativeRange(be,Se,Ae,xe)}}),this.update(O.default.sources.SILENT)}return d(te,[{key:"handleComposition",value:function(){var ae=this;this.root.addEventListener("compositionstart",function(){ae.composing=!0}),this.root.addEventListener("compositionend",function(){if(ae.composing=!1,ae.cursor.parent){var re=ae.cursor.restore();if(!re)return;setTimeout(function(){ae.setNativeRange(re.startNode,re.startOffset,re.endNode,re.endOffset)},1)}})}},{key:"handleDragging",value:function(){var ae=this;this.emitter.listenDOM("mousedown",document.body,function(){ae.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,function(){ae.mouseDown=!1,ae.update(O.default.sources.USER)})}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(ae,re){if(!(this.scroll.whitelist!=null&&!this.scroll.whitelist[ae])){this.scroll.update();var ee=this.getNativeRange();if(!(ee==null||!ee.native.collapsed||m.default.query(ae,m.default.Scope.BLOCK))){if(ee.start.node!==this.cursor.textNode){var ie=m.default.find(ee.start.node,!1);if(ie==null)return;if(ie instanceof m.default.Leaf){var de=ie.split(ee.start.offset);ie.parent.insertBefore(this.cursor,de)}else ie.insertBefore(this.cursor,ee.start.node);this.cursor.attach()}this.cursor.format(ae,re),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(ae){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,ee=this.scroll.length();ae=Math.min(ae,ee-1),re=Math.min(ae+re,ee-1)-ae;var ie=void 0,de=this.scroll.leaf(ae),be=o(de,2),Se=be[0],Ae=be[1];if(Se==null)return null;var xe=Se.position(Ae,!0),me=o(xe,2);ie=me[0],Ae=me[1];var Ce=document.createRange();if(re>0){Ce.setStart(ie,Ae);var ge=this.scroll.leaf(ae+re),pe=o(ge,2);if(Se=pe[0],Ae=pe[1],Se==null)return null;var Oe=Se.position(Ae,!0),Xe=o(Oe,2);return ie=Xe[0],Ae=Xe[1],Ce.setEnd(ie,Ae),Ce.getBoundingClientRect()}else{var We="left",$e=void 0;return ie instanceof Text?(Ae<ie.data.length?(Ce.setStart(ie,Ae),Ce.setEnd(ie,Ae+1)):(Ce.setStart(ie,Ae-1),Ce.setEnd(ie,Ae),We="right"),$e=Ce.getBoundingClientRect()):($e=Se.domNode.getBoundingClientRect(),Ae>0&&(We="right")),{bottom:$e.top+$e.height,height:$e.height,left:$e[We],right:$e[We],top:$e.top,width:0}}}},{key:"getNativeRange",value:function(){var ae=document.getSelection();if(ae==null||ae.rangeCount<=0)return null;var re=ae.getRangeAt(0);if(re==null)return null;var ee=this.normalizeNative(re);return B.info("getNativeRange",ee),ee}},{key:"getRange",value:function(){var ae=this.getNativeRange();if(ae==null)return[null,null];var re=this.normalizedToRange(ae);return[re,ae]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(ae){var re=this,ee=[[ae.start.node,ae.start.offset]];ae.native.collapsed||ee.push([ae.end.node,ae.end.offset]);var ie=ee.map(function(Se){var Ae=o(Se,2),xe=Ae[0],me=Ae[1],Ce=m.default.find(xe,!0),ge=Ce.offset(re.scroll);return me===0?ge:Ce instanceof m.default.Container?ge+Ce.length():ge+Ce.index(xe,me)}),de=Math.min(Math.max.apply(Math,M(ie)),this.scroll.length()-1),be=Math.min.apply(Math,[de].concat(M(ie)));return new $(be,de-be)}},{key:"normalizeNative",value:function(ae){if(!K(this.root,ae.startContainer)||!ae.collapsed&&!K(this.root,ae.endContainer))return null;var re={start:{node:ae.startContainer,offset:ae.startOffset},end:{node:ae.endContainer,offset:ae.endOffset},native:ae};return[re.start,re.end].forEach(function(ee){for(var ie=ee.node,de=ee.offset;!(ie instanceof Text)&&ie.childNodes.length>0;)if(ie.childNodes.length>de)ie=ie.childNodes[de],de=0;else if(ie.childNodes.length===de)ie=ie.lastChild,de=ie instanceof Text?ie.data.length:ie.childNodes.length+1;else break;ee.node=ie,ee.offset=de}),re}},{key:"rangeToNative",value:function(ae){var re=this,ee=ae.collapsed?[ae.index]:[ae.index,ae.index+ae.length],ie=[],de=this.scroll.length();return ee.forEach(function(be,Se){be=Math.min(de-1,be);var Ae=void 0,xe=re.scroll.leaf(be),me=o(xe,2),Ce=me[0],ge=me[1],pe=Ce.position(ge,Se!==0),Oe=o(pe,2);Ae=Oe[0],ge=Oe[1],ie.push(Ae,ge)}),ie.length<2&&(ie=ie.concat(ie)),ie}},{key:"scrollIntoView",value:function(ae){var re=this.lastRange;if(re!=null){var ee=this.getBounds(re.index,re.length);if(ee!=null){var ie=this.scroll.length()-1,de=this.scroll.line(Math.min(re.index,ie)),be=o(de,1),Se=be[0],Ae=Se;if(re.length>0){var xe=this.scroll.line(Math.min(re.index+re.length,ie)),me=o(xe,1);Ae=me[0]}if(!(Se==null||Ae==null)){var Ce=ae.getBoundingClientRect();ee.top<Ce.top?ae.scrollTop-=Ce.top-ee.top:ee.bottom>Ce.bottom&&(ae.scrollTop+=ee.bottom-Ce.bottom)}}}}},{key:"setNativeRange",value:function(ae,re){var ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ae,ie=arguments.length>3&&arguments[3]!==void 0?arguments[3]:re,de=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(B.info("setNativeRange",ae,re,ee,ie),!(ae!=null&&(this.root.parentNode==null||ae.parentNode==null||ee.parentNode==null))){var be=document.getSelection();if(be!=null)if(ae!=null){this.hasFocus()||this.root.focus();var Se=(this.getNativeRange()||{}).native;if(Se==null||de||ae!==Se.startContainer||re!==Se.startOffset||ee!==Se.endContainer||ie!==Se.endOffset){ae.tagName=="BR"&&(re=[].indexOf.call(ae.parentNode.childNodes,ae),ae=ae.parentNode),ee.tagName=="BR"&&(ie=[].indexOf.call(ee.parentNode.childNodes,ee),ee=ee.parentNode);var Ae=document.createRange();Ae.setStart(ae,re),Ae.setEnd(ee,ie),be.removeAllRanges(),be.addRange(Ae)}}else be.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(ae){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:O.default.sources.API;if(typeof re=="string"&&(ee=re,re=!1),B.info("setRange",ae),ae!=null){var ie=this.rangeToNative(ae);this.setNativeRange.apply(this,M(ie).concat([re]))}else this.setNativeRange(null);this.update(ee)}},{key:"update",value:function(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O.default.sources.USER,re=this.lastRange,ee=this.getRange(),ie=o(ee,2),de=ie[0],be=ie[1];if(this.lastRange=de,this.lastRange!=null&&(this.savedRange=this.lastRange),!(0,T.default)(re,this.lastRange)){var Se;!this.composing&&be!=null&&be.native.collapsed&&be.start.node!==this.cursor.textNode&&this.cursor.restore();var Ae=[O.default.events.SELECTION_CHANGE,(0,S.default)(this.lastRange),(0,S.default)(re),ae];if((Se=this.emitter).emit.apply(Se,[O.default.events.EDITOR_CHANGE].concat(Ae)),ae!==O.default.sources.SILENT){var xe;(xe=this.emitter).emit.apply(xe,Ae)}}}}]),te}();function K(te,ne){try{ne.parentNode}catch{return!1}return ne instanceof Text&&(ne=ne.parentNode),te.contains(ne)}n.Range=$,n.default=W},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,N){for(var R=0;R<N.length;R++){var M=N[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,N,R){return N&&O(P.prototype,N),R&&O(P,R),P}}(),d=function O(P,N,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,N);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,N,R)}else{if("value"in M)return M.value;var B=M.get;return B===void 0?void 0:B.call(R)}},i=s(0),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function w(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),w(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return o(P,[{key:"insertInto",value:function(R,M){R.children.length===0?d(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"insertInto",this).call(this,R,M):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),P}(m.default.Embed);A.blotName="break",A.tagName="BR",n.default=A},function(r,n,s){var o=this&&this.__extends||function(){var w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var O in A)A.hasOwnProperty(O)&&(T[O]=A[O])};return function(T,A){w(T,A);function O(){this.constructor=T}T.prototype=A===null?Object.create(A):(O.prototype=A.prototype,new O)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(44),i=s(30),m=s(1),y=function(w){o(T,w);function T(A){var O=w.call(this,A)||this;return O.build(),O}return T.prototype.appendChild=function(A){this.insertBefore(A)},T.prototype.attach=function(){w.prototype.attach.call(this),this.children.forEach(function(A){A.attach()})},T.prototype.build=function(){var A=this;this.children=new d.default,[].slice.call(this.domNode.childNodes).reverse().forEach(function(O){try{var P=S(O);A.insertBefore(P,A.children.head||void 0)}catch(N){if(N instanceof m.ParchmentError)return;throw N}})},T.prototype.deleteAt=function(A,O){if(A===0&&O===this.length())return this.remove();this.children.forEachAt(A,O,function(P,N,R){P.deleteAt(N,R)})},T.prototype.descendant=function(A,O){var P=this.children.find(O),N=P[0],R=P[1];return A.blotName==null&&A(N)||A.blotName!=null&&N instanceof A?[N,R]:N instanceof T?N.descendant(A,R):[null,-1]},T.prototype.descendants=function(A,O,P){O===void 0&&(O=0),P===void 0&&(P=Number.MAX_VALUE);var N=[],R=P;return this.children.forEachAt(O,P,function(M,F,B){(A.blotName==null&&A(M)||A.blotName!=null&&M instanceof A)&&N.push(M),M instanceof T&&(N=N.concat(M.descendants(A,F,R))),R-=B}),N},T.prototype.detach=function(){this.children.forEach(function(A){A.detach()}),w.prototype.detach.call(this)},T.prototype.formatAt=function(A,O,P,N){this.children.forEachAt(A,O,function(R,M,F){R.formatAt(M,F,P,N)})},T.prototype.insertAt=function(A,O,P){var N=this.children.find(A),R=N[0],M=N[1];if(R)R.insertAt(M,O,P);else{var F=P==null?m.create("text",O):m.create(O,P);this.appendChild(F)}},T.prototype.insertBefore=function(A,O){if(this.statics.allowedChildren!=null&&!this.statics.allowedChildren.some(function(P){return A instanceof P}))throw new m.ParchmentError("Cannot insert "+A.statics.blotName+" into "+this.statics.blotName);A.insertInto(this,O)},T.prototype.length=function(){return this.children.reduce(function(A,O){return A+O.length()},0)},T.prototype.moveChildren=function(A,O){this.children.forEach(function(P){A.insertBefore(P,O)})},T.prototype.optimize=function(A){if(w.prototype.optimize.call(this,A),this.children.length===0)if(this.statics.defaultChild!=null){var O=m.create(this.statics.defaultChild);this.appendChild(O),O.optimize(A)}else this.remove()},T.prototype.path=function(A,O){O===void 0&&(O=!1);var P=this.children.find(A,O),N=P[0],R=P[1],M=[[this,A]];return N instanceof T?M.concat(N.path(R,O)):(N!=null&&M.push([N,R]),M)},T.prototype.removeChild=function(A){this.children.remove(A)},T.prototype.replace=function(A){A instanceof T&&A.moveChildren(this),w.prototype.replace.call(this,A)},T.prototype.split=function(A,O){if(O===void 0&&(O=!1),!O){if(A===0)return this;if(A===this.length())return this.next}var P=this.clone();return this.parent.insertBefore(P,this.next),this.children.forEachAt(A,this.length(),function(N,R,M){N=N.split(R,O),P.appendChild(N)}),P},T.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},T.prototype.update=function(A,O){var P=this,N=[],R=[];A.forEach(function(M){M.target===P.domNode&&M.type==="childList"&&(N.push.apply(N,M.addedNodes),R.push.apply(R,M.removedNodes))}),R.forEach(function(M){if(!(M.parentNode!=null&&M.tagName!=="IFRAME"&&document.body.compareDocumentPosition(M)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var F=m.find(M);F!=null&&(F.domNode.parentNode==null||F.domNode.parentNode===P.domNode)&&F.detach()}}),N.filter(function(M){return M.parentNode==P.domNode}).sort(function(M,F){return M===F?0:M.compareDocumentPosition(F)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1}).forEach(function(M){var F=null;M.nextSibling!=null&&(F=m.find(M.nextSibling));var B=S(M);(B.next!=F||B.next==null)&&(B.parent!=null&&B.parent.removeChild(P),P.insertBefore(B,F||void 0))})},T}(i.default);function S(w){var T=m.find(w);if(T==null)try{T=m.create(w)}catch{T=m.create(m.Scope.INLINE),[].slice.call(w.childNodes).forEach(function(O){T.domNode.appendChild(O)}),w.parentNode&&w.parentNode.replaceChild(T.domNode,w),T.attach()}return T}n.default=y},function(r,n,s){var o=this&&this.__extends||function(){var w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var O in A)A.hasOwnProperty(O)&&(T[O]=A[O])};return function(T,A){w(T,A);function O(){this.constructor=T}T.prototype=A===null?Object.create(A):(O.prototype=A.prototype,new O)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(12),i=s(31),m=s(17),y=s(1),S=function(w){o(T,w);function T(A){var O=w.call(this,A)||this;return O.attributes=new i.default(O.domNode),O}return T.formats=function(A){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return A.tagName.toLowerCase()},T.prototype.format=function(A,O){var P=y.query(A);P instanceof d.default?this.attributes.attribute(P,O):O&&P!=null&&(A!==this.statics.blotName||this.formats()[A]!==O)&&this.replaceWith(A,O)},T.prototype.formats=function(){var A=this.attributes.values(),O=this.statics.formats(this.domNode);return O!=null&&(A[this.statics.blotName]=O),A},T.prototype.replaceWith=function(A,O){var P=w.prototype.replaceWith.call(this,A,O);return this.attributes.copy(P),P},T.prototype.update=function(A,O){var P=this;w.prototype.update.call(this,A,O),A.some(function(N){return N.target===P.domNode&&N.type==="attributes"})&&this.attributes.build()},T.prototype.wrap=function(A,O){var P=w.prototype.wrap.call(this,A,O);return P instanceof T&&P.statics.scope===this.statics.scope&&this.attributes.move(P),P},T}(m.default);n.default=S},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,w){S.__proto__=w}||function(S,w){for(var T in w)w.hasOwnProperty(T)&&(S[T]=w[T])};return function(S,w){y(S,w);function T(){this.constructor=S}S.prototype=w===null?Object.create(w):(T.prototype=w.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(30),i=s(1),m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.value=function(w){return!0},S.prototype.index=function(w,T){return this.domNode===w||this.domNode.compareDocumentPosition(w)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(T,1):-1},S.prototype.position=function(w,T){var A=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return w>0&&(A+=1),[this.parent.domNode,A]},S.prototype.value=function(){var w;return w={},w[this.statics.blotName]=this.statics.value(this.domNode)||!0,w},S.scope=i.Scope.INLINE_BLOT,S}(d.default);n.default=m},function(r,n,s){var o=s(11),d=s(3),i={attributes:{compose:function(y,S,w){typeof y!="object"&&(y={}),typeof S!="object"&&(S={});var T=d(!0,{},S);w||(T=Object.keys(T).reduce(function(O,P){return T[P]!=null&&(O[P]=T[P]),O},{}));for(var A in y)y[A]!==void 0&&S[A]===void 0&&(T[A]=y[A]);return Object.keys(T).length>0?T:void 0},diff:function(y,S){typeof y!="object"&&(y={}),typeof S!="object"&&(S={});var w=Object.keys(y).concat(Object.keys(S)).reduce(function(T,A){return o(y[A],S[A])||(T[A]=S[A]===void 0?null:S[A]),T},{});return Object.keys(w).length>0?w:void 0},transform:function(y,S,w){if(typeof y!="object")return S;if(typeof S=="object"){if(!w)return S;var T=Object.keys(S).reduce(function(A,O){return y[O]===void 0&&(A[O]=S[O]),A},{});return Object.keys(T).length>0?T:void 0}}},iterator:function(y){return new m(y)},length:function(y){return typeof y.delete=="number"?y.delete:typeof y.retain=="number"?y.retain:typeof y.insert=="string"?y.insert.length:1}};function m(y){this.ops=y,this.index=0,this.offset=0}m.prototype.hasNext=function(){return this.peekLength()<1/0},m.prototype.next=function(y){y||(y=1/0);var S=this.ops[this.index];if(S){var w=this.offset,T=i.length(S);if(y>=T-w?(y=T-w,this.index+=1,this.offset=0):this.offset+=y,typeof S.delete=="number")return{delete:y};var A={};return S.attributes&&(A.attributes=S.attributes),typeof S.retain=="number"?A.retain=y:typeof S.insert=="string"?A.insert=S.insert.substr(w,y):A.insert=S.insert,A}else return{retain:1/0}},m.prototype.peek=function(){return this.ops[this.index]},m.prototype.peekLength=function(){return this.ops[this.index]?i.length(this.ops[this.index])-this.offset:1/0},m.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},m.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var y=this.offset,S=this.index,w=this.next(),T=this.ops.slice(this.index);return this.offset=y,this.index=S,[w].concat(T)}else return[]},r.exports=i},function(r,n){var s=function(){function o(P,N){return N!=null&&P instanceof N}var d;try{d=Map}catch{d=function(){}}var i;try{i=Set}catch{i=function(){}}var m;try{m=Promise}catch{m=function(){}}function y(P,N,R,M,F){typeof N=="object"&&(R=N.depth,M=N.prototype,F=N.includeNonEnumerable,N=N.circular);var B=[],$=[],W=typeof Buffer<"u";typeof N>"u"&&(N=!0),typeof R>"u"&&(R=1/0);function K(te,ne){if(te===null)return null;if(ne===0)return te;var ae,re;if(typeof te!="object")return te;if(o(te,d))ae=new d;else if(o(te,i))ae=new i;else if(o(te,m))ae=new m(function(Ce,ge){te.then(function(pe){Ce(K(pe,ne-1))},function(pe){ge(K(pe,ne-1))})});else if(y.__isArray(te))ae=[];else if(y.__isRegExp(te))ae=new RegExp(te.source,O(te)),te.lastIndex&&(ae.lastIndex=te.lastIndex);else if(y.__isDate(te))ae=new Date(te.getTime());else{if(W&&Buffer.isBuffer(te))return Buffer.allocUnsafe?ae=Buffer.allocUnsafe(te.length):ae=new Buffer(te.length),te.copy(ae),ae;o(te,Error)?ae=Object.create(te):typeof M>"u"?(re=Object.getPrototypeOf(te),ae=Object.create(re)):(ae=Object.create(M),re=M)}if(N){var ee=B.indexOf(te);if(ee!=-1)return $[ee];B.push(te),$.push(ae)}o(te,d)&&te.forEach(function(Ce,ge){var pe=K(ge,ne-1),Oe=K(Ce,ne-1);ae.set(pe,Oe)}),o(te,i)&&te.forEach(function(Ce){var ge=K(Ce,ne-1);ae.add(ge)});for(var ie in te){var de;re&&(de=Object.getOwnPropertyDescriptor(re,ie)),!(de&&de.set==null)&&(ae[ie]=K(te[ie],ne-1))}if(Object.getOwnPropertySymbols)for(var be=Object.getOwnPropertySymbols(te),ie=0;ie<be.length;ie++){var Se=be[ie],Ae=Object.getOwnPropertyDescriptor(te,Se);Ae&&!Ae.enumerable&&!F||(ae[Se]=K(te[Se],ne-1),Ae.enumerable||Object.defineProperty(ae,Se,{enumerable:!1}))}if(F)for(var xe=Object.getOwnPropertyNames(te),ie=0;ie<xe.length;ie++){var me=xe[ie],Ae=Object.getOwnPropertyDescriptor(te,me);Ae&&Ae.enumerable||(ae[me]=K(te[me],ne-1),Object.defineProperty(ae,me,{enumerable:!1}))}return ae}return K(P,R)}y.clonePrototype=function(N){if(N===null)return null;var R=function(){};return R.prototype=N,new R};function S(P){return Object.prototype.toString.call(P)}y.__objToStr=S;function w(P){return typeof P=="object"&&S(P)==="[object Date]"}y.__isDate=w;function T(P){return typeof P=="object"&&S(P)==="[object Array]"}y.__isArray=T;function A(P){return typeof P=="object"&&S(P)==="[object RegExp]"}y.__isRegExp=A;function O(P){var N="";return P.global&&(N+="g"),P.ignoreCase&&(N+="i"),P.multiline&&(N+="m"),N}return y.__getRegExpFlags=O,y}();typeof r=="object"&&r.exports&&(r.exports=s)},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function ae(re,ee){var ie=[],de=!0,be=!1,Se=void 0;try{for(var Ae=re[Symbol.iterator](),xe;!(de=(xe=Ae.next()).done)&&(ie.push(xe.value),!(ee&&ie.length===ee));de=!0);}catch(me){be=!0,Se=me}finally{try{!de&&Ae.return&&Ae.return()}finally{if(be)throw Se}}return ie}return function(re,ee){if(Array.isArray(re))return re;if(Symbol.iterator in Object(re))return ae(re,ee);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function ae(re,ee){for(var ie=0;ie<ee.length;ie++){var de=ee[ie];de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(re,de.key,de)}}return function(re,ee,ie){return ee&&ae(re.prototype,ee),ie&&ae(re,ie),re}}(),i=function ae(re,ee,ie){re===null&&(re=Function.prototype);var de=Object.getOwnPropertyDescriptor(re,ee);if(de===void 0){var be=Object.getPrototypeOf(re);return be===null?void 0:ae(be,ee,ie)}else{if("value"in de)return de.value;var Se=de.get;return Se===void 0?void 0:Se.call(ie)}},m=s(0),y=B(m),S=s(8),w=B(S),T=s(4),A=B(T),O=s(16),P=B(O),N=s(13),R=B(N),M=s(25),F=B(M);function B(ae){return ae&&ae.__esModule?ae:{default:ae}}function $(ae,re){if(!(ae instanceof re))throw new TypeError("Cannot call a class as a function")}function W(ae,re){if(!ae)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return re&&(typeof re=="object"||typeof re=="function")?re:ae}function K(ae,re){if(typeof re!="function"&&re!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof re);ae.prototype=Object.create(re&&re.prototype,{constructor:{value:ae,enumerable:!1,writable:!0,configurable:!0}}),re&&(Object.setPrototypeOf?Object.setPrototypeOf(ae,re):ae.__proto__=re)}function te(ae){return ae instanceof A.default||ae instanceof T.BlockEmbed}var ne=function(ae){K(re,ae);function re(ee,ie){$(this,re);var de=W(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,ee));return de.emitter=ie.emitter,Array.isArray(ie.whitelist)&&(de.whitelist=ie.whitelist.reduce(function(be,Se){return be[Se]=!0,be},{})),de.domNode.addEventListener("DOMNodeInserted",function(){}),de.optimize(),de.enable(),de}return d(re,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(ie,de){var be=this.line(ie),Se=o(be,2),Ae=Se[0],xe=Se[1],me=this.line(ie+de),Ce=o(me,1),ge=Ce[0];if(i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"deleteAt",this).call(this,ie,de),ge!=null&&Ae!==ge&&xe>0){if(Ae instanceof T.BlockEmbed||ge instanceof T.BlockEmbed){this.optimize();return}if(Ae instanceof R.default){var pe=Ae.newlineIndex(Ae.length(),!0);if(pe>-1&&(Ae=Ae.split(pe+1),Ae===ge)){this.optimize();return}}else if(ge instanceof R.default){var Oe=ge.newlineIndex(0);Oe>-1&&ge.split(Oe+1)}var Xe=ge.children.head instanceof P.default?null:ge.children.head;Ae.moveChildren(ge,Xe),Ae.remove()}this.optimize()}},{key:"enable",value:function(){var ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",ie)}},{key:"formatAt",value:function(ie,de,be,Se){this.whitelist!=null&&!this.whitelist[be]||(i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"formatAt",this).call(this,ie,de,be,Se),this.optimize())}},{key:"insertAt",value:function(ie,de,be){if(!(be!=null&&this.whitelist!=null&&!this.whitelist[de])){if(ie>=this.length())if(be==null||y.default.query(de,y.default.Scope.BLOCK)==null){var Se=y.default.create(this.statics.defaultChild);this.appendChild(Se),be==null&&de.endsWith(`
`)&&(de=de.slice(0,-1)),Se.insertAt(0,de,be)}else{var Ae=y.default.create(de,be);this.appendChild(Ae)}else i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"insertAt",this).call(this,ie,de,be);this.optimize()}}},{key:"insertBefore",value:function(ie,de){if(ie.statics.scope===y.default.Scope.INLINE_BLOT){var be=y.default.create(this.statics.defaultChild);be.appendChild(ie),ie=be}i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"insertBefore",this).call(this,ie,de)}},{key:"leaf",value:function(ie){return this.path(ie).pop()||[null,-1]}},{key:"line",value:function(ie){return ie===this.length()?this.line(ie-1):this.descendant(te,ie)}},{key:"lines",value:function(){var ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,be=function Se(Ae,xe,me){var Ce=[],ge=me;return Ae.children.forEachAt(xe,me,function(pe,Oe,Xe){te(pe)?Ce.push(pe):pe instanceof y.default.Container&&(Ce=Ce.concat(Se(pe,Oe,ge))),ge-=Xe}),Ce};return be(this,ie,de)}},{key:"optimize",value:function(){var ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch!==!0&&(i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"optimize",this).call(this,ie,de),ie.length>0&&this.emitter.emit(w.default.events.SCROLL_OPTIMIZE,ie,de))}},{key:"path",value:function(ie){return i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"path",this).call(this,ie).slice(1)}},{key:"update",value:function(ie){if(this.batch!==!0){var de=w.default.sources.USER;typeof ie=="string"&&(de=ie),Array.isArray(ie)||(ie=this.observer.takeRecords()),ie.length>0&&this.emitter.emit(w.default.events.SCROLL_BEFORE_UPDATE,de,ie),i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"update",this).call(this,ie.concat([])),ie.length>0&&this.emitter.emit(w.default.events.SCROLL_UPDATE,de,ie)}}}]),re}(y.default.Scroll);ne.blotName="scroll",ne.className="ql-editor",ne.tagName="DIV",ne.defaultChild="block",ne.allowedChildren=[A.default,T.BlockEmbed,F.default],n.default=ne},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.SHORTKEY=n.default=void 0;var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function($e){return typeof $e}:function($e){return $e&&typeof Symbol=="function"&&$e.constructor===Symbol&&$e!==Symbol.prototype?"symbol":typeof $e},d=function(){function $e(Ke,Le){var ke=[],st=!0,_t=!1,Be=void 0;try{for(var Dt=Ke[Symbol.iterator](),It;!(st=(It=Dt.next()).done)&&(ke.push(It.value),!(Le&&ke.length===Le));st=!0);}catch(ir){_t=!0,Be=ir}finally{try{!st&&Dt.return&&Dt.return()}finally{if(_t)throw Be}}return ke}return function(Ke,Le){if(Array.isArray(Ke))return Ke;if(Symbol.iterator in Object(Ke))return $e(Ke,Le);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function $e(Ke,Le){for(var ke=0;ke<Le.length;ke++){var st=Le[ke];st.enumerable=st.enumerable||!1,st.configurable=!0,"value"in st&&(st.writable=!0),Object.defineProperty(Ke,st.key,st)}}return function(Ke,Le,ke){return Le&&$e(Ke.prototype,Le),ke&&$e(Ke,ke),Ke}}(),m=s(21),y=ae(m),S=s(11),w=ae(S),T=s(3),A=ae(T),O=s(2),P=ae(O),N=s(20),R=ae(N),M=s(0),F=ae(M),B=s(5),$=ae(B),W=s(10),K=ae(W),te=s(9),ne=ae(te);function ae($e){return $e&&$e.__esModule?$e:{default:$e}}function re($e,Ke,Le){return Ke in $e?Object.defineProperty($e,Ke,{value:Le,enumerable:!0,configurable:!0,writable:!0}):$e[Ke]=Le,$e}function ee($e,Ke){if(!($e instanceof Ke))throw new TypeError("Cannot call a class as a function")}function ie($e,Ke){if(!$e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ke&&(typeof Ke=="object"||typeof Ke=="function")?Ke:$e}function de($e,Ke){if(typeof Ke!="function"&&Ke!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Ke);$e.prototype=Object.create(Ke&&Ke.prototype,{constructor:{value:$e,enumerable:!1,writable:!0,configurable:!0}}),Ke&&(Object.setPrototypeOf?Object.setPrototypeOf($e,Ke):$e.__proto__=Ke)}var be=(0,K.default)("quill:keyboard"),Se=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",Ae=function($e){de(Ke,$e),i(Ke,null,[{key:"match",value:function(ke,st){return st=We(st),["altKey","ctrlKey","metaKey","shiftKey"].some(function(_t){return!!st[_t]!==ke[_t]&&st[_t]!==null})?!1:st.key===(ke.which||ke.keyCode)}}]);function Ke(Le,ke){ee(this,Ke);var st=ie(this,(Ke.__proto__||Object.getPrototypeOf(Ke)).call(this,Le,ke));return st.bindings={},Object.keys(st.options.bindings).forEach(function(_t){_t==="list autofill"&&Le.scroll.whitelist!=null&&!Le.scroll.whitelist.list||st.options.bindings[_t]&&st.addBinding(st.options.bindings[_t])}),st.addBinding({key:Ke.keys.ENTER,shiftKey:null},pe),st.addBinding({key:Ke.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},function(){}),/Firefox/i.test(navigator.userAgent)?(st.addBinding({key:Ke.keys.BACKSPACE},{collapsed:!0},me),st.addBinding({key:Ke.keys.DELETE},{collapsed:!0},Ce)):(st.addBinding({key:Ke.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},me),st.addBinding({key:Ke.keys.DELETE},{collapsed:!0,suffix:/^.?$/},Ce)),st.addBinding({key:Ke.keys.BACKSPACE},{collapsed:!1},ge),st.addBinding({key:Ke.keys.DELETE},{collapsed:!1},ge),st.addBinding({key:Ke.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},me),st.listen(),st}return i(Ke,[{key:"addBinding",value:function(ke){var st=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},Be=We(ke);if(Be==null||Be.key==null)return be.warn("Attempted to add invalid keyboard binding",Be);typeof st=="function"&&(st={handler:st}),typeof _t=="function"&&(_t={handler:_t}),Be=(0,A.default)(Be,st,_t),this.bindings[Be.key]=this.bindings[Be.key]||[],this.bindings[Be.key].push(Be)}},{key:"listen",value:function(){var ke=this;this.quill.root.addEventListener("keydown",function(st){if(!st.defaultPrevented){var _t=st.which||st.keyCode,Be=(ke.bindings[_t]||[]).filter(function(Gn){return Ke.match(st,Gn)});if(Be.length!==0){var Dt=ke.quill.getSelection();if(!(Dt==null||!ke.quill.hasFocus())){var It=ke.quill.getLine(Dt.index),ir=d(It,2),Dr=ir[0],Rr=ir[1],jt=ke.quill.getLeaf(Dt.index),zt=d(jt,2),Je=zt[0],pt=zt[1],rt=Dt.length===0?[Je,pt]:ke.quill.getLeaf(Dt.index+Dt.length),Kt=d(rt,2),Ut=Kt[0],Ht=Kt[1],Cr=Je instanceof F.default.Text?Je.value().slice(0,pt):"",un=Ut instanceof F.default.Text?Ut.value().slice(Ht):"",hn={collapsed:Dt.length===0,empty:Dt.length===0&&Dr.length()<=1,format:ke.quill.getFormat(Dt),offset:Rr,prefix:Cr,suffix:un},Kn=Be.some(function(Gn){if(Gn.collapsed!=null&&Gn.collapsed!==hn.collapsed||Gn.empty!=null&&Gn.empty!==hn.empty||Gn.offset!=null&&Gn.offset!==hn.offset)return!1;if(Array.isArray(Gn.format)){if(Gn.format.every(function(Mi){return hn.format[Mi]==null}))return!1}else if(o(Gn.format)==="object"&&!Object.keys(Gn.format).every(function(Mi){return Gn.format[Mi]===!0?hn.format[Mi]!=null:Gn.format[Mi]===!1?hn.format[Mi]==null:(0,w.default)(Gn.format[Mi],hn.format[Mi])}))return!1;return Gn.prefix!=null&&!Gn.prefix.test(hn.prefix)||Gn.suffix!=null&&!Gn.suffix.test(hn.suffix)?!1:Gn.handler.call(ke,Dt,hn)!==!0});Kn&&st.preventDefault()}}}})}}]),Ke}(ne.default);Ae.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},Ae.DEFAULTS={bindings:{bold:Xe("bold"),italic:Xe("italic"),underline:Xe("underline"),indent:{key:Ae.keys.TAB,format:["blockquote","indent","list"],handler:function(Ke,Le){if(Le.collapsed&&Le.offset!==0)return!0;this.quill.format("indent","+1",$.default.sources.USER)}},outdent:{key:Ae.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(Ke,Le){if(Le.collapsed&&Le.offset!==0)return!0;this.quill.format("indent","-1",$.default.sources.USER)}},"outdent backspace":{key:Ae.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(Ke,Le){Le.format.indent!=null?this.quill.format("indent","-1",$.default.sources.USER):Le.format.list!=null&&this.quill.format("list",!1,$.default.sources.USER)}},"indent code-block":Oe(!0),"outdent code-block":Oe(!1),"remove tab":{key:Ae.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(Ke){this.quill.deleteText(Ke.index-1,1,$.default.sources.USER)}},tab:{key:Ae.keys.TAB,handler:function(Ke){this.quill.history.cutoff();var Le=new P.default().retain(Ke.index).delete(Ke.length).insert("	");this.quill.updateContents(Le,$.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(Ke.index+1,$.default.sources.SILENT)}},"list empty enter":{key:Ae.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(Ke,Le){this.quill.format("list",!1,$.default.sources.USER),Le.format.indent&&this.quill.format("indent",!1,$.default.sources.USER)}},"checklist enter":{key:Ae.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(Ke){var Le=this.quill.getLine(Ke.index),ke=d(Le,2),st=ke[0],_t=ke[1],Be=(0,A.default)({},st.formats(),{list:"checked"}),Dt=new P.default().retain(Ke.index).insert(`
`,Be).retain(st.length()-_t-1).retain(1,{list:"unchecked"});this.quill.updateContents(Dt,$.default.sources.USER),this.quill.setSelection(Ke.index+1,$.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:Ae.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(Ke,Le){var ke=this.quill.getLine(Ke.index),st=d(ke,2),_t=st[0],Be=st[1],Dt=new P.default().retain(Ke.index).insert(`
`,Le.format).retain(_t.length()-Be-1).retain(1,{header:null});this.quill.updateContents(Dt,$.default.sources.USER),this.quill.setSelection(Ke.index+1,$.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(Ke,Le){var ke=Le.prefix.length,st=this.quill.getLine(Ke.index),_t=d(st,2),Be=_t[0],Dt=_t[1];if(Dt>ke)return!0;var It=void 0;switch(Le.prefix.trim()){case"[]":case"[ ]":It="unchecked";break;case"[x]":It="checked";break;case"-":case"*":It="bullet";break;default:It="ordered"}this.quill.insertText(Ke.index," ",$.default.sources.USER),this.quill.history.cutoff();var ir=new P.default().retain(Ke.index-Dt).delete(ke+1).retain(Be.length()-2-Dt).retain(1,{list:It});this.quill.updateContents(ir,$.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(Ke.index-ke,$.default.sources.SILENT)}},"code exit":{key:Ae.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(Ke){var Le=this.quill.getLine(Ke.index),ke=d(Le,2),st=ke[0],_t=ke[1],Be=new P.default().retain(Ke.index+st.length()-_t-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(Be,$.default.sources.USER)}},"embed left":xe(Ae.keys.LEFT,!1),"embed left shift":xe(Ae.keys.LEFT,!0),"embed right":xe(Ae.keys.RIGHT,!1),"embed right shift":xe(Ae.keys.RIGHT,!0)}};function xe($e,Ke){var Le,ke=$e===Ae.keys.LEFT?"prefix":"suffix";return Le={key:$e,shiftKey:Ke,altKey:null},re(Le,ke,/^$/),re(Le,"handler",function(_t){var Be=_t.index;$e===Ae.keys.RIGHT&&(Be+=_t.length+1);var Dt=this.quill.getLeaf(Be),It=d(Dt,1),ir=It[0];return ir instanceof F.default.Embed?($e===Ae.keys.LEFT?Ke?this.quill.setSelection(_t.index-1,_t.length+1,$.default.sources.USER):this.quill.setSelection(_t.index-1,$.default.sources.USER):Ke?this.quill.setSelection(_t.index,_t.length+1,$.default.sources.USER):this.quill.setSelection(_t.index+_t.length+1,$.default.sources.USER),!1):!0}),Le}function me($e,Ke){if(!($e.index===0||this.quill.getLength()<=1)){var Le=this.quill.getLine($e.index),ke=d(Le,1),st=ke[0],_t={};if(Ke.offset===0){var Be=this.quill.getLine($e.index-1),Dt=d(Be,1),It=Dt[0];if(It!=null&&It.length()>1){var ir=st.formats(),Dr=this.quill.getFormat($e.index-1,1);_t=R.default.attributes.diff(ir,Dr)||{}}}var Rr=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(Ke.prefix)?2:1;this.quill.deleteText($e.index-Rr,Rr,$.default.sources.USER),Object.keys(_t).length>0&&this.quill.formatLine($e.index-Rr,Rr,_t,$.default.sources.USER),this.quill.focus()}}function Ce($e,Ke){var Le=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(Ke.suffix)?2:1;if(!($e.index>=this.quill.getLength()-Le)){var ke={},st=0,_t=this.quill.getLine($e.index),Be=d(_t,1),Dt=Be[0];if(Ke.offset>=Dt.length()-1){var It=this.quill.getLine($e.index+1),ir=d(It,1),Dr=ir[0];if(Dr){var Rr=Dt.formats(),jt=this.quill.getFormat($e.index,1);ke=R.default.attributes.diff(Rr,jt)||{},st=Dr.length()}}this.quill.deleteText($e.index,Le,$.default.sources.USER),Object.keys(ke).length>0&&this.quill.formatLine($e.index+st-1,Le,ke,$.default.sources.USER)}}function ge($e){var Ke=this.quill.getLines($e),Le={};if(Ke.length>1){var ke=Ke[0].formats(),st=Ke[Ke.length-1].formats();Le=R.default.attributes.diff(st,ke)||{}}this.quill.deleteText($e,$.default.sources.USER),Object.keys(Le).length>0&&this.quill.formatLine($e.index,1,Le,$.default.sources.USER),this.quill.setSelection($e.index,$.default.sources.SILENT),this.quill.focus()}function pe($e,Ke){var Le=this;$e.length>0&&this.quill.scroll.deleteAt($e.index,$e.length);var ke=Object.keys(Ke.format).reduce(function(st,_t){return F.default.query(_t,F.default.Scope.BLOCK)&&!Array.isArray(Ke.format[_t])&&(st[_t]=Ke.format[_t]),st},{});this.quill.insertText($e.index,`
`,ke,$.default.sources.USER),this.quill.setSelection($e.index+1,$.default.sources.SILENT),this.quill.focus(),Object.keys(Ke.format).forEach(function(st){ke[st]==null&&(Array.isArray(Ke.format[st])||st!=="link"&&Le.quill.format(st,Ke.format[st],$.default.sources.USER))})}function Oe($e){return{key:Ae.keys.TAB,shiftKey:!$e,format:{"code-block":!0},handler:function(Le){var ke=F.default.query("code-block"),st=Le.index,_t=Le.length,Be=this.quill.scroll.descendant(ke,st),Dt=d(Be,2),It=Dt[0],ir=Dt[1];if(It!=null){var Dr=this.quill.getIndex(It),Rr=It.newlineIndex(ir,!0)+1,jt=It.newlineIndex(Dr+ir+_t),zt=It.domNode.textContent.slice(Rr,jt).split(`
`);ir=0,zt.forEach(function(Je,pt){$e?(It.insertAt(Rr+ir,ke.TAB),ir+=ke.TAB.length,pt===0?st+=ke.TAB.length:_t+=ke.TAB.length):Je.startsWith(ke.TAB)&&(It.deleteAt(Rr+ir,ke.TAB.length),ir-=ke.TAB.length,pt===0?st-=ke.TAB.length:_t-=ke.TAB.length),ir+=Je.length+1}),this.quill.update($.default.sources.USER),this.quill.setSelection(st,_t,$.default.sources.SILENT)}}}}function Xe($e){return{key:$e[0].toUpperCase(),shortKey:!0,handler:function(Le,ke){this.quill.format($e,!ke.format[$e],$.default.sources.USER)}}}function We($e){if(typeof $e=="string"||typeof $e=="number")return We({key:$e});if((typeof $e>"u"?"undefined":o($e))==="object"&&($e=(0,y.default)($e,!1)),typeof $e.key=="string")if(Ae.keys[$e.key.toUpperCase()]!=null)$e.key=Ae.keys[$e.key.toUpperCase()];else if($e.key.length===1)$e.key=$e.key.toUpperCase().charCodeAt(0);else return null;return $e.shortKey&&($e[Se]=$e.shortKey,delete $e.shortKey),$e}n.default=Ae,n.SHORTKEY=Se},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function R(M,F){var B=[],$=!0,W=!1,K=void 0;try{for(var te=M[Symbol.iterator](),ne;!($=(ne=te.next()).done)&&(B.push(ne.value),!(F&&B.length===F));$=!0);}catch(ae){W=!0,K=ae}finally{try{!$&&te.return&&te.return()}finally{if(W)throw K}}return B}return function(M,F){if(Array.isArray(M))return M;if(Symbol.iterator in Object(M))return R(M,F);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function R(M,F,B){M===null&&(M=Function.prototype);var $=Object.getOwnPropertyDescriptor(M,F);if($===void 0){var W=Object.getPrototypeOf(M);return W===null?void 0:R(W,F,B)}else{if("value"in $)return $.value;var K=$.get;return K===void 0?void 0:K.call(B)}},i=function(){function R(M,F){for(var B=0;B<F.length;B++){var $=F[B];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(M,$.key,$)}}return function(M,F,B){return F&&R(M.prototype,F),B&&R(M,B),M}}(),m=s(0),y=T(m),S=s(7),w=T(S);function T(R){return R&&R.__esModule?R:{default:R}}function A(R,M){if(!(R instanceof M))throw new TypeError("Cannot call a class as a function")}function O(R,M){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:R}function P(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);R.prototype=Object.create(M&&M.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(R,M):R.__proto__=M)}var N=function(R){P(M,R),i(M,null,[{key:"value",value:function(){}}]);function M(F,B){A(this,M);var $=O(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,F));return $.selection=B,$.textNode=document.createTextNode(M.CONTENTS),$.domNode.appendChild($.textNode),$._length=0,$}return i(M,[{key:"detach",value:function(){this.parent!=null&&this.parent.removeChild(this)}},{key:"format",value:function(B,$){if(this._length!==0)return d(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"format",this).call(this,B,$);for(var W=this,K=0;W!=null&&W.statics.scope!==y.default.Scope.BLOCK_BLOT;)K+=W.offset(W.parent),W=W.parent;W!=null&&(this._length=M.CONTENTS.length,W.optimize(),W.formatAt(K,M.CONTENTS.length,B,$),this._length=0)}},{key:"index",value:function(B,$){return B===this.textNode?0:d(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"index",this).call(this,B,$)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){d(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!(this.selection.composing||this.parent==null)){var B=this.textNode,$=this.selection.getNativeRange(),W=void 0,K=void 0,te=void 0;if($!=null&&$.start.node===B&&$.end.node===B){var ne=[B,$.start.offset,$.end.offset];W=ne[0],K=ne[1],te=ne[2]}for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==M.CONTENTS){var ae=this.textNode.data.split(M.CONTENTS).join("");this.next instanceof w.default?(W=this.next.domNode,this.next.insertAt(0,ae),this.textNode.data=M.CONTENTS):(this.textNode.data=ae,this.parent.insertBefore(y.default.create(this.textNode),this),this.textNode=document.createTextNode(M.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),K!=null){var re=[K,te].map(function(ie){return Math.max(0,Math.min(W.data.length,ie-1))}),ee=o(re,2);return K=ee[0],te=ee[1],{startNode:W,startOffset:K,endNode:W,endOffset:te}}}}},{key:"update",value:function(B,$){var W=this;if(B.some(function(te){return te.type==="characterData"&&te.target===W.textNode})){var K=this.restore();K&&($.range=K)}}},{key:"value",value:function(){return""}}]),M}(y.default.Embed);N.blotName="cursor",N.className="ql-cursor",N.tagName="span",N.CONTENTS="\uFEFF",n.default=N},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),d=y(o),i=s(4),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function w(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),w(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return P}(d.default.Container);A.allowedChildren=[m.default,i.BlockEmbed,A],n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.ColorStyle=n.ColorClass=n.ColorAttributor=void 0;var o=function(){function N(R,M){for(var F=0;F<M.length;F++){var B=M[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(R,B.key,B)}}return function(R,M,F){return M&&N(R.prototype,M),F&&N(R,F),R}}(),d=function N(R,M,F){R===null&&(R=Function.prototype);var B=Object.getOwnPropertyDescriptor(R,M);if(B===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:N($,M,F)}else{if("value"in B)return B.value;var W=B.get;return W===void 0?void 0:W.call(F)}},i=s(0),m=y(i);function y(N){return N&&N.__esModule?N:{default:N}}function S(N,R){if(!(N instanceof R))throw new TypeError("Cannot call a class as a function")}function w(N,R){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:N}function T(N,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);N.prototype=Object.create(R&&R.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(N,R):N.__proto__=R)}var A=function(N){T(R,N);function R(){return S(this,R),w(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"value",value:function(F){var B=d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"value",this).call(this,F);return B.startsWith("rgb(")?(B=B.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),"#"+B.split(",").map(function($){return("00"+parseInt($).toString(16)).slice(-2)}).join("")):B}}]),R}(m.default.Attributor.Style),O=new m.default.Attributor.Class("color","ql-color",{scope:m.default.Scope.INLINE}),P=new A("color","color",{scope:m.default.Scope.INLINE});n.ColorAttributor=A,n.ColorClass=O,n.ColorStyle=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitize=n.default=void 0;var o=function(){function P(N,R){for(var M=0;M<R.length;M++){var F=R[M];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}return function(N,R,M){return R&&P(N.prototype,R),M&&P(N,M),N}}(),d=function P(N,R,M){N===null&&(N=Function.prototype);var F=Object.getOwnPropertyDescriptor(N,R);if(F===void 0){var B=Object.getPrototypeOf(N);return B===null?void 0:P(B,R,M)}else{if("value"in F)return F.value;var $=F.get;return $===void 0?void 0:$.call(M)}},i=s(6),m=y(i);function y(P){return P&&P.__esModule?P:{default:P}}function S(P,N){if(!(P instanceof N))throw new TypeError("Cannot call a class as a function")}function w(P,N){if(!P)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N&&(typeof N=="object"||typeof N=="function")?N:P}function T(P,N){if(typeof N!="function"&&N!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof N);P.prototype=Object.create(N&&N.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),N&&(Object.setPrototypeOf?Object.setPrototypeOf(P,N):P.__proto__=N)}var A=function(P){T(N,P);function N(){return S(this,N),w(this,(N.__proto__||Object.getPrototypeOf(N)).apply(this,arguments))}return o(N,[{key:"format",value:function(M,F){if(M!==this.statics.blotName||!F)return d(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"format",this).call(this,M,F);F=this.constructor.sanitize(F),this.domNode.setAttribute("href",F)}}],[{key:"create",value:function(M){var F=d(N.__proto__||Object.getPrototypeOf(N),"create",this).call(this,M);return M=this.sanitize(M),F.setAttribute("href",M),F.setAttribute("rel","noopener noreferrer"),F.setAttribute("target","_blank"),F}},{key:"formats",value:function(M){return M.getAttribute("href")}},{key:"sanitize",value:function(M){return O(M,this.PROTOCOL_WHITELIST)?M:this.SANITIZED_URL}}]),N}(m.default);A.blotName="link",A.tagName="A",A.SANITIZED_URL="about:blank",A.PROTOCOL_WHITELIST=["http","https","mailto","tel"];function O(P,N){var R=document.createElement("a");R.href=P;var M=R.href.slice(0,R.href.indexOf(":"));return N.indexOf(M)>-1}n.default=A,n.sanitize=O},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(N){return typeof N}:function(N){return N&&typeof Symbol=="function"&&N.constructor===Symbol&&N!==Symbol.prototype?"symbol":typeof N},d=function(){function N(R,M){for(var F=0;F<M.length;F++){var B=M[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(R,B.key,B)}}return function(R,M,F){return M&&N(R.prototype,M),F&&N(R,F),R}}(),i=s(23),m=w(i),y=s(107),S=w(y);function w(N){return N&&N.__esModule?N:{default:N}}function T(N,R){if(!(N instanceof R))throw new TypeError("Cannot call a class as a function")}var A=0;function O(N,R){N.setAttribute(R,N.getAttribute(R)!=="true")}var P=function(){function N(R){var M=this;T(this,N),this.select=R,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",function(){M.togglePicker()}),this.label.addEventListener("keydown",function(F){switch(F.keyCode){case m.default.keys.ENTER:M.togglePicker();break;case m.default.keys.ESCAPE:M.escape(),F.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}return d(N,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),O(this.label,"aria-expanded"),O(this.options,"aria-hidden")}},{key:"buildItem",value:function(M){var F=this,B=document.createElement("span");return B.tabIndex="0",B.setAttribute("role","button"),B.classList.add("ql-picker-item"),M.hasAttribute("value")&&B.setAttribute("data-value",M.getAttribute("value")),M.textContent&&B.setAttribute("data-label",M.textContent),B.addEventListener("click",function(){F.selectItem(B,!0)}),B.addEventListener("keydown",function($){switch($.keyCode){case m.default.keys.ENTER:F.selectItem(B,!0),$.preventDefault();break;case m.default.keys.ESCAPE:F.escape(),$.preventDefault();break}}),B}},{key:"buildLabel",value:function(){var M=document.createElement("span");return M.classList.add("ql-picker-label"),M.innerHTML=S.default,M.tabIndex="0",M.setAttribute("role","button"),M.setAttribute("aria-expanded","false"),this.container.appendChild(M),M}},{key:"buildOptions",value:function(){var M=this,F=document.createElement("span");F.classList.add("ql-picker-options"),F.setAttribute("aria-hidden","true"),F.tabIndex="-1",F.id="ql-picker-options-"+A,A+=1,this.label.setAttribute("aria-controls",F.id),this.options=F,[].slice.call(this.select.options).forEach(function(B){var $=M.buildItem(B);F.appendChild($),B.selected===!0&&M.selectItem($)}),this.container.appendChild(F)}},{key:"buildPicker",value:function(){var M=this;[].slice.call(this.select.attributes).forEach(function(F){M.container.setAttribute(F.name,F.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var M=this;this.close(),setTimeout(function(){return M.label.focus()},1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(M){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,B=this.container.querySelector(".ql-selected");if(M!==B&&(B!=null&&B.classList.remove("ql-selected"),M!=null&&(M.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(M.parentNode.children,M),M.hasAttribute("data-value")?this.label.setAttribute("data-value",M.getAttribute("data-value")):this.label.removeAttribute("data-value"),M.hasAttribute("data-label")?this.label.setAttribute("data-label",M.getAttribute("data-label")):this.label.removeAttribute("data-label"),F))){if(typeof Event=="function")this.select.dispatchEvent(new Event("change"));else if((typeof Event>"u"?"undefined":o(Event))==="object"){var $=document.createEvent("Event");$.initEvent("change",!0,!0),this.select.dispatchEvent($)}this.close()}}},{key:"update",value:function(){var M=void 0;if(this.select.selectedIndex>-1){var F=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];M=this.select.options[this.select.selectedIndex],this.selectItem(F)}else this.selectItem(null);var B=M!=null&&M!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",B)}}]),N}();n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),d=be(o),i=s(5),m=be(i),y=s(4),S=be(y),w=s(16),T=be(w),A=s(25),O=be(A),P=s(24),N=be(P),R=s(35),M=be(R),F=s(6),B=be(F),$=s(22),W=be($),K=s(7),te=be(K),ne=s(55),ae=be(ne),re=s(42),ee=be(re),ie=s(23),de=be(ie);function be(Se){return Se&&Se.__esModule?Se:{default:Se}}m.default.register({"blots/block":S.default,"blots/block/embed":y.BlockEmbed,"blots/break":T.default,"blots/container":O.default,"blots/cursor":N.default,"blots/embed":M.default,"blots/inline":B.default,"blots/scroll":W.default,"blots/text":te.default,"modules/clipboard":ae.default,"modules/history":ee.default,"modules/keyboard":de.default}),d.default.register(S.default,T.default,N.default,B.default,W.default,te.default),n.default=m.default},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(1),d=function(){function i(m){this.domNode=m,this.domNode[o.DATA_KEY]={blot:this}}return Object.defineProperty(i.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),i.create=function(m){if(this.tagName==null)throw new o.ParchmentError("Blot definition missing tagName");var y;return Array.isArray(this.tagName)?(typeof m=="string"&&(m=m.toUpperCase(),parseInt(m).toString()===m&&(m=parseInt(m))),typeof m=="number"?y=document.createElement(this.tagName[m-1]):this.tagName.indexOf(m)>-1?y=document.createElement(m):y=document.createElement(this.tagName[0])):y=document.createElement(this.tagName),this.className&&y.classList.add(this.className),y},i.prototype.attach=function(){this.parent!=null&&(this.scroll=this.parent.scroll)},i.prototype.clone=function(){var m=this.domNode.cloneNode(!1);return o.create(m)},i.prototype.detach=function(){this.parent!=null&&this.parent.removeChild(this),delete this.domNode[o.DATA_KEY]},i.prototype.deleteAt=function(m,y){var S=this.isolate(m,y);S.remove()},i.prototype.formatAt=function(m,y,S,w){var T=this.isolate(m,y);if(o.query(S,o.Scope.BLOT)!=null&&w)T.wrap(S,w);else if(o.query(S,o.Scope.ATTRIBUTE)!=null){var A=o.create(this.statics.scope);T.wrap(A),A.format(S,w)}},i.prototype.insertAt=function(m,y,S){var w=S==null?o.create("text",y):o.create(y,S),T=this.split(m);this.parent.insertBefore(w,T)},i.prototype.insertInto=function(m,y){y===void 0&&(y=null),this.parent!=null&&this.parent.children.remove(this);var S=null;m.children.insertBefore(this,y),y!=null&&(S=y.domNode),(this.domNode.parentNode!=m.domNode||this.domNode.nextSibling!=S)&&m.domNode.insertBefore(this.domNode,S),this.parent=m,this.attach()},i.prototype.isolate=function(m,y){var S=this.split(m);return S.split(y),S},i.prototype.length=function(){return 1},i.prototype.offset=function(m){return m===void 0&&(m=this.parent),this.parent==null||this==m?0:this.parent.children.offset(this)+this.parent.offset(m)},i.prototype.optimize=function(m){this.domNode[o.DATA_KEY]!=null&&delete this.domNode[o.DATA_KEY].mutations},i.prototype.remove=function(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},i.prototype.replace=function(m){m.parent!=null&&(m.parent.insertBefore(this,m.next),m.remove())},i.prototype.replaceWith=function(m,y){var S=typeof m=="string"?o.create(m,y):m;return S.replace(this),S},i.prototype.split=function(m,y){return m===0?this:this.next},i.prototype.update=function(m,y){},i.prototype.wrap=function(m,y){var S=typeof m=="string"?o.create(m,y):m;return this.parent!=null&&this.parent.insertBefore(S,this.next),S.appendChild(this),S},i.blotName="abstract",i}();n.default=d},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(12),d=s(32),i=s(33),m=s(1),y=function(){function S(w){this.attributes={},this.domNode=w,this.build()}return S.prototype.attribute=function(w,T){T?w.add(this.domNode,T)&&(w.value(this.domNode)!=null?this.attributes[w.attrName]=w:delete this.attributes[w.attrName]):(w.remove(this.domNode),delete this.attributes[w.attrName])},S.prototype.build=function(){var w=this;this.attributes={};var T=o.default.keys(this.domNode),A=d.default.keys(this.domNode),O=i.default.keys(this.domNode);T.concat(A).concat(O).forEach(function(P){var N=m.query(P,m.Scope.ATTRIBUTE);N instanceof o.default&&(w.attributes[N.attrName]=N)})},S.prototype.copy=function(w){var T=this;Object.keys(this.attributes).forEach(function(A){var O=T.attributes[A].value(T.domNode);w.format(A,O)})},S.prototype.move=function(w){var T=this;this.copy(w),Object.keys(this.attributes).forEach(function(A){T.attributes[A].remove(T.domNode)}),this.attributes={}},S.prototype.values=function(){var w=this;return Object.keys(this.attributes).reduce(function(T,A){return T[A]=w.attributes[A].value(w.domNode),T},{})},S}();n.default=y},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,w){S.__proto__=w}||function(S,w){for(var T in w)w.hasOwnProperty(T)&&(S[T]=w[T])};return function(S,w){y(S,w);function T(){this.constructor=S}S.prototype=w===null?Object.create(w):(T.prototype=w.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(12);function i(y,S){var w=y.getAttribute("class")||"";return w.split(/\s+/).filter(function(T){return T.indexOf(S+"-")===0})}var m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.keys=function(w){return(w.getAttribute("class")||"").split(/\s+/).map(function(T){return T.split("-").slice(0,-1).join("-")})},S.prototype.add=function(w,T){return this.canAdd(w,T)?(this.remove(w),w.classList.add(this.keyName+"-"+T),!0):!1},S.prototype.remove=function(w){var T=i(w,this.keyName);T.forEach(function(A){w.classList.remove(A)}),w.classList.length===0&&w.removeAttribute("class")},S.prototype.value=function(w){var T=i(w,this.keyName)[0]||"",A=T.slice(this.keyName.length+1);return this.canAdd(w,A)?A:""},S}(d.default);n.default=m},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,w){S.__proto__=w}||function(S,w){for(var T in w)w.hasOwnProperty(T)&&(S[T]=w[T])};return function(S,w){y(S,w);function T(){this.constructor=S}S.prototype=w===null?Object.create(w):(T.prototype=w.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(12);function i(y){var S=y.split("-"),w=S.slice(1).map(function(T){return T[0].toUpperCase()+T.slice(1)}).join("");return S[0]+w}var m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.keys=function(w){return(w.getAttribute("style")||"").split(";").map(function(T){var A=T.split(":");return A[0].trim()})},S.prototype.add=function(w,T){return this.canAdd(w,T)?(w.style[i(this.keyName)]=T,!0):!1},S.prototype.remove=function(w){w.style[i(this.keyName)]="",w.getAttribute("style")||w.removeAttribute("style")},S.prototype.value=function(w){var T=w.style[i(this.keyName)];return this.canAdd(w,T)?T:""},S}(d.default);n.default=m},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function m(y,S){for(var w=0;w<S.length;w++){var T=S[w];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}return function(y,S,w){return S&&m(y.prototype,S),w&&m(y,w),y}}();function d(m,y){if(!(m instanceof y))throw new TypeError("Cannot call a class as a function")}var i=function(){function m(y,S){d(this,m),this.quill=y,this.options=S,this.modules={}}return o(m,[{key:"init",value:function(){var S=this;Object.keys(this.options.modules).forEach(function(w){S.modules[w]==null&&S.addModule(w)})}},{key:"addModule",value:function(S){var w=this.quill.constructor.import("modules/"+S);return this.modules[S]=new w(this.quill,this.options.modules[S]||{}),this.modules[S]}}]),m}();i.DEFAULTS={modules:{}},i.themes={default:i},n.default=i},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function R(M,F){for(var B=0;B<F.length;B++){var $=F[B];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(M,$.key,$)}}return function(M,F,B){return F&&R(M.prototype,F),B&&R(M,B),M}}(),d=function R(M,F,B){M===null&&(M=Function.prototype);var $=Object.getOwnPropertyDescriptor(M,F);if($===void 0){var W=Object.getPrototypeOf(M);return W===null?void 0:R(W,F,B)}else{if("value"in $)return $.value;var K=$.get;return K===void 0?void 0:K.call(B)}},i=s(0),m=w(i),y=s(7),S=w(y);function w(R){return R&&R.__esModule?R:{default:R}}function T(R,M){if(!(R instanceof M))throw new TypeError("Cannot call a class as a function")}function A(R,M){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:R}function O(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);R.prototype=Object.create(M&&M.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(R,M):R.__proto__=M)}var P="\uFEFF",N=function(R){O(M,R);function M(F){T(this,M);var B=A(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,F));return B.contentNode=document.createElement("span"),B.contentNode.setAttribute("contenteditable",!1),[].slice.call(B.domNode.childNodes).forEach(function($){B.contentNode.appendChild($)}),B.leftGuard=document.createTextNode(P),B.rightGuard=document.createTextNode(P),B.domNode.appendChild(B.leftGuard),B.domNode.appendChild(B.contentNode),B.domNode.appendChild(B.rightGuard),B}return o(M,[{key:"index",value:function(B,$){return B===this.leftGuard?0:B===this.rightGuard?1:d(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"index",this).call(this,B,$)}},{key:"restore",value:function(B){var $=void 0,W=void 0,K=B.data.split(P).join("");if(B===this.leftGuard)if(this.prev instanceof S.default){var te=this.prev.length();this.prev.insertAt(te,K),$={startNode:this.prev.domNode,startOffset:te+K.length}}else W=document.createTextNode(K),this.parent.insertBefore(m.default.create(W),this),$={startNode:W,startOffset:K.length};else B===this.rightGuard&&(this.next instanceof S.default?(this.next.insertAt(0,K),$={startNode:this.next.domNode,startOffset:K.length}):(W=document.createTextNode(K),this.parent.insertBefore(m.default.create(W),this.next),$={startNode:W,startOffset:K.length}));return B.data=P,$}},{key:"update",value:function(B,$){var W=this;B.forEach(function(K){if(K.type==="characterData"&&(K.target===W.leftGuard||K.target===W.rightGuard)){var te=W.restore(K.target);te&&($.range=te)}})}}]),M}(m.default.Embed);n.default=N},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.AlignStyle=n.AlignClass=n.AlignAttribute=void 0;var o=s(0),d=i(o);function i(T){return T&&T.__esModule?T:{default:T}}var m={scope:d.default.Scope.BLOCK,whitelist:["right","center","justify"]},y=new d.default.Attributor.Attribute("align","align",m),S=new d.default.Attributor.Class("align","ql-align",m),w=new d.default.Attributor.Style("align","text-align",m);n.AlignAttribute=y,n.AlignClass=S,n.AlignStyle=w},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundStyle=n.BackgroundClass=void 0;var o=s(0),d=m(o),i=s(26);function m(w){return w&&w.__esModule?w:{default:w}}var y=new d.default.Attributor.Class("background","ql-bg",{scope:d.default.Scope.INLINE}),S=new i.ColorAttributor("background","background-color",{scope:d.default.Scope.INLINE});n.BackgroundClass=y,n.BackgroundStyle=S},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.DirectionStyle=n.DirectionClass=n.DirectionAttribute=void 0;var o=s(0),d=i(o);function i(T){return T&&T.__esModule?T:{default:T}}var m={scope:d.default.Scope.BLOCK,whitelist:["rtl"]},y=new d.default.Attributor.Attribute("direction","dir",m),S=new d.default.Attributor.Class("direction","ql-direction",m),w=new d.default.Attributor.Style("direction","direction",m);n.DirectionAttribute=y,n.DirectionClass=S,n.DirectionStyle=w},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.FontClass=n.FontStyle=void 0;var o=function(){function R(M,F){for(var B=0;B<F.length;B++){var $=F[B];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(M,$.key,$)}}return function(M,F,B){return F&&R(M.prototype,F),B&&R(M,B),M}}(),d=function R(M,F,B){M===null&&(M=Function.prototype);var $=Object.getOwnPropertyDescriptor(M,F);if($===void 0){var W=Object.getPrototypeOf(M);return W===null?void 0:R(W,F,B)}else{if("value"in $)return $.value;var K=$.get;return K===void 0?void 0:K.call(B)}},i=s(0),m=y(i);function y(R){return R&&R.__esModule?R:{default:R}}function S(R,M){if(!(R instanceof M))throw new TypeError("Cannot call a class as a function")}function w(R,M){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:R}function T(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);R.prototype=Object.create(M&&M.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(R,M):R.__proto__=M)}var A={scope:m.default.Scope.INLINE,whitelist:["serif","monospace"]},O=new m.default.Attributor.Class("font","ql-font",A),P=function(R){T(M,R);function M(){return S(this,M),w(this,(M.__proto__||Object.getPrototypeOf(M)).apply(this,arguments))}return o(M,[{key:"value",value:function(B){return d(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"value",this).call(this,B).replace(/["']/g,"")}}]),M}(m.default.Attributor.Style),N=new P("font","font-family",A);n.FontStyle=N,n.FontClass=O},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.SizeStyle=n.SizeClass=void 0;var o=s(0),d=i(o);function i(S){return S&&S.__esModule?S:{default:S}}var m=new d.default.Attributor.Class("size","ql-size",{scope:d.default.Scope.INLINE,whitelist:["small","large","huge"]}),y=new d.default.Attributor.Style("size","font-size",{scope:d.default.Scope.INLINE,whitelist:["10px","18px","32px"]});n.SizeClass=m,n.SizeStyle=y},function(r,n,s){r.exports={align:{"":s(76),center:s(77),right:s(78),justify:s(79)},background:s(80),blockquote:s(81),bold:s(82),clean:s(83),code:s(58),"code-block":s(58),color:s(84),direction:{"":s(85),rtl:s(86)},float:{center:s(87),full:s(88),left:s(89),right:s(90)},formula:s(91),header:{1:s(92),2:s(93)},italic:s(94),image:s(95),indent:{"+1":s(96),"-1":s(97)},link:s(98),list:{ordered:s(99),bullet:s(100),check:s(101)},script:{sub:s(102),super:s(103)},strike:s(104),underline:s(105),video:s(106)}},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.getLastChangeIndex=n.default=void 0;var o=function(){function F(B,$){for(var W=0;W<$.length;W++){var K=$[W];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(B,K.key,K)}}return function(B,$,W){return $&&F(B.prototype,$),W&&F(B,W),B}}(),d=s(0),i=T(d),m=s(5),y=T(m),S=s(9),w=T(S);function T(F){return F&&F.__esModule?F:{default:F}}function A(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function O(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function P(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var N=function(F){P(B,F);function B($,W){A(this,B);var K=O(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,$,W));return K.lastRecorded=0,K.ignoreChange=!1,K.clear(),K.quill.on(y.default.events.EDITOR_CHANGE,function(te,ne,ae,re){te!==y.default.events.TEXT_CHANGE||K.ignoreChange||(!K.options.userOnly||re===y.default.sources.USER?K.record(ne,ae):K.transform(ne))}),K.quill.keyboard.addBinding({key:"Z",shortKey:!0},K.undo.bind(K)),K.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},K.redo.bind(K)),/Win/i.test(navigator.platform)&&K.quill.keyboard.addBinding({key:"Y",shortKey:!0},K.redo.bind(K)),K}return o(B,[{key:"change",value:function(W,K){if(this.stack[W].length!==0){var te=this.stack[W].pop();this.stack[K].push(te),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(te[W],y.default.sources.USER),this.ignoreChange=!1;var ne=M(te[W]);this.quill.setSelection(ne)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(W,K){if(W.ops.length!==0){this.stack.redo=[];var te=this.quill.getContents().diff(K),ne=Date.now();if(this.lastRecorded+this.options.delay>ne&&this.stack.undo.length>0){var ae=this.stack.undo.pop();te=te.compose(ae.undo),W=ae.redo.compose(W)}else this.lastRecorded=ne;this.stack.undo.push({redo:W,undo:te}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(W){this.stack.undo.forEach(function(K){K.undo=W.transform(K.undo,!0),K.redo=W.transform(K.redo,!0)}),this.stack.redo.forEach(function(K){K.undo=W.transform(K.undo,!0),K.redo=W.transform(K.redo,!0)})}},{key:"undo",value:function(){this.change("undo","redo")}}]),B}(w.default);N.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};function R(F){var B=F.ops[F.ops.length-1];return B==null?!1:B.insert!=null?typeof B.insert=="string"&&B.insert.endsWith(`
`):B.attributes!=null?Object.keys(B.attributes).some(function($){return i.default.query($,i.default.Scope.BLOCK)!=null}):!1}function M(F){var B=F.reduce(function(W,K){return W+=K.delete||0,W},0),$=F.length()-B;return R(F)&&($-=1),$}n.default=N,n.getLastChangeIndex=M},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BaseTooltip=void 0;var o=function(){function pe(Oe,Xe){for(var We=0;We<Xe.length;We++){var $e=Xe[We];$e.enumerable=$e.enumerable||!1,$e.configurable=!0,"value"in $e&&($e.writable=!0),Object.defineProperty(Oe,$e.key,$e)}}return function(Oe,Xe,We){return Xe&&pe(Oe.prototype,Xe),We&&pe(Oe,We),Oe}}(),d=function pe(Oe,Xe,We){Oe===null&&(Oe=Function.prototype);var $e=Object.getOwnPropertyDescriptor(Oe,Xe);if($e===void 0){var Ke=Object.getPrototypeOf(Oe);return Ke===null?void 0:pe(Ke,Xe,We)}else{if("value"in $e)return $e.value;var Le=$e.get;return Le===void 0?void 0:Le.call(We)}},i=s(3),m=ne(i),y=s(2),S=ne(y),w=s(8),T=ne(w),A=s(23),O=ne(A),P=s(34),N=ne(P),R=s(59),M=ne(R),F=s(60),B=ne(F),$=s(28),W=ne($),K=s(61),te=ne(K);function ne(pe){return pe&&pe.__esModule?pe:{default:pe}}function ae(pe,Oe){if(!(pe instanceof Oe))throw new TypeError("Cannot call a class as a function")}function re(pe,Oe){if(!pe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Oe&&(typeof Oe=="object"||typeof Oe=="function")?Oe:pe}function ee(pe,Oe){if(typeof Oe!="function"&&Oe!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Oe);pe.prototype=Object.create(Oe&&Oe.prototype,{constructor:{value:pe,enumerable:!1,writable:!0,configurable:!0}}),Oe&&(Object.setPrototypeOf?Object.setPrototypeOf(pe,Oe):pe.__proto__=Oe)}var ie=[!1,"center","right","justify"],de=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],be=[!1,"serif","monospace"],Se=["1","2","3",!1],Ae=["small",!1,"large","huge"],xe=function(pe){ee(Oe,pe);function Oe(Xe,We){ae(this,Oe);var $e=re(this,(Oe.__proto__||Object.getPrototypeOf(Oe)).call(this,Xe,We)),Ke=function Le(ke){if(!document.body.contains(Xe.root))return document.body.removeEventListener("click",Le);$e.tooltip!=null&&!$e.tooltip.root.contains(ke.target)&&document.activeElement!==$e.tooltip.textbox&&!$e.quill.hasFocus()&&$e.tooltip.hide(),$e.pickers!=null&&$e.pickers.forEach(function(st){st.container.contains(ke.target)||st.close()})};return Xe.emitter.listenDOM("click",document.body,Ke),$e}return o(Oe,[{key:"addModule",value:function(We){var $e=d(Oe.prototype.__proto__||Object.getPrototypeOf(Oe.prototype),"addModule",this).call(this,We);return We==="toolbar"&&this.extendToolbar($e),$e}},{key:"buildButtons",value:function(We,$e){We.forEach(function(Ke){var Le=Ke.getAttribute("class")||"";Le.split(/\s+/).forEach(function(ke){if(ke.startsWith("ql-")&&(ke=ke.slice(3),$e[ke]!=null))if(ke==="direction")Ke.innerHTML=$e[ke][""]+$e[ke].rtl;else if(typeof $e[ke]=="string")Ke.innerHTML=$e[ke];else{var st=Ke.value||"";st!=null&&$e[ke][st]&&(Ke.innerHTML=$e[ke][st])}})})}},{key:"buildPickers",value:function(We,$e){var Ke=this;this.pickers=We.map(function(ke){if(ke.classList.contains("ql-align"))return ke.querySelector("option")==null&&ge(ke,ie),new B.default(ke,$e.align);if(ke.classList.contains("ql-background")||ke.classList.contains("ql-color")){var st=ke.classList.contains("ql-background")?"background":"color";return ke.querySelector("option")==null&&ge(ke,de,st==="background"?"#ffffff":"#000000"),new M.default(ke,$e[st])}else return ke.querySelector("option")==null&&(ke.classList.contains("ql-font")?ge(ke,be):ke.classList.contains("ql-header")?ge(ke,Se):ke.classList.contains("ql-size")&&ge(ke,Ae)),new W.default(ke)});var Le=function(){Ke.pickers.forEach(function(st){st.update()})};this.quill.on(T.default.events.EDITOR_CHANGE,Le)}}]),Oe}(N.default);xe.DEFAULTS=(0,m.default)(!0,{},N.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var Oe=this,Xe=this.container.querySelector("input.ql-image[type=file]");Xe==null&&(Xe=document.createElement("input"),Xe.setAttribute("type","file"),Xe.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),Xe.classList.add("ql-image"),Xe.addEventListener("change",function(){if(Xe.files!=null&&Xe.files[0]!=null){var We=new FileReader;We.onload=function($e){var Ke=Oe.quill.getSelection(!0);Oe.quill.updateContents(new S.default().retain(Ke.index).delete(Ke.length).insert({image:$e.target.result}),T.default.sources.USER),Oe.quill.setSelection(Ke.index+1,T.default.sources.SILENT),Xe.value=""},We.readAsDataURL(Xe.files[0])}}),this.container.appendChild(Xe)),Xe.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var me=function(pe){ee(Oe,pe);function Oe(Xe,We){ae(this,Oe);var $e=re(this,(Oe.__proto__||Object.getPrototypeOf(Oe)).call(this,Xe,We));return $e.textbox=$e.root.querySelector('input[type="text"]'),$e.listen(),$e}return o(Oe,[{key:"listen",value:function(){var We=this;this.textbox.addEventListener("keydown",function($e){O.default.match($e,"enter")?(We.save(),$e.preventDefault()):O.default.match($e,"escape")&&(We.cancel(),$e.preventDefault())})}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var We=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",$e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),$e!=null?this.textbox.value=$e:We!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+We)||""),this.root.setAttribute("data-mode",We)}},{key:"restoreFocus",value:function(){var We=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=We}},{key:"save",value:function(){var We=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{var $e=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",We,T.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",We,T.default.sources.USER)),this.quill.root.scrollTop=$e;break}case"video":We=Ce(We);case"formula":{if(!We)break;var Ke=this.quill.getSelection(!0);if(Ke!=null){var Le=Ke.index+Ke.length;this.quill.insertEmbed(Le,this.root.getAttribute("data-mode"),We,T.default.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(Le+1," ",T.default.sources.USER),this.quill.setSelection(Le+2,T.default.sources.USER)}break}}this.textbox.value="",this.hide()}}]),Oe}(te.default);function Ce(pe){var Oe=pe.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||pe.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return Oe?(Oe[1]||"https")+"://www.youtube.com/embed/"+Oe[2]+"?showinfo=0":(Oe=pe.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(Oe[1]||"https")+"://player.vimeo.com/video/"+Oe[2]+"/":pe}function ge(pe,Oe){var Xe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;Oe.forEach(function(We){var $e=document.createElement("option");We===Xe?$e.setAttribute("selected","selected"):$e.setAttribute("value",We),pe.appendChild($e)})}n.BaseTooltip=me,n.default=xe},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function d(){this.head=this.tail=null,this.length=0}return d.prototype.append=function(){for(var i=[],m=0;m<arguments.length;m++)i[m]=arguments[m];this.insertBefore(i[0],null),i.length>1&&this.append.apply(this,i.slice(1))},d.prototype.contains=function(i){for(var m,y=this.iterator();m=y();)if(m===i)return!0;return!1},d.prototype.insertBefore=function(i,m){i&&(i.next=m,m!=null?(i.prev=m.prev,m.prev!=null&&(m.prev.next=i),m.prev=i,m===this.head&&(this.head=i)):this.tail!=null?(this.tail.next=i,i.prev=this.tail,this.tail=i):(i.prev=null,this.head=this.tail=i),this.length+=1)},d.prototype.offset=function(i){for(var m=0,y=this.head;y!=null;){if(y===i)return m;m+=y.length(),y=y.next}return-1},d.prototype.remove=function(i){this.contains(i)&&(i.prev!=null&&(i.prev.next=i.next),i.next!=null&&(i.next.prev=i.prev),i===this.head&&(this.head=i.next),i===this.tail&&(this.tail=i.prev),this.length-=1)},d.prototype.iterator=function(i){return i===void 0&&(i=this.head),function(){var m=i;return i!=null&&(i=i.next),m}},d.prototype.find=function(i,m){m===void 0&&(m=!1);for(var y,S=this.iterator();y=S();){var w=y.length();if(i<w||m&&i===w&&(y.next==null||y.next.length()!==0))return[y,i];i-=w}return[null,0]},d.prototype.forEach=function(i){for(var m,y=this.iterator();m=y();)i(m)},d.prototype.forEachAt=function(i,m,y){if(!(m<=0))for(var S=this.find(i),w=S[0],T=S[1],A,O=i-T,P=this.iterator(w);(A=P())&&O<i+m;){var N=A.length();i>O?y(A,i-O,Math.min(m,O+N-i)):y(A,0,Math.min(N,i+m-O)),O+=N}},d.prototype.map=function(i){return this.reduce(function(m,y){return m.push(i(y)),m},[])},d.prototype.reduce=function(i,m){for(var y,S=this.iterator();y=S();)m=i(m,y);return m},d}();n.default=o},function(r,n,s){var o=this&&this.__extends||function(){var w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var O in A)A.hasOwnProperty(O)&&(T[O]=A[O])};return function(T,A){w(T,A);function O(){this.constructor=T}T.prototype=A===null?Object.create(A):(O.prototype=A.prototype,new O)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(17),i=s(1),m={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},y=100,S=function(w){o(T,w);function T(A){var O=w.call(this,A)||this;return O.scroll=O,O.observer=new MutationObserver(function(P){O.update(P)}),O.observer.observe(O.domNode,m),O.attach(),O}return T.prototype.detach=function(){w.prototype.detach.call(this),this.observer.disconnect()},T.prototype.deleteAt=function(A,O){this.update(),A===0&&O===this.length()?this.children.forEach(function(P){P.remove()}):w.prototype.deleteAt.call(this,A,O)},T.prototype.formatAt=function(A,O,P,N){this.update(),w.prototype.formatAt.call(this,A,O,P,N)},T.prototype.insertAt=function(A,O,P){this.update(),w.prototype.insertAt.call(this,A,O,P)},T.prototype.optimize=function(A,O){var P=this;A===void 0&&(A=[]),O===void 0&&(O={}),w.prototype.optimize.call(this,O);for(var N=[].slice.call(this.observer.takeRecords());N.length>0;)A.push(N.pop());for(var R=function($,W){W===void 0&&(W=!0),!($==null||$===P)&&$.domNode.parentNode!=null&&($.domNode[i.DATA_KEY].mutations==null&&($.domNode[i.DATA_KEY].mutations=[]),W&&R($.parent))},M=function($){$.domNode[i.DATA_KEY]==null||$.domNode[i.DATA_KEY].mutations==null||($ instanceof d.default&&$.children.forEach(M),$.optimize(O))},F=A,B=0;F.length>0;B+=1){if(B>=y)throw new Error("[Parchment] Maximum optimize iterations reached");for(F.forEach(function($){var W=i.find($.target,!0);W!=null&&(W.domNode===$.target&&($.type==="childList"?(R(i.find($.previousSibling,!1)),[].forEach.call($.addedNodes,function(K){var te=i.find(K,!1);R(te,!1),te instanceof d.default&&te.children.forEach(function(ne){R(ne,!1)})})):$.type==="attributes"&&R(W.prev)),R(W))}),this.children.forEach(M),F=[].slice.call(this.observer.takeRecords()),N=F.slice();N.length>0;)A.push(N.pop())}},T.prototype.update=function(A,O){var P=this;O===void 0&&(O={}),A=A||this.observer.takeRecords(),A.map(function(N){var R=i.find(N.target,!0);return R==null?null:R.domNode[i.DATA_KEY].mutations==null?(R.domNode[i.DATA_KEY].mutations=[N],R):(R.domNode[i.DATA_KEY].mutations.push(N),null)}).forEach(function(N){N==null||N===P||N.domNode[i.DATA_KEY]==null||N.update(N.domNode[i.DATA_KEY].mutations||[],O)}),this.domNode[i.DATA_KEY].mutations!=null&&w.prototype.update.call(this,this.domNode[i.DATA_KEY].mutations,O),this.optimize(A,O)},T.blotName="scroll",T.defaultChild="block",T.scope=i.Scope.BLOCK_BLOT,T.tagName="DIV",T}(d.default);n.default=S},function(r,n,s){var o=this&&this.__extends||function(){var S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,T){w.__proto__=T}||function(w,T){for(var A in T)T.hasOwnProperty(A)&&(w[A]=T[A])};return function(w,T){S(w,T);function A(){this.constructor=w}w.prototype=T===null?Object.create(T):(A.prototype=T.prototype,new A)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(18),i=s(1);function m(S,w){if(Object.keys(S).length!==Object.keys(w).length)return!1;for(var T in S)if(S[T]!==w[T])return!1;return!0}var y=function(S){o(w,S);function w(){return S!==null&&S.apply(this,arguments)||this}return w.formats=function(T){if(T.tagName!==w.tagName)return S.formats.call(this,T)},w.prototype.format=function(T,A){var O=this;T===this.statics.blotName&&!A?(this.children.forEach(function(P){P instanceof d.default||(P=P.wrap(w.blotName,!0)),O.attributes.copy(P)}),this.unwrap()):S.prototype.format.call(this,T,A)},w.prototype.formatAt=function(T,A,O,P){if(this.formats()[O]!=null||i.query(O,i.Scope.ATTRIBUTE)){var N=this.isolate(T,A);N.format(O,P)}else S.prototype.formatAt.call(this,T,A,O,P)},w.prototype.optimize=function(T){S.prototype.optimize.call(this,T);var A=this.formats();if(Object.keys(A).length===0)return this.unwrap();var O=this.next;O instanceof w&&O.prev===this&&m(A,O.formats())&&(O.moveChildren(this),O.remove())},w.blotName="inline",w.scope=i.Scope.INLINE_BLOT,w.tagName="SPAN",w}(d.default);n.default=y},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,w){S.__proto__=w}||function(S,w){for(var T in w)w.hasOwnProperty(T)&&(S[T]=w[T])};return function(S,w){y(S,w);function T(){this.constructor=S}S.prototype=w===null?Object.create(w):(T.prototype=w.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(18),i=s(1),m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.formats=function(w){var T=i.query(S.blotName).tagName;if(w.tagName!==T)return y.formats.call(this,w)},S.prototype.format=function(w,T){i.query(w,i.Scope.BLOCK)!=null&&(w===this.statics.blotName&&!T?this.replaceWith(S.blotName):y.prototype.format.call(this,w,T))},S.prototype.formatAt=function(w,T,A,O){i.query(A,i.Scope.BLOCK)!=null?this.format(A,O):y.prototype.formatAt.call(this,w,T,A,O)},S.prototype.insertAt=function(w,T,A){if(A==null||i.query(T,i.Scope.INLINE)!=null)y.prototype.insertAt.call(this,w,T,A);else{var O=this.split(w),P=i.create(T,A);O.parent.insertBefore(P,O)}},S.prototype.update=function(w,T){navigator.userAgent.match(/Trident/)?this.build():y.prototype.update.call(this,w,T)},S.blotName="block",S.scope=i.Scope.BLOCK_BLOT,S.tagName="P",S}(d.default);n.default=m},function(r,n,s){var o=this&&this.__extends||function(){var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,S){y.__proto__=S}||function(y,S){for(var w in S)S.hasOwnProperty(w)&&(y[w]=S[w])};return function(y,S){m(y,S);function w(){this.constructor=y}y.prototype=S===null?Object.create(S):(w.prototype=S.prototype,new w)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(19),i=function(m){o(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y.formats=function(S){},y.prototype.format=function(S,w){m.prototype.formatAt.call(this,0,this.length(),S,w)},y.prototype.formatAt=function(S,w,T,A){S===0&&w===this.length()?this.format(T,A):m.prototype.formatAt.call(this,S,w,T,A)},y.prototype.formats=function(){return this.statics.formats(this.domNode)},y}(d.default);n.default=i},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,w){S.__proto__=w}||function(S,w){for(var T in w)w.hasOwnProperty(T)&&(S[T]=w[T])};return function(S,w){y(S,w);function T(){this.constructor=S}S.prototype=w===null?Object.create(w):(T.prototype=w.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=s(19),i=s(1),m=function(y){o(S,y);function S(w){var T=y.call(this,w)||this;return T.text=T.statics.value(T.domNode),T}return S.create=function(w){return document.createTextNode(w)},S.value=function(w){var T=w.data;return T.normalize&&(T=T.normalize()),T},S.prototype.deleteAt=function(w,T){this.domNode.data=this.text=this.text.slice(0,w)+this.text.slice(w+T)},S.prototype.index=function(w,T){return this.domNode===w?T:-1},S.prototype.insertAt=function(w,T,A){A==null?(this.text=this.text.slice(0,w)+T+this.text.slice(w),this.domNode.data=this.text):y.prototype.insertAt.call(this,w,T,A)},S.prototype.length=function(){return this.text.length},S.prototype.optimize=function(w){y.prototype.optimize.call(this,w),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof S&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},S.prototype.position=function(w,T){return[this.domNode,w]},S.prototype.split=function(w,T){if(T===void 0&&(T=!1),!T){if(w===0)return this;if(w===this.length())return this.next}var A=i.create(this.domNode.splitText(w));return this.parent.insertBefore(A,this.next),this.text=this.statics.value(this.domNode),A},S.prototype.update=function(w,T){var A=this;w.some(function(O){return O.type==="characterData"&&O.target===A.domNode})&&(this.text=this.statics.value(this.domNode))},S.prototype.value=function(){return this.text},S.blotName="text",S.scope=i.Scope.INLINE_BLOT,S}(d.default);n.default=m},function(r,n,s){var o=document.createElement("div");if(o.classList.toggle("test-class",!1),o.classList.contains("test-class")){var d=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(i,m){return arguments.length>1&&!this.contains(i)==!m?m:d.call(this,i)}}String.prototype.startsWith||(String.prototype.startsWith=function(i,m){return m=m||0,this.substr(m,i.length)===i}),String.prototype.endsWith||(String.prototype.endsWith=function(i,m){var y=this.toString();(typeof m!="number"||!isFinite(m)||Math.floor(m)!==m||m>y.length)&&(m=y.length),m-=i.length;var S=y.indexOf(i,m);return S!==-1&&S===m}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(m){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof m!="function")throw new TypeError("predicate must be a function");for(var y=Object(this),S=y.length>>>0,w=arguments[1],T,A=0;A<S;A++)if(T=y[A],m.call(w,T,A,y))return T}}),document.addEventListener("DOMContentLoaded",function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)})},function(r,n){var s=-1,o=1,d=0;function i(B,$,W){if(B==$)return B?[[d,B]]:[];(W<0||B.length<W)&&(W=null);var K=w(B,$),te=B.substring(0,K);B=B.substring(K),$=$.substring(K),K=T(B,$);var ne=B.substring(B.length-K);B=B.substring(0,B.length-K),$=$.substring(0,$.length-K);var ae=m(B,$);return te&&ae.unshift([d,te]),ne&&ae.push([d,ne]),O(ae),W!=null&&(ae=R(ae,W)),ae=M(ae),ae}function m(B,$){var W;if(!B)return[[o,$]];if(!$)return[[s,B]];var K=B.length>$.length?B:$,te=B.length>$.length?$:B,ne=K.indexOf(te);if(ne!=-1)return W=[[o,K.substring(0,ne)],[d,te],[o,K.substring(ne+te.length)]],B.length>$.length&&(W[0][0]=W[2][0]=s),W;if(te.length==1)return[[s,B],[o,$]];var ae=A(B,$);if(ae){var re=ae[0],ee=ae[1],ie=ae[2],de=ae[3],be=ae[4],Se=i(re,ie),Ae=i(ee,de);return Se.concat([[d,be]],Ae)}return y(B,$)}function y(B,$){for(var W=B.length,K=$.length,te=Math.ceil((W+K)/2),ne=te,ae=2*te,re=new Array(ae),ee=new Array(ae),ie=0;ie<ae;ie++)re[ie]=-1,ee[ie]=-1;re[ne+1]=0,ee[ne+1]=0;for(var de=W-K,be=de%2!=0,Se=0,Ae=0,xe=0,me=0,Ce=0;Ce<te;Ce++){for(var ge=-Ce+Se;ge<=Ce-Ae;ge+=2){var pe=ne+ge,Oe;ge==-Ce||ge!=Ce&&re[pe-1]<re[pe+1]?Oe=re[pe+1]:Oe=re[pe-1]+1;for(var Xe=Oe-ge;Oe<W&&Xe<K&&B.charAt(Oe)==$.charAt(Xe);)Oe++,Xe++;if(re[pe]=Oe,Oe>W)Ae+=2;else if(Xe>K)Se+=2;else if(be){var We=ne+de-ge;if(We>=0&&We<ae&&ee[We]!=-1){var $e=W-ee[We];if(Oe>=$e)return S(B,$,Oe,Xe)}}}for(var Ke=-Ce+xe;Ke<=Ce-me;Ke+=2){var We=ne+Ke,$e;Ke==-Ce||Ke!=Ce&&ee[We-1]<ee[We+1]?$e=ee[We+1]:$e=ee[We-1]+1;for(var Le=$e-Ke;$e<W&&Le<K&&B.charAt(W-$e-1)==$.charAt(K-Le-1);)$e++,Le++;if(ee[We]=$e,$e>W)me+=2;else if(Le>K)xe+=2;else if(!be){var pe=ne+de-Ke;if(pe>=0&&pe<ae&&re[pe]!=-1){var Oe=re[pe],Xe=ne+Oe-pe;if($e=W-$e,Oe>=$e)return S(B,$,Oe,Xe)}}}}return[[s,B],[o,$]]}function S(B,$,W,K){var te=B.substring(0,W),ne=$.substring(0,K),ae=B.substring(W),re=$.substring(K),ee=i(te,ne),ie=i(ae,re);return ee.concat(ie)}function w(B,$){if(!B||!$||B.charAt(0)!=$.charAt(0))return 0;for(var W=0,K=Math.min(B.length,$.length),te=K,ne=0;W<te;)B.substring(ne,te)==$.substring(ne,te)?(W=te,ne=W):K=te,te=Math.floor((K-W)/2+W);return te}function T(B,$){if(!B||!$||B.charAt(B.length-1)!=$.charAt($.length-1))return 0;for(var W=0,K=Math.min(B.length,$.length),te=K,ne=0;W<te;)B.substring(B.length-te,B.length-ne)==$.substring($.length-te,$.length-ne)?(W=te,ne=W):K=te,te=Math.floor((K-W)/2+W);return te}function A(B,$){var W=B.length>$.length?B:$,K=B.length>$.length?$:B;if(W.length<4||K.length*2<W.length)return null;function te(Ae,xe,me){for(var Ce=Ae.substring(me,me+Math.floor(Ae.length/4)),ge=-1,pe="",Oe,Xe,We,$e;(ge=xe.indexOf(Ce,ge+1))!=-1;){var Ke=w(Ae.substring(me),xe.substring(ge)),Le=T(Ae.substring(0,me),xe.substring(0,ge));pe.length<Le+Ke&&(pe=xe.substring(ge-Le,ge)+xe.substring(ge,ge+Ke),Oe=Ae.substring(0,me-Le),Xe=Ae.substring(me+Ke),We=xe.substring(0,ge-Le),$e=xe.substring(ge+Ke))}return pe.length*2>=Ae.length?[Oe,Xe,We,$e,pe]:null}var ne=te(W,K,Math.ceil(W.length/4)),ae=te(W,K,Math.ceil(W.length/2)),re;if(!ne&&!ae)return null;ae?ne?re=ne[4].length>ae[4].length?ne:ae:re=ae:re=ne;var ee,ie,de,be;B.length>$.length?(ee=re[0],ie=re[1],de=re[2],be=re[3]):(de=re[0],be=re[1],ee=re[2],ie=re[3]);var Se=re[4];return[ee,ie,de,be,Se]}function O(B){B.push([d,""]);for(var $=0,W=0,K=0,te="",ne="",ae;$<B.length;)switch(B[$][0]){case o:K++,ne+=B[$][1],$++;break;case s:W++,te+=B[$][1],$++;break;case d:W+K>1?(W!==0&&K!==0&&(ae=w(ne,te),ae!==0&&($-W-K>0&&B[$-W-K-1][0]==d?B[$-W-K-1][1]+=ne.substring(0,ae):(B.splice(0,0,[d,ne.substring(0,ae)]),$++),ne=ne.substring(ae),te=te.substring(ae)),ae=T(ne,te),ae!==0&&(B[$][1]=ne.substring(ne.length-ae)+B[$][1],ne=ne.substring(0,ne.length-ae),te=te.substring(0,te.length-ae))),W===0?B.splice($-K,W+K,[o,ne]):K===0?B.splice($-W,W+K,[s,te]):B.splice($-W-K,W+K,[s,te],[o,ne]),$=$-W-K+(W?1:0)+(K?1:0)+1):$!==0&&B[$-1][0]==d?(B[$-1][1]+=B[$][1],B.splice($,1)):$++,K=0,W=0,te="",ne="";break}B[B.length-1][1]===""&&B.pop();var re=!1;for($=1;$<B.length-1;)B[$-1][0]==d&&B[$+1][0]==d&&(B[$][1].substring(B[$][1].length-B[$-1][1].length)==B[$-1][1]?(B[$][1]=B[$-1][1]+B[$][1].substring(0,B[$][1].length-B[$-1][1].length),B[$+1][1]=B[$-1][1]+B[$+1][1],B.splice($-1,1),re=!0):B[$][1].substring(0,B[$+1][1].length)==B[$+1][1]&&(B[$-1][1]+=B[$+1][1],B[$][1]=B[$][1].substring(B[$+1][1].length)+B[$+1][1],B.splice($+1,1),re=!0)),$++;re&&O(B)}var P=i;P.INSERT=o,P.DELETE=s,P.EQUAL=d,r.exports=P;function N(B,$){if($===0)return[d,B];for(var W=0,K=0;K<B.length;K++){var te=B[K];if(te[0]===s||te[0]===d){var ne=W+te[1].length;if($===ne)return[K+1,B];if($<ne){B=B.slice();var ae=$-W,re=[te[0],te[1].slice(0,ae)],ee=[te[0],te[1].slice(ae)];return B.splice(K,1,re,ee),[K+1,B]}else W=ne}}throw new Error("cursor_pos is out of bounds!")}function R(B,$){var W=N(B,$),K=W[1],te=W[0],ne=K[te],ae=K[te+1];if(ne==null)return B;if(ne[0]!==d)return B;if(ae!=null&&ne[1]+ae[1]===ae[1]+ne[1])return K.splice(te,2,ae,ne),F(K,te,2);if(ae!=null&&ae[1].indexOf(ne[1])===0){K.splice(te,2,[ae[0],ne[1]],[0,ne[1]]);var re=ae[1].slice(ne[1].length);return re.length>0&&K.splice(te+2,0,[ae[0],re]),F(K,te,3)}else return B}function M(B){for(var $=!1,W=function(ae){return ae.charCodeAt(0)>=56320&&ae.charCodeAt(0)<=57343},K=function(ae){return ae.charCodeAt(ae.length-1)>=55296&&ae.charCodeAt(ae.length-1)<=56319},te=2;te<B.length;te+=1)B[te-2][0]===d&&K(B[te-2][1])&&B[te-1][0]===s&&W(B[te-1][1])&&B[te][0]===o&&W(B[te][1])&&($=!0,B[te-1][1]=B[te-2][1].slice(-1)+B[te-1][1],B[te][1]=B[te-2][1].slice(-1)+B[te][1],B[te-2][1]=B[te-2][1].slice(0,-1));if(!$)return B;for(var ne=[],te=0;te<B.length;te+=1)B[te][1].length>0&&ne.push(B[te]);return ne}function F(B,$,W){for(var K=$+W-1;K>=0&&K>=$-1;K--)if(K+1<B.length){var te=B[K],ne=B[K+1];te[0]===ne[1]&&B.splice(K,2,[te[0],te[1]+ne[1]])}return B}},function(r,n){n=r.exports=typeof Object.keys=="function"?Object.keys:s,n.shim=s;function s(o){var d=[];for(var i in o)d.push(i);return d}},function(r,n){var s=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";n=r.exports=s?o:d,n.supported=o;function o(i){return Object.prototype.toString.call(i)=="[object Arguments]"}n.unsupported=d;function d(i){return i&&typeof i=="object"&&typeof i.length=="number"&&Object.prototype.hasOwnProperty.call(i,"callee")&&!Object.prototype.propertyIsEnumerable.call(i,"callee")||!1}},function(r,n){var s=Object.prototype.hasOwnProperty,o="~";function d(){}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(o=!1));function i(y,S,w){this.fn=y,this.context=S,this.once=w||!1}function m(){this._events=new d,this._eventsCount=0}m.prototype.eventNames=function(){var S=[],w,T;if(this._eventsCount===0)return S;for(T in w=this._events)s.call(w,T)&&S.push(o?T.slice(1):T);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(w)):S},m.prototype.listeners=function(S,w){var T=o?o+S:S,A=this._events[T];if(w)return!!A;if(!A)return[];if(A.fn)return[A.fn];for(var O=0,P=A.length,N=new Array(P);O<P;O++)N[O]=A[O].fn;return N},m.prototype.emit=function(S,w,T,A,O,P){var N=o?o+S:S;if(!this._events[N])return!1;var R=this._events[N],M=arguments.length,F,B;if(R.fn){switch(R.once&&this.removeListener(S,R.fn,void 0,!0),M){case 1:return R.fn.call(R.context),!0;case 2:return R.fn.call(R.context,w),!0;case 3:return R.fn.call(R.context,w,T),!0;case 4:return R.fn.call(R.context,w,T,A),!0;case 5:return R.fn.call(R.context,w,T,A,O),!0;case 6:return R.fn.call(R.context,w,T,A,O,P),!0}for(B=1,F=new Array(M-1);B<M;B++)F[B-1]=arguments[B];R.fn.apply(R.context,F)}else{var $=R.length,W;for(B=0;B<$;B++)switch(R[B].once&&this.removeListener(S,R[B].fn,void 0,!0),M){case 1:R[B].fn.call(R[B].context);break;case 2:R[B].fn.call(R[B].context,w);break;case 3:R[B].fn.call(R[B].context,w,T);break;case 4:R[B].fn.call(R[B].context,w,T,A);break;default:if(!F)for(W=1,F=new Array(M-1);W<M;W++)F[W-1]=arguments[W];R[B].fn.apply(R[B].context,F)}}return!0},m.prototype.on=function(S,w,T){var A=new i(w,T||this),O=o?o+S:S;return this._events[O]?this._events[O].fn?this._events[O]=[this._events[O],A]:this._events[O].push(A):(this._events[O]=A,this._eventsCount++),this},m.prototype.once=function(S,w,T){var A=new i(w,T||this,!0),O=o?o+S:S;return this._events[O]?this._events[O].fn?this._events[O]=[this._events[O],A]:this._events[O].push(A):(this._events[O]=A,this._eventsCount++),this},m.prototype.removeListener=function(S,w,T,A){var O=o?o+S:S;if(!this._events[O])return this;if(!w)return--this._eventsCount===0?this._events=new d:delete this._events[O],this;var P=this._events[O];if(P.fn)P.fn===w&&(!A||P.once)&&(!T||P.context===T)&&(--this._eventsCount===0?this._events=new d:delete this._events[O]);else{for(var N=0,R=[],M=P.length;N<M;N++)(P[N].fn!==w||A&&!P[N].once||T&&P[N].context!==T)&&R.push(P[N]);R.length?this._events[O]=R.length===1?R[0]:R:--this._eventsCount===0?this._events=new d:delete this._events[O]}return this},m.prototype.removeAllListeners=function(S){var w;return S?(w=o?o+S:S,this._events[w]&&(--this._eventsCount===0?this._events=new d:delete this._events[w])):(this._events=new d,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prototype.setMaxListeners=function(){return this},m.prefixed=o,m.EventEmitter=m,typeof r<"u"&&(r.exports=m)},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.matchText=n.matchSpacing=n.matchNewline=n.matchBlot=n.matchAttributor=n.default=void 0;var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(jt){return typeof jt}:function(jt){return jt&&typeof Symbol=="function"&&jt.constructor===Symbol&&jt!==Symbol.prototype?"symbol":typeof jt},d=function(){function jt(zt,Je){var pt=[],rt=!0,Kt=!1,Ut=void 0;try{for(var Ht=zt[Symbol.iterator](),Cr;!(rt=(Cr=Ht.next()).done)&&(pt.push(Cr.value),!(Je&&pt.length===Je));rt=!0);}catch(un){Kt=!0,Ut=un}finally{try{!rt&&Ht.return&&Ht.return()}finally{if(Kt)throw Ut}}return pt}return function(zt,Je){if(Array.isArray(zt))return zt;if(Symbol.iterator in Object(zt))return jt(zt,Je);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function jt(zt,Je){for(var pt=0;pt<Je.length;pt++){var rt=Je[pt];rt.enumerable=rt.enumerable||!1,rt.configurable=!0,"value"in rt&&(rt.writable=!0),Object.defineProperty(zt,rt.key,rt)}}return function(zt,Je,pt){return Je&&jt(zt.prototype,Je),pt&&jt(zt,pt),zt}}(),m=s(3),y=ee(m),S=s(2),w=ee(S),T=s(0),A=ee(T),O=s(5),P=ee(O),N=s(10),R=ee(N),M=s(9),F=ee(M),B=s(36),$=s(37),W=s(13),K=ee(W),te=s(26),ne=s(38),ae=s(39),re=s(40);function ee(jt){return jt&&jt.__esModule?jt:{default:jt}}function ie(jt,zt,Je){return zt in jt?Object.defineProperty(jt,zt,{value:Je,enumerable:!0,configurable:!0,writable:!0}):jt[zt]=Je,jt}function de(jt,zt){if(!(jt instanceof zt))throw new TypeError("Cannot call a class as a function")}function be(jt,zt){if(!jt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return zt&&(typeof zt=="object"||typeof zt=="function")?zt:jt}function Se(jt,zt){if(typeof zt!="function"&&zt!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof zt);jt.prototype=Object.create(zt&&zt.prototype,{constructor:{value:jt,enumerable:!1,writable:!0,configurable:!0}}),zt&&(Object.setPrototypeOf?Object.setPrototypeOf(jt,zt):jt.__proto__=zt)}var Ae=(0,R.default)("quill:clipboard"),xe="__ql-matcher",me=[[Node.TEXT_NODE,Rr],[Node.TEXT_NODE,It],["br",_t],[Node.ELEMENT_NODE,It],[Node.ELEMENT_NODE,st],[Node.ELEMENT_NODE,ir],[Node.ELEMENT_NODE,ke],[Node.ELEMENT_NODE,Dr],["li",Dt],["b",Le.bind(Le,"bold")],["i",Le.bind(Le,"italic")],["style",Be]],Ce=[B.AlignAttribute,ne.DirectionAttribute].reduce(function(jt,zt){return jt[zt.keyName]=zt,jt},{}),ge=[B.AlignStyle,$.BackgroundStyle,te.ColorStyle,ne.DirectionStyle,ae.FontStyle,re.SizeStyle].reduce(function(jt,zt){return jt[zt.keyName]=zt,jt},{}),pe=function(jt){Se(zt,jt);function zt(Je,pt){de(this,zt);var rt=be(this,(zt.__proto__||Object.getPrototypeOf(zt)).call(this,Je,pt));return rt.quill.root.addEventListener("paste",rt.onPaste.bind(rt)),rt.container=rt.quill.addContainer("ql-clipboard"),rt.container.setAttribute("contenteditable",!0),rt.container.setAttribute("tabindex",-1),rt.matchers=[],me.concat(rt.options.matchers).forEach(function(Kt){var Ut=d(Kt,2),Ht=Ut[0],Cr=Ut[1];!pt.matchVisual&&Cr===ir||rt.addMatcher(Ht,Cr)}),rt}return i(zt,[{key:"addMatcher",value:function(pt,rt){this.matchers.push([pt,rt])}},{key:"convert",value:function(pt){if(typeof pt=="string")return this.container.innerHTML=pt.replace(/\>\r?\n +\</g,"><"),this.convert();var rt=this.quill.getFormat(this.quill.selection.savedRange.index);if(rt[K.default.blotName]){var Kt=this.container.innerText;return this.container.innerHTML="",new w.default().insert(Kt,ie({},K.default.blotName,rt[K.default.blotName]))}var Ut=this.prepareMatching(),Ht=d(Ut,2),Cr=Ht[0],un=Ht[1],hn=Ke(this.container,Cr,un);return We(hn,`
`)&&hn.ops[hn.ops.length-1].attributes==null&&(hn=hn.compose(new w.default().retain(hn.length()-1).delete(1))),Ae.log("convert",this.container.innerHTML,hn),this.container.innerHTML="",hn}},{key:"dangerouslyPasteHTML",value:function(pt,rt){var Kt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:P.default.sources.API;if(typeof pt=="string")this.quill.setContents(this.convert(pt),rt),this.quill.setSelection(0,P.default.sources.SILENT);else{var Ut=this.convert(rt);this.quill.updateContents(new w.default().retain(pt).concat(Ut),Kt),this.quill.setSelection(pt+Ut.length(),P.default.sources.SILENT)}}},{key:"onPaste",value:function(pt){var rt=this;if(!(pt.defaultPrevented||!this.quill.isEnabled())){var Kt=this.quill.getSelection(),Ut=new w.default().retain(Kt.index),Ht=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(P.default.sources.SILENT),setTimeout(function(){Ut=Ut.concat(rt.convert()).delete(Kt.length),rt.quill.updateContents(Ut,P.default.sources.USER),rt.quill.setSelection(Ut.length()-Kt.length,P.default.sources.SILENT),rt.quill.scrollingContainer.scrollTop=Ht,rt.quill.focus()},1)}}},{key:"prepareMatching",value:function(){var pt=this,rt=[],Kt=[];return this.matchers.forEach(function(Ut){var Ht=d(Ut,2),Cr=Ht[0],un=Ht[1];switch(Cr){case Node.TEXT_NODE:Kt.push(un);break;case Node.ELEMENT_NODE:rt.push(un);break;default:[].forEach.call(pt.container.querySelectorAll(Cr),function(hn){hn[xe]=hn[xe]||[],hn[xe].push(un)});break}}),[rt,Kt]}}]),zt}(F.default);pe.DEFAULTS={matchers:[],matchVisual:!0};function Oe(jt,zt,Je){return(typeof zt>"u"?"undefined":o(zt))==="object"?Object.keys(zt).reduce(function(pt,rt){return Oe(pt,rt,zt[rt])},jt):jt.reduce(function(pt,rt){return rt.attributes&&rt.attributes[zt]?pt.push(rt):pt.insert(rt.insert,(0,y.default)({},ie({},zt,Je),rt.attributes))},new w.default)}function Xe(jt){if(jt.nodeType!==Node.ELEMENT_NODE)return{};var zt="__ql-computed-style";return jt[zt]||(jt[zt]=window.getComputedStyle(jt))}function We(jt,zt){for(var Je="",pt=jt.ops.length-1;pt>=0&&Je.length<zt.length;--pt){var rt=jt.ops[pt];if(typeof rt.insert!="string")break;Je=rt.insert+Je}return Je.slice(-1*zt.length)===zt}function $e(jt){if(jt.childNodes.length===0)return!1;var zt=Xe(jt);return["block","list-item"].indexOf(zt.display)>-1}function Ke(jt,zt,Je){return jt.nodeType===jt.TEXT_NODE?Je.reduce(function(pt,rt){return rt(jt,pt)},new w.default):jt.nodeType===jt.ELEMENT_NODE?[].reduce.call(jt.childNodes||[],function(pt,rt){var Kt=Ke(rt,zt,Je);return rt.nodeType===jt.ELEMENT_NODE&&(Kt=zt.reduce(function(Ut,Ht){return Ht(rt,Ut)},Kt),Kt=(rt[xe]||[]).reduce(function(Ut,Ht){return Ht(rt,Ut)},Kt)),pt.concat(Kt)},new w.default):new w.default}function Le(jt,zt,Je){return Oe(Je,jt,!0)}function ke(jt,zt){var Je=A.default.Attributor.Attribute.keys(jt),pt=A.default.Attributor.Class.keys(jt),rt=A.default.Attributor.Style.keys(jt),Kt={};return Je.concat(pt).concat(rt).forEach(function(Ut){var Ht=A.default.query(Ut,A.default.Scope.ATTRIBUTE);Ht!=null&&(Kt[Ht.attrName]=Ht.value(jt),Kt[Ht.attrName])||(Ht=Ce[Ut],Ht!=null&&(Ht.attrName===Ut||Ht.keyName===Ut)&&(Kt[Ht.attrName]=Ht.value(jt)||void 0),Ht=ge[Ut],Ht!=null&&(Ht.attrName===Ut||Ht.keyName===Ut)&&(Ht=ge[Ut],Kt[Ht.attrName]=Ht.value(jt)||void 0))}),Object.keys(Kt).length>0&&(zt=Oe(zt,Kt)),zt}function st(jt,zt){var Je=A.default.query(jt);if(Je==null)return zt;if(Je.prototype instanceof A.default.Embed){var pt={},rt=Je.value(jt);rt!=null&&(pt[Je.blotName]=rt,zt=new w.default().insert(pt,Je.formats(jt)))}else typeof Je.formats=="function"&&(zt=Oe(zt,Je.blotName,Je.formats(jt)));return zt}function _t(jt,zt){return We(zt,`
`)||zt.insert(`
`),zt}function Be(){return new w.default}function Dt(jt,zt){var Je=A.default.query(jt);if(Je==null||Je.blotName!=="list-item"||!We(zt,`
`))return zt;for(var pt=-1,rt=jt.parentNode;!rt.classList.contains("ql-clipboard");)(A.default.query(rt)||{}).blotName==="list"&&(pt+=1),rt=rt.parentNode;return pt<=0?zt:zt.compose(new w.default().retain(zt.length()-1).retain(1,{indent:pt}))}function It(jt,zt){return We(zt,`
`)||($e(jt)||zt.length()>0&&jt.nextSibling&&$e(jt.nextSibling))&&zt.insert(`
`),zt}function ir(jt,zt){if($e(jt)&&jt.nextElementSibling!=null&&!We(zt,`

`)){var Je=jt.offsetHeight+parseFloat(Xe(jt).marginTop)+parseFloat(Xe(jt).marginBottom);jt.nextElementSibling.offsetTop>jt.offsetTop+Je*1.5&&zt.insert(`
`)}return zt}function Dr(jt,zt){var Je={},pt=jt.style||{};return pt.fontStyle&&Xe(jt).fontStyle==="italic"&&(Je.italic=!0),pt.fontWeight&&(Xe(jt).fontWeight.startsWith("bold")||parseInt(Xe(jt).fontWeight)>=700)&&(Je.bold=!0),Object.keys(Je).length>0&&(zt=Oe(zt,Je)),parseFloat(pt.textIndent||0)>0&&(zt=new w.default().insert("	").concat(zt)),zt}function Rr(jt,zt){var Je=jt.data;if(jt.parentNode.tagName==="O:P")return zt.insert(Je.trim());if(Je.trim().length===0&&jt.parentNode.classList.contains("ql-clipboard"))return zt;if(!Xe(jt.parentNode).whiteSpace.startsWith("pre")){var pt=function(Kt,Ut){return Ut=Ut.replace(/[^\u00a0]/g,""),Ut.length<1&&Kt?" ":Ut};Je=Je.replace(/\r\n/g," ").replace(/\n/g," "),Je=Je.replace(/\s\s+/g,pt.bind(pt,!0)),(jt.previousSibling==null&&$e(jt.parentNode)||jt.previousSibling!=null&&$e(jt.previousSibling))&&(Je=Je.replace(/^\s+/,pt.bind(pt,!1))),(jt.nextSibling==null&&$e(jt.parentNode)||jt.nextSibling!=null&&$e(jt.nextSibling))&&(Je=Je.replace(/\s+$/,pt.bind(pt,!1)))}return zt.insert(Je)}n.default=pe,n.matchAttributor=ke,n.matchBlot=st,n.matchNewline=It,n.matchSpacing=ir,n.matchText=Rr},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,N){for(var R=0;R<N.length;R++){var M=N[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,N,R){return N&&O(P.prototype,N),R&&O(P,R),P}}(),d=function O(P,N,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,N);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,N,R)}else{if("value"in M)return M.value;var B=M.get;return B===void 0?void 0:B.call(R)}},i=s(6),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function w(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),w(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return o(P,[{key:"optimize",value:function(R){d(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"optimize",this).call(this,R),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return d(P.__proto__||Object.getPrototypeOf(P),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),P}(m.default);A.blotName="bold",A.tagName=["STRONG","B"],n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.addControls=n.default=void 0;var o=function(){function re(ee,ie){var de=[],be=!0,Se=!1,Ae=void 0;try{for(var xe=ee[Symbol.iterator](),me;!(be=(me=xe.next()).done)&&(de.push(me.value),!(ie&&de.length===ie));be=!0);}catch(Ce){Se=!0,Ae=Ce}finally{try{!be&&xe.return&&xe.return()}finally{if(Se)throw Ae}}return de}return function(ee,ie){if(Array.isArray(ee))return ee;if(Symbol.iterator in Object(ee))return re(ee,ie);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function re(ee,ie){for(var de=0;de<ie.length;de++){var be=ie[de];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(ee,be.key,be)}}return function(ee,ie,de){return ie&&re(ee.prototype,ie),de&&re(ee,de),ee}}(),i=s(2),m=R(i),y=s(0),S=R(y),w=s(5),T=R(w),A=s(10),O=R(A),P=s(9),N=R(P);function R(re){return re&&re.__esModule?re:{default:re}}function M(re,ee,ie){return ee in re?Object.defineProperty(re,ee,{value:ie,enumerable:!0,configurable:!0,writable:!0}):re[ee]=ie,re}function F(re,ee){if(!(re instanceof ee))throw new TypeError("Cannot call a class as a function")}function B(re,ee){if(!re)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee&&(typeof ee=="object"||typeof ee=="function")?ee:re}function $(re,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ee);re.prototype=Object.create(ee&&ee.prototype,{constructor:{value:re,enumerable:!1,writable:!0,configurable:!0}}),ee&&(Object.setPrototypeOf?Object.setPrototypeOf(re,ee):re.__proto__=ee)}var W=(0,O.default)("quill:toolbar"),K=function(re){$(ee,re);function ee(ie,de){F(this,ee);var be=B(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,ie,de));if(Array.isArray(be.options.container)){var Se=document.createElement("div");ne(Se,be.options.container),ie.container.parentNode.insertBefore(Se,ie.container),be.container=Se}else typeof be.options.container=="string"?be.container=document.querySelector(be.options.container):be.container=be.options.container;if(!(be.container instanceof HTMLElement)){var Ae;return Ae=W.error("Container required for toolbar",be.options),B(be,Ae)}return be.container.classList.add("ql-toolbar"),be.controls=[],be.handlers={},Object.keys(be.options.handlers).forEach(function(xe){be.addHandler(xe,be.options.handlers[xe])}),[].forEach.call(be.container.querySelectorAll("button, select"),function(xe){be.attach(xe)}),be.quill.on(T.default.events.EDITOR_CHANGE,function(xe,me){xe===T.default.events.SELECTION_CHANGE&&be.update(me)}),be.quill.on(T.default.events.SCROLL_OPTIMIZE,function(){var xe=be.quill.selection.getRange(),me=o(xe,1),Ce=me[0];be.update(Ce)}),be}return d(ee,[{key:"addHandler",value:function(de,be){this.handlers[de]=be}},{key:"attach",value:function(de){var be=this,Se=[].find.call(de.classList,function(xe){return xe.indexOf("ql-")===0});if(Se){if(Se=Se.slice(3),de.tagName==="BUTTON"&&de.setAttribute("type","button"),this.handlers[Se]==null){if(this.quill.scroll.whitelist!=null&&this.quill.scroll.whitelist[Se]==null){W.warn("ignoring attaching to disabled format",Se,de);return}if(S.default.query(Se)==null){W.warn("ignoring attaching to nonexistent format",Se,de);return}}var Ae=de.tagName==="SELECT"?"change":"click";de.addEventListener(Ae,function(xe){var me=void 0;if(de.tagName==="SELECT"){if(de.selectedIndex<0)return;var Ce=de.options[de.selectedIndex];Ce.hasAttribute("selected")?me=!1:me=Ce.value||!1}else de.classList.contains("ql-active")?me=!1:me=de.value||!de.hasAttribute("value"),xe.preventDefault();be.quill.focus();var ge=be.quill.selection.getRange(),pe=o(ge,1),Oe=pe[0];if(be.handlers[Se]!=null)be.handlers[Se].call(be,me);else if(S.default.query(Se).prototype instanceof S.default.Embed){if(me=prompt("Enter "+Se),!me)return;be.quill.updateContents(new m.default().retain(Oe.index).delete(Oe.length).insert(M({},Se,me)),T.default.sources.USER)}else be.quill.format(Se,me,T.default.sources.USER);be.update(Oe)}),this.controls.push([Se,de])}}},{key:"update",value:function(de){var be=de==null?{}:this.quill.getFormat(de);this.controls.forEach(function(Se){var Ae=o(Se,2),xe=Ae[0],me=Ae[1];if(me.tagName==="SELECT"){var Ce=void 0;if(de==null)Ce=null;else if(be[xe]==null)Ce=me.querySelector("option[selected]");else if(!Array.isArray(be[xe])){var ge=be[xe];typeof ge=="string"&&(ge=ge.replace(/\"/g,'\\"')),Ce=me.querySelector('option[value="'+ge+'"]')}Ce==null?(me.value="",me.selectedIndex=-1):Ce.selected=!0}else if(de==null)me.classList.remove("ql-active");else if(me.hasAttribute("value")){var pe=be[xe]===me.getAttribute("value")||be[xe]!=null&&be[xe].toString()===me.getAttribute("value")||be[xe]==null&&!me.getAttribute("value");me.classList.toggle("ql-active",pe)}else me.classList.toggle("ql-active",be[xe]!=null)})}}]),ee}(N.default);K.DEFAULTS={};function te(re,ee,ie){var de=document.createElement("button");de.setAttribute("type","button"),de.classList.add("ql-"+ee),ie!=null&&(de.value=ie),re.appendChild(de)}function ne(re,ee){Array.isArray(ee[0])||(ee=[ee]),ee.forEach(function(ie){var de=document.createElement("span");de.classList.add("ql-formats"),ie.forEach(function(be){if(typeof be=="string")te(de,be);else{var Se=Object.keys(be)[0],Ae=be[Se];Array.isArray(Ae)?ae(de,Se,Ae):te(de,Se,Ae)}}),re.appendChild(de)})}function ae(re,ee,ie){var de=document.createElement("select");de.classList.add("ql-"+ee),ie.forEach(function(be){var Se=document.createElement("option");be!==!1?Se.setAttribute("value",be):Se.setAttribute("selected","selected"),de.appendChild(Se)}),re.appendChild(de)}K.DEFAULTS={container:null,handlers:{clean:function(){var ee=this,ie=this.quill.getSelection();if(ie!=null)if(ie.length==0){var de=this.quill.getFormat();Object.keys(de).forEach(function(be){S.default.query(be,S.default.Scope.INLINE)!=null&&ee.quill.format(be,!1)})}else this.quill.removeFormat(ie,T.default.sources.USER)},direction:function(ee){var ie=this.quill.getFormat().align;ee==="rtl"&&ie==null?this.quill.format("align","right",T.default.sources.USER):!ee&&ie==="right"&&this.quill.format("align",!1,T.default.sources.USER),this.quill.format("direction",ee,T.default.sources.USER)},indent:function(ee){var ie=this.quill.getSelection(),de=this.quill.getFormat(ie),be=parseInt(de.indent||0);if(ee==="+1"||ee==="-1"){var Se=ee==="+1"?1:-1;de.direction==="rtl"&&(Se*=-1),this.quill.format("indent",be+Se,T.default.sources.USER)}},link:function(ee){ee===!0&&(ee=prompt("Enter link URL:")),this.quill.format("link",ee,T.default.sources.USER)},list:function(ee){var ie=this.quill.getSelection(),de=this.quill.getFormat(ie);ee==="check"?de.list==="checked"||de.list==="unchecked"?this.quill.format("list",!1,T.default.sources.USER):this.quill.format("list","unchecked",T.default.sources.USER):this.quill.format("list",ee,T.default.sources.USER)}}},n.default=K,n.addControls=ne},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,N){for(var R=0;R<N.length;R++){var M=N[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,N,R){return N&&O(P.prototype,N),R&&O(P,R),P}}(),d=function O(P,N,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,N);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,N,R)}else{if("value"in M)return M.value;var B=M.get;return B===void 0?void 0:B.call(R)}},i=s(28),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function w(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(N,R){S(this,P);var M=w(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,N));return M.label.innerHTML=R,M.container.classList.add("ql-color-picker"),[].slice.call(M.container.querySelectorAll(".ql-picker-item"),0,7).forEach(function(F){F.classList.add("ql-primary")}),M}return o(P,[{key:"buildItem",value:function(R){var M=d(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"buildItem",this).call(this,R);return M.style.backgroundColor=R.getAttribute("value")||"",M}},{key:"selectItem",value:function(R,M){d(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"selectItem",this).call(this,R,M);var F=this.label.querySelector(".ql-color-label"),B=R&&R.getAttribute("data-value")||"";F&&(F.tagName==="line"?F.style.stroke=B:F.style.fill=B)}}]),P}(m.default);n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,N){for(var R=0;R<N.length;R++){var M=N[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,N,R){return N&&O(P.prototype,N),R&&O(P,R),P}}(),d=function O(P,N,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,N);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,N,R)}else{if("value"in M)return M.value;var B=M.get;return B===void 0?void 0:B.call(R)}},i=s(28),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function w(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(N,R){S(this,P);var M=w(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,N));return M.container.classList.add("ql-icon-picker"),[].forEach.call(M.container.querySelectorAll(".ql-picker-item"),function(F){F.innerHTML=R[F.getAttribute("data-value")||""]}),M.defaultItem=M.container.querySelector(".ql-selected"),M.selectItem(M.defaultItem),M}return o(P,[{key:"selectItem",value:function(R,M){d(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"selectItem",this).call(this,R,M),R=R||this.defaultItem,this.label.innerHTML=R.innerHTML}}]),P}(m.default);n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function m(y,S){for(var w=0;w<S.length;w++){var T=S[w];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}return function(y,S,w){return S&&m(y.prototype,S),w&&m(y,w),y}}();function d(m,y){if(!(m instanceof y))throw new TypeError("Cannot call a class as a function")}var i=function(){function m(y,S){var w=this;d(this,m),this.quill=y,this.boundsContainer=S||document.body,this.root=y.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",function(){w.root.style.marginTop=-1*w.quill.root.scrollTop+"px"}),this.hide()}return o(m,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(S){var w=S.left+S.width/2-this.root.offsetWidth/2,T=S.bottom+this.quill.root.scrollTop;this.root.style.left=w+"px",this.root.style.top=T+"px",this.root.classList.remove("ql-flip");var A=this.boundsContainer.getBoundingClientRect(),O=this.root.getBoundingClientRect(),P=0;if(O.right>A.right&&(P=A.right-O.right,this.root.style.left=w+P+"px"),O.left<A.left&&(P=A.left-O.left,this.root.style.left=w+P+"px"),O.bottom>A.bottom){var N=O.bottom-O.top,R=S.bottom-S.top+N;this.root.style.top=T-R+"px",this.root.classList.add("ql-flip")}return P}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),m}();n.default=i},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function ae(re,ee){var ie=[],de=!0,be=!1,Se=void 0;try{for(var Ae=re[Symbol.iterator](),xe;!(de=(xe=Ae.next()).done)&&(ie.push(xe.value),!(ee&&ie.length===ee));de=!0);}catch(me){be=!0,Se=me}finally{try{!de&&Ae.return&&Ae.return()}finally{if(be)throw Se}}return ie}return function(re,ee){if(Array.isArray(re))return re;if(Symbol.iterator in Object(re))return ae(re,ee);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function ae(re,ee,ie){re===null&&(re=Function.prototype);var de=Object.getOwnPropertyDescriptor(re,ee);if(de===void 0){var be=Object.getPrototypeOf(re);return be===null?void 0:ae(be,ee,ie)}else{if("value"in de)return de.value;var Se=de.get;return Se===void 0?void 0:Se.call(ie)}},i=function(){function ae(re,ee){for(var ie=0;ie<ee.length;ie++){var de=ee[ie];de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(re,de.key,de)}}return function(re,ee,ie){return ee&&ae(re.prototype,ee),ie&&ae(re,ie),re}}(),m=s(3),y=F(m),S=s(8),w=F(S),T=s(43),A=F(T),O=s(27),P=F(O),N=s(15),R=s(41),M=F(R);function F(ae){return ae&&ae.__esModule?ae:{default:ae}}function B(ae,re){if(!(ae instanceof re))throw new TypeError("Cannot call a class as a function")}function $(ae,re){if(!ae)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return re&&(typeof re=="object"||typeof re=="function")?re:ae}function W(ae,re){if(typeof re!="function"&&re!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof re);ae.prototype=Object.create(re&&re.prototype,{constructor:{value:ae,enumerable:!1,writable:!0,configurable:!0}}),re&&(Object.setPrototypeOf?Object.setPrototypeOf(ae,re):ae.__proto__=re)}var K=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],te=function(ae){W(re,ae);function re(ee,ie){B(this,re),ie.modules.toolbar!=null&&ie.modules.toolbar.container==null&&(ie.modules.toolbar.container=K);var de=$(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,ee,ie));return de.quill.container.classList.add("ql-snow"),de}return i(re,[{key:"extendToolbar",value:function(ie){ie.container.classList.add("ql-snow"),this.buildButtons([].slice.call(ie.container.querySelectorAll("button")),M.default),this.buildPickers([].slice.call(ie.container.querySelectorAll("select")),M.default),this.tooltip=new ne(this.quill,this.options.bounds),ie.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(de,be){ie.handlers.link.call(ie,!be.format.link)})}}]),re}(A.default);te.DEFAULTS=(0,y.default)(!0,{},A.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(re){if(re){var ee=this.quill.getSelection();if(ee==null||ee.length==0)return;var ie=this.quill.getText(ee);/^\S+@\S+\.\S+$/.test(ie)&&ie.indexOf("mailto:")!==0&&(ie="mailto:"+ie);var de=this.quill.theme.tooltip;de.edit("link",ie)}else this.quill.format("link",!1)}}}}});var ne=function(ae){W(re,ae);function re(ee,ie){B(this,re);var de=$(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,ee,ie));return de.preview=de.root.querySelector("a.ql-preview"),de}return i(re,[{key:"listen",value:function(){var ie=this;d(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",function(de){ie.root.classList.contains("ql-editing")?ie.save():ie.edit("link",ie.preview.textContent),de.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",function(de){if(ie.linkRange!=null){var be=ie.linkRange;ie.restoreFocus(),ie.quill.formatText(be,"link",!1,w.default.sources.USER),delete ie.linkRange}de.preventDefault(),ie.hide()}),this.quill.on(w.default.events.SELECTION_CHANGE,function(de,be,Se){if(de!=null){if(de.length===0&&Se===w.default.sources.USER){var Ae=ie.quill.scroll.descendant(P.default,de.index),xe=o(Ae,2),me=xe[0],Ce=xe[1];if(me!=null){ie.linkRange=new N.Range(de.index-Ce,me.length());var ge=P.default.formats(me.domNode);ie.preview.textContent=ge,ie.preview.setAttribute("href",ge),ie.show(),ie.position(ie.quill.getBounds(ie.linkRange));return}}else delete ie.linkRange;ie.hide()}})}},{key:"show",value:function(){d(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),re}(T.BaseTooltip);ne.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),n.default=te},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(29),d=rt(o),i=s(36),m=s(38),y=s(64),S=s(65),w=rt(S),T=s(66),A=rt(T),O=s(67),P=rt(O),N=s(37),R=s(26),M=s(39),F=s(40),B=s(56),$=rt(B),W=s(68),K=rt(W),te=s(27),ne=rt(te),ae=s(69),re=rt(ae),ee=s(70),ie=rt(ee),de=s(71),be=rt(de),Se=s(72),Ae=rt(Se),xe=s(73),me=rt(xe),Ce=s(13),ge=rt(Ce),pe=s(74),Oe=rt(pe),Xe=s(75),We=rt(Xe),$e=s(57),Ke=rt($e),Le=s(41),ke=rt(Le),st=s(28),_t=rt(st),Be=s(59),Dt=rt(Be),It=s(60),ir=rt(It),Dr=s(61),Rr=rt(Dr),jt=s(108),zt=rt(jt),Je=s(62),pt=rt(Je);function rt(Kt){return Kt&&Kt.__esModule?Kt:{default:Kt}}d.default.register({"attributors/attribute/direction":m.DirectionAttribute,"attributors/class/align":i.AlignClass,"attributors/class/background":N.BackgroundClass,"attributors/class/color":R.ColorClass,"attributors/class/direction":m.DirectionClass,"attributors/class/font":M.FontClass,"attributors/class/size":F.SizeClass,"attributors/style/align":i.AlignStyle,"attributors/style/background":N.BackgroundStyle,"attributors/style/color":R.ColorStyle,"attributors/style/direction":m.DirectionStyle,"attributors/style/font":M.FontStyle,"attributors/style/size":F.SizeStyle},!0),d.default.register({"formats/align":i.AlignClass,"formats/direction":m.DirectionClass,"formats/indent":y.IndentClass,"formats/background":N.BackgroundStyle,"formats/color":R.ColorStyle,"formats/font":M.FontClass,"formats/size":F.SizeClass,"formats/blockquote":w.default,"formats/code-block":ge.default,"formats/header":A.default,"formats/list":P.default,"formats/bold":$.default,"formats/code":Ce.Code,"formats/italic":K.default,"formats/link":ne.default,"formats/script":re.default,"formats/strike":ie.default,"formats/underline":be.default,"formats/image":Ae.default,"formats/video":me.default,"formats/list/item":O.ListItem,"modules/formula":Oe.default,"modules/syntax":We.default,"modules/toolbar":Ke.default,"themes/bubble":zt.default,"themes/snow":pt.default,"ui/icons":ke.default,"ui/picker":_t.default,"ui/icon-picker":ir.default,"ui/color-picker":Dt.default,"ui/tooltip":Rr.default},!0),n.default=d.default},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.IndentClass=void 0;var o=function(){function P(N,R){for(var M=0;M<R.length;M++){var F=R[M];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(N,F.key,F)}}return function(N,R,M){return R&&P(N.prototype,R),M&&P(N,M),N}}(),d=function P(N,R,M){N===null&&(N=Function.prototype);var F=Object.getOwnPropertyDescriptor(N,R);if(F===void 0){var B=Object.getPrototypeOf(N);return B===null?void 0:P(B,R,M)}else{if("value"in F)return F.value;var $=F.get;return $===void 0?void 0:$.call(M)}},i=s(0),m=y(i);function y(P){return P&&P.__esModule?P:{default:P}}function S(P,N){if(!(P instanceof N))throw new TypeError("Cannot call a class as a function")}function w(P,N){if(!P)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N&&(typeof N=="object"||typeof N=="function")?N:P}function T(P,N){if(typeof N!="function"&&N!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof N);P.prototype=Object.create(N&&N.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),N&&(Object.setPrototypeOf?Object.setPrototypeOf(P,N):P.__proto__=N)}var A=function(P){T(N,P);function N(){return S(this,N),w(this,(N.__proto__||Object.getPrototypeOf(N)).apply(this,arguments))}return o(N,[{key:"add",value:function(M,F){if(F==="+1"||F==="-1"){var B=this.value(M)||0;F=F==="+1"?B+1:B-1}return F===0?(this.remove(M),!0):d(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"add",this).call(this,M,F)}},{key:"canAdd",value:function(M,F){return d(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"canAdd",this).call(this,M,F)||d(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"canAdd",this).call(this,M,parseInt(F))}},{key:"value",value:function(M){return parseInt(d(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"value",this).call(this,M))||void 0}}]),N}(m.default.Attributor.Class),O=new A("indent","ql-indent",{scope:m.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});n.IndentClass=O},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(4),d=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var w=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(d.default);w.blotName="blockquote",w.tagName="blockquote",n.default=w},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function A(O,P){for(var N=0;N<P.length;N++){var R=P[N];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(O,R.key,R)}}return function(O,P,N){return P&&A(O.prototype,P),N&&A(O,N),O}}(),d=s(4),i=m(d);function m(A){return A&&A.__esModule?A:{default:A}}function y(A,O){if(!(A instanceof O))throw new TypeError("Cannot call a class as a function")}function S(A,O){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O&&(typeof O=="object"||typeof O=="function")?O:A}function w(A,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof O);A.prototype=Object.create(O&&O.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),O&&(Object.setPrototypeOf?Object.setPrototypeOf(A,O):A.__proto__=O)}var T=function(A){w(O,A);function O(){return y(this,O),S(this,(O.__proto__||Object.getPrototypeOf(O)).apply(this,arguments))}return o(O,null,[{key:"formats",value:function(N){return this.tagName.indexOf(N.tagName)+1}}]),O}(i.default);T.blotName="header",T.tagName=["H1","H2","H3","H4","H5","H6"],n.default=T},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.ListItem=void 0;var o=function(){function B($,W){for(var K=0;K<W.length;K++){var te=W[K];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty($,te.key,te)}}return function($,W,K){return W&&B($.prototype,W),K&&B($,K),$}}(),d=function B($,W,K){$===null&&($=Function.prototype);var te=Object.getOwnPropertyDescriptor($,W);if(te===void 0){var ne=Object.getPrototypeOf($);return ne===null?void 0:B(ne,W,K)}else{if("value"in te)return te.value;var ae=te.get;return ae===void 0?void 0:ae.call(K)}},i=s(0),m=A(i),y=s(4),S=A(y),w=s(25),T=A(w);function A(B){return B&&B.__esModule?B:{default:B}}function O(B,$,W){return $ in B?Object.defineProperty(B,$,{value:W,enumerable:!0,configurable:!0,writable:!0}):B[$]=W,B}function P(B,$){if(!(B instanceof $))throw new TypeError("Cannot call a class as a function")}function N(B,$){if(!B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return $&&(typeof $=="object"||typeof $=="function")?$:B}function R(B,$){if(typeof $!="function"&&$!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof $);B.prototype=Object.create($&&$.prototype,{constructor:{value:B,enumerable:!1,writable:!0,configurable:!0}}),$&&(Object.setPrototypeOf?Object.setPrototypeOf(B,$):B.__proto__=$)}var M=function(B){R($,B);function $(){return P(this,$),N(this,($.__proto__||Object.getPrototypeOf($)).apply(this,arguments))}return o($,[{key:"format",value:function(K,te){K===F.blotName&&!te?this.replaceWith(m.default.create(this.statics.scope)):d($.prototype.__proto__||Object.getPrototypeOf($.prototype),"format",this).call(this,K,te)}},{key:"remove",value:function(){this.prev==null&&this.next==null?this.parent.remove():d($.prototype.__proto__||Object.getPrototypeOf($.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(K,te){return this.parent.isolate(this.offset(this.parent),this.length()),K===this.parent.statics.blotName?(this.parent.replaceWith(K,te),this):(this.parent.unwrap(),d($.prototype.__proto__||Object.getPrototypeOf($.prototype),"replaceWith",this).call(this,K,te))}}],[{key:"formats",value:function(K){return K.tagName===this.tagName?void 0:d($.__proto__||Object.getPrototypeOf($),"formats",this).call(this,K)}}]),$}(S.default);M.blotName="list-item",M.tagName="LI";var F=function(B){R($,B),o($,null,[{key:"create",value:function(K){var te=K==="ordered"?"OL":"UL",ne=d($.__proto__||Object.getPrototypeOf($),"create",this).call(this,te);return(K==="checked"||K==="unchecked")&&ne.setAttribute("data-checked",K==="checked"),ne}},{key:"formats",value:function(K){if(K.tagName==="OL")return"ordered";if(K.tagName==="UL")return K.hasAttribute("data-checked")?K.getAttribute("data-checked")==="true"?"checked":"unchecked":"bullet"}}]);function $(W){P(this,$);var K=N(this,($.__proto__||Object.getPrototypeOf($)).call(this,W)),te=function(ae){if(ae.target.parentNode===W){var re=K.statics.formats(W),ee=m.default.find(ae.target);re==="checked"?ee.format("list","unchecked"):re==="unchecked"&&ee.format("list","checked")}};return W.addEventListener("touchstart",te),W.addEventListener("mousedown",te),K}return o($,[{key:"format",value:function(K,te){this.children.length>0&&this.children.tail.format(K,te)}},{key:"formats",value:function(){return O({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(K,te){if(K instanceof M)d($.prototype.__proto__||Object.getPrototypeOf($.prototype),"insertBefore",this).call(this,K,te);else{var ne=te==null?this.length():te.offset(this),ae=this.split(ne);ae.parent.insertBefore(K,ae)}}},{key:"optimize",value:function(K){d($.prototype.__proto__||Object.getPrototypeOf($.prototype),"optimize",this).call(this,K);var te=this.next;te!=null&&te.prev===this&&te.statics.blotName===this.statics.blotName&&te.domNode.tagName===this.domNode.tagName&&te.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(te.moveChildren(this),te.remove())}},{key:"replace",value:function(K){if(K.statics.blotName!==this.statics.blotName){var te=m.default.create(this.statics.defaultChild);K.moveChildren(te),this.appendChild(te)}d($.prototype.__proto__||Object.getPrototypeOf($.prototype),"replace",this).call(this,K)}}]),$}(T.default);F.blotName="list",F.scope=m.default.Scope.BLOCK_BLOT,F.tagName=["OL","UL"],F.defaultChild="list-item",F.allowedChildren=[M],n.ListItem=M,n.default=F},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(56),d=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var w=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(d.default);w.blotName="italic",w.tagName=["EM","I"],n.default=w},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,N){for(var R=0;R<N.length;R++){var M=N[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,N,R){return N&&O(P.prototype,N),R&&O(P,R),P}}(),d=function O(P,N,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,N);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,N,R)}else{if("value"in M)return M.value;var B=M.get;return B===void 0?void 0:B.call(R)}},i=s(6),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function w(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),w(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return o(P,null,[{key:"create",value:function(R){return R==="super"?document.createElement("sup"):R==="sub"?document.createElement("sub"):d(P.__proto__||Object.getPrototypeOf(P),"create",this).call(this,R)}},{key:"formats",value:function(R){if(R.tagName==="SUB")return"sub";if(R.tagName==="SUP")return"super"}}]),P}(m.default);A.blotName="script",A.tagName=["SUB","SUP"],n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(6),d=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var w=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(d.default);w.blotName="strike",w.tagName="S",n.default=w},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(6),d=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var w=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(d.default);w.blotName="underline",w.tagName="U",n.default=w},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function N(R,M){for(var F=0;F<M.length;F++){var B=M[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(R,B.key,B)}}return function(R,M,F){return M&&N(R.prototype,M),F&&N(R,F),R}}(),d=function N(R,M,F){R===null&&(R=Function.prototype);var B=Object.getOwnPropertyDescriptor(R,M);if(B===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:N($,M,F)}else{if("value"in B)return B.value;var W=B.get;return W===void 0?void 0:W.call(F)}},i=s(0),m=S(i),y=s(27);function S(N){return N&&N.__esModule?N:{default:N}}function w(N,R){if(!(N instanceof R))throw new TypeError("Cannot call a class as a function")}function T(N,R){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:N}function A(N,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);N.prototype=Object.create(R&&R.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(N,R):N.__proto__=R)}var O=["alt","height","width"],P=function(N){A(R,N);function R(){return w(this,R),T(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"format",value:function(F,B){O.indexOf(F)>-1?B?this.domNode.setAttribute(F,B):this.domNode.removeAttribute(F):d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"format",this).call(this,F,B)}}],[{key:"create",value:function(F){var B=d(R.__proto__||Object.getPrototypeOf(R),"create",this).call(this,F);return typeof F=="string"&&B.setAttribute("src",this.sanitize(F)),B}},{key:"formats",value:function(F){return O.reduce(function(B,$){return F.hasAttribute($)&&(B[$]=F.getAttribute($)),B},{})}},{key:"match",value:function(F){return/\.(jpe?g|gif|png)$/.test(F)||/^data:image\/.+;base64/.test(F)}},{key:"sanitize",value:function(F){return(0,y.sanitize)(F,["http","https","data"])?F:"//:0"}},{key:"value",value:function(F){return F.getAttribute("src")}}]),R}(m.default.Embed);P.blotName="image",P.tagName="IMG",n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function N(R,M){for(var F=0;F<M.length;F++){var B=M[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(R,B.key,B)}}return function(R,M,F){return M&&N(R.prototype,M),F&&N(R,F),R}}(),d=function N(R,M,F){R===null&&(R=Function.prototype);var B=Object.getOwnPropertyDescriptor(R,M);if(B===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:N($,M,F)}else{if("value"in B)return B.value;var W=B.get;return W===void 0?void 0:W.call(F)}},i=s(4),m=s(27),y=S(m);function S(N){return N&&N.__esModule?N:{default:N}}function w(N,R){if(!(N instanceof R))throw new TypeError("Cannot call a class as a function")}function T(N,R){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:N}function A(N,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);N.prototype=Object.create(R&&R.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(N,R):N.__proto__=R)}var O=["height","width"],P=function(N){A(R,N);function R(){return w(this,R),T(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"format",value:function(F,B){O.indexOf(F)>-1?B?this.domNode.setAttribute(F,B):this.domNode.removeAttribute(F):d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"format",this).call(this,F,B)}}],[{key:"create",value:function(F){var B=d(R.__proto__||Object.getPrototypeOf(R),"create",this).call(this,F);return B.setAttribute("frameborder","0"),B.setAttribute("allowfullscreen",!0),B.setAttribute("src",this.sanitize(F)),B}},{key:"formats",value:function(F){return O.reduce(function(B,$){return F.hasAttribute($)&&(B[$]=F.getAttribute($)),B},{})}},{key:"sanitize",value:function(F){return y.default.sanitize(F)}},{key:"value",value:function(F){return F.getAttribute("src")}}]),R}(i.BlockEmbed);P.blotName="video",P.className="ql-video",P.tagName="IFRAME",n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.FormulaBlot=void 0;var o=function(){function F(B,$){for(var W=0;W<$.length;W++){var K=$[W];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(B,K.key,K)}}return function(B,$,W){return $&&F(B.prototype,$),W&&F(B,W),B}}(),d=function F(B,$,W){B===null&&(B=Function.prototype);var K=Object.getOwnPropertyDescriptor(B,$);if(K===void 0){var te=Object.getPrototypeOf(B);return te===null?void 0:F(te,$,W)}else{if("value"in K)return K.value;var ne=K.get;return ne===void 0?void 0:ne.call(W)}},i=s(35),m=A(i),y=s(5),S=A(y),w=s(9),T=A(w);function A(F){return F&&F.__esModule?F:{default:F}}function O(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function P(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function N(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var R=function(F){N(B,F);function B(){return O(this,B),P(this,(B.__proto__||Object.getPrototypeOf(B)).apply(this,arguments))}return o(B,null,[{key:"create",value:function(W){var K=d(B.__proto__||Object.getPrototypeOf(B),"create",this).call(this,W);return typeof W=="string"&&(window.katex.render(W,K,{throwOnError:!1,errorColor:"#f00"}),K.setAttribute("data-value",W)),K}},{key:"value",value:function(W){return W.getAttribute("data-value")}}]),B}(m.default);R.blotName="formula",R.className="ql-formula",R.tagName="SPAN";var M=function(F){N(B,F),o(B,null,[{key:"register",value:function(){S.default.register(R,!0)}}]);function B(){O(this,B);var $=P(this,(B.__proto__||Object.getPrototypeOf(B)).call(this));if(window.katex==null)throw new Error("Formula module requires KaTeX.");return $}return B}(T.default);n.FormulaBlot=R,n.default=M},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.CodeToken=n.CodeBlock=void 0;var o=function(){function W(K,te){for(var ne=0;ne<te.length;ne++){var ae=te[ne];ae.enumerable=ae.enumerable||!1,ae.configurable=!0,"value"in ae&&(ae.writable=!0),Object.defineProperty(K,ae.key,ae)}}return function(K,te,ne){return te&&W(K.prototype,te),ne&&W(K,ne),K}}(),d=function W(K,te,ne){K===null&&(K=Function.prototype);var ae=Object.getOwnPropertyDescriptor(K,te);if(ae===void 0){var re=Object.getPrototypeOf(K);return re===null?void 0:W(re,te,ne)}else{if("value"in ae)return ae.value;var ee=ae.get;return ee===void 0?void 0:ee.call(ne)}},i=s(0),m=P(i),y=s(5),S=P(y),w=s(9),T=P(w),A=s(13),O=P(A);function P(W){return W&&W.__esModule?W:{default:W}}function N(W,K){if(!(W instanceof K))throw new TypeError("Cannot call a class as a function")}function R(W,K){if(!W)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K&&(typeof K=="object"||typeof K=="function")?K:W}function M(W,K){if(typeof K!="function"&&K!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof K);W.prototype=Object.create(K&&K.prototype,{constructor:{value:W,enumerable:!1,writable:!0,configurable:!0}}),K&&(Object.setPrototypeOf?Object.setPrototypeOf(W,K):W.__proto__=K)}var F=function(W){M(K,W);function K(){return N(this,K),R(this,(K.__proto__||Object.getPrototypeOf(K)).apply(this,arguments))}return o(K,[{key:"replaceWith",value:function(ne){this.domNode.textContent=this.domNode.textContent,this.attach(),d(K.prototype.__proto__||Object.getPrototypeOf(K.prototype),"replaceWith",this).call(this,ne)}},{key:"highlight",value:function(ne){var ae=this.domNode.textContent;this.cachedText!==ae&&((ae.trim().length>0||this.cachedText==null)&&(this.domNode.innerHTML=ne(ae),this.domNode.normalize(),this.attach()),this.cachedText=ae)}}]),K}(O.default);F.className="ql-syntax";var B=new m.default.Attributor.Class("token","hljs",{scope:m.default.Scope.INLINE}),$=function(W){M(K,W),o(K,null,[{key:"register",value:function(){S.default.register(B,!0),S.default.register(F,!0)}}]);function K(te,ne){N(this,K);var ae=R(this,(K.__proto__||Object.getPrototypeOf(K)).call(this,te,ne));if(typeof ae.options.highlight!="function")throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var re=null;return ae.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){clearTimeout(re),re=setTimeout(function(){ae.highlight(),re=null},ae.options.interval)}),ae.highlight(),ae}return o(K,[{key:"highlight",value:function(){var ne=this;if(!this.quill.selection.composing){this.quill.update(S.default.sources.USER);var ae=this.quill.getSelection();this.quill.scroll.descendants(F).forEach(function(re){re.highlight(ne.options.highlight)}),this.quill.update(S.default.sources.SILENT),ae!=null&&this.quill.setSelection(ae,S.default.sources.SILENT)}}}]),K}(T.default);$.DEFAULTS={highlight:function(){return window.hljs==null?null:function(W){var K=window.hljs.highlightAuto(W);return K.value}}(),interval:1e3},n.CodeBlock=F,n.CodeToken=B,n.default=$},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BubbleTooltip=void 0;var o=function K(te,ne,ae){te===null&&(te=Function.prototype);var re=Object.getOwnPropertyDescriptor(te,ne);if(re===void 0){var ee=Object.getPrototypeOf(te);return ee===null?void 0:K(ee,ne,ae)}else{if("value"in re)return re.value;var ie=re.get;return ie===void 0?void 0:ie.call(ae)}},d=function(){function K(te,ne){for(var ae=0;ae<ne.length;ae++){var re=ne[ae];re.enumerable=re.enumerable||!1,re.configurable=!0,"value"in re&&(re.writable=!0),Object.defineProperty(te,re.key,re)}}return function(te,ne,ae){return ne&&K(te.prototype,ne),ae&&K(te,ae),te}}(),i=s(3),m=N(i),y=s(8),S=N(y),w=s(43),T=N(w),A=s(15),O=s(41),P=N(O);function N(K){return K&&K.__esModule?K:{default:K}}function R(K,te){if(!(K instanceof te))throw new TypeError("Cannot call a class as a function")}function M(K,te){if(!K)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return te&&(typeof te=="object"||typeof te=="function")?te:K}function F(K,te){if(typeof te!="function"&&te!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof te);K.prototype=Object.create(te&&te.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),te&&(Object.setPrototypeOf?Object.setPrototypeOf(K,te):K.__proto__=te)}var B=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],$=function(K){F(te,K);function te(ne,ae){R(this,te),ae.modules.toolbar!=null&&ae.modules.toolbar.container==null&&(ae.modules.toolbar.container=B);var re=M(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,ne,ae));return re.quill.container.classList.add("ql-bubble"),re}return d(te,[{key:"extendToolbar",value:function(ae){this.tooltip=new W(this.quill,this.options.bounds),this.tooltip.root.appendChild(ae.container),this.buildButtons([].slice.call(ae.container.querySelectorAll("button")),P.default),this.buildPickers([].slice.call(ae.container.querySelectorAll("select")),P.default)}}]),te}(T.default);$.DEFAULTS=(0,m.default)(!0,{},T.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(te){te?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var W=function(K){F(te,K);function te(ne,ae){R(this,te);var re=M(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,ne,ae));return re.quill.on(S.default.events.EDITOR_CHANGE,function(ee,ie,de,be){if(ee===S.default.events.SELECTION_CHANGE)if(ie!=null&&ie.length>0&&be===S.default.sources.USER){re.show(),re.root.style.left="0px",re.root.style.width="",re.root.style.width=re.root.offsetWidth+"px";var Se=re.quill.getLines(ie.index,ie.length);if(Se.length===1)re.position(re.quill.getBounds(ie));else{var Ae=Se[Se.length-1],xe=re.quill.getIndex(Ae),me=Math.min(Ae.length()-1,ie.index+ie.length-xe),Ce=re.quill.getBounds(new A.Range(xe,me));re.position(Ce)}}else document.activeElement!==re.textbox&&re.quill.hasFocus()&&re.hide()}),re}return d(te,[{key:"listen",value:function(){var ae=this;o(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",function(){ae.root.classList.remove("ql-editing")}),this.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){setTimeout(function(){if(!ae.root.classList.contains("ql-hidden")){var re=ae.quill.getSelection();re!=null&&ae.position(ae.quill.getBounds(re))}},1)})}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(ae){var re=o(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"position",this).call(this,ae),ee=this.root.querySelector(".ql-tooltip-arrow");if(ee.style.marginLeft="",re===0)return re;ee.style.marginLeft=-1*re-ee.offsetWidth/2+"px"}}]),te}(w.BaseTooltip);W.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),n.BubbleTooltip=W,n.default=$},function(r,n,s){r.exports=s(63)}]).default})})(Ede);var knt=Ede.exports,Nnt=$c&&$c.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)s.hasOwnProperty(o)&&(n[o]=s[o])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ik=$c&&$c.__assign||function(){return Ik=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ik.apply(this,arguments)},Int=$c&&$c.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var o=arguments[t],d=0,i=o.length;d<i;d++,s++)n[s]=o[d];return n},VI=$c&&$c.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},gh=VI(V),Rnt=VI(xg),nE=VI(bce),_X=VI(knt),Mnt=function(e){Nnt(t,e);function t(r){var n=e.call(this,r)||this;n.dirtyProps=["modules","formats","bounds","theme","children"],n.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],n.state={generation:0},n.selection=null,n.onEditorChange=function(o,d,i,m){var y,S,w,T;o==="text-change"?(S=(y=n).onEditorChangeText)===null||S===void 0||S.call(y,n.editor.root.innerHTML,d,m,n.unprivilegedEditor):o==="selection-change"&&((T=(w=n).onEditorChangeSelection)===null||T===void 0||T.call(w,d,m,n.unprivilegedEditor))};var s=n.isControlled()?r.value:r.defaultValue;return n.value=s??"",n}return t.prototype.validateProps=function(r){var n;if(gh.default.Children.count(r.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(gh.default.Children.count(r.children)){var s=gh.default.Children.only(r.children);if(((n=s)===null||n===void 0?void 0:n.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&r.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},t.prototype.shouldComponentUpdate=function(r,n){var s=this,o;if(this.validateProps(r),!this.editor||this.state.generation!==n.generation)return!0;if("value"in r){var d=this.getEditorContents(),i=(o=r.value,o??"");this.isEqualValue(i,d)||this.setEditorContents(this.editor,i)}return r.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,r.readOnly),Int(this.cleanProps,this.dirtyProps).some(function(m){return!nE.default(r[m],s.props[m])})},t.prototype.shouldComponentRegenerate=function(r){var n=this;return this.dirtyProps.some(function(s){return!nE.default(r[s],n.props[s])})},t.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},t.prototype.componentWillUnmount=function(){this.destroyEditor()},t.prototype.componentDidUpdate=function(r,n){var s=this;if(this.editor&&this.shouldComponentRegenerate(r)){var o=this.editor.getContents(),d=this.editor.getSelection();this.regenerationSnapshot={delta:o,selection:d},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==n.generation){var i=this.regenerationSnapshot,o=i.delta,m=i.selection;delete this.regenerationSnapshot,this.instantiateEditor();var y=this.editor;y.setContents(o),xX(function(){return s.setEditorSelection(y,m)})}},t.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},t.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},t.prototype.isControlled=function(){return"value"in this.props},t.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},t.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},t.prototype.createEditor=function(r,n){var s=new _X.default(r,n);return n.tabIndex!=null&&this.setEditorTabIndex(s,n.tabIndex),this.hookEditor(s),s},t.prototype.hookEditor=function(r){this.unprivilegedEditor=this.makeUnprivilegedEditor(r),r.on("editor-change",this.onEditorChange)},t.prototype.unhookEditor=function(r){r.off("editor-change",this.onEditorChange)},t.prototype.getEditorContents=function(){return this.value},t.prototype.getEditorSelection=function(){return this.selection},t.prototype.isDelta=function(r){return r&&r.ops},t.prototype.isEqualValue=function(r,n){return this.isDelta(r)&&this.isDelta(n)?nE.default(r.ops,n.ops):nE.default(r,n)},t.prototype.setEditorContents=function(r,n){var s=this;this.value=n;var o=this.getEditorSelection();typeof n=="string"?r.setContents(r.clipboard.convert(n)):r.setContents(n),xX(function(){return s.setEditorSelection(r,o)})},t.prototype.setEditorSelection=function(r,n){if(this.selection=n,n){var s=r.getLength();n.index=Math.max(0,Math.min(n.index,s-1)),n.length=Math.max(0,Math.min(n.length,s-1-n.index)),r.setSelection(n)}},t.prototype.setEditorTabIndex=function(r,n){var s,o;!((o=(s=r)===null||s===void 0?void 0:s.scroll)===null||o===void 0)&&o.domNode&&(r.scroll.domNode.tabIndex=n)},t.prototype.setEditorReadOnly=function(r,n){n?r.disable():r.enable()},t.prototype.makeUnprivilegedEditor=function(r){var n=r;return{getHTML:function(){return n.root.innerHTML},getLength:n.getLength.bind(n),getText:n.getText.bind(n),getContents:n.getContents.bind(n),getSelection:n.getSelection.bind(n),getBounds:n.getBounds.bind(n)}},t.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var r=Rnt.default.findDOMNode(this.editingArea);if(!r)throw new Error("Cannot find element for editing area");if(r.nodeType===3)throw new Error("Editing area cannot be a text node");return r},t.prototype.renderEditingArea=function(){var r=this,n=this.props,s=n.children,o=n.preserveWhitespace,d=this.state.generation,i={key:d,ref:function(m){r.editingArea=m}};return gh.default.Children.count(s)?gh.default.cloneElement(gh.default.Children.only(s),i):o?gh.default.createElement("pre",Ik({},i)):gh.default.createElement("div",Ik({},i))},t.prototype.render=function(){var r;return gh.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(r=this.props.className,r??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},t.prototype.onEditorChangeText=function(r,n,s,o){var d,i;if(this.editor){var m=this.isDelta(this.value)?o.getContents():o.getHTML();m!==this.getEditorContents()&&(this.lastDeltaChangeSet=n,this.value=m,(i=(d=this.props).onChange)===null||i===void 0||i.call(d,r,n,s,o))}},t.prototype.onEditorChangeSelection=function(r,n,s){var o,d,i,m,y,S;if(this.editor){var w=this.getEditorSelection(),T=!w&&r,A=w&&!r;nE.default(r,w)||(this.selection=r,(d=(o=this.props).onChangeSelection)===null||d===void 0||d.call(o,r,n,s),T?(m=(i=this.props).onFocus)===null||m===void 0||m.call(i,r,n,s):A&&((S=(y=this.props).onBlur)===null||S===void 0||S.call(y,w,n,s)))}},t.prototype.focus=function(){this.editor&&this.editor.focus()},t.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},t.displayName="React Quill",t.Quill=_X.default,t.defaultProps={theme:"snow",modules:{},readOnly:!1},t}(gh.default.Component);function xX(e){Promise.resolve().then(e)}var Dnt=Mnt;const Lnt=Ps(Dnt);function Lf({value:e,onChange:t,placeholder:r,className:n}){const s=V.useMemo(()=>({toolbar:[[{header:[1,2,3,!1]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link"],["clean"]]}),[]),o=["header","size","bold","italic","underline","strike","color","background","list","bullet","align","link"];return h.jsxs("div",{className:fr("rich-text-editor",n),children:[h.jsx("style",{dangerouslySetInnerHTML:{__html:`
          .rich-text-editor .ql-container {
            min-height: 200px;
            font-family: inherit;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
          }
          
          .rich-text-editor .ql-toolbar {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            background: hsl(var(--muted));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-container {
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-editor {
            min-height: 200px;
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-editor.ql-blank::before {
            color: hsl(var(--muted-foreground));
            font-style: normal;
          }
          
          .rich-text-editor .ql-stroke {
            stroke: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-fill {
            fill: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-picker-label {
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-toolbar button:hover,
          .rich-text-editor .ql-toolbar button:focus,
          .rich-text-editor .ql-toolbar button.ql-active {
            color: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-stroke,
          .rich-text-editor .ql-toolbar button:focus .ql-stroke,
          .rich-text-editor .ql-toolbar button.ql-active .ql-stroke {
            stroke: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-fill,
          .rich-text-editor .ql-toolbar button:focus .ql-fill,
          .rich-text-editor .ql-toolbar button.ql-active .ql-fill {
            fill: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-picker-options {
            background: hsl(var(--background));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-picker-item:hover {
            color: hsl(var(--primary));
          }
        `}}),h.jsx(Lnt,{theme:"snow",value:e,onChange:t,modules:s,formats:o,placeholder:r,className:"bg-background"})]})}var Fnt=Object.defineProperty,znt=(e,t,r)=>t in e?Fnt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ea=(e,t,r)=>znt(e,typeof t!="symbol"?t+"":t,r);const Rk={x:0,y:0,width:0,height:0,unit:"px"},Xx=(e,t,r)=>Math.min(Math.max(e,t),r),Bnt=(...e)=>e.filter(t=>t&&typeof t=="string").join(" "),bX=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function $nt(e,t,r,n){const s=vh(e,r,n);return e.width&&(s.height=s.width/t),e.height&&(s.width=s.height*t),s.y+s.height>n&&(s.height=n-s.y,s.width=s.height*t),s.x+s.width>r&&(s.width=r-s.x,s.height=s.width/t),e.unit==="%"?Cm(s,r,n):s}function Unt(e,t,r){const n=vh(e,t,r);return n.x=(t-n.width)/2,n.y=(r-n.height)/2,e.unit==="%"?Cm(n,t,r):n}function Cm(e,t,r){return e.unit==="%"?{...Rk,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/r*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/r*100:0}}function vh(e,t,r){return e.unit?e.unit==="px"?{...Rk,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*r/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*r/100:0}:{...Rk,...e,unit:"px"}}function wX(e,t,r,n,s,o=0,d=0,i=n,m=s){const y={...e};let S=Math.min(o,n),w=Math.min(d,s),T=Math.min(i,n),A=Math.min(m,s);t&&(t>1?(S=d?d*t:S,w=S/t,T=i*t):(w=o?o/t:w,S=w*t,A=m/t)),y.y<0&&(y.height=Math.max(y.height+y.y,w),y.y=0),y.x<0&&(y.width=Math.max(y.width+y.x,S),y.x=0);const O=n-(y.x+y.width);O<0&&(y.x=Math.min(y.x,n-S),y.width+=O);const P=s-(y.y+y.height);if(P<0&&(y.y=Math.min(y.y,s-w),y.height+=P),y.width<S&&((r==="sw"||r=="nw")&&(y.x-=S-y.width),y.width=S),y.height<w&&((r==="nw"||r=="ne")&&(y.y-=w-y.height),y.height=w),y.width>T&&((r==="sw"||r=="nw")&&(y.x-=T-y.width),y.width=T),y.height>A&&((r==="nw"||r=="ne")&&(y.y-=A-y.height),y.height=A),t){const N=y.width/y.height;if(N<t){const R=Math.max(y.width/t,w);(r==="nw"||r=="ne")&&(y.y-=R-y.height),y.height=R}else if(N>t){const R=Math.max(y.height*t,S);(r==="sw"||r=="nw")&&(y.x-=R-y.width),y.width=R}}return y}function Vnt(e,t,r,n){const s={...e};return t==="ArrowLeft"?n==="nw"?(s.x-=r,s.y-=r,s.width+=r,s.height+=r):n==="w"?(s.x-=r,s.width+=r):n==="sw"?(s.x-=r,s.width+=r,s.height+=r):n==="ne"?(s.y+=r,s.width-=r,s.height-=r):n==="e"?s.width-=r:n==="se"&&(s.width-=r,s.height-=r):t==="ArrowRight"&&(n==="nw"?(s.x+=r,s.y+=r,s.width-=r,s.height-=r):n==="w"?(s.x+=r,s.width-=r):n==="sw"?(s.x+=r,s.width-=r,s.height-=r):n==="ne"?(s.y-=r,s.width+=r,s.height+=r):n==="e"?s.width+=r:n==="se"&&(s.width+=r,s.height+=r)),t==="ArrowUp"?n==="nw"?(s.x-=r,s.y-=r,s.width+=r,s.height+=r):n==="n"?(s.y-=r,s.height+=r):n==="ne"?(s.y-=r,s.width+=r,s.height+=r):n==="sw"?(s.x+=r,s.width-=r,s.height-=r):n==="s"?s.height-=r:n==="se"&&(s.width-=r,s.height-=r):t==="ArrowDown"&&(n==="nw"?(s.x+=r,s.y+=r,s.width-=r,s.height-=r):n==="n"?(s.y+=r,s.height-=r):n==="ne"?(s.y+=r,s.width-=r,s.height-=r):n==="sw"?(s.x-=r,s.width+=r,s.height+=r):n==="s"?s.height+=r:n==="se"&&(s.width+=r,s.height+=r)),s}const Yx={capture:!0,passive:!1};let qnt=0;const xm=class Td extends V.PureComponent{constructor(){super(...arguments),Ea(this,"docMoveBound",!1),Ea(this,"mouseDownOnCrop",!1),Ea(this,"dragStarted",!1),Ea(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),Ea(this,"componentRef",V.createRef()),Ea(this,"mediaRef",V.createRef()),Ea(this,"resizeObserver"),Ea(this,"initChangeCalled",!1),Ea(this,"instanceId",`rc-${qnt++}`),Ea(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),Ea(this,"onCropPointerDown",t=>{const{crop:r,disabled:n}=this.props,s=this.getBox();if(!r)return;const o=vh(r,s.width,s.height);if(n)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const d=t.target.dataset.ord,i=!!d;let m=t.clientX,y=t.clientY,S=o.x,w=o.y;if(d){const T=t.clientX-s.x,A=t.clientY-s.y;let O=0,P=0;d==="ne"||d=="e"?(O=T-(o.x+o.width),P=A-o.y,S=o.x,w=o.y+o.height):d==="se"||d==="s"?(O=T-(o.x+o.width),P=A-(o.y+o.height),S=o.x,w=o.y):d==="sw"||d=="w"?(O=T-o.x,P=A-(o.y+o.height),S=o.x+o.width,w=o.y):(d==="nw"||d=="n")&&(O=T-o.x,P=A-o.y,S=o.x+o.width,w=o.y+o.height),m=S+s.x+O,y=w+s.y+P}this.evData={startClientX:m,startClientY:y,startCropX:S,startCropY:w,clientX:t.clientX,clientY:t.clientY,isResize:i,ord:d},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),Ea(this,"onComponentPointerDown",t=>{const{crop:r,disabled:n,locked:s,keepSelection:o,onChange:d}=this.props,i=this.getBox();if(n||s||o&&r)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const m=t.clientX-i.x,y=t.clientY-i.y,S={unit:"px",x:m,y,width:0,height:0};this.evData={startClientX:t.clientX,startClientY:t.clientY,startCropX:m,startCropY:y,clientX:t.clientX,clientY:t.clientY,isResize:!0},this.mouseDownOnCrop=!0,d(vh(S,i.width,i.height),Cm(S,i.width,i.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),Ea(this,"onDocPointerMove",t=>{const{crop:r,disabled:n,onChange:s,onDragStart:o}=this.props,d=this.getBox();if(n||!r||!this.mouseDownOnCrop)return;t.cancelable&&t.preventDefault(),this.dragStarted||(this.dragStarted=!0,o&&o(t));const{evData:i}=this;i.clientX=t.clientX,i.clientY=t.clientY;let m;i.isResize?m=this.resizeCrop():m=this.dragCrop(),bX(r,m)||s(vh(m,d.width,d.height),Cm(m,d.width,d.height))}),Ea(this,"onComponentKeyDown",t=>{const{crop:r,disabled:n,onChange:s,onComplete:o}=this.props;if(n)return;const d=t.key;let i=!1;if(!r)return;const m=this.getBox(),y=this.makePixelCrop(m),S=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?Td.nudgeStepLarge:t.shiftKey?Td.nudgeStepMedium:Td.nudgeStep;if(d==="ArrowLeft"?(y.x-=S,i=!0):d==="ArrowRight"?(y.x+=S,i=!0):d==="ArrowUp"?(y.y-=S,i=!0):d==="ArrowDown"&&(y.y+=S,i=!0),i){t.cancelable&&t.preventDefault(),y.x=Xx(y.x,0,m.width-y.width),y.y=Xx(y.y,0,m.height-y.height);const w=vh(y,m.width,m.height),T=Cm(y,m.width,m.height);s(w,T),o&&o(w,T)}}),Ea(this,"onHandlerKeyDown",(t,r)=>{const{aspect:n=0,crop:s,disabled:o,minWidth:d=0,minHeight:i=0,maxWidth:m,maxHeight:y,onChange:S,onComplete:w}=this.props,T=this.getBox();if(o||!s)return;if(t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight")t.stopPropagation(),t.preventDefault();else return;const A=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?Td.nudgeStepLarge:t.shiftKey?Td.nudgeStepMedium:Td.nudgeStep,O=vh(s,T.width,T.height),P=Vnt(O,t.key,A,r),N=wX(P,n,r,T.width,T.height,d,i,m,y);if(!bX(s,N)){const R=Cm(N,T.width,T.height);S(N,R),w&&w(N,R)}}),Ea(this,"onDocPointerDone",t=>{const{crop:r,disabled:n,onComplete:s,onDragEnd:o}=this.props,d=this.getBox();this.unbindDocMove(),!(n||!r)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,o&&o(t),s&&s(vh(r,d.width,d.height),Cm(r,d.width,d.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),Ea(this,"onDragFocus",()=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)})}get document(){return document}getBox(){const t=this.mediaRef.current;if(!t)return{x:0,y:0,width:0,height:0};const{x:r,y:n,width:s,height:o}=t.getBoundingClientRect();return{x:r,y:n,width:s,height:o}}componentDidUpdate(t){const{crop:r,onComplete:n}=this.props;if(n&&!t.crop&&r){const{width:s,height:o}=this.getBox();s&&o&&n(vh(r,s,o),Cm(r,s,o))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,Yx),this.document.addEventListener("pointerup",this.onDocPointerDone,Yx),this.document.addEventListener("pointercancel",this.onDocPointerDone,Yx),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,Yx),this.document.removeEventListener("pointerup",this.onDocPointerDone,Yx),this.document.removeEventListener("pointercancel",this.onDocPointerDone,Yx),this.docMoveBound=!1)}getCropStyle(){const{crop:t}=this.props;if(t)return{top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`}}dragCrop(){const{evData:t}=this,r=this.getBox(),n=this.makePixelCrop(r),s=t.clientX-t.startClientX,o=t.clientY-t.startClientY;return n.x=Xx(t.startCropX+s,0,r.width-n.width),n.y=Xx(t.startCropY+o,0,r.height-n.height),n}getPointRegion(t,r,n,s){const{evData:o}=this,d=o.clientX-t.x,i=o.clientY-t.y;let m;s&&r?m=r==="nw"||r==="n"||r==="ne":m=i<o.startCropY;let y;return n&&r?y=r==="nw"||r==="w"||r==="sw":y=d<o.startCropX,y?m?"nw":"sw":m?"ne":"se"}resolveMinDimensions(t,r,n=0,s=0){const o=Math.min(n,t.width),d=Math.min(s,t.height);return!r||!o&&!d?[o,d]:r>1?o?[o,o/r]:[d*r,d]:d?[d*r,d]:[o,o/r]}resizeCrop(){const{evData:t}=this,{aspect:r=0,maxWidth:n,maxHeight:s}=this.props,o=this.getBox(),[d,i]=this.resolveMinDimensions(o,r,this.props.minWidth,this.props.minHeight);let m=this.makePixelCrop(o);const y=this.getPointRegion(o,t.ord,d,i),S=t.ord||y;let w=t.clientX-t.startClientX,T=t.clientY-t.startClientY;(d&&S==="nw"||S==="w"||S==="sw")&&(w=Math.min(w,-d)),(i&&S==="nw"||S==="n"||S==="ne")&&(T=Math.min(T,-i));const A={unit:"px",x:0,y:0,width:0,height:0};y==="ne"?(A.x=t.startCropX,A.width=w,r?(A.height=A.width/r,A.y=t.startCropY-A.height):(A.height=Math.abs(T),A.y=t.startCropY-A.height)):y==="se"?(A.x=t.startCropX,A.y=t.startCropY,A.width=w,r?A.height=A.width/r:A.height=T):y==="sw"?(A.x=t.startCropX+w,A.y=t.startCropY,A.width=Math.abs(w),r?A.height=A.width/r:A.height=T):y==="nw"&&(A.x=t.startCropX+w,A.width=Math.abs(w),r?(A.height=A.width/r,A.y=t.startCropY-A.height):(A.height=Math.abs(T),A.y=t.startCropY+T));const O=wX(A,r,y,o.width,o.height,d,i,n,s);return r||Td.xyOrds.indexOf(S)>-1?m=O:Td.xOrds.indexOf(S)>-1?(m.x=O.x,m.width=O.width):Td.yOrds.indexOf(S)>-1&&(m.y=O.y,m.height=O.height),m.x=Xx(m.x,0,o.width-m.width),m.y=Xx(m.y,0,o.height-m.height),m}renderCropSelection(){const{ariaLabels:t=Td.defaultProps.ariaLabels,disabled:r,locked:n,renderSelectionAddon:s,ruleOfThirds:o,crop:d}=this.props,i=this.getCropStyle();if(d)return Ve.createElement("div",{style:i,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!r&&!n&&Ve.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},Ve.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),Ve.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),Ve.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),Ve.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"nw"),role:"button"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"n"),role:"button"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"ne"),role:"button"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"e"),role:"button"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"se"),role:"button"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"s"),role:"button"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"sw"),role:"button"}),Ve.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"w"),role:"button"})),s&&Ve.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:m=>m.stopPropagation()},s(this.state)),o&&Ve.createElement(Ve.Fragment,null,Ve.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),Ve.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(t){const r={...Rk,...this.props.crop||{}};return vh(r,t.width,t.height)}render(){const{aspect:t,children:r,circularCrop:n,className:s,crop:o,disabled:d,locked:i,style:m,ruleOfThirds:y}=this.props,{cropIsActive:S,newCropIsBeingDrawn:w}=this.state,T=o?this.renderCropSelection():null,A=Bnt("ReactCrop",s,S&&"ReactCrop--active",d&&"ReactCrop--disabled",i&&"ReactCrop--locked",w&&"ReactCrop--new-crop",o&&t&&"ReactCrop--fixed-aspect",o&&n&&"ReactCrop--circular-crop",o&&y&&"ReactCrop--rule-of-thirds",!this.dragStarted&&o&&!o.width&&!o.height&&"ReactCrop--invisible-crop",n&&"ReactCrop--no-animate");return Ve.createElement("div",{ref:this.componentRef,className:A,style:m},Ve.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},r),o?Ve.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},Ve.createElement("defs",null,Ve.createElement("mask",{id:`hole-${this.instanceId}`},Ve.createElement("rect",{width:"100%",height:"100%",fill:"white"}),n?Ve.createElement("ellipse",{cx:`${o.x+o.width/2}${o.unit}`,cy:`${o.y+o.height/2}${o.unit}`,rx:`${o.width/2}${o.unit}`,ry:`${o.height/2}${o.unit}`,fill:"black"}):Ve.createElement("rect",{x:`${o.x}${o.unit}`,y:`${o.y}${o.unit}`,width:`${o.width}${o.unit}`,height:`${o.height}${o.unit}`,fill:"black"}))),Ve.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,T)}};Ea(xm,"xOrds",["e","w"]),Ea(xm,"yOrds",["n","s"]),Ea(xm,"xyOrds",["nw","ne","se","sw"]),Ea(xm,"nudgeStep",1),Ea(xm,"nudgeStepMedium",10),Ea(xm,"nudgeStepLarge",100),Ea(xm,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let Hnt=xm;const Gnt=Zv("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Tde=V.forwardRef(({className:e,variant:t,...r},n)=>h.jsx("div",{ref:n,role:"alert",className:fr(Gnt({variant:t}),e),...r}));Tde.displayName="Alert";const Wnt=V.forwardRef(({className:e,...t},r)=>h.jsx("h5",{ref:r,className:fr("mb-1 font-medium leading-none tracking-tight",e),...t}));Wnt.displayName="AlertTitle";const Ade=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{ref:r,className:fr("text-sm [&_p]:leading-relaxed",e),...t}));Ade.displayName="AlertDescription";const Cde=1200,jde=630,SX=Cde/jde;function Knt(e,t,r){return Unt($nt({unit:"%",width:90},r,e,t),e,t)}function Znt({open:e,onOpenChange:t,imageFile:r,onCropComplete:n}){const{t:s}=ei(),[o,d]=V.useState(""),[i,m]=V.useState(),[y,S]=V.useState(),w=V.useRef(null),[T,A]=V.useState(!1);V.useEffect(()=>{if(e&&r){const R=new FileReader;R.addEventListener("load",()=>{var M;d(((M=R.result)==null?void 0:M.toString())||"")}),R.readAsDataURL(r)}},[e,r]);const O=V.useCallback(R=>{const{width:M,height:F}=R.currentTarget;m(Knt(M,F,SX))},[]),P=V.useCallback(async(R,M)=>{const F=document.createElement("canvas"),B=F.getContext("2d");if(!B)throw new Error("No 2d context");const $=R.naturalWidth/R.width,W=R.naturalHeight/R.height;return F.width=M.width*$,F.height=M.height*W,B.imageSmoothingQuality="high",B.drawImage(R,M.x*$,M.y*W,M.width*$,M.height*W,0,0,F.width,F.height),new Promise((K,te)=>{F.toBlob(ne=>{if(!ne){te(new Error("Canvas is empty"));return}K(ne)},"image/jpeg",.95)})},[]),N=V.useCallback(async()=>{if(!(!y||!w.current)){A(!0);try{const R=await P(w.current,y),M=new File([R],r.name,{type:"image/jpeg"}),F=URL.createObjectURL(R);n(M,F),t(!1)}catch(R){console.error("Error cropping image:",R)}finally{A(!1)}}},[y,r,n,t,P]);return h.jsx(Lo,{open:e,onOpenChange:t,children:h.jsxs(xo,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[h.jsxs(bo,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[h.jsxs(wo,{className:"text-lg sm:text-xl flex items-center gap-2",children:[h.jsx(C_e,{className:"w-5 h-5 text-primary"}),s("admin.cropImage")]}),h.jsx(pl,{className:"text-xs sm:text-sm",children:s("admin.cropImageDescription")})]}),h.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[h.jsxs(Tde,{className:"border-primary/20 bg-primary/5",children:[h.jsx(P_e,{className:"h-4 w-4"}),h.jsxs(Ade,{className:"text-xs sm:text-sm",children:[h.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[h.jsxs("span",{className:"font-medium",children:[s("admin.recommendedSize"),":"]}),h.jsxs(tn,{variant:"secondary",className:"w-fit",children:[h.jsx(I_e,{className:"w-3 h-3 mr-1"}),Cde,"  ",jde," px"]})]}),h.jsx("p",{className:"mt-2 text-muted-foreground text-xs",children:s("admin.imageSizeHint")})]})]}),h.jsx("div",{className:"relative w-full overflow-hidden rounded-lg border",children:o&&h.jsx(Hnt,{crop:i,onChange:R=>m(R),onComplete:R=>S(R),aspect:SX,className:"max-h-[50vh] sm:max-h-[60vh]",children:h.jsx("img",{ref:w,src:o,alt:"Crop preview",onLoad:O,className:"max-w-full h-auto"})})})]}),h.jsxs(r_,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[h.jsx(Mt,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:T,className:"w-full sm:w-auto",children:s("common.cancel")}),h.jsx(Mt,{type:"button",onClick:N,disabled:!y||T,className:"w-full sm:w-auto",children:s(T?"common.processing":"admin.confirmCrop")})]})]})})}const Xnt=Ah({title_en:xn().min(1,Pr.t("validation.titleRequired")),title_zh:xn().min(1,Pr.t("validation.titleRequired")),title_pt:xn().min(1,Pr.t("validation.titleRequired")),intro_zh:xn().optional(),intro_en:xn().optional(),intro_pt:xn().optional(),content_en:xn().min(1,Pr.t("validation.contentRequired")),content_zh:xn().min(1,Pr.t("validation.contentRequired")),content_pt:xn().min(1,Pr.t("validation.contentRequired")),usage_instructions_zh:xn().optional(),usage_instructions_en:xn().optional(),usage_instructions_pt:xn().optional(),start_date:JG(),end_date:JG().optional(),repeat_mode:wT(["none","daily","weekly","monthly","yearly"]),service_type:wT(["dine_in","takeaway","both"]),pinned:bT().default(!1),visible:bT().default(!0),sort_order:FF().default(0),badge_text_zh:xn().min(1,""),badge_text_en:xn().min(1,"Badge text (English) is required"),badge_text_pt:xn().min(1,"Texto do emblema (Portugus)  obrigatrio"),badge_color:xn().optional()});function EX({activity:e,trigger:t}){const{t:r}=ei(),{toast:n}=Ii(),s=Ri(),[o,d]=V.useState(!1),[i,m]=V.useState(null),[y,S]=V.useState((e==null?void 0:e.image_url)||null),[w,T]=V.useState([]),[A,O]=V.useState(!1),[P,N]=V.useState(!1),[R,M]=V.useState(null),{data:F}=P5(),{register:B,handleSubmit:$,formState:{errors:W},setValue:K,watch:te,control:ne}=Eh({resolver:Th(Xnt),defaultValues:e?{title_en:e.title_en,title_zh:e.title_zh,title_pt:e.title_pt,intro_zh:e.intro_zh||"",intro_en:e.intro_en||"",intro_pt:e.intro_pt||"",content_en:e.content_en,content_zh:e.content_zh,content_pt:e.content_pt,usage_instructions_zh:e.usage_instructions_zh||"",usage_instructions_en:e.usage_instructions_en||"",usage_instructions_pt:e.usage_instructions_pt||"",start_date:new Date(e.start_date),end_date:e.end_date?new Date(e.end_date):void 0,repeat_mode:e.repeat_mode||"none",service_type:e.service_type||"both",pinned:e.pinned||!1,visible:e.visible!==void 0?e.visible:!0,sort_order:e.sort_order||0,badge_text_zh:e.badge_text_zh||e.title_zh,badge_text_en:e.badge_text_en||e.title_en,badge_text_pt:e.badge_text_pt||e.title_pt,badge_color:e.badge_color||"#9b87f5"}:{repeat_mode:"none",service_type:"both",pinned:!1,visible:!0,sort_order:0,badge_color:"#9b87f5"}}),ae=te("start_date"),re=te("end_date"),ee=te("pinned"),ie=te("visible");V.useEffect(()=>{(async()=>{if(e!=null&&e.id){const{data:me}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",e.id);me&&T(me.map(Ce=>Ce.restaurant_id))}})()},[e==null?void 0:e.id]);const de=xe=>{var Ce;const me=(Ce=xe.target.files)==null?void 0:Ce[0];if(me){if(me.size>10*1024*1024){n({title:r("common.error"),description:r("admin.imageTooBig"),variant:"destructive"});return}M(me),N(!0)}xe.target.value=""},be=(xe,me)=>{m(xe),S(me)},Se=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const xe=i.name.split(".").pop(),Ce=`${`${Math.random()}.${xe}`}`,{error:ge}=await Ct.storage.from("activity-images").upload(Ce,i);if(ge)throw ge;const{data:{publicUrl:pe}}=Ct.storage.from("activity-images").getPublicUrl(Ce);return pe},Ae=async xe=>{var me;O(!0);try{const{data:{user:Ce}}=await Ct.auth.getUser();if(!Ce)throw new Error("Not authenticated");const ge=await Se(),pe={title_en:xe.title_en,title_zh:xe.title_zh,title_pt:xe.title_pt,intro_zh:xe.intro_zh||null,intro_en:xe.intro_en||null,intro_pt:xe.intro_pt||null,content_en:xe.content_en,content_zh:xe.content_zh,content_pt:xe.content_pt,usage_instructions_zh:xe.usage_instructions_zh||null,usage_instructions_en:xe.usage_instructions_en||null,usage_instructions_pt:xe.usage_instructions_pt||null,repeat_mode:xe.repeat_mode,service_type:xe.service_type,pinned:xe.pinned,visible:xe.visible,sort_order:xe.sort_order,image_url:ge,creator_id:Ce.id,start_date:xe.start_date.toISOString(),end_date:((me=xe.end_date)==null?void 0:me.toISOString())||null,badge_text_zh:xe.badge_text_zh||null,badge_text_en:xe.badge_text_en||null,badge_text_pt:xe.badge_text_pt||null,badge_color:xe.badge_color||"#9b87f5"};if(e){const{error:Oe}=await Ct.from("activities").update(pe).eq("id",e.id);if(Oe)throw Oe;if(await Ct.from("activity_restaurants").delete().eq("activity_id",e.id),w.length>0){const Xe=w.map($e=>({activity_id:e.id,restaurant_id:$e})),{error:We}=await Ct.from("activity_restaurants").insert(Xe);if(We)throw We}n({title:r("common.success"),description:r("admin.activityUpdated")})}else{const{data:Oe,error:Xe}=await Ct.from("activities").insert([pe]).select().single();if(Xe)throw Xe;if(w.length>0){const We=w.map(Ke=>({activity_id:Oe.id,restaurant_id:Ke})),{error:$e}=await Ct.from("activity_restaurants").insert(We);if($e)throw $e}n({title:r("common.success"),description:r("admin.activityCreated")})}s.invalidateQueries({queryKey:["activities"]}),d(!1)}catch(Ce){n({title:r("common.error"),description:Ce.message,variant:"destructive"})}finally{O(!1)}};return h.jsxs(Lo,{open:o,onOpenChange:d,children:[h.jsx(tf,{asChild:!0,children:t}),h.jsxs(xo,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[h.jsxs(bo,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[h.jsxs(wo,{className:"text-2xl flex items-center gap-2",children:[h.jsx(yv,{className:"w-6 h-6 text-primary"}),r(e?"admin.editActivity":"admin.addActivity")]}),h.jsx(pl,{className:"text-base",children:r(e?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),h.jsx(Ov,{className:"px-6 h-[calc(95vh-220px)]",children:h.jsxs("form",{onSubmit:$(Ae),className:"space-y-6 py-6",children:[h.jsx(kr,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:h.jsxs(Mr,{className:"p-6",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[h.jsx(Lh,{className:"w-5 h-5 text-primary"}),r("admin.activityImage")]}),h.jsxs("div",{className:"flex items-center gap-6",children:[y&&h.jsxs("div",{className:"relative group",children:[h.jsx("img",{src:y,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),h.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{m(null),S(null)},children:h.jsx(wu,{className:"h-4 w-4"})})]}),h.jsxs(yr,{htmlFor:"image-upload",className:"cursor-pointer",children:[h.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[h.jsx(Lh,{className:"h-8 w-8 text-primary"}),h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),h.jsx(cr,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:de})]})]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[h.jsx(yv,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),h.jsxs(Lv,{defaultValue:"zh",className:"w-full",children:[h.jsxs(gg,{className:"grid w-full grid-cols-3 mb-6",children:[h.jsxs(La,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),h.jsxs(La,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),h.jsxs(La,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),h.jsxs(Fa,{value:"zh",className:"space-y-4 mt-0",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"title_zh",className:"text-sm font-medium",children:r("admin.title")}),h.jsx(cr,{id:"title_zh",...B("title_zh"),placeholder:r("admin.enterTitle"),className:"text-base"}),W.title_zh&&h.jsx("p",{className:"text-sm text-destructive",children:W.title_zh.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"intro_zh",className:"text-sm font-medium",children:""}),h.jsx(cr,{id:"intro_zh",...B("intro_zh"),placeholder:"",className:"text-base"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:""})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"content_zh",className:"text-sm font-medium",children:r("admin.content")}),h.jsx(_m,{name:"content_zh",control:ne,render:({field:xe})=>h.jsx(Lf,{value:xe.value,onChange:xe.onChange,placeholder:r("admin.enterContent")})}),W.content_zh&&h.jsx("p",{className:"text-sm text-destructive",children:W.content_zh.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"usage_instructions_zh",className:"text-sm font-medium",children:""}),h.jsx(_m,{name:"usage_instructions_zh",control:ne,render:({field:xe})=>h.jsx(Lf,{value:xe.value||"",onChange:xe.onChange,placeholder:""})}),h.jsx("p",{className:"text-xs text-muted-foreground",children:""})]})]}),h.jsxs(Fa,{value:"en",className:"space-y-4 mt-0",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"title_en",className:"text-sm font-medium",children:r("admin.title")}),h.jsx(cr,{id:"title_en",...B("title_en"),placeholder:r("admin.enterTitle"),className:"text-base"}),W.title_en&&h.jsx("p",{className:"text-sm text-destructive",children:W.title_en.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"intro_en",className:"text-sm font-medium",children:"Activity Brief"}),h.jsx(cr,{id:"intro_en",...B("intro_en"),placeholder:"Short description (shown on restaurant details)",className:"text-base"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Brief description shown after activity badge on restaurant page"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"content_en",className:"text-sm font-medium",children:r("admin.content")}),h.jsx(_m,{name:"content_en",control:ne,render:({field:xe})=>h.jsx(Lf,{value:xe.value,onChange:xe.onChange,placeholder:r("admin.enterContent")})}),W.content_en&&h.jsx("p",{className:"text-sm text-destructive",children:W.content_en.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"usage_instructions_en",className:"text-sm font-medium",children:"Usage Instructions"}),h.jsx(_m,{name:"usage_instructions_en",control:ne,render:({field:xe})=>h.jsx(Lf,{value:xe.value||"",onChange:xe.onChange,placeholder:"Describe how to use this activity (optional)"})}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Explain to users how to participate and use this activity"})]})]}),h.jsxs(Fa,{value:"pt",className:"space-y-4 mt-0",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"title_pt",className:"text-sm font-medium",children:r("admin.title")}),h.jsx(cr,{id:"title_pt",...B("title_pt"),placeholder:r("admin.enterTitle"),className:"text-base"}),W.title_pt&&h.jsx("p",{className:"text-sm text-destructive",children:W.title_pt.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"intro_pt",className:"text-sm font-medium",children:"Resumo da Atividade"}),h.jsx(cr,{id:"intro_pt",...B("intro_pt"),placeholder:"Descrio curta (exibida nos detalhes do restaurante)",className:"text-base"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Breve descrio exibida aps o distintivo da atividade na pgina do restaurante"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"content_pt",className:"text-sm font-medium",children:r("admin.content")}),h.jsx(_m,{name:"content_pt",control:ne,render:({field:xe})=>h.jsx(Lf,{value:xe.value,onChange:xe.onChange,placeholder:r("admin.enterContent")})}),W.content_pt&&h.jsx("p",{className:"text-sm text-destructive",children:W.content_pt.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"usage_instructions_pt",className:"text-sm font-medium",children:"Instrues de Uso"}),h.jsx(_m,{name:"usage_instructions_pt",control:ne,render:({field:xe})=>h.jsx(Lf,{value:xe.value||"",onChange:xe.onChange,placeholder:"Descreva como usar esta atividade (opcional)"})}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Explique aos usurios como participar e usar esta atividade"})]})]})]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6 space-y-6",children:[h.jsxs("div",{children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[h.jsx(yo,{className:"w-5 h-5 text-primary"}),r("admin.dateSettings")]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{className:"text-sm font-medium",children:r("admin.startDate")}),h.jsxs(mO,{children:[h.jsx(gO,{asChild:!0,children:h.jsxs(Mt,{variant:"outline",className:fr("w-full justify-start text-left font-normal h-11",!ae&&"text-muted-foreground"),children:[h.jsx(yo,{className:"mr-2 h-4 w-4"}),ae?Rs(ae,"PPP"):h.jsx("span",{children:r("admin.selectDate")})]})}),h.jsx(_T,{className:"w-auto p-0 z-[100]",align:"start",children:h.jsx(_4,{mode:"single",selected:ae,onSelect:xe=>K("start_date",xe),initialFocus:!0,className:"pointer-events-auto"})})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{className:"text-sm font-medium",children:r("admin.endDate")}),h.jsxs(mO,{children:[h.jsx(gO,{asChild:!0,children:h.jsxs(Mt,{variant:"outline",className:fr("w-full justify-start text-left font-normal h-11",!re&&"text-muted-foreground"),children:[h.jsx(yo,{className:"mr-2 h-4 w-4"}),re?Rs(re,"PPP"):h.jsxs("span",{children:[r("admin.selectDate")," (",r("admin.optional"),")"]})]})}),h.jsx(_T,{className:"w-auto p-0 z-[100]",align:"start",children:h.jsx(_4,{mode:"single",selected:re,onSelect:xe=>K("end_date",xe),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:r("admin.repeatMode")}),h.jsxs(Aa,{onValueChange:xe=>K("repeat_mode",xe),defaultValue:te("repeat_mode"),children:[h.jsx(ya,{className:"h-11",children:h.jsx(Ca,{placeholder:r("admin.selectRepeatMode")})}),h.jsxs(va,{children:[h.jsx(En,{value:"none",children:r("admin.repeatNone")}),h.jsx(En,{value:"daily",children:r("admin.repeatDaily")}),h.jsx(En,{value:"weekly",children:r("admin.repeatWeekly")}),h.jsx(En,{value:"monthly",children:r("admin.repeatMonthly")}),h.jsx(En,{value:"yearly",children:r("admin.repeatYearly")})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{htmlFor:"service_type",className:"text-sm font-medium",children:r("admin.serviceType")}),h.jsxs(Aa,{onValueChange:xe=>K("service_type",xe),defaultValue:te("service_type"),children:[h.jsx(ya,{className:"h-11",children:h.jsx(Ca,{placeholder:r("admin.selectServiceType")})}),h.jsxs(va,{children:[h.jsx(En,{value:"dine_in",children:r("activities.serviceType.dine_in")}),h.jsx(En,{value:"takeaway",children:r("activities.serviceType.takeaway")}),h.jsx(En,{value:"both",children:r("activities.serviceType.both")})]})]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[h.jsx(tl,{id:"pinned",checked:ee,onCheckedChange:xe=>K("pinned",xe),className:"data-[state=checked]:bg-primary"}),h.jsxs(yr,{htmlFor:"pinned",className:"cursor-pointer flex items-center gap-2 text-sm font-medium",children:[h.jsx(F_e,{className:"w-4 h-4 text-primary"}),r("admin.pinToTop")]})]}),h.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[h.jsx(tl,{id:"visible",checked:ie,onCheckedChange:xe=>K("visible",xe),className:"data-[state=checked]:bg-primary"}),h.jsxs(yr,{htmlFor:"visible",className:"cursor-pointer flex items-center gap-2 text-sm font-medium",children:[h.jsx(yv,{className:"w-4 h-4 text-primary"}),""]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(m_e,{className:"w-4 h-4 text-primary"}),r("admin.sortOrder")]}),h.jsx(cr,{id:"sort_order",type:"number",...B("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[h.jsx(tn,{className:"w-5 h-5 text-primary"}),""]}),h.jsxs(Lv,{defaultValue:"zh",className:"w-full",children:[h.jsxs(gg,{className:"grid w-full grid-cols-3 mb-4",children:[h.jsx(La,{value:"zh",children:" "}),h.jsx(La,{value:"en",children:" English"}),h.jsx(La,{value:"pt",children:" Portugus"})]}),h.jsx(Fa,{value:"zh",className:"space-y-3",children:h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"badge_text_zh",className:"text-sm",children:[" () ",h.jsx("span",{className:"text-destructive",children:"*"})]}),h.jsx(cr,{id:"badge_text_zh",...B("badge_text_zh"),placeholder:": "}),W.badge_text_zh&&h.jsx("p",{className:"text-sm text-destructive",children:W.badge_text_zh.message}),h.jsx("p",{className:"text-xs text-muted-foreground",children:""})]})}),h.jsx(Fa,{value:"en",className:"space-y-3",children:h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"badge_text_en",className:"text-sm",children:["Badge Text (English) ",h.jsx("span",{className:"text-destructive",children:"*"})]}),h.jsx(cr,{id:"badge_text_en",...B("badge_text_en"),placeholder:"e.g. Fan Festival"}),W.badge_text_en&&h.jsx("p",{className:"text-sm text-destructive",children:W.badge_text_en.message}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Badge text shown on restaurant details and activity list, keep it concise"})]})}),h.jsx(Fa,{value:"pt",className:"space-y-3",children:h.jsxs("div",{className:"space-y-2",children:[h.jsxs(yr,{htmlFor:"badge_text_pt",className:"text-sm",children:["Texto do Distintivo (Portugus) ",h.jsx("span",{className:"text-destructive",children:"*"})]}),h.jsx(cr,{id:"badge_text_pt",...B("badge_text_pt"),placeholder:"ex: Festival dos Fs"}),W.badge_text_pt&&h.jsx("p",{className:"text-sm text-destructive",children:W.badge_text_pt.message}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Texto do emblema exibido nos detalhes do restaurante e na lista de atividades, mantenha-o conciso"})]})})]}),h.jsxs("div",{className:"space-y-2 mt-4",children:[h.jsx(yr,{htmlFor:"badge_color",className:"text-sm",children:" / Badge Color"}),h.jsx(_m,{name:"badge_color",control:ne,render:({field:xe})=>h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(cr,{id:"badge_color",type:"color",value:xe.value||"#9b87f5",onChange:me=>xe.onChange(me.target.value),className:"w-20 h-11 cursor-pointer"}),h.jsx(cr,{value:xe.value||"#9b87f5",onChange:me=>xe.onChange(me.target.value),placeholder:"#9b87f5",className:"flex-1"})]})}),h.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:" / Preview:"}),h.jsx(tn,{style:{backgroundColor:te("badge_color")||"#9b87f5"},className:"text-white",children:te("badge_text_zh")||te("title_zh")||""})]})]})]})}),h.jsx(kr,{className:"border-primary/20",children:h.jsxs(Mr,{className:"p-6",children:[h.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[h.jsx(Mo,{className:"w-5 h-5 text-primary"}),r("admin.associatedRestaurants")]}),h.jsx(Ov,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:h.jsx("div",{className:"space-y-2",children:F==null?void 0:F.map(xe=>h.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[h.jsx(tl,{id:xe.id,checked:w.includes(xe.id),onCheckedChange:me=>{T(me?[...w,xe.id]:w.filter(Ce=>Ce!==xe.id))},className:"data-[state=checked]:bg-primary"}),h.jsx(yr,{htmlFor:xe.id,className:"cursor-pointer flex-1 font-normal",children:xe.name}),w.includes(xe.id)&&h.jsx(tn,{variant:"secondary",className:"text-xs",children:""})]},xe.id))})}),h.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[" ",w.length," "]})]})}),h.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]",children:[h.jsx(Mt,{type:"button",variant:"outline",onClick:()=>d(!1),className:"min-w-[100px]",children:r("common.cancel")}),h.jsx(Mt,{type:"submit",disabled:A,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:A?h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"..."]}):r("common.save")})]})]})}),R&&h.jsx(Znt,{open:P,onOpenChange:N,imageFile:R,onCropComplete:be})]})]})}const Ynt=({children:e})=>{const{t}=ei(),{data:r,isLoading:n}=X5(),s=oNe(),[o,d]=V.useState(!1),[i,m]=V.useState("zh"),[y,S]=V.useState(""),[w,T]=V.useState(""),[A,O]=V.useState("");V.useEffect(()=>{r&&(S(r.content_zh),T(r.content_en),O(r.content_pt))},[r]);const P=async()=>{if(r)try{await s.mutateAsync({id:r.id,content_zh:y,content_en:w,content_pt:A}),ko({title:t("common.success"),description:""}),d(!1)}catch{ko({title:t("common.error"),description:"",variant:"destructive"})}};return h.jsxs(Lo,{open:o,onOpenChange:d,children:[h.jsx(tf,{asChild:!0,children:e}),h.jsxs(xo,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[h.jsx(bo,{children:h.jsxs(wo,{className:"flex items-center gap-2",children:[h.jsx(ab,{className:"w-5 h-5"}),""]})}),n?h.jsx("div",{className:"flex justify-center py-8",children:h.jsx(aa,{className:"w-6 h-6 animate-spin text-primary"})}):h.jsx("div",{className:"space-y-4",children:h.jsxs(Lv,{value:i,onValueChange:m,children:[h.jsxs(gg,{className:"grid w-full grid-cols-3",children:[h.jsx(La,{value:"zh",children:""}),h.jsx(La,{value:"en",children:"English"}),h.jsx(La,{value:"pt",children:"Portugus"})]}),h.jsx(Fa,{value:"zh",className:"mt-4",children:h.jsx(Lf,{value:y,onChange:S,placeholder:"..."})}),h.jsx(Fa,{value:"en",className:"mt-4",children:h.jsx(Lf,{value:w,onChange:T,placeholder:"Enter English activity rules..."})}),h.jsx(Fa,{value:"pt",className:"mt-4",children:h.jsx(Lf,{value:A,onChange:O,placeholder:"Digite as regras da atividade em portugus..."})})]})}),h.jsxs(r_,{children:[h.jsx(Mt,{variant:"outline",onClick:()=>d(!1),children:t("common.cancel")}),h.jsxs(Mt,{onClick:P,disabled:s.isPending,children:[s.isPending?h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}):h.jsx(k3,{className:"w-4 h-4 mr-2"}),t("common.save")]})]})]})]})},Jnt=()=>{const{t:e}=ei(),{toast:t}=Ii(),{data:r,isLoading:n}=MN(),{getLocalizedField:s}=xc(),o=MIe(),d=zIe(),[i,m]=V.useState([]),[y,S]=V.useState(""),[w,T]=V.useState("all"),[A,O]=V.useState({}),[P,N]=V.useState(""),R=V.useMemo(()=>r?r.filter(W=>{const K=String(s(W,"title")||""),te=String(s(W,"content")||""),ne=y===""||K.toLowerCase().includes(y.toLowerCase())||te.toLowerCase().includes(y.toLowerCase()),ae=new Date,re=new Date(W.start_date),ee=W.end_date?new Date(W.end_date):null,ie=ee?ee<ae:!1,de=!ie&&re<=ae,be=w==="all"||w==="active"&&de||w==="ended"&&ie||w==="pinned"&&W.pinned;return ne&&be}):[],[r,y,w,s]),M=()=>{if(!r||r.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}Ztt(r),t({title:e("common.success"),description:e("admin.exportSuccess")})},F=W=>{m(K=>K.includes(W)?K.filter(te=>te!==W):[...K,W])},B=()=>{i.length===(R==null?void 0:R.length)?m([]):m((R==null?void 0:R.map(W=>W.id))||[])},$=()=>{i.length!==0&&(d.mutate(i),m([]))};return n?h.jsx(ml,{children:h.jsx("div",{className:"text-center",children:e("common.loading")})}):h.jsx(ml,{children:h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.activityManagement")}),h.jsx("p",{className:"text-muted-foreground",children:e("admin.manageActivities")})]}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[h.jsx(Ynt,{children:h.jsxs(Mt,{variant:"outline",className:"flex-1 sm:flex-initial",children:[h.jsx(ab,{className:"mr-2 h-4 w-4"}),h.jsx("span",{className:"hidden sm:inline",children:""})]})}),h.jsxs(Mt,{variant:"outline",onClick:M,className:"flex-1 sm:flex-initial",children:[h.jsx(nN,{className:"mr-2 h-4 w-4"}),h.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),h.jsx(EX,{trigger:h.jsxs(Mt,{className:"flex-1 sm:flex-initial",children:[h.jsx(ap,{className:"mr-2 h-4 w-4"}),e("admin.addActivity")]})})]})]}),h.jsx(kr,{children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex gap-4 flex-wrap",children:[h.jsx("div",{className:"flex-1 min-w-[200px]",children:h.jsxs("div",{className:"relative",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(cr,{placeholder:e("admin.searchActivities"),value:y,onChange:W=>S(W.target.value),className:"pl-9"})]})}),h.jsxs(Aa,{value:w,onValueChange:T,children:[h.jsx(ya,{className:"w-[180px]",children:h.jsx(Ca,{placeholder:e("admin.filterByStatus")})}),h.jsxs(va,{children:[h.jsx(En,{value:"all",children:e("admin.allStatus")}),h.jsx(En,{value:"active",children:e("admin.statusActive")}),h.jsx(En,{value:"ended",children:e("admin.statusEnded")}),h.jsx(En,{value:"pinned",children:e("admin.statusPinned")})]})]})]})})}),i.length>0&&h.jsx(kr,{className:"bg-muted/50",children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[h.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:i.length})}),h.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[h.jsxs(Io,{children:[h.jsx(_b,{asChild:!0,children:h.jsxs(Mt,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[h.jsx(Yh,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),h.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:e("admin.confirmBatchDelete")}),h.jsxs(po,{className:"space-y-3",children:[h.jsx("p",{children:e("admin.batchDeleteWarning",{count:i.length})}),h.jsxs("p",{className:"font-semibold text-destructive",children:[" ",i.length," "]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs("p",{className:"text-sm",children:[" ",h.jsx("span",{className:"font-mono font-bold text-destructive",children:"DELETE"})," "]}),h.jsx(cr,{value:P,onChange:W=>N(W.target.value),placeholder:"DELETE",className:"font-mono"})]})]})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>N(""),children:e("common.cancel")}),h.jsx(to,{disabled:P!=="DELETE",onClick:()=>{$(),N("")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})]}),h.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>m([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),h.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[h.jsx(tl,{checked:i.length===(R==null?void 0:R.length)&&R.length>0,onCheckedChange:B}),h.jsx("span",{className:"font-medium",children:e("admin.selectAll")}),h.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",R==null?void 0:R.length," ",e("admin.results"),")"]})]}),h.jsx("div",{className:"grid gap-4",children:R==null?void 0:R.map(W=>h.jsx(kr,{children:h.jsxs("div",{className:"flex flex-col md:flex-row",children:[h.jsx("div",{className:"p-4 flex items-start",children:h.jsx(tl,{checked:i.includes(W.id),onCheckedChange:()=>F(W.id),className:"mt-1"})}),W.image_url&&h.jsx("div",{className:"w-full md:w-48 h-48",children:h.jsx("img",{src:W.image_url,alt:String(s(W,"title")),className:"object-cover w-full h-full"})}),h.jsxs("div",{className:"flex-1",children:[h.jsxs(Rn,{children:[h.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[h.jsx(Hn,{className:"text-lg md:text-xl",children:s(W,"title")}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[!W.visible&&h.jsx(tn,{variant:"secondary",children:""}),W.pinned&&h.jsx(tn,{children:e("activities.pinned")}),(()=>{const K=new Date,te=new Date(W.start_date),ne=W.end_date?new Date(W.end_date):null,ae=ne?ne<K:!1,re=!ae&&te<=K;return ae?h.jsx(tn,{variant:"secondary",children:e("activities.ended")}):re?h.jsx(tn,{children:e("activities.ongoing")}):null})()]})]}),h.jsx(cs,{className:"line-clamp-2",children:h.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:s(W,"content")}})})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:h.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[h.jsx(yo,{className:"h-4 w-4 flex-shrink-0"}),h.jsxs("span",{className:"text-xs sm:text-sm",children:[Rs(new Date(W.start_date),"PPP"),W.end_date&&` - ${Rs(new Date(W.end_date),"PPP")}`]})]})}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[h.jsx(Mt,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:h.jsx(Hi,{to:`/activity/${W.id}`,state:{from:"admin"},children:e("admin.view")})}),h.jsx(EX,{activity:W,trigger:h.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),h.jsxs(Io,{children:[h.jsx(_b,{asChild:!0,children:h.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),h.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[h.jsxs(uo,{children:[h.jsx(fo,{children:e("admin.confirmDelete")}),h.jsxs(po,{className:"space-y-3",children:[h.jsx("p",{children:e("admin.deleteActivityWarning")}),h.jsx("p",{className:"font-semibold text-foreground",children:s(W,"title")}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs("p",{className:"text-sm",children:[" ",h.jsx("span",{className:"font-mono font-bold text-destructive",children:"DELETE"})," "]}),h.jsx(cr,{value:A[W.id]||"",onChange:K=>O({...A,[W.id]:K.target.value}),placeholder:"DELETE",className:"font-mono"})]})]})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>O({...A,[W.id]:""}),children:e("common.cancel")}),h.jsx(to,{disabled:A[W.id]!=="DELETE",onClick:()=>{o.mutate(W.id),O({...A,[W.id]:""})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})]})]})]})]})]})},W.id))})]})})},Qnt=()=>{const{t:e}=ei(),{data:t,isLoading:r}=CIe(),[n,s]=V.useState(new Set),o=i=>{s(m=>{const y=new Set(m);return y.has(i)?y.delete(i):y.add(i),y})};if(r)return h.jsx(ml,{children:h.jsx("div",{className:"text-center",children:e("common.loading")})});const d=i=>({INSERT:"default",UPDATE:"secondary",DELETE:"destructive"})[i]||"secondary";return h.jsx(ml,{children:h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.operationLogs")}),h.jsx("p",{className:"text-muted-foreground",children:e("admin.viewSystemLogs")})]}),t&&t.length>0?h.jsx("div",{className:"space-y-4",children:t.map(i=>{const m=n.has(i.id),y=i.old_data||i.new_data;return h.jsxs(kr,{children:[h.jsx(Rn,{className:"pb-3",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs(Hn,{className:"text-base",children:[i.user_name," - ",i.table_name]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(tn,{variant:d(i.action),children:i.action}),h.jsx("span",{className:"text-xs text-muted-foreground",children:Tg(new Date(i.created_at),{addSuffix:!0})})]})]})}),y&&h.jsx(Mr,{className:"pt-0",children:h.jsxs(m0,{open:m,onOpenChange:()=>o(i.id),children:[h.jsx(g0,{asChild:!0,children:h.jsxs(Mt,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2 text-muted-foreground hover:text-foreground",children:[m?h.jsx(Vf,{className:"h-4 w-4"}):h.jsx(tN,{className:"h-4 w-4"}),e(m?"common.hideDetails":"common.showDetails")]})}),h.jsx(y0,{className:"mt-3",children:h.jsxs("div",{className:"grid gap-3 text-sm",children:[i.old_data&&h.jsxs("div",{children:[h.jsxs("span",{className:"font-semibold text-destructive",children:[e("admin.oldData"),":"]}),h.jsx("pre",{className:"mt-1 p-3 bg-destructive/10 border border-destructive/20 rounded text-xs overflow-auto max-h-64",children:JSON.stringify(i.old_data,null,2)})]}),i.new_data&&h.jsxs("div",{children:[h.jsxs("span",{className:"font-semibold text-primary",children:[e("admin.newData"),":"]}),h.jsx("pre",{className:"mt-1 p-3 bg-primary/10 border border-primary/20 rounded text-xs overflow-auto max-h-64",children:JSON.stringify(i.new_data,null,2)})]})]})})]})})]},i.id)})}):h.jsx(kr,{children:h.jsx(Mr,{className:"py-12 text-center text-muted-foreground",children:e("admin.noLogs")})})]})})};var Pde=["PageUp","PageDown"],Ode=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],kde={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Cw="Slider",[x4,eit,tit]=y2(Cw),[Nde,mst]=Fo(Cw,[tit]),[rit,qI]=Nde(Cw),Ide=V.forwardRef((e,t)=>{const{name:r,min:n=0,max:s=100,step:o=1,orientation:d="horizontal",disabled:i=!1,minStepsBetweenThumbs:m=0,defaultValue:y=[n],value:S,onValueChange:w=()=>{},onValueCommit:T=()=>{},inverted:A=!1,form:O,...P}=e,N=V.useRef(new Set),R=V.useRef(0),F=d==="horizontal"?nit:iit,[B=[],$]=Zc({prop:S,defaultProp:y,onChange:re=>{var ie;(ie=[...N.current][R.current])==null||ie.focus(),w(re)}}),W=V.useRef(B);function K(re){const ee=cit(B,re);ae(re,ee)}function te(re){ae(re,R.current)}function ne(){const re=W.current[R.current];B[R.current]!==re&&T(B)}function ae(re,ee,{commit:ie}={commit:!1}){const de=fit(o),be=pit(Math.round((re-n)/o)*o+n,de),Se=vT(be,[n,s]);$((Ae=[])=>{const xe=oit(Ae,Se,ee);if(hit(xe,m*o)){R.current=xe.indexOf(Se);const me=String(xe)!==String(Ae);return me&&ie&&T(xe),me?xe:Ae}else return Ae})}return h.jsx(rit,{scope:e.__scopeSlider,name:r,disabled:i,min:n,max:s,valueIndexToChangeRef:R,thumbs:N.current,values:B,orientation:d,form:O,children:h.jsx(x4.Provider,{scope:e.__scopeSlider,children:h.jsx(x4.Slot,{scope:e.__scopeSlider,children:h.jsx(F,{"aria-disabled":i,"data-disabled":i?"":void 0,...P,ref:t,onPointerDown:Ir(P.onPointerDown,()=>{i||(W.current=B)}),min:n,max:s,inverted:A,onSlideStart:i?void 0:K,onSlideMove:i?void 0:te,onSlideEnd:i?void 0:ne,onHomeKeyDown:()=>!i&&ae(n,0,{commit:!0}),onEndKeyDown:()=>!i&&ae(s,B.length-1,{commit:!0}),onStepKeyDown:({event:re,direction:ee})=>{if(!i){const be=Pde.includes(re.key)||re.shiftKey&&Ode.includes(re.key)?10:1,Se=R.current,Ae=B[Se],xe=o*be*ee;ae(Ae+xe,Se,{commit:!0})}}})})})})});Ide.displayName=Cw;var[Rde,Mde]=Nde(Cw,{startEdge:"left",endEdge:"right",size:"width",direction:1}),nit=V.forwardRef((e,t)=>{const{min:r,max:n,dir:s,inverted:o,onSlideStart:d,onSlideMove:i,onSlideEnd:m,onStepKeyDown:y,...S}=e,[w,T]=V.useState(null),A=$n(t,F=>T(F)),O=V.useRef(void 0),P=Yv(s),N=P==="ltr",R=N&&!o||!N&&o;function M(F){const B=O.current||w.getBoundingClientRect(),$=[0,B.width],K=_U($,R?[r,n]:[n,r]);return O.current=B,K(F-B.left)}return h.jsx(Rde,{scope:e.__scopeSlider,startEdge:R?"left":"right",endEdge:R?"right":"left",direction:R?1:-1,size:"width",children:h.jsx(Dde,{dir:P,"data-orientation":"horizontal",...S,ref:A,style:{...S.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:F=>{const B=M(F.clientX);d==null||d(B)},onSlideMove:F=>{const B=M(F.clientX);i==null||i(B)},onSlideEnd:()=>{O.current=void 0,m==null||m()},onStepKeyDown:F=>{const $=kde[R?"from-left":"from-right"].includes(F.key);y==null||y({event:F,direction:$?-1:1})}})})}),iit=V.forwardRef((e,t)=>{const{min:r,max:n,inverted:s,onSlideStart:o,onSlideMove:d,onSlideEnd:i,onStepKeyDown:m,...y}=e,S=V.useRef(null),w=$n(t,S),T=V.useRef(void 0),A=!s;function O(P){const N=T.current||S.current.getBoundingClientRect(),R=[0,N.height],F=_U(R,A?[n,r]:[r,n]);return T.current=N,F(P-N.top)}return h.jsx(Rde,{scope:e.__scopeSlider,startEdge:A?"bottom":"top",endEdge:A?"top":"bottom",size:"height",direction:A?1:-1,children:h.jsx(Dde,{"data-orientation":"vertical",...y,ref:w,style:{...y.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:P=>{const N=O(P.clientY);o==null||o(N)},onSlideMove:P=>{const N=O(P.clientY);d==null||d(N)},onSlideEnd:()=>{T.current=void 0,i==null||i()},onStepKeyDown:P=>{const R=kde[A?"from-bottom":"from-top"].includes(P.key);m==null||m({event:P,direction:R?-1:1})}})})}),Dde=V.forwardRef((e,t)=>{const{__scopeSlider:r,onSlideStart:n,onSlideMove:s,onSlideEnd:o,onHomeKeyDown:d,onEndKeyDown:i,onStepKeyDown:m,...y}=e,S=qI(Cw,r);return h.jsx(on.span,{...y,ref:t,onKeyDown:Ir(e.onKeyDown,w=>{w.key==="Home"?(d(w),w.preventDefault()):w.key==="End"?(i(w),w.preventDefault()):Pde.concat(Ode).includes(w.key)&&(m(w),w.preventDefault())}),onPointerDown:Ir(e.onPointerDown,w=>{const T=w.target;T.setPointerCapture(w.pointerId),w.preventDefault(),S.thumbs.has(T)?T.focus():n(w)}),onPointerMove:Ir(e.onPointerMove,w=>{w.target.hasPointerCapture(w.pointerId)&&s(w)}),onPointerUp:Ir(e.onPointerUp,w=>{const T=w.target;T.hasPointerCapture(w.pointerId)&&(T.releasePointerCapture(w.pointerId),o(w))})})}),Lde="SliderTrack",Fde=V.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,s=qI(Lde,r);return h.jsx(on.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...n,ref:t})});Fde.displayName=Lde;var b4="SliderRange",zde=V.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,s=qI(b4,r),o=Mde(b4,r),d=V.useRef(null),i=$n(t,d),m=s.values.length,y=s.values.map(T=>Ude(T,s.min,s.max)),S=m>1?Math.min(...y):0,w=100-Math.max(...y);return h.jsx(on.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...n,ref:i,style:{...e.style,[o.startEdge]:S+"%",[o.endEdge]:w+"%"}})});zde.displayName=b4;var w4="SliderThumb",Bde=V.forwardRef((e,t)=>{const r=eit(e.__scopeSlider),[n,s]=V.useState(null),o=$n(t,i=>s(i)),d=V.useMemo(()=>n?r().findIndex(i=>i.ref.current===n):-1,[r,n]);return h.jsx(sit,{...e,ref:o,index:d})}),sit=V.forwardRef((e,t)=>{const{__scopeSlider:r,index:n,name:s,...o}=e,d=qI(w4,r),i=Mde(w4,r),[m,y]=V.useState(null),S=$n(t,M=>y(M)),w=m?d.form||!!m.closest("form"):!0,T=b2(m),A=d.values[n],O=A===void 0?0:Ude(A,d.min,d.max),P=lit(n,d.values.length),N=T==null?void 0:T[i.size],R=N?uit(N,O,i.direction):0;return V.useEffect(()=>{if(m)return d.thumbs.add(m),()=>{d.thumbs.delete(m)}},[m,d.thumbs]),h.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${O}% + ${R}px)`},children:[h.jsx(x4.ItemSlot,{scope:e.__scopeSlider,children:h.jsx(on.span,{role:"slider","aria-label":e["aria-label"]||P,"aria-valuemin":d.min,"aria-valuenow":A,"aria-valuemax":d.max,"aria-orientation":d.orientation,"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,tabIndex:d.disabled?void 0:0,...o,ref:S,style:A===void 0?{display:"none"}:e.style,onFocus:Ir(e.onFocus,()=>{d.valueIndexToChangeRef.current=n})})}),w&&h.jsx($de,{name:s??(d.name?d.name+(d.values.length>1?"[]":""):void 0),form:d.form,value:A},n)]})});Bde.displayName=w4;var ait="RadioBubbleInput",$de=V.forwardRef(({__scopeSlider:e,value:t,...r},n)=>{const s=V.useRef(null),o=$n(s,n),d=M2(t);return V.useEffect(()=>{const i=s.current;if(!i)return;const m=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(m,"value").set;if(d!==t&&S){const w=new Event("input",{bubbles:!0});S.call(i,t),i.dispatchEvent(w)}},[d,t]),h.jsx(on.input,{style:{display:"none"},...r,ref:o,defaultValue:t})});$de.displayName=ait;function oit(e=[],t,r){const n=[...e];return n[r]=t,n.sort((s,o)=>s-o)}function Ude(e,t,r){const o=100/(r-t)*(e-t);return vT(o,[0,100])}function lit(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function cit(e,t){if(e.length===1)return 0;const r=e.map(s=>Math.abs(s-t)),n=Math.min(...r);return r.indexOf(n)}function uit(e,t,r){const n=e/2,o=_U([0,50],[0,n]);return(n-o(t)*r)*r}function dit(e){return e.slice(0,-1).map((t,r)=>e[r+1]-t)}function hit(e,t){if(t>0){const r=dit(e);return Math.min(...r)>=t}return!0}function _U(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function fit(e){return(String(e).split(".")[1]||"").length}function pit(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}var Vde=Ide,mit=Fde,git=zde,yit=Bde;const S4=V.forwardRef(({className:e,...t},r)=>h.jsxs(Vde,{ref:r,className:fr("relative flex w-full touch-none select-none items-center",e),...t,children:[h.jsx(mit,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:h.jsx(git,{className:"absolute h-full bg-primary"})}),h.jsx(yit,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));S4.displayName=Vde.displayName;const vit=()=>{ei();const{data:e,isLoading:t}=Sie(),r=dPe(),n=hPe(),[s,o]=V.useState("images"),[d,i]=V.useState(null),[m,y]=V.useState(!1);V.useEffect(()=>{e&&!d&&i(e)},[e,d]);const S=async(O,P)=>{var R;const N=(R=O.target.files)==null?void 0:R[0];if(N){if(!N.type.startsWith("image/")){Nr.error("");return}try{const M=await n.mutateAsync({file:N,type:P});i(F=>({...F,[`${P}_image_url`]:M.url})),y(!0),Nr.success("")}catch(M){console.error("Upload failed:",M)}}},w=(O,P)=>{i(N=>({...N,[O]:P})),y(!0)},T=async()=>{try{await r.mutateAsync(d),y(!1),Nr.success("")}catch(O){console.error("Save failed:",O),Nr.error("")}},A=()=>{e&&(i(e),y(!1),Nr.info(""))};return t||!d?h.jsx(ml,{children:h.jsx("div",{className:"flex items-center justify-center h-64",children:h.jsx(aa,{className:"w-8 h-8 animate-spin"})})}):h.jsx(ml,{children:h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:""}),h.jsx("p",{className:"text-muted-foreground mt-2",children:""})]}),h.jsxs("div",{className:"flex gap-2",children:[m&&h.jsxs(Mt,{variant:"outline",onClick:A,children:[h.jsx(B_e,{className:"w-4 h-4 mr-2"}),""]}),h.jsxs(Mt,{onClick:T,disabled:!m||r.isPending,children:[r.isPending?h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}):h.jsx(k3,{className:"w-4 h-4 mr-2"}),""]})]})]}),m&&h.jsx("div",{className:"bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:h.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:'""'})}),h.jsxs(Lv,{value:s,onValueChange:o,children:[h.jsxs(gg,{className:"grid w-full grid-cols-4",children:[h.jsx(La,{value:"images",children:""}),h.jsx(La,{value:"overlay",children:""}),h.jsx(La,{value:"content",children:""}),h.jsx(La,{value:"buttons",children:""})]}),h.jsx(Fa,{value:"images",className:"space-y-6",children:h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:""}),h.jsx(cs,{children:""})]}),h.jsxs(Mr,{className:"space-y-6",children:[h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-4",children:[d.desktop_image_url&&h.jsx("div",{className:"relative w-40 h-24 rounded-lg overflow-hidden border",children:h.jsx("img",{src:d.desktop_image_url,alt:"Desktop",className:"w-full h-full object-cover"})}),h.jsxs("div",{children:[h.jsx(cr,{type:"file",accept:"image/*",onChange:O=>S(O,"desktop"),className:"hidden",id:"desktop-upload"}),h.jsx(yr,{htmlFor:"desktop-upload",children:h.jsx(Mt,{variant:"outline",className:"cursor-pointer",asChild:!0,children:h.jsxs("span",{children:[h.jsx(Lh,{className:"w-4 h-4 mr-2"}),""]})})}),h.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:": 1920x1080px"})]})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-4",children:[d.tablet_image_url&&h.jsx("div",{className:"relative w-40 h-24 rounded-lg overflow-hidden border",children:h.jsx("img",{src:d.tablet_image_url,alt:"Tablet",className:"w-full h-full object-cover"})}),h.jsxs("div",{children:[h.jsx(cr,{type:"file",accept:"image/*",onChange:O=>S(O,"tablet"),className:"hidden",id:"tablet-upload"}),h.jsx(yr,{htmlFor:"tablet-upload",children:h.jsx(Mt,{variant:"outline",className:"cursor-pointer",asChild:!0,children:h.jsxs("span",{children:[h.jsx(Lh,{className:"w-4 h-4 mr-2"}),""]})})}),h.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:": 1024x768px"})]})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-4",children:[d.mobile_image_url&&h.jsx("div",{className:"relative w-40 h-24 rounded-lg overflow-hidden border",children:h.jsx("img",{src:d.mobile_image_url,alt:"Mobile",className:"w-full h-full object-cover"})}),h.jsxs("div",{children:[h.jsx(cr,{type:"file",accept:"image/*",onChange:O=>S(O,"mobile"),className:"hidden",id:"mobile-upload"}),h.jsx(yr,{htmlFor:"mobile-upload",children:h.jsx(Mt,{variant:"outline",className:"cursor-pointer",asChild:!0,children:h.jsxs("span",{children:[h.jsx(Lh,{className:"w-4 h-4 mr-2"}),""]})})}),h.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:": 750x1334px"})]})]})]})]})]})}),h.jsx(Fa,{value:"overlay",className:"space-y-6",children:h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:""}),h.jsx(cs,{children:""})]}),h.jsxs(Mr,{className:"space-y-6",children:[h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx(S4,{value:[d.overlay_opacity||0],onValueChange:([O])=>w("overlay_opacity",O),max:100,step:1,className:"flex-1"}),h.jsxs("div",{className:"flex items-center gap-2 w-24",children:[h.jsx(cr,{type:"number",min:"0",max:"100",value:d.overlay_opacity||0,onChange:O=>w("overlay_opacity",parseInt(O.target.value)||0),className:"w-16"}),h.jsx("span",{className:"text-sm",children:"%"})]})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs(Aa,{value:d.overlay_gradient_direction,onValueChange:O=>w("overlay_gradient_direction",O),children:[h.jsx(ya,{children:h.jsx(Ca,{})}),h.jsxs(va,{children:[h.jsx(En,{value:"to-b",children:""}),h.jsx(En,{value:"to-t",children:""}),h.jsx(En,{value:"to-r",children:""}),h.jsx(En,{value:"to-l",children:""}),h.jsx(En,{value:"to-br",children:""}),h.jsx(En,{value:"to-tr",children:""})]})]})]}),h.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{type:"number",min:"0",max:"100",value:d.overlay_gradient_from_opacity||0,onChange:O=>w("overlay_gradient_from_opacity",parseInt(O.target.value)||0)}),h.jsx("span",{className:"text-sm",children:"%"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{type:"number",min:"0",max:"100",value:d.overlay_gradient_via_opacity||0,onChange:O=>w("overlay_gradient_via_opacity",parseInt(O.target.value)||0)}),h.jsx("span",{className:"text-sm",children:"%"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{type:"number",min:"0",max:"100",value:d.overlay_gradient_to_opacity||0,onChange:O=>w("overlay_gradient_to_opacity",parseInt(O.target.value)||0)}),h.jsx("span",{className:"text-sm",children:"%"})]})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx(S4,{value:[d.background_blur||0],onValueChange:([O])=>w("background_blur",O),max:50,step:1,className:"flex-1"}),h.jsxs("div",{className:"flex items-center gap-2 w-24",children:[h.jsx(cr,{type:"number",min:"0",max:"50",value:d.background_blur||0,onChange:O=>w("background_blur",parseInt(O.target.value)||0),className:"w-16"}),h.jsx("span",{className:"text-sm",children:"px"})]})]})]}),h.jsxs("div",{className:"border-t pt-6 space-y-4",children:[h.jsx("h3",{className:"font-semibold",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:""}),h.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{type:"number",min:"0",max:"100",value:d.desktop_overlay_opacity??"",placeholder:"",onChange:O=>w("desktop_overlay_opacity",O.target.value?parseInt(O.target.value):null)}),h.jsx("span",{className:"text-sm",children:"%"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{type:"number",min:"0",max:"100",value:d.tablet_overlay_opacity??"",placeholder:"",onChange:O=>w("tablet_overlay_opacity",O.target.value?parseInt(O.target.value):null)}),h.jsx("span",{className:"text-sm",children:"%"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{type:"number",min:"0",max:"100",value:d.mobile_overlay_opacity??"",placeholder:"",onChange:O=>w("mobile_overlay_opacity",O.target.value?parseInt(O.target.value):null)}),h.jsx("span",{className:"text-sm",children:"%"})]})]})]})]})]})]})}),h.jsx(Fa,{value:"content",className:"space-y-6",children:h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:""}),h.jsx(cs,{children:""})]}),h.jsxs(Mr,{className:"space-y-6",children:[h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"space-y-3",children:[h.jsx(cr,{placeholder:"",value:d.title_zh||"",onChange:O=>w("title_zh",O.target.value)}),h.jsx(cr,{placeholder:"English Title",value:d.title_en||"",onChange:O=>w("title_en",O.target.value)}),h.jsx(cr,{placeholder:"Ttulo em Portugus",value:d.title_pt||"",onChange:O=>w("title_pt",O.target.value)})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"space-y-3",children:[h.jsx(fl,{placeholder:"",value:d.description_zh||"",onChange:O=>w("description_zh",O.target.value),rows:3}),h.jsx(fl,{placeholder:"English Description",value:d.description_en||"",onChange:O=>w("description_en",O.target.value),rows:3}),h.jsx(fl,{placeholder:"Descrio em Portugus",value:d.description_pt||"",onChange:O=>w("description_pt",O.target.value),rows:3})]})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"space-y-0.5",children:[h.jsx(yr,{children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:""})]}),h.jsx(Tb,{checked:d.show_stats,onCheckedChange:O=>w("show_stats",O)})]})]})]})}),h.jsx(Fa,{value:"buttons",className:"space-y-6",children:h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:""}),h.jsx(cs,{children:""})]}),h.jsxs(Mr,{className:"space-y-6",children:[h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"space-y-3",children:[h.jsx(cr,{placeholder:"",value:d.subtitle_button_text_zh||"",onChange:O=>w("subtitle_button_text_zh",O.target.value)}),h.jsx(cr,{placeholder:"English Text",value:d.subtitle_button_text_en||"",onChange:O=>w("subtitle_button_text_en",O.target.value)}),h.jsx(cr,{placeholder:"Texto em Portugus",value:d.subtitle_button_text_pt||"",onChange:O=>w("subtitle_button_text_pt",O.target.value)}),h.jsxs(Aa,{value:d.subtitle_button_link||"",onValueChange:O=>w("subtitle_button_link",O),children:[h.jsx(ya,{children:h.jsx(Ca,{placeholder:""})}),h.jsxs(va,{children:[h.jsx(En,{value:"/",children:""}),h.jsx(En,{value:"/restaurants",children:""}),h.jsx(En,{value:"/activities",children:""}),h.jsx(En,{value:"/map",children:""}),h.jsx(En,{value:"/join-us",children:""})]})]})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"space-y-3",children:[h.jsx(cr,{placeholder:"",value:d.primary_button_text_zh||"",onChange:O=>w("primary_button_text_zh",O.target.value)}),h.jsx(cr,{placeholder:"English Text",value:d.primary_button_text_en||"",onChange:O=>w("primary_button_text_en",O.target.value)}),h.jsx(cr,{placeholder:"Texto em Portugus",value:d.primary_button_text_pt||"",onChange:O=>w("primary_button_text_pt",O.target.value)}),h.jsxs(Aa,{value:d.primary_button_link||"",onValueChange:O=>w("primary_button_link",O),children:[h.jsx(ya,{children:h.jsx(Ca,{placeholder:""})}),h.jsxs(va,{children:[h.jsx(En,{value:"/",children:""}),h.jsx(En,{value:"/restaurants",children:""}),h.jsx(En,{value:"/activities",children:""}),h.jsx(En,{value:"/map",children:""}),h.jsx(En,{value:"/join-us",children:""})]})]})]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx(yr,{children:""}),h.jsxs("div",{className:"space-y-3",children:[h.jsx(cr,{placeholder:"",value:d.secondary_button_text_zh||"",onChange:O=>w("secondary_button_text_zh",O.target.value)}),h.jsx(cr,{placeholder:"English Text",value:d.secondary_button_text_en||"",onChange:O=>w("secondary_button_text_en",O.target.value)}),h.jsx(cr,{placeholder:"Texto em Portugus",value:d.secondary_button_text_pt||"",onChange:O=>w("secondary_button_text_pt",O.target.value)}),h.jsxs(Aa,{value:d.secondary_button_link||"",onValueChange:O=>w("secondary_button_link",O),children:[h.jsx(ya,{children:h.jsx(Ca,{placeholder:""})}),h.jsxs(va,{children:[h.jsx(En,{value:"/",children:""}),h.jsx(En,{value:"/restaurants",children:""}),h.jsx(En,{value:"/activities",children:""}),h.jsx(En,{value:"/map",children:""}),h.jsx(En,{value:"/join-us",children:""})]})]})]})]})]})]})})]}),m&&h.jsx("div",{className:"fixed bottom-4 right-4 z-50 md:hidden",children:h.jsxs(Mt,{onClick:T,size:"lg",disabled:r.isPending,children:[r.isPending?h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}):h.jsx(k3,{className:"w-4 h-4 mr-2"}),""]})})]})})},qde=V.forwardRef(({className:e,...t},r)=>h.jsx("div",{className:"relative w-full overflow-auto",children:h.jsx("table",{ref:r,className:fr("w-full caption-bottom text-sm",e),...t})}));qde.displayName="Table";const Hde=V.forwardRef(({className:e,...t},r)=>h.jsx("thead",{ref:r,className:fr("[&_tr]:border-b",e),...t}));Hde.displayName="TableHeader";const Gde=V.forwardRef(({className:e,...t},r)=>h.jsx("tbody",{ref:r,className:fr("[&_tr:last-child]:border-0",e),...t}));Gde.displayName="TableBody";const _it=V.forwardRef(({className:e,...t},r)=>h.jsx("tfoot",{ref:r,className:fr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));_it.displayName="TableFooter";const E4=V.forwardRef(({className:e,...t},r)=>h.jsx("tr",{ref:r,className:fr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));E4.displayName="TableRow";const bm=V.forwardRef(({className:e,...t},r)=>h.jsx("th",{ref:r,className:fr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));bm.displayName="TableHead";const wm=V.forwardRef(({className:e,...t},r)=>h.jsx("td",{ref:r,className:fr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));wm.displayName="TableCell";const xit=V.forwardRef(({className:e,...t},r)=>h.jsx("caption",{ref:r,className:fr("mt-4 text-sm text-muted-foreground",e),...t}));xit.displayName="TableCaption";const bit=()=>{const{t:e}=ei(),[t,r]=V.useState(""),[n,s]=V.useState("all"),[o,d]=V.useState(null),i=Ri(),{data:m,isLoading:y}=ci({queryKey:["joinRequests"],queryFn:async()=>{const{data:R,error:M}=await Ct.from("join_requests").select("*").order("created_at",{ascending:!1});if(M)throw M;return R}}),{data:S}=ci({queryKey:["emailConfig","join_request"],queryFn:async()=>{const{data:R,error:M}=await Ct.from("email_config").select("*").eq("type","join_request").single();if(M)throw M;return R}}),w=m==null?void 0:m.filter(R=>{const M=t.toLowerCase(),F=R.name.toLowerCase().includes(M)||R.email.toLowerCase().includes(M)||R.restaurant_name.toLowerCase().includes(M)||R.phone.toLowerCase().includes(M),B=n==="all"||R.status===n;return F&&B}),T=async()=>{const R=prompt(e("joinUs.enterNewEmail"),S==null?void 0:S.recipient_email);if(R)try{const{error:M}=await Ct.from("email_config").update({recipient_email:R}).eq("id",S==null?void 0:S.id);if(M)throw M;ko({title:e("common.success"),description:e("joinUs.emailUpdated")})}catch(M){console.error("Error updating email:",M),ko({title:e("common.error"),description:e("joinUs.emailUpdateError"),variant:"destructive"})}},A=Gi({mutationFn:async({id:R,status:M})=>{const{error:F}=await Ct.from("join_requests").update({status:M}).eq("id",R);if(F)throw F},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),ko({title:e("common.success"),description:e("joinUs.statusUpdated")})},onError:R=>{console.error("Error updating status:",R),ko({title:e("common.error"),description:e("joinUs.statusUpdateError"),variant:"destructive"})}}),O=Gi({mutationFn:async R=>{const{error:M}=await Ct.from("join_requests").delete().eq("id",R);if(M)throw M},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),ko({title:e("common.success"),description:e("joinUs.requestDeleted")}),d(null)},onError:R=>{console.error("Error deleting request:",R),ko({title:e("common.error"),description:e("joinUs.deleteError"),variant:"destructive"})}}),P=()=>{if(!w||w.length===0){ko({title:e("admin.noDataToExport"),variant:"destructive"});return}const R=[["Name","Email","Phone","Restaurant Name","Restaurant Address","Features","Status","Submitted Date"],...w.map($=>[$.name,$.email,$.phone,$.restaurant_name,$.restaurant_address||"",Array.isArray($.features_selected)?$.features_selected.join(", "):"",$.status||"pending",new Date($.created_at).toLocaleString()])].map($=>$.map(W=>`"${W}"`).join(",")).join(`
`),M=new Blob([R],{type:"text/csv;charset=utf-8;"}),F=document.createElement("a"),B=URL.createObjectURL(M);F.setAttribute("href",B),F.setAttribute("download",`join_requests_${new Date().toISOString()}.csv`),F.click(),URL.revokeObjectURL(B),ko({title:e("admin.exportSuccess")})},N=R=>{switch(R){case"completed":return"default";case"rejected":return"destructive";default:return"secondary"}};return h.jsxs(ml,{children:[h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-3xl font-bold",children:e("joinUs.adminTitle")}),h.jsx("p",{className:"text-muted-foreground mt-2",children:e("joinUs.adminDescription")})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:e("joinUs.recipientEmail")}),h.jsx(cs,{children:e("joinUs.recipientEmailDesc")})]}),h.jsx(Mr,{children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx(cr,{value:(S==null?void 0:S.recipient_email)||"",readOnly:!0}),h.jsx(Mt,{onClick:T,children:e("common.edit")})]})})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:e("joinUs.totalRequests")}),h.jsx(cs,{children:e("joinUs.totalRequestsDesc")})]}),h.jsx(Mr,{children:h.jsx("div",{className:"text-3xl font-bold",children:(m==null?void 0:m.length)||0})})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx(Hn,{children:e("joinUs.allRequests")}),h.jsx(cs,{children:e("joinUs.allRequestsDesc")})]}),h.jsxs(Mt,{onClick:P,variant:"outline",children:[h.jsx(nN,{className:"w-4 h-4 mr-2"}),e("admin.exportCSV")]})]}),h.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[h.jsxs("div",{className:"relative flex-1",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),h.jsx(cr,{placeholder:e("joinUs.searchPlaceholder"),value:t,onChange:R=>r(R.target.value),className:"pl-10"})]}),h.jsxs(e_,{children:[h.jsx(t_,{asChild:!0,children:h.jsxs(Mt,{variant:"outline",className:"gap-2",children:[h.jsx(CB,{className:"w-4 h-4"}),e(n==="all"?"admin.allStatus":`joinUs.status.${n}`)]})}),h.jsxs(Eg,{align:"end",className:"bg-background",children:[h.jsx(Is,{onClick:()=>s("all"),children:e("admin.allStatus")}),h.jsx(Is,{onClick:()=>s("pending"),children:e("joinUs.status.pending")}),h.jsx(Is,{onClick:()=>s("completed"),children:e("joinUs.status.completed")}),h.jsx(Is,{onClick:()=>s("rejected"),children:e("joinUs.status.rejected")})]})]})]})]}),h.jsx(Mr,{children:y?h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("common.loading")}):w&&w.length>0?h.jsx("div",{className:"overflow-x-auto",children:h.jsxs(qde,{children:[h.jsx(Hde,{children:h.jsxs(E4,{children:[h.jsx(bm,{children:e("joinUs.name")}),h.jsx(bm,{children:e("joinUs.contact")}),h.jsx(bm,{children:e("joinUs.restaurant")}),h.jsx(bm,{children:e("joinUs.featuresNeeded")}),h.jsx(bm,{children:e("joinUs.status")}),h.jsx(bm,{children:e("joinUs.submittedAt")}),h.jsx(bm,{className:"text-right",children:e("common.actions")})]})}),h.jsx(Gde,{children:w.map(R=>h.jsxs(E4,{children:[h.jsx(wm,{className:"font-medium",children:R.name}),h.jsx(wm,{children:h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(PQ,{className:"w-3 h-3 text-muted-foreground"}),h.jsx("a",{href:`mailto:${R.email}`,className:"hover:underline",children:R.email})]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(tw,{className:"w-3 h-3 text-muted-foreground"}),h.jsx("a",{href:`tel:${R.phone}`,className:"hover:underline",children:R.phone})]})]})}),h.jsx(wm,{children:h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[h.jsx(Mo,{className:"w-3 h-3 text-muted-foreground"}),R.restaurant_name]}),R.restaurant_address&&h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(ga,{className:"w-3 h-3"}),R.restaurant_address]})]})}),h.jsx(wm,{children:h.jsx("div",{className:"flex flex-wrap gap-1",children:Array.isArray(R.features_selected)&&R.features_selected.map((M,F)=>h.jsx(tn,{variant:"secondary",children:e(`joinUs.feature.${M}`)},F))})}),h.jsx(wm,{children:h.jsx(tn,{variant:N(R.status||"pending"),children:e(`joinUs.status.${R.status||"pending"}`)})}),h.jsx(wm,{className:"text-sm text-muted-foreground",children:Tg(new Date(R.created_at),{addSuffix:!0})}),h.jsx(wm,{children:h.jsxs("div",{className:"flex items-center justify-end gap-2",children:[R.status!=="completed"&&h.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>A.mutate({id:R.id,status:"completed"}),disabled:A.isPending,children:h.jsx(sp,{className:"w-4 h-4"})}),h.jsx(Mt,{size:"sm",variant:"destructive",onClick:()=>d(R.id),disabled:O.isPending,children:h.jsx(Yh,{className:"w-4 h-4"})})]})})]},R.id))})]})}):h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("joinUs.noRequests")})})]})]}),h.jsx(Io,{open:o!==null,onOpenChange:R=>!R&&d(null),children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:e("joinUs.confirmDelete")}),h.jsx(po,{children:e("joinUs.confirmDeleteDescription")})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:e("common.cancel")}),h.jsx(to,{onClick:()=>o&&O.mutate(o),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})})]})},wit=()=>{var re;const{t:e}=ei(),t=Ri(),[r,n]=V.useState(null),[s,o]=V.useState(""),[d,i]=V.useState(""),[m,y]=V.useState(""),[S,w]=V.useState("all"),{data:T,isLoading:A}=ci({queryKey:["admin-reports"],queryFn:async()=>{const{data:ee,error:ie}=await Ct.from("reports").select(`
          *,
          reporter:profiles(display_name, avatar_url)
        `).order("created_at",{ascending:!1});if(ie)throw ie;return ee}}),{data:O}=ci({queryKey:["emailConfig","report"],queryFn:async()=>{const{data:ee,error:ie}=await Ct.from("email_config").select("*").eq("type","report").single();if(ie)throw ie;return ee}}),P=T==null?void 0:T.filter(ee=>{var Se,Ae;const ie=m.toLowerCase(),de=ee.description.toLowerCase().includes(ie)||((Ae=(Se=ee.reporter)==null?void 0:Se.display_name)==null?void 0:Ae.toLowerCase().includes(ie))||ee.reason.toLowerCase().includes(ie),be=S==="all"||ee.status===S;return de&&be}),N={total:(T==null?void 0:T.length)||0,pending:(T==null?void 0:T.filter(ee=>ee.status==="pending").length)||0,reviewing:(T==null?void 0:T.filter(ee=>ee.status==="reviewing").length)||0,resolved:(T==null?void 0:T.filter(ee=>ee.status==="resolved").length)||0,dismissed:(T==null?void 0:T.filter(ee=>ee.status==="dismissed").length)||0},R=Array.from({length:7},(ee,ie)=>{const de=fg(cP(new Date,6-ie)),be=Rs(de,"yyyy-MM-dd"),Se=(T==null?void 0:T.filter(Ae=>Rs(fg(new Date(Ae.created_at)),"yyyy-MM-dd")===be).length)||0;return{date:Rs(de,"MM/dd"),count:Se}}),M=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"].map(ee=>({name:e(`report.reasons.${ee}`),value:(T==null?void 0:T.filter(ie=>ie.reason===ee).length)||0})).filter(ee=>ee.value>0),F=["comment","restaurant","activity","user"].map(ee=>({name:e(`admin.reportType.${ee}`),value:(T==null?void 0:T.filter(ie=>ie.target_type===ee).length)||0})).filter(ee=>ee.value>0),B=["#016450","#018a6f","#4CAF50","#81C784","#FFA726","#FF7043","#EF5350","#EC407A","#AB47BC"],$=async()=>{const ee=prompt(e("joinUs.enterNewEmail"),O==null?void 0:O.recipient_email);if(ee)try{const{error:ie}=await Ct.from("email_config").update({recipient_email:ee}).eq("id",O==null?void 0:O.id);if(ie)throw ie;t.invalidateQueries({queryKey:["emailConfig"]}),Nr.success(e("joinUs.emailUpdated"))}catch(ie){console.error("Error updating email:",ie),Nr.error(e("joinUs.emailUpdateError"))}},W=Gi({mutationFn:async({id:ee,status:ie,notes:de})=>{const be={updated_at:new Date().toISOString()};ie&&(be.status=ie),de!==void 0&&(be.admin_notes=de);const{error:Se}=await Ct.from("reports").update(be).eq("id",ee);if(Se)throw Se},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-reports"]}),Nr.success(e("toast.reportUpdatedSuccess")),n(null)},onError:ee=>{Nr.error(ee.message||e("toast.reportUpdateFailed"))}}),K=ee=>{const ie={pending:"default",reviewing:"secondary",resolved:"default",dismissed:"destructive"};return h.jsx(tn,{variant:ie[ee]||"default",children:e(`admin.reportStatus.${ee}`)})},te=(ee,ie)=>{switch(ee){case"restaurant":return`/restaurant/${ie}`;case"activity":return`/activity/${ie}`;case"comment":return"#";case"user":return"/profile";default:return"#"}},ne=ee=>{n(ee),o(ee.admin_notes||""),i(ee.status)},ae=()=>{r&&W.mutate({id:r.id,status:d,notes:s})};return A?h.jsx(ml,{children:h.jsx("div",{className:"flex items-center justify-center h-64",children:h.jsx(aa,{className:"w-8 h-8 animate-spin"})})}):h.jsxs(ml,{children:[h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-3xl font-bold",children:e("admin.reports")}),h.jsx("p",{className:"text-muted-foreground mt-2",children:e("admin.reportsDescription")})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:e("joinUs.recipientEmail")}),h.jsx(cs,{children:e("joinUs.recipientEmailDesc")})]}),h.jsx(Mr,{children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx(cr,{value:(O==null?void 0:O.recipient_email)||"",readOnly:!0}),h.jsx(Mt,{onClick:$,children:e("common.edit")})]})})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:e("admin.totalReports")}),h.jsx(tP,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:N.total}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.allReportsCount")})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:e("admin.reportStatus.pending")}),h.jsx(Xv,{className:"h-4 w-4 text-yellow-500"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:N.pending}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.awaitingReview")})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:e("admin.reportStatus.reviewing")}),h.jsx(rN,{className:"h-4 w-4 text-blue-500"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:N.reviewing}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.underReview")})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:e("admin.reportStatus.resolved")}),h.jsx(E_e,{className:"h-4 w-4 text-green-500"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:N.resolved}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.resolvedReports")})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Hn,{className:"text-sm font-medium",children:e("admin.reportStatus.dismissed")}),h.jsx($P,{className:"h-4 w-4 text-red-500"})]}),h.jsxs(Mr,{children:[h.jsx("div",{className:"text-2xl font-bold",children:N.dismissed}),h.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.dismissedReports")})]})]})]}),h.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(NQ,{className:"w-5 h-5 text-primary"}),h.jsx(Hn,{children:e("admin.reportsTrend")})]}),h.jsx(cs,{children:e("admin.reportsTrendDesc")})]}),h.jsx(Mr,{children:h.jsx(Wm,{width:"100%",height:300,children:h.jsxs(lde,{data:R,children:[h.jsx(sv,{strokeDasharray:"3 3"}),h.jsx(Ih,{dataKey:"date"}),h.jsx(Rh,{}),h.jsx(Tl,{}),h.jsx(Aw,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2,name:e("admin.reportsCount")})]})})})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(b_e,{className:"w-5 h-5 text-primary"}),h.jsx(Hn,{children:e("admin.reportsReasonDist")})]}),h.jsx(cs,{children:e("admin.reportsReasonDistDesc")})]}),h.jsx(Mr,{children:h.jsx(Wm,{width:"100%",height:300,children:h.jsxs(pX,{children:[h.jsx(Xh,{data:M,cx:"50%",cy:"50%",labelLine:!1,label:({name:ee,percent:ie})=>`${ee}: ${(ie*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:M.map((ee,ie)=>h.jsx(kT,{fill:B[ie%B.length]},`cell-${ie}`))}),h.jsx(Tl,{})]})})})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:e("admin.reportsTypeDist")}),h.jsx(cs,{children:e("admin.reportsTypeDistDesc")})]}),h.jsx(Mr,{children:h.jsx(Wm,{width:"100%",height:300,children:h.jsxs(pP,{data:F,children:[h.jsx(sv,{strokeDasharray:"3 3"}),h.jsx(Ih,{dataKey:"name"}),h.jsx(Rh,{}),h.jsx(Tl,{}),h.jsx(Vu,{dataKey:"value",fill:"hsl(var(--primary))",name:e("admin.reportsCount")})]})})})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx(Hn,{children:e("admin.reportsStatusDist")}),h.jsx(cs,{children:e("admin.reportsStatusDistDesc")})]}),h.jsx(Mr,{children:h.jsx(Wm,{width:"100%",height:300,children:h.jsxs(pX,{children:[h.jsx(Xh,{data:[{name:e("admin.reportStatus.pending"),value:N.pending},{name:e("admin.reportStatus.reviewing"),value:N.reviewing},{name:e("admin.reportStatus.resolved"),value:N.resolved},{name:e("admin.reportStatus.dismissed"),value:N.dismissed}].filter(ee=>ee.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:ee,percent:ie})=>`${ee}: ${(ie*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{color:"#FFA726"},{color:"#42A5F5"},{color:"#66BB6A"},{color:"#EF5350"}].map((ee,ie)=>h.jsx(kT,{fill:ee.color},`cell-${ie}`))}),h.jsx(Tl,{})]})})})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsx("div",{className:"flex items-center justify-between",children:h.jsxs("div",{children:[h.jsx(Hn,{children:e("admin.allReports")}),h.jsx(cs,{children:e("admin.manageReportsDesc")})]})}),h.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[h.jsxs("div",{className:"relative flex-1",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),h.jsx(cr,{placeholder:e("admin.searchReports"),value:m,onChange:ee=>y(ee.target.value),className:"pl-10"})]}),h.jsxs(e_,{children:[h.jsx(t_,{asChild:!0,children:h.jsxs(Mt,{variant:"outline",className:"gap-2",children:[h.jsx(CB,{className:"w-4 h-4"}),e(S==="all"?"admin.allStatus":`admin.reportStatus.${S}`)]})}),h.jsxs(Eg,{align:"end",className:"bg-background",children:[h.jsx(Is,{onClick:()=>w("all"),children:e("admin.allStatus")}),h.jsx(Is,{onClick:()=>w("pending"),children:e("admin.reportStatus.pending")}),h.jsx(Is,{onClick:()=>w("reviewing"),children:e("admin.reportStatus.reviewing")}),h.jsx(Is,{onClick:()=>w("resolved"),children:e("admin.reportStatus.resolved")}),h.jsx(Is,{onClick:()=>w("dismissed"),children:e("admin.reportStatus.dismissed")})]})]})]})]}),h.jsx(Mr,{children:h.jsxs("div",{className:"grid gap-4",children:[P==null?void 0:P.map(ee=>{var ie;return h.jsx(kr,{className:"p-4",children:h.jsxs("div",{className:"flex items-start justify-between gap-4",children:[h.jsxs("div",{className:"flex-1 space-y-2",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[h.jsx(tP,{className:"w-4 h-4"}),h.jsx("span",{className:"font-medium",children:e(`admin.reportType.${ee.target_type}`)}),K(ee.status),h.jsx(tn,{variant:"outline",children:e(`report.reasons.${ee.reason}`)})]}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:[ee.description.substring(0,150),ee.description.length>150&&"..."]}),h.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[h.jsxs("span",{children:[e("admin.reportedBy"),": ",(ie=ee.reporter)==null?void 0:ie.display_name]}),h.jsxs("span",{children:[e("admin.reportedAt"),":"," ",Tg(new Date(ee.created_at),{addSuffix:!0})]})]})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>ne(ee),children:e("admin.viewReport")}),h.jsx(Mt,{variant:"ghost",size:"sm",onClick:()=>window.open(te(ee.target_type,ee.target_id),"_blank"),children:h.jsx(D9,{className:"w-4 h-4"})})]})]})},ee.id)}),(P==null?void 0:P.length)===0&&h.jsxs("div",{className:"text-center py-12",children:[h.jsx(tP,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),h.jsx("p",{className:"text-muted-foreground",children:e("admin.noReports")})]})]})})]})]}),h.jsx(Lo,{open:!!r,onOpenChange:()=>n(null),children:h.jsxs(xo,{className:"max-w-[90vw] sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[h.jsxs(bo,{children:[h.jsxs(wo,{children:[e("admin.viewReport")," - ",r==null?void 0:r.id]}),h.jsx(pl,{children:e(`admin.reportType.${r==null?void 0:r.target_type}`)})]}),r&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[h.jsxs("div",{children:[h.jsxs("span",{className:"font-medium",children:[e("admin.reportedBy"),":"]})," ",(re=r.reporter)==null?void 0:re.display_name]}),h.jsxs("div",{children:[h.jsxs("span",{className:"font-medium",children:[e("admin.reportedAt"),":"]})," ",new Date(r.created_at).toLocaleString()]}),h.jsxs("div",{children:[h.jsxs("span",{className:"font-medium",children:[e("report.reason"),":"]})," ",e(`report.reasons.${r.reason}`)]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Status:"})," ",K(r.status)]})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-medium mb-2",children:e("report.detailsLabel")}),h.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.description})]}),r.reporter_contact&&h.jsxs("div",{children:[h.jsx("h4",{className:"font-medium mb-2",children:e("report.contactLabel")}),h.jsx("p",{className:"text-sm",children:r.reporter_contact})]}),r.evidence_urls&&r.evidence_urls.length>0&&h.jsxs("div",{children:[h.jsx("h4",{className:"font-medium mb-2",children:e("report.evidenceLabel")}),h.jsx("ul",{className:"space-y-1",children:r.evidence_urls.map((ee,ie)=>h.jsx("li",{children:h.jsxs("a",{href:ee,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[h.jsx(D9,{className:"w-3 h-3"}),ee]})},ie))})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium",children:e("admin.updateStatus")}),h.jsxs(Aa,{value:d,onValueChange:i,children:[h.jsx(ya,{children:h.jsx(Ca,{})}),h.jsxs(va,{children:[h.jsx(En,{value:"pending",children:e("admin.reportStatus.pending")}),h.jsx(En,{value:"reviewing",children:e("admin.reportStatus.reviewing")}),h.jsx(En,{value:"resolved",children:e("admin.reportStatus.resolved")}),h.jsx(En,{value:"dismissed",children:e("admin.reportStatus.dismissed")})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium",children:e("admin.adminNotes")}),h.jsx(fl,{value:s,onChange:ee=>o(ee.target.value),placeholder:"Add internal notes...",rows:4})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(Mt,{variant:"outline",onClick:()=>n(null),children:e("common.cancel")}),h.jsx(Mt,{onClick:ae,disabled:W.isPending,children:W.isPending?h.jsxs(h.Fragment,{children:[h.jsx(aa,{className:"w-4 h-4 mr-2 animate-spin"}),e("common.loading")]}):e("admin.saveNotes")})]})]})]})})]})},Sit=Ah({activity_id:xn().min(1,""),title_zh:xn().min(1,""),title_en:xn().min(1,""),title_pt:xn().min(1,""),description_zh:xn().optional(),description_en:xn().optional(),description_pt:xn().optional(),discount_type:wT(["percentage","fixed_amount"]),discount_value:QD.number().min(0,"0"),min_order_amount:QD.number().min(0).optional(),max_discount_amount:QD.number().min(0).optional(),valid_from:xn().min(1,""),valid_until:xn().optional(),is_active:bT().default(!0),visible:bT().default(!0)});function Eit({open:e,onOpenChange:t,template:r}){var m;const{t:n}=ei();Ii();const s=gNe(),{data:o}=ci({queryKey:["activities"],queryFn:async()=>{const{data:y,error:S}=await Ct.from("activities").select("id, title_zh, title_en, title_pt").eq("visible",!0).order("created_at",{ascending:!1});if(S)throw S;return y}}),d=Eh({resolver:Th(Sit),defaultValues:r?{activity_id:r.activity_id,title_zh:r.title_zh,title_en:r.title_en,title_pt:r.title_pt,description_zh:r.description_zh||"",description_en:r.description_en||"",description_pt:r.description_pt||"",discount_type:r.discount_type,discount_value:r.discount_value,min_order_amount:r.min_order_amount||void 0,max_discount_amount:r.max_discount_amount||void 0,valid_from:r.valid_from.split("T")[0],valid_until:((m=r.valid_until)==null?void 0:m.split("T")[0])||"",is_active:r.is_active,visible:r.visible}:{activity_id:"",title_zh:"",title_en:"",title_pt:"",description_zh:"",description_en:"",description_pt:"",discount_type:"percentage",discount_value:0,min_order_amount:void 0,max_discount_amount:void 0,valid_from:new Date().toISOString().split("T")[0],valid_until:"",is_active:!0,visible:!0}});V.useEffect(()=>{e||d.reset()},[e,d]);const i=async y=>{const S={...y,valid_until:y.valid_until||null,min_order_amount:y.min_order_amount||null,max_discount_amount:y.max_discount_amount||null,description_zh:y.description_zh||null,description_en:y.description_en||null,description_pt:y.description_pt||null};r!=null&&r.id&&(S.id=r.id),s.mutate(S,{onSuccess:()=>{t(!1),d.reset()}})};return h.jsx(Lo,{open:e,onOpenChange:t,children:h.jsxs(xo,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[h.jsxs(bo,{children:[h.jsx(wo,{children:r?"":""}),h.jsx(pl,{children:r?"":""})]}),h.jsx(r$,{...d,children:h.jsxs("form",{onSubmit:d.handleSubmit(i),className:"space-y-6",children:[h.jsx(Ki,{control:d.control,name:"activity_id",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsxs(Aa,{onValueChange:y.onChange,defaultValue:y.value,children:[h.jsx(Zi,{children:h.jsx(ya,{children:h.jsx(Ca,{placeholder:""})})}),h.jsx(va,{children:o==null?void 0:o.map(S=>h.jsx(En,{value:S.id,children:S.title_zh},S.id))})]}),h.jsx(ev,{children:""}),h.jsx(ss,{})]})}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsx(Ki,{control:d.control,name:"title_zh",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"",...y})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"title_en",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"New User Exclusive",...y})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"title_pt",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"Exclusivo Novo Usurio",...y})}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsx(Ki,{control:d.control,name:"description_zh",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(fl,{placeholder:"",...y})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"description_en",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(fl,{placeholder:"Coupon description",...y})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"description_pt",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(fl,{placeholder:"Descrio do cupom",...y})}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsx(Ki,{control:d.control,name:"discount_type",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsxs(Aa,{onValueChange:y.onChange,defaultValue:y.value,children:[h.jsx(Zi,{children:h.jsx(ya,{children:h.jsx(Ca,{placeholder:""})})}),h.jsxs(va,{children:[h.jsx(En,{value:"percentage",children:""}),h.jsx(En,{value:"fixed_amount",children:""})]})]}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"discount_value",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{type:"number",step:"0.01",placeholder:d.watch("discount_type")==="percentage"?"10 (10%)":"5 (5)",...y})}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsx(Ki,{control:d.control,name:"min_order_amount",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" ()"}),h.jsx(Zi,{children:h.jsx(cr,{type:"number",step:"0.01",placeholder:"0",...y})}),h.jsx(ev,{children:""}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"max_discount_amount",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" ()"}),h.jsx(Zi,{children:h.jsx(cr,{type:"number",step:"0.01",placeholder:"0",...y})}),h.jsx(ev,{children:""}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsx(Ki,{control:d.control,name:"valid_from",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{type:"date",...y})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:d.control,name:"valid_until",render:({field:y})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{type:"date",...y})}),h.jsx(ev,{children:""}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"flex gap-6",children:[h.jsx(Ki,{control:d.control,name:"is_active",render:({field:y})=>h.jsxs(qi,{className:"flex items-center space-x-2 space-y-0",children:[h.jsx(Zi,{children:h.jsx(Tb,{checked:y.value,onCheckedChange:y.onChange})}),h.jsx(Xi,{className:"!mt-0",children:""})]})}),h.jsx(Ki,{control:d.control,name:"visible",render:({field:y})=>h.jsxs(qi,{className:"flex items-center space-x-2 space-y-0",children:[h.jsx(Zi,{children:h.jsx(Tb,{checked:y.value,onCheckedChange:y.onChange})}),h.jsx(Xi,{className:"!mt-0",children:""})]})})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(Mt,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:s.isPending,children:n("common.cancel")}),h.jsx(Mt,{type:"submit",disabled:s.isPending,children:s.isPending?"...":""})]})]})})]})})}function Tit({open:e,onOpenChange:t,template:r}){ei();const{getLocalizedField:n}=xc(),{data:s,isLoading:o}=ci({queryKey:["templateCouponCodes",r.id],queryFn:async()=>{const{data:S,error:w}=await Ct.from("coupon_codes").select("*, user_coupons(count)").eq("template_id",r.id).order("created_at",{ascending:!1});if(w)throw w;return(S||[]).map(T=>{var A,O;return{...T,user_coupons_count:((O=(A=T.user_coupons)==null?void 0:A[0])==null?void 0:O.count)||0}})},enabled:e}),{data:d}=ci({queryKey:["activity",r.activity_id],queryFn:async()=>{const{data:S,error:w}=await Ct.from("activities").select("id, title_zh, title_en, title_pt").eq("id",r.activity_id).single();if(w)throw w;return S},enabled:e}),i=(s==null?void 0:s.length)||0,m=(s==null?void 0:s.reduce((S,w)=>S+w.used_count,0))||0,y=(s==null?void 0:s.reduce((S,w)=>S+w.user_coupons_count,0))||0;return h.jsx(Lo,{open:e,onOpenChange:t,children:h.jsxs(xo,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[h.jsxs(bo,{children:[h.jsxs(wo,{className:"flex items-center gap-2",children:[h.jsx(oT,{className:"h-5 w-5"}),""]}),h.jsx(pl,{children:""})]}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsx(Hn,{className:"text-lg",children:""})}),h.jsxs(Mr,{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:""}),h.jsx("p",{className:"font-medium",children:d?n(d,"title"):"..."})]}),h.jsxs("div",{className:"flex gap-2",children:[!r.visible&&h.jsx(tn,{variant:"secondary",children:""}),!r.is_active&&h.jsx(tn,{variant:"secondary",children:""}),r.is_active&&h.jsx(tn,{children:""})]})]}),h.jsx(Yo,{}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:""}),h.jsxs("div",{className:"space-y-1",children:[h.jsxs("p",{children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:""}),r.title_zh]}),h.jsxs("p",{children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:"English"}),r.title_en]}),h.jsxs("p",{children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:"Portugus"}),r.title_pt]})]})]}),(r.description_zh||r.description_en||r.description_pt)&&h.jsxs(h.Fragment,{children:[h.jsx(Yo,{}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:""}),h.jsxs("div",{className:"space-y-1 text-sm",children:[r.description_zh&&h.jsxs("p",{children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:""}),r.description_zh]}),r.description_en&&h.jsxs("p",{children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:"English"}),r.description_en]}),r.description_pt&&h.jsxs("p",{children:[h.jsx("span",{className:"text-xs text-muted-foreground",children:"Portugus"}),r.description_pt]})]})]})]}),h.jsx(Yo,{}),h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsx("p",{className:"font-medium",children:r.discount_type==="percentage"?"":""})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsx("p",{className:"font-medium text-primary text-lg",children:r.discount_type==="percentage"?`${r.discount_value}%`:`${r.discount_value}`})]}),r.min_order_amount&&r.min_order_amount>0&&h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsxs("p",{className:"font-medium",children:["",r.min_order_amount]})]}),r.max_discount_amount&&r.max_discount_amount>0&&h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsxs("p",{className:"font-medium",children:["",r.max_discount_amount]})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsxs("p",{className:"font-medium",children:[i," "]})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsxs("p",{className:"font-medium",children:[y," "]})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsxs("p",{className:"font-medium",children:[m," "]})]})]}),h.jsx(Yo,{}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(yo,{className:"h-4 w-4 text-muted-foreground"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-muted-foreground",children:""}),h.jsxs("p",{className:"font-medium",children:[Rs(new Date(r.valid_from),"yyyy-MM-dd"),r.valid_until?` - ${Rs(new Date(r.valid_until),"yyyy-MM-dd")}`:" - "]})]})]})})]})]}),h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsxs(Hn,{className:"text-lg flex items-center gap-2",children:[h.jsx(A_e,{className:"h-4 w-4"})," (",i,")"]})}),h.jsx(Mr,{children:o?h.jsx("p",{className:"text-sm text-muted-foreground",children:"..."}):!s||s.length===0?h.jsx("p",{className:"text-sm text-muted-foreground",children:""}):h.jsx("div",{className:"space-y-3",children:s.map(S=>h.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-10 h-10 rounded bg-primary/10 flex items-center justify-center",children:h.jsx(oT,{className:"h-5 w-5 text-primary"})}),h.jsxs("div",{children:[h.jsx("code",{className:"font-mono font-semibold text-sm",children:S.code}),h.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["",Rs(new Date(S.created_at),"yyyy-MM-dd HH:mm")]}),h.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[h.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.jsx(P0,{className:"inline h-3 w-3 mr-1"}),"",S.user_coupons_count," "]}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:["",S.used_count," / ",S.usage_limit]})]})]})]}),h.jsx(tn,{variant:S.is_active?"default":"secondary",children:S.is_active?"":""})]},S.id))})})]})]})]})})}const Ait=()=>{ei(),Ii();const{data:e,isLoading:t}=hNe(),r=yNe(),{getLocalizedField:n}=xc(),[s,o]=V.useState(""),[d,i]=V.useState(!1),[m,y]=V.useState(!1),[S,w]=V.useState(!1),[T,A]=V.useState(null),O=e==null?void 0:e.filter(N=>{const R=String(n(N,"title")||""),M=s.toLowerCase();return R.toLowerCase().includes(M)}),P=()=>{T&&r.mutate(T.id,{onSuccess:()=>{w(!1),A(null)}})};return h.jsx(ml,{children:h.jsxs("div",{className:"container mx-auto px-4 py-8",children:[h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[h.jsxs("div",{children:[h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(oT,{className:"w-6 h-6"}),""]}),h.jsx(cs,{children:""})]}),h.jsxs(Mt,{onClick:()=>{A(null),i(!0)},children:[h.jsx(ap,{className:"w-4 h-4 mr-2"}),""]})]})}),h.jsxs(Mr,{children:[h.jsx("div",{className:"mb-6",children:h.jsxs("div",{className:"relative",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),h.jsx(cr,{placeholder:"...",value:s,onChange:N=>o(N.target.value),className:"pl-10"})]})}),t?h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"..."}):O&&O.length>0?h.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:O.map(N=>h.jsxs(kr,{className:"hover:shadow-lg transition-shadow",children:[h.jsx(Rn,{children:h.jsxs("div",{className:"flex justify-between items-start",children:[h.jsxs("div",{className:"flex-1",children:[h.jsx(Hn,{className:"text-lg mb-1",children:n(N,"title")}),h.jsx(cs,{className:"text-sm",children:n(N,"description")})]}),h.jsx("div",{className:"flex items-center gap-1 ml-2",children:h.jsx(tn,{variant:N.is_active?"default":"secondary",children:N.is_active?"":""})})]})}),h.jsx(Mr,{children:h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm text-muted-foreground",children:""}),h.jsx("div",{className:"flex items-center gap-1",children:N.discount_type==="percentage"?h.jsxs(h.Fragment,{children:[h.jsx(L_e,{className:"w-4 h-4"}),h.jsxs("span",{className:"font-semibold",children:[N.discount_value,"%"]})]}):h.jsxs(h.Fragment,{children:[h.jsx(UP,{className:"w-4 h-4"}),h.jsxs("span",{className:"font-semibold",children:["",N.discount_value]})]})})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm text-muted-foreground",children:""}),h.jsxs("span",{className:"text-sm",children:[Rs(new Date(N.valid_from),"yyyy-MM-dd"),N.valid_until&&`  ${Rs(new Date(N.valid_until),"yyyy-MM-dd")}`]})]}),h.jsxs("div",{className:"flex gap-2 pt-3 border-t",children:[h.jsxs(Mt,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{A(N),y(!0)},children:[h.jsx(AB,{className:"w-4 h-4 mr-1"}),""]}),h.jsxs(Mt,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{A(N),i(!0)},children:[h.jsx(_2,{className:"w-4 h-4 mr-1"}),""]}),h.jsx(Mt,{variant:"destructive",size:"sm",onClick:()=>{A(N),w(!0)},children:h.jsx(Yh,{className:"w-4 h-4"})})]})]})})]},N.id))}):h.jsxs("div",{className:"text-center py-12",children:[h.jsx(oT,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground mb-4",children:s?"":""}),h.jsxs(Mt,{onClick:()=>i(!0),children:[h.jsx(ap,{className:"w-4 h-4 mr-2"}),""]})]})]})]}),h.jsx(Eit,{open:d,onOpenChange:i,template:T}),T&&h.jsx(Tit,{open:m,onOpenChange:y,template:T}),h.jsx(Io,{open:S,onOpenChange:w,children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:""}),h.jsxs(po,{children:[' "',T&&n(T,"title"),'"  ']})]}),h.jsxs(ho,{children:[h.jsx(mo,{children:""}),h.jsx(to,{onClick:P,children:""})]})]})})]})})},Cit=()=>{const{user:e}=Qn();return ci({queryKey:["myActivityRequests",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("activity_requests").select("*").eq("requester_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return t},enabled:!!e})},jit=()=>ci({queryKey:["allActivityRequests"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activity_requests").select("*, profiles:requester_id(display_name, avatar_url)").order("created_at",{ascending:!1});if(t)throw t;return e}}),Pit=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s,error:o}=await Ct.from("activity_requests").insert([{...n,requester_id:e.id}]).select().single();if(o)throw o;return s},onSuccess:()=>{r.invalidateQueries({queryKey:["myActivityRequests"]}),t({title:Pr.t("common.success"),description:""})},onError:n=>{t({title:Pr.t("common.error"),description:n.message||"",variant:"destructive"})}})},Oit=()=>{const{user:e}=Qn(),{toast:t}=Ii(),r=Ri();return Gi({mutationFn:async({requestId:n,status:s,adminNotes:o})=>{if(!e)throw new Error("User not authenticated");const{data:d,error:i}=await Ct.from("activity_requests").select("*").eq("id",n).single();if(i)throw i;let m=null;if(s==="approved"){const{data:S,error:w}=await Ct.from("activities").insert([{creator_id:d.requester_id,title_zh:d.title_zh,title_en:d.title_en,title_pt:d.title_pt,intro_zh:d.intro_zh,intro_en:d.intro_en,intro_pt:d.intro_pt,content_zh:d.content_zh,content_en:d.content_en,content_pt:d.content_pt,image_url:d.image_url,start_date:d.start_date,end_date:d.end_date,service_type:d.service_type,badge_text_zh:d.badge_text_zh,badge_text_en:d.badge_text_en,badge_text_pt:d.badge_text_pt,badge_color:d.badge_color,visible:!0}]).select().single();if(w)throw w;m=S.id}const{error:y}=await Ct.from("activity_requests").update({status:s,admin_notes:o||null,reviewed_by:e.id,reviewed_at:new Date().toISOString(),created_activity_id:m}).eq("id",n);if(y)throw y;return{status:s,createdActivityId:m}},onSuccess:n=>{r.invalidateQueries({queryKey:["allActivityRequests"]}),r.invalidateQueries({queryKey:["activities"]}),t({title:Pr.t("common.success"),description:n.status==="approved"?"":""})},onError:n=>{t({title:Pr.t("common.error"),description:n.message,variant:"destructive"})}})},Wde=()=>{const{toast:e}=Ii(),t=Ri();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("activity_requests").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["myActivityRequests"]}),t.invalidateQueries({queryKey:["allActivityRequests"]}),e({title:Pr.t("common.success"),description:""})},onError:r=>{e({title:Pr.t("common.error"),description:r.message,variant:"destructive"})}})},kit=()=>{const{t:e}=ei(),{data:t,isLoading:r}=jit(),{getLocalizedField:n}=xc(),s=Oit(),o=Wde(),[d,i]=V.useState(""),[m,y]=V.useState("all"),[S,w]=V.useState(!1),[T,A]=V.useState(!1),[O,P]=V.useState(!1),[N,R]=V.useState(null),[M,F]=V.useState("approved"),[B,$]=V.useState(""),W=t==null?void 0:t.filter(ne=>{const re=String(n(ne,"title")||"").toLowerCase().includes(d.toLowerCase()),ee=m==="all"||ne.status===m;return re&&ee}),K=ne=>{switch(ne){case"pending":return h.jsxs(tn,{variant:"secondary",className:"gap-1",children:[h.jsx(Xv,{className:"h-3 w-3"}),""]});case"approved":return h.jsxs(tn,{className:"gap-1 bg-green-500",children:[h.jsx(BP,{className:"h-3 w-3"}),""]});case"rejected":return h.jsxs(tn,{variant:"destructive",className:"gap-1",children:[h.jsx($P,{className:"h-3 w-3"}),""]});default:return null}},te=()=>{N&&(s.mutate({requestId:N.id,status:M,adminNotes:B||void 0}),w(!1),R(null),$(""))};return r?h.jsx(ml,{children:h.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:h.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})})}):h.jsx(ml,{children:h.jsxs("div",{className:"space-y-6",children:[h.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:""}),h.jsx("p",{className:"text-muted-foreground mt-2",children:""})]})}),h.jsx(kr,{children:h.jsx(Mr,{className:"pt-6",children:h.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[h.jsxs("div",{className:"relative flex-1",children:[h.jsx(pp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),h.jsx(cr,{placeholder:"...",value:d,onChange:ne=>i(ne.target.value),className:"pl-10"})]}),h.jsxs(Aa,{value:m,onValueChange:y,children:[h.jsx(ya,{className:"w-[180px]",children:h.jsx(Ca,{placeholder:""})}),h.jsxs(va,{children:[h.jsx(En,{value:"all",children:""}),h.jsx(En,{value:"pending",children:""}),h.jsx(En,{value:"approved",children:""}),h.jsx(En,{value:"rejected",children:""})]})]})]})})}),h.jsx("div",{className:"grid gap-4",children:!W||W.length===0?h.jsx(kr,{children:h.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(yo,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-lg font-medium",children:""})]})}):W.map(ne=>{var ae;return h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[h.jsxs("div",{className:"flex-1",children:[h.jsxs(Hn,{className:"text-lg md:text-xl flex items-center gap-2",children:[h.jsx(yo,{className:"h-5 w-5"}),n(ne,"title")]}),h.jsxs(cs,{className:"mt-2 flex items-center gap-2",children:[h.jsx(P0,{className:"h-3 w-3"}),((ae=ne.profiles)==null?void 0:ae.display_name)||"",h.jsx("span",{children:""}),Rs(new Date(ne.created_at),"yyyy-MM-dd HH:mm")]})]}),K(ne.status)]})}),h.jsx(Mr,{children:h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"text-sm text-muted-foreground",children:["",Rs(new Date(ne.start_date),"yyyy-MM-dd"),ne.end_date?` - ${Rs(new Date(ne.end_date),"yyyy-MM-dd")}`:" - "]}),n(ne,"intro")&&h.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:n(ne,"intro")}),ne.admin_notes&&h.jsxs("div",{className:"p-3 rounded-lg bg-muted",children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:ne.admin_notes})]}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{R(ne),A(!0)},children:[h.jsx(AB,{className:"mr-2 h-3 w-3"}),""]}),ne.status==="pending"&&h.jsxs(h.Fragment,{children:[h.jsxs(Mt,{size:"sm",onClick:()=>{R(ne),F("approved"),w(!0)},children:[h.jsx(BP,{className:"mr-2 h-3 w-3"}),""]}),h.jsxs(Mt,{variant:"destructive",size:"sm",onClick:()=>{R(ne),F("rejected"),w(!0)},children:[h.jsx($P,{className:"mr-2 h-3 w-3"}),""]})]}),h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{R(ne),P(!0)},children:[h.jsx(Yh,{className:"mr-2 h-3 w-3"}),""]})]})]})})]},ne.id)})}),h.jsx(Lo,{open:S,onOpenChange:w,children:h.jsxs(xo,{children:[h.jsxs(bo,{children:[h.jsx(wo,{children:M==="approved"?"":""}),h.jsx(pl,{children:M==="approved"?"":""})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-2",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N&&n(N,"title")})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-2",children:""}),h.jsx(fl,{placeholder:M==="approved"?"...":"...",value:B,onChange:ne=>$(ne.target.value)})]})]}),h.jsxs(r_,{children:[h.jsx(Mt,{variant:"outline",onClick:()=>{w(!1),R(null),$("")},children:""}),h.jsx(Mt,{variant:M==="approved"?"default":"destructive",onClick:te,disabled:s.isPending,children:s.isPending?"...":M==="approved"?"":""})]})]})}),h.jsx(Lo,{open:T,onOpenChange:A,children:h.jsxs(xo,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[h.jsx(bo,{children:h.jsx(wo,{children:""})}),N&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.title_zh})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.title_en})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.title_pt})]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.intro_zh||"-"})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.intro_en||"-"})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.intro_pt||"-"})]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:N.content_zh})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:N.content_en})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:N.content_pt})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:Rs(new Date(N.start_date),"yyyy-MM-dd")})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.end_date?Rs(new Date(N.end_date),"yyyy-MM-dd"):""})]})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:N.service_type==="dine_in"?"":N.service_type==="takeaway"?"":"+"})]}),N.image_url&&h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("img",{src:N.image_url,alt:"",className:"rounded-lg max-w-full h-auto max-h-48 object-cover"})]})]})]})}),h.jsx(Io,{open:O,onOpenChange:P,children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:""}),h.jsx(po,{children:""})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>R(null),children:""}),h.jsx(to,{onClick:()=>{N&&(o.mutate(N.id),P(!1),R(null))},children:""})]})]})})]})})},Nit=()=>{Qn();const e=Ju(),{t}=ei(),{isMerchant:r,isSupervisor:n,isLoading:s}=_c(),{data:o=[],isLoading:d}=D2(),{localizeRestaurant:i}=xc();return!s&&!r&&!n?(e("/"),null):d||s?h.jsx("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center min-h-[50vh]",children:h.jsx(aa,{className:"w-8 h-8 animate-spin text-primary"})}):h.jsxs("div",{className:"container mx-auto px-4 py-8",children:[h.jsxs("div",{className:"mb-8",children:[h.jsx("h1",{className:"text-3xl font-bold mb-2",children:t("merchant.myRestaurants")}),h.jsx("p",{className:"text-muted-foreground",children:t(n?"merchant.supervisorDescription":"merchant.merchantDescription")})]}),o.length===0?h.jsx(kr,{children:h.jsx(Mr,{className:"py-12 text-center",children:h.jsx("p",{className:"text-muted-foreground mb-4",children:t("merchant.noRestaurants")})})}):h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(m=>{const y=i(m);return h.jsxs(kr,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[h.jsx("div",{className:"relative h-48 overflow-hidden",children:h.jsx("img",{src:m.image_url||"/placeholder.svg",alt:y.name,className:"w-full h-full object-cover"})}),h.jsx(Rn,{children:h.jsxs(Hn,{className:"flex items-start justify-between gap-2",children:[h.jsx("span",{className:"line-clamp-1",children:y.name}),m.rating&&h.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[h.jsx(Cl,{className:"w-4 h-4 fill-primary text-primary"}),h.jsx("span",{children:m.rating})]})]})}),h.jsxs(Mr,{className:"space-y-3",children:[m.type&&m.type.length>0&&h.jsx("div",{className:"flex flex-wrap gap-1",children:y.type.slice(0,3).map((S,w)=>h.jsx("span",{className:"text-xs px-2 py-1 bg-secondary text-secondary-foreground rounded",children:S},w))}),m.address&&h.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[h.jsx(ga,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),h.jsx("span",{className:"line-clamp-2",children:m.address})]}),m.phone&&h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(tw,{className:"w-4 h-4 flex-shrink-0"}),h.jsx("span",{children:m.phone})]}),m.website_url&&h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(yv,{className:"w-4 h-4 flex-shrink-0"}),h.jsx("a",{href:m.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline line-clamp-1",children:t("restaurant.visitWebsite")})]}),h.jsxs("div",{className:"flex gap-2 pt-2",children:[h.jsx(Mt,{asChild:!0,variant:"outline",size:"sm",className:"flex-1",children:h.jsx(Hi,{to:`/restaurant/${m.id}`,children:t("restaurants.viewDetails")})}),h.jsx(PO,{restaurant:m,trigger:h.jsxs(Mt,{variant:"default",size:"sm",className:"flex-1",children:[h.jsx(_2,{className:"w-4 h-4 mr-1"}),t("common.edit")]})})]})]})]},m.id)})})]})},Iit=()=>{const{t:e}=ei(),t=Ju(),{user:r}=Qn(),{isMerchant:n,isSupervisor:s}=_c(),{data:o,isLoading:d}=Cit(),{getLocalizedField:i}=xc(),m=Wde(),[y,S]=V.useState(!1),[w,T]=V.useState(null);if(!r||!n&&!s)return h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx(D0,{}),h.jsx("div",{className:"container mx-auto px-4 py-8",children:h.jsx(kr,{children:h.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(rN,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-lg font-medium",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})})})]});const A=O=>{switch(O){case"pending":return h.jsxs(tn,{variant:"secondary",className:"gap-1",children:[h.jsx(Xv,{className:"h-3 w-3"}),""]});case"approved":return h.jsxs(tn,{className:"gap-1 bg-green-500",children:[h.jsx(BP,{className:"h-3 w-3"}),""]});case"rejected":return h.jsxs(tn,{variant:"destructive",className:"gap-1",children:[h.jsx($P,{className:"h-3 w-3"}),""]});default:return null}};return d?h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx(D0,{}),h.jsx("div",{className:"container mx-auto px-4 py-8",children:h.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:h.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})})})]}):h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx(D0,{}),h.jsxs("div",{className:"container mx-auto px-4 py-8",children:[h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:""}),h.jsx("p",{className:"text-muted-foreground mt-2",children:""})]}),h.jsxs(Mt,{onClick:()=>t("/merchant/activity-requests/new"),children:[h.jsx(ap,{className:"mr-2 h-4 w-4"}),""]})]}),h.jsx("div",{className:"grid gap-4",children:!o||o.length===0?h.jsx(kr,{children:h.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(yo,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-lg font-medium",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:""}),h.jsxs(Mt,{onClick:()=>t("/merchant/activity-requests/new"),children:[h.jsx(ap,{className:"mr-2 h-4 w-4"}),""]})]})}):o.map(O=>h.jsxs(kr,{children:[h.jsx(Rn,{children:h.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[h.jsxs("div",{className:"flex-1",children:[h.jsxs(Hn,{className:"text-lg md:text-xl flex items-center gap-2",children:[h.jsx(yo,{className:"h-5 w-5"}),i(O,"title")]}),h.jsxs(cs,{className:"mt-2",children:["",Rs(new Date(O.created_at),"yyyy-MM-dd HH:mm")]})]}),A(O.status)]})}),h.jsx(Mr,{children:h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"text-sm text-muted-foreground",children:["",Rs(new Date(O.start_date),"yyyy-MM-dd"),O.end_date?` - ${Rs(new Date(O.end_date),"yyyy-MM-dd")}`:" - "]}),O.admin_notes&&h.jsxs("div",{className:"p-3 rounded-lg bg-muted",children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:O.admin_notes})]}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[O.status==="approved"&&O.created_activity_id&&h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>t(`/activity/${O.created_activity_id}`),children:[h.jsx(AB,{className:"mr-2 h-3 w-3"}),""]}),O.status==="pending"&&h.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{T(O),S(!0)},children:[h.jsx(Yh,{className:"mr-2 h-3 w-3"}),""]})]})]})})]},O.id))})]}),h.jsx(Io,{open:y,onOpenChange:S,children:h.jsxs(co,{children:[h.jsxs(uo,{children:[h.jsx(fo,{children:""}),h.jsx(po,{children:""})]}),h.jsxs(ho,{children:[h.jsx(mo,{onClick:()=>T(null),children:""}),h.jsx(to,{onClick:()=>{w&&(m.mutate(w.id),S(!1),T(null))},children:""})]})]})})]})]})};var xU="Radio",[Rit,Kde]=Fo(xU),[Mit,Dit]=Rit(xU),Zde=V.forwardRef((e,t)=>{const{__scopeRadio:r,name:n,checked:s=!1,required:o,disabled:d,value:i="on",onCheck:m,form:y,...S}=e,[w,T]=V.useState(null),A=$n(t,N=>T(N)),O=V.useRef(!1),P=w?y||!!w.closest("form"):!0;return h.jsxs(Mit,{scope:r,checked:s,disabled:d,children:[h.jsx(on.button,{type:"button",role:"radio","aria-checked":s,"data-state":Qde(s),"data-disabled":d?"":void 0,disabled:d,value:i,...S,ref:A,onClick:Ir(e.onClick,N=>{s||m==null||m(),P&&(O.current=N.isPropagationStopped(),O.current||N.stopPropagation())})}),P&&h.jsx(Jde,{control:w,bubbles:!O.current,name:n,value:i,checked:s,required:o,disabled:d,form:y,style:{transform:"translateX(-100%)"}})]})});Zde.displayName=xU;var Xde="RadioIndicator",Yde=V.forwardRef((e,t)=>{const{__scopeRadio:r,forceMount:n,...s}=e,o=Dit(Xde,r);return h.jsx(zo,{present:n||o.checked,children:h.jsx(on.span,{"data-state":Qde(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:t})})});Yde.displayName=Xde;var Lit="RadioBubbleInput",Jde=V.forwardRef(({__scopeRadio:e,control:t,checked:r,bubbles:n=!0,...s},o)=>{const d=V.useRef(null),i=$n(d,o),m=M2(r),y=b2(t);return V.useEffect(()=>{const S=d.current;if(!S)return;const w=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(w,"checked").set;if(m!==r&&A){const O=new Event("click",{bubbles:n});A.call(S,r),S.dispatchEvent(O)}},[m,r,n]),h.jsx(on.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...s,tabIndex:-1,ref:i,style:{...s.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Jde.displayName=Lit;function Qde(e){return e?"checked":"unchecked"}var Fit=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],HI="RadioGroup",[zit,gst]=Fo(HI,[uw,Kde]),ehe=uw(),the=Kde(),[Bit,$it]=zit(HI),rhe=V.forwardRef((e,t)=>{const{__scopeRadioGroup:r,name:n,defaultValue:s,value:o,required:d=!1,disabled:i=!1,orientation:m,dir:y,loop:S=!0,onValueChange:w,...T}=e,A=ehe(r),O=Yv(y),[P,N]=Zc({prop:o,defaultProp:s??null,onChange:w,caller:HI});return h.jsx(Bit,{scope:r,name:n,required:d,disabled:i,value:P,onValueChange:N,children:h.jsx(c5,{asChild:!0,...A,orientation:m,dir:O,loop:S,children:h.jsx(on.div,{role:"radiogroup","aria-required":d,"aria-orientation":m,"data-disabled":i?"":void 0,dir:O,...T,ref:t})})})});rhe.displayName=HI;var nhe="RadioGroupItem",ihe=V.forwardRef((e,t)=>{const{__scopeRadioGroup:r,disabled:n,...s}=e,o=$it(nhe,r),d=o.disabled||n,i=ehe(r),m=the(r),y=V.useRef(null),S=$n(t,y),w=o.value===s.value,T=V.useRef(!1);return V.useEffect(()=>{const A=P=>{Fit.includes(P.key)&&(T.current=!0)},O=()=>T.current=!1;return document.addEventListener("keydown",A),document.addEventListener("keyup",O),()=>{document.removeEventListener("keydown",A),document.removeEventListener("keyup",O)}},[]),h.jsx(u5,{asChild:!0,...i,focusable:!d,active:w,children:h.jsx(Zde,{disabled:d,required:o.required,checked:w,...m,...s,name:o.name,ref:S,onCheck:()=>o.onValueChange(s.value),onKeyDown:Ir(A=>{A.key==="Enter"&&A.preventDefault()}),onFocus:Ir(s.onFocus,()=>{var A;T.current&&((A=y.current)==null||A.click())})})})});ihe.displayName=nhe;var Uit="RadioGroupIndicator",she=V.forwardRef((e,t)=>{const{__scopeRadioGroup:r,...n}=e,s=the(r);return h.jsx(Yde,{...s,...n,ref:t})});she.displayName=Uit;var ahe=rhe,ohe=ihe,Vit=she;const lhe=V.forwardRef(({className:e,...t},r)=>h.jsx(ahe,{className:fr("grid gap-2",e),...t,ref:r}));lhe.displayName=ahe.displayName;const T4=V.forwardRef(({className:e,...t},r)=>h.jsx(ohe,{ref:r,className:fr("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:h.jsx(Vit,{className:"flex items-center justify-center",children:h.jsx(AQ,{className:"h-2.5 w-2.5 fill-current text-current"})})}));T4.displayName=ohe.displayName;const qit=Ah({title_zh:xn().min(1,""),title_en:xn().min(1,""),title_pt:xn().min(1,""),intro_zh:xn().optional(),intro_en:xn().optional(),intro_pt:xn().optional(),content_zh:xn().min(1,""),content_en:xn().min(1,""),content_pt:xn().min(1,""),image_url:xn().url().optional().or(Xke("")),start_date:xn().min(1,""),end_date:xn().optional(),service_type:wT(["dine_in","takeaway","both"]),badge_text_zh:xn().optional(),badge_text_en:xn().optional(),badge_text_pt:xn().optional(),badge_color:xn().optional()}),Hit=()=>{ei();const e=Ju(),{user:t}=Qn(),{isMerchant:r,isSupervisor:n}=_c(),s=Pit(),[o,d]=V.useState(!1),[i,m]=V.useState("upload"),[y,S]=V.useState(""),[w,T]=V.useState(!1),[A,O]=V.useState(""),P=V.useRef(null),N=async $=>{if(t){if($.size>5*1024*1024){ko({title:"",description:"5MB",variant:"destructive"});return}T(!0);try{const W=$.name.split(".").pop(),te=`activity-requests/${`${t.id}-${Date.now()}.${W}`}`,{error:ne}=await Ct.storage.from("activity-images").upload(te,$);if(ne)throw ne;const{data:{publicUrl:ae}}=Ct.storage.from("activity-images").getPublicUrl(te);S(ae),O(ae),ko({title:"",description:""})}catch(W){console.error("Upload error:",W),ko({title:"",description:"",variant:"destructive"})}finally{T(!1)}}},R=$=>{var K;const W=(K=$.target.files)==null?void 0:K[0];W&&N(W)},M=()=>{S(""),O(""),P.current&&(P.current.value="")},F=Eh({resolver:Th(qit),defaultValues:{title_zh:"",title_en:"",title_pt:"",intro_zh:"",intro_en:"",intro_pt:"",content_zh:"",content_en:"",content_pt:"",image_url:"",start_date:new Date().toISOString().split("T")[0],end_date:"",service_type:"both",badge_text_zh:"",badge_text_en:"",badge_text_pt:"",badge_color:"#9b87f5"}});if(!t||!r&&!n)return h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx(D0,{}),h.jsx("div",{className:"container mx-auto px-4 py-8",children:h.jsx(kr,{children:h.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(rN,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-lg font-medium",children:""}),h.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})})})]});const B=async $=>{d(!0);try{const W=i==="upload"?y:$.image_url;await s.mutateAsync({title_zh:$.title_zh,title_en:$.title_en,title_pt:$.title_pt,intro_zh:$.intro_zh||null,intro_en:$.intro_en||null,intro_pt:$.intro_pt||null,content_zh:$.content_zh,content_en:$.content_en,content_pt:$.content_pt,image_url:W||null,start_date:$.start_date,end_date:$.end_date||null,service_type:$.service_type,badge_text_zh:$.badge_text_zh||null,badge_text_en:$.badge_text_en||null,badge_text_pt:$.badge_text_pt||null,badge_color:$.badge_color||"#9b87f5"}),e("/merchant/activity-requests")}finally{d(!1)}};return h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx(D0,{}),h.jsx("div",{className:"container mx-auto px-4 py-8",children:h.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>e("/merchant/activity-requests"),children:h.jsx(SQ,{className:"h-4 w-4"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-2xl font-bold",children:""}),h.jsx("p",{className:"text-muted-foreground",children:""})]})]}),h.jsxs(kr,{children:[h.jsxs(Rn,{children:[h.jsxs(Hn,{className:"flex items-center gap-2",children:[h.jsx(yo,{className:"h-5 w-5"}),""]}),h.jsx(cs,{children:""})]}),h.jsx(Mr,{children:h.jsx(r$,{...F,children:h.jsxs("form",{onSubmit:F.handleSubmit(B),className:"space-y-6",children:[h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsx(Ki,{control:F.control,name:"title_zh",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"title_en",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"Activity Title",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"title_pt",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"Ttulo da Atividade",...$})}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsx(Ki,{control:F.control,name:"intro_zh",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"intro_en",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"Brief description",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"intro_pt",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"Descrio breve",...$})}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsx(Ki,{control:F.control,name:"content_zh",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(fl,{placeholder:"",rows:5,...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"content_en",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(fl,{placeholder:"Detailed description",rows:5,...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"content_pt",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(fl,{placeholder:"Descrio detalhada",rows:5,...$})}),h.jsx(ss,{})]})})]}),h.jsx("div",{className:"space-y-4",children:h.jsxs("div",{className:"space-y-3",children:[h.jsx(yr,{children:""}),h.jsxs(lhe,{value:i,onValueChange:$=>{m($),$==="url"?M():(F.setValue("image_url",""),O(""))},className:"flex gap-4",children:[h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx(T4,{value:"upload",id:"upload"}),h.jsxs(yr,{htmlFor:"upload",className:"flex items-center gap-1 cursor-pointer",children:[h.jsx(Lh,{className:"h-4 w-4"}),""]})]}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx(T4,{value:"url",id:"url"}),h.jsxs(yr,{htmlFor:"url",className:"flex items-center gap-1 cursor-pointer",children:[h.jsx(k_e,{className:"h-4 w-4"}),"URL"]})]})]}),i==="upload"?h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(cr,{ref:P,type:"file",accept:"image/*",onChange:R,disabled:w,className:"flex-1"}),w&&h.jsx(aa,{className:"h-4 w-4 animate-spin"})]}),A&&h.jsxs("div",{className:"relative inline-block",children:[h.jsx("img",{src:A,alt:"Preview",className:"max-h-32 rounded-md border"}),h.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6",onClick:M,children:h.jsx(wu,{className:"h-3 w-3"})})]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:" JPGPNGWebP  5MB"})]}):h.jsx(Ki,{control:F.control,name:"image_url",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Zi,{children:h.jsx(cr,{placeholder:"https://example.com/image.jpg",...$,onChange:W=>{$.onChange(W),O(W.target.value)}})}),A&&h.jsx("div",{className:"mt-2",children:h.jsx("img",{src:A,alt:"Preview",className:"max-h-32 rounded-md border",onError:()=>O("")})}),h.jsx(ss,{})]})})]})}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsx("div",{})," ",h.jsx(Ki,{control:F.control,name:"service_type",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsxs(Aa,{onValueChange:$.onChange,defaultValue:$.value,children:[h.jsx(Zi,{children:h.jsx(ya,{children:h.jsx(Ca,{placeholder:""})})}),h.jsxs(va,{children:[h.jsx(En,{value:"dine_in",children:""}),h.jsx(En,{value:"takeaway",children:""}),h.jsx(En,{value:"both",children:"+"})]})]}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsx(Ki,{control:F.control,name:"start_date",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:" *"}),h.jsx(Zi,{children:h.jsx(cr,{type:"date",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"end_date",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{type:"date",...$})}),h.jsx(ev,{children:""}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[h.jsx(Ki,{control:F.control,name:"badge_text_zh",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"badge_text_en",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"New",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"badge_text_pt",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{placeholder:"Novo",...$})}),h.jsx(ss,{})]})}),h.jsx(Ki,{control:F.control,name:"badge_color",render:({field:$})=>h.jsxs(qi,{children:[h.jsx(Xi,{children:""}),h.jsx(Zi,{children:h.jsx(cr,{type:"color",...$})}),h.jsx(ss,{})]})})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(Mt,{type:"button",variant:"outline",onClick:()=>e("/merchant/activity-requests"),disabled:o,children:""}),h.jsx(Mt,{type:"submit",disabled:o,children:o?"...":""})]})]})})})]})]})})]})},Git=new swe,Wit=()=>h.jsx(uwe,{client:Git,children:h.jsxs(_ee,{children:[h.jsx(Exe,{}),h.jsx(r0e,{}),h.jsx(v1e,{children:h.jsxs(NEe,{children:[h.jsx(oPe,{}),h.jsx(D0,{}),h.jsx("div",{className:"pt-14 sm:pt-16",children:h.jsxs(d1e,{children:[h.jsx(Sa,{path:"/",element:h.jsx(fPe,{})}),h.jsx(Sa,{path:"/restaurants",element:h.jsx(DPe,{})}),h.jsx(Sa,{path:"/restaurant/:id",element:h.jsx(sNe,{})}),h.jsx(Sa,{path:"/map",element:h.jsx(aNe,{})}),h.jsx(Sa,{path:"/activities",element:h.jsx(cNe,{})}),h.jsx(Sa,{path:"/activity/:id",element:h.jsx(vNe,{})}),h.jsx(Sa,{path:"/auth",element:h.jsx(_Ne,{})}),h.jsx(Sa,{path:"/profile",element:h.jsx(bIe,{})}),h.jsx(Sa,{path:"/join-us",element:h.jsx(wIe,{})}),h.jsx(Sa,{path:"/merchant-restaurants",element:h.jsx(Nit,{})}),h.jsx(Sa,{path:"/merchant/activity-requests",element:h.jsx(Iit,{})}),h.jsx(Sa,{path:"/merchant/activity-requests/new",element:h.jsx(Hit,{})}),h.jsx(Sa,{path:"/admin",element:h.jsx(Utt,{})}),h.jsx(Sa,{path:"/admin/users",element:h.jsx(Xtt,{})}),h.jsx(Sa,{path:"/admin/restaurants",element:h.jsx(Jtt,{})}),h.jsx(Sa,{path:"/admin/activities",element:h.jsx(Jnt,{})}),h.jsx(Sa,{path:"/admin/coupons",element:h.jsx(Ait,{})}),h.jsx(Sa,{path:"/admin/activity-requests",element:h.jsx(kit,{})}),h.jsx(Sa,{path:"/admin/logs",element:h.jsx(Qnt,{})}),h.jsx(Sa,{path:"/admin/homepage",element:h.jsx(vit,{})}),h.jsx(Sa,{path:"/admin/join-requests",element:h.jsx(bit,{})}),h.jsx(Sa,{path:"/admin/reports",element:h.jsx(wit,{})}),h.jsx(Sa,{path:"*",element:h.jsx(SIe,{})})]})})]})})]})});ZJ(document.getElementById("root")).render(h.jsx(Wit,{}));
