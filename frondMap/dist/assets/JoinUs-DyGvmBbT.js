import{r as d,j as e,c6 as H,c7 as re,p as ne,c8 as ie,bI as le,bM as oe,c9 as ce,y as de,M as me,ba as xe,a4 as w,bp as ue,bn as E,b$ as je,am as he,a_ as pe,an as q,aM as L,X as fe,L as $,bj as ge,W as ve,bt as Ne}from"./vendor-react-Dd_5Sawp.js";import{i as m,b as ye,C as z,q as A,B as C,p as be,F as Ue,$ as _e,I as v,X as I,o as we,D as Ce,c as Ve,d as Ie,e as Se,T as ke,s as Re}from"./index-BTawsUvj.js";import{F as De,a as x,b as u,d as p,e as j,c as N}from"./form-CIY7u5ad.js";import{d as Pe}from"./useInvitationCodes-CahOmGKx.js";import{N as Te,P as O,O as y,Q as Fe}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-BnZwaL-Z.js";const B=d.forwardRef(({className:s,value:b,...U},V)=>e.jsx(H,{ref:V,className:m("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...U,children:e.jsx(re,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(b||0)}%)`}})}));B.displayName=H.displayName;const G=["booking","delivery","qrcode"],He=()=>{const{t:s,i18n:b}=ne(),[U]=ie(),[V,D]=d.useState(!1),[X,P]=d.useState(!1),[n,S]=d.useState(1),[Q,k]=d.useState(!1),{settings:i}=ye(),W=Pe(),[c,f]=d.useState({isValidating:!1,isValid:null,inviterUserId:null}),J=d.useMemo(()=>Te({restaurant_type:O(["standard","ghost"]),name:y().min(2,{message:s("joinUs.nameMin")}),email:y().email({message:s("joinUs.emailInvalid")}),phone:y().min(6,{message:s("joinUs.phoneMin")}),restaurant_name:y().min(2,{message:s("joinUs.restaurantNameMin")}),restaurant_address:y().min(2,{message:s("joinUs.addressMin")}),features_selected:Fe(O(G)).min(1,{message:s("joinUs.featuresMin")}),invitation_code:y().optional()}),[s]),r=le({resolver:oe(J),defaultValues:{restaurant_type:"standard",name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[],invitation_code:U.get("code")||""}}),K=r.watch("restaurant_type"),l=r.watch("features_selected")?.includes("qrcode"),o=K==="ghost",g=o?3:4;d.useEffect(()=>{const t=U.get("code");t&&l&&!o&&T(t)},[U,l,o]),d.useEffect(()=>{(!l||o)&&(r.setValue("invitation_code",""),f({isValidating:!1,isValid:null,inviterUserId:null}))},[l,o,r]),d.useEffect(()=>{o&&r.setValue("features_selected",["delivery"])},[o,r]);const T=async t=>{if(!t||t.length<6){f({isValidating:!1,isValid:null,inviterUserId:null});return}f({isValidating:!0,isValid:null,inviterUserId:null});try{const a=await W.mutateAsync(t);f(a?{isValidating:!1,isValid:!0,inviterUserId:a.user_id}:{isValidating:!1,isValid:!1,inviterUserId:null})}catch{f({isValidating:!1,isValid:!1,inviterUserId:null})}},Y=async()=>{let t=[];switch(n){case 1:t=["restaurant_type"];break;case 2:t=["name","email","phone"];break;case 3:t=["restaurant_name","restaurant_address"];break;case 4:o||(t=["features_selected"]);break}return await r.trigger(t)},Z=async t=>{t.preventDefault(),t.stopPropagation(),await Y()&&n<g&&S(h=>h+1)},ee=t=>{t.preventDefault(),t.stopPropagation(),n>1&&S(a=>a-1)},se=async t=>{D(!0);try{const a=b.language||"en",h=o?["delivery"]:t.features_selected,{error:_}=await Re.functions.invoke("send-join-request-email",{body:{...t,features_selected:h,language:a,invitation_code:!o&&c.isValid?t.invitation_code:null,invited_by_user_id:!o&&c.inviterUserId?c.inviterUserId:null,restaurant_type:t.restaurant_type}});if(_){if(_.message.includes("rate_limit_exceeded"))I({title:s("joinUs.rateLimitError"),description:s("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw _;return}P(!0),r.reset(),S(1),I({title:s("joinUs.successTitle"),description:s("joinUs.successDescription")})}catch(a){console.error("Error submitting join request:",a),I({title:s("common.error"),description:s("joinUs.submitError"),variant:"destructive"})}finally{D(!1)}},te=()=>{const t=b.language;return t==="zh"&&i?.join_success_title_zh?i.join_success_title_zh:t==="pt"&&i?.join_success_title_pt?i.join_success_title_pt:i?.join_success_title_en?i.join_success_title_en:s("joinUs.successTitle")},ae=()=>{const t=b.language;return t==="zh"&&i?.join_success_message_zh?i.join_success_message_zh:t==="pt"&&i?.join_success_message_pt?i.join_success_message_pt:i?.join_success_message_en?i.join_success_message_en:s("joinUs.successMessage")},F=i?.join_contact_phone||"968815050",R=i?.contact_email,M=n/g*100;return X?e.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-2xl",children:e.jsx(z,{className:"border-primary",children:e.jsxs(A,{className:"pt-12 pb-12 text-center",children:[e.jsx(ce,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:te()}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:ae()}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-6",children:[e.jsxs("a",{href:`tel:${F}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{children:F})]}),R&&e.jsxs("a",{href:`mailto:${R}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(me,{className:"w-5 h-5"}),e.jsx("span",{children:R})]})]}),e.jsx(C,{onClick:()=>P(!1),children:s("joinUs.submitAnother")})]})})})}):e.jsxs("div",{className:"min-h-screen pt-4 pb-12 px-4 bg-secondary/20",children:[e.jsx("div",{className:"container mx-auto max-w-2xl",children:e.jsxs(z,{children:[e.jsxs(be,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(xe,{className:"w-12 h-12 text-primary"})}),e.jsx(Ue,{className:"text-3xl font-bold",children:s("joinUs.title")}),e.jsx(_e,{className:"text-base",children:s("joinUs.description")})]}),e.jsxs("div",{className:"px-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s("joinUs.step",{current:n,total:g})}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.round(M),"%"]})]}),e.jsx(B,{value:M,className:"h-2"}),e.jsx("div",{className:"flex justify-between mt-4",children:Array.from({length:g},(t,a)=>a+1).map(t=>e.jsx("div",{className:m("flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors",t<n?"bg-primary text-primary-foreground":t===n?"bg-primary text-primary-foreground ring-2 ring-primary ring-offset-2":"bg-muted text-muted-foreground"),children:t<n?e.jsx(w,{className:"w-4 h-4"}):t},t))})]}),e.jsx(A,{children:e.jsx(De,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(se),className:"space-y-6",children:[n===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.selectRestaurantType")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.selectRestaurantTypeDesc")})]}),e.jsx(x,{control:r.control,name:"restaurant_type",render:({field:t})=>e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>t.onChange("standard"),className:m("relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50",t.value==="standard"?"border-primary bg-primary/5":"border-muted"),children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:m("p-3 rounded-full",t.value==="standard"?"bg-primary/10":"bg-muted"),children:e.jsx(ue,{className:m("w-8 h-8",t.value==="standard"?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s("joinUs.standardRestaurant")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("joinUs.standardRestaurantDesc")})]})]}),t.value==="standard"&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(w,{className:"w-5 h-5 text-primary"})})]}),e.jsxs("div",{onClick:()=>t.onChange("ghost"),className:m("relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50",t.value==="ghost"?"border-primary bg-primary/5":"border-muted"),children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:m("p-3 rounded-full",t.value==="ghost"?"bg-primary/10":"bg-muted"),children:e.jsx(E,{className:m("w-8 h-8",t.value==="ghost"?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s("joinUs.ghostRestaurant")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("joinUs.ghostRestaurantDesc")})]})]}),t.value==="ghost"&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(w,{className:"w-5 h-5 text-primary"})}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),k(!0)},className:"absolute top-3 left-3 p-1 rounded-full hover:bg-muted transition-colors",children:e.jsx(je,{className:"w-4 h-4 text-muted-foreground"})})]})]})}),e.jsx(j,{})]})})]}),n===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(he,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.contactInfo")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.contactInfoDesc")})]}),e.jsx(x,{control:r.control,name:"name",render:({field:t})=>e.jsxs(u,{children:[e.jsx(N,{children:s("joinUs.name")}),e.jsx(p,{children:e.jsx(v,{placeholder:s("joinUs.namePlaceholder"),...t})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"email",render:({field:t})=>e.jsxs(u,{children:[e.jsx(N,{children:s("joinUs.email")}),e.jsx(p,{children:e.jsx(v,{type:"email",placeholder:s("joinUs.emailPlaceholder"),...t})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"phone",render:({field:t})=>e.jsxs(u,{children:[e.jsx(N,{children:s("joinUs.phone")}),e.jsx(p,{children:e.jsx(v,{type:"tel",placeholder:s("joinUs.phonePlaceholder"),...t})}),e.jsx(j,{})]})})]}),n===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(pe,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.restaurantInfo")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.restaurantInfoDesc")})]}),e.jsx(x,{control:r.control,name:"restaurant_name",render:({field:t})=>e.jsxs(u,{children:[e.jsx(N,{children:s("joinUs.restaurantName")}),e.jsx(p,{children:e.jsx(v,{placeholder:s("joinUs.restaurantNamePlaceholder"),...t})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"restaurant_address",render:({field:t})=>e.jsxs(u,{children:[e.jsx(N,{children:s("joinUs.restaurantAddress")}),e.jsx(p,{children:e.jsx(v,{placeholder:s("joinUs.restaurantAddressPlaceholder"),...t})}),e.jsx(j,{})]})})]}),n===4&&!o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(q,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.featuresNeeded")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.featuresDescription")})]}),e.jsx(x,{control:r.control,name:"features_selected",render:({field:t})=>e.jsxs(u,{children:[e.jsx("div",{className:"space-y-3",children:G.map(a=>{const h=t.value?.includes(a);return e.jsxs("div",{className:"flex flex-row items-center space-x-3 space-y-0 rounded-lg border p-4 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{h?t.onChange(t.value?.filter(_=>_!==a)):t.onChange([...t.value||[],a])},children:[e.jsx("div",{className:m("h-4 w-4 shrink-0 rounded-sm border flex items-center justify-center transition-colors",h?"bg-primary border-primary text-primary-foreground":"border-primary"),children:h&&e.jsx(w,{className:"h-3 w-3"})}),e.jsx("span",{className:"font-normal cursor-pointer flex-1 text-sm",children:s(`joinUs.feature.${a}`)})]},a)})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"invitation_code",render:({field:t})=>e.jsxs(u,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),s("joinUs.invitationCode"),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs",children:["(",s("joinUs.optional"),")"]})]}),e.jsx(p,{children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{placeholder:s("joinUs.invitationCodePlaceholder","如有邀请码请输入"),...t,disabled:!l,onChange:a=>{t.onChange(a),l&&T(a.target.value)},onFocus:()=>{l||I({title:s("joinUs.qrcodeRequired","请先勾选扫码点餐"),description:s("joinUs.qrcodeRequiredDesc","只有选择扫码点餐功能后才能使用邀请码")})},className:m("pr-10",!l&&"cursor-not-allowed opacity-50")}),l&&c.isValidating&&e.jsx(L,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-muted-foreground"}),l&&!c.isValidating&&c.isValid===!0&&e.jsx(w,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-green-500"}),l&&!c.isValidating&&c.isValid===!1&&t.value&&e.jsx(fe,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-red-500"})]})}),!l&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s("joinUs.qrcodeRequiredHint","需要勾选扫码点餐功能后才能填写邀请码")}),l&&c.isValid===!0&&e.jsx("p",{className:"text-xs text-green-600",children:s("joinUs.invitationCodeValid","邀请码有效")}),l&&c.isValid===!1&&t.value&&e.jsx("p",{className:"text-xs text-red-600",children:s("joinUs.invitationCodeInvalid","邀请码无效")}),e.jsx(j,{})]})})]}),n===g&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center pb-4",children:[s("joinUs.consentText")," ",e.jsx($,{to:"/privacy-policy",className:"text-primary hover:underline",children:s("joinUs.privacyPolicy")})," ",s("joinUs.and")," ",e.jsx($,{to:"/terms-of-service",className:"text-primary hover:underline",children:s("joinUs.termsOfService")})]}),e.jsxs("div",{className:"flex justify-between gap-4 pt-4",children:[n>1?e.jsxs(C,{type:"button",variant:"outline",onClick:ee,className:"flex-1",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),s("joinUs.prev")]}):e.jsx("div",{className:"flex-1"}),n<g?e.jsxs(C,{type:"button",onClick:Z,className:"flex-1",children:[s("joinUs.next"),e.jsx(ve,{className:"w-4 h-4 ml-2"})]}):e.jsxs(C,{type:"submit",className:"flex-1",disabled:V,children:[V&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),s("joinUs.submit")]})]}),e.jsx("div",{className:"text-center pt-4",children:e.jsxs("button",{type:"button",onClick:()=>we("https://xiaoxiong.pt/en/pages/subscription"),className:"inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[s("joinUs.visitOurWebsite","访问我们的官网查看详细信息"),e.jsx(Ne,{className:"w-3 h-3"})]})})]})})})]})}),e.jsx(Ce,{open:Q,onOpenChange:k,children:e.jsxs(Ve,{className:"sm:max-w-md",children:[e.jsxs(Ie,{children:[e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-primary"}),s("joinUs.ghostRestaurantInfoTitle")]}),e.jsx(ke,{asChild:!0,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{children:s("joinUs.ghostRestaurantInfo1")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-foreground",children:s("joinUs.ghostRestaurantFeatures")}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:s("joinUs.ghostRestaurantFeature1")}),e.jsx("li",{children:s("joinUs.ghostRestaurantFeature2")}),e.jsx("li",{children:s("joinUs.ghostRestaurantFeature3")})]})]}),e.jsx("p",{className:"text-sm",children:s("joinUs.ghostRestaurantInfo2")})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(C,{onClick:()=>k(!1),children:s("common.gotIt")})})]})})]})};export{He as default};
//# sourceMappingURL=JoinUs-DyGvmBbT.js.map
