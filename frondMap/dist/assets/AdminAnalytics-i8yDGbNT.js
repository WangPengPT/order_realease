import{s as ae,r as g,p as oe,w as he,j as e,bG as ne,a6 as re,c9 as de,bd as xe,q as ue,bS as pe,b5 as fe,b0 as ye,cC as Y,cD as $,cE as Z,cF as W,cG as G,cH as Q,cI as B,cK as X,cn as ge,d1 as je,d2 as ve,d3 as we,ab as ee,cL as se,cM as te,bE as Ne,b$ as be,cJ as ie}from"./vendor-react-87iFmKFJ.js";import{s as M,D as _e,a1 as Se,i as U,c as De,d as Ce,e as ke,V as Me,W as Ve,X as Ee,Y as Le,B as P,S as Ae,C as S,n as D,F as C,p as k}from"./index-C3xfGQgV.js";import{f as Oe}from"./paginatedQuery-wslm7SSv.js";import{f as le,s as Te,D as R,H as Fe,p as ze,I as Ue,J as Re}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CQWbleDe.js";const Ie=a=>{if(!a)return"direct";try{return new URL(a).hostname.replace("www.","")}catch{return"unknown"}},Ke=(a=30)=>ae({queryKey:["analytics",a],queryFn:async()=>{let h=null;a===1?h=le(new Date).toISOString():a>1&&(h=le(Te(new Date,a-1)).toISOString());const u=await Oe("page_views","*",t=>(h&&(t=t.gte("created_at",h)),t.order("created_at",{ascending:!1}))),j=u.length,L=new Set(u.map(t=>t.visitor_id)).size,w={};u.forEach(t=>{w[t.page_type]=(w[t.page_type]||0)+1});const V=new Map;u.forEach(t=>{const n=R(new Date(t.created_at),"yyyy-MM-dd");V.has(n)||V.set(n,{views:0,visitors:new Set});const l=V.get(n);l.views++,l.visitors.add(t.visitor_id)});const o=Array.from(V.entries()).map(([t,n])=>({date:t,views:n.views,uniqueVisitors:n.visitors.size})).sort((t,n)=>t.date.localeCompare(n.date)),E=new Map;u.forEach(t=>{const n=Ie(t.referer);E.set(n,(E.get(n)||0)+1)});const T=Array.from(E.entries()).map(([t,n])=>({domain:t,count:n,percentage:j>0?n/j*100:0})).sort((t,n)=>n.count-t.count),A=new Map;u.forEach(t=>{const n=t.country||"unknown";A.set(n,(A.get(n)||0)+1)});const q=Array.from(A.entries()).map(([t,n])=>({location:t,count:n,percentage:j>0?n/j*100:0})).sort((t,n)=>n.count-t.count),F=new Map;u.forEach(t=>{const n=t.city||"unknown";F.set(n,(F.get(n)||0)+1)});const I=Array.from(F.entries()).map(([t,n])=>({location:t,count:n,percentage:j>0?n/j*100:0})).sort((t,n)=>n.count-t.count),b=new Map;u.forEach(t=>{const n=R(new Date(t.created_at),"yyyy-MM-dd"),l=t.country||"unknown";b.has(l)||b.set(l,new Map);const f=b.get(l);f.set(n,(f.get(n)||0)+1)});const z=[];b.forEach((t,n)=>{t.forEach((l,f)=>{z.push({date:f,location:n,views:l})})}),z.sort((t,n)=>t.date.localeCompare(n.date));const c=new Map;u.forEach(t=>{const n=R(new Date(t.created_at),"yyyy-MM-dd"),l=t.city||"unknown";c.has(l)||c.set(l,new Map);const f=c.get(l);f.set(n,(f.get(n)||0)+1)});const O=[];c.forEach((t,n)=>{t.forEach((l,f)=>{O.push({date:f,location:n,views:l})})}),O.sort((t,n)=>t.date.localeCompare(n.date));const x=new Map;u.filter(t=>t.page_type==="restaurant"&&t.target_id).forEach(t=>{x.set(t.target_id,(x.get(t.target_id)||0)+1)});const i=Array.from(x.entries()).sort((t,n)=>n[1]-t[1]).slice(0,10);let d=[];if(i.length>0){const{data:t}=await M.from("restaurants").select("id, name").in("id",i.map(n=>n[0]));d=i.map(([n,l])=>({id:n,name:t?.find(f=>f.id===n)?.name||"Unknown",views:l}))}const m=new Map;u.filter(t=>t.page_type==="activity"&&t.target_id).forEach(t=>{m.set(t.target_id,(m.get(t.target_id)||0)+1)});const p=Array.from(m.entries()).sort((t,n)=>n[1]-t[1]).slice(0,10);let N=[];if(p.length>0){const{data:t}=await M.from("activities").select("id, title_zh, title_en, title_pt").in("id",p.map(n=>n[0]));N=p.map(([n,l])=>{const f=t?.find(y=>y.id===n);return{id:n,title:f?.title_zh||f?.title_en||"Unknown",views:l}})}return{totalViews:j,uniqueVisitors:L,viewsByPage:w,dailyViews:o,topRestaurants:d,topActivities:N,refererStats:T,countryStats:q,cityStats:I,countryDailyViews:z,cityDailyViews:O}}}),me=()=>{const[a,h]=g.useState(new Set),[u,j]=g.useState(new Set),[_,L]=g.useState([]),[w,V]=g.useState(null),[o,E]=g.useState(null);g.useEffect(()=>{console.log("Initializing online users observer...");const x=M.channel("online-users");return x.on("presence",{event:"sync"},()=>{const i=x.presenceState(),d=new Set;Object.keys(i).forEach(m=>{d.add(m)}),h(d),console.log("Presence sync - online users:",Array.from(d))}).on("presence",{event:"join"},({key:i,newPresences:d})=>{console.log("User joined:",i,d),h(m=>new Set([...m,i]))}).on("presence",{event:"leave"},({key:i,leftPresences:d})=>{console.log("User left:",i,d),h(m=>{const p=new Set(m);return p.delete(i),p})}).subscribe(i=>{console.log("Presence channel status:",i)}),V(x),()=>{console.log("Cleaning up online users observer..."),M.removeChannel(x)}},[]),g.useEffect(()=>{console.log("Initializing online visitors observer...");const x=M.channel("online-visitors");return x.on("presence",{event:"sync"},()=>{const i=x.presenceState(),d=new Set,m=[];Object.entries(i).forEach(([p,N])=>{if(d.add(p),N&&N.length>0){const t=N[0];m.push({visitor_id:p,online_at:t.online_at,country:t.country,city:t.city})}}),j(d),L(m),console.log("Visitor presence sync - online visitors:",Array.from(d))}).on("presence",{event:"join"},({key:i,newPresences:d})=>{if(console.log("Visitor joined:",i,d),j(m=>new Set([...m,i])),d&&d.length>0){const m=d[0];L(p=>[...p.filter(N=>N.visitor_id!==i),{visitor_id:i,online_at:m.online_at,country:m.country,city:m.city}])}}).on("presence",{event:"leave"},({key:i,leftPresences:d})=>{console.log("Visitor left:",i,d),j(m=>{const p=new Set(m);return p.delete(i),p}),L(m=>m.filter(p=>p.visitor_id!==i))}).subscribe(i=>{console.log("Visitor presence channel status:",i)}),E(x),()=>{console.log("Cleaning up online visitors observer..."),M.removeChannel(x)}},[]);const{data:T,isLoading:A,refetch:q}=ae({queryKey:["online-users-details",Array.from(a).sort().join(",")],queryFn:async()=>{if(a.size===0)return[];const x=Array.from(a);console.log("Fetching details for online users:",x);const{data:i,error:d}=await M.from("user_presence").select("*").in("user_id",x);d&&console.error("Error fetching presence:",d);const{data:m,error:p}=await M.rpc("get_public_profiles",{user_ids:x});p&&console.error("Error fetching profiles:",p);const{data:N,error:t}=await M.from("user_roles").select("user_id, role").in("user_id",x);t&&console.error("Error fetching roles:",t);const n=new Map((i||[]).map(y=>[y.user_id,y])),l=new Map((m||[]).map(y=>[y.id,y])),f=new Map((N||[]).map(y=>[y.user_id,y.role]));return x.map(y=>{const H=n.get(y),J=l.get(y);return{user_id:y,is_online:!0,last_seen:H?.last_seen||new Date().toISOString(),ip_address:H?.ip_address,city:H?.city,country:H?.country,profile:J?{display_name:J.display_name,avatar_url:J.avatar_url}:void 0,role:f.get(y)}})},enabled:a.size>0,staleTime:1e4}),{data:F,refetch:I}=ae({queryKey:["online-users-db-fallback"],queryFn:async()=>{const x=new Date(Date.now()-12e4).toISOString(),{data:i,error:d}=await M.from("user_presence").select("*").gte("last_seen",x).order("last_seen",{ascending:!1});if(d)return console.error("Error fetching DB presence:",d),[];if(!i||i.length===0)return[];const m=i.map(l=>l.user_id),{data:p}=await M.rpc("get_public_profiles",{user_ids:m}),{data:N}=await M.from("user_roles").select("user_id, role").in("user_id",m),t=new Map((p||[]).map(l=>[l.id,l])),n=new Map((N||[]).map(l=>[l.user_id,l.role]));return i.map(l=>({user_id:l.user_id,is_online:l.is_online,last_seen:l.last_seen,ip_address:l.ip_address,city:l.city,country:l.country,profile:t.get(l.user_id)?{display_name:t.get(l.user_id).display_name,avatar_url:t.get(l.user_id).avatar_url}:void 0,role:n.get(l.user_id)}))},refetchInterval:3e4}),b=(()=>{const x=new Map;return(F||[]).forEach(i=>{x.set(i.user_id,i)}),(T||[]).forEach(i=>{x.set(i.user_id,{...i,is_online:!0})}),a.forEach(i=>{x.has(i)||x.set(i,{user_id:i,is_online:!0,last_seen:new Date().toISOString()})}),Array.from(x.values())})(),z=b.length,c=u.size;return{onlineUsers:b,onlineCount:z,onlineVisitors:_,visitorCount:c,isLoading:A,refetch:async()=>{await Promise.all([q(),I()])}}},qe=({trigger:a})=>{const{t:h,i18n:u}=oe(),[j,_]=g.useState(!1),[L,w]=g.useState(!1),{onlineUsers:V,onlineCount:o,isLoading:E,refetch:T}=me(),A=g.useCallback(async()=>{w(!0);try{await T(),he.success(h("common.refreshed","已刷新"))}finally{w(!1)}},[T,h]),q=()=>{switch(u.language){case"zh":return Re;case"pt":return Ue;default:return ze}},F=c=>{switch(c){case"admin":return"destructive";case"supervisor":return"default";case"merchant":return"secondary";default:return"outline"}},I=c=>{switch(c){case"admin":return h("admin.role.admin","管理员");case"supervisor":return h("admin.role.supervisor","主管");case"merchant":return h("admin.role.merchant","商家");default:return h("admin.role.user","用户")}},b=(c,O)=>c&&O?`${c}, ${O}`:c||O||null,z=c=>c.city||c.country||c.ip_address;return e.jsxs(_e,{open:j,onOpenChange:_,children:[e.jsx(Se,{asChild:!0,children:a||e.jsxs(U,{variant:"outline",size:"sm",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),h("admin.onlineUsers.viewOnline","查看在线用户")]})}),e.jsxs(De,{className:"max-w-md",children:[e.jsx(Ce,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-3 h-3 fill-green-500 text-green-500"}),h("admin.onlineUsers.title","在线用户")," (",o,")"]})}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(U,{variant:"ghost",size:"sm",onClick:A,disabled:E||L,children:[e.jsx(de,{className:`w-4 h-4 mr-1 ${E||L?"animate-spin":""}`}),h("common.refresh","刷新")]})}),e.jsx(Me,{className:"h-[400px] pr-4",children:E?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:h("common.loading","加载中...")}):V.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:h("admin.onlineUsers.noOnline","暂无在线用户")}):e.jsx("div",{className:"space-y-3",children:V.map(c=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Ve,{className:"h-10 w-10",children:[e.jsx(Ee,{src:c.profile?.avatar_url||void 0}),e.jsx(Le,{children:c.profile?.display_name?.charAt(0)||"?"})]}),e.jsx(re,{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 ${c.is_online?"fill-green-500 text-green-500":"fill-yellow-500 text-yellow-500"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:c.profile?.display_name||h("common.anonymous","匿名用户")}),e.jsx(P,{variant:F(c.role),className:"text-xs",children:I(c.role)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c.is_online?h("admin.onlineUsers.online","在线中"):h("admin.onlineUsers.lastSeen","最后活跃 {{time}}",{time:Fe(new Date(c.last_seen),{addSuffix:!0,locale:q()})})}),z(c)&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:[b(c.city,c.country)&&e.jsx("span",{children:b(c.city,c.country)}),c.ip_address&&e.jsxs(e.Fragment,{children:[b(c.city,c.country)&&e.jsx("span",{className:"mx-1",children:"·"}),e.jsx("span",{className:"font-mono text-[10px]",children:c.ip_address})]})]})]})]})]},c.user_id))})})]})]})},ce=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(var(--muted-foreground))"],K=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],Je=()=>{const{t:a,i18n:h}=oe(),[u,j]=g.useState(30),[_,L]=g.useState([]),[w,V]=g.useState([]),{data:o,isLoading:E,refetch:T,isRefetching:A}=Ke(u),{onlineCount:q,visitorCount:F,isLoading:I}=me(),b=ue(),z=g.useCallback(()=>{b.removeQueries({queryKey:["analytics"]}),T()},[b,T]),c={home:a("analytics.pageTypes.home","首页"),restaurant:a("analytics.pageTypes.restaurant","餐厅详情"),activity:a("analytics.pageTypes.activity","活动详情"),restaurants:a("analytics.pageTypes.restaurants","餐厅列表"),activities:a("analytics.pageTypes.activities","活动列表"),map:a("analytics.pageTypes.map","地图"),profile:a("analytics.pageTypes.profile","个人资料"),auth:a("analytics.pageTypes.auth","登录/注册"),"join-us":a("analytics.pageTypes.joinUs","加入我们"),other:a("analytics.pageTypes.other","其他")},O={direct:a("analytics.referer.direct","直接访问"),unknown:a("analytics.referer.unknown","未知来源")},x={unknown:a("analytics.location.unknown","未知地区")},i=s=>O[s]||s,d=s=>x[s]||s,m=g.useMemo(()=>o?.countryStats?.slice(0,10).map(s=>s.location)||[],[o?.countryStats]),p=g.useMemo(()=>o?.cityStats?.slice(0,10).map(s=>s.location)||[],[o?.cityStats]),N=g.useMemo(()=>{if(!o?.countryDailyViews||_.length===0)return[];const s=new Map;return o.countryDailyViews.filter(r=>_.includes(r.location)).forEach(r=>{s.has(r.date)||s.set(r.date,{}),s.get(r.date)[r.location]=r.views}),Array.from(s.entries()).map(([r,v])=>({date:r,...v})).sort((r,v)=>r.date.localeCompare(v.date))},[o?.countryDailyViews,_]),t=g.useMemo(()=>{if(!o?.cityDailyViews||w.length===0)return[];const s=new Map;return o.cityDailyViews.filter(r=>w.includes(r.location)).forEach(r=>{s.has(r.date)||s.set(r.date,{}),s.get(r.date)[r.location]=r.views}),Array.from(s.entries()).map(([r,v])=>({date:r,...v})).sort((r,v)=>r.date.localeCompare(v.date))},[o?.cityDailyViews,w]),n=o?.viewsByPage?Object.entries(o.viewsByPage).map(([s,r])=>({name:c[s]||s,value:r})):[],l=o?.refererStats?.slice(0,10).map(s=>({name:i(s.domain),value:s.count,percentage:s.percentage.toFixed(1)}))||[],f=o?.countryStats?.slice(0,10).map(s=>({name:d(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],y=o?.cityStats?.slice(0,10).map(s=>({name:d(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],H=s=>{L(r=>r.includes(s)?r.filter(v=>v!==s):r.length<5?[...r,s]:r)},J=s=>{V(r=>r.includes(s)?r.filter(v=>v!==s):r.length<5?[...r,s]:r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:a("analytics.title","访问统计")}),e.jsx("p",{className:"text-muted-foreground",children:a("analytics.description","网站访问数据分析")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(U,{variant:u===1?"default":"outline",size:"sm",onClick:()=>j(1),children:a("analytics.today","今日")}),[7,30,90].map(s=>e.jsxs(U,{variant:u===s?"default":"outline",size:"sm",onClick:()=>j(s),children:[s,a("analytics.days","天")]},s)),e.jsx(U,{variant:u===0?"default":"outline",size:"sm",onClick:()=>j(0),children:a("analytics.all","所有")})]}),e.jsxs(U,{variant:"outline",size:"sm",onClick:z,disabled:A,children:[e.jsx(de,{className:`w-4 h-4 mr-1 ${A?"animate-spin":""}`}),a("common.refresh","刷新")]})]})]}),E?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((s,r)=>e.jsx(Ae,{className:"h-32"},r))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(S,{className:"border-green-500/50 bg-green-500/5",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(C,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(re,{className:"h-3 w-3 fill-green-500 text-green-500"}),a("analytics.onlineUsers","在线用户")]}),e.jsx(ne,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:I?"-":q}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx("span",{className:"text-sm",children:"+"}),e.jsx("span",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400",children:I?"-":F}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("analytics.visitors","访客")})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(qe,{trigger:e.jsxs(U,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-green-600 dark:text-green-400 hover:text-green-700",children:[a("analytics.viewOnlineUsers","查看在线用户")," →"]})})})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.totalViews","总访问量")}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?.totalViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u===0?a("analytics.allTime","所有时间"):u===1?a("analytics.today","今日"):a("analytics.lastNDays","最近{{days}}天",{days:u})})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.uniqueVisitors","独立访客")}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?.uniqueVisitors.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.uniqueVisitorDesc","基于访客ID")})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.restaurantViews","餐厅浏览")}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(o?.viewsByPage?.restaurant||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.restaurantViewsDesc","餐厅详情页访问")})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.activityViews","活动浏览")}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(o?.viewsByPage?.activity||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.activityViewsDesc","活动详情页访问")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),a("analytics.dailyTrend","每日访问趋势")]})}),e.jsx(k,{children:e.jsx("div",{className:"h-[300px]",children:o?.dailyViews&&o.dailyViews.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(Z,{data:o.dailyViews,children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{dataKey:"date",tickFormatter:s=>R(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(Q,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>R(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(X,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:2,name:a("analytics.views","访问量")}),e.jsx(X,{type:"monotone",dataKey:"uniqueVisitors",stroke:"hsl(var(--chart-2))",strokeWidth:2,name:a("analytics.uniqueVisitors","独立访客")})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})})})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),a("analytics.pageDistribution","页面访问分布")]})}),e.jsx(k,{children:e.jsx("div",{className:"h-[300px]",children:n.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(ve,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:n.map((s,r)=>e.jsx(we,{fill:ce[r%ce.length]},`cell-${r}`))}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})})})]})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),a("analytics.refererStats","访问来源统计")]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-[300px]",children:l.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(se,{data:l,layout:"vertical",children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{type:"number",className:"text-xs"}),e.jsx(Q,{dataKey:"name",type:"category",width:120,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,r,v)=>[`${s} (${v.payload.percentage}%)`,a("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(te,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:o?.refererStats&&o.refererStats.length>0?o.refererStats.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:r<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:r+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[150px]",children:i(s.domain)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(P,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.domain)):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:a("analytics.noData","暂无数据")})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),a("analytics.countryStats","国家/地区统计")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:f.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(se,{data:f,layout:"vertical",children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{type:"number",className:"text-xs"}),e.jsx(Q,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,r,v)=>[`${s} (${v.payload.percentage}%)`,a("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(te,{dataKey:"value",fill:"hsl(var(--chart-2))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:o?.countryStats&&o.countryStats.length>0?o.countryStats.slice(0,10).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:r<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:r+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:d(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(P,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:a("analytics.noData","暂无数据")})})]})})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),a("analytics.cityStats","城市统计")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:y.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(se,{data:y,layout:"vertical",children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{type:"number",className:"text-xs"}),e.jsx(Q,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,r,v)=>[`${s} (${v.payload.percentage}%)`,a("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(te,{dataKey:"value",fill:"hsl(var(--chart-3))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:o?.cityStats&&o.cityStats.length>0?o.cityStats.slice(0,10).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:r<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:r+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:d(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(P,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:a("analytics.noData","暂无数据")})})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),a("analytics.countryTrend","国家/地区访问趋势")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((s,r)=>e.jsx(U,{variant:_.includes(s)?"default":"outline",size:"sm",onClick:()=>H(s),className:"text-xs",style:_.includes(s)?{backgroundColor:K[_.indexOf(s)%K.length]}:{},children:d(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:N.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(Z,{data:N,children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{dataKey:"date",tickFormatter:s=>R(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(Q,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>R(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ie,{}),_.map((s,r)=>e.jsx(X,{type:"monotone",dataKey:s,stroke:K[r%K.length],strokeWidth:2,name:d(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:_.length===0?a("analytics.selectLocations","请选择地区查看趋势"):a("analytics.noData","暂无数据")})})]})})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),a("analytics.cityTrend","城市访问趋势")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((s,r)=>e.jsx(U,{variant:w.includes(s)?"default":"outline",size:"sm",onClick:()=>J(s),className:"text-xs",style:w.includes(s)?{backgroundColor:K[w.indexOf(s)%K.length]}:{},children:d(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:t.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(Z,{data:t,children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{dataKey:"date",tickFormatter:s=>R(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(Q,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>R(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ie,{}),w.map((s,r)=>e.jsx(X,{type:"monotone",dataKey:s,stroke:K[r%K.length],strokeWidth:2,name:d(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:w.length===0?a("analytics.selectLocations","请选择地区查看趋势"):a("analytics.noData","暂无数据")})})]})})]})]})]})]})};export{Je as default};
//# sourceMappingURL=AdminAnalytics-i8yDGbNT.js.map
