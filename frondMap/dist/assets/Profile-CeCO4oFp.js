const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-Clrw0GhO.js","assets/vendor-misc-DH4LiFnZ.js","assets/vendor-react-core-BErlw7p5.js","assets/vendor-editor-BdQcs4B3.js","assets/vendor-editor-DZrYvFpI.css","assets/vendor-date-fYlqblcl.js","assets/vendor-misc-OEN34m2J.css"])))=>i.map(i=>d[i]);
import{j as e,r as d}from"./vendor-react-core-BErlw7p5.js";import{u as oa,L as I}from"./vendor-router-CLK0c9aH.js";import{D as Ce,a as Se,b as ke,c as Ae,o as g,n as xe,s as y,r as zs,a3 as Ls,a4 as da,U as qs,B as _,Q as ds,N as ms,O as xs,P as hs,I as b,R as N,X as Ue,Y as ze,Z as Le,$ as qe,a0 as He,A as G,E as Q,F as J,G as Y,J as X,K as Z,L as ee,M as L,_ as ma,W as Hs,C as D,h as q,p as H,j as E,a2 as se,T as xa,a5 as ha,S as ua,q as pa}from"./index-CEqKPgls.js";import{u as re}from"./vendor-i18n-CqcxoxDo.js";import{H as _e,ah as fa,ai as ja,M as ga,aj as va,T as Ms,d as ve,ac as Ss,u as us,P as Na,W as ya,ak as wa,al as ba,am as _a,g as Me,an as Ca,ao as Oe,x as ys,e as ae,ap as ks,w as te,a2 as Bs,aq as Sa,ar as ka,U as As,n as be,as as Ps}from"./vendor-icons-C2Bicc1E.js";import{T as cs,a as os,b as U,c as z}from"./tabs-CCXSC-tz.js";import{C as Aa,a as Pa,b as Re}from"./carousel-D8CtjQKm.js";import{a as Pe}from"./vendor-query-BS0wY7WL.js";import{a as Da}from"./useActivities-DWu4GLeC.js";import{u as Be}from"./useLocalizedContent-DqTgPnyL.js";import{u as Ea}from"./useActivityParticipation-BhSi6qgs.js";import{d as $a}from"./useCoupons-B8t5J-Nz.js";import{ah as p,am as Fa}from"./vendor-misc-DH4LiFnZ.js";import{u as Ia,a as Ta,b as Oa,c as Ra,d as Ua,P as Ds}from"./PointsHistoryDialog-D7STXzqd.js";import{C as za}from"./checkbox-C7r0zTfD.js";import{A as Es}from"./ActivityTermsAgreement-BsYs3IIH.js";import{S as $s}from"./separator-CsrYbTbx.js";import{C as ie,F as Vs}from"./vendor-date-fYlqblcl.js";import"./vendor-editor-BdQcs4B3.js";import"./vendor-ui-other-CPTlx-W2.js";import"./vendor-supabase-Clrw0GhO.js";import"./vendor-ui-dialog-Sv_VEL0d.js";import"./vendor-ui-dropdown-DwTcg2UT.js";import"./usePoints-CqD4S3Lg.js";import"./useActivityRules-BqnCt-Ah.js";function La({open:s,onOpenChange:a,activity:l}){const{t}=re();return e.jsx(Ce,{open:s,onOpenChange:a,children:e.jsxs(Se,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(ke,{children:e.jsx(Ae,{className:"text-lg font-semibold line-clamp-2",children:l.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(g,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(_e,{className:"w-3.5 h-3.5 fill-primary text-primary"}),t("profile.activityFavorited")]}),l.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:l.image_url,alt:l.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:l.content}})]})]})})}const qa=()=>{const{user:s}=xe();return Pe({queryKey:["favorites",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:l}=await y.from("favorites").select("restaurant_id").eq("user_id",s.id);if(l)throw l;if(!a||a.length===0)return[];const t=a.map(o=>o.restaurant_id),{data:m,error:r}=await y.from("restaurants").select("*").in("id",t).eq("visible",!0);if(r)throw r;return m||[]},enabled:!!s})},Ha=()=>{const{user:s}=xe();return Pe({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:l}=await y.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(l)throw l;if(!a||a.length===0)return[];const t=a.filter(n=>n.target_type==="restaurant").map(n=>n.target_id),m=a.filter(n=>n.target_type==="activity").map(n=>n.target_id),r=new Map;if(t.length>0){const{data:n}=await y.from("restaurants").select("id, name, name_en, name_pt").in("id",t);n?.forEach(u=>{r.set(u.id,{name:u.name,name_en:u.name_en||void 0,name_pt:u.name_pt||void 0})})}const o=new Map;if(m.length>0){const{data:n}=await y.from("activities").select("id, title_zh, title_en, title_pt").in("id",m);n?.forEach(u=>{o.set(u.id,{title_zh:u.title_zh,title_en:u.title_en,title_pt:u.title_pt})})}return a.map(n=>{if(n.target_type==="restaurant"){const u=r.get(n.target_id);return{...n,target_name:u?.name||"Unknown Restaurant",target_name_en:u?.name_en,target_name_pt:u?.name_pt}}else if(n.target_type==="activity"){const u=o.get(n.target_id);return{...n,target_name:u?.title_zh||"Unknown Activity",target_name_en:u?.title_en,target_name_pt:u?.title_pt}}return n})},enabled:!!s,staleTime:3e4})},Ma=()=>{const{user:s}=xe(),{data:a=[]}=Ea();return Pe({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||a.length===0)return[];const l=a.map(c=>c.id),{data:t,error:m}=await y.from("activity_restaurants").select("*").in("restaurant_id",l).order("created_at",{ascending:!1});if(m)throw m;if(!t||t.length===0)return[];const{data:r}=await y.from("restaurants").select("id, name, name_en, name_pt, address").in("id",l),o=[...new Set(t.map(c=>c.activity_id))],{data:n}=await y.from("activities").select("*").in("id",o).eq("status","published");return t.map(c=>{const v=r?.find(S=>S.id===c.restaurant_id),C=n?.find(S=>S.id===c.activity_id);return{activity_id:c.activity_id,restaurant_id:c.restaurant_id,restaurant_name:v?.name||"",restaurant_name_en:v?.name_en||null,restaurant_name_pt:v?.name_pt||null,restaurant_address:v?.address||"",activity:C||null,created_at:c.created_at}}).filter(c=>c.activity!==null)},enabled:!!s&&a.length>0})},Ks=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Fs=s=>{if(!s)return{code:"+351",number:""};for(const a of Ks)if(s.startsWith(a.code))return{code:a.code,number:s.slice(a.code.length).trim()};return{code:"+351",number:s}},Is=({profile:s})=>{const{t:a}=re(),l=oa(),{user:t}=xe(),{isAdmin:m}=zs(),[r,o]=d.useState(!1),[n,u]=d.useState(s.display_name),c=Fs(s.phone),[v,C]=d.useState(c.code),[S,k]=d.useState(c.number),[M,A]=d.useState(!1),[B,he]=d.useState(null),[P,$]=d.useState(s.avatar_url||""),[T,V]=d.useState(!1),[O,ne]=d.useState(!1),[K,w]=d.useState(""),[Ne,ue]=d.useState(!1),pe=d.useRef(!1);d.useEffect(()=>{const i=pe.current;if(pe.current=r,r&&!i){u(s.display_name);const h=Fs(s.phone);C(h.code),k(h.number),$(s.avatar_url||""),he(null),A(!1)}},[r,s.display_name,s.phone,s.avatar_url]);const[De,ce]=d.useState(!1),[Ve,oe]=d.useState(!1),[x,f]=d.useState(!1),[j,F]=d.useState(""),[Ee,$e]=d.useState(""),[fe,Fe]=d.useState(""),[je,Ie]=d.useState(!1),[de,Te]=d.useState(!1),[ws,Ke]=d.useState(!1),[Ws,ye]=d.useState(!1),[Gs,we]=d.useState(!1),[We,Ge]=d.useState(""),[W,Qe]=d.useState(""),[me,Je]=d.useState(""),[bs,Ye]=d.useState(!1),[Xe,Ze]=d.useState(""),[ge,es]=d.useState(!1),[_s,Cs]=d.useState(!1),[R,ss]=d.useState(null),as=d.useRef(null),ts=d.useRef(null),rs=d.useRef(null),ls=Ls(),is=da();d.useEffect(()=>{je&&as.current&&as.current.focus()},[je]),d.useEffect(()=>{de&&ts.current&&ts.current.focus()},[de]),d.useEffect(()=>{ge&&rs.current&&rs.current.focus()},[ge]);const Qs=i=>{const h=i.target.files?.[0];if(h){if(h.size>2*1024*1024)return;he(h),$(URL.createObjectURL(h))}},Js=async()=>{let i=s.avatar_url;if(B){const le=await is.mutateAsync(B);le&&(i=le)}const h=S?`${v} ${S}`:void 0;await ls.mutateAsync({display_name:n,phone:h,avatar_url:i||void 0}),A(!1),o(!1)},Ys=async()=>{if(!(!t||K.toLowerCase()!=="delete")){ue(!0);try{const{error:i}=await y.functions.invoke("delete-account",{body:{userId:t.id}});if(i){p.error(a("profile.deleteAccountFailed")),console.error(i),ue(!1);return}p.success(a("profile.deleteAccountSuccess")),ne(!1),V(!1),w(""),await new Promise(h=>setTimeout(h,1500)),await y.auth.signOut(),l("/auth")}catch(i){p.error(i.message||a("profile.deleteAccountFailed")),ue(!1)}finally{ue(!1)}}},Xs=async()=>{if(t?.email)try{const{error:i}=await y.functions.invoke("send-verification-code",{body:{email:t.email}});if(i)throw i;Ie(!0),p.success(a("profile.codeSentToOldEmail"))}catch(i){p.error(a("profile.sendCodeFailed")),console.error(i)}},Zs=async()=>{if(!Ee){p.error(a("profile.enterCodePlaceholder"));return}try{const{data:i,error:h}=await y.functions.invoke("verify-email-code",{body:{email:t?.email,code:Ee}});if(h||!i?.success){p.error(a("profile.codeIncorrect"));return}p.success(a("profile.oldEmailVerified")),ce(!1),oe(!0)}catch(i){p.error(a("profile.verificationFailed")),console.error(i)}},ea=async()=>{if(!j||!j.includes("@")){p.error(a("profile.enterValidEmail"));return}try{const{error:i}=await y.functions.invoke("send-verification-code",{body:{email:j}});if(i)throw i;p.success(a("profile.codeSentToNewEmail")),Te(!0)}catch(i){p.error(a("profile.sendCodeFailed")),console.error(i)}},sa=async()=>{if(!fe){p.error(a("profile.enterCodePlaceholder"));return}try{const{data:i,error:h}=await y.functions.invoke("verify-email-code",{body:{email:j,code:fe}});if(h||!i?.success){p.error(a("profile.codeIncorrect"));return}p.success(a("profile.newEmailVerified")),oe(!1),setTimeout(()=>{f(!0)},100)}catch(i){p.error(a("toast.verificationFailed")),console.error(i)}},aa=async()=>{Ke(!0);try{const{data:{session:i}}=await y.auth.getSession();if(!i||!t){p.error(a("toast.pleaseSignIn")),Ke(!1);return}const{data:h,error:le}=await y.functions.invoke("update-email",{body:{userId:t.id,oldEmail:t.email,oldEmailCode:Ee,newEmail:j,newEmailCode:fe},headers:{Authorization:`Bearer ${i.access_token}`}});if(le||!h?.success)throw new Error(h?.error||"Failed to update email");p.success(a("toast.emailUpdatedSuccess")),f(!1),o(!1),$e(""),F(""),Fe(""),Ie(!1),Te(!1),await new Promise(ns=>setTimeout(ns,1500)),await y.auth.signOut(),l("/auth")}catch(i){p.error(i.message||a("toast.emailUpdateError")),console.error(i)}finally{Ke(!1)}},ta=i=>{let h=0;return i.length>=6&&h++,i.length>=8&&h++,/[a-z]/.test(i)&&h++,/[A-Z]/.test(i)&&h++,/[0-9]/.test(i)&&h++,/[^a-zA-Z0-9]/.test(i)&&h++,h<=2?"weak":h<=4?"medium":"strong"},ra=async i=>{if(i?.preventDefault(),i?.stopPropagation(),!We){p.error(a("profile.enterCurrentPassword"));return}try{const{createClient:h}=await ma(async()=>{const{createClient:ca}=await import("./vendor-supabase-Clrw0GhO.js");return{createClient:ca}},__vite__mapDeps([0,1,2,3,4,5,6])),le=h("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:ns}=await le.auth.signInWithPassword({email:t?.email||"",password:We});if(ns){p.error(a("profile.oldPasswordIncorrect"));return}p.success(a("profile.oldPasswordVerified")),ye(!1),we(!0)}catch(h){p.error(a("profile.verificationFailed")),console.error(h)}},la=async()=>{if(t?.email)try{const{error:i}=await y.functions.invoke("send-verification-code",{body:{email:t.email}});if(i)throw i;es(!0),p.success(a("profile.codeSentToOldEmail"))}catch(i){p.error(a("profile.sendCodeFailed")),console.error(i)}},ia=async i=>{if(i?.preventDefault(),i?.stopPropagation(),!Xe){p.error(a("profile.enterCodePlaceholder"));return}try{const{data:h,error:le}=await y.functions.invoke("verify-email-code",{body:{email:t?.email,code:Xe}});if(le||!h?.success){p.error(a("profile.codeIncorrect"));return}p.success(a("profile.oldEmailVerified")),ye(!1),we(!0)}catch(h){p.error(a("profile.verificationFailed")),console.error(h)}},na=async i=>{if(i?.preventDefault(),i?.stopPropagation(),!W||!me){p.error(a("profile.enterNewPassword"));return}if(W.length<6){p.error(a("profile.passwordTooShort"));return}if(W!==me){p.error(a("profile.passwordsDontMatch"));return}Cs(!0);try{const{error:h}=await y.auth.updateUser({password:W});if(h)throw h;p.success(a("profile.passwordUpdated")),we(!1),o(!1),Ge(""),Qe(""),Je(""),Ye(!1),Ze(""),es(!1)}catch(h){p.error(h.message||a("profile.passwordUpdateFailed")),console.error(h)}finally{Cs(!1)}};return e.jsxs(Ce,{open:r,onOpenChange:o,children:[e.jsx(qs,{asChild:!0,children:e.jsxs(_,{variant:"outline",children:[e.jsx(fa,{className:"w-4 h-4 mr-2"}),a("profile.editProfile")]})}),e.jsxs(Se,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:a("profile.editProfile")}),e.jsx(ds,{children:a("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(ms,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(xs,{src:P}),e.jsx(hs,{children:n?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(b,{type:"file",accept:"image/*",onChange:Qs,className:"hidden",id:"avatar-upload"}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx(ja,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(N,{htmlFor:"displayName",className:"text-sm",children:a("profile.displayName")}),e.jsx(b,{id:"displayName",value:n,onChange:i=>u(i.target.value),placeholder:a("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(N,{htmlFor:"phone",className:"text-sm",children:a("profile.phone")}),!s.phone&&!M?e.jsx(_,{variant:"outline",size:"sm",onClick:()=>A(!0),className:"w-full justify-start h-9",children:a("profile.addPhoneNumber")}):M||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ue,{value:v,onValueChange:C,children:[e.jsx(ze,{className:"w-[110px] h-9",children:e.jsx(Le,{placeholder:"+351"})}),e.jsx(qe,{children:Ks.map(i=>e.jsx(He,{value:i.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:i.flag}),e.jsx("span",{children:i.code})]})},i.code))})]}),e.jsx(b,{id:"phone",className:"flex-1 h-9",value:S,onChange:i=>k(i.target.value),placeholder:a("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:`${v} ${S}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>A(!0),className:"text-xs whitespace-nowrap",children:a("profile.modifyPhoneNumber")})]})]}),!m&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(N,{className:"text-sm",children:a("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{value:t?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>ce(!0),className:"text-xs",children:[e.jsx(ga,{className:"w-3 h-3 mr-1"}),a("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${m?"pt-2 border-t":""}`,children:[e.jsx(N,{className:"text-sm",children:a("profile.changePassword")}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>ye(!0),className:"w-full justify-start h-9",children:[e.jsx(va,{className:"w-3 h-3 mr-2"}),a("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!m&&e.jsxs(_,{variant:"destructive",size:"sm",onClick:()=>V(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(Ms,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${m?"sm:ml-auto":""}`,children:[e.jsx(_,{variant:"outline",size:"sm",onClick:()=>{A(!1),o(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:a("common.cancel")}),e.jsx(_,{size:"sm",onClick:Js,disabled:ls.isPending||is.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:ls.isPending||is.isPending?a("common.loading"):a("common.save")})]})]})]}),e.jsx(G,{open:T,onOpenChange:V,children:e.jsxs(Q,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:a("profile.deleteAccountWarning")}),e.jsx(X,{children:a("profile.deleteAccountDescription")})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:a("common.cancel")}),e.jsx(L,{onClick:()=>{V(!1),ne(!0)},className:"bg-destructive hover:bg-destructive/90",children:a("common.continue")})]})]})}),e.jsx(G,{open:O,onOpenChange:ne,children:e.jsxs(Q,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:a("profile.confirmDeleteAccount")}),e.jsxs(X,{className:"space-y-4",children:[e.jsx("p",{children:a("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"confirm-delete",children:a("profile.typeDeleteToConfirm")}),e.jsx(b,{id:"confirm-delete",value:K,onChange:i=>w(i.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:()=>w(""),children:a("common.cancel")}),e.jsx(L,{onClick:Ys,disabled:K.toLowerCase()!=="delete"||Ne,className:"bg-destructive hover:bg-destructive/90",children:a(Ne?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(G,{open:De,onOpenChange:ce,children:e.jsxs(Q,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(J,{children:[e.jsx(Y,{children:a("profile.verifyOldEmail")}),e.jsx(X,{children:a("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(_,{variant:"outline",size:"sm",onClick:Xs,disabled:je,children:a(je?"profile.codeSent":"profile.sendCode")})]})]}),je&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:a("profile.verificationCode")}),e.jsx(b,{ref:as,value:Ee,onChange:i=>$e(i.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:()=>{ce(!1),setTimeout(()=>{$e(""),Ie(!1)},300)},children:a("common.cancel")}),je&&e.jsx(L,{onClick:Zs,children:a("profile.verify")})]})]})}),e.jsx(G,{open:Ve,onOpenChange:oe,children:e.jsxs(Q,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(J,{className:"text-center space-y-3",children:[e.jsx(Y,{className:"text-xl",children:a("profile.verifyNewEmail")}),e.jsx(X,{className:"text-center",children:a("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-sm font-normal",children:a("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{type:"email",value:j,onChange:i=>F(i.target.value),placeholder:a("profile.enterNewEmail"),disabled:de,className:"border-2 focus:border-primary flex-1"}),e.jsx(_,{variant:"outline",size:"sm",onClick:ea,disabled:!j||de,className:"text-xs whitespace-nowrap px-3",children:a(de?"profile.codeSent":"profile.sendCode")})]})]}),de&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(N,{className:"text-sm font-normal",children:a("profile.verificationCode")}),e.jsx(b,{ref:ts,value:fe,onChange:i=>Fe(i.target.value),placeholder:a("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(Z,{className:"flex-col sm:flex-col gap-2",children:[de&&e.jsx(L,{onClick:sa,disabled:!fe||fe.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(ee,{onClick:()=>{oe(!1),setTimeout(()=>{F(""),Fe(""),Te(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(G,{open:x,onOpenChange:f,children:e.jsxs(Q,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(J,{children:[e.jsx(Y,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(X,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:j})]})]})]}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:()=>{f(!1),setTimeout(()=>{$e(""),F(""),Fe(""),Ie(!1),Te(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(L,{onClick:aa,disabled:ws,children:ws?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(G,{open:Ws,onOpenChange:ye,children:e.jsxs(Q,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(J,{children:[e.jsx(Y,{children:a("profile.verifyOldPassword")}),e.jsx(X,{children:a("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:bs?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(_,{variant:"outline",size:"sm",onClick:la,disabled:ge,children:a(ge?"profile.codeSent":"profile.sendCode")})]})]}),ge&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:a("profile.verificationCode")}),e.jsx(b,{ref:rs,value:Xe,onChange:i=>Ze(i.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:a("profile.currentPassword")}),e.jsx(b,{type:"password",value:We,onChange:i=>Ge(i.target.value),placeholder:a("profile.enterCurrentPassword")})]}),e.jsxs(_,{variant:"link",size:"sm",onClick:()=>Ye(!0),className:"text-xs p-0 h-auto",children:[a("profile.forgotPassword")," ",a("profile.useEmailVerification")]})]})}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:()=>{ye(!1),setTimeout(()=>{Ge(""),Ye(!1),Ze(""),es(!1)},300)},children:a("common.cancel")}),bs?ge&&e.jsx(L,{onClick:ia,children:a("profile.verify")}):e.jsx(L,{onClick:ra,children:a("profile.verify")})]})]})}),e.jsx(G,{open:Gs,onOpenChange:we,children:e.jsxs(Q,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(J,{children:[e.jsx(Y,{children:a("profile.setNewPassword")}),e.jsx(X,{children:a("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:a("profile.newPassword")}),e.jsx(b,{type:"password",value:W,onChange:i=>{Qe(i.target.value),i.target.value?ss(ta(i.target.value)):ss(null)},placeholder:a("profile.enterNewPassword")}),R&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${R==="weak"?"bg-destructive":R==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${R==="medium"||R==="strong"?R==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${R==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${R==="weak"?"text-destructive":R==="medium"?"text-warning":"text-success"}`,children:a(`auth.passwordStrength.${R}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:a("profile.confirmNewPassword")}),e.jsx(b,{type:"password",value:me,onChange:i=>Je(i.target.value),placeholder:a("profile.confirmNewPasswordPlaceholder")})]}),W&&me&&W!==me&&e.jsx("p",{className:"text-sm text-destructive",children:a("profile.passwordsDontMatch")})]}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:()=>{we(!1),setTimeout(()=>{Qe(""),Je(""),ss(null)},300)},children:a("common.cancel")}),e.jsx(L,{onClick:na,disabled:!W||!me||W!==me||_s,children:a(_s?"common.loading":"profile.updatePassword")})]})]})})]})},ps=[{value:"Home",icon:wa,labelKey:"address.labelHome"},{value:"Work",icon:ba,labelKey:"address.labelWork"},{value:"Office",icon:_a,labelKey:"address.labelOffice"},{value:"Other",icon:ve,labelKey:"address.labelOther"}],Ba=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Va=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],Ts=({initialData:s,onSubmit:a,onCancel:l,isLoading:t,isEdit:m})=>{const{t:r}=re(),[o,n]=d.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),u=c=>{c.preventDefault(),a(o)};return e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"label",children:r("address.label")}),e.jsxs(Ue,{value:o.label,onValueChange:c=>n({...o,label:c}),children:[e.jsx(ze,{children:e.jsx(Le,{placeholder:r("address.selectLabel")})}),e.jsx(qe,{children:ps.map(c=>e.jsx(He,{value:c.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c.icon,{className:"w-4 h-4"}),r(c.labelKey)]})},c.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"street",children:[r("address.street")," *"]}),e.jsx(b,{id:"street",value:o.street,onChange:c=>n({...o,street:c.target.value}),placeholder:r("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"district",children:r("address.district")}),e.jsx(b,{id:"district",value:o.district,onChange:c=>n({...o,district:c.target.value}),placeholder:r("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"city",children:[r("address.city")," *"]}),e.jsx(b,{id:"city",value:o.city,onChange:c=>n({...o,city:c.target.value}),placeholder:r("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"postal_code",children:[r("address.postalCode")," *"]}),e.jsx(b,{id:"postal_code",value:o.postal_code,onChange:c=>n({...o,postal_code:c.target.value}),placeholder:r("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"country",children:[r("address.country")," *"]}),e.jsxs(Ue,{value:o.country,onValueChange:c=>n({...o,country:c}),children:[e.jsx(ze,{children:e.jsx(Le,{placeholder:r("address.selectCountry")})}),e.jsx(qe,{children:Va.map(c=>e.jsx(He,{value:c,children:c},c))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"phone",children:[r("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ue,{value:o.phone_code,onValueChange:c=>n({...o,phone_code:c}),children:[e.jsx(ze,{className:"w-[130px]",children:e.jsx(Le,{placeholder:"+351"})}),e.jsx(qe,{children:Ba.map(c=>e.jsx(He,{value:c.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.flag}),e.jsx("span",{children:c.code})]})},c.code))})]}),e.jsx(b,{id:"phone",className:"flex-1",value:o.phone,onChange:c=>n({...o,phone:c.target.value}),placeholder:r("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(za,{id:"is_default",checked:o.is_default,onCheckedChange:c=>n({...o,is_default:c})}),e.jsx(N,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:r("address.setAsDefault")})]}),e.jsxs(xa,{className:"gap-2 sm:gap-0",children:[e.jsx(_,{type:"button",variant:"outline",onClick:l,children:r("common.cancel")}),e.jsx(_,{type:"submit",disabled:t,children:r(t?"common.saving":m?"common.save":"address.add")})]})]})},Ka=({address:s,onEdit:a,onDelete:l,onSetDefault:t,isDeleting:m,isSettingDefault:r,canDelete:o=!0})=>{const{t:n}=re(),u=ps.find(v=>v.value===s.label)||ps[3],c=u.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(c,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:n(u.labelKey)}),s.is_default&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:[e.jsx(us,{className:"w-3 h-3 mr-1 fill-current"}),n("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Na,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>t(s.id),disabled:r,title:n("address.setAsDefault"),children:e.jsx(us,{className:"w-4 h-4"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>a(s),title:n("common.edit"),children:e.jsx(ya,{className:"w-4 h-4"})}),o&&e.jsxs(G,{children:[e.jsx(ha,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:n("common.delete"),children:e.jsx(Ms,{className:"w-4 h-4"})})}),e.jsxs(Q,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:n("address.deleteTitle")}),e.jsx(X,{children:n("address.deleteDescription")})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:n("common.cancel")}),e.jsx(L,{onClick:()=>l(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:m,children:n(m?"common.deleting":"common.delete")})]})]})]})]})]})})},Os=()=>{const{t:s}=re(),{data:a,isLoading:l}=Ia(),{data:t}=Hs(),m=Ta(),r=Oa(),o=Ls(),n=Ra(),u=Ua(),[c,v]=d.useState(!1),[C,S]=d.useState(null),[k,M]=d.useState(null),[A,B]=d.useState(!1),he=!t?.phone,P=w=>{if(he&&w.phone){M(w),B(!0);return}m.mutate(w,{onSuccess:()=>v(!1)})},$=()=>{if(!k)return;const w=`${k.phone_code||"+351"} ${k.phone}`;o.mutate({phone:w}),m.mutate(k,{onSuccess:()=>{v(!1),M(null),B(!1)}})},T=()=>{M(null),B(!1)},V=w=>{C&&r.mutate({id:C.id,address:w},{onSuccess:()=>S(null)})},O=w=>{n.mutate(w)},ne=w=>{u.mutate(w)};if(l)return e.jsxs(D,{children:[e.jsx(q,{children:e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx(E,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const K=a&&a.length>0;return e.jsxs(D,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(se,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),K&&e.jsxs(Ce,{open:c,onOpenChange:v,children:[e.jsx(qs,{asChild:!0,children:e.jsxs(_,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(Se,{className:"sm:max-w-[500px]",children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:s("address.addNew")}),e.jsx(ds,{children:s("address.addDescription")})]}),e.jsx(Ts,{onSubmit:P,onCancel:()=>v(!1),isLoading:m.isPending})]})]})]})}),e.jsx(E,{children:K?e.jsx("div",{className:"space-y-4",children:a.map(w=>e.jsx(Ka,{address:w,onEdit:S,onDelete:O,onSetDefault:ne,isDeleting:n.isPending,isSettingDefault:u.isPending,canDelete:a.length>1},w.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(_,{onClick:()=>v(!0),children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(Ce,{open:!!C,onOpenChange:()=>S(null),children:e.jsxs(Se,{className:"sm:max-w-[500px]",children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:s("address.editAddress")}),e.jsx(ds,{children:s("address.editDescription")})]}),C&&e.jsx(Ts,{initialData:C,onSubmit:V,onCancel:()=>S(null),isLoading:r.isPending,isEdit:!0})]})}),e.jsx(G,{open:A,onOpenChange:B,children:e.jsxs(Q,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:s("address.phoneConfirmTitle")}),e.jsx(X,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:T,children:s("common.cancel")}),e.jsx(L,{onClick:$,disabled:m.isPending||o.isPending,children:m.isPending||o.isPending?s("common.saving"):s("common.confirm")})]})]})})]})},Wa=({open:s,onOpenChange:a,coupon:l})=>{const{t}=re(),{getLocalizedField:m}=Be(),[r,o]=d.useState(!1),n=l.coupon_codes?.coupon_templates,u=l.coupon_codes?.code,c=!!l.used_at;return e.jsx(Ce,{open:s,onOpenChange:v=>{a(v),v||o(!1)},children:e.jsxs(Se,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(ke,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-primary"}),t("profile.coupons.details")]})}),e.jsx(ua,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:m(n,"title")}),e.jsx(g,{variant:c?"secondary":"default",children:t(c?"profile.coupons.used":"profile.coupons.available")})]}),n?.description_zh||n?.description_en||n?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:m(n,"description")}):null]}),e.jsx($s,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>o(!r),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(Fa,{value:u||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:u}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ca,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:t("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Oe,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:n?.discount_type==="percentage"?`${n?.discount_value}% OFF`:`â‚¬${n?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ys,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ie(new Date(l.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),c&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ie(new Date(l.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.valid_until?`${ie(new Date(n.valid_from),"yyyy-MM-dd")} - ${ie(new Date(n.valid_until),"yyyy-MM-dd")}`:t("profile.coupons.noExpiry")})]})]}),n?.min_order_amount&&n.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.min_order_amount]})]})]}),n?.max_discount_amount&&n.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.max_discount_amount]})]})]}),e.jsx($s,{}),l.activity_id&&l.source==="share"&&e.jsxs(I,{to:`/activity/${l.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Oe,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[t("profile.coupons.source"),": ",t("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",t("profile.coupons.viewActivity"),")"]})]})]})})]})})},Ga=()=>{const{user:s}=xe();return Pe({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:l}=await y.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(l)throw l;return a},enabled:!!s?.email})},Qa=()=>{const{user:s}=xe();return Pe({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:l}=await y.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(l)throw l;return a},enabled:!!s?.email})},Rs=()=>{const{t:s}=re(),{data:a,isLoading:l}=Ga(),{getLocalizedField:t}=Be(),m=r=>{switch(r){case"confirmed":return e.jsx(g,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(g,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(g,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(g,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(g,{variant:"outline",children:r})}};return e.jsxs(D,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(H,{className:"text-lg flex items-center gap-2",children:[e.jsx(ks,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(se,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx(E,{className:"px-3",children:l?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(r=>{const o=r.restaurants?t(r.restaurants,"name"):r.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:r.restaurant_id?e.jsxs(I,{to:`/restaurant/${r.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(te,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(te,{className:"w-4 h-4 inline mr-1"}),o]})}),m(r.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ks,{className:"w-3 h-3"}),ie(new Date(r.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ys,{className:"w-3 h-3"}),r.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"w-3 h-3"}),r.party_size," ",s("booking.people")]})]}),r.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:r.notes})]},r.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},Us=()=>{const{t:s}=re(),{data:a,isLoading:l}=Qa(),{getLocalizedField:t}=Be(),m=r=>{switch(r){case"completed":return e.jsx(g,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(g,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(g,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(g,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(g,{variant:"outline",children:r})}};return e.jsxs(D,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(H,{className:"text-lg flex items-center gap-2",children:[e.jsx(Sa,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(se,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx(E,{className:"px-3",children:l?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(r=>{const o=r.restaurants?t(r.restaurants,"name"):r.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:r.restaurant_id?e.jsxs(I,{to:`/restaurant/${r.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(te,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(te,{className:"w-4 h-4 inline mr-1"}),o]})}),m(r.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:ie(new Date(r.order_date),"yyyy-MM-dd HH:mm")}),r.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",r.total_amount.toFixed(2)]})]}),r.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(ve,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:r.delivery_address})]}),r.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:r.notes})]},r.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},fs=d.memo(({comment:s,getLocalizedField:a,t:l})=>{const t=s.moderation_status==="flagged",m=s.moderation_status==="pending",r=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const o={spam:l("riskReason.spam","åžƒåœ¾ä¿¡æ¯"),offensive:l("riskReason.offensive","ä¸å½“è¨€è®º"),harassment:l("riskReason.harassment","éªšæ‰°æ”»å‡»"),fake_review:l("riskReason.fakeReview","è™šå‡è¯„è®º"),flooding:l("riskReason.flooding","åˆ·å±"),irrelevant:l("riskReason.irrelevant","æ— å…³å†…å®¹"),sensitive_word_detected:l("riskReason.sensitiveWord","æ•æ„Ÿè¯"),parse_error:l("riskReason.parseError","è§£æžé”™è¯¯")};return s.risk_reasons.map(n=>o[n]||n).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(I,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:a(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:Vs(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),m&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(g,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(ys,{className:"w-3 h-3 mr-1"}),l("restaurant.commentPending","å®¡æ ¸ä¸­")]})}),t&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(g,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(ka,{className:"w-3 h-3 mr-1"}),l("restaurant.commentFailed","å‘é€å¤±è´¥")]}),r()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[l("restaurant.failReason","å¤±è´¥åŽŸå› "),": ",r()]})]})]})});fs.displayName="CommentItem";const js=d.memo(({restaurant:s,getLocalizedField:a,t:l})=>{if(!s||!s.id)return null;const t=a(s,"name")||s.name||"",m=Array.isArray(s.type)?s.type.join(" Â· "):s.type||"";return e.jsxs(I,{to:`/restaurant/${s.id}`,state:{from:"profile"},className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t),className:"w-full h-full object-cover",loading:"lazy",onError:r=>{r.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:t}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:m}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[l("restaurant.noRatingLine1"),e.jsx("br",{}),l("restaurant.noRatingLine2")]})]})]})]})});js.displayName="FavoriteRestaurantItem";const gs=d.memo(({subscription:s,getLocalizedField:a,t:l,isMobile:t})=>{const[m,r]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>r(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${t?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(a(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[l("profile.joinedOn"),":"," ",Vs(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(_e,{className:`text-primary fill-primary flex-shrink-0 ${t?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(La,{open:m,onOpenChange:r,activity:{title:String(a(s.activity,"title")),image_url:s.activity?.image_url,content:String(a(s.activity,"content"))}})]})});gs.displayName="ActivitySubscriptionItem";const vs=d.memo(({activityGroup:s,getLocalizedField:a,t:l,isMobile:t})=>{const m=s.activity,r=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${t?"p-3":"p-4"}`,children:[e.jsx(I,{to:`/activity/${m.id}`,className:t?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[m.image_url&&e.jsx("img",{src:m.image_url,alt:String(a(m,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(m,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(m,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),new Date(m.start_date).toLocaleDateString()]}),m.end_date&&e.jsxs("span",{children:["- ",new Date(m.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${t?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${t?"mb-1.5":"mb-2"}`,children:[e.jsx(te,{className:`text-primary ${t?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${t?"text-xs":"text-sm"}`,children:[l("profile.participatingRestaurants")," (",r.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${t?"gap-1.5":"gap-2"}`,children:r.map(o=>e.jsx(g,{variant:"secondary",className:t?"text-xs px-2 py-0.5":"text-xs",children:a(o,"name")},o.id))})]})]})});vs.displayName="MerchantActivityItem";const Ns=d.memo(({coupon:s,getLocalizedField:a,t:l,isMobile:t})=>{const[m,r]=d.useState(!1),o=s.coupon_codes?.coupon_templates,n=s.coupon_codes?.code,u=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${u?"bg-muted/30":"hover:shadow-medium"} ${t?"p-3":"p-4"}`,onClick:()=>r(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":"text-base"}`,children:a(o,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${t?"text-xs":"text-sm"}`,children:a(o,"description")})]}),e.jsx(g,{variant:u?"secondary":"default",className:t?"text-xs":"",children:l(u?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${t?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:n}),e.jsx("span",{className:"text-muted-foreground",children:o?.discount_type==="percentage"?`${o?.discount_value}%`:`â‚¬${o?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${t?"text-xs":"text-sm"}`,children:u?e.jsxs("span",{children:[l("profile.coupons.usedOn"),": ",ie(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):o?.valid_until?e.jsxs("span",{children:[l("profile.coupons.validUntil"),": ",ie(new Date(o.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:l("profile.coupons.noExpiry")})})]}),e.jsx(Wa,{open:m,onOpenChange:r,coupon:s})]})});Ns.displayName="UserCouponItem";const yt=()=>{const{t:s}=re(),{user:a}=xe(),l=pa(),{data:t,isLoading:m}=Hs(),{data:r,isLoading:o}=qa(),{data:n,isLoading:u}=Ha(),{data:c,isLoading:v}=Da(),{data:C,isLoading:S}=Ma(),{data:k,isLoading:M}=$a(),{role:A,isMerchant:B,isSupervisor:he}=zs(),{getLocalizedField:P}=Be(),$=B||he,[T,V]=d.useState("profile"),[O,ne]=d.useState(),[K,w]=d.useState({}),[Ne,ue]=d.useState(new Set(["profile"])),pe=$?[{value:"profile",label:s("profile.profile"),icon:As},{value:"favorites",label:s("profile.favorites"),icon:_e},{value:"comments",label:s("profile.comments"),icon:be},{value:"activities",label:s("profile.participatedActivities"),icon:ae}]:[{value:"profile",label:s("profile.profile"),icon:As},{value:"favorites",label:s("profile.favorites"),icon:_e},{value:"comments",label:s("profile.comments"),icon:be}],De=x=>{w(f=>({...f,[x]:window.scrollY}))},ce=x=>{if(Ne.has(x)){const f=K[x]||0;setTimeout(()=>window.scrollTo(0,f),0)}else setTimeout(()=>window.scrollTo(0,0),0),ue(f=>new Set([...f,x]))};d.useEffect(()=>{if(!O)return;const x=()=>{const f=O.selectedScrollSnap(),j=pe[f].value;j!==T&&(De(T),ce(j),V(j))};return O.on("select",x),()=>{O.off("select",x)}},[O,T,K,Ne]);const Ve=x=>{if(x===T)return;De(T);const f=pe.findIndex(j=>j.value===x);f!==-1&&O&&O.scrollTo(f),ce(x),V(x)};if(!a||m)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const oe=s(A?`profile.role.${A}`:"profile.role.user");return e.jsx("div",{className:`min-h-screen bg-secondary/20 ${l?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${l?"px-3":""}`,children:[!l&&e.jsx(e.Fragment,{children:e.jsx(D,{className:"mb-6 md:mb-8",children:e.jsx(E,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(ms,{className:"w-24 h-24",children:[e.jsx(xs,{src:t?.avatar_url||""}),e.jsx(hs,{className:"text-3xl",children:t?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:t?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:a.email}),t?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.phone}),A&&A!=="user"&&e.jsx(g,{className:"bg-primary capitalize",children:oe}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:t?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points","ç§¯åˆ†")}),e.jsx(Ds,{})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[t&&e.jsx(Is,{profile:t}),$&&t&&e.jsx(Es,{isAgreed:t?.activity_terms_agreed||!1,agreedAt:t?.activity_terms_agreed_at||null})]})]})})})}),l?e.jsxs(e.Fragment,{children:[e.jsx(Aa,{setApi:ne,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(Pa,{className:"-ml-0",children:[e.jsx(Re,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(D,{children:e.jsx(E,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(ms,{className:"w-20 h-20",children:[e.jsx(xs,{src:t?.avatar_url||""}),e.jsx(hs,{className:"text-2xl",children:t?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:t?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:a.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(Ps,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:t?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points","ç§¯åˆ†")}),e.jsx(Ds,{})]}),t?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:t.phone}),A&&A!=="user"&&e.jsx(g,{className:"bg-primary capitalize text-xs mb-4",children:oe}),t&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(Is,{profile:t}),$&&e.jsx(Es,{isAgreed:t?.activity_terms_agreed||!1,agreedAt:t?.activity_terms_agreed_at||null})]})]})]})})}),e.jsxs(D,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(H,{className:"text-lg flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(se,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx(E,{className:"px-3",children:M?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):k&&k.length>0?e.jsx("div",{className:"space-y-3",children:k.map(x=>e.jsx(Ns,{coupon:x,getLocalizedField:P,t:s,isMobile:!0},x.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(I,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(Os,{}),e.jsx(Rs,{}),e.jsx(Us,{})]})}),e.jsx(Re,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(D,{children:e.jsx(E,{className:"pt-4",children:e.jsxs(cs,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(os,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(U,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(te,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),r&&r.length>0&&e.jsx(g,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:r.length})]}),e.jsxs(U,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(ae,{className:"w-4 h-4"}),s("profile.activityFavorites"),c&&c.length>0&&e.jsx(g,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:c.length})]})]}),e.jsx(z,{value:"restaurants",children:o?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):r&&r.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:r.map(x=>e.jsx(js,{restaurant:x,getLocalizedField:P,t:s},x.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(z,{value:"activities",children:v?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):c&&c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(x=>e.jsx(gs,{subscription:x,getLocalizedField:P,t:s,isMobile:!0},x.activity_id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(I,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(Re,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(D,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(H,{className:"text-lg flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(se,{className:"text-xs",children:s("profile.commentsDesc")})]}),e.jsx(E,{className:"space-y-3 px-3",children:u?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):n&&n.length>0?n.map(x=>e.jsx(fs,{comment:x,getLocalizedField:P,t:s},x.id)):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})})]})})}),$&&e.jsx(Re,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(D,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(H,{className:"text-lg flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(se,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(E,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:S?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):C&&C.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(te,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const x=C.reduce((f,j)=>{const F=j.activity_id;return f[F]||(f[F]={activity:j.activity,restaurants:[],participationDate:j.created_at}),f[F].restaurants.push({id:j.restaurant_id,name:j.restaurant_name,name_en:j.restaurant_name_en,name_pt:j.restaurant_name_pt}),f},{});return Object.values(x).map(f=>e.jsx(vs,{activityGroup:f,getLocalizedField:P,t:s,isMobile:!0},f.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(I,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t z-50",children:e.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:pe.map(x=>{const f=x.icon;return e.jsxs("button",{onClick:()=>Ve(x.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${T===x.value?"text-primary":"text-muted-foreground"}`,children:[e.jsx(f,{className:`${T===x.value?"w-6 h-6":"w-5 h-5"}`}),e.jsx("span",{className:"text-xs font-medium",children:x.label})]},x.value)})})})]}):e.jsxs(cs,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(os,{className:`grid w-full ${$?"grid-cols-6":"grid-cols-5"}`,children:[e.jsxs(U,{value:"favorites",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(U,{value:"coupons",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(U,{value:"comments",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),$&&e.jsxs(U,{value:"activities",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(U,{value:"addresses",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(U,{value:"orders",children:[e.jsx(Bs,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(z,{value:"favorites",children:e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsxs(cs,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(os,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(U,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),r&&r.length>0&&e.jsx(g,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:r.length})]}),e.jsxs(U,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),s("profile.activityFavorites"),c&&c.length>0&&e.jsx(g,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:c.length})]})]}),e.jsx(z,{value:"restaurants",children:o?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):r&&r.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:r.map(x=>e.jsx(js,{restaurant:x,getLocalizedField:P,t:s},x.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(z,{value:"activities",children:v?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):c&&c.length>0?e.jsx("div",{className:"space-y-4",children:c.map(x=>e.jsx(gs,{subscription:x,getLocalizedField:P,t:s,isMobile:l},x.activity_id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(I,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(z,{value:"comments",children:e.jsxs(D,{children:[e.jsxs(q,{className:l?"pb-3":"",children:[e.jsxs(H,{className:`flex items-center gap-2 ${l?"text-lg":""}`,children:[e.jsx(be,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(se,{className:l?"text-xs":"",children:s("profile.commentsDesc")})]}),e.jsx(E,{className:`space-y-3 md:space-y-4 ${l?"px-3":""}`,children:u?e.jsx("div",{className:`text-center py-8 ${l?"text-sm":""}`,children:s("common.loading")}):n&&n.length>0?n.map(x=>e.jsx(fs,{comment:x,getLocalizedField:P,t:s},x.id)):e.jsx("p",{className:`text-muted-foreground text-center py-8 ${l?"text-sm":""}`,children:s("profile.noComments")})})]})}),$&&e.jsx(z,{value:"activities",children:e.jsxs(D,{children:[e.jsxs(q,{className:l?"pb-3":"",children:[e.jsxs(H,{className:`flex items-center gap-2 ${l?"text-lg":""}`,children:[e.jsx(ae,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(se,{className:l?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(E,{className:l?"px-3":"",children:e.jsx("div",{className:l?"space-y-4":"space-y-6",children:S?e.jsx("div",{className:`text-center py-8 ${l?"text-sm":""}`,children:s("common.loading")}):C&&C.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${l?"text-base":"text-lg"}`,children:[e.jsx(te,{className:l?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:l?"space-y-3":"space-y-4",children:(()=>{const x=C.reduce((f,j)=>{const F=j.activity_id;return f[F]||(f[F]={activity:j.activity,restaurants:[],participationDate:j.created_at}),f[F].restaurants.push({id:j.restaurant_id,name:j.restaurant_name,name_en:j.restaurant_name_en,name_pt:j.restaurant_name_pt}),f},{});return Object.values(x).map(f=>e.jsx(vs,{activityGroup:f,getLocalizedField:P,t:s,isMobile:l},f.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${l?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(I,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(z,{value:"coupons",children:e.jsxs(D,{children:[e.jsxs(q,{className:l?"pb-3":"",children:[e.jsxs(H,{className:`flex items-center gap-2 ${l?"text-lg":""}`,children:[e.jsx(Me,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(se,{className:l?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx(E,{className:l?"px-3":"",children:M?e.jsx("div",{className:`text-center py-8 ${l?"text-sm":""}`,children:s("common.loading")}):k&&k.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${l?"grid-cols-1":"md:grid-cols-2"}`,children:k.map(x=>e.jsx(Ns,{coupon:x,getLocalizedField:P,t:s,isMobile:l},x.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${l?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(I,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(z,{value:"addresses",children:e.jsx(Os,{})}),e.jsx(z,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(Rs,{}),e.jsx(Us,{})]})})]})]})})};export{yt as default};
//# sourceMappingURL=Profile-CeCO4oFp.js.map
