{"version":3,"file":"Community-cu_EULfE.js","sources":["../../src/components/community/PostGridCard.tsx","../../src/components/community/PostPointsRulesDialog.tsx","../../src/components/ui/command.tsx","../../src/components/community/RestaurantSelectDrawer.tsx","../../src/components/community/ActivitySelectDrawer.tsx","../../src/components/community/EmojiPicker.tsx","../../src/components/community/CreatePostDialog.tsx","../../src/pages/Community.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Heart, Images, Play } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { CommunityPost, useLikePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\ninterface PostGridCardProps {\r\n  post: CommunityPost;\r\n}\r\n\r\nconst PostGridCard = ({ post }: PostGridCardProps) => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const [imageError, setImageError] = useState(false);\r\n\r\n  const handleLike = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleCardClick = () => {\r\n    navigate(`/community/${post.id}`);\r\n  };\r\n\r\n  // Strip HTML tags for plain text preview\r\n  const getPlainTextContent = (html: string) => {\r\n    const doc = new DOMParser().parseFromString(html, \"text/html\");\r\n    return doc.body.textContent || \"\";\r\n  };\r\n\r\n  const content = getLocalizedField(post, \"content\");\r\n  const plainContent = getPlainTextContent(content);\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasVideo = !!post.video_url;\r\n  const hasMedia = hasImages || hasVideo;\r\n  const imageCount = post.image_urls?.length || 0;\r\n\r\n  return (\r\n    <div \r\n      className=\"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1\"\r\n      onClick={handleCardClick}\r\n    >\r\n      {/* Media Section - Only show first image, no swipe */}\r\n      {hasMedia && (\r\n        <div className=\"relative aspect-[4/5] overflow-hidden\">\r\n          {/* Display cover image or video frame */}\r\n          {hasImages ? (\r\n            !imageError ? (\r\n              <img\r\n                src={post.image_urls![0]}\r\n                alt=\"\"\r\n                className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\r\n                onError={() => setImageError(true)}\r\n              />\r\n            ) : (\r\n              <div className=\"w-full h-full bg-muted flex items-center justify-center\">\r\n                <span className=\"text-xs text-muted-foreground\">\r\n                  {t(\"common.imageLoadError\", \"å›¾ç‰‡åŠ è½½å¤±è´¥\")}\r\n                </span>\r\n              </div>\r\n            )\r\n          ) : hasVideo ? (\r\n            <video\r\n              src={post.video_url}\r\n              className=\"w-full h-full object-cover\"\r\n              preload=\"metadata\"\r\n              muted\r\n              playsInline\r\n            />\r\n          ) : null}\r\n          \r\n          {/* Video indicator - show play button for video posts */}\r\n          {hasVideo && (\r\n            <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n              <div className=\"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center\">\r\n                <Play className=\"h-5 w-5 text-white fill-white ml-0.5\" />\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Multiple images indicator - only show if no video and multiple images */}\r\n          {!hasVideo && imageCount > 1 && (\r\n            <div className=\"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1\">\r\n              <Images className=\"h-3 w-3\" />\r\n              <span>{imageCount}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-3\">\r\n        {/* Text Content */}\r\n        <p className={`text-sm font-medium line-clamp-2 leading-relaxed ${hasMedia ? '' : 'min-h-[60px]'}`}>\r\n          {plainContent}\r\n        </p>\r\n\r\n        {/* Author Row */}\r\n        <div className=\"flex items-center justify-between mt-3\">\r\n          <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n            <Avatar className=\"h-5 w-5 flex-shrink-0\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback className=\"text-[10px]\">\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <span className=\"text-xs text-muted-foreground truncate\">\r\n              {post.author?.display_name}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Like Button */}\r\n          <button\r\n            className={`flex items-center gap-1 text-xs ${\r\n              post.user_liked ? \"text-red-500\" : \"text-muted-foreground\"\r\n            } hover:text-red-500 transition-colors`}\r\n            onClick={handleLike}\r\n            disabled={!user}\r\n          >\r\n            <Heart\r\n              className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n            />\r\n            <span>{post.likes_count || 0}</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostGridCard;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Gift, CheckCircle, Clock, Shield } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { usePointsSettings } from \"@/hooks/usePoints\";\r\n\r\nconst PostPointsRulesDialog = () => {\r\n  const { t } = useTranslation();\r\n  const { data: settings } = usePointsSettings();\r\n\r\n  // ä»è®¾ç½®ä¸­æå–å€¼\r\n  const postPoints = settings?.find(s => s.key === 'post_points')?.value || '5';\r\n  const minLength = settings?.find(s => s.key === 'min_post_length')?.value || '10';\r\n  const requireMedia = settings?.find(s => s.key === 'post_require_media')?.value === 'true';\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogTrigger asChild>\r\n        <button className=\"text-primary hover:underline text-sm whitespace-nowrap\">\r\n          {t(\"community.viewPointsRules\", \"æŸ¥çœ‹è¯¦ç»†è§„åˆ™\")}\r\n        </button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Gift className=\"h-5 w-5 text-primary\" />\r\n            {t(\"community.pointsRulesTitle\", \"å‘å¸–ç§¯åˆ†è§„åˆ™\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4 pt-2\">\r\n          <p className=\"text-muted-foreground text-sm\">\r\n            {t(\"community.pointsRulesIntro\", \"é€šè¿‡å‘å¸ƒç¤¾åŒºå¸–å­è·å¾—ç§¯åˆ†ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š\")}\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            {/* ç§¯åˆ†æ•°é‡ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.rulePostPoints\", { points: postPoints })}</span>\r\n            </li>\r\n            {/* æœ€å°é•¿åº¦ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleMinLength\", { length: minLength })}</span>\r\n            </li>\r\n            {/* åª’ä½“è¦æ±‚ */}\r\n            {requireMedia && (\r\n              <li className=\"flex items-start gap-2 text-sm\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n                <span>{t(\"community.ruleRequireMedia\", \"å¸–å­å¿…é¡»åŒ…å«è‡³å°‘ä¸€å¼ å›¾ç‰‡æˆ–ä¸€ä¸ªè§†é¢‘\")}</span>\r\n              </li>\r\n            )}\r\n            {/* æ¯æ—¥é™åˆ¶ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Clock className=\"h-4 w-4 text-blue-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleDailyLimit\", \"æ¯å¤©ä»…å¯é€šè¿‡å‘å¸–è·å¾—ä¸€æ¬¡ç§¯åˆ†å¥–åŠ±\")}</span>\r\n            </li>\r\n            {/* å®¡æ ¸è¦æ±‚ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Shield className=\"h-4 w-4 text-purple-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleModerationRequired\", \"å¸–å­éœ€é€šè¿‡å®¡æ ¸åæ‰èƒ½è·å¾—ç§¯åˆ†\")}</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default PostPointsRulesDialog;\r\n","import * as React from \"react\";\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\r\nimport { Command as CommandPrimitive } from \"cmdk\";\r\nimport { Search } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCommand.displayName = CommandPrimitive.displayName;\r\n\r\ninterface CommandDialogProps extends DialogProps {}\r\n\r\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName;\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName;\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\r\n));\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName;\r\n\r\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\r\n};\r\nCommandShortcut.displayName = \"CommandShortcut\";\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n};\r\n","import { useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, ChevronsUpDown, MapPin, Search } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n  DrawerFooter,\r\n} from \"@/components/ui/drawer\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n} from \"@/components/ui/command\";\r\n\r\ninterface Restaurant {\r\n  id: string;\r\n  name_zh?: string;\r\n  name_en?: string;\r\n  name_pt?: string;\r\n  address?: string;\r\n  type?: string | string[];\r\n}\r\n\r\ninterface RestaurantSelectDrawerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  value: string;\r\n  onSelect: (restaurantId: string) => void;\r\n  restaurants: Restaurant[];\r\n  showNoneOption?: boolean;\r\n  required?: boolean;\r\n}\r\n\r\nconst RestaurantSelectDrawer = ({\r\n  open,\r\n  onOpenChange,\r\n  value,\r\n  onSelect,\r\n  restaurants,\r\n  showNoneOption = true,\r\n  required = false,\r\n}: RestaurantSelectDrawerProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const [search, setSearch] = useState(\"\");\r\n  const [pendingValue, setPendingValue] = useState(value);\r\n  const [drawerHeight, setDrawerHeight] = useState<string>('85vh');\r\n\r\n  // Monitor visualViewport to dynamically adjust drawer height\r\n  useEffect(() => {\r\n    if (!open || !isMobile) return;\r\n    \r\n    const viewport = window.visualViewport;\r\n    if (!viewport) {\r\n      setDrawerHeight('85vh');\r\n      return;\r\n    }\r\n    \r\n    // Calculate initial max height (85% of viewport)\r\n    const updateHeight = () => {\r\n      // Use actual viewport height in pixels for accurate sizing\r\n      const availableHeight = viewport.height;\r\n      const targetHeight = Math.min(availableHeight * 0.85, availableHeight - 50);\r\n      setDrawerHeight(`${targetHeight}px`);\r\n    };\r\n    \r\n    // Set initial height\r\n    updateHeight();\r\n    \r\n    // Listen for viewport changes (keyboard show/hide)\r\n    viewport.addEventListener('resize', updateHeight);\r\n    \r\n    return () => {\r\n      viewport.removeEventListener('resize', updateHeight);\r\n    };\r\n  }, [open, isMobile]);\r\n\r\n  // Reset pending value when drawer opens\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    if (newOpen) {\r\n      setPendingValue(value);\r\n      setSearch(\"\");\r\n    }\r\n    onOpenChange(newOpen);\r\n  };\r\n\r\n  // Filter restaurants based on search\r\n  const filteredRestaurants = restaurants?.filter((r) => {\r\n    if (!search) return true;\r\n    const name = getLocalizedField(r, \"name\")?.toLowerCase() || \"\";\r\n    const address = r.address?.toLowerCase() || \"\";\r\n    const searchLower = search.toLowerCase();\r\n    return name.includes(searchLower) || address.includes(searchLower);\r\n  }) || [];\r\n\r\n  // Get selected restaurant name\r\n  const getSelectedName = () => {\r\n    if (!value) return \"\";\r\n    const selected = restaurants?.find((r) => r.id === value);\r\n    return selected ? getLocalizedField(selected, \"name\") : \"\";\r\n  };\r\n\r\n  // Handle confirm (mobile only)\r\n  const handleConfirm = () => {\r\n    onSelect(pendingValue);\r\n    onOpenChange(false);\r\n    setSearch(\"\");\r\n  };\r\n\r\n  // Handle select (desktop - immediate)\r\n  const handleDesktopSelect = (restaurantId: string) => {\r\n    onSelect(restaurantId);\r\n    onOpenChange(false);\r\n    setSearch(\"\");\r\n  };\r\n\r\n  // Trigger button\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors\"\r\n      onClick={() => handleOpenChange(true)}\r\n    >\r\n      {value ? (\r\n        <span className=\"text-primary\">{getSelectedName()}</span>\r\n      ) : (\r\n        <span className=\"text-muted-foreground\">\r\n          {t(\"community.linkRestaurant\", \"å…³è”é¤å…\")}\r\n          {required && <span className=\"text-destructive ml-1\">*</span>}\r\n        </span>\r\n      )}\r\n      <ChevronsUpDown className=\"h-4 w-4 opacity-50\" />\r\n    </button>\r\n  );\r\n\r\n  // Mobile: Full-screen Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={handleOpenChange}>\r\n          <DrawerContent \r\n            className=\"flex flex-col\"\r\n            style={{ \r\n              height: drawerHeight,\r\n              maxHeight: drawerHeight,\r\n              transition: 'height 0.15s ease-out, max-height 0.15s ease-out'\r\n            }}\r\n          >\r\n            <DrawerHeader className=\"pb-2 shrink-0\">\r\n              <DrawerTitle>{t(\"community.selectRestaurant\", \"é€‰æ‹©é¤å…\")}</DrawerTitle>\r\n            </DrawerHeader>\r\n\r\n            {/* Search Input */}\r\n            <div className=\"px-4 pb-3 shrink-0\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder={t(\"community.searchRestaurant\", \"æœç´¢é¤å…...\")}\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  className=\"pl-9\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Restaurant List - use flex-1 and overflow for proper sizing */}\r\n            <div className=\"flex-1 overflow-y-auto px-4 min-h-0\">\r\n              <div className=\"space-y-1 pb-4\">\r\n                {/* None option */}\r\n                {showNoneOption && (\r\n                  <div\r\n                    className={cn(\r\n                      \"flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                      pendingValue === \"\" ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                    )}\r\n                    onClick={() => setPendingValue(\"\")}\r\n                  >\r\n                    <Check\r\n                      className={cn(\r\n                        \"h-4 w-4 shrink-0\",\r\n                        pendingValue === \"\" ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                      )}\r\n                    />\r\n                    <span className=\"text-muted-foreground\">\r\n                      {t(\"community.noRestaurantLink\", \"ä¸å…³è”é¤å…\")}\r\n                    </span>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Restaurant items */}\r\n                {filteredRestaurants.map((restaurant) => (\r\n                  <div\r\n                    key={restaurant.id}\r\n                    className={cn(\r\n                      \"flex items-start gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                      pendingValue === restaurant.id ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                    )}\r\n                    onClick={() => setPendingValue(restaurant.id)}\r\n                  >\r\n                    <Check\r\n                      className={cn(\r\n                        \"h-4 w-4 shrink-0 mt-0.5\",\r\n                        pendingValue === restaurant.id ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                      )}\r\n                    />\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"font-medium truncate\">\r\n                        {getLocalizedField(restaurant, \"name\")}\r\n                      </p>\r\n                      {restaurant.address && (\r\n                        <p className=\"text-sm text-muted-foreground truncate flex items-center gap-1 mt-0.5\">\r\n                          <MapPin className=\"h-3 w-3 shrink-0\" />\r\n                          {restaurant.address}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n\r\n                {filteredRestaurants.length === 0 && search && (\r\n                  <div className=\"py-6 text-center text-muted-foreground\">\r\n                    {t(\"community.noRestaurantFound\", \"æœªæ‰¾åˆ°åŒ¹é…çš„é¤å…\")}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Footer Buttons */}\r\n            <DrawerFooter className=\"pt-2\">\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => handleOpenChange(false)}\r\n                >\r\n                  {t(\"common.cancel\", \"å–æ¶ˆ\")}\r\n                </Button>\r\n                <Button className=\"flex-1\" onClick={handleConfirm}>\r\n                  {t(\"community.confirmSelection\", \"ç¡®è®¤é€‰æ‹©\")}\r\n                </Button>\r\n              </div>\r\n            </DrawerFooter>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover with Command\r\n  return (\r\n    <Popover open={open} onOpenChange={handleOpenChange}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-72 p-0\" align=\"start\">\r\n        <Command shouldFilter={false}>\r\n          <CommandInput\r\n            placeholder={t(\"community.searchRestaurant\", \"æœç´¢é¤å…...\")}\r\n            value={search}\r\n            onValueChange={setSearch}\r\n          />\r\n          <CommandList>\r\n            <CommandEmpty>{t(\"community.noRestaurantFound\", \"æœªæ‰¾åˆ°åŒ¹é…çš„é¤å…\")}</CommandEmpty>\r\n            <CommandGroup>\r\n              {showNoneOption && (\r\n                <CommandItem\r\n                  value=\"none\"\r\n                  onSelect={() => handleDesktopSelect(\"\")}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"mr-2 h-4 w-4\",\r\n                      !value ? \"opacity-100\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  {t(\"community.noRestaurantLink\", \"ä¸å…³è”é¤å…\")}\r\n                </CommandItem>\r\n              )}\r\n              {filteredRestaurants.map((restaurant) => (\r\n                <CommandItem\r\n                  key={restaurant.id}\r\n                  value={restaurant.id}\r\n                  onSelect={() => handleDesktopSelect(restaurant.id)}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"mr-2 h-4 w-4\",\r\n                      value === restaurant.id ? \"opacity-100\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  {getLocalizedField(restaurant, \"name\")}\r\n                </CommandItem>\r\n              ))}\r\n            </CommandGroup>\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default RestaurantSelectDrawer;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, ChevronsUpDown, Calendar } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n  DrawerFooter,\r\n} from \"@/components/ui/drawer\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Command,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandList,\r\n} from \"@/components/ui/command\";\r\n\r\ninterface Activity {\r\n  id: string;\r\n  title_zh?: string;\r\n  title_en?: string;\r\n  title_pt?: string;\r\n  status?: string;\r\n}\r\n\r\ninterface ActivitySelectDrawerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  value: string;\r\n  onSelect: (activityId: string) => void;\r\n  activities: Activity[];\r\n}\r\n\r\nconst ActivitySelectDrawer = ({\r\n  open,\r\n  onOpenChange,\r\n  value,\r\n  onSelect,\r\n  activities,\r\n}: ActivitySelectDrawerProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const [pendingValue, setPendingValue] = useState(value);\r\n\r\n  // Reset pending value when drawer opens\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    if (newOpen) {\r\n      setPendingValue(value);\r\n    }\r\n    onOpenChange(newOpen);\r\n  };\r\n\r\n  // Get selected activity name\r\n  const getSelectedName = () => {\r\n    if (!value) return \"\";\r\n    const selected = activities?.find((a) => a.id === value);\r\n    return selected ? getLocalizedField(selected, \"title\") : \"\";\r\n  };\r\n\r\n  // Handle confirm (mobile only)\r\n  const handleConfirm = () => {\r\n    onSelect(pendingValue);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // Handle select (desktop - immediate)\r\n  const handleDesktopSelect = (activityId: string) => {\r\n    onSelect(activityId);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // Trigger button\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors\"\r\n      onClick={() => handleOpenChange(true)}\r\n    >\r\n      {value ? (\r\n        <span className=\"text-primary\">{getSelectedName()}</span>\r\n      ) : (\r\n        <span className=\"text-muted-foreground\">\r\n          {t(\"community.linkActivity\", \"å…³è”æ´»åŠ¨\")}\r\n        </span>\r\n      )}\r\n      <ChevronsUpDown className=\"h-4 w-4 opacity-50\" />\r\n    </button>\r\n  );\r\n\r\n  // Mobile: Full-screen Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={handleOpenChange}>\r\n          <DrawerContent className=\"max-h-[85vh] flex flex-col\">\r\n            <DrawerHeader className=\"pb-2\">\r\n              <DrawerTitle>{t(\"community.selectActivity\", \"é€‰æ‹©æ´»åŠ¨\")}</DrawerTitle>\r\n            </DrawerHeader>\r\n\r\n            {/* Activity List */}\r\n            <ScrollArea className=\"flex-1 px-4\">\r\n              <div className=\"space-y-1 pb-4\">\r\n                {/* None option */}\r\n                <div\r\n                  className={cn(\r\n                    \"flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                    pendingValue === \"\" ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                  )}\r\n                  onClick={() => setPendingValue(\"\")}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"h-4 w-4 shrink-0\",\r\n                      pendingValue === \"\" ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  <span className=\"text-muted-foreground\">\r\n                    {t(\"community.noActivity\", \"ä¸å…³è”æ´»åŠ¨\")}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Activity items */}\r\n                {activities.map((activity) => (\r\n                  <div\r\n                    key={activity.id}\r\n                    className={cn(\r\n                      \"flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                      pendingValue === activity.id ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                    )}\r\n                    onClick={() => setPendingValue(activity.id)}\r\n                  >\r\n                    <Check\r\n                      className={cn(\r\n                        \"h-4 w-4 shrink-0\",\r\n                        pendingValue === activity.id ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                      )}\r\n                    />\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Calendar className=\"h-4 w-4 text-muted-foreground shrink-0\" />\r\n                      <span className=\"font-medium\">\r\n                        {getLocalizedField(activity, \"title\")}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n\r\n                {activities.length === 0 && (\r\n                  <div className=\"py-6 text-center text-muted-foreground\">\r\n                    {t(\"activities.noActivities\", \"æš‚æ— å¯ç”¨æ´»åŠ¨\")}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </ScrollArea>\r\n\r\n            {/* Footer Buttons */}\r\n            <DrawerFooter className=\"pt-2\">\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => handleOpenChange(false)}\r\n                >\r\n                  {t(\"common.cancel\", \"å–æ¶ˆ\")}\r\n                </Button>\r\n                <Button className=\"flex-1\" onClick={handleConfirm}>\r\n                  {t(\"community.confirmSelection\", \"ç¡®è®¤é€‰æ‹©\")}\r\n                </Button>\r\n              </div>\r\n            </DrawerFooter>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover with Command\r\n  return (\r\n    <Popover open={open} onOpenChange={handleOpenChange}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-72 p-0\" align=\"start\">\r\n        <Command>\r\n          <CommandList>\r\n            <CommandGroup>\r\n              <CommandItem\r\n                value=\"none\"\r\n                onSelect={() => handleDesktopSelect(\"\")}\r\n              >\r\n                <Check\r\n                  className={cn(\r\n                    \"mr-2 h-4 w-4\",\r\n                    !value ? \"opacity-100\" : \"opacity-0\"\r\n                  )}\r\n                />\r\n                {t(\"community.noActivity\", \"ä¸å…³è”æ´»åŠ¨\")}\r\n              </CommandItem>\r\n              {activities.map((activity) => (\r\n                <CommandItem\r\n                  key={activity.id}\r\n                  value={activity.id}\r\n                  onSelect={() => handleDesktopSelect(activity.id)}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"mr-2 h-4 w-4\",\r\n                      value === activity.id ? \"opacity-100\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  {getLocalizedField(activity, \"title\")}\r\n                </CommandItem>\r\n              ))}\r\n            </CommandGroup>\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default ActivitySelectDrawer;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Smile } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n} from \"@/components/ui/drawer\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\n\r\ninterface EmojiPickerProps {\r\n  onSelect: (emoji: string) => void;\r\n}\r\n\r\n// Common emoji categories\r\nconst emojiCategories = [\r\n  {\r\n    name: \"smileys\",\r\n    emojis: [\"ğŸ˜€\", \"ğŸ˜ƒ\", \"ğŸ˜„\", \"ğŸ˜\", \"ğŸ˜†\", \"ğŸ˜…\", \"ğŸ¤£\", \"ğŸ˜‚\", \"ğŸ™‚\", \"ğŸ˜Š\", \"ğŸ˜‡\", \"ğŸ¥°\", \"ğŸ˜\", \"ğŸ¤©\", \"ğŸ˜˜\", \"ğŸ˜—\", \"ğŸ˜š\", \"ğŸ˜‹\", \"ğŸ˜›\", \"ğŸ˜œ\", \"ğŸ¤ª\", \"ğŸ˜\", \"ğŸ¤‘\", \"ğŸ¤—\", \"ğŸ¤­\", \"ğŸ¤«\", \"ğŸ¤”\", \"ğŸ¤\", \"ğŸ¤¨\", \"ğŸ˜\", \"ğŸ˜‘\", \"ğŸ˜¶\", \"ğŸ˜\", \"ğŸ˜’\", \"ğŸ™„\", \"ğŸ˜¬\", \"ğŸ¤¥\", \"ğŸ˜Œ\", \"ğŸ˜”\", \"ğŸ˜ª\", \"ğŸ¤¤\", \"ğŸ˜´\", \"ğŸ˜·\", \"ğŸ¤’\", \"ğŸ¤•\", \"ğŸ¤¢\", \"ğŸ¤®\", \"ğŸ¥µ\", \"ğŸ¥¶\", \"ğŸ¥´\", \"ğŸ˜µ\", \"ğŸ¤¯\", \"ğŸ¤ \", \"ğŸ¥³\", \"ğŸ˜\", \"ğŸ¤“\", \"ğŸ§\"],\r\n  },\r\n  {\r\n    name: \"gestures\",\r\n    emojis: [\"ğŸ‘\", \"ğŸ‘\", \"ğŸ‘Œ\", \"ğŸ¤Œ\", \"âœŒï¸\", \"ğŸ¤\", \"ğŸ¤Ÿ\", \"ğŸ¤˜\", \"ğŸ¤™\", \"ğŸ‘ˆ\", \"ğŸ‘‰\", \"ğŸ‘†\", \"ğŸ‘‡\", \"â˜ï¸\", \"âœ‹\", \"ğŸ¤š\", \"ğŸ–ï¸\", \"ğŸ––\", \"ğŸ‘‹\", \"ğŸ¤\", \"ğŸ™\", \"ğŸ’ª\", \"ğŸ¦¾\", \"ğŸ¦¿\", \"ğŸ¦µ\", \"ğŸ¦¶\", \"ğŸ‘‚\", \"ğŸ¦»\", \"ğŸ‘ƒ\", \"ğŸ§ \", \"ğŸ‘€\", \"ğŸ‘ï¸\", \"ğŸ‘…\", \"ğŸ‘„\"],\r\n  },\r\n  {\r\n    name: \"food\",\r\n    emojis: [\"ğŸ\", \"ğŸ\", \"ğŸ\", \"ğŸŠ\", \"ğŸ‹\", \"ğŸŒ\", \"ğŸ‰\", \"ğŸ‡\", \"ğŸ“\", \"ğŸ«\", \"ğŸˆ\", \"ğŸ’\", \"ğŸ‘\", \"ğŸ¥­\", \"ğŸ\", \"ğŸ¥¥\", \"ğŸ¥\", \"ğŸ…\", \"ğŸ†\", \"ğŸ¥‘\", \"ğŸ¥¦\", \"ğŸ¥¬\", \"ğŸ¥’\", \"ğŸŒ¶ï¸\", \"ğŸ«‘\", \"ğŸŒ½\", \"ğŸ¥•\", \"ğŸ§„\", \"ğŸ§…\", \"ğŸ¥”\", \"ğŸ \", \"ğŸ¥\", \"ğŸ¥¯\", \"ğŸ\", \"ğŸ¥–\", \"ğŸ¥¨\", \"ğŸ§€\", \"ğŸ¥š\", \"ğŸ³\", \"ğŸ§ˆ\", \"ğŸ¥\", \"ğŸ§‡\", \"ğŸ¥“\", \"ğŸ¥©\", \"ğŸ—\", \"ğŸ–\", \"ğŸ¦´\", \"ğŸŒ­\", \"ğŸ”\", \"ğŸŸ\", \"ğŸ•\", \"ğŸ«“\", \"ğŸ¥ª\", \"ğŸ¥™\", \"ğŸ§†\", \"ğŸŒ®\", \"ğŸŒ¯\", \"ğŸ«”\", \"ğŸ¥—\", \"ğŸ¥˜\", \"ğŸ«•\", \"ğŸ¥«\", \"ğŸ\", \"ğŸœ\", \"ğŸ²\", \"ğŸ›\", \"ğŸ£\", \"ğŸ±\", \"ğŸ¥Ÿ\", \"ğŸ¦ª\", \"ğŸ¤\", \"ğŸ™\", \"ğŸš\", \"ğŸ˜\", \"ğŸ¥\", \"ğŸ¥ \", \"ğŸ¥®\", \"ğŸ¢\", \"ğŸ¡\", \"ğŸ§\", \"ğŸ¨\", \"ğŸ¦\", \"ğŸ¥§\", \"ğŸ§\", \"ğŸ°\", \"ğŸ‚\", \"ğŸ®\", \"ğŸ­\", \"ğŸ¬\", \"ğŸ«\", \"ğŸ¿\", \"ğŸ©\", \"ğŸª\"],\r\n  },\r\n  {\r\n    name: \"hearts\",\r\n    emojis: [\"â¤ï¸\", \"ğŸ§¡\", \"ğŸ’›\", \"ğŸ’š\", \"ğŸ’™\", \"ğŸ’œ\", \"ğŸ–¤\", \"ğŸ¤\", \"ğŸ¤\", \"ğŸ’”\", \"â£ï¸\", \"ğŸ’•\", \"ğŸ’\", \"ğŸ’“\", \"ğŸ’—\", \"ğŸ’–\", \"ğŸ’˜\", \"ğŸ’\", \"ğŸ’Ÿ\", \"â™¥ï¸\"],\r\n  },\r\n  {\r\n    name: \"objects\",\r\n    emojis: [\"â­\", \"ğŸŒŸ\", \"âœ¨\", \"ğŸ’«\", \"ğŸ”¥\", \"ğŸ’¯\", \"ğŸ‰\", \"ğŸŠ\", \"ğŸˆ\", \"ğŸ\", \"ğŸ†\", \"ğŸ¥‡\", \"ğŸ¥ˆ\", \"ğŸ¥‰\", \"âš½\", \"ğŸ€\", \"ğŸˆ\", \"âš¾\", \"ğŸ¾\", \"ğŸ\", \"ğŸ±\", \"ğŸ“\", \"ğŸ®\", \"ğŸ²\", \"ğŸ§©\", \"ğŸ­\", \"ğŸ¨\", \"ğŸ¬\", \"ğŸ¤\", \"ğŸ§\", \"ğŸµ\", \"ğŸ¶\", \"ğŸ¹\", \"ğŸ¸\", \"ğŸº\", \"ğŸ»\", \"ğŸ“·\", \"ğŸ“¸\", \"ğŸ“¹\", \"ğŸ¥\", \"ğŸ“±\", \"ğŸ’»\", \"âŒ¨ï¸\", \"ğŸ–¥ï¸\", \"ğŸ“º\", \"ğŸ“»\", \"â°\", \"âŒš\", \"ğŸ’¡\", \"ğŸ”¦\", \"ğŸ“š\", \"ğŸ“–\", \"âœï¸\", \"ğŸ“\", \"ğŸ’°\", \"ğŸ’µ\", \"ğŸ’´\", \"ğŸ’¶\", \"ğŸ’·\", \"ğŸ’³\", \"ğŸ›’\", \"ğŸ€\", \"ğŸ—ï¸\"],\r\n  },\r\n  {\r\n    name: \"nature\",\r\n    emojis: [\"ğŸŒ¸\", \"ğŸ’®\", \"ğŸµï¸\", \"ğŸŒ¹\", \"ğŸ¥€\", \"ğŸŒº\", \"ğŸŒ»\", \"ğŸŒ¼\", \"ğŸŒ·\", \"ğŸŒ±\", \"ğŸª´\", \"ğŸŒ²\", \"ğŸŒ³\", \"ğŸŒ´\", \"ğŸŒµ\", \"ğŸŒ¾\", \"ğŸŒ¿\", \"â˜˜ï¸\", \"ğŸ€\", \"ğŸ\", \"ğŸ‚\", \"ğŸƒ\", \"ğŸŒ\", \"ğŸŒ\", \"ğŸŒ\", \"ğŸŒ™\", \"â­\", \"â˜€ï¸\", \"ğŸŒ¤ï¸\", \"â›…\", \"ğŸŒ¥ï¸\", \"â˜ï¸\", \"ğŸŒ¦ï¸\", \"ğŸŒ§ï¸\", \"â›ˆï¸\", \"ğŸŒ©ï¸\", \"ğŸŒ¨ï¸\", \"â„ï¸\", \"â˜ƒï¸\", \"â›„\", \"ğŸŒ¬ï¸\", \"ğŸ’¨\", \"ğŸŒŠ\", \"ğŸ’§\", \"ğŸ’¦\", \"â˜”\", \"ğŸŒˆ\"],\r\n  },\r\n];\r\n\r\nconst EmojiPicker = ({ onSelect }: EmojiPickerProps) => {\r\n  const { t } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [open, setOpen] = useState(false);\r\n  const [activeCategory, setActiveCategory] = useState(0);\r\n\r\n  const handleSelect = (emoji: string) => {\r\n    onSelect(emoji);\r\n    if (!isMobile) {\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const categoryLabels: Record<string, string> = {\r\n    smileys: t(\"emoji.smileys\", \"è¡¨æƒ…\"),\r\n    gestures: t(\"emoji.gestures\", \"æ‰‹åŠ¿\"),\r\n    food: t(\"emoji.food\", \"ç¾é£Ÿ\"),\r\n    hearts: t(\"emoji.hearts\", \"çˆ±å¿ƒ\"),\r\n    objects: t(\"emoji.objects\", \"ç‰©å“\"),\r\n    nature: t(\"emoji.nature\", \"è‡ªç„¶\"),\r\n  };\r\n\r\n  const emojiGrid = (\r\n    <div className=\"space-y-3\">\r\n      {/* Category tabs */}\r\n      <div className=\"flex gap-1 overflow-x-auto pb-2 border-b\">\r\n        {emojiCategories.map((category, index) => (\r\n          <button\r\n            key={category.name}\r\n            type=\"button\"\r\n            onClick={() => setActiveCategory(index)}\r\n            className={`px-3 py-1.5 text-sm rounded-full whitespace-nowrap transition-colors ${\r\n              activeCategory === index\r\n                ? \"bg-primary text-primary-foreground\"\r\n                : \"bg-muted hover:bg-muted/80 text-muted-foreground\"\r\n            }`}\r\n          >\r\n            {categoryLabels[category.name]}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Emoji grid */}\r\n      <div className=\"grid grid-cols-8 gap-1\">\r\n        {emojiCategories[activeCategory].emojis.map((emoji, index) => (\r\n          <button\r\n            key={index}\r\n            type=\"button\"\r\n            onClick={() => handleSelect(emoji)}\r\n            className=\"w-9 h-9 flex items-center justify-center text-xl hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            {emoji}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      onClick={() => setOpen(true)}\r\n      className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground transition-colors\"\r\n    >\r\n      <Smile className=\"h-5 w-5\" />\r\n      <span className=\"text-sm\">{t(\"community.emoji\", \"è¡¨æƒ…\")}</span>\r\n    </button>\r\n  );\r\n\r\n  // Mobile: Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={setOpen}>\r\n          <DrawerContent className=\"h-[50vh]\">\r\n            <DrawerHeader className=\"pb-2\">\r\n              <DrawerTitle>{t(\"emoji.title\", \"é€‰æ‹©è¡¨æƒ…\")}</DrawerTitle>\r\n            </DrawerHeader>\r\n            <ScrollArea className=\"flex-1 px-4 pb-4\">\r\n              {emojiGrid}\r\n            </ScrollArea>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover\r\n  return (\r\n    <Popover open={open} onOpenChange={setOpen}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-80 p-3\" align=\"start\" side=\"top\">\r\n        {emojiGrid}\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default EmojiPicker;\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Image, Video, X, Loader2, Calendar, MapPin, Gift, ArrowLeft } from \"lucide-react\";\r\nimport PostPointsRulesDialog from \"./PostPointsRulesDialog\";\r\nimport RestaurantSelectDrawer from \"./RestaurantSelectDrawer\";\r\nimport ActivitySelectDrawer from \"./ActivitySelectDrawer\";\r\nimport EmojiPicker from \"./EmojiPicker\";\r\nimport {\r\n  Sheet,\r\n  SheetContent,\r\n  SheetTitle,\r\n  SheetTrigger,\r\n} from \"@/components/ui/sheet\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useCreatePost, useMerchantRestaurant, useHasPostedToday } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\";\r\n\r\ninterface CreatePostDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreatePostDialog = ({ trigger }: CreatePostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const createPost = useCreatePost();\r\n  const { data: activities } = useActivities();\r\n  const { data: restaurants } = useRestaurants();\r\n  const { role, isMerchant, isAdmin, isSupervisor } = useUserRole();\r\n  const { data: merchantRestaurant } = useMerchantRestaurant();\r\n  const { data: hasPostedToday, isLoading: checkingPost } = useHasPostedToday();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const [content, setContent] = useState(\"\");\r\n  const [imageUrls, setImageUrls] = useState<string[]>([]);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n  const [activityId, setActivityId] = useState<string>(\"\");\r\n  const [restaurantId, setRestaurantId] = useState<string>(\"\");\r\n  const [uploading, setUploading] = useState(false);\r\n  const [restaurantOpen, setRestaurantOpen] = useState(false);\r\n  const [activityOpen, setActivityOpen] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // æ™®é€šç”¨æˆ· = æ—¢ä¸æ˜¯å•†å®¶ã€ç£å¯¼ä¹Ÿä¸æ˜¯ç®¡ç†å‘˜\r\n  const isRegularUser = !isMerchant && !isSupervisor && !isAdmin;\r\n\r\n  // å•†å®¶è‡ªåŠ¨è®¾ç½®é¤å…\r\n  useEffect(() => {\r\n    if (isMerchant && merchantRestaurant && open) {\r\n      setRestaurantId(merchantRestaurant.id);\r\n    }\r\n  }, [isMerchant, merchantRestaurant, open]);\r\n\r\n  // é‡ç½®è¡¨å•\r\n  const resetForm = () => {\r\n    setContent(\"\");\r\n    setImageUrls([]);\r\n    setVideoUrl(null);\r\n    setActivityId(\"\");\r\n    setRestaurantId(\"\");\r\n    setRestaurantOpen(false);\r\n    setActivityOpen(false);\r\n  };\r\n\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    setOpen(newOpen);\r\n    if (!newOpen) {\r\n      resetForm();\r\n    }\r\n  };\r\n\r\n  // Get active activities\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"æœ€å¤šä¸Šä¼ 9å¼ å›¾ç‰‡\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  // Extract first frame from video file\r\n  const extractVideoFirstFrame = (videoFile: File): Promise<Blob> => {\r\n    return new Promise((resolve, reject) => {\r\n      const video = document.createElement('video');\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      video.preload = 'auto';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      let hasResolved = false;\r\n      \r\n      const captureFrame = () => {\r\n        if (hasResolved) return;\r\n        if (video.videoWidth === 0 || video.videoHeight === 0) return;\r\n        \r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        \r\n        if (ctx) {\r\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n          canvas.toBlob((blob) => {\r\n            if (blob && blob.size > 0) {\r\n              hasResolved = true;\r\n              video.pause();\r\n              URL.revokeObjectURL(video.src);\r\n              resolve(blob);\r\n            } else {\r\n              reject(new Error('Failed to create blob'));\r\n            }\r\n          }, 'image/jpeg', 0.85);\r\n        }\r\n      };\r\n      \r\n      video.onloadedmetadata = () => {\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        video.currentTime = 0.1; // Jump to 0.1s to ensure frame is available\r\n      };\r\n      \r\n      video.onseeked = () => {\r\n        setTimeout(captureFrame, 100);\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(video.src);\r\n        reject(new Error('Failed to load video'));\r\n      };\r\n      \r\n      // Timeout handling\r\n      setTimeout(() => {\r\n        if (!hasResolved) {\r\n          URL.revokeObjectURL(video.src);\r\n          reject(new Error('Timeout'));\r\n        }\r\n      }, 10000);\r\n      \r\n      video.src = URL.createObjectURL(videoFile);\r\n      video.load();\r\n    });\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Check file size (max 100MB)\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"è§†é¢‘ä¸èƒ½è¶…è¿‡100MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      // 1. Upload video\r\n      const videoExt = file.name.split(\".\").pop();\r\n      const videoFileName = `${user.id}/${Date.now()}.${videoExt}`;\r\n\r\n      const { error: videoError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(videoFileName, file);\r\n\r\n      if (videoError) throw videoError;\r\n\r\n      const { data: { publicUrl: videoPublicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(videoFileName);\r\n\r\n      setVideoUrl(videoPublicUrl);\r\n\r\n      // 2. Extract and upload cover image\r\n      try {\r\n        toast.info(t(\"community.extractingCover\", \"æ­£åœ¨æå–è§†é¢‘å°é¢...\"));\r\n        const coverBlob = await extractVideoFirstFrame(file);\r\n        const coverFileName = `${user.id}/${Date.now()}-cover.jpg`;\r\n        \r\n        const { error: coverError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(coverFileName, coverBlob);\r\n        \r\n        if (!coverError) {\r\n          const { data: { publicUrl: coverUrl } } = supabase.storage\r\n            .from(\"community-posts\")\r\n            .getPublicUrl(coverFileName);\r\n          \r\n          // Add cover image to the beginning of imageUrls\r\n          setImageUrls(prev => [coverUrl, ...prev]);\r\n          toast.success(t(\"community.coverExtracted\", \"å°é¢å·²è‡ªåŠ¨ç”Ÿæˆ\"));\r\n        }\r\n      } catch (coverError) {\r\n        console.warn(\"Cover extraction failed:\", coverError);\r\n        // Cover extraction failure should not block video upload\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) {\r\n        videoInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n    // Remove auto-generated cover image (URL contains -cover.jpg)\r\n    setImageUrls(prev => {\r\n      if (prev.length > 0 && prev[0].includes('-cover.jpg')) {\r\n        return prev.slice(1);\r\n      }\r\n      return prev;\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"è¯·è¾“å…¥å†…å®¹\"));\r\n      return;\r\n    }\r\n\r\n    // æ™®é€šç”¨æˆ·å¿…é¡»é€‰æ‹©é¤å…\r\n    if (isRegularUser && !restaurantId) {\r\n      toast.error(t(\"community.restaurantRequired\", \"è¯·é€‰æ‹©é¤å…\"));\r\n      return;\r\n    }\r\n\r\n    await createPost.mutateAsync({\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl || undefined,\r\n      activity_id: activityId || undefined,\r\n      restaurant_id: restaurantId || undefined,\r\n    });\r\n\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n\r\n  // è·å–å•†å®¶é¤å…åç§°\r\n  const getMerchantRestaurantName = () => {\r\n    if (!merchantRestaurant) return t(\"community.noRestaurant\", \"æœªå…³è”é¤å…\");\r\n    return getLocalizedField(merchantRestaurant, \"name\");\r\n  };\r\n\r\n  return (\r\n    <Sheet open={open} onOpenChange={handleOpenChange}>\r\n      <SheetTrigger asChild>\r\n        {trigger || (\r\n          <Button>{t(\"community.createPost\", \"å‘å¸ƒå¸–å­\")}</Button>\r\n        )}\r\n      </SheetTrigger>\r\n      <SheetContent \r\n        side=\"bottom\" \r\n        className=\"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden\"\r\n      >\r\n        <VisuallyHidden.Root>\r\n          <SheetTitle>{t(\"community.createPost\", \"å‘å¸ƒå¸–å­\")}</SheetTitle>\r\n        </VisuallyHidden.Root>\r\n\r\n        {/* é¡¶éƒ¨å¯¼èˆªæ  - å›ºå®š */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setOpen(false)}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={handleSubmit}\r\n            disabled={createPost.isPending || !content.trim()}\r\n            className=\"rounded-full px-6\"\r\n          >\r\n            {createPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            {t(\"community.publish\", \"å‘å¸ƒ\")}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* å¯æ»šåŠ¨å†…å®¹åŒº */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          <div className=\"px-4 py-4 space-y-4\">\r\n            {/* Points Hint - Only show if user hasn't posted today */}\r\n            {!checkingPost && !hasPostedToday && (\r\n              <div className=\"flex items-center justify-between gap-2 px-3 py-2 bg-primary/10 dark:bg-primary/20 border border-primary/30 dark:border-primary/40 rounded-md text-sm text-primary dark:text-primary\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Gift className=\"h-4 w-4 shrink-0\" />\r\n                  <span>{t(\"community.dailyPointsHint\", \"æ¯æ—¥å‘å¸ƒé¦–ä¸ªå¸–å­å¯è·å¾—5ç§¯åˆ†ï¼\")}</span>\r\n                </div>\r\n                <PostPointsRulesDialog />\r\n              </div>\r\n            )}\r\n\r\n            {/* å†…å®¹è¾“å…¥åŒº */}\r\n            <Textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder={t(\"community.contentPlaceholder\", \"åˆ†äº«ä½ çš„æƒ³æ³•...\")}\r\n              className=\"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base\"\r\n            />\r\n\r\n            {/* å›¾ç‰‡é¢„è§ˆ */}\r\n            {imageUrls.length > 0 && (\r\n              <div className=\"grid grid-cols-3 gap-2\">\r\n                {imageUrls.map((url, index) => (\r\n                  <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden\">\r\n                    <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => removeImage(index)}\r\n                      className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* è§†é¢‘é¢„è§ˆ */}\r\n            {videoUrl && (\r\n              <div className=\"relative rounded-lg overflow-hidden\">\r\n                <video src={videoUrl} controls className=\"w-full max-h-48\" preload=\"metadata\" />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={removeVideo}\r\n                  className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                >\r\n                  <X className=\"h-4 w-4\" />\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* å…³è”ä¿¡æ¯åŒº */}\r\n        <div className=\"px-4 py-2 pb-0 bg-background shrink-0 flex items-center gap-6\">\r\n          {/* é¤å…é€‰æ‹© */}\r\n          <div className=\"flex items-center gap-3\">\r\n            <MapPin className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n            {isMerchant ? (\r\n              <span className=\"text-sm text-muted-foreground\">\r\n                {getMerchantRestaurantName()}\r\n              </span>\r\n            ) : (\r\n              <RestaurantSelectDrawer\r\n                open={restaurantOpen}\r\n                onOpenChange={setRestaurantOpen}\r\n                value={restaurantId}\r\n                onSelect={setRestaurantId}\r\n                restaurants={restaurants || []}\r\n                showNoneOption={isSupervisor || isAdmin}\r\n                required={isRegularUser}\r\n              />\r\n            )}\r\n          </div>\r\n\r\n          {/* æ´»åŠ¨é€‰æ‹© */}\r\n          <div className=\"flex items-center gap-3\">\r\n            <Calendar className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n            <ActivitySelectDrawer\r\n              open={activityOpen}\r\n              onOpenChange={setActivityOpen}\r\n              value={activityId}\r\n              onSelect={setActivityId}\r\n              activities={activeActivities}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* åº•éƒ¨åª’ä½“å·¥å…·æ  - å›ºå®š */}\r\n        <div className=\"flex items-center gap-6 px-4 pt-0 py-2 pb-[max(2rem,calc(env(safe-area-inset-bottom)+1rem))] bg-background shrink-0\">\r\n          <input\r\n            ref={imageInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            multiple\r\n            className=\"hidden\"\r\n            onChange={handleImageUpload}\r\n          />\r\n          <input\r\n            ref={videoInputRef}\r\n            type=\"file\"\r\n            accept=\"video/*\"\r\n            className=\"hidden\"\r\n            onChange={handleVideoUpload}\r\n          />\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => imageInputRef.current?.click()}\r\n            disabled={uploading || imageUrls.length >= 9}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Image className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.photo\", \"ç…§ç‰‡\")}</span>\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => videoInputRef.current?.click()}\r\n            disabled={uploading || !!videoUrl}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Video className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.video\", \"è§†é¢‘\")}</span>\r\n          </button>\r\n\r\n          <EmojiPicker\r\n            onSelect={(emoji) => setContent((prev) => prev + emoji)}\r\n          />\r\n\r\n          {uploading && <Loader2 className=\"h-5 w-5 animate-spin ml-auto\" />}\r\n        </div>\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default CreatePostDialog;\r\n","import { useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport CreatePostDialog from \"@/components/community/CreatePostDialog\";\r\nimport { useCommunityPosts, useCanCreatePost } from \"@/hooks/useCommunityPosts\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n\r\n// Skeleton for grid card\r\nconst PostGridSkeleton = () => <div className=\"rounded-xl overflow-hidden bg-card border border-border/50\">\r\n    <Skeleton className=\"aspect-[4/5] w-full\" />\r\n    <div className=\"p-3 space-y-3\">\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-4 w-full\" />\r\n        <Skeleton className=\"h-4 w-3/4\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-5 w-5 rounded-full\" />\r\n          <Skeleton className=\"h-3 w-16\" />\r\n        </div>\r\n        <Skeleton className=\"h-4 w-10\" />\r\n      </div>\r\n    </div>\r\n  </div>;\r\nconst Community = () => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const {\r\n    data: posts,\r\n    isLoading\r\n  } = useCommunityPosts({\r\n    status: \"approved\"\r\n  });\r\n  const {\r\n    data: canPost\r\n  } = useCanCreatePost();\r\n  const handleRefresh = useCallback(async () => {\r\n    await queryClient.invalidateQueries({\r\n      queryKey: ['community-posts']\r\n    });\r\n  }, [queryClient]);\r\n  return <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in\">\r\n        <div className=\"container mx-auto max-w-4xl\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between mb-6\">\r\n            <div>\r\n              <h1 className=\"text-3xl sm:text-4xl mb-2 text-primary font-medium\">\r\n                {t(\"community.title\", \"ç¤¾åŒº\")}\r\n              </h1>\r\n              <p className=\"text-muted-foreground text-base sm:text-lg\">\r\n                {t(\"community.description\", \"åˆ†äº«ç¾é£Ÿä½“éªŒï¼Œå‘ç°æ›´å¤šç²¾å½©\")}\r\n              </p>\r\n            </div>\r\n            {canPost && <CreatePostDialog trigger={<Button size=\"sm\" className=\"gap-1.5\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"å‘å¸ƒ\")}</span>\r\n                  </Button>} />}\r\n          </div>\r\n\r\n        {/* Content */}\r\n        {isLoading ?\r\n        // Loading skeleton - masonry style\r\n        <div className=\"columns-2 sm:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4\">\r\n            {Array.from({\r\n            length: 6\r\n          }).map((_, i) => <div key={i} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridSkeleton />\r\n              </div>)}\r\n          </div> : posts && posts.length > 0 ?\r\n        // Xiaohongshu-style Masonry Grid\r\n        <div className=\"columns-2 sm:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4\">\r\n            {posts.map(post => <div key={post.id} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridCard post={post} />\r\n              </div>)}\r\n          </div> :\r\n        // Empty state - separate container for proper centering\r\n        <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\r\n            <div className=\"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4\">\r\n              <Plus className=\"w-8 h-8 text-muted-foreground/50\" />\r\n            </div>\r\n            <p className=\"text-muted-foreground text-lg\">{t(\"community.noPosts\", \"æš‚æ— å¸–å­\")}</p>\r\n            {canPost && <p className=\"mt-2 text-sm text-muted-foreground/70\">\r\n                {t(\"community.beFirst\", \"æˆä¸ºç¬¬ä¸€ä¸ªå‘å¸–çš„äººå§ï¼\")}\r\n              </p>}\r\n          </div>}\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>;\r\n};\r\nexport default Community;"],"names":["PostGridCard","post","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","imageError","setImageError","useState","handleLike","e","handleCardClick","getPlainTextContent","html","content","plainContent","hasImages","hasVideo","hasMedia","imageCount","jsxs","jsx","Play","Images","Avatar","AvatarImage","AvatarFallback","Heart","PostPointsRulesDialog","t","settings","usePointsSettings","postPoints","s","minLength","requireMedia","Dialog","DialogTrigger","DialogContent","DialogHeader","DialogTitle","Gift","CheckCircle","Clock","Shield","Command","React.forwardRef","className","props","ref","CommandPrimitive","cn","CommandInput","Search","CommandList","CommandEmpty","CommandGroup","CommandSeparator","CommandItem","RestaurantSelectDrawer","open","onOpenChange","value","onSelect","restaurants","showNoneOption","required","isMobile","useIsMobile","search","setSearch","pendingValue","setPendingValue","drawerHeight","setDrawerHeight","useEffect","viewport","updateHeight","availableHeight","targetHeight","handleOpenChange","newOpen","filteredRestaurants","name","address","searchLower","getSelectedName","selected","r","handleConfirm","handleDesktopSelect","restaurantId","triggerButton","ChevronsUpDown","Fragment","Drawer","DrawerContent","DrawerHeader","DrawerTitle","Input","Check","restaurant","MapPin","DrawerFooter","Button","Popover","PopoverTrigger","PopoverContent","ActivitySelectDrawer","activities","a","activityId","ScrollArea","activity","Calendar","emojiCategories","EmojiPicker","setOpen","activeCategory","setActiveCategory","handleSelect","emoji","categoryLabels","emojiGrid","category","index","Smile","CreatePostDialog","trigger","createPost","useCreatePost","useActivities","useRestaurants","role","isMerchant","isAdmin","isSupervisor","useUserRole","merchantRestaurant","useMerchantRestaurant","hasPostedToday","checkingPost","useHasPostedToday","setContent","imageUrls","setImageUrls","videoUrl","setVideoUrl","setActivityId","setRestaurantId","uploading","setUploading","restaurantOpen","setRestaurantOpen","activityOpen","setActivityOpen","imageInputRef","useRef","videoInputRef","isRegularUser","resetForm","activeActivities","handleImageUpload","files","toast","supabase","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","prev","error","extractVideoFirstFrame","videoFile","resolve","reject","video","canvas","ctx","hasResolved","captureFrame","blob","handleVideoUpload","videoExt","videoFileName","videoError","videoPublicUrl","coverBlob","coverFileName","coverError","coverUrl","removeImage","_","i","removeVideo","handleSubmit","getMerchantRestaurantName","Sheet","SheetTrigger","SheetContent","VisuallyHidden.Root","SheetTitle","ArrowLeft","Loader2","Textarea","url","X","Image","Video","PostGridSkeleton","Skeleton","Community","queryClient","useQueryClient","posts","isLoading","useCommunityPosts","canPost","useCanCreatePost","handleRefresh","useCallback","PullToRefresh","Plus"],"mappings":"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"}