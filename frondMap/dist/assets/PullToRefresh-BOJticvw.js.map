{"version":3,"file":"PullToRefresh-BOJticvw.js","sources":["../../src/hooks/usePullToRefresh.ts","../../src/components/PullToRefresh.tsx"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\r\n\r\ninterface UsePullToRefreshOptions {\r\n  onRefresh: () => Promise<void>;\r\n  threshold?: number;\r\n  maxPull?: number;\r\n}\r\n\r\nexport function usePullToRefresh({\r\n  onRefresh,\r\n  threshold = 80,\r\n  maxPull = 120\r\n}: UsePullToRefreshOptions) {\r\n  const [isPulling, setIsPulling] = useState(false);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [pullDistance, setPullDistance] = useState(0);\r\n  \r\n  const startY = useRef(0);\r\n  const currentY = useRef(0);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  const handleTouchStart = useCallback((e: TouchEvent) => {\r\n    // Only start if we're at the top of the page\r\n    const scrollTop = window.scrollY || document.documentElement.scrollTop;\r\n    if (scrollTop > 5) return;\r\n    \r\n    startY.current = e.touches[0].clientY;\r\n    setIsPulling(true);\r\n  }, []);\r\n\r\n  const handleTouchMove = useCallback((e: TouchEvent) => {\r\n    if (!isPulling || isRefreshing) return;\r\n    \r\n    currentY.current = e.touches[0].clientY;\r\n    const diff = currentY.current - startY.current;\r\n    \r\n    // Only pull down, not up\r\n    if (diff < 0) {\r\n      setPullDistance(0);\r\n      return;\r\n    }\r\n\r\n    // Prevent default to avoid browser's own pull-to-refresh\r\n    if (diff > 10) {\r\n      e.preventDefault();\r\n    }\r\n    \r\n    // Apply resistance for a more natural feel\r\n    const resistance = 0.5;\r\n    const distance = Math.min(diff * resistance, maxPull);\r\n    setPullDistance(distance);\r\n  }, [isPulling, isRefreshing, maxPull]);\r\n\r\n  const handleTouchEnd = useCallback(async () => {\r\n    if (!isPulling) return;\r\n    \r\n    setIsPulling(false);\r\n    \r\n    if (pullDistance >= threshold && !isRefreshing) {\r\n      setIsRefreshing(true);\r\n      setPullDistance(threshold); // Keep at threshold during refresh\r\n      \r\n      try {\r\n        await onRefresh();\r\n      } finally {\r\n        setIsRefreshing(false);\r\n        setPullDistance(0);\r\n      }\r\n    } else {\r\n      setPullDistance(0);\r\n    }\r\n  }, [isPulling, pullDistance, threshold, isRefreshing, onRefresh]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    // Use passive: false to allow preventDefault\r\n    container.addEventListener('touchstart', handleTouchStart, { passive: true });\r\n    container.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n    container.addEventListener('touchend', handleTouchEnd, { passive: true });\r\n\r\n    return () => {\r\n      container.removeEventListener('touchstart', handleTouchStart);\r\n      container.removeEventListener('touchmove', handleTouchMove);\r\n      container.removeEventListener('touchend', handleTouchEnd);\r\n    };\r\n  }, [handleTouchStart, handleTouchMove, handleTouchEnd]);\r\n\r\n  const progress = Math.min(pullDistance / threshold, 1);\r\n\r\n  return {\r\n    containerRef,\r\n    isPulling,\r\n    isRefreshing,\r\n    pullDistance,\r\n    progress\r\n  };\r\n}\r\n","import { ReactNode } from 'react';\r\nimport { RefreshCw } from 'lucide-react';\r\nimport { usePullToRefresh } from '@/hooks/usePullToRefresh';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface PullToRefreshProps {\r\n  children: ReactNode;\r\n  onRefresh: () => Promise<void>;\r\n  className?: string;\r\n}\r\n\r\nexport function PullToRefresh({ children, onRefresh, className }: PullToRefreshProps) {\r\n  const { containerRef, isRefreshing, pullDistance, progress } = usePullToRefresh({\r\n    onRefresh,\r\n    threshold: 80,\r\n    maxPull: 120\r\n  });\r\n\r\n  return (\r\n    <div ref={containerRef} className={cn(\"relative\", className)}>\r\n      {/* Pull indicator */}\r\n      <div \r\n        className=\"absolute left-1/2 -translate-x-1/2 z-50 flex items-center justify-center transition-opacity duration-200 pointer-events-none\"\r\n        style={{ \r\n          top: Math.max(pullDistance - 50, 8),\r\n          opacity: pullDistance > 20 ? 1 : 0\r\n        }}\r\n      >\r\n        <div className={cn(\r\n          \"w-10 h-10 rounded-full bg-background/90 backdrop-blur-sm shadow-lg flex items-center justify-center border border-border/50\",\r\n          isRefreshing && \"animate-pulse\"\r\n        )}>\r\n          <RefreshCw \r\n            className={cn(\r\n              \"w-5 h-5 text-primary transition-transform duration-200\",\r\n              isRefreshing && \"animate-spin\"\r\n            )}\r\n            style={{ \r\n              transform: isRefreshing \r\n                ? undefined \r\n                : `rotate(${progress * 360}deg)` \r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Content with pull transform */}\r\n      <div \r\n        style={{ \r\n          transform: pullDistance > 0 ? `translateY(${pullDistance}px)` : undefined,\r\n          transition: pullDistance === 0 ? 'transform 0.3s ease-out' : undefined\r\n        }}\r\n      >\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["usePullToRefresh","onRefresh","threshold","maxPull","isPulling","setIsPulling","useState","isRefreshing","setIsRefreshing","pullDistance","setPullDistance","startY","useRef","currentY","containerRef","handleTouchStart","useCallback","handleTouchMove","diff","distance","handleTouchEnd","useEffect","container","progress","PullToRefresh","children","className","jsxs","cn","jsx","RefreshCw"],"mappings":"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"}