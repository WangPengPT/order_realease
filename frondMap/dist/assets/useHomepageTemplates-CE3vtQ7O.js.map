{"version":3,"file":"useHomepageTemplates-CE3vtQ7O.js","sources":["../../src/hooks/useHomepageTemplates.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport interface HomepageTemplate {\r\n  id: string;\r\n  sort_order: number;\r\n  is_active: boolean;\r\n  media_type: 'image' | 'video';\r\n  // Per-device media type\r\n  desktop_media_type: 'image' | 'video';\r\n  tablet_media_type: 'image' | 'video';\r\n  mobile_media_type: 'image' | 'video';\r\n  desktop_image_url: string | null;\r\n  tablet_image_url: string | null;\r\n  mobile_image_url: string | null;\r\n  desktop_video_url: string | null;\r\n  tablet_video_url: string | null;\r\n  mobile_video_url: string | null;\r\n  overlay_opacity: number;\r\n  overlay_gradient_direction: string;\r\n  overlay_gradient_from: string;\r\n  overlay_gradient_from_opacity: number;\r\n  overlay_gradient_via: string;\r\n  overlay_gradient_via_opacity: number;\r\n  overlay_gradient_to: string;\r\n  overlay_gradient_to_opacity: number;\r\n  background_blur: number;\r\n  desktop_overlay_opacity: number | null;\r\n  tablet_overlay_opacity: number | null;\r\n  mobile_overlay_opacity: number | null;\r\n  title_zh: string;\r\n  title_en: string;\r\n  title_pt: string;\r\n  subtitle_zh: string;\r\n  subtitle_en: string;\r\n  subtitle_pt: string;\r\n  description_zh: string;\r\n  description_en: string;\r\n  description_pt: string;\r\n  primary_button_text_zh: string;\r\n  primary_button_text_en: string;\r\n  primary_button_text_pt: string;\r\n  primary_button_link: string;\r\n  primary_button_variant: string;\r\n  secondary_button_text_zh: string;\r\n  secondary_button_text_en: string;\r\n  secondary_button_text_pt: string;\r\n  secondary_button_link: string;\r\n  secondary_button_variant: string;\r\n  subtitle_button_text_zh: string | null;\r\n  subtitle_button_text_en: string | null;\r\n  subtitle_button_text_pt: string | null;\r\n  subtitle_button_link: string | null;\r\n  duration: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport const useHomepageTemplates = () => {\r\n  return useQuery({\r\n    queryKey: [\"homepage-templates\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"homepage_templates\")\r\n        .select(\"*\")\r\n        .order(\"sort_order\", { ascending: true });\r\n\r\n      if (error) throw error;\r\n      return data as HomepageTemplate[];\r\n    },\r\n    staleTime: 1000 * 60 * 5, // 5 minutes - won't refetch if data is fresh\r\n    gcTime: 1000 * 60 * 30,   // 30 minutes - keep in cache\r\n  });\r\n};\r\n\r\nexport const useActiveHomepageTemplates = () => {\r\n  return useQuery({\r\n    queryKey: [\"homepage-templates\", \"active\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"homepage_templates\")\r\n        .select(\"*\")\r\n        .eq(\"is_active\", true)\r\n        .order(\"sort_order\", { ascending: true });\r\n\r\n      if (error) throw error;\r\n      return data as HomepageTemplate[];\r\n    },\r\n    staleTime: 1000 * 60 * 5, // 5 minutes - won't refetch if data is fresh\r\n    gcTime: 1000 * 60 * 30,   // 30 minutes - keep in cache\r\n  });\r\n};\r\n\r\nexport const useCreateHomepageTemplate = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (template: Partial<HomepageTemplate>) => {\r\n      const { data, error } = await supabase\r\n        .from(\"homepage_templates\")\r\n        .insert(template)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"homepage-templates\"] });\r\n      toast.success(\"模板创建成功\");\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Failed to create template:\", error);\r\n      toast.error(\"创建失败\");\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateHomepageTemplate = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ id, ...template }: Partial<HomepageTemplate> & { id: string }) => {\r\n      const { data, error } = await supabase\r\n        .from(\"homepage_templates\")\r\n        .update(template)\r\n        .eq(\"id\", id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"homepage-templates\"] });\r\n      toast.success(\"模板更新成功\");\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Failed to update template:\", error);\r\n      toast.error(\"更新失败\");\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteHomepageTemplate = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"homepage_templates\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"homepage-templates\"] });\r\n      toast.success(\"模板删除成功\");\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Failed to delete template:\", error);\r\n      toast.error(\"删除失败\");\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUploadTemplateImage = () => {\r\n  return useMutation({\r\n    mutationFn: async ({ file, type, templateId }: { file: File; type: \"desktop\" | \"tablet\" | \"mobile\"; templateId: string }) => {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `template-${templateId}-${type}-${Date.now()}.${fileExt}`;\r\n      const filePath = fileName;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"homepage-images\")\r\n        .upload(filePath, file, { upsert: true });\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"homepage-images\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return { type, url: publicUrl };\r\n    },\r\n    onSuccess: ({ type }) => {\r\n      toast.success(`${type}图片上传成功`);\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Failed to upload image:\", error);\r\n      toast.error(\"图片上传失败\");\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUploadTemplateVideo = () => {\r\n  return useMutation({\r\n    mutationFn: async ({ file, type, templateId }: { file: File; type: \"desktop\" | \"tablet\" | \"mobile\"; templateId: string }) => {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `template-${templateId}-${type}-video-${Date.now()}.${fileExt}`;\r\n      const filePath = fileName;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"homepage-images\")\r\n        .upload(filePath, file, { upsert: true });\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"homepage-images\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return { type, url: publicUrl };\r\n    },\r\n    onSuccess: ({ type }) => {\r\n      toast.success(`${type}视频上传成功`);\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Failed to upload video:\", error);\r\n      toast.error(\"视频上传失败\");\r\n    },\r\n  });\r\n};\r\n"],"names":["useHomepageTemplates","useQuery","data","error","supabase","useActiveHomepageTemplates","useCreateHomepageTemplate","queryClient","useQueryClient","useMutation","template","toast","useUpdateHomepageTemplate","id","useDeleteHomepageTemplate","useUploadTemplateImage","file","type","templateId","fileExt","filePath","uploadError","publicUrl","useUploadTemplateVideo"],"mappings":"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"}