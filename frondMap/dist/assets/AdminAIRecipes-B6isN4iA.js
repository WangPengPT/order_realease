import{p as z,q as L,r as u,s as Q,v as w,j as e,a_ as K,aZ as M,bi as P,bS as O,c$ as $,ak as J,w as C}from"./vendor-react-87iFmKFJ.js";import{B as t,I as d,C as U,n as Z,h as o,D as S,c as T,d as I,e as k,$ as G,s as g}from"./index-CQ-le21e.js";import{S as D}from"./switch-n9orWbz0.js";import{T as V,a as W,b as p,c as l,d as X,e as n}from"./table-TVryfYlQ.js";import{H as Y,J as ee}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CQWbleDe.js";const de=()=>{const{t:q}=z(),f=L(),[m,A]=u.useState(""),[j,x]=u.useState(null),[r,v]=u.useState(null),[a,c]=u.useState({recipe_name:"",recipe_name_en:"",recipe_name_pt:"",image_url:"",is_approved:!0}),{data:N=[],isLoading:E}=Q({queryKey:["admin-ai-recipes"],queryFn:async()=>{const{data:s,error:i}=await g.from("ai_recipe_cache").select("*").order("created_at",{ascending:!1});if(i)throw i;return s}}),F=w({mutationFn:async s=>{const{error:i}=await g.from("ai_recipe_cache").delete().eq("id",s);if(i)throw i},onSuccess:()=>{f.invalidateQueries({queryKey:["admin-ai-recipes"]}),C.success("已删除")}}),_=w({mutationFn:async({id:s,updates:i})=>{const{error:h}=await g.from("ai_recipe_cache").update(i).eq("id",s);if(h)throw h},onSuccess:()=>{f.invalidateQueries({queryKey:["admin-ai-recipes"]}),x(null),C.success("已更新")}}),B=s=>{x(s),c({recipe_name:s.recipe_name,recipe_name_en:s.recipe_name_en||"",recipe_name_pt:s.recipe_name_pt||"",image_url:s.image_url||"",is_approved:s.is_approved})},H=()=>{j&&_.mutate({id:j.id,updates:{recipe_name:a.recipe_name,recipe_name_en:a.recipe_name_en||null,recipe_name_pt:a.recipe_name_pt||null,image_url:a.image_url||null,is_approved:a.is_approved}})},R=s=>{_.mutate({id:s.id,updates:{is_approved:!s.is_approved}})},b=N.filter(s=>!m||s.recipe_name.includes(m)||s.recipe_name_en?.toLowerCase().includes(m.toLowerCase())),y=s=>{if(!s)return null;const i={easy:"bg-green-500/20 text-green-700",medium:"bg-yellow-500/20 text-yellow-700",hard:"bg-red-500/20 text-red-700"},h={easy:"简单",medium:"中等",hard:"困难"};return e.jsx(t,{className:i[s]||"",children:h[s]||s})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(K,{className:"h-6 w-6"}),q("admin.aiRecipes.title","AI食谱缓存管理")]}),e.jsxs(t,{variant:"secondary",children:[N.length," 条记录"]})]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"搜索食谱名称...",value:m,onChange:s=>A(s.target.value),className:"pl-9"})]}),e.jsx(U,{children:e.jsx(Z,{className:"p-0",children:e.jsxs(V,{children:[e.jsx(W,{children:e.jsxs(p,{children:[e.jsx(l,{className:"w-16",children:"图片"}),e.jsx(l,{children:"食谱名称"}),e.jsx(l,{className:"hidden md:table-cell",children:"难度"}),e.jsx(l,{className:"hidden md:table-cell",children:"来源"}),e.jsx(l,{className:"hidden md:table-cell",children:"创建时间"}),e.jsx(l,{children:"状态"}),e.jsx(l,{className:"text-right",children:"操作"})]})}),e.jsx(X,{children:E?e.jsx(p,{children:e.jsx(n,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"加载中..."})}):b.length===0?e.jsx(p,{children:e.jsx(n,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"暂无数据"})}):b.map(s=>e.jsxs(p,{children:[e.jsx(n,{children:s.image_url?e.jsx("img",{src:s.image_url,alt:"",className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded bg-muted flex items-center justify-center",children:e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsxs(n,{children:[e.jsx("div",{className:"font-medium",children:s.recipe_name}),s.recipe_name_en&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.recipe_name_en})]}),e.jsx(n,{className:"hidden md:table-cell",children:y(s.difficulty)}),e.jsx(n,{className:"hidden md:table-cell",children:e.jsx(t,{variant:"outline",children:s.image_source==="web"?"网络":s.image_source==="ai"?"AI":"无"})}),e.jsx(n,{className:"hidden md:table-cell text-sm text-muted-foreground",children:Y(new Date(s.created_at),{addSuffix:!0,locale:ee})}),e.jsx(n,{children:e.jsx(D,{checked:s.is_approved,onCheckedChange:()=>R(s)})}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>v(s),children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>B(s),children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>{confirm("确定删除？")&&F.mutate(s.id)},children:e.jsx(J,{className:"h-4 w-4"})})]})})]},s.id))})]})})}),e.jsx(S,{open:!!j,onOpenChange:()=>x(null),children:e.jsxs(T,{children:[e.jsx(I,{children:e.jsx(k,{children:"编辑食谱"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"中文名称"}),e.jsx(d,{value:a.recipe_name,onChange:s=>c({...a,recipe_name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"英文名称"}),e.jsx(d,{value:a.recipe_name_en,onChange:s=>c({...a,recipe_name_en:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"葡文名称"}),e.jsx(d,{value:a.recipe_name_pt,onChange:s=>c({...a,recipe_name_pt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"图片URL"}),e.jsx(d,{value:a.image_url,onChange:s=>c({...a,image_url:s.target.value})}),a.image_url&&e.jsx("img",{src:a.image_url,alt:"",className:"mt-2 w-full max-h-40 object-cover rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{checked:a.is_approved,onCheckedChange:s=>c({...a,is_approved:s})}),e.jsx("label",{className:"text-sm",children:"启用（对用户可见）"})]})]}),e.jsxs(G,{children:[e.jsx(o,{variant:"outline",onClick:()=>x(null),children:"取消"}),e.jsx(o,{onClick:H,disabled:_.isPending,children:"保存"})]})]})}),e.jsx(S,{open:!!r,onOpenChange:()=>v(null),children:e.jsxs(T,{className:"max-w-lg max-h-[80vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsx(k,{children:r?.recipe_name})}),r&&e.jsxs("div",{className:"space-y-4",children:[r.image_url&&e.jsx("img",{src:r.image_url,alt:"",className:"w-full rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[y(r.difficulty),r.servings&&e.jsxs(t,{variant:"outline",children:[r.servings,"人份"]}),e.jsx(t,{variant:"outline",children:r.image_source==="web"?"网络图片":"AI图片"})]}),r.recipe_data?.introduction&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.recipe_data.introduction}),r.recipe_data?.ingredients&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"食材"}),e.jsx("ul",{className:"text-sm space-y-1",children:r.recipe_data.ingredients.map((s,i)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:"text-muted-foreground",children:[s.amount," ",s.unit]})]},i))})]}),r.recipe_data?.steps&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"步骤"}),e.jsx("ol",{className:"text-sm space-y-2",children:r.recipe_data.steps.sort((s,i)=>s.order-i.order).map((s,i)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-bold text-primary",children:[s.order,"."]}),e.jsx("span",{children:s.description})]},i))})]})]})]})})]})};export{de as default};
//# sourceMappingURL=AdminAIRecipes-B6isN4iA.js.map
