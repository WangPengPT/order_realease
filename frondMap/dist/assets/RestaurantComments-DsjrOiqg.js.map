{"version":3,"file":"RestaurantComments-DsjrOiqg.js","sources":["../../src/components/TranslatableText.tsx","../../src/components/RestaurantComments.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\n\r\ninterface TranslatableTextProps {\r\n  text: string;\r\n  className?: string;\r\n}\r\n\r\nconst TranslatableText = ({ text, className }: TranslatableTextProps) => {\r\n  const [translatedText, setTranslatedText] = useState<string | null>(null);\r\n\r\n  return (\r\n    <div className={className}>\r\n      <p className=\"text-xs sm:text-sm text-foreground break-words\">\r\n        {translatedText || text}\r\n      </p>\r\n      <TranslateButton \r\n        text={text} \r\n        onTranslation={setTranslatedText}\r\n        className=\"mt-0.5\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TranslatableText;\r\n","import { useState, useCallback, useMemo, memo } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { useComments, useAddComment, useDeleteComment, Comment } from \"@/hooks/useComments\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useCheckSensitiveWords } from \"@/hooks/useSensitiveWords\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { MessageSquare, Trash2, Reply, Image as ImageIcon, X, Star, DollarSign, ShieldAlert, VolumeX, Clock, AlertCircle } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport ReportDialog from \"@/components/ReportDialog\";\r\nimport TranslatableText from \"@/components/TranslatableText\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface RestaurantCommentsProps {\r\n  restaurantId?: string;\r\n  targetId?: string;\r\n  targetType?: \"restaurant\" | \"activity\" | \"post\";\r\n}\r\n\r\nconst priceRanges = [\r\n  { value: \"0-5\", label: \"0-5€\" },\r\n  { value: \"5-10\", label: \"5-10€\" },\r\n  { value: \"10-15\", label: \"10-15€\" },\r\n  { value: \"15-20\", label: \"15-20€\" },\r\n  { value: \"20-25\", label: \"20-25€\" },\r\n  { value: \"25-30\", label: \"25-30€\" },\r\n  { value: \"30-40\", label: \"30-40€\" },\r\n  { value: \"40-50\", label: \"40-50€\" },\r\n  { value: \"50+\", label: \"50€+\" },\r\n];\r\n\r\n// Component for comment image with long image detection\r\nconst CommentImage = memo(({ imageUrl, onPreview }: { imageUrl: string; onPreview: () => void }) => {\r\n  const { t } = useTranslation();\r\n  const [isLongImage, setIsLongImage] = useState(false);\r\n  const [imageLoaded, setImageLoaded] = useState(false);\r\n\r\n  const handleImageLoad = useCallback((e: React.SyntheticEvent<HTMLImageElement>) => {\r\n    const img = e.currentTarget;\r\n    const aspectRatio = img.naturalHeight / img.naturalWidth;\r\n    setIsLongImage(aspectRatio > 1.5);\r\n    setImageLoaded(true);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"relative mt-2 inline-block max-w-full sm:max-w-sm w-full\">\r\n      <img\r\n        src={imageUrl}\r\n        alt=\"Comment attachment\"\r\n        className=\"rounded-lg w-full max-h-[300px] sm:max-h-[400px] object-cover object-top cursor-pointer hover:opacity-90 transition-opacity\"\r\n        onClick={onPreview}\r\n        onLoad={handleImageLoad}\r\n      />\r\n      {imageLoaded && isLongImage && (\r\n        <Badge \r\n          variant=\"secondary\" \r\n          className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-1.5 py-0.5\"\r\n        >\r\n          {t(\"community.longImage\", \"长图\")}\r\n        </Badge>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\nCommentImage.displayName = \"CommentImage\";\r\n\r\nconst RestaurantComments = ({ restaurantId, targetId, targetType = \"restaurant\" }: RestaurantCommentsProps) => {\r\n  // Support both old prop name (restaurantId) and new prop name (targetId)\r\n  const actualTargetId = targetId || restaurantId || \"\";\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { data: profile } = useProfile();\r\n  const { isAdmin } = useUserRole();\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n  const [newComment, setNewComment] = useState(\"\");\r\n  const [rating, setRating] = useState(0);\r\n  const [hoverRating, setHoverRating] = useState(0);\r\n  const [priceRange, setPriceRange] = useState(\"\");\r\n  const [replyTo, setReplyTo] = useState<string | null>(null);\r\n  const [replyContent, setReplyContent] = useState(\"\");\r\n  const [commentImage, setCommentImage] = useState<File | null>(null);\r\n  const [commentImagePreview, setCommentImagePreview] = useState<string | null>(null);\r\n  const [replyImage, setReplyImage] = useState<File | null>(null);\r\n  const [replyImagePreview, setReplyImagePreview] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\r\n  const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n\r\n  const { data: comments, isLoading } = useComments(actualTargetId, targetType);\r\n  const addComment = useAddComment();\r\n  const deleteComment = useDeleteComment();\r\n  const { checkContent } = useCheckSensitiveWords();\r\n\r\n  const uploadImage = useCallback(async (file: File): Promise<string | null> => {\r\n    try {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user?.id}-${Date.now()}.${fileExt}`;\r\n      const filePath = `${fileName}`;\r\n\r\n      const { error: uploadError, data } = await supabase.storage\r\n        .from(\"comment-images\")\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"comment-images\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return publicUrl;\r\n    } catch (error) {\r\n      console.error(\"Error uploading image:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.imageUploadFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return null;\r\n    }\r\n  }, [user, toast, t]);\r\n\r\n  const handleImageSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, isReply: boolean = false) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: t(\"restaurant.imageTooLarge\"),\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (isReply) {\r\n        setReplyImage(file);\r\n        setReplyImagePreview(URL.createObjectURL(file));\r\n      } else {\r\n        setCommentImage(file);\r\n        setCommentImagePreview(URL.createObjectURL(file));\r\n      }\r\n    }\r\n  }, [toast, t]);\r\n\r\n  const clearImage = useCallback((isReply: boolean = false) => {\r\n    if (isReply) {\r\n      setReplyImage(null);\r\n      setReplyImagePreview(null);\r\n    } else {\r\n      setCommentImage(null);\r\n      setCommentImagePreview(null);\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmitComment = useCallback(async () => {\r\n    if (!newComment.trim() || !user) return;\r\n    \r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(newComment);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // For restaurant comments, require rating\r\n    if (targetType === \"restaurant\" && !rating) {\r\n      toast({\r\n        title: t(\"common.hint\", \"提示\"),\r\n        description: t(\"toast.pleaseSelectRating\"),\r\n        variant: \"warning\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (commentImage) {\r\n      const uploadedUrl = await uploadImage(commentImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: newComment,\r\n      ratingValue: targetType === \"restaurant\" ? rating : undefined,\r\n      priceRange: targetType === \"restaurant\" && priceRange ? priceRange : undefined,\r\n      imageUrl,\r\n    });\r\n\r\n    setNewComment(\"\");\r\n    setRating(0);\r\n    setPriceRange(\"\");\r\n    setCommentImage(null);\r\n    setCommentImagePreview(null);\r\n    setUploading(false);\r\n  }, [newComment, user, profile, targetType, rating, toast, t, commentImage, uploadImage, addComment, restaurantId, priceRange, checkContent]);\r\n\r\n  const handleSubmitReply = useCallback(async (parentId: string) => {\r\n    if (!replyContent.trim() || !user) return;\r\n\r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(replyContent);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (replyImage) {\r\n      const uploadedUrl = await uploadImage(replyImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: replyContent,\r\n      parentId,\r\n      imageUrl,\r\n    });\r\n\r\n    setReplyContent(\"\");\r\n    setReplyTo(null);\r\n    setReplyImage(null);\r\n    setReplyImagePreview(null);\r\n    setUploading(false);\r\n  }, [replyContent, user, profile, replyImage, uploadImage, addComment, restaurantId, targetType, checkContent, toast, t]);\r\n\r\n  const handleDeleteComment = useCallback(async (commentId: string) => {\r\n    await deleteComment.mutateAsync(commentId);\r\n    setDeleteConfirmId(null);\r\n  }, [deleteComment]);\r\n\r\n  const CommentItem = memo(({ comment, isReply = false }: { comment: Comment; isReply?: boolean }) => (\r\n    <div className={`flex gap-2 sm:gap-3 ${isReply ? \"ml-8 sm:ml-12 mt-3\" : \"\"}`}>\r\n      <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n        <AvatarImage src={comment.profiles?.avatar_url} />\r\n        <AvatarFallback className=\"text-xs sm:text-sm\">\r\n          {comment.profiles?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n        </AvatarFallback>\r\n      </Avatar>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <div className=\"flex items-center gap-2 flex-wrap\">\r\n          <span className=\"font-semibold text-xs sm:text-sm truncate\">{comment.profiles?.display_name}</span>\r\n          <span className=\"text-xs text-muted-foreground shrink-0\">\r\n            {formatDistanceToNow(new Date(comment.created_at), { addSuffix: true })}\r\n          </span>\r\n          {comment.edited && (\r\n            <span className=\"text-xs text-muted-foreground italic\">({t(\"restaurant.edited\")})</span>\r\n          )}\r\n          {/* Show moderation status badges for user's own comments */}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"pending\" && (\r\n            <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs py-0 h-5\">\r\n              <Clock className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentPending\", \"审核中\")}\r\n            </Badge>\r\n          )}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"flagged\" && (\r\n            <Badge variant=\"outline\" className=\"text-destructive border-destructive bg-destructive/10 text-xs py-0 h-5\">\r\n              <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentFailed\", \"发送失败\")}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Display rating and price range for main comments */}\r\n        {!isReply && comment.rating_value && (\r\n          <div className=\"flex items-center gap-3 mt-1 mb-2\">\r\n            <div className=\"flex items-center gap-1\">\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                  key={star}\r\n                  className={cn(\r\n                    \"w-4 h-4\",\r\n                    star <= comment.rating_value!\r\n                      ? \"fill-accent text-accent\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                />\r\n              ))}\r\n            </div>\r\n            {comment.price_range && (\r\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                <DollarSign className=\"w-3 h-3\" />\r\n                <span>{priceRanges.find(r => r.value === comment.price_range)?.label}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        <TranslatableText text={comment.content} className=\"mt-1\" />\r\n        {comment.image_url && (\r\n          <CommentImage \r\n            imageUrl={comment.image_url} \r\n            onPreview={() => setPreviewImageUrl(comment.image_url!)} \r\n          />\r\n        )}\r\n        <div className=\"flex gap-2 sm:gap-3 mt-2\">\r\n          {!isReply && user && !profile?.is_muted && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setReplyTo(comment.id)}\r\n              className=\"h-7 text-xs px-2 sm:px-3\"\r\n            >\r\n              <Reply className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"restaurant.reply\")}</span>\r\n            </Button>\r\n          )}\r\n          {(user?.id === comment.user_id || isAdmin) && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setDeleteConfirmId(comment.id)}\r\n              className=\"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3\"\r\n            >\r\n              <Trash2 className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"common.delete\")}</span>\r\n            </Button>\r\n          )}\r\n          {user?.id !== comment.user_id && (\r\n            <ReportDialog\r\n              targetType=\"comment\"\r\n              targetId={comment.id}\r\n              onLoginRequired={() => setShowLoginDialog(true)}\r\n              trigger={\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"h-7 text-xs px-2 sm:px-3\"\r\n                >\r\n                  <ShieldAlert className=\"w-3 h-3 mr-1\" />\r\n                  <span className=\"hidden xs:inline\">{t(\"report.title\")}</span>\r\n                </Button>\r\n              }\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {replyTo === comment.id && (\r\n          <div className=\"mt-3 space-y-2\">\r\n            <div className=\"flex flex-col sm:flex-row gap-2\">\r\n              <div className=\"flex-1 space-y-2\">\r\n                <Textarea\r\n                  value={replyContent}\r\n                  onChange={(e) => setReplyContent(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeReply\")}\r\n                  className=\"min-h-[80px] text-sm\"\r\n                />\r\n                  {replyImagePreview && (\r\n                  <div className=\"relative inline-block\">\r\n                    <img\r\n                      src={replyImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"w-24 h-24 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity\"\r\n                      onClick={() => setPreviewImageUrl(replyImagePreview)}\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(true)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"flex sm:flex-col gap-2\">\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => handleSubmitReply(comment.id)}\r\n                  disabled={!replyContent.trim() || uploading}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {uploading ? t(\"common.loading\") : t(\"restaurant.reply\")}\r\n                </Button>\r\n                <Input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => handleImageSelect(e, true)}\r\n                  className=\"hidden\"\r\n                  id={`reply-image-${comment.id}`}\r\n                  disabled={uploading}\r\n                />\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => document.getElementById(`reply-image-${comment.id}`)?.click()}\r\n                  disabled={uploading}\r\n                  className=\"text-xs sm:px-3\"\r\n                >\r\n                  <ImageIcon className=\"h-4 w-4 sm:mr-1\" />\r\n                  <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setReplyTo(null);\r\n                    setReplyContent(\"\");\r\n                    clearImage(true);\r\n                  }}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {t(\"common.cancel\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {comment.replies && comment.replies.length > 0 && (\r\n          <div className=\"mt-3 space-y-3\">\r\n            {comment.replies.map((reply) => (\r\n              <CommentItem key={reply.id} comment={reply} isReply />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  ));\r\n  CommentItem.displayName = \"CommentItem\";\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-center py-8\">{t(\"common.loading\")}</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"space-y-4 sm:space-y-6\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <MessageSquare className=\"w-4 sm:w-5 h-4 sm:h-5\" />\r\n        <h2 className=\"text-xl sm:text-2xl font-bold\">\r\n          {t(\"restaurant.reviews\")} ({comments?.length || 0})\r\n        </h2>\r\n      </div>\r\n\r\n      {user ? (\r\n        profile?.is_muted ? (\r\n          <Card className=\"border-yellow-300 bg-yellow-50/50 dark:bg-yellow-950/20\">\r\n            <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6\">\r\n              <div className=\"flex items-center gap-3 text-yellow-600 dark:text-yellow-400\">\r\n                <VolumeX className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-sm font-medium\">{t(\"restaurant.youAreMutedNotice\")}</span>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n        <Card>\r\n          <CardContent className=\"pt-4 sm:pt-6 px-3 sm:px-6\">\r\n            <div className=\"flex gap-2 sm:gap-3\">\r\n              <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n                <AvatarImage src={profile?.avatar_url || undefined} />\r\n                <AvatarFallback className=\"text-xs sm:text-sm\">\r\n                  {profile?.display_name?.charAt(0).toUpperCase() || user?.email?.charAt(0).toUpperCase() || \"U\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"flex-1 space-y-2 sm:space-y-3 min-w-0\">\r\n                {/* Rating and Price Range - Only for restaurant */}\r\n                {targetType === \"restaurant\" && (\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <Star className=\"w-4 h-4 text-accent\" />\r\n                        评分 <span className=\"text-destructive\">*</span>\r\n                      </label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {[1, 2, 3, 4, 5].map((star) => (\r\n                          <button\r\n                            key={star}\r\n                            type=\"button\"\r\n                            onMouseEnter={() => setHoverRating(star)}\r\n                            onMouseLeave={() => setHoverRating(0)}\r\n                            onClick={() => setRating(star)}\r\n                            className=\"transition-transform hover:scale-110\"\r\n                          >\r\n                            <Star\r\n                              className={cn(\r\n                                \"w-7 h-7 cursor-pointer transition-colors\",\r\n                                star <= (hoverRating || rating)\r\n                                  ? \"fill-accent text-accent\"\r\n                                  : \"text-muted-foreground hover:text-accent\"\r\n                              )}\r\n                            />\r\n                          </button>\r\n                        ))}\r\n                        {rating > 0 && (\r\n                          <span className=\"ml-2 text-sm text-muted-foreground\">\r\n                            ({rating}/5)\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <DollarSign className=\"w-4 h-4\" />\r\n                        {t(\"restaurant.priceRange\")}\r\n                      </label>\r\n                      <Select value={priceRange} onValueChange={setPriceRange}>\r\n                        <SelectTrigger className=\"w-full\">\r\n                          <SelectValue placeholder={t(\"restaurant.selectPriceRange\")} />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-background\">\r\n                          {priceRanges.map((range) => (\r\n                            <SelectItem key={range.value} value={range.value}>\r\n                              {range.label}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <Textarea\r\n                  value={newComment}\r\n                  onChange={(e) => setNewComment(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeComment\")}\r\n                  className=\"min-h-[80px] sm:min-h-[100px] text-sm\"\r\n                />\r\n                {commentImagePreview && (\r\n                  <div className=\"relative inline-block\">\r\n                    <img\r\n                      src={commentImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"w-24 h-24 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity\"\r\n                      onClick={() => setPreviewImageUrl(commentImagePreview)}\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(false)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  <Input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={(e) => handleImageSelect(e, false)}\r\n                    className=\"hidden\"\r\n                    id=\"comment-image\"\r\n                    disabled={uploading}\r\n                  />\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => document.getElementById(\"comment-image\")?.click()}\r\n                    disabled={uploading}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    <ImageIcon className=\"h-4 w-4 sm:mr-2\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                  </Button>\r\n                  <Button\r\n                    onClick={handleSubmitComment}\r\n                    disabled={!newComment.trim() || addComment.isPending || uploading}\r\n                    size=\"sm\"\r\n                    className=\"text-xs\"\r\n                  >\r\n                    {uploading || addComment.isPending ? t(\"common.loading\") : t(\"restaurant.postComment\")}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        )\r\n      ) : (\r\n        <Card>\r\n          <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.signInToComment\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <div className=\"space-y-4 sm:space-y-6\">\r\n        {comments?.map((comment) => (\r\n          <Card key={comment.id}>\r\n            <CardHeader className=\"p-3 sm:p-6\">\r\n              <CommentItem comment={comment} />\r\n            </CardHeader>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {comments?.length === 0 && (\r\n        <Card>\r\n          <CardContent className=\"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.noComments\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n\r\n    {/* Login Required Dialog */}\r\n    <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n          <AlertDialogDescription>\r\n            {t(\"activities.loginRequiredMessage\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n          <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n            {t(\"activities.goToLogin\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n\r\n    {/* Delete Comment Confirmation Dialog */}\r\n    <AlertDialog open={!!deleteConfirmId} onOpenChange={(open) => !open && setDeleteConfirmId(null)}>\r\n      <AlertDialogContent className=\"max-w-sm\">\r\n        <AlertDialogHeader>\r\n          <div className=\"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-destructive/10\">\r\n            <Trash2 className=\"h-7 w-7 text-destructive\" />\r\n          </div>\r\n          <AlertDialogTitle className=\"text-center\">\r\n            {t(\"restaurant.deleteComment\")}\r\n          </AlertDialogTitle>\r\n          <AlertDialogDescription className=\"text-center\">\r\n            {t(\"restaurant.confirmDelete\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter className=\"sm:justify-center gap-2\">\r\n          <AlertDialogCancel className=\"sm:w-24\">\r\n            {t(\"common.cancel\")}\r\n          </AlertDialogCancel>\r\n          <AlertDialogAction\r\n            onClick={() => deleteConfirmId && handleDeleteComment(deleteConfirmId)}\r\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90 sm:w-24\"\r\n          >\r\n            {t(\"common.delete\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n    \r\n    {/* Image Preview Modal */}\r\n    <ImagePreviewModal\r\n      imageUrl={previewImageUrl || \"\"}\r\n      isOpen={!!previewImageUrl}\r\n      onClose={() => setPreviewImageUrl(null)}\r\n    />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RestaurantComments;\r\n"],"names":["TranslatableText","text","className","translatedText","setTranslatedText","useState","jsxs","jsx","TranslateButton","priceRanges","CommentImage","memo","imageUrl","onPreview","t","useTranslation","isLongImage","setIsLongImage","imageLoaded","setImageLoaded","handleImageLoad","useCallback","e","img","aspectRatio","Badge","RestaurantComments","restaurantId","targetId","targetType","actualTargetId","user","useAuth","profile","useProfile","isAdmin","useUserRole","toast","useToast","navigate","useNavigate","newComment","setNewComment","rating","setRating","hoverRating","setHoverRating","priceRange","setPriceRange","replyTo","setReplyTo","replyContent","setReplyContent","commentImage","setCommentImage","commentImagePreview","setCommentImagePreview","replyImage","setReplyImage","replyImagePreview","setReplyImagePreview","uploading","setUploading","showLoginDialog","setShowLoginDialog","deleteConfirmId","setDeleteConfirmId","previewImageUrl","setPreviewImageUrl","comments","isLoading","useComments","addComment","useAddComment","deleteComment","useDeleteComment","checkContent","useCheckSensitiveWords","uploadImage","file","fileExt","filePath","uploadError","data","supabase","publicUrl","error","handleImageSelect","isReply","clearImage","handleSubmitComment","uploadedUrl","handleSubmitReply","parentId","handleDeleteComment","commentId","CommentItem","comment","Avatar","AvatarImage","AvatarFallback","Clock","AlertCircle","star","Star","cn","DollarSign","r","Button","Reply","Trash2","ReportDialog","ShieldAlert","Textarea","X","Input","ImageIcon","reply","Fragment","MessageSquare","Card","CardContent","VolumeX","Select","SelectTrigger","SelectValue","SelectContent","range","SelectItem","CardHeader","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","open","ImagePreviewModal"],"mappings":"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"}