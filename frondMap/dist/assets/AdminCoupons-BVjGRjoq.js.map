{"version":3,"file":"AdminCoupons-BVjGRjoq.js","sources":["../../src/components/admin/CouponFormDialog.tsx","../../src/pages/admin/AdminCoupons.tsx"],"sourcesContent":["import { useEffect } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useSaveCouponTemplate, type CouponTemplate } from \"@/hooks/useCoupons\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormDescription,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n} from \"@/components/ui/form\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\nconst formSchema = z.object({\r\n  activity_id: z.string().optional(),\r\n  title_zh: z.string().min(1),\r\n  title_en: z.string().min(1),\r\n  title_pt: z.string().min(1),\r\n  description_zh: z.string().optional(),\r\n  description_en: z.string().optional(),\r\n  description_pt: z.string().optional(),\r\n  discount_type: z.enum([\"percentage\", \"fixed_amount\"]).default(\"percentage\"),\r\n  discount_value: z.coerce.number().min(0),\r\n  min_order_amount: z.coerce.number().min(0).optional(),\r\n  max_discount_amount: z.coerce.number().min(0).optional(),\r\n  valid_from: z.string().min(1),\r\n  valid_until: z.string().optional(),\r\n  duration_days: z.coerce.number().min(1).optional(),\r\n  duration_mode: z.enum([\"end_date\", \"duration\"]).default(\"end_date\"),\r\n  refresh_mode: z.enum([\"none\", \"weekly\", \"monthly\", \"yearly\"]).default(\"none\"),\r\n  is_active: z.boolean().default(true),\r\n  visible: z.boolean().default(true),\r\n  auto_link_activities: z.boolean().default(false),\r\n});\r\n\r\ntype FormData = z.infer<typeof formSchema>;\r\n\r\ninterface CouponFormDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  template?: CouponTemplate | null;\r\n}\r\n\r\nexport function CouponFormDialog({\r\n  open,\r\n  onOpenChange,\r\n  template,\r\n}: CouponFormDialogProps) {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const saveMutation = useSaveCouponTemplate();\r\n\r\n  console.log(\"CouponFormDialog opened:\", { open, hasTemplate: !!template });\r\n\r\n  // 获取所有活动列表\r\n  const { data: activities, isLoading: loadingActivities, error: activitiesError } = useQuery({\r\n    queryKey: [\"activities\"],\r\n    queryFn: async () => {\r\n      console.log(\"Fetching activities...\");\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(\"activities\")\r\n          .select(\"id, title_zh, title_en, title_pt\")\r\n          .eq(\"visible\", true)\r\n          .order(\"created_at\", { ascending: false });\r\n\r\n        if (error) {\r\n          console.error(\"Error fetching activities:\", error);\r\n          throw error;\r\n        }\r\n        console.log(\"Activities fetched:\", data?.length, data);\r\n        return data || [];\r\n      } catch (err) {\r\n        console.error(\"Exception in activities query:\", err);\r\n        throw err;\r\n      }\r\n    },\r\n    enabled: open, // 只在对话框打开时查询\r\n  });\r\n\r\n  // 处理查询错误\r\n  useEffect(() => {\r\n    if (activitiesError) {\r\n      console.error(\"Activities query error in useEffect:\", activitiesError);\r\n      toast({\r\n        title: t(\"admin.coupon.loadError\"),\r\n        description: t(\"admin.coupon.loadActivitiesError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  }, [activitiesError, toast]);\r\n\r\n  const form = useForm<FormData>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      activity_id: \"\",\r\n      title_zh: \"\",\r\n      title_en: \"\",\r\n      title_pt: \"\",\r\n      description_zh: \"\",\r\n      description_en: \"\",\r\n      description_pt: \"\",\r\n      discount_type: \"percentage\" as const,\r\n      discount_value: 0,\r\n      min_order_amount: undefined,\r\n      max_discount_amount: undefined,\r\n      valid_from: new Date().toISOString().split(\"T\")[0],\r\n      valid_until: \"\",\r\n      duration_days: undefined,\r\n      duration_mode: \"end_date\" as const,\r\n      refresh_mode: \"none\" as const,\r\n      is_active: true,\r\n      visible: true,\r\n      auto_link_activities: false,\r\n    },\r\n  });\r\n\r\n  // 当 template 变化时更新表单\r\n  useEffect(() => {\r\n    if (template) {\r\n      console.log(\"Setting form for edit mode:\", template.id);\r\n      // 判断使用哪种模式\r\n      const hasDuration = template.duration_days && template.duration_days > 0;\r\n      form.reset({\r\n        activity_id: template.activity_id || \"\",\r\n        title_zh: template.title_zh,\r\n        title_en: template.title_en,\r\n        title_pt: template.title_pt,\r\n        description_zh: template.description_zh || \"\",\r\n        description_en: template.description_en || \"\",\r\n        description_pt: template.description_pt || \"\",\r\n        discount_type: template.discount_type as \"percentage\" | \"fixed_amount\",\r\n        discount_value: Number(template.discount_value),\r\n        min_order_amount: template.min_order_amount ? Number(template.min_order_amount) : undefined,\r\n        max_discount_amount: template.max_discount_amount ? Number(template.max_discount_amount) : undefined,\r\n        valid_from: template.valid_from.split(\"T\")[0],\r\n        valid_until: template.valid_until?.split(\"T\")[0] || \"\",\r\n        duration_days: template.duration_days || undefined,\r\n        duration_mode: hasDuration ? \"duration\" : \"end_date\",\r\n        refresh_mode: (template.refresh_mode as \"none\" | \"weekly\" | \"monthly\" | \"yearly\") || \"none\",\r\n        is_active: template.is_active,\r\n        visible: template.visible,\r\n        auto_link_activities: template.auto_link_activities || false,\r\n      });\r\n    } else if (open && !template) {\r\n      console.log(\"Setting form for create mode\");\r\n      form.reset({\r\n        activity_id: \"\",\r\n        title_zh: \"\",\r\n        title_en: \"\",\r\n        title_pt: \"\",\r\n        description_zh: \"\",\r\n        description_en: \"\",\r\n        description_pt: \"\",\r\n        discount_type: \"percentage\" as const,\r\n        discount_value: 0,\r\n        min_order_amount: undefined,\r\n        max_discount_amount: undefined,\r\n        valid_from: new Date().toISOString().split(\"T\")[0],\r\n        valid_until: \"\",\r\n        duration_days: undefined,\r\n        duration_mode: \"end_date\" as const,\r\n        refresh_mode: \"none\" as const,\r\n        is_active: true,\r\n        visible: true,\r\n        auto_link_activities: false,\r\n      });\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [template, open]);\r\n\r\n  // 监听 duration_mode 变化，自动计算结束日期或持续天数\r\n  const durationMode = form.watch(\"duration_mode\");\r\n  const validFrom = form.watch(\"valid_from\");\r\n  const validUntil = form.watch(\"valid_until\");\r\n  const durationDays = form.watch(\"duration_days\");\r\n\r\n  // 当模式切换时，自动计算另一个值\r\n  useEffect(() => {\r\n    if (durationMode === \"duration\" && durationDays && validFrom) {\r\n      // 根据持续天数计算结束日期\r\n      const startDate = new Date(validFrom);\r\n      const endDate = new Date(startDate);\r\n      const days = Number(durationDays); // 确保是数字类型\r\n      if (!isNaN(days) && days > 0) {\r\n        endDate.setDate(endDate.getDate() + days);\r\n        form.setValue(\"valid_until\", endDate.toISOString().split(\"T\")[0]);\r\n      }\r\n    }\r\n  }, [durationDays, validFrom, durationMode, form]);\r\n\r\n  useEffect(() => {\r\n    if (durationMode === \"end_date\" && validUntil && validFrom) {\r\n      // 根据结束日期计算持续天数\r\n      const startDate = new Date(validFrom);\r\n      const endDate = new Date(validUntil);\r\n      const days = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));\r\n      if (days > 0) {\r\n        form.setValue(\"duration_days\", days);\r\n      }\r\n    }\r\n  }, [validUntil, validFrom, durationMode, form]);\r\n\r\n  const onSubmit = async (data: FormData) => {\r\n    try {\r\n      console.log(\"Form submitted:\", data);\r\n      const templateData: Partial<CouponTemplate> = {\r\n        activity_id: data.activity_id || null, // 允许为空（积分兑换优惠券）\r\n        title_zh: data.title_zh,\r\n        title_en: data.title_en,\r\n        title_pt: data.title_pt,\r\n        description_zh: data.description_zh || null,\r\n        description_en: data.description_en || null,\r\n        description_pt: data.description_pt || null,\r\n        discount_type: data.discount_type,\r\n        discount_value: data.discount_value,\r\n        min_order_amount: data.min_order_amount || null,\r\n        max_discount_amount: data.max_discount_amount || null,\r\n        valid_from: data.valid_from,\r\n        valid_until: data.valid_until || null,\r\n        duration_days: data.duration_mode === \"duration\" ? data.duration_days : null,\r\n        refresh_mode: data.refresh_mode,\r\n        is_active: data.is_active,\r\n        visible: data.visible,\r\n        auto_link_activities: data.auto_link_activities,\r\n      };\r\n\r\n      if (template?.id) {\r\n        templateData.id = template.id;\r\n      }\r\n\r\n      console.log(\"Saving template data:\", templateData);\r\n\r\n      saveMutation.mutate(templateData, {\r\n        onSuccess: () => {\r\n          console.log(\"Save successful\");\r\n          toast({\r\n            title: t(\"admin.coupon.saveSuccess\"),\r\n            description: t(\"admin.coupon.templateSaved\"),\r\n          });\r\n          onOpenChange(false);\r\n          form.reset();\r\n        },\r\n        onError: (error: any) => {\r\n          console.error(\"Error saving coupon template:\", error);\r\n          toast({\r\n            title: t(\"admin.coupon.saveError\"),\r\n            description: error.message || t(\"admin.coupon.saveErrorHint\"),\r\n            variant: \"destructive\",\r\n          });\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Exception in onSubmit:\", error);\r\n      toast({\r\n        title: t(\"admin.coupon.submitError\"),\r\n        description: t(\"admin.coupon.formSubmitError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>\r\n            {template ? \"编辑优惠券模板\" : \"创建优惠券模板\"}\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            {template ? \"修改优惠券模板信息\" : \"创建新的优惠券模板，用户分享后自动生成子优惠券\"}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        {activitiesError ? (\r\n          <div className=\"p-6 text-center\">\r\n            <p className=\"text-destructive mb-4\">加载活动列表失败</p>\r\n            <Button onClick={() => window.location.reload()}>刷新页面</Button>\r\n          </div>\r\n        ) : (\r\n          <Form {...form}>\r\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\r\n              <FormField\r\n                control={form.control}\r\n                name=\"activity_id\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.linkedActivity\")}</FormLabel>\r\n                    <Select\r\n                      onValueChange={(value) => {\r\n                        console.log(\"Activity selected:\", value);\r\n                        field.onChange(value === \"none\" ? \"\" : value);\r\n                      }}\r\n                      value={field.value || \"none\"}\r\n                      disabled={loadingActivities}\r\n                    >\r\n                      <FormControl>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder={loadingActivities ? t(\"admin.form.loading\") : t(\"admin.form.selectActivity\")} />\r\n                        </SelectTrigger>\r\n                      </FormControl>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"none\">\r\n                          <span className=\"text-muted-foreground\">{t(\"admin.form.noActivityLink\")}</span>\r\n                        </SelectItem>\r\n                        {loadingActivities ? (\r\n                          <SelectItem value=\"loading\" disabled>\r\n                            {t(\"admin.form.loading\")}\r\n                          </SelectItem>\r\n                        ) : activities && activities.length > 0 ? (\r\n                          activities.map((activity) => (\r\n                            <SelectItem key={activity.id} value={activity.id}>\r\n                              {activity.title_zh}\r\n                            </SelectItem>\r\n                          ))\r\n                        ) : null}\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <FormDescription>\r\n                      {t(\"admin.form.linkDescription\")}\r\n                    </FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n              <FormField\r\n                control={form.control}\r\n                name=\"title_zh\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.titleZh\")} *</FormLabel>\r\n                    <FormControl>\r\n                      <Input {...field} />\r\n                    </FormControl>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"title_en\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.titleEn\")} *</FormLabel>\r\n                    <FormControl>\r\n                      <Input {...field} />\r\n                    </FormControl>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"title_pt\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.titlePt\")} *</FormLabel>\r\n                    <FormControl>\r\n                      <Input {...field} />\r\n                    </FormControl>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n              <FormField\r\n                control={form.control}\r\n                name=\"description_zh\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.descZh\")}</FormLabel>\r\n                    <FormControl>\r\n                      <Textarea {...field} />\r\n                    </FormControl>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"description_en\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.descEn\")}</FormLabel>\r\n                    <FormControl>\r\n                      <Textarea {...field} />\r\n                    </FormControl>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"description_pt\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.descPt\")}</FormLabel>\r\n                    <FormControl>\r\n                      <Textarea {...field} />\r\n                    </FormControl>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <FormField\r\n                control={form.control}\r\n                name=\"discount_type\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.discountType\")} *</FormLabel>\r\n                    <Select onValueChange={field.onChange} value={field.value}>\r\n                      <FormControl>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder={t(\"admin.form.selectDiscountType\")} />\r\n                        </SelectTrigger>\r\n                      </FormControl>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"percentage\">{t(\"admin.couponDetail.percentageDiscount\")} (%)</SelectItem>\r\n                        <SelectItem value=\"fixed_amount\">{t(\"admin.couponDetail.fixedAmount\")} (€)</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"discount_value\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.discountValue\")} *</FormLabel>\r\n                    <FormControl>\r\n                      <Input \r\n                        type=\"number\" \r\n                        min=\"0\" \r\n                        step=\"0.01\"\r\n                        {...field} \r\n                      />\r\n                    </FormControl>\r\n                    <FormDescription>\r\n                      {form.watch(\"discount_type\") === \"percentage\" \r\n                        ? t(\"admin.form.percentageHint\") \r\n                        : t(\"admin.form.fixedAmountHint\")}\r\n                    </FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <FormField\r\n                control={form.control}\r\n                name=\"min_order_amount\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.minOrderAmount\")} (€)</FormLabel>\r\n                    <FormControl>\r\n                      <Input \r\n                        type=\"number\" \r\n                        min=\"0\" \r\n                        step=\"0.01\"\r\n                        {...field} \r\n                        value={field.value || \"\"}\r\n                      />\r\n                    </FormControl>\r\n                    <FormDescription>{t(\"admin.form.noLimit\")}</FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"max_discount_amount\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.maxDiscountAmount\")} (€)</FormLabel>\r\n                    <FormControl>\r\n                      <Input \r\n                        type=\"number\" \r\n                        min=\"0\" \r\n                        step=\"0.01\"\r\n                        {...field}\r\n                        value={field.value || \"\"}\r\n                      />\r\n                    </FormControl>\r\n                    <FormDescription>{t(\"admin.form.maxDiscountHint\")}</FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n            </div>\r\n\r\n            {/* Valid Period Settings */}\r\n            <div className=\"space-y-4 p-4 border rounded-lg bg-muted/30\">\r\n              <h4 className=\"font-medium text-sm\">{t(\"admin.form.validPeriodSettings\")}</h4>\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <FormField\r\n                  control={form.control}\r\n                  name=\"valid_from\"\r\n                  render={({ field }) => (\r\n                    <FormItem>\r\n                      <FormLabel>{t(\"admin.form.startDate\")} *</FormLabel>\r\n                      <FormControl>\r\n                        <Input type=\"date\" {...field} />\r\n                      </FormControl>\r\n                      <FormMessage />\r\n                    </FormItem>\r\n                  )}\r\n                />\r\n\r\n                <FormField\r\n                  control={form.control}\r\n                  name=\"duration_mode\"\r\n                  render={({ field }) => (\r\n                    <FormItem>\r\n                      <FormLabel>{t(\"admin.form.durationMode\")}</FormLabel>\r\n                      <Select onValueChange={field.onChange} value={field.value}>\r\n                        <FormControl>\r\n                          <SelectTrigger>\r\n                            <SelectValue placeholder={t(\"admin.form.selectMode\")} />\r\n                          </SelectTrigger>\r\n                        </FormControl>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"end_date\">{t(\"admin.form.modeEndDate\")}</SelectItem>\r\n                          <SelectItem value=\"duration\">{t(\"admin.form.modeDuration\")}</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                      <FormMessage />\r\n                    </FormItem>\r\n                  )}\r\n                />\r\n\r\n                {form.watch(\"duration_mode\") === \"end_date\" ? (\r\n                  <FormField\r\n                    control={form.control}\r\n                    name=\"valid_until\"\r\n                    render={({ field }) => (\r\n                      <FormItem>\r\n                        <FormLabel>{t(\"admin.form.endDate\")}</FormLabel>\r\n                        <FormControl>\r\n                          <Input type=\"date\" {...field} />\r\n                        </FormControl>\r\n                        <FormDescription>{t(\"admin.form.unlimitedPeriod\")}</FormDescription>\r\n                        <FormMessage />\r\n                      </FormItem>\r\n                    )}\r\n                  />\r\n                ) : (\r\n                  <FormField\r\n                    control={form.control}\r\n                    name=\"duration_days\"\r\n                    render={({ field }) => (\r\n                      <FormItem>\r\n                        <FormLabel>{t(\"admin.form.durationDays\")}</FormLabel>\r\n                        <FormControl>\r\n                          <Input \r\n                            type=\"number\" \r\n                            min=\"1\"\r\n                            {...field}\r\n                            value={field.value || \"\"}\r\n                          />\r\n                        </FormControl>\r\n                        <FormDescription>{t(\"admin.form.durationDescription\")}</FormDescription>\r\n                        <FormMessage />\r\n                      </FormItem>\r\n                    )}\r\n                  />\r\n                )}\r\n              </div>\r\n\r\n              {form.watch(\"duration_mode\") === \"duration\" && form.watch(\"duration_days\") && form.watch(\"valid_until\") && (\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {t(\"admin.form.autoCalculatedEndDate\")}: {form.watch(\"valid_until\")}\r\n                </p>\r\n              )}\r\n              {form.watch(\"duration_mode\") === \"end_date\" && form.watch(\"valid_until\") && form.watch(\"duration_days\") && (\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {t(\"admin.form.autoCalculatedDuration\")}: {form.watch(\"duration_days\")} {t(\"common.days\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n\r\n            {/* Refresh Period Settings */}\r\n            <div className=\"space-y-4 p-4 border rounded-lg bg-muted/30\">\r\n              <h4 className=\"font-medium text-sm\">{t(\"admin.form.refreshSettings\")}</h4>\r\n              <FormField\r\n                control={form.control}\r\n                name=\"refresh_mode\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"admin.form.refreshPeriod\")}</FormLabel>\r\n                    <Select onValueChange={field.onChange} value={field.value}>\r\n                      <FormControl>\r\n                        <SelectTrigger className=\"w-full md:w-[200px]\">\r\n                          <SelectValue placeholder={t(\"admin.form.selectRefreshPeriod\")} />\r\n                        </SelectTrigger>\r\n                      </FormControl>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"none\">{t(\"admin.form.refreshNone\")}</SelectItem>\r\n                        <SelectItem value=\"weekly\">{t(\"admin.form.refreshWeekly\")}</SelectItem>\r\n                        <SelectItem value=\"monthly\">{t(\"admin.form.refreshMonthly\")}</SelectItem>\r\n                        <SelectItem value=\"yearly\">{t(\"admin.form.refreshYearly\")}</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <FormDescription>\r\n                      {field.value === \"none\" && t(\"admin.form.refreshDescNone\")}\r\n                      {field.value === \"weekly\" && t(\"admin.form.refreshDescWeekly\")}\r\n                      {field.value === \"monthly\" && t(\"admin.form.refreshDescMonthly\")}\r\n                      {field.value === \"yearly\" && t(\"admin.form.refreshDescYearly\")}\r\n                    </FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n            </div>\r\n\r\n\r\n            <div className=\"flex gap-6\">\r\n              <FormField\r\n                control={form.control}\r\n                name=\"is_active\"\r\n                render={({ field }) => (\r\n                  <FormItem className=\"flex items-center space-x-2 space-y-0\">\r\n                    <FormControl>\r\n                      <Switch\r\n                        checked={field.value}\r\n                        onCheckedChange={field.onChange}\r\n                      />\r\n                    </FormControl>\r\n                    <FormLabel className=\"!mt-0\">{t(\"admin.couponDetail.active\")}</FormLabel>\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"visible\"\r\n                render={({ field }) => (\r\n                  <FormItem className=\"flex items-center space-x-2 space-y-0\">\r\n                    <FormControl>\r\n                      <Switch\r\n                        checked={field.value}\r\n                        onCheckedChange={field.onChange}\r\n                      />\r\n                    </FormControl>\r\n                    <FormLabel className=\"!mt-0\">{t(\"admin.visible\")}</FormLabel>\r\n                  </FormItem>\r\n                )}\r\n              />\r\n\r\n              <FormField\r\n                control={form.control}\r\n                name=\"auto_link_activities\"\r\n                render={({ field }) => (\r\n                  <FormItem className=\"flex items-center space-x-2 space-y-0\">\r\n                    <FormControl>\r\n                      <Switch\r\n                        checked={field.value}\r\n                        onCheckedChange={field.onChange}\r\n                      />\r\n                    </FormControl>\r\n                    <div className=\"flex flex-col\">\r\n                      <FormLabel className=\"!mt-0\">{t(\"admin.coupon.autoLinkActivities\")}</FormLabel>\r\n                      <FormDescription className=\"text-xs\">\r\n                        {t(\"admin.coupon.autoLinkDescription\")}\r\n                      </FormDescription>\r\n                    </div>\r\n                  </FormItem>\r\n                )}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-2\">\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={() => onOpenChange(false)}\r\n                disabled={saveMutation.isPending}\r\n              >\r\n                {t(\"common.cancel\")}\r\n              </Button>\r\n              <Button type=\"submit\" disabled={saveMutation.isPending}>\r\n                {saveMutation.isPending ? t(\"common.saving\") : t(\"common.save\")}\r\n              </Button>\r\n            </div>\r\n            </form>\r\n          </Form>\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { useCouponTemplates, useDeleteCouponTemplate, type CouponTemplate } from \"@/hooks/useCoupons\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\nimport { CouponFormDialog } from \"@/components/admin/CouponFormDialog\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Plus, Search, Ticket, Percent, Euro, Trash2, Edit, Eye, Mail, Loader2 } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\n\r\nconst AdminCoupons = () => {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n  const { data: couponTemplates, isLoading } = useCouponTemplates();\r\n  const deleteMutation = useDeleteCouponTemplate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [formDialogOpen, setFormDialogOpen] = useState(false);\r\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n  const [selectedTemplate, setSelectedTemplate] = useState<CouponTemplate | null>(null);\r\n  \r\n  // 清除邮箱记录相关状态\r\n  const [clearEmailDialogOpen, setClearEmailDialogOpen] = useState(false);\r\n  const [emailToClear, setEmailToClear] = useState(\"\");\r\n  const [isClearingEmail, setIsClearingEmail] = useState(false);\r\n\r\n  const filteredTemplates = couponTemplates?.filter((template) => {\r\n    const title = String(getLocalizedField(template, \"title\") || \"\");\r\n    const query = searchQuery.toLowerCase();\r\n    \r\n    return title.toLowerCase().includes(query);\r\n  });\r\n\r\n  const handleDelete = () => {\r\n    if (selectedTemplate) {\r\n      deleteMutation.mutate(selectedTemplate.id, {\r\n        onSuccess: () => {\r\n          setDeleteDialogOpen(false);\r\n          setSelectedTemplate(null);\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleClearEmailRecords = async () => {\r\n    if (!emailToClear.trim()) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"admin.clearEmail.enterEmail\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsClearingEmail(true);\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"user_coupons\")\r\n        .delete()\r\n        .eq(\"claimed_email\", emailToClear.trim().toLowerCase());\r\n\r\n      if (error) throw error;\r\n\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"admin.clearEmail.success\", { email: emailToClear }),\r\n      });\r\n      \r\n      setClearEmailDialogOpen(false);\r\n      setEmailToClear(\"\");\r\n    } catch (error: any) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: error.message,\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsClearingEmail(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8\">\r\n        <Card>\r\n          <CardHeader>\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n              <div>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <Ticket className=\"w-6 h-6\" />\r\n                  {t(\"admin.couponTemplates.title\")}\r\n                </CardTitle>\r\n                <CardDescription>\r\n                  {t(\"admin.couponTemplates.description\")}\r\n                </CardDescription>\r\n              </div>\r\n              <div className=\"flex gap-2 flex-wrap\">\r\n                <Dialog open={clearEmailDialogOpen} onOpenChange={setClearEmailDialogOpen}>\r\n                  <DialogTrigger asChild>\r\n                    <Button variant=\"outline\">\r\n                      <Mail className=\"w-4 h-4 mr-2\" />\r\n                      {t(\"admin.clearEmail.title\")}\r\n                    </Button>\r\n                  </DialogTrigger>\r\n                  <DialogContent>\r\n                    <DialogHeader>\r\n                      <DialogTitle>{t(\"admin.clearEmail.dialogTitle\")}</DialogTitle>\r\n                      <DialogDescription>\r\n                        {t(\"admin.clearEmail.dialogDescription\")}\r\n                      </DialogDescription>\r\n                    </DialogHeader>\r\n                    <div className=\"space-y-4 py-4\">\r\n                      <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"email-to-clear\">{t(\"admin.clearEmail.emailLabel\")}</Label>\r\n                        <Input\r\n                          id=\"email-to-clear\"\r\n                          type=\"email\"\r\n                          placeholder=\"example@email.com\"\r\n                          value={emailToClear}\r\n                          onChange={(e) => setEmailToClear(e.target.value)}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        onClick={() => {\r\n                          setClearEmailDialogOpen(false);\r\n                          setEmailToClear(\"\");\r\n                        }}\r\n                      >\r\n                        {t(\"common.cancel\")}\r\n                      </Button>\r\n                      <Button\r\n                        variant=\"destructive\"\r\n                        onClick={handleClearEmailRecords}\r\n                        disabled={isClearingEmail || !emailToClear.trim()}\r\n                      >\r\n                        {isClearingEmail && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\r\n                        {t(\"admin.clearEmail.confirm\")}\r\n                      </Button>\r\n                    </DialogFooter>\r\n                  </DialogContent>\r\n                </Dialog>\r\n                <Button onClick={() => {\r\n                  setSelectedTemplate(null);\r\n                  setFormDialogOpen(true);\r\n                }}>\r\n                  <Plus className=\"w-4 h-4 mr-2\" />\r\n                  {t(\"admin.couponTemplates.create\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"mb-6\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\r\n                <Input\r\n                  placeholder={t(\"admin.couponTemplates.search\")}\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {isLoading ? (\r\n              <div className=\"text-center py-8 text-muted-foreground\">\r\n                {t(\"admin.couponTemplates.loading\")}\r\n              </div>\r\n            ) : filteredTemplates && filteredTemplates.length > 0 ? (\r\n              <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n                {filteredTemplates.map((template) => (\r\n                  <Card key={template.id} className=\"hover:shadow-lg transition-shadow\">\r\n                    <CardHeader>\r\n                      <div className=\"flex justify-between items-start\">\r\n                      <div className=\"flex-1\">\r\n                          <CardTitle className=\"text-lg mb-1\">\r\n                            {getLocalizedField(template, \"title\")}\r\n                          </CardTitle>\r\n                          <CardDescription className=\"text-sm\">\r\n                            {getLocalizedField(template, \"description\")}\r\n                          </CardDescription>\r\n                        </div>\r\n                        <div className=\"flex flex-col items-end gap-1 ml-2\">\r\n                          <Badge variant={template.is_active ? \"default\" : \"secondary\"}>\r\n                            {template.is_active ? t(\"admin.couponTemplates.active\") : t(\"admin.couponTemplates.inactive\")}\r\n                          </Badge>\r\n                          {template.auto_link_activities && (\r\n                            <Badge variant=\"outline\" className=\"text-xs\">\r\n                              {t(\"admin.couponTemplates.autoLink\")}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"space-y-3\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <span className=\"text-sm text-muted-foreground\">{t(\"admin.couponTemplates.discountType\")}</span>\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {template.discount_type === \"percentage\" ? (\r\n                              <>\r\n                                <Percent className=\"w-4 h-4\" />\r\n                                <span className=\"font-semibold\">{template.discount_value}%</span>\r\n                              </>\r\n                            ) : (\r\n                              <span className=\"font-semibold\">€{template.discount_value}</span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <span className=\"text-sm text-muted-foreground\">{t(\"admin.couponTemplates.createdAt\")}</span>\r\n                          <span className=\"text-sm\">\r\n                            {format(new Date(template.created_at), \"yyyy-MM-dd\")}\r\n                          </span>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-2 pt-3 border-t\">\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            className=\"flex-1\"\r\n                            onClick={() => navigate(`/admin/coupons/${template.id}`)}\r\n                          >\r\n                            <Eye className=\"w-4 h-4 mr-1\" />\r\n                            {t(\"admin.couponTemplates.view\")}\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            className=\"flex-1\"\r\n                            onClick={() => {\r\n                              setSelectedTemplate(template);\r\n                              setFormDialogOpen(true);\r\n                            }}\r\n                          >\r\n                            <Edit className=\"w-4 h-4 mr-1\" />\r\n                            {t(\"admin.couponTemplates.edit\")}\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"destructive\"\r\n                            size=\"sm\"\r\n                            onClick={() => {\r\n                              setSelectedTemplate(template);\r\n                              setDeleteDialogOpen(true);\r\n                            }}\r\n                          >\r\n                            <Trash2 className=\"w-4 h-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-12\">\r\n                <Ticket className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  {searchQuery ? t(\"admin.couponTemplates.noMatch\") : t(\"admin.couponTemplates.empty\")}\r\n                </p>\r\n                <Button onClick={() => setFormDialogOpen(true)}>\r\n                  <Plus className=\"w-4 h-4 mr-2\" />\r\n                  {t(\"admin.couponTemplates.createFirst\")}\r\n                </Button>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <CouponFormDialog\r\n          key={selectedTemplate?.id || \"new\"}\r\n          open={formDialogOpen}\r\n          onOpenChange={(open) => {\r\n            setFormDialogOpen(open);\r\n            if (!open) {\r\n              setSelectedTemplate(null);\r\n            }\r\n          }}\r\n          template={selectedTemplate}\r\n        />\r\n\r\n        <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>{t(\"admin.couponTemplates.confirmDelete\")}</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {t(\"admin.couponTemplates.deleteWarning\", { name: selectedTemplate ? getLocalizedField(selectedTemplate, \"title\") : \"\" })}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n              <AlertDialogAction onClick={handleDelete}>\r\n                {t(\"admin.couponTemplates.delete\")}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminCoupons;\r\n"],"names":["formSchema","z.object","z.string","z.enum","z.coerce","z.boolean","CouponFormDialog","open","onOpenChange","template","t","useTranslation","toast","useToast","saveMutation","useSaveCouponTemplate","activities","loadingActivities","activitiesError","useQuery","data","error","supabase","err","useEffect","form","useForm","zodResolver","hasDuration","durationMode","validFrom","validUntil","durationDays","startDate","endDate","days","onSubmit","templateData","Dialog","jsxs","DialogContent","DialogHeader","jsx","DialogTitle","DialogDescription","Button","Form","FormField","field","FormItem","FormLabel","Select","value","FormControl","SelectTrigger","SelectValue","SelectContent","SelectItem","activity","FormDescription","FormMessage","Input","Textarea","Switch","AdminCoupons","navigate","useNavigate","couponTemplates","isLoading","useCouponTemplates","deleteMutation","useDeleteCouponTemplate","getLocalizedField","useLocalizedContent","searchQuery","setSearchQuery","useState","formDialogOpen","setFormDialogOpen","deleteDialogOpen","setDeleteDialogOpen","selectedTemplate","setSelectedTemplate","clearEmailDialogOpen","setClearEmailDialogOpen","emailToClear","setEmailToClear","isClearingEmail","setIsClearingEmail","filteredTemplates","title","query","handleDelete","handleClearEmailRecords","Card","CardHeader","CardTitle","Ticket","CardDescription","DialogTrigger","Mail","Label","e","DialogFooter","Loader2","Plus","CardContent","Search","Badge","Fragment","Percent","format","Eye","Edit","Trash2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"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"}