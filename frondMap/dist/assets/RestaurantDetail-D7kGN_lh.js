const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-DqSBmMIN.js","assets/vendor-react-DTNwRJdt.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css","assets/index-60xCuNp_.js","assets/vendor-supabase-CY_qUJoS.js","assets/index-CHqmBJr2.css","assets/TranslatableText-05Juth9U.js","assets/input-otp-CFGCIdCN.js","assets/TranslateButton-CjPyQJkV.js","assets/useSensitiveWords-NF5yXaRb.js","assets/ImagePreviewModal-D3PQXmuc.js"])))=>i.map(i=>d[i]);
import{j as b,C as B,p as ee,q as G,F as Ve,i as Ae,s as Ot,a as Ze,B as y,S as ft,D as $t,c as Et,d as Ft,e as At,l as Bt,g as E,_ as jt,u as qt,G as Vt,J as ct,k as Ut,A as xe,t as ue,v as he,w as pe,x as ge,y as fe,E as le,o as Se,z as je,K as Ht,L as Gt,M as Wt,N as ie,O as dt}from"./index-60xCuNp_.js";import{j as e,p as q,a$ as we,bg as Kt,s as Qt,r,bh as Xt,bi as Yt,bb as Zt,aw as te,bj as Je,W as et,bk as bt,bl as Be,H as Jt,I as es,z as ts,B as ss,ar as as,F as rs,X as ns,bm as oe,bn as ls,bo as is,bp as os,aY as cs,aZ as ds,bq as tt,L as Pe,br as be,be as wt,bs as Nt,bt as ms,bu as xs,b1 as us,bv as hs,a_ as Xe,y as vt,b3 as Te,aM as De,bw as ps,aO as gs,u as fs,q as js,w as Fe,bx as mt,by as xt,bz as Ke,bA as bs,aW as Qe,bB as ws,bf as Ns,b6 as vs}from"./vendor-react-DTNwRJdt.js";import{S as Ye}from"./separator-PMqg0qbe.js";import{C as se,a as ae,b as re}from"./collapsible-SvbSB-Qb.js";import{d as ys,b as _s,c as ks}from"./useRestaurants-BpCtY3aA.js";import{u as yt,T as Cs,R as ut}from"./TranslatableText-05Juth9U.js";import{u as st}from"./useLocalizedContent-Z56eXyv6.js";import{f as Ss}from"./timeUtils-pgRxO0UB.js";import{g as zs,c as Ts,o as Ds,m as Ps}from"./geolocation-DRm3QMsJ.js";import{m as ze}from"./vendor-map-CvE3ASYw.js";import{P as Is}from"./PullToRefresh-B6d7YrXa.js";import{u as Rs}from"./usePageView-BTWEWvEc.js";import{u as Ls}from"./ShareDrawer-DgHmusM0.js";import{u as Ms}from"./useActivityParticipation-C0yijGnH.js";import{u as Os,R as ht}from"./RestaurantFormDialog-CrcT68C3.js";import{C as _t,a as kt,b as Ct,c as St,d as zt}from"./carousel-Di3scV5-.js";import{I as $s}from"./ImagePreviewModal-D3PQXmuc.js";import{D as Es,a as Fs,b as As,c as Bs,d as qs}from"./drawer-DLttulVR.js";import{u as at}from"./useBrands-Efh_S9qQ.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CY_qUJoS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-jtdHZIRR.js";import"./input-otp-CFGCIdCN.js";import"./TranslateButton-CjPyQJkV.js";import"./checkbox-BF20_k7S.js";import"./switch-j1n7FkoV.js";import"./radio-group-CI7sEXQa.js";import"./tabs-zHeZaT3P.js";import"./RichTextEditor-CTcBGtRT.js";const Vs=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(b,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(b,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(b,{className:"h-10 w-10 rounded-md"}),e.jsx(b,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(B,{className:"shadow-large",children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(b,{className:"h-6 w-16 rounded-full"}),e.jsx(b,{className:"h-6 w-20 rounded-full"}),e.jsx(b,{className:"h-6 w-14 rounded-full"})]}),e.jsx(b,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(b,{className:"h-5 w-20"}),e.jsx(b,{className:"h-5 w-24"}),e.jsx(b,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{className:"h-10 w-28 rounded-md"}),e.jsx(b,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(G,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-5 w-24"}),e.jsx(b,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{className:"h-8 w-24 rounded-full"}),e.jsx(b,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(b,{className:"h-5 w-full"}),e.jsx(b,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(b,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(b,{className:"h-5 w-40"}),e.jsx(b,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(B,{className:"mt-6 shadow-large",children:[e.jsx(ee,{children:e.jsx(b,{className:"h-6 w-20"})}),e.jsx(G,{children:e.jsx(b,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(B,{className:"mt-6 shadow-large",children:[e.jsx(ee,{children:e.jsx(b,{className:"h-6 w-24"})}),e.jsx(G,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(t=>e.jsx(b,{className:"h-24 w-24 rounded-lg flex-shrink-0"},t))})})]}),e.jsxs(B,{className:"mt-6 shadow-large",children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{className:"h-6 w-32"}),e.jsx(b,{className:"h-9 w-24 rounded-md"})]}),e.jsx(G,{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-24"}),e.jsx(b,{className:"h-4 w-16"})]}),e.jsx(b,{className:"h-4 w-full"}),e.jsx(b,{className:"h-4 w-3/4"})]})]},t))})]})]})]}),Us=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],Tt=({restaurantId:t})=>{const{t:c}=q(),{data:s}=yt(t,"restaurant"),u=s?.filter(d=>d.rating_value)||[],n=u.length?u.reduce((d,g)=>d+(g.rating_value||0),0)/u.length:0,o=[5,4,3,2,1].map(d=>({star:d,count:u.filter(g=>g.rating_value===d).length,percentage:u.length?(u.filter(g=>g.rating_value===d).length/u.length*100).toFixed(0):0})),i=u.reduce((d,g)=>(g.price_range&&(d[g.price_range]=(d[g.price_range]||0)+1),d),{}),f=i&&Object.keys(i).length>0?Object.entries(i).sort((d,g)=>g[1]-d[1])[0]:null;return e.jsxs(B,{children:[e.jsx(ee,{children:e.jsx(Ve,{children:c("restaurant.rating")})}),e.jsxs(G,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:n.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(d=>e.jsx(we,{className:Ae("w-5 h-5",d<=Math.round(n)?"fill-accent text-accent":"text-muted-foreground")},d))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[u.length," ",c("restaurant.ratingsCount")]}),f&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(Kt,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:Us.find(d=>d.value===f[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:o.map(({star:d,count:g,percentage:_})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[d," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${_}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:g})]},d))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:c("restaurant.signInToRate")})]})]})},Hs=t=>(q(),Qt({queryKey:["restaurant-activities",t],queryFn:async()=>{const{data:c,error:s}=await Ot.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",t);if(s)throw s;const u=new Date;return c.filter(o=>{const i=o.activities;if(!i)return!1;const f=new Date(i.start_date),d=i.end_date?new Date(i.end_date):null;return f<=u&&(!d||d>=u)}).map(o=>({activity_id:o.activity_id,title_zh:o.activities.title_zh,title_en:o.activities.title_en,title_pt:o.activities.title_pt,intro_zh:o.activities.intro_zh,intro_en:o.activities.intro_en,intro_pt:o.activities.intro_pt,badge_text_zh:o.activities.badge_text_zh,badge_text_en:o.activities.badge_text_en,badge_text_pt:o.activities.badge_text_pt,badge_color:o.activities.badge_color}))},enabled:!!t})),Dt=(t,c)=>c==="zh"?t.title_zh:c==="pt"?t.title_pt:t.title_en,qe=(t,c)=>{let s="";return c==="zh"?s=t.badge_text_zh||t.title_zh:c==="pt"?s=t.badge_text_pt||t.title_pt:s=t.badge_text_en||t.title_en,s},Pt=(t,c)=>c==="zh"?t.intro_zh||"":c==="pt"?t.intro_pt||"":t.intro_en||"",pt="dish-gallery-view-mode";function It({restaurantId:t,showGallery:c=!0}){const{t:s}=q(),{data:u=[],isLoading:n}=Os(t),[o,i]=r.useState(!1),[f,d]=r.useState(0),[g,_]=r.useState(!1),x=Ze(),[h,T]=r.useState(()=>{if(typeof window<"u"){const j=localStorage.getItem(pt);return j==="single"||j==="multi"?j:"multi"}return"multi"});r.useEffect(()=>{localStorage.setItem(pt,h)},[h]);const v=r.useCallback(j=>{d(j),i(!0)},[]),D=r.useCallback(()=>{i(!1)},[]),k=r.useCallback(()=>{d(j=>j===0?u.length-1:j-1)},[u.length]),O=r.useCallback(()=>{d(j=>j===u.length-1?0:j+1)},[u.length]);if(r.useCallback(j=>{j.key==="ArrowLeft"&&k(),j.key==="ArrowRight"&&O(),j.key==="Escape"&&D()},[k,O,D]),n||!c||!u.length)return null;const F=()=>x&&h==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs(se,{open:!g,onOpenChange:j=>_(!j),children:[e.jsx(ee,{className:"pb-3",children:e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ve,{className:"text-lg flex items-center gap-2",children:[e.jsx(Xt,{className:"w-5 h-5"}),s("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",u.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:j=>j.stopPropagation(),children:[e.jsx(y,{variant:h==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:j=>{j.stopPropagation(),T("single")},title:s("dishImages.singleView"),children:e.jsx(Yt,{className:"h-4 w-4"})}),e.jsx(y,{variant:h==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:j=>{j.stopPropagation(),T("multi")},title:s("dishImages.multiView"),children:e.jsx(Zt,{className:"h-4 w-4"})})]}),e.jsx(te,{className:`w-5 h-5 text-muted-foreground transition-transform ${g?"":"rotate-180"}`})]})]})})}),e.jsx(re,{children:e.jsxs(G,{children:[e.jsxs(_t,{className:"w-full",children:[e.jsx(kt,{className:"-ml-2 md:-ml-4",children:u.map((j,P)=>e.jsx(Ct,{className:F(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>v(P),children:e.jsx("img",{src:j.image_url,alt:`Dish ${P+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},j.id))}),u.length>(x&&h==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"-left-3 md:-left-4"}),e.jsx(zt,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:s("dishImages.clickToEnlarge")})]})})]})}),o&&e.jsxs(e.Fragment,{children:[e.jsx($s,{imageUrl:u[f]?.image_url||"",isOpen:o,onClose:D}),u.length>1&&e.jsxs("div",{className:"fixed inset-0 z-[101] pointer-events-none",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto",onClick:j=>{j.stopPropagation(),k()},children:e.jsx(Je,{className:"w-8 h-8"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto",onClick:j=>{j.stopPropagation(),O()},children:e.jsx(et,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm pointer-events-auto",children:[f+1," / ",u.length]})]})]})]})}const Gs=({ownerBio:t,ownerName:c,ownerAvatarUrl:s,avatarFallback:u})=>{const{t:n}=q();return e.jsxs(Es,{children:[e.jsx(Fs,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80 p-0 h-auto font-medium gap-1",children:[n("common.viewMore","查看全部"),e.jsx(et,{className:"w-4 h-4"})]})}),e.jsxs(As,{className:"max-h-[85vh]",children:[e.jsx(Bs,{className:"pb-2",children:e.jsxs(qs,{className:"flex items-center gap-2 text-lg",children:[e.jsx(bt,{className:"w-5 h-5 text-primary"}),n("restaurants.ownerStory","主理人")]})}),e.jsx(ft,{className:"flex-1 px-4 pb-8",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(Be,{className:"absolute -top-4 -left-2 w-12 h-12 text-primary/10 rotate-180"}),e.jsx("div",{className:"relative z-10 pt-6 space-y-4",children:e.jsx("p",{className:"text-base md:text-lg text-foreground leading-relaxed whitespace-pre-wrap first-letter:text-4xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-2 first-letter:mt-1",children:t})}),e.jsxs("div",{className:"mt-8 flex items-center gap-3 pt-6 border-t",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg",children:s?e.jsx("img",{src:s,alt:c,className:"w-full h-full object-cover"}):u}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-foreground",children:c}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("restaurants.chef","大厨")})]})]})]})})]})]})},Rt=({open:t,onOpenChange:c,videoUrl:s,posterUrl:u,title:n})=>{const{t:o}=q(),i=r.useRef(null),f=r.useRef(null),[d,g]=r.useState(!1),[_,x]=r.useState(!1),[h,T]=r.useState(!1),[v,D]=r.useState(0),[k,O]=r.useState(0),[F,j]=r.useState(!0),P=r.useRef(null),ce=l=>{const H=Math.floor(l/60),W=Math.floor(l%60);return`${H}:${W.toString().padStart(2,"0")}`},$=r.useCallback(()=>{i.current&&(d?i.current.pause():i.current.play())},[d]),ne=r.useCallback(()=>{i.current&&(i.current.muted=!_,x(!_))},[_]),R=r.useCallback(async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),T(!1)):(await i.current?.requestFullscreen(),T(!0))}catch(l){console.log("Fullscreen not supported:",l)}},[]),V=r.useCallback(l=>{if(!i.current||!f.current)return;const H=f.current.getBoundingClientRect(),C=(l.clientX-H.left)/H.width;i.current.currentTime=C*k},[k]),A=r.useCallback(()=>{j(!0),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{d&&j(!1)},3e3)},[d]),K=r.useCallback(l=>{if(!i.current||!f.current)return;l.preventDefault(),l.stopPropagation();const H=f.current.getBoundingClientRect(),W=l.touches[0].clientX-H.left,C=Math.max(0,Math.min(1,W/H.width));i.current.currentTime=C*k},[k]);r.useEffect(()=>(t&&i.current?(i.current.currentTime=0,D(0),j(!0),i.current.play().catch(()=>{g(!1)})):!t&&i.current&&(i.current.pause(),i.current.currentTime=0,g(!1),D(0),j(!0)),()=>{P.current&&clearTimeout(P.current)}),[t]);const L=r.useCallback(()=>g(!0),[]),Y=r.useCallback(()=>g(!1),[]),Z=r.useCallback(()=>{i.current&&D(i.current.currentTime)},[]),I=r.useCallback(()=>{i.current&&O(i.current.duration)},[]),Q=r.useCallback(()=>{g(!1),j(!0)},[]),U=k>0?v/k*100:0;return e.jsx(Jt,{open:t,onOpenChange:c,children:e.jsxs(es,{children:[e.jsx(ts,{className:"fixed inset-0 z-[49] bg-black/90 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",style:{pointerEvents:"none"}}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{touchAction:"none"},onClick:l=>{l.target===l.currentTarget&&c(!1)},onTouchEnd:l=>{l.target===l.currentTarget&&c(!1)},children:e.jsxs(ss,{className:"relative w-full max-w-4xl bg-black rounded-lg overflow-hidden outline-none",style:{touchAction:"auto"},"aria-describedby":void 0,onMouseMove:A,onTouchStart:l=>{l.stopPropagation(),A()},onTouchMove:l=>{l.stopPropagation(),A()},onClick:l=>l.stopPropagation(),children:[e.jsx(as,{children:e.jsx(rs,{children:n||o("restaurants.videoPlayer","Video Player")})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:Ae("absolute top-3 right-3 z-[60] bg-black/50 hover:bg-black/70 text-white h-10 w-10 rounded-full transition-opacity duration-300",F?"opacity-100":"opacity-0 pointer-events-none"),onClick:l=>{l.stopPropagation(),c(!1)},children:e.jsx(ns,{className:"h-5 w-5"})}),n&&e.jsx("div",{className:Ae("absolute top-3 left-3 z-[60] transition-opacity duration-300 pointer-events-none",F?"opacity-100":"opacity-0"),children:e.jsx("h3",{className:"text-white font-semibold text-lg drop-shadow-lg",children:n})}),e.jsxs("div",{className:"relative aspect-video bg-black select-none",children:[e.jsx("video",{ref:i,src:s,poster:u,className:"w-full h-full object-contain cursor-pointer",playsInline:!0,preload:"metadata",onPlay:L,onPause:Y,onTimeUpdate:Z,onLoadedMetadata:I,onEnded:Q,onCanPlay:()=>{i.current&&!k&&O(i.current.duration)},onClick:l=>{l.stopPropagation(),$()},onTouchEnd:l=>{l.target===i.current&&(l.preventDefault(),$())}}),!d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center cursor-pointer bg-black/30",style:{zIndex:5},onClick:l=>{l.stopPropagation(),$()},onTouchEnd:l=>{l.preventDefault(),l.stopPropagation(),$()},children:e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(oe,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:Ae("absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent px-4 py-3 transition-opacity duration-300",F?"opacity-100":"opacity-0"),style:{zIndex:30,pointerEvents:F?"auto":"none"},onClick:l=>l.stopPropagation(),onTouchStart:l=>l.stopPropagation(),onTouchMove:l=>l.stopPropagation(),children:[e.jsx("div",{ref:f,className:"w-full py-2 cursor-pointer mb-2 group",style:{touchAction:"none"},onClick:l=>{l.stopPropagation(),V(l)},onTouchStart:l=>{l.stopPropagation(),K(l)},onTouchMove:l=>{l.stopPropagation(),K(l)},onTouchEnd:l=>{l.stopPropagation()},children:e.jsx("div",{className:"w-full h-2 bg-white/30 rounded-full relative",children:e.jsx("div",{className:"h-full bg-primary rounded-full relative transition-all",style:{width:`${U}%`},children:e.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full shadow-md -mr-2.5"})})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:l=>{l.stopPropagation(),$()},onTouchEnd:l=>{l.preventDefault(),l.stopPropagation(),$()},children:d?e.jsx(ls,{className:"h-6 w-6"}):e.jsx(oe,{className:"h-6 w-6"})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:l=>{l.stopPropagation(),ne()},onTouchEnd:l=>{l.preventDefault(),l.stopPropagation(),ne()},children:_?e.jsx(is,{className:"h-6 w-6"}):e.jsx(os,{className:"h-6 w-6"})}),e.jsxs("span",{className:"text-white text-sm font-medium select-none",children:[ce(v)," / ",ce(k)]})]}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:l=>{l.stopPropagation(),R()},onTouchEnd:l=>{l.preventDefault(),l.stopPropagation(),R()},children:h?e.jsx(cs,{className:"h-6 w-6"}):e.jsx(ds,{className:"h-6 w-6"})})]})]})]})]})})]})})},Ws=({brandId:t,open:c,onOpenChange:s})=>{const{t:u,i18n:n}=q(),{data:o,isLoading:i}=at(t);if(!o)return null;const f=h=>{switch(n.language){case"zh":return h.content_zh;case"pt":return h.content_pt;default:return h.content_en||h.content_zh}},d=()=>{switch(n.language){case"zh":return o.name;case"pt":return o.name_pt||o.name;default:return o.name_en||o.name}},_=(()=>{switch(n.language){case"zh":return o.intro_zh;case"pt":return o.intro_pt;default:return o.intro_en||o.intro_zh}})(),x=o.content_blocks&&o.content_blocks.length>0;return e.jsx($t,{open:c,onOpenChange:s,children:e.jsxs(Et,{className:"max-w-lg max-h-[85vh]",children:[e.jsx(Ft,{children:e.jsxs(At,{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5 text-primary"}),d()]})}),e.jsx(ft,{className:"max-h-[65vh] pr-2",children:e.jsxs("div",{className:"space-y-4",children:[o.logo_url&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:o.logo_url,alt:d(),className:"w-20 h-20 object-contain rounded-xl"})}),x&&o.content_blocks.map((h,T)=>{const v=f(h),D=h.type==="image"&&T===0,k=h.type==="image"&&T===o.content_blocks.length-1;return e.jsxs("div",{children:[h.type==="text"&&v&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:v}}),h.type==="image"&&h.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:h.url,alt:h.alt||"",className:D?"w-16 h-16 object-contain rounded-lg":k?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},h.id)}),_&&!x&&e.jsx(Cs,{text:_})]})})]})})},Ks=({brandId:t,onViewAll:c})=>{const{t:s,i18n:u}=q(),{data:n,isLoading:o}=at(t);if(o||!n)return null;const i=()=>{switch(u.language){case"zh":return n.name;case"pt":return n.name_pt||n.name;default:return n.name_en||n.name}},f=()=>{switch(u.language){case"zh":return n.intro_zh;case"pt":return n.intro_pt;default:return n.intro_en||n.intro_zh}},d=v=>{switch(u.language){case"zh":return v.content_zh;case"pt":return v.content_pt;default:return v.content_en||v.content_zh}},g=f(),_=n.content_blocks&&n.content_blocks.length>0;let x="";if(_){const v=n.content_blocks.filter(k=>k.type==="text");x=(v.length>0?d(v[0]):"")?.replace(/<[^>]*>/g,"")||""}else g&&(x=g.replace(/<[^>]*>/g,""));if(!x&&!n.logo_url)return null;const h=x.length>80?x.substring(0,80)+"...":x,T=x.length>80||_&&n.content_blocks.length>1;return e.jsxs("div",{className:"bg-muted/30 rounded-2xl border border-border/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n.logo_url&&e.jsx("img",{src:n.logo_url,alt:i(),className:"w-10 h-10 md:w-12 md:h-12 object-contain rounded-lg"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs md:text-sm font-semibold text-foreground flex items-center gap-1.5",children:[e.jsx(tt,{className:"w-3 h-3 md:w-4 md:h-4 text-primary"}),s("brand.aboutUs","品牌介绍")]}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5",children:i()})]})]}),x&&e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground leading-relaxed",children:h}),T&&e.jsxs(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80 p-0 h-auto font-medium gap-1",onClick:c,children:[s("common.viewMore","查看全部"),e.jsx(et,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"h-1.5 md:h-2 bg-gradient-to-r from-accent/20 via-accent/40 to-accent/20"})]})},Qs=({restaurant:t,localizedRestaurant:c,backUrl:s,user:u,isFavorite:n,onToggleFavorite:o,onShare:i,onReport:f,showEditButton:d,editButton:g,reportButton:_,brandId:x})=>{const{t:h}=q(),{getLocalizedField:T}=st();Bt();const[v,D]=r.useState(!1),[k,O]=r.useState(!1),[F,j]=r.useState(!1),[P,ce]=r.useState(!1),[$,ne]=r.useState(!1),R=r.useRef(null),V=T(t,"owner_bio")||t.owner_bio,A=c.description,K=c.name?.charAt(0)?.toUpperCase()||"主",L=t.banner_media_type==="video"&&t.promo_video_url,Y=t.banner_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",Z=t.promo_video_poster||Y,[I,Q]=r.useState(!1),U=3,l=w=>w?.replace(/<[^>]*>/g,"")||"",H=V&&V.length>100?V.substring(0,100)+"...":V,W=V&&V.length>100,C=l(A),Ne=C&&C.length>120?C.substring(0,120)+"...":C,Ue=C&&C.length>120,ve=r.useRef(null),ye=r.useCallback(w=>{!R.current||!L||I||(w?R.current.play().catch(()=>{}):R.current.pause())},[L,I]),Ie=r.useCallback(async w=>{try{return w.muted=!0,w.volume=0,await w.play(),!0}catch(a){return console.warn("Video autoplay attempt failed:",a),!1}},[]);r.useEffect(()=>{if(!L||!R.current)return;const w=R.current;let a=0,de,X=!0;const J=async()=>{if(!X||a>=U){X&&a>=U&&(Q(!0),O(!0));return}a++,await Ie(w)&&X?(O(!0),Q(!1)):X&&a<U?de=setTimeout(J,500):X&&(Q(!0),O(!0))},_e=()=>{J()},Ge=()=>{X&&j(!0)};return w.readyState>=2?J():w.addEventListener("loadeddata",_e),w.addEventListener("error",Ge),()=>{X=!1,clearTimeout(de),w.removeEventListener("loadeddata",_e),w.removeEventListener("error",Ge)}},[L,Ie]),r.useEffect(()=>{if(!L||I||!ve.current)return;const w=new IntersectionObserver(a=>{a.forEach(de=>{ye(de.isIntersecting)})},{threshold:.1});return w.observe(ve.current),()=>{w.disconnect()}},[L,I,ye]);const He=()=>{if(L&&t.promo_video_url)if(I&&R.current){const w=R.current;w.muted=!0,w.play().then(()=>{Q(!1),O(!0)}).catch(()=>{D(!0)})}else D(!0)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{ref:ve,className:"relative h-[33vh] md:h-[40vh] overflow-hidden bg-muted cursor-pointer group",onClick:He,children:[L&&!F?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:Z,alt:c.name,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${k&&!I?"opacity-0":"opacity-100"}`,loading:"eager"}),e.jsx("video",{ref:R,src:t.promo_video_url,poster:Z,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${k&&!I?"opacity-100":"opacity-0"}`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,"webkit-playsinline":"true","x5-playsinline":"true","x5-video-player-type":"h5"})]}):e.jsx("img",{src:Y,alt:c.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 via-background/20 to-transparent"}),L&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 transition-opacity duration-300 pointer-events-auto cursor-pointer ${I?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:e.jsx(oe,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 flex justify-between items-center z-40 p-3 md:p-4",onClick:w=>w.stopPropagation(),children:[e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",children:e.jsx(Pe,{to:s,children:e.jsx(Je,{className:"w-4 h-4 md:w-5 md:h-5"})})}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[_,g,e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:w=>{w.stopPropagation(),i()},children:e.jsx(be,{className:"w-4 h-4 md:w-5 md:h-5"})}),u&&e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:w=>{w.stopPropagation(),o()},children:e.jsx(wt,{className:`w-4 h-4 md:w-5 md:h-5 ${n?"fill-destructive text-destructive":""}`})})]})]})]}),e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-8",children:[L&&e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs(y,{variant:"secondary",size:"sm",className:"gap-2 bg-primary/5 hover:bg-primary/10 text-primary/70 border border-primary/10 backdrop-blur-md",onClick:()=>{R.current&&R.current.pause(),D(!0)},children:[e.jsx(oe,{className:"w-4 h-4"}),h("restaurants.clickWatchFullVideo","点击观看完整视频")]})}),e.jsxs(B,{className:"shadow-xl border-border/50",children:[e.jsxs(ee,{className:"pb-4 md:pb-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1.5 md:mb-2",children:[e.jsxs(E,{variant:"secondary",className:"text-[10px] md:text-xs gap-1 bg-primary/10 text-primary border-primary/20",children:[h("admin.templateGhost","Virtual Restaurant"),e.jsx(Nt,{className:"w-3 h-3"})]}),c.type&&c.type.length>0&&e.jsx(E,{variant:"secondary",className:"text-[10px] md:text-xs bg-primary/10 text-primary border-primary/20",children:c.type.join(" · ")}),e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.15em] md:tracking-[0.2em] uppercase text-primary",children:h("restaurants.exclusiveInterview","专属故事")})]}),e.jsx(Ve,{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight",children:c.name})]}),e.jsx(G,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-5 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"md:col-span-3 space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"relative aspect-square md:aspect-square w-full max-w-md mx-auto overflow-hidden rounded-xl shadow-lg group",children:[e.jsx("img",{src:t.cover_image_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&q=80",alt:c.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"})]}),(Ne||A)&&e.jsx("div",{className:"bg-muted/50 rounded-xl p-4 md:p-5 lg:p-6 border border-border/30",children:Ue?e.jsxs(se,{open:P,onOpenChange:ce,children:[e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 md:w-5 md:h-5 text-primary rotate-180"}),h("restaurants.foodPhilosophy","美食哲学")]}),e.jsx(te,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${P?"rotate-180":""}`})]})}),!P&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed mt-2 text-left",children:Ne}),e.jsx(re,{children:e.jsx("div",{className:"text-sm md:text-base text-muted-foreground leading-relaxed prose prose-sm dark:prose-invert max-w-none [&_*]:!text-muted-foreground [&_a]:!text-primary [&_a]:underline [&_p]:my-2 mt-2",dangerouslySetInnerHTML:{__html:A}})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2 mb-2 md:mb-3",children:[e.jsx(Be,{className:"w-4 h-4 md:w-5 md:h-5 text-primary rotate-180"}),h("restaurants.foodPhilosophy","美食哲学")]}),e.jsx("div",{className:"text-sm md:text-base text-muted-foreground leading-relaxed prose prose-sm dark:prose-invert max-w-none [&_*]:!text-muted-foreground [&_a]:!text-primary [&_a]:underline [&_p]:my-2",dangerouslySetInnerHTML:{__html:A}})]})})]}),e.jsxs("div",{className:"md:col-span-2 space-y-4 md:space-y-5",children:[e.jsxs("div",{className:"bg-muted/30 rounded-2xl border border-border/30 overflow-hidden",children:[e.jsx("div",{className:"relative pt-6 md:pt-8 pb-4 md:pb-6 px-4 md:px-6 bg-gradient-to-b from-primary/5 to-transparent",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-full overflow-hidden border-4 border-background shadow-xl ring-4 ring-primary/10",children:t.owner_avatar_url?e.jsx("img",{src:t.owner_avatar_url,alt:c.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/30 via-accent/20 to-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary/70",children:K})})}),e.jsxs(E,{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-2 md:px-3 py-0.5 md:py-1 text-[10px] md:text-xs font-medium shadow-lg whitespace-nowrap",children:[e.jsx(bt,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-0.5 md:mr-1"}),h("restaurants.ownerStory","主理人")]})]})})}),e.jsxs("div",{className:"px-4 md:px-6 py-3 md:py-4 text-center border-b border-border/30",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-foreground",children:c.name}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium tracking-wider uppercase mt-0.5 md:mt-1",children:h("restaurants.chef","大厨")})]}),e.jsxs("div",{className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[e.jsxs("h4",{className:"text-xs md:text-sm font-semibold text-foreground flex items-center gap-1.5 md:gap-2",children:[e.jsx(Be,{className:"w-3 h-3 md:w-4 md:h-4 text-primary rotate-180"}),h("restaurants.ownerWords","主理人故事")]}),V?e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground leading-relaxed",children:H}),W&&e.jsx(Gs,{ownerBio:V,ownerName:c.name,ownerAvatarUrl:t.owner_avatar_url,avatarFallback:K})]}):e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground/60 italic",children:h("restaurants.noBioYet","暂无简介")})]}),e.jsx("div",{className:"h-1.5 md:h-2 bg-gradient-to-r from-primary/20 via-primary/40 to-primary/20"})]}),x&&e.jsx(Ks,{brandId:x,onViewAll:()=>ne(!0)})]})]})})]})]}),L&&e.jsx(Rt,{open:v,onOpenChange:D,videoUrl:t.promo_video_url,posterUrl:Z,title:c.name}),x&&e.jsx(Ws,{brandId:x,open:$,onOpenChange:ne})]})},Xs=ms,Ys=t=>{if(!t)return"";const c=Math.floor(t/60),s=Math.floor(t%60);return`${c}:${s.toString().padStart(2,"0")}`},gt=({video:t,onClick:c,language:s})=>{const n=(()=>{switch(s){case"en":return t.title_en||t.title_zh||"";case"pt":return t.title_pt||t.title_en||t.title_zh||"";default:return t.title_zh||t.title_en||""}})();return e.jsxs(B,{className:"group cursor-pointer overflow-hidden border-border/50 hover:border-primary/30 transition-all hover:shadow-lg",onClick:c,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xs,{ratio:16/9,children:t.poster_url?e.jsx("img",{src:t.poster_url,alt:n,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 via-primary/10 to-muted flex items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/20 backdrop-blur-sm flex items-center justify-center border border-primary/30",children:e.jsx(oe,{className:"w-8 h-8 text-primary ml-1",fill:"currentColor"})}),e.jsx(xs,{className:"absolute bottom-3 left-3 w-5 h-5 text-primary/40"})]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none md:opacity-0 md:group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 rounded-full bg-black/50 md:bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 md:group-hover:scale-110 transition-transform",children:e.jsx(oe,{className:"w-6 h-6 md:w-7 md:h-7 text-white ml-0.5",fill:"white"})})}),t.duration&&e.jsx(E,{variant:"secondary",className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs border-0",children:Ys(t.duration)})]}),n&&e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:n})})]})},Zs=({videos:t})=>{const{t:c,i18n:s}=q(),u=Ze(),[n,o]=r.useState(null);if(!t||t.length===0)return null;const i=f=>{switch(s.language){case"en":return f.title_en||f.title_zh||"";case"pt":return f.title_pt||f.title_en||f.title_zh||"";default:return f.title_zh||f.title_en||""}};return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:"BEHIND THE KITCHEN"}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(oe,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),c("restaurants.videoSection","美食视界")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),u?e.jsxs(_t,{opts:{align:"start",loop:t.length>2},className:"w-full",children:[e.jsx(kt,{className:"-ml-2",children:t.map((f,d)=>e.jsx(Ct,{className:"pl-2 basis-4/5 sm:basis-1/2",children:e.jsx(gt,{video:f,onClick:()=>o(f),language:s.language})},d))}),t.length>2&&e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"hidden sm:flex -left-4"}),e.jsx(zt,{className:"hidden sm:flex -right-4"})]})]}):e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:t.map((f,d)=>e.jsx(gt,{video:f,onClick:()=>o(f),language:s.language},d))})]})}),e.jsx(Rt,{open:!!n,onOpenChange:f=>!f&&o(null),videoUrl:n?.url||"",posterUrl:n?.poster_url,title:n?i(n):void 0})]})},Js=r.lazy(()=>jt(()=>import("./RestaurantComments-DqSBmMIN.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),ea=({restaurant:t,localizedRestaurant:c,restaurantActivities:s,ratingCount:u,averageRating:n,onTakeawayClick:o})=>{const{t:i,i18n:f}=q();st();const[d,g]=r.useState(!1),_=r.useRef(null);return e.jsxs("div",{className:"relative bg-background",children:[t.website_url&&t.show_takeaway_button&&e.jsx("section",{className:"py-6 md:py-8 bg-gradient-to-b from-muted/50 to-background",children:e.jsxs("div",{className:"container mx-auto max-w-2xl px-4",children:[e.jsxs("div",{className:"text-center mb-4 md:mb-5",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-1",children:i("restaurants.readyToOrder")}),e.jsx("p",{className:"text-sm md:text-base font-medium text-foreground",children:i("restaurants.orderNowHint")})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(y,{className:"w-full h-11 md:h-12 text-sm md:text-base shadow-md hover:shadow-lg transition-shadow",size:"lg",onClick:o,children:[e.jsx(us,{className:"w-4 h-4 md:w-5 md:h-5 mr-2"}),i("restaurant.takeawayOrder")]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 md:mt-5",children:[e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"}),e.jsx("span",{className:"text-[10px] md:text-xs text-muted-foreground uppercase tracking-wider",children:i("restaurants.orBrowse")}),e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"})]})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:i("restaurants.gallery","美食图鉴")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(hs,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),i("restaurants.photoWall","照片墙")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(It,{restaurantId:t.id,showGallery:t.show_dish_gallery!==!1})]})}),t.videos&&Array.isArray(t.videos)&&t.videos.length>0&&e.jsx(Zs,{videos:t.videos}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:i("restaurants.info","详情")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(Xe,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),i("restaurants.contactInfo","联系信息")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(B,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsxs(G,{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[e.jsxs(E,{variant:"secondary",className:"gap-1 text-xs md:text-sm bg-primary/10 text-primary border-primary/20",children:[i("admin.templateGhost","Virtual Restaurant"),e.jsx(Nt,{className:"w-3 h-3"})]}),c.type.slice(0,3).map((x,h)=>e.jsx(E,{variant:"secondary",className:"text-xs md:text-sm",children:x},h)),u>0&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(we,{className:"w-4 h-4 md:w-5 md:h-5 fill-accent text-accent"}),e.jsxs("span",{className:"font-bold text-base md:text-lg",children:[n.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs md:text-sm ml-1",children:["(",u,")"]})]})]})]}),e.jsx(Ye,{}),e.jsxs("div",{className:"grid gap-3 md:gap-4",children:[s.length>0&&e.jsxs(se,{open:d,onOpenChange:g,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-gradient-to-r from-primary/5 to-transparent border border-primary/10",children:[e.jsx(we,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:i("activities.title")}),!d&&e.jsxs("div",{className:"flex flex-wrap gap-1 md:gap-1.5 mt-1",children:[s.slice(0,2).map((x,h)=>e.jsx(E,{variant:"default",className:"text-white text-[10px] md:text-xs",style:{backgroundColor:x.badge_color||"hsl(var(--primary))"},children:qe(x,f.language)},`activity-${h}`)),s.length>2&&e.jsxs(E,{variant:"secondary",className:"text-[10px] md:text-xs",children:["+",s.length-2]})]})]}),e.jsx(te,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${d?"rotate-180":""}`})]})}),e.jsx(re,{className:"mt-2 md:mt-3 space-y-1.5 md:space-y-2",children:s.map((x,h)=>{const T=Pt(x,f.language);return e.jsxs(Pe,{to:`/activity/${x.activity_id}`,className:"block p-2 md:p-3 rounded-md md:rounded-lg hover:bg-muted/80 transition-colors border border-transparent hover:border-primary/20",children:[e.jsx(E,{variant:"default",className:"text-white mr-1.5 md:mr-2 text-[10px] md:text-xs",style:{backgroundColor:x.badge_color||"hsl(var(--primary))"},children:qe(x,f.language)}),e.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground",children:[T||Dt(x,f.language)," ... →"]})]},`activity-detail-${h}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-muted/70 transition-colors",children:[e.jsx(Xe,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:i("restaurants.kitchenAddress")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mt-0.5 md:mt-1 break-words",children:t.address})]})]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-primary/10 transition-colors cursor-pointer group",children:[e.jsx(vt,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:i("restaurant.phone")}),e.jsx("p",{className:"text-sm md:text-base text-primary group-hover:underline mt-0.5 md:mt-1",children:t.phone})]})]})]})]})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:i("restaurants.rating","评分")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(we,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),i("restaurants.rateUs","给我们评分")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(B,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(G,{className:"p-4 md:p-6 lg:p-8",children:e.jsx(Tt,{restaurantId:t.id})})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:i("restaurants.reviews","评价")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(Te,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),i("restaurants.customerReviews","用户评价")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(B,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(G,{className:"p-4 md:p-6 lg:p-8",ref:_,children:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-8 md:py-12",children:e.jsx(De,{className:"w-6 h-6 md:w-8 md:h-8 animate-spin text-primary"})}),children:e.jsx(Js,{restaurantId:t.id})})})})]})})]})};function ta({brandId:t}){const{t:c,i18n:s}=q(),[u,n]=r.useState(!1),{data:o,isLoading:i}=at(t);if(i||!o)return null;const f=()=>{switch(s.language){case"zh":return o.intro_zh;case"pt":return o.intro_pt;default:return o.intro_en||o.intro_zh}},d=x=>{switch(s.language){case"zh":return x.content_zh;case"pt":return x.content_pt;default:return x.content_en||x.content_zh}},g=f(),_=o.content_blocks&&o.content_blocks.length>0;return!g&&!_?null:e.jsxs(se,{open:u,onOpenChange:n,className:"mt-4",children:[e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:c("brand.aboutUs")})]}),e.jsx(te,{className:`w-5 h-5 text-muted-foreground transition-transform ${u?"rotate-180":""}`})]})}),e.jsx(re,{children:e.jsxs("div",{className:"p-4 mt-2 rounded-lg bg-muted/30",children:[e.jsx("div",{className:"space-y-4",children:_&&o.content_blocks.map((x,h)=>{const T=d(x),v=x.type==="image"&&h===0,D=x.type==="image"&&h===o.content_blocks.length-1;return e.jsxs("div",{children:[x.type==="text"&&T&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:T}}),x.type==="image"&&x.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:x.url,alt:x.alt||"",className:v?"w-16 h-16 object-contain rounded-lg":D?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},x.id)})}),g&&!_&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:g}})]})})]})}const sa=r.lazy(()=>jt(()=>import("./RestaurantComments-DqSBmMIN.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),La=()=>{const{id:t}=ps(),c=gs(),{t:s,i18n:u}=q(),{user:n}=qt(),{localizeRestaurant:o,getLocalizedField:i}=st(),f=Ze(),d=r.useRef(null),g=r.useRef(null),[_,x]=r.useState(null),[h,T]=r.useState(!1),[v,D]=r.useState(!0),[k,O]=r.useState(!1),[F,j]=r.useState(!1),[P,ce]=r.useState(!0),[$,ne]=r.useState(!0),[R,V]=r.useState(!1),A=r.useRef(null),K=r.useRef(null),[L,Y]=r.useState(!1),[Z,I]=r.useState(!1),[Q,U]=r.useState(!1),[l,H]=r.useState(!1),W=fs(),C=js(),{share:Ne,DrawerComponent:Ue}=Ls(),ve=r.useCallback(async()=>{C.removeQueries({queryKey:["restaurant",t]}),C.removeQueries({queryKey:["comments",t]}),C.removeQueries({queryKey:["restaurant-activities",t]}),C.removeQueries({queryKey:["dish-images",t]}),await Promise.all([C.invalidateQueries({queryKey:["restaurant",t]}),C.invalidateQueries({queryKey:["comments",t]}),C.invalidateQueries({queryKey:["restaurant-activities",t]}),C.invalidateQueries({queryKey:["dish-images",t]})])},[C,t]);Rs({pageType:"restaurant",targetId:t});const ye=c.state?.fromActivity,Ie=c.state?.from==="admin",He=c.state?.from==="profile",w=Ie?"/admin/restaurants":He?"/profile":ye?`/activity/${ye}`:"/restaurants",{data:a,isLoading:de}=ys(t),{data:X=[]}=_s(),{data:J}=yt(t,"restaurant",{enabled:$}),_e=ks(),{role:Ge,isAdmin:ke}=Vt(),{data:Lt=[]}=Ms(),{data:Re=[]}=Hs(t),Le=a&&Lt.some(m=>m.id===a.id),S=a?o(a):null,rt=a?X.includes(a.id):!1;r.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const me=r.useMemo(()=>{const m={};return J?.forEach(p=>{p.price_range&&(m[p.price_range]||(m[p.price_range]={count:0,latestDate:p.created_at}),m[p.price_range].count+=1,p.created_at>m[p.price_range].latestDate&&(m[p.price_range].latestDate=p.created_at))}),m},[J]),nt=r.useMemo(()=>me?Object.values(me).reduce((m,p)=>m+p.count,0):0,[me]),lt=r.useMemo(()=>!me||nt<10?null:Object.entries(me).sort(([,p],[,z])=>z.count!==p.count?z.count-p.count:z.latestDate.localeCompare(p.latestDate))[0]?.[0]||null,[me,nt]),{ratingCount:Me,averageRating:it}=r.useMemo(()=>{const m=J?.filter(N=>N.rating_value)||[],p=m.length,z=p>0?m.reduce((N,M)=>N+(M.rating_value||0),0)/p:0;return{ratingCount:p,averageRating:z}},[J]);r.useEffect(()=>{a&&zs().then(m=>{const p=Ts(m.coords.latitude,m.coords.longitude,a.lat,a.lng);x(p)}).catch(()=>{x(null)})},[a]);const ot=r.useCallback(()=>{!n||!a||_e.mutate(a.id)},[n,a,_e]),Oe=r.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),Fe.success(s("common.linkCopied"))}catch(m){console.error("Error copying link:",m),Fe.error(s("common.shareError"))}},[s]),We=r.useCallback(async()=>{!a||!S||Ne({title:S.name,text:`${S.name} - Xiaoxiong Market

${S.description||S.address}`,url:window.location.href},()=>{Fe.success(s("common.shareSuccess"))})},[a,S,Ne,s]),Ce=r.useCallback(m=>{if(!a||!S)return;const p=encodeURIComponent(window.location.href),z=encodeURIComponent(S.name);let N="";switch(m){case"whatsapp":N=`https://wa.me/?text=${z}%20${p}`;break;case"facebook":N=`https://www.facebook.com/sharer/sharer.php?u=${p}`;break;case"twitter":N=`https://twitter.com/intent/tweet?text=${z}&url=${p}`;break;case"telegram":N=`https://t.me/share/url?url=${p}&text=${z}`;break;case"wechat":Oe(),Fe.info(s("common.shareVia")+" WeChat");return;default:return}ct()?window.location.href=N:window.open(N,"_blank","width=600,height=400")},[a,S,Oe,s]);return r.useEffect(()=>{const m=new IntersectionObserver(z=>{z.forEach(N=>{N.isIntersecting&&!P&&ce(!0)})},{rootMargin:"100px"}),p=new IntersectionObserver(z=>{z.forEach(N=>{N.isIntersecting&&!$&&ne(!0)})},{rootMargin:"200px"});return A.current&&m.observe(A.current),K.current&&p.observe(K.current),()=>{m.disconnect(),p.disconnect()}},[P,$]),r.useEffect(()=>{if(!d.current||!a||!P||!v||g.current)return;const m="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!ze.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:Ut(),isIOSWebView:ct(),userAgent:navigator.userAgent});return}const p=()=>{if(!d.current)return;const z=d.current.getBoundingClientRect();if(z.width===0||z.height===0){setTimeout(p,100);return}try{ze.accessToken=m,g.current=new ze.Map({container:d.current,style:"mapbox://styles/mapbox/light-v11",center:[a.lng,a.lat],zoom:15,cooperativeGestures:!0}),g.current.on("error",M=>{console.error("[RestaurantDetail Map] Map error:",M)});const N=document.createElement("div");N.style.backgroundImage=`url(${Ps})`,N.style.width="40px",N.style.height="40px",N.style.backgroundSize="contain",N.style.backgroundRepeat="no-repeat",N.style.backgroundPosition="center",N.style.cursor="pointer",new ze.Marker({element:N}).setLngLat([a.lng,a.lat]).addTo(g.current),g.current.addControl(new ze.NavigationControl)}catch(N){console.error("[RestaurantDetail Map] Failed to initialize map:",N)}};return setTimeout(p,50),()=>{g.current?.remove(),g.current=null}},[a,P,v]),r.useEffect(()=>{if(v&&g.current){const m=setTimeout(()=>{g.current?.resize(),a&&g.current?.setCenter([a.lng,a.lat])},350);return()=>clearTimeout(m)}},[v,a]),de?e.jsx(Vs,{}):!a||!S?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(y,{asChild:!0,className:"mt-4",children:e.jsx(Pe,{to:w,children:s("common.back")})})]})}):a.template==="ghost"?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Qs,{restaurant:a,localizedRestaurant:S,backUrl:w,user:n,isFavorite:rt,onToggleFavorite:ot,onShare:()=>{if(!n){I(!0);return}f&&navigator.share?We():Oe()},onReport:()=>{},showEditButton:Le||ke,editButton:(Le||ke)&&a?e.jsx(ht,{restaurant:a,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(mt,{className:"w-5 h-5"})})}):null,reportButton:a?e.jsx(ut,{targetType:"restaurant",targetId:a.id,onLoginRequired:()=>I(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(xt,{className:"w-5 h-5"})})}):null,brandId:a.brand_id}),e.jsx(ea,{restaurant:a,localizedRestaurant:S,restaurantActivities:Re,ratingCount:Me,averageRating:it,onTakeawayClick:()=>U(!0)}),e.jsx(xe,{open:Q,onOpenChange:U,children:e.jsxs(ue,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(he,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",children:e.jsx(Ke,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(pe,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(ge,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面")})]})]}),e.jsxs(fe,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(le,{onClick:()=>{try{let m=a.website_url;if(n){const p=new URL(a.website_url);p.searchParams.set("user_id",n.id),m=p.toString()}Se(m)}catch{Se(a.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(je,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(xe,{open:Z,onOpenChange:I,children:e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsx(pe,{children:s("activities.loginRequired")}),e.jsx(ge,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(fe,{children:[e.jsx(je,{children:s("common.cancel")}),e.jsx(le,{onClick:()=>W("/auth"),children:s("activities.goToLogin")})]})]})})]}):e.jsx(Is,{onRefresh:ve,children:e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:a.cover_image_url||a.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:S.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(Pe,{to:w,children:e.jsx(Je,{className:"w-5 h-5"})})}),n&&e.jsx(y,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:ot,children:e.jsx(wt,{className:`w-5 h-5 ${rt?"fill-destructive text-destructive":""}`})}),f&&navigator.share?e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${n?"right-16":"right-4"}`,onClick:()=>{if(!n){I(!0);return}We()},children:e.jsx(be,{className:"w-5 h-5"})}):e.jsxs(Ht,{children:[e.jsx(Gt,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${n?"right-16":"right-4"}`,onClick:m=>{n||(m.preventDefault(),I(!0))},children:e.jsx(be,{className:"w-5 h-5"})})}),e.jsxs(Wt,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(ie,{onClick:We,children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),s("common.moreOptions")]}),e.jsx(dt,{})]}),e.jsxs(ie,{onClick:()=>Ce("wechat"),children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(ie,{onClick:()=>Ce("whatsapp"),children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(ie,{onClick:()=>Ce("facebook"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(ie,{onClick:()=>Ce("twitter"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(ie,{onClick:()=>Ce("telegram"),children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(dt,{}),e.jsxs(ie,{onClick:Oe,children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),s("common.copyLink")]})]})]}),(Le||ke)&&a&&e.jsx(ht,{restaurant:a,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${n?"right-28":"right-16"}`,children:e.jsx(mt,{className:"w-5 h-5"})})}),a&&e.jsx(ut,{targetType:"restaurant",targetId:a.id,onLoginRequired:()=>I(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${Le||ke?n?"right-40":"right-28":n?"right-28":"right-16"}`,children:e.jsx(xt,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(B,{className:"shadow-large",children:[e.jsx(ee,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:S.type.slice(0,3).map((m,p)=>e.jsx(E,{variant:"secondary",children:m},p))}),e.jsx(Ve,{className:"text-3xl mb-2",children:S.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[_!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[_.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:`w-5 h-5 ${Me>0?"fill-accent text-accent":"text-muted-foreground"}`}),Me>0?e.jsxs("span",{className:"font-semibold text-base",children:[it.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",Me,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:s("restaurant.noRatingWithHint")})]}),lt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ws,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:lt})]})]}),a.brand_id&&e.jsx(ta,{brandId:a.brand_id}),S.description&&S.description.replace(/<[^>]*>/g,"").trim()!==""&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline mt-3",dangerouslySetInnerHTML:{__html:S.description}})]})})}),e.jsxs(G,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[Re.length>0&&e.jsxs(se,{open:F,onOpenChange:j,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(we,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("activities.title")}),!F&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:Re.map((m,p)=>e.jsx(E,{variant:"default",className:"text-white",style:{backgroundColor:m.badge_color||"#9b87f5"},children:qe(m,u.language)},`activity-${p}`))})]}),e.jsx(te,{className:`w-5 h-5 text-muted-foreground transition-transform ${F?"rotate-180":""}`})]})}),e.jsx(re,{className:"mt-3 space-y-2",children:Re.map((m,p)=>{const z=Pt(m,u.language);return e.jsxs(Pe,{to:`/activity/${m.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(E,{variant:"default",className:"text-white mr-2",style:{backgroundColor:m.badge_color||"#9b87f5"},children:qe(m,u.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[z||Dt(m,u.language)," ... →"]})]},`activity-detail-${p}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Xe,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.address")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:a.address}),a.template==="ghost"&&e.jsx(E,{variant:"secondary",className:"text-xs",children:s("restaurants.ghostKitchen")})]})]})]}),a.phone&&e.jsxs("a",{href:`tel:${a.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(vt,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:a.phone})]})]}),a.opening_hours&&a.template!=="ghost"&&e.jsxs(se,{open:h,onOpenChange:T,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Ns,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.hours")}),!h&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s("restaurant.today")," ",Ss(a.opening_hours)]})]}),e.jsx(te,{className:`w-5 h-5 text-muted-foreground transition-transform ${h?"rotate-180":""}`})]})}),e.jsx(re,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const m=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],p={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},z=m[new Date().getDay()===0?6:new Date().getDay()-1];return m.map(N=>{const M=a.opening_hours[N],$e=N===z,Mt=s(`restaurant.${p[N]}`);let Ee="N/A";return M&&(M.closed?Ee=s("restaurant.closed"):M.splitShift?Ee=`${M.open} - ${M.close}, ${M.open2} - ${M.close2}`:Ee=`${M.open} - ${M.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${$e?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${$e?"text-primary":"text-foreground"}`,children:[Mt,$e&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",s("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${$e?"text-primary font-semibold":"text-muted-foreground"} ${M?.closed?"italic":""}`,children:Ee})]},N)})})()})})]})]}),a&&(i(a,"announcement")||a.announcement_zh)&&e.jsxs(se,{open:k,onOpenChange:O,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Te,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.announcement")}),e.jsx(te,{className:`w-5 h-5 text-muted-foreground transition-transform ${k?"rotate-180":""}`})]})}),e.jsx(re,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:i(a,"announcement")||a.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[a.template!=="ghost"&&e.jsxs(y,{variant:"secondary",className:"w-full",onClick:()=>Y(!0),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),s("restaurant.getDirections")]}),a.website_url&&(a.show_takeaway_button||a.show_booking_button&&a.template!=="ghost")&&e.jsxs(y,{className:"w-full",onClick:()=>U(!0),children:[e.jsx(vs,{className:"w-4 h-4 mr-2"}),s("restaurant.orderOrBook","外卖/订台")]})]}),e.jsx(xe,{open:L,onOpenChange:Y,children:e.jsxs(ue,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(he,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Qe,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(pe,{className:"text-base font-semibold tracking-tight text-foreground",children:s("navigation.confirmTitle")}),e.jsx(ge,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("navigation.confirmDescriptionSimple",{destination:S.name})})]})]}),e.jsxs(fe,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(le,{onClick:()=>{Ds(a.lat,a.lng,S.name),Y(!1)},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("navigation.openNavigation","获取路线")}),e.jsx(je,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(xe,{open:l,onOpenChange:H,children:e.jsxs(ue,{className:"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none"}),e.jsxs(he,{className:"relative text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ke,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:2})}),e.jsx(pe,{className:"text-lg font-semibold text-foreground",children:s("restaurant.joinPrivateTitle")}),e.jsx(ge,{className:"text-center text-sm text-muted-foreground mt-2 leading-relaxed",children:s("restaurant.joinPrivateDescription")})]}),e.jsxs(fe,{className:"relative flex-col gap-2 pt-4",children:[e.jsxs(le,{onClick:()=>{const m=new URL(a.website_url);n&&m.searchParams.set("user_id",n.id);const p=m.toString();Se(p)},className:"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200",children:[R?e.jsx(De,{className:"w-4 h-4 mr-2 animate-spin"}):null,s("restaurant.joinPrivateConfirm")]}),e.jsx(je,{className:"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200",children:s("common.cancel")})]})]})}),e.jsx(xe,{open:Q,onOpenChange:U,children:e.jsxs(ue,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(he,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ke,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(pe,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(ge,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:n?s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面"):s("restaurant.orderOrBookLoginRequired","请先登录后再进入餐厅私域页面")})]})]}),e.jsxs(fe,{className:"relative flex-col gap-2 pt-4 mt-1",children:[n?e.jsx(le,{onClick:()=>{try{let m=a.website_url;if(n){const p=new URL(a.website_url);p.searchParams.set("user_id",n.id),m=p.toString()}Se(m)}catch{Se(a.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}):e.jsx(le,{onClick:()=>{U(!1),W("/auth",{state:{from:c.pathname}})},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("auth.login","登录")}),e.jsx(je,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(It,{restaurantId:a.id,showGallery:a.show_dish_gallery!==!1}),a.template!=="ghost"&&e.jsx("div",{ref:A,children:e.jsxs(se,{open:v,onOpenChange:D,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(ae,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("restaurant.map")}),e.jsx(te,{className:`w-5 h-5 text-muted-foreground transition-transform ${v?"rotate-180":""}`})]})}),e.jsx(re,{children:P?e.jsx("div",{ref:d,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(De,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(Ye,{}),e.jsx(Tt,{restaurantId:a.id}),e.jsx(Ye,{}),e.jsx("div",{ref:K,children:$?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(De,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(sa,{restaurantId:a.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(De,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(xe,{open:Z,onOpenChange:I,children:e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsx(pe,{children:s("activities.loginRequired")}),e.jsx(ge,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(fe,{children:[e.jsx(je,{children:s("common.cancel")}),e.jsx(le,{onClick:()=>W("/auth"),children:s("activities.goToLogin")})]})]})}),Ue]})})};export{La as default};
//# sourceMappingURL=RestaurantDetail-D7kGN_lh.js.map
