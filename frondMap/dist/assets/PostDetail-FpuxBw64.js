import{j as e}from"./vendor-ui-DmpovMYY.js";import{u as K,n as U,G,av as Q,aw as W,ax as V,b9 as Y,a7 as Z,a8 as ee,B as l,E as ae,a9 as se,aa as te,J as re,h as le,at as ie,K as ne,Q as ce,M as oe,a6 as me,ah as de,ai as ue,aj as he,ak as xe,al as ge,am as je,an as fe,ao as ve,D as Ne,cJ as we,cK as pe,X as Ce,a1 as ye,a2 as be,cb as _e,co as ke,cp as De,a4 as h,L as Se,aP as S}from"./index-C_NQhAgt.js";import{u as P,r as n,L as N,j as Pe}from"./vendor-react-iAJ0IrSD.js";import{C as Te,a as Ae,b as ze}from"./carousel-CpCm4xSl.js";import{c as Le,g as Ee,b as Ie,h as Fe}from"./useCommunityPosts-CpCFfTcL.js";import{u as $e}from"./useLocalizedContent-BN2IWylL.js";import{T as Me,R as Xe}from"./RestaurantComments-Cr6Qg_j7.js";import{u as T}from"./vendor-i18n-DxKeo2S1.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-query-D82cqPtt.js";import"./vendor-supabase-6pZ9VDFn.js";import"./ReportDialog-9ncPTvX7.js";import"./input-otp-DGm3m9gJ.js";import"./useSensitiveWords-Cy8Q4GCE.js";const Oe=({post:a,showActions:o=!0,isDetailPage:d=!1})=>{const{t,i18n:x}=T(),{user:i}=K(),A=P(),{getLocalizedField:z}=$e(),L=Le(),g=Ee(),E=Ie(),[I,j]=n.useState(!1),[w,p]=n.useState({}),[F,u]=n.useState(!1),[f,v]=n.useState(0),[c,$]=n.useState(),[C,y]=n.useState(0),[M,X]=n.useState(null);n.useEffect(()=>{c&&(y(c.selectedScrollSnap()),c.on("select",()=>{y(c.selectedScrollSnap())}))},[c]);const O=()=>{switch(x.language){case"zh":return De;case"pt":return ke;default:return _e}},B=()=>{i&&L.mutate({postId:a.id,liked:a.user_liked||!1})},H=async()=>{const s=`${window.location.origin}/community/${a.id}`;if(navigator.share)try{await navigator.share({title:t("community.shareTitle","分享帖子"),url:s}),i&&g.mutate(a.id),h.success(t("community.shareSuccess","分享成功"))}catch(r){r?.name!=="AbortError"&&(await navigator.clipboard.writeText(s),h.success(t("community.linkCopied","链接已复制到剪贴板")),i&&g.mutate(a.id))}else try{await navigator.clipboard.writeText(s),h.success(t("community.linkCopied","链接已复制到剪贴板")),i&&g.mutate(a.id)}catch{h.error(t("community.shareFailed","分享失败"))}},R=()=>{E.mutate(a.id),j(!1)},b=s=>{d?(v(s),u(!0)):A(`/community/${a.id}`)},_=()=>{v(s=>s===0?(a.image_urls?.length||1)-1:s-1)},k=()=>{v(s=>s===(a.image_urls?.length||1)-1?0:s+1)},q=i?.id===a.author_id,J=a.activity?z(a.activity,"title"):null;return e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:"overflow-hidden",children:[e.jsx(G,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Q,{className:"h-10 w-10",children:[e.jsx(W,{src:a.author?.avatar_url||void 0}),e.jsx(V,{children:a.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Y(new Date(a.created_at),{addSuffix:!0,locale:O()})})]})]}),o&&q&&e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsx(se,{align:"end",children:e.jsx(te,{onClick:()=>j(!0),className:"text-destructive",children:t("common.delete","删除")})})]})]})}),e.jsxs(re,{className:"pt-0 pb-3",children:[a.activity&&e.jsx(N,{to:`/activity/${a.activity.id}`,children:e.jsxs(le,{variant:"secondary",className:"mb-3 gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),J]})}),e.jsx(N,{to:`/community/${a.id}`,children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:M||a.content}})}),e.jsx(Me,{text:a.content,onTranslation:X,className:"mt-1"}),a.image_urls&&a.image_urls.length>0&&e.jsx("div",{className:"relative mt-3",children:a.image_urls.length===1?e.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg cursor-pointer",onClick:()=>b(0),children:w[a.image_urls[0]]?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:a.image_urls[0],alt:"",className:"w-full h-full object-cover",onError:()=>p(s=>({...s,[a.image_urls[0]]:!0}))})}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{setApi:$,className:"w-full",opts:{loop:!0},children:e.jsx(Ae,{className:"-ml-0",children:a.image_urls.map((s,r)=>e.jsx(ze,{className:"pl-0",children:e.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg cursor-pointer",onClick:()=>b(r),children:w[s]?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover",onError:()=>p(m=>({...m,[s]:!0}))})})},r))})}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[C+1,"/",a.image_urls.length]}),e.jsx("div",{className:"flex justify-center gap-1.5 mt-2",children:a.image_urls.map((s,r)=>e.jsx("button",{className:`w-1.5 h-1.5 rounded-full transition-colors ${r===C?"bg-primary":"bg-muted-foreground/30"}`,onClick:m=>{m.stopPropagation(),c?.scrollTo(r)}},r))})]})}),a.video_url&&e.jsx("div",{className:"mt-3 rounded-lg overflow-hidden",children:e.jsx("video",{src:a.video_url,controls:!0,className:"w-full max-h-96",preload:"metadata"})})]}),e.jsx(ne,{className:"pt-0 border-t",children:e.jsxs("div",{className:"flex items-center gap-4 pt-3 w-full",children:[e.jsxs(l,{variant:"ghost",size:"sm",className:`gap-2 ${a.user_liked?"text-red-500":""}`,onClick:B,disabled:!i,children:[e.jsx(ce,{className:`h-4 w-4 ${a.user_liked?"fill-current":""}`}),e.jsx("span",{children:a.likes_count})]}),e.jsx(N,{to:`/community/${a.id}`,children:e.jsxs(l,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:a.comments_count})]})}),e.jsxs(l,{variant:"ghost",size:"sm",className:"gap-2",onClick:H,children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:a.shares_count})]})]})})]}),e.jsx(de,{open:I,onOpenChange:j,children:e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:t("common.confirmDelete","确认删除")}),e.jsx(ge,{children:t("community.deleteWarning","删除后无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(je,{children:[e.jsx(fe,{children:t("common.cancel","取消")}),e.jsx(ve,{onClick:R,children:t("common.delete","删除")})]})]})}),e.jsx(Ne,{open:F,onOpenChange:u,children:e.jsxs(we,{children:[e.jsx(pe,{className:"bg-black"}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center cursor-pointer",onClick:()=>u(!1),onTouchStart:s=>{const r=s.touches[0];s.currentTarget.dataset.touchStartX=r.clientX.toString()},onTouchEnd:s=>{const r=parseFloat(s.currentTarget.dataset.touchStartX||"0"),m=s.changedTouches[0].clientX,D=r-m;Math.abs(D)>50&&a.image_urls&&a.image_urls.length>1&&(s.stopPropagation(),D>0?k():_())},children:[a.image_urls&&a.image_urls.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full",children:[f+1," / ",a.image_urls.length]}),e.jsx(l,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:s=>{s.stopPropagation(),u(!1)},children:e.jsx(Ce,{className:"h-6 w-6"})}),a.image_urls&&a.image_urls.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"ghost",size:"icon",className:"absolute left-4 z-10 text-white hover:bg-white/20 h-12 w-12",onClick:s=>{s.stopPropagation(),_()},children:e.jsx(ye,{className:"h-8 w-8"})}),e.jsx(l,{variant:"ghost",size:"icon",className:"absolute right-4 z-10 text-white hover:bg-white/20 h-12 w-12",onClick:s=>{s.stopPropagation(),k()},children:e.jsx(be,{className:"h-8 w-8"})})]}),a.image_urls&&a.image_urls[f]&&e.jsx("img",{src:a.image_urls[f],alt:"",className:"w-full h-full object-contain",onClick:s=>s.stopPropagation()})]})})]})})]})},aa=()=>{const{id:a}=Pe(),{t:o}=T(),d=P(),{data:t,isLoading:x,error:i}=Fe(a||"");return x?e.jsx("div",{className:"container max-w-2xl mx-auto py-6 px-4 flex justify-center",children:e.jsx(Se,{className:"h-8 w-8 animate-spin"})}):i||!t?e.jsx("div",{className:"container max-w-2xl mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:o("community.postNotFound","帖子不存在或已被删除")}),e.jsxs(l,{variant:"outline",className:"mt-4",onClick:()=>d("/community"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),o("community.backToList","返回社区")]})]})}):e.jsxs("div",{className:"container max-w-2xl mx-auto py-6 px-4",children:[e.jsxs(l,{variant:"ghost",size:"sm",className:"mb-4",onClick:()=>d("/community"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),o("community.backToList","返回社区")]}),e.jsx(Oe,{post:t,showActions:!0,isDetailPage:!0}),e.jsx("div",{className:"mt-6",children:e.jsx(Xe,{targetId:t.id,targetType:"post"})})]})};export{aa as default};
//# sourceMappingURL=PostDetail-FpuxBw64.js.map
