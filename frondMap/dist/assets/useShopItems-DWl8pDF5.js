import{s as p,p as c,q as m,v as d}from"./vendor-react-87iFmKFJ.js";import{u as h,s as o,a2 as n}from"./index-C3xfGQgV.js";const q=()=>p({queryKey:["shop-items"],queryFn:async()=>{const{data:e,error:r}=await o.from("shop_items").select(`
          *,
          coupon_templates (
            id,
            title_zh,
            title_en,
            title_pt
          )
        `).eq("is_active",!0).order("sort_order",{ascending:!0});if(r)throw r;return e}}),f=()=>p({queryKey:["all-shop-items"],queryFn:async()=>{const{data:e,error:r}=await o.from("shop_items").select(`
          *,
          coupon_templates (
            id,
            title_zh,
            title_en,
            title_pt
          )
        `).order("sort_order",{ascending:!0});if(r)throw r;return e}}),v=()=>{const{user:e}=h();return p({queryKey:["user-purchase-limits",e?.id],queryFn:async()=>{if(!e?.id)return[];const{data:r,error:s}=await o.from("user_purchase_limits").select("*").eq("user_id",e.id);if(s)throw s;return r},enabled:!!e?.id})},w=()=>{const{t:e}=c(),{user:r}=h(),s=m();return d({mutationFn:async({itemId:t,shippingAddressId:u})=>{if(!r?.id)throw new Error("Not authenticated");const{data:a,error:i}=await o.rpc("purchase_shop_item",{p_user_id:r.id,p_item_id:t,p_shipping_address_id:u||null});if(i)throw i;const l=a;if(!l.success)throw new Error(l.error||"Unknown error");return l},onSuccess:()=>{s.invalidateQueries({queryKey:["user-points"]}),s.invalidateQueries({queryKey:["user-purchases"]}),s.invalidateQueries({queryKey:["user-purchase-limits"]}),s.invalidateQueries({queryKey:["shop-items"]}),s.invalidateQueries({queryKey:["user-coupons"]}),s.invalidateQueries({queryKey:["profiles"]}),n({title:e("common.success"),description:e("shop.purchaseSuccess")})},onError:t=>{const u={item_not_found:e("shop.errors.itemNotFound"),item_inactive:e("shop.errors.itemInactive"),out_of_stock:e("shop.errors.outOfStock"),insufficient_points:e("shop.errors.insufficientPoints"),limit_reached:e("shop.errors.limitReached"),address_required:e("shop.errors.addressRequired")};n({title:e("common.error"),description:u[t.message]||e("common.errorOccurred"),variant:"destructive"})}})},K=()=>{const{t:e}=c(),r=m();return d({mutationFn:async s=>{const{id:t,coupon_templates:u,...a}=s;if(t){const{error:i}=await o.from("shop_items").update(a).eq("id",t);if(i)throw i}else{const{error:i}=await o.from("shop_items").insert(a);if(i)throw i}},onSuccess:()=>{r.invalidateQueries({queryKey:["shop-items"]}),r.invalidateQueries({queryKey:["all-shop-items"]}),n({title:e("common.success"),description:e("common.saved")})},onError:()=>{n({title:e("common.error"),description:e("common.errorOccurred"),variant:"destructive"})}})},Q=()=>{const{t:e}=c(),r=m();return d({mutationFn:async s=>{const{error:t}=await o.from("shop_items").delete().eq("id",s);if(t)throw t},onSuccess:()=>{r.invalidateQueries({queryKey:["shop-items"]}),r.invalidateQueries({queryKey:["all-shop-items"]}),n({title:e("common.success"),description:e("common.deleted")})},onError:()=>{n({title:e("common.error"),description:e("common.errorOccurred"),variant:"destructive"})}})},S=()=>{const{t:e}=c(),r=m();return d({mutationFn:async({itemId:s,userId:t})=>{const{error:u}=await o.from("user_purchase_limits").delete().eq("shop_item_id",s).eq("user_id",t);if(u)throw u},onSuccess:()=>{r.invalidateQueries({queryKey:["user-purchase-limits"]}),r.invalidateQueries({queryKey:["item-purchase-limits"]}),r.invalidateQueries({queryKey:["all-shop-items"]}),n({title:e("common.success"),description:e("admin.shop.userLimitReset")})},onError:()=>{n({title:e("common.error"),description:e("common.errorOccurred"),variant:"destructive"})}})};export{f as a,Q as b,S as c,w as d,q as e,v as f,K as u};
//# sourceMappingURL=useShopItems-DWl8pDF5.js.map
