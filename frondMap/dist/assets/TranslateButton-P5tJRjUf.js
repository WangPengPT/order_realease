import{p as C,r,j as a,aM as S,dS as B,dT as R,w as u}from"./vendor-react-DImbKuZP.js";import{q as N,s as E}from"./index-_G3CuCzp.js";const w=new Map,M=({text:h,className:L,label:j,onTranslation:n})=>{const{t:s,i18n:o}=C(),[f,p]=r.useState(!1),[F,g]=r.useState(null),[l,c]=r.useState(!1),[y,T]=r.useState(null),m=r.useRef(o.language);r.useEffect(()=>{const e=o.language;m.current!==e&&l&&(c(!1),g(null),n?.(null)),m.current=e},[o.language,l,n]);const b=()=>(navigator.language||navigator.userLanguage||"").split("-")[0].toLowerCase()||o.language,v=async()=>{const e=b(),i=`${h.substring(0,100)}_${e}`;if(l&&y===e){c(!1),n?.(null);return}const d=w.get(i);if(d){g(d),c(!0),T(e),n?.(d);return}p(!0),console.log("[TranslateButton] Calling translate-content with targetLang:",e);try{const{data:t,error:x}=await E.functions.invoke("translate-content",{body:{text:h,targetLang:e}});if(console.log("[TranslateButton] Response:",t,x),x){console.error("Translation error:",x),u.error(s("translate.error","翻译失败，请稍后重试"));return}t?.translatedText?(w.set(i,t.translatedText),g(t.translatedText),c(!0),T(e),n?.(t.translatedText),u.success(s("translate.success","翻译完成"))):t?.error&&u.error(t.error)}catch(t){console.error("Translation error:",t),u.error(s("translate.error","翻译失败，请稍后重试"))}finally{p(!1)}};return a.jsx(N,{variant:"ghost",size:"sm",className:`gap-1.5 h-auto py-1 px-2 text-xs text-muted-foreground hover:text-foreground ${L||""}`,onClick:v,disabled:f,children:f?a.jsxs(a.Fragment,{children:[a.jsx(S,{className:"h-3 w-3 animate-spin"}),a.jsx("span",{children:s("translate.translating","翻译中...")})]}):l?a.jsxs(a.Fragment,{children:[a.jsx(B,{className:"h-3 w-3"}),a.jsx("span",{children:s("translate.showOriginal","显示原文")})]}):a.jsxs(a.Fragment,{children:[a.jsx(R,{className:"h-3 w-3"}),a.jsx("span",{children:j||s("translate.button","翻译")})]})})};export{M as T};
//# sourceMappingURL=TranslateButton-P5tJRjUf.js.map
