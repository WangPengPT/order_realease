{"version":3,"file":"EditRecipeDialog-BvttCogK.js","sources":["../../src/components/community/MultiRestaurantSelectDrawer.tsx","../../src/components/ui/command.tsx","../../src/components/community/ActivitySelectDrawer.tsx","../../src/components/community/EmojiPicker.tsx","../../src/components/community/EditPostDialog.tsx","../../src/components/community/recipe/RecipeTypes.ts","../../src/components/community/recipe/RecipeBasicStep.tsx","../../src/components/community/recipe/RecipeIngredientsStep.tsx","../../src/components/community/recipe/RecipeStepsStep.tsx","../../src/hooks/useEditRecipe.ts","../../src/components/community/recipe/EditRecipeWizard.tsx","../../src/components/community/EditRecipeDialog.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, ChevronsUpDown, MapPin, Search, X } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n  DrawerFooter,\r\n} from \"@/components/ui/drawer\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\n\r\ninterface Restaurant {\r\n  id: string;\r\n  name?: string;\r\n  name_zh?: string;\r\n  name_en?: string;\r\n  name_pt?: string;\r\n  address?: string;\r\n  type?: string | string[];\r\n}\r\n\r\ninterface MultiRestaurantSelectDrawerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  value: string[];\r\n  onSelect: (restaurantIds: string[]) => void;\r\n  restaurants: Restaurant[];\r\n  required?: boolean;\r\n  maxDisplay?: number;\r\n}\r\n\r\nconst MultiRestaurantSelectDrawer = ({\r\n  open,\r\n  onOpenChange,\r\n  value,\r\n  onSelect,\r\n  restaurants,\r\n  required = false,\r\n  maxDisplay = 2,\r\n}: MultiRestaurantSelectDrawerProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const [search, setSearch] = useState(\"\");\r\n  const [pendingValue, setPendingValue] = useState<string[]>(value);\r\n  const [drawerHeight, setDrawerHeight] = useState<string>('85vh');\r\n\r\n  // Monitor visualViewport to dynamically adjust drawer height\r\n  useEffect(() => {\r\n    if (!open || !isMobile) return;\r\n    \r\n    const viewport = window.visualViewport;\r\n    if (!viewport) {\r\n      setDrawerHeight('85vh');\r\n      return;\r\n    }\r\n    \r\n    const updateHeight = () => {\r\n      const availableHeight = viewport.height;\r\n      const targetHeight = Math.min(availableHeight * 0.85, availableHeight - 50);\r\n      setDrawerHeight(`${targetHeight}px`);\r\n    };\r\n    \r\n    updateHeight();\r\n    viewport.addEventListener('resize', updateHeight);\r\n    \r\n    return () => {\r\n      viewport.removeEventListener('resize', updateHeight);\r\n    };\r\n  }, [open, isMobile]);\r\n\r\n  // Reset pending value when drawer opens\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    if (newOpen) {\r\n      setPendingValue(value);\r\n      setSearch(\"\");\r\n    }\r\n    onOpenChange(newOpen);\r\n  };\r\n\r\n  // Filter restaurants based on search\r\n  const filteredRestaurants = restaurants?.filter((r) => {\r\n    if (!search) return true;\r\n    const name = getLocalizedField(r, \"name\")?.toLowerCase() || \"\";\r\n    const address = r.address?.toLowerCase() || \"\";\r\n    const searchLower = search.toLowerCase();\r\n    return name.includes(searchLower) || address.includes(searchLower);\r\n  }) || [];\r\n\r\n  // Toggle restaurant selection\r\n  const toggleRestaurant = (restaurantId: string) => {\r\n    setPendingValue((prev) => {\r\n      if (prev.includes(restaurantId)) {\r\n        return prev.filter((id) => id !== restaurantId);\r\n      }\r\n      return [...prev, restaurantId];\r\n    });\r\n  };\r\n\r\n  // Handle confirm (mobile only)\r\n  const handleConfirm = () => {\r\n    onSelect(pendingValue);\r\n    onOpenChange(false);\r\n    setSearch(\"\");\r\n  };\r\n\r\n  // Handle toggle (desktop - immediate)\r\n  const handleDesktopToggle = (restaurantId: string) => {\r\n    const newValue = value.includes(restaurantId)\r\n      ? value.filter((id) => id !== restaurantId)\r\n      : [...value, restaurantId];\r\n    onSelect(newValue);\r\n  };\r\n\r\n  // Get selected restaurant names\r\n  const getSelectedNames = () => {\r\n    return value\r\n      .map((id) => {\r\n        const restaurant = restaurants?.find((r) => r.id === id);\r\n        return restaurant ? getLocalizedField(restaurant, \"name\") : null;\r\n      })\r\n      .filter(Boolean) as string[];\r\n  };\r\n\r\n  const selectedNames = getSelectedNames();\r\n\r\n  // Trigger button content\r\n  const TriggerContent = () => {\r\n    if (selectedNames.length === 0) {\r\n      return (\r\n        <span className=\"text-muted-foreground\">\r\n          {t(\"community.linkRestaurants\", \"å…³è”é¤å…\")}\r\n          {required && <span className=\"text-destructive ml-1\">*</span>}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    const displayNames = selectedNames.slice(0, maxDisplay);\r\n    const remaining = selectedNames.length - maxDisplay;\r\n\r\n    return (\r\n      <span className=\"text-primary flex items-center gap-1 flex-wrap\">\r\n        {displayNames.map((name, i) => (\r\n          <span key={i}>\r\n            {name}{i < displayNames.length - 1 ? \"ã€\" : \"\"}\r\n          </span>\r\n        ))}\r\n        {remaining > 0 && (\r\n          <Badge variant=\"secondary\" className=\"text-xs px-1.5 py-0\">\r\n            +{remaining}\r\n          </Badge>\r\n        )}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  // Trigger button\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors text-left\"\r\n      onClick={() => handleOpenChange(true)}\r\n    >\r\n      <TriggerContent />\r\n      <ChevronsUpDown className=\"h-4 w-4 opacity-50 shrink-0\" />\r\n    </button>\r\n  );\r\n\r\n  // Restaurant item component\r\n  const RestaurantItem = ({\r\n    restaurant,\r\n    isSelected,\r\n    onToggle,\r\n  }: {\r\n    restaurant: Restaurant;\r\n    isSelected: boolean;\r\n    onToggle: () => void;\r\n  }) => (\r\n    <div\r\n      className={cn(\r\n        \"flex items-start gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n        isSelected ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n      )}\r\n      onClick={onToggle}\r\n    >\r\n      <div className={cn(\r\n        \"h-5 w-5 shrink-0 mt-0.5 rounded border flex items-center justify-center transition-colors\",\r\n        isSelected ? \"bg-primary border-primary\" : \"border-muted-foreground/30\"\r\n      )}>\r\n        {isSelected && <Check className=\"h-3 w-3 text-primary-foreground\" />}\r\n      </div>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <p className=\"font-medium truncate\">\r\n          {getLocalizedField(restaurant, \"name\")}\r\n        </p>\r\n        {restaurant.address && (\r\n          <p className=\"text-sm text-muted-foreground truncate flex items-center gap-1 mt-0.5\">\r\n            <MapPin className=\"h-3 w-3 shrink-0\" />\r\n            {restaurant.address}\r\n          </p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Mobile: Full-screen Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={handleOpenChange}>\r\n          <DrawerContent \r\n            className=\"flex flex-col\"\r\n            style={{ \r\n              height: drawerHeight,\r\n              maxHeight: drawerHeight,\r\n              transition: 'height 0.15s ease-out, max-height 0.15s ease-out'\r\n            }}\r\n          >\r\n            <DrawerHeader className=\"pb-2 shrink-0\">\r\n              <DrawerTitle>\r\n                {t(\"community.selectRestaurants\", \"é€‰æ‹©é¤å…\")}\r\n                {pendingValue.length > 0 && (\r\n                  <Badge variant=\"secondary\" className=\"ml-2\">\r\n                    {pendingValue.length}\r\n                  </Badge>\r\n                )}\r\n              </DrawerTitle>\r\n            </DrawerHeader>\r\n\r\n            {/* Search Input */}\r\n            <div className=\"px-4 pb-3 shrink-0\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder={t(\"community.searchRestaurant\", \"æœç´¢é¤å…...\")}\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  className=\"pl-9\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Selected Preview */}\r\n            {pendingValue.length > 0 && (\r\n              <div className=\"px-4 pb-3 shrink-0\">\r\n                <div className=\"flex flex-wrap gap-1.5\">\r\n                  {pendingValue.map((id) => {\r\n                    const restaurant = restaurants?.find((r) => r.id === id);\r\n                    if (!restaurant) return null;\r\n                    return (\r\n                      <Badge\r\n                        key={id}\r\n                        variant=\"secondary\"\r\n                        className=\"gap-1 pr-1\"\r\n                      >\r\n                        <span className=\"truncate max-w-[120px]\">\r\n                          {getLocalizedField(restaurant, \"name\")}\r\n                        </span>\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"hover:bg-muted-foreground/20 rounded-full p-0.5\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            setPendingValue((prev) => prev.filter((i) => i !== id));\r\n                          }}\r\n                        >\r\n                          <X className=\"h-3 w-3\" />\r\n                        </button>\r\n                      </Badge>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Restaurant List */}\r\n            <div className=\"flex-1 overflow-y-auto px-4 min-h-0\">\r\n              <div className=\"space-y-1 pb-4\">\r\n                {filteredRestaurants.map((restaurant) => (\r\n                  <RestaurantItem\r\n                    key={restaurant.id}\r\n                    restaurant={restaurant}\r\n                    isSelected={pendingValue.includes(restaurant.id)}\r\n                    onToggle={() => toggleRestaurant(restaurant.id)}\r\n                  />\r\n                ))}\r\n\r\n                {filteredRestaurants.length === 0 && search && (\r\n                  <div className=\"py-6 text-center text-muted-foreground\">\r\n                    {t(\"community.noRestaurantFound\", \"æœªæ‰¾åˆ°åŒ¹é…çš„é¤å…\")}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Footer Buttons */}\r\n            <DrawerFooter className=\"pt-2\">\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => handleOpenChange(false)}\r\n                >\r\n                  {t(\"common.cancel\", \"å–æ¶ˆ\")}\r\n                </Button>\r\n                <Button className=\"flex-1\" onClick={handleConfirm}>\r\n                  {t(\"community.confirmSelection\", \"ç¡®è®¤é€‰æ‹©\")}\r\n                  {pendingValue.length > 0 && ` (${pendingValue.length})`}\r\n                </Button>\r\n              </div>\r\n            </DrawerFooter>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover\r\n  return (\r\n    <Popover open={open} onOpenChange={handleOpenChange}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-80 p-0\" align=\"start\">\r\n        <div className=\"p-3 border-b\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n            <Input\r\n              placeholder={t(\"community.searchRestaurant\", \"æœç´¢é¤å…...\")}\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              className=\"pl-9\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Selected Preview */}\r\n        {value.length > 0 && (\r\n          <div className=\"p-3 border-b\">\r\n            <div className=\"flex flex-wrap gap-1.5\">\r\n              {value.map((id) => {\r\n                const restaurant = restaurants?.find((r) => r.id === id);\r\n                if (!restaurant) return null;\r\n                return (\r\n                  <Badge\r\n                    key={id}\r\n                    variant=\"secondary\"\r\n                    className=\"gap-1 pr-1\"\r\n                  >\r\n                    <span className=\"truncate max-w-[100px]\">\r\n                      {getLocalizedField(restaurant, \"name\")}\r\n                    </span>\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"hover:bg-muted-foreground/20 rounded-full p-0.5\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        handleDesktopToggle(id);\r\n                      }}\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </Badge>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"max-h-64 overflow-y-auto p-2\">\r\n          {filteredRestaurants.map((restaurant) => (\r\n            <RestaurantItem\r\n              key={restaurant.id}\r\n              restaurant={restaurant}\r\n              isSelected={value.includes(restaurant.id)}\r\n              onToggle={() => handleDesktopToggle(restaurant.id)}\r\n            />\r\n          ))}\r\n          \r\n          {filteredRestaurants.length === 0 && search && (\r\n            <div className=\"py-4 text-center text-muted-foreground text-sm\">\r\n              {t(\"community.noRestaurantFound\", \"æœªæ‰¾åˆ°åŒ¹é…çš„é¤å…\")}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default MultiRestaurantSelectDrawer;\r\n","import * as React from \"react\";\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\r\nimport { Command as CommandPrimitive } from \"cmdk\";\r\nimport { Search } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCommand.displayName = CommandPrimitive.displayName;\r\n\r\ninterface CommandDialogProps extends DialogProps {}\r\n\r\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName;\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName;\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\r\n));\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName;\r\n\r\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\r\n};\r\nCommandShortcut.displayName = \"CommandShortcut\";\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n};\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, ChevronsUpDown, Calendar } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n  DrawerFooter,\r\n} from \"@/components/ui/drawer\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Command,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandList,\r\n} from \"@/components/ui/command\";\r\n\r\ninterface Activity {\r\n  id: string;\r\n  title_zh?: string;\r\n  title_en?: string;\r\n  title_pt?: string;\r\n  status?: string;\r\n}\r\n\r\ninterface ActivitySelectDrawerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  value: string;\r\n  onSelect: (activityId: string) => void;\r\n  activities: Activity[];\r\n}\r\n\r\nconst ActivitySelectDrawer = ({\r\n  open,\r\n  onOpenChange,\r\n  value,\r\n  onSelect,\r\n  activities,\r\n}: ActivitySelectDrawerProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const [pendingValue, setPendingValue] = useState(value);\r\n\r\n  // Reset pending value when drawer opens\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    if (newOpen) {\r\n      setPendingValue(value);\r\n    }\r\n    onOpenChange(newOpen);\r\n  };\r\n\r\n  // Get selected activity name\r\n  const getSelectedName = () => {\r\n    if (!value) return \"\";\r\n    const selected = activities?.find((a) => a.id === value);\r\n    return selected ? getLocalizedField(selected, \"title\") : \"\";\r\n  };\r\n\r\n  // Handle confirm (mobile only)\r\n  const handleConfirm = () => {\r\n    onSelect(pendingValue);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // Handle select (desktop - immediate)\r\n  const handleDesktopSelect = (activityId: string) => {\r\n    onSelect(activityId);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // Trigger button\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors\"\r\n      onClick={() => handleOpenChange(true)}\r\n    >\r\n      {value ? (\r\n        <span className=\"text-primary\">{getSelectedName()}</span>\r\n      ) : (\r\n        <span className=\"text-muted-foreground\">\r\n          {t(\"community.linkActivity\", \"å…³è”æ´»åŠ¨\")}\r\n        </span>\r\n      )}\r\n      <ChevronsUpDown className=\"h-4 w-4 opacity-50\" />\r\n    </button>\r\n  );\r\n\r\n  // Mobile: Full-screen Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={handleOpenChange}>\r\n          <DrawerContent className=\"max-h-[85vh] flex flex-col\">\r\n            <DrawerHeader className=\"pb-2\">\r\n              <DrawerTitle>{t(\"community.selectActivity\", \"é€‰æ‹©æ´»åŠ¨\")}</DrawerTitle>\r\n            </DrawerHeader>\r\n\r\n            {/* Activity List */}\r\n            <ScrollArea className=\"flex-1 px-4\">\r\n              <div className=\"space-y-1 pb-4\">\r\n                {/* None option */}\r\n                <div\r\n                  className={cn(\r\n                    \"flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                    pendingValue === \"\" ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                  )}\r\n                  onClick={() => setPendingValue(\"\")}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"h-4 w-4 shrink-0\",\r\n                      pendingValue === \"\" ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  <span className=\"text-muted-foreground\">\r\n                    {t(\"community.noActivity\", \"ä¸å…³è”æ´»åŠ¨\")}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Activity items */}\r\n                {activities.map((activity) => (\r\n                  <div\r\n                    key={activity.id}\r\n                    className={cn(\r\n                      \"flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                      pendingValue === activity.id ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                    )}\r\n                    onClick={() => setPendingValue(activity.id)}\r\n                  >\r\n                    <Check\r\n                      className={cn(\r\n                        \"h-4 w-4 shrink-0\",\r\n                        pendingValue === activity.id ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                      )}\r\n                    />\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Calendar className=\"h-4 w-4 text-muted-foreground shrink-0\" />\r\n                      <span className=\"font-medium\">\r\n                        {getLocalizedField(activity, \"title\")}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n\r\n                {activities.length === 0 && (\r\n                  <div className=\"py-6 text-center text-muted-foreground\">\r\n                    {t(\"activities.noActivities\", \"æš‚æ— å¯ç”¨æ´»åŠ¨\")}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </ScrollArea>\r\n\r\n            {/* Footer Buttons */}\r\n            <DrawerFooter className=\"pt-2\">\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => handleOpenChange(false)}\r\n                >\r\n                  {t(\"common.cancel\", \"å–æ¶ˆ\")}\r\n                </Button>\r\n                <Button className=\"flex-1\" onClick={handleConfirm}>\r\n                  {t(\"community.confirmSelection\", \"ç¡®è®¤é€‰æ‹©\")}\r\n                </Button>\r\n              </div>\r\n            </DrawerFooter>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover with Command\r\n  return (\r\n    <Popover open={open} onOpenChange={handleOpenChange}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-72 p-0\" align=\"start\">\r\n        <Command>\r\n          <CommandList>\r\n            <CommandGroup>\r\n              <CommandItem\r\n                value=\"none\"\r\n                onSelect={() => handleDesktopSelect(\"\")}\r\n              >\r\n                <Check\r\n                  className={cn(\r\n                    \"mr-2 h-4 w-4\",\r\n                    !value ? \"opacity-100\" : \"opacity-0\"\r\n                  )}\r\n                />\r\n                {t(\"community.noActivity\", \"ä¸å…³è”æ´»åŠ¨\")}\r\n              </CommandItem>\r\n              {activities.map((activity) => (\r\n                <CommandItem\r\n                  key={activity.id}\r\n                  value={activity.id}\r\n                  onSelect={() => handleDesktopSelect(activity.id)}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"mr-2 h-4 w-4\",\r\n                      value === activity.id ? \"opacity-100\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  {getLocalizedField(activity, \"title\")}\r\n                </CommandItem>\r\n              ))}\r\n            </CommandGroup>\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default ActivitySelectDrawer;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Smile } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n} from \"@/components/ui/drawer\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\n\r\ninterface EmojiPickerProps {\r\n  onSelect: (emoji: string) => void;\r\n}\r\n\r\n// Common emoji categories\r\nconst emojiCategories = [\r\n  {\r\n    name: \"smileys\",\r\n    emojis: [\"ğŸ˜€\", \"ğŸ˜ƒ\", \"ğŸ˜„\", \"ğŸ˜\", \"ğŸ˜†\", \"ğŸ˜…\", \"ğŸ¤£\", \"ğŸ˜‚\", \"ğŸ™‚\", \"ğŸ˜Š\", \"ğŸ˜‡\", \"ğŸ¥°\", \"ğŸ˜\", \"ğŸ¤©\", \"ğŸ˜˜\", \"ğŸ˜—\", \"ğŸ˜š\", \"ğŸ˜‹\", \"ğŸ˜›\", \"ğŸ˜œ\", \"ğŸ¤ª\", \"ğŸ˜\", \"ğŸ¤‘\", \"ğŸ¤—\", \"ğŸ¤­\", \"ğŸ¤«\", \"ğŸ¤”\", \"ğŸ¤\", \"ğŸ¤¨\", \"ğŸ˜\", \"ğŸ˜‘\", \"ğŸ˜¶\", \"ğŸ˜\", \"ğŸ˜’\", \"ğŸ™„\", \"ğŸ˜¬\", \"ğŸ¤¥\", \"ğŸ˜Œ\", \"ğŸ˜”\", \"ğŸ˜ª\", \"ğŸ¤¤\", \"ğŸ˜´\", \"ğŸ˜·\", \"ğŸ¤’\", \"ğŸ¤•\", \"ğŸ¤¢\", \"ğŸ¤®\", \"ğŸ¥µ\", \"ğŸ¥¶\", \"ğŸ¥´\", \"ğŸ˜µ\", \"ğŸ¤¯\", \"ğŸ¤ \", \"ğŸ¥³\", \"ğŸ˜\", \"ğŸ¤“\", \"ğŸ§\"],\r\n  },\r\n  {\r\n    name: \"gestures\",\r\n    emojis: [\"ğŸ‘\", \"ğŸ‘\", \"ğŸ‘Œ\", \"ğŸ¤Œ\", \"âœŒï¸\", \"ğŸ¤\", \"ğŸ¤Ÿ\", \"ğŸ¤˜\", \"ğŸ¤™\", \"ğŸ‘ˆ\", \"ğŸ‘‰\", \"ğŸ‘†\", \"ğŸ‘‡\", \"â˜ï¸\", \"âœ‹\", \"ğŸ¤š\", \"ğŸ–ï¸\", \"ğŸ––\", \"ğŸ‘‹\", \"ğŸ¤\", \"ğŸ™\", \"ğŸ’ª\", \"ğŸ¦¾\", \"ğŸ¦¿\", \"ğŸ¦µ\", \"ğŸ¦¶\", \"ğŸ‘‚\", \"ğŸ¦»\", \"ğŸ‘ƒ\", \"ğŸ§ \", \"ğŸ‘€\", \"ğŸ‘ï¸\", \"ğŸ‘…\", \"ğŸ‘„\"],\r\n  },\r\n  {\r\n    name: \"food\",\r\n    emojis: [\"ğŸ\", \"ğŸ\", \"ğŸ\", \"ğŸŠ\", \"ğŸ‹\", \"ğŸŒ\", \"ğŸ‰\", \"ğŸ‡\", \"ğŸ“\", \"ğŸ«\", \"ğŸˆ\", \"ğŸ’\", \"ğŸ‘\", \"ğŸ¥­\", \"ğŸ\", \"ğŸ¥¥\", \"ğŸ¥\", \"ğŸ…\", \"ğŸ†\", \"ğŸ¥‘\", \"ğŸ¥¦\", \"ğŸ¥¬\", \"ğŸ¥’\", \"ğŸŒ¶ï¸\", \"ğŸ«‘\", \"ğŸŒ½\", \"ğŸ¥•\", \"ğŸ§„\", \"ğŸ§…\", \"ğŸ¥”\", \"ğŸ \", \"ğŸ¥\", \"ğŸ¥¯\", \"ğŸ\", \"ğŸ¥–\", \"ğŸ¥¨\", \"ğŸ§€\", \"ğŸ¥š\", \"ğŸ³\", \"ğŸ§ˆ\", \"ğŸ¥\", \"ğŸ§‡\", \"ğŸ¥“\", \"ğŸ¥©\", \"ğŸ—\", \"ğŸ–\", \"ğŸ¦´\", \"ğŸŒ­\", \"ğŸ”\", \"ğŸŸ\", \"ğŸ•\", \"ğŸ«“\", \"ğŸ¥ª\", \"ğŸ¥™\", \"ğŸ§†\", \"ğŸŒ®\", \"ğŸŒ¯\", \"ğŸ«”\", \"ğŸ¥—\", \"ğŸ¥˜\", \"ğŸ«•\", \"ğŸ¥«\", \"ğŸ\", \"ğŸœ\", \"ğŸ²\", \"ğŸ›\", \"ğŸ£\", \"ğŸ±\", \"ğŸ¥Ÿ\", \"ğŸ¦ª\", \"ğŸ¤\", \"ğŸ™\", \"ğŸš\", \"ğŸ˜\", \"ğŸ¥\", \"ğŸ¥ \", \"ğŸ¥®\", \"ğŸ¢\", \"ğŸ¡\", \"ğŸ§\", \"ğŸ¨\", \"ğŸ¦\", \"ğŸ¥§\", \"ğŸ§\", \"ğŸ°\", \"ğŸ‚\", \"ğŸ®\", \"ğŸ­\", \"ğŸ¬\", \"ğŸ«\", \"ğŸ¿\", \"ğŸ©\", \"ğŸª\"],\r\n  },\r\n  {\r\n    name: \"hearts\",\r\n    emojis: [\"â¤ï¸\", \"ğŸ§¡\", \"ğŸ’›\", \"ğŸ’š\", \"ğŸ’™\", \"ğŸ’œ\", \"ğŸ–¤\", \"ğŸ¤\", \"ğŸ¤\", \"ğŸ’”\", \"â£ï¸\", \"ğŸ’•\", \"ğŸ’\", \"ğŸ’“\", \"ğŸ’—\", \"ğŸ’–\", \"ğŸ’˜\", \"ğŸ’\", \"ğŸ’Ÿ\", \"â™¥ï¸\"],\r\n  },\r\n  {\r\n    name: \"objects\",\r\n    emojis: [\"â­\", \"ğŸŒŸ\", \"âœ¨\", \"ğŸ’«\", \"ğŸ”¥\", \"ğŸ’¯\", \"ğŸ‰\", \"ğŸŠ\", \"ğŸˆ\", \"ğŸ\", \"ğŸ†\", \"ğŸ¥‡\", \"ğŸ¥ˆ\", \"ğŸ¥‰\", \"âš½\", \"ğŸ€\", \"ğŸˆ\", \"âš¾\", \"ğŸ¾\", \"ğŸ\", \"ğŸ±\", \"ğŸ“\", \"ğŸ®\", \"ğŸ²\", \"ğŸ§©\", \"ğŸ­\", \"ğŸ¨\", \"ğŸ¬\", \"ğŸ¤\", \"ğŸ§\", \"ğŸµ\", \"ğŸ¶\", \"ğŸ¹\", \"ğŸ¸\", \"ğŸº\", \"ğŸ»\", \"ğŸ“·\", \"ğŸ“¸\", \"ğŸ“¹\", \"ğŸ¥\", \"ğŸ“±\", \"ğŸ’»\", \"âŒ¨ï¸\", \"ğŸ–¥ï¸\", \"ğŸ“º\", \"ğŸ“»\", \"â°\", \"âŒš\", \"ğŸ’¡\", \"ğŸ”¦\", \"ğŸ“š\", \"ğŸ“–\", \"âœï¸\", \"ğŸ“\", \"ğŸ’°\", \"ğŸ’µ\", \"ğŸ’´\", \"ğŸ’¶\", \"ğŸ’·\", \"ğŸ’³\", \"ğŸ›’\", \"ğŸ€\", \"ğŸ—ï¸\"],\r\n  },\r\n  {\r\n    name: \"nature\",\r\n    emojis: [\"ğŸŒ¸\", \"ğŸ’®\", \"ğŸµï¸\", \"ğŸŒ¹\", \"ğŸ¥€\", \"ğŸŒº\", \"ğŸŒ»\", \"ğŸŒ¼\", \"ğŸŒ·\", \"ğŸŒ±\", \"ğŸª´\", \"ğŸŒ²\", \"ğŸŒ³\", \"ğŸŒ´\", \"ğŸŒµ\", \"ğŸŒ¾\", \"ğŸŒ¿\", \"â˜˜ï¸\", \"ğŸ€\", \"ğŸ\", \"ğŸ‚\", \"ğŸƒ\", \"ğŸŒ\", \"ğŸŒ\", \"ğŸŒ\", \"ğŸŒ™\", \"â­\", \"â˜€ï¸\", \"ğŸŒ¤ï¸\", \"â›…\", \"ğŸŒ¥ï¸\", \"â˜ï¸\", \"ğŸŒ¦ï¸\", \"ğŸŒ§ï¸\", \"â›ˆï¸\", \"ğŸŒ©ï¸\", \"ğŸŒ¨ï¸\", \"â„ï¸\", \"â˜ƒï¸\", \"â›„\", \"ğŸŒ¬ï¸\", \"ğŸ’¨\", \"ğŸŒŠ\", \"ğŸ’§\", \"ğŸ’¦\", \"â˜”\", \"ğŸŒˆ\"],\r\n  },\r\n];\r\n\r\nconst EmojiPicker = ({ onSelect }: EmojiPickerProps) => {\r\n  const { t } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [open, setOpen] = useState(false);\r\n  const [activeCategory, setActiveCategory] = useState(0);\r\n\r\n  const handleSelect = (emoji: string) => {\r\n    onSelect(emoji);\r\n    if (!isMobile) {\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const categoryLabels: Record<string, string> = {\r\n    smileys: t(\"emoji.smileys\", \"è¡¨æƒ…\"),\r\n    gestures: t(\"emoji.gestures\", \"æ‰‹åŠ¿\"),\r\n    food: t(\"emoji.food\", \"ç¾é£Ÿ\"),\r\n    hearts: t(\"emoji.hearts\", \"çˆ±å¿ƒ\"),\r\n    objects: t(\"emoji.objects\", \"ç‰©å“\"),\r\n    nature: t(\"emoji.nature\", \"è‡ªç„¶\"),\r\n  };\r\n\r\n  const emojiGrid = (\r\n    <div className=\"space-y-3\">\r\n      {/* Category tabs */}\r\n      <div className=\"flex gap-1 overflow-x-auto pb-2 border-b\">\r\n        {emojiCategories.map((category, index) => (\r\n          <button\r\n            key={category.name}\r\n            type=\"button\"\r\n            onClick={() => setActiveCategory(index)}\r\n            className={`px-3 py-1.5 text-sm rounded-full whitespace-nowrap transition-colors ${\r\n              activeCategory === index\r\n                ? \"bg-primary text-primary-foreground\"\r\n                : \"bg-muted hover:bg-muted/80 text-muted-foreground\"\r\n            }`}\r\n          >\r\n            {categoryLabels[category.name]}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Emoji grid */}\r\n      <div className=\"grid grid-cols-8 gap-1\">\r\n        {emojiCategories[activeCategory].emojis.map((emoji, index) => (\r\n          <button\r\n            key={index}\r\n            type=\"button\"\r\n            onClick={() => handleSelect(emoji)}\r\n            className=\"w-9 h-9 flex items-center justify-center text-xl hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            {emoji}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      onClick={() => setOpen(true)}\r\n      className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground transition-colors\"\r\n    >\r\n      <Smile className=\"h-5 w-5\" />\r\n      <span className=\"text-sm\">{t(\"community.emoji\", \"è¡¨æƒ…\")}</span>\r\n    </button>\r\n  );\r\n\r\n  // Mobile: Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={setOpen}>\r\n          <DrawerContent className=\"h-[50vh]\">\r\n            <DrawerHeader className=\"pb-2\">\r\n              <DrawerTitle>{t(\"emoji.title\", \"é€‰æ‹©è¡¨æƒ…\")}</DrawerTitle>\r\n            </DrawerHeader>\r\n            <ScrollArea className=\"flex-1 px-4 pb-4\">\r\n              {emojiGrid}\r\n            </ScrollArea>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover\r\n  return (\r\n    <Popover open={open} onOpenChange={setOpen}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-80 p-3\" align=\"start\" side=\"top\">\r\n        {emojiGrid}\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default EmojiPicker;\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Image, Video, X, Loader2, Calendar, MapPin, ArrowLeft } from \"lucide-react\";\r\nimport MultiRestaurantSelectDrawer from \"./MultiRestaurantSelectDrawer\";\r\nimport ActivitySelectDrawer from \"./ActivitySelectDrawer\";\r\nimport EmojiPicker from \"./EmojiPicker\";\r\nimport {\r\n  Sheet,\r\n  SheetContent,\r\n  SheetTitle,\r\n} from \"@/components/ui/sheet\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useEditPost, CommunityPost } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\";\r\n\r\ninterface EditPostDialogProps {\r\n  post: CommunityPost;\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst EditPostDialog = ({ post, open, onOpenChange }: EditPostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const editPost = useEditPost();\r\n  const { data: activities } = useActivities();\r\n  const { data: restaurants } = useRestaurants();\r\n  const { isMerchant, isAdmin, isSupervisor } = useUserRole();\r\n  const isRegularUser = !isMerchant && !isSupervisor && !isAdmin;\r\n\r\n  const [content, setContent] = useState(post.content);\r\n  const [imageUrls, setImageUrls] = useState<string[]>(post.image_urls || []);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(post.video_url || null);\r\n  const [activityId, setActivityId] = useState<string>(post.activity_id || \"\");\r\n  const [restaurantIds, setRestaurantIds] = useState<string[]>(\r\n    post.restaurants?.map(r => r.id) || (post.restaurant ? [post.restaurant.id] : [])\r\n  );\r\n  const [uploading, setUploading] = useState(false);\r\n  const [restaurantOpen, setRestaurantOpen] = useState(false);\r\n  const [activityOpen, setActivityOpen] = useState(false);\r\n  const [showRestaurantError, setShowRestaurantError] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // Reset form when post changes\r\n  useEffect(() => {\r\n    if (open) {\r\n      setContent(post.content);\r\n      setImageUrls(post.image_urls || []);\r\n      setVideoUrl(post.video_url || null);\r\n      setActivityId(post.activity_id || \"\");\r\n      setRestaurantIds(\r\n        post.restaurants?.map(r => r.id) || (post.restaurant ? [post.restaurant.id] : [])\r\n      );\r\n    }\r\n  }, [open, post]);\r\n\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"æœ€å¤šä¸Šä¼ 9å¼ å›¾ç‰‡\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n        if (uploadError) throw uploadError;\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) imageInputRef.current.value = \"\";\r\n    }\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"è§†é¢‘ä¸èƒ½è¶…è¿‡100MB\"));\r\n      return;\r\n    }\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n      const videoExt = file.name.split(\".\").pop();\r\n      const videoFileName = `${user.id}/${Date.now()}.${videoExt}`;\r\n      const { error: videoError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(videoFileName, file);\r\n      if (videoError) throw videoError;\r\n      const { data: { publicUrl: videoPublicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(videoFileName);\r\n      setVideoUrl(videoPublicUrl);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) videoInputRef.current.value = \"\";\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    setShowRestaurantError(false);\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"è¯·è¾“å…¥å†…å®¹\"));\r\n      return;\r\n    }\r\n    if (isRegularUser && restaurantIds.length === 0) {\r\n      setShowRestaurantError(true);\r\n      toast.error(t(\"community.restaurantRequired\", \"è¯·é€‰æ‹©é¤å…\"));\r\n      return;\r\n    }\r\n\r\n    await editPost.mutateAsync({\r\n      id: post.id,\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl,\r\n      activity_id: activityId || null,\r\n      restaurant_ids: restaurantIds.length > 0 ? restaurantIds : undefined,\r\n    });\r\n\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Sheet open={open} onOpenChange={onOpenChange}>\r\n      <SheetContent\r\n        side=\"bottom\"\r\n        className=\"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden\"\r\n      >\r\n        <VisuallyHidden.Root>\r\n          <SheetTitle>{t(\"community.editPost\", \"ç¼–è¾‘å¸–å­\")}</SheetTitle>\r\n        </VisuallyHidden.Root>\r\n\r\n        {/* Top Navigation */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => onOpenChange(false)}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <span className=\"font-medium text-sm\">{t(\"community.editPost\", \"ç¼–è¾‘å¸–å­\")}</span>\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={handleSubmit}\r\n            disabled={editPost.isPending || !content.trim()}\r\n            className=\"rounded-full px-6\"\r\n          >\r\n            {editPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            {t(\"community.resubmit\", \"é‡æ–°æäº¤\")}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Scrollable content */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          <div className=\"px-4 py-4 space-y-4\">\r\n            {/* Notice */}\r\n            <div className=\"px-3 py-2 bg-amber-500/10 border border-amber-500/30 rounded-md text-sm text-amber-700 dark:text-amber-400\">\r\n              {t(\"community.editNotice\", \"ç¼–è¾‘åå¸–å­å°†é‡æ–°æäº¤å®¡æ ¸\")}\r\n            </div>\r\n\r\n            <Textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder={t(\"community.contentPlaceholder\", \"åˆ†äº«ä½ çš„æƒ³æ³•...\")}\r\n              className=\"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base whitespace-pre-wrap\"\r\n            />\r\n\r\n            {/* Image previews */}\r\n            {imageUrls.length > 0 && (\r\n              <div className=\"grid grid-cols-3 gap-2\">\r\n                {imageUrls.map((url, index) => (\r\n                  <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden bg-muted\">\r\n                    <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => removeImage(index)}\r\n                      className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Video preview */}\r\n            {videoUrl && (\r\n              <div className=\"relative rounded-lg overflow-hidden\">\r\n                <video src={videoUrl} controls className=\"w-full max-h-48\" preload=\"metadata\" />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={removeVideo}\r\n                  className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                >\r\n                  <X className=\"h-4 w-4\" />\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Association section */}\r\n        <div className=\"px-4 py-2 pb-0 bg-background shrink-0 space-y-2\">\r\n          <div className=\"flex items-center gap-6\">\r\n            <div className={`flex items-center gap-3 ${showRestaurantError && isRegularUser && restaurantIds.length === 0 ? 'text-destructive' : ''}`}>\r\n              <MapPin className={`h-5 w-5 shrink-0 ${showRestaurantError && isRegularUser && restaurantIds.length === 0 ? 'text-destructive' : 'text-muted-foreground'}`} />\r\n              {isMerchant ? (\r\n                <span className=\"text-sm text-muted-foreground\">\r\n                  {restaurantIds.length > 0 ? t(\"community.restaurantSelected\", \"å·²é€‰æ‹©é¤å…\") : t(\"community.noRestaurant\", \"æœªå…³è”é¤å…\")}\r\n                </span>\r\n              ) : (\r\n                <MultiRestaurantSelectDrawer\r\n                  open={restaurantOpen}\r\n                  onOpenChange={(open) => {\r\n                    setRestaurantOpen(open);\r\n                    if (open) setShowRestaurantError(false);\r\n                  }}\r\n                  value={restaurantIds}\r\n                  onSelect={(ids) => {\r\n                    setRestaurantIds(ids);\r\n                    setShowRestaurantError(false);\r\n                  }}\r\n                  restaurants={restaurants || []}\r\n                  required={isRegularUser}\r\n                />\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <Calendar className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n              <ActivitySelectDrawer\r\n                open={activityOpen}\r\n                onOpenChange={setActivityOpen}\r\n                value={activityId}\r\n                onSelect={setActivityId}\r\n                activities={activeActivities}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {showRestaurantError && isRegularUser && restaurantIds.length === 0 && (\r\n            <p className=\"text-xs text-destructive pl-8\">\r\n              {t(\"community.restaurantRequired\", \"è¯·é€‰æ‹©é¤å…\")}\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Bottom toolbar */}\r\n        <div className=\"flex items-center gap-6 px-4 pt-0 py-2 pb-[max(2rem,calc(env(safe-area-inset-bottom)+1rem))] bg-background shrink-0\">\r\n          <input\r\n            ref={imageInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            multiple\r\n            className=\"hidden\"\r\n            onChange={handleImageUpload}\r\n          />\r\n          <input\r\n            ref={videoInputRef}\r\n            type=\"file\"\r\n            accept=\"video/*\"\r\n            className=\"hidden\"\r\n            onChange={handleVideoUpload}\r\n          />\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => imageInputRef.current?.click()}\r\n            disabled={uploading || imageUrls.length >= 9}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Image className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.photo\", \"ç…§ç‰‡\")}</span>\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => videoInputRef.current?.click()}\r\n            disabled={uploading || !!videoUrl}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Video className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.video\", \"è§†é¢‘\")}</span>\r\n          </button>\r\n\r\n          <EmojiPicker\r\n            onSelect={(emoji) => setContent((prev) => prev + emoji)}\r\n          />\r\n\r\n          {uploading && <Loader2 className=\"h-5 w-5 animate-spin ml-auto\" />}\r\n        </div>\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default EditPostDialog;\r\n","// Recipe types and interfaces\r\n\r\nexport interface Ingredient {\r\n  name: string;\r\n  name_en?: string;\r\n  name_pt?: string;\r\n  amount: string;\r\n  unit: string;\r\n  unit_en?: string;\r\n  unit_pt?: string;\r\n}\r\n\r\nexport interface RecipeStep {\r\n  order: number;\r\n  description: string;\r\n  description_en?: string;\r\n  description_pt?: string;\r\n  image_url?: string;\r\n  image_urls?: string[];\r\n}\r\n\r\nexport interface NutritionInfo {\r\n  calories?: number;\r\n  protein?: number;\r\n  carbs?: number;\r\n  fat?: number;\r\n}\r\n\r\nexport type RecipeDifficulty = 'easy' | 'medium' | 'hard';\r\n\r\nexport interface RecipeData {\r\n  recipe_name: string;\r\n  recipe_name_en?: string;\r\n  recipe_name_pt?: string;\r\n  subtitle?: string;\r\n  subtitle_en?: string;\r\n  subtitle_pt?: string;\r\n  cook_time: number; // in minutes\r\n  difficulty: RecipeDifficulty;\r\n  servings: number;\r\n  ingredients: Ingredient[];\r\n  steps: RecipeStep[];\r\n  // Optional fields (user can choose to add)\r\n  nutrition?: NutritionInfo;\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\nexport const DIFFICULTY_OPTIONS: { value: RecipeDifficulty; labelKey: string }[] = [\r\n  { value: 'easy', labelKey: 'recipe.difficulty.easy' },\r\n  { value: 'medium', labelKey: 'recipe.difficulty.medium' },\r\n  { value: 'hard', labelKey: 'recipe.difficulty.hard' },\r\n];\r\n\r\nexport const RECIPE_CATEGORIES = [\r\n  'breakfast',\r\n  'lunch', \r\n  'dinner',\r\n  'dessert',\r\n  'snack',\r\n  'drink',\r\n  'appetizer',\r\n  'main',\r\n  'side',\r\n  'soup',\r\n] as const;\r\n\r\nexport const COMMON_UNITS = [\r\n  'g', 'kg', 'ml', 'L', 'tsp', 'tbsp', 'cup', 'piece', 'slice', 'clove', 'pinch'\r\n] as const;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Clock, Users, ChefHat, Image, X, Loader2, Flame, ChevronDown, ChevronUp, FileText } from \"lucide-react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\nimport { RecipeData, DIFFICULTY_OPTIONS, RecipeDifficulty, NutritionInfo } from \"./RecipeTypes\";\r\nimport { useRef, useState } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface RecipeBasicStepProps {\r\n  data: Partial<RecipeData>;\r\n  coverImage: string | null;\r\n  nutrition: NutritionInfo;\r\n  introduction: string;\r\n  onDataChange: (data: Partial<RecipeData>) => void;\r\n  onCoverImageChange: (url: string | null) => void;\r\n  onNutritionChange: (nutrition: NutritionInfo) => void;\r\n  onIntroductionChange: (introduction: string) => void;\r\n}\r\n\r\nconst RecipeBasicStep = ({ data, coverImage, nutrition, introduction, onDataChange, onCoverImageChange, onNutritionChange, onIntroductionChange }: RecipeBasicStepProps) => {\r\n  const { t } = useTranslation();\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const [showNutrition, setShowNutrition] = useState(\r\n    !!(nutrition.calories || nutrition.protein || nutrition.carbs || nutrition.fat)\r\n  );\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      toast.error(t(\"common.imageTooLarge\", \"å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user.id}/${Date.now()}-recipe-cover.${fileExt}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(fileName, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(fileName);\r\n\r\n      onCoverImageChange(publicUrl);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Cover Image */}\r\n      <div className=\"space-y-2\">\r\n        <Label>{t(\"recipe.coverImage\", \"å°é¢å›¾ç‰‡\")}</Label>\r\n        <input\r\n          ref={imageInputRef}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          className=\"hidden\"\r\n          onChange={handleImageUpload}\r\n        />\r\n        {coverImage ? (\r\n          <div className=\"relative aspect-video rounded-lg overflow-hidden bg-muted\">\r\n            <img src={coverImage} alt=\"\" className=\"w-full h-full object-cover\" />\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => onCoverImageChange(null)}\r\n              className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => imageInputRef.current?.click()}\r\n            disabled={uploading}\r\n            className=\"w-full aspect-video rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-2 text-muted-foreground hover:border-primary hover:text-primary transition-colors\"\r\n          >\r\n            {uploading ? (\r\n              <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n            ) : (\r\n              <>\r\n                <Image className=\"h-8 w-8\" />\r\n                <span className=\"text-sm\">{t(\"recipe.addCoverImage\", \"æ·»åŠ å°é¢å›¾ç‰‡\")}</span>\r\n              </>\r\n            )}\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Recipe Name */}\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"recipe-name\">{t(\"recipe.name\", \"é£Ÿè°±åç§°\")} *</Label>\r\n        <Input\r\n          id=\"recipe-name\"\r\n          value={data.recipe_name || \"\"}\r\n          onChange={(e) => onDataChange({ ...data, recipe_name: e.target.value })}\r\n          placeholder={t(\"recipe.namePlaceholder\", \"å¦‚ï¼šçº¢çƒ§è‚‰ã€ç•ªèŒ„ç‚’è›‹\")}\r\n        />\r\n      </div>\r\n\r\n      {/* Subtitle - Food Philosophy */}\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"subtitle\">\r\n          {t(\"recipe.subtitle\", \"å‰¯æ ‡é¢˜\")}\r\n          <span className=\"text-xs text-muted-foreground ml-1\">({t(\"common.optional\", \"å¯é€‰\")})</span>\r\n        </Label>\r\n        <Input\r\n          id=\"subtitle\"\r\n          value={data.subtitle || \"\"}\r\n          onChange={(e) => onDataChange({ ...data, subtitle: e.target.value })}\r\n          placeholder={t(\"recipe.subtitlePlaceholder\", \"ä¸€å¥è¯æè¿°è¿™é“èœçš„ç¾é£Ÿå“²å­¦æˆ–çµé­‚\")}\r\n        />\r\n      </div>\r\n\r\n      {/* Food Introduction */}\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"introduction\">\r\n          <FileText className=\"h-4 w-4 inline mr-1\" />\r\n          {t(\"recipe.introduction\", \"ç¾é£Ÿä»‹ç»\")}\r\n        </Label>\r\n        <Textarea\r\n          id=\"introduction\"\r\n          value={introduction}\r\n          onChange={(e) => onIntroductionChange(e.target.value)}\r\n          placeholder={t(\"recipe.introductionPlaceholder\", \"ä»‹ç»è¿™é“ç¾é£Ÿçš„ç‰¹è‰²ã€å£æ„Ÿã€æ¥æºæ•…äº‹ç­‰...\")}\r\n          rows={Math.max(3, Math.min(12, (introduction?.split('\\n').length || 1) + 1))}\r\n          className=\"resize-y min-h-[80px]\"\r\n        />\r\n        {introduction && (\r\n          <p className=\"text-xs text-muted-foreground text-right\">\r\n            {introduction.length} {t(\"common.characters\", \"å­—\")}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Cook Time */}\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"cook-time\">\r\n          <Clock className=\"h-4 w-4 inline mr-1\" />\r\n          {t(\"recipe.cookTime\", \"çƒ¹é¥ªæ—¶é—´\")} *\r\n        </Label>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Input\r\n            id=\"cook-time\"\r\n            type=\"number\"\r\n            min={1}\r\n            value={data.cook_time || \"\"}\r\n            onChange={(e) => onDataChange({ ...data, cook_time: parseInt(e.target.value) || 0 })}\r\n            placeholder=\"30\"\r\n            className=\"w-24\"\r\n          />\r\n          <span className=\"text-sm text-muted-foreground\">{t(\"recipe.minutes\", \"åˆ†é’Ÿ\")}</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Difficulty */}\r\n      <div className=\"space-y-2\">\r\n        <Label>\r\n          <ChefHat className=\"h-4 w-4 inline mr-1\" />\r\n          {t(\"recipe.difficulty\", \"éš¾åº¦\")} *\r\n        </Label>\r\n        <Select\r\n          value={data.difficulty || \"\"}\r\n          onValueChange={(value) => onDataChange({ ...data, difficulty: value as RecipeDifficulty })}\r\n        >\r\n          <SelectTrigger>\r\n            <SelectValue placeholder={t(\"recipe.selectDifficulty\", \"é€‰æ‹©éš¾åº¦\")} />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            {DIFFICULTY_OPTIONS.map((option) => (\r\n              <SelectItem key={option.value} value={option.value}>\r\n                {t(option.labelKey, option.value)}\r\n              </SelectItem>\r\n            ))}\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      {/* Servings */}\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"servings\">\r\n          <Users className=\"h-4 w-4 inline mr-1\" />\r\n          {t(\"recipe.servings\", \"ä»½é‡\")} *\r\n        </Label>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Input\r\n            id=\"servings\"\r\n            type=\"number\"\r\n            min={1}\r\n            value={data.servings || \"\"}\r\n            onChange={(e) => onDataChange({ ...data, servings: parseInt(e.target.value) || 0 })}\r\n            placeholder=\"2\"\r\n            className=\"w-24\"\r\n          />\r\n          <span className=\"text-sm text-muted-foreground\">{t(\"recipe.people\", \"äººä»½\")}</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Optional Nutrition Info */}\r\n      <Collapsible open={showNutrition} onOpenChange={setShowNutrition}>\r\n        <CollapsibleTrigger asChild>\r\n          <Button variant=\"ghost\" type=\"button\" className=\"w-full justify-between px-0 hover:bg-transparent\">\r\n            <span className=\"flex items-center gap-2 text-sm font-medium\">\r\n              <Flame className=\"h-4 w-4\" />\r\n              {t(\"recipe.nutritionInfo\", \"è¥å…»ä¿¡æ¯\")}\r\n              <span className=\"text-xs text-muted-foreground font-normal\">\r\n                ({t(\"common.optional\", \"å¯é€‰\")})\r\n              </span>\r\n            </span>\r\n            {showNutrition ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\r\n          </Button>\r\n        </CollapsibleTrigger>\r\n        <CollapsibleContent className=\"space-y-4 pt-2\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            {/* Calories */}\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"calories\" className=\"text-xs\">\r\n                {t(\"recipe.calories\", \"å¡è·¯é‡Œ\")}\r\n              </Label>\r\n              <div className=\"flex items-center gap-1\">\r\n                <Input\r\n                  id=\"calories\"\r\n                  type=\"number\"\r\n                  min={0}\r\n                  value={nutrition.calories || \"\"}\r\n                  onChange={(e) => onNutritionChange({ ...nutrition, calories: parseInt(e.target.value) || undefined })}\r\n                  placeholder=\"300\"\r\n                  className=\"h-8\"\r\n                />\r\n                <span className=\"text-xs text-muted-foreground\">kcal</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Protein */}\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"protein\" className=\"text-xs\">\r\n                {t(\"recipe.protein\", \"è›‹ç™½è´¨\")}\r\n              </Label>\r\n              <div className=\"flex items-center gap-1\">\r\n                <Input\r\n                  id=\"protein\"\r\n                  type=\"number\"\r\n                  min={0}\r\n                  value={nutrition.protein || \"\"}\r\n                  onChange={(e) => onNutritionChange({ ...nutrition, protein: parseInt(e.target.value) || undefined })}\r\n                  placeholder=\"20\"\r\n                  className=\"h-8\"\r\n                />\r\n                <span className=\"text-xs text-muted-foreground\">g</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Carbs */}\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"carbs\" className=\"text-xs\">\r\n                {t(\"recipe.carbs\", \"ç¢³æ°´\")}\r\n              </Label>\r\n              <div className=\"flex items-center gap-1\">\r\n                <Input\r\n                  id=\"carbs\"\r\n                  type=\"number\"\r\n                  min={0}\r\n                  value={nutrition.carbs || \"\"}\r\n                  onChange={(e) => onNutritionChange({ ...nutrition, carbs: parseInt(e.target.value) || undefined })}\r\n                  placeholder=\"30\"\r\n                  className=\"h-8\"\r\n                />\r\n                <span className=\"text-xs text-muted-foreground\">g</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Fat */}\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"fat\" className=\"text-xs\">\r\n                {t(\"recipe.fat\", \"è„‚è‚ª\")}\r\n              </Label>\r\n              <div className=\"flex items-center gap-1\">\r\n                <Input\r\n                  id=\"fat\"\r\n                  type=\"number\"\r\n                  min={0}\r\n                  value={nutrition.fat || \"\"}\r\n                  onChange={(e) => onNutritionChange({ ...nutrition, fat: parseInt(e.target.value) || undefined })}\r\n                  placeholder=\"10\"\r\n                  className=\"h-8\"\r\n                />\r\n                <span className=\"text-xs text-muted-foreground\">g</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CollapsibleContent>\r\n      </Collapsible>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeBasicStep;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Plus, Trash2 } from \"lucide-react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Ingredient, COMMON_UNITS } from \"./RecipeTypes\";\r\n\r\ninterface RecipeIngredientsStepProps {\r\n  ingredients: Ingredient[];\r\n  onChange: (ingredients: Ingredient[]) => void;\r\n}\r\n\r\nconst RecipeIngredientsStep = ({ ingredients, onChange }: RecipeIngredientsStepProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  const addIngredient = () => {\r\n    onChange([...ingredients, { name: \"\", amount: \"\", unit: \"\" }]);\r\n  };\r\n\r\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\r\n    const updated = [...ingredients];\r\n    updated[index] = { ...updated[index], [field]: value };\r\n    onChange(updated);\r\n  };\r\n\r\n  const removeIngredient = (index: number) => {\r\n    onChange(ingredients.filter((_, i) => i !== index));\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <Label className=\"text-base font-medium\">{t(\"recipe.ingredients\", \"é…æ–™\")} *</Label>\r\n        <span className=\"text-sm text-muted-foreground\">\r\n          {ingredients.filter(i => i.name).length} {t(\"recipe.items\", \"é¡¹\")}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"space-y-3\">\r\n        {ingredients.map((ingredient, index) => (\r\n          <div key={index} className=\"space-y-1.5\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"flex-1\">\r\n                <Input\r\n                  value={ingredient.name}\r\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\r\n                  placeholder={t(\"recipe.ingredientName\", \"é…æ–™åç§°\")}\r\n                />\r\n              </div>\r\n              <div className=\"w-20\">\r\n                <Input\r\n                  value={ingredient.amount}\r\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\r\n                  placeholder={t(\"recipe.amount\", \"é‡\")}\r\n                />\r\n              </div>\r\n              <div className=\"w-20\">\r\n                <Input\r\n                  value={ingredient.unit}\r\n                  onChange={(e) => updateIngredient(index, \"unit\", e.target.value)}\r\n                  placeholder={t(\"recipe.unit\", \"å•ä½\")}\r\n                  list=\"common-units\"\r\n                />\r\n                <datalist id=\"common-units\">\r\n                  {COMMON_UNITS.map((unit) => (\r\n                    <option key={unit} value={unit} />\r\n                  ))}\r\n                </datalist>\r\n              </div>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={() => removeIngredient(index)}\r\n                disabled={ingredients.length === 1}\r\n                className=\"shrink-0\"\r\n              >\r\n                <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <Button\r\n        type=\"button\"\r\n        variant=\"outline\"\r\n        onClick={addIngredient}\r\n        className=\"w-full\"\r\n      >\r\n        <Plus className=\"h-4 w-4 mr-2\" />\r\n        {t(\"recipe.addIngredient\", \"æ·»åŠ é…æ–™\")}\r\n      </Button>\r\n\r\n      {/* Common units hint */}\r\n      <p className=\"text-xs text-muted-foreground\">\r\n        {t(\"recipe.unitsHint\", \"å¸¸ç”¨å•ä½ï¼šg, kg, ml, L, å‹º, æ¯, ä¸ª, ç‰‡, é€‚é‡\")}\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeIngredientsStep;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Plus, Trash2, Image, X, Loader2, GripVertical } from \"lucide-react\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { RecipeStep } from \"./RecipeTypes\";\r\nimport { useRef, useState } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst MAX_STEP_IMAGES = 3;\r\n\r\ninterface RecipeStepsStepProps {\r\n  steps: RecipeStep[];\r\n  onChange: (steps: RecipeStep[]) => void;\r\n}\r\n\r\nconst RecipeStepsStep = ({ steps, onChange }: RecipeStepsStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [uploadingIndex, setUploadingIndex] = useState<number | null>(null);\r\n  const imageInputRefs = useRef<(HTMLInputElement | null)[]>([]);\r\n\r\n  const getStepImages = (step: RecipeStep): string[] => {\r\n    if (step.image_urls && step.image_urls.length > 0) return step.image_urls;\r\n    if (step.image_url) return [step.image_url];\r\n    return [];\r\n  };\r\n\r\n  const addStep = () => {\r\n    const newOrder = steps.length + 1;\r\n    onChange([...steps, { order: newOrder, description: \"\", image_urls: [] }]);\r\n  };\r\n\r\n  const updateStep = (index: number, field: keyof RecipeStep, value: any) => {\r\n    const updated = [...steps];\r\n    updated[index] = { ...updated[index], [field]: value };\r\n    onChange(updated);\r\n  };\r\n\r\n  const removeStep = (index: number) => {\r\n    const updated = steps\r\n      .filter((_, i) => i !== index)\r\n      .map((step, i) => ({ ...step, order: i + 1 }));\r\n    onChange(updated);\r\n  };\r\n\r\n  const removeImage = (stepIndex: number, imageIndex: number) => {\r\n    const images = getStepImages(steps[stepIndex]);\r\n    const newImages = images.filter((_, i) => i !== imageIndex);\r\n    updateStep(stepIndex, \"image_urls\", newImages);\r\n    // Clear legacy field\r\n    updateStep(stepIndex, \"image_url\", undefined);\r\n  };\r\n\r\n  const handleImageUpload = async (index: number, e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    const currentImages = getStepImages(steps[index]);\r\n    if (currentImages.length >= MAX_STEP_IMAGES) {\r\n      toast.error(t(\"recipe.maxStepImages\", \"æ¯ä¸ªæ­¥éª¤æœ€å¤šä¸Šä¼ {{max}}å¼ å›¾ç‰‡\", { max: MAX_STEP_IMAGES }));\r\n      return;\r\n    }\r\n\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      toast.error(t(\"common.imageTooLarge\", \"å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploadingIndex(index);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user.id}/${Date.now()}-step-${index}.${fileExt}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(fileName, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(fileName);\r\n\r\n      const newImages = [...currentImages, publicUrl];\r\n      const updated = [...steps];\r\n      updated[index] = { ...updated[index], image_urls: newImages, image_url: undefined };\r\n      onChange(updated);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploadingIndex(null);\r\n      if (imageInputRefs.current[index]) {\r\n        imageInputRefs.current[index]!.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <Label className=\"text-base font-medium\">{t(\"recipe.steps\", \"çƒ¹é¥ªæ­¥éª¤\")} *</Label>\r\n        <span className=\"text-sm text-muted-foreground\">\r\n          {steps.filter(s => s.description).length} {t(\"recipe.stepsCount\", \"æ­¥\")}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        {steps.map((step, index) => {\r\n          const images = getStepImages(step);\r\n          return (\r\n            <div key={index} className=\"p-4 border rounded-lg space-y-3 bg-card\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\r\n                  <span className=\"font-medium text-primary\">\r\n                    {t(\"recipe.stepNumber\", \"ç¬¬{{n}}æ­¥\", { n: index + 1 })}\r\n                  </span>\r\n                </div>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  onClick={() => removeStep(index)}\r\n                  disabled={steps.length === 1}\r\n                >\r\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n                </Button>\r\n              </div>\r\n\r\n              <Textarea\r\n                value={step.description}\r\n                onChange={(e) => updateStep(index, \"description\", e.target.value)}\r\n                placeholder={t(\"recipe.stepDescriptionPlaceholder\", \"æè¿°è¿™ä¸€æ­¥çš„æ“ä½œ...\")}\r\n                className=\"min-h-[80px]\"\r\n              />\r\n\r\n              {/* Step Images */}\r\n              <div>\r\n                <input\r\n                  ref={(el) => (imageInputRefs.current[index] = el)}\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  className=\"hidden\"\r\n                  onChange={(e) => handleImageUpload(index, e)}\r\n                />\r\n                \r\n                {images.length > 0 && (\r\n                  <div className=\"flex flex-wrap gap-2 mb-2\">\r\n                    {images.map((url, imgIdx) => (\r\n                      <div key={imgIdx} className=\"relative w-24 h-20 rounded-lg overflow-hidden bg-muted\">\r\n                        <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => removeImage(index, imgIdx)}\r\n                          className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                        >\r\n                          <X className=\"h-3 w-3\" />\r\n                        </button>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n\r\n                {images.length < MAX_STEP_IMAGES && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => imageInputRefs.current[index]?.click()}\r\n                    disabled={uploadingIndex === index}\r\n                    className=\"flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors\"\r\n                  >\r\n                    {uploadingIndex === index ? (\r\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                    ) : (\r\n                      <Image className=\"h-4 w-4\" />\r\n                    )}\r\n                    <span>\r\n                      {images.length === 0\r\n                        ? t(\"recipe.addStepImage\", \"æ·»åŠ æ­¥éª¤å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰\")\r\n                        : t(\"recipe.addMoreImages\", \"ç»§ç»­æ·»åŠ  ({{current}}/{{max}})\", { current: images.length, max: MAX_STEP_IMAGES })}\r\n                    </span>\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      <Button\r\n        type=\"button\"\r\n        variant=\"outline\"\r\n        onClick={addStep}\r\n        className=\"w-full\"\r\n      >\r\n        <Plus className=\"h-4 w-4 mr-2\" />\r\n        {t(\"recipe.addStep\", \"æ·»åŠ æ­¥éª¤\")}\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeStepsStep;\r\n","import { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Ingredient, RecipeStep, RecipeDifficulty } from \"@/components/community/recipe/RecipeTypes\";\r\n\r\ninterface EditRecipeParams {\r\n  id: string;\r\n  recipe_name: string;\r\n  cook_time: number;\r\n  difficulty: RecipeDifficulty;\r\n  servings: number;\r\n  ingredients: Ingredient[];\r\n  steps: RecipeStep[];\r\n  cover_image?: string | null;\r\n  introduction?: string;\r\n  nutrition?: {\r\n    calories?: number;\r\n    protein?: number;\r\n    carbs?: number;\r\n    fat?: number;\r\n  };\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\nexport const useEditRecipe = () => {\r\n  const queryClient = useQueryClient();\r\n  const { t } = useTranslation();\r\n\r\n  return useMutation({\r\n    mutationFn: async (params: EditRecipeParams) => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const content = params.introduction || \"\";\r\n\r\n      // Prepare image_urls\r\n      const imageUrls: string[] = [];\r\n      if (params.cover_image) {\r\n        imageUrls.push(params.cover_image);\r\n      }\r\n      params.steps.forEach(step => {\r\n        if (step.image_urls && step.image_urls.length > 0) {\r\n          step.image_urls.forEach(url => imageUrls.push(url));\r\n        } else if (step.image_url) {\r\n          imageUrls.push(step.image_url);\r\n        }\r\n      });\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"community_posts\")\r\n        .update({\r\n          content,\r\n          image_urls: imageUrls,\r\n          recipe_name: params.recipe_name,\r\n          cook_time: params.cook_time,\r\n          difficulty: params.difficulty,\r\n          servings: params.servings,\r\n          ingredients: params.ingredients as unknown as any,\r\n          steps: params.steps as unknown as any,\r\n          nutrition: params.nutrition ? (params.nutrition as unknown as any) : null,\r\n          recipe_tags: params.recipe_tags || null,\r\n          recipe_category: params.recipe_category || null,\r\n          status: \"pending\",\r\n          moderation_status: \"pending\",\r\n          risk_score: null,\r\n          risk_reasons: null,\r\n          ai_reviewed_at: null,\r\n        } as any)\r\n        .eq(\"id\", params.id)\r\n        .eq(\"author_id\", user.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      // Trigger re-moderation\r\n      try {\r\n        await supabase.functions.invoke(\"moderate-post\", {\r\n          body: {\r\n            post_id: data.id,\r\n            content,\r\n            user_id: user.id,\r\n            image_urls: imageUrls,\r\n          },\r\n        });\r\n      } catch (err) {\r\n        console.error(\"Moderation call failed:\", err);\r\n      }\r\n\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"community-posts\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"community-post\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-community-posts\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"has-posted-today\"] });\r\n      toast.success(t(\"recipe.editSuccess\", \"é£Ÿè°±å·²æ›´æ–°ï¼Œç­‰å¾…å®¡æ ¸\"));\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Edit recipe error:\", error);\r\n      toast.error(t(\"recipe.editError\", \"ç¼–è¾‘å¤±è´¥\"));\r\n    },\r\n  });\r\n};\r\n","import { useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ArrowLeft, ArrowRight, Loader2, Check } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport RecipeBasicStep from \"./RecipeBasicStep\";\r\nimport RecipeIngredientsStep from \"./RecipeIngredientsStep\";\r\nimport RecipeStepsStep from \"./RecipeStepsStep\";\r\nimport { RecipeData, Ingredient, RecipeStep, NutritionInfo } from \"./RecipeTypes\";\r\nimport { useEditRecipe } from \"@/hooks/useEditRecipe\";\r\nimport { toast } from \"sonner\";\r\nimport { CommunityPost } from \"@/hooks/useCommunityPosts\";\r\n\r\ninterface ExtendedPost extends CommunityPost {\r\n  post_type?: string;\r\n  recipe_name?: string;\r\n  recipe_name_en?: string;\r\n  recipe_name_pt?: string;\r\n  cook_time?: number;\r\n  difficulty?: string;\r\n  servings?: number;\r\n  ingredients?: Ingredient[];\r\n  steps?: RecipeStep[];\r\n  nutrition?: NutritionInfo;\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\ninterface EditRecipeWizardProps {\r\n  post: ExtendedPost;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst EditRecipeWizard = ({ post, onClose, onSuccess }: EditRecipeWizardProps) => {\r\n  const { t } = useTranslation();\r\n  const editRecipe = useEditRecipe();\r\n\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n\r\n  // Derive cover image: first image_url if present and not a step image\r\n  const deriveCoverImage = () => {\r\n    if (!post.image_urls || post.image_urls.length === 0) return null;\r\n    // The first image is the cover if it exists\r\n    return post.image_urls[0] || null;\r\n  };\r\n\r\n  const [coverImage, setCoverImage] = useState<string | null>(deriveCoverImage());\r\n  const [recipeData, setRecipeData] = useState<Partial<RecipeData>>({\r\n    recipe_name: post.recipe_name || \"\",\r\n    cook_time: post.cook_time || undefined,\r\n    difficulty: (post.difficulty as any) || undefined,\r\n    servings: post.servings || undefined,\r\n  });\r\n  const [ingredients, setIngredients] = useState<Ingredient[]>(\r\n    post.ingredients && post.ingredients.length > 0\r\n      ? post.ingredients\r\n      : [{ name: \"\", amount: \"\", unit: \"\" }]\r\n  );\r\n  const [steps, setSteps] = useState<RecipeStep[]>(\r\n    post.steps && post.steps.length > 0\r\n      ? post.steps\r\n      : [{ order: 1, description: \"\" }]\r\n  );\r\n  const [nutrition, setNutrition] = useState<NutritionInfo>(\r\n    post.nutrition || {}\r\n  );\r\n  const [introduction, setIntroduction] = useState(post.content || \"\");\r\n\r\n  const STEPS = [\r\n    { key: \"basic\", title: t(\"recipe.step.basic\", \"åŸºæœ¬ä¿¡æ¯\") },\r\n    { key: \"ingredients\", title: t(\"recipe.step.ingredients\", \"é…æ–™\") },\r\n    { key: \"steps\", title: t(\"recipe.step.steps\", \"æ­¥éª¤\") },\r\n  ];\r\n\r\n  const progress = ((currentStep + 1) / STEPS.length) * 100;\r\n\r\n  const validateBasicStep = () => {\r\n    if (!recipeData.recipe_name?.trim()) {\r\n      toast.error(t(\"recipe.nameRequired\", \"è¯·è¾“å…¥é£Ÿè°±åç§°\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.cook_time || recipeData.cook_time < 1) {\r\n      toast.error(t(\"recipe.cookTimeRequired\", \"è¯·è¾“å…¥çƒ¹é¥ªæ—¶é—´\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.difficulty) {\r\n      toast.error(t(\"recipe.difficultyRequired\", \"è¯·é€‰æ‹©éš¾åº¦\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.servings || recipeData.servings < 1) {\r\n      toast.error(t(\"recipe.servingsRequired\", \"è¯·è¾“å…¥ä»½é‡\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const validateIngredientsStep = () => {\r\n    const validIngredients = ingredients.filter(i => i.name.trim());\r\n    if (validIngredients.length === 0) {\r\n      toast.error(t(\"recipe.ingredientsRequired\", \"è¯·è‡³å°‘æ·»åŠ ä¸€ç§é…æ–™\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const validateStepsStep = () => {\r\n    const validSteps = steps.filter(s => s.description.trim());\r\n    if (validSteps.length === 0) {\r\n      toast.error(t(\"recipe.stepsRequired\", \"è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæ­¥éª¤\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (currentStep === 0 && !validateBasicStep()) return;\r\n    if (currentStep === 1 && !validateIngredientsStep()) return;\r\n    setCurrentStep((prev) => Math.min(prev + 1, STEPS.length - 1));\r\n  };\r\n\r\n  const handleBack = () => {\r\n    setCurrentStep((prev) => Math.max(prev - 1, 0));\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!validateStepsStep()) return;\r\n\r\n    const validIngredients = ingredients.filter(i => i.name.trim());\r\n    const validSteps = steps\r\n      .filter(s => s.description.trim())\r\n      .map((s, i) => ({ ...s, order: i + 1 }));\r\n\r\n    const hasNutrition = nutrition.calories || nutrition.protein || nutrition.carbs || nutrition.fat;\r\n\r\n    try {\r\n      await editRecipe.mutateAsync({\r\n        id: post.id,\r\n        recipe_name: recipeData.recipe_name!,\r\n        cook_time: recipeData.cook_time!,\r\n        difficulty: recipeData.difficulty!,\r\n        servings: recipeData.servings!,\r\n        ingredients: validIngredients,\r\n        steps: validSteps,\r\n        cover_image: coverImage,\r\n        nutrition: hasNutrition ? nutrition : undefined,\r\n        introduction: introduction.trim() || undefined,\r\n      });\r\n      onSuccess();\r\n    } catch (error) {\r\n      // Error handled in hook\r\n    }\r\n  };\r\n\r\n  const renderStepContent = () => {\r\n    switch (currentStep) {\r\n      case 0:\r\n        return (\r\n          <RecipeBasicStep\r\n            data={recipeData}\r\n            coverImage={coverImage}\r\n            nutrition={nutrition}\r\n            introduction={introduction}\r\n            onDataChange={setRecipeData}\r\n            onCoverImageChange={setCoverImage}\r\n            onNutritionChange={setNutrition}\r\n            onIntroductionChange={setIntroduction}\r\n          />\r\n        );\r\n      case 1:\r\n        return (\r\n          <RecipeIngredientsStep\r\n            ingredients={ingredients}\r\n            onChange={setIngredients}\r\n          />\r\n        );\r\n      case 2:\r\n        return (\r\n          <RecipeStepsStep\r\n            steps={steps}\r\n            onChange={setSteps}\r\n          />\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      {/* Header */}\r\n      <div className=\"px-4 py-3 border-b bg-background shrink-0\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <h2 className=\"font-medium\">{t(\"recipe.editTitle\", \"ç¼–è¾‘é£Ÿè°±\")}</h2>\r\n          <div className=\"w-6\" />\r\n        </div>\r\n\r\n        {/* Notice */}\r\n        <div className=\"px-3 py-2 mb-3 bg-amber-500/10 border border-amber-500/30 rounded-md text-xs text-amber-700 dark:text-amber-400\">\r\n          {t(\"community.editNotice\", \"ç¼–è¾‘åå¸–å­å°†é‡æ–°æäº¤å®¡æ ¸\")}\r\n        </div>\r\n\r\n        {/* Step Progress */}\r\n        <div className=\"space-y-2\">\r\n          <Progress value={progress} className=\"h-1\" />\r\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\r\n            {STEPS.map((step, index) => (\r\n              <span\r\n                key={step.key}\r\n                className={index === currentStep ? \"text-primary font-medium\" : \"\"}\r\n              >\r\n                {step.title}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-y-auto p-4\">\r\n        {renderStepContent()}\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <div className=\"px-4 py-3 pb-[max(1rem,env(safe-area-inset-bottom))] border-t bg-background shrink-0\">\r\n        <div className=\"flex gap-3\">\r\n          {currentStep > 0 && (\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleBack}\r\n              className=\"flex-1\"\r\n            >\r\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n              {t(\"common.back\", \"ä¸Šä¸€æ­¥\")}\r\n            </Button>\r\n          )}\r\n          \r\n          {currentStep < STEPS.length - 1 ? (\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleNext}\r\n              className=\"flex-1\"\r\n            >\r\n              {t(\"common.next\", \"ä¸‹ä¸€æ­¥\")}\r\n              <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n            </Button>\r\n          ) : (\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleSubmit}\r\n              disabled={editRecipe.isPending}\r\n              className=\"flex-1\"\r\n            >\r\n              {editRecipe.isPending ? (\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              ) : (\r\n                <Check className=\"h-4 w-4 mr-2\" />\r\n              )}\r\n              {t(\"recipe.resubmit\", \"é‡æ–°æäº¤\")}\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditRecipeWizard;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport {\r\n  Sheet,\r\n  SheetContent,\r\n  SheetTitle,\r\n} from \"@/components/ui/sheet\";\r\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\";\r\nimport EditRecipeWizard from \"./recipe/EditRecipeWizard\";\r\nimport { CommunityPost } from \"@/hooks/useCommunityPosts\";\r\n\r\ninterface EditRecipeDialogProps {\r\n  post: CommunityPost;\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst EditRecipeDialog = ({ post, open, onOpenChange }: EditRecipeDialogProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Sheet open={open} onOpenChange={onOpenChange}>\r\n      <SheetContent\r\n        side=\"bottom\"\r\n        className=\"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden\"\r\n      >\r\n        <VisuallyHidden.Root>\r\n          <SheetTitle>{t(\"recipe.editTitle\", \"ç¼–è¾‘é£Ÿè°±\")}</SheetTitle>\r\n        </VisuallyHidden.Root>\r\n        <EditRecipeWizard\r\n          post={post as any}\r\n          onClose={() => onOpenChange(false)}\r\n          onSuccess={() => onOpenChange(false)}\r\n        />\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default EditRecipeDialog;\r\n"],"names":["MultiRestaurantSelectDrawer","open","onOpenChange","value","onSelect","restaurants","required","maxDisplay","t","useTranslation","getLocalizedField","useLocalizedContent","isMobile","useIsMobile","search","setSearch","useState","pendingValue","setPendingValue","drawerHeight","setDrawerHeight","useEffect","viewport","updateHeight","availableHeight","targetHeight","handleOpenChange","newOpen","filteredRestaurants","r","name","address","searchLower","toggleRestaurant","restaurantId","prev","id","handleConfirm","handleDesktopToggle","newValue","selectedNames","restaurant","TriggerContent","jsxs","jsx","displayNames","remaining","i","Badge","triggerButton","ChevronsUpDown","RestaurantItem","isSelected","onToggle","cn","Check","MapPin","Fragment","Drawer","DrawerContent","DrawerHeader","DrawerTitle","Search","Input","e","X","DrawerFooter","Button","Popover","PopoverTrigger","PopoverContent","Command","React.forwardRef","className","props","ref","CommandPrimitive","CommandInput","CommandList","CommandEmpty","CommandGroup","CommandSeparator","CommandItem","ActivitySelectDrawer","activities","getSelectedName","selected","a","handleDesktopSelect","activityId","ScrollArea","activity","Calendar","emojiCategories","EmojiPicker","setOpen","activeCategory","setActiveCategory","handleSelect","emoji","categoryLabels","emojiGrid","category","index","Smile","EditPostDialog","post","editPost","useEditPost","useActivities","useRestaurants","isMerchant","isAdmin","isSupervisor","useUserRole","isRegularUser","content","setContent","imageUrls","setImageUrls","videoUrl","setVideoUrl","setActivityId","restaurantIds","setRestaurantIds","uploading","setUploading","restaurantOpen","setRestaurantOpen","activityOpen","setActivityOpen","showRestaurantError","setShowRestaurantError","imageInputRef","useRef","videoInputRef","activeActivities","handleImageUpload","files","toast","user","supabase","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","error","handleVideoUpload","videoExt","videoFileName","videoError","videoPublicUrl","removeImage","_","removeVideo","handleSubmit","Sheet","SheetContent","VisuallyHidden.Root","SheetTitle","ArrowLeft","Loader2","Textarea","url","ids","Image","Video","DIFFICULTY_OPTIONS","COMMON_UNITS","RecipeBasicStep","data","coverImage","nutrition","introduction","onDataChange","onCoverImageChange","onNutritionChange","onIntroductionChange","showNutrition","setShowNutrition","Label","FileText","Clock","ChefHat","Select","SelectTrigger","SelectValue","SelectContent","option","SelectItem","Users","Collapsible","CollapsibleTrigger","Flame","ChevronUp","ChevronDown","CollapsibleContent","RecipeIngredientsStep","ingredients","onChange","addIngredient","updateIngredient","field","updated","removeIngredient","ingredient","unit","Trash2","Plus","MAX_STEP_IMAGES","RecipeStepsStep","steps","uploadingIndex","setUploadingIndex","imageInputRefs","getStepImages","step","addStep","newOrder","updateStep","removeStep","stepIndex","imageIndex","newImages","currentImages","s","images","GripVertical","el","imgIdx","useEditRecipe","queryClient","useQueryClient","useMutation","params","err","EditRecipeWizard","onClose","onSuccess","editRecipe","currentStep","setCurrentStep","deriveCoverImage","setCoverImage","recipeData","setRecipeData","setIngredients","setSteps","setNutrition","setIntroduction","STEPS","progress","validateBasicStep","validateIngredientsStep","validateStepsStep","handleNext","handleBack","validIngredients","validSteps","hasNutrition","renderStepContent","Progress","ArrowRight","EditRecipeDialog"],"mappings":"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"}