{"version":3,"file":"AdminUsers-CzeEKrJB.js","sources":["../../src/components/admin/CreateUserDialog.tsx","../../src/components/admin/MerchantRestaurantsDialog.tsx","../../src/components/admin/AssignMerchantToSupervisorDialog.tsx","../../src/components/admin/AssignMerchantsToSupervisorDialog.tsx","../../src/components/admin/EditMerchantProfileDialog.tsx","../../src/components/admin/DeleteUserDialog.tsx","../../src/pages/admin/AdminUsers.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { Loader2, UserPlus } from \"lucide-react\";\r\n\r\ninterface CreateUserDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreateUserDialog = ({ trigger }: CreateUserDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const { isSupervisor } = useUserRole();\r\n  const [open, setOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    email: \"\",\r\n    password: \"\",\r\n    displayName: \"\",\r\n    phone: \"\",\r\n    role: \"merchant\" as \"merchant\" | \"supervisor\",\r\n  });\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      \r\n      const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/admin-create-user`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": `Bearer ${session?.access_token}`,\r\n        },\r\n        body: JSON.stringify({\r\n          email: formData.email,\r\n          password: formData.password,\r\n          displayName: formData.displayName,\r\n          phone: formData.phone,\r\n          role: formData.role,\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(result.error || \"Failed to create user\");\r\n      }\r\n\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"admin.userCreated\"),\r\n      });\r\n\r\n      setOpen(false);\r\n      setFormData({\r\n        email: \"\",\r\n        password: \"\",\r\n        displayName: \"\",\r\n        phone: \"\",\r\n        role: \"merchant\",\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n    } catch (error: any) {\r\n      console.error(\"Error creating user:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: error.message || t(\"admin.createUserError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {trigger || (\r\n          <Button>\r\n            <UserPlus className=\"mr-2 h-4 w-4\" />\r\n            {t(\"admin.createUser\")}\r\n          </Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-[90vw] sm:max-w-[500px]\">\r\n        <form onSubmit={handleSubmit}>\r\n          <DialogHeader>\r\n            <DialogTitle>{t(\"admin.createNewUser\")}</DialogTitle>\r\n            <DialogDescription>\r\n              {t(\"admin.createUserDescription\")}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"email\">{t(\"auth.email\")}</Label>\r\n              <Input\r\n                id=\"email\"\r\n                type=\"email\"\r\n                required\r\n                value={formData.email}\r\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                placeholder=\"user@example.com\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"password\">{t(\"auth.password\")}</Label>\r\n              <Input\r\n                id=\"password\"\r\n                type=\"password\"\r\n                required\r\n                value={formData.password}\r\n                onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                placeholder=\"••••••••\"\r\n                minLength={6}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"displayName\">{t(\"profile.displayName\")}</Label>\r\n              <Input\r\n                id=\"displayName\"\r\n                required\r\n                value={formData.displayName}\r\n                onChange={(e) => setFormData({ ...formData, displayName: e.target.value })}\r\n                placeholder={t(\"profile.displayName\")}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"phone\">{t(\"profile.phone\")}</Label>\r\n              <Input\r\n                id=\"phone\"\r\n                type=\"tel\"\r\n                value={formData.phone}\r\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                placeholder=\"+351 XXX XXX XXX\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"role\">{t(\"admin.role\")}</Label>\r\n            {isSupervisor ? (\r\n              <Input\r\n                id=\"role\"\r\n                value={t(\"admin.merchant\")}\r\n                disabled\r\n                className=\"bg-muted\"\r\n              />\r\n            ) : (\r\n                <Select\r\n                  value={formData.role}\r\n                  onValueChange={(value: \"merchant\" | \"supervisor\") =>\r\n                    setFormData({ ...formData, role: value })\r\n                  }\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"merchant\">{t(\"admin.merchant\")}</SelectItem>\r\n                    <SelectItem value=\"supervisor\">{t(\"admin.supervisor\")}</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={() => setOpen(false)}\r\n              disabled={isLoading}\r\n            >\r\n              {t(\"common.cancel\")}\r\n            </Button>\r\n            <Button type=\"submit\" disabled={isLoading}>\r\n              {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n              {t(\"admin.create\")}\r\n            </Button>\r\n          </DialogFooter>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default CreateUserDialog;\r\n","import { useState, useEffect } from \"react\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Loader2, Store, MapPin, Search, User } from \"lucide-react\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\n\r\ninterface MerchantRestaurantsDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  merchantId: string;\r\n  merchantName: string;\r\n  userRole: \"merchant\" | \"supervisor\";\r\n}\r\n\r\nconst MerchantRestaurantsDialog = ({\r\n  open,\r\n  onOpenChange,\r\n  merchantId,\r\n  merchantName,\r\n  userRole,\r\n}: MerchantRestaurantsDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const { localizeRestaurant } = useLocalizedContent();\r\n  const { user } = useAuth();\r\n  const { isSupervisor } = useUserRole();\r\n  const [selectedRestaurants, setSelectedRestaurants] = useState<string[]>([]);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n\r\n  // Fetch supervisor's restaurants if current user is supervisor\r\n  const { data: supervisorRestaurantIds } = useQuery({\r\n    queryKey: [\"supervisorRestaurants\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user || !isSupervisor) return null;\r\n      \r\n      const { data, error } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", user.id);\r\n      \r\n      if (error) throw error;\r\n      return data?.map(mr => mr.restaurant_id) || [];\r\n    },\r\n    enabled: open && isSupervisor && !!user,\r\n  });\r\n\r\n  // Fetch all restaurants (or filtered by supervisor's restaurants)\r\n  const { data: allRestaurants, isLoading: restaurantsLoading } = useQuery({\r\n    queryKey: [\"allRestaurants\", supervisorRestaurantIds],\r\n    queryFn: async () => {\r\n      let query = supabase\r\n        .from(\"restaurants\")\r\n        .select(\"*\")\r\n        .order(\"name\");\r\n      \r\n      // If supervisor, only show their managed restaurants\r\n      if (isSupervisor && supervisorRestaurantIds && supervisorRestaurantIds.length > 0) {\r\n        query = query.in(\"id\", supervisorRestaurantIds);\r\n      }\r\n      \r\n      const { data, error } = await query;\r\n      \r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    enabled: !isSupervisor || (isSupervisor && supervisorRestaurantIds !== undefined),\r\n  });\r\n\r\n  // Fetch merchant's current restaurants\r\n  const { data: merchantRestaurants, isLoading: merchantRestaurantsLoading } = useQuery({\r\n    queryKey: [\"merchantRestaurants\", merchantId],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", merchantId);\r\n      \r\n      if (error) throw error;\r\n      return data?.map(mr => mr.restaurant_id) || [];\r\n    },\r\n    enabled: open,\r\n  });\r\n\r\n  // Fetch all restaurant assignments (which accounts are assigned to each restaurant)\r\n  const { data: allAssignments } = useQuery({\r\n    queryKey: [\"allRestaurantAssignments\"],\r\n    queryFn: async () => {\r\n      // First get all merchant_restaurants records\r\n      const { data: mrData, error: mrError } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"restaurant_id, user_id\");\r\n      \r\n      if (mrError) throw mrError;\r\n      if (!mrData || mrData.length === 0) return {};\r\n      \r\n      // Get unique user IDs\r\n      const userIds = [...new Set(mrData.map(mr => mr.user_id))];\r\n      \r\n      // Fetch profiles for these users\r\n      const { data: profilesData } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name\")\r\n        .in(\"id\", userIds);\r\n      \r\n      // Fetch roles for these users\r\n      const { data: rolesData } = await supabase\r\n        .from(\"user_roles\")\r\n        .select(\"user_id, role\")\r\n        .in(\"user_id\", userIds);\r\n      \r\n      // Create lookup maps\r\n      const profilesMap = new Map(profilesData?.map(p => [p.id, p.display_name]) || []);\r\n      const rolesMap = new Map(rolesData?.map(r => [r.user_id, r.role]) || []);\r\n      \r\n      // Group by restaurant_id\r\n      const assignmentsByRestaurant: Record<string, Array<{ userId: string; displayName: string; role: string }>> = {};\r\n      mrData.forEach((item) => {\r\n        if (!assignmentsByRestaurant[item.restaurant_id]) {\r\n          assignmentsByRestaurant[item.restaurant_id] = [];\r\n        }\r\n        assignmentsByRestaurant[item.restaurant_id].push({\r\n          userId: item.user_id,\r\n          displayName: profilesMap.get(item.user_id) || \"Unknown\",\r\n          role: rolesMap.get(item.user_id) || \"user\",\r\n        });\r\n      });\r\n      \r\n      return assignmentsByRestaurant;\r\n    },\r\n    enabled: open,\r\n  });\r\n\r\n  // Set selected restaurants when merchant restaurants are loaded\r\n  useEffect(() => {\r\n    if (merchantRestaurants) {\r\n      setSelectedRestaurants(merchantRestaurants);\r\n    }\r\n  }, [merchantRestaurants]);\r\n\r\n  // Save changes mutation\r\n  const saveMutation = useMutation({\r\n    mutationFn: async () => {\r\n      // First, delete all existing associations\r\n      const { error: deleteError } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .delete()\r\n        .eq(\"user_id\", merchantId);\r\n\r\n      if (deleteError) throw deleteError;\r\n\r\n      // Then, insert new associations\r\n      if (selectedRestaurants.length > 0) {\r\n        const { error: insertError } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .insert(\r\n            selectedRestaurants.map(restaurantId => ({\r\n              user_id: merchantId,\r\n              restaurant_id: restaurantId,\r\n            }))\r\n          );\r\n\r\n        if (insertError) throw insertError;\r\n      }\r\n    },\r\n    onSuccess: () => {\r\n      toast({\r\n        title: t(\"toast.merchantRestaurantsSaved\"),\r\n        description: t(\"toast.merchantRestaurantsDescription\"),\r\n      });\r\n      queryClient.invalidateQueries({ queryKey: [\"merchantRestaurants\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"adminUsers\"] });\r\n      onOpenChange(false);\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Error saving merchant restaurants:\", error);\r\n      toast({\r\n        title: t(\"toast.merchantRestaurantsSaveFailed\"),\r\n        description: t(\"toast.merchantRestaurantsDescriptionFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n\r\n  const toggleRestaurant = (restaurantId: string) => {\r\n    if (userRole === \"merchant\") {\r\n      // Merchant can only select one restaurant, but can deselect\r\n      if (selectedRestaurants.includes(restaurantId)) {\r\n        setSelectedRestaurants([]);\r\n      } else {\r\n        setSelectedRestaurants([restaurantId]);\r\n      }\r\n    } else {\r\n      // Supervisor can select multiple restaurants\r\n      setSelectedRestaurants(prev => \r\n        prev.includes(restaurantId)\r\n          ? prev.filter(id => id !== restaurantId)\r\n          : [...prev, restaurantId]\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleSave = () => {\r\n    saveMutation.mutate();\r\n  };\r\n\r\n  const isLoading = restaurantsLoading || merchantRestaurantsLoading;\r\n\r\n  // Filter restaurants based on search query\r\n  const filteredRestaurants = allRestaurants?.filter((restaurant) => {\r\n    if (!searchQuery.trim()) return true;\r\n    const localizedRest = localizeRestaurant(restaurant);\r\n    return localizedRest.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n           restaurant.address.toLowerCase().includes(searchQuery.toLowerCase());\r\n  });\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-2xl max-h-[80vh] flex flex-col\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Store className=\"w-5 h-5\" />\r\n            {userRole === \"merchant\" ? t(\"merchant.manageRestaurants\") : t(\"merchant.manageSupervisorRestaurants\")}\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            {t(\"merchant.assignRestaurantsTo\", { name: merchantName })}\r\n            {userRole === \"merchant\" && (\r\n              <span className=\"block mt-1 text-primary font-medium\">\r\n                {t(\"merchant.merchantOnlyOne\")}\r\n              </span>\r\n            )}\r\n            <span className=\"block mt-1 text-muted-foreground text-xs\">\r\n              {t(\"merchant.saveReminder\")}\r\n            </span>\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        {isLoading ? (\r\n          <div className=\"flex justify-center py-8\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex flex-col flex-1 min-h-0\">\r\n            <div className=\"relative mb-4 flex-shrink-0\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n              <Input\r\n                placeholder={t(\"merchant.searchRestaurants\")}\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n                className=\"pl-9\"\r\n              />\r\n            </div>\r\n            <ScrollArea className=\"flex-1 min-h-0 pr-4\">\r\n              <div className=\"space-y-3\">\r\n                {filteredRestaurants?.map((restaurant) => {\r\n                  const isSelected = selectedRestaurants.includes(restaurant.id);\r\n                  const localizedRest = localizeRestaurant(restaurant);\r\n                  const assignedUsers = allAssignments?.[restaurant.id]?.filter(u => u.userId !== merchantId) || [];\r\n                  \r\n                  return (\r\n                    <div\r\n                      key={restaurant.id}\r\n                      className=\"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-all cursor-pointer\"\r\n                      onClick={() => toggleRestaurant(restaurant.id)}\r\n                    >\r\n                      <Checkbox\r\n                        checked={isSelected}\r\n                        className=\"mt-1\"\r\n                      />\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\r\n                          <p className=\"text-sm font-medium leading-none\">\r\n                            {localizedRest.name}\r\n                          </p>\r\n                          {isSelected && (\r\n                            <Badge variant=\"secondary\" className=\"text-xs\">\r\n                              {t(\"merchant.selected\")}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                          <MapPin className=\"w-3 h-3\" />\r\n                          <span className=\"line-clamp-1\">{restaurant.address}</span>\r\n                        </div>\r\n                        {restaurant.type && restaurant.type.length > 0 && (\r\n                          <div className=\"flex gap-1 mt-2 flex-wrap\">\r\n                            {restaurant.type.slice(0, 2).map((type, idx) => (\r\n                              <Badge key={idx} variant=\"outline\" className=\"text-xs\">\r\n                                {type}\r\n                              </Badge>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                        {/* Display assigned accounts */}\r\n                        {assignedUsers.length > 0 && (\r\n                          <div className=\"flex items-center gap-1.5 mt-2 flex-wrap\">\r\n                            <User className=\"w-3 h-3 text-muted-foreground\" />\r\n                            <span className=\"text-xs text-muted-foreground\">{t(\"merchant.assignedTo\")}:</span>\r\n                            <TooltipProvider>\r\n                              {assignedUsers.slice(0, 3).map((user, idx) => (\r\n                                <Tooltip key={user.userId}>\r\n                                  <TooltipTrigger asChild>\r\n                                    <Badge \r\n                                      variant=\"outline\" \r\n                                      className={`text-xs ${\r\n                                        user.role === 'supervisor' \r\n                                          ? 'border-blue-500/50 text-blue-600 dark:text-blue-400' \r\n                                          : 'border-amber-500/50 text-amber-600 dark:text-amber-400'\r\n                                      }`}\r\n                                    >\r\n                                      {user.displayName}\r\n                                    </Badge>\r\n                                  </TooltipTrigger>\r\n                                  <TooltipContent>\r\n                                    <p>{user.role === 'supervisor' ? t(\"roles.supervisor\") : t(\"roles.merchant\")}</p>\r\n                                  </TooltipContent>\r\n                                </Tooltip>\r\n                              ))}\r\n                              {assignedUsers.length > 3 && (\r\n                                <Tooltip>\r\n                                  <TooltipTrigger asChild>\r\n                                    <Badge variant=\"outline\" className=\"text-xs\">\r\n                                      +{assignedUsers.length - 3}\r\n                                    </Badge>\r\n                                  </TooltipTrigger>\r\n                                  <TooltipContent>\r\n                                    <div className=\"space-y-1\">\r\n                                      {assignedUsers.slice(3).map(user => (\r\n                                        <p key={user.userId}>{user.displayName} ({user.role === 'supervisor' ? t(\"roles.supervisor\") : t(\"roles.merchant\")})</p>\r\n                                      ))}\r\n                                    </div>\r\n                                  </TooltipContent>\r\n                                </Tooltip>\r\n                              )}\r\n                            </TooltipProvider>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </ScrollArea>\r\n\r\n            <div className=\"flex items-center justify-between pt-4 border-t flex-shrink-0\">\r\n              <div className=\"text-sm text-muted-foreground\">\r\n                {userRole === \"merchant\" \r\n                  ? t(\"merchant.selectedCountOne\", { count: selectedRestaurants.length })\r\n                  : t(\"merchant.selectedCountMulti\", { count: selectedRestaurants.length })\r\n                }\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => onOpenChange(false)}\r\n                  disabled={saveMutation.isPending}\r\n                >\r\n                  {t(\"common.cancel\")}\r\n                </Button>\r\n                <Button\r\n                  onClick={handleSave}\r\n                  disabled={saveMutation.isPending}\r\n                >\r\n                  {saveMutation.isPending && (\r\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  )}\r\n                  {t(\"common.save\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default MerchantRestaurantsDialog;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Shield, Loader2, UserCog } from \"lucide-react\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\n\r\ninterface AssignMerchantToSupervisorDialogProps {\r\n  merchantId: string;\r\n  merchantName: string;\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst AssignMerchantToSupervisorDialog = ({\r\n  merchantId,\r\n  merchantName,\r\n  trigger,\r\n}: AssignMerchantToSupervisorDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const [open, setOpen] = useState(false);\r\n  const [selectedSupervisor, setSelectedSupervisor] = useState<string>(\"\");\r\n\r\n  // Fetch all supervisors\r\n  const { data: supervisors = [], isLoading: loadingSupervisors } = useQuery({\r\n    queryKey: [\"supervisors\"],\r\n    queryFn: async () => {\r\n      const { data: roles, error: rolesError } = await supabase\r\n        .from(\"user_roles\")\r\n        .select(\"user_id\")\r\n        .eq(\"role\", \"supervisor\");\r\n\r\n      if (rolesError) throw rolesError;\r\n\r\n      const supervisorIds = roles.map((r) => r.user_id);\r\n\r\n      if (supervisorIds.length === 0) return [];\r\n\r\n      const { data: profiles, error: profilesError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name\")\r\n        .in(\"id\", supervisorIds);\r\n\r\n      if (profilesError) throw profilesError;\r\n\r\n      return profiles;\r\n    },\r\n    enabled: open,\r\n  });\r\n\r\n  // Fetch merchant's restaurants\r\n  const { data: merchantRestaurants = [] } = useQuery({\r\n    queryKey: [\"merchant-restaurants\", merchantId],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", merchantId);\r\n\r\n      if (error) throw error;\r\n      return data.map((r) => r.restaurant_id);\r\n    },\r\n    enabled: open,\r\n  });\r\n\r\n  // Fetch current supervisors managing merchant's restaurants\r\n  const { data: currentSupervisors = [] } = useQuery({\r\n    queryKey: [\"merchant-supervisors\", merchantId],\r\n    queryFn: async () => {\r\n      if (merchantRestaurants.length === 0) return [];\r\n\r\n      const { data: supervisorRestaurants, error } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"user_id, restaurant_id\")\r\n        .in(\"restaurant_id\", merchantRestaurants)\r\n        .neq(\"user_id\", merchantId);\r\n\r\n      if (error) throw error;\r\n\r\n      // Get unique supervisor IDs\r\n      const supervisorIds = [...new Set(supervisorRestaurants.map((r) => r.user_id))];\r\n\r\n      if (supervisorIds.length === 0) return [];\r\n\r\n      // Check if these users are supervisors\r\n      const { data: roles, error: rolesError } = await supabase\r\n        .from(\"user_roles\")\r\n        .select(\"user_id\")\r\n        .in(\"user_id\", supervisorIds)\r\n        .eq(\"role\", \"supervisor\");\r\n\r\n      if (rolesError) throw rolesError;\r\n\r\n      const validSupervisorIds = roles.map((r) => r.user_id);\r\n\r\n      if (validSupervisorIds.length === 0) return [];\r\n\r\n      const { data: profiles, error: profilesError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name\")\r\n        .in(\"id\", validSupervisorIds);\r\n\r\n      if (profilesError) throw profilesError;\r\n\r\n      return profiles;\r\n    },\r\n    enabled: open && merchantRestaurants.length > 0,\r\n  });\r\n\r\n  // Assign merchant to supervisor mutation\r\n  const assignMutation = useMutation({\r\n    mutationFn: async (supervisorId: string) => {\r\n      if (merchantRestaurants.length === 0) {\r\n        throw new Error(\"该商家没有管理任何餐厅\");\r\n      }\r\n\r\n      // Add supervisor to manage all merchant's restaurants\r\n      const insertData = merchantRestaurants.map((restaurantId) => ({\r\n        user_id: supervisorId,\r\n        restaurant_id: restaurantId,\r\n      }));\r\n\r\n      const { error } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .upsert(insertData, { onConflict: \"user_id,restaurant_id\" });\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      toast({\r\n        title: \"分配成功\",\r\n        description: \"商家已成功分配给主管\",\r\n      });\r\n      queryClient.invalidateQueries({ queryKey: [\"merchant-supervisors\"] });\r\n      setSelectedSupervisor(\"\");\r\n      setOpen(false);\r\n    },\r\n    onError: (error: any) => {\r\n      toast({\r\n        title: \"分配失败\",\r\n        description: error.message,\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n\r\n  // Remove supervisor from merchant mutation\r\n  const removeMutation = useMutation({\r\n    mutationFn: async (supervisorId: string) => {\r\n      const { error } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .delete()\r\n        .eq(\"user_id\", supervisorId)\r\n        .in(\"restaurant_id\", merchantRestaurants);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      toast({\r\n        title: \"移除成功\",\r\n        description: \"主管已从该商家移除\",\r\n      });\r\n      queryClient.invalidateQueries({ queryKey: [\"merchant-supervisors\"] });\r\n    },\r\n    onError: (error: any) => {\r\n      toast({\r\n        title: \"移除失败\",\r\n        description: error.message,\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n\r\n  const handleAssign = () => {\r\n    if (!selectedSupervisor) return;\r\n    assignMutation.mutate(selectedSupervisor);\r\n  };\r\n\r\n  const handleRemove = (supervisorId: string) => {\r\n    removeMutation.mutate(supervisorId);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {trigger || (\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <UserCog className=\"w-4 h-4 mr-2\" />\r\n            分配主管\r\n          </Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Shield className=\"w-5 h-5\" />\r\n            分配商家给主管\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            为商家 <strong>{merchantName}</strong> 分配主管\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          {/* Current Supervisors */}\r\n          {currentSupervisors.length > 0 && (\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium\">当前主管</label>\r\n              <div className=\"space-y-2\">\r\n                {currentSupervisors.map((supervisor) => (\r\n                  <div\r\n                    key={supervisor.id}\r\n                    className=\"flex items-center justify-between p-2 border rounded-lg\"\r\n                  >\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Shield className=\"w-4 h-4 text-blue-500\" />\r\n                      <span className=\"text-sm\">{supervisor.display_name}</span>\r\n                    </div>\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleRemove(supervisor.id)}\r\n                      disabled={removeMutation.isPending}\r\n                    >\r\n                      移除\r\n                    </Button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Assign New Supervisor */}\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium\">分配新主管</label>\r\n            <Select value={selectedSupervisor} onValueChange={setSelectedSupervisor}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"选择主管\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {loadingSupervisors ? (\r\n                  <div className=\"p-2 text-center\">\r\n                    <Loader2 className=\"w-4 h-4 animate-spin mx-auto\" />\r\n                  </div>\r\n                ) : supervisors.length === 0 ? (\r\n                  <div className=\"p-2 text-center text-sm text-muted-foreground\">\r\n                    没有可用的主管\r\n                  </div>\r\n                ) : (\r\n                  supervisors\r\n                    .filter((s) => !currentSupervisors.find((cs) => cs.id === s.id))\r\n                    .map((supervisor) => (\r\n                      <SelectItem key={supervisor.id} value={supervisor.id}>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Shield className=\"w-4 h-4 text-blue-500\" />\r\n                          {supervisor.display_name}\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))\r\n                )}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          {merchantRestaurants.length === 0 && (\r\n            <Badge variant=\"secondary\" className=\"w-full justify-center\">\r\n              该商家没有管理任何餐厅\r\n            </Badge>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 justify-end\">\r\n            <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n              取消\r\n            </Button>\r\n            <Button\r\n              onClick={handleAssign}\r\n              disabled={\r\n                !selectedSupervisor ||\r\n                assignMutation.isPending ||\r\n                merchantRestaurants.length === 0\r\n              }\r\n            >\r\n              {assignMutation.isPending ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  分配中...\r\n                </>\r\n              ) : (\r\n                \"确认分配\"\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AssignMerchantToSupervisorDialog;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Shield, Loader2, Users, Briefcase, Store } from \"lucide-react\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\n\r\ninterface AssignMerchantsToSupervisorDialogProps {\r\n  supervisorId: string;\r\n  supervisorName: string;\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst AssignMerchantsToSupervisorDialog = ({\r\n  supervisorId,\r\n  supervisorName,\r\n  trigger,\r\n}: AssignMerchantsToSupervisorDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const [open, setOpen] = useState(false);\r\n  const [selectedMerchants, setSelectedMerchants] = useState<string[]>([]);\r\n\r\n  // Fetch all merchants with their restaurants\r\n  const { data: merchants = [], isLoading: loadingMerchants } = useQuery({\r\n    queryKey: [\"all-merchants-with-restaurants\"],\r\n    queryFn: async () => {\r\n      // Get all merchant user IDs\r\n      const { data: roles, error: rolesError } = await supabase\r\n        .from(\"user_roles\")\r\n        .select(\"user_id\")\r\n        .eq(\"role\", \"merchant\");\r\n\r\n      if (rolesError) throw rolesError;\r\n\r\n      const merchantIds = roles.map((r) => r.user_id);\r\n      if (merchantIds.length === 0) return [];\r\n\r\n      // Get merchant profiles\r\n      const { data: profiles, error: profilesError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name, avatar_url\")\r\n        .in(\"id\", merchantIds);\r\n\r\n      if (profilesError) throw profilesError;\r\n\r\n      // Get merchant restaurants\r\n      const { data: merchantRestaurants, error: mrError } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"user_id, restaurant_id, restaurants(name)\")\r\n        .in(\"user_id\", merchantIds);\r\n\r\n      if (mrError) throw mrError;\r\n\r\n      // Combine data\r\n      return profiles.map((profile) => ({\r\n        ...profile,\r\n        restaurants: merchantRestaurants\r\n          .filter((mr) => mr.user_id === profile.id)\r\n          .map((mr) => ({\r\n            id: mr.restaurant_id,\r\n            name: (mr.restaurants as any)?.name || \"Unknown\",\r\n          })),\r\n      }));\r\n    },\r\n    enabled: open,\r\n  });\r\n\r\n  // Fetch merchants currently managed by this supervisor\r\n  const { data: managedMerchantIds = [], isLoading: loadingManaged } = useQuery({\r\n    queryKey: [\"supervisor-managed-merchants\", supervisorId],\r\n    queryFn: async () => {\r\n      // Get all restaurants managed by supervisor\r\n      const { data: supervisorRestaurants, error: srError } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", supervisorId);\r\n\r\n      if (srError) throw srError;\r\n\r\n      const supervisorRestaurantIds = supervisorRestaurants.map((r) => r.restaurant_id);\r\n      if (supervisorRestaurantIds.length === 0) return [];\r\n\r\n      // Get merchants who manage these restaurants\r\n      const { data: merchantRestaurants, error: mrError } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"user_id\")\r\n        .in(\"restaurant_id\", supervisorRestaurantIds)\r\n        .neq(\"user_id\", supervisorId);\r\n\r\n      if (mrError) throw mrError;\r\n\r\n      // Check which are actually merchants\r\n      const potentialMerchantIds = [...new Set(merchantRestaurants.map((r) => r.user_id))];\r\n      if (potentialMerchantIds.length === 0) return [];\r\n\r\n      const { data: roles, error: rolesError } = await supabase\r\n        .from(\"user_roles\")\r\n        .select(\"user_id\")\r\n        .in(\"user_id\", potentialMerchantIds)\r\n        .eq(\"role\", \"merchant\");\r\n\r\n      if (rolesError) throw rolesError;\r\n\r\n      return roles.map((r) => r.user_id);\r\n    },\r\n    enabled: open,\r\n  });\r\n\r\n  // Initialize selected merchants when data loads\r\n  useState(() => {\r\n    if (managedMerchantIds.length > 0 && selectedMerchants.length === 0) {\r\n      setSelectedMerchants(managedMerchantIds);\r\n    }\r\n  });\r\n\r\n  // Save assignment mutation\r\n  const saveMutation = useMutation({\r\n    mutationFn: async () => {\r\n      // Get all restaurants of selected merchants\r\n      const { data: selectedMerchantRestaurants, error: mrError } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"user_id, restaurant_id\")\r\n        .in(\"user_id\", selectedMerchants);\r\n\r\n      if (mrError) throw mrError;\r\n\r\n      // Get current supervisor restaurants\r\n      const { data: currentSupervisorRestaurants, error: csrError } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", supervisorId);\r\n\r\n      if (csrError) throw csrError;\r\n\r\n      const currentRestaurantIds = currentSupervisorRestaurants.map((r) => r.restaurant_id);\r\n      const newRestaurantIds = selectedMerchantRestaurants.map((r) => r.restaurant_id);\r\n\r\n      // Restaurants to add (in selected but not in current)\r\n      const toAdd = newRestaurantIds.filter((id) => !currentRestaurantIds.includes(id));\r\n\r\n      // Restaurants to remove (in current but not in selected, and belongs to a merchant)\r\n      const allMerchantRestaurantIds = merchants.flatMap((m) => m.restaurants.map((r) => r.id));\r\n      const toRemove = currentRestaurantIds.filter(\r\n        (id) => allMerchantRestaurantIds.includes(id) && !newRestaurantIds.includes(id)\r\n      );\r\n\r\n      // Add new restaurants\r\n      if (toAdd.length > 0) {\r\n        const insertData = toAdd.map((restaurantId) => ({\r\n          user_id: supervisorId,\r\n          restaurant_id: restaurantId,\r\n        }));\r\n\r\n        const { error: insertError } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .upsert(insertData, { onConflict: \"user_id,restaurant_id\" });\r\n\r\n        if (insertError) throw insertError;\r\n      }\r\n\r\n      // Remove old restaurants\r\n      if (toRemove.length > 0) {\r\n        const { error: deleteError } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .delete()\r\n          .eq(\"user_id\", supervisorId)\r\n          .in(\"restaurant_id\", toRemove);\r\n\r\n        if (deleteError) throw deleteError;\r\n      }\r\n    },\r\n    onSuccess: () => {\r\n      toast({\r\n        title: \"保存成功\",\r\n        description: \"商家分配已更新\",\r\n      });\r\n      queryClient.invalidateQueries({ queryKey: [\"supervisor-managed-merchants\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"merchant-restaurants\"] });\r\n      setOpen(false);\r\n    },\r\n    onError: (error: any) => {\r\n      toast({\r\n        title: \"保存失败\",\r\n        description: error.message,\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n\r\n  const toggleMerchant = (merchantId: string) => {\r\n    setSelectedMerchants((prev) =>\r\n      prev.includes(merchantId)\r\n        ? prev.filter((id) => id !== merchantId)\r\n        : [...prev, merchantId]\r\n    );\r\n  };\r\n\r\n  const handleSave = () => {\r\n    saveMutation.mutate();\r\n  };\r\n\r\n  // Update selected when managed merchants load\r\n  const isInitialized = useState(false);\r\n  if (!isInitialized[0] && managedMerchantIds.length > 0) {\r\n    setSelectedMerchants(managedMerchantIds);\r\n    isInitialized[1](true);\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(newOpen) => {\r\n      setOpen(newOpen);\r\n      if (newOpen) {\r\n        // Reset selection when opening\r\n        setSelectedMerchants(managedMerchantIds);\r\n      }\r\n    }}>\r\n      <DialogTrigger asChild>\r\n        {trigger || (\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Users className=\"w-4 h-4 mr-2\" />\r\n            管理商家\r\n          </Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-lg\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Shield className=\"w-5 h-5 text-blue-500\" />\r\n            分配商家给主管\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            选择要分配给 <strong>{supervisorName}</strong> 管理的商家\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          {loadingMerchants || loadingManaged ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\r\n            </div>\r\n          ) : merchants.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              <Briefcase className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\r\n              <p>没有可分配的商家</p>\r\n            </div>\r\n          ) : (\r\n            <ScrollArea className=\"h-[300px] pr-4\">\r\n              <div className=\"space-y-2\">\r\n                {merchants.map((merchant) => (\r\n                  <div\r\n                    key={merchant.id}\r\n                    className={`flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${\r\n                      selectedMerchants.includes(merchant.id)\r\n                        ? \"border-primary bg-primary/5\"\r\n                        : \"hover:bg-muted/50\"\r\n                    }`}\r\n                    onClick={() => toggleMerchant(merchant.id)}\r\n                  >\r\n                    <Checkbox\r\n                      checked={selectedMerchants.includes(merchant.id)}\r\n                      onCheckedChange={() => toggleMerchant(merchant.id)}\r\n                    />\r\n                    <Avatar className=\"h-10 w-10\">\r\n                      <AvatarImage src={merchant.avatar_url || \"\"} />\r\n                      <AvatarFallback className=\"bg-emerald-100 text-emerald-700\">\r\n                        {merchant.display_name?.charAt(0).toUpperCase() || \"M\"}\r\n                      </AvatarFallback>\r\n                    </Avatar>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"font-medium truncate\">{merchant.display_name}</p>\r\n                      {merchant.restaurants.length > 0 ? (\r\n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                          <Store className=\"w-3 h-3\" />\r\n                          <span className=\"truncate\">\r\n                            {merchant.restaurants.map((r) => r.name).join(\", \")}\r\n                          </span>\r\n                        </div>\r\n                      ) : (\r\n                        <span className=\"text-xs text-muted-foreground\">无餐厅</span>\r\n                      )}\r\n                    </div>\r\n                    <Badge variant=\"outline\" className=\"text-xs\">\r\n                      <Briefcase className=\"w-3 h-3 mr-1\" />\r\n                      商家\r\n                    </Badge>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </ScrollArea>\r\n          )}\r\n\r\n          <div className=\"flex items-center justify-between pt-2 border-t\">\r\n            <span className=\"text-sm text-muted-foreground\">\r\n              已选择 {selectedMerchants.length} 个商家\r\n            </span>\r\n            <div className=\"flex gap-2\">\r\n              <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n                取消\r\n              </Button>\r\n              <Button onClick={handleSave} disabled={saveMutation.isPending}>\r\n                {saveMutation.isPending ? (\r\n                  <>\r\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                    保存中...\r\n                  </>\r\n                ) : (\r\n                  \"保存\"\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AssignMerchantsToSupervisorDialog;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Edit, Upload, Loader2 } from \"lucide-react\";\r\nimport { useUpdateMerchantProfile, useUploadMerchantAvatar } from \"@/hooks/useAdmin\";\r\n\r\ninterface EditMerchantProfileDialogProps {\r\n  merchant: {\r\n    id: string;\r\n    display_name: string;\r\n    phone?: string | null;\r\n    avatar_url?: string | null;\r\n  };\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst EditMerchantProfileDialog = ({ merchant, trigger }: EditMerchantProfileDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const [open, setOpen] = useState(false);\r\n  const [displayName, setDisplayName] = useState(merchant.display_name);\r\n  const [phone, setPhone] = useState(merchant.phone || \"\");\r\n  const [avatarFile, setAvatarFile] = useState<File | null>(null);\r\n  const [avatarPreview, setAvatarPreview] = useState(merchant.avatar_url || \"\");\r\n\r\n  const updateProfile = useUpdateMerchantProfile();\r\n  const uploadAvatar = useUploadMerchantAvatar();\r\n\r\n  const handleAvatarChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 2 * 1024 * 1024) {\r\n        return;\r\n      }\r\n      setAvatarFile(file);\r\n      setAvatarPreview(URL.createObjectURL(file));\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    let avatar_url = merchant.avatar_url;\r\n\r\n    if (avatarFile) {\r\n      const uploadedUrl = await uploadAvatar.mutateAsync({ \r\n        file: avatarFile, \r\n        userId: merchant.id \r\n      });\r\n      if (uploadedUrl) avatar_url = uploadedUrl;\r\n    }\r\n\r\n    await updateProfile.mutateAsync({\r\n      userId: merchant.id,\r\n      display_name: displayName,\r\n      phone: phone || undefined,\r\n      avatar_url: avatar_url || undefined,\r\n    });\r\n\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {trigger || (\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Edit className=\"w-4 h-4 mr-2\" />\r\n            编辑资料\r\n          </Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-[90vw] sm:max-w-[425px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>编辑商家资料</DialogTitle>\r\n          <DialogDescription>修改商家的个人信息和头像</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4 py-4\">\r\n          <div className=\"flex flex-col items-center gap-4\">\r\n            <Avatar className=\"w-24 h-24\">\r\n              <AvatarImage src={avatarPreview} />\r\n              <AvatarFallback>{displayName?.charAt(0).toUpperCase()}</AvatarFallback>\r\n            </Avatar>\r\n            <div>\r\n              <Input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleAvatarChange}\r\n                className=\"hidden\"\r\n                id=\"avatar-upload\"\r\n              />\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => document.getElementById(\"avatar-upload\")?.click()}\r\n              >\r\n                <Upload className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.uploadAvatar\")}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"displayName\">{t(\"profile.displayName\")}</Label>\r\n            <Input\r\n              id=\"displayName\"\r\n              value={displayName}\r\n              onChange={(e) => setDisplayName(e.target.value)}\r\n              placeholder={t(\"profile.displayName\")}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"phone\">{t(\"profile.phone\")}</Label>\r\n            <Input\r\n              id=\"phone\"\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              placeholder={t(\"profile.phone\")}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"flex justify-end gap-2\">\r\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n            {t(\"common.cancel\")}\r\n          </Button>\r\n          <Button\r\n            onClick={handleSave}\r\n            disabled={updateProfile.isPending || uploadAvatar.isPending}\r\n          >\r\n            {updateProfile.isPending || uploadAvatar.isPending ? (\r\n              <>\r\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                {t(\"common.loading\")}\r\n              </>\r\n            ) : (\r\n              t(\"common.save\")\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default EditMerchantProfileDialog;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { AlertTriangle, Trash2 } from \"lucide-react\";\r\n\r\ninterface DeleteUserDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userName: string;\r\n  userId: string;\r\n  userRole: string;\r\n  onConfirm: () => void;\r\n  isDeleting?: boolean;\r\n}\r\n\r\nconst DeleteUserDialog = ({\r\n  open,\r\n  onOpenChange,\r\n  userName,\r\n  userId,\r\n  userRole,\r\n  onConfirm,\r\n  isDeleting = false,\r\n}: DeleteUserDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const [step, setStep] = useState<1 | 2>(1);\r\n  const [confirmText, setConfirmText] = useState(\"\");\r\n\r\n  const handleClose = () => {\r\n    setStep(1);\r\n    setConfirmText(\"\");\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleFirstConfirm = () => {\r\n    setStep(2);\r\n  };\r\n\r\n  const handleFinalConfirm = () => {\r\n    if (confirmText.toLowerCase() === \"delete\") {\r\n      onConfirm();\r\n      // Don't call handleClose() here - let parent control dialog state after async operation\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AlertDialog open={open} onOpenChange={(isOpen) => {\r\n      if (!isOpen) {\r\n        handleClose();\r\n      } else {\r\n        onOpenChange(isOpen);\r\n      }\r\n    }}>\r\n      <AlertDialogContent className=\"max-w-[90vw] sm:max-w-[500px]\">\r\n        {step === 1 ? (\r\n          <>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle className=\"flex items-center gap-2 text-destructive\">\r\n                <AlertTriangle className=\"h-5 w-5\" />\r\n                {t(\"admin.deleteUser\")}\r\n              </AlertDialogTitle>\r\n              <AlertDialogDescription className=\"space-y-4 pt-4\">\r\n                <div className=\"bg-destructive/10 border border-destructive/20 p-4 rounded-lg\">\r\n                  <p className=\"font-semibold text-foreground mb-2\">\r\n                    {t(\"admin.deleteUserWarning\")}\r\n                  </p>\r\n                  <div className=\"space-y-2 text-sm\">\r\n                    <p><strong>{t(\"admin.userName\")}:</strong> {userName}</p>\r\n                    <p><strong>{t(\"admin.userRole\")}:</strong> {userRole}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"space-y-2 text-sm text-muted-foreground\">\r\n                  <p>{t(\"admin.deleteUserConsequences\")}</p>\r\n                  <ul className=\"list-disc list-inside space-y-1 ml-2\">\r\n                    <li>{t(\"admin.deleteUserData1\")}</li>\r\n                    <li>{t(\"admin.deleteUserData2\")}</li>\r\n                    <li>{t(\"admin.deleteUserData3\")}</li>\r\n                    <li>{t(\"admin.deleteUserData4\")}</li>\r\n                  </ul>\r\n                </div>\r\n\r\n                {userRole === \"admin\" && (\r\n                  <div className=\"bg-destructive/20 border border-destructive p-3 rounded-lg\">\r\n                    <p className=\"text-sm font-semibold text-destructive\">\r\n                      ⚠️ {t(\"admin.deleteAdminWarning\")}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel onClick={handleClose}>\r\n                {t(\"common.cancel\")}\r\n              </AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={handleFirstConfirm}\r\n                className=\"bg-destructive hover:bg-destructive/90\"\r\n              >\r\n                {t(\"common.continue\")}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle className=\"flex items-center gap-2 text-destructive\">\r\n                <Trash2 className=\"h-5 w-5\" />\r\n                {t(\"admin.confirmDeleteUser\")}\r\n              </AlertDialogTitle>\r\n              <AlertDialogDescription className=\"space-y-4 pt-4\">\r\n                <p className=\"text-foreground font-medium\">\r\n                  {t(\"admin.finalDeleteWarning\", { userName })}\r\n                </p>\r\n                \r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"delete-confirm\" className=\"text-sm font-medium\">\r\n                    {t(\"admin.typeDeleteToConfirm\")}\r\n                  </Label>\r\n                  <Input\r\n                    id=\"delete-confirm\"\r\n                    value={confirmText}\r\n                    onChange={(e) => setConfirmText(e.target.value)}\r\n                    placeholder=\"DELETE\"\r\n                    className=\"uppercase\"\r\n                    autoComplete=\"off\"\r\n                  />\r\n                </div>\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel onClick={handleClose}>\r\n                {t(\"common.cancel\")}\r\n              </AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={handleFinalConfirm}\r\n                disabled={confirmText.toLowerCase() !== \"delete\" || isDeleting}\r\n                className=\"bg-destructive hover:bg-destructive/90\"\r\n              >\r\n                {isDeleting ? t(\"common.loading\") : t(\"admin.deleteUser\")}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </>\r\n        )}\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n  );\r\n};\r\n\r\nexport default DeleteUserDialog;\r\n","import { useState, useMemo, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\nimport { useAdminUsers, useChangeRole, useBatchDeleteUsers, useBatchChangeRole, useDeleteUser } from \"@/hooks/useAdmin\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useInfiniteScroll } from \"@/hooks/useInfiniteScroll\";\r\n\r\nimport CreateUserDialog from \"@/components/admin/CreateUserDialog\";\r\nimport MerchantRestaurantsDialog from \"@/components/admin/MerchantRestaurantsDialog\";\r\nimport AssignMerchantToSupervisorDialog from \"@/components/admin/AssignMerchantToSupervisorDialog\";\r\nimport AssignMerchantsToSupervisorDialog from \"@/components/admin/AssignMerchantsToSupervisorDialog\";\r\nimport EditMerchantProfileDialog from \"@/components/admin/EditMerchantProfileDialog\";\r\nimport DeleteUserDialog from \"@/components/admin/DeleteUserDialog\";\r\nimport { UserProfileDialog } from \"@/components/admin/UserProfileDialog\";\r\nimport {\r\n  Download, \r\n  Trash2, \r\n  UserPlus, \r\n  Search, \r\n  Users, \r\n  Briefcase, \r\n  Shield,\r\n  UserCog,\r\n  Filter,\r\n  X,\r\n  Store,\r\n  AlertTriangle,\r\n  Eye,\r\n  Edit,\r\n  ChevronDown,\r\n  MoreHorizontal,\r\n  Loader2,\r\n  ArrowUpDown,\r\n  ArrowUp,\r\n  ArrowDown\r\n} from \"lucide-react\";\r\nimport { exportUsersToCSV } from \"@/lib/exportUtils\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\nconst AdminUsers = () => {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const { isSupervisor, isAdmin } = useUserRole();\r\n  const { data: users, isLoading } = useAdminUsers();\r\n  const changeRole = useChangeRole();\r\n  const batchDeleteUsers = useBatchDeleteUsers();\r\n  const batchChangeRole = useBatchChangeRole();\r\n  const deleteUser = useDeleteUser();\r\n  const [selectedUser, setSelectedUser] = useState<string | null>(null);\r\n  const [selectedRole, setSelectedRole] = useState<\"user\" | \"merchant\" | \"supervisor\" | \"admin\" | \"\">(\"\");\r\n  const [selectedUsers, setSelectedUsers] = useState<string[]>([]);\r\n  const [batchRole, setBatchRole] = useState<\"user\" | \"merchant\" | \"supervisor\" | \"admin\">(\"user\");\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [roleFilter, setRoleFilter] = useState<string>(\"all\");\r\n  const [sortBy, setSortBy] = useState<\"name\" | \"created\" | \"lastLogin\">(\"name\");\r\n  const [sortDirection, setSortDirection] = useState<\"asc\" | \"desc\">(\"asc\");\r\n  const [expandedUser, setExpandedUser] = useState<string | null>(null);\r\n  \r\n  // Single user delete dialog state\r\n  const [deleteUserDialog, setDeleteUserDialog] = useState<{\r\n    open: boolean;\r\n    userId: string;\r\n    userName: string;\r\n    userRole: string;\r\n  }>({\r\n    open: false,\r\n    userId: \"\",\r\n    userName: \"\",\r\n    userRole: \"\",\r\n  });\r\n\r\n  // Batch delete dialog state\r\n  const [batchDeleteDialog, setBatchDeleteDialog] = useState<{\r\n    open: boolean;\r\n    step: 1 | 2;\r\n    confirmText: string;\r\n  }>({\r\n    open: false,\r\n    step: 1,\r\n    confirmText: \"\",\r\n  });\r\n\r\n  const [roleChangeDialog, setRoleChangeDialog] = useState<{\r\n    open: boolean;\r\n    userId: string;\r\n    userName: string;\r\n    currentRole: string;\r\n    newRole: string;\r\n  }>({\r\n    open: false,\r\n    userId: \"\",\r\n    userName: \"\",\r\n    currentRole: \"\",\r\n    newRole: \"\",\r\n  });\r\n  const [merchantRestaurantsDialog, setMerchantRestaurantsDialog] = useState<{\r\n    open: boolean;\r\n    merchantId: string;\r\n    merchantName: string;\r\n    userRole: \"merchant\" | \"supervisor\";\r\n  }>({\r\n    open: false,\r\n    merchantId: \"\",\r\n    merchantName: \"\",\r\n    userRole: \"merchant\",\r\n  });\r\n\r\n  // User profile dialog state\r\n  const [userProfileDialog, setUserProfileDialog] = useState<{\r\n    open: boolean;\r\n    userId: string;\r\n    userName: string;\r\n    userRole: string;\r\n  }>({\r\n    open: false,\r\n    userId: \"\",\r\n    userName: \"\",\r\n    userRole: \"\",\r\n  });\r\n\r\n  const roles: Array<\"user\" | \"merchant\" | \"supervisor\" | \"admin\"> = [\"user\", \"merchant\", \"supervisor\", \"admin\"];\r\n  \r\n  // Filter available roles based on user permissions\r\n  const availableRoles = isSupervisor \r\n    ? roles.filter(role => role === \"user\" || role === \"merchant\")\r\n    : roles;\r\n\r\n  // Calculate statistics\r\n  const stats = useMemo(() => {\r\n    if (!users) return { total: 0, admins: 0, supervisors: 0, merchants: 0, regularUsers: 0 };\r\n    return {\r\n      total: users.length,\r\n      admins: users.filter(u => u.role === \"admin\").length,\r\n      supervisors: users.filter(u => u.role === \"supervisor\").length,\r\n      merchants: users.filter(u => u.role === \"merchant\").length,\r\n      regularUsers: users.filter(u => u.role === \"user\").length,\r\n    };\r\n  }, [users]);\r\n\r\n  // Filter and sort users\r\n  const filteredUsers = useMemo(() => {\r\n    if (!users) return [];\r\n    \r\n    let filtered = users.filter((user) => {\r\n      const matchesSearch = searchQuery === \"\" || \r\n        user.display_name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        user.phone?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        user.email?.toLowerCase().includes(searchQuery.toLowerCase());\r\n      \r\n      const matchesRole = roleFilter === \"all\" || \r\n        user.role === roleFilter;\r\n      \r\n      return matchesSearch && matchesRole;\r\n    });\r\n\r\n    // Sort users\r\n    filtered.sort((a, b) => {\r\n      let comparison = 0;\r\n      \r\n      if (sortBy === \"name\") {\r\n        comparison = a.display_name.localeCompare(b.display_name);\r\n      } else if (sortBy === \"created\") {\r\n        const dateA = new Date(a.auth_created_at || a.created_at).getTime();\r\n        const dateB = new Date(b.auth_created_at || b.created_at).getTime();\r\n        comparison = dateA - dateB;\r\n      } else if (sortBy === \"lastLogin\") {\r\n        const dateA = a.last_sign_in_at ? new Date(a.last_sign_in_at).getTime() : 0;\r\n        const dateB = b.last_sign_in_at ? new Date(b.last_sign_in_at).getTime() : 0;\r\n        comparison = dateA - dateB;\r\n      }\r\n      \r\n      return sortDirection === \"asc\" ? comparison : -comparison;\r\n    });\r\n\r\n    return filtered;\r\n  }, [users, searchQuery, roleFilter, sortBy, sortDirection]);\r\n\r\n  // Infinite scroll for users\r\n  const {\r\n    displayedData: displayedUsers,\r\n    hasMore,\r\n    reset: resetInfiniteScroll,\r\n    displayedCount,\r\n    sentinelRef,\r\n  } = useInfiniteScroll({\r\n    data: filteredUsers,\r\n    initialItemsPerPage: 30,\r\n    incrementPerPage: 30,\r\n  });\r\n\r\n  // Reset infinite scroll when filters or sorting change\r\n  useEffect(() => {\r\n    resetInfiniteScroll();\r\n  }, [searchQuery, roleFilter, sortBy, sortDirection, resetInfiniteScroll]);\r\n\r\n  const handleExport = () => {\r\n    if (!users || users.length === 0) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"admin.noDataToExport\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    exportUsersToCSV(users);\r\n    toast({\r\n      title: t(\"common.success\"),\r\n      description: t(\"admin.exportSuccess\"),\r\n    });\r\n  };\r\n\r\n  const toggleSelectUser = (userId: string) => {\r\n    setSelectedUsers(prev =>\r\n      prev.includes(userId)\r\n        ? prev.filter(id => id !== userId)\r\n        : [...prev, userId]\r\n    );\r\n  };\r\n\r\n  const toggleSelectAll = () => {\r\n    if (selectedUsers.length === filteredUsers?.length) {\r\n      setSelectedUsers([]);\r\n    } else {\r\n      setSelectedUsers(filteredUsers?.map(u => u.id) || []);\r\n    }\r\n  };\r\n\r\n  // Single user delete handler\r\n  const handleDeleteUser = () => {\r\n    if (!deleteUserDialog.userId) return;\r\n    deleteUser.mutate(deleteUserDialog.userId, {\r\n      onSuccess: () => {\r\n        setDeleteUserDialog({\r\n          open: false,\r\n          userId: \"\",\r\n          userName: \"\",\r\n          userRole: \"\",\r\n        });\r\n      },\r\n      onError: () => {\r\n        setDeleteUserDialog({\r\n          open: false,\r\n          userId: \"\",\r\n          userName: \"\",\r\n          userRole: \"\",\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  // Open single user delete dialog\r\n  const openDeleteUserDialog = (userId: string, userName: string, userRole: string) => {\r\n    setDeleteUserDialog({\r\n      open: true,\r\n      userId,\r\n      userName,\r\n      userRole,\r\n    });\r\n  };\r\n\r\n  // Batch delete with multi-step verification\r\n  const handleBatchDeleteConfirm = () => {\r\n    if (selectedUsers.length === 0 || batchDeleteDialog.confirmText.toLowerCase() !== \"delete\") return;\r\n    batchDeleteUsers.mutate(selectedUsers, {\r\n      onSuccess: () => {\r\n        setSelectedUsers([]);\r\n        setBatchDeleteDialog({ open: false, step: 1, confirmText: \"\" });\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleBatchChangeRole = () => {\r\n    if (selectedUsers.length === 0) return;\r\n    batchChangeRole.mutate({ userIds: selectedUsers, role: batchRole });\r\n    setSelectedUsers([]);\r\n  };\r\n\r\n  const handleChangeRole = () => {\r\n    if (roleChangeDialog.userId && roleChangeDialog.newRole) {\r\n      changeRole.mutate(\r\n        { \r\n          userId: roleChangeDialog.userId, \r\n          role: roleChangeDialog.newRole as \"user\" | \"merchant\" | \"supervisor\" | \"admin\"\r\n        },\r\n        {\r\n          onSuccess: () => {\r\n            setRoleChangeDialog({\r\n              open: false,\r\n              userId: \"\",\r\n              userName: \"\",\r\n              currentRole: \"\",\r\n              newRole: \"\",\r\n            });\r\n            setSelectedUser(null);\r\n            setSelectedRole(\"\");\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const openRoleChangeDialog = (userId: string, userName: string, currentRole: string, newRole: string) => {\r\n    setRoleChangeDialog({\r\n      open: true,\r\n      userId,\r\n      userName,\r\n      currentRole,\r\n      newRole,\r\n    });\r\n  };\r\n\r\n  const getRoleBadgeColor = (role: string) => {\r\n    switch (role) {\r\n      case \"admin\":\r\n        return \"bg-primary text-primary-foreground hover:bg-primary/90\";\r\n      case \"supervisor\":\r\n        return \"bg-blue-500 text-white hover:bg-blue-600\";\r\n      case \"merchant\":\r\n        return \"bg-emerald-500 text-white hover:bg-emerald-600\";\r\n      default:\r\n        return \"bg-muted text-muted-foreground hover:bg-muted/80\";\r\n    }\r\n  };\r\n\r\n  const getRoleIcon = (role: string) => {\r\n    switch (role) {\r\n      case \"admin\":\r\n        return <Shield className=\"h-3.5 w-3.5\" />;\r\n      case \"supervisor\":\r\n        return <Shield className=\"h-3.5 w-3.5\" />;\r\n      case \"merchant\":\r\n        return <Briefcase className=\"h-3.5 w-3.5\" />;\r\n      default:\r\n        return <Users className=\"h-3.5 w-3.5\" />;\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n        <div className=\"text-center space-y-3\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\r\n          <p className=\"text-muted-foreground\">{t(\"common.loading\")}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 w-full max-w-full overflow-x-hidden\">\r\n        {/* Header */}\r\n        <div>\r\n          <div className=\"flex items-center gap-3 mb-2\">\r\n            <div className=\"p-2 bg-primary/10 rounded-lg\">\r\n              <UserCog className=\"h-6 w-6 text-primary\" />\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold tracking-tight\">{t(\"admin.userManagement\")}</h1>\r\n              <p className=\"text-muted-foreground\">{t(\"admin.manageUserRoles\")}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Statistics Cards */}\r\n        {isSupervisor ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <Card className=\"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30\">\r\n              <CardContent className=\"pt-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <p className=\"text-sm font-medium text-muted-foreground\">{t(\"admin.managedMerchants\")}</p>\r\n                    <p className=\"text-2xl font-bold\">{stats.merchants}</p>\r\n                  </div>\r\n                  <Briefcase className=\"h-8 w-8 text-emerald-500\" />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3\">\r\n            <Card className=\"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20 min-w-0\">\r\n              <CardContent className=\"pt-4 pb-4\">\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <p className=\"text-xs font-medium text-muted-foreground truncate\">{t(\"admin.totalUsersLabel\")}</p>\r\n                    <p className=\"text-xl font-bold\">{stats.total}</p>\r\n                  </div>\r\n                  <Users className=\"h-6 w-6 text-primary/60 flex-shrink-0\" />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"bg-gradient-to-br from-red-50 to-red-100 border-red-200 dark:from-red-950/20 dark:to-red-900/20 dark:border-red-900/30 min-w-0\">\r\n              <CardContent className=\"pt-4 pb-4\">\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <p className=\"text-xs font-medium text-muted-foreground truncate\">{t(\"admin.adminsLabel\")}</p>\r\n                    <p className=\"text-xl font-bold\">{stats.admins}</p>\r\n                  </div>\r\n                  <Shield className=\"h-6 w-6 text-red-500 flex-shrink-0\" />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 dark:from-blue-950/20 dark:to-blue-900/20 dark:border-blue-900/30 min-w-0\">\r\n              <CardContent className=\"pt-4 pb-4\">\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <p className=\"text-xs font-medium text-muted-foreground truncate\">{t(\"admin.supervisorsLabel\")}</p>\r\n                    <p className=\"text-xl font-bold\">{stats.supervisors}</p>\r\n                  </div>\r\n                  <Shield className=\"h-6 w-6 text-blue-500 flex-shrink-0\" />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30 min-w-0\">\r\n              <CardContent className=\"pt-4 pb-4\">\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <p className=\"text-xs font-medium text-muted-foreground truncate\">{t(\"admin.merchantsLabel\")}</p>\r\n                    <p className=\"text-xl font-bold\">{stats.merchants}</p>\r\n                  </div>\r\n                  <Briefcase className=\"h-6 w-6 text-emerald-500 flex-shrink-0\" />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 dark:from-gray-950/20 dark:to-gray-900/20 dark:border-gray-900/30 min-w-0\">\r\n              <CardContent className=\"pt-4 pb-4\">\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <p className=\"text-xs font-medium text-muted-foreground truncate\">{t(\"admin.regularUsersLabel\")}</p>\r\n                    <p className=\"text-xl font-bold\">{stats.regularUsers}</p>\r\n                  </div>\r\n                  <Users className=\"h-6 w-6 text-gray-500 flex-shrink-0\" />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        )}\r\n\r\n        {/* Actions Bar */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex flex-col gap-4\">\r\n              {/* Search */}\r\n              <div className=\"w-full\">\r\n                <div className=\"relative\">\r\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                  <Input\r\n                    placeholder={t(\"admin.searchUserPlaceholder\")}\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                    className=\"pl-10 pr-10\"\r\n                  />\r\n                  {searchQuery && (\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0\"\r\n                      onClick={() => setSearchQuery(\"\")}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Filters Row */}\r\n              <div className=\"flex flex-wrap gap-2 items-center\">\r\n              {!isSupervisor && (\r\n                <Select value={roleFilter} onValueChange={setRoleFilter}>\r\n                  <SelectTrigger className=\"w-full lg:w-[200px]\">\r\n                    <Filter className=\"h-4 w-4 mr-2\" />\r\n                    <SelectValue placeholder={t(\"admin.filterRole\")} />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"all\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Users className=\"h-4 w-4\" />\r\n                        {t(\"admin.allRolesLabel\")}\r\n                      </div>\r\n                    </SelectItem>\r\n                    <SelectItem value=\"admin\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Shield className=\"h-4 w-4 text-red-500\" />\r\n                        {t(\"admin.adminsLabel\")}\r\n                      </div>\r\n                    </SelectItem>\r\n                    <SelectItem value=\"supervisor\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Shield className=\"h-4 w-4 text-blue-500\" />\r\n                        {t(\"admin.supervisorsLabel\")}\r\n                      </div>\r\n                    </SelectItem>\r\n                    <SelectItem value=\"merchant\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Briefcase className=\"h-4 w-4 text-emerald-500\" />\r\n                        {t(\"admin.merchantsLabel\")}\r\n                      </div>\r\n                    </SelectItem>\r\n                    <SelectItem value=\"user\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Users className=\"h-4 w-4 text-gray-500\" />\r\n                        {t(\"admin.regularUsersLabel\")}\r\n                      </div>\r\n                    </SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              )}\r\n\r\n              {/* Sort Controls */}\r\n              <div className=\"flex items-center gap-2\">\r\n                <Select value={sortBy} onValueChange={(value: \"name\" | \"created\" | \"lastLogin\") => setSortBy(value)}>\r\n                  <SelectTrigger className=\"w-full lg:w-[160px]\">\r\n                    <ArrowUpDown className=\"h-4 w-4 mr-2\" />\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"name\">{t(\"admin.sortByName\")}</SelectItem>\r\n                    <SelectItem value=\"created\">{t(\"admin.sortByCreated\")}</SelectItem>\r\n                    <SelectItem value=\"lastLogin\">{t(\"admin.sortByLastLogin\")}</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"icon\"\r\n                  onClick={() => setSortDirection(prev => prev === \"asc\" ? \"desc\" : \"asc\")}\r\n                  title={sortDirection === \"asc\" ? t(\"admin.sortAsc\") : t(\"admin.sortDesc\")}\r\n                >\r\n                  {sortDirection === \"asc\" ? <ArrowUp className=\"h-4 w-4\" /> : <ArrowDown className=\"h-4 w-4\" />}\r\n                </Button>\r\n              </div>\r\n\r\n              <div className=\"flex gap-2\">\r\n                {isAdmin && (\r\n                  <CreateUserDialog\r\n                    trigger={\r\n                      <Button variant=\"default\" size=\"default\">\r\n                        <UserPlus className=\"mr-2 h-4 w-4\" />\r\n                        <span className=\"hidden sm:inline\">{t(\"admin.createUser\")}</span>\r\n                        <span className=\"sm:hidden\">{t(\"admin.create\")}</span>\r\n                      </Button>\r\n                    }\r\n                  />\r\n                )}\r\n                <Button variant=\"outline\" onClick={handleExport}>\r\n                  <Download className=\"h-4 w-4 md:mr-2\" />\r\n                  <span className=\"hidden md:inline\">{t(\"admin.exportLabel\")}</span>\r\n                </Button>\r\n              </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Batch Operations - Admin only */}\r\n        {isAdmin && selectedUsers.length > 0 && (\r\n          <Card className=\"border-primary/50 bg-primary/5\">\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex flex-col gap-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Checkbox\r\n                      checked={true}\r\n                      onCheckedChange={() => setSelectedUsers([])}\r\n                    />\r\n                    <span className=\"font-semibold\">\r\n                      已选择 {selectedUsers.length} 个用户\r\n                    </span>\r\n                  </div>\r\n                  <Button \r\n                    variant=\"ghost\" \r\n                    size=\"sm\" \r\n                    onClick={() => setSelectedUsers([])}\r\n                  >\r\n                    <X className=\"h-4 w-4 mr-1\" />\r\n                    清除选择\r\n                  </Button>\r\n                </div>\r\n                \r\n                <Separator />\r\n                \r\n                <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-3\">\r\n                  <div className=\"flex items-center gap-2 flex-1\">\r\n                    <span className=\"text-sm text-muted-foreground whitespace-nowrap\">批量更改角色为：</span>\r\n                    <Select value={batchRole} onValueChange={(value: any) => setBatchRole(value)}>\r\n                      <SelectTrigger className=\"w-full sm:w-[160px]\">\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {availableRoles.map((role) => (\r\n                          <SelectItem key={role} value={role}>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              {getRoleIcon(role)}\r\n                              <span className=\"capitalize\">{role}</span>\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <Button onClick={handleBatchChangeRole} size=\"default\">\r\n                      <UserPlus className=\"mr-2 h-4 w-4\" />\r\n                      应用\r\n                    </Button>\r\n                  </div>\r\n\r\n                  <Button \r\n                    variant=\"destructive\" \r\n                    size=\"default\"\r\n                    onClick={() => setBatchDeleteDialog({ open: true, step: 1, confirmText: \"\" })}\r\n                  >\r\n                    <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                    批量删除\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Users List */}\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Checkbox\r\n                checked={selectedUsers.length === filteredUsers?.length && filteredUsers.length > 0}\r\n                onCheckedChange={toggleSelectAll}\r\n              />\r\n              <span className=\"font-medium text-sm\">全选</span>\r\n            </div>\r\n            <Badge variant=\"secondary\" className=\"text-xs\">\r\n              {displayedCount} / {filteredUsers?.length || 0}\r\n            </Badge>\r\n          </div>\r\n\r\n          {displayedUsers && displayedUsers.length > 0 ? (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3\">\r\n              {displayedUsers.map((user) => (\r\n                <Card \r\n                  key={user.id} \r\n                  className={`transition-all duration-200 ${\r\n                    expandedUser === user.id ? 'ring-2 ring-primary' : 'hover:shadow-md'\r\n                  } ${user.is_banned ? 'border-orange-300 bg-orange-50/50 dark:bg-orange-950/20' : ''}`}\r\n                >\r\n                  <CardContent className=\"p-4\">\r\n                    {/* Compact User Info */}\r\n                    <div className=\"flex items-center gap-4 py-2\">\r\n                      <Checkbox\r\n                        checked={selectedUsers.includes(user.id)}\r\n                        onCheckedChange={() => toggleSelectUser(user.id)}\r\n                        onClick={(e) => e.stopPropagation()}\r\n                        className=\"h-5 w-5\"\r\n                      />\r\n                      <Avatar className=\"h-14 w-14 flex-shrink-0\">\r\n                        <AvatarImage src={user.avatar_url || \"\"} />\r\n                        <AvatarFallback className=\"text-lg font-medium bg-primary/10 text-primary\">\r\n                          {user.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n                        </AvatarFallback>\r\n                      </Avatar>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <h3 className=\"font-semibold text-base truncate\">{user.display_name}</h3>\r\n                          {user.is_banned && (\r\n                            <Badge variant=\"outline\" className=\"text-xs px-1.5 py-0.5 text-orange-500 border-orange-300\">\r\n                              已封禁\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-sm text-muted-foreground truncate\">\r\n                          {user.email || user.phone || \"未设置联系方式\"}\r\n                        </p>\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                          {user.last_sign_in_at \r\n                            ? `最后登录: ${new Date(user.last_sign_in_at).toLocaleString('zh-CN')}`\r\n                            : '从未登录'}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"flex flex-col items-end gap-2\">\r\n                        <Badge className={`${getRoleBadgeColor(user.role)} text-xs px-2.5 py-1`}>\r\n                          {getRoleIcon(user.role)}\r\n                          <span className=\"ml-1.5 capitalize\">{user.role}</span>\r\n                        </Badge>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-8 w-8 p-0\"\r\n                          onClick={() => setExpandedUser(expandedUser === user.id ? null : user.id)}\r\n                        >\r\n                          <ChevronDown className={`h-5 w-5 transition-transform ${expandedUser === user.id ? 'rotate-180' : ''}`} />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Expanded Actions */}\r\n                    {expandedUser === user.id && (\r\n                      <div className=\"mt-3 pt-3 border-t space-y-3\">\r\n                        {/* User Details */}\r\n                        <div className=\"grid grid-cols-2 gap-2 text-xs\">\r\n                          <div>\r\n                            <span className=\"text-muted-foreground\">邮箱:</span>\r\n                            <p className=\"truncate\">{user.email || '-'}</p>\r\n                          </div>\r\n                          <div>\r\n                            <span className=\"text-muted-foreground\">电话:</span>\r\n                            <p className=\"truncate\">{user.phone || '-'}</p>\r\n                          </div>\r\n                          <div>\r\n                            <span className=\"text-muted-foreground\">创建时间:</span>\r\n                            <p>{user.auth_created_at ? new Date(user.auth_created_at).toLocaleDateString('zh-CN') : '-'}</p>\r\n                          </div>\r\n                          <div>\r\n                            <span className=\"text-muted-foreground\">最后登录:</span>\r\n                            <p>{user.last_sign_in_at ? new Date(user.last_sign_in_at).toLocaleString('zh-CN') : '-'}</p>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Role Change - Admin only */}\r\n                        {isAdmin && (\r\n                          <div className=\"flex gap-2\">\r\n                            <Select\r\n                              value={selectedUser === user.id ? selectedRole : \"\"}\r\n                              onValueChange={(value) => {\r\n                                setSelectedUser(user.id);\r\n                                setSelectedRole(value as \"user\" | \"merchant\" | \"supervisor\" | \"admin\");\r\n                              }}\r\n                            >\r\n                              <SelectTrigger className=\"h-8 text-xs flex-1\">\r\n                                <SelectValue placeholder=\"更改角色...\" />\r\n                              </SelectTrigger>\r\n                              <SelectContent>\r\n                                {availableRoles\r\n                                  .filter((role) => role !== user.role)\r\n                                  .map((role) => (\r\n                                    <SelectItem key={role} value={role}>\r\n                                      <div className=\"flex items-center gap-2\">\r\n                                        {getRoleIcon(role)}\r\n                                        <span className=\"capitalize\">{role}</span>\r\n                                      </div>\r\n                                    </SelectItem>\r\n                                  ))}\r\n                              </SelectContent>\r\n                            </Select>\r\n                            <Button\r\n                              size=\"sm\"\r\n                              className=\"h-8 text-xs\"\r\n                              onClick={() => {\r\n                                if (selectedUser === user.id && selectedRole) {\r\n                                  openRoleChangeDialog(user.id, user.display_name, user.role, selectedRole);\r\n                                }\r\n                              }}\r\n                              disabled={selectedUser !== user.id || !selectedRole}\r\n                            >\r\n                              确认\r\n                            </Button>\r\n                          </div>\r\n                        )}\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                          {/* View Profile */}\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            className=\"h-8 px-3 text-xs\"\r\n                            onClick={() => setUserProfileDialog({\r\n                              open: true,\r\n                              userId: user.id,\r\n                              userName: user.display_name,\r\n                              userRole: user.role,\r\n                            })}\r\n                          >\r\n                            <Eye className=\"mr-1.5 h-3.5 w-3.5\" />\r\n                            查看资料\r\n                          </Button>\r\n\r\n                          {/* Edit Profile - Only for merchants and only for supervisors */}\r\n                          {isSupervisor && user.role === \"merchant\" && (\r\n                            <EditMerchantProfileDialog\r\n                              merchant={{\r\n                                id: user.id,\r\n                                display_name: user.display_name,\r\n                                phone: user.phone,\r\n                                avatar_url: user.avatar_url,\r\n                              }}\r\n                              trigger={\r\n                                <Button variant=\"outline\" size=\"sm\" className=\"h-8 px-3 text-xs\">\r\n                                  <Edit className=\"mr-1.5 h-3.5 w-3.5\" />\r\n                                  编辑资料\r\n                                </Button>\r\n                              }\r\n                            />\r\n                          )}\r\n\r\n                          {/* Restaurant Management */}\r\n                          {(user.role === \"merchant\" || user.role === \"supervisor\") && (\r\n                            <Button\r\n                              variant=\"outline\"\r\n                              size=\"sm\"\r\n                              className=\"h-8 px-3 text-xs\"\r\n                              onClick={() => setMerchantRestaurantsDialog({\r\n                                open: true,\r\n                                merchantId: user.id,\r\n                                merchantName: user.display_name,\r\n                                userRole: user.role as \"merchant\" | \"supervisor\",\r\n                              })}\r\n                            >\r\n                              <Store className=\"mr-1.5 h-3.5 w-3.5\" />\r\n                              餐厅\r\n                            </Button>\r\n                          )}\r\n\r\n                          {/* Assign Merchant to Supervisor */}\r\n                          {isAdmin && user.role === \"merchant\" && (\r\n                            <AssignMerchantToSupervisorDialog\r\n                              merchantId={user.id}\r\n                              merchantName={user.display_name}\r\n                              trigger={\r\n                                <Button variant=\"outline\" size=\"sm\" className=\"h-8 px-3 text-xs\">\r\n                                  <UserCog className=\"mr-1.5 h-3.5 w-3.5\" />\r\n                                  分配主管\r\n                                </Button>\r\n                              }\r\n                            />\r\n                          )}\r\n\r\n                          {/* Assign Merchants to Supervisor */}\r\n                          {isAdmin && user.role === \"supervisor\" && (\r\n                            <AssignMerchantsToSupervisorDialog\r\n                              supervisorId={user.id}\r\n                              supervisorName={user.display_name}\r\n                              trigger={\r\n                                <Button variant=\"outline\" size=\"sm\" className=\"h-8 px-3 text-xs\">\r\n                                  <Users className=\"mr-1.5 h-3.5 w-3.5\" />\r\n                                  {t(\"admin.users.manageMerchant\")}\r\n                                </Button>\r\n                              }\r\n                            />\r\n                          )}\r\n\r\n                          {/* Delete User */}\r\n                          {isAdmin && user.role !== \"admin\" && (\r\n                            <Button\r\n                              variant=\"destructive\"\r\n                              size=\"sm\"\r\n                              className=\"h-8 px-3 text-xs\"\r\n                              onClick={() => openDeleteUserDialog(user.id, user.display_name, user.role)}\r\n                            >\r\n                              <Trash2 className=\"mr-1.5 h-3.5 w-3.5\" />\r\n                              {t(\"admin.users.delete\")}\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-12 pb-12\">\r\n                <div className=\"text-center space-y-3\">\r\n                  <Users className=\"h-16 w-16 text-muted-foreground/50 mx-auto\" />\r\n                  <h3 className=\"text-lg font-semibold\">{t(\"admin.users.noUsersFound\")}</h3>\r\n                  <p className=\"text-muted-foreground\">\r\n                    {searchQuery || roleFilter !== \"all\" \r\n                      ? t(\"admin.users.adjustFilters\")\r\n                      : t(\"admin.users.noUsersYet\")}\r\n                  </p>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n\r\n          {/* Infinite scroll sentinel */}\r\n          {hasMore && (\r\n            <div ref={sentinelRef} className=\"flex justify-center py-4\">\r\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Role Change Confirmation Dialog */}\r\n        <AlertDialog open={roleChangeDialog.open} onOpenChange={(open) => {\r\n          if (!open) {\r\n            setRoleChangeDialog({\r\n              open: false,\r\n              userId: \"\",\r\n              userName: \"\",\r\n              currentRole: \"\",\r\n              newRole: \"\",\r\n            });\r\n          }\r\n        }}>\r\n          <AlertDialogContent className=\"max-w-[90vw] sm:max-w-[500px]\">\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle className=\"flex items-center gap-2\">\r\n                <Shield className=\"h-5 w-5 text-primary\" />\r\n                确认角色更改\r\n              </AlertDialogTitle>\r\n              <AlertDialogDescription className=\"space-y-4 pt-4\">\r\n                <div className=\"bg-muted/50 p-4 rounded-lg space-y-3\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm font-medium text-muted-foreground\">用户：</span>\r\n                    <span className=\"font-semibold text-foreground\">{roleChangeDialog.userName}</span>\r\n                  </div>\r\n                  <Separator />\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm font-medium text-muted-foreground\">当前角色：</span>\r\n                    <Badge className={getRoleBadgeColor(roleChangeDialog.currentRole)}>\r\n                      {getRoleIcon(roleChangeDialog.currentRole)}\r\n                      <span className=\"ml-1.5 capitalize\">{roleChangeDialog.currentRole}</span>\r\n                    </Badge>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-center\">\r\n                    <div className=\"text-2xl text-primary\">↓</div>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm font-medium text-muted-foreground\">新角色：</span>\r\n                    <Badge className={getRoleBadgeColor(roleChangeDialog.newRole)}>\r\n                      {getRoleIcon(roleChangeDialog.newRole)}\r\n                      <span className=\"ml-1.5 capitalize\">{roleChangeDialog.newRole}</span>\r\n                    </Badge>\r\n                  </div>\r\n                </div>\r\n                \r\n                {roleChangeDialog.newRole === \"admin\" && (\r\n                  <div className=\"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3\">\r\n                    <Shield className=\"h-5 w-5 text-destructive flex-shrink-0 mt-0.5\" />\r\n                    <div className=\"space-y-1\">\r\n                      <p className=\"font-semibold text-destructive text-sm\">⚠️ 警告：管理员权限</p>\r\n                      <p className=\"text-sm text-muted-foreground\">\r\n                        您即将授予该用户管理员权限。管理员可以管理所有用户、餐厅和活动，包括删除数据和分配角色。\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {roleChangeDialog.currentRole === \"admin\" && (\r\n                  <div className=\"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3\">\r\n                    <Shield className=\"h-5 w-5 text-destructive flex-shrink-0 mt-0.5\" />\r\n                    <div className=\"space-y-1\">\r\n                      <p className=\"font-semibold text-destructive text-sm\">⚠️ 警告：移除管理员权限</p>\r\n                      <p className=\"text-sm text-muted-foreground\">\r\n                        您即将移除该用户的管理员权限。该用户将失去对系统的完全访问权限。\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                <p className=\"text-sm text-center text-muted-foreground\">\r\n                  此操作将立即生效。确定要继续吗？\r\n                </p>\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>取消</AlertDialogCancel>\r\n              <AlertDialogAction onClick={handleChangeRole} className=\"bg-primary\">\r\n                确认更改\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {/* Merchant Restaurants Dialog */}\r\n        <MerchantRestaurantsDialog\r\n          open={merchantRestaurantsDialog.open}\r\n          onOpenChange={(open) => setMerchantRestaurantsDialog({\r\n            ...merchantRestaurantsDialog,\r\n            open,\r\n          })}\r\n          merchantId={merchantRestaurantsDialog.merchantId}\r\n          merchantName={merchantRestaurantsDialog.merchantName}\r\n          userRole={merchantRestaurantsDialog.userRole}\r\n        />\r\n\r\n        {/* Single User Delete Dialog */}\r\n        <DeleteUserDialog\r\n          open={deleteUserDialog.open}\r\n          onOpenChange={(open) => {\r\n            if (!open) {\r\n              setDeleteUserDialog({\r\n                open: false,\r\n                userId: \"\",\r\n                userName: \"\",\r\n                userRole: \"\",\r\n              });\r\n            }\r\n          }}\r\n          userName={deleteUserDialog.userName}\r\n          userId={deleteUserDialog.userId}\r\n          userRole={deleteUserDialog.userRole}\r\n          onConfirm={handleDeleteUser}\r\n          isDeleting={deleteUser.isPending}\r\n        />\r\n\r\n        {/* Batch Delete Multi-Step Dialog */}\r\n        <AlertDialog open={batchDeleteDialog.open} onOpenChange={(open) => {\r\n          if (!open) {\r\n            setBatchDeleteDialog({ open: false, step: 1, confirmText: \"\" });\r\n          }\r\n        }}>\r\n          <AlertDialogContent className=\"max-w-[90vw] sm:max-w-[500px]\">\r\n            {batchDeleteDialog.step === 1 ? (\r\n              <>\r\n                <AlertDialogHeader>\r\n                  <AlertDialogTitle className=\"flex items-center gap-2 text-destructive\">\r\n                    <AlertTriangle className=\"h-5 w-5\" />\r\n                    {t(\"admin.batchDeleteTitle\")}\r\n                  </AlertDialogTitle>\r\n                  <AlertDialogDescription className=\"space-y-4 pt-4\">\r\n                    <div className=\"bg-destructive/10 border border-destructive/20 p-4 rounded-lg\">\r\n                      <p className=\"font-semibold text-foreground\">\r\n                        {t(\"admin.batchDeleteStep1\", { count: selectedUsers.length })}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"space-y-2 text-sm text-muted-foreground\">\r\n                      <p>{t(\"admin.deleteUserConsequences\")}</p>\r\n                      <ul className=\"list-disc list-inside space-y-1 ml-2\">\r\n                        <li>{t(\"admin.deleteUserData1\")}</li>\r\n                        <li>{t(\"admin.deleteUserData2\")}</li>\r\n                        <li>{t(\"admin.deleteUserData3\")}</li>\r\n                        <li>{t(\"admin.deleteUserData4\")}</li>\r\n                      </ul>\r\n                    </div>\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter>\r\n                  <AlertDialogCancel onClick={() => setBatchDeleteDialog({ open: false, step: 1, confirmText: \"\" })}>\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                  <AlertDialogAction\r\n                    onClick={() => setBatchDeleteDialog(prev => ({ ...prev, step: 2 }))}\r\n                    className=\"bg-destructive hover:bg-destructive/90\"\r\n                  >\r\n                    {t(\"common.continue\")}\r\n                  </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <AlertDialogHeader>\r\n                  <AlertDialogTitle className=\"flex items-center gap-2 text-destructive\">\r\n                    <Trash2 className=\"h-5 w-5\" />\r\n                    {t(\"admin.batchDeleteStep2Title\")}\r\n                  </AlertDialogTitle>\r\n                  <AlertDialogDescription className=\"space-y-4 pt-4\">\r\n                    <p className=\"text-foreground font-medium\">\r\n                      {t(\"admin.batchDeleteStep2Desc\", { count: selectedUsers.length })}\r\n                    </p>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"batch-delete-confirm\" className=\"text-sm font-medium\">\r\n                        {t(\"admin.typeDeleteToConfirm\")}\r\n                      </Label>\r\n                      <Input\r\n                        id=\"batch-delete-confirm\"\r\n                        value={batchDeleteDialog.confirmText}\r\n                        onChange={(e) => setBatchDeleteDialog(prev => ({ ...prev, confirmText: e.target.value }))}\r\n                        placeholder=\"DELETE\"\r\n                        className=\"uppercase\"\r\n                        autoComplete=\"off\"\r\n                      />\r\n                    </div>\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter>\r\n                  <AlertDialogCancel onClick={() => setBatchDeleteDialog({ open: false, step: 1, confirmText: \"\" })}>\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                  <AlertDialogAction\r\n                    onClick={handleBatchDeleteConfirm}\r\n                    disabled={batchDeleteDialog.confirmText.toLowerCase() !== \"delete\" || batchDeleteUsers.isPending}\r\n                    className=\"bg-destructive hover:bg-destructive/90\"\r\n                  >\r\n                    {batchDeleteUsers.isPending ? t(\"common.loading\") : t(\"admin.deleteUser\")}\r\n                  </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n              </>\r\n            )}\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {/* User Profile Dialog */}\r\n        <UserProfileDialog\r\n          open={userProfileDialog.open}\r\n          onOpenChange={(open) => setUserProfileDialog(prev => ({ ...prev, open }))}\r\n          userId={userProfileDialog.userId}\r\n          userName={userProfileDialog.userName}\r\n          userRole={userProfileDialog.userRole}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n\r\n  export default AdminUsers;\r\n"],"names":["CreateUserDialog","trigger","t","useTranslation","toast","useToast","queryClient","useQueryClient","isSupervisor","useUserRole","open","setOpen","useState","isLoading","setIsLoading","formData","setFormData","handleSubmit","e","session","supabase","response","result","error","Dialog","jsx","DialogTrigger","Button","UserPlus","DialogContent","jsxs","DialogHeader","DialogTitle","DialogDescription","Label","Input","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","DialogFooter","Loader2","MerchantRestaurantsDialog","onOpenChange","merchantId","merchantName","userRole","localizeRestaurant","useLocalizedContent","user","useAuth","selectedRestaurants","setSelectedRestaurants","searchQuery","setSearchQuery","supervisorRestaurantIds","useQuery","data","mr","allRestaurants","restaurantsLoading","query","merchantRestaurants","merchantRestaurantsLoading","allAssignments","mrData","mrError","userIds","profilesData","rolesData","profilesMap","p","rolesMap","r","assignmentsByRestaurant","item","useEffect","saveMutation","useMutation","deleteError","insertError","restaurantId","toggleRestaurant","prev","id","handleSave","filteredRestaurants","restaurant","Store","Search","ScrollArea","isSelected","localizedRest","assignedUsers","u","Checkbox","Badge","MapPin","type","idx","User","TooltipProvider","Tooltip","TooltipTrigger","TooltipContent","AssignMerchantToSupervisorDialog","selectedSupervisor","setSelectedSupervisor","supervisors","loadingSupervisors","roles","rolesError","supervisorIds","profiles","profilesError","currentSupervisors","supervisorRestaurants","validSupervisorIds","assignMutation","supervisorId","insertData","removeMutation","handleAssign","handleRemove","UserCog","Shield","supervisor","s","cs","Fragment","AssignMerchantsToSupervisorDialog","supervisorName","selectedMerchants","setSelectedMerchants","merchants","loadingMerchants","merchantIds","profile","managedMerchantIds","loadingManaged","srError","potentialMerchantIds","selectedMerchantRestaurants","currentSupervisorRestaurants","csrError","currentRestaurantIds","newRestaurantIds","toAdd","allMerchantRestaurantIds","m","toRemove","toggleMerchant","isInitialized","newOpen","Users","Briefcase","merchant","Avatar","AvatarImage","AvatarFallback","EditMerchantProfileDialog","displayName","setDisplayName","phone","setPhone","avatarFile","setAvatarFile","avatarPreview","setAvatarPreview","updateProfile","useUpdateMerchantProfile","uploadAvatar","useUploadMerchantAvatar","handleAvatarChange","file","avatar_url","uploadedUrl","Edit","Upload","DeleteUserDialog","userName","userId","onConfirm","isDeleting","step","setStep","confirmText","setConfirmText","handleClose","handleFirstConfirm","handleFinalConfirm","AlertDialog","isOpen","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertTriangle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","Trash2","AdminUsers","isAdmin","users","useAdminUsers","changeRole","useChangeRole","batchDeleteUsers","useBatchDeleteUsers","batchChangeRole","useBatchChangeRole","deleteUser","useDeleteUser","selectedUser","setSelectedUser","selectedRole","setSelectedRole","selectedUsers","setSelectedUsers","batchRole","setBatchRole","roleFilter","setRoleFilter","sortBy","setSortBy","sortDirection","setSortDirection","expandedUser","setExpandedUser","deleteUserDialog","setDeleteUserDialog","batchDeleteDialog","setBatchDeleteDialog","roleChangeDialog","setRoleChangeDialog","merchantRestaurantsDialog","setMerchantRestaurantsDialog","userProfileDialog","setUserProfileDialog","availableRoles","role","stats","useMemo","filteredUsers","filtered","matchesSearch","matchesRole","a","b","comparison","dateA","dateB","displayedUsers","hasMore","resetInfiniteScroll","displayedCount","sentinelRef","useInfiniteScroll","handleExport","exportUsersToCSV","toggleSelectUser","toggleSelectAll","handleDeleteUser","openDeleteUserDialog","handleBatchDeleteConfirm","handleBatchChangeRole","handleChangeRole","openRoleChangeDialog","currentRole","newRole","getRoleBadgeColor","getRoleIcon","Card","CardContent","X","Filter","ArrowUpDown","ArrowUp","ArrowDown","Download","Separator","ChevronDown","Eye","UserProfileDialog"],"mappings":"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"}