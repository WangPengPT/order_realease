import{j as e}from"./vendor-ui-BO6fjm1h.js";import{u as Y,q as Z,R as G,aA as J,aB as K,aC as Q,bm as ee,ac as se,ad as ae,B as i,E as te,ae as re,af as le,T as ie,k as ne,ay as ce,V as oe,Z as me,M as de,ab as ue,am as he,an as xe,ao as ge,ap as je,aq as fe,ar as ve,as as Ne,at as pe,Y as we,a6 as Ce,a7 as ye,bn as be,bo as ke,bp as _e,a9 as u,L as Se,aU as k}from"./index-Bjy07DNZ.js";import{u as A,r,L as f,a as De,j as Ae}from"./vendor-react-CrHRjzzo.js";import{C as _,a as S,b as D}from"./carousel-CTBl1JfU.js";import{c as Te,g as ze,b as Le,h as Pe}from"./useCommunityPosts-Bqcd_MRM.js";import{u as Ee}from"./useLocalizedContent-S0TAoDtX.js";import{T as Ie,R as Fe}from"./RestaurantComments-DmJ4Ectf.js";import{u as T}from"./vendor-i18n-DWR4v88Y.js";import"./vendor-charts-C50LysBY.js";import"./vendor-query-EnOED-MY.js";import"./vendor-supabase-QnE9GqXs.js";import"./ReportDialog-CcPbd7Tk.js";import"./input-otp-ioX8WIrA.js";import"./useSensitiveWords-C4aN5_xI.js";const $e=({post:s,showActions:o=!0,isDetailPage:m=!1})=>{const{t,i18n:h}=T(),{user:n}=Y(),z=A(),{getLocalizedField:L}=Ee(),P=Te(),x=ze(),E=Le(),[I,g]=r.useState(!1),[v,N]=r.useState({}),[F,d]=r.useState(!1),[$,p]=r.useState(0),[c,M]=r.useState(),[w,B]=r.useState(),[C,y]=r.useState(0),[R,q]=r.useState(null);r.useState(null),r.useState(!1),r.useState(0),r.useState(!1),r.useEffect(()=>{c&&(y(c.selectedScrollSnap()),c.on("select",()=>{y(c.selectedScrollSnap())}))},[c]);const H=()=>{switch(h.language){case"zh":return _e;case"pt":return ke;default:return be}},O=()=>{n&&P.mutate({postId:s.id,liked:s.user_liked||!1})},U=async()=>{const a=`${window.location.origin}/community/${s.id}`;if(navigator.share)try{await navigator.share({title:t("community.shareTitle","分享帖子"),url:a}),n&&x.mutate(s.id),u.success(t("community.shareSuccess","分享成功"))}catch(l){l?.name!=="AbortError"&&(await navigator.clipboard.writeText(a),u.success(t("community.linkCopied","链接已复制到剪贴板")),n&&x.mutate(s.id))}else try{await navigator.clipboard.writeText(a),u.success(t("community.linkCopied","链接已复制到剪贴板")),n&&x.mutate(s.id)}catch{u.error(t("community.shareFailed","分享失败"))}},V=()=>{E.mutate(s.id),g(!1)},b=a=>{m?(p(a),d(!0)):z(`/community/${s.id}`)},W=n?.id===s.author_id,X=s.activity?L(s.activity,"title"):null;return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{className:"overflow-hidden",children:[e.jsx(G,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(J,{className:"h-10 w-10",children:[e.jsx(K,{src:s.author?.avatar_url||void 0}),e.jsx(Q,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ee(new Date(s.created_at),{addSuffix:!0,locale:H()})})]})]}),o&&W&&e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsx(re,{align:"end",children:e.jsx(le,{onClick:()=>g(!0),className:"text-destructive",children:t("common.delete","删除")})})]})]})}),e.jsxs(ie,{className:"pt-0 pb-3",children:[s.activity&&e.jsx(f,{to:`/activity/${s.activity.id}`,children:e.jsxs(ne,{variant:"secondary",className:"mb-3 gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),X]})}),e.jsx(f,{to:`/community/${s.id}`,children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:R||s.content}})}),e.jsx(Ie,{text:s.content,onTranslation:q,className:"mt-1"}),s.image_urls&&s.image_urls.length>0&&e.jsx("div",{className:"relative mt-3",children:s.image_urls.length===1?e.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg cursor-pointer",onClick:()=>b(0),children:v[s.image_urls[0]]?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s.image_urls[0],alt:"",className:"w-full h-full object-cover",onError:()=>N(a=>({...a,[s.image_urls[0]]:!0}))})}):e.jsxs(e.Fragment,{children:[e.jsx(_,{setApi:M,className:"w-full",opts:{loop:!0},children:e.jsx(S,{className:"-ml-0",children:s.image_urls.map((a,l)=>e.jsx(D,{className:"pl-0",children:e.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg cursor-pointer",onClick:()=>b(l),children:v[a]?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:a,alt:"",className:"w-full h-full object-cover",onError:()=>N(j=>({...j,[a]:!0}))})})},l))})}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[C+1,"/",s.image_urls.length]}),e.jsx("div",{className:"flex justify-center gap-1.5 mt-2",children:s.image_urls.map((a,l)=>e.jsx("button",{className:`w-1.5 h-1.5 rounded-full transition-colors ${l===C?"bg-primary":"bg-muted-foreground/30"}`,onClick:j=>{j.stopPropagation(),c?.scrollTo(l)}},l))})]})}),s.video_url&&e.jsx("div",{className:"mt-3 rounded-lg overflow-hidden",children:e.jsx("video",{src:s.video_url,controls:!0,className:"w-full max-h-96",preload:"metadata"})})]}),e.jsx(oe,{className:"pt-0 border-t",children:e.jsxs("div",{className:"flex items-center gap-4 pt-3 w-full",children:[e.jsxs(i,{variant:"ghost",size:"sm",className:`gap-2 ${s.user_liked?"text-red-500":""}`,onClick:O,disabled:!n,children:[e.jsx(me,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count})]}),e.jsx(f,{to:`/community/${s.id}`,children:e.jsxs(i,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:s.comments_count})]})}),e.jsxs(i,{variant:"ghost",size:"sm",className:"gap-2",onClick:U,children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:s.shares_count})]})]})})]}),e.jsx(he,{open:I,onOpenChange:g,children:e.jsxs(xe,{children:[e.jsxs(ge,{children:[e.jsx(je,{children:t("common.confirmDelete","确认删除")}),e.jsx(fe,{children:t("community.deleteWarning","删除后无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(ve,{children:[e.jsx(Ne,{children:t("common.cancel","取消")}),e.jsx(pe,{onClick:V,children:t("common.delete","删除")})]})]})}),F&&De.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black overflow-hidden",onClick:a=>{a.target===a.currentTarget&&d(!1)},children:[s.image_urls&&s.image_urls.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full",children:[$+1," / ",s.image_urls.length]}),e.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:()=>d(!1),children:e.jsx(we,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(_,{className:"w-full",opts:{loop:!0},setApi:a=>{B(a),a&&a.on("select",()=>{p(a.selectedScrollSnap())})},children:e.jsx(S,{className:"-ml-0",children:s.image_urls?.map((a,l)=>e.jsx(D,{className:"pl-0 flex items-center justify-center",children:e.jsx("img",{src:a,alt:"",className:"object-contain select-none w-screen h-screen cursor-pointer",draggable:!1,onClick:()=>d(!1)})},l))})})}),s.image_urls&&s.image_urls.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>w?.scrollPrev(),children:e.jsx(Ce,{className:"h-8 w-8"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>w?.scrollNext(),children:e.jsx(ye,{className:"h-8 w-8"})})]})]}),document.body)]})},Ke=()=>{const{id:s}=Ae(),{t:o}=T(),m=A(),{data:t,isLoading:h,error:n}=Pe(s||"");return h?e.jsx("div",{className:"container max-w-2xl mx-auto py-6 px-4 flex justify-center",children:e.jsx(Se,{className:"h-8 w-8 animate-spin"})}):n||!t?e.jsx("div",{className:"container max-w-2xl mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:o("community.postNotFound","帖子不存在或已被删除")}),e.jsxs(i,{variant:"outline",className:"mt-4",onClick:()=>m("/community"),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),o("community.backToList","返回社区")]})]})}):e.jsxs("div",{className:"container max-w-2xl mx-auto py-6 px-4",children:[e.jsxs(i,{variant:"ghost",size:"sm",className:"mb-4",onClick:()=>m("/community"),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),o("community.backToList","返回社区")]}),e.jsx($e,{post:t,showActions:!0,isDetailPage:!0}),e.jsx("div",{className:"mt-6",children:e.jsx(Fe,{targetId:t.id,targetType:"post"})})]})};export{Ke as default};
//# sourceMappingURL=PostDetail-Ww1uIAc8.js.map
