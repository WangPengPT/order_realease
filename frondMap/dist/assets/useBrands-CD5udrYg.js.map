{"version":3,"file":"useBrands-CD5udrYg.js","sources":["../../src/hooks/useBrands.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport i18n from \"i18next\";\r\nimport { Json } from \"@/integrations/supabase/types\";\r\n\r\nexport interface ContentBlock {\r\n  id: string;\r\n  type: \"text\" | \"image\";\r\n  content_zh?: string;\r\n  content_en?: string;\r\n  content_pt?: string;\r\n  url?: string;\r\n  alt?: string;\r\n}\r\n\r\nexport interface Brand {\r\n  id: string;\r\n  name: string;\r\n  name_en?: string | null;\r\n  name_pt?: string | null;\r\n  intro_zh?: string | null;\r\n  intro_en?: string | null;\r\n  intro_pt?: string | null;\r\n  image_url?: string | null;\r\n  logo_url?: string | null;\r\n  content_blocks?: ContentBlock[] | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n// Helper to safely cast JSON to ContentBlock[]\r\nconst parseContentBlocks = (json: Json | null): ContentBlock[] | null => {\r\n  if (!json || !Array.isArray(json)) return null;\r\n  return json as unknown as ContentBlock[];\r\n};\r\n\r\nexport const useBrands = () => {\r\n  return useQuery({\r\n    queryKey: [\"brands\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"brands\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data.map((item) => ({\r\n        ...item,\r\n        content_blocks: parseContentBlocks(item.content_blocks),\r\n      })) as Brand[];\r\n    },\r\n  });\r\n};\r\n\r\nexport const useBrand = (id: string) => {\r\n  return useQuery({\r\n    queryKey: [\"brand\", id],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"brands\")\r\n        .select(\"*\")\r\n        .eq(\"id\", id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return {\r\n        ...data,\r\n        content_blocks: parseContentBlocks(data.content_blocks),\r\n      } as Brand;\r\n    },\r\n    enabled: !!id,\r\n  });\r\n};\r\n\r\nexport const useCreateBrand = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (brandData: Omit<Brand, \"id\" | \"created_at\" | \"updated_at\">) => {\r\n      const { content_blocks, ...rest } = brandData;\r\n      const { data, error } = await supabase\r\n        .from(\"brands\")\r\n        .insert([{\r\n          ...rest,\r\n          content_blocks: content_blocks as unknown as Json,\r\n        }])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"brands\"] });\r\n      toast.success(i18n.t(\"admin.brand.createSuccess\"));\r\n    },\r\n    onError: (error: any) => {\r\n      toast.error(error.message || i18n.t(\"admin.brand.createError\"));\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateBrand = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ id, content_blocks, ...brandData }: Partial<Brand> & { id: string }) => {\r\n      const updateData: Record<string, unknown> = { ...brandData };\r\n      \r\n      // Only include content_blocks if it's defined\r\n      if (content_blocks !== undefined) {\r\n        updateData.content_blocks = content_blocks as unknown as Json;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"brands\")\r\n        .update(updateData)\r\n        .eq(\"id\", id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"brands\"] });\r\n      toast.success(i18n.t(\"admin.brand.updateSuccess\"));\r\n    },\r\n    onError: (error: any) => {\r\n      toast.error(error.message || i18n.t(\"admin.brand.updateError\"));\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteBrand = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"brands\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"brands\"] });\r\n      toast.success(i18n.t(\"admin.brand.deleteSuccess\"));\r\n    },\r\n    onError: (error: any) => {\r\n      toast.error(error.message || i18n.t(\"admin.brand.deleteError\"));\r\n    },\r\n  });\r\n};\r\n"],"names":["parseContentBlocks","json","useBrands","useQuery","data","error","supabase","item","useBrand","id","useCreateBrand","queryClient","useQueryClient","useMutation","brandData","content_blocks","rest","toast","i18n","useUpdateBrand","updateData","useDeleteBrand"],"mappings":"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"}