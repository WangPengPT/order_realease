import{j as e}from"./vendor-ui-DmpovMYY.js";import{a as _e,u as Ee,l as Me,D as Oe,b as Fe,c as Pe,d as Be,S as Ce,M as pe,e as q,U as Ve,L as ve,I as Te,B as Q,f as We,g as qe,N as de,F as Xe,h as W,i as He,j as Ue,C as ye,k as je,m as me,n as we,o as Ne,E as Je,s as Ke,p as Qe,q as Ge,r as Ye,H as Ze,t as Ie,v as Re,w as et,x as tt,y as st,z as at}from"./index-C_NQhAgt.js";import{u as $e,r,a as ke,L as rt}from"./vendor-react-iAJ0IrSD.js";import{c as ot,g as nt,m as lt}from"./geolocation-DRm3QMsJ.js";import{u as it}from"./useHomepageTemplates-u9uk6tOd.js";import{u as ct}from"./usePageView-EMM9bYWR.js";import{L as De}from"./LocationPermissionDialog-DYuyJDRt.js";import{u as fe}from"./vendor-i18n-DxKeo2S1.js";import{P as dt}from"./PullToRefresh-DepNgOxA.js";import{u as mt}from"./vendor-query-D82cqPtt.js";import{P as ut,a as xt,b as ht}from"./popover-BWq6G-y5.js";import{u as pt,a as gt}from"./useRestaurants-PMUD2IEv.js";import{u as ft,R as bt,l as vt}from"./xiaoxiong-logo-clean-CV4qRQYb.js";import{u as yt}from"./useLocalizedContent-BN2IWylL.js";import{u as jt}from"./useActivities-C60Sgsnm.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-6pZ9VDFn.js";import"./vendor-map-BaCLwlqt.js";/* empty css                  */const wt="/assets/google-play-badge-new-BAXiFmDF.png",Nt="/assets/app-store-badge-C-eOGvqu.svg",he="https://tzdgqhwyzsxkxnncgzap.supabase.co",ie="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",kt=["最近","附近","离我","距离","远近","近的","周边","周围","最近的","附近的","nearest","closest","nearby","near me","close to me","distance","around me","mais perto","próximo","perto de mim","distância","mais próximo"],St=()=>{const a="xiaoxiong_anonymous_user_id";let n=localStorage.getItem(a);return n||(n=`anon_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,localStorage.setItem(a,n)),n},_t=({open:a,onOpenChange:n,provider:v="ask-xiaoxiong"})=>{const{i18n:j}=fe(),p=$e(),{settings:O}=_e(),{user:X}=Ee(),D=O?.logo_url||Me,[c,I]=r.useState(""),[z,g]=r.useState([]),[C,R]=r.useState(!1),[k,S]=r.useState(null),[G,H]=r.useState(!1),[F,L]=r.useState(null),E=r.useRef(null),P=r.useRef(null),Z=r.useRef(null),U=()=>X?.id?X.id:St();r.useEffect(()=>{a&&!k&&navigator.geolocation?.getCurrentPosition(s=>{S({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{console.log("Unable to get user location:",s.message)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})},[a,k]),r.useEffect(()=>{Z.current?.scrollIntoView({behavior:"smooth"})},[z]);const w=async(s,m)=>{const o=await fetch(`${he}/functions/v1/ask-xiaoxiong`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ie}`,apikey:ie},body:JSON.stringify({text:s.content,stream:!0,lat:k?.lat,lng:k?.lng}),signal:E.current?.signal});if(!o.ok)throw new Error(`Request failed with status: ${o.status}`);if(!o.body)throw new Error("No response body");const d=o.body.getReader(),l=new TextDecoder;let h="";for(;;){const{done:b,value:f}=await d.read();if(b)break;const V=l.decode(f,{stream:!0});h+=V;let y=h;y.startsWith('"')&&(y=y.slice(1)),y.endsWith('"')&&(y=y.slice(0,-1)),y=y.replace(/\\n/g,`
`),g(M=>M.map(t=>t.id===m?{...t,content:y}:t))}let u=h;u.startsWith('"')&&(u=u.slice(1)),u.endsWith('"')&&(u=u.slice(0,-1)),u=u.replace(/\\n/g,`
`),g(b=>b.map(f=>f.id===m?{...f,content:u,isStreaming:!1}:f))},N=async(s,m)=>{const o=U(),d=Date.now();console.log(`[前端-Agent] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const l=await fetch(`${he}/functions/v1/xiaoxiong-agent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ie}`,apikey:ie},body:JSON.stringify({message:s.content,userId:o}),signal:E.current?.signal}),h=Date.now()-d;if(console.log(`[前端-Agent] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${h}ms`),!l.ok)throw new Error(`Request failed with status: ${l.status}`);if(!l.body)throw new Error("No response body");const u=l.body.getReader(),b=new TextDecoder;let f="",V=!1,y=0;for(;;){const{done:M,value:t}=await u.read();if(M){console.log(`[前端-Agent] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-d}ms, 共 ${y} 个数据块`);break}y++;const i=b.decode(t,{stream:!0});if(f+=i,!V){V=!0;const T=Date.now()-d;console.log(`[前端-Agent] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${T}ms, 大小: ${i.length} 字符`)}ke.flushSync(()=>{g(T=>T.map(le=>le.id===m?{...le,content:f}:le))}),await new Promise(T=>requestAnimationFrame(T))}g(M=>M.map(t=>t.id===m?{...t,isStreaming:!1}:t))},J=async(s,m)=>{const o=Date.now();console.log(`[前端-LovableAI] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const d=await fetch(`${he}/functions/v1/lovable-chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ie}`,apikey:ie},body:JSON.stringify({message:s.content,lat:k?.lat,lng:k?.lng,language:j.language}),signal:E.current?.signal}),l=Date.now()-o;if(console.log(`[前端-LovableAI] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${l}ms`),!d.ok){const y=await d.json().catch(()=>({}));throw new Error(y.error||`Request failed with status: ${d.status}`)}if(!d.body)throw new Error("No response body");const h=d.body.getReader(),u=new TextDecoder;let b="",f="",V=!1;for(;;){const{done:y,value:M}=await h.read();if(y){console.log(`[前端-LovableAI] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-o}ms`);break}if(f+=u.decode(M,{stream:!0}),!V){V=!0;const i=Date.now()-o;console.log(`[前端-LovableAI] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${i}ms`)}let t;for(;(t=f.indexOf(`
`))!==-1;){let i=f.slice(0,t);if(f=f.slice(t+1),i.endsWith("\r")&&(i=i.slice(0,-1)),i.startsWith(":")||i.trim()===""||!i.startsWith("data: "))continue;const T=i.slice(6).trim();if(T==="[DONE]")break;try{const be=JSON.parse(T).choices?.[0]?.delta?.content;be&&(b+=be,ke.flushSync(()=>{g(ue=>ue.map(xe=>xe.id===m?{...xe,content:b}:xe))}),await new Promise(ue=>requestAnimationFrame(ue)))}catch{f=i+`
`+f;break}}}g(y=>y.map(M=>M.id===m?{...M,isStreaming:!1}:M))},_=s=>{const m=s.toLowerCase();return kt.some(o=>m.includes(o))},K=async s=>{const m={id:Date.now().toString(),role:"user",content:s},o=(Date.now()+1).toString(),d={id:o,role:"assistant",content:"",isStreaming:!0};g(l=>[...l,m,d]),I(""),R(!0),E.current&&E.current.abort(),E.current=new AbortController;try{v==="lovable-ai"?await J(m,o):v==="xiaoxiong-agent"?await N(m,o):await w(m,o)}catch(l){if(l instanceof Error&&l.name==="AbortError"){console.log("Request aborted");return}console.error("Ask API error:",l);const h=j.language==="zh"?"抱歉，暂时无法获取结果，请稍后再试":j.language==="pt"?"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.":"Sorry, unable to get results. Please try again later.";g(u=>u.map(b=>b.id===o?{...b,content:h,isStreaming:!1}:b))}finally{R(!1)}},ce=()=>{H(!1),navigator.geolocation?.getCurrentPosition(s=>{S({lat:s.coords.latitude,lng:s.coords.longitude}),F&&setTimeout(()=>{K(F),L(null)},100)},s=>{console.log("Location permission denied:",s.message),F&&(K(F),L(null))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},re=async()=>{if(!c.trim()||C)return;const s=c.trim();if(!k&&_(s)){L(s),H(!0),I("");return}await K(s)},ee=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),re())},Y=()=>{E.current&&E.current.abort(),n(!1)},oe=s=>{Y(),p(s)},A=s=>{const m=/\[([^\]]+)\]\(([^)]+)\)/g,o=[];let d=0,l,h=0;for(;(l=m.exec(s))!==null;){l.index>d&&o.push(e.jsx("span",{children:s.slice(d,l.index)},h++));const u=l[1],b=l[2];b.startsWith("/")?o.push(e.jsx("button",{onClick:()=>oe(b),className:"text-primary hover:underline font-medium cursor-pointer",children:u},h++)):o.push(e.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:u},h++)),d=l.index+l[0].length}return d<s.length&&o.push(e.jsx("span",{children:s.slice(d)},h++)),o.length>0?o:[e.jsx("span",{children:s},"0")]},ne=s=>s.replace(/\*\*(.*?)\*\*/g,"$1"),te=(s,m=20)=>s.length<=m?s:s.slice(0,m)+"...",se=(s,m)=>{const o=h=>h.split("|").slice(1,-1).map(u=>ne(u.trim())),d=o(s[0]),l=s.slice(2).map(o);return e.jsx("div",{className:"overflow-x-auto my-2 max-w-full",children:e.jsxs("table",{className:"w-full text-xs border border-border rounded-md overflow-hidden table-fixed",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsx("tr",{children:d.map((h,u)=>e.jsx("th",{className:"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]",title:h,children:A(te(h,15))},u))})}),e.jsx("tbody",{children:l.map((h,u)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/30 transition-colors",children:h.map((b,f)=>e.jsx("td",{className:"px-2 py-2 truncate max-w-[100px]",title:b,children:A(te(b,18))},f))},u))})]})},m)},ae=s=>{const m=s.split(`
`),o=[];let d=0;for(;d<m.length;){const l=m[d];if(l.trim().startsWith("|")&&l.split("|").length>2){const h=[];for(;d<m.length&&m[d].trim().startsWith("|");)h.push(m[d]),d++;h.length>=2&&o.push(se(h,o.length));continue}if(l.startsWith("### "))o.push(e.jsx("h3",{className:"text-base font-semibold mt-3 mb-1",children:A(l.slice(4))},o.length));else if(l.startsWith("## "))o.push(e.jsx("h2",{className:"text-lg font-bold mt-4 mb-2",children:A(l.slice(3))},o.length));else if(l.startsWith("# "))o.push(e.jsx("h1",{className:"text-xl font-bold mt-4 mb-2",children:A(l.slice(2))},o.length));else if(l.includes("**")){const h=l.split(/\*\*(.*?)\*\*/g);o.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:h.map((u,b)=>b%2===1?e.jsx("strong",{className:"font-semibold",children:A(u)},b):A(u))},o.length))}else l.startsWith("- ")||l.startsWith("* ")?o.push(e.jsx("li",{className:"ml-4 mb-0.5 list-disc",children:A(l.slice(2))},o.length)):/^\d+\.\s/.test(l)?o.push(e.jsx("li",{className:"ml-4 mb-0.5 list-decimal",children:A(l.replace(/^\d+\.\s/,""))},o.length)):l.match(/^[-*_]{3,}$/)?o.push(e.jsx("hr",{className:"my-3 border-border"},o.length)):l.trim()===""?o.push(e.jsx("div",{className:"h-1"},o.length)):o.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:A(l)},o.length));d++}return o},x=()=>j.language==="zh"?"小熊AI助手":j.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant",$=()=>j.language==="zh"?"告诉小熊，你想吃什么...":j.language==="pt"?"Diga ao Xiaoxiong o que você quer comer...":"Tell Xiaoxiong what you want to eat...",B=()=>j.language==="zh"?"你好，我是小熊，我来帮你推荐餐厅；比如：「我附近的寿司餐厅」":j.language==="pt"?"Olá, eu sou o Xiaoxiong, vou te ajudar a encontrar restaurantes; por exemplo: 「restaurantes de sushi perto de mim」":`Hi, I'm Xiaoxiong, I'll help you find restaurants; for example: "sushi restaurants near me"`;return e.jsx(Oe,{open:a,onOpenChange:Y,children:e.jsxs(Fe,{className:"w-full h-full max-w-full max-h-full sm:max-w-lg sm:h-[70vh] sm:max-h-[70vh] sm:rounded-lg rounded-none flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(Pe,{className:"px-4 py-3 border-b shrink-0 bg-primary/5",children:e.jsxs(Be,{className:"flex items-center gap-2 text-base",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:D,alt:"Logo",className:"w-6 h-6 object-contain"})}),x()]})}),e.jsx(Ce,{className:"flex-1 h-0",ref:P,children:e.jsxs("div",{className:"p-4 space-y-4",children:[z.length===0&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(pe,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:"flex-1 bg-muted/50 rounded-2xl rounded-tl-sm px-4 py-3 text-sm",children:B()})]}),z.map(s=>e.jsxs("div",{className:q("flex gap-3",s.role==="user"&&"flex-row-reverse"),children:[e.jsx("div",{className:q("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s.role==="user"?"bg-primary text-primary-foreground":"bg-primary/10"),children:s.role==="user"?e.jsx(Ve,{className:"h-4 w-4"}):e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("div",{className:q("flex-1 max-w-[85%] rounded-2xl px-4 py-3 text-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted/50 rounded-tl-sm"),children:s.role==="assistant"?e.jsxs(e.Fragment,{children:[s.content?e.jsx("div",{className:"prose-sm",children:ae(s.content)}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ve,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:j.language==="zh"?"思考中...":j.language==="pt"?"Pensando...":"Thinking..."})]}),s.isStreaming&&s.content&&e.jsx("span",{className:"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle"})]}):s.content})]},s.id)),e.jsx("div",{ref:Z})]})}),e.jsx("div",{className:"p-3 border-t bg-background shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Te,{value:c,onChange:s=>I(s.target.value),onKeyDown:ee,placeholder:$(),disabled:C,className:"flex-1 rounded-full bg-muted/50 border-0 focus-visible:ring-1",autoFocus:!0}),e.jsx(Q,{onClick:re,disabled:!c.trim()||C,size:"icon",className:"shrink-0 rounded-full",children:C?e.jsx(ve,{className:"h-4 w-4 animate-spin"}):e.jsx(We,{className:"h-4 w-4"})})]})}),e.jsx(De,{open:G,onOpenChange:s=>{H(s),!s&&F&&(K(F),L(null))},onConfirm:ce})]})})},Se=({restaurant:a,language:n})=>{const[v,j]=r.useState(999),p=r.useRef(null),O=a.type.slice(0,3).map((c,I)=>({key:`type-${I}`,label:c,variant:"secondary",color:void 0}));r.useEffect(()=>{const c=()=>{if(!p.current)return;const z=p.current,g=Array.from(z.querySelectorAll(".tag-badge"));if(g.length===0){setTimeout(c,50);return}const C=g[0]?.offsetTop;let R=g.length;for(let k=0;k<g.length;k++)if(g[k].offsetTop>C){R=k;break}R<g.length&&(R=Math.max(1,R-1)),j(R)};j(999);const I=setTimeout(c,100);return window.addEventListener("resize",c),()=>{clearTimeout(I),window.removeEventListener("resize",c)}},[O.length,a.id]);const X=O.slice(0,v),D=O.length>v;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{ref:p,className:"flex gap-1.5 flex-wrap flex-1",children:X.map(c=>e.jsx(W,{variant:c.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:c.color?{backgroundColor:c.color,color:"white"}:void 0,children:c.label},c.key))}),D&&e.jsxs(ut,{children:[e.jsx(xt,{asChild:!0,children:e.jsx(Q,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:e.jsx(Je,{className:"h-4 w-4"})})}),e.jsx(ht,{className:"w-80",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(c=>e.jsx(W,{variant:c.variant,className:"text-xs font-medium",style:c.color?{backgroundColor:c.color,color:"white"}:void 0,children:c.label},c.key))})})]})]})},Ct=()=>{const a=$e(),{t:n,i18n:v}=fe(),{toast:j}=qe(),{localizeRestaurant:p}=yt(),[O,X]=r.useState(""),[D,c]=r.useState([]),[I,z]=r.useState(null),[g,C]=r.useState([]),[R,k]=r.useState(null),[S,G]=r.useState(null),[H,F]=r.useState(!1),[L,E]=r.useState(!1),[P,Z]=r.useState(!1),U=r.useRef(null),w=r.useRef(null),N=r.useRef({}),[J,_]=r.useState(null),[K,ce]=r.useState(!1),[re,ee]=r.useState(!1),[Y,oe]=r.useState(!1),[A,ne]=r.useState(!1),te=4,{data:se,isLoading:ae}=pt(O,D.length>0?D.join(","):void 0),{data:x=[]}=gt(),{data:$=[]}=jt(),{data:B={}}=ft(),s=$.filter(t=>(B[t.id]||0)>0),m=t=>{c(i=>i.includes(t)?i.filter(T=>T!==t):[...i,t])},o=()=>{ee(!0)},d=async()=>{ee(!1);try{const t=await nt();G({lat:t.coords.latitude,lng:t.coords.longitude}),j({title:n("restaurants.locationEnabled"),description:n("restaurants.sortByDistance")})}catch(t){console.error("Location error:",t)}},l=t=>{k(t),t&&!S&&o()},h=async t=>{if(I===t)z(null),C([]);else{z(t);const{data:i,error:T}=await Ke.from("activity_restaurants").select("restaurant_id").eq("activity_id",t);T?(console.error("Error fetching activity restaurants:",T),C([])):C(i.map(le=>le.restaurant_id))}},u=se?.map(t=>{const i=p(t);if(S){const T=ot(S.lat,S.lng,t.lat,t.lng);return{...i,distance:T}}return i})||[],b=I?u.filter(t=>g.includes(t.id)):u,f=R&&S?b.filter(t=>t.distance&&t.distance<=R).sort((t,i)=>(t.distance||0)-(i.distance||0)):S?b.sort((t,i)=>(t.distance||0)-(i.distance||0)):b.sort((t,i)=>(i.rating||0)-(t.rating||0)),V=t=>{a(`/restaurant/${t.id}`)},y=t=>{_(t.id);const i=N.current[t.id];i&&i.scrollIntoView({behavior:"smooth",block:"center"})},M=()=>{const t=document.getElementById("home-map-container");if(t)if(H)document.exitFullscreen&&document.exitFullscreen();else{if(U.current){const i=U.current.getCenter(),T=U.current.getZoom();w.current={center:[i.lng,i.lat],zoom:T}}t.requestFullscreen&&t.requestFullscreen()}};return r.useEffect(()=>{const t=()=>{const i=!!document.fullscreenElement;F(i),!i&&w.current&&U.current&&setTimeout(()=>{U.current?.jumpTo({center:w.current.center,zoom:w.current.zoom})},100)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-2 sm:mb-3",children:n("nav.mapView")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-xl mx-auto px-4",children:n("map.subtitle")})]}),e.jsxs("div",{className:"mb-6 space-y-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(Te,{placeholder:n("restaurants.search"),value:O,onChange:t=>X(t.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),e.jsxs("div",{className:"flex gap-2 md:contents",children:[e.jsxs(Q,{variant:S?"default":"outline",onClick:S?void 0:o,className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(de,{className:`w-4 h-4 ${S?"animate-pulse":""}`}),e.jsx("span",{className:"md:hidden",children:n("restaurants.getLocationMobile")}),e.jsx("span",{className:"hidden md:inline",children:n(S?"restaurants.locationEnabled":"restaurants.getLocation")})]}),e.jsxs(Q,{variant:K?"default":"outline",onClick:()=>ce(!K),className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(Xe,{className:"w-4 h-4"}),n("restaurants.filter")]})]})]}),K&&e.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[n("restaurants.restaurantTypes"),":"]}),D.length>0&&e.jsx(W,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>c([]),children:n("common.actions.clearFilter")}),x.length>8&&e.jsx(Q,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>E(!L),children:n(L?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${L?"animate-expand-height":""}`,children:(L?x:x.slice(0,8)).map((t,i)=>e.jsx(W,{variant:D.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${D.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${i*30}ms`},onClick:()=>m(t),children:t},t))}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:x.map((t,i)=>e.jsx(W,{variant:D.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${D.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${i*30}ms`},onClick:()=>m(t),children:t},t))}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),s.length>0&&e.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[n("nav.activities"),":"]}),I&&e.jsx(W,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{z(null),C([])},children:n("common.actions.clearFilter")}),s.length>8&&e.jsx(Q,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>Z(!P),children:n(P?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${P?"animate-expand-height":""}`,children:(P?s:s.slice(0,8)).map((t,i)=>{const T=v.language==="zh"?t.badge_text_zh||t.title_zh:v.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(W,{variant:I===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${I===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${i*30}ms`},onClick:()=>h(t.id),children:T},t.id)})}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:s.map((t,i)=>{const T=v.language==="zh"?t.badge_text_zh||t.title_zh:v.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(W,{variant:I===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${I===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${i*30}ms`},onClick:()=>h(t.id),children:T},t.id)})}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),S&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[n("restaurants.radius"),":"]}),e.jsx(W,{variant:R===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>l(null),children:n("restaurants.allRestaurants")}),e.jsx(W,{variant:R===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>l(5),children:n("restaurants.radius5km")}),e.jsx(W,{variant:R===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>l(10),children:n("restaurants.radius10km")}),e.jsx(W,{variant:R===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>l(20),children:n("restaurants.radius20km")})]})]}),!ae&&f&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:`w-full lg:flex-1 transition-all duration-300 ease-in-out ${Y?"h-0 overflow-hidden lg:h-[500px]":"h-[400px] lg:h-[500px]"}`,children:e.jsxs("div",{id:"home-map-container",className:`${H?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[e.jsx(Q,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:M,children:H?e.jsx(He,{className:"w-5 h-5"}):e.jsx(Ue,{className:"w-5 h-5"})}),e.jsxs("div",{className:"h-full relative",children:[e.jsx(bt,{restaurants:f,onRestaurantClick:V,userLocation:S,radiusFilter:R,onMarkerClick:y,showViewDetailsButton:!0,onMapInit:t=>{U.current=t}}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg",children:[e.jsx("img",{src:vt,alt:"Xiaoxiong Market Logo",className:"h-6 w-6 object-contain"}),e.jsx("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:v.language==="zh"?"小熊市场":"Xiaoxiong Market"})]})]})]})}),e.jsx(Q,{variant:"outline",size:"sm",className:"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1",onClick:()=>oe(!Y),children:Y?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4"}),n("map.showMap")]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4"}),n("map.hideMap")]})}),e.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-border",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(me,{className:"w-6 h-6 text-primary"}),n("restaurants.title"),e.jsx(W,{variant:"secondary",className:"ml-2",children:f.length})]}),S&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[e.jsx(de,{className:"w-4 h-4"}),n("restaurants.sortedByDistance")]})]}),f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(me,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:n("restaurants.noResults")}),e.jsx("p",{className:"text-muted-foreground max-w-xs",children:n("restaurants.noResultsDesc")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden space-y-3 pb-4",children:[(A?f:f.slice(0,te)).map(t=>e.jsx(we,{ref:i=>N.current[t.id]=i,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${J===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>V(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(de,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(Ne,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Se,{restaurant:t,language:v.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(me,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id)),f.length>te&&e.jsx(Q,{variant:"outline",className:"w-full mt-2 gap-2",onClick:()=>ne(!A),children:A?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4"}),n("map.collapseList")]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4"}),n("map.showAllRestaurants",{count:f.length})]})})]}),e.jsx(Ce,{className:"hidden lg:block h-[420px] pr-4",children:e.jsx("div",{className:"space-y-3 pb-4",children:f.map(t=>e.jsx(we,{ref:i=>N.current[t.id]=i,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${J===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>V(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(de,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(Ne,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Se,{restaurant:t,language:v.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(me,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id))})})]})]})]}),e.jsx(De,{open:re,onOpenChange:ee,onConfirm:d})]})},ge="/images/sushi-ramen-hero.jpg",ze="/images/sushi-ramen-mobile.jpg",Le=r.memo(({stats:a,t:n})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:n("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:a.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:n("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:a.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:n("home.hero.brandName")}),e.jsx("img",{src:lt,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));Le.displayName="StatsDisplay";const Tt=()=>{const a=window.innerWidth<640,n=window.innerWidth>=1024,v=navigator.connection,j=Re(),p=Ie();return n?!!v?.saveData:!!(p&&!j||v&&(v.saveData||v.effectiveType==="2g"||v.effectiveType==="slow-2g")||a&&navigator.deviceMemory&&navigator.deviceMemory<2)},Ae=r.memo(({template:a,isActive:n,currentLang:v,t:j,onContentReady:p,onAskXiaoxiong:O})=>{const[X,D]=r.useState({}),[c,I]=r.useState({}),[z,g]=r.useState({}),[C,R]=r.useState({mobile:!0,tablet:!0,desktop:!0}),[k,S]=r.useState(!1),G=Tt(),H=r.useRef(null),F=r.useRef(null),L=r.useRef(null),E=x=>a[`${x}${v==="zh"?"_zh":v==="pt"?"_pt":"_en"}`]||"",P=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",Z=()=>{const x=P();return x==="mobile"&&a.mobile_overlay_opacity!==null?a.mobile_overlay_opacity:x==="tablet"&&a.tablet_overlay_opacity!==null?a.tablet_overlay_opacity:x==="desktop"&&a.desktop_overlay_opacity!==null?a.desktop_overlay_opacity:a.overlay_opacity??30},U=()=>{const x=Z(),$=a.overlay_gradient_direction||"to-b",B=(y,M)=>y==null?M/100:y>1?y/100:y,s=x>1?x/100:x,m=B(a.overlay_gradient_from_opacity,30)*s,o=B(a.overlay_gradient_via_opacity,25)*s,d=B(a.overlay_gradient_to_opacity,40)*s,h={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[$]||"to bottom",u={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},b=u[a.overlay_gradient_from||"black"]||"0, 0, 0",f=u[a.overlay_gradient_via||"black"]||"0, 0, 0",V=u[a.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${h}, rgba(${b}, ${m}), rgba(${f}, ${o}), rgba(${V}, ${d}))`}},w=a.mobile_image_url||ze,N=a.tablet_image_url||a.desktop_image_url||ge,J=a.desktop_image_url||ge,_=a.background_blur||0,K=a.desktop_media_type||a.media_type||"image",ce=a.tablet_media_type||a.media_type||"image",re=a.mobile_media_type||a.media_type||"image",ee=K==="video"&&!G,Y=ce==="video"&&!G,oe=re==="video"&&!G,A=oe?a.mobile_video_url:null,ne=Y?a.tablet_video_url||a.desktop_video_url:null,te=ee?a.desktop_video_url:null;r.useEffect(()=>{const x=P(),$=x==="mobile"?w:x==="tablet"?N:J;if($){const B=new Image;B.onload=()=>{D(s=>({...s,[x]:!0})),R(s=>({...s,[x]:!0})),n&&(p?.(),setTimeout(()=>S(!0),100))},B.src=$}},[w,N,J,n,p]),r.useEffect(()=>{n&&X[P()]&&S(!0)},[n,X]);const se=x=>{I($=>({...$,[x]:!0}))},ae=(x,$)=>{console.error(`[HeroSlide] Video error on ${x}:`,$),g(B=>({...B,[x]:!0}))};return r.useEffect(()=>{if(!k||!n||!at())return;const $=P(),s=($==="mobile"?H:$==="tablet"?F:L).current;if(!s)return;const o=setTimeout(async()=>{try{s.muted=!0,s.playsInline=!0,s.setAttribute("webkit-playsinline","true"),await s.play(),console.log(`[HeroSlide] iOS video play successful on ${$}`)}catch(d){console.error(`[HeroSlide] iOS video play failed on ${$}:`,d),g(l=>({...l,[$]:!0}))}},150);return()=>clearTimeout(o)},[k,n]),e.jsxs("div",{className:q("absolute inset-0 w-full h-full transition-opacity duration-1000",n?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!C.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),oe&&A?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:w,alt:"Background",className:q("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",c.mobile&&!z.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:_>0?`blur(${_}px)`:void 0}}),k&&!z.mobile&&e.jsx("video",{ref:H,src:A,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>se("mobile"),onError:x=>ae("mobile",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:_>0?`blur(${_}px)`:void 0}})]}):e.jsx("img",{src:w,alt:"Background",className:q("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",C.mobile?"opacity-100":"opacity-0"),style:{filter:_>0?`blur(${_}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!C.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),Y&&ne?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:N,alt:"Background",className:q("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",c.tablet&&!z.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:_>0?`blur(${_}px)`:void 0}}),k&&!z.tablet&&e.jsx("video",{ref:F,src:ne,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>se("tablet"),onError:x=>ae("tablet",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:_>0?`blur(${_}px)`:void 0}})]}):e.jsx("img",{src:N,alt:"Background",className:q("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",C.tablet?"opacity-100":"opacity-0"),style:{filter:_>0?`blur(${_}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!C.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),ee&&te?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:J,alt:"Background",className:q("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",c.desktop&&!z.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:_>0?`blur(${_}px)`:void 0}}),k&&!z.desktop&&e.jsx("video",{ref:L,src:te,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>se("desktop"),onError:x=>ae("desktop",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:_>0?`blur(${_}px)`:void 0}})]}):e.jsx("img",{src:J,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:q("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",C.desktop?"opacity-100":"opacity-0"),style:{filter:_>0?`blur(${_}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:U()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:E("title")||j("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:E("description")||j("home.hero.description")}),a.subtitle_button_text_zh&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:O,className:"group flex items-center gap-3 bg-white/95 backdrop-blur-sm text-muted-foreground px-4 sm:px-6 py-3 sm:py-4 rounded-full shadow-lg hover:shadow-2xl hover:bg-white transition-all duration-300 cursor-text border border-border/20",children:[e.jsx(pe,{className:"w-5 h-5 text-primary/70 group-hover:text-primary transition-colors"}),e.jsx("span",{className:"text-sm sm:text-base text-muted-foreground/80 group-hover:text-muted-foreground transition-colors",children:E("subtitle_button_text")||j("home.hero.subtitle")}),e.jsx(Ye,{className:"w-4 h-4 text-muted-foreground/50 ml-2"})]})})]})})]})});Ae.displayName="HeroSlide";const Jt=()=>{const{t:a,i18n:n}=fe(),v=mt(),{settings:j}=_e(),{data:p,isLoading:O,refetch:X}=it(),[D,c]=r.useState(0),[I,z]=r.useState(null),g=r.useRef(null),[C,R]=r.useState(!1),[k,S]=r.useState(!1),G=j?.ai_assistant_enabled!==!1,H=j?.ai_provider||"ask-xiaoxiong",F=r.useCallback(()=>{R(!0)},[]);ct({pageType:"home"});const L=r.useCallback(async()=>{try{const N=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();N&&z({order_count:N.order_count||0,reserve_count:N.reserve_count||0})}catch(w){console.error("Failed to fetch stats:",w)}},[]);r.useEffect(()=>{L()},[L]);const E=r.useCallback(async()=>{await Promise.all([X(),L(),v.invalidateQueries({queryKey:["restaurants"]}),v.invalidateQueries({queryKey:["activities"]})])},[X,L,v]);r.useEffect(()=>{if(!p||p.length<=1)return;const N=p[D]?.duration||5e3;return g.current=setTimeout(()=>{c(J=>(J+1)%p.length)},N),()=>{g.current&&clearTimeout(g.current)}},[p,D]);const P=r.useCallback(w=>{g.current&&clearTimeout(g.current),c(w)},[]);r.useCallback(()=>{p&&(g.current&&clearTimeout(g.current),c(w=>(w-1+p.length)%p.length))},[p]),r.useCallback(()=>{p&&(g.current&&clearTimeout(g.current),c(w=>(w+1)%p.length))},[p]);const Z=n.language,U=p&&p.length>1;return e.jsx(dt,{onRefresh:E,children:e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[I&&e.jsx(Le,{stats:I,t:a}),e.jsx("div",{className:q("absolute inset-0 w-full h-full transition-opacity duration-500",C?"opacity-100":"opacity-0"),children:p?.map((w,N)=>e.jsx(Ae,{template:w,isActive:N===D,currentLang:Z,t:a,onContentReady:N===0?F:void 0,onAskXiaoxiong:()=>S(!0)},w.id))}),e.jsx("div",{className:q("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",O||!C?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(Ze,{})}),!O&&(!p||p.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:ze,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:ge,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:a("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:a("home.hero.description")})]})})]}),U&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:p.map((w,N)=>e.jsx("button",{onClick:()=>P(N),className:q("w-3 h-3 rounded-full transition-all duration-300",N===D?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${N+1}`},N))})]}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx(Ct,{})})}),!Ie()&&!Re()&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 bg-gradient-to-br from-primary/5 via-background to-primary/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-72 h-72 bg-primary/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 right-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:a("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:a("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Nt,alt:"Download on the App Store",className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:wt,alt:"Get it on Google Play",className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(tt,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:a("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:a("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:a("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Q,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(rt,{to:"/join-us",children:[e.jsx(st,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),a("home.cta.button")]})})})]})]}),G&&e.jsx(_t,{open:k,onOpenChange:S,provider:H})]})})};export{Jt as default};
//# sourceMappingURL=Home-Dwpzk7rA.js.map
