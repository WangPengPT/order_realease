{"version":3,"file":"AIRecipe-Dk_SNEmT.js","sources":["../../src/components/ai-recipe/IngredientPhotoStep.tsx","../../src/components/ai-recipe/IngredientConfirmStep.tsx","../../src/components/ai-recipe/PreferencesStep.tsx","../../src/components/ai-recipe/RecipeSelectStep.tsx","../../src/components/ai-recipe/MealDetailView.tsx","../../src/components/ai-recipe/AIRecipeCookingView.tsx","../../src/components/ai-recipe/MealCookingView.tsx","../../src/components/ai-recipe/AIRecipeSharePrompt.tsx","../../src/pages/AIRecipe.tsx"],"sourcesContent":["import { useState, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Camera, Loader2, ImageIcon, PenLine, X, Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport CameraCapture from \"./CameraCapture\";\r\n\r\nconst MAX_PHOTOS = 5;\r\n\r\ninterface IngredientPhotoStepProps {\r\n  onPhotosUploaded: (imageUrls: string[]) => void;\r\n  onSkipToManual: () => void;\r\n  uploadImage: (file: File, folder: string) => Promise<string | null>;\r\n  isUploading?: boolean;\r\n  initialImageUrls?: string[];\r\n  onRequireLogin?: () => boolean;\r\n}\r\n\r\ninterface PhotoItem {\r\n  id: string;\r\n  preview: string;\r\n  url: string | null;\r\n  uploading: boolean;\r\n}\r\n\r\nconst IngredientPhotoStep = ({ onPhotosUploaded, onSkipToManual, uploadImage, isUploading, initialImageUrls, onRequireLogin }: IngredientPhotoStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [photos, setPhotos] = useState<PhotoItem[]>(() => {\r\n    if (initialImageUrls && initialImageUrls.length > 0) {\r\n      return initialImageUrls.map((url, i) => ({\r\n        id: `restored-${i}`,\r\n        preview: url,\r\n        url,\r\n        uploading: false,\r\n      }));\r\n    }\r\n    return [];\r\n  });\r\n  const [showCamera, setShowCamera] = useState(false);\r\n  const fileRef = useRef<HTMLInputElement>(null);\r\n\r\n  const uploadingCount = photos.filter(p => p.uploading).length;\r\n  const allUploaded = photos.length > 0 && photos.every(p => p.url !== null);\r\n\r\n  const handleFiles = async (files: FileList | File[]) => {\r\n    if (onRequireLogin && !onRequireLogin()) return;\r\n\r\n    const fileArray = Array.from(files);\r\n    const remaining = MAX_PHOTOS - photos.length;\r\n    const toAdd = fileArray.slice(0, remaining).filter(f => f.size <= 10 * 1024 * 1024);\r\n\r\n    if (toAdd.length === 0) return;\r\n\r\n    const newItems: PhotoItem[] = toAdd.map(f => ({\r\n      id: `${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      preview: URL.createObjectURL(f),\r\n      url: null,\r\n      uploading: true,\r\n    }));\r\n\r\n    setPhotos(prev => [...prev, ...newItems]);\r\n\r\n    await Promise.all(\r\n      toAdd.map(async (file, i) => {\r\n        const url = await uploadImage(file, \"ai-recipe-ingredients\");\r\n        if (url) {\r\n          setPhotos(prev =>\r\n            prev.map(p => p.id === newItems[i].id ? { ...p, url, uploading: false } : p)\r\n          );\r\n        } else {\r\n          setPhotos(prev => prev.filter(p => p.id !== newItems[i].id));\r\n        }\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleCameraCapture = (file: File) => {\r\n    setShowCamera(false);\r\n    handleFiles([file]);\r\n  };\r\n\r\n  const handleOpenCamera = () => {\r\n    if (onRequireLogin && !onRequireLogin()) return;\r\n    setShowCamera(true);\r\n  };\r\n\r\n  const removePhoto = (id: string) => {\r\n    setPhotos(prev => prev.filter(p => p.id !== id));\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    if (onRequireLogin && !onRequireLogin()) return;\r\n    const urls = photos.map(p => p.url).filter(Boolean) as string[];\r\n    if (urls.length > 0) {\r\n      onPhotosUploaded(urls);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {showCamera && (\r\n        <CameraCapture\r\n          onCapture={handleCameraCapture}\r\n          onClose={() => setShowCamera(false)}\r\n        />\r\n      )}\r\n\r\n      <div className=\"flex flex-col items-center justify-center gap-6 py-8\">\r\n        <div className=\"text-center space-y-2\">\r\n          <div className=\"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\r\n            <Camera className=\"h-10 w-10 text-primary\" />\r\n          </div>\r\n          <h3 className=\"text-lg font-semibold\">\r\n            {t(\"aiRecipe.photoTitle\", \"拍摄您的食材\")}\r\n          </h3>\r\n          <p className=\"text-sm text-muted-foreground max-w-xs\">\r\n            {t(\"aiRecipe.photoDescMulti\", \"拍照或上传食材照片（最多5张），AI 将自动识别食材\")}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Photo grid */}\r\n        {photos.length > 0 && (\r\n          <div className=\"w-full max-w-sm grid grid-cols-3 gap-2\">\r\n            {photos.map((photo) => (\r\n              <div key={photo.id} className=\"relative aspect-square rounded-lg overflow-hidden border bg-muted\">\r\n                <img src={photo.preview} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                {photo.uploading && (\r\n                  <div className=\"absolute inset-0 bg-background/60 flex items-center justify-center\">\r\n                    <Loader2 className=\"h-5 w-5 animate-spin text-primary\" />\r\n                  </div>\r\n                )}\r\n                <button\r\n                  onClick={() => removePhoto(photo.id)}\r\n                  className=\"absolute top-1 right-1 w-5 h-5 rounded-full bg-black/60 text-white flex items-center justify-center\"\r\n                >\r\n                  <X className=\"h-3 w-3\" />\r\n                </button>\r\n              </div>\r\n            ))}\r\n            {photos.length < MAX_PHOTOS && (\r\n              <button\r\n                onClick={() => fileRef.current?.click()}\r\n                className=\"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1 text-muted-foreground hover:border-primary/50 hover:text-primary transition-colors\"\r\n                disabled={uploadingCount > 0}\r\n              >\r\n                <Plus className=\"h-5 w-5\" />\r\n                <span className=\"text-xs\">{photos.length}/{MAX_PHOTOS}</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Action buttons */}\r\n        {photos.length === 0 ? (\r\n          <div className=\"flex gap-3 w-full max-w-sm\">\r\n            <Button\r\n              variant=\"default\"\r\n              className=\"flex-1 gap-2\"\r\n              onClick={handleOpenCamera}\r\n            >\r\n              <Camera className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.takePhoto\", \"拍照\")}\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"flex-1 gap-2\"\r\n              onClick={() => fileRef.current?.click()}\r\n            >\r\n              <ImageIcon className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.uploadPhoto\", \"相册\")}\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex gap-3 w-full max-w-sm\">\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"flex-1 gap-2\"\r\n              onClick={handleOpenCamera}\r\n              disabled={photos.length >= MAX_PHOTOS || uploadingCount > 0}\r\n            >\r\n              <Camera className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.addMore\", \"继续拍照\")}\r\n            </Button>\r\n            <Button\r\n              className=\"flex-1 gap-2\"\r\n              onClick={handleSubmit}\r\n              disabled={!allUploaded || uploadingCount > 0}\r\n            >\r\n              {uploadingCount > 0 ? (\r\n                <>\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                  {t(\"common.uploading\", \"上传中...\")}\r\n                </>\r\n              ) : (\r\n                t(\"aiRecipe.startIdentify\", \"开始识别\")\r\n              )}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Skip to manual input */}\r\n        <Button\r\n          variant=\"ghost\"\r\n          className=\"gap-2 text-muted-foreground\"\r\n          onClick={onSkipToManual}\r\n          disabled={uploadingCount > 0}\r\n        >\r\n          <PenLine className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.skipToManual\", \"跳过，手动输入食材\")}\r\n        </Button>\r\n\r\n        <input\r\n          ref={fileRef}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          multiple\r\n          className=\"hidden\"\r\n          onChange={(e) => {\r\n            const files = e.target.files;\r\n            if (files?.length) handleFiles(files);\r\n            e.target.value = \"\";\r\n          }}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default IngredientPhotoStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus, Trash2, Edit2, Check, X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { IdentifiedIngredient } from \"@/hooks/useAIRecipe\";\r\n\r\ninterface IngredientConfirmStepProps {\r\n  ingredients: IdentifiedIngredient[];\r\n  onChange: (ingredients: IdentifiedIngredient[]) => void;\r\n}\r\n\r\nconst IngredientConfirmStep = ({ ingredients, onChange }: IngredientConfirmStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [editIndex, setEditIndex] = useState<number | null>(null);\r\n  const [editName, setEditName] = useState(\"\");\r\n  const [editAmount, setEditAmount] = useState(\"\");\r\n  const [editUnit, setEditUnit] = useState(\"\");\r\n  const [newName, setNewName] = useState(\"\");\r\n\r\n  const handleEdit = (index: number) => {\r\n    setEditIndex(index);\r\n    setEditName(ingredients[index].name);\r\n    setEditAmount(ingredients[index].estimated_amount || \"\");\r\n    setEditUnit(ingredients[index].unit || \"\");\r\n  };\r\n\r\n  const handleSaveEdit = () => {\r\n    if (editIndex === null || !editName.trim()) return;\r\n    const updated = [...ingredients];\r\n    updated[editIndex] = { ...updated[editIndex], name: editName.trim(), estimated_amount: editAmount.trim(), unit: editUnit.trim() };\r\n    onChange(updated);\r\n    setEditIndex(null);\r\n  };\r\n\r\n  const handleDelete = (index: number) => {\r\n    onChange(ingredients.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleAdd = () => {\r\n    if (!newName.trim()) return;\r\n    // Split by Chinese or English comma, or spaces, filter empty\r\n    const parts = newName.split(/[，,\\s]+/).map(s => s.trim()).filter(Boolean);\r\n    if (parts.length === 0) return;\r\n    onChange([...ingredients, ...parts.map(name => ({ name, estimated_amount: \"\", unit: \"\" }))]);\r\n    setNewName(\"\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-center space-y-1 mb-4\">\r\n        <h3 className=\"text-lg font-semibold\">\r\n          {t(\"aiRecipe.confirmIngredients\", \"确认食材\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {t(\"aiRecipe.confirmIngredientsDesc\", \"确认 AI 识别的食材，您可以添加、编辑或删除\")}\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        {ingredients.map((item, index) => (\r\n          <div\r\n            key={index}\r\n            className=\"flex items-center gap-2 p-3 rounded-lg border bg-card\"\r\n          >\r\n            {editIndex === index ? (\r\n              <>\r\n                <Input\r\n                  value={editName}\r\n                  onChange={(e) => setEditName(e.target.value)}\r\n                  placeholder={t(\"aiRecipe.ingredientName\", \"食材名称\")}\r\n                  className=\"flex-1 h-8\"\r\n                  autoFocus\r\n                />\r\n                <Input\r\n                  value={editAmount}\r\n                  onChange={(e) => setEditAmount(e.target.value)}\r\n                  placeholder={t(\"aiRecipe.amount\", \"数量\")}\r\n                  className=\"w-16 h-8\"\r\n                />\r\n                <Input\r\n                  value={editUnit}\r\n                  onChange={(e) => setEditUnit(e.target.value)}\r\n                  placeholder={t(\"aiRecipe.unit\", \"单位\")}\r\n                  className=\"w-14 h-8\"\r\n                />\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" onClick={handleSaveEdit}>\r\n                  <Check className=\"h-4 w-4\" />\r\n                </Button>\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" onClick={() => setEditIndex(null)}>\r\n                  <X className=\"h-4 w-4\" />\r\n                </Button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <span className=\"flex-1 text-sm font-medium\">{item.name}</span>\r\n                {item.estimated_amount && (\r\n                  <Badge variant=\"outline\" className=\"text-xs\">\r\n                    {item.estimated_amount}{item.unit || \"\"}\r\n                  </Badge>\r\n                )}\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" onClick={() => handleEdit(index)}>\r\n                  <Edit2 className=\"h-3.5 w-3.5\" />\r\n                </Button>\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 text-destructive\" onClick={() => handleDelete(index)}>\r\n                  <Trash2 className=\"h-3.5 w-3.5\" />\r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Add new ingredient */}\r\n      <div className=\"flex gap-2\">\r\n        <Input\r\n          value={newName}\r\n          onChange={(e) => setNewName(e.target.value)}\r\n          placeholder={t(\"aiRecipe.addIngredientPlaceholder\", \"添加食材...\")}\r\n          className=\"flex-1\"\r\n          onKeyDown={(e) => e.key === \"Enter\" && handleAdd()}\r\n        />\r\n        <Button onClick={handleAdd} disabled={!newName.trim()} size=\"icon\">\r\n          <Plus className=\"h-4 w-4\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default IngredientConfirmStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChefHat, Users, UtensilsCrossed, MessageSquare } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\n\r\nexport interface RecipePreferences {\r\n  difficulty?: \"easy\" | \"medium\" | \"hard\";\r\n  servings?: number;\r\n  dishCount?: number;\r\n  notes?: string;\r\n}\r\n\r\ninterface PreferencesStepProps {\r\n  onConfirm: (prefs: RecipePreferences) => void;\r\n  onSkip: () => void;\r\n  initialValues?: RecipePreferences;\r\n}\r\n\r\nconst SERVINGS_OPTIONS = [1, 2, 3, 4, 6];\r\nconst DISH_COUNT_OPTIONS = [1, 2, 3, 4, 5, 6];\r\n\r\nconst PreferencesStep = ({ onConfirm, onSkip, initialValues }: PreferencesStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [difficulty, setDifficulty] = useState<\"easy\" | \"medium\" | \"hard\" | undefined>(initialValues?.difficulty);\r\n  const [servings, setServings] = useState<number | undefined>(initialValues?.servings ?? 2);\r\n  const [dishCount, setDishCount] = useState<number | undefined>(initialValues?.dishCount);\r\n  const [notes, setNotes] = useState(initialValues?.notes || \"\");\r\n  const isCustom = initialValues?.servings != null && !SERVINGS_OPTIONS.includes(initialValues.servings);\r\n  const [showCustom, setShowCustom] = useState(isCustom);\r\n  const [customServings, setCustomServings] = useState(isCustom ? String(initialValues?.servings) : \"\");\r\n\r\n  const difficulties = [\r\n    { value: \"easy\" as const, label: t(\"recipe.difficulty.easy\", \"简单\"), desc: t(\"aiRecipe.diffEasyDesc\", \"适合零基础新手\") },\r\n    { value: \"medium\" as const, label: t(\"recipe.difficulty.medium\", \"中等\"), desc: t(\"aiRecipe.diffMediumDesc\", \"有一点烹饪经验\") },\r\n    { value: \"hard\" as const, label: t(\"recipe.difficulty.hard\", \"困难\"), desc: t(\"aiRecipe.diffHardDesc\", \"挑战高难度菜肴\") },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"text-center space-y-1\">\r\n        <h3 className=\"text-lg font-semibold\">\r\n          {t(\"aiRecipe.preferences\", \"烹饪偏好\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {t(\"aiRecipe.preferencesDesc\", \"设置您的偏好，AI 会据此推荐更合适的菜谱\")}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Difficulty */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <ChefHat className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.preferredDifficulty\", \"期望难度\")}\r\n        </div>\r\n        <div className=\"grid grid-cols-3 gap-2\">\r\n          {difficulties.map((d) => (\r\n            <button\r\n              key={d.value}\r\n              onClick={() => setDifficulty(difficulty === d.value ? undefined : d.value)}\r\n              className={`p-3 rounded-lg border text-center transition-all ${\r\n                difficulty === d.value\r\n                  ? \"border-primary bg-primary/10 ring-1 ring-primary\"\r\n                  : \"hover:border-primary/50\"\r\n              }`}\r\n            >\r\n              <div className=\"text-sm font-medium\">{d.label}</div>\r\n              <div className=\"text-xs text-muted-foreground mt-0.5\">{d.desc}</div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Servings */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <Users className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.preferredServings\", \"用餐人数\")}\r\n        </div>\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          {SERVINGS_OPTIONS.map((s) => (\r\n            <Badge\r\n              key={s}\r\n              variant={servings === s && !showCustom ? \"default\" : \"outline\"}\r\n              className=\"cursor-pointer px-4 py-2 text-sm\"\r\n              onClick={() => { setServings(s); setShowCustom(false); setCustomServings(\"\"); }}\r\n            >\r\n              {s} {t(\"recipe.servingsUnit\", \"人份\")}\r\n            </Badge>\r\n          ))}\r\n          <Badge\r\n            variant={showCustom ? \"default\" : \"outline\"}\r\n            className=\"cursor-pointer px-4 py-2 text-sm\"\r\n            onClick={() => { setShowCustom(true); setServings(undefined); }}\r\n          >\r\n            {t(\"aiRecipe.customServings\", \"自定义\")}\r\n          </Badge>\r\n        </div>\r\n        {showCustom && (\r\n          <div className=\"flex items-center gap-2 mt-2\">\r\n            <Input\r\n              type=\"number\"\r\n              min={1}\r\n              max={99}\r\n              placeholder={t(\"aiRecipe.enterServings\", \"输入人数\")}\r\n              value={customServings}\r\n              onChange={(e) => {\r\n                setCustomServings(e.target.value);\r\n                const n = parseInt(e.target.value);\r\n                setServings(n > 0 ? n : undefined);\r\n              }}\r\n              className=\"w-28\"\r\n            />\r\n            <span className=\"text-sm text-muted-foreground\">{t(\"recipe.servingsUnit\", \"人份\")}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Dish Count */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <UtensilsCrossed className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.dishCount\", \"菜品数量\")}\r\n        </div>\r\n        <p className=\"text-xs text-muted-foreground\">\r\n          {t(\"aiRecipe.dishCountDesc\", \"不指定时 AI 会根据人数和食材自动判断\")}\r\n        </p>\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          <Badge\r\n            variant={dishCount === undefined ? \"default\" : \"outline\"}\r\n            className=\"cursor-pointer px-4 py-2 text-sm\"\r\n            onClick={() => setDishCount(undefined)}\r\n          >\r\n            {t(\"aiRecipe.autoDecide\", \"自动\")}\r\n          </Badge>\r\n          {DISH_COUNT_OPTIONS.map((c) => (\r\n            <Badge\r\n              key={c}\r\n              variant={dishCount === c ? \"default\" : \"outline\"}\r\n              className=\"cursor-pointer px-4 py-2 text-sm\"\r\n              onClick={() => setDishCount(c)}\r\n            >\r\n              {c} {t(\"aiRecipe.dishUnit\", \"道菜\")}\r\n            </Badge>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Notes */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <MessageSquare className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.cookingNotes\", \"备注\")}\r\n        </div>\r\n        <Textarea\r\n          value={notes}\r\n          onChange={(e) => setNotes(e.target.value)}\r\n          placeholder={t(\"aiRecipe.cookingNotesPlaceholder\", \"如：不要太辣、想做一桌年夜饭、偏清淡口味等...\")}\r\n          rows={3}\r\n          className=\"resize-none\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex gap-3 pt-2\">\r\n        <Button className=\"flex-1\" onClick={() => onConfirm({ difficulty, servings, dishCount, notes: notes.trim() || undefined })}>\r\n          {t(\"aiRecipe.confirmPreferences\", \"开始生成菜谱\")}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PreferencesStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Clock, Users, ChefHat, AlertTriangle, RefreshCw, Sparkles, Globe, Check, UtensilsCrossed, Info, Pencil, History, ChevronDown } from \"lucide-react\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { RecipePreferences } from \"@/components/ai-recipe/PreferencesStep\";\r\n\r\ninterface RecipeSelectStepProps {\r\n  recipes: AIRecipeSuggestion[];\r\n  recipeHistory?: AIRecipeSuggestion[][];\r\n  onSelectHistoryMeal?: (meal: AIRecipeSuggestion[]) => void;\r\n  onConfirmMeal: () => void;\r\n  onRegenerate?: (updatedNotes?: string) => void;\r\n  isRegenerating?: boolean;\r\n  preferences?: RecipePreferences;\r\n  isLoadingImages?: boolean;\r\n}\r\n\r\nconst RecipeSelectStep = ({ recipes, recipeHistory = [], onSelectHistoryMeal, onConfirmMeal, onRegenerate, isRegenerating, preferences, isLoadingImages }: RecipeSelectStepProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [editingNotes, setEditingNotes] = useState(false);\r\n  const [notesValue, setNotesValue] = useState(preferences?.notes || \"\");\r\n  const [showHistory, setShowHistory] = useState(false);\r\n\r\n  const getLocalizedName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const getLocalizedSubtitle = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.subtitle_en) return recipe.subtitle_en;\r\n    if (i18n.language === \"pt\" && recipe.subtitle_pt) return recipe.subtitle_pt;\r\n    return recipe.subtitle;\r\n  };\r\n\r\n  const difficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case \"medium\": return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case \"hard\": return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const totalCookTime = recipes.reduce((sum, r) => sum + (r.cook_time || 0), 0);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Meal Plan Header */}\r\n      <div className=\"text-center space-y-2 mb-4\">\r\n        <div className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-full\">\r\n          <UtensilsCrossed className=\"h-4 w-4 text-primary\" />\r\n          <span className=\"text-sm font-medium text-primary\">\r\n            {t(\"aiRecipe.mealPlan\", \"完整菜单\")}\r\n          </span>\r\n        </div>\r\n        <h3 className=\"text-lg font-semibold\">\r\n          {t(\"aiRecipe.mealPlanTitle\", \"AI 为您设计了一桌菜\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {t(\"aiRecipe.mealPlanDesc\", \"共 {{count}} 道菜，总计约 {{time}} 分钟\", { count: recipes.length, time: totalCookTime })}\r\n        </p>\r\n        {/* Dish count explanation */}\r\n        {preferences && (\r\n          <div className=\"inline-flex items-start gap-1.5 text-xs text-muted-foreground bg-muted/50 rounded-lg px-3 py-2 mt-1 text-left max-w-sm mx-auto\">\r\n            <Info className=\"h-3.5 w-3.5 mt-0.5 shrink-0\" />\r\n            <span>\r\n              {preferences.dishCount\r\n                ? t(\"aiRecipe.dishCountExplain\", \"按照您指定的 {{count}} 道菜生成\", { count: preferences.dishCount })\r\n                : preferences.notes\r\n                  ? t(\"aiRecipe.dishCountFromNotes\", \"根据您的备注「{{notes}}」，AI 为您规划了 {{count}} 道菜\", { notes: preferences.notes.length > 20 ? preferences.notes.slice(0, 20) + \"…\" : preferences.notes, count: recipes.length })\r\n                  : t(\"aiRecipe.dishCountAuto\", \"AI 根据 {{servings}} 人份的食材自动规划了 {{count}} 道菜\", { servings: preferences.servings || recipes[0]?.servings || \"?\", count: recipes.length })\r\n              }\r\n            </span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* All dishes in the meal */}\r\n      <div className=\"space-y-3\">\r\n        {recipes.map((recipe, index) => (\r\n          <Card key={index} className=\"overflow-hidden\">\r\n            {/* Image area: loading skeleton → actual image */}\r\n            {recipe.image_url ? (\r\n              <div className=\"relative w-full aspect-[16/9] bg-muted\">\r\n                <img\r\n                  src={recipe.image_url}\r\n                  alt={getLocalizedName(recipe)}\r\n                  className=\"w-full h-full object-cover\"\r\n                  loading=\"lazy\"\r\n                />\r\n                <Badge variant=\"secondary\" className=\"absolute top-2 left-2 text-xs font-bold\">\r\n                  {t(\"aiRecipe.dishNumber\", \"第 {{n}} 道\", { n: index + 1 })}\r\n                </Badge>\r\n                <Badge variant=\"secondary\" className=\"absolute bottom-2 right-2 text-[10px] gap-1 opacity-80\">\r\n                  {recipe.image_source === \"ai\" ? (\r\n                    <><Sparkles className=\"h-2.5 w-2.5\" />{t(\"aiRecipe.imageSourceAI\", \"AI 生成\")}</>\r\n                  ) : (\r\n                    <><Globe className=\"h-2.5 w-2.5\" />{t(\"aiRecipe.imageSourceWeb\", \"来自网络\")}</>\r\n                  )}\r\n                </Badge>\r\n              </div>\r\n            ) : (\r\n              <div className=\"relative w-full aspect-[16/9] overflow-hidden bg-muted\">\r\n                {isLoadingImages ? (\r\n                  <>\r\n                    <Skeleton className=\"absolute inset-0 w-full h-full rounded-none\" />\r\n                    <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-1.5 z-10\">\r\n                      <Sparkles className=\"h-5 w-5 text-primary animate-pulse\" />\r\n                      <span className=\"text-xs text-muted-foreground\">\r\n                        {t(\"aiRecipe.generatingImage\", \"AI 正在生成图片...\")}\r\n                      </span>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                    <Sparkles className=\"h-8 w-8 text-muted-foreground/30\" />\r\n                  </div>\r\n                )}\r\n                <Badge variant=\"secondary\" className=\"absolute top-2 left-2 text-xs font-bold z-20\">\r\n                  {t(\"aiRecipe.dishNumber\", \"第 {{n}} 道\", { n: index + 1 })}\r\n                </Badge>\r\n              </div>\r\n            )}\r\n            <CardHeader className=\"pb-2\">\r\n              <h4 className=\"font-semibold\">{getLocalizedName(recipe)}</h4>\r\n              {getLocalizedSubtitle(recipe) && (\r\n                <p className=\"text-xs text-muted-foreground italic\">{getLocalizedSubtitle(recipe)}</p>\r\n              )}\r\n            </CardHeader>\r\n            <CardContent className=\"pt-0\">\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                  <Clock className=\"h-3 w-3\" />\r\n                  {recipe.cook_time} {t(\"recipe.minutes\", \"分钟\")}\r\n                </Badge>\r\n                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                  <ChefHat className=\"h-3 w-3\" />\r\n                  {difficultyLabel(recipe.difficulty)}\r\n                </Badge>\r\n                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                  <Users className=\"h-3 w-3\" />\r\n                  {recipe.servings} {t(\"recipe.servingsUnit\", \"人份\")}\r\n                </Badge>\r\n              </div>\r\n\r\n              {recipe.missing_ingredients && recipe.missing_ingredients.length > 0 && (\r\n                <div className=\"mt-2 flex items-start gap-1.5 text-xs text-destructive\">\r\n                  <AlertTriangle className=\"h-3.5 w-3.5 mt-0.5 shrink-0\" />\r\n                  <span>\r\n                    {t(\"aiRecipe.missingIngredients\", \"需要额外食材：\")}\r\n                    {(() => {\r\n                      const lang = i18n.language;\r\n                      const list =\r\n                        lang === \"en\" ? (recipe as any).missing_ingredients_en || recipe.missing_ingredients :\r\n                        lang === \"pt\" ? (recipe as any).missing_ingredients_pt || recipe.missing_ingredients :\r\n                        recipe.missing_ingredients;\r\n                      return list.join(lang === \"zh\" ? \"、\" : \", \");\r\n                    })()}\r\n                  </span>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Editable notes */}\r\n      <div className=\"space-y-2\">\r\n        {editingNotes ? (\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-xs font-medium text-muted-foreground\">\r\n              {t(\"aiRecipe.editNotes\", \"编辑备注（修改后点击换一批即可重新生成）\")}\r\n            </label>\r\n            <Textarea\r\n              value={notesValue}\r\n              onChange={(e) => setNotesValue(e.target.value)}\r\n              placeholder={t(\"aiRecipe.notesPlaceholder\", \"例如：两菜一汤、清淡为主...\")}\r\n              className=\"min-h-[60px] text-sm\"\r\n            />\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setEditingNotes(false)}>\r\n              {t(\"common.done\", \"完成\")}\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <button\r\n            onClick={() => setEditingNotes(true)}\r\n            className=\"inline-flex items-center gap-1.5 text-xs text-muted-foreground hover:text-primary transition-colors\"\r\n          >\r\n            <Pencil className=\"h-3 w-3\" />\r\n            {notesValue\r\n              ? t(\"aiRecipe.currentNotes\", \"备注：{{notes}}\", { notes: notesValue.length > 30 ? notesValue.slice(0, 30) + \"…\" : notesValue })\r\n              : t(\"aiRecipe.addNotes\", \"添加备注（如：两菜一汤）\")}\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Action buttons */}\r\n      <div className=\"flex gap-3 pt-2 sticky bottom-4\">\r\n        {onRegenerate && (\r\n          <Button\r\n            variant=\"outline\"\r\n            className=\"flex-1 gap-1.5\"\r\n            onClick={() => onRegenerate(notesValue || undefined)}\r\n            disabled={isRegenerating}\r\n          >\r\n            <RefreshCw className={`h-4 w-4 ${isRegenerating ? \"animate-spin\" : \"\"}`} />\r\n            {isRegenerating\r\n              ? t(\"aiRecipe.regenerating\", \"重新生成中...\")\r\n              : t(\"aiRecipe.regenerateRecipes\", \"换一批\")}\r\n          </Button>\r\n        )}\r\n        <Button className=\"flex-1 gap-1.5\" onClick={onConfirmMeal}>\r\n          <Check className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.confirmMeal\", \"确认菜单\")}\r\n        </Button>\r\n      </div>\r\n\r\n      {/* History section */}\r\n      {recipeHistory.length > 0 && onSelectHistoryMeal && (\r\n        <div className=\"border rounded-xl overflow-hidden\">\r\n          <button\r\n            className=\"w-full flex items-center justify-between px-4 py-3 text-sm font-medium hover:bg-muted/50 transition-colors\"\r\n            onClick={() => setShowHistory(h => !h)}\r\n          >\r\n            <span className=\"flex items-center gap-2 text-muted-foreground\">\r\n              <History className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.historyMeals\", \"历史菜单\")}\r\n              <Badge variant=\"secondary\" className=\"text-xs\">{recipeHistory.length}</Badge>\r\n            </span>\r\n            <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${showHistory ? \"rotate-180\" : \"\"}`} />\r\n          </button>\r\n\r\n          {showHistory && (\r\n            <div className=\"divide-y\">\r\n              {recipeHistory.map((meal, hi) => (\r\n                <div key={hi} className=\"px-4 py-3 space-y-1.5\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-xs text-muted-foreground\">\r\n                      {t(\"aiRecipe.historyEntry\", \"第 {{n}} 次生成\", { n: recipeHistory.length - hi })}\r\n                    </span>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      className=\"h-7 text-xs gap-1 text-primary\"\r\n                      onClick={() => { onSelectHistoryMeal(meal); setShowHistory(false); }}\r\n                    >\r\n                      <Check className=\"h-3 w-3\" />\r\n                      {t(\"aiRecipe.useThisMeal\", \"选这桌\")}\r\n                    </Button>\r\n                  </div>\r\n                  <div className=\"flex flex-wrap gap-1.5\">\r\n                    {meal.map((dish, di) => (\r\n                      <span key={di} className=\"text-xs bg-muted rounded-full px-2.5 py-0.5\">\r\n                        {i18n.language === \"en\" && dish.recipe_name_en ? dish.recipe_name_en\r\n                          : i18n.language === \"pt\" && dish.recipe_name_pt ? dish.recipe_name_pt\r\n                          : dish.recipe_name}\r\n                      </span>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeSelectStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Clock, Users, ChefHat, ChevronDown, ChevronUp, Sparkles, Globe } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\n\r\ninterface MealDetailViewProps {\r\n  recipes: AIRecipeSuggestion[];\r\n}\r\n\r\nconst MealDetailView = ({ recipes }: MealDetailViewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [expandedIndex, setExpandedIndex] = useState<number>(0);\r\n\r\n  const getLocalName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const getLocalSubtitle = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.subtitle_en) return recipe.subtitle_en;\r\n    if (i18n.language === \"pt\" && recipe.subtitle_pt) return recipe.subtitle_pt;\r\n    return recipe.subtitle;\r\n  };\r\n\r\n  const difficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case \"medium\": return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case \"hard\": return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {recipes.map((recipe, index) => (\r\n        <Collapsible\r\n          key={index}\r\n          open={expandedIndex === index}\r\n          onOpenChange={(open) => setExpandedIndex(open ? index : -1)}\r\n        >\r\n          <Card className=\"overflow-hidden\">\r\n            {/* Recipe image */}\r\n            {recipe.image_url && (\r\n              <div className=\"relative w-full aspect-[16/9] bg-muted\">\r\n                <img\r\n                  src={recipe.image_url}\r\n                  alt={getLocalName(recipe)}\r\n                  className=\"w-full h-full object-cover\"\r\n                  loading=\"lazy\"\r\n                />\r\n                <div className=\"absolute bottom-2 right-2\">\r\n                  <span className=\"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full\">\r\n                    {recipe.image_source === \"ai\" ? (\r\n                      <><Sparkles className=\"h-2.5 w-2.5\" />AI 生成</>\r\n                    ) : (\r\n                      <><Globe className=\"h-2.5 w-2.5\" />来自网络</>\r\n                    )}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            <CollapsibleTrigger className=\"w-full text-left\">\r\n              <CardHeader className=\"pb-2 flex flex-row items-center justify-between\">\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"secondary\" className=\"text-xs shrink-0\">\r\n                      {t(\"aiRecipe.dishNumber\", \"第 {{n}} 道\", { n: index + 1 })}\r\n                    </Badge>\r\n                    <h4 className=\"font-semibold truncate\">{getLocalName(recipe)}</h4>\r\n                  </div>\r\n                  {getLocalSubtitle(recipe) && (\r\n                    <p className=\"text-xs text-muted-foreground italic mt-1\">{getLocalSubtitle(recipe)}</p>\r\n                  )}\r\n                  <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                    <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                      <Clock className=\"h-3 w-3\" />\r\n                      {recipe.cook_time}{t(\"recipe.minutes\", \"分钟\")}\r\n                    </Badge>\r\n                    <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                      <ChefHat className=\"h-3 w-3\" />\r\n                      {difficultyLabel(recipe.difficulty)}\r\n                    </Badge>\r\n                  </div>\r\n                </div>\r\n                {expandedIndex === index ? (\r\n                  <ChevronUp className=\"h-5 w-5 text-muted-foreground shrink-0 ml-2\" />\r\n                ) : (\r\n                  <ChevronDown className=\"h-5 w-5 text-muted-foreground shrink-0 ml-2\" />\r\n                )}\r\n              </CardHeader>\r\n            </CollapsibleTrigger>\r\n\r\n            <CollapsibleContent>\r\n              <CardContent className=\"pt-0 space-y-4\">\r\n                {/* Ingredients */}\r\n                <div>\r\n                  <h5 className=\"font-semibold text-sm mb-2\">{t(\"recipe.step.ingredients\", \"配料\")}</h5>\r\n                  <div className=\"space-y-1\">\r\n                    {recipe.ingredients.map((ing, i) => {\r\n                      const localName = i18n.language === \"en\" && ing.name_en ? ing.name_en\r\n                        : i18n.language === \"pt\" && ing.name_pt ? ing.name_pt\r\n                        : ing.name;\r\n                      return (\r\n                        <div key={i} className=\"flex justify-between text-sm py-1 border-b border-dashed last:border-0\">\r\n                          <span>{localName}</span>\r\n                          <span className=\"text-muted-foreground\">\r\n                            {ing.amount} {i18n.language === \"en\" && ing.unit_en ? ing.unit_en\r\n                              : i18n.language === \"pt\" && ing.unit_pt ? ing.unit_pt\r\n                              : ing.unit}\r\n                          </span>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Steps */}\r\n                <div>\r\n                  <h5 className=\"font-semibold text-sm mb-2\">{t(\"recipe.step.steps\", \"步骤\")}</h5>\r\n                  <div className=\"space-y-3\">\r\n                    {recipe.steps.map((step, i) => {\r\n                      const localDesc = i18n.language === \"en\" && step.description_en ? step.description_en\r\n                        : i18n.language === \"pt\" && step.description_pt ? step.description_pt\r\n                        : step.description;\r\n                      return (\r\n                        <div key={i} className=\"flex gap-3\">\r\n                          <div className=\"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center shrink-0 mt-0.5\">\r\n                            <span className=\"text-xs font-bold text-primary\">{step.order || i + 1}</span>\r\n                          </div>\r\n                          <p className=\"text-sm leading-relaxed\">{localDesc}</p>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </CollapsibleContent>\r\n          </Card>\r\n        </Collapsible>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MealDetailView;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Clock, Users, ChefHat, PlayCircle, List, Sparkles, Globe, SkipForward } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport RecipeCookingMode from \"@/components/community/recipe/RecipeCookingMode\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface AIRecipeCookingViewProps {\r\n  recipe: AIRecipeSuggestion;\r\n  ingredientImageUrl?: string;\r\n  onComplete: () => void;\r\n  onBack: () => void;\r\n  onSkip?: () => void;\r\n}\r\n\r\ntype ViewMode = \"guided\" | \"full\";\r\n\r\nconst AIRecipeCookingView = ({ recipe, ingredientImageUrl, onComplete, onBack, onSkip }: AIRecipeCookingViewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [viewMode, setViewMode] = useState<ViewMode>(\"guided\");\r\n  const [guidedStarted, setGuidedStarted] = useState(false);\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n\r\n  const getName = () => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const getDifficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case \"medium\": return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case \"hard\": return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const getDifficultyColor = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return \"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30\";\r\n      case \"medium\": return \"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30\";\r\n      case \"hard\": return \"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30\";\r\n      default: return \"bg-muted text-muted-foreground\";\r\n    }\r\n  };\r\n\r\n  const steps = recipe.steps.map((s, i) => ({ ...s, order: s.order || i + 1 }));\r\n\r\n  // Guided mode - cooking phase (step-by-step)\r\n  if (viewMode === \"guided\" && guidedStarted) {\r\n    return (\r\n      <Card className=\"overflow-hidden\">\r\n        <RecipeCookingMode\r\n          steps={steps}\r\n          onExit={() => setGuidedStarted(false)}\r\n          onComplete={onComplete}\r\n        />\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Mode toggle\r\n  const ModeToggle = () => (\r\n    <div className=\"flex justify-end\">\r\n      <div className=\"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n        <button\r\n          onClick={() => { setViewMode(\"guided\"); setGuidedStarted(false); }}\r\n          className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${viewMode === \"guided\" ? \"bg-background text-foreground shadow-sm\" : \"\"}`}\r\n        >\r\n          <PlayCircle className=\"h-4 w-4\" />\r\n          {t(\"recipe.guidedMode\", \"流程模式\")}\r\n        </button>\r\n        <button\r\n          onClick={() => setViewMode(\"full\")}\r\n          className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${viewMode === \"full\" ? \"bg-background text-foreground shadow-sm\" : \"\"}`}\r\n        >\r\n          <List className=\"h-4 w-4\" />\r\n          {t(\"recipe.fullMode\", \"完整模式\")}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Overview content (shared between guided overview and full mode top)\r\n  const RecipeHeader = () => (\r\n    <Card className=\"overflow-hidden\">\r\n\r\n      {/* Recipe image */}\r\n      {recipe.image_url && (\r\n        <div className=\"relative w-full aspect-[16/9] bg-muted\">\r\n          <img\r\n            src={recipe.image_url}\r\n            alt={getName()}\r\n            className=\"w-full h-full object-cover\"\r\n          />\r\n          <div className=\"absolute bottom-2 right-2\">\r\n            <span className=\"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full\">\r\n              {recipe.image_source === \"ai\" ? (\r\n                <>\r\n                  <Sparkles className=\"h-2.5 w-2.5\" />\r\n                  AI 生成\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Globe className=\"h-2.5 w-2.5\" />\r\n                  来自网络\r\n                </>\r\n              )}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <CardHeader className=\"pb-3\">\r\n        <h2 className=\"text-xl font-bold\">{getName()}</h2>\r\n        <div className=\"flex flex-wrap items-center gap-3 mt-3\">\r\n          {recipe.cook_time && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Clock className=\"h-4 w-4\" />\r\n              <span>{recipe.cook_time} {t(\"recipe.minutes\", \"分钟\")}</span>\r\n            </div>\r\n          )}\r\n          {recipe.servings && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Users className=\"h-4 w-4\" />\r\n              <span>{recipe.servings} {t(\"recipe.servingsUnit\", \"人份\")}</span>\r\n            </div>\r\n          )}\r\n          {recipe.difficulty && (\r\n            <Badge variant=\"outline\" className={getDifficultyColor(recipe.difficulty)}>\r\n              <ChefHat className=\"h-3 w-3 mr-1\" />\r\n              {getDifficultyLabel(recipe.difficulty)}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      </CardHeader>\r\n\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Introduction */}\r\n        {(() => {\r\n          const intro = i18n.language === \"en\" && recipe.introduction_en ? recipe.introduction_en\r\n            : i18n.language === \"pt\" && recipe.introduction_pt ? recipe.introduction_pt\r\n            : recipe.introduction;\r\n          return intro && <p className=\"text-sm text-muted-foreground whitespace-pre-line\">{intro}</p>;\r\n        })()}\r\n\r\n        <Separator />\r\n\r\n        {/* Ingredients */}\r\n        {recipe.ingredients.length > 0 && (\r\n          <div>\r\n            <h3 className=\"font-semibold text-sm mb-3\">\r\n              {t(\"recipe.ingredients\", \"食材\")} ({recipe.ingredients.length})\r\n            </h3>\r\n            <div className=\"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50\">\r\n              <span className=\"flex-1\">{t(\"recipe.ingredientName\", \"名称\")}</span>\r\n              <span className=\"w-24 text-right\">{t(\"recipe.amount\", \"用量\")}</span>\r\n            </div>\r\n            <ul className=\"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50\">\r\n              {recipe.ingredients.map((ingredient, index) => {\r\n                const localName = i18n.language === \"en\" && ingredient.name_en ? ingredient.name_en\r\n                  : i18n.language === \"pt\" && ingredient.name_pt ? ingredient.name_pt\r\n                  : ingredient.name;\r\n                return (\r\n                  <li key={index} className=\"flex items-center text-sm px-2 py-2\">\r\n                    <span className=\"flex-1 min-w-0 truncate\">{localName}</span>\r\n                    <span className=\"w-24 text-right text-muted-foreground shrink-0\">\r\n                      {ingredient.amount} {i18n.language === \"en\" && ingredient.unit_en ? ingredient.unit_en\r\n                        : i18n.language === \"pt\" && ingredient.unit_pt ? ingredient.unit_pt\r\n                        : ingredient.unit}\r\n                    </span>\r\n                  </li>\r\n                );\r\n              })}\r\n            </ul>\r\n          </div>\r\n        )}\r\n\r\n        {/* Guided mode: Start cooking button + skip */}\r\n        {viewMode === \"guided\" && (\r\n          <>\r\n            <Separator />\r\n            <Button\r\n              size=\"lg\"\r\n              className=\"w-full gap-2 h-14 text-lg\"\r\n              onClick={() => setGuidedStarted(true)}\r\n            >\r\n              <PlayCircle className=\"h-6 w-6\" />\r\n              {t(\"recipe.startCooking\", \"开始烹饪\")}\r\n              <Badge variant=\"secondary\" className=\"ml-2\">\r\n                {steps.length} {t(\"recipe.stepsCount\", \"步\")}\r\n              </Badge>\r\n            </Button>\r\n            {onSkip && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                className=\"w-full gap-2 text-muted-foreground\"\r\n                onClick={onSkip}\r\n              >\r\n                <SkipForward className=\"h-4 w-4\" />\r\n                {t(\"aiRecipe.skipDish\", \"跳过这道菜\")}\r\n              </Button>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* Full mode: Steps inline */}\r\n        {viewMode === \"full\" && (\r\n          <>\r\n            <Separator />\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3\">\r\n                {t(\"recipe.step.steps\", \"步骤\")} ({steps.length})\r\n              </h3>\r\n              <ol className=\"space-y-4\">\r\n                {steps.map((step, index) => {\r\n                  const localDesc = i18n.language === \"en\" && step.description_en ? step.description_en\r\n                    : i18n.language === \"pt\" && step.description_pt ? step.description_pt\r\n                    : step.description;\r\n                  return (\r\n                    <li key={index} className=\"flex gap-3\">\r\n                      <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\r\n                        {step.order}\r\n                      </div>\r\n                      <div className=\"flex-1 space-y-2\">\r\n                        <p className=\"text-sm\">{localDesc}</p>\r\n                        {(() => {\r\n                          const imgs = (step.image_urls && step.image_urls.length > 0) ? step.image_urls : step.image_url ? [step.image_url] : [];\r\n                          return imgs.length > 0 && (\r\n                            <div className={`flex gap-2 ${imgs.length === 1 ? \"\" : \"flex-wrap\"}`}>\r\n                              {imgs.map((url, imgIdx) => (\r\n                                <img\r\n                                  key={imgIdx}\r\n                                  src={url}\r\n                                  alt={`Step ${step.order} - ${imgIdx + 1}`}\r\n                                  className={`rounded-lg max-h-48 object-cover cursor-pointer ${imgs.length === 1 ? \"w-full\" : \"w-[calc(50%-0.25rem)]\"}`}\r\n                                  onClick={() => setPreviewImageUrl(url)}\r\n                                />\r\n                              ))}\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    </li>\r\n                  );\r\n                })}\r\n              </ol>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {viewMode === \"full\" && (\r\n          <Button\r\n            size=\"lg\"\r\n            variant=\"outline\"\r\n            className=\"w-full gap-2\"\r\n            onClick={onComplete}\r\n          >\r\n            {t(\"recipe.completeCooking\", \"完成烹饪\")}\r\n          </Button>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <ModeToggle />\r\n      <RecipeHeader />\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AIRecipeCookingView;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, SkipForward } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport AIRecipeCookingView from \"./AIRecipeCookingView\";\r\n\r\ninterface MealCookingViewProps {\r\n  recipes: AIRecipeSuggestion[];\r\n  ingredientImageUrl: string;\r\n  onComplete: (skippedIndices: number[]) => void;\r\n  onBack: () => void;\r\n}\r\n\r\nconst MealCookingView = ({ recipes, ingredientImageUrl, onComplete, onBack }: MealCookingViewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [currentDishIndex, setCurrentDishIndex] = useState(0);\r\n  const [completedDishes, setCompletedDishes] = useState<Set<number>>(new Set());\r\n  const [skippedDishes, setSkippedDishes] = useState<Set<number>>(new Set());\r\n\r\n  const getLocalName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const isAllResolved = (completed: Set<number>, skipped: Set<number>) =>\r\n    completed.size + skipped.size === recipes.length;\r\n\r\n  const moveToNext = (completed: Set<number>, skipped: Set<number>, fromIndex: number) => {\r\n    if (isAllResolved(completed, skipped)) {\r\n      onComplete(Array.from(skipped));\r\n      return;\r\n    }\r\n    // Find next unresolved dish\r\n    for (let i = fromIndex + 1; i < recipes.length; i++) {\r\n      if (!completed.has(i) && !skipped.has(i)) {\r\n        setCurrentDishIndex(i);\r\n        return;\r\n      }\r\n    }\r\n    for (let i = 0; i < fromIndex; i++) {\r\n      if (!completed.has(i) && !skipped.has(i)) {\r\n        setCurrentDishIndex(i);\r\n        return;\r\n      }\r\n    }\r\n    onComplete(Array.from(skipped));\r\n  };\r\n\r\n  const handleDishComplete = () => {\r\n    const newCompleted = new Set(completedDishes);\r\n    newCompleted.add(currentDishIndex);\r\n    setCompletedDishes(newCompleted);\r\n    moveToNext(newCompleted, skippedDishes, currentDishIndex);\r\n  };\r\n\r\n  const handleSkipDish = () => {\r\n    const newSkipped = new Set(skippedDishes);\r\n    newSkipped.add(currentDishIndex);\r\n    setSkippedDishes(newSkipped);\r\n    moveToNext(completedDishes, newSkipped, currentDishIndex);\r\n  };\r\n\r\n  const doneDishes = completedDishes.size + skippedDishes.size;\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {/* Dish navigation tabs */}\r\n      <div className=\"flex items-center gap-2 overflow-x-auto pb-1 scrollbar-hide\">\r\n        {recipes.map((recipe, index) => (\r\n          <button\r\n            key={index}\r\n            onClick={() => setCurrentDishIndex(index)}\r\n            className={`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all border shrink-0 ${\r\n              currentDishIndex === index\r\n                ? \"bg-primary text-primary-foreground border-primary\"\r\n                : completedDishes.has(index)\r\n                ? \"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-300 dark:border-green-700\"\r\n                : skippedDishes.has(index)\r\n                ? \"bg-muted text-muted-foreground/50 border-border line-through\"\r\n                : \"bg-muted text-muted-foreground border-border hover:border-primary/50\"\r\n            }`}\r\n          >\r\n            {completedDishes.has(index) && <Check className=\"h-3 w-3\" />}\r\n            {skippedDishes.has(index) && <SkipForward className=\"h-3 w-3\" />}\r\n            {getLocalName(recipe)}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Progress */}\r\n      <div className=\"text-center text-xs text-muted-foreground\">\r\n        {t(\"aiRecipe.cookingProgress\", \"已完成 {{done}}/{{total}} 道菜\", {\r\n          done: completedDishes.size,\r\n          total: recipes.length,\r\n        })}\r\n        {skippedDishes.size > 0 && (\r\n          <span className=\"ml-1 opacity-60\">\r\n            ({t(\"aiRecipe.skippedCount\", \"已跳过 {{n}} 道\", { n: skippedDishes.size })})\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {/* Current dish cooking view - key resets state when switching dishes */}\r\n      <AIRecipeCookingView\r\n        key={currentDishIndex}\r\n        recipe={recipes[currentDishIndex]}\r\n        ingredientImageUrl={ingredientImageUrl}\r\n        onComplete={handleDishComplete}\r\n        onBack={onBack}\r\n        onSkip={recipes.length > 1 && !skippedDishes.has(currentDishIndex) ? handleSkipDish : undefined}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MealCookingView;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { PartyPopper, X, Check, Bookmark, Loader2 } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { useState } from \"react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\n\r\ninterface AIRecipeSharePromptProps {\r\n  recipes: AIRecipeSuggestion[];\r\n  /** Indices of dishes the user skipped during cooking — pre-deselected */\r\n  skippedIndices?: number[];\r\n  onShare: (selectedIndices: number[]) => void;\r\n  onSkip: () => void;\r\n  onSaveRecipe?: (recipe: AIRecipeSuggestion) => Promise<any>;\r\n  /** Called when user un-saves a previously saved recipe */\r\n  onUnsaveRecipe?: (id: string) => Promise<any>;\r\n  isSaving?: boolean;\r\n}\r\n\r\nconst AIRecipeSharePrompt = ({ recipes, skippedIndices = [], onShare, onSkip, onSaveRecipe, onUnsaveRecipe, isSaving }: AIRecipeSharePromptProps) => {\r\n  const { t, i18n } = useTranslation();\r\n\r\n  // Pre-deselect skipped dishes\r\n  const [selectedIndices, setSelectedIndices] = useState<Set<number>>(\r\n    new Set(recipes.map((_, i) => i).filter(i => !skippedIndices.includes(i)))\r\n  );\r\n\r\n  // Map: recipe index → saved recipe id (or true if saved without id)\r\n  const [savedMap, setSavedMap] = useState<Map<number, string>>(new Map());\r\n  const [savingIndex, setSavingIndex] = useState<number | null>(null);\r\n\r\n  const handleToggleSave = async (index: number, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (!onSaveRecipe) return;\r\n\r\n    if (savedMap.has(index)) {\r\n      // Already saved → cancel save (delete)\r\n      const savedId = savedMap.get(index);\r\n      if (savedId && onUnsaveRecipe) {\r\n        setSavingIndex(index);\r\n        try {\r\n          await onUnsaveRecipe(savedId);\r\n          setSavedMap(prev => {\r\n            const next = new Map(prev);\r\n            next.delete(index);\r\n            return next;\r\n          });\r\n        } finally {\r\n          setSavingIndex(null);\r\n        }\r\n      }\r\n    } else {\r\n      // Not saved → save\r\n      setSavingIndex(index);\r\n      try {\r\n        const result = await onSaveRecipe(recipes[index]);\r\n        setSavedMap(prev => new Map(prev).set(index, result?.id || \"saved\"));\r\n      } finally {\r\n        setSavingIndex(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getLocalName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const toggleDish = (index: number) => {\r\n    const next = new Set(selectedIndices);\r\n    if (next.has(index)) next.delete(index);\r\n    else next.add(index);\r\n    setSelectedIndices(next);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center gap-5 py-6\">\r\n      <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\">\r\n        <PartyPopper className=\"h-8 w-8 text-primary\" />\r\n      </div>\r\n\r\n      <div className=\"text-center space-y-1.5\">\r\n        <h3 className=\"text-xl font-bold\">\r\n          {t(\"aiRecipe.cookingDone\", \"烹饪完成！🎉\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground max-w-xs mx-auto\">\r\n          {t(\"aiRecipe.shareSelectDesc\", \"选择您想要分享到社区的菜品，每道菜需要拍摄成品照片\")}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Dish selection list */}\r\n      <div className=\"w-full max-w-sm space-y-2\">\r\n        {recipes.map((recipe, index) => {\r\n          const isSkipped = skippedIndices.includes(index);\r\n          const isSaved = savedMap.has(index);\r\n          return (\r\n            <button\r\n              key={index}\r\n              onClick={() => !isSkipped && toggleDish(index)}\r\n              className={`w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left ${\r\n                isSkipped\r\n                  ? \"border-border bg-muted/20 opacity-40 cursor-not-allowed\"\r\n                  : selectedIndices.has(index)\r\n                  ? \"border-primary bg-primary/5 ring-1 ring-primary/20\"\r\n                  : \"border-border bg-muted/30 opacity-60\"\r\n              }`}\r\n            >\r\n              {/* Dish image */}\r\n              <div className=\"w-14 h-14 rounded-lg overflow-hidden bg-muted shrink-0\">\r\n                {recipe.image_url ? (\r\n                  <img src={recipe.image_url} alt={recipe.recipe_name} className=\"w-full h-full object-cover\" />\r\n                ) : (\r\n                  <div className=\"w-full h-full flex items-center justify-center text-muted-foreground text-lg\">\r\n                    🍽️\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Dish info */}\r\n              <div className=\"flex-1 min-w-0\">\r\n                <p className=\"font-medium text-sm truncate\">{getLocalName(recipe)}</p>\r\n                {recipe.subtitle && (\r\n                  <p className=\"text-xs text-muted-foreground italic truncate mt-0.5\">{recipe.subtitle}</p>\r\n                )}\r\n                <div className=\"flex items-center gap-1.5 mt-1\">\r\n                  <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0\">\r\n                    {recipe.cook_time}{t(\"recipe.minuteShort\", \"分钟\")}\r\n                  </Badge>\r\n                  {isSkipped && (\r\n                    <Badge variant=\"outline\" className=\"text-[10px] px-1.5 py-0 text-muted-foreground\">\r\n                      {t(\"aiRecipe.skipped\", \"已跳过\")}\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Save / Unsave toggle button */}\r\n              {onSaveRecipe && !isSkipped && (\r\n                <button\r\n                  onClick={(e) => handleToggleSave(index, e)}\r\n                  disabled={savingIndex === index}\r\n                  className={`p-1.5 rounded-lg shrink-0 transition-colors ${\r\n                    isSaved\r\n                      ? \"text-primary\"\r\n                      : \"text-muted-foreground hover:text-primary hover:bg-primary/10\"\r\n                  }`}\r\n                >\r\n                  {savingIndex === index ? (\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                  ) : (\r\n                    <Bookmark className={`h-4 w-4 ${isSaved ? \"fill-primary\" : \"\"}`} />\r\n                  )}\r\n                </button>\r\n              )}\r\n\r\n              {/* Selection indicator */}\r\n              {!isSkipped && (\r\n                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors ${\r\n                  selectedIndices.has(index)\r\n                    ? \"bg-primary border-primary text-primary-foreground\"\r\n                    : \"border-muted-foreground/30\"\r\n                }`}>\r\n                  {selectedIndices.has(index) && <Check className=\"h-3.5 w-3.5\" />}\r\n                </div>\r\n              )}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      <div className=\"w-full max-w-sm space-y-3\">\r\n        <Button\r\n          className=\"w-full gap-2 h-12\"\r\n          onClick={() => onShare(Array.from(selectedIndices).sort())}\r\n          disabled={selectedIndices.size === 0}\r\n        >\r\n          {selectedIndices.size > 0\r\n            ? t(\"aiRecipe.shareSelected\", \"分享 {{count}} 道菜到社区\", { count: selectedIndices.size })\r\n            : t(\"aiRecipe.shareToComm\", \"分享到社区\")}\r\n        </Button>\r\n        <Button variant=\"outline\" className=\"w-full gap-2\" onClick={onSkip}>\r\n          <X className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.noThanks\", \"暂时不分享\")}\r\n        </Button>\r\n      </div>\r\n\r\n      <p className=\"text-xs text-muted-foreground text-center max-w-xs\">\r\n        {t(\"aiRecipe.shareNote\", \"分享需要拍摄成品照片进行验证，以确保内容真实可靠\")}\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AIRecipeSharePrompt;\r\n","import { useState, useEffect, useRef, useMemo } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { ArrowLeft, Loader2, Sparkles, Bookmark, X, Camera, SkipForward } from \"lucide-react\";\r\nimport AnimatedLoadingText from \"@/components/ai-recipe/AnimatedLoadingText\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { useAIRecipe, IdentifiedIngredient, AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { useCreateRecipe } from \"@/hooks/useCreateRecipe\";\r\nimport { useSavedRecipes } from \"@/hooks/useSavedRecipes\";\r\nimport { useLoginRequired } from \"@/hooks/useLoginRequired\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\r\nimport IngredientPhotoStep from \"@/components/ai-recipe/IngredientPhotoStep\";\r\nimport IngredientConfirmStep from \"@/components/ai-recipe/IngredientConfirmStep\";\r\nimport PreferencesStep, { RecipePreferences } from \"@/components/ai-recipe/PreferencesStep\";\r\nimport RecipeSelectStep from \"@/components/ai-recipe/RecipeSelectStep\";\r\nimport MealDetailView from \"@/components/ai-recipe/MealDetailView\";\r\nimport MealCookingView from \"@/components/ai-recipe/MealCookingView\";\r\nimport ResultPhotoStep from \"@/components/ai-recipe/ResultPhotoStep\";\r\nimport AIRecipeSharePrompt from \"@/components/ai-recipe/AIRecipeSharePrompt\";\r\nimport PublishConfirmStep from \"@/components/ai-recipe/PublishConfirmStep\";\r\n\r\ntype Step = \"photo\" | \"confirm\" | \"preferences\" | \"generating\" | \"select\" | \"detail\" | \"cooking\" | \"share-prompt\" | \"result\" | \"publish\";\r\n\r\nconst STEP_ORDER: Step[] = [\"photo\", \"confirm\", \"preferences\", \"generating\", \"select\", \"detail\", \"cooking\", \"share-prompt\", \"result\", \"publish\"];\r\n\r\nconst SESSION_KEY = \"ai-recipe-session\";\r\n\r\ninterface SessionState {\r\n  step: Step;\r\n  ingredientImageUrls: string[];\r\n  ingredients: IdentifiedIngredient[];\r\n  preferences: RecipePreferences;\r\n  recipes: AIRecipeSuggestion[];\r\n  publishingDishIndex: number;\r\n  publishQueue: number[];\r\n  resultImageUrl: string;\r\n  photoVerified: boolean;\r\n}\r\n\r\nconst loadSession = (): Partial<SessionState> => {\r\n  try {\r\n    const raw = sessionStorage.getItem(SESSION_KEY);\r\n    if (raw) return JSON.parse(raw);\r\n  } catch {}\r\n  return {};\r\n};\r\n\r\nconst AIRecipe = () => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const backTo = (location.state as any)?.from || \"/ai-recipe\";\r\n  const { requireLogin } = useLoginRequired();\r\n  const { identifyIngredients, generateRecipes, generateRecipeImages, verifyResultPhoto, uploadImage, isIdentifying, isGenerating, isVerifying, isGeneratingImages } = useAIRecipe();\r\n  const [showCloseConfirm, setShowCloseConfirm] = useState(false);\r\n  const createRecipe = useCreateRecipe();\r\n  const { saveRecipe, deleteRecipe, isSaving } = useSavedRecipes();\r\n\r\n  const [saved] = useState(() => loadSession());\r\n  const hasExistingSession = !!(saved.step && saved.step !== \"photo\" && saved.step !== \"generating\" && (saved.ingredients?.length || saved.recipes?.length));\r\n\r\n  const [showResumeDialog, setShowResumeDialog] = useState(hasExistingSession);\r\n  const [sessionActive, setSessionActive] = useState(!hasExistingSession);\r\n\r\n  const [step, setStep] = useState<Step>(\"photo\");\r\n  const [ingredientImageUrls, setIngredientImageUrls] = useState<string[]>([]);\r\n  const [ingredients, setIngredients] = useState<IdentifiedIngredient[]>([]);\r\n  const [preferences, setPreferences] = useState<RecipePreferences>({});\r\n  const [recipes, setRecipes] = useState<AIRecipeSuggestion[]>([]);\r\n  const recipesRef = useRef<AIRecipeSuggestion[]>([]);\r\n  const [recipeHistory, setRecipeHistory] = useState<AIRecipeSuggestion[][]>([]);\r\n  const [publishingDishIndex, setPublishingDishIndex] = useState<number>(0);\r\n  const [publishQueue, setPublishQueue] = useState<number[]>([]);\r\n  const [resultImageUrl, setResultImageUrl] = useState<string>(\"\");\r\n  const [photoVerified, setPhotoVerified] = useState(false);\r\n  const [resultNote, setResultNote] = useState<string>(\"\");\r\n  const [skippedCookingIndices, setSkippedCookingIndices] = useState<number[]>([]);\r\n\r\n  const handleResumeSession = () => {\r\n    setStep(saved.step && saved.step !== \"generating\" ? saved.step : \"photo\");\r\n    setIngredientImageUrls(saved.ingredientImageUrls || []);\r\n    setIngredients(saved.ingredients || []);\r\n    setPreferences(saved.preferences || {});\r\n    const savedRecipes = saved.recipes || [];\r\n    recipesRef.current = savedRecipes;\r\n    setRecipes(savedRecipes);\r\n    setPublishingDishIndex(saved.publishingDishIndex || 0);\r\n    setPublishQueue(saved.publishQueue || []);\r\n    setResultImageUrl(saved.resultImageUrl || \"\");\r\n    setPhotoVerified(saved.photoVerified || false);\r\n    setSessionActive(true);\r\n    setShowResumeDialog(false);\r\n  };\r\n\r\n  // Keep ref always in sync with recipes state — most reliable way to avoid stale closures\r\n  useEffect(() => {\r\n    recipesRef.current = recipes;\r\n  }, [recipes]);\r\n\r\n  const handleNewSession = () => {\r\n    sessionStorage.removeItem(SESSION_KEY);\r\n    setSessionActive(true);\r\n    setShowResumeDialog(false);\r\n  };\r\n\r\n  const stepIndex = STEP_ORDER.indexOf(step);\r\n  const progress = ((stepIndex + 1) / STEP_ORDER.length) * 100;\r\n\r\n  // Persist state to sessionStorage (only when session is active to avoid overwriting with defaults)\r\n  useEffect(() => {\r\n    if (!sessionActive) return;\r\n    try {\r\n      const lightRecipes = recipes.map(r => ({\r\n        ...r,\r\n        image_url: r.image_url && r.image_url.startsWith(\"data:\") ? undefined : r.image_url,\r\n      }));\r\n      const state: SessionState = { step, ingredientImageUrls, ingredients, preferences, recipes: lightRecipes as any, publishingDishIndex, publishQueue, resultImageUrl, photoVerified };\r\n      sessionStorage.setItem(SESSION_KEY, JSON.stringify(state));\r\n    } catch (e) {\r\n      console.warn(\"Session save failed (quota):\", e);\r\n    }\r\n  }, [sessionActive, step, ingredientImageUrls, ingredients, preferences, recipes, publishingDishIndex, publishQueue, resultImageUrl, photoVerified]);\r\n\r\n  // Scroll to top when step changes\r\n  useEffect(() => {\r\n    window.scrollTo({ top: 0, behavior: \"instant\" });\r\n  }, [step]);\r\n\r\n  const currentPublishRecipe = publishQueue.length > 0 ? recipes[publishQueue[0]] : null;\r\n  const currentQueuePosition = publishQueue.length > 0 ? 1 : 0;\r\n  // Step 1a: Photos uploaded → identify\r\n  const handlePhotosUploaded = async (urls: string[]) => {\r\n    if (!requireLogin()) return;\r\n    setIngredientImageUrls(urls);\r\n    const allIngredients: IdentifiedIngredient[] = [];\r\n    const seen = new Set<string>();\r\n    for (const url of urls) {\r\n      const result = await identifyIngredients(url);\r\n      if (result) {\r\n        for (const ing of result) {\r\n          if (!seen.has(ing.name)) {\r\n            seen.add(ing.name);\r\n            allIngredients.push(ing);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (allIngredients.length > 0) {\r\n      setIngredients(allIngredients);\r\n      setStep(\"confirm\");\r\n    }\r\n  };\r\n\r\n  const handleSkipToManual = () => {\r\n    if (!requireLogin()) return;\r\n    setIngredients([]);\r\n    setStep(\"confirm\");\r\n  };\r\n\r\n  const handleConfirmIngredients = () => {\r\n    if (ingredients.length === 0) {\r\n      toast.error(t(\"aiRecipe.noIngredients\", \"请至少保留一种食材\"));\r\n      return;\r\n    }\r\n    setStep(\"preferences\");\r\n  };\r\n\r\n  const handlePreferencesConfirm = async (prefs: RecipePreferences) => {\r\n    setPreferences(prefs);\r\n    await doGenerate(prefs);\r\n  };\r\n\r\n  const handlePreferencesSkip = async () => {\r\n    setPreferences({});\r\n    await doGenerate({});\r\n  };\r\n\r\n  const doGenerate = async (prefs: RecipePreferences, excludeDishes?: string[]) => {\r\n    setStep(\"generating\");\r\n    // Snapshot current recipes from ref before async call (ref is always latest via useEffect)\r\n    const currentBeforeGenerate = recipesRef.current.slice();\r\n    const result = await generateRecipes(ingredients, prefs.difficulty, prefs.servings, prefs.dishCount, prefs.notes, excludeDishes);\r\n    if (result && result.length > 0) {\r\n      // Push snapshot into history only if non-empty and not a dup of history top\r\n      if (currentBeforeGenerate.length > 0) {\r\n        setRecipeHistory(prev => {\r\n          const isDup =\r\n            prev.length > 0 &&\r\n            prev[0].length === currentBeforeGenerate.length &&\r\n            prev[0][0]?.recipe_name === currentBeforeGenerate[0]?.recipe_name;\r\n          if (isDup) return prev;\r\n          return [currentBeforeGenerate, ...prev].slice(0, 5);\r\n        });\r\n      }\r\n      setRecipes(result);\r\n      setStep(\"select\");\r\n\r\n      // Asynchronously generate images — update recipes as each image arrives\r\n      generateRecipeImages(\r\n        result.map(r => ({ recipe_name: r.recipe_name, recipe_name_en: r.recipe_name_en })),\r\n        (recipeName, imageUrl, imageSource) => {\r\n          setRecipes(prev =>\r\n            prev.map(r =>\r\n              r.recipe_name === recipeName\r\n                ? { ...r, image_url: imageUrl, image_source: imageSource as \"ai\" | \"web\" }\r\n                : r\r\n            )\r\n          );\r\n        }\r\n      );\r\n    } else {\r\n      setStep(\"preferences\");\r\n    }\r\n  };\r\n\r\n  // Confirm entire meal\r\n  const handleConfirmMeal = () => {\r\n    setStep(\"detail\");\r\n  };\r\n\r\n  // Save all recipes\r\n  const handleSaveAllRecipes = async () => {\r\n    for (const recipe of recipes) {\r\n      await saveRecipe(recipe);\r\n    }\r\n  };\r\n\r\n  const handleStartCooking = () => {\r\n    setStep(\"cooking\");\r\n  };\r\n\r\n  const handleCookingComplete = (skippedIndices: number[]) => {\r\n    setSkippedCookingIndices(skippedIndices);\r\n    setStep(\"share-prompt\");\r\n  };\r\n\r\n  const [showSaveBeforeAction, setShowSaveBeforeAction] = useState<\"share\" | \"skip\" | null>(null);\r\n\r\n  const handleWantToShare = (selectedIndices: number[]) => {\r\n    setPublishQueue(selectedIndices);\r\n    setShowSaveBeforeAction(\"share\");\r\n  };\r\n\r\n  const handleSkipShare = () => {\r\n    sessionStorage.removeItem(SESSION_KEY);\r\n    toast.success(t(\"aiRecipe.cookingComplete\", \"太棒了！烹饪完成！\"));\r\n    navigate(\"/community\");\r\n  };\r\n\r\n  const handleSaveAndContinue = async (action: \"share\" | \"skip\") => {\r\n    for (const recipe of recipes) {\r\n      await saveRecipe(recipe);\r\n    }\r\n    setShowSaveBeforeAction(null);\r\n    if (action === \"share\") {\r\n      setPublishingDishIndex(publishQueue[0] || 0);\r\n      setStep(\"result\");\r\n    } else {\r\n      handleSkipShare();\r\n    }\r\n  };\r\n\r\n  const handleSkipSaveAndContinue = (action: \"share\" | \"skip\") => {\r\n    setShowSaveBeforeAction(null);\r\n    if (action === \"share\") {\r\n      setPublishingDishIndex(publishQueue[0] || 0);\r\n      setStep(\"result\");\r\n    } else {\r\n      handleSkipShare();\r\n    }\r\n  };\r\n\r\n  // Result photo verified\r\n  const handlePhotoVerified = (url: string, verified: boolean, note?: string) => {\r\n    setResultImageUrl(url);\r\n    setPhotoVerified(verified);\r\n    if (note) setResultNote(note);\r\n    if (verified) {\r\n      setStep(\"publish\");\r\n    }\r\n  };\r\n\r\n  // Publish current dish\r\n  const handlePublish = async (notes?: string) => {\r\n    if (!currentPublishRecipe || !resultImageUrl) return;\r\n\r\n    try {\r\n      await createRecipe.mutateAsync({\r\n        recipe_name: currentPublishRecipe.recipe_name,\r\n        recipe_name_en: currentPublishRecipe.recipe_name_en,\r\n        recipe_name_pt: currentPublishRecipe.recipe_name_pt,\r\n        subtitle: currentPublishRecipe.subtitle,\r\n        subtitle_en: currentPublishRecipe.subtitle_en,\r\n        subtitle_pt: currentPublishRecipe.subtitle_pt,\r\n        cook_time: currentPublishRecipe.cook_time,\r\n        difficulty: currentPublishRecipe.difficulty,\r\n        servings: currentPublishRecipe.servings,\r\n        ingredients: currentPublishRecipe.ingredients,\r\n        steps: currentPublishRecipe.steps.map((s, i) => ({ ...s, order: i + 1 })),\r\n        cover_image: resultImageUrl,\r\n        introduction: currentPublishRecipe.introduction || \"\",\r\n        introduction_en: currentPublishRecipe.introduction_en,\r\n        introduction_pt: currentPublishRecipe.introduction_pt,\r\n        cooking_note: notes?.trim() || resultNote || undefined,\r\n        ai_recipe_source: {\r\n          source: \"ai_recipe\",\r\n          ingredient_images: ingredientImageUrls,\r\n          identified_ingredients: ingredients,\r\n          selected_recipe_index: publishQueue[0],\r\n          all_recipes: recipes.map(r => r.recipe_name),\r\n          result_image: resultImageUrl,\r\n          photo_verified: photoVerified,\r\n        },\r\n      });\r\n\r\n      // Remove current from queue and move to next\r\n      const remaining = publishQueue.slice(1);\r\n      setPublishQueue(remaining);\r\n\r\n      if (remaining.length > 0) {\r\n        toast.success(t(\"aiRecipe.dishPublished\", \"第 {{n}} 道菜已发布！继续下一道\", { n: currentQueuePosition }));\r\n        setPublishingDishIndex(remaining[0]);\r\n        setResultImageUrl(\"\");\r\n        setPhotoVerified(false);\r\n        setResultNote(\"\");\r\n        setStep(\"result\");\r\n      } else {\r\n        sessionStorage.removeItem(SESSION_KEY);\r\n        toast.success(t(\"aiRecipe.allPublished\", \"所有菜谱已发布到社区！\"));\r\n        navigate(\"/community\");\r\n      }\r\n    } catch (err) {\r\n      // Error handled in hook\r\n    }\r\n  };\r\n\r\n  // Skip current dish in publish queue\r\n  const handleSkipCurrentDish = () => {\r\n    const remaining = publishQueue.slice(1);\r\n    setPublishQueue(remaining);\r\n\r\n    if (remaining.length > 0) {\r\n      setPublishingDishIndex(remaining[0]);\r\n      setResultImageUrl(\"\");\r\n      setPhotoVerified(false);\r\n      setResultNote(\"\");\r\n      setStep(\"result\");\r\n    } else {\r\n      sessionStorage.removeItem(SESSION_KEY);\r\n      toast.success(t(\"aiRecipe.publishDone\", \"发布完成！\"));\r\n      navigate(\"/community\");\r\n    }\r\n  };\r\n\r\n  const handleBack = () => {\r\n    switch (step) {\r\n      case \"confirm\": setStep(\"photo\"); break;\r\n      case \"preferences\": setStep(\"confirm\"); break;\r\n      case \"select\": setStep(\"preferences\"); break;\r\n      case \"detail\": setStep(\"select\"); break;\r\n      case \"cooking\": setStep(\"detail\"); break;\r\n      case \"share-prompt\": setStep(\"cooking\"); break;\r\n      case \"result\": setStep(\"share-prompt\"); break;\r\n      case \"publish\": setStep(\"result\"); break;\r\n      default:\r\n        navigate(\"/ai-recipe\", { replace: true, state: { from: backTo } });\r\n        break;\r\n    }\r\n  };\r\n\r\n  const getStepTitle = () => {\r\n    switch (step) {\r\n      case \"photo\": return t(\"aiRecipe.stepPhoto\", \"拍摄食材\");\r\n      case \"confirm\": return t(\"aiRecipe.stepConfirm\", \"确认食材\");\r\n      case \"preferences\": return t(\"aiRecipe.stepPreferences\", \"烹饪偏好\");\r\n      case \"generating\": return t(\"aiRecipe.stepGenerating\", \"生成菜谱\");\r\n      case \"select\": return t(\"aiRecipe.stepMealPlan\", \"完整菜单\");\r\n      case \"detail\": return t(\"aiRecipe.stepDetail\", \"菜谱详情\");\r\n      case \"cooking\": return t(\"aiRecipe.stepCooking\", \"烹饪中\");\r\n      case \"share-prompt\": return t(\"aiRecipe.stepShare\", \"分享\");\r\n      case \"result\": return currentPublishRecipe\r\n        ? t(\"aiRecipe.stepResultDish\", \"拍摄成品 ({{n}}/{{total}})\", { n: currentQueuePosition, total: publishQueue.length + currentQueuePosition - 1 })\r\n        : t(\"aiRecipe.stepResult\", \"拍摄成品\");\r\n      case \"publish\": return t(\"aiRecipe.stepPublish\", \"发布\");\r\n    }\r\n  };\r\n\r\n  const getResumeStepLabel = () => {\r\n    const s = saved.step;\r\n    if (s === \"select\" || s === \"detail\") return t(\"aiRecipe.resumeAtSelect\", \"已生成菜单\");\r\n    if (s === \"cooking\") return t(\"aiRecipe.resumeAtCooking\", \"烹饪中\");\r\n    if (s === \"confirm\") return t(\"aiRecipe.resumeAtConfirm\", \"食材确认\");\r\n    if (s === \"preferences\") return t(\"aiRecipe.resumeAtPrefs\", \"烹饪偏好\");\r\n    if (s === \"share-prompt\" || s === \"result\" || s === \"publish\") return t(\"aiRecipe.resumeAtShare\", \"分享/发布\");\r\n    return \"\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col bg-background\">\r\n      {/* Resume session dialog - blocks main content until user decides */}\r\n      {showResumeDialog ? (\r\n        <Dialog open={showResumeDialog} onOpenChange={(open) => { if (!open) { setShowResumeDialog(false); navigate('/community', { state: { openCreatePost: true } }); } }}>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle className=\"flex items-center gap-2\">\r\n                <Sparkles className=\"h-5 w-5 text-primary\" />\r\n                {t(\"aiRecipe.resumeTitle\", \"检测到未完成的食谱\")}\r\n              </DialogTitle>\r\n              <DialogDescription className=\"space-y-2\">\r\n                <span>{t(\"aiRecipe.resumeDesc\", \"您有一个未完成的 AI 食谱流程，是否要继续？\")}</span>\r\n                {saved.recipes && saved.recipes.length > 0 && (\r\n                  <span className=\"block text-xs mt-2 bg-muted rounded-lg px-3 py-2\">\r\n                    {saved.recipes.map(r => r.recipe_name).join(\"、\")}\r\n                  </span>\r\n                )}\r\n                <span className=\"block text-xs text-muted-foreground\">\r\n                  {t(\"aiRecipe.resumeProgress\", \"进度：{{step}}\", { step: getResumeStepLabel() })}\r\n                </span>\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <DialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n              <Button variant=\"outline\" onClick={handleNewSession}>\r\n                {t(\"aiRecipe.startNew\", \"重新开始\")}\r\n              </Button>\r\n              <Button onClick={handleResumeSession}>\r\n                {t(\"aiRecipe.resumeContinue\", \"继续上次\")}\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n      ) : null}\r\n      {!showResumeDialog && <>\r\n      {/* Header */}\r\n      <div className=\"px-4 py-3 border-b bg-background shrink-0 sticky top-14 z-10\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <button\r\n            onClick={step === \"publish\" || step === \"share-prompt\" ? () => setShowCloseConfirm(true) : handleBack}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md\"\r\n          >\r\n            {step === \"publish\" || step === \"share-prompt\" ? <X className=\"h-5 w-5\" /> : <ArrowLeft className=\"h-5 w-5\" />}\r\n          </button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Sparkles className=\"h-4 w-4 text-primary\" />\r\n            <h2 className=\"font-medium\">{getStepTitle()}</h2>\r\n          </div>\r\n          <div className=\"w-6\" />\r\n        </div>\r\n        <Progress value={progress} className=\"h-1\" />\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 max-w-lg mx-auto w-full\">\r\n        {step === \"photo\" && (\r\n          <IngredientPhotoStep\r\n            onPhotosUploaded={handlePhotosUploaded}\r\n            onSkipToManual={handleSkipToManual}\r\n            uploadImage={uploadImage}\r\n            isUploading={isIdentifying}\r\n            initialImageUrls={ingredientImageUrls}\r\n            onRequireLogin={requireLogin}\r\n          />\r\n        )}\r\n\r\n        {isIdentifying && (\r\n          <div className=\"flex flex-col items-center gap-3 py-12\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            <AnimatedLoadingText\r\n              messages={[\r\n                t(\"aiRecipe.identifying.1\", \"AI 正在识别食材...\"),\r\n                t(\"aiRecipe.identifying.2\", \"分析食材种类与数量...\"),\r\n                t(\"aiRecipe.identifying.3\", \"即将完成识别...\"),\r\n              ]}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {step === \"confirm\" && !isIdentifying && (\r\n          <div className=\"space-y-4\">\r\n            <IngredientConfirmStep ingredients={ingredients} onChange={setIngredients} />\r\n            <Button className=\"w-full\" onClick={handleConfirmIngredients}>\r\n              {t(\"aiRecipe.nextStep\", \"下一步\")}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {step === \"preferences\" && (\r\n          <PreferencesStep\r\n            onConfirm={handlePreferencesConfirm}\r\n            onSkip={handlePreferencesSkip}\r\n            initialValues={preferences}\r\n          />\r\n        )}\r\n\r\n        {step === \"generating\" && (\r\n          <div className=\"flex flex-col items-center gap-3 py-12\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            <AnimatedLoadingText\r\n              messages={[\r\n                t(\"aiRecipe.generating.1\", \"AI 正在为您设计一桌菜...\"),\r\n                t(\"aiRecipe.generating.2\", \"搭配营养均衡的食谱...\"),\r\n                t(\"aiRecipe.generating.3\", \"计算最佳烹饪顺序...\"),\r\n                t(\"aiRecipe.generating.4\", \"生成详细烹饪步骤...\"),\r\n                t(\"aiRecipe.generating.5\", \"即将完成，请稍候...\"),\r\n              ]}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {step === \"select\" && (\r\n          <RecipeSelectStep\r\n            recipes={recipes}\r\n            recipeHistory={recipeHistory}\r\n            onSelectHistoryMeal={(meal) => {\r\n              // Snapshot current via ref (always up-to-date due to useEffect)\r\n              const current = recipesRef.current.slice();\r\n              setRecipeHistory(prev => {\r\n                // Remove selected meal from history\r\n                const filtered = prev.filter(h => h !== meal);\r\n                // Push current into history (deduplicated)\r\n                if (current.length === 0) return filtered;\r\n                const isDup = filtered.length > 0 && filtered[0][0]?.recipe_name === current[0]?.recipe_name && filtered[0].length === current.length;\r\n                return isDup ? filtered : [current, ...filtered].slice(0, 5);\r\n              });\r\n              setRecipes(meal); // useEffect will sync recipesRef.current\r\n            }}\r\n            onConfirmMeal={handleConfirmMeal}\r\n            onRegenerate={(updatedNotes?: string) => {\r\n              const excludeNames = recipes.map(r => r.recipe_name);\r\n              const updatedPrefs = { ...preferences, notes: updatedNotes !== undefined ? updatedNotes : preferences.notes };\r\n              setPreferences(updatedPrefs);\r\n              doGenerate(updatedPrefs, excludeNames);\r\n            }}\r\n            isRegenerating={isGenerating}\r\n            preferences={preferences}\r\n            isLoadingImages={isGeneratingImages}\r\n          />\r\n        )}\r\n\r\n        {step === \"detail\" && recipes.length > 0 && (\r\n          <div className=\"space-y-4\">\r\n            <MealDetailView recipes={recipes} />\r\n            <div className=\"flex gap-3\">\r\n              <Button variant=\"outline\" className=\"flex-1\" onClick={() => setStep(\"select\")}>\r\n                {t(\"aiRecipe.changeMeal\", \"换一桌\")}\r\n              </Button>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"gap-1\"\r\n                onClick={handleSaveAllRecipes}\r\n                disabled={isSaving}\r\n              >\r\n                <Bookmark className=\"h-4 w-4\" />\r\n                {t(\"aiRecipe.saveAll\", \"全部保存\")}\r\n              </Button>\r\n              <Button className=\"flex-1\" onClick={handleStartCooking}>\r\n                {t(\"aiRecipe.startCooking\", \"开始烹饪\")}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {step === \"cooking\" && recipes.length > 0 && (\r\n          <MealCookingView\r\n            recipes={recipes}\r\n            ingredientImageUrl={ingredientImageUrls[0] || \"\"}\r\n            onComplete={handleCookingComplete}\r\n            onBack={() => setStep(\"detail\")}\r\n          />\r\n        )}\r\n\r\n        {step === \"share-prompt\" && recipes.length > 0 && (\r\n          <div className=\"space-y-4\">\r\n            <AIRecipeSharePrompt\r\n              recipes={recipes}\r\n              skippedIndices={skippedCookingIndices}\r\n              onShare={handleWantToShare}\r\n              onSkip={() => setShowSaveBeforeAction(\"skip\")}\r\n              onSaveRecipe={saveRecipe}\r\n              onUnsaveRecipe={deleteRecipe}\r\n              isSaving={isSaving}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Save before action dialog */}\r\n        <AlertDialog open={!!showSaveBeforeAction} onOpenChange={(open) => !open && setShowSaveBeforeAction(null)}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>{t(\"aiRecipe.saveBeforeTitle\", \"保存食谱？\")}</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {t(\"aiRecipe.saveBeforeDescMeal\", \"是否将这桌菜的所有食谱保存到您的收藏中？\")}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n              <AlertDialogCancel onClick={() => showSaveBeforeAction && handleSkipSaveAndContinue(showSaveBeforeAction)}>\r\n                {t(\"aiRecipe.noSave\", \"不保存\")}\r\n              </AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={() => showSaveBeforeAction && handleSaveAndContinue(showSaveBeforeAction)}\r\n                disabled={isSaving}\r\n              >\r\n                <Bookmark className=\"h-4 w-4 mr-1\" />\r\n                {t(\"aiRecipe.saveAllRecipes\", \"保存全部食谱\")}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {step === \"result\" && currentPublishRecipe && (\r\n          <div className=\"space-y-4\">\r\n            {/* Current dish indicator */}\r\n            {publishQueue.length > 0 && (\r\n              <div className=\"flex items-center gap-3 p-3 rounded-xl border bg-muted/30\">\r\n                <div className=\"w-12 h-12 rounded-lg overflow-hidden bg-muted shrink-0\">\r\n                  {currentPublishRecipe.image_url ? (\r\n                    <img src={currentPublishRecipe.image_url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <div className=\"w-full h-full flex items-center justify-center text-lg\">🍽️</div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"font-medium text-sm truncate\">{currentPublishRecipe.recipe_name}</p>\r\n                  {currentPublishRecipe.subtitle && (\r\n                    <p className=\"text-xs text-muted-foreground italic truncate\">{currentPublishRecipe.subtitle}</p>\r\n                  )}\r\n                </div>\r\n                {publishQueue.length > 1 && (\r\n                  <Button variant=\"ghost\" size=\"sm\" className=\"text-xs shrink-0\" onClick={handleSkipCurrentDish}>\r\n                    <SkipForward className=\"h-3.5 w-3.5 mr-1\" />\r\n                    {t(\"aiRecipe.skipThisDish\", \"跳过\")}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            )}\r\n            <ResultPhotoStep\r\n              onPhotoVerified={handlePhotoVerified}\r\n              uploadImage={uploadImage}\r\n              verifyPhoto={verifyResultPhoto}\r\n              recipeName={currentPublishRecipe.recipe_name}\r\n              isVerifying={isVerifying}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {step === \"publish\" && currentPublishRecipe && (\r\n          <PublishConfirmStep\r\n            resultImageUrl={resultImageUrl}\r\n            recipeName={currentPublishRecipe.recipe_name}\r\n            initialNote={resultNote}\r\n            onPublish={handlePublish}\r\n            onSkip={handleSkipCurrentDish}\r\n            isPublishing={createRecipe.isPending}\r\n          />\r\n        )}\r\n\r\n        {/* Close confirmation dialog */}\r\n        <AlertDialog open={showCloseConfirm} onOpenChange={setShowCloseConfirm}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>\r\n                {step === \"share-prompt\"\r\n                  ? t(\"aiRecipe.exitShareTitle\", \"确认退出？\")\r\n                  : t(\"aiRecipe.closeConfirmTitle\", \"确认离开？\")}\r\n              </AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {step === \"share-prompt\"\r\n                  ? t(\"aiRecipe.exitShareDesc\", \"您还没有保存食谱，退出后食谱将丢失。是否先保存？\")\r\n                  : t(\"aiRecipe.closeConfirmDesc\", \"离开后将放弃发布，您的成品照片和食谱将不会保存到社区。\")}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n              <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n              {step === \"share-prompt\" ? (\r\n                <>\r\n                  <AlertDialogAction\r\n                    onClick={async () => {\r\n                      for (const recipe of recipes) {\r\n                        await saveRecipe(recipe);\r\n                      }\r\n                      setShowCloseConfirm(false);\r\n                      handleSkipShare();\r\n                    }}\r\n                    disabled={isSaving}\r\n                  >\r\n                    <Bookmark className=\"h-4 w-4 mr-1\" />\r\n                    {t(\"aiRecipe.saveAndExit\", \"保存并退出\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogAction\r\n                    className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n                    onClick={() => {\r\n                      setShowCloseConfirm(false);\r\n                      handleSkipShare();\r\n                    }}\r\n                  >\r\n                    {t(\"aiRecipe.exitWithoutSave\", \"不保存，直接退出\")}\r\n                  </AlertDialogAction>\r\n                </>\r\n              ) : (\r\n                <AlertDialogAction onClick={handleSkipShare}>\r\n                  {t(\"aiRecipe.confirmLeave\", \"确认离开\")}\r\n                </AlertDialogAction>\r\n              )}\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n      </div>\r\n      </>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AIRecipe;\r\n"],"names":["MAX_PHOTOS","IngredientPhotoStep","onPhotosUploaded","onSkipToManual","uploadImage","isUploading","initialImageUrls","onRequireLogin","t","useTranslation","photos","setPhotos","useState","url","i","showCamera","setShowCamera","fileRef","useRef","uploadingCount","p","allUploaded","handleFiles","files","fileArray","remaining","toAdd","f","newItems","prev","file","handleCameraCapture","handleOpenCamera","removePhoto","id","handleSubmit","urls","jsxs","Fragment","jsx","CameraCapture","Camera","photo","Loader2","X","Plus","Button","ImageIcon","PenLine","e","IngredientConfirmStep","ingredients","onChange","editIndex","setEditIndex","editName","setEditName","editAmount","setEditAmount","editUnit","setEditUnit","newName","setNewName","handleEdit","index","handleSaveEdit","updated","handleDelete","_","handleAdd","parts","s","name","item","Input","Check","Badge","Edit2","Trash2","SERVINGS_OPTIONS","DISH_COUNT_OPTIONS","PreferencesStep","onConfirm","onSkip","initialValues","difficulty","setDifficulty","servings","setServings","dishCount","setDishCount","notes","setNotes","isCustom","showCustom","setShowCustom","customServings","setCustomServings","difficulties","ChefHat","d","Users","n","UtensilsCrossed","c","MessageSquare","Textarea","RecipeSelectStep","recipes","recipeHistory","onSelectHistoryMeal","onConfirmMeal","onRegenerate","isRegenerating","preferences","isLoadingImages","i18n","editingNotes","setEditingNotes","notesValue","setNotesValue","showHistory","setShowHistory","getLocalizedName","recipe","getLocalizedSubtitle","difficultyLabel","totalCookTime","sum","r","Info","Card","Sparkles","Globe","Skeleton","CardHeader","CardContent","Clock","AlertTriangle","lang","Pencil","RefreshCw","h","History","ChevronDown","meal","hi","dish","di","MealDetailView","expandedIndex","setExpandedIndex","getLocalName","getLocalSubtitle","Collapsible","open","CollapsibleTrigger","ChevronUp","CollapsibleContent","ing","localName","step","localDesc","AIRecipeCookingView","ingredientImageUrl","onComplete","onBack","viewMode","setViewMode","guidedStarted","setGuidedStarted","previewImageUrl","setPreviewImageUrl","getName","getDifficultyLabel","getDifficultyColor","steps","RecipeCookingMode","ModeToggle","PlayCircle","List","RecipeHeader","intro","Separator","ingredient","SkipForward","imgs","imgIdx","ImagePreviewModal","MealCookingView","currentDishIndex","setCurrentDishIndex","completedDishes","setCompletedDishes","skippedDishes","setSkippedDishes","isAllResolved","completed","skipped","moveToNext","fromIndex","handleDishComplete","newCompleted","handleSkipDish","newSkipped","AIRecipeSharePrompt","skippedIndices","onShare","onSaveRecipe","onUnsaveRecipe","isSaving","selectedIndices","setSelectedIndices","savedMap","setSavedMap","savingIndex","setSavingIndex","handleToggleSave","savedId","next","result","toggleDish","PartyPopper","isSkipped","isSaved","Bookmark","STEP_ORDER","SESSION_KEY","loadSession","raw","AIRecipe","navigate","useNavigate","backTo","useLocation","requireLogin","useLoginRequired","identifyIngredients","generateRecipes","generateRecipeImages","verifyResultPhoto","isIdentifying","isGenerating","isVerifying","isGeneratingImages","useAIRecipe","showCloseConfirm","setShowCloseConfirm","createRecipe","useCreateRecipe","saveRecipe","deleteRecipe","useSavedRecipes","saved","hasExistingSession","showResumeDialog","setShowResumeDialog","sessionActive","setSessionActive","setStep","ingredientImageUrls","setIngredientImageUrls","setIngredients","setPreferences","setRecipes","recipesRef","setRecipeHistory","publishingDishIndex","setPublishingDishIndex","publishQueue","setPublishQueue","resultImageUrl","setResultImageUrl","photoVerified","setPhotoVerified","resultNote","setResultNote","skippedCookingIndices","setSkippedCookingIndices","handleResumeSession","savedRecipes","useEffect","handleNewSession","progress","lightRecipes","state","currentPublishRecipe","currentQueuePosition","handlePhotosUploaded","allIngredients","seen","handleSkipToManual","handleConfirmIngredients","toast","handlePreferencesConfirm","prefs","doGenerate","handlePreferencesSkip","excludeDishes","currentBeforeGenerate","recipeName","imageUrl","imageSource","handleConfirmMeal","handleSaveAllRecipes","handleStartCooking","handleCookingComplete","showSaveBeforeAction","setShowSaveBeforeAction","handleWantToShare","handleSkipShare","handleSaveAndContinue","action","handleSkipSaveAndContinue","handlePhotoVerified","verified","note","handlePublish","handleSkipCurrentDish","handleBack","getStepTitle","getResumeStepLabel","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","DialogFooter","ArrowLeft","Progress","AnimatedLoadingText","current","filtered","updatedNotes","excludeNames","updatedPrefs","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","ResultPhotoStep","PublishConfirmStep"],"mappings":"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"}