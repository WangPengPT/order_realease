{"version":3,"file":"Community-hhLperJS.js","sources":["../../src/components/community/PostGridCard.tsx","../../src/components/community/PostPointsRulesDialog.tsx","../../src/components/community/MultiRestaurantSelectDrawer.tsx","../../src/components/ui/command.tsx","../../src/components/community/ActivitySelectDrawer.tsx","../../src/components/community/EmojiPicker.tsx","../../src/components/community/CreatePostDialog.tsx","../../src/pages/Community.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Heart, Images, Play, Store, Calendar, ChevronRight } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CommunityPost, useLikePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\ninterface PostGridCardProps {\r\n  post: CommunityPost;\r\n  showAssociations?: boolean;\r\n}\r\n\r\nconst PostGridCard = ({ post, showAssociations = false }: PostGridCardProps) => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const [imageError, setImageError] = useState(false);\r\n\r\n  const handleLike = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleCardClick = () => {\r\n    navigate(`/community/${post.id}`);\r\n  };\r\n\r\n  const handleRestaurantClick = (e: React.MouseEvent, restaurantId: string) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    navigate(`/restaurant/${restaurantId}`);\r\n  };\r\n\r\n  const handleActivityClick = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (post.activity?.id) {\r\n      navigate(`/activity/${post.activity.id}`);\r\n    }\r\n  };\r\n\r\n  // Strip HTML tags for plain text preview\r\n  const getPlainTextContent = (html: string) => {\r\n    const doc = new DOMParser().parseFromString(html, \"text/html\");\r\n    return doc.body.textContent || \"\";\r\n  };\r\n\r\n  const content = getLocalizedField(post, \"content\");\r\n  const plainContent = getPlainTextContent(content);\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasVideo = !!post.video_url;\r\n  const hasMedia = hasImages || hasVideo;\r\n  const imageCount = post.image_urls?.length || 0;\r\n\r\n  // Get all restaurants (from new junction table + legacy single restaurant)\r\n  const allRestaurants = [\r\n    ...(post.restaurants || []),\r\n    ...(post.restaurant && !post.restaurants?.find(r => r.id === post.restaurant?.id) ? [post.restaurant] : []),\r\n  ];\r\n\r\n  // Get localized names\r\n  const activityTitle = post.activity \r\n    ? getLocalizedField(post.activity, \"title\") \r\n    : null;\r\n\r\n  // Max visible restaurants in single column mode\r\n  const maxVisibleRestaurants = 2;\r\n\r\n  return (\r\n    <div \r\n      className=\"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1\"\r\n      onClick={handleCardClick}\r\n    >\r\n      {/* Media Section - Only show first image, no swipe */}\r\n      {hasMedia && (\r\n        <div className=\"relative aspect-[4/5] overflow-hidden\">\r\n          {/* Display cover image or video frame */}\r\n          {hasImages ? (\r\n            !imageError ? (\r\n              <img\r\n                src={post.image_urls![0]}\r\n                alt=\"\"\r\n                className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\r\n                onError={() => setImageError(true)}\r\n              />\r\n            ) : (\r\n              <div className=\"w-full h-full bg-muted flex items-center justify-center\">\r\n                <span className=\"text-xs text-muted-foreground\">\r\n                  {t(\"common.imageLoadError\", \"å›¾ç‰‡åŠ è½½å¤±è´¥\")}\r\n                </span>\r\n              </div>\r\n            )\r\n          ) : hasVideo ? (\r\n            <video\r\n              src={post.video_url}\r\n              className=\"w-full h-full object-cover\"\r\n              preload=\"metadata\"\r\n              muted\r\n              playsInline\r\n            />\r\n          ) : null}\r\n          \r\n          {/* Video indicator - show play button for video posts */}\r\n          {hasVideo && (\r\n            <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n              <div className=\"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center\">\r\n                <Play className=\"h-5 w-5 text-white fill-white ml-0.5\" />\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Multiple images indicator - only show if no video and multiple images */}\r\n          {!hasVideo && imageCount > 1 && (\r\n            <div className=\"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1\">\r\n              <Images className=\"h-3 w-3\" />\r\n              <span>{imageCount}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-3\">\r\n        {/* Associations - only show when showAssociations is true */}\r\n        {showAssociations && (allRestaurants.length > 0 || activityTitle) && (\r\n          <div className=\"flex flex-wrap gap-1.5 mb-2\">\r\n            {allRestaurants.slice(0, maxVisibleRestaurants).map((restaurant) => (\r\n              <Badge \r\n                key={restaurant.id}\r\n                variant=\"secondary\" \r\n                className=\"text-xs cursor-pointer hover:bg-secondary/80 gap-1\"\r\n                onClick={(e) => handleRestaurantClick(e, restaurant.id)}\r\n              >\r\n                <Store className=\"h-3 w-3\" />\r\n                <span className=\"truncate max-w-[120px]\">\r\n                  {getLocalizedField(restaurant, \"name\")}\r\n                </span>\r\n              </Badge>\r\n            ))}\r\n            {allRestaurants.length > maxVisibleRestaurants && (\r\n              <Badge \r\n                variant=\"secondary\" \r\n                className=\"text-xs gap-1\"\r\n              >\r\n                +{allRestaurants.length - maxVisibleRestaurants}\r\n              </Badge>\r\n            )}\r\n            {activityTitle && (\r\n              <Badge \r\n                variant=\"secondary\" \r\n                className=\"text-xs cursor-pointer hover:bg-secondary/80 gap-1\"\r\n                onClick={handleActivityClick}\r\n              >\r\n                <Calendar className=\"h-3 w-3\" />\r\n                <span className=\"truncate max-w-[120px]\">{activityTitle}</span>\r\n              </Badge>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Text Content */}\r\n        <p className={`text-sm font-medium line-clamp-2 leading-relaxed ${hasMedia ? '' : 'min-h-[60px]'}`}>\r\n          {plainContent}\r\n        </p>\r\n\r\n        {/* Author Row */}\r\n        <div className=\"flex items-center justify-between mt-3\">\r\n          <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n            <Avatar className=\"h-5 w-5 flex-shrink-0\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback className=\"text-[10px]\">\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <span className=\"text-xs text-muted-foreground truncate\">\r\n              {post.author?.display_name}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Like Button */}\r\n          <button\r\n            className={`flex items-center gap-1 text-xs ${\r\n              post.user_liked ? \"text-red-500\" : \"text-muted-foreground\"\r\n            } hover:text-red-500 transition-colors`}\r\n            onClick={handleLike}\r\n            disabled={!user}\r\n          >\r\n            <Heart\r\n              className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n            />\r\n            <span>{post.likes_count || 0}</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostGridCard;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Gift, CheckCircle, Clock, Shield } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { usePointsSettings } from \"@/hooks/usePoints\";\r\n\r\nconst PostPointsRulesDialog = () => {\r\n  const { t } = useTranslation();\r\n  const { data: settings } = usePointsSettings();\r\n\r\n  // ä»è®¾ç½®ä¸­æå–å€¼\r\n  const postPoints = settings?.find(s => s.key === 'post_points')?.value || '5';\r\n  const minLength = settings?.find(s => s.key === 'min_post_length')?.value || '10';\r\n  const requireMedia = settings?.find(s => s.key === 'post_require_media')?.value === 'true';\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogTrigger asChild>\r\n        <button className=\"text-primary hover:underline text-sm whitespace-nowrap\">\r\n          {t(\"community.viewPointsRules\", \"æŸ¥çœ‹è¯¦ç»†è§„åˆ™\")}\r\n        </button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Gift className=\"h-5 w-5 text-primary\" />\r\n            {t(\"community.pointsRulesTitle\", \"å‘å¸–ç§¯åˆ†è§„åˆ™\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4 pt-2\">\r\n          <p className=\"text-muted-foreground text-sm\">\r\n            {t(\"community.pointsRulesIntro\", \"é€šè¿‡å‘å¸ƒç¤¾åŒºå¸–å­è·å¾—ç§¯åˆ†ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š\")}\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            {/* ç§¯åˆ†æ•°é‡ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.rulePostPoints\", { points: postPoints })}</span>\r\n            </li>\r\n            {/* æœ€å°é•¿åº¦ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleMinLength\", { length: minLength })}</span>\r\n            </li>\r\n            {/* åª’ä½“è¦æ±‚ */}\r\n            {requireMedia && (\r\n              <li className=\"flex items-start gap-2 text-sm\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n                <span>{t(\"community.ruleRequireMedia\", \"å¸–å­å¿…é¡»åŒ…å«è‡³å°‘ä¸€å¼ å›¾ç‰‡æˆ–ä¸€ä¸ªè§†é¢‘\")}</span>\r\n              </li>\r\n            )}\r\n            {/* æ¯æ—¥é™åˆ¶ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Clock className=\"h-4 w-4 text-blue-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleDailyLimit\", \"æ¯å¤©ä»…å¯é€šè¿‡å‘å¸–è·å¾—ä¸€æ¬¡ç§¯åˆ†å¥–åŠ±\")}</span>\r\n            </li>\r\n            {/* å®¡æ ¸è¦æ±‚ */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Shield className=\"h-4 w-4 text-purple-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleModerationRequired\", \"å¸–å­éœ€é€šè¿‡å®¡æ ¸åæ‰èƒ½è·å¾—ç§¯åˆ†\")}</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default PostPointsRulesDialog;\r\n","import { useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, ChevronsUpDown, MapPin, Search, X } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n  DrawerFooter,\r\n} from \"@/components/ui/drawer\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\n\r\ninterface Restaurant {\r\n  id: string;\r\n  name?: string;\r\n  name_zh?: string;\r\n  name_en?: string;\r\n  name_pt?: string;\r\n  address?: string;\r\n  type?: string | string[];\r\n}\r\n\r\ninterface MultiRestaurantSelectDrawerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  value: string[];\r\n  onSelect: (restaurantIds: string[]) => void;\r\n  restaurants: Restaurant[];\r\n  required?: boolean;\r\n  maxDisplay?: number;\r\n}\r\n\r\nconst MultiRestaurantSelectDrawer = ({\r\n  open,\r\n  onOpenChange,\r\n  value,\r\n  onSelect,\r\n  restaurants,\r\n  required = false,\r\n  maxDisplay = 2,\r\n}: MultiRestaurantSelectDrawerProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const [search, setSearch] = useState(\"\");\r\n  const [pendingValue, setPendingValue] = useState<string[]>(value);\r\n  const [drawerHeight, setDrawerHeight] = useState<string>('85vh');\r\n\r\n  // Monitor visualViewport to dynamically adjust drawer height\r\n  useEffect(() => {\r\n    if (!open || !isMobile) return;\r\n    \r\n    const viewport = window.visualViewport;\r\n    if (!viewport) {\r\n      setDrawerHeight('85vh');\r\n      return;\r\n    }\r\n    \r\n    const updateHeight = () => {\r\n      const availableHeight = viewport.height;\r\n      const targetHeight = Math.min(availableHeight * 0.85, availableHeight - 50);\r\n      setDrawerHeight(`${targetHeight}px`);\r\n    };\r\n    \r\n    updateHeight();\r\n    viewport.addEventListener('resize', updateHeight);\r\n    \r\n    return () => {\r\n      viewport.removeEventListener('resize', updateHeight);\r\n    };\r\n  }, [open, isMobile]);\r\n\r\n  // Reset pending value when drawer opens\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    if (newOpen) {\r\n      setPendingValue(value);\r\n      setSearch(\"\");\r\n    }\r\n    onOpenChange(newOpen);\r\n  };\r\n\r\n  // Filter restaurants based on search\r\n  const filteredRestaurants = restaurants?.filter((r) => {\r\n    if (!search) return true;\r\n    const name = getLocalizedField(r, \"name\")?.toLowerCase() || \"\";\r\n    const address = r.address?.toLowerCase() || \"\";\r\n    const searchLower = search.toLowerCase();\r\n    return name.includes(searchLower) || address.includes(searchLower);\r\n  }) || [];\r\n\r\n  // Toggle restaurant selection\r\n  const toggleRestaurant = (restaurantId: string) => {\r\n    setPendingValue((prev) => {\r\n      if (prev.includes(restaurantId)) {\r\n        return prev.filter((id) => id !== restaurantId);\r\n      }\r\n      return [...prev, restaurantId];\r\n    });\r\n  };\r\n\r\n  // Handle confirm (mobile only)\r\n  const handleConfirm = () => {\r\n    onSelect(pendingValue);\r\n    onOpenChange(false);\r\n    setSearch(\"\");\r\n  };\r\n\r\n  // Handle toggle (desktop - immediate)\r\n  const handleDesktopToggle = (restaurantId: string) => {\r\n    const newValue = value.includes(restaurantId)\r\n      ? value.filter((id) => id !== restaurantId)\r\n      : [...value, restaurantId];\r\n    onSelect(newValue);\r\n  };\r\n\r\n  // Get selected restaurant names\r\n  const getSelectedNames = () => {\r\n    return value\r\n      .map((id) => {\r\n        const restaurant = restaurants?.find((r) => r.id === id);\r\n        return restaurant ? getLocalizedField(restaurant, \"name\") : null;\r\n      })\r\n      .filter(Boolean) as string[];\r\n  };\r\n\r\n  const selectedNames = getSelectedNames();\r\n\r\n  // Trigger button content\r\n  const TriggerContent = () => {\r\n    if (selectedNames.length === 0) {\r\n      return (\r\n        <span className=\"text-muted-foreground\">\r\n          {t(\"community.linkRestaurants\", \"å…³è”é¤å…\")}\r\n          {required && <span className=\"text-destructive ml-1\">*</span>}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    const displayNames = selectedNames.slice(0, maxDisplay);\r\n    const remaining = selectedNames.length - maxDisplay;\r\n\r\n    return (\r\n      <span className=\"text-primary flex items-center gap-1 flex-wrap\">\r\n        {displayNames.map((name, i) => (\r\n          <span key={i}>\r\n            {name}{i < displayNames.length - 1 ? \"ã€\" : \"\"}\r\n          </span>\r\n        ))}\r\n        {remaining > 0 && (\r\n          <Badge variant=\"secondary\" className=\"text-xs px-1.5 py-0\">\r\n            +{remaining}\r\n          </Badge>\r\n        )}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  // Trigger button\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors text-left\"\r\n      onClick={() => handleOpenChange(true)}\r\n    >\r\n      <TriggerContent />\r\n      <ChevronsUpDown className=\"h-4 w-4 opacity-50 shrink-0\" />\r\n    </button>\r\n  );\r\n\r\n  // Restaurant item component\r\n  const RestaurantItem = ({\r\n    restaurant,\r\n    isSelected,\r\n    onToggle,\r\n  }: {\r\n    restaurant: Restaurant;\r\n    isSelected: boolean;\r\n    onToggle: () => void;\r\n  }) => (\r\n    <div\r\n      className={cn(\r\n        \"flex items-start gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n        isSelected ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n      )}\r\n      onClick={onToggle}\r\n    >\r\n      <div className={cn(\r\n        \"h-5 w-5 shrink-0 mt-0.5 rounded border flex items-center justify-center transition-colors\",\r\n        isSelected ? \"bg-primary border-primary\" : \"border-muted-foreground/30\"\r\n      )}>\r\n        {isSelected && <Check className=\"h-3 w-3 text-primary-foreground\" />}\r\n      </div>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <p className=\"font-medium truncate\">\r\n          {getLocalizedField(restaurant, \"name\")}\r\n        </p>\r\n        {restaurant.address && (\r\n          <p className=\"text-sm text-muted-foreground truncate flex items-center gap-1 mt-0.5\">\r\n            <MapPin className=\"h-3 w-3 shrink-0\" />\r\n            {restaurant.address}\r\n          </p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Mobile: Full-screen Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={handleOpenChange}>\r\n          <DrawerContent \r\n            className=\"flex flex-col\"\r\n            style={{ \r\n              height: drawerHeight,\r\n              maxHeight: drawerHeight,\r\n              transition: 'height 0.15s ease-out, max-height 0.15s ease-out'\r\n            }}\r\n          >\r\n            <DrawerHeader className=\"pb-2 shrink-0\">\r\n              <DrawerTitle>\r\n                {t(\"community.selectRestaurants\", \"é€‰æ‹©é¤å…\")}\r\n                {pendingValue.length > 0 && (\r\n                  <Badge variant=\"secondary\" className=\"ml-2\">\r\n                    {pendingValue.length}\r\n                  </Badge>\r\n                )}\r\n              </DrawerTitle>\r\n            </DrawerHeader>\r\n\r\n            {/* Search Input */}\r\n            <div className=\"px-4 pb-3 shrink-0\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder={t(\"community.searchRestaurant\", \"æœç´¢é¤å…...\")}\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  className=\"pl-9\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Selected Preview */}\r\n            {pendingValue.length > 0 && (\r\n              <div className=\"px-4 pb-3 shrink-0\">\r\n                <div className=\"flex flex-wrap gap-1.5\">\r\n                  {pendingValue.map((id) => {\r\n                    const restaurant = restaurants?.find((r) => r.id === id);\r\n                    if (!restaurant) return null;\r\n                    return (\r\n                      <Badge\r\n                        key={id}\r\n                        variant=\"secondary\"\r\n                        className=\"gap-1 pr-1\"\r\n                      >\r\n                        <span className=\"truncate max-w-[120px]\">\r\n                          {getLocalizedField(restaurant, \"name\")}\r\n                        </span>\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"hover:bg-muted-foreground/20 rounded-full p-0.5\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            setPendingValue((prev) => prev.filter((i) => i !== id));\r\n                          }}\r\n                        >\r\n                          <X className=\"h-3 w-3\" />\r\n                        </button>\r\n                      </Badge>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Restaurant List */}\r\n            <div className=\"flex-1 overflow-y-auto px-4 min-h-0\">\r\n              <div className=\"space-y-1 pb-4\">\r\n                {filteredRestaurants.map((restaurant) => (\r\n                  <RestaurantItem\r\n                    key={restaurant.id}\r\n                    restaurant={restaurant}\r\n                    isSelected={pendingValue.includes(restaurant.id)}\r\n                    onToggle={() => toggleRestaurant(restaurant.id)}\r\n                  />\r\n                ))}\r\n\r\n                {filteredRestaurants.length === 0 && search && (\r\n                  <div className=\"py-6 text-center text-muted-foreground\">\r\n                    {t(\"community.noRestaurantFound\", \"æœªæ‰¾åˆ°åŒ¹é…çš„é¤å…\")}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Footer Buttons */}\r\n            <DrawerFooter className=\"pt-2\">\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => handleOpenChange(false)}\r\n                >\r\n                  {t(\"common.cancel\", \"å–æ¶ˆ\")}\r\n                </Button>\r\n                <Button className=\"flex-1\" onClick={handleConfirm}>\r\n                  {t(\"community.confirmSelection\", \"ç¡®è®¤é€‰æ‹©\")}\r\n                  {pendingValue.length > 0 && ` (${pendingValue.length})`}\r\n                </Button>\r\n              </div>\r\n            </DrawerFooter>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover\r\n  return (\r\n    <Popover open={open} onOpenChange={handleOpenChange}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-80 p-0\" align=\"start\">\r\n        <div className=\"p-3 border-b\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n            <Input\r\n              placeholder={t(\"community.searchRestaurant\", \"æœç´¢é¤å…...\")}\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              className=\"pl-9\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Selected Preview */}\r\n        {value.length > 0 && (\r\n          <div className=\"p-3 border-b\">\r\n            <div className=\"flex flex-wrap gap-1.5\">\r\n              {value.map((id) => {\r\n                const restaurant = restaurants?.find((r) => r.id === id);\r\n                if (!restaurant) return null;\r\n                return (\r\n                  <Badge\r\n                    key={id}\r\n                    variant=\"secondary\"\r\n                    className=\"gap-1 pr-1\"\r\n                  >\r\n                    <span className=\"truncate max-w-[100px]\">\r\n                      {getLocalizedField(restaurant, \"name\")}\r\n                    </span>\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"hover:bg-muted-foreground/20 rounded-full p-0.5\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        handleDesktopToggle(id);\r\n                      }}\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </Badge>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"max-h-64 overflow-y-auto p-2\">\r\n          {filteredRestaurants.map((restaurant) => (\r\n            <RestaurantItem\r\n              key={restaurant.id}\r\n              restaurant={restaurant}\r\n              isSelected={value.includes(restaurant.id)}\r\n              onToggle={() => handleDesktopToggle(restaurant.id)}\r\n            />\r\n          ))}\r\n          \r\n          {filteredRestaurants.length === 0 && search && (\r\n            <div className=\"py-4 text-center text-muted-foreground text-sm\">\r\n              {t(\"community.noRestaurantFound\", \"æœªæ‰¾åˆ°åŒ¹é…çš„é¤å…\")}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default MultiRestaurantSelectDrawer;\r\n","import * as React from \"react\";\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\r\nimport { Command as CommandPrimitive } from \"cmdk\";\r\nimport { Search } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCommand.displayName = CommandPrimitive.displayName;\r\n\r\ninterface CommandDialogProps extends DialogProps {}\r\n\r\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName;\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName;\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\r\n));\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName;\r\n\r\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\r\n};\r\nCommandShortcut.displayName = \"CommandShortcut\";\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n};\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, ChevronsUpDown, Calendar } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n  DrawerFooter,\r\n} from \"@/components/ui/drawer\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Command,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandList,\r\n} from \"@/components/ui/command\";\r\n\r\ninterface Activity {\r\n  id: string;\r\n  title_zh?: string;\r\n  title_en?: string;\r\n  title_pt?: string;\r\n  status?: string;\r\n}\r\n\r\ninterface ActivitySelectDrawerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  value: string;\r\n  onSelect: (activityId: string) => void;\r\n  activities: Activity[];\r\n}\r\n\r\nconst ActivitySelectDrawer = ({\r\n  open,\r\n  onOpenChange,\r\n  value,\r\n  onSelect,\r\n  activities,\r\n}: ActivitySelectDrawerProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const [pendingValue, setPendingValue] = useState(value);\r\n\r\n  // Reset pending value when drawer opens\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    if (newOpen) {\r\n      setPendingValue(value);\r\n    }\r\n    onOpenChange(newOpen);\r\n  };\r\n\r\n  // Get selected activity name\r\n  const getSelectedName = () => {\r\n    if (!value) return \"\";\r\n    const selected = activities?.find((a) => a.id === value);\r\n    return selected ? getLocalizedField(selected, \"title\") : \"\";\r\n  };\r\n\r\n  // Handle confirm (mobile only)\r\n  const handleConfirm = () => {\r\n    onSelect(pendingValue);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // Handle select (desktop - immediate)\r\n  const handleDesktopSelect = (activityId: string) => {\r\n    onSelect(activityId);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // Trigger button\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors\"\r\n      onClick={() => handleOpenChange(true)}\r\n    >\r\n      {value ? (\r\n        <span className=\"text-primary\">{getSelectedName()}</span>\r\n      ) : (\r\n        <span className=\"text-muted-foreground\">\r\n          {t(\"community.linkActivity\", \"å…³è”æ´»åŠ¨\")}\r\n        </span>\r\n      )}\r\n      <ChevronsUpDown className=\"h-4 w-4 opacity-50\" />\r\n    </button>\r\n  );\r\n\r\n  // Mobile: Full-screen Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={handleOpenChange}>\r\n          <DrawerContent className=\"max-h-[85vh] flex flex-col\">\r\n            <DrawerHeader className=\"pb-2\">\r\n              <DrawerTitle>{t(\"community.selectActivity\", \"é€‰æ‹©æ´»åŠ¨\")}</DrawerTitle>\r\n            </DrawerHeader>\r\n\r\n            {/* Activity List */}\r\n            <ScrollArea className=\"flex-1 px-4\">\r\n              <div className=\"space-y-1 pb-4\">\r\n                {/* None option */}\r\n                <div\r\n                  className={cn(\r\n                    \"flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                    pendingValue === \"\" ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                  )}\r\n                  onClick={() => setPendingValue(\"\")}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"h-4 w-4 shrink-0\",\r\n                      pendingValue === \"\" ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  <span className=\"text-muted-foreground\">\r\n                    {t(\"community.noActivity\", \"ä¸å…³è”æ´»åŠ¨\")}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Activity items */}\r\n                {activities.map((activity) => (\r\n                  <div\r\n                    key={activity.id}\r\n                    className={cn(\r\n                      \"flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors\",\r\n                      pendingValue === activity.id ? \"bg-primary/10\" : \"hover:bg-muted\"\r\n                    )}\r\n                    onClick={() => setPendingValue(activity.id)}\r\n                  >\r\n                    <Check\r\n                      className={cn(\r\n                        \"h-4 w-4 shrink-0\",\r\n                        pendingValue === activity.id ? \"opacity-100 text-primary\" : \"opacity-0\"\r\n                      )}\r\n                    />\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Calendar className=\"h-4 w-4 text-muted-foreground shrink-0\" />\r\n                      <span className=\"font-medium\">\r\n                        {getLocalizedField(activity, \"title\")}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n\r\n                {activities.length === 0 && (\r\n                  <div className=\"py-6 text-center text-muted-foreground\">\r\n                    {t(\"activities.noActivities\", \"æš‚æ— å¯ç”¨æ´»åŠ¨\")}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </ScrollArea>\r\n\r\n            {/* Footer Buttons */}\r\n            <DrawerFooter className=\"pt-2\">\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => handleOpenChange(false)}\r\n                >\r\n                  {t(\"common.cancel\", \"å–æ¶ˆ\")}\r\n                </Button>\r\n                <Button className=\"flex-1\" onClick={handleConfirm}>\r\n                  {t(\"community.confirmSelection\", \"ç¡®è®¤é€‰æ‹©\")}\r\n                </Button>\r\n              </div>\r\n            </DrawerFooter>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover with Command\r\n  return (\r\n    <Popover open={open} onOpenChange={handleOpenChange}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-72 p-0\" align=\"start\">\r\n        <Command>\r\n          <CommandList>\r\n            <CommandGroup>\r\n              <CommandItem\r\n                value=\"none\"\r\n                onSelect={() => handleDesktopSelect(\"\")}\r\n              >\r\n                <Check\r\n                  className={cn(\r\n                    \"mr-2 h-4 w-4\",\r\n                    !value ? \"opacity-100\" : \"opacity-0\"\r\n                  )}\r\n                />\r\n                {t(\"community.noActivity\", \"ä¸å…³è”æ´»åŠ¨\")}\r\n              </CommandItem>\r\n              {activities.map((activity) => (\r\n                <CommandItem\r\n                  key={activity.id}\r\n                  value={activity.id}\r\n                  onSelect={() => handleDesktopSelect(activity.id)}\r\n                >\r\n                  <Check\r\n                    className={cn(\r\n                      \"mr-2 h-4 w-4\",\r\n                      value === activity.id ? \"opacity-100\" : \"opacity-0\"\r\n                    )}\r\n                  />\r\n                  {getLocalizedField(activity, \"title\")}\r\n                </CommandItem>\r\n              ))}\r\n            </CommandGroup>\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default ActivitySelectDrawer;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Smile } from \"lucide-react\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n} from \"@/components/ui/drawer\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\n\r\ninterface EmojiPickerProps {\r\n  onSelect: (emoji: string) => void;\r\n}\r\n\r\n// Common emoji categories\r\nconst emojiCategories = [\r\n  {\r\n    name: \"smileys\",\r\n    emojis: [\"ğŸ˜€\", \"ğŸ˜ƒ\", \"ğŸ˜„\", \"ğŸ˜\", \"ğŸ˜†\", \"ğŸ˜…\", \"ğŸ¤£\", \"ğŸ˜‚\", \"ğŸ™‚\", \"ğŸ˜Š\", \"ğŸ˜‡\", \"ğŸ¥°\", \"ğŸ˜\", \"ğŸ¤©\", \"ğŸ˜˜\", \"ğŸ˜—\", \"ğŸ˜š\", \"ğŸ˜‹\", \"ğŸ˜›\", \"ğŸ˜œ\", \"ğŸ¤ª\", \"ğŸ˜\", \"ğŸ¤‘\", \"ğŸ¤—\", \"ğŸ¤­\", \"ğŸ¤«\", \"ğŸ¤”\", \"ğŸ¤\", \"ğŸ¤¨\", \"ğŸ˜\", \"ğŸ˜‘\", \"ğŸ˜¶\", \"ğŸ˜\", \"ğŸ˜’\", \"ğŸ™„\", \"ğŸ˜¬\", \"ğŸ¤¥\", \"ğŸ˜Œ\", \"ğŸ˜”\", \"ğŸ˜ª\", \"ğŸ¤¤\", \"ğŸ˜´\", \"ğŸ˜·\", \"ğŸ¤’\", \"ğŸ¤•\", \"ğŸ¤¢\", \"ğŸ¤®\", \"ğŸ¥µ\", \"ğŸ¥¶\", \"ğŸ¥´\", \"ğŸ˜µ\", \"ğŸ¤¯\", \"ğŸ¤ \", \"ğŸ¥³\", \"ğŸ˜\", \"ğŸ¤“\", \"ğŸ§\"],\r\n  },\r\n  {\r\n    name: \"gestures\",\r\n    emojis: [\"ğŸ‘\", \"ğŸ‘\", \"ğŸ‘Œ\", \"ğŸ¤Œ\", \"âœŒï¸\", \"ğŸ¤\", \"ğŸ¤Ÿ\", \"ğŸ¤˜\", \"ğŸ¤™\", \"ğŸ‘ˆ\", \"ğŸ‘‰\", \"ğŸ‘†\", \"ğŸ‘‡\", \"â˜ï¸\", \"âœ‹\", \"ğŸ¤š\", \"ğŸ–ï¸\", \"ğŸ––\", \"ğŸ‘‹\", \"ğŸ¤\", \"ğŸ™\", \"ğŸ’ª\", \"ğŸ¦¾\", \"ğŸ¦¿\", \"ğŸ¦µ\", \"ğŸ¦¶\", \"ğŸ‘‚\", \"ğŸ¦»\", \"ğŸ‘ƒ\", \"ğŸ§ \", \"ğŸ‘€\", \"ğŸ‘ï¸\", \"ğŸ‘…\", \"ğŸ‘„\"],\r\n  },\r\n  {\r\n    name: \"food\",\r\n    emojis: [\"ğŸ\", \"ğŸ\", \"ğŸ\", \"ğŸŠ\", \"ğŸ‹\", \"ğŸŒ\", \"ğŸ‰\", \"ğŸ‡\", \"ğŸ“\", \"ğŸ«\", \"ğŸˆ\", \"ğŸ’\", \"ğŸ‘\", \"ğŸ¥­\", \"ğŸ\", \"ğŸ¥¥\", \"ğŸ¥\", \"ğŸ…\", \"ğŸ†\", \"ğŸ¥‘\", \"ğŸ¥¦\", \"ğŸ¥¬\", \"ğŸ¥’\", \"ğŸŒ¶ï¸\", \"ğŸ«‘\", \"ğŸŒ½\", \"ğŸ¥•\", \"ğŸ§„\", \"ğŸ§…\", \"ğŸ¥”\", \"ğŸ \", \"ğŸ¥\", \"ğŸ¥¯\", \"ğŸ\", \"ğŸ¥–\", \"ğŸ¥¨\", \"ğŸ§€\", \"ğŸ¥š\", \"ğŸ³\", \"ğŸ§ˆ\", \"ğŸ¥\", \"ğŸ§‡\", \"ğŸ¥“\", \"ğŸ¥©\", \"ğŸ—\", \"ğŸ–\", \"ğŸ¦´\", \"ğŸŒ­\", \"ğŸ”\", \"ğŸŸ\", \"ğŸ•\", \"ğŸ«“\", \"ğŸ¥ª\", \"ğŸ¥™\", \"ğŸ§†\", \"ğŸŒ®\", \"ğŸŒ¯\", \"ğŸ«”\", \"ğŸ¥—\", \"ğŸ¥˜\", \"ğŸ«•\", \"ğŸ¥«\", \"ğŸ\", \"ğŸœ\", \"ğŸ²\", \"ğŸ›\", \"ğŸ£\", \"ğŸ±\", \"ğŸ¥Ÿ\", \"ğŸ¦ª\", \"ğŸ¤\", \"ğŸ™\", \"ğŸš\", \"ğŸ˜\", \"ğŸ¥\", \"ğŸ¥ \", \"ğŸ¥®\", \"ğŸ¢\", \"ğŸ¡\", \"ğŸ§\", \"ğŸ¨\", \"ğŸ¦\", \"ğŸ¥§\", \"ğŸ§\", \"ğŸ°\", \"ğŸ‚\", \"ğŸ®\", \"ğŸ­\", \"ğŸ¬\", \"ğŸ«\", \"ğŸ¿\", \"ğŸ©\", \"ğŸª\"],\r\n  },\r\n  {\r\n    name: \"hearts\",\r\n    emojis: [\"â¤ï¸\", \"ğŸ§¡\", \"ğŸ’›\", \"ğŸ’š\", \"ğŸ’™\", \"ğŸ’œ\", \"ğŸ–¤\", \"ğŸ¤\", \"ğŸ¤\", \"ğŸ’”\", \"â£ï¸\", \"ğŸ’•\", \"ğŸ’\", \"ğŸ’“\", \"ğŸ’—\", \"ğŸ’–\", \"ğŸ’˜\", \"ğŸ’\", \"ğŸ’Ÿ\", \"â™¥ï¸\"],\r\n  },\r\n  {\r\n    name: \"objects\",\r\n    emojis: [\"â­\", \"ğŸŒŸ\", \"âœ¨\", \"ğŸ’«\", \"ğŸ”¥\", \"ğŸ’¯\", \"ğŸ‰\", \"ğŸŠ\", \"ğŸˆ\", \"ğŸ\", \"ğŸ†\", \"ğŸ¥‡\", \"ğŸ¥ˆ\", \"ğŸ¥‰\", \"âš½\", \"ğŸ€\", \"ğŸˆ\", \"âš¾\", \"ğŸ¾\", \"ğŸ\", \"ğŸ±\", \"ğŸ“\", \"ğŸ®\", \"ğŸ²\", \"ğŸ§©\", \"ğŸ­\", \"ğŸ¨\", \"ğŸ¬\", \"ğŸ¤\", \"ğŸ§\", \"ğŸµ\", \"ğŸ¶\", \"ğŸ¹\", \"ğŸ¸\", \"ğŸº\", \"ğŸ»\", \"ğŸ“·\", \"ğŸ“¸\", \"ğŸ“¹\", \"ğŸ¥\", \"ğŸ“±\", \"ğŸ’»\", \"âŒ¨ï¸\", \"ğŸ–¥ï¸\", \"ğŸ“º\", \"ğŸ“»\", \"â°\", \"âŒš\", \"ğŸ’¡\", \"ğŸ”¦\", \"ğŸ“š\", \"ğŸ“–\", \"âœï¸\", \"ğŸ“\", \"ğŸ’°\", \"ğŸ’µ\", \"ğŸ’´\", \"ğŸ’¶\", \"ğŸ’·\", \"ğŸ’³\", \"ğŸ›’\", \"ğŸ€\", \"ğŸ—ï¸\"],\r\n  },\r\n  {\r\n    name: \"nature\",\r\n    emojis: [\"ğŸŒ¸\", \"ğŸ’®\", \"ğŸµï¸\", \"ğŸŒ¹\", \"ğŸ¥€\", \"ğŸŒº\", \"ğŸŒ»\", \"ğŸŒ¼\", \"ğŸŒ·\", \"ğŸŒ±\", \"ğŸª´\", \"ğŸŒ²\", \"ğŸŒ³\", \"ğŸŒ´\", \"ğŸŒµ\", \"ğŸŒ¾\", \"ğŸŒ¿\", \"â˜˜ï¸\", \"ğŸ€\", \"ğŸ\", \"ğŸ‚\", \"ğŸƒ\", \"ğŸŒ\", \"ğŸŒ\", \"ğŸŒ\", \"ğŸŒ™\", \"â­\", \"â˜€ï¸\", \"ğŸŒ¤ï¸\", \"â›…\", \"ğŸŒ¥ï¸\", \"â˜ï¸\", \"ğŸŒ¦ï¸\", \"ğŸŒ§ï¸\", \"â›ˆï¸\", \"ğŸŒ©ï¸\", \"ğŸŒ¨ï¸\", \"â„ï¸\", \"â˜ƒï¸\", \"â›„\", \"ğŸŒ¬ï¸\", \"ğŸ’¨\", \"ğŸŒŠ\", \"ğŸ’§\", \"ğŸ’¦\", \"â˜”\", \"ğŸŒˆ\"],\r\n  },\r\n];\r\n\r\nconst EmojiPicker = ({ onSelect }: EmojiPickerProps) => {\r\n  const { t } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [open, setOpen] = useState(false);\r\n  const [activeCategory, setActiveCategory] = useState(0);\r\n\r\n  const handleSelect = (emoji: string) => {\r\n    onSelect(emoji);\r\n    if (!isMobile) {\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const categoryLabels: Record<string, string> = {\r\n    smileys: t(\"emoji.smileys\", \"è¡¨æƒ…\"),\r\n    gestures: t(\"emoji.gestures\", \"æ‰‹åŠ¿\"),\r\n    food: t(\"emoji.food\", \"ç¾é£Ÿ\"),\r\n    hearts: t(\"emoji.hearts\", \"çˆ±å¿ƒ\"),\r\n    objects: t(\"emoji.objects\", \"ç‰©å“\"),\r\n    nature: t(\"emoji.nature\", \"è‡ªç„¶\"),\r\n  };\r\n\r\n  const emojiGrid = (\r\n    <div className=\"space-y-3\">\r\n      {/* Category tabs */}\r\n      <div className=\"flex gap-1 overflow-x-auto pb-2 border-b\">\r\n        {emojiCategories.map((category, index) => (\r\n          <button\r\n            key={category.name}\r\n            type=\"button\"\r\n            onClick={() => setActiveCategory(index)}\r\n            className={`px-3 py-1.5 text-sm rounded-full whitespace-nowrap transition-colors ${\r\n              activeCategory === index\r\n                ? \"bg-primary text-primary-foreground\"\r\n                : \"bg-muted hover:bg-muted/80 text-muted-foreground\"\r\n            }`}\r\n          >\r\n            {categoryLabels[category.name]}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Emoji grid */}\r\n      <div className=\"grid grid-cols-8 gap-1\">\r\n        {emojiCategories[activeCategory].emojis.map((emoji, index) => (\r\n          <button\r\n            key={index}\r\n            type=\"button\"\r\n            onClick={() => handleSelect(emoji)}\r\n            className=\"w-9 h-9 flex items-center justify-center text-xl hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            {emoji}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const triggerButton = (\r\n    <button\r\n      type=\"button\"\r\n      onClick={() => setOpen(true)}\r\n      className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground transition-colors\"\r\n    >\r\n      <Smile className=\"h-5 w-5\" />\r\n      <span className=\"text-sm\">{t(\"community.emoji\", \"è¡¨æƒ…\")}</span>\r\n    </button>\r\n  );\r\n\r\n  // Mobile: Drawer\r\n  if (isMobile) {\r\n    return (\r\n      <>\r\n        {triggerButton}\r\n        <Drawer open={open} onOpenChange={setOpen}>\r\n          <DrawerContent className=\"h-[50vh]\">\r\n            <DrawerHeader className=\"pb-2\">\r\n              <DrawerTitle>{t(\"emoji.title\", \"é€‰æ‹©è¡¨æƒ…\")}</DrawerTitle>\r\n            </DrawerHeader>\r\n            <ScrollArea className=\"flex-1 px-4 pb-4\">\r\n              {emojiGrid}\r\n            </ScrollArea>\r\n          </DrawerContent>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Desktop: Popover\r\n  return (\r\n    <Popover open={open} onOpenChange={setOpen}>\r\n      <PopoverTrigger asChild>{triggerButton}</PopoverTrigger>\r\n      <PopoverContent className=\"w-80 p-3\" align=\"start\" side=\"top\">\r\n        {emojiGrid}\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default EmojiPicker;\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Image, Video, X, Loader2, Calendar, MapPin, Gift, ArrowLeft } from \"lucide-react\";\r\nimport PostPointsRulesDialog from \"./PostPointsRulesDialog\";\r\nimport MultiRestaurantSelectDrawer from \"./MultiRestaurantSelectDrawer\";\r\nimport ActivitySelectDrawer from \"./ActivitySelectDrawer\";\r\nimport EmojiPicker from \"./EmojiPicker\";\r\nimport {\r\n  Sheet,\r\n  SheetContent,\r\n  SheetTitle,\r\n  SheetTrigger,\r\n} from \"@/components/ui/sheet\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useCreatePost, useMerchantRestaurant, useHasPostedToday } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\";\r\n\r\ninterface CreatePostDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreatePostDialog = ({ trigger }: CreatePostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const createPost = useCreatePost();\r\n  const { data: activities } = useActivities();\r\n  const { data: restaurants } = useRestaurants();\r\n  const { role, isMerchant, isAdmin, isSupervisor } = useUserRole();\r\n  const { data: merchantRestaurant } = useMerchantRestaurant();\r\n  const { data: hasPostedToday, isLoading: checkingPost } = useHasPostedToday();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const [content, setContent] = useState(\"\");\r\n  const [imageUrls, setImageUrls] = useState<string[]>([]);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n  const [activityId, setActivityId] = useState<string>(\"\");\r\n  const [restaurantIds, setRestaurantIds] = useState<string[]>([]);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [restaurantOpen, setRestaurantOpen] = useState(false);\r\n  const [activityOpen, setActivityOpen] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // æ™®é€šç”¨æˆ· = æ—¢ä¸æ˜¯å•†å®¶ã€ç£å¯¼ä¹Ÿä¸æ˜¯ç®¡ç†å‘˜\r\n  const isRegularUser = !isMerchant && !isSupervisor && !isAdmin;\r\n\r\n  // å•†å®¶è‡ªåŠ¨è®¾ç½®é¤å…\r\n  useEffect(() => {\r\n    if (isMerchant && merchantRestaurant && open) {\r\n      setRestaurantIds([merchantRestaurant.id]);\r\n    }\r\n  }, [isMerchant, merchantRestaurant, open]);\r\n\r\n  // é‡ç½®è¡¨å•\r\n  const resetForm = () => {\r\n    setContent(\"\");\r\n    setImageUrls([]);\r\n    setVideoUrl(null);\r\n    setActivityId(\"\");\r\n    setRestaurantIds([]);\r\n    setRestaurantOpen(false);\r\n    setActivityOpen(false);\r\n  };\r\n\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    setOpen(newOpen);\r\n    if (!newOpen) {\r\n      resetForm();\r\n    }\r\n  };\r\n\r\n  // Get active activities\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"æœ€å¤šä¸Šä¼ 9å¼ å›¾ç‰‡\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  // Extract first frame from video file\r\n  const extractVideoFirstFrame = (videoFile: File): Promise<Blob> => {\r\n    return new Promise((resolve, reject) => {\r\n      const video = document.createElement('video');\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      video.preload = 'auto';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      let hasResolved = false;\r\n      \r\n      const captureFrame = () => {\r\n        if (hasResolved) return;\r\n        if (video.videoWidth === 0 || video.videoHeight === 0) return;\r\n        \r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        \r\n        if (ctx) {\r\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n          canvas.toBlob((blob) => {\r\n            if (blob && blob.size > 0) {\r\n              hasResolved = true;\r\n              video.pause();\r\n              URL.revokeObjectURL(video.src);\r\n              resolve(blob);\r\n            } else {\r\n              reject(new Error('Failed to create blob'));\r\n            }\r\n          }, 'image/jpeg', 0.85);\r\n        }\r\n      };\r\n      \r\n      video.onloadedmetadata = () => {\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        video.currentTime = 0.1; // Jump to 0.1s to ensure frame is available\r\n      };\r\n      \r\n      video.onseeked = () => {\r\n        setTimeout(captureFrame, 100);\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(video.src);\r\n        reject(new Error('Failed to load video'));\r\n      };\r\n      \r\n      // Timeout handling\r\n      setTimeout(() => {\r\n        if (!hasResolved) {\r\n          URL.revokeObjectURL(video.src);\r\n          reject(new Error('Timeout'));\r\n        }\r\n      }, 10000);\r\n      \r\n      video.src = URL.createObjectURL(videoFile);\r\n      video.load();\r\n    });\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Check file size (max 100MB)\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"è§†é¢‘ä¸èƒ½è¶…è¿‡100MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      // 1. Upload video\r\n      const videoExt = file.name.split(\".\").pop();\r\n      const videoFileName = `${user.id}/${Date.now()}.${videoExt}`;\r\n\r\n      const { error: videoError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(videoFileName, file);\r\n\r\n      if (videoError) throw videoError;\r\n\r\n      const { data: { publicUrl: videoPublicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(videoFileName);\r\n\r\n      setVideoUrl(videoPublicUrl);\r\n\r\n      // 2. Extract and upload cover image\r\n      try {\r\n        toast.info(t(\"community.extractingCover\", \"æ­£åœ¨æå–è§†é¢‘å°é¢...\"));\r\n        const coverBlob = await extractVideoFirstFrame(file);\r\n        const coverFileName = `${user.id}/${Date.now()}-cover.jpg`;\r\n        \r\n        const { error: coverError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(coverFileName, coverBlob);\r\n        \r\n        if (!coverError) {\r\n          const { data: { publicUrl: coverUrl } } = supabase.storage\r\n            .from(\"community-posts\")\r\n            .getPublicUrl(coverFileName);\r\n          \r\n          // Add cover image to the beginning of imageUrls\r\n          setImageUrls(prev => [coverUrl, ...prev]);\r\n          toast.success(t(\"community.coverExtracted\", \"å°é¢å·²è‡ªåŠ¨ç”Ÿæˆ\"));\r\n        }\r\n      } catch (coverError) {\r\n        console.warn(\"Cover extraction failed:\", coverError);\r\n        // Cover extraction failure should not block video upload\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"ä¸Šä¼ å¤±è´¥\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) {\r\n        videoInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n    // Remove auto-generated cover image (URL contains -cover.jpg)\r\n    setImageUrls(prev => {\r\n      if (prev.length > 0 && prev[0].includes('-cover.jpg')) {\r\n        return prev.slice(1);\r\n      }\r\n      return prev;\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"è¯·è¾“å…¥å†…å®¹\"));\r\n      return;\r\n    }\r\n\r\n    // æ™®é€šç”¨æˆ·å¿…é¡»é€‰æ‹©é¤å…\r\n    if (isRegularUser && restaurantIds.length === 0) {\r\n      toast.error(t(\"community.restaurantRequired\", \"è¯·é€‰æ‹©é¤å…\"));\r\n      return;\r\n    }\r\n\r\n    await createPost.mutateAsync({\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl || undefined,\r\n      activity_id: activityId || undefined,\r\n      restaurant_ids: restaurantIds.length > 0 ? restaurantIds : undefined,\r\n    });\r\n\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n\r\n  // è·å–å•†å®¶é¤å…åç§°\r\n  const getMerchantRestaurantName = () => {\r\n    if (!merchantRestaurant) return t(\"community.noRestaurant\", \"æœªå…³è”é¤å…\");\r\n    return getLocalizedField(merchantRestaurant, \"name\");\r\n  };\r\n\r\n  return (\r\n    <Sheet open={open} onOpenChange={handleOpenChange}>\r\n      <SheetTrigger asChild>\r\n        {trigger || (\r\n          <Button>{t(\"community.createPost\", \"å‘å¸ƒå¸–å­\")}</Button>\r\n        )}\r\n      </SheetTrigger>\r\n      <SheetContent \r\n        side=\"bottom\" \r\n        className=\"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden\"\r\n      >\r\n        <VisuallyHidden.Root>\r\n          <SheetTitle>{t(\"community.createPost\", \"å‘å¸ƒå¸–å­\")}</SheetTitle>\r\n        </VisuallyHidden.Root>\r\n\r\n        {/* é¡¶éƒ¨å¯¼èˆªæ  - å›ºå®š */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setOpen(false)}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={handleSubmit}\r\n            disabled={createPost.isPending || !content.trim()}\r\n            className=\"rounded-full px-6\"\r\n          >\r\n            {createPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            {t(\"community.publish\", \"å‘å¸ƒ\")}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* å¯æ»šåŠ¨å†…å®¹åŒº */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          <div className=\"px-4 py-4 space-y-4\">\r\n            {/* Points Hint - Only show if user hasn't posted today */}\r\n            {!checkingPost && !hasPostedToday && (\r\n              <div className=\"flex items-center justify-between gap-2 px-3 py-2 bg-primary/10 dark:bg-primary/20 border border-primary/30 dark:border-primary/40 rounded-md text-sm text-primary dark:text-primary\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Gift className=\"h-4 w-4 shrink-0\" />\r\n                  <span>{t(\"community.dailyPointsHint\", \"æ¯æ—¥å‘å¸ƒé¦–ä¸ªå¸–å­å¯è·å¾—5ç§¯åˆ†ï¼\")}</span>\r\n                </div>\r\n                <PostPointsRulesDialog />\r\n              </div>\r\n            )}\r\n\r\n            {/* å†…å®¹è¾“å…¥åŒº */}\r\n            <Textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder={t(\"community.contentPlaceholder\", \"åˆ†äº«ä½ çš„æƒ³æ³•...\")}\r\n              className=\"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base whitespace-pre-wrap\"\r\n            />\r\n\r\n            {/* å›¾ç‰‡é¢„è§ˆ */}\r\n            {imageUrls.length > 0 && (\r\n              <div className=\"grid grid-cols-3 gap-2\">\r\n                {imageUrls.map((url, index) => (\r\n                  <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden bg-muted\">\r\n                    <img \r\n                      src={url} \r\n                      alt=\"\" \r\n                      className=\"w-full h-full object-cover\" \r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => removeImage(index)}\r\n                      className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* è§†é¢‘é¢„è§ˆ */}\r\n            {videoUrl && (\r\n              <div className=\"relative rounded-lg overflow-hidden\">\r\n                <video src={videoUrl} controls className=\"w-full max-h-48\" preload=\"metadata\" />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={removeVideo}\r\n                  className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                >\r\n                  <X className=\"h-4 w-4\" />\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* å…³è”ä¿¡æ¯åŒº */}\r\n        <div className=\"px-4 py-2 pb-0 bg-background shrink-0 flex items-center gap-6\">\r\n          {/* é¤å…é€‰æ‹© */}\r\n          <div className=\"flex items-center gap-3\">\r\n            <MapPin className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n            {isMerchant ? (\r\n              <span className=\"text-sm text-muted-foreground\">\r\n                {getMerchantRestaurantName()}\r\n              </span>\r\n            ) : (\r\n              <MultiRestaurantSelectDrawer\r\n                open={restaurantOpen}\r\n                onOpenChange={setRestaurantOpen}\r\n                value={restaurantIds}\r\n                onSelect={setRestaurantIds}\r\n                restaurants={restaurants || []}\r\n                required={isRegularUser}\r\n              />\r\n            )}\r\n          </div>\r\n\r\n          {/* æ´»åŠ¨é€‰æ‹© */}\r\n          <div className=\"flex items-center gap-3\">\r\n            <Calendar className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n            <ActivitySelectDrawer\r\n              open={activityOpen}\r\n              onOpenChange={setActivityOpen}\r\n              value={activityId}\r\n              onSelect={setActivityId}\r\n              activities={activeActivities}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* åº•éƒ¨åª’ä½“å·¥å…·æ  - å›ºå®š */}\r\n        <div className=\"flex items-center gap-6 px-4 pt-0 py-2 pb-[max(2rem,calc(env(safe-area-inset-bottom)+1rem))] bg-background shrink-0\">\r\n          <input\r\n            ref={imageInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            multiple\r\n            className=\"hidden\"\r\n            onChange={handleImageUpload}\r\n          />\r\n          <input\r\n            ref={videoInputRef}\r\n            type=\"file\"\r\n            accept=\"video/*\"\r\n            className=\"hidden\"\r\n            onChange={handleVideoUpload}\r\n          />\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => imageInputRef.current?.click()}\r\n            disabled={uploading || imageUrls.length >= 9}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Image className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.photo\", \"ç…§ç‰‡\")}</span>\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => videoInputRef.current?.click()}\r\n            disabled={uploading || !!videoUrl}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Video className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.video\", \"è§†é¢‘\")}</span>\r\n          </button>\r\n\r\n          <EmojiPicker\r\n            onSelect={(emoji) => setContent((prev) => prev + emoji)}\r\n          />\r\n\r\n          {uploading && <Loader2 className=\"h-5 w-5 animate-spin ml-auto\" />}\r\n        </div>\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default CreatePostDialog;\r\n","import { useCallback, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus, LayoutGrid, List, Clock, Flame } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport CreatePostDialog from \"@/components/community/CreatePostDialog\";\r\nimport { useCommunityPosts, useCanCreatePost, SortOption } from \"@/hooks/useCommunityPosts\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\n\r\n// Skeleton for grid card\r\nconst PostGridSkeleton = () => (\r\n  <div className=\"rounded-xl overflow-hidden bg-card border border-border/50\">\r\n    <Skeleton className=\"aspect-[4/5] w-full\" />\r\n    <div className=\"p-3 space-y-3\">\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-4 w-full\" />\r\n        <Skeleton className=\"h-4 w-3/4\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-5 w-5 rounded-full\" />\r\n          <Skeleton className=\"h-3 w-16\" />\r\n        </div>\r\n        <Skeleton className=\"h-4 w-10\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst Community = () => {\r\n  const { t } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const isMobile = useIsMobile();\r\n  \r\n  // Layout state: 'double' for 2 columns, 'single' for 1 column (mobile only)\r\n  const [mobileLayout, setMobileLayout] = useState<'double' | 'single'>(() => {\r\n    const saved = localStorage.getItem('community-mobile-layout');\r\n    return (saved === 'single' ? 'single' : 'double') as 'double' | 'single';\r\n  });\r\n\r\n  // Sort state\r\n  const [sortBy, setSortBy] = useState<SortOption>(() => {\r\n    const saved = localStorage.getItem('community-sort');\r\n    return (saved === 'popular' ? 'popular' : 'latest') as SortOption;\r\n  });\r\n  \r\n  const { data: posts, isLoading } = useCommunityPosts({\r\n    status: \"approved\",\r\n    sortBy\r\n  });\r\n  const { data: canPost } = useCanCreatePost();\r\n  \r\n  // Pull-to-refresh handler - clears cache and forces fresh data\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear caches first to ensure fresh data\r\n    queryClient.removeQueries({ queryKey: ['community-posts'] });\r\n    queryClient.removeQueries({ queryKey: ['can-create-post'] });\r\n    queryClient.removeQueries({ queryKey: ['has-posted-today'] });\r\n    \r\n    // Refetch with fresh data\r\n    await Promise.all([\r\n      queryClient.invalidateQueries({ queryKey: ['community-posts'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['can-create-post'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['has-posted-today'] }),\r\n    ]);\r\n  }, [queryClient]);\r\n\r\n  const toggleMobileLayout = () => {\r\n    const newLayout = mobileLayout === 'double' ? 'single' : 'double';\r\n    setMobileLayout(newLayout);\r\n    localStorage.setItem('community-mobile-layout', newLayout);\r\n  };\r\n\r\n  const handleSortChange = (value: string) => {\r\n    const newSort = value as SortOption;\r\n    setSortBy(newSort);\r\n    localStorage.setItem('community-sort', newSort);\r\n  };\r\n\r\n  // Grid classes based on layout\r\n  // Desktop (lg+): 4 columns, Tablet (md): 3 columns, Mobile: 1 or 2 based on toggle\r\n  const getGridClasses = () => {\r\n    if (isMobile) {\r\n      return mobileLayout === 'single' \r\n        ? 'columns-1 gap-4' \r\n        : 'columns-2 gap-3';\r\n    }\r\n    // Tablet: 3 columns, Desktop: 4 columns\r\n    return 'columns-3 lg:columns-4 gap-4';\r\n  };\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in\">\r\n        <div className=\"container mx-auto max-w-5xl\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <div>\r\n              <h1 className=\"text-3xl sm:text-4xl mb-2 text-primary font-medium\">\r\n                {t(\"community.title\", \"ç¤¾åŒº\")}\r\n              </h1>\r\n              <p className=\"text-muted-foreground text-base sm:text-lg\">\r\n                {t(\"community.description\", \"åˆ†äº«ç¾é£Ÿä½“éªŒï¼Œå‘ç°æ›´å¤šç²¾å½©\")}\r\n              </p>\r\n            </div>\r\n            {canPost && (\r\n              <CreatePostDialog\r\n                trigger={\r\n                  <Button size=\"sm\" className=\"gap-1.5\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"å‘å¸ƒ\")}</span>\r\n                  </Button>\r\n                }\r\n              />\r\n            )}\r\n          </div>\r\n          \r\n          {/* Sort and Layout controls */}\r\n          <div className=\"flex items-center mb-4\">\r\n            {/* Combined sort tabs and layout toggle */}\r\n            <div className=\"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n              <button\r\n                onClick={() => handleSortChange('latest')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  sortBy === 'latest' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Clock className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.sortLatest\", \"æœ€æ–°\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={() => handleSortChange('popular')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  sortBy === 'popular' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Flame className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.sortPopular\", \"çƒ­é—¨\")}</span>\r\n              </button>\r\n              {/* Layout toggle - only show on mobile */}\r\n              {isMobile && (\r\n                <button\r\n                  onClick={toggleMobileLayout}\r\n                  className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-2.5 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\r\n                  title={mobileLayout === 'double' \r\n                    ? t(\"community.singleColumn\", \"å•åˆ—å¸ƒå±€\") \r\n                    : t(\"community.doubleColumn\", \"åŒåˆ—å¸ƒå±€\")}\r\n                >\r\n                  {mobileLayout === 'double' ? (\r\n                    <List className=\"h-3.5 w-3.5\" />\r\n                  ) : (\r\n                    <LayoutGrid className=\"h-3.5 w-3.5\" />\r\n                  )}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          {isLoading ? (\r\n            // Loading skeleton\r\n            <div className={getGridClasses()}>\r\n              {Array.from({ length: 8 }).map((_, i) => (\r\n                <div key={i} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                  <PostGridSkeleton />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : posts && posts.length > 0 ? (\r\n            // Masonry Grid\r\n            <div className={getGridClasses()}>\r\n              {posts.map(post => (\r\n                <div key={post.id} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                  <PostGridCard \r\n                    post={post} \r\n                    showAssociations={isMobile && mobileLayout === 'single'}\r\n                  />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            // Empty state\r\n            <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\r\n              <div className=\"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4\">\r\n                <Plus className=\"w-8 h-8 text-muted-foreground/50\" />\r\n              </div>\r\n              <p className=\"text-muted-foreground text-lg\">\r\n                {t(\"community.noPosts\", \"æš‚æ— å¸–å­\")}\r\n              </p>\r\n              {canPost && (\r\n                <p className=\"mt-2 text-sm text-muted-foreground/70\">\r\n                  {t(\"community.beFirst\", \"æˆä¸ºç¬¬ä¸€ä¸ªå‘å¸–çš„äººå§ï¼\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Community;\r\n"],"names":["PostGridCard","post","showAssociations","t","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","imageError","setImageError","useState","handleLike","e","handleCardClick","handleRestaurantClick","restaurantId","handleActivityClick","getPlainTextContent","html","content","plainContent","hasImages","hasVideo","hasMedia","imageCount","allRestaurants","r","activityTitle","maxVisibleRestaurants","jsxs","jsx","Play","Images","restaurant","Badge","Store","Calendar","Avatar","AvatarImage","AvatarFallback","Heart","PostPointsRulesDialog","settings","usePointsSettings","postPoints","s","minLength","requireMedia","Dialog","DialogTrigger","DialogContent","DialogHeader","DialogTitle","Gift","CheckCircle","Clock","Shield","MultiRestaurantSelectDrawer","open","onOpenChange","value","onSelect","restaurants","required","maxDisplay","isMobile","useIsMobile","search","setSearch","pendingValue","setPendingValue","drawerHeight","setDrawerHeight","useEffect","viewport","updateHeight","availableHeight","targetHeight","handleOpenChange","newOpen","filteredRestaurants","name","address","searchLower","toggleRestaurant","prev","id","handleConfirm","handleDesktopToggle","newValue","selectedNames","TriggerContent","displayNames","remaining","i","triggerButton","ChevronsUpDown","RestaurantItem","isSelected","onToggle","cn","Check","MapPin","Fragment","Drawer","DrawerContent","DrawerHeader","DrawerTitle","Search","Input","X","DrawerFooter","Button","Popover","PopoverTrigger","PopoverContent","Command","React.forwardRef","className","props","ref","CommandPrimitive","CommandInput","CommandList","CommandEmpty","CommandGroup","CommandSeparator","CommandItem","ActivitySelectDrawer","activities","getSelectedName","selected","a","handleDesktopSelect","activityId","ScrollArea","activity","emojiCategories","EmojiPicker","setOpen","activeCategory","setActiveCategory","handleSelect","emoji","categoryLabels","emojiGrid","category","index","Smile","CreatePostDialog","trigger","createPost","useCreatePost","useActivities","useRestaurants","role","isMerchant","isAdmin","isSupervisor","useUserRole","merchantRestaurant","useMerchantRestaurant","hasPostedToday","checkingPost","useHasPostedToday","setContent","imageUrls","setImageUrls","videoUrl","setVideoUrl","setActivityId","restaurantIds","setRestaurantIds","uploading","setUploading","restaurantOpen","setRestaurantOpen","activityOpen","setActivityOpen","imageInputRef","useRef","videoInputRef","isRegularUser","resetForm","activeActivities","handleImageUpload","files","toast","supabase","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","error","extractVideoFirstFrame","videoFile","resolve","reject","video","canvas","ctx","hasResolved","captureFrame","blob","handleVideoUpload","videoExt","videoFileName","videoError","videoPublicUrl","coverBlob","coverFileName","coverError","coverUrl","removeImage","_","removeVideo","handleSubmit","getMerchantRestaurantName","Sheet","SheetTrigger","SheetContent","VisuallyHidden.Root","SheetTitle","ArrowLeft","Loader2","Textarea","url","Image","Video","PostGridSkeleton","Skeleton","Community","queryClient","useQueryClient","mobileLayout","setMobileLayout","sortBy","setSortBy","posts","isLoading","useCommunityPosts","canPost","useCanCreatePost","handleRefresh","useCallback","toggleMobileLayout","newLayout","handleSortChange","newSort","getGridClasses","PullToRefresh","Plus","Flame","List","LayoutGrid"],"mappings":"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"}