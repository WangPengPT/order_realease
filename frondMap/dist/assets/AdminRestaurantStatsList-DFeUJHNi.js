import{p as Q,u as H,r as p,s as j,j as e,cz as Y,cL as $,cN as G,cM as J,a_ as P,b3 as S,bQ as _,aY as C,ba as N}from"./vendor-react-Dngtq_Sc.js";import{S as v,a7 as q,a8 as D,a9 as F,aa as O,ab as n,h as R,C as u,n as h,m as W,E as X,s as f}from"./index-C6vDgFXl.js";import{u as Z}from"./useLocalizedContent-Dr5YHAdJ.js";import{f as w,s as B}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-xpVHVj_9.js";const ne=()=>{const{t}=Q(),E=H(),{localizeRestaurant:k}=Z(),[d,z]=p.useState("30days"),[y,T]=p.useState("rating"),[g,V]=p.useState("desc"),A=()=>{const s=new Date;switch(d){case"today":return w(s).toISOString();case"7days":return w(B(s,6)).toISOString();case"30days":return w(B(s,29)).toISOString();default:return null}},{data:b,isLoading:L}=j({queryKey:["admin-restaurants-stats-list"],queryFn:async()=>{const{data:s,error:a}=await f.from("restaurants").select("*").order("rating",{ascending:!1});if(a)throw a;return s}}),c=A(),{data:o}=j({queryKey:["admin-all-restaurant-view-counts",d],queryFn:async()=>{let s=f.from("page_views").select("target_id, created_at").eq("page_type","restaurant");c&&(s=s.gte("created_at",c));const{data:a,error:r}=await s;if(r)throw r;const l={};return a.forEach(i=>{i.target_id&&(l[i.target_id]=(l[i.target_id]||0)+1)}),l}}),{data:m}=j({queryKey:["admin-all-restaurant-comment-counts",d],queryFn:async()=>{let s=f.from("comments").select("target_id, created_at").eq("target_type","restaurant");c&&(s=s.gte("created_at",c));const{data:a,error:r}=await s;if(r)throw r;const l={};return a.forEach(i=>{l[i.target_id]=(l[i.target_id]||0)+1}),l}}),{data:x}=j({queryKey:["admin-all-restaurant-favorite-counts",d],queryFn:async()=>{let s=f.from("favorites").select("restaurant_id, created_at");c&&(s=s.gte("created_at",c));const{data:a,error:r}=await s;if(r)throw r;const l={};return a.forEach(i=>{l[i.restaurant_id]=(l[i.restaurant_id]||0)+1}),l}}),I=o?Object.values(o).reduce((s,a)=>s+a,0):0,K=m?Object.values(m).reduce((s,a)=>s+a,0):0,U=x?Object.values(x).reduce((s,a)=>s+a,0):0,M=b?.slice().sort((s,a)=>{let r=0;switch(y){case"views":r=(o?.[a.id]||0)-(o?.[s.id]||0);break;case"comments":r=(m?.[a.id]||0)-(m?.[s.id]||0);break;case"favorites":r=(x?.[a.id]||0)-(x?.[s.id]||0);break;case"rating":default:r=(a.rating||0)-(s.rating||0)}return g==="desc"?r:-r});return L?e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(v,{className:"h-24"},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsx(v,{className:"h-40"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:t("admin.restaurantStatistics","餐厅统计")})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(q,{value:y,onValueChange:s=>T(s),children:[e.jsx(D,{className:"w-[140px]",children:e.jsx(F,{})}),e.jsxs(O,{children:[e.jsx(n,{value:"rating",children:t("admin.sortByRating","按评分")}),e.jsx(n,{value:"views",children:t("admin.sortByViews","按浏览量")}),e.jsx(n,{value:"comments",children:t("admin.sortByComments","按评论数")}),e.jsx(n,{value:"favorites",children:t("admin.sortByFavorites","按收藏数")})]})]}),e.jsx(R,{variant:"outline",size:"icon",onClick:()=>V(g==="desc"?"asc":"desc"),title:g==="desc"?t("admin.sortDescending","从大到小"):t("admin.sortAscending","从小到大"),children:g==="desc"?e.jsx(G,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(q,{value:d,onValueChange:s=>z(s),children:[e.jsx(D,{className:"w-[140px]",children:e.jsx(F,{})}),e.jsxs(O,{children:[e.jsx(n,{value:"today",children:t("analytics.today","今日")}),e.jsx(n,{value:"7days",children:t("analytics.last7Days","近7天")}),e.jsx(n,{value:"30days",children:t("analytics.last30Days","近30天")}),e.jsx(n,{value:"all",children:t("analytics.allTime","所有时间")})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(S,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalRestaurants","餐厅总数")}),e.jsx("p",{className:"text-2xl font-bold",children:b?.length||0})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(_,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalViews","总浏览量")}),e.jsx("p",{className:"text-2xl font-bold",children:I})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(C,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalComments","总评论数")}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:e.jsx(N,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalFavorites","总收藏数")}),e.jsx("p",{className:"text-2xl font-bold",children:U})]})]})})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:t("admin.allRestaurants","所有餐厅")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M?.map(s=>{const a=k(s),r=o?.[s.id]||0,l=m?.[s.id]||0,i=x?.[s.id]||0;return e.jsxs(u,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>E(`/admin/restaurant-stats/${s.id}`),children:[e.jsx(W,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:a.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(X,{className:"text-base line-clamp-1",children:a.name}),s.rating>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(N,{className:"h-3 w-3 fill-amber-400 text-amber-400"}),e.jsx("span",{children:s.rating.toFixed(1)})]})]})]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:r}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("admin.views","浏览")})]}),e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(C,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:l}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("admin.comments","评论")})]}),e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:i}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("admin.favorites","收藏")})]})]}),e.jsx(R,{variant:"outline",size:"sm",className:"w-full mt-4",children:t("admin.viewDetails","查看详情")})]})]},s.id)})})]})]})};export{ne as default};
//# sourceMappingURL=AdminRestaurantStatsList-DFeUJHNi.js.map
