import{a as d,u as p,b as l}from"./vendor-query-BlSVl3IQ.js";import{i}from"./vendor-i18n-DxKeo2S1.js";import{y,Q as n,a3 as c}from"./index-COqZhysY.js";const v=(e,r)=>d({queryKey:["restaurants",e,r],queryFn:async()=>{let t=n.from("restaurants").select("*").eq("visible",!0).order("rating",{ascending:!1});if(e&&(t=t.or(`name.ilike.%${e}%,address.ilike.%${e}%`)),r){const o=r.split(",").flatMap(u=>[`type.cs.{${u}}`,`type_en.cs.{${u}}`,`type_pt.cs.{${u}}`]);t=t.or(o.join(","))}const{data:a,error:s}=await t;if(s)throw s;return a}}),w=e=>d({queryKey:["restaurant",e],queryFn:async()=>{const{data:r,error:t}=await n.from("restaurants").select("*").eq("id",e).single();if(t)throw t;return r},enabled:!!e}),_=()=>{const{user:e}=y();return d({queryKey:["favorites",e?.id],queryFn:async()=>{if(!e)return[];const{data:r,error:t}=await n.from("favorites").select("restaurant_id").eq("user_id",e.id);if(t)throw t;return r.map(a=>a.restaurant_id)},enabled:!!e})},b=()=>{const{user:e}=y(),r=p();return l({mutationFn:async t=>{if(!e)throw new Error("Must be logged in");const{data:a}=await n.from("favorites").select("id").eq("user_id",e.id).eq("restaurant_id",t).maybeSingle();if(a){const{error:s}=await n.from("favorites").delete().eq("id",a.id);if(s)throw s;return{action:"removed"}}else{const{error:s}=await n.from("favorites").insert({user_id:e.id,restaurant_id:t});if(s)throw s;return{action:"added"}}},onSuccess:t=>{r.invalidateQueries({queryKey:["favorites"]}),c.success(i.t(t.action==="added"?"toast.favoriteAdded":"toast.favoriteRemoved"))},onError:t=>{t.message==="Must be logged in"?c.error(i.t("toast.signInToFavorite")):c.error(i.t("toast.favoritesUpdateFailed"))}})},F=()=>d({queryKey:["restaurant-types",i.language],queryFn:async()=>{const e=i.language,r=e==="zh"?"type":e==="pt"?"type_pt":"type_en",{data:t,error:a}=await n.from("restaurants").select("type, type_en, type_pt").order("type");if(a)throw a;const s=t.flatMap(o=>o[r]||o.type_en||o.type||[]);return Array.from(new Set(s)).sort()}});export{_ as a,F as b,b as c,w as d,v as u};
//# sourceMappingURL=useRestaurants-DUc86lZJ.js.map
