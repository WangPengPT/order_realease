import{u as ee,i as se,y as ae,r as f,j as e,B as m,C as N,f as v,I as ie,af as le,ag as te,ah as ne,ai as re,aj as y,N as C,ar as b,O as S,Q as D,R as A,T as P,U as T,V as k,W as R,e as ce,o as me,an as oe,M as de,n as xe,a7 as he,L as fe}from"./index-DVul3rRI.js";import{C as _}from"./checkbox-C5Bsmw93.js";import{S as je}from"./switch-DhKWlehl.js";import{u as ue,P as pe,a as ge,b as u,c as Ne,d as ve,e as we,f as ye}from"./usePagination-B9SyEtqL.js";import{u as Ce}from"./useLocalizedContent-DGzOWXzu.js";import{n as be,o as Se,p as De,q as Ae}from"./useAdmin-DDeNyiNR.js";import{R as L}from"./RestaurantFormDialog-DWHAr78r.js";import{a as Pe}from"./exportUtils-HjLVYFQn.js";import{D as Te}from"./download-C6I8KRRV.js";import{P as ke}from"./plus-D3nVzAkL.js";import{S as Re}from"./search-5C1V7VKV.js";import{T as _e}from"./trash-2-i8G4gdCQ.js";import{S as Le}from"./star-CBcxmTIO.js";import"./chevron-left-TQOXgaDP.js";import"./ellipsis-CHjM5Ruf.js";import"./index.esm-D95Ut7MB.js";import"./types-CkdHTN5i.js";import"./mapbox-gl-CuI7p22H.js";import"./tabs-BqH_mVoW.js";import"./image-D5R4LjR2.js";import"./upload-Di4AbJj9.js";import"./grip-vertical-DEE8aHUy.js";import"./RichTextEditor-CavRnAFH.js";import"./isEqual-D9KOwNhl.js";import"./key-BfaP7nsU.js";import"./clock-B_uRC1lR.js";const ns=()=>{const{t:a}=ee(),{toast:w}=se(),{isSupervisor:j}=ae(),{data:r,isLoading:z}=be(),{getLocalizedField:t}=Ce(),B=Se(),E=De(),F=Ae(),[c,o]=f.useState([]),[d,I]=f.useState(""),[x,V]=f.useState("all"),M=f.useMemo(()=>{if(!r)return[];const s=new Set;return r.forEach(l=>{const n=t(l,"type");Array.isArray(n)?n.forEach(g=>s.add(g)):n&&s.add(n)}),Array.from(s)},[r,t]),H=f.useMemo(()=>r?r.filter(s=>{const l=d===""||t(s,"name").toString().toLowerCase().includes(d.toLowerCase())||s.address.toLowerCase().includes(d.toLowerCase()),n=t(s,"type"),g=x==="all"||(Array.isArray(n)?n.includes(x):n===x);return l&&g}):[],[r,d,x,t]),{currentPage:h,totalPages:p,paginatedData:i,goToPage:Q,nextPage:W,previousPage:$,canGoNext:G,canGoPrevious:U,startIndex:q,endIndex:O,totalItems:J}=ue({data:H,itemsPerPage:10}),K=()=>{if(!r||r.length===0){w({title:a("common.error"),description:a("admin.noDataToExport"),variant:"destructive"});return}Pe(r),w({title:a("common.success"),description:a("admin.exportSuccess")})},X=s=>{o(l=>l.includes(s)?l.filter(n=>n!==s):[...l,s])},Y=()=>{c.length===(i==null?void 0:i.length)?o([]):o((i==null?void 0:i.map(s=>s.id))||[])},Z=()=>{c.length!==0&&(E.mutate(c),o([]))};return z?e.jsx("div",{className:"text-center",children:a("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:a("admin.restaurantManagement")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.manageRestaurants")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(m,{variant:"outline",onClick:K,className:"flex-1 sm:flex-initial",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.exportCSV")})]}),e.jsx(L,{trigger:e.jsxs(m,{className:"flex-1 sm:flex-initial",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),a("admin.addRestaurant")]})})]})]}),e.jsx(N,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:a("admin.searchRestaurants"),value:d,onChange:s=>I(s.target.value),className:"pl-9"})]})}),e.jsxs(le,{value:x,onValueChange:V,children:[e.jsx(te,{className:"w-[180px]",children:e.jsx(ne,{placeholder:a("admin.filterByType")})}),e.jsxs(re,{children:[e.jsx(y,{value:"all",children:a("admin.allTypes")}),M.map(s=>e.jsx(y,{value:s,children:s},s))]})]})]})})}),!j&&c.length>0&&e.jsx(N,{className:"bg-muted/50",children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("span",{className:"font-medium",children:a("admin.selectedCount",{count:c.length})}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[e.jsxs(C,{children:[e.jsx(b,{asChild:!0,children:e.jsxs(m,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),a("admin.batchDelete")]})}),e.jsxs(S,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(D,{children:[e.jsx(A,{children:a("admin.confirmBatchDelete")}),e.jsx(P,{children:a("admin.batchDeleteWarning",{count:c.length})})]}),e.jsxs(T,{children:[e.jsx(k,{children:a("common.cancel")}),e.jsx(R,{onClick:Z,children:a("common.delete")})]})]})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>o([]),className:"flex-1 sm:flex-initial",children:a("admin.clearSelection")})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b",children:[e.jsx("div",{className:"flex items-center gap-2",children:!j&&e.jsxs(e.Fragment,{children:[e.jsx(_,{checked:c.length===(i==null?void 0:i.length)&&i.length>0,onCheckedChange:Y}),e.jsx("span",{className:"font-medium",children:a("admin.selectAll")})]})}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a("admin.showing")," ",q,"-",O," ",a("admin.of")," ",J]})]}),e.jsx("div",{className:"grid gap-4",children:i==null?void 0:i.map(s=>e.jsx(N,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center",children:[e.jsx("div",{className:"p-4 flex items-start md:self-start",children:!j&&e.jsx(_,{checked:c.includes(s.id),onCheckedChange:()=>X(s.id),className:"mt-1"})}),s.image_url&&e.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden mx-auto md:mx-0 flex-shrink-0",children:e.jsx("img",{src:s.image_url,alt:String(t(s,"name")),className:"object-cover object-center w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(ce,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx(me,{className:"text-lg md:text-xl",children:t(s,"name")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"h-4 w-4 fill-accent text-accent"}),e.jsx("span",{className:"font-medium",children:s.rating||0})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm",children:s.address})]}),t(s,"description")&&e.jsx("div",{className:`text-sm text-muted-foreground prose prose-sm max-w-none line-clamp-2\r
                            [&_p]:inline [&_p]:m-0\r
                            [&_strong]:font-semibold [&_strong]:text-foreground\r
                            [&_em]:italic\r
                            [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                            [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:t(s,"description")}})]})]}),e.jsxs(v,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:(Array.isArray(t(s,"type"))?t(s,"type"):[t(s,"type")]).map((l,n)=>e.jsx(xe,{children:l},n))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(he,{htmlFor:`visible-${s.id}`,className:"text-sm font-medium",children:a("admin.frontendDisplay")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.visible?a("admin.restaurantShown"):a("admin.restaurantHidden")})]}),e.jsx(je,{id:`visible-${s.id}`,checked:s.visible??!0,onCheckedChange:l=>F.mutate({restaurantId:s.id,visible:l})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(m,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsx(fe,{to:`/restaurant/${s.id}`,state:{from:"admin"},children:a("admin.view")})}),e.jsx(L,{restaurant:s,trigger:e.jsx(m,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.edit")})}),!j&&e.jsxs(C,{children:[e.jsx(b,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(S,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(D,{children:[e.jsx(A,{children:a("admin.confirmDelete")}),e.jsx(P,{children:a("admin.deleteRestaurantWarning")})]}),e.jsxs(T,{children:[e.jsx(k,{children:a("common.cancel")}),e.jsx(R,{onClick:()=>B.mutate(s.id),children:a("common.delete")})]})]})]})]})]})]})]})]})},s.id))}),p>1&&e.jsx(pe,{className:"mt-6",children:e.jsxs(ge,{children:[e.jsx(u,{children:e.jsx(Ne,{onClick:$,className:U?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:p},(s,l)=>l+1).map(s=>s===1||s===p||s>=h-1&&s<=h+1?e.jsx(u,{children:e.jsx(ve,{onClick:()=>Q(s),isActive:h===s,className:"cursor-pointer",children:s})},s):s===h-2||s===h+2?e.jsx(u,{children:e.jsx(we,{})},s):null),e.jsx(u,{children:e.jsx(ye,{onClick:W,className:G?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})};export{ns as default};
