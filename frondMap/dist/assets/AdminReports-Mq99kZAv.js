import{c as de,u as ce,af as oe,r as v,A as P,ai as me,j as e,L as I,C as n,o as l,z as d,ap as j,p as c,I as z,B as f,O as xe,Q as he,R as ue,T as y,x as Q,av as pe,D as je,d as fe,e as ge,f as ve,a9 as ye,aj as Ne,ak as we,al as Ce,am as Se,an as S,ao as be,y as b,N as D}from"./index-tBrG_sQo.js";import{F as L}from"./flag-BYo3_GqO.js";import{C as De}from"./clock-CfDFVEuU.js";import{C as _e}from"./circle-alert-otnbVy-Q.js";import{C as ke}from"./circle-check-big-BCKwhIZv.js";import{C as Fe}from"./circle-x-H0jWa1fQ.js";import{T as Le}from"./trending-up-DbZK2sLt.js";import{R as _,L as Te,C as V,X,Y as H,T as k,b as Re,c as Y,B as Ae}from"./LineChart-UI-f7kPb.js";import{P as G,a as W}from"./PieChart-Dq-5pjzz.js";import{B as $e}from"./BarChart-TNFgsQ0X.js";import{S as Be}from"./search-DWWBTdMh.js";import{F as Ee}from"./filter-BZFzI4Zy.js";import{E as J}from"./external-link-DPrEJ_xT.js";import{s as Z}from"./startOfDay-D9HvL57p.js";import{s as Me}from"./subDays-CvFWAk7W.js";import{f as T}from"./format-DGXNDZcH.js";import"./isEqual-0tuMjcui.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=de("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),ts=()=>{var O;const{t:s}=ce(),R=oe(),[i,N]=v.useState(null),[A,$]=v.useState(""),[B,E]=v.useState(""),[M,ee]=v.useState(""),[w,g]=v.useState("all"),{data:r,isLoading:se}=P({queryKey:["admin-reports"],queryFn:async()=>{const{data:a,error:t}=await b.from("reports").select(`
          *,
          reporter:profiles(display_name, avatar_url)
        `).order("created_at",{ascending:!1});if(t)throw t;return a}}),{data:o}=P({queryKey:["emailConfig","report"],queryFn:async()=>{const{data:a,error:t}=await b.from("email_config").select("*").eq("type","report").single();if(t)throw t;return a}}),p=r==null?void 0:r.filter(a=>{var u,C;const t=M.toLowerCase(),x=a.description.toLowerCase().includes(t)||((C=(u=a.reporter)==null?void 0:u.display_name)==null?void 0:C.toLowerCase().includes(t))||a.reason.toLowerCase().includes(t),h=w==="all"||a.status===w;return x&&h}),m={total:(r==null?void 0:r.length)||0,pending:(r==null?void 0:r.filter(a=>a.status==="pending").length)||0,reviewing:(r==null?void 0:r.filter(a=>a.status==="reviewing").length)||0,resolved:(r==null?void 0:r.filter(a=>a.status==="resolved").length)||0,dismissed:(r==null?void 0:r.filter(a=>a.status==="dismissed").length)||0},ae=Array.from({length:7},(a,t)=>{const x=Z(Me(new Date,6-t)),h=T(x,"yyyy-MM-dd"),u=(r==null?void 0:r.filter(C=>T(Z(new Date(C.created_at)),"yyyy-MM-dd")===h).length)||0;return{date:T(x,"MM/dd"),count:u}}),U=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"].map(a=>({name:s(`report.reasons.${a}`),value:(r==null?void 0:r.filter(t=>t.reason===a).length)||0})).filter(a=>a.value>0),te=["comment","restaurant","activity","user"].map(a=>({name:s(`admin.reportType.${a}`),value:(r==null?void 0:r.filter(t=>t.target_type===a).length)||0})).filter(a=>a.value>0),q=["#016450","#018a6f","#4CAF50","#81C784","#FFA726","#FF7043","#EF5350","#EC407A","#AB47BC"],re=async()=>{const a=prompt(s("joinUs.enterNewEmail"),o==null?void 0:o.recipient_email);if(a)try{const{error:t}=await b.from("email_config").update({recipient_email:a}).eq("id",o==null?void 0:o.id);if(t)throw t;R.invalidateQueries({queryKey:["emailConfig"]}),D.success(s("joinUs.emailUpdated"))}catch(t){console.error("Error updating email:",t),D.error(s("joinUs.emailUpdateError"))}},F=me({mutationFn:async({id:a,status:t,notes:x})=>{const h={updated_at:new Date().toISOString()};t&&(h.status=t),x!==void 0&&(h.admin_notes=x);const{error:u}=await b.from("reports").update(h).eq("id",a);if(u)throw u},onSuccess:()=>{R.invalidateQueries({queryKey:["admin-reports"]}),D.success(s("toast.reportUpdatedSuccess")),N(null)},onError:a=>{D.error(a.message||s("toast.reportUpdateFailed"))}}),K=a=>{const t={pending:"default",reviewing:"secondary",resolved:"default",dismissed:"destructive"};return e.jsx(Q,{variant:t[a]||"default",children:s(`admin.reportStatus.${a}`)})},ie=(a,t)=>{switch(a){case"restaurant":return`/restaurant/${t}`;case"activity":return`/activity/${t}`;case"comment":return"#";case"user":return"/profile";default:return"#"}},ne=a=>{N(a),$(a.admin_notes||""),E(a.status)},le=()=>{i&&F.mutate({id:i.id,status:B,notes:A})};return se?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(I,{className:"w-8 h-8 animate-spin"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:s("admin.reports")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("admin.reportsDescription")})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsx(d,{children:s("joinUs.recipientEmail")}),e.jsx(j,{children:s("joinUs.recipientEmailDesc")})]}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{value:(o==null?void 0:o.recipient_email)||"",readOnly:!0}),e.jsx(f,{onClick:re,children:s("common.edit")})]})})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:s("admin.totalReports")}),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.total}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.allReportsCount")})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:s("admin.reportStatus.pending")}),e.jsx(De,{className:"h-4 w-4 text-yellow-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.pending}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.awaitingReview")})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:s("admin.reportStatus.reviewing")}),e.jsx(_e,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.reviewing}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.underReview")})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:s("admin.reportStatus.resolved")}),e.jsx(ke,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.resolved}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.resolvedReports")})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:s("admin.reportStatus.dismissed")}),e.jsx(Fe,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.dismissed}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.dismissedReports")})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-primary"}),e.jsx(d,{children:s("admin.reportsTrend")})]}),e.jsx(j,{children:s("admin.reportsTrendDesc")})]}),e.jsx(c,{children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(Te,{data:ae,children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(X,{dataKey:"date"}),e.jsx(H,{}),e.jsx(k,{}),e.jsx(Re,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2,name:s("admin.reportsCount")})]})})})]}),e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),e.jsx(d,{children:s("admin.reportsReasonDist")})]}),e.jsx(j,{children:s("admin.reportsReasonDistDesc")})]}),e.jsx(c,{children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(G,{children:[e.jsx(W,{data:U,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a}: ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:U.map((a,t)=>e.jsx(Y,{fill:q[t%q.length]},`cell-${t}`))}),e.jsx(k,{})]})})})]}),e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsx(d,{children:s("admin.reportsTypeDist")}),e.jsx(j,{children:s("admin.reportsTypeDistDesc")})]}),e.jsx(c,{children:e.jsx(_,{width:"100%",height:300,children:e.jsxs($e,{data:te,children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(X,{dataKey:"name"}),e.jsx(H,{}),e.jsx(k,{}),e.jsx(Ae,{dataKey:"value",fill:"hsl(var(--primary))",name:s("admin.reportsCount")})]})})})]}),e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsx(d,{children:s("admin.reportsStatusDist")}),e.jsx(j,{children:s("admin.reportsStatusDistDesc")})]}),e.jsx(c,{children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(G,{children:[e.jsx(W,{data:[{name:s("admin.reportStatus.pending"),value:m.pending},{name:s("admin.reportStatus.reviewing"),value:m.reviewing},{name:s("admin.reportStatus.resolved"),value:m.resolved},{name:s("admin.reportStatus.dismissed"),value:m.dismissed}].filter(a=>a.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a}: ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{color:"#FFA726"},{color:"#42A5F5"},{color:"#66BB6A"},{color:"#EF5350"}].map((a,t)=>e.jsx(Y,{fill:a.color},`cell-${t}`))}),e.jsx(k,{})]})})})]})]}),e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(d,{children:s("admin.allReports")}),e.jsx(j,{children:s("admin.manageReportsDesc")})]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(z,{placeholder:s("admin.searchReports"),value:M,onChange:a=>ee(a.target.value),className:"pl-10"})]}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),s(w==="all"?"admin.allStatus":`admin.reportStatus.${w}`)]})}),e.jsxs(ue,{align:"end",className:"bg-background",children:[e.jsx(y,{onClick:()=>g("all"),children:s("admin.allStatus")}),e.jsx(y,{onClick:()=>g("pending"),children:s("admin.reportStatus.pending")}),e.jsx(y,{onClick:()=>g("reviewing"),children:s("admin.reportStatus.reviewing")}),e.jsx(y,{onClick:()=>g("resolved"),children:s("admin.reportStatus.resolved")}),e.jsx(y,{onClick:()=>g("dismissed"),children:s("admin.reportStatus.dismissed")})]})]})]})]}),e.jsx(c,{children:e.jsxs("div",{className:"grid gap-4",children:[p==null?void 0:p.map(a=>{var t;return e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s(`admin.reportType.${a.target_type}`)}),K(a.status),e.jsx(Q,{variant:"outline",children:s(`report.reasons.${a.reason}`)})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.description.substring(0,150),a.description.length>150&&"..."]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s("admin.reportedBy"),": ",(t=a.reporter)==null?void 0:t.display_name]}),e.jsxs("span",{children:[s("admin.reportedAt"),":"," ",pe(new Date(a.created_at),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>ne(a),children:s("admin.viewReport")}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>window.open(ie(a.target_type,a.target_id),"_blank"),children:e.jsx(J,{className:"w-4 h-4"})})]})]})},a.id)}),(p==null?void 0:p.length)===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.noReports")})]})]})})]})]}),e.jsx(je,{open:!!i,onOpenChange:()=>N(null),children:e.jsxs(fe,{className:"max-w-[90vw] sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ge,{children:[e.jsxs(ve,{children:[s("admin.viewReport")," - ",i==null?void 0:i.id]}),e.jsx(ye,{children:s(`admin.reportType.${i==null?void 0:i.target_type}`)})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.reportedBy"),":"]})," ",(O=i.reporter)==null?void 0:O.display_name]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.reportedAt"),":"]})," ",new Date(i.created_at).toLocaleString()]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("report.reason"),":"]})," ",s(`report.reasons.${i.reason}`)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",K(i.status)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.detailsLabel")}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:i.description})]}),i.reporter_contact&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.contactLabel")}),e.jsx("p",{className:"text-sm",children:i.reporter_contact})]}),i.evidence_urls&&i.evidence_urls.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.evidenceLabel")}),e.jsx("ul",{className:"space-y-1",children:i.evidence_urls.map((a,t)=>e.jsx("li",{children:e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),a]})},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s("admin.updateStatus")}),e.jsxs(Ne,{value:B,onValueChange:E,children:[e.jsx(we,{children:e.jsx(Ce,{})}),e.jsxs(Se,{children:[e.jsx(S,{value:"pending",children:s("admin.reportStatus.pending")}),e.jsx(S,{value:"reviewing",children:s("admin.reportStatus.reviewing")}),e.jsx(S,{value:"resolved",children:s("admin.reportStatus.resolved")}),e.jsx(S,{value:"dismissed",children:s("admin.reportStatus.dismissed")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s("admin.adminNotes")}),e.jsx(be,{value:A,onChange:a=>$(a.target.value),placeholder:"Add internal notes...",rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>N(null),children:s("common.cancel")}),e.jsx(f,{onClick:le,disabled:F.isPending,children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2 animate-spin"}),s("common.loading")]}):s("admin.saveNotes")})]})]})]})})]})};export{ts as default};
