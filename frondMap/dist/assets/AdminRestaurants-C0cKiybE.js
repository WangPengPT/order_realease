import{p as ue,r as d,s as pe,j as e,b8 as fe,bY as je,a_ as ge,b9 as Ne,bw as T,ak as ve,bf as we,bG as ye,L as be}from"./vendor-react-DImbKuZP.js";import{I as Ce,Q as Se,q as m,C as b,F as C,J as Re,a8 as _,a9 as k,aa as P,ab as E,ac as j,A as F,ad as L,f as B,h as M,i as z,j as I,k as V,l as q,m as G,E as Ae,K as De,B as S,$ as Te,s as Q}from"./index-_G3CuCzp.js";import{C as $}from"./checkbox-DvE0llcT.js";import{S as _e}from"./switch-B49nLmHg.js";import{u as ke,P as Pe,a as Ee,b as w,c as Fe,d as Le,e as Be,f as Me}from"./usePagination-CauszoW5.js";import{u as ze}from"./useLocalizedContent-B2SRIfSp.js";import{n as Ie,o as Ve,p as qe,q as Ge}from"./useAdmin-CR2MzlZ-.js";import{R as H}from"./RestaurantFormDialog-ByHnzdU3.js";import{a as Qe}from"./exportUtils-YWmY6fTR.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CRxszhSs.js";import"./vendor-map-CvE3ASYw.js";import"./radio-group-DJCsebfV.js";import"./tabs-Dk5peax5.js";import"./RichTextEditor-Bg0Y3csO.js";import"./useBrands-BDNwioL9.js";const cs=()=>{const{t:a}=ue(),{toast:R}=Ce(),{isSupervisor:g}=Se(),{data:n,isLoading:K}=Ie(),{getLocalizedField:i}=ze(),U=Ve(),W=qe(),J=Ge(),[r,o]=d.useState([]),[x,Y]=d.useState(""),[h,O]=d.useState("all"),[N,X]=d.useState("all"),{data:A}=pe({queryKey:["merchant-restaurant-assignments"],queryFn:async()=>{const{data:s,error:t}=await Q.from("merchant_restaurants").select("restaurant_id, user_id");if(t)throw t;const l=[...new Set(s.map(c=>c.user_id))];if(l.length===0)return[];const{data:f,error:v}=await Q.from("profiles").select("id, display_name").in("id",l);if(v)throw v;const D=new Map(f.map(c=>[c.id,c.display_name]));return s.map(c=>({...c,display_name:D.get(c.user_id)||c.user_id.slice(0,8)}))}}),Z=d.useMemo(()=>{const s=new Map;return A?.forEach(t=>{const l=s.get(t.restaurant_id)||[];l.push({user_id:t.user_id,display_name:t.display_name}),s.set(t.restaurant_id,l)}),s},[A]),ee=d.useMemo(()=>{if(!n)return[];const s=new Set;return n.forEach(t=>{const l=i(t,"type");Array.isArray(l)?l.forEach(f=>s.add(f)):l&&s.add(l)}),Array.from(s)},[n,i]),se=d.useMemo(()=>n?n.filter(s=>{const t=x===""||i(s,"name").toString().toLowerCase().includes(x.toLowerCase())||s.address.toLowerCase().includes(x.toLowerCase()),l=i(s,"type"),f=h==="all"||(Array.isArray(l)?l.includes(h):l===h),v=s.template||"default";return t&&f&&(N==="all"||v===N)}):[],[n,x,h,N,i]),{currentPage:u,totalPages:y,paginatedData:p,goToPage:ae,nextPage:te,previousPage:le,canGoNext:ie,canGoPrevious:ne,startIndex:re,endIndex:ce,totalItems:de}=ke({data:se,itemsPerPage:10}),me=()=>{if(!n||n.length===0){R({title:a("common.error"),description:a("admin.noDataToExport"),variant:"destructive"});return}Qe(n),R({title:a("common.success"),description:a("admin.exportSuccess")})},oe=s=>{o(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])},xe=()=>{r.length===p?.length?o([]):o(p?.map(s=>s.id)||[])},he=()=>{r.length!==0&&(W.mutate(r),o([]))};return K?e.jsx("div",{className:"text-center",children:a("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:a("admin.restaurantManagement")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.manageRestaurants")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(m,{variant:"outline",onClick:me,className:"flex-1 sm:flex-initial",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.exportCSV")})]}),e.jsx(H,{trigger:e.jsxs(m,{className:"flex-1 sm:flex-initial",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),a("admin.addRestaurant")]})})]})]}),e.jsx(b,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Re,{placeholder:a("admin.searchRestaurants"),value:x,onChange:s=>Y(s.target.value),className:"pl-9"})]})}),e.jsxs(_,{value:N,onValueChange:X,children:[e.jsx(k,{className:"w-[160px]",children:e.jsx(P,{placeholder:a("admin.filterByTemplate")})}),e.jsxs(E,{children:[e.jsx(j,{value:"all",children:e.jsx("span",{className:"flex items-center gap-2",children:a("admin.allTemplates")})}),e.jsx(j,{value:"default",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),a("admin.standardRestaurant")]})}),e.jsx(j,{value:"ghost",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),a("admin.ghostRestaurant")]})})]})]}),e.jsxs(_,{value:h,onValueChange:O,children:[e.jsx(k,{className:"w-[180px]",children:e.jsx(P,{placeholder:a("admin.filterByType")})}),e.jsxs(E,{children:[e.jsx(j,{value:"all",children:a("admin.allTypes")}),ee.map(s=>e.jsx(j,{value:s,children:s},s))]})]})]})})}),!g&&r.length>0&&e.jsx(b,{className:"bg-muted/50",children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("span",{className:"font-medium",children:a("admin.selectedCount",{count:r.length})}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[e.jsxs(F,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(m,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),a("admin.batchDelete")]})}),e.jsxs(B,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(M,{children:[e.jsx(z,{children:a("admin.confirmBatchDelete")}),e.jsx(I,{children:a("admin.batchDeleteWarning",{count:r.length})})]}),e.jsxs(V,{children:[e.jsx(q,{children:a("common.cancel")}),e.jsx(G,{onClick:he,children:a("common.delete")})]})]})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>o([]),className:"flex-1 sm:flex-initial",children:a("admin.clearSelection")})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b",children:[e.jsx("div",{className:"flex items-center gap-2",children:!g&&e.jsxs(e.Fragment,{children:[e.jsx($,{checked:r.length===p?.length&&p.length>0,onCheckedChange:xe}),e.jsx("span",{className:"font-medium",children:a("admin.selectAll")})]})}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a("admin.showing")," ",re,"-",ce," ",a("admin.of")," ",de]})]}),e.jsx("div",{className:"grid gap-4",children:p?.map(s=>e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center",children:[e.jsx("div",{className:"p-4 flex items-start md:self-start",children:!g&&e.jsx($,{checked:r.includes(s.id),onCheckedChange:()=>oe(s.id),className:"mt-1"})}),s.image_url&&e.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden mx-auto md:mx-0 flex-shrink-0",children:e.jsx("img",{src:s.image_url,alt:String(i(s,"name")),className:"object-cover object-center w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Ae,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx(De,{className:"text-lg md:text-xl",children:i(s,"name")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-4 w-4 fill-accent text-accent"}),e.jsx("span",{className:"font-medium",children:s.rating||0})]})})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.template==="ghost"&&e.jsxs(S,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),a("admin.ghostRestaurant")]}),(Array.isArray(i(s,"type"))?i(s,"type"):[i(s,"type")]).map((t,l)=>e.jsx(S,{children:t},l))]}),(()=>{const t=Z.get(s.id);return t&&t.length>0?e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-4",children:[e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a("admin.associatedMerchants","关联负责人"),":"]}),t.map(l=>e.jsx(S,{variant:"outline",className:"text-xs",children:l.display_name},l.user_id))]}):null})(),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Te,{htmlFor:`visible-${s.id}`,className:"text-sm font-medium",children:a("admin.frontendDisplay")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.visible?a("admin.restaurantShown"):a("admin.restaurantHidden")})]}),e.jsx(_e,{id:`visible-${s.id}`,checked:s.visible??!0,onCheckedChange:t=>J.mutate({restaurantId:s.id,visible:t})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(m,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsx(be,{to:`/restaurant/${s.id}`,state:{from:"admin"},children:a("admin.view")})}),e.jsx(H,{restaurant:s,trigger:e.jsx(m,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.edit")})}),!g&&e.jsxs(F,{children:[e.jsx(L,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(B,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(M,{children:[e.jsx(z,{children:a("admin.confirmDelete")}),e.jsx(I,{children:a("admin.deleteRestaurantWarning")})]}),e.jsxs(V,{children:[e.jsx(q,{children:a("common.cancel")}),e.jsx(G,{onClick:()=>U.mutate(s.id),children:a("common.delete")})]})]})]})]})]})]})]})]})},s.id))}),y>1&&e.jsx(Pe,{className:"mt-6",children:e.jsxs(Ee,{children:[e.jsx(w,{children:e.jsx(Fe,{onClick:le,className:ne?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:y},(s,t)=>t+1).map(s=>s===1||s===y||s>=u-1&&s<=u+1?e.jsx(w,{children:e.jsx(Le,{onClick:()=>ae(s),isActive:u===s,className:"cursor-pointer",children:s})},s):s===u-2||s===u+2?e.jsx(w,{children:e.jsx(Be,{})},s):null),e.jsx(w,{children:e.jsx(Me,{onClick:te,className:ie?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})};export{cs as default};
//# sourceMappingURL=AdminRestaurants-C0cKiybE.js.map
