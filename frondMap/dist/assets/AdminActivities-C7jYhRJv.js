import{c as et,r as f,ae as N,j as e,f as Q,aV as It,u as Ne,D as Me,a as Fe,b as Ie,d as Be,a6 as jt,v as q,a9 as tt,B as C,a2 as pe,ac as Bt,aa as st,aW as $e,a1 as it,C as ne,l as ie,a7 as w,X as Ue,I as R,g as De,ag as je,ah as we,ai as ve,aj as _e,ak as y,S as Ze,h as Lt,s as I,G as he,L as ke,ab as Se,o as Ht,R as Oe,at as Ve,as as $t,T as Ye,U as Xe,V as Ke,W as We,Y as qe,Z as Ge,$ as Qe,k as Ut,w as Ot,ao as Vt,e as rt}from"./index-DDDDgwLZ.js";import{C as be}from"./checkbox-DbrPu41g.js";import{i as Yt}from"./useActivities-DSS2UpLX.js";import{u as Xt}from"./useLocalizedContent-pbKMpp6T.js";import{r as Kt,s as Wt}from"./useAdmin-BNC-r_JW.js";import{u as qt,C as K}from"./index.esm--54UaIQe.js";import{o as wt,s as _,d as ze,e as re,n as le,b as Ee,t as Gt}from"./types-BL2obTSH.js";import{C as lt}from"./calendar-BCptcx5y.js";import{P as ot,a as dt,b as ct}from"./popover-DWnWzERd.js";import{T as Re,a as Pe,b as L,c as H}from"./tabs-D7FAQSQ9.js";import{u as Qt}from"./useRestaurants-JxXkPBFO.js";import{R as $}from"./RichTextEditor-kED5Ev1O.js";import{I as Zt}from"./info-Bio-BsD4.js";import{U as ht}from"./upload-CmJknLKR.js";import{I as mt}from"./image-D60QNIj3.js";import{V as xt}from"./video-yQaNOTej.js";import{F as Je}from"./file-pen-Dn62dRkk.js";import{A as Jt}from"./arrow-up-down-BamKLJgJ.js";import{f as Te}from"./format-B49CpSpa.js";import{u as es,a as ts}from"./useActivityRules-DsN8c6cj.js";import{F as vt}from"./file-text-BwvDCRoS.js";import{S as _t}from"./save-CGh_X9IE.js";import{u as ss,a as as}from"./useGlobalHandbook-B4vr8k5b.js";import{B as bt}from"./book-open-BS1KAtQi.js";import{b as ns}from"./exportUtils-HjLVYFQn.js";import{D as is}from"./download-D5LQbPDi.js";import{P as rs}from"./plus-B5zEjpJa.js";import{S as ls}from"./search-C3gG7zdj.js";import{C as os}from"./chart-column-CxLFiAoC.js";import"./startOfDay-BDvM62ew.js";import"./subDays-C0PMy43u.js";import"./chevron-left-BGtubpHe.js";import"./isEqual-Dr_ILfKy.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=et("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=et("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=et("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);var ms=Object.defineProperty,xs=(a,s,t)=>s in a?ms(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,D=(a,s,t)=>xs(a,typeof s!="symbol"?s+"":s,t);const Ae={x:0,y:0,width:0,height:0,unit:"px"},ge=(a,s,t)=>Math.min(Math.max(a,s),t),us=(...a)=>a.filter(s=>s&&typeof s=="string").join(" "),ut=(a,s)=>a===s||a.width===s.width&&a.height===s.height&&a.x===s.x&&a.y===s.y&&a.unit===s.unit;function ps(a,s,t,o){const n=W(a,t,o);return a.width&&(n.height=n.width/s),a.height&&(n.width=n.height*s),n.y+n.height>o&&(n.height=o-n.y,n.width=n.height*s),n.x+n.width>t&&(n.width=t-n.x,n.height=n.width/s),a.unit==="%"?ae(n,t,o):n}function gs(a,s,t){const o=W(a,s,t);return o.x=(s-o.width)/2,o.y=(t-o.height)/2,a.unit==="%"?ae(o,s,t):o}function ae(a,s,t){return a.unit==="%"?{...Ae,...a,unit:"%"}:{unit:"%",x:a.x?a.x/s*100:0,y:a.y?a.y/t*100:0,width:a.width?a.width/s*100:0,height:a.height?a.height/t*100:0}}function W(a,s,t){return a.unit?a.unit==="px"?{...Ae,...a,unit:"px"}:{unit:"px",x:a.x?a.x*s/100:0,y:a.y?a.y*t/100:0,width:a.width?a.width*s/100:0,height:a.height?a.height*t/100:0}:{...Ae,...a,unit:"px"}}function pt(a,s,t,o,n,i=0,c=0,p=o,d=n){const l={...a};let m=Math.min(i,o),x=Math.min(c,n),j=Math.min(p,o),h=Math.min(d,n);s&&(s>1?(m=c?c*s:m,x=m/s,j=p*s):(x=i?i/s:x,m=x*s,h=d/s)),l.y<0&&(l.height=Math.max(l.height+l.y,x),l.y=0),l.x<0&&(l.width=Math.max(l.width+l.x,m),l.x=0);const b=o-(l.x+l.width);b<0&&(l.x=Math.min(l.x,o-m),l.width+=b);const k=n-(l.y+l.height);if(k<0&&(l.y=Math.min(l.y,n-x),l.height+=k),l.width<m&&((t==="sw"||t=="nw")&&(l.x-=m-l.width),l.width=m),l.height<x&&((t==="nw"||t=="ne")&&(l.y-=x-l.height),l.height=x),l.width>j&&((t==="sw"||t=="nw")&&(l.x-=j-l.width),l.width=j),l.height>h&&((t==="nw"||t=="ne")&&(l.y-=h-l.height),l.height=h),s){const T=l.width/l.height;if(T<s){const g=Math.max(l.width/s,x);(t==="nw"||t=="ne")&&(l.y-=g-l.height),l.height=g}else if(T>s){const g=Math.max(l.height*s,m);(t==="sw"||t=="nw")&&(l.x-=g-l.width),l.width=g}}return l}function fs(a,s,t,o){const n={...a};return s==="ArrowLeft"?o==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):o==="w"?(n.x-=t,n.width+=t):o==="sw"?(n.x-=t,n.width+=t,n.height+=t):o==="ne"?(n.y+=t,n.width-=t,n.height-=t):o==="e"?n.width-=t:o==="se"&&(n.width-=t,n.height-=t):s==="ArrowRight"&&(o==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):o==="w"?(n.x+=t,n.width-=t):o==="sw"?(n.x+=t,n.width-=t,n.height-=t):o==="ne"?(n.y-=t,n.width+=t,n.height+=t):o==="e"?n.width+=t:o==="se"&&(n.width+=t,n.height+=t)),s==="ArrowUp"?o==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):o==="n"?(n.y-=t,n.height+=t):o==="ne"?(n.y-=t,n.width+=t,n.height+=t):o==="sw"?(n.x+=t,n.width-=t,n.height-=t):o==="s"?n.height-=t:o==="se"&&(n.width-=t,n.height-=t):s==="ArrowDown"&&(o==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):o==="n"?(n.y+=t,n.height-=t):o==="ne"?(n.y+=t,n.width-=t,n.height-=t):o==="sw"?(n.x-=t,n.width+=t,n.height+=t):o==="s"?n.height+=t:o==="se"&&(n.width+=t,n.height+=t)),n}const fe={capture:!0,passive:!1};let js=0;const se=class O extends f.PureComponent{constructor(){super(...arguments),D(this,"docMoveBound",!1),D(this,"mouseDownOnCrop",!1),D(this,"dragStarted",!1),D(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),D(this,"componentRef",f.createRef()),D(this,"mediaRef",f.createRef()),D(this,"resizeObserver"),D(this,"initChangeCalled",!1),D(this,"instanceId",`rc-${js++}`),D(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),D(this,"onCropPointerDown",s=>{const{crop:t,disabled:o}=this.props,n=this.getBox();if(!t)return;const i=W(t,n.width,n.height);if(o)return;s.cancelable&&s.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const c=s.target.dataset.ord,p=!!c;let d=s.clientX,l=s.clientY,m=i.x,x=i.y;if(c){const j=s.clientX-n.x,h=s.clientY-n.y;let b=0,k=0;c==="ne"||c=="e"?(b=j-(i.x+i.width),k=h-i.y,m=i.x,x=i.y+i.height):c==="se"||c==="s"?(b=j-(i.x+i.width),k=h-(i.y+i.height),m=i.x,x=i.y):c==="sw"||c=="w"?(b=j-i.x,k=h-(i.y+i.height),m=i.x+i.width,x=i.y):(c==="nw"||c=="n")&&(b=j-i.x,k=h-i.y,m=i.x+i.width,x=i.y+i.height),d=m+n.x+b,l=x+n.y+k}this.evData={startClientX:d,startClientY:l,startCropX:m,startCropY:x,clientX:s.clientX,clientY:s.clientY,isResize:p,ord:c},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),D(this,"onComponentPointerDown",s=>{const{crop:t,disabled:o,locked:n,keepSelection:i,onChange:c}=this.props,p=this.getBox();if(o||n||i&&t)return;s.cancelable&&s.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const d=s.clientX-p.x,l=s.clientY-p.y,m={unit:"px",x:d,y:l,width:0,height:0};this.evData={startClientX:s.clientX,startClientY:s.clientY,startCropX:d,startCropY:l,clientX:s.clientX,clientY:s.clientY,isResize:!0},this.mouseDownOnCrop=!0,c(W(m,p.width,p.height),ae(m,p.width,p.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),D(this,"onDocPointerMove",s=>{const{crop:t,disabled:o,onChange:n,onDragStart:i}=this.props,c=this.getBox();if(o||!t||!this.mouseDownOnCrop)return;s.cancelable&&s.preventDefault(),this.dragStarted||(this.dragStarted=!0,i&&i(s));const{evData:p}=this;p.clientX=s.clientX,p.clientY=s.clientY;let d;p.isResize?d=this.resizeCrop():d=this.dragCrop(),ut(t,d)||n(W(d,c.width,c.height),ae(d,c.width,c.height))}),D(this,"onComponentKeyDown",s=>{const{crop:t,disabled:o,onChange:n,onComplete:i}=this.props;if(o)return;const c=s.key;let p=!1;if(!t)return;const d=this.getBox(),l=this.makePixelCrop(d),m=(navigator.platform.match("Mac")?s.metaKey:s.ctrlKey)?O.nudgeStepLarge:s.shiftKey?O.nudgeStepMedium:O.nudgeStep;if(c==="ArrowLeft"?(l.x-=m,p=!0):c==="ArrowRight"?(l.x+=m,p=!0):c==="ArrowUp"?(l.y-=m,p=!0):c==="ArrowDown"&&(l.y+=m,p=!0),p){s.cancelable&&s.preventDefault(),l.x=ge(l.x,0,d.width-l.width),l.y=ge(l.y,0,d.height-l.height);const x=W(l,d.width,d.height),j=ae(l,d.width,d.height);n(x,j),i&&i(x,j)}}),D(this,"onHandlerKeyDown",(s,t)=>{const{aspect:o=0,crop:n,disabled:i,minWidth:c=0,minHeight:p=0,maxWidth:d,maxHeight:l,onChange:m,onComplete:x}=this.props,j=this.getBox();if(i||!n)return;if(s.key==="ArrowUp"||s.key==="ArrowDown"||s.key==="ArrowLeft"||s.key==="ArrowRight")s.stopPropagation(),s.preventDefault();else return;const h=(navigator.platform.match("Mac")?s.metaKey:s.ctrlKey)?O.nudgeStepLarge:s.shiftKey?O.nudgeStepMedium:O.nudgeStep,b=W(n,j.width,j.height),k=fs(b,s.key,h,t),T=pt(k,o,t,j.width,j.height,c,p,d,l);if(!ut(n,T)){const g=ae(T,j.width,j.height);m(T,g),x&&x(T,g)}}),D(this,"onDocPointerDone",s=>{const{crop:t,disabled:o,onComplete:n,onDragEnd:i}=this.props,c=this.getBox();this.unbindDocMove(),!(o||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,i&&i(s),n&&n(W(t,c.width,c.height),ae(t,c.width,c.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),D(this,"onDragFocus",()=>{var s;(s=this.componentRef.current)==null||s.scrollTo(0,0)})}get document(){return document}getBox(){const s=this.mediaRef.current;if(!s)return{x:0,y:0,width:0,height:0};const{x:t,y:o,width:n,height:i}=s.getBoundingClientRect();return{x:t,y:o,width:n,height:i}}componentDidUpdate(s){const{crop:t,onComplete:o}=this.props;if(o&&!s.crop&&t){const{width:n,height:i}=this.getBox();n&&i&&o(W(t,n,i),ae(t,n,i))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,fe),this.document.addEventListener("pointerup",this.onDocPointerDone,fe),this.document.addEventListener("pointercancel",this.onDocPointerDone,fe),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,fe),this.document.removeEventListener("pointerup",this.onDocPointerDone,fe),this.document.removeEventListener("pointercancel",this.onDocPointerDone,fe),this.docMoveBound=!1)}getCropStyle(){const{crop:s}=this.props;if(s)return{top:`${s.y}${s.unit}`,left:`${s.x}${s.unit}`,width:`${s.width}${s.unit}`,height:`${s.height}${s.unit}`}}dragCrop(){const{evData:s}=this,t=this.getBox(),o=this.makePixelCrop(t),n=s.clientX-s.startClientX,i=s.clientY-s.startClientY;return o.x=ge(s.startCropX+n,0,t.width-o.width),o.y=ge(s.startCropY+i,0,t.height-o.height),o}getPointRegion(s,t,o,n){const{evData:i}=this,c=i.clientX-s.x,p=i.clientY-s.y;let d;n&&t?d=t==="nw"||t==="n"||t==="ne":d=p<i.startCropY;let l;return o&&t?l=t==="nw"||t==="w"||t==="sw":l=c<i.startCropX,l?d?"nw":"sw":d?"ne":"se"}resolveMinDimensions(s,t,o=0,n=0){const i=Math.min(o,s.width),c=Math.min(n,s.height);return!t||!i&&!c?[i,c]:t>1?i?[i,i/t]:[c*t,c]:c?[c*t,c]:[i,i/t]}resizeCrop(){const{evData:s}=this,{aspect:t=0,maxWidth:o,maxHeight:n}=this.props,i=this.getBox(),[c,p]=this.resolveMinDimensions(i,t,this.props.minWidth,this.props.minHeight);let d=this.makePixelCrop(i);const l=this.getPointRegion(i,s.ord,c,p),m=s.ord||l;let x=s.clientX-s.startClientX,j=s.clientY-s.startClientY;(c&&m==="nw"||m==="w"||m==="sw")&&(x=Math.min(x,-c)),(p&&m==="nw"||m==="n"||m==="ne")&&(j=Math.min(j,-p));const h={unit:"px",x:0,y:0,width:0,height:0};l==="ne"?(h.x=s.startCropX,h.width=x,t?(h.height=h.width/t,h.y=s.startCropY-h.height):(h.height=Math.abs(j),h.y=s.startCropY-h.height)):l==="se"?(h.x=s.startCropX,h.y=s.startCropY,h.width=x,t?h.height=h.width/t:h.height=j):l==="sw"?(h.x=s.startCropX+x,h.y=s.startCropY,h.width=Math.abs(x),t?h.height=h.width/t:h.height=j):l==="nw"&&(h.x=s.startCropX+x,h.width=Math.abs(x),t?(h.height=h.width/t,h.y=s.startCropY-h.height):(h.height=Math.abs(j),h.y=s.startCropY+j));const b=pt(h,t,l,i.width,i.height,c,p,o,n);return t||O.xyOrds.indexOf(m)>-1?d=b:O.xOrds.indexOf(m)>-1?(d.x=b.x,d.width=b.width):O.yOrds.indexOf(m)>-1&&(d.y=b.y,d.height=b.height),d.x=ge(d.x,0,i.width-d.width),d.y=ge(d.y,0,i.height-d.height),d}renderCropSelection(){const{ariaLabels:s=O.defaultProps.ariaLabels,disabled:t,locked:o,renderSelectionAddon:n,ruleOfThirds:i,crop:c}=this.props,p=this.getCropStyle();if(c)return N.createElement("div",{style:p,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":s.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!t&&!o&&N.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},N.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),N.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),N.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),N.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":s.nwDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"nw"),role:"button"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":s.nDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"n"),role:"button"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":s.neDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"ne"),role:"button"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":s.eDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"e"),role:"button"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":s.seDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"se"),role:"button"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":s.sDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"s"),role:"button"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":s.swDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"sw"),role:"button"}),N.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":s.wDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"w"),role:"button"})),n&&N.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:d=>d.stopPropagation()},n(this.state)),i&&N.createElement(N.Fragment,null,N.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),N.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(s){const t={...Ae,...this.props.crop||{}};return W(t,s.width,s.height)}render(){const{aspect:s,children:t,circularCrop:o,className:n,crop:i,disabled:c,locked:p,style:d,ruleOfThirds:l}=this.props,{cropIsActive:m,newCropIsBeingDrawn:x}=this.state,j=i?this.renderCropSelection():null,h=us("ReactCrop",n,m&&"ReactCrop--active",c&&"ReactCrop--disabled",p&&"ReactCrop--locked",x&&"ReactCrop--new-crop",i&&s&&"ReactCrop--fixed-aspect",i&&o&&"ReactCrop--circular-crop",i&&l&&"ReactCrop--rule-of-thirds",!this.dragStarted&&i&&!i.width&&!i.height&&"ReactCrop--invisible-crop",o&&"ReactCrop--no-animate");return N.createElement("div",{ref:this.componentRef,className:h,style:d},N.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),i?N.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},N.createElement("defs",null,N.createElement("mask",{id:`hole-${this.instanceId}`},N.createElement("rect",{width:"100%",height:"100%",fill:"white"}),o?N.createElement("ellipse",{cx:`${i.x+i.width/2}${i.unit}`,cy:`${i.y+i.height/2}${i.unit}`,rx:`${i.width/2}${i.unit}`,ry:`${i.height/2}${i.unit}`,fill:"black"}):N.createElement("rect",{x:`${i.x}${i.unit}`,y:`${i.y}${i.unit}`,width:`${i.width}${i.unit}`,height:`${i.height}${i.unit}`,fill:"black"}))),N.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,j)}};D(se,"xOrds",["e","w"]),D(se,"yOrds",["n","s"]),D(se,"xyOrds",["nw","ne","se","sw"]),D(se,"nudgeStep",1),D(se,"nudgeStepMedium",10),D(se,"nudgeStepLarge",100),D(se,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let ws=se;const vs=It("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Nt=f.forwardRef(({className:a,variant:s,...t},o)=>e.jsx("div",{ref:o,role:"alert",className:Q(vs({variant:s}),a),...t}));Nt.displayName="Alert";const _s=f.forwardRef(({className:a,...s},t)=>e.jsx("h5",{ref:t,className:Q("mb-1 font-medium leading-none tracking-tight",a),...s}));_s.displayName="AlertTitle";const yt=f.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:Q("text-sm [&_p]:leading-relaxed",a),...s}));yt.displayName="AlertDescription";const Ct=1200,Dt=630,gt=Ct/Dt;function bs(a,s,t){return gs(ps({unit:"%",width:90},t,a,s),a,s)}function Ns({open:a,onOpenChange:s,imageFile:t,onCropComplete:o}){const{t:n}=Ne(),[i,c]=f.useState(""),[p,d]=f.useState(),[l,m]=f.useState(),x=f.useRef(null),[j,h]=f.useState(!1);f.useEffect(()=>{if(a&&t){const g=new FileReader;g.addEventListener("load",()=>{var S;c(((S=g.result)==null?void 0:S.toString())||"")}),g.readAsDataURL(t)}},[a,t]);const b=f.useCallback(g=>{const{width:S,height:A}=g.currentTarget;d(bs(S,A,gt))},[]),k=f.useCallback(async(g,S)=>{const A=document.createElement("canvas"),V=A.getContext("2d");if(!V)throw new Error("No 2d context");const Z=g.naturalWidth/g.width,u=g.naturalHeight/g.height;return A.width=S.width*Z,A.height=S.height*u,V.imageSmoothingQuality="high",V.drawImage(g,S.x*Z,S.y*u,S.width*Z,S.height*u,0,0,A.width,A.height),new Promise((M,J)=>{A.toBlob(Y=>{if(!Y){J(new Error("Canvas is empty"));return}M(Y)},"image/jpeg",.95)})},[]),T=f.useCallback(async()=>{if(!(!l||!x.current)){h(!0);try{const g=await k(x.current,l),S=new File([g],t.name,{type:"image/jpeg"}),A=URL.createObjectURL(g);o(S,A),s(!1)}catch(g){console.error("Error cropping image:",g)}finally{h(!1)}}},[l,t,o,s,k]);return e.jsx(Me,{open:a,onOpenChange:s,children:e.jsxs(Fe,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Ie,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(Be,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-primary"}),n("admin.cropImage")]}),e.jsx(jt,{className:"text-xs sm:text-sm",children:n("admin.cropImageDescription")})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsxs(Nt,{className:"border-primary/20 bg-primary/5",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsxs(yt,{className:"text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[n("admin.recommendedSize"),":"]}),e.jsxs(q,{variant:"secondary",className:"w-fit",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),Ct," Ã— ",Dt," px"]})]}),e.jsx("p",{className:"mt-2 text-muted-foreground text-xs",children:n("admin.imageSizeHint")})]})]}),e.jsx("div",{className:"relative w-full overflow-hidden rounded-lg border",children:i&&e.jsx(ws,{crop:p,onChange:g=>d(g),onComplete:g=>m(g),aspect:gt,className:"max-h-[50vh] sm:max-h-[60vh]",children:e.jsx("img",{ref:x,src:i,alt:"Crop preview",onLoad:b,className:"max-w-full h-auto"})})})]}),e.jsxs(tt,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:j,className:"w-full sm:w-auto",children:n("common.cancel")}),e.jsx(C,{type:"button",onClick:T,disabled:!l||j,className:"w-full sm:w-auto",children:n(j?"common.processing":"admin.confirmCrop")})]})]})})}const ys=wt({title_en:_().optional(),title_zh:_().optional(),title_pt:_().optional(),intro_zh:_().optional(),intro_en:_().optional(),intro_pt:_().optional(),content_en:_().optional(),content_zh:_().optional(),content_pt:_().optional(),usage_instructions_zh:_().optional(),usage_instructions_en:_().optional(),usage_instructions_pt:_().optional(),start_date:ze().optional(),end_date:ze().optional(),repeat_mode:re(["none","daily","weekly","monthly","yearly","days_before"]).optional(),repeat_weekday:le().min(0).max(6).optional().nullable(),repeat_days_before:le().min(0).max(30).optional().nullable(),service_type:re(["dine_in","takeaway","both"]).optional(),status:re(["draft","published"]).default("draft"),pinned:Ee().default(!1),visible:Ee().default(!1),sort_order:le().default(0),badge_text_zh:_().optional(),badge_text_en:_().optional(),badge_text_pt:_().optional(),badge_color:_().optional(),discount_type:re(["percentage","fixed_amount"]).optional().nullable(),discount_value:le().optional().nullable(),discount_key:_().optional().nullable()}),Cs=wt({title_en:_().min(1,pe.t("validation.titleRequired")),title_zh:_().min(1,pe.t("validation.titleRequired")),title_pt:_().min(1,pe.t("validation.titleRequired")),intro_zh:_().optional(),intro_en:_().optional(),intro_pt:_().optional(),content_en:_().min(1,pe.t("validation.contentRequired")),content_zh:_().min(1,pe.t("validation.contentRequired")),content_pt:_().min(1,pe.t("validation.contentRequired")),usage_instructions_zh:_().optional(),usage_instructions_en:_().optional(),usage_instructions_pt:_().optional(),start_date:ze(),end_date:ze().optional(),repeat_mode:re(["none","daily","weekly","monthly","yearly","days_before"]),repeat_weekday:le().min(0).max(6).optional().nullable(),repeat_days_before:le().min(0).max(30).optional().nullable(),service_type:re(["dine_in","takeaway","both"]),status:re(["draft","published"]).default("published"),pinned:Ee().default(!1),visible:Ee().default(!0),sort_order:le().default(0),badge_text_zh:_().optional(),badge_text_en:_().optional(),badge_text_pt:_().optional(),badge_color:_().optional(),discount_type:re(["percentage","fixed_amount"]).optional().nullable(),discount_value:le().optional().nullable(),discount_key:_().optional().nullable()}),Ds=ys;function ft({activity:a,trigger:s}){const{t}=Ne(),o=Bt(),[n,i]=f.useState(!1),[c,p]=f.useState(null),[d,l]=f.useState((a==null?void 0:a.image_url)||null),[m,x]=f.useState([]),[j,h]=f.useState(!1),[b,k]=f.useState(!1),[T,g]=f.useState(null),[S,A]=f.useState((a==null?void 0:a.media_type)==="video"?"video":"image"),[V,Z]=f.useState(null),[u,M]=f.useState((a==null?void 0:a.video_url)||null),[J,Y]=f.useState(!1),[oe,me]=f.useState(!1),{data:xe}=Qt(),{register:F,handleSubmit:Le,formState:{errors:z},setValue:B,watch:P,control:X}=qt({resolver:Gt(Ds),defaultValues:a?{title_en:a.title_en,title_zh:a.title_zh,title_pt:a.title_pt,intro_zh:a.intro_zh||"",intro_en:a.intro_en||"",intro_pt:a.intro_pt||"",content_en:a.content_en,content_zh:a.content_zh,content_pt:a.content_pt,usage_instructions_zh:a.usage_instructions_zh||"",usage_instructions_en:a.usage_instructions_en||"",usage_instructions_pt:a.usage_instructions_pt||"",start_date:new Date(a.start_date),end_date:a.end_date?new Date(a.end_date):void 0,repeat_mode:a.repeat_mode||"none",repeat_weekday:a.repeat_weekday??null,repeat_days_before:a.repeat_days_before??null,service_type:a.service_type||"both",status:a.status||"draft",pinned:a.pinned||!1,visible:a.visible!==void 0?a.visible:!0,sort_order:a.sort_order||0,badge_text_zh:a.badge_text_zh||a.title_zh,badge_text_en:a.badge_text_en||a.title_en,badge_text_pt:a.badge_text_pt||a.title_pt,badge_color:a.badge_color||"#9b87f5",discount_type:a.discount_type||null,discount_value:a.discount_value||null,discount_key:a.discount_key||null}:{repeat_mode:"none",repeat_weekday:null,repeat_days_before:null,service_type:"both",status:"draft",pinned:!1,visible:!1,sort_order:0,badge_color:"#9b87f5",discount_type:null,discount_value:null,discount_key:null}}),ye=P("start_date"),Ce=P("end_date"),kt=P("pinned"),St=P("visible"),U=P("status");f.useEffect(()=>{U==="draft"&&(B("visible",!1),B("pinned",!1))},[U,B]),f.useEffect(()=>{(async()=>{if(a!=null&&a.id){const{data:v}=await I.from("activity_restaurants").select("restaurant_id").eq("activity_id",a.id);v&&x(v.map(E=>E.restaurant_id))}})()},[a==null?void 0:a.id]);const at=r=>{var E;const v=(E=r.target.files)==null?void 0:E[0];if(v){if(v.size>10*1024*1024){he.error(t("admin.imageTooBig"));return}g(v),k(!0)}r.target.value=""},zt=(r,v)=>{p(r),l(v)},Et=r=>{var E;const v=(E=r.target.files)==null?void 0:E[0];if(v){if(v.size>100*1024*1024){he.error(t("admin.videoTooBig")||"è§†é¢‘æ–‡ä»¶è¿‡å¤§ï¼ˆæœ€å¤§100MBï¼‰");return}if(!v.type.startsWith("video/")){he.error(t("admin.invalidVideoFormat")||"è¯·ä¸Šä¼ è§†é¢‘æ–‡ä»¶");return}Z(v),M(URL.createObjectURL(v)),me(!1)}r.target.value=""},Rt=async()=>{if(!c)return(a==null?void 0:a.image_url)||null;const r=c.name.split(".").pop(),E=`${`${Math.random()}.${r}`}`,{error:G}=await I.storage.from("activity-images").upload(E,c);if(G)throw G;const{data:{publicUrl:He}}=I.storage.from("activity-images").getPublicUrl(E);return He},Pt=async()=>{if(oe&&!V)return null;if(!V)return(a==null?void 0:a.video_url)||null;Y(!0);try{const r=V.name.split(".").pop(),v=`video_${Date.now()}.${r}`,{error:E}=await I.storage.from("activity-images").upload(v,V);if(E)throw E;const{data:{publicUrl:G}}=I.storage.from("activity-images").getPublicUrl(v);return G}finally{Y(!1)}},Tt=async r=>{var v,E;h(!0);try{if(r.status==="published"){const ee=Cs.safeParse(r);if(!ee.success){const ue={title_zh:t("admin.titleChinese"),title_en:t("admin.titleEnglish"),title_pt:t("admin.titlePortuguese"),content_zh:t("admin.contentChinese"),content_en:t("admin.contentEnglish"),content_pt:t("admin.contentPortuguese"),start_date:t("admin.startDate"),end_date:t("admin.endDate"),repeat_mode:t("admin.repeatMode"),service_type:t("admin.serviceType")},te=ee.error.errors.map(de=>{const ce=de.path.join(".");return ue[ce]||ce});he.error(`${t("admin.publishRequiresComplete")}: ${te.join(", ")}`),h(!1);return}}const{data:{user:G}}=await I.auth.getUser();if(!G)throw new Error("Not authenticated");const[He,At]=await Promise.all([Rt(),Pt()]),Mt=r.status==="draft"?!1:r.visible,nt={title_en:r.title_en||"",title_zh:r.title_zh||"",title_pt:r.title_pt||"",intro_zh:r.intro_zh||null,intro_en:r.intro_en||null,intro_pt:r.intro_pt||null,content_en:r.content_en||"",content_zh:r.content_zh||"",content_pt:r.content_pt||"",usage_instructions_zh:r.usage_instructions_zh||null,usage_instructions_en:r.usage_instructions_en||null,usage_instructions_pt:r.usage_instructions_pt||null,repeat_mode:r.repeat_mode||"none",repeat_weekday:r.repeat_mode==="weekly"?r.repeat_weekday:null,repeat_days_before:r.repeat_mode==="days_before"?r.repeat_days_before:null,service_type:r.service_type||"both",status:r.status,pinned:r.status==="draft"?!1:r.pinned,visible:Mt,sort_order:r.sort_order,image_url:He,media_type:S,video_url:At,creator_id:G.id,start_date:((v=r.start_date)==null?void 0:v.toISOString())||new Date().toISOString(),end_date:((E=r.end_date)==null?void 0:E.toISOString())||null,badge_text_zh:r.badge_text_zh||r.title_zh||"",badge_text_en:r.badge_text_en||r.title_en||"",badge_text_pt:r.badge_text_pt||r.title_pt||"",badge_color:r.badge_color||"#9b87f5",discount_type:r.discount_type||null,discount_value:r.discount_value||null,discount_key:r.discount_key||null};if(a){const{error:ee}=await I.from("activities").update(nt).eq("id",a.id);if(ee)throw ee;if(await I.from("activity_restaurants").delete().eq("activity_id",a.id),m.length>0){const ue=m.map(de=>({activity_id:a.id,restaurant_id:de})),{error:te}=await I.from("activity_restaurants").insert(ue);if(te)throw te}he.success(t("admin.activityUpdated")),i(!1)}else{const{data:ee,error:ue}=await I.from("activities").insert([nt]).select().single();if(ue)throw ue;if(m.length>0){const de=m.map(Ft=>({activity_id:ee.id,restaurant_id:Ft})),{error:ce}=await I.from("activity_restaurants").insert(de);if(ce)throw ce}const{data:te}=await I.from("coupon_templates").select("id").eq("auto_link_activities",!0).eq("is_active",!0);if(te&&te.length>0){const de=te.map(ce=>({coupon_template_id:ce.id,activity_id:ee.id}));await I.from("coupon_template_activities").insert(de)}he.success(t("admin.activityCreated")),i(!1)}o.invalidateQueries({queryKey:["activities"]})}catch(G){he.error(G.message||t("common.error"))}finally{h(!1)}};return e.jsxs(Me,{open:n,onOpenChange:i,children:[e.jsx(st,{asChild:!0,children:s}),e.jsxs(Fe,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Ie,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[e.jsxs(Be,{className:"text-2xl flex items-center gap-2",children:[e.jsx($e,{className:"w-6 h-6 text-primary"}),t(a?"admin.editActivity":"admin.addActivity")]}),e.jsx(jt,{className:"text-base",children:t(a?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),e.jsx(it,{className:"px-6 h-[calc(95vh-220px)]",children:e.jsxs("form",{onSubmit:Le(Tt),className:"space-y-6 py-6",children:[e.jsx(ne,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(ie,{className:"p-6",children:[e.jsxs(w,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(ht,{className:"w-5 h-5 text-primary"}),t("admin.activityMedia")||"æ´»åŠ¨åª’ä½“"]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(C,{type:"button",variant:S==="image"?"default":"outline",size:"sm",onClick:()=>A("image"),className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),t("admin.image")||"å›¾ç‰‡"]}),e.jsxs(C,{type:"button",variant:S==="video"?"default":"outline",size:"sm",onClick:()=>A("video"),className:"flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),t("admin.video")||"è§†é¢‘"]})]}),S==="image"&&e.jsxs("div",{className:"flex items-center gap-6",children:[d&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:d,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),e.jsx(C,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{p(null),l(null)},children:e.jsx(Ue,{className:"h-4 w-4"})})]}),e.jsxs(w,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(ht,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:t("admin.uploadImage")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t("admin.imageMaxSize")})]})]}),e.jsx(R,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:at})]})]}),S==="video"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[u&&e.jsxs("div",{className:"relative group",children:[e.jsx("video",{src:u,className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20",muted:!0,loop:!0,playsInline:!0,onMouseEnter:r=>r.currentTarget.play(),onMouseLeave:r=>{r.currentTarget.pause(),r.currentTarget.currentTime=0}}),e.jsx(C,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{Z(null),M(null),me(!0)},children:e.jsx(Ue,{className:"h-4 w-4"})})]}),e.jsxs(w,{htmlFor:"video-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(xt,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:t("admin.uploadVideo")||"ä¸Šä¼ è§†é¢‘"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t("admin.videoMaxSize")||"æœ€å¤§ 50MB"})]})]}),e.jsx(R,{id:"video-upload",type:"file",accept:"video/*",className:"hidden",onChange:Et})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(w,{className:"text-sm font-medium mb-2 block",children:t("admin.fallbackImage")||"å°é¢å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:t("admin.fallbackImageDesc")||"è§†é¢‘åŠ è½½å‰æ˜¾ç¤ºçš„å°é¢å›¾"}),e.jsxs("div",{className:"flex items-center gap-4",children:[d&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:d,alt:"Fallback",className:"w-20 h-20 object-cover rounded-lg shadow ring-2 ring-primary/20"}),e.jsx(C,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-1 -right-1 h-6 w-6 shadow opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{p(null),l(null)},children:e.jsx(Ue,{className:"h-3 w-3"})})]}),e.jsxs(w,{htmlFor:"fallback-image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all text-sm",children:[e.jsx(mt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:t("admin.uploadFallback")||"ä¸Šä¼ å°é¢"})]}),e.jsx(R,{id:"fallback-image-upload",type:"file",accept:"image/*",className:"hidden",onChange:at})]})]})]})]})]})}),e.jsx(ne,{className:"border-primary/20",children:e.jsxs(ie,{className:"p-6",children:[e.jsxs(w,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx($e,{className:"w-5 h-5 text-primary"}),t("admin.multilingualContent")]}),e.jsxs(Re,{defaultValue:"zh",className:"w-full",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(L,{value:"zh",className:"gap-2",children:["ğŸ‡¨ğŸ‡³ ",t("admin.chinese")]}),e.jsxs(L,{value:"en",className:"gap-2",children:["ğŸ‡¬ğŸ‡§ ",t("admin.english")]}),e.jsxs(L,{value:"pt",className:"gap-2",children:["ğŸ‡µğŸ‡¹ ",t("admin.portuguese")]})]}),e.jsxs(H,{value:"zh",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"title_zh",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(R,{id:"title_zh",...F("title_zh"),placeholder:t("admin.enterTitle"),className:"text-base"}),z.title_zh&&e.jsx("p",{className:"text-sm text-destructive",children:z.title_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"intro_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ç®€ä»‹"}),e.jsx(R,{id:"intro_zh",...F("intro_zh"),placeholder:"ç®€çŸ­æè¿°æ´»åŠ¨ï¼ˆæ˜¾ç¤ºåœ¨é¤å…è¯¦æƒ…é¡µï¼‰",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"åœ¨é¤å…è¯¦æƒ…é¡µæ´»åŠ¨æ ‡ç­¾åæ˜¾ç¤ºçš„ç®€çŸ­è¯´æ˜"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"content_zh",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(K,{name:"content_zh",control:X,render:({field:r})=>e.jsx($,{value:r.value,onChange:r.onChange,placeholder:t("admin.enterContent")})}),z.content_zh&&e.jsx("p",{className:"text-sm text-destructive",children:z.content_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"usage_instructions_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ä½¿ç”¨æ–¹æ³•"}),e.jsx(K,{name:"usage_instructions_zh",control:X,render:({field:r})=>e.jsx($,{value:r.value||"",onChange:r.onChange,placeholder:"æè¿°å¦‚ä½•ä½¿ç”¨æ­¤æ´»åŠ¨ï¼ˆå¯é€‰ï¼‰"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"å‘ç”¨æˆ·è¯´æ˜å¦‚ä½•å‚ä¸å’Œä½¿ç”¨æ­¤æ´»åŠ¨"})]})]}),e.jsxs(H,{value:"en",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"title_en",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(R,{id:"title_en",...F("title_en"),placeholder:t("admin.enterTitle"),className:"text-base"}),z.title_en&&e.jsx("p",{className:"text-sm text-destructive",children:z.title_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"intro_en",className:"text-sm font-medium",children:"Activity Brief"}),e.jsx(R,{id:"intro_en",...F("intro_en"),placeholder:"Short description (shown on restaurant details)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Brief description shown after activity badge on restaurant page"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"content_en",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(K,{name:"content_en",control:X,render:({field:r})=>e.jsx($,{value:r.value,onChange:r.onChange,placeholder:t("admin.enterContent")})}),z.content_en&&e.jsx("p",{className:"text-sm text-destructive",children:z.content_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"usage_instructions_en",className:"text-sm font-medium",children:"Usage Instructions"}),e.jsx(K,{name:"usage_instructions_en",control:X,render:({field:r})=>e.jsx($,{value:r.value||"",onChange:r.onChange,placeholder:"Describe how to use this activity (optional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explain to users how to participate and use this activity"})]})]}),e.jsxs(H,{value:"pt",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"title_pt",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(R,{id:"title_pt",...F("title_pt"),placeholder:t("admin.enterTitle"),className:"text-base"}),z.title_pt&&e.jsx("p",{className:"text-sm text-destructive",children:z.title_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"intro_pt",className:"text-sm font-medium",children:"Resumo da Atividade"}),e.jsx(R,{id:"intro_pt",...F("intro_pt"),placeholder:"DescriÃ§Ã£o curta (exibida nos detalhes do restaurante)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Breve descriÃ§Ã£o exibida apÃ³s o distintivo da atividade na pÃ¡gina do restaurante"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"content_pt",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(K,{name:"content_pt",control:X,render:({field:r})=>e.jsx($,{value:r.value,onChange:r.onChange,placeholder:t("admin.enterContent")})}),z.content_pt&&e.jsx("p",{className:"text-sm text-destructive",children:z.content_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"usage_instructions_pt",className:"text-sm font-medium",children:"InstruÃ§Ãµes de Uso"}),e.jsx(K,{name:"usage_instructions_pt",control:X,render:({field:r})=>e.jsx($,{value:r.value||"",onChange:r.onChange,placeholder:"Descreva como usar esta atividade (opcional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explique aos usuÃ¡rios como participar e usar esta atividade"})]})]})]})]})}),e.jsx(ne,{className:"border-primary/20",children:e.jsxs(ie,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(w,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),t("admin.dateSettings")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm font-medium",children:t("admin.startDate")}),e.jsxs(ot,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:Q("w-full justify-start text-left font-normal h-11",!ye&&"text-muted-foreground"),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),ye?Te(ye,"PPP"):e.jsx("span",{children:t("admin.selectDate")})]})}),e.jsx(ct,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(lt,{mode:"single",selected:ye,onSelect:r=>B("start_date",r),initialFocus:!0,className:"pointer-events-auto"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm font-medium",children:t("admin.endDate")}),e.jsxs(ot,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:Q("w-full justify-start text-left font-normal h-11",!Ce&&"text-muted-foreground"),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),Ce?Te(Ce,"PPP"):e.jsxs("span",{children:[t("admin.selectDate")," (",t("admin.optional"),")"]})]})}),e.jsx(ct,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(lt,{mode:"single",selected:Ce,onSelect:r=>B("end_date",r),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:t("admin.repeatMode")}),e.jsxs(je,{onValueChange:r=>B("repeat_mode",r),defaultValue:P("repeat_mode"),children:[e.jsx(we,{className:"h-11",children:e.jsx(ve,{placeholder:t("admin.selectRepeatMode")})}),e.jsxs(_e,{children:[e.jsx(y,{value:"none",children:t("admin.repeatNone")}),e.jsx(y,{value:"daily",children:t("admin.repeatDaily")}),e.jsx(y,{value:"weekly",children:t("admin.repeatWeekly")}),e.jsx(y,{value:"monthly",children:t("admin.repeatMonthly")}),e.jsx(y,{value:"yearly",children:t("admin.repeatYearly")}),e.jsx(y,{value:"days_before",children:t("admin.repeatDaysBefore")})]})]})]}),P("repeat_mode")==="weekly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"repeat_weekday",className:"text-sm font-medium",children:"æ¯å‘¨é‡å¤æ—¥ / Weekly on"}),e.jsx(K,{name:"repeat_weekday",control:X,render:({field:r})=>{var v;return e.jsxs(je,{value:((v=r.value)==null?void 0:v.toString())||"",onValueChange:E=>r.onChange(E?parseInt(E):null),children:[e.jsx(we,{className:"h-11",children:e.jsx(ve,{placeholder:"é€‰æ‹©æ˜ŸæœŸå‡  / Select day"})}),e.jsxs(_e,{children:[e.jsx(y,{value:"1",children:"å‘¨ä¸€ / Monday"}),e.jsx(y,{value:"2",children:"å‘¨äºŒ / Tuesday"}),e.jsx(y,{value:"3",children:"å‘¨ä¸‰ / Wednesday"}),e.jsx(y,{value:"4",children:"å‘¨å›› / Thursday"}),e.jsx(y,{value:"5",children:"å‘¨äº” / Friday"}),e.jsx(y,{value:"6",children:"å‘¨å…­ / Saturday"}),e.jsx(y,{value:"0",children:"å‘¨æ—¥ / Sunday"})]})]})}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"é€‰æ‹©æ´»åŠ¨æ¯å‘¨ç”Ÿæ•ˆçš„æ—¥æœŸ / Select which day this activity is valid each week"})]}),P("repeat_mode")==="days_before"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"repeat_days_before",className:"text-sm font-medium",children:t("admin.daysBeforeLabel")}),e.jsx(K,{name:"repeat_days_before",control:X,render:({field:r})=>e.jsx(R,{type:"number",min:1,max:30,className:"h-11",placeholder:t("admin.daysBeforePlaceholder"),value:r.value??"",onChange:v=>r.onChange(v.target.value?parseInt(v.target.value):null)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.daysBeforeHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"service_type",className:"text-sm font-medium",children:t("admin.serviceType")}),e.jsxs(je,{onValueChange:r=>B("service_type",r),defaultValue:P("service_type"),children:[e.jsx(we,{className:"h-11",children:e.jsx(ve,{placeholder:t("admin.selectServiceType")})}),e.jsxs(_e,{children:[e.jsx(y,{value:"dine_in",children:t("activities.serviceType.dine_in")}),e.jsx(y,{value:"takeaway",children:t("activities.serviceType.takeaway")}),e.jsx(y,{value:"both",children:t("activities.serviceType.both")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{className:"text-sm font-medium flex items-center gap-2",children:[P("status")==="draft"?e.jsx(Je,{className:"w-4 h-4 text-yellow-500"}):e.jsx(Ze,{className:"w-4 h-4 text-green-500"}),"æ´»åŠ¨çŠ¶æ€"]}),e.jsxs(je,{onValueChange:r=>B("status",r),value:U||"draft",children:[e.jsx(we,{className:"h-11",children:e.jsx(ve,{})}),e.jsxs(_e,{children:[e.jsx(y,{value:"draft",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-yellow-500"}),"è‰ç¨¿"]})}),e.jsx(y,{value:"published",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 text-green-500"}),"å·²å‘å¸ƒ"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:U==="draft"?"è‰ç¨¿çŠ¶æ€ï¼šæ— å¿…å¡«é¡¹ï¼Œä¸æ˜¾ç¤ºåœ¨å‰ç«¯ï¼Œé¤å…ä¸ä¼šæ”¶åˆ°é€šçŸ¥":"å‘å¸ƒæ—¶å°†éªŒè¯å¿…å¡«é¡¹"})]}),e.jsxs("div",{className:Q("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",U==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(be,{id:"pinned",checked:kt,onCheckedChange:r=>B("pinned",r===!0),className:"data-[state=checked]:bg-primary",disabled:U==="draft"}),e.jsxs(w,{htmlFor:"pinned",className:Q("flex items-center gap-2 text-sm font-medium",U==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(hs,{className:"w-4 h-4 text-primary"}),t("admin.pinToTop")]})]}),e.jsxs("div",{className:Q("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",U==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(be,{id:"visible",checked:St,onCheckedChange:r=>B("visible",r===!0),className:"data-[state=checked]:bg-primary",disabled:U==="draft"}),e.jsxs(w,{htmlFor:"visible",className:Q("flex items-center gap-2 text-sm font-medium",U==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx($e,{className:"w-4 h-4 text-primary"}),"æ˜¾ç¤ºæ´»åŠ¨",U==="draft"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(è‰ç¨¿é»˜è®¤å…³é—­)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-primary"}),t("admin.sortOrder")]}),e.jsx(R,{id:"sort_order",type:"number",...F("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),e.jsx(ne,{className:"border-primary/20",children:e.jsxs(ie,{className:"p-6",children:[e.jsxs(w,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"w-5 h-5 text-primary"}),"æ˜¾ç¤ºå¾½ç« è®¾ç½®"]}),e.jsxs(Re,{defaultValue:"zh",className:"w-full",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(L,{value:"zh",children:"ğŸ‡¨ğŸ‡³ ä¸­æ–‡"}),e.jsx(L,{value:"en",children:"ğŸ‡¬ğŸ‡§ English"}),e.jsx(L,{value:"pt",children:"ğŸ‡µğŸ‡¹ PortuguÃªs"})]}),e.jsx(H,{value:"zh",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"badge_text_zh",className:"text-sm",children:["å¾½ç« æ–‡å­— (ä¸­æ–‡) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"badge_text_zh",...F("badge_text_zh"),placeholder:"ä¾‹å¦‚: ç²‰ä¸èŠ‚"}),z.badge_text_zh&&e.jsx("p",{className:"text-sm text-destructive",children:z.badge_text_zh.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"å¾½ç« æ–‡å­—æ˜¾ç¤ºåœ¨é¤å…è¯¦æƒ…å’Œæ´»åŠ¨åˆ—è¡¨ä¸­ï¼Œå»ºè®®ç®€æ´æ˜äº†"})]})}),e.jsx(H,{value:"en",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"badge_text_en",className:"text-sm",children:["Badge Text (English) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"badge_text_en",...F("badge_text_en"),placeholder:"e.g. Fan Festival"}),z.badge_text_en&&e.jsx("p",{className:"text-sm text-destructive",children:z.badge_text_en.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Badge text shown on restaurant details and activity list, keep it concise"})]})}),e.jsx(H,{value:"pt",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"badge_text_pt",className:"text-sm",children:["Texto do Distintivo (PortuguÃªs) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"badge_text_pt",...F("badge_text_pt"),placeholder:"ex: Festival dos FÃ£s"}),z.badge_text_pt&&e.jsx("p",{className:"text-sm text-destructive",children:z.badge_text_pt.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Texto do emblema exibido nos detalhes do restaurante e na lista de atividades, mantenha-o conciso"})]})})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(w,{htmlFor:"badge_color",className:"text-sm",children:"å¾½ç« é¢œè‰² / Badge Color"}),e.jsx(K,{name:"badge_color",control:X,render:({field:r})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{id:"badge_color",type:"color",value:r.value||"#9b87f5",onChange:v=>r.onChange(v.target.value),className:"w-20 h-11 cursor-pointer"}),e.jsx(R,{value:r.value||"#9b87f5",onChange:v=>r.onChange(v.target.value),placeholder:"#9b87f5",className:"flex-1"})]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"é¢„è§ˆ / Preview:"}),e.jsx(q,{style:{backgroundColor:P("badge_color")||"#9b87f5"},className:"text-white",children:P("badge_text_zh")||P("title_zh")||"ç¤ºä¾‹"})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx(w,{className:"text-sm font-medium flex items-center gap-2 mb-3",children:"ğŸ’° ä¼˜æƒ è®¾ç½® / Discount Settings"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"discount_type",className:"text-sm",children:"æŠ˜æ‰£ç±»å‹ / Discount Type"}),e.jsx(K,{name:"discount_type",control:X,render:({field:r})=>e.jsxs(je,{value:r.value||"none",onValueChange:v=>r.onChange(v==="none"?null:v),children:[e.jsx(we,{className:"h-11",children:e.jsx(ve,{placeholder:"é€‰æ‹©æŠ˜æ‰£ç±»å‹"})}),e.jsxs(_e,{children:[e.jsx(y,{value:"none",children:"æ— ä¼˜æƒ  / No Discount"}),e.jsx(y,{value:"percentage",children:"ç™¾åˆ†æ¯”æŠ˜æ‰£ / Percentage"}),e.jsx(y,{value:"fixed_amount",children:"å›ºå®šé‡‘é¢ / Fixed Amount"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"discount_value",className:"text-sm",children:["æŠ˜æ‰£å€¼ / Discount Value",P("discount_type")==="percentage"&&" (%)",P("discount_type")==="fixed_amount"&&" (â‚¬)"]}),e.jsx(R,{id:"discount_value",type:"number",step:"0.01",...F("discount_value",{valueAsNumber:!0}),className:"h-11",placeholder:P("discount_type")==="percentage"?"ä¾‹å¦‚: 20 (è¡¨ç¤º8æŠ˜)":"ä¾‹å¦‚: 5 (è¡¨ç¤ºå‡5â‚¬)",disabled:!P("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:P("discount_type")==="percentage"?"è¾“å…¥æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼Œå¦‚ 20 è¡¨ç¤ºæ‰“8æŠ˜ï¼ˆå‡20%ï¼‰":P("discount_type")==="fixed_amount"?"è¾“å…¥å›ºå®šå‡å…é‡‘é¢ï¼ˆæ¬§å…ƒï¼‰":"å…ˆé€‰æ‹©æŠ˜æ‰£ç±»å‹"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"discount_key",className:"text-sm",children:"æŠ˜æ‰£æ ‡è¯† / Discount Key"}),e.jsx(R,{id:"discount_key",type:"text",...F("discount_key"),className:"h-11",placeholder:"ä¾‹å¦‚: SUMMER2025, VIP_DISCOUNT",disabled:!P("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ç”¨äºå¤–éƒ¨ç³»ç»Ÿè¯†åˆ«çš„æŠ˜æ‰£æ ‡è¯†ç¬¦"})]})]})]})]})}),e.jsx(ne,{className:"border-primary/20",children:e.jsxs(ie,{className:"p-6",children:[e.jsxs(w,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Lt,{className:"w-5 h-5 text-primary"}),t("admin.associatedRestaurants")]}),e.jsx(it,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:e.jsx("div",{className:"space-y-2",children:xe==null?void 0:xe.map(r=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[e.jsx(be,{id:r.id,checked:m.includes(r.id),onCheckedChange:v=>{x(v?[...m,r.id]:m.filter(E=>E!==r.id))},className:"data-[state=checked]:bg-primary"}),e.jsx(w,{htmlFor:r.id,className:"cursor-pointer flex-1 font-normal",children:r.name}),m.includes(r.id)&&e.jsx(q,{variant:"secondary",className:"text-xs",children:"å·²é€‰"})]},r.id))})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["å·²é€‰æ‹© ",m.length," ä¸ªé¤å…"]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>i(!1),className:"min-w-[100px]",children:t("common.cancel")}),e.jsx(C,{type:"submit",disabled:j,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),t("common.saving")]}):t("common.save")})]})]})}),T&&e.jsx(Ns,{open:b,onOpenChange:k,imageFile:T,onCropComplete:zt})]})]})}const ks=({children:a})=>{const{t:s}=Ne(),{data:t,isLoading:o}=es(),n=ts(),[i,c]=f.useState(!1),[p,d]=f.useState("zh"),[l,m]=f.useState(""),[x,j]=f.useState(""),[h,b]=f.useState("");f.useEffect(()=>{t&&(m(t.content_zh),j(t.content_en),b(t.content_pt))},[t]);const k=async()=>{if(t)try{await n.mutateAsync({id:t.id,content_zh:l,content_en:x,content_pt:h}),Se({title:s("common.success"),description:"æ´»åŠ¨æ¡ä¾‹å·²æ›´æ–°"}),c(!1)}catch{Se({title:s("common.error"),description:"æ›´æ–°å¤±è´¥",variant:"destructive"})}};return e.jsxs(Me,{open:i,onOpenChange:c,children:[e.jsx(st,{asChild:!0,children:a}),e.jsxs(Fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"}),"ç¼–è¾‘æ´»åŠ¨æ¡ä¾‹"]})}),o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ke,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(Re,{value:p,onValueChange:d,children:[e.jsxs(Pe,{className:"grid w-full grid-cols-3",children:[e.jsx(L,{value:"zh",children:"ä¸­æ–‡"}),e.jsx(L,{value:"en",children:"English"}),e.jsx(L,{value:"pt",children:"PortuguÃªs"})]}),e.jsx(H,{value:"zh",className:"mt-4",children:e.jsx($,{value:l,onChange:m,placeholder:"è¯·è¾“å…¥ä¸­æ–‡æ´»åŠ¨æ¡ä¾‹å†…å®¹..."})}),e.jsx(H,{value:"en",className:"mt-4",children:e.jsx($,{value:x,onChange:j,placeholder:"Enter English activity rules..."})}),e.jsx(H,{value:"pt",className:"mt-4",children:e.jsx($,{value:h,onChange:b,placeholder:"Digite as regras da atividade em portuguÃªs..."})})]})}),e.jsxs(tt,{children:[e.jsx(C,{variant:"outline",onClick:()=>c(!1),children:s("common.cancel")}),e.jsxs(C,{onClick:k,disabled:n.isPending,children:[n.isPending?e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(_t,{className:"w-4 h-4 mr-2"}),s("common.save")]})]})]})]})},Ss=({children:a})=>{const{t:s}=Ne(),{data:t,isLoading:o}=ss(),n=as(),[i,c]=f.useState(!1),[p,d]=f.useState("zh"),[l,m]=f.useState(""),[x,j]=f.useState(""),[h,b]=f.useState("");f.useEffect(()=>{t&&(m(t.content_zh),j(t.content_en),b(t.content_pt))},[t]);const k=async()=>{if(t)try{await n.mutateAsync({id:t.id,content_zh:l,content_en:x,content_pt:h}),Se({title:s("common.success"),description:s("activities.handbook.updateSuccess")}),c(!1)}catch{Se({title:s("common.error"),description:s("activities.handbook.updateError"),variant:"destructive"})}};return e.jsxs(Me,{open:i,onOpenChange:c,children:[e.jsx(st,{asChild:!0,children:a}),e.jsxs(Fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-5 h-5"}),s("admin.editActivityHandbook")]})}),o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ke,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(Re,{value:p,onValueChange:d,children:[e.jsxs(Pe,{className:"grid w-full grid-cols-3",children:[e.jsx(L,{value:"zh",children:"ä¸­æ–‡"}),e.jsx(L,{value:"en",children:"English"}),e.jsx(L,{value:"pt",children:"PortuguÃªs"})]}),e.jsx(H,{value:"zh",className:"mt-4",children:e.jsx($,{value:l,onChange:m,placeholder:"è¯·è¾“å…¥ä¸­æ–‡æ´»åŠ¨æ‰‹å†Œå†…å®¹..."})}),e.jsx(H,{value:"en",className:"mt-4",children:e.jsx($,{value:x,onChange:j,placeholder:"Enter English activity handbook content..."})}),e.jsx(H,{value:"pt",className:"mt-4",children:e.jsx($,{value:h,onChange:b,placeholder:"Digite o conteÃºdo do manual da atividade em portuguÃªs..."})})]})}),e.jsxs(tt,{children:[e.jsx(C,{variant:"outline",onClick:()=>c(!1),children:s("common.cancel")}),e.jsxs(C,{onClick:k,disabled:n.isPending,children:[n.isPending?e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(_t,{className:"w-4 h-4 mr-2"}),s("common.save")]})]})]})]})},oa=()=>{const{t:a}=Ne(),{toast:s}=Ht(),{data:t,isLoading:o}=Yt(),{getLocalizedField:n}=Xt(),i=Kt(),c=Wt(),[p,d]=f.useState([]),[l,m]=f.useState(""),[x,j]=f.useState("all"),[h,b]=f.useState({}),[k,T]=f.useState(""),g=f.useMemo(()=>t?t.filter(u=>{const M=String(n(u,"title")||""),J=String(n(u,"content")||""),Y=l===""||M.toLowerCase().includes(l.toLowerCase())||J.toLowerCase().includes(l.toLowerCase()),oe=new Date,me=new Date(u.start_date),xe=u.end_date?new Date(u.end_date):null,F=xe?xe<oe:!1,Le=!F&&me<=oe,z=u.status||"published",B=x==="all"||x==="active"&&Le||x==="ended"&&F||x==="pinned"&&u.pinned||x==="draft"&&z==="draft"||x==="published"&&z==="published";return Y&&B}):[],[t,l,x,n]),S=()=>{if(!t||t.length===0){s({title:a("common.error"),description:a("admin.noDataToExport"),variant:"destructive"});return}ns(t),s({title:a("common.success"),description:a("admin.exportSuccess")})},A=u=>{d(M=>M.includes(u)?M.filter(J=>J!==u):[...M,u])},V=()=>{p.length===(g==null?void 0:g.length)?d([]):d((g==null?void 0:g.map(u=>u.id))||[])},Z=()=>{p.length!==0&&(c.mutate(p),d([]))};return o?e.jsx("div",{className:"text-center",children:a("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:a("admin.activityManagement")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.manageActivities")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(Ss,{children:e.jsxs(C,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.activityHandbook")})]})}),e.jsx(ks,{children:e.jsxs(C,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.activityRules")})]})}),e.jsxs(C,{variant:"outline",onClick:S,className:"flex-1 sm:flex-initial",children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.exportCSV")})]}),e.jsx(ft,{trigger:e.jsxs(C,{className:"flex-1 sm:flex-initial",children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),a("admin.addActivity")]})})]})]}),e.jsx(ne,{children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(R,{placeholder:a("admin.searchActivities"),value:l,onChange:u=>m(u.target.value),className:"pl-9"})]})}),e.jsxs(je,{value:x,onValueChange:j,children:[e.jsx(we,{className:"w-[180px]",children:e.jsx(ve,{placeholder:a("admin.filterByStatus")})}),e.jsxs(_e,{children:[e.jsx(y,{value:"all",children:a("admin.allStatus")}),e.jsx(y,{value:"draft",children:a("admin.statusDraft")}),e.jsx(y,{value:"published",children:a("admin.statusPublished")}),e.jsx(y,{value:"active",children:a("admin.statusActive")}),e.jsx(y,{value:"ended",children:a("admin.statusEnded")}),e.jsx(y,{value:"pinned",children:a("admin.statusPinned")})]})]})]})})}),p.length>0&&e.jsx(ne,{className:"bg-muted/50",children:e.jsx(ie,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("span",{className:"font-medium",children:a("admin.selectedCount",{count:p.length})}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[e.jsxs(Oe,{children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(C,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[e.jsx($t,{className:"mr-2 h-4 w-4"}),a("admin.batchDelete")]})}),e.jsxs(Ye,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Xe,{children:[e.jsx(Ke,{children:a("admin.confirmBatchDelete")}),e.jsxs(We,{className:"space-y-3",children:[e.jsx("p",{children:a("admin.batchDeleteWarning",{count:p.length})}),e.jsx("p",{className:"font-semibold text-destructive",children:a("admin.willDeleteActivities",{count:p.length})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:a("admin.typeDeleteToConfirmBatch")}),e.jsx(R,{value:k,onChange:u=>T(u.target.value),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs(qe,{children:[e.jsx(Ge,{onClick:()=>T(""),children:a("common.cancel")}),e.jsx(Qe,{disabled:k!=="DELETE",onClick:()=>{Z(),T("")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>d([]),className:"flex-1 sm:flex-initial",children:a("admin.clearSelection")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(be,{checked:p.length===(g==null?void 0:g.length)&&g.length>0,onCheckedChange:V}),e.jsx("span",{className:"font-medium",children:a("admin.selectAll")}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",g==null?void 0:g.length," ",a("admin.results"),")"]})]}),e.jsx("div",{className:"grid gap-4",children:g==null?void 0:g.map(u=>e.jsx(ne,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center",children:[e.jsx("div",{className:"p-4 flex items-start md:self-start",children:e.jsx(be,{checked:p.includes(u.id),onCheckedChange:()=>A(u.id),className:"mt-1"})}),u.image_url&&e.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden mx-auto md:mx-0 flex-shrink-0",children:e.jsx("img",{src:u.image_url,alt:String(n(u,"title")),className:"object-cover w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(Ut,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx(Ot,{className:"text-lg md:text-xl",children:n(u,"title")}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[u.status==="draft"?e.jsxs(q,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[e.jsx(Je,{className:"w-3 h-3 mr-1"}),"è‰ç¨¿"]}):e.jsxs(q,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(Ze,{className:"w-3 h-3 mr-1"}),"å·²å‘å¸ƒ"]}),!u.visible&&e.jsx(q,{variant:"secondary",children:a("admin.hidden")}),u.pinned&&e.jsx(q,{children:a("activities.pinned")}),(()=>{const M=new Date,J=new Date(u.start_date),Y=u.end_date?new Date(u.end_date):null,oe=Y?Y<M:!1,me=!oe&&J<=M;return oe?e.jsx(q,{variant:"secondary",children:a("activities.ended")}):me?e.jsx(q,{children:a("activities.ongoing")}):null})()]})]}),e.jsx(Vt,{className:"line-clamp-2",children:e.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:n(u,"content")}})})]}),e.jsxs(ie,{children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:e.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsx(De,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"text-xs sm:text-sm",children:[Te(new Date(u.start_date),"PPP"),u.end_date&&` - ${Te(new Date(u.end_date),"PPP")}`]})]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[u.status!=="draft"&&e.jsx(C,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsxs(rt,{to:`/admin/activity-stats/${u.id}`,children:[e.jsx(os,{className:"w-4 h-4 mr-1"}),a("admin.stats","ç»Ÿè®¡")]})}),e.jsx(C,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsx(rt,{to:`/activity/${u.id}`,state:{from:"admin"},children:a("admin.view")})}),e.jsx(ft,{activity:u,trigger:e.jsx(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.edit")})}),u.status==="draft"?e.jsxs(Oe,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(Ye,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Xe,{children:[e.jsx(Ke,{children:a("admin.confirmDelete")}),e.jsxs(We,{children:[e.jsx("p",{children:a("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground mt-2",children:n(u,"title")})]})]}),e.jsxs(qe,{children:[e.jsx(Ge,{children:a("common.cancel")}),e.jsx(Qe,{onClick:()=>i.mutate(u.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]}):e.jsxs(Oe,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(Ye,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Xe,{children:[e.jsx(Ke,{children:a("admin.confirmDelete")}),e.jsxs(We,{className:"space-y-3",children:[e.jsx("p",{children:a("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground",children:n(u,"title")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:a("admin.typeDeleteToConfirmBatch")}),e.jsx(R,{value:h[u.id]||"",onChange:M=>b({...h,[u.id]:M.target.value}),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs(qe,{children:[e.jsx(Ge,{onClick:()=>b({...h,[u.id]:""}),children:a("common.cancel")}),e.jsx(Qe,{disabled:h[u.id]!=="DELETE",onClick:()=>{i.mutate(u.id),b({...h,[u.id]:""})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]})]})]})]})]})},u.id))})]})};export{oa as default};
