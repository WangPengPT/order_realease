{"version":3,"file":"PublicProfile-CPUBIYpk.js","sources":["../../src/pages/PublicProfile.tsx"],"sourcesContent":["import { useParams, useNavigate, Link } from \"react-router-dom\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ChefHat, ArrowLeft, Store, Calendar, Heart, Utensils, FileText, MapPin, Lock } from \"lucide-react\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\n// Fetch public profile data\r\nconst usePublicProfile = (userId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"public-profile\", userId],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name, avatar_url, has_published_recipe\")\r\n        .eq(\"id\", userId)\r\n        .single();\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    enabled: !!userId,\r\n  });\r\n};\r\n\r\nconst usePublicUserRole = (userId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"public-user-role\", userId],\r\n    queryFn: async () => {\r\n      const { data } = await supabase\r\n        .from(\"user_roles\")\r\n        .select(\"role\")\r\n        .eq(\"user_id\", userId)\r\n        .maybeSingle();\r\n      return data?.role || \"user\";\r\n    },\r\n    enabled: !!userId,\r\n  });\r\n};\r\n\r\nconst usePublicFavoriteRestaurants = (userId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"public-favorites\", userId],\r\n    queryFn: async () => {\r\n      const { data: favorites } = await supabase\r\n        .from(\"favorites\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", userId);\r\n\r\n      if (!favorites || favorites.length === 0) return [];\r\n\r\n      const ids = favorites.map((f) => f.restaurant_id);\r\n      const { data: restaurants } = await supabase\r\n        .from(\"restaurants\")\r\n        .select(\"id, name, name_en, name_pt, type, cover_image_url, address\")\r\n        .in(\"id\", ids)\r\n        .eq(\"visible\", true);\r\n\r\n      return restaurants || [];\r\n    },\r\n    enabled: !!userId,\r\n  });\r\n};\r\n\r\nconst usePublicSubscribedActivities = (userId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"public-subscriptions\", userId],\r\n    queryFn: async () => {\r\n      const { data: subs } = await supabase\r\n        .from(\"subscriptions\")\r\n        .select(\"activity_id\")\r\n        .eq(\"user_id\", userId);\r\n\r\n      if (!subs || subs.length === 0) return [];\r\n\r\n      const ids = subs.map((s: any) => s.activity_id);\r\n      const { data: activities } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"id, title_en, title_zh, title_pt, image_url, start_date, status, visible\")\r\n        .in(\"id\", ids)\r\n        .eq(\"status\", \"published\")\r\n        .eq(\"visible\", true);\r\n\r\n      return activities || [];\r\n    },\r\n    enabled: !!userId,\r\n  });\r\n};\r\n\r\nconst usePublicPosts = (userId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"public-posts\", userId],\r\n    queryFn: async () => {\r\n      const { data } = await supabase\r\n        .from(\"community_posts\")\r\n        .select(`\r\n          *,\r\n          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url),\r\n          activity:activities(id, title_en, title_zh, title_pt),\r\n          restaurant:restaurants(id, name, name_en, name_pt),\r\n          post_restaurants(restaurant:restaurants(id, name, name_en, name_pt))\r\n        `)\r\n        .eq(\"author_id\", userId)\r\n        .eq(\"status\", \"approved\")\r\n        .eq(\"post_type\", \"post\")\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(50);\r\n\r\n      return (data || []).map((post: any) => ({\r\n        ...post,\r\n        restaurants: post.post_restaurants?.map((pr: any) => pr.restaurant).filter(Boolean) || [],\r\n      }));\r\n    },\r\n    enabled: !!userId,\r\n  });\r\n};\r\n\r\nconst usePublicRecipes = (userId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"public-recipes\", userId],\r\n    queryFn: async () => {\r\n      const { data } = await supabase\r\n        .from(\"community_posts\")\r\n        .select(`\r\n          *,\r\n          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url),\r\n          activity:activities(id, title_en, title_zh, title_pt),\r\n          restaurant:restaurants(id, name, name_en, name_pt),\r\n          post_restaurants(restaurant:restaurants(id, name, name_en, name_pt))\r\n        `)\r\n        .eq(\"author_id\", userId)\r\n        .eq(\"status\", \"approved\")\r\n        .eq(\"post_type\", \"recipe\")\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(50);\r\n\r\n      return (data || []).map((post: any) => ({\r\n        ...post,\r\n        restaurants: post.post_restaurants?.map((pr: any) => pr.restaurant).filter(Boolean) || [],\r\n      }));\r\n    },\r\n    enabled: !!userId,\r\n  });\r\n};\r\n\r\nconst useManagedRestaurants = (userId: string, role: string) => {\r\n  return useQuery({\r\n    queryKey: [\"public-managed-restaurants\", userId],\r\n    queryFn: async () => {\r\n      const { data } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"restaurant_id, restaurants:restaurant_id(id, name, name_en, name_pt, cover_image_url, address, type)\")\r\n        .eq(\"user_id\", userId);\r\n\r\n      return (data || [])\r\n        .map((r: any) => r.restaurants)\r\n        .filter(Boolean);\r\n    },\r\n    enabled: !!userId && (role === \"merchant\" || role === \"supervisor\"),\r\n  });\r\n};\r\n\r\nexport default function PublicProfile() {\r\n  const { userId } = useParams<{ userId: string }>();\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n\r\n  const { user } = useAuth();\r\n  const isLoggedIn = !!user;\r\n\r\n  const { data: profile, isLoading: profileLoading } = usePublicProfile(userId!);\r\n  const { data: role } = usePublicUserRole(userId!);\r\n  const { data: favoriteRestaurants = [] } = usePublicFavoriteRestaurants(userId!);\r\n  const { data: subscribedActivities = [] } = usePublicSubscribedActivities(userId!);\r\n  const { data: posts = [] } = usePublicPosts(userId!);\r\n  const { data: recipes = [] } = usePublicRecipes(userId!);\r\n  const { data: managedRestaurants = [] } = useManagedRestaurants(userId!, role || \"user\");\r\n\r\n  const isMerchantOrSupervisor = role === \"merchant\" || role === \"supervisor\";\r\n\r\n  if (profileLoading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!profile) {\r\n    return (\r\n      <div className=\"min-h-screen flex flex-col items-center justify-center gap-4\">\r\n        <p className=\"text-muted-foreground\">{t(\"publicProfile.notFound\", \"用户不存在\")}</p>\r\n        <Button variant=\"outline\" onClick={() => navigate(-1)}>\r\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n          {t(\"common.back\", \"返回\")}\r\n        </Button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const displayName = profile.display_name || t(\"publicProfile.anonymousUser\", \"匿名用户\");\r\n  const initials = displayName.charAt(0).toUpperCase();\r\n\r\n  const roleDisplay = role === \"merchant\"\r\n    ? t(\"profile.roles.merchant\", \"商家\")\r\n    : role === \"supervisor\"\r\n      ? t(\"profile.roles.supervisor\", \"主管\")\r\n      : null;\r\n\r\n  return (\r\n    <div className=\"min-h-screen\">\r\n      <div className=\"max-w-3xl mx-auto px-4 py-6\">\r\n        {/* Back Button */}\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"sm\"\r\n          className=\"mb-4 -ml-2\"\r\n          onClick={() => navigate(-1)}\r\n        >\r\n          <ArrowLeft className=\"h-4 w-4 mr-1\" />\r\n          {t(\"common.back\", \"返回\")}\r\n        </Button>\r\n\r\n        {/* Profile Header */}\r\n        <div className=\"flex flex-col items-center text-center mb-8\">\r\n          <Avatar className=\"h-24 w-24 mb-4 ring-2 ring-border\">\r\n            <AvatarImage src={profile.avatar_url || undefined} />\r\n            <AvatarFallback className=\"text-2xl font-semibold bg-primary/10 text-primary\">\r\n              {initials}\r\n            </AvatarFallback>\r\n          </Avatar>\r\n\r\n          <h1 className=\"text-2xl font-bold mb-2\">{displayName}</h1>\r\n\r\n          {/* Badges - only visible when logged in */}\r\n          {isLoggedIn && (\r\n            <div className=\"flex items-center gap-2 flex-wrap justify-center\">\r\n              {roleDisplay && (\r\n                <Badge className=\"bg-primary capitalize\">\r\n                  {roleDisplay}\r\n                </Badge>\r\n              )}\r\n              {profile.has_published_recipe && (\r\n                <Badge\r\n                  className=\"gap-1 border font-semibold\"\r\n                  style={{\r\n                    background: \"linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 50%, #a8a8a8 100%)\",\r\n                    borderColor: \"#b0b0b0\",\r\n                    color: \"#3a3a3a\",\r\n                    boxShadow: \"0 1px 3px rgba(0,0,0,0.2)\",\r\n                  }}\r\n                >\r\n                  <ChefHat className=\"w-3 h-3\" />\r\n                  {t(\"profile.recipeExpert\", \"食谱达人\")}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Login gate for unauthenticated users */}\r\n        {!isLoggedIn && (\r\n          <div className=\"relative mt-2\">\r\n            {/* Blurred preview of tab content */}\r\n            <div className=\"pointer-events-none select-none blur-sm opacity-40 overflow-hidden rounded-xl\">\r\n              <div className=\"flex gap-2 mb-4\">\r\n                {[1,2,3,4].map(i => (\r\n                  <div key={i} className=\"flex-1 h-9 rounded-md bg-muted\" />\r\n                ))}\r\n              </div>\r\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\r\n                {[1,2,3,4,5,6].map(i => (\r\n                  <div key={i} className=\"rounded-lg overflow-hidden bg-muted aspect-square\" />\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Overlay CTA */}\r\n            <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-4 text-center px-4\">\r\n              <div className=\"bg-background/90 backdrop-blur-md border border-border rounded-2xl px-8 py-8 shadow-lg flex flex-col items-center gap-3 max-w-xs w-full\">\r\n                <div className=\"rounded-full bg-primary/10 p-3\">\r\n                  <Lock className=\"h-6 w-6 text-primary\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"font-semibold text-base mb-1\">\r\n                    {t(\"publicProfile.loginToView\", \"登录后查看更多信息\")}\r\n                  </p>\r\n                  <p className=\"text-xs text-muted-foreground leading-relaxed\">\r\n                    {t(\"publicProfile.loginToViewDesc\", \"登录以查看该用户的徽章、帖子、食谱、收藏及活动\")}\r\n                  </p>\r\n                </div>\r\n                <Button className=\"w-full\" onClick={() => navigate(\"/auth\")}>\r\n                  {t(\"activities.goToLogin\", \"去登录\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Tabs - only visible when logged in */}\r\n        {isLoggedIn && (\r\n        <Tabs defaultValue={isMerchantOrSupervisor ? \"managed\" : \"posts\"}>\r\n          <TabsList className=\"w-full mb-6 flex flex-wrap h-auto gap-1\">\r\n            {isMerchantOrSupervisor && (\r\n              <TabsTrigger value=\"managed\" className=\"flex-1 gap-1.5\">\r\n                <Store className=\"h-4 w-4\" />\r\n                <span className=\"hidden sm:inline\">{t(\"publicProfile.managedRestaurants\", \"管辖餐厅\")}</span>\r\n                <span className=\"sm:hidden\">{t(\"publicProfile.managed\", \"餐厅\")}</span>\r\n                {managedRestaurants.length > 0 && (\r\n                  <span className=\"ml-1 text-xs text-muted-foreground\">({managedRestaurants.length})</span>\r\n                )}\r\n              </TabsTrigger>\r\n            )}\r\n            <TabsTrigger value=\"posts\" className=\"flex-1 gap-1.5\">\r\n              <FileText className=\"h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">{t(\"publicProfile.posts\", \"帖子\")}</span>\r\n              {posts.length > 0 && (\r\n                <span className=\"ml-1 text-xs text-muted-foreground\">({posts.length})</span>\r\n              )}\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"recipes\" className=\"flex-1 gap-1.5\">\r\n              <Utensils className=\"h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">{t(\"publicProfile.recipes\", \"食谱\")}</span>\r\n              {recipes.length > 0 && (\r\n                <span className=\"ml-1 text-xs text-muted-foreground\">({recipes.length})</span>\r\n              )}\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"favorites\" className=\"flex-1 gap-1.5\">\r\n              <Heart className=\"h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">{t(\"publicProfile.favorites\", \"收藏餐厅\")}</span>\r\n              {favoriteRestaurants.length > 0 && (\r\n                <span className=\"ml-1 text-xs text-muted-foreground\">({favoriteRestaurants.length})</span>\r\n              )}\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"activities\" className=\"flex-1 gap-1.5\">\r\n              <Calendar className=\"h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">{t(\"publicProfile.activities\", \"活动\")}</span>\r\n              {subscribedActivities.length > 0 && (\r\n                <span className=\"ml-1 text-xs text-muted-foreground\">({subscribedActivities.length})</span>\r\n              )}\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Managed Restaurants Tab */}\r\n          {isMerchantOrSupervisor && (\r\n            <TabsContent value=\"managed\">\r\n              {managedRestaurants.length === 0 ? (\r\n                <EmptyState icon={<Store className=\"h-10 w-10 text-muted-foreground/40\" />} text={t(\"publicProfile.noManagedRestaurants\", \"暂无管辖餐厅\")} />\r\n              ) : (\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                  {managedRestaurants.map((restaurant: any) => (\r\n                    <RestaurantCard key={restaurant.id} restaurant={restaurant} getLocalizedField={getLocalizedField} t={t} />\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </TabsContent>\r\n          )}\r\n\r\n          {/* Posts Tab */}\r\n          <TabsContent value=\"posts\">\r\n            {posts.length === 0 ? (\r\n              <EmptyState icon={<FileText className=\"h-10 w-10 text-muted-foreground/40\" />} text={t(\"publicProfile.noPosts\", \"暂无公开帖子\")} />\r\n            ) : (\r\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\r\n                {posts.map((post: any) => (\r\n                  <PostGridCard key={post.id} post={post} />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n\r\n          {/* Recipes Tab */}\r\n          <TabsContent value=\"recipes\">\r\n            {recipes.length === 0 ? (\r\n              <EmptyState icon={<Utensils className=\"h-10 w-10 text-muted-foreground/40\" />} text={t(\"publicProfile.noRecipes\", \"暂无公开食谱\")} />\r\n            ) : (\r\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\r\n                {recipes.map((post: any) => (\r\n                  <PostGridCard key={post.id} post={post} />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n\r\n          {/* Favorite Restaurants Tab */}\r\n          <TabsContent value=\"favorites\">\r\n            {favoriteRestaurants.length === 0 ? (\r\n              <EmptyState icon={<Heart className=\"h-10 w-10 text-muted-foreground/40\" />} text={t(\"publicProfile.noFavorites\", \"暂无收藏餐厅\")} />\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                {favoriteRestaurants.map((restaurant: any) => (\r\n                  <RestaurantCard key={restaurant.id} restaurant={restaurant} getLocalizedField={getLocalizedField} t={t} />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n\r\n          {/* Activities Tab */}\r\n          <TabsContent value=\"activities\">\r\n            {subscribedActivities.length === 0 ? (\r\n              <EmptyState icon={<Calendar className=\"h-10 w-10 text-muted-foreground/40\" />} text={t(\"publicProfile.noActivities\", \"暂无订阅活动\")} />\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                {subscribedActivities.map((activity: any) => (\r\n                  <ActivityCard key={activity.id} activity={activity} getLocalizedField={getLocalizedField} t={t} />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n        </Tabs>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Sub-components\r\nfunction EmptyState({ icon, text }: { icon: React.ReactNode; text: string }) {\r\n  return (\r\n    <div className=\"flex flex-col items-center justify-center py-16 gap-3 text-center\">\r\n      {icon}\r\n      <p className=\"text-muted-foreground text-sm\">{text}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction RestaurantCard({ restaurant, getLocalizedField, t }: { restaurant: any; getLocalizedField: any; t: any }) {\r\n  const name = getLocalizedField(restaurant, \"name\");\r\n  return (\r\n    <Link to={`/restaurant/${restaurant.id}`}>\r\n      <Card className=\"hover:shadow-md transition-shadow cursor-pointer group overflow-hidden\">\r\n        <CardContent className=\"p-0\">\r\n          {restaurant.cover_image_url ? (\r\n            <img\r\n              src={restaurant.cover_image_url}\r\n              alt={name}\r\n              className=\"w-full h-28 object-cover group-hover:scale-105 transition-transform duration-300\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-full h-28 bg-muted flex items-center justify-center\">\r\n              <Store className=\"h-8 w-8 text-muted-foreground/40\" />\r\n            </div>\r\n          )}\r\n          <div className=\"p-3\">\r\n            <p className=\"font-semibold text-sm line-clamp-1\">{name}</p>\r\n            {restaurant.address && (\r\n              <p className=\"text-xs text-muted-foreground mt-0.5 line-clamp-1 flex items-center gap-1\">\r\n                <MapPin className=\"h-3 w-3 flex-shrink-0\" />\r\n                {restaurant.address}\r\n              </p>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </Link>\r\n  );\r\n}\r\n\r\nfunction ActivityCard({ activity, getLocalizedField, t }: { activity: any; getLocalizedField: any; t: any }) {\r\n  const title = getLocalizedField(activity, \"title\");\r\n  return (\r\n    <Link to={`/activity/${activity.id}`}>\r\n      <Card className=\"hover:shadow-md transition-shadow cursor-pointer group overflow-hidden\">\r\n        <CardContent className=\"p-0\">\r\n          {activity.image_url ? (\r\n            <img\r\n              src={activity.image_url}\r\n              alt={title}\r\n              className=\"w-full h-28 object-cover group-hover:scale-105 transition-transform duration-300\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-full h-28 bg-muted flex items-center justify-center\">\r\n              <Calendar className=\"h-8 w-8 text-muted-foreground/40\" />\r\n            </div>\r\n          )}\r\n          <div className=\"p-3\">\r\n            <p className=\"font-semibold text-sm line-clamp-2\">{title}</p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </Link>\r\n  );\r\n}\r\n"],"names":["usePublicProfile","userId","useQuery","data","error","supabase","usePublicUserRole","usePublicFavoriteRestaurants","favorites","ids","f","restaurants","usePublicSubscribedActivities","subs","s","activities","usePublicPosts","post","pr","usePublicRecipes","useManagedRestaurants","role","PublicProfile","useParams","navigate","useNavigate","t","useTranslation","getLocalizedField","useLocalizedContent","user","useAuth","isLoggedIn","profile","profileLoading","favoriteRestaurants","subscribedActivities","posts","recipes","managedRestaurants","isMerchantOrSupervisor","jsx","jsxs","Button","ArrowLeft","displayName","initials","roleDisplay","Avatar","AvatarImage","AvatarFallback","Badge","ChefHat","Lock","Tabs","TabsList","TabsTrigger","Store","FileText","Utensils","Heart","Calendar","TabsContent","EmptyState","restaurant","RestaurantCard","PostGridCard","activity","ActivityCard","icon","text","name","Link","Card","CardContent","MapPin","title"],"mappings":"s2BAeA,MAAMA,EAAoBC,GACjBC,EAAS,CACd,SAAU,CAAC,iBAAkBD,CAAM,EACnC,QAAS,SAAY,CACnB,KAAM,CAAE,KAAAE,EAAM,MAAAC,CAAA,EAAU,MAAMC,EAC3B,KAAK,UAAU,EACf,OAAO,oDAAoD,EAC3D,GAAG,KAAMJ,CAAM,EACf,SACH,GAAIG,EAAa,MAAAA,EACV,OAAAD,CACT,EACA,QAAS,CAAC,CAACF,CAAA,CACZ,EAGGK,EAAqBL,GAClBC,EAAS,CACd,SAAU,CAAC,mBAAoBD,CAAM,EACrC,QAAS,SAAY,CACnB,KAAM,CAAE,KAAAE,CAAS,EAAA,MAAME,EACpB,KAAK,YAAY,EACjB,OAAO,MAAM,EACb,GAAG,UAAWJ,CAAM,EACpB,YAAY,EACf,OAAOE,GAAM,MAAQ,MACvB,EACA,QAAS,CAAC,CAACF,CAAA,CACZ,EAGGM,EAAgCN,GAC7BC,EAAS,CACd,SAAU,CAAC,mBAAoBD,CAAM,EACrC,QAAS,SAAY,CACnB,KAAM,CAAE,KAAMO,CAAU,EAAI,MAAMH,EAC/B,KAAK,WAAW,EAChB,OAAO,eAAe,EACtB,GAAG,UAAWJ,CAAM,EAEvB,GAAI,CAACO,GAAaA,EAAU,SAAW,QAAU,CAAA,EAEjD,MAAMC,EAAMD,EAAU,IAAKE,GAAMA,EAAE,aAAa,EAC1C,CAAE,KAAMC,GAAgB,MAAMN,EACjC,KAAK,aAAa,EAClB,OAAO,4DAA4D,EACnE,GAAG,KAAMI,CAAG,EACZ,GAAG,UAAW,EAAI,EAErB,OAAOE,GAAe,CAAA,CACxB,EACA,QAAS,CAAC,CAACV,CAAA,CACZ,EAGGW,GAAiCX,GAC9BC,EAAS,CACd,SAAU,CAAC,uBAAwBD,CAAM,EACzC,QAAS,SAAY,CACnB,KAAM,CAAE,KAAMY,CAAK,EAAI,MAAMR,EAC1B,KAAK,eAAe,EACpB,OAAO,aAAa,EACpB,GAAG,UAAWJ,CAAM,EAEvB,GAAI,CAACY,GAAQA,EAAK,SAAW,QAAU,CAAA,EAEvC,MAAMJ,EAAMI,EAAK,IAAKC,GAAWA,EAAE,WAAW,EACxC,CAAE,KAAMC,CAAW,EAAI,MAAMV,EAChC,KAAK,YAAY,EACjB,OAAO,0EAA0E,EACjF,GAAG,KAAMI,CAAG,EACZ,GAAG,SAAU,WAAW,EACxB,GAAG,UAAW,EAAI,EAErB,OAAOM,GAAc,CAAA,CACvB,EACA,QAAS,CAAC,CAACd,CAAA,CACZ,EAGGe,GAAkBf,GACfC,EAAS,CACd,SAAU,CAAC,eAAgBD,CAAM,EACjC,QAAS,SAAY,CACb,KAAA,CAAE,KAAAE,GAAS,MAAME,EACpB,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMP,EACA,GAAG,YAAaJ,CAAM,EACtB,GAAG,SAAU,UAAU,EACvB,GAAG,YAAa,MAAM,EACtB,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAM,EAAE,EAEX,OAAQE,GAAQ,CAAA,GAAI,IAAKc,IAAe,CACtC,GAAGA,EACH,YAAaA,EAAK,kBAAkB,IAAKC,GAAYA,EAAG,UAAU,EAAE,OAAO,OAAO,GAAK,CAAC,CACxF,EAAA,CACJ,EACA,QAAS,CAAC,CAACjB,CAAA,CACZ,EAGGkB,GAAoBlB,GACjBC,EAAS,CACd,SAAU,CAAC,iBAAkBD,CAAM,EACnC,QAAS,SAAY,CACb,KAAA,CAAE,KAAAE,GAAS,MAAME,EACpB,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMP,EACA,GAAG,YAAaJ,CAAM,EACtB,GAAG,SAAU,UAAU,EACvB,GAAG,YAAa,QAAQ,EACxB,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAM,EAAE,EAEX,OAAQE,GAAQ,CAAA,GAAI,IAAKc,IAAe,CACtC,GAAGA,EACH,YAAaA,EAAK,kBAAkB,IAAKC,GAAYA,EAAG,UAAU,EAAE,OAAO,OAAO,GAAK,CAAC,CACxF,EAAA,CACJ,EACA,QAAS,CAAC,CAACjB,CAAA,CACZ,EAGGmB,GAAwB,CAACnB,EAAgBoB,IACtCnB,EAAS,CACd,SAAU,CAAC,6BAA8BD,CAAM,EAC/C,QAAS,SAAY,CACnB,KAAM,CAAE,KAAAE,CAAS,EAAA,MAAME,EACpB,KAAK,sBAAsB,EAC3B,OAAO,sGAAsG,EAC7G,GAAG,UAAWJ,CAAM,EAEf,OAAAE,GAAQ,IACb,IAAK,GAAW,EAAE,WAAW,EAC7B,OAAO,OAAO,CACnB,EACA,QAAS,CAAC,CAACF,IAAWoB,IAAS,YAAcA,IAAS,aAAA,CACvD,EAGH,SAAwBC,IAAgB,CAChC,KAAA,CAAE,OAAArB,GAAWsB,IACbC,EAAWC,IACX,CAAE,EAAAC,GAAMC,IACR,CAAE,kBAAAC,GAAsBC,IAExB,CAAE,KAAAC,GAASC,IACXC,EAAa,CAAC,CAACF,EAEf,CAAE,KAAMG,EAAS,UAAWC,GAAmBlC,EAAiBC,CAAO,EACvE,CAAE,KAAMoB,CAAK,EAAIf,EAAkBL,CAAO,EAC1C,CAAE,KAAMkC,EAAsB,CAAG,CAAA,EAAI5B,EAA6BN,CAAO,EACzE,CAAE,KAAMmC,EAAuB,CAAG,CAAA,EAAIxB,GAA8BX,CAAO,EAC3E,CAAE,KAAMoC,EAAQ,CAAG,CAAA,EAAIrB,GAAef,CAAO,EAC7C,CAAE,KAAMqC,EAAU,CAAG,CAAA,EAAInB,GAAiBlB,CAAO,EACjD,CAAE,KAAMsC,EAAqB,IAAOnB,GAAsBnB,EAASoB,GAAQ,MAAM,EAEjFmB,EAAyBnB,IAAS,YAAcA,IAAS,aAE/D,GAAIa,EAEA,OAAAO,EAAA,IAAC,OAAI,UAAU,gDACb,eAAC,MAAI,CAAA,UAAU,6DAA8D,CAAA,CAC/E,CAAA,EAIJ,GAAI,CAACR,EAED,OAAAS,EAAA,KAAC,MAAI,CAAA,UAAU,+DACb,SAAA,CAAAD,MAAC,KAAE,UAAU,wBAAyB,SAAEf,EAAA,yBAA0B,OAAO,EAAE,EAC3EgB,OAACC,GAAO,QAAQ,UAAU,QAAS,IAAMnB,EAAS,EAAE,EAClD,SAAA,CAACiB,EAAAA,IAAAG,EAAA,CAAU,UAAU,cAAe,CAAA,EACnClB,EAAE,cAAe,IAAI,CAAA,EACxB,CACF,CAAA,CAAA,EAIJ,MAAMmB,EAAcZ,EAAQ,cAAgBP,EAAE,8BAA+B,MAAM,EAC7EoB,EAAWD,EAAY,OAAO,CAAC,EAAE,YAAY,EAE7CE,EAAc1B,IAAS,WACzBK,EAAE,yBAA0B,IAAI,EAChCL,IAAS,aACPK,EAAE,2BAA4B,IAAI,EAClC,KAEN,aACG,MAAI,CAAA,UAAU,eACb,SAACgB,EAAA,KAAA,MAAA,CAAI,UAAU,8BAEb,SAAA,CAAAA,EAAA,KAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,aACV,QAAS,IAAMnB,EAAS,EAAE,EAE1B,SAAA,CAACiB,EAAAA,IAAAG,EAAA,CAAU,UAAU,cAAe,CAAA,EACnClB,EAAE,cAAe,IAAI,CAAA,CAAA,CACxB,EAGAgB,EAAAA,KAAC,MAAI,CAAA,UAAU,8CACb,SAAA,CAACA,EAAAA,KAAAM,EAAA,CAAO,UAAU,oCAChB,SAAA,CAAAP,EAAA,IAACQ,EAAY,CAAA,IAAKhB,EAAQ,YAAc,OAAW,EAClDQ,EAAA,IAAAS,EAAA,CAAe,UAAU,oDACvB,SACHJ,EAAA,CAAA,EACF,EAECL,EAAA,IAAA,KAAA,CAAG,UAAU,0BAA2B,SAAYI,EAAA,EAGpDb,GACCU,EAAA,KAAC,MAAI,CAAA,UAAU,mDACZ,SAAA,CAAAK,GACEN,EAAA,IAAAU,EAAA,CAAM,UAAU,wBACd,SACHJ,EAAA,EAEDd,EAAQ,sBACPS,EAAA,KAACS,EAAA,CACC,UAAU,6BACV,MAAO,CACL,WAAY,iEACZ,YAAa,UACb,MAAO,UACP,UAAW,2BACb,EAEA,SAAA,CAACV,EAAAA,IAAAW,EAAA,CAAQ,UAAU,SAAU,CAAA,EAC5B1B,EAAE,uBAAwB,MAAM,CAAA,CAAA,CACnC,CAAA,EAEJ,CAAA,EAEJ,EAGC,CAACM,GACCU,EAAAA,KAAA,MAAA,CAAI,UAAU,gBAEb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,gFACb,SAAA,CAAAD,MAAC,OAAI,UAAU,kBACZ,SAAC,CAAA,EAAE,EAAE,EAAE,CAAC,EAAE,OACRA,EAAA,IAAA,MAAA,CAAY,UAAU,gCAAb,EAAA,CAA8C,CACzD,EACH,EACAA,EAAAA,IAAC,OAAI,UAAU,wCACZ,UAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,OACZA,EAAAA,IAAA,MAAA,CAAY,UAAU,mDAAb,EAAA,CAAiE,CAC5E,EACH,CAAA,EACF,QAGC,MAAI,CAAA,UAAU,oFACb,SAACC,EAAA,KAAA,MAAA,CAAI,UAAU,0IACb,SAAA,CAAAD,EAAAA,IAAC,OAAI,UAAU,iCACb,eAACY,EAAK,CAAA,UAAU,uBAAuB,CACzC,CAAA,SACC,MACC,CAAA,SAAA,CAAAZ,MAAC,KAAE,UAAU,+BACV,SAAEf,EAAA,4BAA6B,WAAW,EAC7C,QACC,IAAE,CAAA,UAAU,gDACV,SAAEA,EAAA,gCAAiC,yBAAyB,EAC/D,CAAA,EACF,EACCe,EAAAA,IAAAE,EAAA,CAAO,UAAU,SAAS,QAAS,IAAMnB,EAAS,OAAO,EACvD,SAAAE,EAAE,uBAAwB,KAAK,CAClC,CAAA,CAAA,CAAA,CACF,CACF,CAAA,CAAA,EACF,EAIDM,GACAU,EAAAA,KAAAY,EAAA,CAAK,aAAcd,EAAyB,UAAY,QACvD,SAAA,CAACE,EAAAA,KAAAa,EAAA,CAAS,UAAU,0CACjB,SAAA,CAAAf,GACEE,EAAAA,KAAAc,EAAA,CAAY,MAAM,UAAU,UAAU,iBACrC,SAAA,CAACf,EAAAA,IAAAgB,EAAA,CAAM,UAAU,SAAU,CAAA,QAC1B,OAAK,CAAA,UAAU,mBAAoB,SAAE/B,EAAA,mCAAoC,MAAM,EAAE,QACjF,OAAK,CAAA,UAAU,YAAa,SAAEA,EAAA,wBAAyB,IAAI,EAAE,EAC7Da,EAAmB,OAAS,GAC1BG,EAAA,KAAA,OAAA,CAAK,UAAU,qCAAqC,SAAA,CAAA,IAAEH,EAAmB,OAAO,GAAA,EAAC,CAAA,EAEtF,EAEDG,EAAA,KAAAc,EAAA,CAAY,MAAM,QAAQ,UAAU,iBACnC,SAAA,CAACf,EAAAA,IAAAiB,EAAA,CAAS,UAAU,SAAU,CAAA,QAC7B,OAAK,CAAA,UAAU,mBAAoB,SAAEhC,EAAA,sBAAuB,IAAI,EAAE,EAClEW,EAAM,OAAS,GACbK,EAAA,KAAA,OAAA,CAAK,UAAU,qCAAqC,SAAA,CAAA,IAAEL,EAAM,OAAO,GAAA,EAAC,CAAA,EAEzE,EACCK,EAAA,KAAAc,EAAA,CAAY,MAAM,UAAU,UAAU,iBACrC,SAAA,CAACf,EAAAA,IAAAkB,EAAA,CAAS,UAAU,SAAU,CAAA,QAC7B,OAAK,CAAA,UAAU,mBAAoB,SAAEjC,EAAA,wBAAyB,IAAI,EAAE,EACpEY,EAAQ,OAAS,GACfI,EAAA,KAAA,OAAA,CAAK,UAAU,qCAAqC,SAAA,CAAA,IAAEJ,EAAQ,OAAO,GAAA,EAAC,CAAA,EAE3E,EACCI,EAAA,KAAAc,EAAA,CAAY,MAAM,YAAY,UAAU,iBACvC,SAAA,CAACf,EAAAA,IAAAmB,EAAA,CAAM,UAAU,SAAU,CAAA,QAC1B,OAAK,CAAA,UAAU,mBAAoB,SAAElC,EAAA,0BAA2B,MAAM,EAAE,EACxES,EAAoB,OAAS,GAC3BO,EAAA,KAAA,OAAA,CAAK,UAAU,qCAAqC,SAAA,CAAA,IAAEP,EAAoB,OAAO,GAAA,EAAC,CAAA,EAEvF,EACCO,EAAA,KAAAc,EAAA,CAAY,MAAM,aAAa,UAAU,iBACxC,SAAA,CAACf,EAAAA,IAAAoB,EAAA,CAAS,UAAU,SAAU,CAAA,QAC7B,OAAK,CAAA,UAAU,mBAAoB,SAAEnC,EAAA,2BAA4B,IAAI,EAAE,EACvEU,EAAqB,OAAS,GAC5BM,EAAA,KAAA,OAAA,CAAK,UAAU,qCAAqC,SAAA,CAAA,IAAEN,EAAqB,OAAO,GAAA,EAAC,CAAA,EAExF,CAAA,EACF,EAGCI,GACEC,EAAAA,IAAAqB,EAAA,CAAY,MAAM,UAChB,WAAmB,SAAW,EAC5BrB,EAAAA,IAAAsB,EAAA,CAAW,KAAOtB,EAAA,IAAAgB,EAAA,CAAM,UAAU,qCAAqC,EAAI,KAAM/B,EAAE,qCAAsC,QAAQ,EAAG,EAEpIe,MAAA,MAAA,CAAI,UAAU,wCACZ,SAAAF,EAAmB,IAAKyB,GACtBvB,EAAAA,IAAAwB,EAAA,CAAmC,WAAAD,EAAwB,kBAAApC,EAAsC,EAAAF,GAA7EsC,EAAW,EAAwE,CACzG,CACH,CAAA,EAEJ,QAIDF,EAAY,CAAA,MAAM,QAChB,SAAAzB,EAAM,SAAW,EAChBI,EAAA,IAACsB,EAAW,CAAA,WAAOL,EAAS,CAAA,UAAU,oCAAqC,CAAA,EAAI,KAAMhC,EAAE,wBAAyB,QAAQ,CAAG,CAAA,EAE1He,EAAAA,IAAA,MAAA,CAAI,UAAU,wCACZ,WAAM,IAAKxB,GACVwB,EAAA,IAACyB,GAA2B,KAAAjD,CAAT,EAAAA,EAAK,EAAgB,CACzC,CACH,CAAA,EAEJ,QAGC6C,EAAY,CAAA,MAAM,UAChB,SAAAxB,EAAQ,SAAW,EAClBG,EAAA,IAACsB,EAAW,CAAA,WAAOJ,EAAS,CAAA,UAAU,oCAAqC,CAAA,EAAI,KAAMjC,EAAE,0BAA2B,QAAQ,CAAG,CAAA,EAE5He,EAAAA,IAAA,MAAA,CAAI,UAAU,wCACZ,WAAQ,IAAKxB,GACZwB,EAAA,IAACyB,GAA2B,KAAAjD,CAAT,EAAAA,EAAK,EAAgB,CACzC,CACH,CAAA,EAEJ,QAGC6C,EAAY,CAAA,MAAM,YAChB,SAAA3B,EAAoB,SAAW,EAC9BM,MAACsB,EAAW,CAAA,WAAOH,EAAM,CAAA,UAAU,qCAAqC,EAAI,KAAMlC,EAAE,4BAA6B,QAAQ,CAAG,CAAA,QAE3H,MAAI,CAAA,UAAU,wCACZ,SAAAS,EAAoB,IAAK6B,GACvBvB,EAAA,IAAAwB,EAAA,CAAmC,WAAAD,EAAwB,kBAAApC,EAAsC,EAAAF,CAAA,EAA7EsC,EAAW,EAAwE,CACzG,CACH,CAAA,EAEJ,QAGCF,EAAY,CAAA,MAAM,aAChB,SAAA1B,EAAqB,SAAW,EAC/BK,MAACsB,EAAW,CAAA,WAAOF,EAAS,CAAA,UAAU,qCAAqC,EAAI,KAAMnC,EAAE,6BAA8B,QAAQ,CAAG,CAAA,QAE/H,MAAI,CAAA,UAAU,wCACZ,SAAAU,EAAqB,IAAK+B,GACxB1B,EAAA,IAAA2B,GAAA,CAA+B,SAAAD,EAAoB,kBAAAvC,EAAsC,EAAAF,CAAA,EAAvEyC,EAAS,EAAoE,CACjG,CACH,CAAA,EAEJ,CAAA,EACF,CAAA,CAEF,CAAA,CACF,CAAA,CAEJ,CAGA,SAASJ,EAAW,CAAE,KAAAM,EAAM,KAAAC,GAAiD,CAEzE,OAAA5B,EAAA,KAAC,MAAI,CAAA,UAAU,oEACZ,SAAA,CAAA2B,EACA5B,EAAA,IAAA,IAAA,CAAE,UAAU,gCAAiC,SAAK6B,EAAA,CACrD,CAAA,CAAA,CAEJ,CAEA,SAASL,EAAe,CAAE,WAAAD,EAAY,kBAAApC,EAAmB,EAAAF,GAA0D,CAC3G,MAAA6C,EAAO3C,EAAkBoC,EAAY,MAAM,EACjD,OACGvB,EAAA,IAAA+B,EAAA,CAAK,GAAI,eAAeR,EAAW,EAAE,GACpC,SAACvB,EAAAA,IAAAgC,EAAA,CAAK,UAAU,yEACd,SAAC/B,EAAAA,KAAAgC,EAAA,CAAY,UAAU,MACpB,SAAA,CAAAV,EAAW,gBACVvB,EAAA,IAAC,MAAA,CACC,IAAKuB,EAAW,gBAChB,IAAKO,EACL,UAAU,kFAAA,CACZ,QAEC,MAAI,CAAA,UAAU,wDACb,SAAC9B,EAAA,IAAAgB,EAAA,CAAM,UAAU,kCAAA,CAAmC,CACtD,CAAA,EAEFf,EAAAA,KAAC,MAAI,CAAA,UAAU,MACb,SAAA,CAACD,EAAA,IAAA,IAAA,CAAE,UAAU,qCAAsC,SAAK8B,EAAA,EACvDP,EAAW,SACTtB,OAAA,IAAA,CAAE,UAAU,4EACX,SAAA,CAACD,EAAAA,IAAAkC,EAAA,CAAO,UAAU,uBAAwB,CAAA,EACzCX,EAAW,OAAA,EACd,CAAA,EAEJ,CAAA,EACF,EACF,CACF,CAAA,CAEJ,CAEA,SAASI,GAAa,CAAE,SAAAD,EAAU,kBAAAvC,EAAmB,EAAAF,GAAwD,CACrG,MAAAkD,EAAQhD,EAAkBuC,EAAU,OAAO,EACjD,OACG1B,EAAA,IAAA+B,EAAA,CAAK,GAAI,aAAaL,EAAS,EAAE,GAChC,SAAC1B,EAAAA,IAAAgC,EAAA,CAAK,UAAU,yEACd,SAAC/B,EAAAA,KAAAgC,EAAA,CAAY,UAAU,MACpB,SAAA,CAAAP,EAAS,UACR1B,EAAA,IAAC,MAAA,CACC,IAAK0B,EAAS,UACd,IAAKS,EACL,UAAU,kFAAA,CACZ,QAEC,MAAI,CAAA,UAAU,wDACb,SAACnC,EAAA,IAAAoB,EAAA,CAAS,UAAU,kCAAA,CAAmC,CACzD,CAAA,EAEFpB,EAAAA,IAAC,OAAI,UAAU,MACb,eAAC,IAAE,CAAA,UAAU,qCAAsC,SAAAmC,CAAA,CAAM,CAC3D,CAAA,CAAA,EACF,EACF,CACF,CAAA,CAEJ"}