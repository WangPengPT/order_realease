{"version":3,"file":"MerchantCouponQuery-ChEc4XK5.js","sources":["../../src/components/QrCodeScanner.tsx","../../src/pages/merchant/MerchantCouponQuery.tsx"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport { Html5Qrcode } from \"html5-qrcode\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Camera, Settings } from \"lucide-react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\n\r\ninterface QrCodeScannerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onScan: (code: string) => void;\r\n}\r\n\r\ntype PermissionState = \"prompt\" | \"granted\" | \"denied\" | \"checking\";\r\n\r\nconst QrCodeScanner = ({ open, onOpenChange, onScan }: QrCodeScannerProps) => {\r\n  const { t } = useTranslation();\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [permissionState, setPermissionState] = useState<PermissionState>(\"checking\");\r\n  const [showPermissionDialog, setShowPermissionDialog] = useState(false);\r\n  const [showBlockedDialog, setShowBlockedDialog] = useState(false);\r\n  const scannerRef = useRef<Html5Qrcode | null>(null);\r\n  const containerIdRef = useRef(`qr-scanner-${Date.now()}`);\r\n  const portalContainerRef = useRef<HTMLDivElement | null>(null);\r\n  const camerasRef = useRef<Array<{ id: string; label: string }>>([]);\r\n  const currentCameraIndexRef = useRef(0);\r\n\r\n  const cleanupScanner = useCallback(async () => {\r\n    if (scannerRef.current) {\r\n      try {\r\n        const state = scannerRef.current.getState();\r\n        if (state === 2) {\r\n          await scannerRef.current.stop();\r\n        }\r\n      } catch (err) {\r\n        // Ignore errors during cleanup\r\n      }\r\n      scannerRef.current = null;\r\n    }\r\n    \r\n    // Remove portal container from body\r\n    if (portalContainerRef.current && document.body.contains(portalContainerRef.current)) {\r\n      document.body.removeChild(portalContainerRef.current);\r\n      portalContainerRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const handleClose = useCallback(async () => {\r\n    await cleanupScanner();\r\n    setError(null);\r\n    setIsLoading(true);\r\n    setShowPermissionDialog(false);\r\n    setShowBlockedDialog(false);\r\n    onOpenChange(false);\r\n  }, [cleanupScanner, onOpenChange]);\r\n\r\n  // Check camera permission status\r\n  const checkCameraPermission = useCallback(async (): Promise<PermissionState> => {\r\n    try {\r\n      // Check if permissions API is available\r\n      if (navigator.permissions && navigator.permissions.query) {\r\n        const result = await navigator.permissions.query({ name: 'camera' as PermissionName });\r\n        return result.state as PermissionState;\r\n      }\r\n      // Fallback: try to access camera to check\r\n      return \"prompt\";\r\n    } catch (err) {\r\n      // Permissions API not supported, assume prompt\r\n      return \"prompt\";\r\n    }\r\n  }, []);\r\n\r\n  // Request camera permission\r\n  const requestCameraPermission = useCallback(async (): Promise<boolean> => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        video: { facingMode: \"environment\" } \r\n      });\r\n      stream.getTracks().forEach(track => track.stop());\r\n      setPermissionState(\"granted\");\r\n      return true;\r\n    } catch (err: any) {\r\n      console.error(\"Camera permission error:\", err);\r\n      if (err.name === \"NotAllowedError\" || err.name === \"PermissionDeniedError\") {\r\n        setPermissionState(\"denied\");\r\n        setShowBlockedDialog(true);\r\n      } else {\r\n        setPermissionState(\"denied\");\r\n      }\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  const handleAllowCamera = useCallback(async () => {\r\n    setShowPermissionDialog(false);\r\n    const granted = await requestCameraPermission();\r\n    if (granted) {\r\n      // Permission granted, scanner will be initialized by the effect\r\n      setPermissionState(\"granted\");\r\n    }\r\n  }, [requestCameraPermission]);\r\n\r\n  const initScanner = useCallback(async (scannerId: string, mounted: { value: boolean }) => {\r\n    // Create portal container outside React\r\n    const portalContainer = document.createElement('div');\r\n    portalContainer.style.cssText = `\r\n      position: fixed;\r\n      inset: 0;\r\n      z-index: 9999;\r\n      background: rgba(0, 0, 0, 0.8);\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    `;\r\n    document.body.appendChild(portalContainer);\r\n    portalContainerRef.current = portalContainer;\r\n\r\n    // Create scanner wrapper\r\n    const wrapper = document.createElement('div');\r\n    wrapper.style.cssText = `\r\n      background: hsl(var(--background));\r\n      border-radius: 12px;\r\n      padding: 24px;\r\n      max-width: 400px;\r\n      width: 90%;\r\n      max-height: 90vh;\r\n      overflow: hidden;\r\n    `;\r\n    portalContainer.appendChild(wrapper);\r\n\r\n    // Create header\r\n    const header = document.createElement('div');\r\n    header.style.cssText = `\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 16px;\r\n    `;\r\n    header.innerHTML = `\r\n      <h3 style=\"font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px; color: hsl(var(--foreground));\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z\"/><circle cx=\"12\" cy=\"13\" r=\"3\"/></svg>\r\n        ${t(\"qrScanner.title\")}\r\n      </h3>\r\n    `;\r\n    \r\n    // Create header buttons container\r\n    const headerButtons = document.createElement('div');\r\n    headerButtons.style.cssText = `\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    `;\r\n\r\n    // Create switch camera button (hidden by default)\r\n    const switchCameraBtn = document.createElement('button');\r\n    switchCameraBtn.id = 'switch-camera-btn';\r\n    switchCameraBtn.style.cssText = `\r\n      background: hsl(var(--primary));\r\n      border: none;\r\n      cursor: pointer;\r\n      padding: 8px;\r\n      border-radius: 6px;\r\n      color: hsl(var(--primary-foreground));\r\n      display: none;\r\n      align-items: center;\r\n      justify-content: center;\r\n      transition: opacity 0.2s;\r\n    `;\r\n    switchCameraBtn.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5\"/><path d=\"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5\"/><circle cx=\"12\" cy=\"12\" r=\"3\"/><path d=\"m18 22-3-3 3-3\"/><path d=\"m6 2 3 3-3 3\"/></svg>`;\r\n    switchCameraBtn.title = t(\"qrScanner.switchCamera\");\r\n    headerButtons.appendChild(switchCameraBtn);\r\n    \r\n    const closeBtn = document.createElement('button');\r\n    closeBtn.style.cssText = `\r\n      background: transparent;\r\n      border: none;\r\n      cursor: pointer;\r\n      padding: 4px;\r\n      color: hsl(var(--muted-foreground));\r\n    `;\r\n    closeBtn.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>`;\r\n    closeBtn.onclick = () => handleClose();\r\n    headerButtons.appendChild(closeBtn);\r\n    \r\n    header.appendChild(headerButtons);\r\n    wrapper.appendChild(header);\r\n\r\n    // Create scanner container - responsive size, centered\r\n    const scannerContainer = document.createElement('div');\r\n    scannerContainer.id = scannerId;\r\n    const isMobile = window.innerWidth < 400;\r\n    const scannerSize = isMobile ? Math.min(window.innerWidth - 80, 280) : 300;\r\n    scannerContainer.style.cssText = `\r\n      width: ${scannerSize}px;\r\n      height: ${scannerSize}px;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      background: hsl(var(--muted));\r\n      position: relative;\r\n      margin: 0 auto;\r\n    `;\r\n    wrapper.appendChild(scannerContainer);\r\n\r\n    // Create hint text\r\n    const hint = document.createElement('p');\r\n    hint.style.cssText = `\r\n      text-align: center;\r\n      color: hsl(var(--muted-foreground));\r\n      font-size: 14px;\r\n      margin-top: 16px;\r\n    `;\r\n    hint.textContent = t(\"qrScanner.hint\");\r\n    wrapper.appendChild(hint);\r\n\r\n    // Create loading indicator\r\n    const loadingDiv = document.createElement('div');\r\n    loadingDiv.id = 'qr-loading';\r\n    loadingDiv.style.cssText = `\r\n      position: absolute;\r\n      inset: 0;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      background: hsl(var(--muted));\r\n    `;\r\n    loadingDiv.innerHTML = `\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"hsl(var(--primary))\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"animate-spin\">\r\n        <path d=\"M21 12a9 9 0 1 1-6.219-8.56\"></path>\r\n      </svg>\r\n    `;\r\n    scannerContainer.appendChild(loadingDiv);\r\n\r\n    // Add CSS for square video - use dynamic size\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      @keyframes spin { to { transform: rotate(360deg); } }\r\n      .animate-spin { animation: spin 1s linear infinite; }\r\n      #${scannerId} video {\r\n        width: ${scannerSize}px !important;\r\n        height: ${scannerSize}px !important;\r\n        object-fit: cover !important;\r\n      }\r\n    `;\r\n    wrapper.appendChild(style);\r\n\r\n    const startCameraById = async (cameraId: string) => {\r\n      if (!mounted.value) return;\r\n      \r\n      // Show loading\r\n      loadingDiv.style.display = 'flex';\r\n      \r\n      try {\r\n        const scanner = new Html5Qrcode(scannerId);\r\n        scannerRef.current = scanner;\r\n        \r\n        // Dynamic qrbox size based on scanner container\r\n        const qrboxFunction = (viewfinderWidth: number, viewfinderHeight: number) => {\r\n          const minEdge = Math.min(viewfinderWidth, viewfinderHeight);\r\n          const qrboxSize = Math.floor(minEdge * 0.7); // 70% of smaller edge\r\n          console.log(\"QR Scanner qrbox calculated:\", { viewfinderWidth, viewfinderHeight, qrboxSize });\r\n          return { width: qrboxSize, height: qrboxSize };\r\n        };\r\n        \r\n        console.log(\"Starting QR scanner with camera:\", cameraId);\r\n        \r\n        await scanner.start(\r\n          cameraId,\r\n          {\r\n            fps: 15, // Increased FPS for better detection\r\n            qrbox: qrboxFunction,\r\n            aspectRatio: 1.0, // Square aspect ratio\r\n          },\r\n          async (decodedText, decodedResult) => {\r\n            console.log(\"QR Code detected:\", decodedText, decodedResult);\r\n            if (mounted.value && scannerRef.current) {\r\n              try {\r\n                await scannerRef.current.stop();\r\n              } catch (e) {\r\n                console.log(\"Error stopping scanner:\", e);\r\n              }\r\n              scannerRef.current = null;\r\n              await cleanupScanner();\r\n              onScan(decodedText);\r\n              onOpenChange(false);\r\n            }\r\n          },\r\n          (errorMessage) => {\r\n            // QR code not found in frame - this is normal, don't log every frame\r\n            // But we can log periodically for debugging\r\n          }\r\n        );\r\n        \r\n        console.log(\"QR Scanner started successfully\");\r\n        \r\n        if (mounted.value) {\r\n          loadingDiv.style.display = 'none';\r\n        }\r\n      } catch (err) {\r\n        console.error(\"QR Scanner start error:\", err);\r\n        if (mounted.value) {\r\n          loadingDiv.innerHTML = `<p style=\"color: hsl(var(--destructive)); text-align: center; padding: 20px;\">${t(\"qrScanner.cameraError\")}</p>`;\r\n        }\r\n      }\r\n    };\r\n\r\n    const switchCamera = async () => {\r\n      if (camerasRef.current.length < 2) return;\r\n      \r\n      // Stop current scanner\r\n      if (scannerRef.current) {\r\n        try {\r\n          const state = scannerRef.current.getState();\r\n          if (state === 2) {\r\n            await scannerRef.current.stop();\r\n          }\r\n        } catch (err) {\r\n          // Ignore\r\n        }\r\n        scannerRef.current = null;\r\n      }\r\n      \r\n      // Switch to next camera\r\n      currentCameraIndexRef.current = (currentCameraIndexRef.current + 1) % camerasRef.current.length;\r\n      const nextCamera = camerasRef.current[currentCameraIndexRef.current];\r\n      \r\n      // Start with new camera\r\n      await startCameraById(nextCamera.id);\r\n    };\r\n\r\n    // Set up switch camera button click handler\r\n    switchCameraBtn.onclick = switchCamera;\r\n\r\n    // Request camera permission again just to be safe\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        video: { facingMode: \"environment\" } \r\n      });\r\n      stream.getTracks().forEach(track => track.stop());\r\n    } catch (err) {\r\n      console.error(\"Camera permission denied:\", err);\r\n      if (mounted.value) {\r\n        loadingDiv.innerHTML = `<p style=\"color: hsl(var(--destructive)); text-align: center; padding: 20px;\">${t(\"qrScanner.permissionDenied\")}</p>`;\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (!mounted.value) return;\r\n\r\n    try {\r\n      // Get available cameras\r\n      const cameras = await Html5Qrcode.getCameras();\r\n      camerasRef.current = cameras;\r\n      \r\n      // Show switch button if multiple cameras available\r\n      if (cameras.length >= 2) {\r\n        switchCameraBtn.style.display = 'flex';\r\n      }\r\n      \r\n      // Try to find back camera first\r\n      let selectedCameraIndex = 0;\r\n      const backCameraIndex = cameras.findIndex(\r\n        camera => camera.label.toLowerCase().includes('back') || \r\n                  camera.label.toLowerCase().includes('rear') ||\r\n                  camera.label.toLowerCase().includes('environment') ||\r\n                  camera.label.toLowerCase().includes('后')\r\n      );\r\n      if (backCameraIndex !== -1) {\r\n        selectedCameraIndex = backCameraIndex;\r\n      }\r\n      currentCameraIndexRef.current = selectedCameraIndex;\r\n      \r\n      // Start with selected camera\r\n      await startCameraById(cameras[selectedCameraIndex].id);\r\n      \r\n    } catch (err) {\r\n      console.error(\"QR Scanner error:\", err);\r\n      if (mounted.value) {\r\n        loadingDiv.innerHTML = `<p style=\"color: hsl(var(--destructive)); text-align: center; padding: 20px;\">${t(\"qrScanner.cameraError\")}</p>`;\r\n      }\r\n    }\r\n\r\n    // Close on backdrop click\r\n    portalContainer.onclick = (e) => {\r\n      if (e.target === portalContainer) {\r\n        handleClose();\r\n      }\r\n    };\r\n\r\n    // Close on escape key\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        handleClose();\r\n      }\r\n    };\r\n    document.addEventListener('keydown', handleKeyDown);\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [t, handleClose, cleanupScanner, onScan, onOpenChange]);\r\n\r\n  useEffect(() => {\r\n    if (!open) {\r\n      cleanupScanner();\r\n      setPermissionState(\"checking\");\r\n      return;\r\n    }\r\n\r\n    const mounted = { value: true };\r\n    const scannerId = containerIdRef.current;\r\n\r\n    const checkAndHandlePermission = async () => {\r\n      const currentPermission = await checkCameraPermission();\r\n      \r\n      if (!mounted.value) return;\r\n      \r\n      setPermissionState(currentPermission);\r\n      \r\n      if (currentPermission === \"denied\") {\r\n        setShowBlockedDialog(true);\r\n        return;\r\n      }\r\n      \r\n      if (currentPermission === \"prompt\") {\r\n        setShowPermissionDialog(true);\r\n        return;\r\n      }\r\n      \r\n      // Permission is granted, proceed with scanner initialization\r\n      initScanner(scannerId, mounted);\r\n    };\r\n\r\n    checkAndHandlePermission();\r\n\r\n    return () => {\r\n      mounted.value = false;\r\n      cleanupScanner();\r\n    };\r\n  }, [open, cleanupScanner, checkCameraPermission, initScanner]);\r\n\r\n  // Re-init scanner when permission changes to granted\r\n  useEffect(() => {\r\n    if (open && permissionState === \"granted\" && !portalContainerRef.current) {\r\n      const mounted = { value: true };\r\n      const scannerId = containerIdRef.current;\r\n      initScanner(scannerId, mounted);\r\n      \r\n      return () => {\r\n        mounted.value = false;\r\n      };\r\n    }\r\n  }, [permissionState, open, initScanner]);\r\n\r\n  return (\r\n    <>\r\n      {/* Permission Request Dialog */}\r\n      <AlertDialog open={showPermissionDialog} onOpenChange={setShowPermissionDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle className=\"flex items-center gap-2\">\r\n              <Camera className=\"w-5 h-5\" />\r\n              {t(\"qrScanner.requestPermission\")}\r\n            </AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"qrScanner.requestPermissionMessage\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={handleClose}>\r\n              {t(\"common.cancel\")}\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleAllowCamera}>\r\n              <Camera className=\"w-4 h-4 mr-2\" />\r\n              {t(\"qrScanner.allowCamera\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Permission Blocked Dialog */}\r\n      <AlertDialog open={showBlockedDialog} onOpenChange={setShowBlockedDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle className=\"flex items-center gap-2\">\r\n              <Camera className=\"w-5 h-5 text-destructive\" />\r\n              {t(\"qrScanner.requestPermission\")}\r\n            </AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"qrScanner.permissionBlockedMessage\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={handleClose}>\r\n              {t(\"common.cancel\")}\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleClose}>\r\n              <Settings className=\"w-4 h-4 mr-2\" />\r\n              {t(\"qrScanner.openSettings\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default QrCodeScanner;","import { useState } from \"react\";\r\nimport { useQueryCouponByCode } from \"@/hooks/useCoupons\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Search, Loader2, CheckCircle, XCircle, Clock, User, Ticket, ScanLine } from \"lucide-react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { format } from \"date-fns\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport QrCodeScanner from \"@/components/QrCodeScanner\";\r\n\r\nconst MerchantCouponQuery = () => {\r\n  const { user } = useAuth();\r\n  const { t, i18n } = useTranslation();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const [searchCode, setSearchCode] = useState(\"\");\r\n  const [queryCode, setQueryCode] = useState(\"\");\r\n  const [isUsing, setIsUsing] = useState<string | null>(null);\r\n  const [showScanner, setShowScanner] = useState(false);\r\n  const { data: couponData, isLoading } = useQueryCouponByCode(queryCode);\r\n\r\n  const handleSearch = () => {\r\n    if (searchCode.trim()) {\r\n      setQueryCode(searchCode.trim());\r\n    }\r\n  };\r\n\r\n  const handleScan = (code: string) => {\r\n    setSearchCode(code);\r\n    setQueryCode(code);\r\n  };\r\n\r\n  const getLocalizedTitle = () => {\r\n    if (!couponData) return \"\";\r\n    const lang = i18n.language;\r\n    if (lang === \"zh\") return couponData.coupon_templates.title_zh;\r\n    if (lang === \"pt\") return couponData.coupon_templates.title_pt;\r\n    return couponData.coupon_templates.title_en;\r\n  };\r\n\r\n  const getLocalizedDescription = () => {\r\n    if (!couponData) return \"\";\r\n    const lang = i18n.language;\r\n    if (lang === \"zh\") return couponData.coupon_templates.description_zh;\r\n    if (lang === \"pt\") return couponData.coupon_templates.description_pt;\r\n    return couponData.coupon_templates.description_en;\r\n  };\r\n\r\n  const isExpired = couponData?.coupon_templates.valid_until && new Date(couponData.coupon_templates.valid_until) <= new Date();\r\n  const isUsedUp = couponData && couponData.used_count >= couponData.usage_limit;\r\n  const isValid = couponData?.is_active && !isExpired && !isUsedUp;\r\n\r\n  const handleUseCoupon = async (userCouponId: string, couponCodeId: string) => {\r\n    if (!user) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"auth.loginRequired\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    setIsUsing(userCouponId);\r\n    try {\r\n      // 1. 先获取最新的 coupon_code 数据检查使用上限\r\n      const { data: currentCode, error: fetchError } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .select(\"used_count, usage_limit\")\r\n        .eq(\"id\", couponCodeId)\r\n        .single();\r\n\r\n      if (fetchError) {\r\n        console.error(\"Failed to fetch coupon code:\", fetchError);\r\n        throw new Error(t(\"common.unknownError\"));\r\n      }\r\n\r\n      // 检查是否已达使用上限\r\n      if (currentCode && currentCode.used_count >= currentCode.usage_limit) {\r\n        throw new Error(t(\"couponQuery.usageLimitReached\"));\r\n      }\r\n\r\n      const usedAt = new Date().toISOString();\r\n      \r\n      // 2. 更新 user_coupons 的使用状态\r\n      const { error: userCouponError } = await supabase\r\n        .from(\"user_coupons\")\r\n        .update({ used_at: usedAt })\r\n        .eq(\"id\", userCouponId)\r\n        .is(\"used_at\", null); // 确保优惠券未被使用\r\n\r\n      if (userCouponError) {\r\n        console.error(\"Failed to update user_coupon:\", userCouponError);\r\n        throw new Error(t(\"couponQuery.alreadyUsed\"));\r\n      }\r\n\r\n      // 3. 更新 coupon_codes 的 used_count\r\n      const { error: codeError } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .update({ used_count: currentCode.used_count + 1 })\r\n        .eq(\"id\", couponCodeId);\r\n\r\n      if (codeError) {\r\n        console.error(\"Failed to update coupon code used_count:\", codeError);\r\n      }\r\n\r\n      // 3. 记录使用历史\r\n      const { error: historyError } = await supabase\r\n        .from(\"coupon_usage_history\")\r\n        .insert({\r\n          user_coupon_id: userCouponId,\r\n          coupon_code_id: couponCodeId,\r\n          used_by_user_id: user.id,\r\n          used_at: usedAt,\r\n        });\r\n\r\n      if (historyError) {\r\n        console.error(\"Failed to record usage history:\", historyError);\r\n      }\r\n\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"couponQuery.couponUsedSuccess\"),\r\n      });\r\n      \r\n      // 刷新相关查询缓存\r\n      await queryClient.invalidateQueries({ queryKey: [\"queryCouponByCode\", queryCode] });\r\n      queryClient.invalidateQueries({ queryKey: [\"userCoupons\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"couponCodeUsers\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"couponUsageHistory\"] });\r\n    } catch (error: any) {\r\n      console.error(\"handleUseCoupon error:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: error.message || t(\"common.unknownError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsUsing(null);\r\n    }\r\n  };\r\n\r\n  // 直接核销优惠码（无需用户领取记录）\r\n  const handleDirectUseCoupon = async () => {\r\n    if (!couponData || !user) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"auth.loginRequired\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    setIsUsing(\"direct\");\r\n    try {\r\n      const usedAt = new Date().toISOString();\r\n      \r\n      // 1. 先获取最新的 used_count 避免竞态条件\r\n      const { data: currentCode, error: fetchError } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .select(\"used_count, usage_limit\")\r\n        .eq(\"id\", couponData.id)\r\n        .single();\r\n\r\n      if (fetchError) {\r\n        throw fetchError;\r\n      }\r\n\r\n      // 检查是否已达使用上限\r\n      if (currentCode && currentCode.used_count >= currentCode.usage_limit) {\r\n        throw new Error(t(\"couponQuery.usageLimitReached\"));\r\n      }\r\n\r\n      // 2. 增加 coupon_codes 的 used_count\r\n      const { error } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .update({ used_count: (currentCode?.used_count || 0) + 1 })\r\n        .eq(\"id\", couponData.id);\r\n\r\n      if (error) throw error;\r\n\r\n      // 3. 记录使用历史（直接核销没有 user_coupon_id）\r\n      const { error: historyError } = await supabase\r\n        .from(\"coupon_usage_history\")\r\n        .insert({\r\n          coupon_code_id: couponData.id,\r\n          used_by_user_id: user.id,\r\n          used_at: usedAt,\r\n        });\r\n\r\n      if (historyError) {\r\n        console.error(\"Failed to record usage history:\", historyError);\r\n      }\r\n\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"couponQuery.couponUsedSuccess\"),\r\n      });\r\n      \r\n      await queryClient.invalidateQueries({ queryKey: [\"queryCouponByCode\", queryCode] });\r\n      queryClient.invalidateQueries({ queryKey: [\"userCoupons\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"couponCodeUsers\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"couponUsageHistory\"] });\r\n    } catch (error: any) {\r\n      console.error(\"handleDirectUseCoupon error:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: error.message || t(\"common.unknownError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsUsing(null);\r\n    }\r\n  };\r\n\r\n  // 检查是否可以直接核销（没有用户领取记录且使用次数未达上限）\r\n  const canDirectUse = couponData && isValid && \r\n    (!couponData.user_coupons || couponData.user_coupons.length === 0) &&\r\n    couponData.used_count < couponData.usage_limit;\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-3xl font-bold mb-2\">{t(\"couponQuery.title\")}</h1>\r\n        <p className=\"text-muted-foreground\">{t(\"couponQuery.description\")}</p>\r\n      </div>\r\n\r\n      <Card className=\"mb-6\">\r\n        <CardHeader>\r\n          <CardTitle>{t(\"couponQuery.searchTitle\")}</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-2\">\r\n            <Input\r\n              className=\"sm:flex-1\"\r\n              placeholder={t(\"couponQuery.searchPlaceholder\")}\r\n              value={searchCode}\r\n              onChange={(e) => setSearchCode(e.target.value)}\r\n              onKeyDown={(e) => e.key === \"Enter\" && handleSearch()}\r\n            />\r\n            <div className=\"flex gap-2\">\r\n              <Button \r\n                className=\"flex-1 sm:flex-none\" \r\n                onClick={handleSearch} \r\n                disabled={isLoading || !searchCode.trim()}\r\n              >\r\n                <Search className=\"w-4 h-4 mr-2\" />\r\n                {t(\"couponQuery.search\")}\r\n              </Button>\r\n              <Button \r\n                className=\"flex-1 sm:flex-none\" \r\n                variant=\"outline\" \r\n                onClick={() => setShowScanner(true)}\r\n              >\r\n                <ScanLine className=\"w-4 h-4 mr-2\" />\r\n                {t(\"couponQuery.scan\")}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {isLoading && (\r\n        <div className=\"flex justify-center items-center py-12\">\r\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n        </div>\r\n      )}\r\n\r\n      {!isLoading && queryCode && !couponData && (\r\n        <Card>\r\n          <CardContent className=\"py-12 text-center\">\r\n            <XCircle className=\"w-12 h-12 text-destructive mx-auto mb-4\" />\r\n            <p className=\"text-lg font-medium\">{t(\"couponQuery.notFound\")}</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {!isLoading && couponData && (\r\n        <Card>\r\n          <CardHeader className=\"pb-4\">\r\n            <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3\">\r\n              <CardTitle className=\"text-xl sm:text-2xl\">{getLocalizedTitle()}</CardTitle>\r\n              <div className=\"flex flex-wrap items-center gap-2\">\r\n                {couponData.user_coupons?.some(uc => !uc.used_at) && (\r\n                  <Badge className=\"bg-green-500 text-white text-xs\">\r\n                    {t(\"couponQuery.unused\")}\r\n                  </Badge>\r\n                )}\r\n                {isUsedUp ? (\r\n                  <>\r\n                    <Badge variant=\"secondary\" className=\"text-xs\">\r\n                      <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n                      {t(\"couponQuery.used\")}\r\n                    </Badge>\r\n                    <Badge variant=\"secondary\" className=\"text-xs\">\r\n                      <XCircle className=\"w-3 h-3 mr-1\" />\r\n                      {t(\"couponQuery.usageLimitReached\")}\r\n                    </Badge>\r\n                  </>\r\n                ) : isValid ? (\r\n                  <Badge className=\"bg-green-500 text-xs\">\r\n                    <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n                    {t(\"couponQuery.valid\")}\r\n                  </Badge>\r\n                ) : (\r\n                  <Badge variant=\"destructive\" className=\"text-xs\">\r\n                    <XCircle className=\"w-3 h-3 mr-1\" />\r\n                    {t(\"couponQuery.invalid\")}\r\n                  </Badge>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4 sm:space-y-6\">\r\n            {getLocalizedDescription() && (\r\n              <p className=\"text-muted-foreground text-sm sm:text-base\">\r\n                {getLocalizedDescription()}\r\n              </p>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">{t(\"couponQuery.code\")}</p>\r\n                <p className=\"font-mono font-bold text-lg\">{couponData.code}</p>\r\n              </div>\r\n\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">{t(\"couponQuery.discount\")}</p>\r\n                <p className=\"font-bold text-lg\">\r\n                  {couponData.coupon_templates.discount_type === \"percentage\"\r\n                    ? `${couponData.coupon_templates.discount_value}%`\r\n                    : `€${couponData.coupon_templates.discount_value}`}\r\n                </p>\r\n              </div>\r\n\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">{t(\"couponQuery.usageCount\")}</p>\r\n                <p className=\"font-medium\">\r\n                  {couponData.used_count} / {couponData.usage_limit}\r\n                </p>\r\n              </div>\r\n\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">{t(\"couponQuery.validity\")}</p>\r\n                <p className=\"font-medium\">\r\n                  {format(new Date(couponData.coupon_templates.valid_from), \"yyyy-MM-dd\")}\r\n                  {couponData.coupon_templates.valid_until \r\n                    ? ` - ${format(new Date(couponData.coupon_templates.valid_until), \"yyyy-MM-dd\")}`\r\n                    : ` - ${t(\"couponQuery.noExpiry\")}`}\r\n                </p>\r\n              </div>\r\n\r\n              {couponData.coupon_templates.min_order_amount && (\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">{t(\"couponQuery.minOrder\")}</p>\r\n                  <p className=\"font-medium\">€{couponData.coupon_templates.min_order_amount}</p>\r\n                </div>\r\n              )}\r\n\r\n              {couponData.coupon_templates.max_discount_amount && (\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">{t(\"couponQuery.maxDiscount\")}</p>\r\n                  <p className=\"font-medium\">€{couponData.coupon_templates.max_discount_amount}</p>\r\n                </div>\r\n              )}\r\n\r\n            </div>\r\n\r\n            {/* 领取详情 - 展开显示 */}\r\n            {couponData.user_coupons && couponData.user_coupons.length > 0 && (\r\n              <div className=\"pt-4 border-t space-y-3\">\r\n                {couponData.user_coupons.map((userCoupon) => (\r\n                  <div key={userCoupon.id} className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-3 bg-muted/50 rounded-lg\">\r\n                    <div className=\"flex items-start sm:items-center gap-3\">\r\n                      <User className=\"w-4 h-4 text-muted-foreground shrink-0 mt-0.5 sm:mt-0\" />\r\n                      <div className=\"min-w-0\">\r\n                        <p className=\"font-medium text-sm\">\r\n                          {userCoupon.profiles?.display_name || t(\"couponQuery.unknownUser\")}\r\n                        </p>\r\n                        <div className=\"flex flex-col sm:flex-row sm:flex-wrap gap-1 sm:gap-3 text-xs text-muted-foreground mt-1\">\r\n                          <span className=\"flex items-center gap-1\">\r\n                            <Clock className=\"w-3 h-3 shrink-0\" />\r\n                            {t(\"couponQuery.claimedAt\")}: {format(new Date(userCoupon.claimed_at), \"yyyy-MM-dd HH:mm\")}\r\n                          </span>\r\n                          {userCoupon.used_at && (\r\n                            <span className=\"flex items-center gap-1\">\r\n                              <CheckCircle className=\"w-3 h-3 shrink-0\" />\r\n                              {t(\"couponQuery.usedAt\")}: {format(new Date(userCoupon.used_at), \"yyyy-MM-dd HH:mm\")}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    {!userCoupon.used_at && !isUsedUp && couponData.is_active && !isExpired && (\r\n                      <Button\r\n                        size=\"sm\"\r\n                        className=\"w-full sm:w-auto shrink-0\"\r\n                        onClick={() => handleUseCoupon(userCoupon.id, couponData.id)}\r\n                        disabled={isUsing === userCoupon.id}\r\n                      >\r\n                        {isUsing === userCoupon.id ? (\r\n                          <Loader2 className=\"w-4 h-4 animate-spin mr-1\" />\r\n                        ) : (\r\n                          <Ticket className=\"w-4 h-4 mr-1\" />\r\n                        )}\r\n                        {t(\"couponQuery.useCoupon\")}\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* 直接核销按钮 - 当没有用户领取记录但可以核销时显示 */}\r\n            {canDirectUse && (\r\n              <div className=\"pt-4 border-t\">\r\n                <Button \r\n                  onClick={handleDirectUseCoupon}\r\n                  disabled={isUsing === \"direct\"}\r\n                  className=\"w-full sm:w-auto\"\r\n                >\r\n                  {isUsing === \"direct\" ? (\r\n                    <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\r\n                  ) : (\r\n                    <Ticket className=\"w-4 h-4 mr-2\" />\r\n                  )}\r\n                  {t(\"couponQuery.useCoupon\")}\r\n                </Button>\r\n              </div>\r\n            )}\r\n\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <QrCodeScanner\r\n        open={showScanner}\r\n        onOpenChange={setShowScanner}\r\n        onScan={handleScan}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MerchantCouponQuery;\r\n"],"names":["QrCodeScanner","open","onOpenChange","onScan","t","useTranslation","error","setError","useState","isLoading","setIsLoading","permissionState","setPermissionState","showPermissionDialog","setShowPermissionDialog","showBlockedDialog","setShowBlockedDialog","scannerRef","useRef","containerIdRef","portalContainerRef","camerasRef","currentCameraIndexRef","cleanupScanner","useCallback","handleClose","checkCameraPermission","requestCameraPermission","track","err","handleAllowCamera","initScanner","scannerId","mounted","portalContainer","wrapper","header","headerButtons","switchCameraBtn","closeBtn","scannerContainer","scannerSize","hint","loadingDiv","style","startCameraById","cameraId","scanner","Html5Qrcode","qrboxFunction","viewfinderWidth","viewfinderHeight","minEdge","qrboxSize","decodedText","decodedResult","e","errorMessage","switchCamera","nextCamera","cameras","selectedCameraIndex","backCameraIndex","camera","handleKeyDown","useEffect","currentPermission","jsxs","Fragment","jsx","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","Camera","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","Settings","MerchantCouponQuery","user","useAuth","i18n","toast","useToast","queryClient","useQueryClient","searchCode","setSearchCode","queryCode","setQueryCode","isUsing","setIsUsing","showScanner","setShowScanner","couponData","useQueryCouponByCode","handleSearch","handleScan","code","getLocalizedTitle","lang","getLocalizedDescription","isExpired","isUsedUp","isValid","handleUseCoupon","userCouponId","couponCodeId","currentCode","fetchError","supabase","usedAt","userCouponError","codeError","historyError","handleDirectUseCoupon","canDirectUse","Card","CardHeader","CardTitle","CardContent","Input","Button","Search","ScanLine","Loader2","XCircle","uc","Badge","CheckCircle","format","userCoupon","User","Clock","Ticket"],"mappings":"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"}