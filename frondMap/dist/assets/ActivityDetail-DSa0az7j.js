import{c as Ds,j as e,k as l,C as H,l as Q,m as U,r as i,u as K,D as be,b as ye,d as Ce,e as ke,i as te,a6 as Ye,a7 as Fe,t as M,a8 as oe,a9 as es,B as w,L as Z,F as ss,aa as Ls,ab as ze,J as Ts,K as Es,N as Ps,O as A,Q as $e,G as P,ac as as,v as V,A as Rs,E as As,a as Is,p as Ms,ad as Fs,ae as T,f as ae,w as Oe,h as zs,a3 as $s,a4 as Os,a5 as Hs,a2 as qs,y as He,M as qe,R as Bs,T as Us,U as Gs,V as Ws,W as Xs,Y as Js,Z as Qs,$ as Vs}from"./index-B9cY5t1p.js";import{S as Be}from"./separator-C9gk583o.js";import{C as Zs,a as Ks,b as Ys}from"./collapsible-BGY6ZaDZ.js";import{a as ea,C as sa,p as Ue}from"./xiaoxiong-logo-v3-C--JfwgT.js";import{b as aa,c as ta,a as ra,d as na,e as ia,f as la,g as oa,h as ca}from"./useActivities-Bfk1pXZM.js";import{u as da,a as ma,b as ha}from"./useActivityParticipation-BHXLmecN.js";import{u as ts}from"./useLocalizedContent-DVcuWCrr.js";import ua from"./RestaurantComments-CJYxwynf.js";import{m as J}from"./mapbox-gl-BqKcFVUk.js";import{m as xa}from"./map-icon-DR07RZr_.js";import{C as Ge}from"./checkbox-DG5lVBf3.js";import{R as pa}from"./ReportDialog-Wdm317L-.js";import{A as ga}from"./ActivityTermsAgreement-lAGZFJeg.js";import{T as fa,a as ja,b as fe,c as je}from"./tabs-CsfMJY62.js";import{u as va,a as Na}from"./useGlobalHandbook-ZIm7zuWQ.js";import{R as ve}from"./RichTextEditor-CTA09La4.js";import{B as we}from"./book-open--GgEI66O.js";import{S as wa}from"./save-BMMXeYJ-.js";import{S as ba}from"./square-pen-Cm9rDoz_.js";import{L as ya}from"./LocationPermissionDialog-Bgd1XD3K.js";import{u as rs}from"./use-mobile-DGSEuO0A.js";import{b as Ca,u as ka}from"./externalLinks-GW9pcgVk.js";import{C as Sa}from"./circle-check-big-bZEEekzl.js";import{G as ce}from"./gift-K999JfmY.js";import{S as O}from"./share-2-BC_xgpqj.js";import{M as le}from"./message-circle-FANX-YSW.js";import{L as _a}from"./link-2-5iWT5dEL.js";import{g as Da,c as La,N as Ne}from"./geolocation-DO2M7OHl.js";import{u as Ta,a as Ea,b as Pa,c as Ra}from"./useCoupons-DPoFLC7x.js";import{F as Aa}from"./forward-C4JqlDtC.js";import{U as ns}from"./users-XuhtRWHh.js";import{C as Ia}from"./chevron-left-C8S8V_Aw.js";import{S as We}from"./shield-alert-CgAAsaN7.js";import{F as Ma}from"./file-pen-DT_sVv_c.js";import{F as Xe}from"./file-text-GLdebuZk.js";import{U as Je}from"./utensils-crossed-CeArJW4K.js";import{S as Qe}from"./shopping-bag-C2faTDDo.js";import{H as Ve}from"./heart-DvQ94Oo2.js";import{S as Fa}from"./star-w6qzoqne.js";import{f as Ze}from"./format-BewYtBYJ.js";import"./index-VXzTq4DQ.js";import"./useSensitiveWords-Br0-IRVv.js";import"./clock-Cp6uC9E8.js";import"./circle-alert-BPVwB_-K.js";import"./image-BLy2PCgc.js";import"./volume-x-DXvQANrB.js";import"./input-otp-B98bZ6Vx.js";import"./plus-CFyGnb7B.js";import"./useActivityRules-D8b1HG8Q.js";import"./isEqual-DFrQFnYa.js";import"./startOfDay-DKu_CsZ5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=Ds("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]),$a=()=>e.jsxs("div",{className:"min-h-screen bg-secondary/20 pb-8",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[e.jsx(l,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(l,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(l,{className:"h-10 w-10 rounded-md"}),e.jsx(l,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-20 relative z-10",children:[e.jsx(H,{className:"shadow-large",children:e.jsxs(Q,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx(l,{className:"h-6 w-16 rounded-full"}),e.jsx(l,{className:"h-6 w-20 rounded-full"}),e.jsx(l,{className:"h-6 w-24 rounded-full"})]}),e.jsx(l,{className:"h-9 w-3/4 mb-4"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsx(l,{className:"h-5 w-24"}),e.jsx(l,{className:"h-5 w-20"}),e.jsx(l,{className:"h-5 w-28"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(l,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"h-4 w-32"}),e.jsx(l,{className:"h-4 w-40"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"h-4 w-20"}),e.jsx(l,{className:"h-4 w-32"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(l,{className:"h-10 w-28 rounded-md"}),e.jsx(l,{className:"h-10 w-32 rounded-md"}),e.jsx(l,{className:"h-10 w-24 rounded-md"})]})]})}),e.jsxs(H,{className:"mt-6 shadow-large",children:[e.jsx(Q,{children:e.jsx(l,{className:"h-6 w-36"})}),e.jsxs(U,{className:"space-y-3",children:[e.jsx(l,{className:"h-4 w-full"}),e.jsx(l,{className:"h-4 w-full"}),e.jsx(l,{className:"h-4 w-5/6"}),e.jsx(l,{className:"h-4 w-4/5"})]})]}),e.jsxs(H,{className:"mt-6 shadow-large",children:[e.jsx(Q,{children:e.jsx(l,{className:"h-6 w-28"})}),e.jsxs(U,{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-full"}),e.jsx(l,{className:"h-4 w-3/4"})]})]}),e.jsxs(H,{className:"mt-6 shadow-large",children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between",children:[e.jsx(l,{className:"h-6 w-40"}),e.jsx(l,{className:"h-5 w-24"})]}),e.jsxs(U,{children:[e.jsx(l,{className:"h-[200px] w-full rounded-lg mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx(l,{className:"h-16 w-16 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(l,{className:"h-5 w-40"}),e.jsx(l,{className:"h-4 w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{className:"h-5 w-16 rounded-full"}),e.jsx(l,{className:"h-5 w-12"})]})]})]},a))})]})]})]})]}),is=i.memo(({restaurants:a,onMarkerClick:h})=>{const g=i.useRef(null),s=i.useRef(null),t=i.useRef([]),[x,j]=i.useState(!1),c=i.useRef(null);return i.useEffect(()=>{if(!g.current||s.current)return;const o="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";J.accessToken=o;const b=a.reduce((f,p)=>f+Number(p.restaurants.lat||0),0)/a.length,u=a.reduce((f,p)=>f+Number(p.restaurants.lng||0),0)/a.length;return s.current=new J.Map({container:g.current,style:"mapbox://styles/mapbox/light-v11",center:[u,b],zoom:12,cooperativeGestures:!0,doubleClickZoom:!1}),s.current.addControl(new J.NavigationControl,"top-right"),s.current.on("load",()=>{j(!0)}),()=>{var f;t.current.forEach(p=>p.remove()),t.current=[],c.current&&(c.current.remove(),c.current=null),(f=s.current)==null||f.remove(),s.current=null,j(!1)}},[]),i.useEffect(()=>{if(!s.current||!x||a.length===0)return;(()=>{var b;if(t.current.forEach(u=>u.remove()),t.current=[],c.current&&(c.current.remove(),c.current=null),a.forEach(u=>{const f=Number(u.restaurants.lat),p=Number(u.restaurants.lng);if(isNaN(f)||isNaN(p))return;const _=document.createElement("div");_.className="p-3 min-w-[200px]",_.innerHTML=`
          <div class="space-y-2">
            <h3 class="font-bold text-base text-foreground">${u.restaurants.name}</h3>
            <p class="text-xs text-muted-foreground">${u.restaurants.address}</p>
          </div>
        `;const m=new J.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([p,f]).setDOMContent(_),d=document.createElement("div");d.className="custom-marker",d.style.backgroundImage=`url(${xa})`,d.style.width="40px",d.style.height="40px",d.style.backgroundSize="contain",d.style.backgroundRepeat="no-repeat",d.style.backgroundPosition="center",d.style.cursor="pointer";const N=new J.Marker({element:d,draggable:!1}).setLngLat([p,f]).addTo(s.current),E=N.getElement();E.style.cursor="pointer";const y=v=>{v.stopPropagation(),v.preventDefault(),c.current&&c.current!==m&&c.current.remove(),m.addTo(s.current),c.current=m,s.current.easeTo({center:[p,f],zoom:17,duration:800}),h&&h(u.restaurant_id)};E.addEventListener("click",y,!0),m.on("close",()=>{c.current===m&&(c.current=null)}),t.current.push(N)}),a.length>1){const u=new J.LngLatBounds;a.forEach(f=>{const p=Number(f.restaurants.lat),_=Number(f.restaurants.lng);!isNaN(p)&&!isNaN(_)&&u.extend([_,p])}),(b=s.current)==null||b.fitBounds(u,{padding:50,maxZoom:14})}})()},[a,x,h]),a.length===0?null:e.jsx("div",{ref:g,className:"w-full h-[350px] rounded-lg"})});is.displayName="ActivityParticipationMap";const Oa=({open:a,onOpenChange:h,restaurants:g,participatingRestaurantIds:s,onConfirm:t,isPending:x,isParticipating:j})=>{const{t:c}=K(),{localizeRestaurant:o}=ts(),[b,u]=i.useState([]);i.useEffect(()=>{a&&u(s)},[a,s]);const f=m=>{u(d=>d.includes(m)?d.filter(N=>N!==m):[...d,m])},p=()=>{b.length===g.length?u([]):u(g.map(m=>m.id))},_=()=>{t(b)};return e.jsx(be,{open:a,onOpenChange:h,children:e.jsxs(ye,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(Ce,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"选择参与的餐厅"]}),e.jsx(Ye,{children:"勾选要参与活动的餐厅，取消勾选将退出活动"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(Ge,{id:"select-all",checked:b.length===g.length,onCheckedChange:p}),e.jsxs(Fe,{htmlFor:"select-all",className:"cursor-pointer font-semibold",children:["全选/取消全选 (",b.length,"/",g.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:g.map(m=>{const d=o(m),N=b.includes(m.id),E=s.includes(m.id);return e.jsx(H,{className:`transition-all ${N?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{id:m.id,checked:N,onCheckedChange:()=>f(m.id)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(Fe,{htmlFor:m.id,className:"cursor-pointer flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold truncate",children:d.name}),E&&e.jsxs(M,{variant:"secondary",className:"text-xs",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"已参与"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:m.address}),d.type&&d.type.length>0&&e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:d.type.slice(0,2).map((y,v)=>e.jsx(M,{variant:"outline",className:"text-xs",children:y},v))})]})]})})},m.id)})})]}),e.jsxs(es,{children:[e.jsx(w,{variant:"outline",onClick:()=>h(!1),disabled:x,children:c("common.cancel")}),e.jsx(w,{onClick:_,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),c("common.loading")]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"确认 (",b.length,")"]})})]})]})})},Ke=({children:a})=>{const{t:h,i18n:g}=K(),{isAdmin:s}=ss(),{data:t,isLoading:x}=va(),j=Na(),[c,o]=i.useState(!1),[b,u]=i.useState(!1),[f,p]=i.useState("zh"),[_,m]=i.useState(""),[d,N]=i.useState(""),[E,y]=i.useState("");i.useEffect(()=>{t&&(m(t.content_zh),N(t.content_en),y(t.content_pt))},[t]);const v=()=>{if(!t)return"";const Y=g.language;return Y==="zh"?t.content_zh||t.content_en||t.content_pt||"":Y==="pt"?t.content_pt||t.content_en||t.content_zh||"":t.content_en||t.content_zh||t.content_pt||""},I=t&&(t.content_zh||t.content_en||t.content_pt),D=async()=>{if(t)try{await j.mutateAsync({id:t.id,content_zh:_,content_en:d,content_pt:E}),ze({title:h("common.success"),description:h("activities.handbook.updateSuccess")}),u(!1)}catch{ze({title:h("common.error"),description:h("activities.handbook.updateError"),variant:"destructive"})}};return e.jsxs(be,{open:c,onOpenChange:o,children:[e.jsx(Ls,{asChild:!0,children:a}),e.jsxs(ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-primary"}),e.jsx(ke,{children:h("activities.handbook.title")})]})}),x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Z,{className:"w-6 h-6 animate-spin text-primary"})}):b&&s?e.jsx("div",{className:"space-y-4",children:e.jsxs(fa,{value:f,onValueChange:p,children:[e.jsxs(ja,{className:"grid w-full grid-cols-3",children:[e.jsx(fe,{value:"zh",children:"中文"}),e.jsx(fe,{value:"en",children:"English"}),e.jsx(fe,{value:"pt",children:"Português"})]}),e.jsx(je,{value:"zh",className:"mt-4",children:e.jsx(ve,{value:_,onChange:m,placeholder:"请输入中文活动手册内容..."})}),e.jsx(je,{value:"en",className:"mt-4",children:e.jsx(ve,{value:d,onChange:N,placeholder:"Enter English activity handbook content..."})}),e.jsx(je,{value:"pt",className:"mt-4",children:e.jsx(ve,{value:E,onChange:y,placeholder:"Digite o conteúdo do manual da atividade em português..."})})]})}):e.jsx("div",{className:"space-y-4",children:I?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:v()}}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(we,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:h("activities.handbook.empty")}),s&&e.jsx("p",{className:"text-sm mt-2",children:h("activities.handbook.addPrompt")})]})}),e.jsx(es,{className:"gap-2 sm:gap-0",children:b?e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outline",onClick:()=>u(!1),children:h("common.cancel")}),e.jsxs(w,{onClick:D,disabled:j.isPending,children:[j.isPending?e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(wa,{className:"w-4 h-4 mr-2"}),h("common.save")]})]}):s&&e.jsxs(w,{onClick:()=>u(!0),children:[e.jsx(ba,{className:"w-4 h-4 mr-2"}),h(I?"common.edit":"activities.handbook.add")]})})]})]})},Ha=({open:a,onOpenChange:h,activityTitle:g,activityId:s,onShareComplete:t,onShareAction:x,isProcessing:j=!1,hasAlreadyClaimed:c=!1})=>{const{t:o}=K(),b=rs(),[u,f]=i.useState(!1),[p,_]=i.useState(!1);i.useEffect(()=>{_(typeof navigator<"u"&&!!navigator.share&&typeof navigator.canShare=="function")},[]);const m=async()=>{try{await navigator.clipboard.writeText(window.location.href),P.success(o("common.linkCopied")),f(!0),x==null||x()}catch(y){console.error("Error copying link:",y),P.error(o("common.shareError"))}},d=y=>{const v=encodeURIComponent(window.location.href),I=encodeURIComponent(`${g} - Xiaoxiong Market`);let D="";switch(y){case"whatsapp":D=`https://wa.me/?text=${I}%20${v}`;break;case"facebook":D=`https://www.facebook.com/sharer/sharer.php?u=${v}`;break;case"twitter":D=`https://twitter.com/intent/tweet?text=${I}&url=${v}`;break;case"telegram":D=`https://t.me/share/url?url=${v}&text=${I}`;break;case"linkedin":D=`https://www.linkedin.com/sharing/share-offsite/?url=${v}`;break;case"reddit":D=`https://reddit.com/submit?url=${v}&title=${I}`;break;case"line":D=`https://social-plugins.line.me/lineit/share?url=${v}`;break;case"wechat":m(),P.info(o("sharing.copiedForWeChat"));return;case"instagram":m(),P.info(o("sharing.copiedForInstagram"));return;default:return}Ca()?window.location.href=D:window.open(D,"_blank","noopener,noreferrer"),f(!0),x==null||x()},N=async()=>{const y={title:g,text:`${g} - Xiaoxiong Market`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(y)?(await navigator.share(y),f(!0),x==null||x()):m()}catch(v){v.name!=="AbortError"&&(console.error("Error sharing:",v),P.error(o("common.shareError")))}},E=()=>{u&&t()};return e.jsx(be,{open:a,onOpenChange:h,children:e.jsxs(ye,{className:"sm:max-w-md",children:[e.jsxs(Ce,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[c?e.jsx(Sa,{className:"w-5 h-5 text-primary"}):e.jsx(ce,{className:"w-5 h-5 text-primary"}),o("shareDialog.title")]}),e.jsx(Ye,{className:"space-y-2",children:c?e.jsx("p",{className:"text-primary font-medium",children:o("shareDialog.alreadyShared")}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:o("shareDialog.description")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o("shareDialog.hint")})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-2",children:b&&p?e.jsxs(w,{onClick:N,className:"w-full",variant:"default",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),o("sharing.shareToApps")]}):e.jsxs(Ts,{children:[e.jsx(Es,{asChild:!0,children:e.jsxs(w,{className:"w-full",variant:"default",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),o("sharing.selectPlatform")]})}),e.jsxs(Ps,{className:"w-56",children:[p&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{onClick:N,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),o("sharing.systemShare")]}),e.jsx($e,{})]}),e.jsxs(A,{onClick:()=>d("wechat"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(A,{onClick:()=>d("instagram"),children:[e.jsx(za,{className:"w-4 h-4 mr-2"}),"Instagram"]}),e.jsxs(A,{onClick:()=>d("whatsapp"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(A,{onClick:()=>d("facebook"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(A,{onClick:()=>d("twitter"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(A,{onClick:()=>d("telegram"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsxs(A,{onClick:()=>d("linkedin"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"LinkedIn"]}),e.jsxs(A,{onClick:()=>d("line"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"LINE"]}),e.jsxs(A,{onClick:()=>d("reddit"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Reddit"]}),e.jsx($e,{}),e.jsxs(A,{onClick:m,children:[e.jsx(_a,{className:"w-4 h-4 mr-2"}),o("common.copyLink")]})]})]})}),!c&&e.jsx(w,{onClick:E,disabled:!u||j,className:"w-full",variant:u?"default":"secondary",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),o("shareDialog.claiming")]}):u?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),o("shareDialog.confirmButton")]}):o("shareDialog.shareFirst")})]})]})})},qa=({activityId:a,initialCount:h=0})=>{const{t:g}=K(),s=as(),[t,x]=i.useState(h),j=i.useCallback(async()=>{const{count:c}=await V.from("activity_shares").select("*",{count:"exact",head:!0}).eq("activity_id",a);c!==null&&x(c)},[a]);return i.useEffect(()=>{x(h)},[h]),i.useEffect(()=>{const c=V.channel(`share-count-${a}`).on("postgres_changes",{event:"*",schema:"public",table:"activity_shares",filter:`activity_id=eq.${a}`},()=>{j(),s.invalidateQueries({queryKey:["shareCount",a]})}).subscribe();return()=>{V.removeChannel(c)}},[a,j,s]),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Aa,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[t," ",g("activities.shareCount")]})]})},Ba=({activityId:a,initialCount:h=0})=>{const{t:g}=K(),s=as(),[t,x]=i.useState(h),j=i.useCallback(async()=>{const{count:c}=await V.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",a);c!==null&&x(c)},[a]);return i.useEffect(()=>{x(h)},[h]),i.useEffect(()=>{const c=V.channel(`subscriber-count-${a}`).on("postgres_changes",{event:"*",schema:"public",table:"subscriptions",filter:`activity_id=eq.${a}`},()=>{j(),s.invalidateQueries({queryKey:["subscriberCount",a]})}).subscribe();return()=>{V.removeChannel(c)}},[a,j,s]),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(ns,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[t," ",g("activities.subscribersCount")]})]})},Ht=()=>{var Ie;const{id:a}=Rs(),h=As(),g=Is(),{t:s}=K(),{user:t}=Ms(),{isMerchant:x,isSupervisor:j,isAdmin:c}=ss(),{data:o}=Fs(),{localizeActivity:b,localizeRestaurant:u,currentLang:f}=ts();rs();const[p,_]=T.useState(!1),[m,d]=T.useState(!1),[N,E]=T.useState(null),[y,v]=T.useState(!1),[I,D]=T.useState(!1),[Y,de]=T.useState(!1),[ls,Se]=T.useState(!1),[me,os]=T.useState(!0),[cs,he]=T.useState(!1),[ds,ue]=T.useState(!1),[ms,_e]=T.useState(!1),[hs,xe]=T.useState(!1);ka({pageType:"activity",targetId:a}),ea(a);const{data:re=[]}=Ta(a),{data:G=!1}=Ea(a),{data:pe}=Pa(),De=Ra(),q=re.length>0||!!pe,us=T.useCallback(r=>{g(`/restaurant/${r}`,{state:{fromActivity:a}})},[g,a]),Le=((Ie=h.state)==null?void 0:Ie.from)==="admin"?"/admin/activities":"/activities",{data:n,isLoading:xs}=aa(a),{data:z,isLoading:ps}=ta(a),{data:gs=[]}=ra(),fs=gs.map(r=>r.activity_id),{data:js=0}=na(a),{data:vs=0}=ia(a),W=la(),{data:C}=oa(n==null?void 0:n.creator_id),ge=ca(),{data:F=[]}=da(),{data:B=[]}=ma(a),$=ha(),k=n?b(n):null,Te=n?fs.includes(n.id):!1,ee=x||j,Ns=i.useCallback(()=>{!t||!n||ge.mutate(n.id)},[t,n,ge]),ne=F.filter(r=>B.includes(r.id)).length,se=ne>0;F.length,ne>0&&ne<F.length;const ws=i.useCallback(()=>{if(!(!n||!ee||F.length===0))if(j)de(!0);else if(se)for(const r of F)B.includes(r.id)&&$.mutate({activityId:n.id,restaurantId:r.id});else for(const r of F)$.mutate({activityId:n.id,restaurantId:r.id})},[n,ee,F,j,se,B,$]),bs=i.useCallback(r=>{if(!n)return;const S=r.filter(R=>!B.includes(R)),L=B.filter(R=>!r.includes(R));S.forEach(R=>{$.mutate({activityId:n.id,restaurantId:R})}),L.forEach(R=>{$.mutate({activityId:n.id,restaurantId:R})}),de(!1)},[n,B,$]),ys=i.useCallback(()=>{ue(!0)},[]),Cs=i.useCallback(async()=>{ue(!1),D(!0);try{const r=await Da();E({lat:r.coords.latitude,lng:r.coords.longitude}),v(!0),P.success(s("map.locationEnabled"))}catch(r){console.error("Location error:",r),v(!1)}finally{D(!1)}},[s]);i.useCallback(()=>{E(null),v(!1)},[]),T.useEffect(()=>{if(t&&q&&!G&&me){const r=setTimeout(()=>{os(!1)},3e3);return()=>clearTimeout(r)}},[t,q,G,me]);const Ee=i.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),P.success(s("common.linkCopied"))}catch(r){console.error("Error copying link:",r),P.error(s("common.shareError"))}},[s]),Pe=i.useCallback(async()=>{if(!n||!k)return;const r={title:k.title,text:`${k.title} - Xiaoxiong Market

${k.content.replace(/<[^>]*>/g,"").substring(0,200)}...`,url:window.location.href};try{navigator.share&&typeof navigator.canShare=="function"&&navigator.canShare(r)?(await navigator.share(r),P.success(s("common.shareSuccess"))):Ee()}catch(S){S.name!=="AbortError"&&(console.error("Error sharing:",S),P.error(s("common.shareError")))}},[n,k,Ee,s]),ks=i.useCallback(()=>{if(!(!n||!k)){if(!t){xe(!0);return}q?he(!0):(Pe(),W.mutateAsync({activityId:a,userId:t.id}).catch(()=>{}))}},[n,k,t,q,Pe,W,a]),Ss=i.useCallback(async()=>{if(!(!n||!t)){_e(!0);try{await W.mutateAsync({activityId:a,userId:t.id});const r=re.length>0?re[0]:pe;r&&(await De.mutateAsync({templateId:r.id,activityId:a,source:"share"}),P.success(s("coupon.claimSuccess"))),he(!1)}catch(r){console.error("Error claiming coupon:",r),P.error(s("common.error"))}finally{_e(!1)}}},[n,t,W,a,re,pe,De,s]),_s=i.useCallback(()=>{!t||!a||W.mutateAsync({activityId:a,userId:t.id}).catch(r=>{console.log("Share already recorded or error:",r)})},[t,a,W]),X=i.useMemo(()=>{if(!z)return[];const r=z.map(S=>{if(N){const L=La(N.lat,N.lng,Number(S.restaurants.lat),Number(S.restaurants.lng));return{...S,distance:L}}return{...S,distance:void 0}});return y&&N?r.sort((S,L)=>S.distance!==void 0&&L.distance!==void 0?S.distance-L.distance:0):r.sort((S,L)=>{const R=Number(S.restaurants.rating)||0;return(Number(L.restaurants.rating)||0)-R})},[z,y,N]);if(xs)return e.jsx($a,{});if(!n||!k||n.status==="draft"&&!c)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(w,{asChild:!0,className:"mt-4",children:e.jsx(ae,{to:Le,children:s("common.back")})})]})});const Re=new Date(n.start_date),ie=n.end_date?new Date(n.end_date):null,Ae=ie?new Date<=ie:new Date>=Re;return e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[n.media_type==="video"&&n.video_url?e.jsx("video",{src:n.video_url,poster:n.image_url||void 0,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,autoPlay:!0}):e.jsx("img",{src:n.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1200&q=80",alt:k.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(w,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(ae,{to:Le,children:e.jsx(Ia,{className:"w-5 h-5"})})}),t&&ee&&o&&!o.activity_terms_agreed&&e.jsxs(ae,{to:"/profile?tab=activities",className:"absolute top-4 left-16 bg-destructive/95 backdrop-blur-sm text-destructive-foreground text-xs px-3 py-1.5 rounded-full shadow-lg whitespace-nowrap animate-pulse flex items-center gap-1.5 hover:bg-destructive transition-colors",children:[e.jsx(We,{className:"w-3.5 h-3.5"}),s("activities.termsNotAgreed")]}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 items-start",children:[n.status==="draft"&&c&&e.jsxs(M,{variant:"outline",className:"bg-amber-500/90 text-white border-amber-600",children:[e.jsx(Ma,{className:"w-3 h-3 mr-1"}),s("admin.activities.draftPreview")]}),n.pinned&&e.jsx(M,{className:"bg-accent",children:s("activities.pinned")}),e.jsx(pa,{targetType:"activity",targetId:n.id,onLoginRequired:()=>xe(!0),trigger:e.jsx(w,{variant:"secondary",size:"icon",className:"shadow-lg",children:e.jsx(We,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs(w,{variant:"secondary",size:"icon",className:"shadow-lg relative",onClick:ks,children:[e.jsx(O,{className:"w-5 h-5"}),q&&!G&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx(ce,{className:"w-2.5 h-2.5"})}),q&&G&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-green-500 text-white rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx(oe,{className:"w-2.5 h-2.5"})})]}),t&&q&&!G&&me&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-primary/95 backdrop-blur-sm text-primary-foreground text-xs px-3 py-1.5 rounded-full shadow-lg whitespace-nowrap animate-pulse z-10",children:[e.jsx(ce,{className:"w-3 h-3 inline mr-1"}),s("activities.shareToGetCoupon")]})]})]})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(H,{className:"shadow-large",children:[e.jsxs(Q,{className:"relative",children:[e.jsx("div",{className:"hidden sm:block absolute top-4 right-4",children:e.jsx(Ke,{children:e.jsxs(w,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),s("activities.handbook.button")]})})}),e.jsxs("div",{className:"flex flex-col gap-4 sm:pr-32",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(M,{variant:Ae?"default":"secondary",children:s(Ae?"activities.ongoing":"activities.ended")}),n.repeat_mode&&n.repeat_mode!=="none"&&n.repeat_mode!=="days_before"&&e.jsx(M,{variant:"outline",children:s(`activities.repeat.${n.repeat_mode}`)}),n.service_type&&e.jsxs(M,{variant:"outline",className:"flex items-center gap-1.5",children:[n.service_type==="dine_in"&&e.jsx(Je,{className:"w-3.5 h-3.5"}),n.service_type==="takeaway"&&e.jsx(Qe,{className:"w-3.5 h-3.5"}),n.service_type==="both"&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-3.5 h-3.5"}),e.jsx(Qe,{className:"w-3.5 h-3.5"})]}),s(`activities.serviceType.${n.service_type}`)]}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ke,{children:e.jsxs(w,{variant:"outline",size:"sm",className:"gap-1.5 h-7 px-2",children:[e.jsx(Xe,{className:"w-3.5 h-3.5"}),s("activities.handbook.button")]})})})]}),e.jsx(Oe,{className:"text-3xl",children:k.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(zs,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[Ze(Re,"PPP"),ie&&` - ${Ze(ie,"PPP")}`]})]}),e.jsx(Ba,{activityId:a,initialCount:js}),e.jsx(qa,{activityId:a,initialCount:vs}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(te,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[(z==null?void 0:z.length)||0," ",s("activities.restaurantsParticipating")]})]}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(sa,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:s("activities.creatorLabel")}),C!=null&&C.isAdmin?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:Ue,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:s("activities.createdByPlatform")})]}):C!=null&&C.restaurant?e.jsxs(ae,{to:`/restaurant/${C.restaurant.id}`,className:"flex items-center gap-1",onClick:r=>r.stopPropagation(),children:[C.avatar_url?e.jsxs($s,{className:"w-4 h-4",children:[e.jsx(Os,{src:C.avatar_url,alt:"Creator"}),e.jsx(Hs,{className:"text-[8px]",children:C.restaurant.name.charAt(0)})]}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-medium",children:C.restaurant.name.charAt(0)})}),e.jsx("span",{className:"text-primary font-medium hover:underline",children:(()=>{const r=qs.language;return r==="zh"?C.restaurant.name:r==="pt"?C.restaurant.name_pt||C.restaurant.name_en||C.restaurant.name:C.restaurant.name_en||C.restaurant.name})()})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:Ue,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:s("activities.createdByPlatform")})]})]})]}),t&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[ee&&F.length>0&&(o!=null&&o.activity_terms_agreed?e.jsx(w,{onClick:ws,disabled:$.isPending,size:"lg",variant:se?"outline":"default",className:"w-full sm:w-auto",children:j?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"选择参与的餐厅"]}):se?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"退出活动"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"参与活动"]})}):e.jsx(w,{onClick:()=>Se(!0),size:"lg",variant:"outline",className:"w-full sm:w-auto text-muted-foreground",children:s("activities.agreeTermsFirst")})),e.jsx(w,{onClick:Ns,disabled:ge.isPending,size:"lg",variant:Te?"outline":"secondary",className:"w-full sm:w-auto",children:Te?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-4 h-4 mr-2 fill-current"}),s("activities.favorited")||"已收藏"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),s("activities.favorite")||"收藏活动"]})})]}),!t&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("activities.signInToJoin")}),e.jsxs("p",{className:"text-xs text-muted-foreground/80 flex items-center gap-1.5",children:[e.jsx(ns,{className:"w-3.5 h-3.5"}),s("activities.signInToJoinHint")]})]})]})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("activities.about")}),e.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                  prose-headings:text-foreground prose-headings:font-semibold\r
                  prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                  prose-p:leading-relaxed prose-p:my-3\r
                  prose-strong:text-foreground prose-strong:font-semibold\r
                  prose-ul:my-3 prose-ol:my-3\r
                  prose-li:my-1\r
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline\r
                  [&_*]:!text-inherit [&_span[style*='color']]:!text-muted-foreground`,dangerouslySetInnerHTML:{__html:k.content}})]}),k.usage_instructions&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(we,{className:"w-6 h-6 text-primary"}),s("activities.usageInstructions")]}),e.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                      prose-headings:text-foreground prose-headings:font-semibold\r
                      prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                      prose-p:leading-relaxed prose-p:my-3\r
                      prose-strong:text-foreground prose-strong:font-semibold\r
                      prose-ul:my-3 prose-ol:my-3\r
                      prose-li:my-1\r
                      prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:k.usage_instructions}})]})]}),e.jsx(Be,{}),ps?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Z,{className:"w-6 h-6 animate-spin text-primary"})}):z&&z.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Zs,{open:p,onOpenChange:_,children:e.jsxs(H,{className:"border-primary/20 shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden",children:[e.jsx(Q,{className:"pb-3",children:e.jsx(Ks,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[e.jsxs(Oe,{className:"text-lg font-semibold flex items-center gap-2 transition-colors duration-200 group-hover:text-primary",children:[e.jsx(te,{className:"w-5 h-5 transition-transform duration-300 group-hover:scale-110"}),s("activities.participatingRestaurants")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{variant:"secondary",className:"transition-opacity duration-200",children:s(p?"common.showLess":"common.showDetails")}),e.jsx("div",{className:"transition-transform duration-300 ease-in-out",style:{transform:p?"rotate(180deg)":"rotate(0deg)"},children:e.jsx(He,{className:"w-5 h-5 text-muted-foreground group-hover:text-primary"})})]})]})})}),e.jsx(Ys,{className:"overflow-hidden transition-all duration-500 ease-in-out data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",children:e.jsxs(U,{className:"pt-0 pb-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:y?e.jsxs(M,{variant:"default",className:"flex items-center gap-1.5",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),s("activities.sortByLocationEnabled")]}):e.jsxs(w,{variant:"outline",size:"sm",onClick:ys,disabled:I,children:[I?e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ne,{className:"w-4 h-4 mr-2"}),s("activities.enableLocationSort")]})}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:(m?X:X.slice(0,6)).map((r,S)=>{const L=u(r.restaurants);return e.jsx(H,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 opacity-0 animate-fade-in h-full flex flex-col",style:{animationDelay:`${S*50}ms`,animationFillMode:"forwards"},children:e.jsxs(ae,{to:`/restaurant/${r.restaurant_id}`,state:{fromActivity:n.id},className:"flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-40 overflow-hidden flex-shrink-0",children:[e.jsx("img",{src:r.restaurants.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&q=80",alt:L.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),L.type&&L.type.length>0&&e.jsx("div",{className:"absolute top-2 left-2 flex flex-wrap gap-1",children:L.type.slice(0,3).map((R,Me)=>e.jsx(M,{className:"bg-primary",children:R},Me))})]}),e.jsxs(U,{className:"pt-4 pb-4 flex flex-col flex-grow",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-1",children:L.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[e.jsx(qe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:r.restaurants.address})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fa,{className:`w-4 h-4 ${r.restaurants.rating?"fill-accent text-accent":"text-muted-foreground"}`}),r.restaurants.rating?e.jsx("span",{className:"font-semibold text-sm",children:r.restaurants.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[s("restaurant.noRatingLine1"),e.jsx("br",{}),s("restaurant.noRatingLine2")]})]}),r.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[r.distance.toFixed(1)," km"]})]})]})]})]})},r.id)})}),X.length>6&&!m&&e.jsxs(w,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-all duration-200",onClick:()=>d(!0),children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"查看更多 (",X.length-6," 个餐厅)"]})]})})]})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2 mb-4",children:[e.jsx(qe,{className:"w-6 h-6"}),s("activities.participatingRestaurants")," (",X.length,")"]}),e.jsx(is,{restaurants:X,onMarkerClick:us})]})]}):null,e.jsx(ua,{restaurantId:n.id,targetType:"activity"})]})]})}),j&&e.jsx(Oa,{open:Y,onOpenChange:de,restaurants:F,participatingRestaurantIds:B,onConfirm:bs,isPending:$.isPending,isParticipating:se}),ee&&e.jsx(ga,{isAgreed:(o==null?void 0:o.activity_terms_agreed)||!1,agreedAt:(o==null?void 0:o.activity_terms_agreed_at)||null,open:ls,onOpenChange:Se}),e.jsx(Ha,{open:cs,onOpenChange:he,activityTitle:(k==null?void 0:k.title)||"",activityId:a,onShareComplete:Ss,onShareAction:_s,isProcessing:ms,hasAlreadyClaimed:G}),e.jsx(ya,{open:ds,onOpenChange:ue,onConfirm:Cs}),e.jsx(Bs,{open:hs,onOpenChange:xe,children:e.jsxs(Us,{children:[e.jsxs(Gs,{children:[e.jsx(Ws,{children:s("activities.loginRequired")}),e.jsx(Xs,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(Js,{children:[e.jsx(Qs,{children:s("common.cancel")}),e.jsx(Vs,{onClick:()=>g("/auth"),children:s("activities.goToLogin")})]})]})})]})};export{Ht as default};
