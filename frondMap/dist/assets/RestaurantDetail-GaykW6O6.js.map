{"version":3,"mappings":"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","names":["RestaurantDetailSkeleton","jsxs","jsx","Skeleton","Card","CardHeader","CardContent","i","priceRanges","RestaurantRating","restaurantId","t","useTranslation","comments","useComments","ratedComments","c","averageRating","sum","ratingDistribution","star","priceRangeStats","acc","comment","mostCommonPriceRange","a","b","CardTitle","Star","cn","DollarSign","r","count","percentage","useRestaurantActivities","useQuery","data","error","supabase","now","item","activity","startDate","endDate","getLocalizedActivityTitle","language","getLocalizedBadgeText","badgeText","getLocalizedIntro","GALLERY_VIEW_KEY","RestaurantDishGallery","showGallery","images","isLoading","useDishImages","lightboxOpen","setLightboxOpen","useState","currentIndex","setCurrentIndex","isCollapsed","setIsCollapsed","isMobile","useIsMobile","viewMode","setViewMode","saved","useEffect","openLightbox","useCallback","index","closeLightbox","goToPrevious","prev","goToNext","handleKeyDown","e","getCarouselItemClass","Fragment","Collapsible","open","CollapsibleTrigger","ImageIcon","Button","Square","LayoutGrid","ChevronDown","CollapsibleContent","Carousel","CarouselContent","image","CarouselItem","CarouselPrevious","CarouselNext","Dialog","DialogContent","VisuallyHidden","DialogTitle","X","ChevronLeft","ChevronRight","GhostRestaurantHero","restaurant","localizedRestaurant","backUrl","user","isFavorite","onToggleFavorite","onShare","showEditButton","editButton","reportButton","getLocalizedField","useLocalizedContent","ownerBio","avatarFallback","Link","Share2","Heart","Badge","Sparkles","RestaurantComments","lazy","GhostRestaurantStory","restaurantActivities","ratingCount","onTakeawayClick","i18n","activitiesOpen","setActivitiesOpen","announcementOpen","setAnnouncementOpen","commentsSectionRef","useRef","Quote","Utensils","type","idx","ShoppingBag","Separator","intro","MapPin","Phone","MessageCircle","Suspense","Loader2","RestaurantDetail","id","useParams","location","useLocation","useAuth","localizeRestaurant","mapContainer","map","distance","setDistance","hoursOpen","setHoursOpen","mapOpen","setMapOpen","shouldLoadMap","setShouldLoadMap","shouldLoadComments","setShouldLoadComments","isGeneratingToken","setIsGeneratingToken","mapSectionRef","showNavigationDialog","setShowNavigationDialog","showLoginDialog","setShowLoginDialog","showTakeawayDialog","setShowTakeawayDialog","showBookingDialog","setShowBookingDialog","showPrivateDialog","setShowPrivateDialog","navigate","useNavigate","usePageView","fromActivity","fromAdmin","fromProfile","useRestaurant","favoriteIds","useFavorites","toggleFavorite","useToggleFavorite","role","isAdmin","useUserRole","myRestaurants","useMerchantRestaurants","isMerchantOfRestaurant","useMemo","stats","totalPriceRangeCount","priceRangeDisplay","avg","getUserLocation","position","dist","calculateDistance","handleToggleFavorite","handleCopyLink","toast","handleNativeShare","shareData","handleShareToPlatform","platform","url","text","shareUrl","isIOSWebView","mapObserver","entries","entry","commentsObserver","token","mapboxgl","isIOSDevice","initMap","rect","el","mapIcon","timer","RestaurantFormDialog","Edit","ReportDialog","ShieldAlert","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogAction","openExternalUrl","AlertDialogCancel","DropdownMenu","DropdownMenuTrigger","DropdownMenuContent","DropdownMenuItem","DropdownMenuSeparator","Link2","Navigation","Wallet","Clock","formatOpeningHours","days","dayKeys","currentDay","day","hours","isToday","displayName","hoursText","CalendarDays","openNavigation","ExternalLink","targetUrl"],"ignoreList":[],"sources":["../../src/components/skeletons/RestaurantDetailSkeleton.tsx","../../src/components/RestaurantRating.tsx","../../src/hooks/useRestaurantActivities.ts","../../src/components/RestaurantDishGallery.tsx","../../src/components/GhostRestaurantHero.tsx","../../src/components/GhostRestaurantStory.tsx","../../src/pages/RestaurantDetail.tsx"],"sourcesContent":["import { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { ChevronLeft } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nconst RestaurantDetailSkeleton = () => {\r\n  return (\r\n    <div className=\"min-h-screen bg-background pb-8\">\r\n      {/* Hero Image Section */}\r\n      <div className=\"relative h-[30vh] sm:h-[35vh] overflow-hidden\">\r\n        <Skeleton className=\"w-full h-full rounded-none\" />\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent\" />\r\n        \r\n        {/* Back Button */}\r\n        <div className=\"absolute top-4 left-4\">\r\n          <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n        </div>\r\n        \r\n        {/* Action Buttons */}\r\n        <div className=\"absolute top-4 right-4 flex gap-2\">\r\n          <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n          <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"container mx-auto px-4 -mt-16 relative z-10\">\r\n        <Card className=\"shadow-large\">\r\n          <CardHeader>\r\n            <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\r\n              <div className=\"flex-1\">\r\n                {/* Type badges */}\r\n                <div className=\"mb-3 flex flex-wrap gap-2\">\r\n                  <Skeleton className=\"h-6 w-16 rounded-full\" />\r\n                  <Skeleton className=\"h-6 w-20 rounded-full\" />\r\n                  <Skeleton className=\"h-6 w-14 rounded-full\" />\r\n                </div>\r\n                \r\n                {/* Restaurant name */}\r\n                <Skeleton className=\"h-9 w-64 mb-3\" />\r\n                \r\n                {/* Rating and distance */}\r\n                <div className=\"flex items-center gap-4 mb-2\">\r\n                  <Skeleton className=\"h-5 w-20\" />\r\n                  <Skeleton className=\"h-5 w-24\" />\r\n                  <Skeleton className=\"h-5 w-16\" />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Action buttons */}\r\n              <div className=\"flex gap-2\">\r\n                <Skeleton className=\"h-10 w-28 rounded-md\" />\r\n                <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          \r\n          <CardContent className=\"space-y-6\">\r\n            {/* Announcement section */}\r\n            <div className=\"space-y-2\">\r\n              <Skeleton className=\"h-5 w-24\" />\r\n              <Skeleton className=\"h-16 w-full rounded-md\" />\r\n            </div>\r\n            \r\n            {/* Activities section */}\r\n            <div className=\"space-y-2\">\r\n              <Skeleton className=\"h-5 w-32\" />\r\n              <div className=\"flex gap-2\">\r\n                <Skeleton className=\"h-8 w-24 rounded-full\" />\r\n                <Skeleton className=\"h-8 w-28 rounded-full\" />\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Info rows */}\r\n            <div className=\"space-y-4\">\r\n              {/* Address */}\r\n              <div className=\"flex items-start gap-3\">\r\n                <Skeleton className=\"h-5 w-5 flex-shrink-0\" />\r\n                <div className=\"flex-1 space-y-1\">\r\n                  <Skeleton className=\"h-5 w-full\" />\r\n                  <Skeleton className=\"h-5 w-3/4\" />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Phone */}\r\n              <div className=\"flex items-center gap-3\">\r\n                <Skeleton className=\"h-5 w-5 flex-shrink-0\" />\r\n                <Skeleton className=\"h-5 w-32\" />\r\n              </div>\r\n              \r\n              {/* Hours */}\r\n              <div className=\"flex items-start gap-3\">\r\n                <Skeleton className=\"h-5 w-5 flex-shrink-0\" />\r\n                <div className=\"flex-1 space-y-1\">\r\n                  <Skeleton className=\"h-5 w-40\" />\r\n                  <Skeleton className=\"h-5 w-48\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        {/* Map Section */}\r\n        <Card className=\"mt-6 shadow-large\">\r\n          <CardHeader>\r\n            <Skeleton className=\"h-6 w-20\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <Skeleton className=\"h-[200px] w-full rounded-lg\" />\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        {/* Photo Gallery Section */}\r\n        <Card className=\"mt-6 shadow-large\">\r\n          <CardHeader>\r\n            <Skeleton className=\"h-6 w-24\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"flex gap-3 overflow-hidden\">\r\n              {[1, 2, 3, 4].map((i) => (\r\n                <Skeleton key={i} className=\"h-24 w-24 rounded-lg flex-shrink-0\" />\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        {/* Comments Section */}\r\n        <Card className=\"mt-6 shadow-large\">\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <Skeleton className=\"h-6 w-32\" />\r\n            <Skeleton className=\"h-9 w-24 rounded-md\" />\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            {[1, 2, 3].map((i) => (\r\n              <div key={i} className=\"flex gap-3\">\r\n                <Skeleton className=\"h-10 w-10 rounded-full flex-shrink-0\" />\r\n                <div className=\"flex-1 space-y-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Skeleton className=\"h-4 w-24\" />\r\n                    <Skeleton className=\"h-4 w-16\" />\r\n                  </div>\r\n                  <Skeleton className=\"h-4 w-full\" />\r\n                  <Skeleton className=\"h-4 w-3/4\" />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RestaurantDetailSkeleton;\r\n","import { Star, DollarSign } from \"lucide-react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { useComments } from \"@/hooks/useComments\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface RestaurantRatingProps {\r\n  restaurantId: string;\r\n}\r\n\r\nconst priceRanges = [\r\n  { value: \"0-5\", label: \"0-5€\" },\r\n  { value: \"5-10\", label: \"5-10€\" },\r\n  { value: \"10-15\", label: \"10-15€\" },\r\n  { value: \"15-20\", label: \"15-20€\" },\r\n  { value: \"20-25\", label: \"20-25€\" },\r\n  { value: \"25-30\", label: \"25-30€\" },\r\n  { value: \"30-40\", label: \"30-40€\" },\r\n  { value: \"40-50\", label: \"40-50€\" },\r\n  { value: \"50+\", label: \"50€+\" },\r\n];\r\n\r\nconst RestaurantRating = ({ restaurantId }: RestaurantRatingProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  // Get all comments with ratings\r\n  const { data: comments } = useComments(restaurantId, \"restaurant\");\r\n  \r\n  // Filter comments that have ratings\r\n  const ratedComments = comments?.filter(c => c.rating_value) || [];\r\n\r\n  const averageRating = ratedComments.length\r\n    ? ratedComments.reduce((sum, c) => sum + (c.rating_value || 0), 0) / ratedComments.length\r\n    : 0;\r\n\r\n  const ratingDistribution = [5, 4, 3, 2, 1].map((star) => ({\r\n    star,\r\n    count: ratedComments.filter((c) => c.rating_value === star).length,\r\n    percentage: ratedComments.length\r\n      ? ((ratedComments.filter((c) => c.rating_value === star).length / ratedComments.length) * 100).toFixed(0)\r\n      : 0,\r\n  }));\r\n\r\n  // Calculate most common price range\r\n  const priceRangeStats = ratedComments.reduce((acc, comment) => {\r\n    if (comment.price_range) {\r\n      acc[comment.price_range] = (acc[comment.price_range] || 0) + 1;\r\n    }\r\n    return acc;\r\n  }, {} as Record<string, number>);\r\n\r\n  const mostCommonPriceRange = priceRangeStats && Object.keys(priceRangeStats).length > 0\r\n    ? Object.entries(priceRangeStats).sort((a, b) => b[1] - a[1])[0]\r\n    : null;\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>{t(\"restaurant.rating\")}</CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Average Rating Display */}\r\n        <div className=\"flex items-center gap-6\">\r\n          <div className=\"text-center\">\r\n            <div className=\"text-5xl font-bold\">{averageRating.toFixed(1)}</div>\r\n            <div className=\"flex items-center justify-center mt-2\">\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                  key={star}\r\n                  className={cn(\r\n                    \"w-5 h-5\",\r\n                    star <= Math.round(averageRating)\r\n                      ? \"fill-accent text-accent\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                />\r\n              ))}\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground mt-1\">\r\n              {ratedComments.length} {t(\"restaurant.ratingsCount\")}\r\n            </div>\r\n            {mostCommonPriceRange && (\r\n              <div className=\"flex items-center justify-center gap-1 mt-2 text-sm\">\r\n                <DollarSign className=\"w-4 h-4 text-primary\" />\r\n                <span className=\"font-semibold text-foreground\">\r\n                  {priceRanges.find(r => r.value === mostCommonPriceRange[0])?.label}\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Rating Distribution */}\r\n          <div className=\"flex-1 space-y-2\">\r\n            {ratingDistribution.map(({ star, count, percentage }) => (\r\n              <div key={star} className=\"flex items-center gap-2 text-sm\">\r\n                <span className=\"w-8\">{star} ★</span>\r\n                <div className=\"flex-1 h-2 bg-secondary rounded-full overflow-hidden\">\r\n                  <div\r\n                    className=\"h-full bg-accent transition-all\"\r\n                    style={{ width: `${percentage}%` }}\r\n                  />\r\n                </div>\r\n                <span className=\"w-12 text-right text-muted-foreground\">{count}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Info message */}\r\n        <div className=\"pt-4 border-t text-center text-sm text-muted-foreground\">\r\n          {t(\"restaurant.signInToRate\")}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default RestaurantRating;\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport interface RestaurantActivity {\r\n  activity_id: string;\r\n  title_zh: string;\r\n  title_en: string;\r\n  title_pt: string;\r\n  intro_zh?: string | null;\r\n  intro_en?: string | null;\r\n  intro_pt?: string | null;\r\n  badge_text_zh?: string | null;\r\n  badge_text_en?: string | null;\r\n  badge_text_pt?: string | null;\r\n  badge_color?: string | null;\r\n}\r\n\r\n// Get activities for a specific restaurant\r\nexport const useRestaurantActivities = (restaurantId: string) => {\r\n  const { i18n } = useTranslation();\r\n\r\n  return useQuery({\r\n    queryKey: [\"restaurant-activities\", restaurantId],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(`\r\n          activity_id,\r\n          activities (\r\n            id,\r\n            title_zh,\r\n            title_en,\r\n            title_pt,\r\n            intro_zh,\r\n            intro_en,\r\n            intro_pt,\r\n            badge_text_zh,\r\n            badge_text_en,\r\n            badge_text_pt,\r\n            badge_color,\r\n            start_date,\r\n            end_date\r\n          )\r\n        `)\r\n        .eq(\"restaurant_id\", restaurantId);\r\n\r\n      if (error) throw error;\r\n\r\n      // Filter only active activities\r\n      const now = new Date();\r\n      const activeActivities = data\r\n        .filter((item: any) => {\r\n          const activity = item.activities;\r\n          if (!activity) return false;\r\n          \r\n          const startDate = new Date(activity.start_date);\r\n          const endDate = activity.end_date ? new Date(activity.end_date) : null;\r\n          \r\n          return startDate <= now && (!endDate || endDate >= now);\r\n        })\r\n        .map((item: any) => ({\r\n          activity_id: item.activity_id,\r\n          title_zh: item.activities.title_zh,\r\n          title_en: item.activities.title_en,\r\n          title_pt: item.activities.title_pt,\r\n          intro_zh: item.activities.intro_zh,\r\n          intro_en: item.activities.intro_en,\r\n          intro_pt: item.activities.intro_pt,\r\n          badge_text_zh: item.activities.badge_text_zh,\r\n          badge_text_en: item.activities.badge_text_en,\r\n          badge_text_pt: item.activities.badge_text_pt,\r\n          badge_color: item.activities.badge_color,\r\n        }));\r\n\r\n      return activeActivities as RestaurantActivity[];\r\n    },\r\n    enabled: !!restaurantId,\r\n  });\r\n};\r\n\r\n// Get activities for multiple restaurants at once (for list views)\r\nexport const useBatchRestaurantActivities = (restaurantIds: string[]) => {\r\n  const { i18n } = useTranslation();\r\n\r\n  return useQuery({\r\n    queryKey: [\"batch-restaurant-activities\", restaurantIds.join(\",\")],\r\n    queryFn: async () => {\r\n      if (restaurantIds.length === 0) return {};\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(`\r\n          restaurant_id,\r\n          activity_id,\r\n          activities (\r\n            id,\r\n            title_zh,\r\n            title_en,\r\n            title_pt,\r\n            intro_zh,\r\n            intro_en,\r\n            intro_pt,\r\n            badge_text_zh,\r\n            badge_text_en,\r\n            badge_text_pt,\r\n            badge_color,\r\n            start_date,\r\n            end_date\r\n          )\r\n        `)\r\n        .in(\"restaurant_id\", restaurantIds);\r\n\r\n      if (error) throw error;\r\n\r\n      // Group by restaurant and filter active activities\r\n      const now = new Date();\r\n      const activitiesByRestaurant: { [key: string]: RestaurantActivity[] } = {};\r\n\r\n      data.forEach((item: any) => {\r\n        const activity = item.activities;\r\n        if (!activity) return;\r\n\r\n        const startDate = new Date(activity.start_date);\r\n        const endDate = activity.end_date ? new Date(activity.end_date) : null;\r\n\r\n        if (startDate <= now && (!endDate || endDate >= now)) {\r\n          if (!activitiesByRestaurant[item.restaurant_id]) {\r\n            activitiesByRestaurant[item.restaurant_id] = [];\r\n          }\r\n\r\n          activitiesByRestaurant[item.restaurant_id].push({\r\n            activity_id: item.activity_id,\r\n            title_zh: activity.title_zh,\r\n            title_en: activity.title_en,\r\n            title_pt: activity.title_pt,\r\n            intro_zh: activity.intro_zh,\r\n            intro_en: activity.intro_en,\r\n            intro_pt: activity.intro_pt,\r\n            badge_text_zh: activity.badge_text_zh,\r\n            badge_text_en: activity.badge_text_en,\r\n            badge_text_pt: activity.badge_text_pt,\r\n            badge_color: activity.badge_color,\r\n          });\r\n        }\r\n      });\r\n\r\n      return activitiesByRestaurant;\r\n    },\r\n    enabled: restaurantIds.length > 0,\r\n  });\r\n};\r\n\r\n// Helper to get localized activity title\r\nexport const getLocalizedActivityTitle = (\r\n  activity: RestaurantActivity,\r\n  language: string\r\n): string => {\r\n  if (language === \"zh\") return activity.title_zh;\r\n  if (language === \"pt\") return activity.title_pt;\r\n  return activity.title_en;\r\n};\r\n\r\n// Helper to get localized badge text or fallback to activity title\r\nexport const getLocalizedBadgeText = (\r\n  activity: RestaurantActivity,\r\n  language: string\r\n): string => {\r\n  let badgeText = \"\";\r\n  if (language === \"zh\") {\r\n    badgeText = activity.badge_text_zh || activity.title_zh;\r\n  } else if (language === \"pt\") {\r\n    badgeText = activity.badge_text_pt || activity.title_pt;\r\n  } else {\r\n    badgeText = activity.badge_text_en || activity.title_en;\r\n  }\r\n  return badgeText;\r\n};\r\n\r\n// Helper to get localized intro text\r\nexport const getLocalizedIntro = (\r\n  activity: RestaurantActivity,\r\n  language: string\r\n): string => {\r\n  if (language === \"zh\") {\r\n    return activity.intro_zh || \"\";\r\n  } else if (language === \"pt\") {\r\n    return activity.intro_pt || \"\";\r\n  } else {\r\n    return activity.intro_en || \"\";\r\n  }\r\n};\r\n","import { useState, useCallback, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Dialog, DialogContent, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { VisuallyHidden } from \"@radix-ui/react-visually-hidden\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport {\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  CarouselNext,\r\n  CarouselPrevious,\r\n} from \"@/components/ui/carousel\";\r\nimport {\r\n  Collapsible,\r\n  CollapsibleContent,\r\n  CollapsibleTrigger,\r\n} from \"@/components/ui/collapsible\";\r\nimport { ChevronLeft, ChevronRight, X, ImageIcon, ChevronDown, LayoutGrid, Square } from \"lucide-react\";\r\nimport { useDishImages } from \"@/hooks/useDishImages\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\n\r\ninterface RestaurantDishGalleryProps {\r\n  restaurantId: string;\r\n  showGallery?: boolean;\r\n}\r\n\r\nconst GALLERY_VIEW_KEY = \"dish-gallery-view-mode\";\r\n\r\nexport function RestaurantDishGallery({ restaurantId, showGallery = true }: RestaurantDishGalleryProps) {\r\n  const { t } = useTranslation();\r\n  const { data: images = [], isLoading } = useDishImages(restaurantId);\r\n  const [lightboxOpen, setLightboxOpen] = useState(false);\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [isCollapsed, setIsCollapsed] = useState(false);\r\n  const isMobile = useIsMobile();\r\n  \r\n  // View mode: 'single' or 'multi' - only for mobile\r\n  const [viewMode, setViewMode] = useState<'single' | 'multi'>(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem(GALLERY_VIEW_KEY);\r\n      return (saved === 'single' || saved === 'multi') ? saved : 'multi';\r\n    }\r\n    return 'multi';\r\n  });\r\n\r\n  // Persist view mode preference\r\n  useEffect(() => {\r\n    localStorage.setItem(GALLERY_VIEW_KEY, viewMode);\r\n  }, [viewMode]);\r\n\r\n  const openLightbox = useCallback((index: number) => {\r\n    setCurrentIndex(index);\r\n    setLightboxOpen(true);\r\n  }, []);\r\n\r\n  const closeLightbox = useCallback(() => {\r\n    setLightboxOpen(false);\r\n  }, []);\r\n\r\n  const goToPrevious = useCallback(() => {\r\n    setCurrentIndex((prev) => (prev === 0 ? images.length - 1 : prev - 1));\r\n  }, [images.length]);\r\n\r\n  const goToNext = useCallback(() => {\r\n    setCurrentIndex((prev) => (prev === images.length - 1 ? 0 : prev + 1));\r\n  }, [images.length]);\r\n\r\n  // Handle keyboard navigation\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    if (e.key === \"ArrowLeft\") goToPrevious();\r\n    if (e.key === \"ArrowRight\") goToNext();\r\n    if (e.key === \"Escape\") closeLightbox();\r\n  }, [goToPrevious, goToNext, closeLightbox]);\r\n\r\n  if (isLoading) {\r\n    return null;\r\n  }\r\n\r\n  // Don't render if gallery is disabled or no images\r\n  if (!showGallery || !images.length) {\r\n    return null;\r\n  }\r\n\r\n  // Determine basis class based on view mode (mobile only)\r\n  const getCarouselItemClass = () => {\r\n    if (isMobile && viewMode === 'single') {\r\n      return \"pl-2 basis-full\";\r\n    }\r\n    return \"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4\";\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <Collapsible open={!isCollapsed} onOpenChange={(open) => setIsCollapsed(!open)}>\r\n          <CardHeader className=\"pb-3\">\r\n            <CollapsibleTrigger className=\"w-full\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                  <ImageIcon className=\"w-5 h-5\" />\r\n                  {t(\"restaurant.photoGallery\")}\r\n                  <span className=\"text-sm font-normal text-muted-foreground\">\r\n                    ({images.length})\r\n                  </span>\r\n                </CardTitle>\r\n                <div className=\"flex items-center gap-2\">\r\n                  {/* Mobile-only view mode toggle */}\r\n                  {isMobile && (\r\n                    <div \r\n                      className=\"flex items-center gap-1 bg-muted rounded-md p-0.5\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                      <Button\r\n                        variant={viewMode === 'single' ? 'default' : 'ghost'}\r\n                        size=\"icon\"\r\n                        className=\"h-7 w-7\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          setViewMode('single');\r\n                        }}\r\n                        title={t(\"dishImages.singleView\")}\r\n                      >\r\n                        <Square className=\"h-4 w-4\" />\r\n                      </Button>\r\n                      <Button\r\n                        variant={viewMode === 'multi' ? 'default' : 'ghost'}\r\n                        size=\"icon\"\r\n                        className=\"h-7 w-7\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          setViewMode('multi');\r\n                        }}\r\n                        title={t(\"dishImages.multiView\")}\r\n                      >\r\n                        <LayoutGrid className=\"h-4 w-4\" />\r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                  <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${!isCollapsed ? 'rotate-180' : ''}`} />\r\n                </div>\r\n              </div>\r\n            </CollapsibleTrigger>\r\n          </CardHeader>\r\n          <CollapsibleContent>\r\n            <CardContent>\r\n              <Carousel className=\"w-full\">\r\n                <CarouselContent className=\"-ml-2 md:-ml-4\">\r\n                  {images.map((image, index) => (\r\n                    <CarouselItem\r\n                      key={image.id}\r\n                      className={getCarouselItemClass()}\r\n                    >\r\n                      <div\r\n                        className=\"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity\"\r\n                        onClick={() => openLightbox(index)}\r\n                      >\r\n                        <img\r\n                          src={image.image_url}\r\n                          alt={`Dish ${index + 1}`}\r\n                          className=\"w-full h-full object-cover\"\r\n                          loading=\"lazy\"\r\n                        />\r\n                      </div>\r\n                    </CarouselItem>\r\n                  ))}\r\n                </CarouselContent>\r\n                {images.length > (isMobile && viewMode === 'single' ? 1 : 2) && (\r\n                  <>\r\n                    <CarouselPrevious className=\"-left-3 md:-left-4\" />\r\n                    <CarouselNext className=\"-right-3 md:-right-4\" />\r\n                  </>\r\n                )}\r\n              </Carousel>\r\n              <p className=\"text-sm text-muted-foreground mt-2 text-center\">\r\n                {t(\"dishImages.clickToEnlarge\")}\r\n              </p>\r\n            </CardContent>\r\n          </CollapsibleContent>\r\n        </Collapsible>\r\n      </Card>\r\n\r\n      {/* Lightbox Dialog */}\r\n      <Dialog open={lightboxOpen} onOpenChange={setLightboxOpen}>\r\n        <DialogContent\r\n          className=\"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none\"\r\n          onKeyDown={handleKeyDown}\r\n        >\r\n          <VisuallyHidden>\r\n            <DialogTitle>{t(\"restaurants.dishGallery\", \"Dish Gallery\")}</DialogTitle>\r\n          </VisuallyHidden>\r\n          <div className=\"relative w-full h-full flex items-center justify-center min-h-[50vh]\">\r\n            {/* Close button */}\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              className=\"absolute top-2 right-2 z-50 text-white hover:bg-white/20\"\r\n              onClick={closeLightbox}\r\n            >\r\n              <X className=\"w-6 h-6\" />\r\n            </Button>\r\n\r\n            {/* Previous button */}\r\n            {images.length > 1 && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute left-2 z-50 text-white hover:bg-white/20 h-12 w-12\"\r\n                onClick={goToPrevious}\r\n              >\r\n                <ChevronLeft className=\"w-8 h-8\" />\r\n              </Button>\r\n            )}\r\n\r\n            {/* Image */}\r\n            <img\r\n              src={images[currentIndex]?.image_url}\r\n              alt={`Dish ${currentIndex + 1}`}\r\n              className=\"max-w-full max-h-[85vh] object-contain\"\r\n            />\r\n\r\n            {/* Next button */}\r\n            {images.length > 1 && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute right-2 z-50 text-white hover:bg-white/20 h-12 w-12\"\r\n                onClick={goToNext}\r\n              >\r\n                <ChevronRight className=\"w-8 h-8\" />\r\n              </Button>\r\n            )}\r\n\r\n            {/* Image counter */}\r\n            <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm\">\r\n              {currentIndex + 1} / {images.length}\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}","import { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Heart, ChevronLeft, Share2, Edit, ShieldAlert, Sparkles } from \"lucide-react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\ninterface GhostRestaurantHeroProps {\r\n  restaurant: any;\r\n  localizedRestaurant: any;\r\n  backUrl: string;\r\n  user: any;\r\n  isFavorite: boolean;\r\n  onToggleFavorite: () => void;\r\n  onShare: () => void;\r\n  onReport: () => void;\r\n  showEditButton?: boolean;\r\n  editButton?: React.ReactNode;\r\n  reportButton?: React.ReactNode;\r\n}\r\n\r\nexport const GhostRestaurantHero = ({\r\n  restaurant,\r\n  localizedRestaurant,\r\n  backUrl,\r\n  user,\r\n  isFavorite,\r\n  onToggleFavorite,\r\n  onShare,\r\n  showEditButton,\r\n  editButton,\r\n  reportButton,\r\n}: GhostRestaurantHeroProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  const ownerBio = getLocalizedField(restaurant, \"owner_bio\") || restaurant.owner_bio;\r\n  const avatarFallback = localizedRestaurant.name?.charAt(0)?.toUpperCase() || \"主\";\r\n\r\n  return (\r\n    <div className=\"relative min-h-[100vh] md:min-h-[90vh] overflow-hidden\">\r\n      {/* Full-screen background image */}\r\n      <div className=\"absolute inset-0\">\r\n        <img\r\n          src={restaurant.cover_image_url || restaurant.image_url || \"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80\"}\r\n          alt={localizedRestaurant.name}\r\n          className=\"w-full h-full object-cover\"\r\n        />\r\n        {/* Cinematic gradient overlay */}\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background via-background/70 to-background/30\" />\r\n        <div className=\"absolute inset-0 bg-gradient-to-r from-background/50 via-transparent to-background/50\" />\r\n      </div>\r\n\r\n      {/* Navigation buttons */}\r\n      <div className=\"absolute top-4 left-4 right-4 flex justify-between items-center z-20\">\r\n        <Button asChild variant=\"secondary\" size=\"icon\" className=\"backdrop-blur-sm bg-background/60\">\r\n          <Link to={backUrl}>\r\n            <ChevronLeft className=\"w-5 h-5\" />\r\n          </Link>\r\n        </Button>\r\n        \r\n        <div className=\"flex items-center gap-2\">\r\n          {reportButton}\r\n          {editButton}\r\n          <Button\r\n            variant=\"secondary\"\r\n            size=\"icon\"\r\n            className=\"backdrop-blur-sm bg-background/60\"\r\n            onClick={onShare}\r\n          >\r\n            <Share2 className=\"w-5 h-5\" />\r\n          </Button>\r\n          {user && (\r\n            <Button\r\n              variant=\"secondary\"\r\n              size=\"icon\"\r\n              className=\"backdrop-blur-sm bg-background/60\"\r\n              onClick={onToggleFavorite}\r\n            >\r\n              <Heart className={`w-5 h-5 ${isFavorite ? 'fill-destructive text-destructive' : ''}`} />\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Hero content - Story-driven layout */}\r\n      <div className=\"relative z-10 min-h-[100vh] md:min-h-[90vh] flex flex-col justify-end pb-8 md:pb-16\">\r\n        <div className=\"container mx-auto max-w-6xl px-4\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-end\">\r\n            \r\n            {/* Left: Owner portrait */}\r\n            <div className=\"order-2 lg:order-1 flex justify-center lg:justify-start\">\r\n              <div className=\"relative\">\r\n                {/* Glow effect */}\r\n                <div className=\"absolute -inset-4 bg-gradient-to-br from-primary/20 to-accent/20 rounded-[2rem] blur-2xl opacity-60\" />\r\n                \r\n                {/* Portrait frame */}\r\n                <div className=\"relative w-48 h-48 md:w-64 md:h-64 lg:w-80 lg:h-80 rounded-[1.5rem] overflow-hidden border-4 border-background/50 shadow-2xl\">\r\n                  {restaurant.owner_avatar_url ? (\r\n                    <img \r\n                      src={restaurant.owner_avatar_url} \r\n                      alt={localizedRestaurant.name}\r\n                      className=\"w-full h-full object-cover\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-full h-full bg-gradient-to-br from-primary/20 via-accent/10 to-muted flex items-center justify-center\">\r\n                      <span className=\"text-6xl md:text-8xl lg:text-9xl font-bold text-primary/40\">\r\n                        {avatarFallback}\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Badge */}\r\n                <Badge className=\"absolute -bottom-3 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-4 py-1.5 text-sm font-medium shadow-lg\">\r\n                  <Sparkles className=\"w-3.5 h-3.5 mr-1.5\" />\r\n                  {t(\"restaurants.ownerStory\", \"主理人\")}\r\n                </Badge>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Right: Story text */}\r\n            <div className=\"order-1 lg:order-2 text-center lg:text-left space-y-6\">\r\n              {/* Overline */}\r\n              <p className=\"text-xs md:text-sm font-medium tracking-[0.25em] uppercase text-primary/80\">\r\n                {t(\"restaurants.exclusiveInterview\", \"专属故事\")}\r\n              </p>\r\n              \r\n              {/* Main title */}\r\n              <h1 className=\"text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-foreground leading-tight\">\r\n                {localizedRestaurant.name}\r\n              </h1>\r\n              \r\n              {/* Subtitle / Bio preview */}\r\n              {ownerBio && (\r\n                <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed max-w-xl mx-auto lg:mx-0 line-clamp-3\">\r\n                  {ownerBio}\r\n                </p>\r\n              )}\r\n              \r\n              {/* Scroll indicator */}\r\n              <div className=\"pt-4 flex justify-center lg:justify-start\">\r\n                <div className=\"flex flex-col items-center gap-2 text-muted-foreground/60\">\r\n                  <span className=\"text-xs tracking-wider uppercase\">{t(\"common.scrollDown\", \"向下滚动\")}</span>\r\n                  <div className=\"w-px h-8 bg-gradient-to-b from-muted-foreground/40 to-transparent animate-pulse\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GhostRestaurantHero;\r\n","import { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\nimport { MapPin, Phone, MessageCircle, Star, ChevronDown, ShoppingBag, Quote, Utensils } from \"lucide-react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { RestaurantDishGallery } from \"@/components/RestaurantDishGallery\";\r\nimport RestaurantRating from \"@/components/RestaurantRating\";\r\nimport { lazy, Suspense, useState, useRef } from \"react\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { getLocalizedBadgeText, getLocalizedActivityTitle, getLocalizedIntro } from \"@/hooks/useRestaurantActivities\";\r\n\r\nconst RestaurantComments = lazy(() => import(\"@/components/RestaurantComments\"));\r\n\r\ninterface GhostRestaurantStoryProps {\r\n  restaurant: any;\r\n  localizedRestaurant: any;\r\n  restaurantActivities: any[];\r\n  ratingCount: number;\r\n  averageRating: number;\r\n  onTakeawayClick: () => void;\r\n}\r\n\r\nexport const GhostRestaurantStory = ({\r\n  restaurant,\r\n  localizedRestaurant,\r\n  restaurantActivities,\r\n  ratingCount,\r\n  averageRating,\r\n  onTakeawayClick,\r\n}: GhostRestaurantStoryProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [activitiesOpen, setActivitiesOpen] = useState(false);\r\n  const [announcementOpen, setAnnouncementOpen] = useState(false);\r\n  const commentsSectionRef = useRef<HTMLDivElement>(null);\r\n  \r\n  const ownerBio = getLocalizedField(restaurant, \"owner_bio\") || restaurant.owner_bio;\r\n  const avatarFallback = localizedRestaurant.name?.charAt(0)?.toUpperCase() || \"主\";\r\n\r\n  return (\r\n    <div className=\"relative bg-background\">\r\n      {/* Story Section */}\r\n      <section className=\"py-16 md:py-24\">\r\n        <div className=\"container mx-auto max-w-4xl px-4\">\r\n          {/* Section title */}\r\n          <div className=\"text-center mb-12\">\r\n            <p className=\"text-xs md:text-sm font-medium tracking-[0.25em] uppercase text-primary mb-3\">\r\n              {t(\"restaurants.theStory\", \"品牌故事\")}\r\n            </p>\r\n            <h2 className=\"text-3xl md:text-4xl font-bold text-foreground\">\r\n              {t(\"restaurants.behindTheScene\", \"幕后故事\")}\r\n            </h2>\r\n            <div className=\"w-16 h-1 bg-primary mx-auto mt-4\" />\r\n          </div>\r\n          \r\n          {/* Biography - Magazine style */}\r\n          {ownerBio && (\r\n            <div className=\"relative max-w-3xl mx-auto\">\r\n              {/* Large quote mark */}\r\n              <Quote className=\"absolute -top-8 -left-4 md:-left-12 w-16 h-16 md:w-24 md:h-24 text-primary/10 rotate-180\" />\r\n              \r\n              {/* Story content */}\r\n              <div className=\"relative z-10 space-y-6\">\r\n                <p className=\"text-lg md:text-xl lg:text-2xl text-foreground leading-relaxed md:leading-loose whitespace-pre-wrap first-letter:text-6xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-3 first-letter:mt-2\">\r\n                  {ownerBio}\r\n                </p>\r\n              </div>\r\n              \r\n              {/* Signature */}\r\n              <div className=\"mt-12 flex items-center justify-center gap-4\">\r\n                <div className=\"h-px flex-1 bg-gradient-to-r from-transparent to-border\" />\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg\">\r\n                    {avatarFallback}\r\n                  </div>\r\n                  <div className=\"text-left\">\r\n                    <p className=\"font-semibold text-foreground\">{localizedRestaurant.name}</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"restaurants.founder\", \"创始人\")}</p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"h-px flex-1 bg-gradient-to-l from-transparent to-border\" />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </section>\r\n\r\n      {/* Food Philosophy Section */}\r\n      {localizedRestaurant.description && (\r\n        <section className=\"py-16 bg-muted/30\">\r\n          <div className=\"container mx-auto max-w-4xl px-4\">\r\n            <div className=\"text-center mb-12\">\r\n              <p className=\"text-xs md:text-sm font-medium tracking-[0.25em] uppercase text-primary mb-3\">\r\n                {t(\"restaurants.philosophy\", \"理念\")}\r\n              </p>\r\n              <h2 className=\"text-3xl md:text-4xl font-bold text-foreground flex items-center justify-center gap-3\">\r\n                <Utensils className=\"w-8 h-8 text-primary\" />\r\n                {t(\"restaurants.foodPhilosophy\", \"美食哲学\")}\r\n              </h2>\r\n              <div className=\"w-16 h-1 bg-primary mx-auto mt-4\" />\r\n            </div>\r\n            \r\n            <div \r\n              className=\"prose prose-lg dark:prose-invert max-w-none text-center [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline\"\r\n              dangerouslySetInnerHTML={{ __html: localizedRestaurant.description }}\r\n            />\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Dish Gallery Section */}\r\n      <section className=\"py-16\">\r\n        <div className=\"container mx-auto max-w-5xl px-4\">\r\n          <RestaurantDishGallery restaurantId={restaurant.id} showGallery={(restaurant as any).show_dish_gallery !== false} />\r\n        </div>\r\n      </section>\r\n\r\n      {/* Info Section */}\r\n      <section className=\"py-16 bg-muted/30\">\r\n        <div className=\"container mx-auto max-w-4xl px-4\">\r\n          <Card className=\"border-0 shadow-xl overflow-hidden\">\r\n            <CardContent className=\"p-6 md:p-8 space-y-6\">\r\n              {/* Type tags and rating */}\r\n              <div className=\"flex flex-wrap items-center gap-3\">\r\n                {localizedRestaurant.type.slice(0, 3).map((type: string, idx: number) => (\r\n                  <Badge key={idx} variant=\"secondary\">{type}</Badge>\r\n                ))}\r\n                <Badge variant=\"outline\" className=\"gap-1\">\r\n                  <ShoppingBag className=\"w-3 h-3\" />\r\n                  {t(\"restaurants.ghostKitchen\")}\r\n                </Badge>\r\n                {ratingCount > 0 && (\r\n                  <div className=\"flex items-center gap-1 ml-auto\">\r\n                    <Star className=\"w-4 h-4 fill-accent text-accent\" />\r\n                    <span className=\"font-semibold text-sm\">\r\n                      {averageRating.toFixed(1)}\r\n                      <span className=\"text-muted-foreground font-normal ml-1\">({ratingCount})</span>\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              {/* Contact Info Grid */}\r\n              <div className=\"grid gap-4\">\r\n                {/* Activities */}\r\n                {restaurantActivities.length > 0 && (\r\n                  <Collapsible\r\n                    open={activitiesOpen}\r\n                    onOpenChange={setActivitiesOpen}\r\n                    className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                  >\r\n                    <Star className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                    <div className=\"flex-1\">\r\n                      <CollapsibleTrigger className=\"w-full\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div className=\"flex flex-col items-start\">\r\n                            <p className=\"font-medium text-card-foreground\">{t(\"activities.title\")}</p>\r\n                            {!activitiesOpen && (\r\n                              <div className=\"flex flex-wrap gap-1.5 mt-1\">\r\n                                {restaurantActivities.map((activity, idx) => (\r\n                                  <Badge \r\n                                    key={`activity-${idx}`} \r\n                                    variant=\"default\" \r\n                                    className=\"text-white\"\r\n                                    style={{ backgroundColor: activity.badge_color || \"hsl(var(--primary))\" }}\r\n                                  >\r\n                                    {getLocalizedBadgeText(activity, i18n.language)}\r\n                                  </Badge>\r\n                                ))}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${activitiesOpen ? 'rotate-180' : ''}`} />\r\n                        </div>\r\n                      </CollapsibleTrigger>\r\n                      <CollapsibleContent className=\"mt-3 space-y-2\">\r\n                        {restaurantActivities.map((activity, idx) => {\r\n                          const intro = getLocalizedIntro(activity, i18n.language);\r\n                          return (\r\n                            <Link\r\n                              key={`activity-detail-${idx}`}\r\n                              to={`/activity/${activity.activity_id}`}\r\n                              className=\"block p-2 rounded-md hover:bg-muted/80 transition-colors\"\r\n                            >\r\n                              <Badge \r\n                                variant=\"default\" \r\n                                className=\"text-white mr-2\"\r\n                                style={{ backgroundColor: activity.badge_color || \"hsl(var(--primary))\" }}\r\n                              >\r\n                                {getLocalizedBadgeText(activity, i18n.language)}\r\n                              </Badge>\r\n                              <span className=\"text-sm text-muted-foreground\">\r\n                                {intro || getLocalizedActivityTitle(activity, i18n.language)} ... →\r\n                              </span>\r\n                            </Link>\r\n                          );\r\n                        })}\r\n                      </CollapsibleContent>\r\n                    </div>\r\n                  </Collapsible>\r\n                )}\r\n\r\n                {/* Production Address */}\r\n                <div className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\">\r\n                  <MapPin className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div>\r\n                    <p className=\"font-medium text-card-foreground\">{t(\"restaurants.productionAddress\")}</p>\r\n                    <p className=\"text-muted-foreground\">{restaurant.address}</p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Phone */}\r\n                {restaurant.phone && (\r\n                  <a \r\n                    href={`tel:${restaurant.phone}`}\r\n                    className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer\"\r\n                  >\r\n                    <Phone className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                    <div>\r\n                      <p className=\"font-medium text-card-foreground\">{t(\"restaurant.phone\")}</p>\r\n                      <p className=\"text-primary underline\">{restaurant.phone}</p>\r\n                    </div>\r\n                  </a>\r\n                )}\r\n\r\n                {/* Announcement */}\r\n                {restaurant && (getLocalizedField(restaurant, \"announcement\") || restaurant.announcement_zh) && (\r\n                  <Collapsible\r\n                    open={announcementOpen}\r\n                    onOpenChange={setAnnouncementOpen}\r\n                    className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                  >\r\n                    <MessageCircle className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                    <div className=\"flex-1\">\r\n                      <CollapsibleTrigger className=\"w-full\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <p className=\"font-medium text-card-foreground\">{t(\"restaurant.announcement\")}</p>\r\n                          <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${announcementOpen ? 'rotate-180' : ''}`} />\r\n                        </div>\r\n                      </CollapsibleTrigger>\r\n                      <CollapsibleContent className=\"mt-3\">\r\n                        <div className=\"p-3 rounded-md bg-primary/5 border border-primary/10\">\r\n                          <p className=\"text-sm text-foreground whitespace-pre-wrap\">\r\n                            {getLocalizedField(restaurant, \"announcement\") || restaurant.announcement_zh}\r\n                          </p>\r\n                        </div>\r\n                      </CollapsibleContent>\r\n                    </div>\r\n                  </Collapsible>\r\n                )}\r\n              </div>\r\n\r\n              {/* Action Button */}\r\n              {restaurant.website_url && (restaurant as any).show_takeaway_button && (\r\n                <>\r\n                  <Separator />\r\n                  <Button \r\n                    className=\"w-full\"\r\n                    size=\"lg\"\r\n                    onClick={onTakeawayClick}\r\n                  >\r\n                    <ShoppingBag className=\"w-4 h-4 mr-2\" />\r\n                    {t(\"restaurant.takeawayOrder\")}\r\n                  </Button>\r\n                </>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Rating Section */}\r\n      <section className=\"py-16\">\r\n        <div className=\"container mx-auto max-w-4xl px-4\">\r\n          <Card className=\"border-0 shadow-xl overflow-hidden\">\r\n            <CardContent className=\"p-6 md:p-8\">\r\n              <RestaurantRating restaurantId={restaurant.id} />\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Comments Section */}\r\n      <section className=\"py-16 bg-muted/30\">\r\n        <div className=\"container mx-auto max-w-4xl px-4\">\r\n          <Card className=\"border-0 shadow-xl overflow-hidden\">\r\n            <CardContent className=\"p-6 md:p-8\" ref={commentsSectionRef}>\r\n              <Suspense fallback={\r\n                <div className=\"flex items-center justify-center py-12\">\r\n                  <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n                </div>\r\n              }>\r\n                <RestaurantComments restaurantId={restaurant.id} />\r\n              </Suspense>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GhostRestaurantStory;\r\n","import { useParams, Link, useLocation, useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuSeparator,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport {\r\n  Collapsible,\r\n  CollapsibleContent,\r\n  CollapsibleTrigger,\r\n} from \"@/components/ui/collapsible\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { toast } from \"sonner\";\r\nimport { Star, MapPin, Phone, Clock, Heart, Navigation, ChevronLeft, Loader2, MessageCircle, Wallet, Edit, ShieldAlert, Share2, Link2, ChevronDown, ShoppingBag, CalendarDays, ExternalLink } from \"lucide-react\";\r\nimport { useRestaurant, useToggleFavorite, useFavorites } from \"@/hooks/useRestaurants\";\r\nimport { useComments } from \"@/hooks/useComments\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { formatAllOpeningHours, formatOpeningHours } from \"@/lib/timeUtils\";\r\nimport { openNavigation, calculateDistance, getUserLocation } from \"@/lib/geolocation\";\r\nimport { isIOSWebView, isIOSDevice, openExternalUrl } from \"@/lib/externalLinks\";\r\n// NavigationConfirmDialog removed - using inline glass-style AlertDialog instead\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport RestaurantRating from \"@/components/RestaurantRating\";\r\nimport ReportDialog from \"@/components/ReportDialog\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport { useEffect, useRef, useState, useMemo, useCallback, lazy, Suspense } from \"react\";\r\nimport { usePageView } from \"@/hooks/usePageView\";\r\n\r\n// Lazy load heavy components\r\nconst RestaurantComments = lazy(() => import(\"@/components/RestaurantComments\"));\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useMerchantRestaurants } from \"@/hooks/useActivityParticipation\";\r\nimport { RestaurantFormDialog } from \"@/components/admin/RestaurantFormDialog\";\r\nimport { useRestaurantActivities, getLocalizedBadgeText, getLocalizedActivityTitle, getLocalizedIntro } from \"@/hooks/useRestaurantActivities\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { RestaurantDishGallery } from \"@/components/RestaurantDishGallery\";\r\nimport { RestaurantDetailSkeleton } from \"@/components/skeletons\";\r\nimport { GhostRestaurantHero } from \"@/components/GhostRestaurantHero\";\r\nimport { GhostRestaurantStory } from \"@/components/GhostRestaurantStory\";\r\n\r\nconst RestaurantDetail = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const location = useLocation();\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { localizeRestaurant, getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const mapContainer = useRef<HTMLDivElement>(null);\r\n  const map = useRef<mapboxgl.Map | null>(null);\r\n  const [distance, setDistance] = useState<number | null>(null);\r\n  const [hoursOpen, setHoursOpen] = useState(false);\r\n  const [mapOpen, setMapOpen] = useState(true);\r\n  const [announcementOpen, setAnnouncementOpen] = useState(false);\r\n  const [activitiesOpen, setActivitiesOpen] = useState(false);\r\n  const [shouldLoadMap, setShouldLoadMap] = useState(true);\r\n  const [shouldLoadComments, setShouldLoadComments] = useState(true);\r\n  const [isGeneratingToken, setIsGeneratingToken] = useState(false);\r\n  const mapSectionRef = useRef<HTMLDivElement>(null);\r\n  const commentsSectionRef = useRef<HTMLDivElement>(null);\r\n  const [showNavigationDialog, setShowNavigationDialog] = useState(false);\r\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\r\n  const [showTakeawayDialog, setShowTakeawayDialog] = useState(false);\r\n  const [showBookingDialog, setShowBookingDialog] = useState(false);\r\n  const [showPrivateDialog, setShowPrivateDialog] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  // Track page view\r\n  usePageView({ pageType: \"restaurant\", targetId: id });\r\n  \r\n  // Determine where to go back based on where we came from\r\n  const fromActivity = (location.state as { fromActivity?: string })?.fromActivity;\r\n  const fromAdmin = (location.state as { from?: string })?.from === \"admin\";\r\n  const fromProfile = (location.state as { from?: string })?.from === \"profile\";\r\n  \r\n  const backUrl = fromAdmin\r\n    ? \"/admin/restaurants\"\r\n    : fromProfile\r\n    ? \"/profile\"\r\n    : fromActivity\r\n    ? `/activity/${fromActivity}`\r\n    : \"/restaurants\";\r\n\r\n  const { data: restaurant, isLoading } = useRestaurant(id!);\r\n  const { data: favoriteIds = [] } = useFavorites();\r\n  const { data: comments } = useComments(id!, \"restaurant\", { enabled: shouldLoadComments });\r\n  const toggleFavorite = useToggleFavorite();\r\n  const { role, isAdmin } = useUserRole();\r\n  const { data: myRestaurants = [] } = useMerchantRestaurants();\r\n  const { data: restaurantActivities = [] } = useRestaurantActivities(id!);\r\n  \r\n  // Check if current user is merchant of this restaurant\r\n  const isMerchantOfRestaurant = restaurant && myRestaurants.some(r => r.id === restaurant.id);\r\n\r\n  const localizedRestaurant = restaurant ? localizeRestaurant(restaurant) : null;\r\n  const isFavorite = restaurant ? favoriteIds.includes(restaurant.id) : false;\r\n\r\n  // Calculate most common price range from comments\r\n  const priceRanges = useMemo(() => [\r\n    { value: \"€\", label: \"€ (0-10€)\" },\r\n    { value: \"€€\", label: \"€€ (10-20€)\" },\r\n    { value: \"€€€\", label: \"€€€ (20€+)\" },\r\n  ], []);\r\n  \r\n  const mostCommonPriceRange = useMemo(() => {\r\n    const stats: Record<string, { count: number; latestDate: string }> = {};\r\n    comments?.forEach(comment => {\r\n      if (comment.price_range) {\r\n        if (!stats[comment.price_range]) {\r\n          stats[comment.price_range] = { count: 0, latestDate: comment.created_at };\r\n        }\r\n        stats[comment.price_range].count += 1;\r\n        // Keep track of the most recent date for this price range\r\n        if (comment.created_at > stats[comment.price_range].latestDate) {\r\n          stats[comment.price_range].latestDate = comment.created_at;\r\n        }\r\n      }\r\n    });\r\n    return stats;\r\n  }, [comments]);\r\n  \r\n  // Calculate total price range count\r\n  const totalPriceRangeCount = useMemo(() => {\r\n    if (!mostCommonPriceRange) return 0;\r\n    return Object.values(mostCommonPriceRange).reduce((sum, item) => sum + item.count, 0);\r\n  }, [mostCommonPriceRange]);\r\n  \r\n  // Only display price range if there are more than 10 data points\r\n  // If counts are equal, use the one with the most recent comment\r\n  const priceRangeDisplay = useMemo(() => {\r\n    if (!mostCommonPriceRange || totalPriceRangeCount < 10) return null;\r\n    const sorted = Object.entries(mostCommonPriceRange).sort(([, a], [, b]) => {\r\n      // Sort by count first (descending)\r\n      if (b.count !== a.count) return b.count - a.count;\r\n      // If counts are equal, sort by latest date (descending)\r\n      return b.latestDate.localeCompare(a.latestDate);\r\n    });\r\n    return sorted[0]?.[0] || null;\r\n  }, [mostCommonPriceRange, totalPriceRangeCount]);\r\n\r\n  // Calculate rating count and average rating from comments (comments with rating_value)\r\n  const { ratingCount, averageRating } = useMemo(() => {\r\n    const ratedComments = comments?.filter(c => c.rating_value) || [];\r\n    const count = ratedComments.length;\r\n    const avg = count > 0 \r\n      ? ratedComments.reduce((sum, c) => sum + (c.rating_value || 0), 0) / count \r\n      : 0;\r\n    return { ratingCount: count, averageRating: avg };\r\n  }, [comments]);\r\n\r\n  // Calculate distance from user location\r\n  useEffect(() => {\r\n    if (!restaurant) return;\r\n    \r\n    getUserLocation()\r\n      .then((position) => {\r\n        const dist = calculateDistance(\r\n          position.coords.latitude,\r\n          position.coords.longitude,\r\n          restaurant.lat,\r\n          restaurant.lng\r\n        );\r\n        setDistance(dist);\r\n      })\r\n      .catch(() => {\r\n        // Silently fail if location not available\r\n        setDistance(null);\r\n      });\r\n  }, [restaurant]);\r\n\r\n  const handleToggleFavorite = useCallback(() => {\r\n    if (!user || !restaurant) return;\r\n    toggleFavorite.mutate(restaurant.id);\r\n  }, [user, restaurant, toggleFavorite]);\r\n\r\n  const handleCopyLink = useCallback(async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(window.location.href);\r\n      toast.success(t(\"common.linkCopied\"));\r\n    } catch (error) {\r\n      console.error(\"Error copying link:\", error);\r\n      toast.error(t(\"common.shareError\"));\r\n    }\r\n  }, [t]);\r\n\r\n  const handleNativeShare = useCallback(async () => {\r\n    if (!restaurant || !localizedRestaurant) return;\r\n    \r\n    const shareData = {\r\n      title: localizedRestaurant.name,\r\n      text: `${localizedRestaurant.name} - Xiaoxiong Market\\n\\n${localizedRestaurant.description || localizedRestaurant.address}`,\r\n      url: window.location.href,\r\n    };\r\n\r\n    try {\r\n      if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {\r\n        await navigator.share(shareData);\r\n        toast.success(t(\"common.shareSuccess\"));\r\n      } else {\r\n        handleCopyLink();\r\n      }\r\n    } catch (error) {\r\n      if ((error as Error).name !== \"AbortError\") {\r\n        console.error(\"Error sharing:\", error);\r\n        toast.error(t(\"common.shareError\"));\r\n      }\r\n    }\r\n  }, [restaurant, localizedRestaurant, handleCopyLink, t]);\r\n\r\n  const handleShareToPlatform = useCallback((platform: string) => {\r\n    if (!restaurant || !localizedRestaurant) return;\r\n    \r\n    const url = encodeURIComponent(window.location.href);\r\n    const text = encodeURIComponent(localizedRestaurant.name);\r\n    \r\n    let shareUrl = \"\";\r\n    \r\n    switch (platform) {\r\n      case \"whatsapp\":\r\n        shareUrl = `https://wa.me/?text=${text}%20${url}`;\r\n        break;\r\n      case \"facebook\":\r\n        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;\r\n        break;\r\n      case \"twitter\":\r\n        shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;\r\n        break;\r\n      case \"telegram\":\r\n        shareUrl = `https://t.me/share/url?url=${url}&text=${text}`;\r\n        break;\r\n      case \"wechat\":\r\n        handleCopyLink();\r\n        toast.info(t(\"common.shareVia\") + \" WeChat\");\r\n        return;\r\n      default:\r\n        return;\r\n    }\r\n    \r\n    // Use appropriate method based on environment\r\n    if (isIOSWebView()) {\r\n      window.location.href = shareUrl;\r\n    } else {\r\n      window.open(shareUrl, \"_blank\", \"width=600,height=400\");\r\n    }\r\n  }, [restaurant, localizedRestaurant, handleCopyLink, t]);\r\n\r\n  // Setup Intersection Observer for lazy loading\r\n  useEffect(() => {\r\n    const mapObserver = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting && !shouldLoadMap) {\r\n            setShouldLoadMap(true);\r\n          }\r\n        });\r\n      },\r\n      { rootMargin: \"100px\" }\r\n    );\r\n\r\n    const commentsObserver = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting && !shouldLoadComments) {\r\n            setShouldLoadComments(true);\r\n          }\r\n        });\r\n      },\r\n      { rootMargin: \"200px\" }\r\n    );\r\n\r\n    if (mapSectionRef.current) {\r\n      mapObserver.observe(mapSectionRef.current);\r\n    }\r\n    if (commentsSectionRef.current) {\r\n      commentsObserver.observe(commentsSectionRef.current);\r\n    }\r\n\r\n    return () => {\r\n      mapObserver.disconnect();\r\n      commentsObserver.disconnect();\r\n    };\r\n  }, [shouldLoadMap, shouldLoadComments]);\r\n\r\n  // Initialize map\r\n  useEffect(() => {\r\n    if (!mapContainer.current || !restaurant || !shouldLoadMap || !mapOpen) return;\r\n    \r\n    // Don't initialize if map already exists\r\n    if (map.current) return;\r\n\r\n    const token = import.meta.env.VITE_MAPBOX_TOKEN;\r\n    if (!token) {\r\n      console.warn('[RestaurantDetail Map] No Mapbox token found');\r\n      return;\r\n    }\r\n\r\n    // Check WebGL support\r\n    if (!mapboxgl.supported()) {\r\n      console.warn('[RestaurantDetail Map] WebGL not supported', {\r\n        isIOSDevice: isIOSDevice(),\r\n        isIOSWebView: isIOSWebView(),\r\n        userAgent: navigator.userAgent\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Wait for container to have dimensions\r\n    const initMap = () => {\r\n      if (!mapContainer.current) return;\r\n      \r\n      const rect = mapContainer.current.getBoundingClientRect();\r\n      \r\n      if (rect.width === 0 || rect.height === 0) {\r\n        // Retry after a short delay\r\n        setTimeout(initMap, 100);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        mapboxgl.accessToken = token;\r\n\r\n        map.current = new mapboxgl.Map({\r\n          container: mapContainer.current,\r\n          style: \"mapbox://styles/mapbox/light-v11\",\r\n          center: [restaurant.lng, restaurant.lat],\r\n          zoom: 15,\r\n          cooperativeGestures: true, // Require two fingers to pan and zoom on mobile\r\n        });\r\n\r\n        map.current.on('error', (e) => {\r\n          console.error('[RestaurantDetail Map] Map error:', e);\r\n        });\r\n\r\n        // Add custom marker with icon\r\n        const el = document.createElement('div');\r\n        el.style.backgroundImage = `url(${mapIcon})`;\r\n        el.style.width = '40px';\r\n        el.style.height = '40px';\r\n        el.style.backgroundSize = 'contain';\r\n        el.style.backgroundRepeat = 'no-repeat';\r\n        el.style.backgroundPosition = 'center';\r\n        el.style.cursor = 'pointer';\r\n\r\n        new mapboxgl.Marker({ element: el })\r\n          .setLngLat([restaurant.lng, restaurant.lat])\r\n          .addTo(map.current);\r\n\r\n        map.current.addControl(new mapboxgl.NavigationControl());\r\n      } catch (error) {\r\n        console.error('[RestaurantDetail Map] Failed to initialize map:', error);\r\n      }\r\n    };\r\n\r\n    // Small delay to ensure Collapsible animation is complete\r\n    setTimeout(initMap, 50);\r\n\r\n    return () => {\r\n      map.current?.remove();\r\n      map.current = null;\r\n    };\r\n  }, [restaurant, shouldLoadMap, mapOpen]);\r\n\r\n  // Handle map resize when toggling visibility\r\n  useEffect(() => {\r\n    if (mapOpen && map.current) {\r\n      // Wait for collapsible animation to complete before resizing\r\n      const timer = setTimeout(() => {\r\n        map.current?.resize();\r\n        // Re-center the map after resize\r\n        if (restaurant) {\r\n          map.current?.setCenter([restaurant.lng, restaurant.lat]);\r\n        }\r\n      }, 350);\r\n      \r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [mapOpen, restaurant]);\r\n\r\n  if (isLoading) {\r\n    return <RestaurantDetailSkeleton />;\r\n  }\r\n\r\n  if (!restaurant || !localizedRestaurant) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-xl text-muted-foreground\">{t(\"error.notFound\")}</p>\r\n          <Button asChild className=\"mt-4\">\r\n            <Link to={backUrl}>{t(\"common.back\")}</Link>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isGhostRestaurant = (restaurant as any).template === 'ghost';\r\n\r\n  // Ghost Restaurant - Immersive storytelling layout\r\n  if (isGhostRestaurant) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background\">\r\n        {/* Hero Section */}\r\n        <GhostRestaurantHero\r\n          restaurant={restaurant}\r\n          localizedRestaurant={localizedRestaurant}\r\n          backUrl={backUrl}\r\n          user={user}\r\n          isFavorite={isFavorite}\r\n          onToggleFavorite={handleToggleFavorite}\r\n          onShare={() => {\r\n            if (!user) {\r\n              setShowLoginDialog(true);\r\n              return;\r\n            }\r\n            if (isMobile && navigator.share) {\r\n              handleNativeShare();\r\n            } else {\r\n              handleCopyLink();\r\n            }\r\n          }}\r\n          onReport={() => {}}\r\n          showEditButton={isMerchantOfRestaurant || isAdmin}\r\n          editButton={(isMerchantOfRestaurant || isAdmin) && restaurant ? (\r\n            <RestaurantFormDialog\r\n              restaurant={restaurant}\r\n              trigger={\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  size=\"icon\"\r\n                  className=\"backdrop-blur-sm bg-background/60\"\r\n                >\r\n                  <Edit className=\"w-5 h-5\" />\r\n                </Button>\r\n              }\r\n            />\r\n          ) : null}\r\n          reportButton={restaurant ? (\r\n            <ReportDialog\r\n              targetType=\"restaurant\"\r\n              targetId={restaurant.id}\r\n              onLoginRequired={() => setShowLoginDialog(true)}\r\n              trigger={\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  size=\"icon\"\r\n                  className=\"backdrop-blur-sm bg-background/60\"\r\n                >\r\n                  <ShieldAlert className=\"w-5 h-5\" />\r\n                </Button>\r\n              }\r\n            />\r\n          ) : null}\r\n        />\r\n\r\n        {/* Story Content */}\r\n        <GhostRestaurantStory\r\n          restaurant={restaurant}\r\n          localizedRestaurant={localizedRestaurant}\r\n          restaurantActivities={restaurantActivities}\r\n          ratingCount={ratingCount}\r\n          averageRating={averageRating}\r\n          onTakeawayClick={() => setShowTakeawayDialog(true)}\r\n        />\r\n\r\n        {/* Dialogs */}\r\n        <AlertDialog open={showTakeawayDialog} onOpenChange={setShowTakeawayDialog}>\r\n          <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n            <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n            <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n              <div className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\">\r\n                <ShoppingBag className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n              </div>\r\n              <div className=\"space-y-1.5 px-1\">\r\n                <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                  {t(\"restaurant.takeawayOrderTitle\", \"外卖点餐\")}\r\n                </AlertDialogTitle>\r\n                <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                  {t(\"restaurant.takeawayDescription\", \"即将为您打开外卖订餐页面\")}\r\n                </AlertDialogDescription>\r\n              </div>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n              <AlertDialogAction\r\n                onClick={() => {\r\n                  try {\r\n                    const url = new URL(restaurant.website_url);\r\n                    url.pathname = '/table';\r\n                    if (user) {\r\n                      url.searchParams.set('user_id', user.id);\r\n                    }\r\n                    openExternalUrl(url.toString());\r\n                  } catch (e) {\r\n                    console.error('Invalid URL:', e);\r\n                  }\r\n                }}\r\n                className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n              >\r\n                {t(\"common.continue\", \"继续\")}\r\n              </AlertDialogAction>\r\n              <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                {t(\"common.cancel\")}\r\n              </AlertDialogCancel>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {/* Login Required Dialog */}\r\n        <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {t(\"activities.loginRequiredMessage\")}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n              <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n                {t(\"activities.goToLogin\")}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Regular Restaurant Layout\r\n  return (\r\n    <div className=\"min-h-screen bg-secondary/20\">\r\n      {/* Hero Image */}\r\n      <div className=\"relative h-[33vh] overflow-hidden bg-muted\">\r\n        <img\r\n          src={restaurant.cover_image_url || restaurant.image_url || \"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80\"}\r\n          alt={localizedRestaurant.name}\r\n          className=\"w-full h-full object-cover\"\r\n          loading=\"eager\"\r\n        />\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent\" />\r\n        \r\n        {/* Back Button */}\r\n        <Button\r\n          asChild\r\n          variant=\"secondary\"\r\n          size=\"icon\"\r\n          className=\"absolute top-4 left-4\"\r\n        >\r\n          <Link to={backUrl}>\r\n            <ChevronLeft className=\"w-5 h-5\" />\r\n          </Link>\r\n        </Button>\r\n\r\n        {/* Favorite Button */}\r\n        {user && (\r\n          <Button\r\n            variant=\"secondary\"\r\n            size=\"icon\"\r\n            className=\"absolute top-4 right-4\"\r\n            onClick={handleToggleFavorite}\r\n          >\r\n            <Heart className={`w-5 h-5 ${isFavorite ? 'fill-destructive text-destructive' : ''}`} />\r\n          </Button>\r\n        )}\r\n        \r\n        {/* Share Button */}\r\n        {isMobile && navigator.share ? (\r\n          <Button\r\n            variant=\"secondary\"\r\n            size=\"icon\"\r\n            className={`absolute top-4 shadow-lg ${user ? 'right-16' : 'right-4'}`}\r\n            onClick={() => {\r\n              if (!user) {\r\n                setShowLoginDialog(true);\r\n                return;\r\n              }\r\n              handleNativeShare();\r\n            }}\r\n          >\r\n            <Share2 className=\"w-5 h-5\" />\r\n          </Button>\r\n        ) : (\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className={`absolute top-4 shadow-lg ${user ? 'right-16' : 'right-4'}`}\r\n                onClick={(e) => {\r\n                  if (!user) {\r\n                    e.preventDefault();\r\n                    setShowLoginDialog(true);\r\n                  }\r\n                }}\r\n              >\r\n                <Share2 className=\"w-5 h-5\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n              {navigator.share && (\r\n                <>\r\n                  <DropdownMenuItem onClick={handleNativeShare}>\r\n                    <Share2 className=\"w-4 h-4 mr-2\" />\r\n                    {t(\"common.moreOptions\")}\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                </>\r\n              )}\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"wechat\")}>\r\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\r\n                WeChat\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"whatsapp\")}>\r\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\r\n                WhatsApp\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"facebook\")}>\r\n                <Share2 className=\"w-4 h-4 mr-2\" />\r\n                Facebook\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"twitter\")}>\r\n                <Share2 className=\"w-4 h-4 mr-2\" />\r\n                X (Twitter)\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"telegram\")}>\r\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\r\n                Telegram\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem onClick={handleCopyLink}>\r\n                <Link2 className=\"w-4 h-4 mr-2\" />\r\n                {t(\"common.copyLink\")}\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        )}\r\n        \r\n        {/* Edit Button for Merchants */}\r\n        {(isMerchantOfRestaurant || isAdmin) && restaurant && (\r\n          <RestaurantFormDialog\r\n            restaurant={restaurant}\r\n            trigger={\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className={`absolute top-4 ${user ? 'right-28' : 'right-16'}`}\r\n              >\r\n                <Edit className=\"w-5 h-5\" />\r\n              </Button>\r\n            }\r\n          />\r\n        )}\r\n        \r\n        {/* Report Button */}\r\n        {restaurant && (\r\n          <ReportDialog\r\n            targetType=\"restaurant\"\r\n            targetId={restaurant.id}\r\n            onLoginRequired={() => setShowLoginDialog(true)}\r\n            trigger={\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className={`absolute top-4 ${\r\n                  (isMerchantOfRestaurant || isAdmin) \r\n                    ? (user ? 'right-40' : 'right-28')\r\n                    : (user ? 'right-28' : 'right-16')\r\n                }`}\r\n              >\r\n                <ShieldAlert className=\"w-5 h-5\" />\r\n              </Button>\r\n            }\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12\">\r\n        <Card className=\"shadow-large\">\r\n          <CardHeader>\r\n            <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\r\n              <div>\r\n                <div className=\"mb-2 flex flex-wrap gap-2\">\r\n                  {localizedRestaurant.type.slice(0, 3).map((type, idx) => (\r\n                    <Badge key={idx} variant=\"secondary\">{type}</Badge>\r\n                  ))}\r\n                </div>\r\n                <CardTitle className=\"text-3xl mb-2\">{localizedRestaurant.name}</CardTitle>\r\n                <div className=\"flex items-center gap-3 mb-2 flex-wrap\">\r\n                  {distance !== null && (\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Navigation className=\"w-4 h-4 text-primary\" />\r\n                      <span className=\"font-semibold text-base\">{distance.toFixed(1)} km</span>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Star className={`w-5 h-5 ${ratingCount > 0 ? \"fill-accent text-accent\" : \"text-muted-foreground\"}`} />\r\n                    {ratingCount > 0 ? (\r\n                      <span className=\"font-semibold text-base\">\r\n                        {averageRating.toFixed(1)}\r\n                        <span className=\"text-muted-foreground font-normal text-sm ml-1\">({ratingCount})</span>\r\n                      </span>\r\n                    ) : (\r\n                      <span className=\"text-sm text-muted-foreground\">\r\n                        {t(\"restaurant.noRatingWithHint\")}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  {priceRangeDisplay && (\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Wallet className=\"w-4 h-4 text-primary\" />\r\n                      <span className=\"font-semibold text-base\">{priceRangeDisplay}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {localizedRestaurant.description && (\r\n                  <div \r\n                    className=\"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline\"\r\n                    dangerouslySetInnerHTML={{ __html: localizedRestaurant.description }}\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n\r\n          <CardContent className=\"space-y-6\">\r\n            {/* Contact Info */}\r\n            <div className=\"grid md:grid-cols-2 gap-4\">\r\n              {/* Activities */}\r\n              {restaurantActivities.length > 0 && (\r\n                <Collapsible\r\n                  open={activitiesOpen}\r\n                  onOpenChange={setActivitiesOpen}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <Star className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1\">\r\n                    <CollapsibleTrigger className=\"w-full\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex flex-col items-start\">\r\n                          <p className=\"font-medium text-card-foreground\">{t(\"activities.title\")}</p>\r\n                          {!activitiesOpen && (\r\n                            <div className=\"flex flex-wrap gap-1.5 mt-1\">\r\n                              {restaurantActivities.map((activity, idx) => (\r\n                                <Badge \r\n                                  key={`activity-${idx}`} \r\n                                  variant=\"default\" \r\n                                  className=\"text-white\"\r\n                                  style={{ backgroundColor: activity.badge_color || \"#9b87f5\" }}\r\n                                >\r\n                                  {getLocalizedBadgeText(activity, i18n.language)}\r\n                                </Badge>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${activitiesOpen ? 'rotate-180' : ''}`} />\r\n                      </div>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent className=\"mt-3 space-y-2\">\r\n                      {restaurantActivities.map((activity, idx) => {\r\n                        const intro = getLocalizedIntro(activity, i18n.language);\r\n                        return (\r\n                          <Link\r\n                            key={`activity-detail-${idx}`}\r\n                            to={`/activity/${activity.activity_id}`}\r\n                            className=\"block p-2 rounded-md hover:bg-muted/80 transition-colors\"\r\n                          >\r\n                            <Badge \r\n                              variant=\"default\" \r\n                              className=\"text-white mr-2\"\r\n                              style={{ backgroundColor: activity.badge_color || \"#9b87f5\" }}\r\n                            >\r\n                              {getLocalizedBadgeText(activity, i18n.language)}\r\n                            </Badge>\r\n                            <span className=\"text-sm text-muted-foreground\">\r\n                              {intro || getLocalizedActivityTitle(activity, i18n.language)} ... →\r\n                            </span>\r\n                          </Link>\r\n                        );\r\n                      })}\r\n                    </CollapsibleContent>\r\n                  </div>\r\n                </Collapsible>\r\n              )}\r\n\r\n              <div className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\">\r\n                <MapPin className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                <div>\r\n                  <p className=\"font-medium text-card-foreground\">{t(\"restaurant.address\")}</p>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <p className=\"text-muted-foreground\">{restaurant.address}</p>\r\n                    {(restaurant as any).template === 'ghost' && (\r\n                      <Badge variant=\"secondary\" className=\"text-xs\">\r\n                        {t(\"restaurants.ghostKitchen\")}\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {restaurant.phone && (\r\n                <a \r\n                  href={`tel:${restaurant.phone}`}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer\"\r\n                >\r\n                  <Phone className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div>\r\n                    <p className=\"font-medium text-card-foreground\">{t(\"restaurant.phone\")}</p>\r\n                    <p className=\"text-primary underline\">{restaurant.phone}</p>\r\n                  </div>\r\n                </a>\r\n              )}\r\n\r\n              {/* Opening Hours - Only for non-ghost restaurants */}\r\n              {restaurant.opening_hours && (restaurant as any).template !== 'ghost' && (\r\n                <Collapsible\r\n                  open={hoursOpen}\r\n                  onOpenChange={setHoursOpen}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <Clock className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1\">\r\n                    <CollapsibleTrigger className=\"w-full\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex flex-col items-start\">\r\n                          <p className=\"font-medium text-card-foreground\">{t(\"restaurant.hours\")}</p>\r\n                          {!hoursOpen && (\r\n                            <p className=\"text-sm text-muted-foreground mt-0.5\">\r\n                              {t(\"restaurant.today\")} {formatOpeningHours(restaurant.opening_hours)}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                        <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${hoursOpen ? 'rotate-180' : ''}`} />\r\n                      </div>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent className=\"mt-3\">\r\n                      <div className=\"space-y-2\">\r\n                        {(() => {\r\n                          const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];\r\n                          const dayKeys: Record<string, string> = {\r\n                            monday: 'dayMon',\r\n                            tuesday: 'dayTue',\r\n                            wednesday: 'dayWed',\r\n                            thursday: 'dayThu',\r\n                            friday: 'dayFri',\r\n                            saturday: 'daySat',\r\n                            sunday: 'daySun'\r\n                          };\r\n                          const currentDay = days[new Date().getDay() === 0 ? 6 : new Date().getDay() - 1];\r\n                          \r\n                          return days.map((day) => {\r\n                            const hours = restaurant.opening_hours[day];\r\n                            const isToday = day === currentDay;\r\n                            const displayName = t(`restaurant.${dayKeys[day]}`);\r\n                            \r\n                            let hoursText = 'N/A';\r\n                            if (hours) {\r\n                              if (hours.closed) {\r\n                                hoursText = t(\"restaurant.closed\");\r\n                              } else if (hours.splitShift) {\r\n                                hoursText = `${hours.open} - ${hours.close}, ${hours.open2} - ${hours.close2}`;\r\n                              } else {\r\n                                hoursText = `${hours.open} - ${hours.close}`;\r\n                              }\r\n                            }\r\n                            \r\n                            return (\r\n                              <div \r\n                                key={day}\r\n                                className={`flex justify-between items-center py-1.5 px-2 rounded ${\r\n                                  isToday ? 'bg-primary/10 border border-primary/20' : ''\r\n                                }`}\r\n                              >\r\n                                <span className={`text-sm font-medium ${\r\n                                  isToday ? 'text-primary' : 'text-foreground'\r\n                                }`}>\r\n                                  {displayName}\r\n                                  {isToday && <span className=\"ml-2 text-xs\">({t(\"restaurant.today\")})</span>}\r\n                                </span>\r\n                                <span className={`text-sm ${\r\n                                  isToday ? 'text-primary font-semibold' : 'text-muted-foreground'\r\n                                } ${hours?.closed ? 'italic' : ''}`}>\r\n                                  {hoursText}\r\n                                </span>\r\n                              </div>\r\n                            );\r\n                          });\r\n                        })()}\r\n                      </div>\r\n                    </CollapsibleContent>\r\n                  </div>\r\n                </Collapsible>\r\n              )}\r\n\r\n              {/* Announcement */}\r\n              {restaurant && (getLocalizedField(restaurant, \"announcement\") || restaurant.announcement_zh) && (\r\n                <Collapsible\r\n                  open={announcementOpen}\r\n                  onOpenChange={setAnnouncementOpen}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <MessageCircle className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1\">\r\n                    <CollapsibleTrigger className=\"w-full\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <p className=\"font-medium text-card-foreground\">{t(\"restaurant.announcement\")}</p>\r\n                        <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${announcementOpen ? 'rotate-180' : ''}`} />\r\n                      </div>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent className=\"mt-3\">\r\n                      <div className=\"p-3 rounded-md bg-primary/5 border border-primary/10\">\r\n                        <p className=\"text-sm text-foreground whitespace-pre-wrap\">\r\n                          {getLocalizedField(restaurant, \"announcement\") || restaurant.announcement_zh}\r\n                        </p>\r\n                      </div>\r\n                    </CollapsibleContent>\r\n                  </div>\r\n                </Collapsible>\r\n              )}\r\n            </div>\r\n\r\n            {/* Action Buttons - Hide navigation/booking for ghost restaurants */}\r\n            <div className=\"flex flex-col gap-3\">\r\n              {(restaurant as any).template !== 'ghost' && (\r\n                <Button \r\n                  variant=\"secondary\"\r\n                  className=\"w-full\"\r\n                  onClick={() => setShowNavigationDialog(true)}\r\n                >\r\n                  <Navigation className=\"w-4 h-4 mr-2\" />\r\n                  {t(\"restaurant.getDirections\")}\r\n                </Button>\r\n              )}\r\n              {restaurant.website_url && ((restaurant as any).show_takeaway_button || ((restaurant as any).show_booking_button && (restaurant as any).template !== 'ghost')) && (\r\n                <div className=\"flex gap-3\">\r\n                  {(restaurant as any).show_takeaway_button && (\r\n                    <Button \r\n                      className=\"flex-1\"\r\n                      onClick={() => setShowTakeawayDialog(true)}\r\n                    >\r\n                      <ShoppingBag className=\"w-4 h-4 mr-2\" />\r\n                      {t(\"restaurant.takeawayOrder\")}\r\n                    </Button>\r\n                  )}\r\n                  {(restaurant as any).show_booking_button && (restaurant as any).template !== 'ghost' && (\r\n                    <Button \r\n                      className=\"flex-1\"\r\n                      onClick={() => setShowBookingDialog(true)}\r\n                    >\r\n                      <CalendarDays className=\"w-4 h-4 mr-2\" />\r\n                      {t(\"restaurant.tableBooking\")}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Navigation Confirm Dialog - Glass UI Style */}\r\n            <AlertDialog open={showNavigationDialog} onOpenChange={setShowNavigationDialog}>\r\n              <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n                {/* Glass effect overlay */}\r\n                <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n                \r\n                <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n                  {/* Icon container */}\r\n                  <div \r\n                    className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\"\r\n                    style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n                  >\r\n                    <Navigation className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n                  </div>\r\n                  <div className=\"space-y-1.5 px-1\">\r\n                    <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                      {t(\"navigation.confirmTitle\")}\r\n                    </AlertDialogTitle>\r\n                    <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                      {t(\"navigation.confirmDescriptionSimple\", { destination: localizedRestaurant.name })}\r\n                    </AlertDialogDescription>\r\n                  </div>\r\n                </AlertDialogHeader>\r\n                \r\n                <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n                  <AlertDialogAction\r\n                    onClick={() => {\r\n                      openNavigation(restaurant.lat, restaurant.lng, localizedRestaurant.name);\r\n                      setShowNavigationDialog(false);\r\n                    }}\r\n                    className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n                  >\r\n                    {t(\"navigation.openNavigation\", \"获取路线\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Private Domain Confirm Dialog - Glass UI Style */}\r\n            <AlertDialog open={showPrivateDialog} onOpenChange={setShowPrivateDialog}>\r\n              <AlertDialogContent className=\"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden\">\r\n                {/* Glass effect overlay */}\r\n                <div className=\"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none\" />\r\n                \r\n                <AlertDialogHeader className=\"relative text-center pb-2\">\r\n                  {/* Icon container */}\r\n                  <div \r\n                    className=\"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0\"\r\n                    style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n                  >\r\n                    <ExternalLink className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={2} />\r\n                  </div>\r\n                  <AlertDialogTitle className=\"text-lg font-semibold text-foreground\">\r\n                    {t(\"restaurant.joinPrivateTitle\")}\r\n                  </AlertDialogTitle>\r\n                  <AlertDialogDescription className=\"text-center text-sm text-muted-foreground mt-2 leading-relaxed\">\r\n                    {t(\"restaurant.joinPrivateDescription\")}\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                \r\n                <AlertDialogFooter className=\"relative flex-col gap-2 pt-4\">\r\n                  <AlertDialogAction\r\n                    onClick={() => {\r\n                      const url = new URL(restaurant.website_url);\r\n                      if (user) {\r\n                        url.searchParams.set('user_id', user.id);\r\n                      }\r\n                      const targetUrl = url.toString();\r\n                      openExternalUrl(targetUrl);\r\n                    }}\r\n                    className=\"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200\"\r\n                  >\r\n                    {isGeneratingToken ? (\r\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                    ) : null}\r\n                    {t(\"restaurant.joinPrivateConfirm\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogCancel className=\"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200\">\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            <AlertDialog open={showTakeawayDialog} onOpenChange={setShowTakeawayDialog}>\r\n              <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n                {/* Glass effect overlay */}\r\n                <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n                \r\n                <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n                  {/* Icon container */}\r\n                  <div \r\n                    className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\"\r\n                    style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n                  >\r\n                    <ShoppingBag className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n                  </div>\r\n                  <div className=\"space-y-1.5 px-1\">\r\n                    <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                      {t(\"restaurant.takeawayOrderTitle\", \"外卖点餐\")}\r\n                    </AlertDialogTitle>\r\n                    <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                      {t(\"restaurant.takeawayDescription\", \"即将为您打开外卖订餐页面\")}\r\n                    </AlertDialogDescription>\r\n                  </div>\r\n                </AlertDialogHeader>\r\n                \r\n                <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n                  <AlertDialogAction\r\n                    onClick={() => {\r\n                      try {\r\n                        const url = new URL(restaurant.website_url);\r\n                        url.pathname = '/table';\r\n                        if (user) {\r\n                          url.searchParams.set('user_id', user.id);\r\n                        }\r\n                        openExternalUrl(url.toString());\r\n                      } catch (e) {\r\n                        console.error('Invalid URL:', e);\r\n                      }\r\n                    }}\r\n                    className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n                  >\r\n                    {t(\"common.continue\", \"继续\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            <AlertDialog open={showBookingDialog} onOpenChange={setShowBookingDialog}>\r\n              <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n                {/* Glass effect overlay */}\r\n                <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n                \r\n                <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n                  {/* Icon container */}\r\n                  <div \r\n                    className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\"\r\n                    style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n                  >\r\n                    <CalendarDays className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n                  </div>\r\n                  <div className=\"space-y-1.5 px-1\">\r\n                    <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                      {t(\"restaurant.tableBookingTitle\", \"预约订台\")}\r\n                    </AlertDialogTitle>\r\n                    <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                      {t(\"restaurant.bookingDescription\", \"即将为您打开餐位预约页面\")}\r\n                    </AlertDialogDescription>\r\n                  </div>\r\n                </AlertDialogHeader>\r\n                \r\n                <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n                  <AlertDialogAction\r\n                    onClick={() => {\r\n                      try {\r\n                        const url = new URL(restaurant.website_url);\r\n                        url.pathname = '/reservePage';\r\n                        if (user) {\r\n                          url.searchParams.set('user_id', user.id);\r\n                        }\r\n                        openExternalUrl(url.toString());\r\n                      } catch (e) {\r\n                        console.error('Invalid URL:', e);\r\n                      }\r\n                    }}\r\n                    className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n                  >\r\n                    {t(\"common.continue\", \"继续\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Dish Photo Gallery */}\r\n            <RestaurantDishGallery restaurantId={restaurant.id} showGallery={(restaurant as any).show_dish_gallery !== false} />\r\n\r\n            {/* Map - Only show for non-ghost restaurants */}\r\n            {(restaurant as any).template !== 'ghost' && (\r\n              <div ref={mapSectionRef}>\r\n                <Collapsible\r\n                  open={mapOpen}\r\n                  onOpenChange={setMapOpen}\r\n                  className=\"p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <CollapsibleTrigger className=\"w-full\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                      <h2 className=\"text-2xl font-bold\">{t(\"restaurant.map\")}</h2>\r\n                      <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${mapOpen ? 'rotate-180' : ''}`} />\r\n                    </div>\r\n                  </CollapsibleTrigger>\r\n                  <CollapsibleContent>\r\n                    {shouldLoadMap ? (\r\n                      <div ref={mapContainer} className=\"h-[350px] rounded-lg overflow-hidden bg-muted\" />\r\n                    ) : (\r\n                      <div className=\"h-[350px] rounded-lg bg-muted flex items-center justify-center\">\r\n                        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\r\n                      </div>\r\n                    )}\r\n                  </CollapsibleContent>\r\n                </Collapsible>\r\n              </div>\r\n            )}\r\n\r\n            <Separator />\r\n\r\n            {/* Rating Section */}\r\n            <RestaurantRating restaurantId={restaurant.id} />\r\n\r\n            <Separator />\r\n\r\n            {/* Comments Section */}\r\n            <div ref={commentsSectionRef}>\r\n              {shouldLoadComments ? (\r\n                <Suspense fallback={\r\n                  <div className=\"flex items-center justify-center py-12\">\r\n                    <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n                  </div>\r\n                }>\r\n                  <RestaurantComments restaurantId={restaurant.id} />\r\n                </Suspense>\r\n              ) : (\r\n                <div className=\"flex items-center justify-center py-12\">\r\n                  <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Login Required Dialog */}\r\n      <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"activities.loginRequiredMessage\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n              {t(\"activities.goToLogin\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RestaurantDetail;\r\n"],"file":"assets/RestaurantDetail-GaykW6O6.js"}