import{j as e}from"./vendor-ui-BO6fjm1h.js";import{a as Me,u as Ye,b as Ee,l as Ze,D as et,c as tt,d as st,e as at,S as Oe,M as je,f as E,U as rt,L as Te,g as nt,h as ot,i as it,j as lt,I as ct,B as Z,N as ye,F as dt,k as q,m as mt,n as ut,C as Ie,o as ze,p as we,q as Le,r as $e,E as xt,s as ht,t as pt,v as gt,w as Fe,x as Pe,y as Be,z as ft,H as bt,A as Ve,G as We,J as vt,K as yt,O as wt,P as jt}from"./index-H22t9J9U.js";import{u as qe,r as n,a as De,L as Nt}from"./vendor-react-CrHRjzzo.js";import{c as kt,g as _t,m as He}from"./geolocation-DRm3QMsJ.js";import{a as St,g as Ct}from"./app-store-badge-CyCtXXOt.js";import{u as Xe}from"./useHomepageTemplates-CEk0FUuw.js";import{u as Rt}from"./usePageView-CoBvYXTA.js";import{L as Ue}from"./LocationPermissionDialog-CLTTNLAi.js";import{u as Ne}from"./vendor-i18n-DWR4v88Y.js";import{P as Tt}from"./PullToRefresh-93kYaFg3.js";import{u as It}from"./vendor-query-EnOED-MY.js";import{P as zt,a as Lt,b as $t}from"./popover-G8f0OuDh.js";import{u as Dt,a as At}from"./useRestaurants-CDHX4Ghm.js";import{u as Mt,R as Et,l as Ot}from"./xiaoxiong-logo-clean--K0jENuo.js";import{u as Ft}from"./useLocalizedContent-S0TAoDtX.js";import{u as Pt}from"./useActivities-zXhmOWJh.js";import"./vendor-charts-C50LysBY.js";import"./vendor-supabase-QnE9GqXs.js";import"./vendor-map-hWrxZwzm.js";/* empty css                  */const Se="https://tzdgqhwyzsxkxnncgzap.supabase.co",fe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",Bt=["最近","附近","离我","距离","远近","近的","周边","周围","最近的","附近的","nearest","closest","nearby","near me","close to me","distance","around me","mais perto","próximo","perto de mim","distância","mais próximo"],Vt=()=>{const r="xiaoxiong_anonymous_user_id";let i=localStorage.getItem(r);return i||(i=`anon_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,localStorage.setItem(r,i)),i},Wt=({open:r,onOpenChange:i,provider:m="ask-xiaoxiong"})=>{const{i18n:h}=Ne(),d=qe(),{settings:R}=Me(),{user:D}=Ye(),g=Ee(),u=R?.logo_url||Ze,[j,N]=n.useState(""),[b,v]=n.useState([]),[w,k]=n.useState(!1),[f,U]=n.useState(null),[Q,G]=n.useState(!1),[M,H]=n.useState(null),[T,O]=n.useState(!1),[X,F]=n.useState(!1),I=n.useRef(null),J=n.useRef(null),c=n.useRef(null),_=n.useRef(null),ie=()=>{if(!X)return!1;const s=typeof window<"u"?window.innerWidth:1024,l=s>=768&&s<1024,t=s>=1024;return g?R?.voice_input_mobile!==!1:l?R?.voice_input_tablet!==!1:t?R?.voice_input_desktop!==!1:!0},be=()=>D?.id?D.id:Vt();n.useEffect(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;F(!!s)},[]),n.useEffect(()=>{r&&!f&&navigator.geolocation?.getCurrentPosition(s=>{U({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{console.log("Unable to get user location:",s.message)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})},[r,f]),n.useEffect(()=>{!r&&c.current&&(c.current.stop(),O(!1))},[r]),n.useEffect(()=>{_.current?.scrollIntoView({behavior:"smooth"})},[b]);const te=async(s,l)=>{const t=await fetch(`${Se}/functions/v1/ask-xiaoxiong`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${fe}`,apikey:fe},body:JSON.stringify({text:s.content,stream:!0,lat:f?.lat,lng:f?.lng}),signal:I.current?.signal});if(!t.ok)throw new Error(`Request failed with status: ${t.status}`);if(!t.body)throw new Error("No response body");const a=t.body.getReader(),o=new TextDecoder;let p="";for(;;){const{done:C,value:L}=await a.read();if(C)break;const he=o.decode(L,{stream:!0});p+=he;let $=p;$.startsWith('"')&&($=$.slice(1)),$.endsWith('"')&&($=$.slice(0,-1)),$=$.replace(/\\n/g,`
`),v(K=>K.map(V=>V.id===l?{...V,content:$}:V))}let y=p;y.startsWith('"')&&(y=y.slice(1)),y.endsWith('"')&&(y=y.slice(0,-1)),y=y.replace(/\\n/g,`
`),v(C=>C.map(L=>L.id===l?{...L,content:y,isStreaming:!1}:L))},se=async(s,l)=>{const t=be(),a=Date.now();console.log(`[前端-Agent] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const o=await fetch(`${Se}/functions/v1/xiaoxiong-agent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${fe}`,apikey:fe},body:JSON.stringify({message:s.content,userId:t}),signal:I.current?.signal}),p=Date.now()-a;if(console.log(`[前端-Agent] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${p}ms`),!o.ok)throw new Error(`Request failed with status: ${o.status}`);if(!o.body)throw new Error("No response body");const y=o.body.getReader(),C=new TextDecoder;let L="",he=!1,$=0;for(;;){const{done:K,value:V}=await y.read();if(K){console.log(`[前端-Agent] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-a}ms, 共 ${$} 个数据块`);break}$++;const W=C.decode(V,{stream:!0});if(L+=W,!he){he=!0;const oe=Date.now()-a;console.log(`[前端-Agent] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${oe}ms, 大小: ${W.length} 字符`)}De.flushSync(()=>{v(oe=>oe.map(ve=>ve.id===l?{...ve,content:L}:ve))}),await new Promise(oe=>requestAnimationFrame(oe))}v(K=>K.map(V=>V.id===l?{...V,isStreaming:!1}:V))},pe=async(s,l)=>{const t=Date.now();console.log(`[前端-LovableAI] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const a=await fetch(`${Se}/functions/v1/lovable-chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${fe}`,apikey:fe},body:JSON.stringify({message:s.content,lat:f?.lat,lng:f?.lng,language:h.language}),signal:I.current?.signal}),o=Date.now()-t;if(console.log(`[前端-LovableAI] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${o}ms`),!a.ok){const $=await a.json().catch(()=>({}));throw new Error($.error||`Request failed with status: ${a.status}`)}if(!a.body)throw new Error("No response body");const p=a.body.getReader(),y=new TextDecoder;let C="",L="",he=!1;for(;;){const{done:$,value:K}=await p.read();if($){console.log(`[前端-LovableAI] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-t}ms`);break}if(L+=y.decode(K,{stream:!0}),!he){he=!0;const W=Date.now()-t;console.log(`[前端-LovableAI] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${W}ms`)}let V;for(;(V=L.indexOf(`
`))!==-1;){let W=L.slice(0,V);if(L=L.slice(V+1),W.endsWith("\r")&&(W=W.slice(0,-1)),W.startsWith(":")||W.trim()===""||!W.startsWith("data: "))continue;const oe=W.slice(6).trim();if(oe==="[DONE]")break;try{const Re=JSON.parse(oe).choices?.[0]?.delta?.content;Re&&(C+=Re,De.flushSync(()=>{v(ke=>ke.map(_e=>_e.id===l?{..._e,content:C}:_e))}),await new Promise(ke=>requestAnimationFrame(ke)))}catch{L=W+`
`+L;break}}}v($=>$.map(K=>K.id===l?{...K,isStreaming:!1}:K))},ae=s=>{const l=s.toLowerCase();return Bt.some(t=>l.includes(t))},ee=async s=>{const l={id:Date.now().toString(),role:"user",content:s},t=(Date.now()+1).toString(),a={id:t,role:"assistant",content:"",isStreaming:!0};v(o=>[...o,l,a]),N(""),k(!0),I.current&&I.current.abort(),I.current=new AbortController;try{m==="lovable-ai"?await pe(l,t):m==="xiaoxiong-agent"?await se(l,t):await te(l,t)}catch(o){if(o instanceof Error&&o.name==="AbortError"){console.log("Request aborted");return}console.error("Ask API error:",o);const p=h.language==="zh"?"抱歉，暂时无法获取结果，请稍后再试":h.language==="pt"?"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.":"Sorry, unable to get results. Please try again later.";v(y=>y.map(C=>C.id===t?{...C,content:p,isStreaming:!1}:C))}finally{k(!1)}},le=()=>{G(!1),navigator.geolocation?.getCurrentPosition(s=>{U({lat:s.coords.latitude,lng:s.coords.longitude}),M&&setTimeout(()=>{ee(M),H(null)},100)},s=>{console.log("Location permission denied:",s.message),M&&(ee(M),H(null))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},re=async()=>{if(!j.trim()||w)return;const s=j.trim();if(!f&&ae(s)){H(s),G(!0),N("");return}await ee(s)},ce=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),re())},x=()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){console.log("Speech recognition not supported");return}c.current&&c.current.stop();const l=new s;c.current=l;const t={zh:"zh-CN",en:"en-US",pt:"pt-BR"};l.lang=t[h.language]||"zh-CN",l.continuous=!1,l.interimResults=!0,l.onstart=()=>{O(!0)},l.onresult=a=>{const o=Array.from(a.results).map(p=>p[0].transcript).join("");N(o)},l.onerror=a=>{console.log("Speech recognition error:",a.error),O(!1)},l.onend=()=>{O(!1)},l.start()},z=()=>{c.current&&(c.current.stop(),O(!1))},P=()=>{T?z():x()},S=()=>{I.current&&I.current.abort(),i(!1)},de=s=>{S(),d(s)},A=s=>{const l=/\[([^\]]+)\]\(([^)]+)\)/g,t=[];let a=0,o,p=0;for(;(o=l.exec(s))!==null;){o.index>a&&t.push(e.jsx("span",{children:s.slice(a,o.index)},p++));const y=o[1],C=o[2];C.startsWith("/")?t.push(e.jsx("button",{onClick:()=>de(C),className:"text-primary hover:underline font-medium cursor-pointer",children:y},p++)):t.push(e.jsx("a",{href:C,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:y},p++)),a=o.index+o[0].length}return a<s.length&&t.push(e.jsx("span",{children:s.slice(a)},p++)),t.length>0?t:[e.jsx("span",{children:s},"0")]},me=s=>s.replace(/\*\*(.*?)\*\*/g,"$1"),Y=(s,l=20)=>s.length<=l?s:s.slice(0,l)+"...",ge=(s,l)=>{const t=p=>p.split("|").slice(1,-1).map(y=>me(y.trim())),a=t(s[0]),o=s.slice(2).map(t);return e.jsx("div",{className:"overflow-x-auto my-2 max-w-full",children:e.jsxs("table",{className:"w-full text-xs border border-border rounded-md overflow-hidden table-fixed",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsx("tr",{children:a.map((p,y)=>e.jsx("th",{className:"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]",title:p,children:A(Y(p,15))},y))})}),e.jsx("tbody",{children:o.map((p,y)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/30 transition-colors",children:p.map((C,L)=>e.jsx("td",{className:"px-2 py-2 truncate max-w-[100px]",title:C,children:A(Y(C,18))},L))},y))})]})},l)},ne=s=>{const l=s.split(`
`),t=[];let a=0;for(;a<l.length;){const o=l[a];if(o.trim().startsWith("|")&&o.split("|").length>2){const p=[];for(;a<l.length&&l[a].trim().startsWith("|");)p.push(l[a]),a++;p.length>=2&&t.push(ge(p,t.length));continue}if(o.startsWith("### "))t.push(e.jsx("h3",{className:"text-base font-semibold mt-3 mb-1",children:A(o.slice(4))},t.length));else if(o.startsWith("## "))t.push(e.jsx("h2",{className:"text-lg font-bold mt-4 mb-2",children:A(o.slice(3))},t.length));else if(o.startsWith("# "))t.push(e.jsx("h1",{className:"text-xl font-bold mt-4 mb-2",children:A(o.slice(2))},t.length));else if(o.includes("**")){const p=o.split(/\*\*(.*?)\*\*/g);t.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:p.map((y,C)=>C%2===1?e.jsx("strong",{className:"font-semibold",children:A(y)},C):A(y))},t.length))}else o.startsWith("- ")||o.startsWith("* ")?t.push(e.jsx("li",{className:"ml-4 mb-0.5 list-disc",children:A(o.slice(2))},t.length)):/^\d+\.\s/.test(o)?t.push(e.jsx("li",{className:"ml-4 mb-0.5 list-decimal",children:A(o.replace(/^\d+\.\s/,""))},t.length)):o.match(/^[-*_]{3,}$/)?t.push(e.jsx("hr",{className:"my-3 border-border"},t.length)):o.trim()===""?t.push(e.jsx("div",{className:"h-1"},t.length)):t.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:A(o)},t.length));a++}return t},ue=()=>h.language==="zh"?"小熊AI助手":h.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant",B=()=>h.language==="zh"?"告诉小熊，你想吃什么...":h.language==="pt"?"Diga ao Xiaoxiong o que você quer comer...":"Tell Xiaoxiong what you want to eat...",xe=()=>h.language==="zh"?"你好，我是小熊，我来帮你推荐餐厅；比如：「我附近的寿司餐厅」":h.language==="pt"?"Olá, eu sou o Xiaoxiong, vou te ajudar a encontrar restaurantes; por exemplo: 「restaurantes de sushi perto de mim」":`Hi, I'm Xiaoxiong, I'll help you find restaurants; for example: "sushi restaurants near me"`;return e.jsx(et,{open:r,onOpenChange:S,children:e.jsxs(tt,{className:"w-full h-full max-w-full max-h-full sm:max-w-lg sm:h-[70vh] sm:max-h-[70vh] sm:rounded-lg rounded-none flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(st,{className:"px-4 py-3 border-b shrink-0 bg-primary/5",children:e.jsxs(at,{className:"flex items-center gap-2 text-base",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:u,alt:"Logo",className:"w-6 h-6 object-contain"})}),ue()]})}),e.jsx(Oe,{className:"flex-1 h-0",ref:J,children:e.jsxs("div",{className:"p-4 space-y-4",children:[b.length===0&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(je,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:"flex-1 bg-muted/50 rounded-2xl rounded-tl-sm px-4 py-3 text-sm",children:xe()})]}),b.map(s=>e.jsxs("div",{className:E("flex gap-3",s.role==="user"&&"flex-row-reverse"),children:[e.jsx("div",{className:E("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s.role==="user"?"bg-primary text-primary-foreground":"bg-primary/10"),children:s.role==="user"?e.jsx(rt,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsx("div",{className:E("flex-1 max-w-[85%] rounded-2xl px-4 py-3 text-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted/50 rounded-tl-sm"),children:s.role==="assistant"?e.jsxs(e.Fragment,{children:[s.content?e.jsx("div",{className:"prose-sm",children:ne(s.content)}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Te,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:h.language==="zh"?"思考中...":h.language==="pt"?"Pensando...":"Thinking..."})]}),s.isStreaming&&s.content&&e.jsx("span",{className:"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle"})]}):s.content})]},s.id)),e.jsx("div",{ref:_})]})}),e.jsx("div",{className:"p-4 bg-background shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-border/50 bg-muted/20 shadow-sm hover:shadow-md transition-shadow duration-200",children:[ie()&&e.jsx("button",{onClick:P,disabled:w,className:E("shrink-0 p-2 rounded-full transition-all duration-200 hover:bg-muted",T&&"text-destructive animate-pulse"),title:h.language==="zh"?T?"停止录音":"语音输入":h.language==="pt"?T?"Parar gravação":"Entrada de voz":T?"Stop recording":"Voice input",children:T?e.jsx(nt,{className:"h-5 w-5"}):e.jsx(ot,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{value:j,onChange:s=>N(s.target.value),onKeyDown:ce,placeholder:T?h.language==="zh"?"正在聆听...":h.language==="pt"?"Ouvindo...":"Listening...":B(),disabled:w,className:"flex-1 bg-transparent border-0 outline-none text-foreground placeholder:text-muted-foreground",autoFocus:!0}),e.jsx("button",{onClick:re,disabled:!j.trim()||w,className:E("shrink-0 p-2 rounded-full transition-all duration-200",j.trim()&&!w?"text-primary hover:bg-primary/10":"text-muted-foreground/50"),children:w?e.jsx(Te,{className:"h-5 w-5 animate-spin"}):e.jsx(it,{className:"h-5 w-5"})})]})}),e.jsx(Ue,{open:Q,onOpenChange:s=>{G(s),!s&&M&&(ee(M),H(null))},onConfirm:le})]})})},Ae=({restaurant:r,language:i})=>{const[m,h]=n.useState(999),d=n.useRef(null),R=r.type.slice(0,3).map((u,j)=>({key:`type-${j}`,label:u,variant:"secondary",color:void 0}));n.useEffect(()=>{const u=()=>{if(!d.current)return;const N=d.current,b=Array.from(N.querySelectorAll(".tag-badge"));if(b.length===0){setTimeout(u,50);return}const v=b[0]?.offsetTop;let w=b.length;for(let k=0;k<b.length;k++)if(b[k].offsetTop>v){w=k;break}w<b.length&&(w=Math.max(1,w-1)),h(w)};h(999);const j=setTimeout(u,100);return window.addEventListener("resize",u),()=>{clearTimeout(j),window.removeEventListener("resize",u)}},[R.length,r.id]);const D=R.slice(0,m),g=R.length>m;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{ref:d,className:"flex gap-1.5 flex-wrap flex-1",children:D.map(u=>e.jsx(q,{variant:u.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:u.color?{backgroundColor:u.color,color:"white"}:void 0,children:u.label},u.key))}),g&&e.jsxs(zt,{children:[e.jsx(Lt,{asChild:!0,children:e.jsx(Z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:e.jsx(xt,{className:"h-4 w-4"})})}),e.jsx($t,{className:"w-80",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(u=>e.jsx(q,{variant:u.variant,className:"text-xs font-medium",style:u.color?{backgroundColor:u.color,color:"white"}:void 0,children:u.label},u.key))})})]})]})},qt=()=>{const r=qe(),{t:i,i18n:m}=Ne(),{toast:h}=lt(),{localizeRestaurant:d}=Ft(),[R,D]=n.useState(""),[g,u]=n.useState([]),[j,N]=n.useState(null),[b,v]=n.useState([]),[w,k]=n.useState(null),[f,U]=n.useState(null),[Q,G]=n.useState(!1),[M,H]=n.useState(!1),[T,O]=n.useState(!1),X=n.useRef(null),F=n.useRef(null),I=n.useRef({}),[J,c]=n.useState(null),[_,ie]=n.useState(!1),[be,te]=n.useState(!1),[se,pe]=n.useState(!1),[ae,ee]=n.useState(!1),le=4,{data:re,isLoading:ce}=Dt(R,g.length>0?g.join(","):void 0),{data:x=[]}=At(),{data:z=[]}=Pt(),{data:P={}}=Mt(),S=z.filter(t=>(P[t.id]||0)>0),de=t=>{u(a=>a.includes(t)?a.filter(o=>o!==t):[...a,t])},A=()=>{te(!0)},me=async()=>{te(!1);try{const t=await _t();U({lat:t.coords.latitude,lng:t.coords.longitude}),h({title:i("restaurants.locationEnabled"),description:i("restaurants.sortByDistance")})}catch(t){console.error("Location error:",t)}},Y=t=>{k(t),t&&!f&&A()},ge=async t=>{if(j===t)N(null),v([]);else{N(t);const{data:a,error:o}=await ht.from("activity_restaurants").select("restaurant_id").eq("activity_id",t);o?(console.error("Error fetching activity restaurants:",o),v([])):v(a.map(p=>p.restaurant_id))}},ne=re?.map(t=>{const a=d(t);if(f){const o=kt(f.lat,f.lng,t.lat,t.lng);return{...a,distance:o}}return a})||[],ue=j?ne.filter(t=>b.includes(t.id)):ne,B=w&&f?ue.filter(t=>t.distance&&t.distance<=w).sort((t,a)=>(t.distance||0)-(a.distance||0)):f?ue.sort((t,a)=>(t.distance||0)-(a.distance||0)):ue.sort((t,a)=>(a.rating||0)-(t.rating||0)),xe=t=>{r(`/restaurant/${t.id}`)},s=t=>{c(t.id);const a=I.current[t.id];a&&a.scrollIntoView({behavior:"smooth",block:"center"})},l=()=>{const t=document.getElementById("home-map-container");if(t)if(Q)document.exitFullscreen&&document.exitFullscreen();else{if(X.current){const a=X.current.getCenter(),o=X.current.getZoom();F.current={center:[a.lng,a.lat],zoom:o}}t.requestFullscreen&&t.requestFullscreen()}};return n.useEffect(()=>{const t=()=>{const a=!!document.fullscreenElement;G(a),!a&&F.current&&X.current&&setTimeout(()=>{X.current?.jumpTo({center:F.current.center,zoom:F.current.zoom})},100)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"text-left mb-8 sm:mb-10",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-primary mb-2 sm:mb-3",children:i("nav.mapView")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:i("map.subtitle")})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(ct,{placeholder:i("restaurants.search"),value:R,onChange:t=>D(t.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),e.jsxs("div",{className:"flex gap-2 md:contents",children:[e.jsxs(Z,{variant:f?"default":"outline",onClick:f?void 0:A,className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(ye,{className:`w-4 h-4 ${f?"animate-pulse":""}`}),e.jsx("span",{className:"md:hidden",children:i("restaurants.getLocationMobile")}),e.jsx("span",{className:"hidden md:inline",children:i(f?"restaurants.locationEnabled":"restaurants.getLocation")})]}),e.jsxs(Z,{variant:_?"default":"outline",onClick:()=>ie(!_),className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(dt,{className:"w-4 h-4"}),i("restaurants.filter")]})]})]}),_&&e.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[i("restaurants.restaurantTypes"),":"]}),g.length>0&&e.jsx(q,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>u([]),children:i("common.actions.clearFilter")}),x.length>8&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>H(!M),children:i(M?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${M?"animate-expand-height":""}`,children:(M?x:x.slice(0,8)).map((t,a)=>e.jsx(q,{variant:g.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${g.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>de(t),children:t},t))}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:x.map((t,a)=>e.jsx(q,{variant:g.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${g.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>de(t),children:t},t))}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),S.length>0&&e.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[i("nav.activities"),":"]}),j&&e.jsx(q,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{N(null),v([])},children:i("common.actions.clearFilter")}),S.length>8&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>O(!T),children:i(T?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${T?"animate-expand-height":""}`,children:(T?S:S.slice(0,8)).map((t,a)=>{const o=m.language==="zh"?t.badge_text_zh||t.title_zh:m.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(q,{variant:j===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${j===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ge(t.id),children:o},t.id)})}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:S.map((t,a)=>{const o=m.language==="zh"?t.badge_text_zh||t.title_zh:m.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(q,{variant:j===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${j===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ge(t.id),children:o},t.id)})}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),f&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[i("restaurants.radius"),":"]}),e.jsx(q,{variant:w===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Y(null),children:i("restaurants.allRestaurants")}),e.jsx(q,{variant:w===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Y(5),children:i("restaurants.radius5km")}),e.jsx(q,{variant:w===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Y(10),children:i("restaurants.radius10km")}),e.jsx(q,{variant:w===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Y(20),children:i("restaurants.radius20km")})]})]}),!ce&&B&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:`w-full lg:flex-1 transition-all duration-300 ease-in-out ${se?"h-0 overflow-hidden lg:h-[500px]":"h-[400px] lg:h-[500px]"}`,children:e.jsxs("div",{id:"home-map-container",className:`${Q?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[e.jsx(Z,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:l,children:Q?e.jsx(mt,{className:"w-5 h-5"}):e.jsx(ut,{className:"w-5 h-5"})}),e.jsxs("div",{className:"h-full relative",children:[e.jsx(Et,{restaurants:B,onRestaurantClick:xe,userLocation:f,radiusFilter:w,onMarkerClick:s,showViewDetailsButton:!0,onMapInit:t=>{X.current=t}}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg",children:[e.jsx("img",{src:Ot,alt:"Xiaoxiong Market Logo",className:"h-6 w-6 object-contain"}),e.jsx("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:m.language==="zh"?"小熊市场":"Xiaoxiong Market"})]})]})]})}),e.jsx(Z,{variant:"outline",size:"sm",className:"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1",onClick:()=>pe(!se),children:se?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4"}),i("map.showMap")]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4"}),i("map.hideMap")]})}),e.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-border",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(we,{className:"w-6 h-6 text-primary"}),i("restaurants.title"),e.jsx(q,{variant:"secondary",className:"ml-2",children:B.length})]}),f&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[e.jsx(ye,{className:"w-4 h-4"}),i("restaurants.sortedByDistance")]})]}),B.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(we,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:i("restaurants.noResults")}),e.jsx("p",{className:"text-muted-foreground max-w-xs",children:i("restaurants.noResultsDesc")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden space-y-3 pb-4",children:[(ae?B:B.slice(0,le)).map(t=>e.jsx(Le,{ref:a=>I.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${J===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>xe(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx($e,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Ae,{restaurant:t,language:m.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id)),B.length>le&&e.jsx(Z,{variant:"outline",className:"w-full mt-2 gap-2",onClick:()=>ee(!ae),children:ae?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4"}),i("map.collapseList")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4"}),i("map.showAllRestaurants",{count:B.length})]})})]}),e.jsx(Oe,{className:"hidden lg:block h-[420px] pr-4",children:e.jsx("div",{className:"space-y-3 pb-4",children:B.map(t=>e.jsx(Le,{ref:a=>I.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${J===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>xe(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx($e,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Ae,{restaurant:t,language:m.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id))})})]})]})]}),e.jsx(Ue,{open:be,onOpenChange:te,onConfirm:me})]})},Je=n.memo(({stats:r,onAskXiaoxiong:i})=>{const{t:m,i18n:h}=Ne(),{data:d}=Xe(),{buttons:R}=pt(),D=h.language,g=R?.find(k=>k.label_zh==="演示"||k.link?.includes("v.xiaoxiong.pt")),u=g&&g.enabled!==!1&&g.visible!==!1&&g.show_on_mobile!==!1,j=()=>g?D==="zh"?g.label_zh:D==="pt"?g.label_pt:g.label_en:m("home.hero.demo","前往演示"),N=k=>!d||d.length===0?"":d[0][`${k}${D==="zh"?"_zh":D==="pt"?"_pt":"_en"}`]||"",b=N("title")||m("home.hero.title"),v=N("description")||m("home.hero.description"),w=N("subtitle_button_text")||m("home.hero.subtitle");return e.jsxs("section",{className:"min-h-[70vh] flex flex-col bg-secondary/20",children:[e.jsxs("div",{className:"pt-20 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-foreground",children:m("home.hero.brandName")}),e.jsx("img",{src:He,alt:"map icon",width:28,height:28,loading:"eager",decoding:"async",className:"w-7 h-7 object-contain flex-shrink-0"})]}),u&&g&&e.jsxs(Z,{variant:"outline",size:"sm",className:"gap-1.5 text-xs",onClick:()=>window.open(g.link,"_blank"),children:[e.jsx(gt,{className:"w-3.5 h-3.5"}),j()]})]}),r&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Fe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:r.order_count})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:r.reserve_count})]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground leading-tight",children:b}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto",children:v}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:i,className:"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 cursor-text border border-border/50 mx-auto",children:[e.jsx(je,{className:"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors"}),e.jsx("span",{className:"text-sm text-muted-foreground group-hover:text-foreground transition-colors",children:w}),e.jsx(Be,{className:"w-4 h-4 text-muted-foreground/60 ml-2"})]})})]})})]})});Je.displayName="MobileHeroSection";const Ce="/images/sushi-ramen-hero.jpg",Ke="/images/sushi-ramen-mobile.jpg",Qe=n.memo(({stats:r,t:i})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:i("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:r.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:i("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:r.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:i("home.hero.brandName")}),e.jsx("img",{src:He,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));Qe.displayName="StatsDisplay";const Ht=()=>{const r=window.innerWidth<640,i=window.innerWidth>=1024,m=navigator.connection,h=We(),d=Ve();return i?!!m?.saveData:!!(d&&!h||m&&(m.saveData||m.effectiveType==="2g"||m.effectiveType==="slow-2g")||r&&navigator.deviceMemory&&navigator.deviceMemory<2)},Ge=n.memo(({template:r,isActive:i,currentLang:m,t:h,onContentReady:d,onAskXiaoxiong:R})=>{const[D,g]=n.useState({}),[u,j]=n.useState({}),[N,b]=n.useState({}),[v,w]=n.useState({mobile:!0,tablet:!0,desktop:!0}),[k,f]=n.useState(!1),U=Ht(),Q=n.useRef(null),G=n.useRef(null),M=n.useRef(null),H=x=>r[`${x}${m==="zh"?"_zh":m==="pt"?"_pt":"_en"}`]||"",T=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",O=()=>{const x=T();return x==="mobile"&&r.mobile_overlay_opacity!==null?r.mobile_overlay_opacity:x==="tablet"&&r.tablet_overlay_opacity!==null?r.tablet_overlay_opacity:x==="desktop"&&r.desktop_overlay_opacity!==null?r.desktop_overlay_opacity:r.overlay_opacity??30},X=()=>{const x=O(),z=r.overlay_gradient_direction||"to-b",P=(s,l)=>s==null?l/100:s>1?s/100:s,S=x>1?x/100:x,de=P(r.overlay_gradient_from_opacity,30)*S,A=P(r.overlay_gradient_via_opacity,25)*S,me=P(r.overlay_gradient_to_opacity,40)*S,ge={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[z]||"to bottom",ne={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},ue=ne[r.overlay_gradient_from||"black"]||"0, 0, 0",B=ne[r.overlay_gradient_via||"black"]||"0, 0, 0",xe=ne[r.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${ge}, rgba(${ue}, ${de}), rgba(${B}, ${A}), rgba(${xe}, ${me}))`}},F=r.mobile_image_url||Ke,I=r.tablet_image_url||r.desktop_image_url||Ce,J=r.desktop_image_url||Ce,c=r.background_blur||0,_=r.desktop_media_type||r.media_type||"image",ie=r.tablet_media_type||r.media_type||"image",be=r.mobile_media_type||r.media_type||"image",te=_==="video"&&!U,se=ie==="video"&&!U,pe=be==="video"&&!U,ae=pe?r.mobile_video_url:null,ee=se?r.tablet_video_url||r.desktop_video_url:null,le=te?r.desktop_video_url:null;n.useEffect(()=>{const x=T(),z=x==="mobile"?F:x==="tablet"?I:J;if(z){const P=new Image;P.onload=()=>{g(S=>({...S,[x]:!0})),w(S=>({...S,[x]:!0})),i&&(d?.(),setTimeout(()=>f(!0),100))},P.src=z}},[F,I,J,i,d]),n.useEffect(()=>{i&&D[T()]&&f(!0)},[i,D]);const re=x=>{j(z=>({...z,[x]:!0}))},ce=(x,z)=>{console.error(`[HeroSlide] Video error on ${x}:`,z),b(P=>({...P,[x]:!0}))};return n.useEffect(()=>{if(!k||!i||!jt())return;const z=T(),S=(z==="mobile"?Q:z==="tablet"?G:M).current;if(!S)return;const A=setTimeout(async()=>{try{S.muted=!0,S.playsInline=!0,S.setAttribute("webkit-playsinline","true"),await S.play(),console.log(`[HeroSlide] iOS video play successful on ${z}`)}catch(me){console.error(`[HeroSlide] iOS video play failed on ${z}:`,me),b(Y=>({...Y,[z]:!0}))}},150);return()=>clearTimeout(A)},[k,i]),e.jsxs("div",{className:E("absolute inset-0 w-full h-full transition-opacity duration-1000",i?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!v.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),pe&&ae?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:F,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",u.mobile&&!N.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:c>0?`blur(${c}px)`:void 0}}),k&&!N.mobile&&e.jsx("video",{ref:Q,src:ae,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("mobile"),onError:x=>ce("mobile",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:c>0?`blur(${c}px)`:void 0}})]}):e.jsx("img",{src:F,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",v.mobile?"opacity-100":"opacity-0"),style:{filter:c>0?`blur(${c}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!v.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),se&&ee?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:I,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",u.tablet&&!N.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:c>0?`blur(${c}px)`:void 0}}),k&&!N.tablet&&e.jsx("video",{ref:G,src:ee,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("tablet"),onError:x=>ce("tablet",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:c>0?`blur(${c}px)`:void 0}})]}):e.jsx("img",{src:I,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",v.tablet?"opacity-100":"opacity-0"),style:{filter:c>0?`blur(${c}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!v.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),te&&le?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:J,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",u.desktop&&!N.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:c>0?`blur(${c}px)`:void 0}}),k&&!N.desktop&&e.jsx("video",{ref:M,src:le,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("desktop"),onError:x=>ce("desktop",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:c>0?`blur(${c}px)`:void 0}})]}):e.jsx("img",{src:J,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:E("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",v.desktop?"opacity-100":"opacity-0"),style:{filter:c>0?`blur(${c}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:X()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:H("title")||h("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:H("description")||h("home.hero.description")}),r.subtitle_button_text_zh&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:R,className:"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40",children:[e.jsx(je,{className:"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm"}),e.jsx("span",{className:"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium",children:H("subtitle_button_text")||h("home.hero.subtitle")}),e.jsx(Be,{className:"w-4 h-4 text-white/60 ml-2 drop-shadow-sm"})]})})]})})]})});Ge.displayName="HeroSlide";const us=()=>{const{t:r,i18n:i}=Ne(),m=It(),{settings:h}=Me(),{data:d,isLoading:R,refetch:D}=Xe(),[g,u]=n.useState(0),[j,N]=n.useState(null),b=n.useRef(null),[v,w]=n.useState(!1),[k,f]=n.useState(!1),U=Ee(),{isWebView:Q}=ft(),G=U||Q,M=h?.ai_assistant_enabled!==!1,H=h?.ai_provider||"ask-xiaoxiong",T=n.useCallback(()=>{w(!0)},[]);Rt({pageType:"home"});const O=n.useCallback(async()=>{try{const _=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();_&&N({order_count:_.order_count||0,reserve_count:_.reserve_count||0})}catch(c){console.error("Failed to fetch stats:",c)}},[]);n.useEffect(()=>{O()},[O]);const X=n.useCallback(async()=>{await Promise.all([D(),O(),m.invalidateQueries({queryKey:["restaurants"]}),m.invalidateQueries({queryKey:["activities"]})])},[D,O,m]);n.useEffect(()=>{if(!d||d.length<=1)return;const _=d[g]?.duration||5e3;return b.current=setTimeout(()=>{u(ie=>(ie+1)%d.length)},_),()=>{b.current&&clearTimeout(b.current)}},[d,g]);const F=n.useCallback(c=>{b.current&&clearTimeout(b.current),u(c)},[]);n.useCallback(()=>{d&&(b.current&&clearTimeout(b.current),u(c=>(c-1+d.length)%d.length))},[d]),n.useCallback(()=>{d&&(b.current&&clearTimeout(b.current),u(c=>(c+1)%d.length))},[d]);const I=i.language,J=d&&d.length>1;return e.jsx(Tt,{onRefresh:X,children:e.jsxs("div",{className:"min-h-screen",children:[G?e.jsx(Je,{stats:j,onAskXiaoxiong:()=>f(!0)}):e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[j&&e.jsx(Qe,{stats:j,t:r}),e.jsx("div",{className:E("absolute inset-0 w-full h-full transition-opacity duration-500",v?"opacity-100":"opacity-0"),children:d?.map((c,_)=>e.jsx(Ge,{template:c,isActive:_===g,currentLang:I,t:r,onContentReady:_===0?T:void 0,onAskXiaoxiong:()=>f(!0)},c.id))}),e.jsx("div",{className:E("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",R||!v?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(bt,{})}),!R&&(!d||d.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:Ke,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:Ce,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:r("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:r("home.hero.description")})]})})]}),J&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:d.map((c,_)=>e.jsx("button",{onClick:()=>F(_),className:E("w-3 h-3 rounded-full transition-all duration-300",_===g?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${_+1}`},_))})]}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx(qt,{})})}),!Ve()&&!We()&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 bg-gradient-to-br from-primary/5 via-background to-primary/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-72 h-72 bg-primary/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 right-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:r("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:r("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:St,alt:"Download on the App Store",className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Ct,alt:"Get it on Google Play",className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(yt,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:r("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:r("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:r("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Z,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(Nt,{to:"/join-us",children:[e.jsx(wt,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),r("home.cta.button")]})})})]})]}),M&&e.jsx(Wt,{open:k,onOpenChange:f,provider:H})]})})};export{us as default};
//# sourceMappingURL=Home-NY5tIrth.js.map
