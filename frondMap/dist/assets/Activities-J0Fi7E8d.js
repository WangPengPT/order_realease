import{j as e}from"./vendor-ui-BO6fjm1h.js";import{r as j,u as S,L as y}from"./vendor-react-CrHRjzzo.js";import{$ as t,u as D,j as I,B as b,a6 as L,s as _,q as z,k as h,aw as w,K as P,ax as B,ay as F,a0 as T,a1 as q,az as R,a8 as $,aA as M,aB as E,aC as H,aD as U,a2 as K}from"./index-DPt6srxb.js";import{u as Q,a as G}from"./useActivities-BVrK1Gn7.js";import{u as J}from"./useActivityRealtime-EexrmD0x.js";import{u as O}from"./useLocalizedContent-S0TAoDtX.js";import{u as V}from"./useInfiniteScroll-1jvSebPK.js";import{l as C}from"./xiaoxiong-logo-v3-D2n3VLi4.js";import{u as k,i as c}from"./vendor-i18n-DWR4v88Y.js";import{P as W}from"./PullToRefresh-eghfMZXi.js";import{u as X}from"./vendor-query-EnOED-MY.js";import{f as A}from"./format-BKpO4UHC.js";import"./vendor-charts-C50LysBY.js";import"./vendor-supabase-QnE9GqXs.js";import"./startOfDay-Dg24GAz-.js";const Y=({count:a=4})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:Array.from({length:a}).map((r,l)=>e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden bg-card",children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"w-full h-48 sm:h-56 rounded-none"}),e.jsx(t,{className:"absolute top-3 left-3 h-6 w-20 rounded-full"})]}),e.jsxs("div",{className:"p-4 sm:p-5",children:[e.jsx(t,{className:"h-7 w-3/4 mb-2"}),e.jsx(t,{className:"h-4 w-48 mb-3"}),e.jsx(t,{className:"h-4 w-full mb-1"}),e.jsx(t,{className:"h-4 w-5/6 mb-4"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(t,{className:"h-5 w-24"}),e.jsx(t,{className:"h-5 w-20"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{className:"h-9 flex-1 rounded-md"}),e.jsx(t,{className:"h-9 w-9 rounded-md"}),e.jsx(t,{className:"h-9 w-9 rounded-md"})]})]})]},l))}),Z=({activityId:a,initialSubscribed:r=!1})=>{const{t:l}=k(),{user:d}=D(),{toast:m}=I(),[n,u]=j.useState(r),[g,i]=j.useState(!1);j.useEffect(()=>{u(r)},[r]);const f=async p=>{if(p.preventDefault(),p.stopPropagation(),!d){m({title:l("activities.signInToSubscribe")||"请先登录",description:l("activities.signInToSubscribeDesc")||"您需要登录才能订阅活动",variant:"destructive"});return}i(!0);const x=n;u(!x);try{if(x){const{error:o}=await _.from("subscriptions").delete().eq("activity_id",a).eq("user_id",d.id);if(o)throw o;m({title:c.t("toast.unsubscribed"),description:c.t("toast.unsubscribedDesc")})}else{const{error:o}=await _.from("subscriptions").insert({activity_id:a,user_id:d.id});if(o)throw o;m({title:c.t("toast.subscribed"),description:c.t("toast.subscribedDesc")})}}catch{u(x),m({title:c.t("common.error"),description:c.t("toast.subscriptionFailed"),variant:"destructive"})}finally{i(!1)}};return e.jsx(b,{variant:n?"default":"outline",size:"icon",onClick:f,disabled:g,title:l(n?"activities.favorited":"activities.favorite"),className:"transition-all duration-200",children:e.jsx(L,{className:`w-4 h-4 transition-all duration-200 ${n?"fill-current":""}`})})},ee=a=>{if(!a)return"";const r=c.language;return r==="zh"?a.name:r==="pt"?a.name_pt||a.name_en||a.name:a.name_en||a.name},pe=()=>{const{t:a}=k();D();const{localizeActivity:r}=O(),l=S(),d=X();J();const{data:m,isLoading:n}=Q(),{data:u=[]}=G(),g=u.map(s=>s.activity_id),i=m?.filter(s=>s.status==="published"&&s.visible===!0),{displayedData:f,hasMore:p,loadMore:x}=V({data:i,initialItemsPerPage:6,incrementPerPage:6}),o=j.useCallback(async()=>{await d.invalidateQueries({queryKey:["activities"]})},[d]);return e.jsx(W,{onRefresh:o,children:e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2 text-primary",children:a("activities.title")}),e.jsx("p",{className:"text-muted-foreground text-lg",children:a("activities.description")})]}),n&&e.jsx(Y,{count:4}),!n&&(!i||i.length===0)&&e.jsx("div",{className:"text-center py-20",children:e.jsx("p",{className:"text-xl text-muted-foreground",children:a("activities.noActivities")||"No activities available"})}),!n&&i&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:f.map(s=>{const N=r(s);return e.jsx(z,{className:"overflow-hidden hover:shadow-large transition-shadow flex flex-col h-full",children:e.jsxs(y,{to:`/activity/${s.id}`,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-48 overflow-hidden",children:[s.media_type==="video"&&s.video_url?e.jsx("video",{src:s.video_url,poster:s.image_url||void 0,className:"w-full h-full object-cover transition-transform hover:scale-105",muted:!0,loop:!0,playsInline:!0,autoPlay:!0}):e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",alt:N.title,className:"w-full h-full object-cover transition-transform hover:scale-105"}),s.pinned&&e.jsx(h,{className:"absolute top-3 left-3 bg-accent",children:a("activities.pinned")}),s.service_type&&e.jsxs(h,{className:"absolute bottom-3 left-3 flex items-center gap-1",variant:"secondary",children:[s.service_type==="dine_in"&&e.jsx(w,{className:"w-3 h-3"}),s.service_type==="takeaway"&&e.jsx(P,{className:"w-3 h-3"}),s.service_type==="both"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-3 h-3"}),e.jsx(P,{className:"w-3 h-3"})]}),a(`activities.serviceType.${s.service_type}`)]}),s.end_date&&new Date(s.end_date)<new Date?e.jsx(h,{className:"absolute top-3 right-3 bg-secondary",children:a("activities.ended")}):e.jsxs("div",{className:"absolute top-3 right-3 flex gap-1.5",children:[s.subscriber_count!==void 0&&e.jsxs(h,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),e.jsx("span",{children:s.subscriber_count})]}),s.share_count!==void 0&&s.share_count>0&&e.jsxs(h,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),e.jsx("span",{children:s.share_count})]})]})]}),e.jsx(T,{children:e.jsx("h3",{className:"text-xl font-semibold text-card-foreground line-clamp-2",children:N.title})}),e.jsxs(q,{className:"space-y-3 flex-1",children:[e.jsx("div",{className:`text-muted-foreground text-sm line-clamp-3\r
                          [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-foreground\r
                          [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:text-foreground\r
                          [&_h3]:text-sm [&_h3]:font-medium [&_h3]:text-foreground\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_p]:my-1\r
                          [&_ul]:list-disc [&_ul]:ml-4\r
                          [&_ol]:list-decimal [&_ol]:ml-4\r
                          [&_*]:!text-inherit`,dangerouslySetInnerHTML:{__html:N.content}}),s.start_date&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:A(new Date(s.start_date),"PPP")})]}),s.end_date&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{children:[a("activities.until")," ",A(new Date(s.end_date),"PPP")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:a("activities.creatorLabel")}),s.creator?.isAdmin?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:C,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:a("activities.createdByPlatform")})]}):s.creator?.restaurant?e.jsxs("div",{className:"flex items-center gap-1 cursor-pointer",onClick:v=>{v.preventDefault(),v.stopPropagation(),l(`/restaurant/${s.creator.restaurant.id}`)},children:[s.creator.avatar_url?e.jsxs(E,{className:"w-4 h-4",children:[e.jsx(H,{src:s.creator.avatar_url,alt:"Creator"}),e.jsx(U,{className:"text-[8px]",children:s.creator.restaurant.name.charAt(0)})]}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-medium",children:s.creator.restaurant.name.charAt(0)})}),e.jsx("span",{className:"text-primary font-medium hover:underline",children:ee(s.creator.restaurant)})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:C,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:a("activities.createdByPlatform")})]})]})]}),e.jsxs(K,{className:"gap-2",children:[e.jsx(b,{asChild:!0,className:"flex-1",children:e.jsx("span",{children:a("activities.viewDetails")})}),e.jsx(Z,{activityId:s.id,initialSubscribed:g.includes(s.id)})]})]})},s.id)})}),p&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs(b,{onClick:x,size:"lg",variant:"outline",children:[a("common.loadMore")," (",f.length," / ",i.length,")"]})})]})]})})})};export{pe as default};
//# sourceMappingURL=Activities-J0Fi7E8d.js.map
