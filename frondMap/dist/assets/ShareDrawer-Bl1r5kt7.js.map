{"version":3,"file":"ShareDrawer-Bl1r5kt7.js","sources":["../../src/lib/share.ts","../../src/components/ShareDrawer.tsx"],"sourcesContent":["import { isIOSWebView, isAndroidWebView, isInWebView } from \"./externalLinks\";\r\n\r\nexport interface ShareData {\r\n  title: string;\r\n  text?: string;\r\n  url: string;\r\n}\r\n\r\nexport interface SmartShareResult {\r\n  success: boolean;\r\n  needsDrawer: boolean;\r\n  method: \"native\" | \"drawer\" | \"clipboard\";\r\n}\r\n\r\n// Check if Web Share API is supported\r\nexport const supportsNativeShare = (): boolean => {\r\n  return (\r\n    typeof navigator !== \"undefined\" &&\r\n    !!navigator.share &&\r\n    typeof navigator.canShare === \"function\"\r\n  );\r\n};\r\n\r\n// Check if we should show the custom share drawer\r\n// In WebView environments, we directly copy to clipboard instead of showing drawer\r\nexport const shouldShowShareDrawer = (): boolean => {\r\n  // Never show drawer in WebView - we copy directly instead\r\n  if (isIOSWebView() || isAndroidWebView()) {\r\n    return false;\r\n  }\r\n  // In normal browsers, also don't need drawer since we use native share or fallback\r\n  return false;\r\n};\r\n\r\n// Smart share function that chooses the best method\r\nexport const smartShare = async (data: ShareData): Promise<SmartShareResult> => {\r\n  // In WebView environments, directly copy to clipboard (can't open other apps)\r\n  if (isIOSWebView() || isAndroidWebView()) {\r\n    try {\r\n      await navigator.clipboard.writeText(data.url);\r\n      return {\r\n        success: true,\r\n        needsDrawer: false,\r\n        method: \"clipboard\",\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Clipboard copy failed:\", error);\r\n      return {\r\n        success: false,\r\n        needsDrawer: false,\r\n        method: \"clipboard\",\r\n      };\r\n    }\r\n  }\r\n\r\n  // Try native share if supported\r\n  if (supportsNativeShare()) {\r\n    try {\r\n      const shareData = {\r\n        title: data.title,\r\n        text: data.text || data.title,\r\n        url: data.url,\r\n      };\r\n\r\n      if (navigator.canShare && navigator.canShare(shareData)) {\r\n        await navigator.share(shareData);\r\n        return {\r\n          success: true,\r\n          needsDrawer: false,\r\n          method: \"native\",\r\n        };\r\n      }\r\n    } catch (error) {\r\n      // If user cancelled, still return success (no error toast needed)\r\n      if ((error as Error).name === \"AbortError\") {\r\n        return {\r\n          success: true,\r\n          needsDrawer: false,\r\n          method: \"native\",\r\n        };\r\n      }\r\n      console.error(\"Native share failed:\", error);\r\n    }\r\n  }\r\n\r\n  // Fallback: copy to clipboard\r\n  try {\r\n    await navigator.clipboard.writeText(data.url);\r\n    return {\r\n      success: true,\r\n      needsDrawer: false,\r\n      method: \"clipboard\",\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Clipboard copy failed:\", error);\r\n    return {\r\n      success: false,\r\n      needsDrawer: true,\r\n      method: \"drawer\",\r\n    };\r\n  }\r\n};\r\n\r\n// Platform share configurations\r\nexport type SharePlatform =\r\n  | \"wechat\"\r\n  | \"whatsapp\"\r\n  | \"telegram\"\r\n  | \"weibo\"\r\n  | \"xiaohongshu\"\r\n  | \"instagram\"\r\n  | \"facebook\"\r\n  | \"twitter\"\r\n  | \"line\";\r\n\r\ninterface PlatformConfig {\r\n  name: string;\r\n  nameZh: string;\r\n  icon: string;\r\n  color: string;\r\n  // URL scheme to open native app (used in WebView)\r\n  getSchemeUrl?: (url: string, text: string) => string;\r\n  // Universal link / web URL (fallback)\r\n  getWebUrl?: (url: string, text: string) => string;\r\n  requiresCopy: boolean;\r\n}\r\n\r\nexport const platformConfigs: Record<SharePlatform, PlatformConfig> = {\r\n  wechat: {\r\n    name: \"WeChat\",\r\n    nameZh: \"微信\",\r\n    icon: \"wechat\",\r\n    color: \"#07C160\",\r\n    // WeChat doesn't support URL scheme for sharing external content\r\n    requiresCopy: true,\r\n  },\r\n  whatsapp: {\r\n    name: \"WhatsApp\",\r\n    nameZh: \"WhatsApp\",\r\n    icon: \"whatsapp\",\r\n    color: \"#25D366\",\r\n    // URL scheme for native app\r\n    getSchemeUrl: (url, text) =>\r\n      `whatsapp://send?text=${encodeURIComponent(text + \" \" + url)}`,\r\n    // Universal link fallback\r\n    getWebUrl: (url, text) =>\r\n      `https://wa.me/?text=${encodeURIComponent(text + \" \" + url)}`,\r\n    requiresCopy: false,\r\n  },\r\n  telegram: {\r\n    name: \"Telegram\",\r\n    nameZh: \"Telegram\",\r\n    icon: \"telegram\",\r\n    color: \"#0088CC\",\r\n    getSchemeUrl: (url, text) =>\r\n      `tg://msg_url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`,\r\n    getWebUrl: (url, text) =>\r\n      `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`,\r\n    requiresCopy: false,\r\n  },\r\n  weibo: {\r\n    name: \"Weibo\",\r\n    nameZh: \"微博\",\r\n    icon: \"weibo\",\r\n    color: \"#E6162D\",\r\n    getSchemeUrl: (url, text) =>\r\n      `sinaweibo://share?content=${encodeURIComponent(text + \" \" + url)}`,\r\n    getWebUrl: (url, text) =>\r\n      `https://service.weibo.com/share/share.php?url=${encodeURIComponent(url)}&title=${encodeURIComponent(text)}`,\r\n    requiresCopy: false,\r\n  },\r\n  xiaohongshu: {\r\n    name: \"Xiaohongshu\",\r\n    nameZh: \"小红书\",\r\n    icon: \"xiaohongshu\",\r\n    color: \"#FE2C55\",\r\n    // Xiaohongshu doesn't support URL scheme for sharing\r\n    requiresCopy: true,\r\n  },\r\n  instagram: {\r\n    name: \"Instagram\",\r\n    nameZh: \"Instagram\",\r\n    icon: \"instagram\",\r\n    color: \"#E4405F\",\r\n    // Instagram doesn't support URL scheme for sharing\r\n    requiresCopy: true,\r\n  },\r\n  facebook: {\r\n    name: \"Facebook\",\r\n    nameZh: \"Facebook\",\r\n    icon: \"facebook\",\r\n    color: \"#1877F2\",\r\n    getSchemeUrl: (url) =>\r\n      `fb://share/?link=${encodeURIComponent(url)}`,\r\n    getWebUrl: (url) =>\r\n      `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,\r\n    requiresCopy: false,\r\n  },\r\n  twitter: {\r\n    name: \"X\",\r\n    nameZh: \"X\",\r\n    icon: \"twitter\",\r\n    color: \"#000000\",\r\n    getSchemeUrl: (url, text) =>\r\n      `twitter://post?message=${encodeURIComponent(text + \" \" + url)}`,\r\n    getWebUrl: (url, text) =>\r\n      `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`,\r\n    requiresCopy: false,\r\n  },\r\n  line: {\r\n    name: \"LINE\",\r\n    nameZh: \"LINE\",\r\n    icon: \"line\",\r\n    color: \"#00B900\",\r\n    getSchemeUrl: (url, text) =>\r\n      `line://msg/text/${encodeURIComponent(text + \" \" + url)}`,\r\n    getWebUrl: (url) =>\r\n      `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}`,\r\n    requiresCopy: false,\r\n  },\r\n};\r\n\r\n// Share to a specific platform - tries to open native app directly\r\nexport const shareToPlatform = async (\r\n  platform: SharePlatform,\r\n  url: string,\r\n  text: string\r\n): Promise<{ success: boolean; copied: boolean }> => {\r\n  const config = platformConfigs[platform];\r\n\r\n  if (config.requiresCopy) {\r\n    try {\r\n      await navigator.clipboard.writeText(url);\r\n      return { success: true, copied: true };\r\n    } catch (error) {\r\n      console.error(\"Copy failed:\", error);\r\n      return { success: false, copied: false };\r\n    }\r\n  }\r\n\r\n  // In regular browsers, try URL scheme first to open native app directly\r\n  if (config.getSchemeUrl) {\r\n    const schemeUrl = config.getSchemeUrl(url, text);\r\n    const webUrl = config.getWebUrl?.(url, text);\r\n    \r\n    // Try to open native app with timeout fallback\r\n    const start = Date.now();\r\n    let didNavigate = false;\r\n    \r\n    const handleVisibilityChange = () => {\r\n      if (document.hidden) {\r\n        didNavigate = true;\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    \r\n    // Attempt to open via URL scheme\r\n    window.location.href = schemeUrl;\r\n    \r\n    // If we don't navigate away after 1.5s, fall back to web URL\r\n    setTimeout(() => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      \r\n      if (!didNavigate && webUrl && Date.now() - start >= 1500) {\r\n        // Open in new window as fallback\r\n        window.open(webUrl, \"_blank\", \"noopener,noreferrer,width=600,height=400\");\r\n      }\r\n    }, 1500);\r\n    \r\n    return { success: true, copied: false };\r\n  }\r\n\r\n  // Fallback to web URL in new window\r\n  const webUrl = config.getWebUrl?.(url, text);\r\n  if (webUrl) {\r\n    window.open(webUrl, \"_blank\", \"noopener,noreferrer,width=600,height=400\");\r\n    return { success: true, copied: false };\r\n  }\r\n\r\n  return { success: false, copied: false };\r\n};\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { toast } from \"sonner\";\r\nimport { Copy, X, Link2 } from \"lucide-react\";\r\nimport {\r\n  Drawer,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerTitle,\r\n  DrawerClose,\r\n} from \"@/components/ui/drawer\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  ShareData,\r\n  SharePlatform,\r\n  platformConfigs,\r\n  shareToPlatform,\r\n  smartShare,\r\n  shouldShowShareDrawer,\r\n} from \"@/lib/share\";\r\nimport { isInWebView } from \"@/lib/externalLinks\";\r\n\r\n// Platform icons as SVG components\r\nconst WeChatIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178 1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.722.722 0 0 1 .598.082l1.584.926a.272.272 0 0 0 .14.045c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.582.582 0 0 1-.023-.156.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.03-.406-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982z\" />\r\n  </svg>\r\n);\r\n\r\nconst WhatsAppIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\" />\r\n  </svg>\r\n);\r\n\r\nconst TelegramIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z\" />\r\n  </svg>\r\n);\r\n\r\nconst WeiboIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M10.098 20.323c-3.977.391-7.414-1.406-7.672-4.02-.259-2.609 2.759-5.047 6.74-5.441 3.979-.394 7.413 1.404 7.671 4.018.259 2.6-2.759 5.049-6.739 5.443zM9.05 17.219c-.384.616-1.208.884-1.829.602-.612-.279-.793-.991-.406-1.593.379-.595 1.176-.861 1.793-.601.622.263.82.972.442 1.592zm1.27-1.627c-.141.237-.449.353-.689.253-.236-.09-.313-.361-.177-.586.138-.227.436-.346.672-.24.239.09.315.36.18.573h.014zm.176-2.719c-1.893-.493-4.033.45-4.857 2.118-.836 1.704-.026 3.591 1.886 4.21 1.983.64 4.318-.341 5.132-2.179.8-1.793-.201-3.642-2.161-4.149zm7.563-1.224c-.346-.105-.581-.175-.402-.635.392-1.044.434-1.94.006-2.581-.8-1.199-2.994-1.134-5.512-.033 0 0-.79.345-.588-.283.39-1.24.332-2.277-.275-2.88-1.379-1.371-5.053.05-8.206 3.176C.196 11.63-.762 14.574.406 16.856c2.213 4.345 8.026 6.985 13.553 6.17 7.313-1.074 9.145-5.893 9.145-5.893.812-1.467-.134-2.244-2.545-3.084zm.937-6.365c-1.293-1.433-3.197-1.996-4.988-1.586l-.002.016c-.259.055-.529.133-.784.225-.256.087-.471.345-.381.663.094.346.419.548.764.452.079-.022.157-.052.236-.081 2.102-.722 4.749.373 5.349 2.863.116.48.083 1.002-.019 1.522-.035.185-.083.368-.14.545-.11.345.046.727.403.825.337.092.696-.114.801-.455.088-.293.163-.601.217-.919.253-1.482-.075-3.104-1.456-4.07z\" />\r\n  </svg>\r\n);\r\n\r\nconst XiaohongshuIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm4.5 16.5h-9v-1.5h9v1.5zm0-3h-9V12h9v1.5zm0-3h-9V9h9v1.5zm0-3h-9V6h9v1.5z\" />\r\n  </svg>\r\n);\r\n\r\nconst InstagramIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.757-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z\" />\r\n  </svg>\r\n);\r\n\r\nconst FacebookIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\" />\r\n  </svg>\r\n);\r\n\r\nconst TwitterIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\" />\r\n  </svg>\r\n);\r\n\r\nconst LineIcon = () => (\r\n  <svg viewBox=\"0 0 24 24\" className=\"w-6 h-6\" fill=\"currentColor\">\r\n    <path d=\"M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.105.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314\" />\r\n  </svg>\r\n);\r\n\r\nconst platformIcons: Record<SharePlatform, React.FC> = {\r\n  wechat: WeChatIcon,\r\n  whatsapp: WhatsAppIcon,\r\n  telegram: TelegramIcon,\r\n  weibo: WeiboIcon,\r\n  xiaohongshu: XiaohongshuIcon,\r\n  instagram: InstagramIcon,\r\n  facebook: FacebookIcon,\r\n  twitter: TwitterIcon,\r\n  line: LineIcon,\r\n};\r\n\r\n// Ordered platforms for display (only used in normal browsers)\r\nconst orderedPlatforms: SharePlatform[] = [\r\n  \"wechat\",\r\n  \"whatsapp\",\r\n  \"telegram\",\r\n  \"weibo\",\r\n  \"xiaohongshu\",\r\n  \"instagram\",\r\n  \"facebook\",\r\n  \"twitter\",\r\n  \"line\",\r\n];\r\n\r\ninterface ShareDrawerProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  shareData: ShareData;\r\n  onShareComplete?: () => void;\r\n}\r\n\r\nexport const ShareDrawer = ({\r\n  open,\r\n  onOpenChange,\r\n  shareData,\r\n  onShareComplete,\r\n}: ShareDrawerProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const isZh = i18n.language === \"zh\";\r\n  const inWebView = isInWebView();\r\n\r\n  const handlePlatformClick = async (platform: SharePlatform) => {\r\n    const config = platformConfigs[platform];\r\n    const result = await shareToPlatform(platform, shareData.url, shareData.title);\r\n\r\n    if (result.copied) {\r\n      const platformName = isZh ? config.nameZh : config.name;\r\n      toast.success(\r\n        t(\"sharing.copiedForPlatform\", {\r\n          platform: platformName,\r\n          defaultValue: `链接已复制，请打开${platformName}粘贴分享`,\r\n        })\r\n      );\r\n    }\r\n\r\n    onShareComplete?.();\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleCopyLink = async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(shareData.url);\r\n      toast.success(t(\"common.linkCopied\", \"链接已复制\"));\r\n      onShareComplete?.();\r\n      onOpenChange(false);\r\n    } catch (error) {\r\n      console.error(\"Copy failed:\", error);\r\n      toast.error(t(\"common.shareError\", \"分享失败\"));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Drawer open={open} onOpenChange={onOpenChange}>\r\n      <DrawerContent className=\"max-h-[85vh]\">\r\n        <DrawerHeader className=\"relative pb-2\">\r\n          <DrawerTitle className=\"text-center\">\r\n            {inWebView \r\n              ? t(\"sharing.copyToShare\", \"复制链接分享\") \r\n              : t(\"sharing.shareTitle\", \"分享到\")\r\n            }\r\n          </DrawerTitle>\r\n          <DrawerClose asChild>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              className=\"absolute right-4 top-4\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </Button>\r\n          </DrawerClose>\r\n        </DrawerHeader>\r\n\r\n        <div className=\"px-4 pb-6\">\r\n          {/* WebView hint */}\r\n          {inWebView && (\r\n            <p className=\"text-sm text-muted-foreground text-center mb-4\">\r\n              {t(\"sharing.webviewHint\", \"请选择应用，链接将自动复制\")}\r\n            </p>\r\n          )}\r\n\r\n          {/* Platform grid */}\r\n          <div className=\"grid grid-cols-4 gap-4 mb-6\">\r\n            {orderedPlatforms.map((platform) => {\r\n              const config = platformConfigs[platform];\r\n              const IconComponent = platformIcons[platform];\r\n              return (\r\n                <button\r\n                  key={platform}\r\n                  onClick={() => handlePlatformClick(platform)}\r\n                  className=\"flex flex-col items-center gap-2 p-2 rounded-lg hover:bg-muted transition-colors\"\r\n                >\r\n                  <div\r\n                    className=\"w-12 h-12 rounded-full flex items-center justify-center text-white\"\r\n                    style={{ backgroundColor: config.color }}\r\n                  >\r\n                    <IconComponent />\r\n                  </div>\r\n                  <span className=\"text-xs text-muted-foreground\">\r\n                    {isZh ? config.nameZh : config.name}\r\n                  </span>\r\n                </button>\r\n              );\r\n            })}\r\n          </div>\r\n\r\n          {/* Copy link button */}\r\n          <Button\r\n            variant=\"outline\"\r\n            className=\"w-full\"\r\n            onClick={handleCopyLink}\r\n          >\r\n            <Copy className=\"w-4 h-4 mr-2\" />\r\n            {t(\"common.copyLink\", \"复制链接\")}\r\n          </Button>\r\n        </div>\r\n      </DrawerContent>\r\n    </Drawer>\r\n  );\r\n};\r\n// Hook for smart sharing\r\nexport const useSmartShare = () => {\r\n  const [showDrawer, setShowDrawer] = useState(false);\r\n  const [shareData, setShareData] = useState<ShareData | null>(null);\r\n  const { t } = useTranslation();\r\n\r\n  const share = async (data: ShareData, onComplete?: () => void) => {\r\n    const result = await smartShare(data);\r\n\r\n    if (result.needsDrawer) {\r\n      setShareData(data);\r\n      setShowDrawer(true);\r\n      return;\r\n    }\r\n\r\n    if (result.success) {\r\n      if (result.method === \"clipboard\") {\r\n        toast.success(t(\"common.linkCopied\", \"链接已复制\"));\r\n      } else if (result.method === \"native\") {\r\n        toast.success(t(\"common.shareSuccess\", \"分享成功\"));\r\n      }\r\n      onComplete?.();\r\n    }\r\n  };\r\n\r\n  const DrawerComponent = shareData ? (\r\n    <ShareDrawer\r\n      open={showDrawer}\r\n      onOpenChange={setShowDrawer}\r\n      shareData={shareData}\r\n    />\r\n  ) : null;\r\n\r\n  return {\r\n    share,\r\n    showDrawer,\r\n    setShowDrawer,\r\n    DrawerComponent,\r\n  };\r\n};\r\n\r\nexport default ShareDrawer;\r\n"],"names":["supportsNativeShare","smartShare","data","isIOSWebView","isAndroidWebView","error","shareData","platformConfigs","url","text","shareToPlatform","platform","config","schemeUrl","webUrl","start","didNavigate","handleVisibilityChange","WeChatIcon","jsx","WhatsAppIcon","TelegramIcon","WeiboIcon","XiaohongshuIcon","InstagramIcon","FacebookIcon","TwitterIcon","LineIcon","platformIcons","orderedPlatforms","ShareDrawer","open","onOpenChange","onShareComplete","t","i18n","useTranslation","isZh","inWebView","isInWebView","handlePlatformClick","platformName","toast","handleCopyLink","Drawer","jsxs","DrawerContent","DrawerHeader","DrawerTitle","DrawerClose","Button","X","IconComponent","Copy","useSmartShare","showDrawer","setShowDrawer","useState","setShareData","onComplete","result"],"mappings":"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"}