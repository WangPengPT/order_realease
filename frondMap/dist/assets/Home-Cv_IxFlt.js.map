{"version":3,"mappings":"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","names":["AskXiaoxiongDialog","open","onOpenChange","i18n","useTranslation","navigate","useNavigate","isMobile","useIsMobile","settings","useSiteSettings","logoUrl","provider","input","setInput","messages","isLoading","showLocationDialog","setShowLocationDialog","pendingMessage","setPendingMessage","handleSubmit","handleKeyDown","handleLocationConfirm","processMessage","abortRequest","requestLocation","useXiaoxiongChat","useEffect","handleClose","getTitle","jsx","Dialog","jsxs","DialogContent","DialogHeader","DialogTitle","XiaoxiongChatContent","MobileHeroSection","memo","stats","onAskXiaoxiong","t","templates","useActiveHomepageTemplates","buttons","useNavigationSettings","currentLang","showExternalLinkDialog","setShowExternalLinkDialog","useState","showAboutUsButton","demoButton","btn","getLocalizedText","field","title","description","chatButtonText","handleConfirmExternalLink","openExternalUrl","mapIcon","Link","Info","ShoppingBag","CalendarCheck","MessageCircle","Search","ExternalLinkConfirmDialog","isDateRangeArray","value","item","isActivityValidOnDate","activity","targetDate","startDate","startOfDay","endDate","target","isSameDay","targetWeekday","getDay","targetDayOfMonth","getDate","monthRanges","range","targetMonth","getMonth","targetDay","yearlyMonth","yearlyDay","getActivitySortWeight","useRecentActivities","activities","useActivities","recentActivities","useMemo","today","tomorrow","addDays","dayAfterTomorrow","filterAndSort","date","a","b","weightDiff","allRecentActivities","seen","combined","useResponsiveCount","count","setCount","updateCount","width","ActivityCard","dayLabel","getLocalizedField","useLocalizedContent","serviceTypeLabel","handleClick","Card","Calendar","Badge","cn","UtensilsCrossed","Fragment","LoadingSkeleton","displayCount","_","i","Skeleton","RecentActivitiesSection","hasActivities","showAll","setShowAll","getDayLabel","dayKey","displayedActivities","hasMore","Button","ArrowRight","sushiRamenHero","sushiRamenMobile","HomeMapSection","lazy","StatsDisplay","useLightweightMode","getWindowWidth","getConnection","getDeviceMemory","windowWidth","isDesktop","connection","isCapacitor","isWebView","isCapacitorApp","isInWebView","e","deviceMemory","HeroSlide","template","isActive","onContentReady","postersLoaded","setPostersLoaded","videosReady","setVideosReady","videoErrors","setVideoErrors","imagesLoaded","setImagesLoaded","shouldLoadVideo","setShouldLoadVideo","isLightweight","mobileVideoRef","useRef","tabletVideoRef","desktopVideoRef","getDeviceType","getOverlayOpacity","deviceType","getOverlayStyle","baseOpacity","direction","normalizeOpacity","defaultValue","normalizedBaseOpacity","fromOpacity","viaOpacity","toOpacity","cssDirection","colorMap","fromColor","viaColor","toColor","mobileImg","tabletImg","desktopImg","blurAmount","desktopMediaType","tabletMediaType","mobileMediaType","isDesktopVideo","isTabletVideo","isMobileVideo","mobileVideo","tabletVideo","desktopVideo","currentImage","img","prev","handleVideoCanPlay","device","handleVideoError","error","isIOS","isIOSDevice","video","timer","err","Home","queryClient","useQueryClient","siteSettings","isLoadingTemplates","refetchTemplates","currentIndex","setCurrentIndex","setStats","timerRef","firstSlideReady","setFirstSlideReady","askDialogOpen","setAskDialogOpen","isNativeApp","useEnvironment","showMobileLayout","shouldHideAppDownload","isAIAssistantEnabled","handleContentReady","useCallback","usePageView","fetchStats","result","handleRefresh","duration","goToSlide","index","showControls","PullToRefresh","HomeSkeleton","Suspense","Smartphone","appStoreBadge","googlePlayBadge","Download","Store"],"ignoreList":[],"sources":["../../src/components/AskXiaoxiongDialog.tsx","../../src/components/MobileHeroSection.tsx","../../src/hooks/useRecentActivities.ts","../../src/components/RecentActivitiesSection.tsx","../../src/pages/Home.tsx"],"sourcesContent":["import { useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { useXiaoxiongChat, Provider } from \"@/hooks/useXiaoxiongChat\";\r\nimport XiaoxiongChatContent from \"@/components/XiaoxiongChatContent\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\n\r\ninterface AskXiaoxiongDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst AskXiaoxiongDialog = ({ open, onOpenChange }: AskXiaoxiongDialogProps) => {\r\n  const { i18n } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const isMobile = useIsMobile();\r\n  const { settings } = useSiteSettings();\r\n  const logoUrl = settings?.logo_url;\r\n  \r\n  // Use provider from site settings, fallback to xiaoxiong-community (consistent with AskXiaoxiong page)\r\n  const provider = (settings?.ai_provider || \"xiaoxiong-community\") as Provider;\r\n  \r\n  const {\r\n    input,\r\n    setInput,\r\n    messages,\r\n    isLoading,\r\n    showLocationDialog,\r\n    setShowLocationDialog,\r\n    pendingMessage,\r\n    setPendingMessage,\r\n    handleSubmit,\r\n    handleKeyDown,\r\n    handleLocationConfirm,\r\n    processMessage,\r\n    abortRequest,\r\n    requestLocation,\r\n  } = useXiaoxiongChat(provider);\r\n\r\n  // On mobile, redirect to full page instead of dialog\r\n  useEffect(() => {\r\n    if (open && isMobile) {\r\n      onOpenChange(false);\r\n      navigate(\"/ask-xiaoxiong\");\r\n    }\r\n  }, [open, isMobile, navigate, onOpenChange]);\r\n\r\n  // Request location on dialog open\r\n  useEffect(() => {\r\n    if (open && !isMobile) {\r\n      requestLocation();\r\n    }\r\n  }, [open, isMobile, requestLocation]);\r\n\r\n  // Cleanup on close\r\n  const handleClose = () => {\r\n    abortRequest();\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const getTitle = () => {\r\n    if (i18n.language === \"zh\") return \"小熊AI助手\";\r\n    if (i18n.language === \"pt\") return \"Assistente IA Xiaoxiong\";\r\n    return \"Xiaoxiong AI Assistant\";\r\n  };\r\n\r\n  // Don't render dialog on mobile (will redirect to page)\r\n  if (isMobile) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-2xl sm:h-[90vh] sm:max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden\">\r\n        <DialogHeader className=\"px-4 py-3 shrink-0 border-b\">\r\n          <DialogTitle className=\"text-base font-semibold flex items-center gap-2\">\r\n            {logoUrl && <img src={logoUrl} alt=\"Logo\" className=\"w-8 h-8 rounded-full object-cover\" />}\r\n            {getTitle()}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex-1 min-h-0 flex flex-col overflow-hidden\">\r\n          <XiaoxiongChatContent\r\n            messages={messages}\r\n            input={input}\r\n            setInput={setInput}\r\n            isLoading={isLoading}\r\n            showLocationDialog={showLocationDialog}\r\n            setShowLocationDialog={setShowLocationDialog}\r\n            pendingMessage={pendingMessage}\r\n            handleSubmit={handleSubmit}\r\n            handleKeyDown={handleKeyDown}\r\n            handleLocationConfirm={handleLocationConfirm}\r\n            processMessage={processMessage}\r\n            setPendingMessage={setPendingMessage}\r\n            onClose={handleClose}\r\n            showBackButton={false}\r\n            showHeader={false}\r\n            className=\"flex-1\"\r\n          />\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AskXiaoxiongDialog;\r\n","import { memo, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { ShoppingBag, CalendarCheck, MessageCircle, Search, Info } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport { useActiveHomepageTemplates } from \"@/hooks/useHomepageTemplates\";\r\nimport { useNavigationSettings } from \"@/hooks/useNavigationSettings\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { openExternalUrl } from \"@/lib/externalLinks\";\r\nimport ExternalLinkConfirmDialog from \"@/components/ExternalLinkConfirmDialog\";\r\n\r\ninterface MobileHeroSectionProps {\r\n  stats: { order_count: number; reserve_count: number } | null;\r\n  onAskXiaoxiong: () => void;\r\n}\r\n\r\nconst MobileHeroSection = memo(({ stats, onAskXiaoxiong }: MobileHeroSectionProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { data: templates } = useActiveHomepageTemplates();\r\n  const { buttons } = useNavigationSettings();\r\n  const { settings } = useSiteSettings();\r\n  const currentLang = i18n.language;\r\n  \r\n  // State for external link confirmation dialog\r\n  const [showExternalLinkDialog, setShowExternalLinkDialog] = useState(false);\r\n  \r\n  // Check if About Us button should be shown\r\n  const showAboutUsButton = settings?.about_us_button_mobile !== false;\r\n\r\n  // Find demo button from navigation settings\r\n  const demoButton = buttons?.find(\r\n    (btn) => btn.label_zh === \"演示\" || btn.link?.includes(\"v.xiaoxiong.pt\")\r\n  );\r\n\r\n  // Check if demo button should be shown\r\n  const showDemoButton = demoButton && \r\n    demoButton.enabled !== false && \r\n    demoButton.visible !== false && \r\n    demoButton.show_on_mobile !== false;\r\n\r\n  // Get localized demo button label\r\n  const getDemoLabel = () => {\r\n    if (!demoButton) return t(\"home.hero.demo\", \"前往演示\");\r\n    if (currentLang === \"zh\") return demoButton.label_zh;\r\n    if (currentLang === \"pt\") return demoButton.label_pt;\r\n    return demoButton.label_en;\r\n  };\r\n\r\n  // Get localized text from active template\r\n  const getLocalizedText = (field: string) => {\r\n    if (!templates || templates.length === 0) return \"\";\r\n    const template = templates[0];\r\n    const langSuffix = currentLang === \"zh\" ? \"_zh\" : currentLang === \"pt\" ? \"_pt\" : \"_en\";\r\n    return (template as any)[`${field}${langSuffix}`] || \"\";\r\n  };\r\n\r\n  const title = getLocalizedText(\"title\") || t(\"home.hero.title\");\r\n  const description = getLocalizedText(\"description\") || t(\"home.hero.description\");\r\n  const chatButtonText = getLocalizedText(\"subtitle_button_text\") || t(\"home.hero.subtitle\");\r\n\r\n  // Handle demo button click - show confirmation dialog\r\n  const handleDemoClick = () => {\r\n    setShowExternalLinkDialog(true);\r\n  };\r\n\r\n  // Handle confirmation - open external URL with iOS WebView compatibility\r\n  const handleConfirmExternalLink = () => {\r\n    if (demoButton?.link) {\r\n      openExternalUrl(demoButton.link);\r\n    }\r\n    setShowExternalLinkDialog(false);\r\n  };\r\n\r\n  return (\r\n    <section className=\"min-h-[55vh] flex flex-col bg-secondary/20\">\r\n      {/* Header Area - Brand + Demo Button */}\r\n      <div className=\"pt-20 px-4\">\r\n        {/* Top Row: Brand Name + Demo Button */}\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          {/* Brand Name with Icon */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-xl font-bold text-foreground\">\r\n              {t(\"home.hero.brandName\")}\r\n            </span>\r\n            <img \r\n              src={mapIcon} \r\n              alt=\"map icon\" \r\n              width={28}\r\n              height={28}\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className=\"w-7 h-7 object-contain flex-shrink-0\" \r\n            />\r\n          </div>\r\n\r\n          {/* About Us Button */}\r\n          {showAboutUsButton && (\r\n            <Link\r\n              to=\"/about-us\"\r\n              className=\"flex items-center gap-1 px-2 py-1 text-xs bg-background/80 backdrop-blur-sm rounded-full border border-border/50 shadow-sm hover:bg-background transition-colors whitespace-nowrap flex-shrink-0\"\r\n            >\r\n              <Info className=\"w-3.5 h-3.5 text-primary flex-shrink-0\" />\r\n              <span className=\"text-foreground/80\">\r\n                {t(\"nav.aboutUs\", \"关于我们\")}\r\n              </span>\r\n            </Link>\r\n          )}\r\n        </div>\r\n\r\n        {/* Stats Row: Delivery + Booking */}\r\n        {stats && (\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <ShoppingBag className=\"w-4 h-4 text-primary\" />\r\n              <span className=\"text-sm text-muted-foreground\">{t(\"home.stats.delivery\")}</span>\r\n              <span className=\"font-bold text-foreground text-sm\">{stats.order_count}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <CalendarCheck className=\"w-4 h-4 text-accent\" />\r\n              <span className=\"text-sm text-muted-foreground\">{t(\"home.stats.reservation\")}</span>\r\n              <span className=\"font-bold text-foreground text-sm\">{stats.reserve_count}</span>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Content Area - Title, Description, Chat Button */}\r\n      <div className=\"flex-1 flex flex-col items-center justify-center px-4 py-8\">\r\n        <div className=\"max-w-md mx-auto text-center space-y-4\">\r\n          {/* Title */}\r\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground leading-tight\">\r\n            {title}\r\n          </h1>\r\n          \r\n          {/* Description */}\r\n          <p className=\"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto\">\r\n            {description}\r\n          </p>\r\n          \r\n          {/* Chat Button - Ask Xiaoxiong */}\r\n          <div className=\"pt-4\">\r\n            <button \r\n              onClick={onAskXiaoxiong}\r\n              className=\"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 cursor-text border border-border/50 mx-auto\"\r\n            >\r\n              <MessageCircle className=\"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors\" />\r\n              <span className=\"text-sm text-muted-foreground group-hover:text-foreground transition-colors\">\r\n                {chatButtonText}\r\n              </span>\r\n              <Search className=\"w-4 h-4 text-muted-foreground/60 ml-2\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* External Link Confirmation Dialog */}\r\n      <ExternalLinkConfirmDialog\r\n        open={showExternalLinkDialog}\r\n        onOpenChange={setShowExternalLinkDialog}\r\n        onConfirm={handleConfirmExternalLink}\r\n        url={demoButton?.link}\r\n      />\r\n    </section>\r\n  );\r\n});\r\n\r\nMobileHeroSection.displayName = \"MobileHeroSection\";\r\n\r\nexport default MobileHeroSection;\r\n","import { useMemo } from \"react\";\r\nimport { useActivities, Activity, ActivityCreator } from \"@/hooks/useActivities\";\r\nimport { addDays, isSameDay, getDay, getDate, getMonth, startOfDay } from \"date-fns\";\r\n\r\n// Extended Activity type with creator\r\ntype ActivityWithExtras = Activity & { creator: ActivityCreator; share_count?: number };\r\n\r\ninterface DateRange {\r\n  start: number;\r\n  end: number;\r\n}\r\n\r\n// Type guard to check if value is a valid DateRange array\r\nconst isDateRangeArray = (value: unknown): value is DateRange[] => {\r\n  if (!value || !Array.isArray(value)) return false;\r\n  return value.every(item => \r\n    typeof item === 'object' && \r\n    item !== null &&\r\n    'start' in item && \r\n    'end' in item &&\r\n    typeof item.start === 'number' &&\r\n    typeof item.end === 'number'\r\n  );\r\n};\r\n\r\n// Check if activity is valid on a specific date\r\nconst isActivityValidOnDate = (activity: ActivityWithExtras, targetDate: Date): boolean => {\r\n  const startDate = startOfDay(new Date(activity.start_date));\r\n  const endDate = activity.end_date ? startOfDay(new Date(activity.end_date)) : null;\r\n  const target = startOfDay(targetDate);\r\n  \r\n  // Check if within valid period\r\n  if (target < startDate) return false;\r\n  if (endDate && target > endDate) return false;\r\n  \r\n  const repeatMode = activity.repeat_mode || \"none\";\r\n  \r\n  switch (repeatMode) {\r\n    case \"none\":\r\n      // Only valid on start date\r\n      return isSameDay(startDate, target);\r\n      \r\n    case \"daily\":\r\n      // Valid every day\r\n      return true;\r\n      \r\n    case \"weekly\":\r\n      // Check weekday (0-6, Sunday = 0)\r\n      const targetWeekday = getDay(target);\r\n      // Need to fetch repeat_weekday from the raw data\r\n      const weekday = (activity as any).repeat_weekday;\r\n      return weekday === targetWeekday;\r\n      \r\n    case \"monthly\":\r\n      // Check day of month ranges\r\n      const targetDayOfMonth = getDate(target);\r\n      const monthRanges = (activity as any).repeat_month_day;\r\n      if (!isDateRangeArray(monthRanges)) return false;\r\n      return monthRanges.some(range => \r\n        targetDayOfMonth >= range.start && targetDayOfMonth <= range.end\r\n      );\r\n      \r\n    case \"yearly\":\r\n      // Check month and day of year\r\n      const targetMonth = getMonth(target) + 1; // 1-12\r\n      const targetDay = getDate(target);\r\n      const yearlyMonth = (activity as any).repeat_yearly_month;\r\n      const yearlyDay = (activity as any).repeat_yearly_day;\r\n      return yearlyMonth === targetMonth && yearlyDay === targetDay;\r\n             \r\n    default:\r\n      return false;\r\n  }\r\n};\r\n\r\n// Get sort weight for activity (lower = higher priority)\r\nconst getActivitySortWeight = (activity: ActivityWithExtras): number => {\r\n  const repeatMode = activity.repeat_mode || \"none\";\r\n  switch (repeatMode) {\r\n    case \"none\": return 0;      // Dated activities first\r\n    case \"weekly\": return 1;\r\n    case \"monthly\": return 2;\r\n    case \"yearly\": return 3;\r\n    case \"daily\": return 4;     // Daily activities last\r\n    default: return 5;\r\n  }\r\n};\r\n\r\nexport interface ActivityWithDayLabel extends ActivityWithExtras {\r\n  dayLabel: \"today\" | \"tomorrow\" | \"dayAfterTomorrow\";\r\n}\r\n\r\nexport const useRecentActivities = () => {\r\n  const { data: activities, isLoading } = useActivities();\r\n  \r\n  const recentActivities = useMemo(() => {\r\n    if (!activities) return { today: [], tomorrow: [], dayAfterTomorrow: [] };\r\n    \r\n    const today = new Date();\r\n    const tomorrow = addDays(today, 1);\r\n    const dayAfterTomorrow = addDays(today, 2);\r\n    \r\n    const filterAndSort = (date: Date): ActivityWithExtras[] => {\r\n      return activities\r\n        .filter(a => a.visible && a.status === \"published\")\r\n        .filter(a => isActivityValidOnDate(a, date))\r\n        .sort((a, b) => {\r\n          // Sort by type weight first\r\n          const weightDiff = getActivitySortWeight(a) - getActivitySortWeight(b);\r\n          if (weightDiff !== 0) return weightDiff;\r\n          \r\n          // Then by pinned and sort_order\r\n          if (a.pinned !== b.pinned) return a.pinned ? -1 : 1;\r\n          return (a.sort_order || 0) - (b.sort_order || 0);\r\n        });\r\n    };\r\n    \r\n    return {\r\n      today: filterAndSort(today),\r\n      tomorrow: filterAndSort(tomorrow),\r\n      dayAfterTomorrow: filterAndSort(dayAfterTomorrow),\r\n    };\r\n  }, [activities]);\r\n  \r\n  // Combine all recent activities (deduplicated, with day label)\r\n  const allRecentActivities = useMemo((): ActivityWithDayLabel[] => {\r\n    const seen = new Set<string>();\r\n    const combined: ActivityWithDayLabel[] = [];\r\n    \r\n    // Add today's activities\r\n    recentActivities.today.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"today\" });\r\n      }\r\n    });\r\n    \r\n    // Add tomorrow's activities\r\n    recentActivities.tomorrow.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"tomorrow\" });\r\n      }\r\n    });\r\n    \r\n    // Add day after tomorrow's activities\r\n    recentActivities.dayAfterTomorrow.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"dayAfterTomorrow\" });\r\n      }\r\n    });\r\n    \r\n    // Sort combined list\r\n    return combined.sort((a, b) => {\r\n      const weightDiff = getActivitySortWeight(a) - getActivitySortWeight(b);\r\n      if (weightDiff !== 0) return weightDiff;\r\n      if (a.pinned !== b.pinned) return a.pinned ? -1 : 1;\r\n      return (a.sort_order || 0) - (b.sort_order || 0);\r\n    });\r\n  }, [recentActivities]);\r\n  \r\n  return {\r\n    recentActivities,\r\n    allRecentActivities,\r\n    isLoading,\r\n    hasActivities: allRecentActivities.length > 0,\r\n  };\r\n};\r\n","import { memo, useMemo, useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { ArrowRight, Calendar, UtensilsCrossed, ShoppingBag } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { useRecentActivities, ActivityWithDayLabel } from \"@/hooks/useRecentActivities\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Get responsive display count based on window width\r\nconst useResponsiveCount = () => {\r\n  const [count, setCount] = useState(4);\r\n  \r\n  useEffect(() => {\r\n    const updateCount = () => {\r\n      const width = window.innerWidth;\r\n      if (width < 640) {\r\n        setCount(2);\r\n      } else if (width < 1024) {\r\n        setCount(3);\r\n      } else {\r\n        setCount(4);\r\n      }\r\n    };\r\n    \r\n    updateCount();\r\n    window.addEventListener(\"resize\", updateCount);\r\n    return () => window.removeEventListener(\"resize\", updateCount);\r\n  }, []);\r\n  \r\n  return count;\r\n};\r\n\r\n// Activity Card Component\r\nconst ActivityCard = memo(({ \r\n  activity, \r\n  dayLabel \r\n}: { \r\n  activity: ActivityWithDayLabel; \r\n  dayLabel: string;\r\n}) => {\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  const title = getLocalizedField(activity, \"title\");\r\n  \r\n  const serviceTypeLabel = useMemo(() => {\r\n    switch (activity.service_type) {\r\n      case \"dine_in\":\r\n        return t(\"activities.serviceType.dine_in\");\r\n      case \"takeaway\":\r\n        return t(\"activities.serviceType.takeaway\");\r\n      case \"both\":\r\n        return t(\"activities.serviceType.both\");\r\n      default:\r\n        return \"\";\r\n    }\r\n  }, [activity.service_type, t]);\r\n  \r\n  const handleClick = () => {\r\n    navigate(`/activity/${activity.id}`);\r\n  };\r\n  \r\n  return (\r\n    <Card \r\n      className=\"group cursor-pointer overflow-hidden hover:shadow-lg transition-all duration-300 border-border/50 bg-card\"\r\n      onClick={handleClick}\r\n    >\r\n      {/* Image Container */}\r\n      <div className=\"relative aspect-[16/10] overflow-hidden bg-muted\">\r\n        {activity.image_url ? (\r\n          <img \r\n            src={activity.image_url} \r\n            alt={title}\r\n            className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n            loading=\"lazy\"\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5\">\r\n            <Calendar className=\"w-12 h-12 text-primary/40\" />\r\n          </div>\r\n        )}\r\n        \r\n        {/* Day Badge */}\r\n        <Badge \r\n          className={cn(\r\n            \"absolute top-2 left-2 text-xs font-medium\",\r\n            dayLabel === t(\"home.recentActivities.today\") \r\n              ? \"bg-primary text-primary-foreground\" \r\n              : \"bg-secondary text-secondary-foreground\"\r\n          )}\r\n        >\r\n          {dayLabel}\r\n        </Badge>\r\n        \r\n        {/* Pinned Badge */}\r\n        {activity.pinned && (\r\n          <Badge \r\n            className=\"absolute top-2 right-2 text-xs bg-accent text-accent-foreground\"\r\n          >\r\n            {t(\"activities.pinned\")}\r\n          </Badge>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className=\"p-3 space-y-2\">\r\n        <h3 className=\"font-medium text-sm leading-tight line-clamp-2 text-foreground group-hover:text-primary transition-colors\">\r\n          {title}\r\n        </h3>\r\n        \r\n        <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n          {activity.service_type === \"dine_in\" && (\r\n            <UtensilsCrossed className=\"w-3 h-3 flex-shrink-0\" />\r\n          )}\r\n          {activity.service_type === \"takeaway\" && (\r\n            <ShoppingBag className=\"w-3 h-3 flex-shrink-0\" />\r\n          )}\r\n          {activity.service_type === \"both\" && (\r\n            <>\r\n              <UtensilsCrossed className=\"w-3 h-3 flex-shrink-0\" />\r\n              <ShoppingBag className=\"w-3 h-3 flex-shrink-0\" />\r\n            </>\r\n          )}\r\n          <span className=\"truncate\">{serviceTypeLabel}</span>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n});\r\nActivityCard.displayName = \"ActivityCard\";\r\n\r\n// Loading Skeleton\r\nconst LoadingSkeleton = memo(() => {\r\n  const displayCount = useResponsiveCount();\r\n  \r\n  return (\r\n    <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n      {Array.from({ length: displayCount }).map((_, i) => (\r\n        <Card key={i} className=\"overflow-hidden\">\r\n          <Skeleton className=\"aspect-[16/10] w-full\" />\r\n          <div className=\"p-3 space-y-2\">\r\n            <Skeleton className=\"h-4 w-full\" />\r\n            <Skeleton className=\"h-3 w-2/3\" />\r\n          </div>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\nLoadingSkeleton.displayName = \"LoadingSkeleton\";\r\n\r\n// Main Component\r\nconst RecentActivitiesSection = memo(() => {\r\n  const { t } = useTranslation();\r\n  const { allRecentActivities, isLoading, hasActivities } = useRecentActivities();\r\n  const displayCount = useResponsiveCount();\r\n  const [showAll, setShowAll] = useState(false);\r\n  \r\n  // Get day label for display\r\n  const getDayLabel = (dayKey: \"today\" | \"tomorrow\" | \"dayAfterTomorrow\") => {\r\n    switch (dayKey) {\r\n      case \"today\":\r\n        return t(\"home.recentActivities.today\");\r\n      case \"tomorrow\":\r\n        return t(\"home.recentActivities.tomorrow\");\r\n      case \"dayAfterTomorrow\":\r\n        return t(\"home.recentActivities.dayAfterTomorrow\");\r\n      default:\r\n        return \"\";\r\n    }\r\n  };\r\n  \r\n  // Slice activities to display count or show all\r\n  const displayedActivities = useMemo(() => {\r\n    if (showAll) {\r\n      return allRecentActivities;\r\n    }\r\n    return allRecentActivities.slice(0, displayCount);\r\n  }, [allRecentActivities, displayCount, showAll]);\r\n  \r\n  const hasMore = allRecentActivities.length > displayCount;\r\n  \r\n  // Don't render if no activities and not loading\r\n  if (!isLoading && !hasActivities) {\r\n    return null;\r\n  }\r\n  \r\n  return (\r\n    <section className=\"py-8 sm:py-12 px-4 bg-secondary/20\">\r\n      <div className=\"container mx-auto max-w-7xl\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h2 className=\"text-xl sm:text-2xl font-bold text-foreground\">\r\n            {t(\"home.recentActivities.title\")}\r\n          </h2>\r\n          \r\n          {hasMore && !showAll && (\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"sm\" \r\n              className=\"text-primary hover:text-primary/80\"\r\n              onClick={() => setShowAll(true)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentActivities.viewAll\")}\r\n                <ArrowRight className=\"w-4 h-4\" />\r\n              </span>\r\n            </Button>\r\n          )}\r\n          \r\n          {showAll && (\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"sm\" \r\n              className=\"text-muted-foreground hover:text-foreground\"\r\n              onClick={() => setShowAll(false)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentActivities.collapse\")}\r\n              </span>\r\n            </Button>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Content */}\r\n        {isLoading ? (\r\n          <LoadingSkeleton />\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            {displayedActivities.map((activity) => (\r\n              <ActivityCard \r\n                key={activity.id} \r\n                activity={activity}\r\n                dayLabel={getDayLabel(activity.dayLabel)}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n});\r\nRecentActivitiesSection.displayName = \"RecentActivitiesSection\";\r\n\r\nexport default RecentActivitiesSection;\r\n","import { Button } from \"@/components/ui/button\";\r\nimport { MapPin, Search, Star, Calendar, Store, ArrowRight, ShoppingBag, CalendarCheck, Smartphone, Download, MessageCircle } from \"lucide-react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card } from \"@/components/ui/card\";\r\n// Hero images served from public folder for LCP optimization (discoverable in initial HTML)\r\nconst sushiRamenHero = \"/images/sushi-ramen-hero.jpg\";\r\nconst sushiRamenMobile = \"/images/sushi-ramen-mobile.jpg\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport googlePlayBadge from \"@/assets/google-play-badge-new.png\";\r\nimport appStoreBadge from \"@/assets/app-store-badge.svg\";\r\nimport { useState, useEffect, memo, useCallback, useRef, lazy, Suspense } from \"react\";\r\nimport { useActiveHomepageTemplates, HomepageTemplate } from \"@/hooks/useHomepageTemplates\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { usePageView } from \"@/hooks/usePageView\";\r\nimport { HomeSkeleton } from \"@/components/skeletons\";\r\nimport { isIOSWebView, isInWebView, isCapacitorApp, isIOSDevice } from \"@/lib/externalLinks\";\r\nimport AskXiaoxiongDialog from \"@/components/AskXiaoxiongDialog\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\n// Lazy load map section - mapbox-gl is 458KB and not needed for initial render\r\nconst HomeMapSection = lazy(() => import(\"@/components/HomeMapSection\"));\r\nimport MobileHeroSection from \"@/components/MobileHeroSection\";\r\nimport RecentActivitiesSection from \"@/components/RecentActivitiesSection\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport useEnvironment from \"@/hooks/useEnvironment\";\r\n// Memoized Stats Display Component\r\nconst StatsDisplay = memo(({ stats, t }: { stats: { order_count: number; reserve_count: number }; t: (key: string) => string }) => (\r\n  <div className=\"absolute top-16 sm:top-20 left-3 z-20\">\r\n    <div className=\"gap-4 w-fit flex-col flex items-start justify-start\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <ShoppingBag className=\"w-4 h-4 text-primary\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.delivery\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.order_count}</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <CalendarCheck className=\"w-4 h-4 text-accent\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.reservation\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.reserve_count}</span>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"flex items-center gap-2\">\r\n        <span className=\"text-xl sm:text-2xl font-bold text-white drop-shadow-md\">\r\n          {t(\"home.hero.brandName\")}\r\n        </span>\r\n        <img \r\n          src={mapIcon} \r\n          alt=\"map icon\" \r\n          width={32}\r\n          height={32}\r\n          loading=\"eager\"\r\n          decoding=\"async\"\r\n          className=\"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0\" \r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n));\r\nStatsDisplay.displayName = \"StatsDisplay\";\r\n\r\n\r\n// Hook to determine if we should use lightweight mode for better performance\r\nconst useLightweightMode = (): boolean => {\r\n  // Safely access window properties with fallbacks for SSR/restricted environments\r\n  const getWindowWidth = () => {\r\n    try {\r\n      return typeof window !== 'undefined' ? window.innerWidth : 1024;\r\n    } catch {\r\n      return 1024;\r\n    }\r\n  };\r\n  \r\n  const getConnection = () => {\r\n    try {\r\n      return typeof navigator !== 'undefined' ? (navigator as any).connection : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n  \r\n  const getDeviceMemory = () => {\r\n    try {\r\n      return typeof navigator !== 'undefined' ? (navigator as any).deviceMemory : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const windowWidth = getWindowWidth();\r\n  const isMobile = windowWidth < 640;\r\n  const isDesktop = windowWidth >= 1024;\r\n  const connection = getConnection();\r\n  \r\n  // Detection for iOS environments - wrapped in try-catch for safety\r\n  let isCapacitor = false;\r\n  let isWebView = false;\r\n  \r\n  try {\r\n    isCapacitor = isCapacitorApp();\r\n    isWebView = isInWebView();\r\n  } catch (e) {\r\n    console.warn('[useLightweightMode] Environment detection failed:', e);\r\n  }\r\n  \r\n  // Desktop: only use lightweight mode if user explicitly enabled data saver\r\n  if (isDesktop) {\r\n    if (connection?.saveData) return true;\r\n    return false; // Desktop always loads video by default\r\n  }\r\n  \r\n  // Mobile/Tablet: WebView environments use lightweight mode\r\n  // But exclude Capacitor native apps (user's own app should play videos)\r\n  if (isWebView && !isCapacitor) {\r\n    return true;\r\n  }\r\n  \r\n  // Check for slow network or data saver (mobile/tablet)\r\n  if (connection) {\r\n    if (connection.saveData) return true;\r\n    if (connection.effectiveType === '2g' || connection.effectiveType === 'slow-2g') return true;\r\n  }\r\n  \r\n  // Mobile low memory devices (< 2GB) - reduced threshold\r\n  const deviceMemory = getDeviceMemory();\r\n  if (isMobile && deviceMemory && deviceMemory < 2) return true;\r\n  \r\n  return false;\r\n};\r\n\r\n// Hero Slide Component\r\nconst HeroSlide = memo(({ \r\n  template, \r\n  isActive, \r\n  currentLang, \r\n  t,\r\n  onContentReady,\r\n  onAskXiaoxiong\r\n}: { \r\n  template: HomepageTemplate; \r\n  isActive: boolean;\r\n  currentLang: string;\r\n  t: (key: string) => string;\r\n  onContentReady?: () => void;\r\n  onAskXiaoxiong?: () => void;\r\n}) => {\r\n  const [postersLoaded, setPostersLoaded] = useState<Record<string, boolean>>({});\r\n  const [videosReady, setVideosReady] = useState<Record<string, boolean>>({});\r\n  const [videoErrors, setVideoErrors] = useState<Record<string, boolean>>({});\r\n  const [imagesLoaded, setImagesLoaded] = useState<Record<string, boolean>>({\r\n    mobile: true,\r\n    tablet: true, \r\n    desktop: true\r\n  });\r\n  // Control when to start loading videos - only after image is ready\r\n  const [shouldLoadVideo, setShouldLoadVideo] = useState(false);\r\n  const isLightweight = useLightweightMode();\r\n  \r\n  // Video refs for iOS Safari fix\r\n  const mobileVideoRef = useRef<HTMLVideoElement>(null);\r\n  const tabletVideoRef = useRef<HTMLVideoElement>(null);\r\n  const desktopVideoRef = useRef<HTMLVideoElement>(null);\r\n  \r\n  const getLocalizedText = (field: string) => {\r\n    const langSuffix = currentLang === \"zh\" ? \"_zh\" : currentLang === \"pt\" ? \"_pt\" : \"_en\";\r\n    return (template as any)[`${field}${langSuffix}`] || \"\";\r\n  };\r\n\r\n  const getDeviceType = () => {\r\n    try {\r\n      if (typeof window === 'undefined') return 'desktop';\r\n      const width = window.innerWidth;\r\n      if (width < 640) return 'mobile';\r\n      if (width < 1024) return 'tablet';\r\n      return 'desktop';\r\n    } catch {\r\n      return 'desktop';\r\n    }\r\n  };\r\n\r\n  const getOverlayOpacity = () => {\r\n    const deviceType = getDeviceType();\r\n    \r\n    if (deviceType === 'mobile' && template.mobile_overlay_opacity !== null) {\r\n      return template.mobile_overlay_opacity;\r\n    }\r\n    if (deviceType === 'tablet' && template.tablet_overlay_opacity !== null) {\r\n      return template.tablet_overlay_opacity;\r\n    }\r\n    if (deviceType === 'desktop' && template.desktop_overlay_opacity !== null) {\r\n      return template.desktop_overlay_opacity;\r\n    }\r\n    \r\n    return template.overlay_opacity ?? 30;\r\n  };\r\n\r\n  const getOverlayStyle = () => {\r\n    const baseOpacity = getOverlayOpacity();\r\n    const direction = template.overlay_gradient_direction || 'to-b';\r\n    \r\n    const normalizeOpacity = (value: number | null | undefined, defaultValue: number) => {\r\n      if (value === null || value === undefined) return defaultValue / 100;\r\n      return value > 1 ? value / 100 : value;\r\n    };\r\n    \r\n    const normalizedBaseOpacity = baseOpacity > 1 ? baseOpacity / 100 : baseOpacity;\r\n    \r\n    const fromOpacity = normalizeOpacity(template.overlay_gradient_from_opacity, 30) * normalizedBaseOpacity;\r\n    const viaOpacity = normalizeOpacity(template.overlay_gradient_via_opacity, 25) * normalizedBaseOpacity;\r\n    const toOpacity = normalizeOpacity(template.overlay_gradient_to_opacity, 40) * normalizedBaseOpacity;\r\n\r\n    const directionMap: Record<string, string> = {\r\n      'to-t': 'to top',\r\n      'to-b': 'to bottom',\r\n      'to-l': 'to left',\r\n      'to-r': 'to right',\r\n      'to-tl': 'to top left',\r\n      'to-tr': 'to top right',\r\n      'to-bl': 'to bottom left',\r\n      'to-br': 'to bottom right'\r\n    };\r\n\r\n    const cssDirection = directionMap[direction] || 'to bottom';\r\n\r\n    const colorMap: Record<string, string> = {\r\n      'black': '0, 0, 0',\r\n      'white': '255, 255, 255',\r\n      'background': '0, 0, 0',\r\n      'foreground': '255, 255, 255',\r\n      'primary': '1, 100, 80',\r\n      'secondary': '240, 240, 240'\r\n    };\r\n\r\n    const fromColor = colorMap[template.overlay_gradient_from || 'black'] || '0, 0, 0';\r\n    const viaColor = colorMap[template.overlay_gradient_via || 'black'] || '0, 0, 0';\r\n    const toColor = colorMap[template.overlay_gradient_to || 'black'] || '0, 0, 0';\r\n\r\n    return {\r\n      background: `linear-gradient(${cssDirection}, rgba(${fromColor}, ${fromOpacity}), rgba(${viaColor}, ${viaOpacity}), rgba(${toColor}, ${toOpacity}))`\r\n    };\r\n  };\r\n\r\n  const mobileImg = template.mobile_image_url || sushiRamenMobile;\r\n  const tabletImg = template.tablet_image_url || template.desktop_image_url || sushiRamenHero;\r\n  const desktopImg = template.desktop_image_url || sushiRamenHero;\r\n  const blurAmount = template.background_blur || 0;\r\n\r\n  // Per-device media type (fallback to global media_type for backwards compatibility)\r\n  const desktopMediaType = (template as any).desktop_media_type || template.media_type || 'image';\r\n  const tabletMediaType = (template as any).tablet_media_type || template.media_type || 'image';\r\n  const mobileMediaType = (template as any).mobile_media_type || template.media_type || 'image';\r\n\r\n  // In lightweight mode (WebView), always treat as image to avoid video loading overhead\r\n  const isDesktopVideo = desktopMediaType === 'video' && !isLightweight;\r\n  const isTabletVideo = tabletMediaType === 'video' && !isLightweight;\r\n  const isMobileVideo = mobileMediaType === 'video' && !isLightweight;\r\n  \r\n  const mobileVideo = isMobileVideo ? template.mobile_video_url : null;\r\n  const tabletVideo = isTabletVideo ? (template.tablet_video_url || template.desktop_video_url) : null;\r\n  const desktopVideo = isDesktopVideo ? template.desktop_video_url : null;\r\n\r\n  // Preload only current device's poster image to prevent flash\r\n  useEffect(() => {\r\n    const deviceType = getDeviceType();\r\n    const currentImage = deviceType === 'mobile' ? mobileImg \r\n      : deviceType === 'tablet' ? tabletImg : desktopImg;\r\n    \r\n    if (currentImage) {\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        setPostersLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        setImagesLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        // Image is ready - notify parent and start loading video\r\n        if (isActive) {\r\n          onContentReady?.();\r\n          // Start loading video after image is displayed (with slight delay for smoother UX)\r\n          setTimeout(() => setShouldLoadVideo(true), 100);\r\n        }\r\n      };\r\n      img.src = currentImage;\r\n    }\r\n  }, [mobileImg, tabletImg, desktopImg, isActive, onContentReady]);\r\n\r\n  // Also enable video loading when slide becomes active (for carousel navigation)\r\n  useEffect(() => {\r\n    if (isActive && postersLoaded[getDeviceType()]) {\r\n      setShouldLoadVideo(true);\r\n    }\r\n  }, [isActive, postersLoaded]);\r\n\r\n  const handleVideoCanPlay = (device: string) => {\r\n    setVideosReady(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  const handleVideoError = (device: string, error: any) => {\r\n    console.error(`[HeroSlide] Video error on ${device}:`, error);\r\n    setVideoErrors(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  // iOS Safari video autoplay fix - programmatically set muted and trigger play\r\n  useEffect(() => {\r\n    if (!shouldLoadVideo || !isActive) return;\r\n    \r\n    let isIOS = false;\r\n    try {\r\n      isIOS = isIOSDevice();\r\n    } catch {\r\n      // Ignore detection errors in restricted WebView environments\r\n    }\r\n    if (!isIOS) return;\r\n\r\n    const deviceType = getDeviceType();\r\n    const videoRef = deviceType === 'mobile' ? mobileVideoRef \r\n      : deviceType === 'tablet' ? tabletVideoRef : desktopVideoRef;\r\n    \r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    // For iOS, we need to programmatically ensure muted is set and call play()\r\n    const attemptPlay = async () => {\r\n      try {\r\n        video.muted = true;\r\n        video.playsInline = true;\r\n        // Set webkit-playsinline for older iOS versions\r\n        video.setAttribute('webkit-playsinline', 'true');\r\n        \r\n        await video.play();\r\n        console.log(`[HeroSlide] iOS video play successful on ${deviceType}`);\r\n      } catch (err) {\r\n        console.error(`[HeroSlide] iOS video play failed on ${deviceType}:`, err);\r\n        // Mark as error so we show the fallback image\r\n        setVideoErrors(prev => ({ ...prev, [deviceType]: true }));\r\n      }\r\n    };\r\n\r\n    // Small delay to ensure video element is ready\r\n    const timer = setTimeout(attemptPlay, 150);\r\n    return () => clearTimeout(timer);\r\n  }, [shouldLoadVideo, isActive]);\r\n\r\n  return (\r\n    <div className={cn(\r\n      \"absolute inset-0 w-full h-full transition-opacity duration-1000\",\r\n      isActive ? \"opacity-100 z-10\" : \"opacity-0 z-0\"\r\n    )}>\r\n      {/* 背景媒体 */}\r\n      <div className=\"absolute inset-0 w-full h-full\">\r\n        {/* Mobile: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full sm:hidden\">\r\n          {!imagesLoaded.mobile && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isMobileVideo && mobileVideo ? (\r\n            <>\r\n              <img \r\n                src={mobileImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.mobile && !videoErrors.mobile ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.mobile && (\r\n                <video\r\n                  ref={mobileVideoRef}\r\n                  src={mobileVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('mobile')}\r\n                  onError={(e) => handleVideoError('mobile', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={mobileImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.mobile ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Tablet: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden sm:block lg:hidden\">\r\n          {!imagesLoaded.tablet && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isTabletVideo && tabletVideo ? (\r\n            <>\r\n              <img \r\n                src={tabletImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.tablet && !videoErrors.tablet ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.tablet && (\r\n                <video\r\n                  ref={tabletVideoRef}\r\n                  src={tabletVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('tablet')}\r\n                  onError={(e) => handleVideoError('tablet', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={tabletImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.tablet ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Desktop: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden lg:block\">\r\n          {!imagesLoaded.desktop && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isDesktopVideo && desktopVideo ? (\r\n            <>\r\n              <img \r\n                src={desktopImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.desktop && !videoErrors.desktop ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.desktop && (\r\n                <video\r\n                  ref={desktopVideoRef}\r\n                  src={desktopVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('desktop')}\r\n                  onError={(e) => handleVideoError('desktop', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={desktopImg} \r\n              alt=\"Background\" \r\n              fetchPriority=\"high\"\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.desktop ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        <div className=\"absolute inset-0 w-full h-full\" style={getOverlayStyle()} />\r\n      </div>\r\n\r\n      {/* 内容 */}\r\n      <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen\">\r\n        <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n          <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n            {getLocalizedText(\"title\") || t(\"home.hero.title\")}\r\n          </h1>\r\n          \r\n          <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n            {getLocalizedText(\"description\") || t(\"home.hero.description\")}\r\n          </p>\r\n          \r\n          {template.subtitle_button_text_zh && (\r\n            <div className=\"flex justify-center\">\r\n              <button \r\n                onClick={onAskXiaoxiong}\r\n                className=\"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40\"\r\n              >\r\n                <MessageCircle className=\"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm\" />\r\n                <span className=\"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium\">\r\n                  {getLocalizedText(\"subtitle_button_text\") || t(\"home.hero.subtitle\")}\r\n                </span>\r\n                <Search className=\"w-4 h-4 text-white/60 ml-2 drop-shadow-sm\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nHeroSlide.displayName = \"HeroSlide\";\r\n\r\nconst Home = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const { settings: siteSettings } = useSiteSettings();\r\n  const { data: templates, isLoading: isLoadingTemplates, refetch: refetchTemplates } = useActiveHomepageTemplates();\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [stats, setStats] = useState<{ order_count: number; reserve_count: number } | null>(null);\r\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n  const [firstSlideReady, setFirstSlideReady] = useState(false);\r\n  const [askDialogOpen, setAskDialogOpen] = useState(false);\r\n  \r\n  // Mobile/WebView detection for conditional layout\r\n  const isMobile = useIsMobile();\r\n  const { isWebView, isNativeApp } = useEnvironment();\r\n  const showMobileLayout = isMobile || isWebView;\r\n  \r\n  // Use environment hook values instead of direct function calls to avoid exceptions\r\n  const shouldHideAppDownload = isWebView || isNativeApp;\r\n  \r\n  // Check if AI assistant is enabled\r\n  const isAIAssistantEnabled = siteSettings?.ai_assistant_enabled !== false;\r\n  \r\n  // Handler for when the first slide's content is ready\r\n  const handleContentReady = useCallback(() => {\r\n    setFirstSlideReady(true);\r\n  }, []);\r\n\r\n  // Track page view\r\n  usePageView({ pageType: \"home\" });\r\n\r\n  const fetchStats = useCallback(async () => {\r\n    try {\r\n      const response = await fetch(\"https://v.xiaoxiong.pt/api/get_info\");\r\n      const result = await response.json();\r\n      if (result) {\r\n        setStats({\r\n          order_count: result.order_count || 0,\r\n          reserve_count: result.reserve_count || 0\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch stats:\", error);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchStats();\r\n  }, [fetchStats]);\r\n\r\n  // Pull-to-refresh handler - clears all caches and forces fresh data\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear all related caches first\r\n    queryClient.removeQueries({ queryKey: ['homepage-templates'] });\r\n    queryClient.removeQueries({ queryKey: ['restaurants'] });\r\n    queryClient.removeQueries({ queryKey: ['activities'] });\r\n    queryClient.removeQueries({ queryKey: ['recent-activities'] });\r\n    \r\n    // Then refetch fresh data\r\n    await Promise.all([\r\n      refetchTemplates(),\r\n      fetchStats(),\r\n      queryClient.invalidateQueries({ queryKey: ['restaurants'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['activities'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['recent-activities'] }),\r\n    ]);\r\n  }, [refetchTemplates, fetchStats, queryClient]);\r\n\r\n  // Auto-rotate carousel\r\n  useEffect(() => {\r\n    if (!templates || templates.length <= 1) return;\r\n\r\n    const currentTemplate = templates[currentIndex];\r\n    const duration = currentTemplate?.duration || 5000;\r\n\r\n    timerRef.current = setTimeout(() => {\r\n      setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n    }, duration);\r\n\r\n    return () => {\r\n      if (timerRef.current) clearTimeout(timerRef.current);\r\n    };\r\n  }, [templates, currentIndex]);\r\n\r\n  const goToSlide = useCallback((index: number) => {\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex(index);\r\n  }, []);\r\n\r\n  const goToPrev = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev - 1 + templates.length) % templates.length);\r\n  }, [templates]);\r\n\r\n  const goToNext = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n  }, [templates]);\r\n\r\n  const currentLang = i18n.language;\r\n  const showControls = templates && templates.length > 1;\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen\">\r\n        {/* Hero Section - Conditional Layout */}\r\n        {showMobileLayout ? (\r\n          // Mobile/WebView: Simplified hero without background\r\n          <MobileHeroSection \r\n            stats={stats} \r\n            onAskXiaoxiong={() => setAskDialogOpen(true)} \r\n          />\r\n        ) : (\r\n          // Desktop: Full carousel with background media\r\n          <section className=\"relative h-screen flex items-start overflow-hidden bg-background\">\r\n            {/* 统计数据显示 - 左上角 */}\r\n            {stats && <StatsDisplay stats={stats} t={t} />}\r\n\r\n            {/* Carousel Slides */}\r\n            <div className={cn(\r\n              \"absolute inset-0 w-full h-full transition-opacity duration-500\",\r\n              firstSlideReady ? \"opacity-100\" : \"opacity-0\"\r\n            )}>\r\n              {templates?.map((template, index) => (\r\n                <HeroSlide\r\n                  key={template.id}\r\n                  template={template}\r\n                  isActive={index === currentIndex}\r\n                  currentLang={currentLang}\r\n                  t={t}\r\n                  onContentReady={index === 0 ? handleContentReady : undefined}\r\n                  onAskXiaoxiong={() => setAskDialogOpen(true)}\r\n                />\r\n              ))}\r\n            </div>\r\n\r\n            {/* Loading state - show skeleton until content is actually ready */}\r\n            <div \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full z-20 transition-opacity duration-500\",\r\n                (isLoadingTemplates || !firstSlideReady) ? \"opacity-100\" : \"opacity-0 pointer-events-none\"\r\n              )}\r\n            >\r\n              <HomeSkeleton />\r\n            </div>\r\n\r\n            {/* Fallback if no templates (only after loading completes) */}\r\n            {!isLoadingTemplates && (!templates || templates.length === 0) && (\r\n              <div className=\"absolute inset-0 w-full h-full\">\r\n                <img \r\n                  src={sushiRamenMobile} \r\n                  alt=\"Background\" \r\n                  fetchPriority=\"high\"\r\n                  loading=\"eager\"\r\n                  decoding=\"async\"\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center sm:hidden\"\r\n                />\r\n                <img \r\n                  src={sushiRamenHero} \r\n                  alt=\"Background\" \r\n                  fetchPriority=\"high\"\r\n                  loading=\"eager\"\r\n                  decoding=\"async\"\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center hidden sm:block\"\r\n                />\r\n                <div className=\"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40\" />\r\n                <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen\">\r\n                  <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n                    <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n                      {t(\"home.hero.title\")}\r\n                    </h1>\r\n                    <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n                      {t(\"home.hero.description\")}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Carousel Controls - Dot Indicators Only */}\r\n            {showControls && (\r\n              <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2\">\r\n                {templates.map((_, index) => (\r\n                  <button\r\n                    key={index}\r\n                    onClick={() => goToSlide(index)}\r\n                    className={cn(\r\n                      \"w-3 h-3 rounded-full transition-all duration-300\",\r\n                      index === currentIndex \r\n                        ? \"bg-white w-8\" \r\n                        : \"bg-white/50 hover:bg-white/70\"\r\n                    )}\r\n                    aria-label={`Go to slide ${index + 1}`}\r\n                  />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </section>\r\n        )}\r\n\r\n      {/* Recent Activities Section */}\r\n      <RecentActivitiesSection />\r\n\r\n      {/* Map Section */}\r\n      <section className=\"py-12 sm:py-20 px-4 bg-secondary/20\">\r\n        <div className=\"container mx-auto max-w-7xl\">\r\n          <Suspense fallback={<div className=\"h-[400px] bg-muted/30 rounded-lg animate-pulse\" />}>\r\n            <HomeMapSection />\r\n          </Suspense>\r\n        </div>\r\n      </section>\r\n\r\n      {/* App Download Section - Hidden in WebView/Native App */}\r\n      {!shouldHideAppDownload && (\r\n      <section className=\"py-16 sm:py-24 px-4 relative overflow-hidden\">\r\n        {/* Background with soft edges using mask */}\r\n        <div \r\n          className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-primary/3 to-primary/8\"\r\n          style={{\r\n            maskImage: 'radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)',\r\n            WebkitMaskImage: 'radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)',\r\n          }}\r\n        />\r\n        \r\n        {/* Decorative elements */}\r\n        <div className=\"absolute top-1/4 left-1/4 w-72 h-72 bg-primary/8 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl\" />\r\n        \r\n        <div className=\"container mx-auto max-w-5xl relative z-10\">\r\n          <div className=\"flex flex-col items-center justify-center gap-8\">\r\n            \r\n            {/* Content */}\r\n            <div className=\"text-center max-w-md\">\r\n              <div className=\"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4\">\r\n                <Smartphone className=\"w-4 h-4\" />\r\n                <span>Mobile App</span>\r\n              </div>\r\n              <h3 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4\">\r\n                {t(\"home.app.title\")}\r\n              </h3>\r\n              <p className=\"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed\">\r\n                {t(\"home.app.description\")}\r\n              </p>\r\n              <div className=\"flex flex-col items-center gap-4\">\r\n                <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\r\n                  {/* App Store */}\r\n                  <a \r\n                    href=\"https://apps.apple.com/cn/app/xiaoxiong/id6755481369\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={appStoreBadge} \r\n                        alt=\"Download on the App Store\" \r\n                        width={108}\r\n                        height={36}\r\n                        className=\"h-8 sm:h-9\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                  \r\n                  {/* Google Play */}\r\n                  <a \r\n                    href=\"https://play.google.com/store/apps/details?id=com.xiaoxiong.market\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={googlePlayBadge} \r\n                        alt=\"Get it on Google Play\" \r\n                        width={145}\r\n                        height={56}\r\n                        className=\"h-12 sm:h-14\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                </div>\r\n                \r\n                {/* Download hint */}\r\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <Download className=\"w-4 h-4 animate-bounce\" />\r\n                  <span>{t(\"home.app.downloadNow\")}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n      )}\r\n\r\n      {/* CTA Section */}\r\n      <section className=\"py-16 sm:py-20 px-4 bg-gradient-to-r from-primary/90 to-primary relative overflow-hidden rounded-3xl mx-4 sm:mx-8 lg:mx-16 mb-8\">\r\n        <div className=\"absolute inset-0 bg-grid-pattern opacity-10\" />\r\n        <div className=\"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl\" />\r\n        \r\n        <div className=\"container mx-auto max-w-4xl text-center relative z-10\">\r\n          <h2 className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4\">\r\n            {t(\"home.cta.title\")}\r\n          </h2>\r\n          <p className=\"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4\">\r\n            {t(\"home.cta.description\")}\r\n          </p>\r\n          <div className=\"flex justify-center\">\r\n            <Button size=\"lg\" variant=\"secondary\" asChild className=\"text-base sm:text-lg shadow-xl hover:shadow-2xl\">\r\n              <Link to=\"/join-us\">\r\n                <Store className=\"mr-2 w-4 sm:w-5 h-4 sm:h-5\" />\r\n                {t(\"home.cta.button\")}\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Ask Xiaoxiong Dialog - conditionally rendered based on settings */}\r\n      {isAIAssistantEnabled && (\r\n        <AskXiaoxiongDialog open={askDialogOpen} onOpenChange={setAskDialogOpen} />\r\n      )}\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"file":"assets/Home-Cv_IxFlt.js"}