import{p as K,u as Be,r,j as e,bc as de,bd as Ke,cY as Qe,L as X,a_ as Xe,bb as Je,aw as te,ay as ne,eh as _e,b9 as ae,aY as re,bq as le,cf as Ze,X as De,bh as ze,W as Ae,w as es,s as ss,bz as ts,cy as Le,bC as Me,dO as Pe,dP as $e,ej as ie,a4 as ns,b6 as Se}from"./vendor-react-BDRnRVHv.js";import{C as ke,a as Te,b as Ee}from"./carousel-Ck27F7jF.js";import{u as as,C as B,m as me,P as ue,Q as xe,R as he,B as L,K as rs,L as ls,h as y,M as is,N as Ie,n as J,p as cs,A as os,q as ds,r as ms,t as us,v as xs,w as hs,x as gs,y as fs,a as ps,s as js}from"./index-4ynzYXNo.js";import{a as Ns,f as bs,b as ws}from"./useCommunityPosts-B7JV6vWq.js";import{u as ge}from"./useLocalizedContent-DlPVPXMF.js";import{T as Z,I as fe}from"./TranslateButton-DMYBpi1A.js";import{u as vs}from"./ShareDrawer-k2YkzlV8.js";import{E as ys,a as Cs}from"./EditRecipeDialog-JLc5c3aO.js";import{H as pe,p as je,I as Ne,J as be}from"./vendor-utils-vwQGbBim.js";import{S as ce}from"./separator-BOXP8Hup.js";import{E as _s}from"./ExternalLinkConfirmDialog-CCOM5kGx.js";import{P as Ss}from"./progress-Xe9TpOIa.js";const Ys=({post:s,showActions:M=!0,isDetailPage:t=!1})=>{const{t:i,i18n:b}=K(),{user:p}=as(),f=Be(),{getLocalizedField:k}=ge(),C=Ns(),T=bs(),c=ws(),[x,w]=r.useState(!1),[E,z]=r.useState(!1),[I,P]=r.useState({}),[D,d]=r.useState(!1),[g,v]=r.useState(0),[_,$]=r.useState(),[U,Y]=r.useState(),[O,W]=r.useState(0),[G,H]=r.useState(null);r.useState(null),r.useState(!1),r.useState(0),r.useState(!1);const[m,n]=r.useState({}),[l,o]=r.useState(null),[j,S]=r.useState(!1),{share:R,DrawerComponent:q}=vs();r.useEffect(()=>{if(D){const a=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${a}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.overflow="hidden",()=>{document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.overflow="",window.scrollTo(0,a)}}},[D]),r.useEffect(()=>{_&&(W(_.selectedScrollSnap()),_.on("select",()=>{W(_.selectedScrollSnap())}))},[_]);const Re=()=>{switch(b.language){case"zh":return be;case"pt":return Ne;default:return je}},Fe=()=>{p&&C.mutate({postId:s.id,liked:s.user_liked||!1})},Ue=async()=>{const a=`${window.location.origin}/community/${s.id}`;R({title:i("community.shareTitle","分享帖子"),text:s.content.replace(/<[^>]*>/g,"").substring(0,100),url:a},()=>{p&&T.mutate(s.id),es.success(i("community.shareSuccess","分享成功"))})},Oe=()=>{c.mutate(s.id),w(!1)},we=a=>{t?(v(a),d(!0)):f(`/community/${s.id}`)},Q=(a,u)=>{const N=a.currentTarget;n(A=>({...A,[u]:{width:N.naturalWidth,height:N.naturalHeight}}))},ve=a=>{const u=m[a];return u?u.height/u.width>1.5:!1},ye=p?.id===s.author_id,We=s.activity?k(s.activity,"title"):null,V=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(a=>a.id===s.restaurant?.id)?[s.restaurant]:[]],ee=t?3:2,Ye=j?V:V.slice(0,ee),Ce=V.length>ee,Ge=k(s,"content"),He=b.language==="zh"&&s.content_zh||b.language==="en"&&s.content_en||b.language==="pt"&&s.content_pt,qe=(G||Ge||s.content)?.replace(/\n/g,"<br>")||"";return e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"overflow-hidden",children:[e.jsx(me,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ue,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(he,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:pe(new Date(s.created_at),{addSuffix:!0,locale:Re()})}),ye&&s.status==="pending"&&e.jsxs(L,{variant:"outline",className:"text-amber-600 border-amber-500 bg-amber-50 dark:bg-amber-950/30 text-xs mt-0.5",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),i("community.pendingReview","审核中")]})]})]}),M&&ye&&e.jsxs(rs,{children:[e.jsx(ls,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsxs(is,{align:"end",children:[e.jsxs(Ie,{onClick:()=>z(!0),children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),i("common.edit","编辑")]}),e.jsx(Ie,{onClick:()=>w(!0),className:"text-destructive",children:i("common.delete","删除")})]})]})]})}),e.jsxs(J,{className:"pt-0 pb-3",children:[(s.activity||V.length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:[s.activity&&e.jsx(X,{to:`/activity/${s.activity.id}`,children:e.jsxs(L,{variant:"secondary",className:"gap-1",children:[e.jsx(Xe,{className:"h-3 w-3"}),We]})}),Ye.map(a=>e.jsx(X,{to:`/restaurant/${a.id}`,children:e.jsxs(L,{variant:"secondary",className:"gap-1",children:[e.jsx(Je,{className:"h-3 w-3"}),k(a,"name")]})},a.id)),Ce&&!j&&e.jsxs("button",{onClick:()=>S(!0),className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5",children:["+",V.length-ee," ",i("community.more","更多"),e.jsx(te,{className:"h-3 w-3"})]}),j&&Ce&&e.jsxs("button",{onClick:()=>S(!1),className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5",children:[i("community.collapse","收起"),e.jsx(ne,{className:"h-3 w-3"})]})]}),e.jsx(X,{to:`/community/${s.id}`,children:e.jsx("div",{className:`prose prose-sm max-w-none dark:prose-invert ${t?"":"line-clamp-6"}`,dangerouslySetInnerHTML:{__html:qe}})}),!He&&e.jsx(Z,{text:s.content,onTranslation:H,className:"mt-1"}),(()=>{const a=t&&s.video_url?(s.image_urls||[]).filter(u=>!u.includes("-cover")):s.image_urls;return!a||a.length===0?null:e.jsx("div",{className:"relative mt-3",children:a.length===1?(()=>{const u=a[0],N=ve(u);return e.jsx("div",{className:"relative overflow-hidden rounded-lg cursor-pointer max-h-[300px] sm:max-h-[400px]",onClick:()=>we(0),children:I[u]?e.jsx("div",{className:"w-full h-full min-h-[200px] bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:i("common.imageLoadError","图片加载失败")})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"",className:"w-full max-h-[300px] sm:max-h-[400px] object-cover object-top",onLoad:A=>Q(A,u),onError:()=>P(A=>({...A,[u]:!0}))}),N&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),e.jsx("span",{children:i("community.longImage","长图")})]})]})})})():e.jsxs(e.Fragment,{children:[e.jsx(ke,{setApi:$,className:"w-full",opts:{loop:!0},children:e.jsx(Te,{className:"-ml-0",children:a.map((u,N)=>{const A=ve(u);return e.jsx(Ee,{className:"pl-0",children:e.jsx("div",{className:"relative overflow-hidden rounded-lg cursor-pointer aspect-[4/3] bg-muted",onClick:()=>we(N),children:I[u]?e.jsx("div",{className:"w-full h-full min-h-[200px] bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:i("common.imageLoadError","图片加载失败")})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"",className:"w-full h-full object-contain",onLoad:h=>Q(h,u),onError:()=>P(h=>({...h,[u]:!0}))}),A&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),e.jsx("span",{children:i("community.longImage","长图")})]})]})})},N)})})}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[O+1,"/",a.length]}),e.jsx("div",{className:"flex justify-center gap-1.5 mt-2",children:a.map((u,N)=>e.jsx("button",{className:`w-1.5 h-1.5 rounded-full transition-colors ${N===O?"bg-primary":"bg-muted-foreground/30"}`,onClick:A=>{A.stopPropagation(),_?.scrollTo(N)}},N))})]})})})(),s.video_url&&e.jsx("div",{className:"mt-3 rounded-lg overflow-hidden bg-gray-900",children:e.jsx("video",{src:s.video_url,...s.image_urls?.length?{poster:s.image_urls[0]}:{},controls:!0,className:"w-full max-h-96",preload:"metadata",playsInline:!0})})]}),e.jsx(cs,{className:"pt-0 border-t",children:e.jsxs("div",{className:"flex items-center gap-4 pt-3 w-full",children:[e.jsxs(y,{variant:"ghost",size:"sm",className:`gap-2 ${s.user_liked?"text-red-500":""}`,onClick:Fe,disabled:!p,children:[e.jsx(ae,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count})]}),e.jsx(X,{to:`/community/${s.id}`,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:s.comments_count})]})}),e.jsxs(y,{variant:"ghost",size:"sm",className:"gap-2",onClick:Ue,children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:s.shares_count})]})]})})]}),e.jsx(os,{open:x,onOpenChange:w,children:e.jsxs(ds,{children:[e.jsxs(ms,{children:[e.jsx(us,{children:i("common.confirmDelete","确认删除")}),e.jsx(xs,{children:i("community.deleteWarning","删除后无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(hs,{children:[e.jsx(gs,{children:i("common.cancel","取消")}),e.jsx(fs,{onClick:Oe,children:i("common.delete","删除")})]})]})}),s.post_type==="recipe"?e.jsx(ys,{post:s,open:E,onOpenChange:z}):e.jsx(Cs,{post:s,open:E,onOpenChange:z}),D&&Ze.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black overflow-hidden",onClick:a=>{a.target===a.currentTarget&&d(!1)},onWheel:a=>a.stopPropagation(),onTouchMove:a=>a.stopPropagation(),children:[s.image_urls&&s.image_urls.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full",children:[g+1," / ",s.image_urls.length]}),e.jsx(y,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:()=>d(!1),children:e.jsx(De,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ke,{className:"w-full",opts:{loop:!0,startIndex:g},setApi:a=>{Y(a),a&&a.on("select",()=>{v(a.selectedScrollSnap())})},children:e.jsx(Te,{className:"-ml-0",children:s.image_urls?.map((a,u)=>{const N=m[a],A=N?N.height/N.width>1.5:!1;return e.jsx(Ee,{className:"pl-0 flex items-center justify-center",children:A?e.jsx("div",{className:"w-full h-screen overflow-x-hidden overflow-y-scroll overscroll-contain",onMouseDown:h=>{const F=h.currentTarget;o({y:h.clientY,scrollTop:F.scrollTop})},onMouseUp:h=>{if(l){const F=Math.abs(h.clientY-l.y),se=Math.abs(h.currentTarget.scrollTop-l.scrollTop);F<10&&se<10&&d(!1),o(null)}},onTouchStart:h=>{const F=h.currentTarget;o({y:h.touches[0].clientY,scrollTop:F.scrollTop})},onTouchEnd:h=>{if(l){const F=h.changedTouches[0],se=Math.abs(F.clientY-l.y),Ve=Math.abs(h.currentTarget.scrollTop-l.scrollTop);se<15&&Ve<15&&(h.preventDefault(),d(!1)),o(null)}},children:e.jsx("img",{src:a,alt:"",className:"block select-none",style:{width:"100vw",minHeight:"100dvh",height:"auto",margin:0},draggable:!1,onLoad:h=>Q(h,a)})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("img",{src:a,alt:"",className:"object-contain w-screen h-screen select-none cursor-pointer",draggable:!1,onClick:()=>d(!1),onLoad:h=>Q(h,a)})})},u)})})})}),s.image_urls&&s.image_urls.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>U?.scrollPrev(),children:e.jsx(ze,{className:"h-8 w-8"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>U?.scrollNext(),children:e.jsx(Ae,{className:"h-8 w-8"})})]})]}),document.body),q]})},ks=()=>js.from("ads"),oe=()=>{const{t:s}=K(),M=ps(),[t,i]=r.useState(null),[b,p]=r.useState(null),{data:f}=ss({queryKey:["active-ads"],queryFn:async()=>{const c=new Date().toISOString(),{data:x,error:w}=await ks().select("*").eq("is_active",!0).or(`start_date.is.null,start_date.lte.${c}`).or(`end_date.is.null,end_date.gte.${c}`).order("sort_order",{ascending:!0});if(w)throw w;return x},staleTime:5*60*1e3});if(!f||f.length===0)return null;const k=c=>{c.link_url&&(i(c.link_url),p(c.name))},C=()=>{t&&(window.open(t,"_blank","noopener,noreferrer"),i(null),p(null))},T=c=>M?c.mobile_image_url||c.desktop_image_url||c.image_url:c.desktop_image_url||c.mobile_image_url||c.image_url;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mt-3",children:f.map(c=>{const x=T(c);return e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-border/50 hover:border-primary/30 transition-colors cursor-pointer",style:{aspectRatio:M?"375/112":"672/112"},onClick:()=>k(c),children:[e.jsx(L,{className:"absolute top-1.5 left-1.5 z-10 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded hover:bg-black/60",children:s("common.ad","广告")}),x?e.jsx("img",{src:x,alt:c.name,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex items-center gap-2 px-3 bg-muted/50 text-sm text-muted-foreground w-full h-full justify-center",children:[e.jsx(ts,{className:"h-3.5 w-3.5 shrink-0"}),e.jsx("span",{className:"truncate",children:c.name})]})]},c.id)})}),e.jsx(_s,{open:!!t,onOpenChange:c=>{c||(i(null),p(null))},onConfirm:C,url:t||void 0,title:s("common.adLinkTitle","外部链接"),description:s("common.adLinkDescription","您即将离开本站，前往广告链接「{{name}}」的外部页面",{name:b||""}),confirmLabel:s("common.adLinkContinue","继续前往")})]})},Ts=({post:s,onStartCooking:M})=>{const{t,i18n:i}=K(),{getLocalizedField:b}=ge(),[p,f]=r.useState(null),[k,C]=r.useState(null),[T,c]=r.useState({}),[x,w]=r.useState(null),[E,z]=r.useState(!1),[I,P]=r.useState(!1),D=200,d=5,v=k||(()=>{const n={zh:"content_zh",en:"content_en",pt:"content_pt"}[i.language]||"content",l=s[n];return l&&typeof l=="string"&&l.trim()?l:s.content})(),_=p||b(s,"recipe_name")||s.recipe_name,$=()=>{const m=[];if(s.recipe_name&&m.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&m.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const n=s.ingredients.map(l=>l.name).join("|");m.push(`[INGREDIENTS]${n}`)}return m.join(`
---
`)},U=m=>{if(!m){f(null),C(null),c({});return}m.split(`
---
`).forEach(l=>{if(l.startsWith("[NAME]"))f(l.replace("[NAME]",""));else if(l.startsWith("[CONTENT]"))C(l.replace("[CONTENT]",""));else if(l.startsWith("[INGREDIENTS]")){const o=l.replace("[INGREDIENTS]","").split("|"),j={};o.forEach((S,R)=>{j[R]=S.trim()}),c(j)}})},Y=()=>{switch(i.language){case"zh":return be;case"pt":return Ne;default:return je}},O=m=>{switch(m){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},W=m=>{switch(m){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return m}},G=s.image_urls&&s.image_urls.length>0,H=s.steps&&s.steps.length>0;return e.jsxs(B,{className:"overflow-hidden",children:[G&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:_||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>w(s.image_urls[0])}),e.jsxs(L,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Le,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(me,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(ue,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(he,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:pe(new Date(s.created_at),{addSuffix:!0,locale:Y()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(Z,{text:$(),onTranslation:U,label:t("recipe.translateAll")})}),e.jsx("h2",{className:"text-xl font-bold",children:_}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(L,{variant:"outline",className:O(s.difficulty),children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),W(s.difficulty)]})]})]}),e.jsxs(J,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:E||(v||"").length<=D?v:(v||"").slice(0,D)+"..."}),(v||"").length>D&&e.jsxs(y,{variant:"ghost",size:"sm",className:"px-0 h-auto py-1 text-xs text-primary",onClick:()=>z(!E),children:[E?t("common.collapse","收起"):t("common.viewAll","查看全部"),E?e.jsx(ne,{className:"h-3 w-3 ml-1"}):e.jsx(te,{className:"h-3 w-3 ml-1"})]})]}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-orange-500"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(ce,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:t("recipe.ingredientName","名称")}),e.jsx("span",{className:"w-24 text-right",children:t("recipe.amount","用量")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:(I?s.ingredients:s.ingredients.slice(0,d)).map((m,n)=>e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:T[n]||m.name}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[m.amount," ",m.unit]})]},n))}),s.ingredients.length>d&&e.jsxs(e.Fragment,{children:[I&&e.jsx(oe,{}),e.jsxs(y,{variant:"ghost",size:"sm",className:"w-full mt-2 text-xs text-primary",onClick:()=>P(!I),children:[I?t("common.collapse","收起"):t("recipe.showAllIngredients",{count:s.ingredients.length}),I?e.jsx(ne,{className:"h-3 w-3 ml-1"}):e.jsx(te,{className:"h-3 w-3 ml-1"})]})]}),s.ingredients.length<=d&&e.jsx(oe,{})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((m,n)=>e.jsxs(L,{variant:"secondary",className:"text-xs",children:["#",m]},n))}),H&&e.jsxs(y,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:M,children:[e.jsx(ie,{className:"h-6 w-6"}),t("recipe.startCooking","开始烹饪"),e.jsxs(L,{variant:"secondary",className:"ml-2",children:[s.steps.length," ",t("recipe.stepsCount","步")]})]})]}),e.jsx(fe,{imageUrl:x||"",isOpen:!!x,onClose:()=>w(null)})]})},Es=({steps:s,onExit:M})=>{const{t}=K(),[i,b]=r.useState(0),[p,f]=r.useState({}),[k,C]=r.useState(null),T=[...s].sort((d,g)=>d.order-g.order),c=T.length,x=T[i],w=(i+1)/c*100,E=i===c-1,z=i===0,I=()=>{E||b(d=>d+1)},P=()=>{z||b(d=>d-1)},D=()=>{M()};return e.jsxs("div",{className:"flex flex-col h-full min-h-[60vh]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background sticky top-0 z-10",children:[e.jsx(y,{variant:"ghost",size:"icon",onClick:M,children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:t("recipe.stepProgress","步骤 {{current}} / {{total}}",{current:i+1,total:c})}),e.jsx(Z,{text:T.map(d=>d.description).join(`
---
`),onTranslation:d=>{if(d){const g=d.split(`
---
`),v={};g.forEach((_,$)=>{v[$]=_}),f(v)}else f({})}})]}),e.jsx(Ss,{value:w,className:"h-1 rounded-none"}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-2xl font-bold shadow-lg",children:x.order})}),(()=>{const d=x.image_urls&&x.image_urls.length>0?x.image_urls:x.image_url?[x.image_url]:[];return d.length>0&&e.jsx("div",{className:"mb-6 flex flex-wrap justify-center gap-2",children:d.map((g,v)=>e.jsx("img",{src:g,alt:`Step ${x.order} - ${v+1}`,className:`h-auto max-h-64 object-cover cursor-pointer rounded-xl ${d.length===1?"max-w-[75%]":"w-[calc(50%-0.25rem)]"}`,onClick:()=>C(g)},v))})})(),e.jsx("p",{className:"text-lg leading-relaxed text-center",children:p[i]||x.description})]}),e.jsx("div",{className:"flex justify-center gap-1.5 py-3",children:T.map((d,g)=>e.jsx("button",{className:`w-2 h-2 rounded-full transition-all ${g===i?"bg-primary w-6":g<i?"bg-primary/50":"bg-muted-foreground/30"}`,onClick:()=>b(g)},g))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-background",children:[e.jsxs(y,{variant:"outline",size:"lg",onClick:P,disabled:z,className:"gap-2",children:[e.jsx(ze,{className:"h-5 w-5"}),t("recipe.prevStep","上一步")]}),E?e.jsxs(y,{size:"lg",onClick:D,className:"gap-2",variant:"default",children:[e.jsx(ns,{className:"h-5 w-5"}),t("recipe.complete","完成")]}):e.jsxs(y,{size:"lg",onClick:I,className:"gap-2",children:[t("recipe.nextStep","下一步"),e.jsx(Ae,{className:"h-5 w-5"})]})]}),e.jsx(fe,{imageUrl:k||"",isOpen:!!k,onClose:()=>C(null)})]})},Gs=({post:s,showActions:M=!1})=>{const{t,i18n:i}=K(),{getLocalizedField:b}=ge(),[p,f]=r.useState("guided"),[k,C]=r.useState("overview"),[T,c]=r.useState(null),[x,w]=r.useState(null),[E,z]=r.useState({}),[I,P]=r.useState({}),[D,d]=r.useState(null);r.useRef(null);const g=r.useCallback(()=>{C("cooking"),requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"smooth"})})},[]),_=x||(()=>{const l={zh:"content_zh",en:"content_en",pt:"content_pt"}[i.language]||"content",o=s[l];return o&&typeof o=="string"&&o.trim()?o:s.content})(),$=T||b(s,"recipe_name")||s.recipe_name,U=()=>{const n=[];if(s.recipe_name&&n.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&n.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const l=s.ingredients.map(o=>o.name).join("|");n.push(`[INGREDIENTS]${l}`)}if(s.steps&&s.steps.length>0){const l=s.steps.sort((o,j)=>o.order-j.order).map(o=>o.description).join("|");n.push(`[STEPS]${l}`)}return n.join(`
---
`)},Y=n=>{if(!n){c(null),w(null),z({}),P({});return}n.split(`
---
`).forEach(o=>{if(o.startsWith("[NAME]"))c(o.replace("[NAME]",""));else if(o.startsWith("[CONTENT]"))w(o.replace("[CONTENT]",""));else if(o.startsWith("[INGREDIENTS]")){const j=o.replace("[INGREDIENTS]","").split("|"),S={};j.forEach((R,q)=>{S[q]=R.trim()}),z(S)}else if(o.startsWith("[STEPS]")){const j=o.replace("[STEPS]","").split("|"),S={};j.forEach((R,q)=>{S[q]=R.trim()}),P(S)}})},O=()=>{switch(i.language){case"zh":return be;case"pt":return Ne;default:return je}},W=n=>{switch(n){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},G=n=>{switch(n){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return n}},H=s.image_urls&&s.image_urls.length>0,m=s.steps&&s.steps.length>0;return p==="guided"&&k==="cooking"&&m?e.jsx(B,{className:"overflow-hidden",children:e.jsx(Es,{steps:s.steps,onExit:()=>C("overview")})}):p==="guided"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>f("guided"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(ie,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>f("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(Se,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsx(Ts,{post:s,onStartCooking:g}),e.jsx(B,{children:e.jsx(J,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-6 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(ae,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(re,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(le,{className:"h-4 w-4"}),s.shares_count||0]})]})})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{f("guided"),C("overview")},className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(ie,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>f("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(Se,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsxs(B,{className:"overflow-hidden",children:[H&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:$||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>d(s.image_urls[0])}),e.jsxs(L,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Le,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(me,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(ue,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(he,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:pe(new Date(s.created_at),{addSuffix:!0,locale:O()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(Z,{text:U(),onTranslation:Y,label:t("recipe.translateAllFull")})}),e.jsx("h2",{className:"text-xl font-bold",children:$}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(L,{variant:"outline",className:W(s.difficulty),children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),G(s.difficulty)]})]})]}),e.jsxs(J,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:_})}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-primary"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(ce,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:t("recipe.ingredientName","名称")}),e.jsx("span",{className:"w-24 text-right",children:t("recipe.amount","用量")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:s.ingredients.map((n,l)=>e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:E[l]||n.name}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[n.amount," ",n.unit]})]},l))}),e.jsx(oe,{})]}),e.jsx(ce,{}),m&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.steps","步骤")," (",s.steps.length,")"]}),e.jsx("ol",{className:"space-y-4",children:s.steps.sort((n,l)=>n.order-l.order).map((n,l)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:n.order}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:I[l]||n.description}),(()=>{const o=n.image_urls&&n.image_urls.length>0?n.image_urls:n.image_url?[n.image_url]:[];return o.length>0&&e.jsx("div",{className:`flex gap-2 ${o.length===1?"":"flex-wrap"}`,children:o.map((j,S)=>e.jsx("img",{src:j,alt:`Step ${n.order} - ${S+1}`,className:`rounded-lg max-h-48 object-cover cursor-pointer ${o.length===1?"w-full":"w-[calc(50%-0.25rem)]"}`,onClick:()=>d(j)},S))})})()]})]},l))})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((n,l)=>e.jsxs(L,{variant:"secondary",className:"text-xs",children:["#",n]},l))}),e.jsxs("div",{className:"flex items-center gap-6 pt-4 border-t text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(ae,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(re,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(le,{className:"h-4 w-4"}),s.shares_count||0]})]})]})]}),e.jsx(fe,{imageUrl:D||"",isOpen:!!D,onClose:()=>d(null)})]})};export{Ys as P,Gs as R};
//# sourceMappingURL=RecipeDetailContent-DkhuOd3_.js.map
