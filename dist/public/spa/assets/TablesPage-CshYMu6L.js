import{Q as ee,a as te}from"./QItem-D8HyRVKq.js";import{Q as be,a as me}from"./rtl-C1Z_t4iI.js";import{c as R,d as s,F as z,K as J,y as i,s as U,P as p,x as G,U as O,k as fe,Y as pe,l as r,p as n,q as k,e as v,N as V,t as h,Q as H,r as w,O as ve,S as Y,L as W,b as ye,w as Z,R as B,ai as ge,C as ke,n as K,aj as Te,h as j,ag as Ce}from"./index-BJrmHtlE.js";import{u as we}from"./use-quasar-BGykivy7.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as ne}from"./QForm-Dn_bjnAh.js";import{c as X,b as xe,Q as Oe,a as le}from"./QTable-DMbInwpq.js";import{C as ae,Q as Se}from"./CodeMaker-IOgtdCDu.js";import{Q as oe,a as ie}from"./QTd-C6cef2pF.js";import"./QItemLabel-Q39-L4As.js";import"./format-CJebrXOQ.js";import"./_commonjsHelpers-gnU0ypJ3.js";const $e={class:"tabs row q-gutter-sm"},he={__name:"FilterTabs",props:{filterStatus:String},setup(l){const y=l,m=[{label:"Todos",value:"Todos"},{label:"Livre",value:"Livre"},{label:"Ocupado",value:"Ocupado"},{label:"Reservado",value:"Reservado"},{label:"Pago",value:"Pago"}];function d(T){if(T===y.filterStatus)switch(T){case"Livre":return"bg-green text-white";case"Ocupado":return"bg-red text-white";case"Reservado":return"bg-blue text-white";case"Pago":return"bg-grey-6 text-white";case"Todos":default:return"bg-black text-white"}return"bg-white text-black"}return(T,f)=>(s(),R("div",$e,[(s(),R(z,null,J(m,a=>i(p,{key:a.value,label:a.label,flat:l.filterStatus!==a.value,unelevated:!0,class:U(d(a.value)),onClick:e=>T.$emit("update:filterStatus",a.value)},null,8,["label","flat","class","onClick"])),64))]))}},Me={class:"text-h6 text-weight-bolder"},qe={class:"status-text"},Ee={class:"text-subtitle2 text-weight-bolder"},Qe={__name:"TableCard",props:{table:Object,editMode:Boolean},setup(l){const y=l,m=G(()=>parseFloat(y.table.order.reduce((a,e)=>a+e.price*e.quantity,0).toFixed(2))),d=G(()=>{switch(y.table.status){case"Livre":return"status-free";case"Ocupado":return"status-busy";case"Reservado":return"status-reserved";case"Pago":return"status-paid";default:return""}});function T(a,e){a["msg_"+e]=!1,O.socket.emit("click_msg",a.id,e)}function f(){document.getElementById("tipsAudio").play()}return O.playSoundFun=f,(a,e)=>fe((s(),r(H,{class:U(["table-card",d.value,"my-card","text-center","q-pa-md"]),flat:"",bordered:"",onClick:e[3]||(e[3]=()=>a.$emit("selectTable",l.table.id))},{default:n(()=>[l.editMode?(s(),r(p,{key:0,icon:"close",size:"xl",color:"red",flat:"",round:"",class:"central-delete-btn",onClick:e[0]||(e[0]=V(()=>a.$emit("removeTable",l.table.id),["stop"]))})):k("",!0),e[4]||(e[4]=v("audio",{id:"tipsAudio",src:"sound/tips.mp3",preload:"auto"},null,-1)),l.table.msg_pay?(s(),r(p,{key:1,onClick:e[1]||(e[1]=V(M=>T(l.table,"pay"),["stop"])),icon:"euro",style:{width:"40px",height:"30px"},color:"white",rounded:"",flat:"",class:"right-btn1"})):k("",!0),l.table.msg_call?(s(),r(p,{key:2,onClick:e[2]||(e[2]=V(M=>T(l.table,"call"),["stop"])),icon:"call",style:{width:"40px",height:"30px"},color:"white",flat:"",rounded:"",class:"right-btn2"})):k("",!0),v("div",null,[v("div",Me," Mesa "+h(l.table.id),1),v("div",qe,h(l.table.status),1),v("div",null,h(l.table.people)+" Pessoas ",1),v("div",Ee," €"+h(m.value),1)])]),_:1,__:[4]},8,["class"])),[[pe]])}},Ae=_(Qe,[["__scopeId","data-v-74bc39f3"]]),Ne={class:"table-grid q-pa-lg"},Be={__name:"TableGrid",props:{tables:Array,editMode:Boolean},setup(l){return(y,m)=>(s(),R("div",Ne,[(s(!0),R(z,null,J(l.tables,d=>(s(),r(Ae,{key:d.id,table:d,editMode:l.editMode,onSelectTable:()=>y.$emit("selectTable",d.id),onRemoveTable:()=>y.$emit("removeTable",d.id)},null,8,["table","editMode","onSelectTable","onRemoveTable"]))),128))]))}},Re=_(Be,[["__scopeId","data-v-acb55136"]]),De={__name:"AddTableForm",props:{visible:Boolean},emits:["submit","update:visible","close"],setup(l,{emit:y}){const m=y,d=w("");function T(){m("submit",d.value),d.value=""}return(f,a)=>(s(),r(W,{"model-value":l.visible,onHide:a[2]||(a[2]=()=>f.$emit("close"))},{default:n(()=>[i(H,{style:{"min-width":"400px"}},{default:n(()=>[i(ne,{onSubmit:T},{default:n(()=>[i(ve,{filled:"",modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),type:"number",label:"Número da mesa",hint:"Número da mesa","lazy-rules":"",rules:[e=>e&&e.length>0||"Por favor, escreve algo",e=>!isNaN(e)||"Conteúdo tem ser um número"]},null,8,["modelValue","rules"]),i(Y,{align:"right"},{default:n(()=>[v("div",null,[i(p,{label:"Submeter",type:"submit",color:"primary"}),i(p,{label:"Cancelar",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:a[1]||(a[1]=V(()=>f.$emit("close"),["stop"]))})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Fe={class:"q-mt-none q-mb-none text-center"},Ie={class:"self-center no-outline"},Le={round:"",class:"self-center no-outline"},Ve={class:"self-center no-outline"},je={class:U(["col-4","justify-between","row"])},ze={__name:"TableDetail",props:{visible:Boolean,table:Object,editable:Boolean},emits:["submit","close","tableEditableMode","editableModeBack","showTableOrders","cleanTable"],setup(l,{emit:y}){const m=l,d=w(!0),T=["Livre","Ocupado","Pago","Reservado"],f=y,a=w(null),e=ye({id:null,people:0,peopleType:{adults:0,children:0},status:""});function M(){e.peopleType.adults>0&&(e.peopleType.adults=e.peopleType.adults-1)}function S(){e.peopleType.adults=e.peopleType.adults+1}function Q(){e.peopleType.children>0&&(e.peopleType.children=e.peopleType.children-1)}function I(){e.peopleType.children=e.peopleType.children+1}function L(){window.open(window.env.QR_ADDR+ae.SimpleEncode(m.table.id),"_blank")}Z(()=>m.visible,async C=>{C&&m.table?.id&&(Object.assign(e,JSON.parse(JSON.stringify(m.table))),await K(),D(),e.status==="Livre"&&(await K(),f("tableEditableMode")))},{immediate:!0}),Z(()=>[e.peopleType.adults,e.peopleType.children],([C,u])=>{const q=parseInt(C)||0,t=parseInt(u)||0;e.people=q+t});async function D(){if(d.value=!0,await K(),!a.value||!m.table.id){console.warn("Canvas not ready or table ID missing");return}const C=window.env.QR_ADDR+ae.SimpleEncode(m.table.id);console.log("qrcoed data: ",C),Se.toCanvas(a.value,C,{width:150},u=>{u?(console.error("二维码生成失败",u),setTimeout(()=>D(),300)):d.value=!1})}return(C,u)=>(s(),r(W,{"model-value":l.visible,onHide:u[7]||(u[7]=q=>C.$emit("close"))},{default:n(()=>[i(H,{style:{"min-width":"450px"}},{default:n(()=>[i(B,{class:"row items-center justify-end q-pb-none q-pl-none q-pt-sm q-pr-sm"},{default:n(()=>[i(p,{icon:"close",flat:"",round:"",dense:"",onClick:u[0]||(u[0]=V(q=>C.$emit("close"),["stop"]))})]),_:1}),i(ne,{onSubmit:u[6]||(u[6]=()=>C.$emit("submit",e)),class:"q-ma-lg"},{default:n(()=>[v("h4",Fe,"Table "+h(e.id),1),i(X,{outlined:"",label:"Adults","stack-label":"",class:"q-mx-sm col-grow"},{control:n(()=>[v("div",Ie,h(e.people),1)]),_:1}),i(B,{class:"row items-center"},{default:n(()=>[l.editable?(s(),r(p,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:M})):k("",!0),i(X,{outlined:"",label:"Adults","stack-label":"",class:"q-mx-sm col-grow"},{control:n(()=>[v("div",Le,h(e.peopleType.adults),1)]),_:1}),l.editable?(s(),r(p,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:S})):k("",!0)]),_:1}),i(B,{class:"row items-center no-wrap"},{default:n(()=>[l.editable?(s(),r(p,{key:0,round:"",color:"primary",icon:"remove",padding:"xs",onClick:Q})):k("",!0),i(X,{outlined:"",label:"Childrens","stack-label":"",class:"q-mx-sm col-grow"},{control:n(()=>[v("div",Ve,h(e.peopleType.children),1)]),_:1}),l.editable?(s(),r(p,{key:1,round:"",color:"primary",icon:"add",padding:"xs",onClick:I})):k("",!0)]),_:1}),i(xe,{square:"",outlined:"",modelValue:e.status,"onUpdate:modelValue":u[1]||(u[1]=q=>e.status=q),options:T,disable:!l.editable},null,8,["modelValue","disable"]),i(B,{class:"flex flex-center",style:{"min-height":"160px"}},{default:n(()=>[d.value?(s(),r(ge,{key:0,color:"primary",size:"2em"})):k("",!0),v("canvas",{ref_key:"qrCanvas",ref:a,style:ke({display:d.value?"none":"block",marginTop:"8px",border:"1px solid #c0c0c0",borderRadius:"12px"}),onClick:L},null,4)]),_:1}),v("div",je,[e.status!="空闲"&&!l.editable?(s(),r(p,{key:0,color:"deep-orange",glossy:"",label:"Limpar mesa",onClick:u[2]||(u[2]=()=>C.$emit("cleanTable",e.id))})):k("",!0),l.editable?k("",!0):(s(),r(p,{key:1,color:"primary",label:"Visualizar pedidos",onClick:u[3]||(u[3]=()=>C.$emit("showTableOrders"))})),l.editable?k("",!0):(s(),r(p,{key:2,color:"secondary",label:"Editar",onClick:u[4]||(u[4]=()=>C.$emit("tableEditableMode"))})),l.editable?(s(),r(p,{key:3,color:"white","text-color":"black",label:"Cancelar",onClick:u[5]||(u[5]=()=>C.$emit("editableModeBack"))})):k("",!0),l.editable?(s(),r(p,{key:4,color:"primary",type:"submit",label:"Salvar"})):k("",!0)])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ue=_(ze,[["__scopeId","data-v-5966a3b8"]]),Pe={class:"text-h6"},Je={class:"text-subtitle2",style:{"text-align":"left",width:"100%"}},Ge={__name:"OrderModal",props:{visible:Boolean,editMode:Boolean,table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},emits:["cancelOrderEdit","setEditMode","saveOrder","close","autoClose","deleteOrder"],setup(l,{emit:y}){const m=l,d=y,T=w({rowsPerPage:0}),f=w(""),a=w(!1),e=w([]),M=[{name:"name",required:!0,label:"nome",align:"left",field:t=>O.getDishName(t),format:t=>`${t}`,sortable:!0},{name:"quantity",required:!0,label:"quandidade",align:"left",field:t=>t.quantity,format:t=>`${t}`,sortable:!0},{name:"price/uni",required:!0,label:"Preço/uni",align:"left",field:t=>t.price.toFixed(2),format:t=>`${t}`,sortable:!0},{name:"price",required:!0,label:"Preço",align:"left",field:t=>t.price*t.quantity,format:t=>`${t.toFixed(2)}`,sortable:!0},{name:"extras",required:!0,label:"Extras",field:t=>Q(t),format:t=>t||""}],S=w([]);function Q(t){return t.name.toLowerCase().includes("bibimbap")?(console.log("rows: ",t.notes),[t.notes[0],t.notes[1],t.notes[2],t.notes[3],t.notes[4]].filter(b=>!!b).join(" / ")):t.name.toLowerCase().includes("ramen")&&t.notes[4]||""}Z(()=>m.table?.order,t=>{e.value=Array.isArray(t)?JSON.parse(JSON.stringify(t)):[]},{immediate:!0,deep:!0});function I(t){return a.value?t.filter(b=>b.price>0):t}function L(){a.value&&(f.value=a.value?"price>0":"")}function D(){q(),a.value=!1,d("autoClose")}function C(t){const b=t.name==="My BOX"||t.name==="Pato assado",g=(A,E)=>A.findIndex(N=>b?N.name===E.name&&N.price===E.price:N.dishid===E.dishid),$=g(e.value,t);if($===-1)return;const F=e.value[$];if(F.quantity<=0)return;if(F.quantity-=1,F.quantity===0){const A=e.value.splice($,1)[0];P(A)}else P(F,t);function P(A,E=A){const N=g(S.value,A);N!==-1?S.value[N].quantity+=1:S.value.push({dishid:E.dishid,quantity:1,name:E.name,price:E.price})}}const u=G(()=>parseFloat(e.value.reduce((t,b)=>t+b.price*b.quantity,0).toFixed(2)));function q(){e.value=Array.isArray(m.table.order)?JSON.parse(JSON.stringify(m.table.order)):[],S.value=[],d("cancelOrderEdit")}return(t,b)=>(s(),r(W,{"model-value":l.visible,onHide:D},{default:n(()=>[i(H,{style:{"min-width":"300px","max-height":"70%","max-width":"80%"}},{default:n(()=>[i(B,null,{default:n(()=>[v("div",Pe,"Mesa "+h(l.table.id),1)]),_:1}),Array.isArray(e.value)&&e.value.length>0?(s(),r(B,{key:0,class:"q-pa-md"},{default:n(()=>[i(Oe,{class:"my-sticky-header-table",flat:"",bordered:"","hide-bottom":"",rows:e.value,"virtual-scroll":"",filter:f.value,"filter-method":I,columns:M,pagination:T.value,"onUpdate:pagination":b[0]||(b[0]=g=>T.value=g),"rows-per-page-options":[0],"row-key":"id"},Te({_:2},[l.editMode?{name:"header",fn:n(g=>[i(oe,{props:g},{default:n(()=>[i(le,{"auto-width":""}),(s(!0),R(z,null,J(g.cols,$=>(s(),r(le,{key:$.name,props:g},{default:n(()=>[j(h($.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"0"}:void 0,l.editMode?{name:"body",fn:n(g=>[i(oe,{props:g},{default:n(()=>[i(ie,{"auto-width":""},{default:n(()=>[i(p,{size:"sm",color:"accent",round:"",dense:"",icon:"remove",disable:g.row.quantity<=0,onClick:$=>C(g.row)},null,8,["disable","onClick"])]),_:2},1024),(s(!0),R(z,null,J(g.cols,$=>(s(),r(ie,{key:$.name,props:g},{default:n(()=>[j(h($.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"1"}:void 0]),1032,["rows","filter","pagination"])]),_:1})):(s(),r(B,{key:1},{default:n(()=>b[5]||(b[5]=[j(" Nothing ")])),_:1,__:[5]})),i(Y,{class:"q-gutter-sm",style:{display:"flex","justify-content":"space-between",padding:"8px 16px","border-top":"1px solid #ccc",position:"sticky",bottom:"0",background:"white","z-index":"10"}},{default:n(()=>[i(Y,{class:"q-gutter-sm",style:{padding:"8px 16px"}},{default:n(()=>[v("div",Je," Total: €"+h(u.value),1)]),_:1}),l.editMode?k("",!0):(s(),r(Ce,{key:0,modelValue:a.value,"onUpdate:modelValue":b[1]||(b[1]=g=>a.value=g),color:"green",onClick:b[2]||(b[2]=g=>L()),label:"No Zero"},null,8,["modelValue"])),l.editMode?(s(),r(p,{key:1,color:"white","text-color":"black",label:"Cancelar",onClick:q})):k("",!0),l.editMode?(s(),r(p,{key:2,color:"primary",label:"Salvar",onClick:b[3]||(b[3]=g=>t.$emit("saveOrder",[...S.value]))})):k("",!0),l.editMode?k("",!0):(s(),r(p,{key:3,color:"primary",label:"Editar",onClick:b[4]||(b[4]=()=>t.$emit("setEditMode"))}))]),_:1})]),_:1})]),_:1},8,["model-value"]))}},He={class:U(["tables-page","row","no-wrap","justify-between"])},nt={__name:"TablesPage",setup(l){const y=we(),m=w("Livre"),d=w(!1),T=w(!1),f=w(null),a=w(!1),e=w(!1),M=w(!1),S=w(!1),Q=w({}),I=G(()=>m.value==="Todos"?O.tables.value:O.tables.value.filter(c=>c.status===m.value));function L(){d.value=!0}function D(){d.value==!0&&(d.value=!1)}function C(c){y.dialog({title:"Confimação de eliminação",message:`Tem certeza quer eliminar a mesa ${c} ? Esta operação não é recuperável.`,cancel:!0,persistent:!0}).onOk(()=>{const o=O.deleteTable(c);o!=null&&y.dialog({title:"Erro",message:o.message})})}function u(){T.value=!0}async function q(c){const o=await O.addNewTable(c);o!==void 0&&y.notify({title:o.title,type:"negative",message:o.message,position:"top-right",timeout:3e3,icon:"error"})}function t(){T.value=!1}function b(c){const o=O.tables.value.find(x=>x.id===c);f.value={...o,order:o?.order||[]},a.value=!0}function g(){e.value=!0}function $(c){const o={id:c.id,status:c.status,peopleType:{adults:c.peopleType.adults,children:c.peopleType.children}},x=O.updateTable(o);x&&y.dialog(x),e.value=!1}function F(){e.value=!1,a.value=!1}function P(){e.value=!1}function A(c){y.dialog({title:"Confirmação de limpeza",message:`Tem a certeza que deseja limpar a mesa ${c}? Isto irá remover todos os clientes e definir o estado como 'Livre'.`,cancel:!0,persistent:!0}).onOk(()=>{const o=O.tableClean(c);o&&y.dialog(o)})}function E(){const c=O.tables.value.find(o=>o.id===f.value.id);f.value={...c,order:c?.order||[]},M.value=!0}function N(){M.value=!1}function se(){S.value=!0}function re(c){O.deleteOrders(f.value.id,c),Q.value.order&&(O.deleteOrder(Q.value),Q.value={}),S.value=!1}function de(){O.refreshTables(),S.value=!1}function ue(){M.value=!1}function ce({order:c,tableId:o}){Q.value={order:c,tableId:o}}return(c,o)=>(s(),R(z,null,[v("div",He,[i(he,{filterStatus:m.value,"onUpdate:filterStatus":o[0]||(o[0]=x=>m.value=x)},null,8,["filterStatus"]),i(p,{color:"primary",icon:d.value?"close":"edit",class:U(["q-pa-md"]),onClick:D},{default:n(()=>[d.value?k("",!0):(s(),r(be,{key:0},{default:n(()=>[i(me,{style:{"min-width":"100px"}},{default:n(()=>[i(ee,{clickable:"",onClick:u},{default:n(()=>[i(te,null,{default:n(()=>o[6]||(o[6]=[j("Adicionar")])),_:1,__:[6]})]),_:1}),i(ee,{clickable:"",onClick:L},{default:n(()=>[i(te,null,{default:n(()=>o[7]||(o[7]=[j("Editar")])),_:1,__:[7]})]),_:1})]),_:1})]),_:1}))]),_:1},8,["icon"])]),o[8]||(o[8]=v("div",null,null,-1)),v("div",null,[i(Re,{tables:I.value,editMode:d.value,onSelectTable:b,onRemoveTable:C},null,8,["tables","editMode"])]),v("div",null,[i(De,{onSubmit:q,onClose:t,visible:T.value,"onUpdate:visible":o[1]||(o[1]=x=>T.value=x)},null,8,["visible"])]),v("div",null,[f.value?(s(),r(Ue,{key:0,visible:a.value,"onUpdate:visible":o[2]||(o[2]=x=>a.value=x),table:f.value,"onUpdate:table":o[3]||(o[3]=x=>f.value=x),editable:e.value,onTableEditableMode:g,onSubmit:$,onClose:F,onEditableModeBack:P,onCleanTable:A,onShowTableOrders:E},null,8,["visible","table","editable"])):k("",!0)]),v("div",null,[f.value?(s(),r(Ge,{key:0,visible:M.value,"onUpdate:visible":o[4]||(o[4]=x=>M.value=x),table:f.value,"onUpdate:table":o[5]||(o[5]=x=>f.value=x),onClose:N,onSetEditMode:se,editMode:S.value,onSaveOrder:re,onCancelOrderEdit:de,onAutoClose:ue,onDeleteOrder:ce},null,8,["visible","table","editMode"])):k("",!0)])],64))}};export{nt as default};
