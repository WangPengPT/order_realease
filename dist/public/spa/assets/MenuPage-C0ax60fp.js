import{Q as ne,a as z,b as ue}from"./QTable-DMbInwpq.js";import{Q as N,a as b}from"./QTd-C6cef2pF.js";import{r as y,o as oe,U as g,c as x,d as f,e as s,y as n,p as o,L as X,F as I,P as r,O as i,Z as J,k as C,K as P,l as c,h as Q,t as S,q as K,J as de,Q as Z,R as h,ah as T}from"./index-BJrmHtlE.js";import{Q as se}from"./QItemLabel-Q39-L4As.js";import{Q as ie}from"./QItem-D8HyRVKq.js";import{a as re}from"./rtl-C1Z_t4iI.js";import{Q as $}from"./QSpace-C_6L_zTD.js";import{Q as me}from"./QImg-buL376UG.js";import{Q as G}from"./QToolbar-CiH_Qgyq.js";import{C as F}from"./ClosePopup-CfnmXNFL.js";import{u as ve}from"./use-quasar-BGykivy7.js";import"./format-CJebrXOQ.js";const fe={class:"q-pa-md"},pe={style:{display:"flex",gap:"16px"}},ge={key:1,class:"upload-placeholder"},be={style:{display:"flex",gap:"16px"}},ye={style:{display:"flex",gap:"16px"}},Ve={style:{display:"flex",gap:"16px"}},Te={__name:"MenuPage",setup(ce){const q=ve(),H=[{name:"id",required:!0,label:"id",align:"left",field:u=>u.id,format:u=>`${u}`,sortable:!0},{name:"name",required:!0,label:"name",align:"left",field:u=>u.name,format:u=>`${u}`,sortable:!0,style:"max-width: 50px;"}],B=y(""),U=y([]),m=y(null),a=y({}),M=y([]);let v=["name","note","subname"];const D=["","_en","_cn"];let V=["id","price","category","tags","image","soldout"];const k=y(!1);function L(u,l){p=void 0,k.value=!0,_(l)}const w=y(!1);function W(u){p=void 0,w.value=!0,_(u)}function _(u,l){R=l,m.value=u;for(let e=0;e<v.length;e++)a.value[v[e]]=u[v[e]],a.value[v[e]+"_en"]=u[v[e]+"_en"],a.value[v[e]+"_cn"]=u[v[e]+"_cn"];a.value.disable=u.disable||!1;for(let e=0;e<V.length;e++)a.value[V[e]]=u[V[e]]}let R=!1;function A(){console.log("apply dish");let u={},l=!1;for(let e=0;e<v.length;e++)for(let t=0;t<D.length;t++){const d=v[e]+D[t];m.value[d]!=a.value[d]&&(u[d]=a.value[d],l=!0)}for(let e=0;e<V.length;e++){let t=V[e];m.value[t]!=a.value[t]&&(l=!0,u[t]=a.value[t])}if(m.value.disable?a.value.disable||(l=!0,u.disable=!1):a.value.disable&&(l=!0,u.disable=!0),console.log("need_update：",m.value,a.value),console.log("need_update：",l),!l){q.notify({type:"negative",message:"There is no data changed!"});return}if(l){let e=!1;if(a.value.id=a.value.id.trim(),a.value.id!="")if(a.value.id==m.value.id)e=!0;else{e=!0;for(let t=0;t<g.menuData.length;t++)if(a.value.id==g.menuData[t].id){console.log("has old id : ",a.value,g.menuData[t]),e=!1;break}}if(!e){q.notify({type:"negative",message:`invalid id: ${a.value.id}`}),console.log("check_ok is: ",e);return}if(R)u={...a.value},g.menuData.push(u),p?(p.subitems||(p.subitems=[p]),p.subitems.push(u),u.handle=m.value.handle):(u.handle="handle_"+u.id,U.value.push(u));else{u.org_id=m.value.id;for(let t=0;t<v.length;t++)for(let d=0;d<D.length;d++){const j=v[t]+D[d];m.value[j]=a.value[j]}m.value.disable=a.value.disable;for(let t=0;t<V.length;t++){let d=V[t];m.value[d]=a.value[d]}}w.value=!1,k.value=!1,g.updateMenuItem(u),console.log("update apply dish",u)}}let p;function E(u){p=u;let l={id:"",handle:u.handle,category:u.category,subname:"",price:"0"};w.value=!0,_(l,!0)}function Y(){p=void 0;let u={id:"",handle:"",category:"",subname:"",price:"0"};k.value=!0,_(u,!0)}oe(()=>{console.log("..... onMounted ...");const u=[],l={};for(let e=0;e<g.menuData.length;e++){let t=g.menuData[e];if(l[t.handle]){let d=l[t.handle];d.subitems||(d.subitems=[d]),d.subitems.push(t)}else l[t.handle]=t,u.push(t)}U.value=u,console.log(U.value),ee()});function ee(){const u={},l=[{label:"------",value:""},{label:"My BOX",value:"My BOX"},{label:"Pato assado",value:"Pato assado"}];for(let e=0;e<g.menuData.length;e++){const t=g.menuData[e];t.category&&t.category!=""&&(u[t.category]||(u[t.category]=!0,l.push({label:t.category,value:t.category}))),t.tags&&t.tags!=""&&(u[t.tags]||(u[t.tags]=!0,l.push({label:t.tags,value:t.tags})))}M.value=l,console.log(M.value)}const O=y(null);function le(){O.value.click()}function ae(u){const l=u.target.files[0];l&&te(l)}async function te(u){let l;l="/upload_image";const e=new FormData;e.append("image",u);try{const t=await fetch(l,{method:"POST",body:e});if(!t.ok)throw new Error("上传失败");const d=await t.json();console.log("上传成功",d),a.value.image=d.imageUrl,console.log(a.value.image),q.notify({type:"positive",message:"图片上传成功"})}catch(t){console.error("上传错误",t),q.notify({type:"negative",message:"图片上传失败"})}}return(u,l)=>(f(),x(I,null,[s("div",fe,[n(ne,{title:"Dishes",rows:U.value,columns:H,"row-key":"id",filter:B.value,onRowClick:L},{header:o(e=>[n(N,{props:e},{default:o(()=>[n(z,{"auto-width":""}),(f(!0),x(I,null,P(e.cols,t=>(f(),c(z,{key:t.name,props:e},{default:o(()=>[Q(S(t.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:o(e=>[n(N,{props:e},{default:o(()=>[n(b,{"auto-width":""},{default:o(()=>[n(r,{size:"sm",color:e.row.subitems?"accent":"primary",round:"",dense:"",onClick:t=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["color","onClick","icon"])]),_:2},1024),(f(!0),x(I,null,P(e.cols,t=>(f(),c(b,{key:t.name,props:e},{default:o(()=>[Q(S(t.value),1)]),_:2},1032,["props"]))),128)),n(b,{"auto-width":""},{default:o(()=>[n(r,{color:"primary",dense:"",onClick:t=>L(null,e.row),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"]),C(n(N,{props:e},{default:o(()=>[e.row.subitems?K("",!0):(f(),c(b,{key:0,colspan:"100%"},{default:o(()=>[n(r,{color:"primary",dense:"",onClick:t=>E(e.row),label:"add new"},null,8,["onClick"])]),_:2},1024)),e.row.subitems?(f(),c(b,{key:1,colspan:"100%"},{default:o(()=>[n(r,{color:"primary",dense:"",onClick:t=>E(e.row),label:"add new"},null,8,["onClick"]),n(re,{bordered:"",class:"rounded-borders",style:{"max-width":"600px"}},{default:o(()=>[n(se,{header:""},{default:o(()=>l[23]||(l[23]=[Q("sub item")])),_:1,__:[23]}),(f(!0),x(I,null,P(e.row.subitems,t=>(f(),c(ie,{key:t.id},{default:o(()=>[n(b,{style:{width:"50px"}},{default:o(()=>[Q(S(t.id),1)]),_:2},1024),n(b,{style:{width:"150px"}},{default:o(()=>[Q(S(t.subname),1)]),_:2},1024),n(b,{"auto-width":""},{default:o(()=>[n(r,{color:"primary",dense:"",onClick:d=>W(t),label:"edit"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):K("",!0)]),_:2},1032,["props"]),[[de,e.expand]])]),"top-right":o(()=>[n(r,{class:"q-mr-lg",color:"primary",dense:"",onClick:l[0]||(l[0]=e=>Y()),label:"add new"}),n(i,{borderless:"",dense:"",debounce:"300",modelValue:B.value,"onUpdate:modelValue":l[1]||(l[1]=e=>B.value=e),placeholder:"Search"},{append:o(()=>[n(J,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter"])]),n(X,{modelValue:k.value,"onUpdate:modelValue":l[14]||(l[14]=e=>k.value=e),"full-height":"","full-width":""},{default:o(()=>[n(Z,null,{default:o(()=>[n(h,{class:"row items-center q-pb-none"},{default:o(()=>[l[24]||(l[24]=s("div",{class:"text-h6"},"Edit Dish",-1)),n($),C(n(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[F]])]),_:1,__:[24]}),s("div",pe,[n(T,{modelValue:a.value.disable,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),n(T,{modelValue:a.value.soldout,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.soldout=e),label:"Soldout"},null,8,["modelValue"]),n(h,{class:"row items-center q-pa-none q-ml-lg"},{default:o(()=>[s("div",{class:"image-uploader cursor-pointer",onClick:le},[a.value.image?(f(),c(me,{key:0,src:a.value.image,style:{height:"100px",width:"100px"}},null,8,["src"])):(f(),x("div",ge,[n(J,{name:"image",size:"xl"}),l[25]||(l[25]=s("div",{class:"q-mt-sm"},"点击选择图片",-1))]))]),s("input",{type:"file",ref_key:"fileInput",ref:O,accept:"image/*",style:{display:"none"},onChange:ae},null,544)]),_:1})]),n(h,{class:"q-pa-sm q-gutter-sm"},{default:o(()=>[n(i,{outlined:"",modelValue:a.value.name,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.name=e),label:"name(pt)",dense:u.dense},null,8,["modelValue","dense"]),n(i,{outlined:"",modelValue:a.value.name_en,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.name_en=e),label:"name(english)",dense:u.dense},null,8,["modelValue","dense"]),n(i,{outlined:"",modelValue:a.value.name_cn,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.name_cn=e),label:"name(中文)",dense:u.dense},null,8,["modelValue","dense"]),l[26]||(l[26]=s("div",{class:"q-ma-lg"},null,-1)),n(i,{outlined:"",modelValue:a.value.note,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.note=e),label:"descript(pt)",dense:u.dense},null,8,["modelValue","dense"]),n(i,{outlined:"",modelValue:a.value.note_en,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.note_en=e),label:"descript(english)",dense:u.dense},null,8,["modelValue","dense"]),n(i,{outlined:"",modelValue:a.value.note_cn,"onUpdate:modelValue":l[9]||(l[9]=e=>a.value.note_cn=e),label:"descript(中文)",dense:u.dense},null,8,["modelValue","dense"]),l[27]||(l[27]=s("div",{class:"q-ma-lg"},null,-1)),s("div",be,[n(i,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),n(i,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[11]||(l[11]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),s("div",ye,[n(i,{outlined:"",modelValue:a.value.category,"onUpdate:modelValue":l[12]||(l[12]=e=>a.value.category=e),label:"category",style:{flex:"1"}},null,8,["modelValue"]),n(ue,{outlined:"",modelValue:a.value.tags,"onUpdate:modelValue":l[13]||(l[13]=e=>a.value.tags=e),options:M.value,label:"tags",style:{flex:"1"}},null,8,["modelValue","options"])]),l[28]||(l[28]=s("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[26,27,28]}),n(G,{class:"q-gutter-lg q-mb-lg"},{default:o(()=>[n($),C(n(r,{align:"right",label:"Cancel"},null,512),[[F]]),n(r,{align:"left",color:"primary",label:"Apply",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(X,{modelValue:w.value,"onUpdate:modelValue":l[22]||(l[22]=e=>w.value=e),"full-height":"","full-width":""},{default:o(()=>[n(Z,null,{default:o(()=>[n(h,{class:"row items-center q-pb-none"},{default:o(()=>[l[29]||(l[29]=s("div",{class:"text-h6"},"Edit Item",-1)),n($),C(n(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[F]])]),_:1,__:[29]}),n(h,{class:"q-pa-sm q-gutter-sm"},{default:o(()=>[n(T,{modelValue:a.value.disable,"onUpdate:modelValue":l[15]||(l[15]=e=>a.value.disable=e),label:"Disable"},null,8,["modelValue"]),n(T,{modelValue:a.value.soldout,"onUpdate:modelValue":l[16]||(l[16]=e=>a.value.soldout=e),label:"Soldout"},null,8,["modelValue"]),l[30]||(l[30]=s("div",{class:"q-ma-lg"},null,-1)),n(i,{outlined:"",modelValue:a.value.subname,"onUpdate:modelValue":l[17]||(l[17]=e=>a.value.subname=e),label:"subname(pt)",dense:u.dense},null,8,["modelValue","dense"]),n(i,{outlined:"",modelValue:a.value.subname_en,"onUpdate:modelValue":l[18]||(l[18]=e=>a.value.subname_en=e),label:"subname(english)",dense:u.dense},null,8,["modelValue","dense"]),n(i,{outlined:"",modelValue:a.value.subname_cn,"onUpdate:modelValue":l[19]||(l[19]=e=>a.value.subname_cn=e),label:"subname(中文)",dense:u.dense},null,8,["modelValue","dense"]),l[31]||(l[31]=s("div",{class:"q-ma-lg"},null,-1)),s("div",Ve,[n(i,{outlined:"",modelValue:a.value.id,"onUpdate:modelValue":l[20]||(l[20]=e=>a.value.id=e),label:"id",style:{flex:"1"}},null,8,["modelValue"]),n(i,{outlined:"",modelValue:a.value.price,"onUpdate:modelValue":l[21]||(l[21]=e=>a.value.price=e),label:"price",type:"number",prefix:"€",style:{flex:"1"}},null,8,["modelValue"])]),l[32]||(l[32]=s("div",{class:"q-ma-lg"},null,-1))]),_:1,__:[30,31,32]}),n(G,{class:"q-gutter-lg q-mb-lg"},{default:o(()=>[n($),C(n(r,{align:"right",label:"Cancel"},null,512),[[F]]),n(r,{align:"left",color:"primary",label:"Apply",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Te as default};
