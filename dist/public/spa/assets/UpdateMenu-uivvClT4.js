import{aC as he,a4 as de,g as Z,aD as be,x as h,G as d,aF as Fe,r as x,aL as ce,a1 as ve,aX as ye,aq as Se,ar as qe,w as xe,E as ke,bz as ze,aS as we,aR as Ue,ai as ne,ak as Ce,Z as Be,P as J,I as Pe,bA as Re,aQ as Ne,l as Ee,d as Le,p as X,y as T,e as G,ag as je,ae as Qe,U as $e}from"./index-BJrmHtlE.js";import{Q as Oe}from"./QBanner-NAkD6W4M.js";import{b as Ae,h as se}from"./format-CJebrXOQ.js";import{Q as De}from"./QPage-DFXwwnOK.js";import{Q as Ie,a as Te}from"./QLayout-Cp2qxRQE.js";import{u as Me}from"./use-quasar-BGykivy7.js";const Ve={...he,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:a=>a>=0&&a<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},K=50,fe=2*K,pe=fe*Math.PI,We=Math.round(pe*1e3)/1e3,Xe=de({name:"QCircularProgress",props:{...Ve,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(a,{slots:i}){const{proxy:{$q:o}}=Z(),r=be(a),u=h(()=>{const g=(o.lang.rtl===!0?-1:1)*a.angle;return{transform:a.reverse!==(o.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-g}deg)`:`rotate3d(0, 0, 1, ${g-90}deg)`}}),p=h(()=>a.instantFeedback!==!0&&a.indeterminate!==!0?{transition:`stroke-dashoffset ${a.animationSpeed}ms ease 0s, stroke ${a.animationSpeed}ms ease`}:""),b=h(()=>fe/(1-a.thickness/2)),y=h(()=>`${b.value/2} ${b.value/2} ${b.value} ${b.value}`),k=h(()=>Ae(a.value,a.min,a.max)),P=h(()=>a.max-a.min),z=h(()=>a.thickness/2*b.value),N=h(()=>{const g=(a.max-k.value)/P.value,e=a.rounded===!0&&k.value<a.max&&g<.25?z.value/2*(1-g/.25):0;return pe*g+e});function C({thickness:g,offset:e,color:m,cls:w,rounded:c}){return d("circle",{class:"q-circular-progress__"+w+(m!==void 0?` text-${m}`:""),style:p.value,fill:"transparent",stroke:"currentColor","stroke-width":g,"stroke-dasharray":We,"stroke-dashoffset":e,"stroke-linecap":c,cx:b.value,cy:b.value,r:K})}return()=>{const g=[];a.centerColor!==void 0&&a.centerColor!=="transparent"&&g.push(d("circle",{class:`q-circular-progress__center text-${a.centerColor}`,fill:"currentColor",r:K-z.value/2,cx:b.value,cy:b.value})),a.trackColor!==void 0&&a.trackColor!=="transparent"&&g.push(C({cls:"track",thickness:z.value,offset:0,color:a.trackColor})),g.push(C({cls:"circle",thickness:z.value,offset:N.value,color:a.color,rounded:a.rounded===!0?"round":void 0}));const e=[d("svg",{class:"q-circular-progress__svg",style:u.value,viewBox:y.value,"aria-hidden":"true"},g)];return a.showValue===!0&&e.push(d("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:a.fontSize}},i.default!==void 0?i.default():[d("div",k.value)])),d("div",{class:`q-circular-progress q-circular-progress--${a.indeterminate===!0?"in":""}determinate`,style:r.value,role:"progressbar","aria-valuemin":a.min,"aria-valuemax":a.max,"aria-valuenow":a.indeterminate===!0?void 0:k.value},Fe(i.internal,e))}}});function M(a,i,o,r){const u=[];return a.forEach(p=>{r(p)===!0?u.push(p):i.push({failedPropValidation:o,file:p})}),u}function H(a){a?.dataTransfer&&(a.dataTransfer.dropEffect="copy"),ve(a)}const Ge={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},He=["rejected"];function Ye({editable:a,dnd:i,getFileInput:o,addFilesToQueue:r}){const{props:u,emit:p,proxy:b}=Z(),y=x(null),k=h(()=>u.accept!==void 0?u.accept.split(",").map(l=>(l=l.trim(),l==="*"?"*/":(l.endsWith("/*")&&(l=l.slice(0,l.length-1)),l.toUpperCase()))):null),P=h(()=>parseInt(u.maxFiles,10)),z=h(()=>parseInt(u.maxTotalSize,10));function N(l){if(a.value)if(l!==Object(l)&&(l={target:null}),l.target?.matches('input[type="file"]')===!0)l.clientX===0&&l.clientY===0&&ce(l);else{const U=o();U!==l.target&&U?.click(l)}}function C(l){a.value&&l&&r(null,l)}function g(l,U,Q,$){let s=Array.from(U||l.target.files);const _=[],B=()=>{_.length!==0&&p("rejected",_)};if(u.accept!==void 0&&k.value.indexOf("*/")===-1&&(s=M(s,_,"accept",v=>k.value.some(F=>v.type.toUpperCase().startsWith(F)||v.name.toUpperCase().endsWith(F))),s.length===0))return B();if(u.maxFileSize!==void 0){const v=parseInt(u.maxFileSize,10);if(s=M(s,_,"max-file-size",F=>F.size<=v),s.length===0)return B()}if(u.multiple!==!0&&s.length!==0&&(s=[s[0]]),s.forEach(v=>{v.__key=v.webkitRelativePath+v.lastModified+v.name+v.size}),$===!0){const v=Q.map(F=>F.__key);s=M(s,_,"duplicate",F=>v.includes(F.__key)===!1)}if(s.length===0)return B();if(u.maxTotalSize!==void 0){let v=$===!0?Q.reduce((F,E)=>F+E.size,0):0;if(s=M(s,_,"max-total-size",F=>(v+=F.size,v<=z.value)),s.length===0)return B()}if(typeof u.filter=="function"){const v=u.filter(s);s=M(s,_,"filter",F=>v.includes(F))}if(u.maxFiles!==void 0){let v=$===!0?Q.length:0;if(s=M(s,_,"max-files",()=>(v++,v<=P.value)),s.length===0)return B()}if(B(),s.length!==0)return s}function e(l){H(l),i.value!==!0&&(i.value=!0)}function m(l){ve(l),(l.relatedTarget!==null||ye.is.safari!==!0?l.relatedTarget!==y.value:document.elementsFromPoint(l.clientX,l.clientY).includes(y.value)===!1)===!0&&(i.value=!1)}function w(l){H(l);const U=l.dataTransfer.files;U.length!==0&&r(null,U),i.value=!1}function c(l){if(i.value===!0)return d("div",{ref:y,class:`q-${l}__dnd absolute-full`,onDragenter:H,onDragover:H,onDragleave:m,onDrop:w})}return Object.assign(b,{pickFiles:N,addFiles:C}),{pickFiles:N,addFiles:C,onDragover:e,onDragleave:m,processFiles:g,getDndNode:c,maxFilesNumber:P,maxTotalSizeNumber:z}}function ie(a){return(a*100).toFixed(2)+"%"}const Je={...Se,...Ge,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},me=[...He,"start","finish","added","removed"];function Ke(a,i){const o=Z(),{props:r,slots:u,emit:p,proxy:b}=o,{$q:y}=b,k=qe(r,y);function P(t,f,S){if(t.__status=f,f==="idle"){t.__uploaded=0,t.__progress=0,t.__sizeLabel=se(t.size),t.__progressLabel="0.00%";return}if(f==="failed"){b.$forceUpdate();return}t.__uploaded=f==="uploaded"?t.size:S,t.__progress=f==="uploaded"?1:Math.min(.9999,t.__uploaded/t.size),t.__progressLabel=ie(t.__progress),b.$forceUpdate()}const z=h(()=>r.disable!==!0&&r.readonly!==!0),N=x(!1),C=x(null),g=x(null),e={files:x([]),queuedFiles:x([]),uploadedFiles:x([]),uploadedSize:x(0),updateFileStatus:P,isAlive:()=>Ce(o)===!1},{pickFiles:m,addFiles:w,onDragover:c,onDragleave:l,processFiles:U,getDndNode:Q,maxFilesNumber:$,maxTotalSizeNumber:s}=Ye({editable:z,dnd:N,getFileInput:te,addFilesToQueue:le});Object.assign(e,a({props:r,slots:u,emit:p,helpers:e,exposeApi:t=>{Object.assign(e,t)}})),e.isBusy===void 0&&(e.isBusy=x(!1));const _=x(0),B=h(()=>_.value===0?0:e.uploadedSize.value/_.value),v=h(()=>ie(B.value)),F=h(()=>se(_.value)),E=h(()=>z.value===!0&&e.isUploading.value!==!0&&(r.multiple===!0||e.queuedFiles.value.length===0)&&(r.maxFiles===void 0||e.files.value.length<$.value)&&(r.maxTotalSize===void 0||_.value<s.value)),n=h(()=>z.value===!0&&e.isBusy.value!==!0&&e.isUploading.value!==!0&&e.queuedFiles.value.length!==0);Pe(Re,oe);const O=h(()=>"q-uploader column no-wrap"+(k.value===!0?" q-uploader--dark q-dark":"")+(r.bordered===!0?" q-uploader--bordered":"")+(r.square===!0?" q-uploader--square no-border-radius":"")+(r.flat===!0?" q-uploader--flat no-shadow":"")+(r.disable===!0?" disabled q-uploader--disable":"")+(N.value===!0?" q-uploader--dnd":"")),A=h(()=>"q-uploader__header"+(r.color!==void 0?` bg-${r.color}`:"")+(r.textColor!==void 0?` text-${r.textColor}`:""));xe(e.isUploading,(t,f)=>{f===!1&&t===!0?p("start"):f===!0&&t===!1&&p("finish")});function D(){r.disable===!1&&(e.abort(),e.uploadedSize.value=0,_.value=0,ae(),e.files.value=[],e.queuedFiles.value=[],e.uploadedFiles.value=[])}function R(){r.disable===!1&&ee(["uploaded"],()=>{e.uploadedFiles.value=[]})}function W(){ee(["idle","failed"],({size:t})=>{_.value-=t,e.queuedFiles.value=[]})}function ee(t,f){if(r.disable===!0)return;const S={files:[],size:0},L=e.files.value.filter(q=>t.indexOf(q.__status)===-1?!0:(S.size+=q.size,S.files.push(q),q.__img!==void 0&&window.URL.revokeObjectURL(q.__img.src),!1));S.files.length!==0&&(e.files.value=L,f(S),p("removed",S.files))}function Y(t){r.disable||(t.__status==="uploaded"?e.uploadedFiles.value=e.uploadedFiles.value.filter(f=>f.__key!==t.__key):t.__status==="uploading"?t.__abort():_.value-=t.size,e.files.value=e.files.value.filter(f=>f.__key!==t.__key?!0:(f.__img!==void 0&&window.URL.revokeObjectURL(f.__img.src),!1)),e.queuedFiles.value=e.queuedFiles.value.filter(f=>f.__key!==t.__key),p("removed",[t]))}function ae(){e.files.value.forEach(t=>{t.__img!==void 0&&window.URL.revokeObjectURL(t.__img.src)})}function te(){return g.value||C.value.getElementsByClassName("q-uploader__input")[0]}function le(t,f){const S=U(t,f,e.files.value,!0),L=te();L!=null&&(L.value=""),S!==void 0&&(S.forEach(q=>{if(e.updateFileStatus(q,"idle"),_.value+=q.size,r.noThumbnails!==!0&&q.type.toUpperCase().startsWith("IMAGE")){const ue=new Image;ue.src=window.URL.createObjectURL(q),q.__img=ue}}),e.files.value=e.files.value.concat(S),e.queuedFiles.value=e.queuedFiles.value.concat(S),p("added",S),r.autoUpload===!0&&e.upload())}function re(){n.value===!0&&e.upload()}function V(t,f,S){if(t===!0){const L={type:"a",key:f,icon:y.iconSet.uploader[f],flat:!0,dense:!0};let q;return f==="add"?(L.onClick=m,q=oe):L.onClick=S,d(J,L,q)}}function oe(){return d("input",{ref:g,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:r.accept,multiple:r.multiple===!0?"multiple":void 0,capture:r.capture,onMousedown:ce,onClick:m,onChange:le})}function ge(){return u.header!==void 0?u.header(I):[d("div",{class:"q-uploader__header-content column"},[d("div",{class:"flex flex-center no-wrap q-gutter-xs"},[V(e.queuedFiles.value.length!==0,"removeQueue",W),V(e.uploadedFiles.value.length!==0,"removeUploaded",R),e.isUploading.value===!0?d(ne,{class:"q-uploader__spinner"}):null,d("div",{class:"col column justify-center"},[r.label!==void 0?d("div",{class:"q-uploader__title"},[r.label]):null,d("div",{class:"q-uploader__subtitle"},[F.value+" / "+v.value])]),V(E.value,"add"),V(r.hideUploadBtn===!1&&n.value===!0,"upload",e.upload),V(e.isUploading.value,"clear",e.abort)])])]}function _e(){return u.list!==void 0?u.list(I):e.files.value.map(t=>d("div",{key:t.__key,class:"q-uploader__file relative-position"+(r.noThumbnails!==!0&&t.__img!==void 0?" q-uploader__file--img":"")+(t.__status==="failed"?" q-uploader__file--failed":t.__status==="uploaded"?" q-uploader__file--uploaded":""),style:r.noThumbnails!==!0&&t.__img!==void 0?{backgroundImage:'url("'+t.__img.src+'")',backgroundSize:r.thumbnailFit}:null},[d("div",{class:"q-uploader__file-header row flex-center no-wrap"},[t.__status==="failed"?d(Be,{class:"q-uploader__file-status",name:y.iconSet.type.negative,color:"negative"}):null,d("div",{class:"q-uploader__file-header-content col"},[d("div",{class:"q-uploader__title"},[t.name]),d("div",{class:"q-uploader__subtitle row items-center no-wrap"},[t.__sizeLabel+" / "+t.__progressLabel])]),t.__status==="uploading"?d(Xe,{value:t.__progress,min:0,max:1,indeterminate:t.__progress===0}):d(J,{round:!0,dense:!0,flat:!0,icon:y.iconSet.uploader[t.__status==="uploaded"?"done":"clear"],onClick:()=>{Y(t)}})])]))}ke(()=>{e.isUploading.value===!0&&e.abort(),e.files.value.length!==0&&ae()});const I={};for(const t in e)ze(e[t])===!0?we(I,t,()=>e[t].value):I[t]=e[t];return Object.assign(I,{upload:re,reset:D,removeUploadedFiles:R,removeQueuedFiles:W,removeFile:Y,pickFiles:m,addFiles:w}),Ue(I,{canAddFiles:()=>E.value,canUpload:()=>n.value,uploadSizeLabel:()=>F.value,uploadProgressLabel:()=>v.value}),i({...e,upload:re,reset:D,removeUploadedFiles:R,removeQueuedFiles:W,removeFile:Y,pickFiles:m,addFiles:w,canAddFiles:E,canUpload:n,uploadSizeLabel:F,uploadProgressLabel:v}),()=>{const t=[d("div",{class:A.value},ge()),d("div",{class:"q-uploader__list scroll"},_e()),Q("uploader")];e.isBusy.value===!0&&t.push(d("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[d(ne)]));const f={ref:C,class:O.value};return E.value===!0&&Object.assign(f,{onDragover:c,onDragleave:l}),d("div",f,t)}}const Ze=()=>!0;function ea(a){const i={};return a.forEach(o=>{i[o]=Ze}),i}const aa=ea(me),ta=({name:a,props:i,emits:o,injectPlugin:r})=>de({name:a,props:{...Je,...i},emits:Ne(o)===!0?{...aa,...o}:[...me,...o],setup(u,{expose:p}){return Ke(r,p)}});function j(a){return typeof a=="function"?a:()=>a}const la="QUploader",ra={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>a=>a.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},oa=["factoryFailed","uploaded","failed","uploading"];function ua({props:a,emit:i,helpers:o}){const r=x([]),u=x([]),p=x(0),b=h(()=>({url:j(a.url),method:j(a.method),headers:j(a.headers),formFields:j(a.formFields),fieldName:j(a.fieldName),withCredentials:j(a.withCredentials),sendRaw:j(a.sendRaw),batch:j(a.batch)})),y=h(()=>p.value>0),k=h(()=>u.value.length!==0);let P;function z(){r.value.forEach(e=>{e.abort()}),u.value.length!==0&&(P=!0)}function N(){const e=o.queuedFiles.value.slice(0);o.queuedFiles.value=[],b.value.batch(e)?C(e):e.forEach(m=>{C([m])})}function C(e){if(p.value++,typeof a.factory!="function"){g(e,{});return}const m=a.factory(e);if(!m)i("factoryFailed",new Error("QUploader: factory() does not return properly"),e),p.value--;else if(typeof m.catch=="function"&&typeof m.then=="function"){u.value.push(m);const w=c=>{o.isAlive()===!0&&(u.value=u.value.filter(l=>l!==m),u.value.length===0&&(P=!1),o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(l=>{o.updateFileStatus(l,"failed")}),i("factoryFailed",c,e),p.value--)};m.then(c=>{P===!0?w(new Error("Aborted")):o.isAlive()===!0&&(u.value=u.value.filter(l=>l!==m),g(e,c))}).catch(w)}else g(e,m||{})}function g(e,m){const w=new FormData,c=new XMLHttpRequest,l=(n,O)=>m[n]!==void 0?j(m[n])(O):b.value[n](O),U=l("url",e);if(!U){console.error("q-uploader: invalid or no URL specified"),p.value--;return}const Q=l("formFields",e);Q!==void 0&&Q.forEach(n=>{w.append(n.name,n.value)});let $=0,s=0,_=0,B=0,v;c.upload.addEventListener("progress",n=>{if(v===!0)return;const O=Math.min(B,n.loaded);o.uploadedSize.value+=O-_,_=O;let A=_-s;for(let D=$;A>0&&D<e.length;D++){const R=e[D];if(A>R.size)A-=R.size,$++,s+=R.size,o.updateFileStatus(R,"uploading",R.size);else{o.updateFileStatus(R,"uploading",A);return}}},!1),c.onreadystatechange=()=>{c.readyState<4||(c.status&&c.status<400?(o.uploadedFiles.value=o.uploadedFiles.value.concat(e),e.forEach(n=>{o.updateFileStatus(n,"uploaded")}),i("uploaded",{files:e,xhr:c})):(v=!0,o.uploadedSize.value-=_,o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(n=>{o.updateFileStatus(n,"failed")}),i("failed",{files:e,xhr:c})),p.value--,r.value=r.value.filter(n=>n!==c))},c.open(l("method",e),U),l("withCredentials",e)===!0&&(c.withCredentials=!0);const F=l("headers",e);F!==void 0&&F.forEach(n=>{c.setRequestHeader(n.name,n.value)});const E=l("sendRaw",e);e.forEach(n=>{o.updateFileStatus(n,"uploading",0),E!==!0&&w.append(l("fieldName",n),n,n.name),n.xhr=c,n.__abort=()=>{c.abort()},B+=n.size}),i("uploading",{files:e,xhr:c}),r.value.push(c),E===!0?c.send(new Blob(e)):c.send(w)}return{isUploading:y,isBusy:k,abort:z,upload:N}}const na={name:la,props:ra,emits:oa,injectPlugin:ua},sa=ta(na),ia={class:"q-pa-md"},da={class:"q-gutter-sm row items-start"},_a={__name:"UpdateMenu",setup(a){const i=x(!1),o=Me();let r;r="/upload";function u({xhr:b}){const y=JSON.parse(b.response);y.success?($e.refreshMenuSignal(),o.notify({type:"positive",message:"上传成功"})):o.notify({type:"negative",message:y.msg})}function p(){}return(b,y)=>(Le(),Ee(Ie,null,{default:X(()=>[T(Te,null,{default:X(()=>[T(De,{class:"q-pa-lg"},{default:X(()=>[T(Oe,{class:"bg-primary text-white"},{default:X(()=>[T(J,{flat:"",color:"white",label:"MAIN",icon:"arrow_back",to:"/"})]),_:1}),G("div",null,[T(je,{modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=k=>i.value=k),label:"update all",color:"green"},null,8,["modelValue"])]),G("div",ia,[y[1]||(y[1]=G("p",null,"上传菜单",-1)),G("div",da,[T(sa,{"form-fields":[{name:"update_all",value:i.value}],url:Qe(r),onUploaded:u,onFailed:p,style:{"max-width":"300px"}},null,8,["form-fields","url"])])])]),_:1})]),_:1})]),_:1}))}};export{_a as default};
