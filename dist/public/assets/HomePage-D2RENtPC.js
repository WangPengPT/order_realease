import{g as tt,b as st}from"./vendor-BwD4SF-p.js";import{Q as me,b as $,e as we,f as u,o as l,h as e,v as g,F as B,y as se,a as q,B as de,t as n,M as t,s as S,E as qe,w as fe,V as lt,c as K,A as ge,U as Ge,C as ae,p as at,I as nt,J as ot,n as ze,R as it,S as rt}from"./vue-Dca0Sd-v.js";import{k as Ne,b as P,e as ve,l as ut,m as He,j as Oe,n as Be,o as ct,u as dt,f as Pe,g as Ee,h as Ve,d as je,p as ke,c as Ue,q as mt,r as ft,v as vt,i as ht,w as pt,x as gt}from"./primevue-CBPQtTnk.js";import{c as h,m as Q,g as yt,l as Qe}from"./index-CqHK_XIN.js";import{D as Y,c as re}from"./CartItems-CR5Jfahr.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as Ae,a as _t,S as bt}from"./cookie-B5yvvDQV.js";import{_ as Ke}from"./LoginDialog-DUFgvgRU.js";var xt=st();const Re=tt(xt),kt={class:"grid"},wt={key:0,class:"col-12 sm:col-12 md:col-6 lg:col-4 border-round surface-section shadow-1 p-2"},$t={class:"flex flex-column"},Dt=["onClick"],Ct={class:"p-1 flex-shrink-0 w-7rem h-7rem flex align-items-center justify-content-center overflow-hidden"},It=["src","alt"],Tt={class:"flex flex-column justify-content-center"},Nt={class:"font-bold"},qt={class:"flex flex-wrap gap-2"},At={class:"flex gap-1 align-items-center"},St={class:"text-color-secondary line2"},Mt={key:0,class:"text-xl font-bold text-primary"},Lt={key:1,class:"flex align-items-center gap-1"},Ut={class:"text-l font-bold text-color-secondary"},Rt={class:"text-sm line-through text-500"},Pt={key:2,class:"flex gap-2 mr-2",id:"card-quantity"},Et={class:"w-2rem text-xl text-center"},Vt={key:3,class:"flex gap-2 mr-2"},jt={key:0,class:"m-2 mt-0"},Ot={class:"flex flex-row justify-content-between align-content-center"},Ft={class:"flex flex-column"},Wt={class:"text-l font-bold"},zt={key:0,class:"text-l font-bold text-color-secondary"},Ht={key:1,class:"flex align-items-center gap-1"},Bt={class:"text-l font-bold text-color-secondary"},Qt={class:"text-sm line-through text-500"},Gt={key:0,class:"flex ml-2 mr-2"},Kt={class:"w-2rem text-xl text-center"},Jt={key:1,class:"flex gap-2 mr-3 pt-2 pb-2"},Xt={class:"mb-2 flex justify-content-center"},Yt={class:"font-bold text-center"},Zt={class:"mb-2"},es={class:"text-color-secondary m-0 line-height-3 line2 text-center"},ts={class:"mb-2"},ss={class:"flex justify-content-center"},ls=["src","alt"],as={class:"flex align-items-center gap-2"},ns=["src","alt"],os={class:"flex align-items-center gap-3 ml-auto"},is={__name:"DishList",props:{rateDish:{type:Function,required:!0},likedItemsRef:Array,dislikedItemsRef:Array,tabIndex:Number,onlyVeg:Boolean},setup(M){const{t:te}=me(),T=Y.dishDatas,A=$(null),_=M,U=(c,C=!0)=>{if(!_.onlyVeg)return!0;if(C)return c.vegetable;if(c.subItems.length>0){for(const p of c.subItems)if(p.vegetable)return!0}else return c.dish.vegetable;return!1};we(()=>{let c=h.getOrderMenuTab()[_.tabIndex];if(h.customDishAPI.customDishes.value.map(d=>d.name),h.getMenu().length==0){console.log("exit");return}A.value=T.value[p(T.value,c)].mainDishes,Y.showDishList(A.value);function p(d,y){for(const f in d)if(d[f].name==y)return f;console.error("Can not find tab index in menu")}});let i={rated:!1,id:null,like:0,rate:0};const O=c=>Y.dishDatas.value[c]?Y.dishDatas.value[c].quantity:0,N=c=>{if(!H())return!1;const C=c.quantity;let p=3;if(c.price>0&&(p=9),c.limit){const d=c.id,y=H(),f=(y.peopleType.adults+y.peopleType.children)*c.limit,I=y.order.find(x=>x.dishid==d);let z=0;if(c.subitem)for(const x of c.subitem){z+=O(x);const k=y.order.find(F=>F.dishid==Z(x));k&&(z+=k.quantity)}else z+=c.quantity,I&&(z+=I.quantity);return C>=p||f&&z>=f}return C>=p},Z=c=>Y.dishDatas.value[c]?Y.dishDatas.value[c].id:0,H=()=>h.getTableValue(),J=c=>{let C="absolute origin-top-left mt-1 ml-1 border-round-lg pl-1 pr-1 text-xs text-white font-bold ";switch(c){case"new":C+="bg-red-600";break;case"recommended":case"special":C+="bg-orange-600";break;default:C+="bg-blue-600"}return C};function X(c){_.rateDish(i.id,i.like,i.rate,i.rated),D(c,i.rate,i.like),i.id=null,i.like=0,i.rate=0,i.rated=!1}const b=c=>{const C=_.likedItemsRef.indexOf(c);if(i.id=c.id,C!==-1)_.likedItemsRef.splice(C,1),i.like+=-1,i.rate+=-1,i.rated=!1;else{i.rated=!0,_.likedItemsRef.push(c);const p=_.dislikedItemsRef.indexOf(c);p!==-1?(_.dislikedItemsRef.splice(p,1),i.like+=1):(i.like+=1,i.rate+=1)}X(c)};function D(c,C=0,p=0){c.rates=(c.rates||0)+C,c.likes=(c.likes||0)+p}const V=c=>{const C=_.dislikedItemsRef.indexOf(c);if(i.id=c.id,C!==-1)_.dislikedItemsRef.splice(C,1),i.rate+=-1,i.rated=!1;else{i.rated=!0,_.dislikedItemsRef.push(c);const p=_.likedItemsRef.indexOf(c);p!==-1?(_.likedItemsRef.splice(p,1),i.like+=-1):i.rate+=1}X(c)},G=$(!1),j=$({}),ue=c=>{G.value=!0,j.value=c},ie=c=>{c.target.src="/images/default.png"};function ne(c){ee(c.target,300)}function oe(c){ee(c.target,110)}function ee(c,C){const p=c.naturalWidth,d=c.naturalHeight,y=Math.min(p,C),f=y/p,I=d*f;c.style.width=`${y}px`,c.style.height=`${I}px`}return(c,C)=>(l(),u(B,null,[e("div",kt,[(l(!0),u(B,null,se(A.value,(p,d)=>{var y;return l(),u(B,{key:d},[U(p,!1)?(l(),u("div",wt,[e("div",$t,[e("div",{class:de(["flex flex-row",p.subItems.length!==0?"flex-grow-1":""]),onClick:f=>ue(p.dish)},[((y=p.dish.etiquette)==null?void 0:y.length)>0?(l(),u("div",{key:0,class:de(J(p.dish.etiquette))},n(t(te)("common.etiquette."+p.dish.etiquette)),3)):q("",!0),e("div",Ct,[e("img",{src:p.dish.image||"/images/default.png",alt:p.dish.name,class:"w-full h-full",style:{"object-fit":"cover"},onError:ie,onLoad:oe},null,40,It)]),e("div",Tt,[e("div",Nt,n(p.dish.name),1),e("div",null,[e("div",qt,[e("div",At,[(l(),u(B,null,se(5,f=>e("i",{key:f,class:de(["pi invert-star",f<=Math.floor(p.dish.likes/p.dish.rates*5)?"pi-star-fill":f-.5<=p.dish.likes/p.dish.rates*5?"pi-star-half-fill":"pi-star"]),style:{color:"black"}},null,2)),64)),e("p",null,"("+n(p.dish.rates?p.dish.rates:0)+")",1)])])]),e("div",null,[e("p",St,n(p.dish.note),1)])])],10,Dt),p.subItems.length==0?(l(),u("div",{key:0,class:de(["flex ml-2 mr-2 mb-2",Number(p.dish.price)>0?"justify-content-between":"justify-content-end"])},[!p.dish.discount&&Number(p.dish.price)>0?(l(),u("span",Mt,"â‚¬"+n(p.dish.price),1)):q("",!0),p.dish.discount?(l(),u("div",Lt,[e("span",Ut,"â‚¬"+n(p.dish.dis_price),1),e("span",Rt,"â‚¬"+n(p.dish.price),1),g(t(Ne),{severity:"danger",value:"-"+p.dish.discount+"%"},null,8,["value"])])):q("",!0),p.dish.soldout?q("",!0):(l(),u("div",Pt,[g(t(P),{icon:"pi pi-minus",rounded:"",disabled:p.dish.quantity<=0,onClick:f=>p.dish.quantity--,class:"w-2rem h-2rem"},null,8,["disabled","onClick"]),e("span",Et,n(p.dish.quantity),1),g(t(P),{icon:"pi pi-plus",rounded:"",disabled:N(p.dish),onClick:f=>p.dish.quantity++,class:"w-2rem h-2rem"},null,8,["disabled","onClick"])])),p.dish.soldout?(l(),u("div",Vt,[g(t(Ne),{severity:"danger",value:c.$t("common.soldout")},null,8,["value"])])):q("",!0)],2)):q("",!0),p.subItems.length!==0?(l(!0),u(B,{key:1},se(p.subItems,(f,I)=>(l(),u(B,{key:"index"},[!f.disable&&U(f)?(l(),u("div",jt,[e("div",Ot,[e("div",Ft,[e("span",Wt,n(f.subname),1),!f.discount&&f.price!=="0.00"&&f.price!=="0"?(l(),u("span",zt,"â‚¬"+n(f.price),1)):q("",!0),f.discount?(l(),u("div",Ht,[e("span",Bt,"â‚¬"+n(f.dis_price),1),e("span",Qt,"â‚¬"+n(f.price),1),g(t(Ne),{severity:"danger",value:"-"+f.discount+"%"},null,8,["value"])])):q("",!0)]),f.soldout?q("",!0):(l(),u("div",Gt,[g(t(P),{icon:"pi pi-minus",rounded:"",disabled:f.quantity<=0,onClick:z=>f.quantity--,class:"w-2rem h-2rem"},null,8,["disabled","onClick"]),e("span",Kt,n(f.quantity),1),g(t(P),{icon:"pi pi-plus",rounded:"",onClick:z=>f.quantity++,class:"w-2rem h-2rem",disabled:N(f)},null,8,["onClick","disabled"])])),f.soldout?(l(),u("div",Jt,[g(t(Ne),{severity:"danger",value:c.$t("common.soldout")},null,8,["value"])])):q("",!0)])])):q("",!0)],64))),128)):q("",!0)])])):q("",!0)],64)}),128))]),g(t(ve),{visible:G.value,"onUpdate:visible":C[2]||(C[2]=p=>G.value=p),modal:"",header:" ",style:qe([{width:"23rem"},{width:"80vw","max-width":"700px"}]),pt:{header:{class:"p-1"}}},{default:S(()=>[e("div",Xt,[e("span",Yt,n(j.value.name),1)]),e("div",Zt,[e("span",es,n(j.value.note),1)]),e("div",ts,[e("div",ss,[e("img",{class:"w-full h-auto object-contain",src:j.value.image,alt:j.value.name,onError:ie,onLoad:ne},null,40,ls)])]),e("div",as,[(l(!0),u(B,null,se(j.value.allergies,(p,d)=>(l(),u("img",{src:"images/"+p+".png",alt:p,class:"w-2rem h-2rem border-round flex-shrink-0",style:{"object-fit":"cover","min-width":"2rem"}},null,8,ns))),256)),e("div",os,[e("button",{onClick:C[0]||(C[0]=p=>b(j.value)),class:"p-0 border-none bg-transparent cursor-pointer"},[e("i",{class:de(["pi pi-thumbs-up text-xl",_.likedItemsRef.includes(j.value)?"text-green-500":"text-gray-400"])},null,2)]),e("button",{onClick:C[1]||(C[1]=p=>V(j.value)),class:"p-0 border-none bg-transparent cursor-pointer"},[e("i",{class:de(["pi pi-thumbs-down text-xl",_.dislikedItemsRef.includes(j.value)?"text-red-500":"text-gray-400"])},null,2)])])])]),_:1},8,["visible"])],64))}},rs=$e(is,[["__scopeId","data-v-704e6bd0"]]),us={key:0,class:"text-3xl font-bold"},cs={class:"flex flex-column gap-3 p-1"},ds={key:0,class:"flex flex-column gap-1"},ms={key:0,class:"m-0"},fs={key:0,class:"m-0"},vs={class:"flex justify-content-between gap-4 mt-1"},hs={class:"flex align-items-center gap-2"},ps=["src","alt"],gs={class:"flex-grow-1 min-width-0 max-w-18rem"},ys={class:"flex flex-column gap-1"},_s={class:"flex align-items-center gap-2"},bs={class:"text-xl font-bold line1 whitespace-nowrap overflow-hidden text-overflow-ellipsis",style:{"max-width":"20rem"}},xs={class:"flex align-items-end gap-1"},ks={key:0,class:"text-xl font-bold text-primary"},ws={key:1,class:"text-xl font-bold text-primary"},$s={key:2,class:"text-sm text-color-secondary"},Ds={key:0,class:"text-xs text-primary"},Cs={class:"flex-shrink-0 flex flex-wrap justify-content-between align-items-center gap-1"},Is={class:"flex flex-wrap justify-content-between align-content-center"},Ts={class:"flex align-items-center gap-1"},Ns={class:"w-2rem text-center"},qs={key:1,class:"flex flex-column gap-2 mt-2"},As={for:"in_label"},Ss={for:"in_label"},Ms={class:"bottom-0 left-0 mt-2"},Ls={class:"text-2xl font-bold"},Us={class:"text-2xl font-bold text-primary pl-2"},Rs={class:"flex justify-content-between"},Ps={class:"flex flex-column align-items-center gap-4 py-4"},Es={class:"text-center text-lg m-0"},Vs={__name:"Cart",props:{checkout:{type:Function,required:!0},isTakeaway:Boolean},setup(M,{expose:te}){const{locale:T}=me(),A=Ge(),{t:_}=me(),U=re.cartDishs,i=$([]),O=$(),N=$(),Z=$(!1),H=$(!1),J=$(!0),X=$(""),b=$(""),D=$(!1);let V=null,G=null;const j=fe(()=>{var o;return(o=h.table.value)==null?void 0:o.users},o=>{if(D.value&&o){const r=h.getActiveUser();if(r){const m=o.find(E=>E.id===r.id);m&&m.authorized&&(console.log("ç”¨æˆ·å·²èŽ·å¾—æŽˆæƒï¼Œè‡ªåŠ¨é‡æ–°ä¸‹å•..."),D.value=!1,V&&G&&C.checkout(V,G))}}},{deep:!0});lt(()=>{j&&j()});function ue(o,r,m){let E="";const le=T.value,ce=h.customDishAPI.getCustomDishByName(o);for(const ye of m){const De=ce.types[r].dishes.find(Se=>Se.dishid===ye.id)[`name_${le}`];E=E+De+"/"}return E}function ie(o,r){const m=T.value;return h.customDishAPI.getCustomDishByName(o).types[r][`typeName_${m}`]}const ne=(o,r)=>{const m=i.value[o].quantity+r;m>=0&&(i.value[o].quantity=m)};function oe(o){o&&O.value&&(O.value.dishNote=N.value?N.value:void 0),H.value=!1}function ee(){N.value&&(N.value=void 0),O.value&&(O.value=void 0)}function c(o){O.value=o,N.value=O.value.dishNote?O.value.dishNote:void 0,H.value=!0}const C=M;te({showDishList:o=>{Z.value=!0,i.value.length=0;for(let r=0;r<o.length;r++)i.value.push(o[r]);J.value=i.value.length==0&&U.length==0}});function d(o){re.removeItem(o)}function y(){C.isTakeaway?f():I()}function f(){const o=[];U.value.forEach(r=>{o.push(r)}),i.value.forEach(r=>{r.quantity>0&&o.push(r)}),o.length<=0?Q.show_warn(_("notification.select_at_least_one")):(Z.value=!1,A.push({path:"/paymentPage"}))}function I(){const o={name:X.value,note:b.value},r=m=>{if(m.success){U.value.forEach(E=>{E.dishNote=void 0}),i.value.forEach(E=>{E.dishNote=void 0}),b.value="",Y.cleanDishDataQty(),Ae.deleteCookie("cartDish_normal"),re.cleanAll(),Ae.deleteCookie("cartDish_custom"),Z.value=!1,D.value=!1;return}!m.success&&m.code===401&&(V=o,G=r,D.value=!0)};C.checkout(o,r)}function z(o){return o.subname!=""&&o.subname!="Default Title"?o.name+" "+o.subname:o.name}function x(){let o=0;return U.value.forEach(r=>{o+=r.discount?(r.dis_price?r.dis_price:0)*r.count:(r.price?r.price:0)*r.count}),i.value.forEach(r=>{o+=r.discount?(r.dis_price?r.dis_price:0)*r.quantity:(r.price?r.price:0)*r.quantity}),"â‚¬"+o.toFixed(2)}const k=o=>{o.target.src="/images/default.png"},F=o=>{const r=o.quantity;let m=3;return o.price>0&&(m=9),r>=m};return(o,r)=>(l(),u(B,null,[g(t(ve),{class:"bg-primary-reverse text-sm md:text-lg lg:text-xl",visible:Z.value,"onUpdate:visible":r[2]||(r[2]=m=>Z.value=m),modal:"",header:o.$t("common.cart"),style:qe([{backgroundColor:"rgba(250, 250, 250, 1)",height:"100%",minWidth:"24rem"},{width:"80vw","max-width":"700px"}]),dismissableMask:!0},{footer:S(()=>[e("div",Ms,[e("span",Ls,n(o.$t("common.total"))+": ",1),e("span",Us,n(x()),1),g(t(P),{icon:M.isTakeaway?"pi pi-wallet":"pi pi-plus",class:"p-button-success p-button-rounded ml-3",onClick:y,label:M.isTakeaway?t(_)("common.pay"):t(_)("common.send")},null,8,["icon","label"])])]),default:S(()=>[J.value?(l(),u("h2",us,"Cart is empty.")):q("",!0),e("div",cs,[(l(!0),u(B,null,se(t(U),(m,E)=>(l(),K(t(ut),{style:{overflow:"hidden"},key:E},{title:S(()=>[ge(n(o.$t(`common.${m.name}`)),1)]),subtitle:S(()=>[ge(n(o.$t("common.price"))+" : "+n(m.price)+"â‚¬",1)]),content:S(()=>[t(h).customDishAPI.customDishes.value.find(le=>le.name==m.name)?(l(),u("div",ds,[(l(!0),u(B,null,se(m.notesAndId,(le,ce)=>(l(),u("div",null,[m.notesAndId[ce].length!==0?(l(),u("span",ms,n(ie(m.name,ce))+": "+n(ue(m.name,ce,le)),1)):q("",!0)]))),256)),e("div",null,[m.dishNote?(l(),u("span",fs,n(o.$t("common.note"))+": "+n(m.dishNote),1)):q("",!0)])])):q("",!0)]),footer:S(()=>[e("div",vs,[M.isTakeaway?q("",!0):(l(),K(t(P),{key:0,label:t(_)("common.edit")+" "+t(_)("common.note"),severity:"contrast",onClick:le=>c(m)},null,8,["label","onClick"])),g(t(P),{label:t(_)("common.remove"),severity:"danger",onClick:le=>d(m)},null,8,["label","onClick"])])]),_:2},1024))),128)),(l(!0),u(B,null,se(i.value,(m,E)=>(l(),u("div",{key:E,class:"p-2 border-round shadow-1 transition-all transition-duration-200 hover:shadow-3 flex flex-column gap-1"},[e("div",hs,[e("img",{src:m.image,alt:m.name,class:"w-4rem h-4rem border-round flex-shrink-0",onError:k,style:{"object-fit":"cover","min-width":"4rem"}},null,40,ps),e("div",gs,[e("div",ys,[e("div",_s,[e("span",bs,n(z(m)),1)])]),e("div",xs,[m.discount?(l(),u("span",ks,"â‚¬"+n(Number(m.dis_price?m.dis_price:0).toFixed(2)),1)):q("",!0),m.discount?q("",!0):(l(),u("span",ws,"â‚¬"+n(Number(m.price?m.price:0).toFixed(2)),1)),m.price>0?(l(),u("span",$s,"/uni.")):q("",!0)])])]),e("div",null,[m.dishNote?(l(),u("span",Ds,n(t(_)("common.note")+": "+m.dishNote),1)):q("",!0)]),e("div",Cs,[e("div",Is,[M.isTakeaway?q("",!0):(l(),K(t(P),{key:0,label:t(_)("common.edit")+" "+t(_)("common.note"),severity:"contrast",class:"w-3.5rem h-2rem",onClick:le=>c(m)},null,8,["label","onClick"]))]),e("div",Ts,[g(t(P),{icon:"pi pi-minus",rounded:"",disabled:m.quantity<=0,onClick:le=>ne(E,-1),class:"w-2rem h-2rem"},null,8,["disabled","onClick"]),e("span",Ns,n(m.quantity),1),g(t(P),{icon:"pi pi-plus",rounded:"",disabled:F(m),onClick:le=>ne(E,1),class:"w-2rem h-2rem"},null,8,["disabled","onClick"])])])]))),128))]),M.isTakeaway?q("",!0):(l(),u("div",qs,[g(t(He),{variant:"in"},{default:S(()=>[g(t(Oe),{id:"in_label",modelValue:X.value,"onUpdate:modelValue":r[0]||(r[0]=m=>X.value=m),variant:"filled",maxlength:"20"},null,8,["modelValue"]),e("label",As,n(t(_)("common.name")),1)]),_:1}),g(t(He),{variant:"in"},{default:S(()=>[g(t(Be),{id:"in_label",class:"min-w-full",rows:"5",modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=m=>b.value=m),variant:"filled",maxlength:"200"},null,8,["modelValue"]),e("label",Ss,n(t(_)("common.observation")),1)]),_:1})]))]),_:1},8,["visible","header"]),g(t(ve),{visible:H.value,"onUpdate:visible":r[6]||(r[6]=m=>H.value=m),header:t(_)("common.note"),onHide:r[7]||(r[7]=m=>ee()),modal:"",dismissableMask:!0},{default:S(()=>[g(t(Be),{modelValue:N.value,"onUpdate:modelValue":r[3]||(r[3]=m=>N.value=m),rows:"5",cols:"30",placeholder:t(_)("common.edit")+" "+t(_)("common.note")+"...",maxlength:"100"},null,8,["modelValue","placeholder"]),e("div",Rs,[g(t(P),{label:t(_)("common.cancel"),severity:"danger",onClick:r[4]||(r[4]=m=>oe(!1))},null,8,["label"]),g(t(P),{label:t(_)("common.save"),severity:"primary",size:"sm",onClick:r[5]||(r[5]=m=>oe(!0))},null,8,["label"])])]),_:1},8,["visible","header"]),g(t(ve),{visible:D.value,"onUpdate:visible":r[9]||(r[9]=m=>D.value=m),modal:"",header:t(_)("notification.waiting_auth"),closable:!1,style:{width:"90vw","max-width":"400px"}},{default:S(()=>[e("div",Ps,[g(t(ct),{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".5s"}),e("p",Es,n(t(_)("notification.waiting_auth_msg")),1),g(t(P),{label:t(_)("notification.cancel_waiting"),severity:"secondary",onClick:r[8]||(r[8]=m=>D.value=!1),class:"w-full"},null,8,["label"])])]),_:1},8,["visible","header"])],64))}},js=$e(Vs,[["__scopeId","data-v-6dc4081a"]]);$([]);$("iniImages()");const Os={class:"m-3"},Fs={class:"flex flex-column gap-2"},Ws={class:"w-full flex justify-content-center"},zs={key:0,class:"max-w-19rem"},Hs=["src"],Bs={style:{width:"300px",height:"300px",background:"url(/boxImage/box.png)"}},Qs={key:0,class:"flex align-items-center justify-content-center text-4xl font-bold text-white w-full h-full"},Gs={key:1,class:"grid m-0 p-2"},Ks=["onClick"],Js={class:"flex align-items-center justify-content-center font-bold m-0 p-0",style:{width:"94px",height:"94px"}},Xs=["src"],Ys={class:"flex flex-wrap justify-content-between align-items-center m-1"},Zs={class:"flex gap-1 align-items-center"},el={key:0},tl={class:"font-bold mb-2"},sl={key:1,class:"flex justify-content-between gap-2 mt-3"},ll={class:"font-bold mb-2"},al={class:"flex mr-2"},nl={class:"w-3rem text-xl text-center"},ol={class:"font-bold block mb-2"},il={class:"flex flex-wrap"},rl={key:2,class:"flex flex-wrap gap-2 mt-3"},ul={class:"font-bold block mb-2"},cl={class:"font-bold block mb-2 text-center"},dl={class:"flex flex-wrap gap-2 mt-3"},ml={__name:"CustomDish",props:{currentCustomDish:Object,tabindex:Number},emits:["typeClick"],setup(M,{emit:te}){const{locale:T}=me(),A=M,_=dt(),{t:U}=me(),i=$(null);fe(()=>A.currentCustomDish,d=>{d&&(i.value=d)},{immediate:!0,deep:!0});const O=ae(()=>i.boxImages),N=$(0),Z=ae(()=>{var f,I,z;if(i.value==null)return 0;const d=h.isTakeaway();let y=d?((f=i.value)==null?void 0:f.initialDeliveryPrice)||((I=i.value)==null?void 0:I.initialPrice):(z=i.value)==null?void 0:z.initialPrice;for(const x of i.value.types??[])for(const k of x.dishes??[])k.selected&&(y+=d&&k.deliveryPrice||k.price);return Number(y).toFixed(2)}),H=te,J=$(null),X=ae(()=>{const d=T.value,y=`title_${d}`,f=`description_${d}`;return i.value==null?{}:i.value.descriptions.map(I=>({title:I[y],descriptions:I.descriptions.map(z=>z[f]),image:I==null?void 0:I.image}))}),b=ae(()=>{var f,I;const d=Number(((f=i.value)==null?void 0:f.like)??0),y=Number(((I=i.value)==null?void 0:I.rate)??0);return y?d/y*5:0});function D(d,y){const f=T.value;return d[`${y}_${f}`]}function V(d,y,f){const I=d[y];if(I.selected){I.selected=!1;return}else{const x=d.filter(k=>k.selected).length;if(f===1){c(d),I.selected=!0;return}x<f&&(I.selected=!0)}}function G(d,y,f){const I=d.dishes;H("typeClick",d,y,I[y].selected),V(I,y,f)}function j(d){return d.selected}function ue(){if(!C(i.value.types))return;const d=ne(i.value.types),y=oe(i.value.types);re.addItem({dishid:-1,name:i.value.name,category:A.currentCustomDish.category,count:N.value!==0?N.value:1,price:Z.value,notes:d,notesAndId:y}),console.log("CART: ",re.cartDishs),ee(i.value.types),Q.show({severity:"info",summary:"info",detail:U("customDishBibimbapVue.addToCartSuccessBibimbap")})}function ie(d){return!d||!d.dishes?"":d.dishes.filter(f=>f.selected).map(f=>f.name).join(",")}function ne(d){return d?d.map(y=>ie(y)):[]}function oe(d){return d?d.map(y=>y.dishes?y.dishes.filter(f=>f.selected).map(f=>({id:f.dishid,name:f.name})):[]):[]}function ee(d){d&&d.forEach(y=>{y.dishes&&y.dishes.forEach(f=>{f.selected=!1})})}function c(d){d.forEach(y=>y.selected=!1)}function C(d){if(i.value.options.quantity&&N.value<=0)return Q.show({severity:"warn",detail:U("notification.quantity_must_be_positive")}),!1;for(const y of d)if(y.dishes.filter(I=>I.selected).length<y.minQuantity){const I=y.typeName;return Q.show({severity:"warn",detail:U("notification.select_type_of",{name:I})}),!1}return!0}function p(d){d?h.customDishAPI.like(i.value.id)&&(J.value="like",_.add({severity:"success",summary:U("common.success"),detail:U("common.rate")+" "+U("common.success"),life:750})):h.customDishAPI.unLike(i.value.id)&&(J.value="unlike",_.add({severity:"success",summary:U("common.success"),detail:U("common.rate")+" "+U("common.success"),life:750}))}return(d,y)=>{var f,I,z,x,k,F;return l(),u("div",Os,[e("div",Fs,[g(t(je),{class:"w-full max-w-xl mx-auto"},{default:S(()=>[(l(!0),u(B,null,se(X.value,(o,r)=>(l(),K(t(Pe),{key:r,value:r},{default:S(()=>[g(t(Ee),null,{default:S(()=>[ge(n(o.title),1)]),_:2},1024),g(t(Ve),null,{default:S(()=>{var m;return[(l(!0),u(B,null,se(o.descriptions,(E,le)=>(l(),u("p",{key:le},n(E),1))),128)),e("div",Ws,[(m=o.image)!=null&&m.src?(l(),u("div",zs,[e("img",{src:o.image.src,class:"w-full"},null,8,Hs)])):q("",!0)])]}),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),((I=(f=i.value)==null?void 0:f.value)==null?void 0:I.name)==="MY BOX"?(l(),K(t(je),{key:0,class:"w-full max-w-xl mx-auto"},{default:S(()=>[g(t(Pe),{value:"0"},{default:S(()=>[g(t(Ee),null,{default:S(()=>[ge(" ðŸ¥© "+n(d.$t("common.showMybox")),1)]),_:1}),g(t(Ve),null,{default:S(()=>[e("div",Bs,[d.isEmptyArray(O.value)?(l(),u("div",Qs,n(d.$t("common.myboxAlarm")),1)):q("",!0),d.isEmptyArray(O.value)?q("",!0):(l(),u("div",Gs,[(l(!0),u(B,null,se(O.value,o=>(l(),u("div",{class:"col-4 p-0",onClick:r=>d.imageSelectAction(o)},[e("div",Js,[o?(l(),u("img",{key:0,class:"m-0 p-0",src:d.imagePath(o),style:{width:"82px",height:"82px"}},null,8,Xs)):q("",!0)])],8,Ks))),256))]))])]),_:1})]),_:1})]),_:1})):q("",!0)]),e("div",Ys,[e("div",Zs,[(l(),u(B,null,se(5,o=>e("i",{key:o,class:de(["pi invert-star",o<=Math.floor(b.value)?"pi-star-fill":o-.5<=b.value?"pi-star-half":"pi-star"]),style:{color:"black"}},null,2)),64)),e("p",null,"("+n((z=i.value)!=null&&z.rate?i.value.rate:0)+")",1)]),e("div",null,[g(t(P),{text:"",icon:"pi pi-thumbs-up",severity:J.value==="like"?"success":"",onClick:y[0]||(y[0]=o=>p(!0))},null,8,["severity"]),g(t(P),{text:"",icon:"pi pi-thumbs-down",severity:J.value==="unlike"?"danger":"",onClick:y[1]||(y[1]=o=>p(!1))},null,8,["severity"])])]),(x=i.value)!=null&&x.options.extraInfo?(l(),u("div",el,[e("label",tl,n(i.value.options.extraInfo),1)])):q("",!0),(k=i.value)!=null&&k.options.quantity?(l(),u("div",sl,[e("div",null,[e("label",ll,n(d.$t("common.quantity"))+" / "+n(d.$t("common.pieces")),1)]),e("div",al,[g(t(P),{icon:"pi pi-minus",disabled:N.value<=0,onClick:y[2]||(y[2]=o=>{var r;return N.value-=(r=i.value)==null?void 0:r.options.quantitySetp}),class:"w-2rem h-2rem"},null,8,["disabled"]),e("span",nl,n(N.value),1),g(t(P),{icon:"pi pi-plus",disabled:N.value>=i.value.options.maxQuantity,onClick:y[3]||(y[3]=o=>{var r;return N.value+=(r=i.value)==null?void 0:r.options.quantitySetp}),class:"w-2rem h-2rem"},null,8,["disabled"])])])):q("",!0),(l(!0),u(B,null,se((F=i.value)==null?void 0:F.types,(o,r)=>(l(),u("div",{key:o.id},[at(e("div",null,[e("label",ol,n(r+1)+". "+n(D(o,"typeName")),1),e("div",il,[(l(!0),u(B,null,se(o.dishes,(m,E)=>(l(),K(t(P),{key:E,onClick:le=>G(o,E,N.value==0?o.maxQuantity:o.maxQuantity*N.value),class:de([{"p-button-primary":j(m),"p-button-outlined":!j(m)},"m-1"])},{default:S(()=>[e("p",{class:de({"text-gray-700":!j(m)})},n(D(m,"name")),3)]),_:2},1032,["onClick","class"]))),128))])],512),[[nt,o.enable]])]))),128)),M.currentCustomDish.initialPrice!==0?(l(),u("div",rl,[e("label",ul,n(d.$t("common.price"))+":",1),e("label",cl,n(Z.value+"â‚¬"),1)])):q("",!0),e("div",dl,[g(t(P),{icon:"pi pi-shopping-cart",onClick:y[4]||(y[4]=o=>ue()),label:d.$t("common.addToCart"),class:"m-3",severity:"primary",raised:""},null,8,["label"])])])}}},fl=$e(ml,[["__scopeId","data-v-b0149620"]]),vl={key:0,class:"flex flex-column gap-4"},hl={class:"flex justify-content-center"},pl={key:0,class:"flex flex-column gap-3"},gl={class:"flex flex-column gap-1"},yl={class:"text-sm text-color-secondary"},_l={class:"text-lg font-semibold"},bl={class:"flex flex-column gap-1"},xl={class:"text-sm text-color-secondary"},kl={class:"text-lg"},wl={class:"flex flex-column gap-1"},$l={class:"text-sm text-color-secondary"},Dl={class:"text-lg"},Cl={key:0,class:"flex flex-column gap-1"},Il={class:"text-sm text-color-secondary"},Tl={class:"text-sm text-color-secondary"},Nl={key:1,class:"flex flex-column gap-3"},ql={class:"flex flex-column gap-1"},Al={class:"text-sm text-color-secondary"},Sl={key:0,class:"flex align-items-center justify-content-between"},Ml={class:"text-lg font-semibold"},Ll={key:1,class:"flex gap-2"},Ul={class:"flex flex-column gap-1"},Rl={class:"text-sm text-color-secondary"},Pl={class:"text-lg"},El={__name:"UserInfoDialog",props:{visible:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["update:visible"],setup(M,{emit:te}){const{t:T}=me(),A=M,_=te,U=$(!1),i=$(!1),O=$(""),N=ae(()=>{var b;return!!((b=A.user)!=null&&b.isGuest)});fe(()=>A.visible,b=>{b&&N.value&&(O.value=A.user.username,i.value=!1)});async function Z(){if(!O.value.trim()){Q.show_warn(T("common.auth.nameRequired"));return}const b=await h.updateGuestName(O.value);b.success?(Q.show_info(T("common.auth.updateSuccess")),i.value=!1):Q.show_error(b.message||T("common.failed"))}const H=ae(()=>{var D;if(!((D=A.user)!=null&&D.avatar_url))return null;const b=A.user.avatar_url;return b&&(b.startsWith("http://")||b.startsWith("https://")||b.startsWith("/"))?b:null});fe(()=>A.user,b=>{if(U.value=!1,b!=null&&b.avatar_url&&H.value){const D=new Image;D.onload=()=>{U.value=!1},D.onerror=()=>{U.value=!0,console.warn("Avatar image failed to load:",b.avatar_url)},D.src=H.value}},{immediate:!0});function J(){var b,D,V;return(b=A.user)!=null&&b.username?A.user.username.charAt(0).toUpperCase():(D=A.user)!=null&&D.display_name?A.user.display_name.charAt(0).toUpperCase():(V=A.user)!=null&&V.email?A.user.email.charAt(0).toUpperCase():"U"}function X(){_("update:visible",!1)}return(b,D)=>(l(),K(t(ve),{visible:M.visible,"onUpdate:visible":D[3]||(D[3]=V=>b.$emit("update:visible",V)),header:b.$t("common.auth.userInfo"),modal:!0,dismissableMask:!0,style:{width:"90vw",maxWidth:"30rem"}},{footer:S(()=>[g(t(P),{label:b.$t("common.cancel"),severity:"secondary",onClick:X},null,8,["label"])]),default:S(()=>[M.user?(l(),u("div",vl,[e("div",hl,[H.value&&!U.value?(l(),K(t(ke),{key:0,image:H.value,shape:"circle",size:"xlarge",class:"mb-3"},null,8,["image"])):(l(),K(t(ke),{key:1,label:J(),shape:"circle",size:"xlarge",class:"mb-3",style:{"background-color":"var(--primary-color)",color:"var(--primary-color-text)"}},null,8,["label"]))]),N.value?(l(),u("div",Nl,[e("div",ql,[e("label",Al,n(b.$t("common.auth.guestName")),1),i.value?(l(),u("div",Ll,[g(t(Oe),{modelValue:O.value,"onUpdate:modelValue":D[1]||(D[1]=V=>O.value=V),class:"flex-grow-1",autofocus:"",onKeyup:ot(Z,["enter"])},null,8,["modelValue"]),g(t(P),{icon:"pi pi-check",severity:"success",text:"",rounded:"",onClick:Z}),g(t(P),{icon:"pi pi-times",severity:"danger",text:"",rounded:"",onClick:D[2]||(D[2]=V=>i.value=!1)})])):(l(),u("div",Sl,[e("div",Ml,n(M.user.username||"-"),1),g(t(P),{icon:"pi pi-pencil",text:"",rounded:"",onClick:D[0]||(D[0]=V=>i.value=!0)})]))]),e("div",Ul,[e("label",Rl,n(b.$t("common.auth.role")),1),e("div",Pl,n(b.$t("common.auth.guest")),1)])])):(l(),u("div",pl,[e("div",gl,[e("label",yl,n(b.$t("common.auth.displayName")),1),e("div",_l,n(M.user.display_name||"-"),1)]),e("div",bl,[e("label",xl,n(b.$t("common.auth.email")),1),e("div",kl,n(M.user.email||"-"),1)]),e("div",wl,[e("label",$l,n(b.$t("common.auth.role")),1),e("div",Dl,n(M.user.role||"-"),1)]),M.user.id?(l(),u("div",Cl,[e("label",Il,n(b.$t("common.auth.userId")),1),e("div",Tl,n(M.user.id),1)])):q("",!0)]))])):q("",!0)]),_:1},8,["visible","header"]))}},Vl={class:"fixed top-0 left-0 w-full bg-primary-reverse",style:{"z-index":"10"}},jl={class:"grid mt-1 ml-1"},Ol={class:"h-3rem w-3rem flex align-items-center"},Fl=["src"],Wl={class:"flex align-items-center"},zl={key:0,class:"text-color font-bold p-1"},Hl={key:1,class:"text-color font-bold p-1"},Bl={class:"card flex mr-3 flex align-items-center gap-2",style:{"margin-left":"auto"}},Ql={key:0},Gl={key:1},Kl={style:{display:"flex","align-items":"center"}},Jl={style:{"flex-grow":"1",width:"0",overflow:"hidden"}},Xl={class:"mt-2"},Yl={class:"flex justify-content-end mt-2"},Zl={class:"flex inline-flex items-center justify-center gap-2"},ea={class:"flex align-items-center"},ta={class:"flex flex-column"},sa={class:"text-sm p-2"},la={class:"text-sm p-2"},aa={class:"flex items-center gap-4 mb-4 p-2"},na={class:"flex flex-column gap-3"},oa={__name:"HeaderTabs",props:{types:Array,typeIndex:Number,tableId:String,tabItems:Array},emits:["clickType","switchToWelcome"],setup(M,{emit:te}){const{t:T}=me(),A=$(!1),_=$(!1),U=$(!1),i=$(""),O=$(),N=$(!1),Z=ae(()=>!!h.getActiveUser()),H=ae(()=>h.authUser.value),J=ae(()=>h.guestUser.value),X=ae(()=>h.getActiveUser()),b=ae(()=>{var k;if(J.value||!((k=H.value)!=null&&k.avatar_url))return null;const x=H.value.avatar_url;return x&&(x.startsWith("http://")||x.startsWith("https://")||x.startsWith("/"))?x:null});fe(H,x=>{if(N.value=!1,x!=null&&x.avatar_url&&b.value){const k=new Image;k.onload=()=>{N.value=!1},k.onerror=()=>{N.value=!0,console.warn("Avatar image failed to load:",x.avatar_url)},k.src=b.value}},{immediate:!0});function D(){return h.getTable()}we(async()=>{i.value=await yt()});const V=$(),G=ae(()=>[{label:T("common.options"),items:[{label:T("common.pay"),icon:"pi pi-wallet",command:()=>{c()}},{label:T("common.call"),icon:"pi pi-user-plus",command:()=>{h.send_cmd(D(),{cmd:"call"},x=>{x.success?Q.show_info(T("notification.call_msg")):Q.show_warn(x.data)})}}]}]),j=x=>{V.value.toggle(x)},ue=x=>{ie.value.toggle(x)},ie=$(),ne=$(!1),oe=$(),ee=$();function c(){ne.value=!0}function C(){x(oe.value)?h.send_cmd(D(),{cmd:"pay",nif:oe.value,note:ee.value},k=>{k.success?(Q.show_info(T("notification.pay_msg")),ne.value=!1):Q.show_error(T("common.failed"))}):Q.show_warn(T("notification.cancel_msg"));function x(k){return!k||k.toString().length===9||k.toString().length===0}}function p(){ee.value&&(ee.value=void 0)}function d(){A.value=!0}const y=ae(()=>[{label:T("common.auth.userInfo"),icon:"pi pi-user",command:()=>{U.value=!0}},{separator:!0},{label:T("common.auth.logout"),icon:"pi pi-sign-out",command:()=>{h.logout(),Q.show_info(T("common.auth.logoutSuccess"))}}]);function f(x){O.value.toggle(x)}function I(){const x=X.value;return x!=null&&x.username?x.username.charAt(0).toUpperCase():x!=null&&x.display_name?x.display_name.charAt(0).toUpperCase():x!=null&&x.email?x.email.charAt(0).toUpperCase():"U"}function z(){var x;_.value=!1,Q.show_info(T("common.auth.loginSuccess")),console.log("Login success, user:",h.authUser.value),console.log("Avatar URL:",(x=h.authUser.value)==null?void 0:x.avatar_url)}return(x,k)=>(l(),u(B,null,[e("div",Vl,[e("div",jl,[e("div",Ol,[e("img",{src:i.value,class:"h-full w-full",onClick:k[0]||(k[0]=()=>x.$emit("switchToWelcome"))},null,8,Fl)]),e("div",Wl,[M.tableId?(l(),u("p",zl,n(x.$t("common.table"))+": "+n(M.tableId),1)):q("",!0),M.tableId?q("",!0):(l(),u("p",Hl,n(x.$t("common.takeAway")),1))]),e("div",Bl,[Z.value?(l(),u("div",Gl,[b.value?(l(),K(t(ke),{key:0,image:b.value,shape:"circle",size:"large",onClick:f,style:{cursor:"pointer"}},null,8,["image"])):(l(),K(t(ke),{key:1,label:I(),shape:"circle",size:"large",onClick:f,style:{cursor:"pointer","background-color":"var(--primary-color)",color:"var(--primary-color-text)"}},null,8,["label"])),g(t(Ue),{ref_key:"userMenu",ref:O,id:"user_menu",model:y.value,popup:!0},null,8,["model"])])):(l(),u("div",Ql,[g(t(P),{label:t(T)("common.auth.login"),icon:"pi pi-sign-in",onClick:k[1]||(k[1]=F=>_.value=!0)},null,8,["label"])])),M.tableId?(l(),K(t(P),{key:2,icon:"pi pi-bell",rounded:"","aria-label":"Filter",onClick:j,"aria-haspopup":"true","aria-controls":"overlay_menu"})):(l(),K(t(P),{key:3,icon:"pi pi-question",rounded:"",onClick:d})),g(t(Ue),{ref_key:"menu",ref:V,id:"overlay_menu",model:G.value,popup:!0},null,8,["model"])])]),e("div",Kl,[e("div",null,[g(t(P),{icon:"pi pi-bars",variant:"text",rounded:"","aria-label":"Filter",onClick:ue,"aria-haspopup":"true","aria-controls":"tab_menu"}),g(t(Ue),{ref_key:"tabMenu",ref:ie,id:"tab_menu",model:M.tabItems,popup:!0},null,8,["model"])]),e("div",Jl,[g(t(vt),{value:M.typeIndex,scrollable:"",showNavigators:!1},{default:S(()=>[g(t(mt),null,{default:S(()=>[(l(!0),u(B,null,se(M.types,(F,o)=>(l(),K(t(ft),{value:o,onClick:()=>x.$emit("clickType",o),class:"text-sm md:text-lg lg:text-xl"},{default:S(()=>[ge(n(F),1)]),_:2},1032,["value","onClick"]))),256))]),_:1})]),_:1},8,["value"])])])]),g(t(ve),{visible:ne.value,"onUpdate:visible":k[5]||(k[5]=F=>ne.value=F),header:"ç»“è´¦",class:"flex flex-column",modal:!0,dismissableMask:!0,onHide:p},{default:S(()=>[e("div",null,[k[9]||(k[9]=e("label",null,"NIF:",-1)),g(t(ht),{modelValue:oe.value,"onUpdate:modelValue":k[2]||(k[2]=F=>oe.value=F),inputId:"withoutgrouping",useGrouping:!1,fluid:"",class:"w-full m-1"},null,8,["modelValue"])]),e("div",Xl,[e("label",null,n(x.$t("common.note"))+":",1),g(t(Oe),{type:"text",modelValue:ee.value,"onUpdate:modelValue":k[3]||(k[3]=F=>ee.value=F),class:"w-full m-1"},null,8,["modelValue"])]),e("div",Yl,[g(t(P),{label:t(T)("common.send"),onClick:k[4]||(k[4]=F=>C())},null,8,["label"])])]),_:1},8,["visible"]),g(t(ve),{visible:A.value,"onUpdate:visible":k[6]||(k[6]=F=>A.value=F),modal:"",dismissableMask:"",class:"h-full",style:{width:"90vw",maxWidth:"40rem",minWidth:"20rem"},draggable:!1},{header:S(()=>[e("div",Zl,[g(t(ke),{icon:"pi pi-question",shape:"circle"}),e("span",ea,n(t(T)("takeawayHelper.dialogTitle")),1)])]),default:S(()=>[e("div",ta,[e("span",sa,n(t(T)("takeawayHelper.introduction")),1),e("span",la,n(t(T)("takeawayHelper.note_t"))+" "+n(t(T)("takeawayHelper.note_1")),1),e("div",aa,[g(t(je),{class:"w-full max-w-xl mx-auto"},{default:S(()=>[g(t(Pe),{value:"0"},{default:S(()=>[g(t(Ee),{class:"text-sm"},{default:S(()=>[ge(n(t(T)("takeawayHelper.question_1")),1)]),_:1}),g(t(Ve),{class:"p-1"},{default:S(()=>[e("div",na,[e("span",null,n(t(T)("takeawayHelper.q_1_request_1")),1),e("span",null,n(t(T)("takeawayHelper.q_1_request_2")),1),e("span",null,n(t(T)("takeawayHelper.q_1_request_3")),1),e("span",null,n(t(T)("takeawayHelper.q_1_request_4")),1),e("span",null,n(t(T)("takeawayHelper.q_1_request_5")),1)])]),_:1})]),_:1})]),_:1})])])]),_:1},8,["visible"]),g(Ke,{visible:_.value,"onUpdate:visible":k[7]||(k[7]=F=>_.value=F),onLoginSuccess:z},null,8,["visible"]),g(El,{visible:U.value,"onUpdate:visible":k[8]||(k[8]=F=>U.value=F),user:X.value},null,8,["visible","user"])],64))}},ia={__name:"SwipeHint",props:{size:{type:String,default:"8rem"},duration:{type:Number,default:6e3},position:{type:String,default:"bottom"}},setup(M){const te=M,T=$(!0);we(()=>{te.duration>0&&setTimeout(()=>{T.value=!1},te.duration);const _=()=>{T.value=!1,window.removeEventListener("touchstart",_)};window.addEventListener("touchstart",_)});const A=ae(()=>{let _={left:"50%",transform:"translateX(-50%)",zIndex:99999,opacity:.5,pointerEvents:"none",textAlign:"center",position:"fixed"};return te.position==="top"?_.top="15%":te.position==="center"?(_.top="50%",_.transform="translate(-50%, -50%)"):_.bottom="15%",_});return(_,U)=>T.value?(l(),u("div",{key:0,class:"swipe-hint",style:qe(A.value)},[e("div",{class:"hand",style:qe({width:M.size,height:M.size,backgroundImages:"url(/images/hand_finger.png)"})},null,4)],4)):q("",!0)}},ra=$e(ia,[["__scopeId","data-v-30a48de8"]]),ua={class:"w-full h-full flex flex-column p-1"},ca={class:"swiper-container-wrapper"},da={class:"fixed bottom-0 left-0 w-full h-3rem bg-primary-reverse p-3 z-[9999]"},ma={class:"h-full flex align-items-center justify-content-between w-full"},fa={class:"m-2"},va={class:"m-2"},ha={class:"m-2"},pa={style:{"max-height":"60vh","overflow-y":"auto","padding-bottom":"60px"}},ga={class:"flex flex-column border-bottom-1"},ya={key:0,class:"flex justify-content-between"},_a={class:"flex flex-column"},ba={class:"font-bold"},xa={class:"text-right"},ka={key:1,class:"flex justify-content-between"},wa={class:"flex flex-column"},$a={class:"font-bold"},Da={class:"text-right"},Ca={key:0},Ia={key:1,class:"flex flex-column"},Ta={class:"flex flex-column"},Na={class:"font-bold"},qa={class:"text-right"},Aa={class:"total-footer bg-primary-reverse"},Sa={__name:"HomePage",setup(M){const te=Ge(),T=rt(),{t:A}=me(),{locale:_}=me(),U=$(0),i=$(!1),O=$([""]),N=$(0),Z=re.cartItemCount,H=$(!1),J=$(!1),X=$([]),b=$(0),D=$({}),V=$(!1),G=Y.dishDatas,j=$(h.getOrderMenuTab()),ue=$(null),ie=$(null),ne=$([]),oe=$([]),ee=$([]),c=$(!1);let C=null;const p=s=>{N.value=s.activeIndex,ye()},d=s=>{C=s};fe(N,s=>{C&&C.activeIndex!==s&&C.slideTo(s);let a=h.getOrderMenuTab()[s];h.customDishAPI.customDishes.value.map(w=>w.name).includes(a)?(V.value=!0,D.value=h.customDishAPI.customDishes.value.find(w=>w.name==a)):V.value=!1});const y=(s,a,v,w)=>{h.rateDish(s,a,v),w&&Q.show_success(A("notification.rating_submitted"))},f=(s,a,v)=>{if(D.value.name=="XIAOXIONGÂ® RAMEN"&&s.id===1){const w=s.dishes[a];let L;w.dishid==47?v?L=I(3,!0,1):L=I(3,!1,1):L=I(3,!0,1),L!==void 0&&z(L)}if(D.value.name=="Menu AlmoÃ§o"&&s.id===3){const w=s.dishes[a];let L;[1427,41].includes(w.dishid)?v?L=I(4,!0,0):L=I(4,!1,0):L=I(4,!0,0),L!==void 0&&z(L)}};function I(s,a,v){if(D.value={...D.value,types:D.value.types.map(w=>w.id===s?{...w,enable:a,minQuantity:a?v:0}:w)},a===!1)return s}function z(s){!D.value||!Array.isArray(D.value.types)||(D.value={...D.value,types:D.value.types.map(a=>a.id===s?{...a,dishes:a.dishes.map(v=>({...v,selected:!1}))}:a)})}function x(s){let a=h.getOrderMenuTab()[s];if(h.customDishAPI.customDishes.value.map(R=>R.name).includes(a)?(V.value=!0,D.value=h.customDishAPI.customDishes.value.find(R=>R.name==a)):V.value=!1,h.getMenu().length==0){console.log("exit");return}let L=G.value[s].mainDishes;Y.showDishList(L)}const k=()=>{h.refreshTableFromServer(),h.getTableTotalAmount(b),H.value=!0},F=s=>{let a=s.id;s.org_id&&(a=s.org_id);for(let v=0;v<G.value.length;v++)if(G.value[v].id==a)for(const w in s){let L=w;w.startsWith("note")&&(L=L.replace("note","description")),G.value[v][L]=s[w]}};function o(){return new Promise(s=>{let a=()=>{const v=h.formatedMenu.value;v.length>0?s(v):setTimeout(a,200)};a()})}function r(){return new Promise(s=>{let a=()=>{const v=h.getOrderMenuTab();v.length>0?s(v):setTimeout(a,200)};a()})}const m=ae(()=>s=>{const a=h.dictinaryAPI.dictinary.value.find(v=>v.refName===s);return a?a[`text_${_.value.toLowerCase()}`]:s});fe([()=>h.formatedMenu.value,()=>_.value],([s,a])=>{if(!s||s.length===0){ee.value=[];return}const v={};h.orderMenuTab.value;const w=s.map(_e=>({..._e,mainDishes:_e.dishes.map(be=>{const W=be.dish;if(v[W.id])return v[W.id];const pe={...W,defaultName:W.name,defaultSubname:W.subname,name:E(W,"name",a),note:E(W,"note",a),subname:E(W,"subname",a),quantity:0},he=be.subItems.map(We=>{const Te=We;return{...We,defaultName:W.name,defaultSubname:Te.subname,name:E(Te,"name",a),note:E(Te,"note",a),subname:E(Te,"subname",a),quantity:0}}),xe={...be,dish:pe,subItems:he};return v[xe.id]=xe,xe})}));G.value.length;const L=Y.getAllIncrementedDish();Y.getIdsAndQuantity(L);const R=re.cartDishs.value;Re.compressToEncodedURIComponent(JSON.stringify(R)),ee.value=w,G.value=ee.value,O.value=h.orderMenuTab.value,(L.length>0||R.length>0)&&(Y.cleanDishDataQty(),Y.updateDishDataQty(L)),h.filterMenuTabs(c.value),console.log("languagedMenu updated via watch:",ee.value),ze(()=>{U.value++,C&&typeof C.updateDictionaryWord=="function"&&(C.updateDictionaryWord(),C.slideTo(N.value))})},{immediate:!0,deep:!0}),fe(()=>h.orderMenuTab.value,s=>{j.value=s.map(a=>{const v=h.dictinaryAPI.dictinary.value.find(w=>w.refName===a);return v?v[`text_${_.value.toLowerCase()}`]:a}),X.value=ce(s),N.value=0}),we(()=>{const s=h.orderMenuTab.value;j.value=s.map(a=>{const v=h.dictinaryAPI.dictinary.value.find(w=>w.refName===a);return v?v[`text_${_.value.toLowerCase()}`]:a}),X.value=ce(s),N.value=0});function E(s,a,v){return s?v==="en"?s[`${a}_en`]||s[a]:v==="zh"&&s[`${a}_cn`]||s[a]:""}async function le(){await o();const s=await r();h.onMenuItemChanged=F,et(),X.value=ce(s)}function ce(s){const a=[];for(let v=0;v<s.length;v++){const w=v;a.push({label:m.value(s[v]),command:()=>{De(w),ye()}})}return a}const ye=()=>{ze(()=>{const s=document.querySelector(".p-tablist-viewport"),a=document.querySelector(".p-tab.p-tab-active");if(s&&a){const v=a.offsetLeft-s.offsetWidth/2+a.offsetWidth/2;s.scrollTo({left:v,behavior:"smooth"})}window.scrollTo({top:0,behavior:"smooth"})})},De=s=>{x(s),N.value=s,ye()},Se=()=>{var s=Y.getAllIncrementedDish();ie.value.showDishList(s)};function Me(){return h.getTable()}h.params.port,ue.value=h.table.value.order;const Je=(s,a)=>{const v=localStorage.getItem("lastOrderTime"),w=h.getShopInfo("orderCoolingTime")||0;if(v&&w>0){const pe=(Date.now()-parseInt(v))/1e3;if(pe<w){const he=Math.ceil(w-pe);return Q.show_warn(A("notification.too_fast",{remainTime:he})),!1}}const L=[];for(let W=0;W<re.cartDishs.value.length;W++){var R=re.cartDishs.value[W];const pe=h.formateCustomDishNotes(R),he=R.dis_count?R.dis_price:R.price;L.push({dishid:R.dishid,name:R.name,quantity:R.count,notes:pe,limit:R.limit,price:he,dishNote:R.dishNote,category:R.category})}const _e=Y.getAllIncrementedDish();for(let W=0;W<_e.length;W++){var R=_e[W];if(R.quantity>0){const he=R.dis_count?R.dis_price:R.price,xe=h.getDishNameDefaultName(R);L.push({dishid:R.id,name:xe,quantity:R.quantity,limit:R.limit,price:he,dishNote:R.dishNote})}}if(L.length===0)return Q.show_warn(A("notification.select_at_least_one")),!1;if(h.settings.value.useAuth&&h.params.table&&!h.getActiveUser())return J.value=!0,!1;const be=Date.now().toString(36)+Math.random().toString(36).substring(2,5);return i.value=!0,h.submit_order({uniCode:be,name:s.name,note:s.note,table:Me(),items:L},W=>{!W.success&&W.code===401&&Q.show_warn(A("notification.unauthorized_wait")),W.success||(i.value=!1),a(W)}),!0};function Xe(){const s=Ae.getCookie("language");s&&(_.value=s)}function Fe(){for(let s=0;s<G.value.length;s++){const a=G.value[s];a.quantity=0}i.value=!1,re.cleanAll()}const Ye=()=>{J.value=!1,Q.show_success(A("notification.login_success"))};we(async()=>{Xe(),h.settings.value.useAuth&&h.params.table&&setTimeout(()=>{h.getActiveUser()||(J.value=!0)},500),await le(),x(N.value),h.clear_order_data=()=>{Fe()},h.setOnOrderConfirmed(s=>{localStorage.setItem("lastOrderTime",Date.now()),Fe();const a=s;Q.show_success(A("notification.order_submitted",{id:a}))}),h.setOnShowError(s=>{i.value=!1;let a=s;if(typeof s=="string"&&s.startsWith("COOLING_LIMIT:")){const v=s.split(":");v.length===3&&(a=A("notification.order_cooling_wait",{coolingTime:v[1],remaining:v[2]}))}Q.show_error(A("notification.order_failed")+": "+a)})});function Ze(){Ae.deleteCookie("login_time");const s=T.query.table;s?te.push({path:"/",query:{table:s}}):te.push({path:"/takeReserve"})}async function Ce(s,a=!0){const v=a?re.cartDishs.value:Y.getIdsAndQuantity(Y.getAllIncrementedDish()),w=Re.compressToEncodedURIComponent(JSON.stringify(v));try{await Qe.setItem(s,w)}catch(L){console.error("ä¿å­˜åˆ° localForage å¤±è´¥:",L)}}function Le(){h.isTakeaway()?(Ce("take_cartDish_normal",!1),Ce("take_cartDish_custom",!0)):(Ce("cartDish_normal",!1),Ce("cartDish_custom",!0))}async function Ie(s,a=!0){try{const v=await Qe.getItem(s);if(!v)return;const w=JSON.parse(Re.decompressFromEncodedURIComponent(v));w&&w!=="undefined"&&(a?re.cartDishs.value=w:Y.updateDishDataQty(w))}catch(v){console.error("ä»Ž localForage è¯»å–å¤±è´¥æˆ–è§£æžå¤±è´¥:",v)}}function et(){h.isTakeaway()?(Ie("take_cartDish_normal",!1),Ie("take_cartDish_custom")):(Ie("cartDish_normal",!1),Ie("cartDish_custom"))}return it(()=>{Le()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&Le()}),window.addEventListener("beforeunload",s=>{Le(),h.cleanup()}),(s,a)=>(l(),u(B,null,[e("div",ua,[(l(),K(oa,{key:U.value,types:j.value,typeIndex:N.value,tabItems:X.value,tableId:Me(),onClickType:De,onSwitchToWelcome:Ze},null,8,["types","typeIndex","tabItems","tableId"])),a[5]||(a[5]=e("div",{class:"pb-8"},null,-1)),a[6]||(a[6]=e("div",{class:"pb-4 sm:pb-5 md:pb-5 lg:pb-5"},null,-1)),g(ra,{duration:3e3,position:"center",size:"3rem"}),e("div",ca,[(l(),K(t(_t),{key:`swiper-${j.value.length}-${U.value}`,"space-between":20,"centered-slides":"","grab-cursor":!0,class:"w-full",autoHeight:!0,onSlideChange:p,onSwiper:d,"initial-slide":N.value},{default:S(()=>[(l(!0),u(B,null,se(j.value,(v,w)=>(l(),K(t(bt),{key:w},{default:S(()=>[Math.abs(N.value-w)<=1&&(!V.value||N.value!==w)?(l(),K(rs,{key:0,rateDish:y,likedItemsRef:ne.value,dislikedItemsRef:oe.value,tabIndex:w,onlyVeg:c.value},null,8,["likedItemsRef","dislikedItemsRef","tabIndex","onlyVeg"])):Math.abs(N.value-w)<=1&&V.value&&N.value===w?(l(),K(fl,{key:1,currentCustomDish:D.value,onTypeClick:f,tabindex:w},null,8,["currentCustomDish","tabindex"])):q("",!0)]),_:2},1024))),128))]),_:1},8,["initial-slide"]))]),a[7]||(a[7]=e("div",{style:{height:"60px"}},null,-1)),e("div",da,[e("div",ma,[e("div",fa,[t(h).isTakeaway()?q("",!0):(l(),K(t(P),{key:0,label:s.$t("common.orders"),icon:"pi pi-list",class:"p-button-secondary",onClick:k},null,8,["label"]))]),e("div",va,[g(t(pt),{class:"text-sm",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=v=>c.value=v),onLabel:t(A)("common.showAll"),offLabel:t(A)("common.showOnlyVegetables"),onClick:a[1]||(a[1]=v=>t(h).filterMenuTabs(c.value))},null,8,["modelValue","onLabel","offLabel"])]),e("div",ha,[g(t(gt),{value:t(Z),severity:"danger",onClick:Se},{default:S(()=>a[4]||(a[4]=[e("i",{class:"pi pi-shopping-cart",style:{"font-size":"2rem"}},null,-1)])),_:1,__:[4]},8,["value"])])])])]),g(js,{ref_key:"cartRef",ref:ie,checkout:Je,isTakeaway:!Me()},null,8,["isTakeaway"]),g(t(ve),{visible:H.value,"onUpdate:visible":a[2]||(a[2]=v=>H.value=v),header:s.$t("common.completedOrders"),modal:"",style:{width:"80vw","max-width":"700px"}},{default:S(()=>{var v,w;return[e("div",pa,[e("div",ga,[(v=b.value.adultPrice)!=null&&v.quantity&&b.value.adultPrice.quantity!=0?(l(),u("div",ya,[e("div",_a,[e("span",ba,n(s.$t("common.adult")),1),e("small",null,n(s.$t("common.quantity"))+": "+n(b.value.adultPrice.quantity),1)]),e("div",xa,[e("span",null,"â‚¬"+n((Number(b.value.adultPrice.price)*b.value.adultPrice.quantity).toFixed(2)),1)])])):q("",!0),(w=b.value.childrenPrice)!=null&&w.quantity&&b.value.childrenPrice.quantity!=0?(l(),u("div",ka,[e("div",wa,[e("span",$a,n(s.$t("common.children")),1),e("small",null,n(s.$t("common.quantity"))+": "+n(b.value.childrenPrice.quantity),1)]),e("div",Da,[e("span",null,"â‚¬"+n((Number(b.value.childrenPrice.price)*b.value.childrenPrice.quantity).toFixed(2)),1)])])):q("",!0)]),t(h).table.value.order.length===0?(l(),u("div",Ca,n(s.$t("common.noOrders")),1)):(l(),u("div",Ia,[(l(!0),u(B,null,se(t(h).table.value.order,(L,R)=>(l(),u("div",{key:R,class:"flex justify-content-between border-bottom-1 pb-2"},[e("div",Ta,[e("span",Na,n(t(h).getDishName(L)),1),e("small",null,n(s.$t("common.quantity"))+": "+n(L.quantity),1)]),e("div",qa,[e("span",null,"â‚¬"+n((L.price*L.quantity).toFixed(2)),1)])]))),128))]))]),e("div",Aa,n(s.$t("common.total"))+": â‚¬"+n(b.value.total),1)]}),_:1},8,["visible","header"]),g(Ke,{visible:J.value,"onUpdate:visible":a[3]||(a[3]=v=>J.value=v),onLoginSuccess:Ye},null,8,["visible"])],64))}},Oa=$e(Sa,[["__scopeId","data-v-59e93568"]]);export{Oa as default};
