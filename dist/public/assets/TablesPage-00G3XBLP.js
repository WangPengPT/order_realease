import{s as H}from"./index-Bs7PK4L7.js";import{a as ee,s as le}from"./index-f9alCN6r.js";import{b as L}from"./index-Cf1xqoVV.js";import{h as _,f as q,o as T,w as y,a as i,d as s,c as E,e as C,F as z,C as te,t as B,z as F,x as ae,u as K,E as W,q as Q,i as se,G as ie,A as P,l as ne,n as O,H as I}from"./index-BZk1WzeF.js";import{s as oe}from"./index-NzYoxG7k.js";import{d as X,a as re,s as ue}from"./index-CQlhH8Xi.js";import{s as de}from"./index-h5zgMMD6.js";import{s as ce}from"./index-DzV0RDjI.js";import{s as pe}from"./index-sRrGFFXH.js";import{Q as ve,C as J}from"./CodeMaker-IOgtdCDu.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as fe}from"./index-Cc-zLFtW.js";import"./index-D_gKEM_d.js";import"./index-C2Ng2Nts.js";import"./index-BxFPhagj.js";import"./index-C3SaQNDS.js";import"./index-DBlQvM8A.js";import"./index-Dy1lOUzY.js";import"./index-gJr80cEC.js";import"./_commonjsHelpers-gnU0ypJ3.js";const be={class:"p-menuitem-content"},ye={__name:"TableMenuBar",props:{filterStatu:String},setup(V){const M=_([{label:"全部",value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:"空闲",value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:"用餐",value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:"预定",value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:"已付",value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(x,d)=>{const m=L,b=oe;return T(),q(b,{model:M.value,breakpoint:"355px",class:"border-0"},{item:y(({item:r})=>[i("div",be,[s(m,{label:r.label,icon:r.icon,severity:r.severity,variant:"outlined",raised:"",onClick:w=>x.$emit("update:filterStatu",r.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},Te={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},ge={class:"grid m-2"},_e={class:"flex justify-content-center align-items-center w-100"},xe={class:"relative"},we={class:"text-center text-2xl font-bold"},he={key:0},ke={class:"text-center"},Ce={class:"text-center text-lg"},$e={class:"text-center text-lg font-bold"},Oe={key:1,class:"flex flex-wrap justify-content-center"},Se={class:"flex flex-wrap justify-content-end mt-3"},Ne={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(V,{emit:M}){const x=_(!1),d=_(),m=_([{label:"空闲",value:"Livre"},{label:"用餐",value:"Ocupado"},{label:"预定",value:"Reservado"},{label:"已付",value:"Pago"}]);function b(p){return m.value.find(o=>o.value===p)}function r(p){return Number(p.peopleType.children)+Number(p.peopleType.adults)}function w(p){return!p||!Array.isArray(p)?0:parseFloat(p.reduce((o,g)=>o+g.price*g.quantity,0).toFixed(2))}function D(p){const o="m-1 border-3 border-gray-500 ";let g="";switch(p){case"Livre":break;case"Ocupado":g="border-red-300 bg-red-100";break;case"Reservado":g="border-blue-300 bg-blue-100";break;case"Pago":g="border-purple-300 bg-purple-100";break;default:g="border-gray-500 bg-gray-100"}return o+g}function a(p,o){p["msg_"+o]=!1,client.socket.emit("click_msg",p.id,o)}return(p,o)=>{const g=L,S=de,A=X,U=H;return T(),E(z,null,[i("div",Te,[i("div",ge,[V.editMode?(T(),q(S,{key:0,class:"m-1 border-3 border-gray-500 flex justify-content-center align-items-center",style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:o[0]||(o[0]=v=>x.value=!0)},{content:y(()=>[i("div",_e,[s(g,{text:"",icon:"pi pi-plus",severity:"contrast",size:"large"})])]),_:1})):C("",!0),(T(!0),E(z,null,te(V.filteredTables,v=>(T(),q(S,{class:ae(D(v.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:N=>V.editMode?"":p.$emit("openTableDetail",v.id)},{header:y(()=>[i("div",xe,[v.msg_pay?(T(),q(g,{key:0,onClick:F(N=>a(v,"pay"),["stop"]),icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"}},null,8,["onClick"])):C("",!0),v.msg_call?(T(),q(g,{key:1,onClick:F(N=>a(v,"call"),["stop"]),icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"}},null,8,["onClick"])):C("",!0)])]),content:y(()=>[i("p",we,"桌号: "+B(v.id),1),V.editMode?C("",!0):(T(),E("div",he,[i("p",ke,B(b(v.status).label),1),i("p",Ce,B(r(v))+"人",1),i("p",$e,B(w(v.order))+"€",1)])),V.editMode?(T(),E("div",Oe,[s(g,{icon:"pi pi-trash",severity:"danger",outlined:"",raised:"",class:"m-2",onClick:F(N=>p.$emit("removeTable",v.id),["stop"])},null,8,["onClick"])])):C("",!0)]),_:2},1032,["class","onClick"]))),256))])]),s(U,{visible:x.value,"onUpdate:visible":o[3]||(o[3]=v=>x.value=v),modal:!0,dismissableMask:!0,header:"添加桌子",onHide:o[4]||(o[4]=v=>d.value=void 0)},{default:y(()=>[s(A,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=v=>d.value=v),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:d.value<10?"桌号：0":"桌号：",step:1,min:"1",max:"9999",placeholder:"输入桌号",fluid:""},{incrementbuttonicon:y(()=>o[5]||(o[5]=[i("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:y(()=>o[6]||(o[6]=[i("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix"]),i("div",Se,[s(g,{label:"创建桌子",onClick:o[2]||(o[2]=v=>{p.$emit("addNewTable",d.value),x.value=!1})})])]),_:1},8,["visible"])],64)}}},Ee={class:"flex flex-column justify-content-center align-items-center"},Ve={key:0,class:"flex flex-wrap justify-content-center align-items-center"},De={key:1,class:"flex flex-wrap justify-content-center align-items-center"},je={class:"flex flex-wrap justify-content-center align-items-center m-2"},qe={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},Me={class:"m-2"},Be={key:0,class:"flex flex-wrap justify-content-between align-items-center"},Ae={key:1,class:"flex flex-wrap justify-content-between align-items-center"},Ue={class:"flex flex-column"},Re={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(V,{emit:M}){let x=!1;const d=K(),m=_(!1),b=_(!1),r=V,w=M;function D(){w("onEdit",r.selectedTable.id,l=>{a.value=JSON.parse(JSON.stringify(l)),m.value=!0})}const a=_(JSON.parse(JSON.stringify(r.selectedTable))),p=_([{label:"空闲",value:"Livre",severity:"success"},{label:"用餐",value:"Ocupado",severity:"danger"},{label:"预定",value:"Reservado",severity:"info"},{label:"已付",value:"Pago",severity:"help"}]);function o(){x||(b.value=!1,a.value=JSON.parse(JSON.stringify(r.selectedTable))),x=!1}const g=W(()=>Number(a.value.peopleType.children)+Number(a.value.peopleType.adults));function S(){a.value.status?(w("tableEditConfirm",a.value,l=>{(l==null?void 0:l.success)==!0?(d.add({severity:"success",summary:"成功",detail:l.message,life:3e3}),m.value=!1):d.add({severity:"error",summary:"失败",detail:l.message,life:3e3})}),b.value=!1,x=!0):d.add({severity:"error",summary:"失败",detail:"未输入桌子状态",life:3e3})}function A(){b.value=!0}function U(){m.value=!1,a.value=JSON.parse(JSON.stringify(r.selectedTable))}function v(){return p.value.find(l=>l.value===a.value.status)}function N(l,e){const u=Number(e);if(l==="Adult"){Number(a.value.peopleType.adults)+u<=0?a.value.peopleType.adults=0:a.value.peopleType.adults=Number(a.value.peopleType.adults)+u,a.value.people=Number(a.value.peopleType.adults)+Number(a.value.peopleType.children);return}if(l==="Children"){a.value.peopleType.children+u<=0?a.value.peopleType.children=0:a.value.peopleType.children=Number(a.value.peopleType.children)+u,a.value.people=Number(a.value.peopleType.adults)+Number(a.value.peopleType.children);return}}const R=Q(),n=()=>{R.require({message:"是否清空"+a.value.id+"号桌",header:"确认清台",icon:"pi pi-info-circle",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{w("cleanTable",a.value.id,l=>{(l==null?void 0:l.success)===!1?d.add({severity:"error",summary:"操作",detail:l.message,life:3e3}):(l==null?void 0:l.success)===!0&&d.add({severity:"success",summary:"操作",detail:`桌号${a.value.id}，清台`,life:3e3})})},reject:()=>{d.add({severity:"error",summary:"操作",detail:`取消${a.value.id}号桌清台`,life:3e3})}})},t=_(null);function c(){window.open(window.env.QR_ADDR+J.SimpleEncode(r.selectedTable.id),"_blank")}const j=async()=>{if(t.value)try{await ve.toCanvas(t.value,window.env.QR_ADDR+J.SimpleEncode(r.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(l){console.error("生成二维码失败:",l)}};return se(()=>{j()}),ie(()=>window.env.QR_ADDR+J.SimpleEncode(r.selectedTable.id),j),(l,e)=>{var G,Z;const u=pe,f=ce,h=L,$=ee,Y=H;return T(),E(z,null,[i("div",Ee,[i("div",null,[s(f,{class:"m-2",variant:"on"},{default:y(()=>[s(u,{id:"Total",modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=k=>g.value=k),autocomplete:"off",disabled:""},null,8,["modelValue"]),e[11]||(e[11]=i("label",{for:"Total"},"总人数",-1))]),_:1,__:[11]})]),m.value?(T(),E("div",Ve,[s(h,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:e[1]||(e[1]=k=>N("Adult",-1))}),s(f,{class:"m-2",variant:"on"},{default:y(()=>[s(u,{id:"Adult",modelValue:a.value.peopleType.adults,"onUpdate:modelValue":e[2]||(e[2]=k=>a.value.peopleType.adults=k),autocomplete:"off"},null,8,["modelValue"]),e[12]||(e[12]=i("label",{for:"Adult"},"大人",-1))]),_:1,__:[12]}),s(h,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:e[3]||(e[3]=k=>N("Adult",1))})])):C("",!0),m.value?(T(),E("div",De,[s(h,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:e[4]||(e[4]=k=>N("Children",-1))}),s(f,{class:"m-2",variant:"on"},{default:y(()=>[s(u,{id:"Children",modelValue:a.value.peopleType.children,"onUpdate:modelValue":e[5]||(e[5]=k=>a.value.peopleType.children=k),autocomplete:"off"},null,8,["modelValue"]),e[13]||(e[13]=i("label",{for:"Children"},"小孩",-1))]),_:1,__:[13]}),s(h,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:e[6]||(e[6]=k=>N("Children",1))})])):C("",!0)]),i("div",je,[m.value?C("",!0):(T(),q(h,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:(G=v())==null?void 0:G.label,severity:(Z=v())==null?void 0:Z.severity,onClick:A},null,8,["label","severity"])),m.value?(T(),q($,{key:1,modelValue:a.value.status,"onUpdate:modelValue":e[7]||(e[7]=k=>a.value.status=k),options:p.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:a.value.status===null},null,8,["modelValue","options","invalid"])):C("",!0)]),i("div",qe,[i("canvas",{ref_key:"qrCanvas",ref:t,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:c},null,512)]),i("div",Me,[m.value?C("",!0):(T(),E("div",Be,[s(h,{label:"订单详情",severity:"success",onClick:e[8]||(e[8]=()=>l.$emit("showTableOrders"))}),s(h,{label:"清台",onClick:n,severity:"danger",class:"m-1"}),s(h,{label:"编辑",onClick:D,class:"m-1"})])),m.value?(T(),E("div",Ae,[s(h,{label:"取消编辑",severity:"danger",raised:"",class:"m-2",onClick:U}),s(h,{label:"保存编辑",severity:"success",raised:"",class:"m-2",onClick:S})])):C("",!0)]),s(Y,{visible:b.value,"onUpdate:visible":e[10]||(e[10]=k=>b.value=k),modal:"",header:"修改桌子状态",closable:!0,dismissableMask:!0,onHide:o},{default:y(()=>[i("div",Ue,[s($,{modelValue:a.value.status,"onUpdate:modelValue":e[9]||(e[9]=k=>a.value.status=k),options:p.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:a.value.status===null},null,8,["modelValue","options","invalid"]),s(h,{label:"确认",class:"mt-3",onClick:S})])]),_:1},8,["visible"])],64)}}},Pe=me(Re,[["__scopeId","data-v-69fe9906"]]),ze={key:0},Le=["disabled","onClick"],Fe={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Je={class:"font-bold"},He={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(V,{emit:M}){var R;const x=V,d=M,m=_((R=x.selectedTable.order)==null?void 0:R.sort((n,t)=>t.price-n.price).filter(n=>n.quantity!=0)),b=_(m.value.filter(n=>n.price!=0)),r=_([]),w=_(!1),D=_(!1);function a(n){let t=0;return n.forEach(c=>{t+=c.price*c.quantity}),t.toFixed(2)}function p(){w.value=!w.value,!w.value&&r.value.length>0&&N()}function o(n){if(r.value.find(t=>t.dishid===n.dishid))r.value.find(t=>t.dishid===n.dishid).quantity+=1;else{const t={...n,quantity:1};r.value.push(t)}n.quantity-=1}function g(){let n="| ";return r.value.forEach(t=>{const c=m.value.find(j=>j.dishid===t.dishid);c&&(n+=t.dishid+"-"+O.getDishName(t)+" "+(c.quantity+t.quantity)+" -> "+c.quantity+` | 
`)}),n}function S(n){d("cancelOrderEdit"),d("showToast","error","操作",`取消菜品删除
`+n),r.value.forEach(t=>{m.value.find(c=>c.dishid===t.dishid).quantity+=t.quantity}),r.value=[]}function A(n){var t;d("saveOrder",r.value),d("showToast","info","操作","桌号1，清除"),r.value=[],m.value=(t=x.selectedTable.order)==null?void 0:t.sort((c,j)=>j.price-c.price).filter(c=>c.quantity!=0)}const U=Q();function v(n){return Array.isArray(n)?n.map(I):I(n)}const N=()=>{let n=!1;const t=v(g());U.require({message:t,escape:!0,header:"是否修改以下订单",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{n=!0,A()},reject:()=>{n=!0,S(t)},onHide:()=>{n||S(t)}})};return(n,t)=>{const c=re,j=X,l=ue,e=fe,u=L;return T(),E(z,null,[i("div",null,[s(l,{value:D.value?b.value:m.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:y(()=>t[6]||(t[6]=[i("div",{class:"text-center py-5"},[i("p",{class:"text-gray-500"},"该桌子还没有菜品")],-1)])),default:y(()=>[s(c,{field:"dishid",header:"号码"}),s(c,{header:"菜名"},{body:y(f=>[P(B(ne(O).getDishName(f.data)),1)]),default:y(()=>[t[2]||(t[2]=P(" > ",-1))]),_:1,__:[2]}),s(c,{field:"price",header:"单价"}),s(c,{field:"quantity",header:"数量"},{body:y(f=>[w.value?C("",!0):(T(),E("label",ze,B(f.data.quantity),1)),w.value?(T(),q(j,{key:1,modelValue:f.data.quantity,"onUpdate:modelValue":h=>f.data.quantity=h,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:y(()=>t[3]||(t[3]=[i("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:y(()=>[i("span",{class:"p-inputnumber-button-icon",disabled:f.data.quantity<=0,onClick:h=>o(f.data)},t[4]||(t[4]=[i("i",{class:"pi pi-angle-down"},null,-1)]),8,Le)]),_:2},1032,["modelValue","onUpdate:modelValue"])):C("",!0)]),_:1}),s(c,{header:"总价"},{body:y(f=>[P(B(a([f.data])),1)]),default:y(()=>[t[5]||(t[5]=P(" > ",-1))]),_:1,__:[5]})]),_:1},8,["value"])]),i("div",Fe,[i("label",Je," 合计："+B(b.value.length>0?a(b.value):"0"),1),i("label",null,[s(e,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=f=>D.value=f)},null,8,["modelValue"]),t[7]||(t[7]=P(" 不显示价格为0 ",-1))]),s(u,{label:w.value?"保存":"编辑",onClick:t[1]||(t[1]=f=>p())},null,8,["label"])])],64)}}},Qe={class:"flex flex-wrap justify-content-between align-items-center m-1"},vl={__name:"TablesPage",setup(V){const M=Q(),x=_("Todos"),d=_(!1),m=_(!1),b=_({id:0}),r=_(!1),w=_({}),D=W(()=>x.value==="Todos"?O.tables.value:O.tables.value.filter(l=>l.status===x.value));function a(){d.value=!0}function p(){d.value==!0&&(d.value=!1)}function o(l){M.require({message:"确认删除"+l+`号桌子？
(注意：删除后不能撤回)`,header:"删除桌子",icon:"pi pi-trash",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认删除",severity:"danger"},accept:()=>{const e=O.deleteTable(l);e!=null?c.add({severity:"error",summary:e.title,detail:e.message,life:3e3}):c.add({severity:"info",summary:"删除成功",detail:"成功删除桌号："+l,life:3e3})},reject:()=>{}})}async function g(l){l<10&&(l="0"+l);const e=await O.addNewTable(l);e!==void 0?c.add({severity:"error",summary:e.title,detail:e.message,life:3e3}):c.add({severity:"info",summary:"创建成功",detail:"成功创建桌号："+l,life:3e3})}function S(l){const e=O.tables.value.find(u=>u.id===l);b.value={...e,order:(e==null?void 0:e.order)||[]}}function A(l,e){const u=O.tables.value.find(f=>f.id===l);b.value={...u,order:(u==null?void 0:u.order)||[]},e(b.value)}function U(l){S(l),m.value=!0}function v(l,e){const u={id:l.id,status:l.status,peopleType:{adults:l.peopleType.adults,children:l.peopleType.children}},f=O.updateTable(u);S(l.id),e(f?{success:!1,message:"更新失败"}:{success:!0,message:"更新成功"})}function N(l,e){const u=O.tableClean(l);u?(console.log("cleanTable Error:",u),e({success:!1,message:"更新失败"})):(m.value=!1,e({success:!0,message:"更新成功"}))}function R(){const l=b.value.id;S(l),r.value=!0}function n(l){O.deleteOrders(b.value.id,l),w.value.order&&(O.deleteOrder(w.value),w.value={})}function t(){O.refreshTables()}const c=K();function j(l,e,u,f){c.add({severity:l||"",summary:e||"",detail:u||"",life:f||3e3})}return(l,e)=>{const u=L,f=le,h=H;return T(),E(z,null,[i("div",Qe,[s(ye,{filterStatu:x.value,"onUpdate:filterStatu":e[0]||(e[0]=$=>x.value=$)},null,8,["filterStatu"]),d.value?C("",!0):(T(),q(u,{key:0,icon:"pi pi-pencil",label:"编辑桌子",class:"mr-3",onClick:a})),d.value?(T(),q(u,{key:1,label:"关闭编辑模式",class:"mr-3",onClick:p})):C("",!0)]),s(f,{class:"m-0"}),s(Ne,{filteredTables:D.value,"onUpdate:filteredTables":e[1]||(e[1]=$=>D.value=$),editMode:d.value,"onUpdate:editMode":e[2]||(e[2]=$=>d.value=$),onOpenTableDetail:U,onRemoveTable:o,onAddNewTable:g},null,8,["filteredTables","editMode"]),s(h,{visible:m.value,"onUpdate:visible":e[3]||(e[3]=$=>m.value=$),header:"桌号: "+b.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:y(()=>[s(Pe,{selectedTable:b.value,onTableEditConfirm:v,onCleanTable:N,onShowTableOrders:R,onOnEdit:A},null,8,["selectedTable"])]),_:1},8,["visible","header"]),s(h,{visible:r.value,"onUpdate:visible":e[4]||(e[4]=$=>r.value=$),modal:!0,dismissableMask:!0,header:"菜品详情",style:{"min-width":"350px","max-width":"550px"},onHide:e[5]||(e[5]=$=>t())},{default:y(()=>[s(He,{selectedTable:b.value,onSaveOrder:n,onCancelOrderEdit:t,onShowToast:j},null,8,["selectedTable"])]),_:1},8,["visible"])],64)}}};export{vl as default};
