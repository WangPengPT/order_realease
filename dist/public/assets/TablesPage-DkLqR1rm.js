import{s as Q}from"./index-Bi_XjiB5.js";import{a as Z,s as K}from"./index-COVmhWai.js";import{b as L}from"./index-i0lLfar3.js";import{h as _,f as M,o as g,w as T,a as o,d as i,c as $,e as k,F,C as W,t as D,z as X,x as Y,u as H,q as z,i as I,G as ee,A as U,l as te,n as C,H as J,E as le}from"./index-Df3HD8B_.js";import{s as ae}from"./index-BSelCf1c.js";import{d as G,a as se,s as ie}from"./index-BmcmgtWS.js";import{s as ne}from"./index-vUeUQ3iq.js";import{s as oe}from"./index-5YDElXyE.js";import{s as re}from"./index-qGdXzq3l.js";import{Q as de,C as P}from"./CodeMaker-IOgtdCDu.js";import{s as ue}from"./index-riHDROOP.js";import"./index-Dgk89KGb.js";import"./index-D6VuDqyv.js";import"./index-C_bYEhJJ.js";import"./index-Bv0S9RyS.js";import"./index-DwdLXCYe.js";import"./index-DJj2O3js.js";import"./_commonjsHelpers-gnU0ypJ3.js";const ce={class:"p-menuitem-content"},pe={__name:"TableMenuBar",props:{filterStatu:String},setup(O){const q=_([{label:"全部",value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:"空闲",value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:"用餐",value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:"预定",value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:"已付",value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(f,r)=>{const p=L,m=ae;return g(),M(m,{model:q.value,breakpoint:"355px",class:"border-0"},{item:T(({item:c})=>[o("div",ce,[i(p,{label:c.label,icon:c.icon,severity:c.severity,variant:"outlined",raised:"",onClick:a=>f.$emit("update:filterStatu",c.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},ve={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},fe={class:"grid m-2"},me={class:"flex justify-content-center align-items-center w-100"},be={class:"text-center text-2xl font-bold"},ye={key:0},Te={class:"text-center"},ge={class:"text-center text-lg"},_e={class:"text-center text-lg font-bold"},xe={key:1,class:"flex flex-wrap justify-content-center"},we={class:"flex flex-wrap justify-content-end mt-3"},he={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(O,{emit:q}){const f=_(!1),r=_(),p=_([{label:"空闲",value:"Livre"},{label:"用餐",value:"Ocupado"},{label:"预定",value:"Reservado"},{label:"已付",value:"Pago"}]);function m(v){return p.value.find(u=>u.value===v)}function c(v){return!v||!Array.isArray(v)?0:parseFloat(v.reduce((u,x)=>u+x.price*x.quantity,0).toFixed(2))}function a(v){const u="m-1 border-3 border-gray-500 ";let x="";switch(v){case"Livre":break;case"Ocupado":x="border-red-300 bg-red-100";break;case"Reservado":x="border-blue-300 bg-blue-100";break;case"Pago":x="border-purple-300 bg-purple-100";break;default:x="border-gray-500 bg-gray-100"}return u+x}return(v,u)=>{const x=L,N=ne,E=G,S=Q;return g(),$(F,null,[o("div",ve,[o("div",fe,[O.editMode?(g(),M(N,{key:0,class:"m-1 border-3 border-gray-500 flex justify-content-center align-items-center",style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:u[0]||(u[0]=b=>f.value=!0)},{content:T(()=>[o("div",me,[i(x,{text:"",icon:"pi pi-plus",severity:"contrast",size:"large"})])]),_:1})):k("",!0),(g(!0),$(F,null,W(O.filteredTables,b=>(g(),M(N,{class:Y(a(b.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:j=>O.editMode?"":v.$emit("openTableDetail",b.id)},{content:T(()=>[o("p",be,"桌号: "+D(b.id),1),O.editMode?k("",!0):(g(),$("div",ye,[o("p",Te,D(m(b.status).label),1),o("p",ge,D(b.people)+"人",1),o("p",_e,D(c(b.order))+"€",1)])),O.editMode?(g(),$("div",xe,[i(x,{icon:"pi pi-trash",severity:"danger",outlined:"",raised:"",class:"m-2",onClick:X(j=>v.$emit("removeTable",b.id),["stop"])},null,8,["onClick"])])):k("",!0)]),_:2},1032,["class","onClick"]))),256))])]),i(S,{visible:f.value,"onUpdate:visible":u[3]||(u[3]=b=>f.value=b),modal:!0,dismissableMask:!0,header:"添加桌子",onHide:u[4]||(u[4]=b=>r.value=void 0)},{default:T(()=>[i(E,{modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=b=>r.value=b),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:r.value<10?"桌号：0":"桌号：",step:1,min:"1",max:"9999",placeholder:"输入桌号",fluid:""},{incrementbuttonicon:T(()=>u[5]||(u[5]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:T(()=>u[6]||(u[6]=[o("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix"]),o("div",we,[i(x,{label:"创建桌子",onClick:u[2]||(u[2]=b=>{v.$emit("addNewTable",r.value),f.value=!1})})])]),_:1},8,["visible"])],64)}}},Ce={class:"flex flex-column justify-content-center align-items-center"},ke={key:0,class:"flex flex-wrap justify-content-center align-items-center"},$e={key:1,class:"flex flex-wrap justify-content-center align-items-center"},Oe={class:"flex flex-wrap justify-content-center align-items-center m-2"},Ee={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},Se={class:"m-2"},Ve={key:0,class:"flex flex-wrap justify-content-between align-items-center"},Ne={key:1,class:"flex flex-wrap justify-content-between align-items-center"},je={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(O,{emit:q}){const f=H(),r=_(!1),p=O,m=q;function c(){m("onEdit",p.selectedTable.id,n=>{a.value=JSON.parse(JSON.stringify(n)),r.value=!0})}const a=_(JSON.parse(JSON.stringify(p.selectedTable))),v=_([{label:"空闲",value:"Livre",severity:"success"},{label:"用餐",value:"Ocupado",severity:"danger"},{label:"预定",value:"Reservado",severity:"info"},{label:"已付",value:"Pago",severity:"help"}]);function u(){m("tableEditConfirm",a.value,n=>{(n==null?void 0:n.success)===!1?f.add({severity:"error",summary:"失败",detail:n.message,life:3e3}):(n==null?void 0:n.success)===!0&&(f.add({severity:"success",summary:"成功",detail:n.message,life:3e3}),r.value=!1)})}function x(){r.value=!1,a.value=JSON.parse(JSON.stringify(p.selectedTable))}function N(){return v.value.find(n=>n.value===a.value.status)}function E(n,e){const t=Number(e);if(n==="Adult"){a.value.peopleType.adults+t<=0?a.value.peopleType.adults=0:a.value.peopleType.adults=a.value.peopleType.adults+t,a.value.people=a.value.peopleType.adults+a.value.peopleType.children;return}if(n==="Children"){a.value.peopleType.children+t<=0?a.value.peopleType.children=0:a.value.peopleType.children=a.value.peopleType.children+t,a.value.people=a.value.peopleType.adults+a.value.peopleType.children;return}}const S=z(),b=()=>{S.require({message:"是否清空"+a.value.id+"号桌",header:"确认清台",icon:"pi pi-info-circle",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{m("cleanTable",a.value.id,n=>{(n==null?void 0:n.success)===!1?f.add({severity:"error",summary:"操作",detail:n.message,life:3e3}):(n==null?void 0:n.success)===!0&&f.add({severity:"success",summary:"操作",detail:`桌号${a.value.id}，清台`,life:3e3})})},reject:()=>{f.add({severity:"error",summary:"操作",detail:`取消${a.value.id}号桌清台`,life:3e3})}})},j=_(null);function A(){window.open(window.env.QR_ADDR+P.SimpleEncode(p.selectedTable.id),"_blank")}const B=async()=>{if(j.value)try{await de.toCanvas(j.value,window.env.QR_ADDR+P.SimpleEncode(p.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(n){console.error("生成二维码失败:",n)}};return I(()=>{B()}),ee(()=>window.env.QR_ADDR+P.SimpleEncode(p.selectedTable.id),B),(n,e)=>{const t=re,d=oe,w=L,s=Z;return g(),$(F,null,[o("div",Ce,[o("div",null,[i(d,{class:"m-2",variant:"on"},{default:T(()=>[i(t,{id:"Total",modelValue:a.value.people,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.people=l),autocomplete:"off",disabled:""},null,8,["modelValue"]),e[9]||(e[9]=o("label",{for:"Total"},"总人数",-1))]),_:1,__:[9]})]),r.value?(g(),$("div",ke,[i(w,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:e[1]||(e[1]=l=>E("Adult",-1))}),i(d,{class:"m-2",variant:"on"},{default:T(()=>[i(t,{id:"Adult",modelValue:a.value.peopleType.adults,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.peopleType.adults=l),autocomplete:"off"},null,8,["modelValue"]),e[10]||(e[10]=o("label",{for:"Adult"},"大人",-1))]),_:1,__:[10]}),i(w,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:e[3]||(e[3]=l=>E("Adult",1))})])):k("",!0),r.value?(g(),$("div",$e,[i(w,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:e[4]||(e[4]=l=>E("Children",-1))}),i(d,{class:"m-2",variant:"on"},{default:T(()=>[i(t,{id:"Children",modelValue:a.value.peopleType.children,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.peopleType.children=l),autocomplete:"off"},null,8,["modelValue"]),e[11]||(e[11]=o("label",{for:"Children"},"小孩",-1))]),_:1,__:[11]}),i(w,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:e[6]||(e[6]=l=>E("Children",1))})])):k("",!0)]),o("div",Oe,[r.value?k("",!0):(g(),M(w,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:N().label,severity:N().severity},null,8,["label","severity"])),r.value?(g(),M(s,{key:1,modelValue:a.value.status,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.status=l),options:v.value,optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"])):k("",!0)]),o("div",Ee,[o("canvas",{ref_key:"qrCanvas",ref:j,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:A},null,512)]),o("div",Se,[r.value?k("",!0):(g(),$("div",Ve,[i(w,{label:"订单详情",severity:"success",onClick:e[8]||(e[8]=()=>n.$emit("showTableOrders"))}),i(w,{label:"清台",onClick:b,severity:"danger",class:"m-1"}),i(w,{label:"编辑",onClick:c,class:"m-1"})])),r.value?(g(),$("div",Ne,[i(w,{label:"取消编辑",severity:"danger",raised:"",class:"m-2",onClick:x}),i(w,{label:"保存编辑",severity:"success",raised:"",class:"m-2",onClick:u})])):k("",!0)])],64)}}},qe={key:0},De=["disabled","onClick"],Me={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Be={class:"font-bold"},Ae={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(O,{emit:q}){var n;const f=O,r=q,p=_((n=f.selectedTable.order)==null?void 0:n.sort((e,t)=>t.price-e.price).filter(e=>e.quantity!=0)),m=_(p.value.filter(e=>e.price!=0)),c=_([]),a=_(!1),v=_(!1);function u(e){let t=0;return e.forEach(d=>{t+=d.price*d.quantity}),t.toFixed(2)}function x(){a.value=!a.value,!a.value&&c.value.length>0&&B()}function N(e){if(c.value.find(t=>t.dishid===e.dishid))c.value.find(t=>t.dishid===e.dishid).quantity+=1;else{const t={...e,quantity:1};c.value.push(t)}e.quantity-=1}function E(){let e="| ";return c.value.forEach(t=>{const d=p.value.find(w=>w.dishid===t.dishid);d&&(e+=t.dishid+"-"+C.getDishName(t)+" "+(d.quantity+t.quantity)+" -> "+d.quantity+` | 
`)}),e}function S(e){r("cancelOrderEdit"),r("showToast","error","操作",`取消菜品删除
`+e),c.value.forEach(t=>{p.value.find(d=>d.dishid===t.dishid).quantity+=t.quantity}),c.value=[]}function b(e){var t;r("saveOrder",c.value),r("showToast","info","操作","桌号1，清台"),c.value=[],p.value=(t=f.selectedTable.order)==null?void 0:t.sort((d,w)=>w.price-d.price).filter(d=>d.quantity!=0)}const j=z();function A(e){return Array.isArray(e)?e.map(J):J(e)}const B=()=>{let e=!1;const t=A(E());j.require({message:t,escape:!0,header:"是否修改以下订单",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{e=!0,b()},reject:()=>{e=!0,S(t)},onHide:()=>{e||S(t)}})};return(e,t)=>{const d=se,w=G,s=ie,l=ue,h=L;return g(),$(F,null,[o("div",null,[i(s,{value:v.value?m.value:p.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:T(()=>t[6]||(t[6]=[o("div",{class:"text-center py-5"},[o("p",{class:"text-gray-500"},"该桌子还没有菜品")],-1)])),default:T(()=>[i(d,{field:"dishid",header:"号码"}),i(d,{header:"菜名"},{body:T(y=>[U(D(te(C).getDishName(y.data)),1)]),default:T(()=>[t[2]||(t[2]=U(" > ",-1))]),_:1,__:[2]}),i(d,{field:"price",header:"单价"}),i(d,{field:"quantity",header:"数量"},{body:T(y=>[a.value?k("",!0):(g(),$("label",qe,D(y.data.quantity),1)),a.value?(g(),M(w,{key:1,modelValue:y.data.quantity,"onUpdate:modelValue":R=>y.data.quantity=R,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:T(()=>t[3]||(t[3]=[o("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:T(()=>[o("span",{class:"p-inputnumber-button-icon",disabled:y.data.quantity<=0,onClick:R=>N(y.data)},t[4]||(t[4]=[o("i",{class:"pi pi-angle-down"},null,-1)]),8,De)]),_:2},1032,["modelValue","onUpdate:modelValue"])):k("",!0)]),_:1}),i(d,{header:"总价"},{body:T(y=>[U(D(u([y.data])),1)]),default:T(()=>[t[5]||(t[5]=U(" > ",-1))]),_:1,__:[5]})]),_:1},8,["value"])]),o("div",Me,[o("label",Be," 合计："+D(m.value.length>0?u(m.value):"0"),1),o("label",null,[i(l,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=y=>v.value=y)},null,8,["modelValue"]),t[7]||(t[7]=U(" 不显示价格为0 ",-1))]),i(h,{label:a.value?"保存":"编辑",onClick:t[1]||(t[1]=y=>x())},null,8,["label"])])],64)}}},Re={class:"flex flex-wrap justify-content-between align-items-center m-1"},at={__name:"TablesPage",setup(O){const q=z(),f=_("Todos"),r=_(!1),p=_(!1),m=_({id:0}),c=_(!1),a=_({}),v=le(()=>f.value==="Todos"?C.tables.value:C.tables.value.filter(s=>s.status===f.value));function u(){r.value=!0}function x(){r.value==!0&&(r.value=!1)}function N(s){q.require({message:"确认删除"+s+`号桌子？
(注意：删除后不能撤回)`,header:"删除桌子",icon:"pi pi-trash",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认删除",severity:"danger"},accept:()=>{const l=C.deleteTable(s);l!=null?d.add({severity:"error",summary:l.title,detail:l.message,life:3e3}):d.add({severity:"info",summary:"删除成功",detail:"成功删除桌号："+s,life:3e3})},reject:()=>{}})}async function E(s){s<10&&(s="0"+s);const l=await C.addNewTable(s);l!==void 0?d.add({severity:"error",summary:l.title,detail:l.message,life:3e3}):d.add({severity:"info",summary:"创建成功",detail:"成功创建桌号："+s,life:3e3})}function S(s){const l=C.tables.value.find(h=>h.id===s);m.value={...l,order:(l==null?void 0:l.order)||[]}}function b(s,l){const h=C.tables.value.find(y=>y.id===s);m.value={...h,order:(h==null?void 0:h.order)||[]},l(m.value)}function j(s){S(s),p.value=!0}function A(s,l){const h={id:s.id,status:s.status,peopleType:{adults:s.peopleType.adults,children:s.peopleType.children}},y=C.updateTable(h);S(s.id),l(y?{success:!1,message:"更新失败"}:{success:!0,message:"更新成功"})}function B(s,l){const h=C.tableClean(s);h?(console.log("cleanTable Error:",h),l({success:!1,message:"更新失败"})):(p.value=!1,l({success:!0,message:"更新成功"}))}function n(){const s=m.value.id;S(s),c.value=!0}function e(s){C.deleteOrders(m.value.id,s),a.value.order&&(C.deleteOrder(a.value),a.value={})}function t(){C.refreshTables()}const d=H();function w(s,l,h,y){d.add({severity:s||"",summary:l||"",detail:h||"",life:y||3e3})}return(s,l)=>{const h=L,y=K,R=Q;return g(),$(F,null,[o("div",Re,[i(pe,{filterStatu:f.value,"onUpdate:filterStatu":l[0]||(l[0]=V=>f.value=V)},null,8,["filterStatu"]),r.value?k("",!0):(g(),M(h,{key:0,icon:"pi pi-pencil",label:"编辑桌子",class:"mr-3",onClick:u})),r.value?(g(),M(h,{key:1,label:"关闭编辑模式",class:"mr-3",onClick:x})):k("",!0)]),i(y,{class:"m-0"}),i(he,{filteredTables:v.value,"onUpdate:filteredTables":l[1]||(l[1]=V=>v.value=V),editMode:r.value,"onUpdate:editMode":l[2]||(l[2]=V=>r.value=V),onOpenTableDetail:j,onRemoveTable:N,onAddNewTable:E},null,8,["filteredTables","editMode"]),i(R,{visible:p.value,"onUpdate:visible":l[3]||(l[3]=V=>p.value=V),header:"桌号: "+m.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:T(()=>[i(je,{selectedTable:m.value,onTableEditConfirm:A,onCleanTable:B,onShowTableOrders:n,onOnEdit:b},null,8,["selectedTable"])]),_:1},8,["visible","header"]),i(R,{visible:c.value,"onUpdate:visible":l[4]||(l[4]=V=>c.value=V),modal:!0,dismissableMask:!0,header:"菜品详情",style:{"min-width":"350px","max-width":"550px"},onHide:l[5]||(l[5]=V=>t())},{default:T(()=>[i(Ae,{selectedTable:m.value,onSaveOrder:e,onCancelOrderEdit:t,onShowToast:w},null,8,["selectedTable"])]),_:1},8,["visible"])],64)}}};export{at as default};
