import{Q as q,b as p,w as F,c as $,o as h,s as t,v as o,f as K,a as y,M as l,A as N,t as r,h as u,J as L}from"./vue-Dca0Sd-v.js";import{v as M,q as j,r as A,y as D,z as C,j as x,b as w,A as R,e as z}from"./primevue-CBPQtTnk.js";import{c as g}from"./index-CqHK_XIN.js";const E={class:"flex flex-column gap-3 mt-3"},G={class:"flex flex-column gap-2"},H={for:"guestName"},I={class:"flex flex-column gap-3 mt-3"},J={class:"flex flex-column gap-2"},Q={for:"email"},S={class:"flex flex-column gap-2"},T={for:"password"},W={key:0,class:"text-red-500 text-sm mt-3"},O={class:"flex justify-content-end gap-2"},ee={__name:"LoginDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","login-success"],setup(V,{emit:B}){const{t:d}=q(),P=V,c=B,m=p(""),v=p(""),f=p(""),a=p(!1),s=p("");F(()=>P.visible,e=>{e&&b()});function b(){m.value="",v.value="",f.value="",s.value="",a.value=!1}async function k(){if(!f.value.trim()){s.value=d("common.auth.guestNameRequired");return}a.value=!0,s.value="";try{const e=await g.guestLogin(f.value.trim());e.success?(c("login-success"),c("update:visible",!1)):s.value=e.error||d("common.failed")}catch(e){s.value=e.message||d("common.failed")}finally{a.value=!1}}function U(){c("update:visible",!1),b()}async function _(){if(!m.value||!v.value){s.value=d("common.auth.emailPasswordRequired");return}a.value=!0,s.value="";try{const e=await g.login(m.value,v.value);e.success?(c("login-success"),c("update:visible",!1)):s.value=e.error||d("common.auth.loginFailed")}catch(e){s.value=d("common.auth.loginFailed"),console.error("Login error:",e)}finally{a.value=!1}}return(e,i)=>(h(),$(l(z),{visible:V.visible,"onUpdate:visible":i[3]||(i[3]=n=>e.$emit("update:visible",n)),header:e.$t("common.auth.login"),modal:!0,dismissableMask:!0,style:{width:"90vw",maxWidth:"25rem"},onHide:b},{footer:t(()=>[u("div",O,[o(l(w),{label:e.$t("common.cancel"),severity:"secondary",onClick:U,disabled:a.value},null,8,["label","disabled"])])]),default:t(()=>[o(l(M),{value:l(g).settings.value.useAuth?"0":"1"},{default:t(()=>[o(l(j),null,{default:t(()=>[l(g).settings.value.useAuth?(h(),$(l(A),{key:0,value:"0"},{default:t(()=>[N(r(e.$t("common.auth.guestLogin")),1)]),_:1})):y("",!0),o(l(A),{value:"1"},{default:t(()=>[N(r(e.$t("common.auth.supabaseLogin")),1)]),_:1})]),_:1}),o(l(D),null,{default:t(()=>[l(g).settings.value.useAuth?(h(),$(l(C),{key:0,value:"0"},{default:t(()=>[u("div",E,[u("div",G,[u("label",H,r(e.$t("common.auth.guestName")),1),o(l(x),{id:"guestName",modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=n=>f.value=n),placeholder:e.$t("common.auth.guestNamePlaceholder"),class:"w-full",disabled:a.value,onKeyup:L(k,["enter"])},null,8,["modelValue","placeholder","disabled"])]),o(l(w),{label:e.$t("common.auth.login"),onClick:k,loading:a.value,class:"w-full mt-2"},null,8,["label","loading"])])]),_:1})):y("",!0),o(l(C),{value:"1"},{default:t(()=>[u("div",I,[u("div",J,[u("label",Q,r(e.$t("common.auth.email")),1),o(l(x),{id:"email",modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=n=>m.value=n),type:"email",placeholder:e.$t("common.auth.emailPlaceholder"),class:"w-full",disabled:a.value},null,8,["modelValue","placeholder","disabled"])]),u("div",S,[u("label",T,r(e.$t("common.auth.password")),1),o(l(R),{id:"password",modelValue:v.value,"onUpdate:modelValue":i[2]||(i[2]=n=>v.value=n),placeholder:e.$t("common.auth.passwordPlaceholder"),feedback:!1,toggleMask:"",class:"w-full",disabled:a.value,onKeyup:L(_,["enter"]),fluid:""},null,8,["modelValue","placeholder","disabled"])]),o(l(w),{label:e.$t("common.auth.login"),onClick:_,loading:a.value,class:"w-full mt-2"},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1},8,["value"]),s.value?(h(),K("div",W,r(s.value),1)):y("",!0)]),_:1},8,["visible","header"]))}};export{ee as _};
