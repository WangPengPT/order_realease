import{s as z}from"./index-C4pIAl8J.js";import{s as M}from"./index-CjycXkf5.js";import{a as F}from"./index-F4Om_Gvw.js";import{s as T}from"./index-DVB9r7eW.js";import{x as j,q as B,u as A,O as D,h as u,c as E,a,b as t,w as I,l as g,F as N,n as P,j as q,o as L,t as O}from"./index-Dj9Eatox.js";import"./index-C95LJuME.js";import"./index-yL077HWr.js";import"./index-B4wLVNxk.js";import"./index-C_FiY1S9.js";import"./index-BjzCbByR.js";const R={class:"flex flex-column justify-between items-center flex-1 gap-4"},G={class:"flex gap-3 align-items-center"},H={class:"m-2"},J={class:"mr-2"},K={class:"m-2"},se={__name:"UpdateMenu",setup(Q){const C=j(),{t:l}=B();q();const p=A(),k=D(),x=u(0),f=u([]),n=u(!1),v=u(!1);let _;_="/upload";function y(e){n.value&&C.require({message:l("common.updateAllConfirm"),header:l("common.ConfirmTitle"),icon:"pi pi-exclamation-triangle",acceptLabel:l("common.Confirm"),rejectLabel:l("common.Cancel"),accept:()=>{p.add({severity:"info",summary:l("common.Info"),detail:l("common.updateAllConfirmed"),life:3e3})},reject:()=>{n.value=!1,p.add({severity:"warn",summary:l("common.Cancelled"),detail:l("common.updateAllCancelled"),life:3e3})}})}const h=()=>{let e="";for(const o of f.value)e+='"'+o.name+'",';P.refreshMenuSignal(),console.log("update_all:",n.value),p.add({severity:"info",summary:l("common.success"),detail:l("optionPages.menuUpload")+e.substring(0,e.length-1),life:5e3})},b=e=>{console.log("执行callback()函数，触发实际的文件上传"),e()},S=e=>{f.value=e.files,f.value.forEach(o=>{x.value+=parseInt($(o.size))})},$=e=>{const i=k.config.locale.fileSizeTypes;if(e===0)return`0 ${i[0]}`;const m=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,m)).toFixed(3))} ${i[m]}`},w=e=>{console.log("上传前的文件",e.files),e.formData.append("update_all",n.value),e.formData.append("takeaway",v.value)};return(e,o)=>{const c=F,i=M,m=z;return L(),E(N,null,[a("div",null,[t(g(T),{url:g(_),onUpload:o[2]||(o[2]=r=>h()),multiple:!0,accept:".xlsx,.xls,.csv,.json",maxFileSize:1e6,onSelect:S,onBeforeUpload:o[3]||(o[3]=r=>w(r))},{header:I(({chooseCallback:r,uploadCallback:U,clearCallback:V,files:d})=>[a("div",R,[a("div",G,[t(c,{onClick:s=>r(),icon:"pi pi-file-arrow-up",rounded:"",outlined:"",severity:"secondary"},null,8,["onClick"]),t(c,{onClick:s=>b(U),icon:"pi pi-cloud-upload",rounded:"",outlined:"",severity:"success",disabled:!d||d.length===0},null,8,["onClick","disabled"]),t(c,{onClick:s=>V(),icon:"pi pi-times",rounded:"",outlined:"",severity:"danger",disabled:!d||d.length===0},null,8,["onClick","disabled"])])]),a("div",H,[a("label",J,O(g(l)("optionPages.changeMenu")),1),t(i,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value=s),onChange:y},null,8,["modelValue"])]),a("div",K,[o[4]||(o[4]=a("label",{class:"mr-2"},"takeaway",-1)),t(i,{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=s=>v.value=s)},null,8,["modelValue"])])]),_:1},8,["url"])]),t(m)],64)}}};export{se as default};
