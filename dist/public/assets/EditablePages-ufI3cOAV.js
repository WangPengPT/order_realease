import{s as X}from"./index-BUVb3Qu5.js";import{s as Y}from"./index-BuVj7k5V.js";import{s as Z}from"./index-CeLxPqQC.js";import{s as ee}from"./index-Cp6jjMOu.js";import{b as q}from"./index-B_yOoGes.js";import{s as ae,a as te,b as oe}from"./index-BdsqsLRc.js";import{q as I,j as se,h as p,s as ie,f as B,o as f,w as v,a as s,d as l,l as _,t as k,x as le,u as ne,H as re,i as pe,n as d,c as j,F as L,E as S,C as ce,e as de}from"./index-wgRpoX0d.js";import{s as ue}from"./index-jtmE8pl_.js";import{s as me}from"./index-D-OnMRF5.js";import{_ as ge}from"./main-C8Q1gxG8.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Bqnvhu8P.js";import"./index-CpkBTmvN.js";import"./index-D-07fRNA.js";import"./index-BSRB7VuG.js";import"./index-CS9HPE5f.js";import"./index-CROvrDHc.js";import"./index-DU9w3h9i.js";import"./index-CHu6DZJV.js";import"./index-aCXqh-i3.js";const ve={class:"relative"},ye={class:"absolute bottom-0 surface-800 left-0 w-full p-3 bg-black bg-opacity-50 text-white"},be={class:"text-xl font-semibold"},Pe={class:"text-sm"},_e={class:"flex justify-content-end"},xe={__name:"EditablePageCard",props:{page:Object},emits:[],setup(x,{emit:e}){const{t:c}=I(),n=se(),i=x,r=e;function y(m){n.push(`/editablePages/${m}`)}function g(){r("deletePage",i.page.id)}function h(){r("applypage",i.page.id)}function $(){r("exportPage",i.page.id)}function M(){r("modification",i.page.id,i.page.name,i.page.description)}const b=p(),C=ie(()=>[{label:c("optionPages.option"),items:[{label:c("optionPages.apply"),icon:"pi pi-check-square",command:h},{label:c("common.delete"),icon:"pi pi-times",command:g},{label:c("common.export"),icon:"pi pi-file-export",command:$},{label:c("common.modification"),icon:"pi pi-pencil",command:M}]}]),u=m=>{b.value.toggle(m)};return(m,P)=>{const T=q,A=me,V=ue;return f(),B(V,{style:{width:"250px"},class:"relative"},{header:v(()=>[l(T,{type:"button",icon:"pi pi-ellipsis-v",class:"absolute top-2 right-0 z-5",onClick:u,"aria-haspopup":"true","aria-controls":"overlay_menu"}),l(A,{ref_key:"menu",ref:b,model:C.value,popup:!0},null,8,["model"]),s("div",ve,[P[1]||(P[1]=s("img",{src:ge,style:{width:"100%",height:"150px","object-fit":"cover"}},null,-1)),s("div",ye,[s("div",be,k(x.page.name),1),s("div",Pe,k(x.page.description),1)])])]),footer:v(()=>[s("div",_e,[l(T,{label:_(c)("common.edit"),text:"",onClick:P[0]||(P[0]=U=>y(x.page.id)),icon:"pi pi-file-edit"},null,8,["label"])])]),_:1})}}},he={class:"p-4"},Me={class:"flex flex-wrap gap-4"},we={class:"flex justify-center"},ke={class:"flex items-center gap-4 mb-4"},$e={for:"name",class:"font-semibold w-24"},Ce={class:"flex items-center gap-4 mb-8"},Te={for:"description",class:"font-semibold w-24"},je={class:"flex justify-end gap-2"},Ae={class:"card flex justify-center"},Ve={__name:"EditablePages",setup(x){const{t:e}=I(),c=le(),n=ne(),i=p(""),r=p("");let y=null;const g=p(!1),h=p("add"),$=p(null),M=p(!1),b=p(""),C=p([{title:"主页",value:"Dine-in"},{title:"外卖",value:"Takeaway"}]),u=p(C.value[0].value),m=p([]);re(()=>d.pageApi.pages.value,(o,a)=>{m.value=o.filter(w=>w.type==u.value)},{deep:!0,immediate:!0});async function P(){if(!i.value.trim()){n.add({severity:"warn",summary:e("common.error"),detail:e("optionPages.enterNameMsg"),life:3e3});return}h.value==="add"&&(await d.pageApi.addPage(i.value,r.value,u.value),await d.pageApi.getPages()),h.value==="edit"&&(await d.pageApi.updatePage($.value,i.value,r.value),await d.pageApi.getPages()),g.value=!1,i.value="",r.value=""}pe(async()=>{b.value=sessionStorage.getItem("token"),await d.pageApi.getPages()});function T(o){c.require({message:e("optionPages.deletePageMsg"),header:e("optionPages.deletePageHeader"),icon:"pi pi-exclamation-triangle",acceptLabel:e("common.delete"),rejectLabel:e("common.cancel"),acceptClass:"p-button-danger",accept:async()=>{try{await d.pageApi.deletePage(o),n.add({severity:"success",summary:e("optionPages.deletedMsg"),detail:e("optionPages.deleteSucMsg"),life:3e3})}catch(a){n.add({severity:"error",summary:e("optionPages.notDeletedMsg"),detail:a.message||e("optionPages.serverErrorMsg"),life:3e3})}},reject:()=>{n.add({severity:"info",summary:e("optionPages.cancelMsg"),detail:e("optionPages.operationCancelMsg"),life:3e3})}})}function A(o){c.require({message:e("optionPages.applyPageMsg"),header:e("optionPages.applyPageHeader"),icon:"pi pi-exclamation-triangle",acceptLabel:e("common.confirm"),rejectLabel:e("common.cancel"),accept:async()=>{try{await d.pageApi.applyWelcomePage(o,u.value),n.add({severity:"success",summary:e("optionPages.applyMsg"),detail:e("optionPages.applySucMsg"),life:3e3})}catch(a){n.add({severity:"error",summary:e("optionPages.applyFailMsg"),detail:a.message||e("optionPages.serverErrorMsg"),life:3e3})}},reject:()=>{console.log("取消应用")}})}function V(o){c.require({message:e("optionPages.exportPageMsg"),header:e("optionPages.applyPageHeader"),icon:"pi pi-exclamation-triangle",acceptLabel:e("common.confirm"),rejectLabel:e("common.cancel"),accept:async()=>{try{await d.dataTransfer.exportPage(o),n.add({severity:"success",summary:e("optionPages.exportMsg"),detail:e("optionPages.exportSucMsg"),life:3e3})}catch(a){n.add({severity:"error",summary:e("optionPages.exportFailMsg"),detail:a.message||e("optionPages.serverErrorMsg"),life:3e3})}},reject:()=>{console.log("取消应用")}})}function U(o,a,w){h.value="edit",$.value=o,i.value=a,r.value=w,g.value=!0}function N(){M.value=!0}function z(){y=setTimeout(()=>{N()},2e3)}function H(){y&&(clearTimeout(y),y=null)}function O(){H()}function R(o){var a;((a=o==null?void 0:o.xhr)==null?void 0:a.status)===200?n.value.add({severity:"success",summary:"成功",detail:"上传完成",life:3e3}):n.value.add({severity:"error",summary:"失败",detail:"上传失败",life:3e3})}function W(){m.value=d.pageApi.pages.value.filter(o=>o.type==u.value)}return(o,a)=>{const w=oe,G=te,J=ae,E=q,D=ee,F=Z,K=Y,Q=X;return f(),j(L,null,[s("div",he,[l(J,{scrollable:"",value:u.value,"onUpdate:value":a[0]||(a[0]=t=>u.value=t)},{default:v(()=>[l(G,null,{default:v(()=>[(f(!0),j(L,null,S(C.value,t=>(f(),B(w,{key:t.title,value:t.value,onClick:W},{default:v(()=>[ce(k(t.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"]),s("div",Me,[(f(!0),j(L,null,S(m.value,t=>(f(),j("div",{key:t.title},[l(xe,{page:t,onDeletePage:T,onApplypage:A,onExportPage:V,onModification:U},null,8,["page"])]))),128)),s("div",we,[l(E,{style:{width:"200px",height:"200px"},icon:"pi pi-plus",onClick:a[1]||(a[1]=t=>g.value=!0),onMousedown:z,onMouseup:O,onMouseleave:H})])])]),l(F,{visible:g.value,"onUpdate:visible":a[5]||(a[5]=t=>g.value=t),modal:"",header:_(e)("optionPages.createPage"),style:{width:"25rem"}},{default:v(()=>[s("div",ke,[s("label",$e,k(_(e)("optionPages.name")),1),l(D,{id:"name",class:"flex-auto",modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value=t),autocomplete:"off"},null,8,["modelValue"])]),s("div",Ce,[s("label",Te,k(_(e)("optionPages.description")),1),l(D,{id:"description",class:"flex-auto",modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=t=>r.value=t),autocomplete:"off"},null,8,["modelValue"])]),s("div",je,[l(E,{type:"button",label:_(e)("common.cancel"),severity:"secondary",onClick:a[4]||(a[4]=t=>o.visible=!1)},null,8,["label"]),l(E,{type:"button",label:_(e)("common.save"),onClick:P},null,8,["label"])])]),_:1},8,["visible","header"]),l(F,{visible:M.value,"onUpdate:visible":a[6]||(a[6]=t=>M.value=t),header:"上传主页模板",modal:""},{default:v(()=>[s("div",Ae,[l(K),b.value?(f(),B(Q,{key:0,mode:"basic",name:"page",url:"/api/import/page",headers:{authorization:`Bearer ${b.value}`},accept:".zip",maxFileSize:1e6,auto:!0,chooseLabel:"Browse",onUpload:R},null,8,["headers"])):de("",!0)])]),_:1},8,["visible"])],64)}}},Ye=fe(Ve,[["__scopeId","data-v-d0bc8495"]]);export{Ye as default};
