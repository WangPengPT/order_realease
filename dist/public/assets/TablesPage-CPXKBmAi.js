import{s as J}from"./index-DJF7rNL7.js";import{a as W,s as X}from"./index-tjpq5YAm.js";import{c as F}from"./index-DbP2HlSH.js";import{h as w,f as q,o as m,w as b,a as d,d as s,c as k,e as $,F as R,A as Y,t as j,x as I,y as ee,q as H,i as te,E as le,l as _,z as U,n as h,G as Z,C as ae,u as ie}from"./index-CS4Gn_Dm.js";import{s as ne}from"./index-BmMJO9yb.js";import{d as K,a as se,s as oe}from"./index-BDK5UlIt.js";import{s as re}from"./index-CvPKQSqh.js";import{s as de}from"./index-dOrF5dWo.js";import{s as ue}from"./index-CU5YzXH5.js";import{Q as ce,C as Q}from"./CodeMaker-DIpcM4PY.js";import{s as pe}from"./index-Dz_memzz.js";import"./index-D_U2DyPt.js";import"./index-BJ-lXpUg.js";import"./index-CAuqSre3.js";import"./index-CPfMrKgB.js";import"./index-W_ubY66s.js";import"./_commonjsHelpers-DaWZu8wl.js";const fe={class:"p-menuitem-content"},be={__name:"TableMenuBar",props:{filterStatu:String},setup(x){const M=w([{label:"全部",value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:"空闲",value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:"用餐",value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:"预定",value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:"已付",value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(v,p)=>{const n=F,y=ne;return m(),q(y,{model:M.value,breakpoint:"355px",class:"border-0"},{item:b(({item:c})=>[d("div",fe,[s(n,{label:c.label,icon:c.icon,severity:c.severity,variant:"outlined",raised:"",onClick:T=>v.$emit("update:filterStatu",c.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},me={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},ve={class:"grid m-2"},ye={class:"flex justify-content-center align-items-center w-100"},Te={class:"text-center text-2xl font-bold"},ge={key:0},we={class:"text-center"},xe={class:"text-center text-lg"},Ce={class:"text-center text-lg font-bold"},he={key:1,class:"flex flex-wrap justify-content-center"},$e={class:"flex flex-wrap justify-content-end mt-3"},ke={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(x,{emit:M}){const v=w(!1),p=w(),n=w([{label:"空闲",value:"Livre"},{label:"用餐",value:"Ocupado"},{label:"预定",value:"Reservado"},{label:"已付",value:"Pago"}]);function y(f){return n.value.find(u=>u.value===f)}function c(f){return!f||!Array.isArray(f)?0:parseFloat(f.reduce((u,g)=>u+g.price*g.quantity,0).toFixed(2))}function T(f){const u="m-1 border-3 border-gray-500 ";let g="";switch(f){case"Livre":break;case"Ocupado":g="border-red-300 bg-red-100";break;case"Reservado":g="border-blue-300 bg-blue-100";break;case"Pago":g="border-purple-300 bg-purple-100";break;default:g="border-gray-500 bg-gray-100"}return u+g}return(f,u)=>{const g=F,E=re,D=K,O=J;return m(),k(R,null,[d("div",me,[d("div",ve,[x.editMode?(m(),q(E,{key:0,class:"m-1 border-3 border-gray-500 flex justify-content-center align-items-center",style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:u[0]||(u[0]=r=>v.value=!0)},{content:b(()=>[d("div",ye,[s(g,{text:"",icon:"pi pi-plus",severity:"contrast",size:"large"})])]),_:1})):$("",!0),(m(!0),k(R,null,Y(x.filteredTables,r=>(m(),q(E,{class:ee(T(r.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:t=>x.editMode?"":f.$emit("openTableDetail",r.id)},{content:b(()=>[d("p",Te,"桌号: "+j(r.id),1),x.editMode?$("",!0):(m(),k("div",ge,[d("p",we,j(y(r.status).label),1),d("p",xe,j(r.people)+"人",1),d("p",Ce,j(c(r.order))+"€",1)])),x.editMode?(m(),k("div",he,[s(g,{icon:"pi pi-trash",severity:"danger",outlined:"",raised:"",class:"m-2",onClick:I(t=>f.$emit("removeTable",r.id),["stop"])},null,8,["onClick"])])):$("",!0)]),_:2},1032,["class","onClick"]))),256))])]),s(O,{visible:v.value,"onUpdate:visible":u[3]||(u[3]=r=>v.value=r),modal:!0,dismissableMask:!0,header:"添加桌子",onHide:u[4]||(u[4]=r=>p.value=void 0)},{default:b(()=>[s(D,{modelValue:p.value,"onUpdate:modelValue":u[1]||(u[1]=r=>p.value=r),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:p.value<10?"桌号：0":"桌号：",step:1,min:"1",max:"9999",placeholder:"输入桌号",fluid:""},{incrementbuttonicon:b(()=>u[5]||(u[5]=[d("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:b(()=>u[6]||(u[6]=[d("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix"]),d("div",$e,[s(g,{label:"创建桌子",onClick:u[2]||(u[2]=r=>{f.$emit("addNewTable",p.value),v.value=!1})})])]),_:1},8,["visible"])],64)}}},Ee={class:"flex flex-column justify-content-center align-items-center"},_e={key:0,class:"flex flex-wrap justify-content-center align-items-center"},Oe={key:1,class:"flex flex-wrap justify-content-center align-items-center"},Ve={class:"flex flex-wrap justify-content-center align-items-center m-2"},Me={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},Se={class:"m-2"},je={key:0,class:"flex flex-wrap justify-content-between align-items-center"},qe={key:1,class:"flex flex-wrap justify-content-between align-items-center"},De={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditableMode","tableEditCancel","tableEditConfirm","cleanTable","showTableOrders","showToast"],setup(x,{emit:M}){const v=x,p=M,n=v.selectedTable,y=w([{label:"空闲",value:"Livre",severity:"success"},{label:"用餐",value:"Ocupado",severity:"danger"},{label:"预定",value:"Reservado",severity:"info"},{label:"已付",value:"Pago",severity:"help"}]);function c(){return y.value.find(r=>r.value===n.status)}function T(r,t){if(r==="Adult"){if(n.peopleType.adults<=0&&t<=0)return;n.peopleType.adults+=t}else if(r==="Children"){if(n.peopleType.children<=0&&t<=0)return;n.peopleType.children+=t}n.people=n.peopleType.adults+n.peopleType.children,f()}function f(){p("update:selectedTable",n)}const u=H(),g=()=>{u.require({message:"是否清空"+n.id+"号桌",header:"确认清台",icon:"pi pi-info-circle",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{p("showToast","info","操作","桌号"+n.id+"，清台"),p("cleanTable",n.id)},reject:()=>{p("showToast","error","操作","取消"+n.id+"号桌清台")}})},E=w(null);function D(){window.open(window.env.QR_ADDR+Q.SimpleEncode(v.selectedTable.id),"_blank")}const O=async()=>{if(E.value)try{await ce.toCanvas(E.value,window.env.QR_ADDR+Q.SimpleEncode(v.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(r){console.error("生成二维码失败:",r)}};return te(()=>{O()}),le(()=>window.env.QR_ADDR+Q.SimpleEncode(v.selectedTable.id),O),(r,t)=>{const B=ue,S=de,a=F,e=W;return m(),k(R,null,[d("div",Ee,[d("div",null,[s(S,{class:"m-2",variant:"on"},{default:b(()=>[s(B,{id:"Total",modelValue:_(n).people,"onUpdate:modelValue":t[0]||(t[0]=o=>_(n).people=o),autocomplete:"off",disabled:""},null,8,["modelValue"]),t[12]||(t[12]=d("label",{for:"Total"},"总人数",-1))]),_:1,__:[12]})]),x.isEditTable?(m(),k("div",_e,[s(a,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:t[1]||(t[1]=o=>T("Adult",-1))}),s(S,{class:"m-2",variant:"on"},{default:b(()=>[s(B,{id:"Adult",modelValue:_(n).peopleType.adults,"onUpdate:modelValue":t[2]||(t[2]=o=>_(n).peopleType.adults=o),autocomplete:"off"},null,8,["modelValue"]),t[13]||(t[13]=d("label",{for:"Adult"},"大人",-1))]),_:1,__:[13]}),s(a,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:t[3]||(t[3]=o=>T("Adult",1))})])):$("",!0),x.isEditTable?(m(),k("div",Oe,[s(a,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:t[4]||(t[4]=o=>T("Children",-1))}),s(S,{class:"m-2",variant:"on"},{default:b(()=>[s(B,{id:"Children",modelValue:_(n).peopleType.children,"onUpdate:modelValue":t[5]||(t[5]=o=>_(n).peopleType.children=o),autocomplete:"off"},null,8,["modelValue"]),t[14]||(t[14]=d("label",{for:"Children"},"小孩",-1))]),_:1,__:[14]}),s(a,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:t[6]||(t[6]=o=>T("Children",1))})])):$("",!0)]),d("div",Ve,[x.isEditTable?$("",!0):(m(),q(a,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:c().label,severity:c().severity},null,8,["label","severity"])),x.isEditTable?(m(),q(e,{key:1,modelValue:_(n).status,"onUpdate:modelValue":t[7]||(t[7]=o=>_(n).status=o),options:y.value,optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"])):$("",!0)]),d("div",Me,[d("canvas",{ref_key:"qrCanvas",ref:E,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:D},null,512)]),d("div",Se,[x.isEditTable?$("",!0):(m(),k("div",je,[s(a,{label:"订单详情",severity:"success",onClick:t[8]||(t[8]=o=>r.$emit("showTableOrders"))}),s(a,{label:"清台",onClick:g,severity:"danger",class:"m-1"}),s(a,{label:"编辑",onClick:t[9]||(t[9]=o=>r.$emit("tableEditableMode")),class:"m-1"})])),x.isEditTable?(m(),k("div",qe,[s(a,{label:"取消编辑",severity:"danger",raised:"",class:"m-2",onClick:t[10]||(t[10]=o=>r.$emit("tableEditCancel"))}),s(a,{label:"保存编辑",severity:"success",raised:"",class:"m-2",onClick:t[11]||(t[11]=o=>{r.$emit("tableEditCancel"),r.$emit("tableEditConfirm",_(n))})})])):$("",!0)])],64)}}},Be={key:0},Ne=["disabled","onClick"],Ae={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Ue={class:"font-bold"},Re={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit"],setup(x,{emit:M}){const v=x,p=M,n=w(v.selectedTable.order?.sort((a,e)=>e.price-a.price).filter(a=>a.quantity!=0)),y=w(n.value.filter(a=>a.price!=0)),c=w([]),T=w(!1),f=w(!1);function u(a){let e=0;return a.forEach(o=>{e+=o.price*o.quantity}),e.toFixed(2)}function g(){T.value=!T.value,!T.value&&c.value.length>0&&S()}function E(a){if(c.value.find(e=>e.dishid===a.dishid))c.value.find(e=>e.dishid===a.dishid).quantity+=1;else{const e={...a,quantity:1};c.value.push(e)}a.quantity-=1}function D(){let a="| ";return c.value.forEach(e=>{const o=n.value.find(A=>A.dishid===e.dishid);o&&(a+=e.dishid+"-"+h.getDishName(e)+" "+(o.quantity+e.quantity)+" -> "+o.quantity+` | 
`)}),a}function O(a){p("cancelOrderEdit"),p("showToast","error","操作",`取消菜品删除
`+a),c.value.forEach(e=>{n.value.find(o=>o.dishid===e.dishid).quantity+=e.quantity}),c.value=[]}function r(a){p("saveOrder",c.value),p("showToast","info","操作","桌号1，清台"),c.value=[],n.value=v.selectedTable.order?.sort((e,o)=>o.price-e.price).filter(e=>e.quantity!=0)}const t=H();function B(a){return Array.isArray(a)?a.map(Z):Z(a)}const S=()=>{let a=!1;const e=B(D());t.require({message:e,escape:!0,header:"是否修改以下订单",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{a=!0,r()},reject:()=>{a=!0,O(e)},onHide:()=>{a||O(e)}})};return(a,e)=>{const o=se,A=K,L=oe,N=pe,P=F;return m(),k(R,null,[d("div",null,[s(L,{value:f.value?y.value:n.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:b(()=>e[6]||(e[6]=[d("div",{class:"text-center py-5"},[d("p",{class:"text-gray-500"},"该桌子还没有菜品")],-1)])),default:b(()=>[s(o,{field:"dishid",header:"号码"}),s(o,{header:"菜名"},{body:b(l=>[U(j(_(h).getDishName(l.data)),1)]),default:b(()=>[e[2]||(e[2]=U(" > "))]),_:1,__:[2]}),s(o,{field:"price",header:"单价"}),s(o,{field:"quantity",header:"数量"},{body:b(l=>[T.value?$("",!0):(m(),k("label",Be,j(l.data.quantity),1)),T.value?(m(),q(A,{key:1,modelValue:l.data.quantity,"onUpdate:modelValue":i=>l.data.quantity=i,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:b(()=>e[3]||(e[3]=[d("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:b(()=>[d("span",{class:"p-inputnumber-button-icon",disabled:l.data.quantity<=0,onClick:i=>E(l.data)},e[4]||(e[4]=[d("i",{class:"pi pi-angle-down"},null,-1)]),8,Ne)]),_:2},1032,["modelValue","onUpdate:modelValue"])):$("",!0)]),_:1}),s(o,{header:"总价"},{body:b(l=>[U(j(u([l.data])),1)]),default:b(()=>[e[5]||(e[5]=U(" > "))]),_:1,__:[5]})]),_:1},8,["value"])]),d("div",Ae,[d("label",Ue," 合计："+j(y.value.length>0?u(y.value):"0"),1),d("label",null,[s(N,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l)},null,8,["modelValue"]),e[7]||(e[7]=U(" 不显示价格为0 "))]),s(P,{label:T.value?"保存":"编辑",onClick:e[1]||(e[1]=l=>g())},null,8,["label"])])],64)}}},Fe={class:"flex flex-wrap justify-content-between align-items-center m-1"},it={__name:"TablesPage",setup(x){const M=H(),v=w("Todos"),p=w(!1),n=w(!1),y=w({id:0}),c=w(!1),T=w(!1),f=w({}),u=ae(()=>v.value==="Todos"?h.tables.value:h.tables.value.filter(l=>l.status===v.value));function g(){p.value=!0}function E(){p.value==!0&&(p.value=!1)}function D(l){M.require({message:"确认删除"+l+`号桌子？
(注意：删除后不能撤回)`,header:"删除桌子",icon:"pi pi-trash",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认删除",severity:"danger"},accept:()=>{const i=h.deleteTable(l);i!=null?N.add({severity:"error",summary:i.title,detail:i.message,life:3e3}):N.add({severity:"info",summary:"删除成功",detail:"成功删除桌号："+l,life:3e3})},reject:()=>{}})}async function O(l){l<10&&(l="0"+l);const i=await h.addNewTable(l);i!==void 0?N.add({severity:"error",summary:i.title,detail:i.message,life:3e3}):N.add({severity:"info",summary:"创建成功",detail:"成功创建桌号："+l,life:3e3})}function r(l){const i=h.tables.value.find(V=>V.id===l);y.value={...i,order:i?.order||[]},n.value=!0}function t(){c.value=!0}function B(l){const i={id:l.id,status:l.status,peopleType:{adults:l.peopleType.adults,children:l.peopleType.children}},V=h.updateTable(i);V&&console.log("tableEditConfirm Error:",V),c.value=!1}function S(){c.value=!1,n.value=!1}function a(){c.value=!1}function e(l){const i=h.tableClean(l);i&&console.log("cleanTable Error:",i),S()}function o(){const l=h.tables.value.find(i=>i.id===y.value.id);y.value={...l,order:l?.order||[]},T.value=!0}function A(l){h.deleteOrders(y.value.id,l),f.value.order&&(h.deleteOrder(f.value),f.value={})}function L(){h.refreshTables()}const N=ie();function P(l,i,V,z){N.add({severity:l||"",summary:i||"",detail:V||"",life:z||3e3})}return(l,i)=>{const V=F,z=X,G=J;return m(),k(R,null,[d("div",Fe,[s(be,{filterStatu:v.value,"onUpdate:filterStatu":i[0]||(i[0]=C=>v.value=C)},null,8,["filterStatu"]),p.value?$("",!0):(m(),q(V,{key:0,icon:"pi pi-pencil",label:"编辑桌子",class:"mr-3",onClick:g})),p.value?(m(),q(V,{key:1,label:"关闭编辑模式",class:"mr-3",onClick:E})):$("",!0)]),s(z,{class:"m-0"}),s(ke,{filteredTables:u.value,"onUpdate:filteredTables":i[1]||(i[1]=C=>u.value=C),editMode:p.value,"onUpdate:editMode":i[2]||(i[2]=C=>p.value=C),onOpenTableDetail:r,onRemoveTable:D,onAddNewTable:O},null,8,["filteredTables","editMode"]),s(G,{visible:n.value,"onUpdate:visible":i[5]||(i[5]=C=>n.value=C),header:"桌号: "+y.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"},onHide:S},{default:b(()=>[s(De,{selectedTable:y.value,"onUpdate:selectedTable":i[3]||(i[3]=C=>y.value=C),isEditTable:c.value,"onUpdate:isEditTable":i[4]||(i[4]=C=>c.value=C),onTableEditableMode:t,onTableEditCancel:a,onTableEditConfirm:B,onCleanTable:e,onShowTableOrders:o,onShowToast:P},null,8,["selectedTable","isEditTable"])]),_:1},8,["visible","header"]),s(G,{visible:T.value,"onUpdate:visible":i[6]||(i[6]=C=>T.value=C),modal:!0,dismissableMask:!0,header:"菜品详情",style:{"min-width":"350px","max-width":"550px"},onHide:i[7]||(i[7]=C=>L())},{default:b(()=>[s(Re,{selectedTable:y.value,onSaveOrder:A,onCancelOrderEdit:L,onShowToast:P},null,8,["selectedTable"])]),_:1},8,["visible"])],64)}}};export{it as default};
