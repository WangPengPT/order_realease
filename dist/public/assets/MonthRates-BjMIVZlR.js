import{s as G}from"./index-BQoOYY0e.js";import{s as I,a as O}from"./index-CSF5DMG3.js";import{s as W,a as q,b as J,c as K}from"./index-DEoikMzI.js";import{s as Q}from"./index-jqmaJLEb.js";import{s as X}from"./index-CeLZXEuR.js";import{b as ee}from"./index-UWjVb1or.js";import{h as p,G as te,n as $,c as v,d as a,a as d,w as s,j as le,o as r,l as ae,F as x,A as k,f as h,z as Y,t as F,e as oe}from"./index-C6PSjnPN.js";import"./index-BYBm0dCp.js";import"./index-kao1m_HO.js";import"./index-BRKDf7a0.js";import"./index-N4RJtCTP.js";import"./index-nHcMNJSJ.js";import"./index-DUDhmHNJ.js";import"./index-BF-X1nVO.js";const se={class:"flex flex-column w-full",style:{position:"fixed",top:"0",left:"0"}},re={class:"flex flex-wrap justify-content-center align-items-center gap-1 ml-2"},ne={class:"card flex flex-column",style:{height:"calc(100vh - 200px)"}},P=2025,ie=1,Re={__name:"MonthRates",setup(ue){const z=le(),n=p();H();const _=p(!0),C=new Date,m=C.getFullYear(),b=C.getMonth()+1;te(_,()=>{g(i.value,w.value)});const y=p([{id:0,value:0,label:"总评分"}]);S();function S(){for(let e=P;e<=m;e++)y.value.push({id:e,value:e,label:e})}function A(e){return!e.rates||!e.likes?0:(e.likes/e.rates*5).toFixed(2)}function g(e,t){i.value=e,w.value=t,n.value=[],i.value===0?E(()=>{N()}):T(n,e,t,()=>{N()}),n.value=n.value.filter(l=>l.category)}function T(e,t,l,c){t==m&&l==b?$.getCurrentMonthRates(e):$.getMonthRatesWithDate(e,t,l,()=>{c()}),c()}function E(e){for(let t=P;t<=m;t++)for(let l=ie;l<=b;l++){const c=p([]);T(c,t,l,()=>{c.value.forEach(R=>n.value.push(R))})}e()}function N(){const e=[];for(let t=0;t<n.value.length;t++){const l=n.value[t];l.likes=l.likes|0,l.rates=l.rates|0,l.rating=A(l),_.value?l.rates!==0&&e.push(l):e.push(l)}n.value=e}async function H(){try{await $.refreshMenu(),g(m,b)}catch(e){console.error("获取评分失败:",e),toast.add({severity:"error",summary:"错误",detail:"获取评分失败",life:3e3})}}const M=p([]);L();function L(){const e=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];for(let t=0;t<e.length;t++)M.value.push({id:t+1,value:e[t],label:t+1+" - "+e[t].toUpperCase()})}const i=p(m),w=p(b);return(e,t)=>{const l=ee,c=X,R=Q,V=J,j=q,D=K,B=W,f=O,U=I,Z=G;return r(),v("div",se,[a(R,{class:"bg-primary text-white p-2"},{start:s(()=>[a(l,{icon:"pi pi-arrow-left",class:"p-button-text text-white",label:"主页",onClick:t[0]||(t[0]=o=>ae(z).push("/"))}),d("div",re,[a(c,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),class:"green-toggle"},null,8,["modelValue"]),t[2]||(t[2]=d("label",null,"隐藏无评分的菜品",-1))])]),_:1}),d("div",null,[a(B,{value:i.value},{default:s(()=>[a(j,null,{default:s(()=>[(r(!0),v(x,null,k(y.value,o=>(r(),h(V,{key:o.id,value:o.id,onClick:u=>g(o.id,w.value)},{default:s(()=>[Y(F(o.label),1)]),_:2},1032,["value","onClick"]))),128))]),_:1}),(r(!0),v(x,null,k(y.value,o=>(r(),h(D,{key:o.id,value:o.id},{default:s(()=>[i.value!==0?(r(),h(B,{key:0,value:w.value,scrollable:""},{default:s(()=>[a(j,null,{default:s(()=>[(r(!0),v(x,null,k(M.value,u=>(r(),h(V,{key:u.id,value:u.id,onClick:ce=>g(o.id,u.id)},{default:s(()=>[Y(F(u.label),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024),(r(!0),v(x,null,k(M.value,u=>(r(),h(D,{key:u.id,value:u.id},null,8,["value"]))),128))]),_:2},1032,["value"])):oe("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),d("div",ne,[a(U,{value:n.value,stripedRows:"",scrollable:"",scrollHeight:"flex",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],tableStyle:"min-width: 50rem"},{empty:s(()=>t[3]||(t[3]=[d("div",{class:"text-center py-5"},[d("i",{class:"pi pi-search",style:{"font-size":"3rem",color:"#ccc"}}),d("p",{class:"mt-3 text-gray-500"},"未找到评分")],-1)])),default:s(()=>[a(f,{field:"id",header:"ID",sortable:""}),a(f,{field:"category",header:"类型",sortable:""}),a(f,{field:"name",header:"菜名"}),a(f,{field:"rating",header:(i.value===0?"":"当月")+"综合评分",sortable:""},null,8,["header"]),a(f,{field:"likes",header:(i.value===0?"":"当月")+"点赞数",sortable:""},null,8,["header"]),a(f,{field:"rates",header:(i.value===0?"":"当月")+"评分总数",sortable:""},null,8,["header"])]),_:1},8,["value"])])]),a(Z)])}}};export{Re as default};
