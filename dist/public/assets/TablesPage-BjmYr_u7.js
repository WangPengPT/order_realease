import{s as H}from"./index-C9sHzxGz.js";import{a as K,s as W}from"./index-D_BBjgiq.js";import{b as F}from"./index-2xuslDVO.js";import{h as x,f as j,o as v,w as y,a as o,d as i,c as O,e as k,F as z,C as X,t as M,z as L,x as Y,u as G,q as J,i as I,G as ee,A as U,l as te,n as C,H as Q,E as le}from"./index-CPglD95J.js";import{s as ae}from"./index-CFhPOjmr.js";import{d as Z,a as se,s as ie}from"./index-D2QaFu4X.js";import{s as ne}from"./index-9EPWeMID.js";import{s as oe}from"./index-BfprNMmG.js";import{s as re}from"./index-DL6jIj-w.js";import{Q as de,C as P}from"./CodeMaker-IOgtdCDu.js";import{s as ue}from"./index-Ckq88eel.js";import"./index-f5mji0sK.js";import"./index-qwhjxsUf.js";import"./index-CNFbPPBa.js";import"./index-CidjEKZH.js";import"./index-DBFeidwZ.js";import"./index-CvRyHg3R.js";import"./index-B2QEePNG.js";import"./_commonjsHelpers-gnU0ypJ3.js";const ce={class:"p-menuitem-content"},pe={__name:"TableMenuBar",props:{filterStatu:String},setup(E){const D=x([{label:"全部",value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:"空闲",value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:"用餐",value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:"预定",value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:"已付",value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(T,r)=>{const f=F,g=ae;return v(),j(g,{model:D.value,breakpoint:"355px",class:"border-0"},{item:y(({item:p})=>[o("div",ce,[i(f,{label:p.label,icon:p.icon,severity:p.severity,variant:"outlined",raised:"",onClick:a=>T.$emit("update:filterStatu",p.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},ve={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},fe={class:"grid m-2"},me={class:"flex justify-content-center align-items-center w-100"},be={class:"relative"},ye={class:"text-center text-2xl font-bold"},Te={key:0},ge={class:"text-center"},_e={class:"text-center text-lg"},xe={class:"text-center text-lg font-bold"},we={key:1,class:"flex flex-wrap justify-content-center"},he={class:"flex flex-wrap justify-content-end mt-3"},ke={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(E,{emit:D}){const T=x(!1),r=x(),f=x([{label:"空闲",value:"Livre"},{label:"用餐",value:"Ocupado"},{label:"预定",value:"Reservado"},{label:"已付",value:"Pago"}]);function g(m){return f.value.find(d=>d.value===m)}function p(m){return!m||!Array.isArray(m)?0:parseFloat(m.reduce((d,b)=>d+b.price*b.quantity,0).toFixed(2))}function a(m){const d="m-1 border-3 border-gray-500 ";let b="";switch(m){case"Livre":break;case"Ocupado":b="border-red-300 bg-red-100";break;case"Reservado":b="border-blue-300 bg-blue-100";break;case"Pago":b="border-purple-300 bg-purple-100";break;default:b="border-gray-500 bg-gray-100"}return d+b}function $(m,d){m["msg_"+d]=!1,client.socket.emit("click_msg",m.id,d)}return(m,d)=>{const b=F,S=ne,V=Z,B=H;return v(),O(z,null,[o("div",ve,[o("div",fe,[E.editMode?(v(),j(S,{key:0,class:"m-1 border-3 border-gray-500 flex justify-content-center align-items-center",style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:d[0]||(d[0]=c=>T.value=!0)},{content:y(()=>[o("div",me,[i(b,{text:"",icon:"pi pi-plus",severity:"contrast",size:"large"})])]),_:1})):k("",!0),(v(!0),O(z,null,X(E.filteredTables,c=>(v(),j(S,{class:Y(a(c.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:q=>E.editMode?"":m.$emit("openTableDetail",c.id)},{header:y(()=>[o("div",be,[c.msg_pay?(v(),j(b,{key:0,onClick:L(q=>$(c,"pay"),["stop"]),icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"}},null,8,["onClick"])):k("",!0),c.msg_call?(v(),j(b,{key:1,onClick:L(q=>$(c,"call"),["stop"]),icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"}},null,8,["onClick"])):k("",!0)])]),content:y(()=>[o("p",ye,"桌号: "+M(c.id),1),E.editMode?k("",!0):(v(),O("div",Te,[o("p",ge,M(g(c.status).label),1),o("p",_e,M(c.people)+"人",1),o("p",xe,M(p(c.order))+"€",1)])),E.editMode?(v(),O("div",we,[i(b,{icon:"pi pi-trash",severity:"danger",outlined:"",raised:"",class:"m-2",onClick:L(q=>m.$emit("removeTable",c.id),["stop"])},null,8,["onClick"])])):k("",!0)]),_:2},1032,["class","onClick"]))),256))])]),i(B,{visible:T.value,"onUpdate:visible":d[3]||(d[3]=c=>T.value=c),modal:!0,dismissableMask:!0,header:"添加桌子",onHide:d[4]||(d[4]=c=>r.value=void 0)},{default:y(()=>[i(V,{modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=c=>r.value=c),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:r.value<10?"桌号：0":"桌号：",step:1,min:"1",max:"9999",placeholder:"输入桌号",fluid:""},{incrementbuttonicon:y(()=>d[5]||(d[5]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:y(()=>d[6]||(d[6]=[o("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix"]),o("div",he,[i(b,{label:"创建桌子",onClick:d[2]||(d[2]=c=>{m.$emit("addNewTable",r.value),T.value=!1})})])]),_:1},8,["visible"])],64)}}},Ce={class:"flex flex-column justify-content-center align-items-center"},$e={key:0,class:"flex flex-wrap justify-content-center align-items-center"},Oe={key:1,class:"flex flex-wrap justify-content-center align-items-center"},Ee={class:"flex flex-wrap justify-content-center align-items-center m-2"},Se={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},Ve={class:"m-2"},Ne={key:0,class:"flex flex-wrap justify-content-between align-items-center"},je={key:1,class:"flex flex-wrap justify-content-between align-items-center"},qe={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(E,{emit:D}){const T=G(),r=x(!1),f=E,g=D;function p(){g("onEdit",f.selectedTable.id,n=>{a.value=JSON.parse(JSON.stringify(n)),r.value=!0})}const a=x(JSON.parse(JSON.stringify(f.selectedTable))),$=x([{label:"空闲",value:"Livre",severity:"success"},{label:"用餐",value:"Ocupado",severity:"danger"},{label:"预定",value:"Reservado",severity:"info"},{label:"已付",value:"Pago",severity:"help"}]);function m(){g("tableEditConfirm",a.value,n=>{(n==null?void 0:n.success)===!1?T.add({severity:"error",summary:"失败",detail:n.message,life:3e3}):(n==null?void 0:n.success)===!0&&(T.add({severity:"success",summary:"成功",detail:n.message,life:3e3}),r.value=!1)})}function d(){r.value=!1,a.value=JSON.parse(JSON.stringify(f.selectedTable))}function b(){return $.value.find(n=>n.value===a.value.status)}function S(n,e){const t=Number(e);if(n==="Adult"){a.value.peopleType.adults+t<=0?a.value.peopleType.adults=0:a.value.peopleType.adults=a.value.peopleType.adults+t,a.value.people=a.value.peopleType.adults+a.value.peopleType.children;return}if(n==="Children"){a.value.peopleType.children+t<=0?a.value.peopleType.children=0:a.value.peopleType.children=a.value.peopleType.children+t,a.value.people=a.value.peopleType.adults+a.value.peopleType.children;return}}const V=J(),B=()=>{V.require({message:"是否清空"+a.value.id+"号桌",header:"确认清台",icon:"pi pi-info-circle",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{g("cleanTable",a.value.id,n=>{(n==null?void 0:n.success)===!1?T.add({severity:"error",summary:"操作",detail:n.message,life:3e3}):(n==null?void 0:n.success)===!0&&T.add({severity:"success",summary:"操作",detail:`桌号${a.value.id}，清台`,life:3e3})})},reject:()=>{T.add({severity:"error",summary:"操作",detail:`取消${a.value.id}号桌清台`,life:3e3})}})},c=x(null);function q(){window.open(window.env.QR_ADDR+P.SimpleEncode(f.selectedTable.id),"_blank")}const A=async()=>{if(c.value)try{await de.toCanvas(c.value,window.env.QR_ADDR+P.SimpleEncode(f.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(n){console.error("生成二维码失败:",n)}};return I(()=>{A()}),ee(()=>window.env.QR_ADDR+P.SimpleEncode(f.selectedTable.id),A),(n,e)=>{const t=re,u=oe,w=F,s=K;return v(),O(z,null,[o("div",Ce,[o("div",null,[i(u,{class:"m-2",variant:"on"},{default:y(()=>[i(t,{id:"Total",modelValue:a.value.people,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.people=l),autocomplete:"off",disabled:""},null,8,["modelValue"]),e[9]||(e[9]=o("label",{for:"Total"},"总人数",-1))]),_:1,__:[9]})]),r.value?(v(),O("div",$e,[i(w,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:e[1]||(e[1]=l=>S("Adult",-1))}),i(u,{class:"m-2",variant:"on"},{default:y(()=>[i(t,{id:"Adult",modelValue:a.value.peopleType.adults,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.peopleType.adults=l),autocomplete:"off"},null,8,["modelValue"]),e[10]||(e[10]=o("label",{for:"Adult"},"大人",-1))]),_:1,__:[10]}),i(w,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:e[3]||(e[3]=l=>S("Adult",1))})])):k("",!0),r.value?(v(),O("div",Oe,[i(w,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:e[4]||(e[4]=l=>S("Children",-1))}),i(u,{class:"m-2",variant:"on"},{default:y(()=>[i(t,{id:"Children",modelValue:a.value.peopleType.children,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.peopleType.children=l),autocomplete:"off"},null,8,["modelValue"]),e[11]||(e[11]=o("label",{for:"Children"},"小孩",-1))]),_:1,__:[11]}),i(w,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:e[6]||(e[6]=l=>S("Children",1))})])):k("",!0)]),o("div",Ee,[r.value?k("",!0):(v(),j(w,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:b().label,severity:b().severity},null,8,["label","severity"])),r.value?(v(),j(s,{key:1,modelValue:a.value.status,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.status=l),options:$.value,optionLabel:"label",optionValue:"value"},null,8,["modelValue","options"])):k("",!0)]),o("div",Se,[o("canvas",{ref_key:"qrCanvas",ref:c,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:q},null,512)]),o("div",Ve,[r.value?k("",!0):(v(),O("div",Ne,[i(w,{label:"订单详情",severity:"success",onClick:e[8]||(e[8]=()=>n.$emit("showTableOrders"))}),i(w,{label:"清台",onClick:B,severity:"danger",class:"m-1"}),i(w,{label:"编辑",onClick:p,class:"m-1"})])),r.value?(v(),O("div",je,[i(w,{label:"取消编辑",severity:"danger",raised:"",class:"m-2",onClick:d}),i(w,{label:"保存编辑",severity:"success",raised:"",class:"m-2",onClick:m})])):k("",!0)])],64)}}},De={key:0},Me=["disabled","onClick"],Be={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Ae={class:"font-bold"},Re={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(E,{emit:D}){var n;const T=E,r=D,f=x((n=T.selectedTable.order)==null?void 0:n.sort((e,t)=>t.price-e.price).filter(e=>e.quantity!=0)),g=x(f.value.filter(e=>e.price!=0)),p=x([]),a=x(!1),$=x(!1);function m(e){let t=0;return e.forEach(u=>{t+=u.price*u.quantity}),t.toFixed(2)}function d(){a.value=!a.value,!a.value&&p.value.length>0&&A()}function b(e){if(p.value.find(t=>t.dishid===e.dishid))p.value.find(t=>t.dishid===e.dishid).quantity+=1;else{const t={...e,quantity:1};p.value.push(t)}e.quantity-=1}function S(){let e="| ";return p.value.forEach(t=>{const u=f.value.find(w=>w.dishid===t.dishid);u&&(e+=t.dishid+"-"+C.getDishName(t)+" "+(u.quantity+t.quantity)+" -> "+u.quantity+` | 
`)}),e}function V(e){r("cancelOrderEdit"),r("showToast","error","操作",`取消菜品删除
`+e),p.value.forEach(t=>{f.value.find(u=>u.dishid===t.dishid).quantity+=t.quantity}),p.value=[]}function B(e){var t;r("saveOrder",p.value),r("showToast","info","操作","桌号1，清台"),p.value=[],f.value=(t=T.selectedTable.order)==null?void 0:t.sort((u,w)=>w.price-u.price).filter(u=>u.quantity!=0)}const c=J();function q(e){return Array.isArray(e)?e.map(Q):Q(e)}const A=()=>{let e=!1;const t=q(S());c.require({message:t,escape:!0,header:"是否修改以下订单",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{e=!0,B()},reject:()=>{e=!0,V(t)},onHide:()=>{e||V(t)}})};return(e,t)=>{const u=se,w=Z,s=ie,l=ue,h=F;return v(),O(z,null,[o("div",null,[i(s,{value:$.value?g.value:f.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:y(()=>t[6]||(t[6]=[o("div",{class:"text-center py-5"},[o("p",{class:"text-gray-500"},"该桌子还没有菜品")],-1)])),default:y(()=>[i(u,{field:"dishid",header:"号码"}),i(u,{header:"菜名"},{body:y(_=>[U(M(te(C).getDishName(_.data)),1)]),default:y(()=>[t[2]||(t[2]=U(" > ",-1))]),_:1,__:[2]}),i(u,{field:"price",header:"单价"}),i(u,{field:"quantity",header:"数量"},{body:y(_=>[a.value?k("",!0):(v(),O("label",De,M(_.data.quantity),1)),a.value?(v(),j(w,{key:1,modelValue:_.data.quantity,"onUpdate:modelValue":R=>_.data.quantity=R,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:y(()=>t[3]||(t[3]=[o("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:y(()=>[o("span",{class:"p-inputnumber-button-icon",disabled:_.data.quantity<=0,onClick:R=>b(_.data)},t[4]||(t[4]=[o("i",{class:"pi pi-angle-down"},null,-1)]),8,Me)]),_:2},1032,["modelValue","onUpdate:modelValue"])):k("",!0)]),_:1}),i(u,{header:"总价"},{body:y(_=>[U(M(m([_.data])),1)]),default:y(()=>[t[5]||(t[5]=U(" > ",-1))]),_:1,__:[5]})]),_:1},8,["value"])]),o("div",Be,[o("label",Ae," 合计："+M(g.value.length>0?m(g.value):"0"),1),o("label",null,[i(l,{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=_=>$.value=_)},null,8,["modelValue"]),t[7]||(t[7]=U(" 不显示价格为0 ",-1))]),i(h,{label:a.value?"保存":"编辑",onClick:t[1]||(t[1]=_=>d())},null,8,["label"])])],64)}}},Ue={class:"flex flex-wrap justify-content-between align-items-center m-1"},it={__name:"TablesPage",setup(E){const D=J(),T=x("Todos"),r=x(!1),f=x(!1),g=x({id:0}),p=x(!1),a=x({}),$=le(()=>T.value==="Todos"?C.tables.value:C.tables.value.filter(s=>s.status===T.value));function m(){r.value=!0}function d(){r.value==!0&&(r.value=!1)}function b(s){D.require({message:"确认删除"+s+`号桌子？
(注意：删除后不能撤回)`,header:"删除桌子",icon:"pi pi-trash",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认删除",severity:"danger"},accept:()=>{const l=C.deleteTable(s);l!=null?u.add({severity:"error",summary:l.title,detail:l.message,life:3e3}):u.add({severity:"info",summary:"删除成功",detail:"成功删除桌号："+s,life:3e3})},reject:()=>{}})}async function S(s){s<10&&(s="0"+s);const l=await C.addNewTable(s);l!==void 0?u.add({severity:"error",summary:l.title,detail:l.message,life:3e3}):u.add({severity:"info",summary:"创建成功",detail:"成功创建桌号："+s,life:3e3})}function V(s){const l=C.tables.value.find(h=>h.id===s);g.value={...l,order:(l==null?void 0:l.order)||[]}}function B(s,l){const h=C.tables.value.find(_=>_.id===s);g.value={...h,order:(h==null?void 0:h.order)||[]},l(g.value)}function c(s){V(s),f.value=!0}function q(s,l){const h={id:s.id,status:s.status,peopleType:{adults:s.peopleType.adults,children:s.peopleType.children}},_=C.updateTable(h);V(s.id),l(_?{success:!1,message:"更新失败"}:{success:!0,message:"更新成功"})}function A(s,l){const h=C.tableClean(s);h?(console.log("cleanTable Error:",h),l({success:!1,message:"更新失败"})):(f.value=!1,l({success:!0,message:"更新成功"}))}function n(){const s=g.value.id;V(s),p.value=!0}function e(s){C.deleteOrders(g.value.id,s),a.value.order&&(C.deleteOrder(a.value),a.value={})}function t(){C.refreshTables()}const u=G();function w(s,l,h,_){u.add({severity:s||"",summary:l||"",detail:h||"",life:_||3e3})}return(s,l)=>{const h=F,_=W,R=H;return v(),O(z,null,[o("div",Ue,[i(pe,{filterStatu:T.value,"onUpdate:filterStatu":l[0]||(l[0]=N=>T.value=N)},null,8,["filterStatu"]),r.value?k("",!0):(v(),j(h,{key:0,icon:"pi pi-pencil",label:"编辑桌子",class:"mr-3",onClick:m})),r.value?(v(),j(h,{key:1,label:"关闭编辑模式",class:"mr-3",onClick:d})):k("",!0)]),i(_,{class:"m-0"}),i(ke,{filteredTables:$.value,"onUpdate:filteredTables":l[1]||(l[1]=N=>$.value=N),editMode:r.value,"onUpdate:editMode":l[2]||(l[2]=N=>r.value=N),onOpenTableDetail:c,onRemoveTable:b,onAddNewTable:S},null,8,["filteredTables","editMode"]),i(R,{visible:f.value,"onUpdate:visible":l[3]||(l[3]=N=>f.value=N),header:"桌号: "+g.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:y(()=>[i(qe,{selectedTable:g.value,onTableEditConfirm:q,onCleanTable:A,onShowTableOrders:n,onOnEdit:B},null,8,["selectedTable"])]),_:1},8,["visible","header"]),i(R,{visible:p.value,"onUpdate:visible":l[4]||(l[4]=N=>p.value=N),modal:!0,dismissableMask:!0,header:"菜品详情",style:{"min-width":"350px","max-width":"550px"},onHide:l[5]||(l[5]=N=>t())},{default:y(()=>[i(Re,{selectedTable:g.value,onSaveOrder:e,onCancelOrderEdit:t,onShowToast:w},null,8,["selectedTable"])]),_:1},8,["visible"])],64)}}};export{it as default};
