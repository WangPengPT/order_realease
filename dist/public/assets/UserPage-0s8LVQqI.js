import{Q as N,b as P,e as S,z as _,f as L,h as o,v as a,M as n,s as m,U as M,o as T,t as i,B as y}from"./vue-BLaX11bV.js";import{u as B,b as f,l as k,e as A,j as w,N as g}from"./primevue-Dz75K8ui.js";import{c as p}from"./index-C9_-_DFL.js";import{_ as F}from"./LoginDialog-CyXkp9Op.js";import"./vendor-BwD4SF-p.js";const z={class:"user-profile-container p-4 surface-ground min-h-screen"},E={class:"mb-4"},j={class:"flex align-items-center gap-2"},G={class:"text-primary font-semibold"},O={class:"grid formgrid p-fluid"},Q={class:"col-12 md:col-6 field"},R={for:"displayName",class:"text-color-secondary font-medium block mb-2"},q={class:"col-12 md:col-6 field"},H={for:"email",class:"text-color-secondary font-medium block mb-2"},J={class:"col-12 md:col-6 field"},K={for:"registrationDate",class:"text-color-secondary font-medium block mb-2"},W={class:"col-12 md:col-6 field"},X={for:"points",class:"text-color-secondary font-medium block mb-2"},Y={class:"col-12 md:col-6 field"},Z={for:"id",class:"text-color-secondary font-medium block mb-2"},ss={class:"flex align-items-center gap-2"},os={class:"text-primary font-semibold"},es={class:"flex flex-column gap-3"},ls={class:"flex flex-column gap-3"},as={class:"field"},ts={for:"oldPassword",class:"text-color-secondary font-medium block mb-2"},ns={class:"p-error"},ds={class:"field"},is={for:"newPassword",class:"text-color-secondary font-medium block mb-2"},rs={class:"p-error"},cs={class:"field"},ms={for:"confirmPassword",class:"text-color-secondary font-medium block mb-2"},us={class:"p-error"},hs={__name:"UserPage",setup(fs){const{t:c}=N(),b=B(),$=M(),r=P({id:"",email:"",display_name:"",registrationDate:"",phone:"",points:0});S(async()=>{p.isAuthenticated()?r.value=p.userInfo.value:v.value=!0});const v=P(!1);function V(){v.value=!1,r.value=p.userInfo.value}function D(){r.value.id==""&&$.go(-1)}const u=P(!1),h=P(!1),t=_({oldPassword:"",newPassword:"",confirmPassword:""}),d=_({oldPassword:"",newPassword:"",confirmPassword:""}),U=e=>{const s={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("pt-PT",s)},C=async()=>{b.add({severity:"info",summary:"information refreshed",life:3e3})},I=()=>{let e=!0;return d.oldPassword="",d.newPassword="",d.confirmPassword="",t.oldPassword||(d.oldPassword=c("common.auth.enterOldPassword"),e=!1),t.newPassword?t.newPassword.length<6&&(d.newPassword=c("common.auth.passwordTooShort"),e=!1):(d.newPassword=c("common.auth.enterNewPassword"),e=!1),t.confirmPassword!==t.newPassword&&(d.confirmPassword=c("common.auth.passwordsDoNotMatch"),e=!1),e},x=async()=>{if(I()){h.value=!0;try{const e={oldPassword:t.oldPassword,newPassword:t.newPassword,token:p.accessToken.value};await p.centerAPI("vip_change_password",e,s=>{s.result?(u.value=!1,b.add({severity:"success",summary:c("common.success"),detail:c("common.auth.modifyPasswordSuccess")||"Password changed successfully",life:3e3}),t.oldPassword="",t.newPassword="",t.confirmPassword=""):b.add({severity:"error",summary:c("common.failed"),detail:s.message||c("common.auth.modifyPasswordFailed"),life:3e3})})}catch(e){console.error("Change password error:",e)}finally{h.value=!1}}};return(e,s)=>(T(),L("div",z,[o("div",E,[a(n(f),{label:"back",icon:"pi pi-arrow-left",class:"p-button-text p-button-secondary",onClick:s[0]||(s[0]=l=>e.$router.go(-1))})]),a(n(k),{class:"user-card mb-4"},{title:m(()=>[o("div",j,[s[11]||(s[11]=o("i",{class:"pi pi-user text-color-secondary"},null,-1)),o("span",G,i(e.$t("common.auth.userInfo")),1)])]),content:m(()=>[o("div",O,[o("div",Q,[o("label",R,i(e.$t("common.auth.displayName")),1),a(n(w),{id:"displayName",modelValue:r.value.display_name,"onUpdate:modelValue":s[1]||(s[1]=l=>r.value.display_name=l),readonly:"",class:"w-full"},null,8,["modelValue"])]),o("div",q,[o("label",H,i(e.$t("common.auth.email")),1),a(n(w),{id:"email",modelValue:r.value.email,"onUpdate:modelValue":s[2]||(s[2]=l=>r.value.email=l),readonly:"",class:"w-full"},null,8,["modelValue"])]),o("div",J,[o("label",K,i(e.$t("common.auth.registerTime")),1),a(n(w),{id:"registrationDate",value:U(r.value.registrationDate),readonly:"",class:"w-full"},null,8,["value"])]),o("div",W,[o("label",X,i(e.$t("common.auth.points")),1),a(n(w),{id:"points",value:r.value.points.toLocaleString(),readonly:"",class:"w-full"},null,8,["value"])]),o("div",Y,[o("label",Z,i(e.$t("common.auth.userId")),1),a(n(w),{id:"id",modelValue:r.value.id,"onUpdate:modelValue":s[3]||(s[3]=l=>r.value.id=l),readonly:"",class:"w-full"},null,8,["modelValue"])])])]),_:1}),a(n(k),{class:"actions-card mb-4"},{title:m(()=>[o("div",ss,[s[12]||(s[12]=o("i",{class:"pi pi-cog text-color-secondary"},null,-1)),o("span",os,i(e.$t("common.auth.operation")),1)])]),content:m(()=>[o("div",es,[a(n(f),{label:e.$t("common.auth.modifyPassword"),icon:"pi pi-key",class:"p-button-outlined",onClick:s[4]||(s[4]=l=>u.value=!0)},null,8,["label"]),a(n(f),{label:e.$t("common.auth.refreshInfo"),icon:"pi pi-refresh",class:"p-button-outlined p-button-secondary",onClick:C},null,8,["label"])])]),_:1}),a(F,{visible:v.value,"onUpdate:visible":[s[5]||(s[5]=l=>v.value=l),D],showGuestShortcut:!1,onLoginSuccess:V},null,8,["visible"]),a(n(A),{visible:u.value,"onUpdate:visible":s[10]||(s[10]=l=>u.value=l),modal:"",header:e.$t("common.auth.modifyPassword"),style:{width:"450px"}},{footer:m(()=>[a(n(f),{label:e.$t("common.cancel"),icon:"pi pi-times",class:"p-button-text",onClick:s[9]||(s[9]=l=>u.value=!1)},null,8,["label"]),a(n(f),{label:e.$t("common.save"),icon:"pi pi-check",loading:h.value,onClick:x},null,8,["label","loading"])]),default:m(()=>[o("div",ls,[o("div",as,[o("label",ts,i(e.$t("common.auth.oldPassword")),1),a(n(g),{id:"oldPassword",modelValue:t.oldPassword,"onUpdate:modelValue":s[6]||(s[6]=l=>t.oldPassword=l),feedback:!1,toggleMask:"",class:y(["w-full",{"p-invalid":d.oldPassword}])},null,8,["modelValue","class"]),o("small",ns,i(d.oldPassword),1)]),o("div",ds,[o("label",is,i(e.$t("common.auth.newPassword")),1),a(n(g),{id:"newPassword",modelValue:t.newPassword,"onUpdate:modelValue":s[7]||(s[7]=l=>t.newPassword=l),toggleMask:"",class:y(["w-full",{"p-invalid":d.newPassword}])},null,8,["modelValue","class"]),o("small",rs,i(d.newPassword),1)]),o("div",cs,[o("label",ms,i(e.$t("common.auth.confirmPassword")),1),a(n(g),{id:"confirmPassword",modelValue:t.confirmPassword,"onUpdate:modelValue":s[8]||(s[8]=l=>t.confirmPassword=l),feedback:!1,toggleMask:"",class:y(["w-full",{"p-invalid":d.confirmPassword}])},null,8,["modelValue","class"]),o("small",us,i(d.confirmPassword),1)])])]),_:1},8,["visible","header"])]))}};export{hs as default};
