import{s as ee}from"./index-Bsi-Sd13.js";import{s as ne}from"./index-Fs0KR1hu.js";import{a as G}from"./index-Dj_IRUm9.js";import{q as K,h as C,s as F,c as P,o as c,a as l,b as r,w as p,t as f,C as B,F as L,n as D,f as q,e as M,E as Z,l as k,z as I,A as J,u as oe,x as te,i as le,H as ce,J as se}from"./index-DzHUwVyT.js";import{b as pe,a as ie,s as re}from"./index-vqYuOxMK.js";import{s as me}from"./index-D_Jdeed6.js";import{s as be}from"./index-B77-hDyx.js";import{a as de}from"./index-BpY7Scom.js";import{s as ve}from"./index-C45HymDU.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as fe}from"./index-B7pSxufG.js";import{s as ye}from"./index-hN7hn0f8.js";import{s as ge}from"./index-BS1jMPr4.js";import{Q as he,C as X}from"./CodeMaker-IOgtdCDu.js";import{s as _e}from"./index-CpBW3uPp.js";import"./index-BiJebUMY.js";import"./index-DidCtkvN.js";import"./index-ebALBZ2U.js";import"./index-Czp4exBW.js";import"./index-Cy_lTcNw.js";import"./index-CJInCNO_.js";import"./index-Bgd2jX6O.js";import"./index-BuEHQXhk.js";import"./_commonjsHelpers-gnU0ypJ3.js";const xe={class:"hidden sm:block md:block lg:block"},Te={class:"p-menuitem-content"},$e={class:"text-center"},ke={class:"block sm:hidden md:hidden lg:hidden w-full ml-2"},we={__name:"TableMenuBar",props:{filterStatu:String},setup(S){const{t:b}=K(),_=C(S.filterStatu),v=F(()=>[{label:b("tablesPage.all"),value:"Todos",icon:"pi pi-circle-fill",severity:"contrast",message_severity:"contrast"},{label:b("tablesPage.available"),value:"Livre",icon:"pi pi-circle-fill",severity:"success",message_severity:"success"},{label:b("tablesPage.dining"),value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger",message_severity:"error"},{label:b("tablesPage.reserved"),value:"Reservado",icon:"pi pi-circle-fill",severity:"info",message_severity:"info"},{label:b("tablesPage.paid"),value:"Pago",icon:"pi pi-circle-fill",severity:"help",message_severity:"secondary"}]);function y(g){return v.value.find(d=>d.value===g)}return(g,d)=>{const T=G,O=be,i=me,$=pe;return c(),P(L,null,[l("div",xe,[r(O,{model:v.value,breakpoint:"319px",class:"border-0"},{item:p(({item:x})=>[l("div",Te,[r(T,{label:x.label,icon:x.icon,severity:x.severity,variant:"outlined",raised:"",class:"border-round-lg p-2",onClick:V=>g.$emit("update:filterStatu",x.value)},{default:p(()=>[l("label",$e,"● "+f(x.label),1)]),_:2},1032,["label","icon","severity","onClick"])])]),_:1},8,["model"])]),l("div",ke,[r($,{modelValue:_.value,"onUpdate:modelValue":[d[0]||(d[0]=x=>_.value=x),d[1]||(d[1]=x=>g.$emit("update:filterStatu",_.value))],options:v.value,optionValue:"value",checkmark:"",highlightOnSelect:!1,class:"flex align-items-center",size:"small",style:{width:"200px",height:"40px"}},{value:p(x=>[r(i,{class:"text-center",severity:y(x.value).message_severity,variant:"simple"},{default:p(()=>[B("● "+f(y(x.value).label),1)]),_:2},1032,["severity"])]),option:p(x=>[r(i,{class:"text-center",severity:x.option.message_severity,variant:"simple"},{default:p(()=>[B(f(x.option.label),1)]),_:2},1032,["severity"])]),_:1},8,["modelValue","options"])])],64)}}},Pe={class:"overflow-auto",style:{height:"calc(100vh - 200px)"}},Ce={class:"hidden sm:block md:block lg:block"},Se={class:"grid m-2"},Ne={class:"relative"},Oe={class:"flex flex-column justify-content-center align-items-center",style:{height:"144px"}},Me={class:"flex justify-content-center align-items-center",style:{height:"30%"}},De={class:"text-2xl font-bold"},Ee={key:0,class:"flex flex-column align-items-center",style:{height:"70%"}},Ve={class:"text-center text-lg"},je={class:"text-center text-2xl font-bold"},qe=["onClick"],Ae={class:"block sm:hidden md:hidden lg:hidden"},Re={class:"grid m-2"},Ue={class:"col-12"},Be={class:"col-12"},Le={class:"relative"},ze={class:"flex flex-row p-0"},Fe={class:"flex justify-content-center align-items-center relative",style:{width:"30%",height:"74px"}},He={class:"absolute top-0 left-0 pl-1 text-xs"},Ie={class:"font-bold text-4xl"},Je={key:0,class:"flex flex-row justify-content-center align-items-center",style:{width:"70%",height:"74px"}},Qe={class:"flex relative",style:{width:"30%",height:"74px"}},Ze={class:"absolute top-0 left-0 pl-1 text-xs"},Ge={class:"flex justify-content-center align-items-center w-full"},Ke={class:"font-bold text-2xl"},Ye={class:"flex relative",style:{width:"70%",height:"74px"}},We={class:"absolute top-0 left-0 pl-1 text-xs"},Xe={class:"flex justify-content-center align-items-center w-full"},et={class:"font-bold text-2xl"},tt=["onClick"],lt={class:"font-bold text-xl"},at={class:"ont-bold"},st={class:"flex flex-wrap justify-content-end mt-3"},nt={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(S,{emit:b}){const{t:s}=K(),_=C(!1),v=C(),y=C(!1),g=C({}),d=F(()=>[{label:s("tablesPage.available"),value:"Livre"},{label:s("tablesPage.dining"),value:"Ocupado"},{label:s("tablesPage.reserved"),value:"Reservado"},{label:s("tablesPage.paid"),value:"Pago"}]);function T(m){return d.value.find(o=>o.value===m)}function O(m){return Number(m.peopleType.children)+Number(m.peopleType.adults)}function i(m){return!m||!Array.isArray(m)?0:parseFloat(m.reduce((o,E)=>o+E.price*E.quantity,0).toFixed(2))}function $(m){const o=D.getCurrentPeoplePrice();return Number(m.peopleType.children)*o.children+Number(m.peopleType.adults)*o.adults}function x(m){return(i(m.order)+$(m)).toFixed(2)}function V(m,o){let w="";switch(m){case"Livre":w="text-green-600";break;case"Ocupado":w="text-red-600";break;case"Reservado":w="text-blue-700";break;case"Pago":w="text-purple-600";break;default:w="text-gray-600"}return""+w}function j(m,o=3){const E="border-"+o+" border-gray-500 ";let w="";switch(m){case"Livre":break;case"Ocupado":w="border-red-300 bg-red-50";break;case"Reservado":w="border-blue-300 bg-blue-50";break;case"Pago":w="border-purple-300 bg-purple-50";break;default:w="border-gray-500"}return E+w}function R(m,o){o=="pay"?(g.value=m.nif_note,y.value=!0):m["msg_"+o]=!1,D.socket.emit("click_msg",m.id,o)}function H(){document.getElementById("tipsAudio").play()}return D.playSoundFun=H,(m,o)=>{const E=ve,w=G,U=ne,A=ee,z=de;return c(),P(L,null,[l("div",Pe,[o[12]||(o[12]=l("audio",{id:"tipsAudio",src:"/sound/tips.mp3",preload:"auto"},null,-1)),l("div",Ce,[l("div",Se,[S.editMode?(c(),q(E,{key:0,class:"m-1 border-3 border-gray-500 border-round-3xl flex justify-content-center align-items-center",style:{width:"150px",height:"150px"},onClick:o[0]||(o[0]=e=>_.value=!0)},{content:p(()=>o[8]||(o[8]=[l("div",{class:"flex justify-content-center align-items-center"},[l("i",{class:"pi pi-plus text-3xl text-gray-600"})],-1)])),_:1})):M("",!0),(c(!0),P(L,null,Z(S.filteredTables,e=>(c(),q(E,{class:I([j(e.status),"m-1 border-round-3xl flex flex-column justify-content-center align-items-center"]),style:{width:"150px",height:"150px"},onClick:t=>S.editMode?"":m.$emit("openTableDetail",e.id)},{header:p(()=>[l("div",Ne,[e.msg_pay?(c(),q(w,{key:0,icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"},onClick:J(t=>R(e,"pay"),["stop"])},null,8,["onClick"])):M("",!0),e.msg_call?(c(),q(w,{key:1,icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"},onClick:J(t=>R(e,"call"),["stop"])},null,8,["onClick"])):M("",!0)])]),content:p(()=>[l("div",Oe,[l("div",Me,[l("label",De,f(k(s)("tablesPage.tableNum"))+": "+f(e.id),1)]),S.editMode?M("",!0):(c(),P("div",Ee,[l("label",{class:I(["text-center text-sm",V(e.status)])},f(T(e.status).label),3),l("p",Ve,f(O(e)+" "+k(s)("tablesPage.people")),1),l("p",je,f(x(e))+"€",1)])),S.editMode?(c(),P("div",{key:1,class:I(j(e.status,1)),style:{width:"144px"}},null,2)):M("",!0),S.editMode?(c(),P("div",{key:2,class:"flex flex-wrap justify-content-center align-items-center w-full",style:{height:"70%"},onClick:J(t=>m.$emit("removeTable",e.id),["stop"])},o[9]||(o[9]=[l("i",{class:"pi pi-trash text-3xl text-red-400"},null,-1)]),8,qe)):M("",!0)])]),_:2},1032,["class","onClick"]))),256))])]),l("div",Ae,[l("div",Re,[l("div",Ue,[S.editMode?(c(),q(E,{key:0,class:"border-3 border-gray-500 flex align-items-center justify-content-center",onClick:o[1]||(o[1]=e=>_.value=!0),style:{height:"80px"}},{content:p(()=>o[10]||(o[10]=[l("div",{class:"flex justify-content-center align-items-center"},[l("i",{class:"pi pi-plus text-2xl text-gray-600",size:"large"})],-1)])),_:1})):M("",!0)]),(c(!0),P(L,null,Z(S.filteredTables,e=>(c(),P("div",Be,[r(E,{class:I([j(e.status),"flex justify-content-center border-round-2xl"]),style:{height:"80px"},onClick:t=>S.editMode?"":m.$emit("openTableDetail",e.id)},{header:p(()=>[l("div",Le,[e.msg_pay?(c(),q(w,{key:0,icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"},onClick:J(t=>R(e,"pay"),["stop"])},null,8,["onClick"])):M("",!0),e.msg_call?(c(),q(w,{key:1,icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"},onClick:J(t=>R(e,"call"),["stop"])},null,8,["onClick"])):M("",!0)])]),content:p(()=>[l("div",ze,[l("div",Fe,[l("small",He,f(k(s)("tablesPage.tableNum")),1),l("label",Ie,f(e.id),1)]),l("div",{class:I(j(e.status,1))},null,2),S.editMode?M("",!0):(c(),P("div",Je,[l("div",Qe,[l("small",Ze,f(k(s)("tablesPage.peopleNum")),1),l("div",Ge,[l("label",Ke,f(O(e)),1)])]),l("div",{class:I([j(e.status,1),"h-full"])},null,2),l("div",Ye,[l("small",We,f(k(s)("tablesPage.costNum")),1),l("div",Xe,[l("label",et,f(x(e))+" €",1)])])])),S.editMode?(c(),P("div",{key:1,class:"flex flex-row justify-content-center align-items-center",style:{width:"70%",height:"74px"},onClick:J(t=>m.$emit("removeTable",e.id),["stop"])},o[11]||(o[11]=[l("i",{class:"pi pi-trash text-2xl text-gray-600",size:"large"},null,-1)]),8,tt)):M("",!0)])]),_:2},1032,["class","onClick"])]))),256))])])]),r(A,{visible:y.value,"onUpdate:visible":o[2]||(o[2]=e=>y.value=e),modal:!0,dismissableMask:!0,header:k(s)("tablesPage.payInfo"),style:{"min-width":"300px","max-width":"450px"},onHide:o[3]||(o[3]=e=>g.value={nif:void 0,note:void 0})},{default:p(()=>{var e,t;return[l("label",lt,"NIF:"+f((e=g.value)!=null&&e.nif?g.value.nif:k(s)("tablesPage.noNif")),1),r(U),l("label",at,f(k(s)("tablesPage.note"))+": "+f((t=g.value)!=null&&t.note?g.value.note:k(s)("tablesPage.noNote")),1)]}),_:1},8,["visible","header"]),r(A,{visible:_.value,"onUpdate:visible":o[6]||(o[6]=e=>_.value=e),modal:!0,dismissableMask:!0,header:k(s)("tablesPage.addTable"),onHide:o[7]||(o[7]=e=>v.value=void 0)},{default:p(()=>[r(z,{modelValue:v.value,"onUpdate:modelValue":o[4]||(o[4]=e=>v.value=e),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:`${k(s)("tablesPage.tableNum")}：${v.value<10?"0":""}`,step:1,min:1,max:9999,placeholder:k(s)("tablesPage.enterTable"),fluid:""},{incrementbuttonicon:p(()=>o[13]||(o[13]=[l("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:p(()=>o[14]||(o[14]=[l("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix","placeholder"]),l("div",st,[r(w,{label:k(s)("tablesPage.createTable"),onClick:o[5]||(o[5]=e=>{m.$emit("addNewTable",v.value),_.value=!1})},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},ot=ue(nt,[["__scopeId","data-v-04203ec6"]]),it={class:"flex flex-column justify-content-center align-items-center"},rt={for:"Total"},dt={key:0,class:"flex flex-wrap justify-content-center align-items-center"},ut={for:"Adult"},ct={key:1,class:"flex flex-wrap justify-content-center align-items-center"},pt={for:"Children"},mt={class:"flex flex-wrap justify-content-center align-items-center m-2"},bt={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},vt={class:"m-2"},ft={key:0,class:"flex flex-wrap justify-content-between align-items-center"},yt={key:1,class:"flex flex-wrap justify-content-between align-items-center"},gt={class:"flex flex-column"},ht={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(S,{emit:b}){const{t:s}=K();let _=!1;const v=oe(),y=C(!1),g=C(!1),d=S,T=b;function O(){T("onEdit",d.selectedTable.id,e=>{i.value=JSON.parse(JSON.stringify(e)),y.value=!0})}const i=C(JSON.parse(JSON.stringify(d.selectedTable))),$=C([{label:s("tablesPage.available"),value:"Livre",severity:"success"},{label:s("tablesPage.dining"),value:"Ocupado",severity:"danger"},{label:s("tablesPage.reserved"),value:"Reservado",severity:"info"},{label:s("tablesPage.paid"),value:"Pago",severity:"help"}]);function x(){_||(g.value=!1,i.value=JSON.parse(JSON.stringify(d.selectedTable))),_=!1}const V=F(()=>Number(i.value.peopleType.children)+Number(i.value.peopleType.adults));function j(){i.value.status?(T("tableEditConfirm",i.value,e=>{(e==null?void 0:e.success)==!0?(v.add({severity:"success",summary:s("common.success"),detail:e.message,life:3e3}),y.value=!1):v.add({severity:"error",summary:s("common.error"),detail:e.message,life:3e3})}),g.value=!1,_=!0):v.add({severity:"error",summary:s("common.error"),detail:s("tablesPage.stateError"),life:3e3})}function R(){g.value=!0}function H(){y.value=!1,i.value=JSON.parse(JSON.stringify(d.selectedTable))}function m(){return $.value.find(e=>e.value===i.value.status)}function o(e,t){const a=Number(t);if(e==="Adult"){Number(i.value.peopleType.adults)+a<=0?i.value.peopleType.adults=0:i.value.peopleType.adults=Number(i.value.peopleType.adults)+a,i.value.people=Number(i.value.peopleType.adults)+Number(i.value.peopleType.children);return}if(e==="Children"){i.value.peopleType.children+a<=0?i.value.peopleType.children=0:i.value.peopleType.children=Number(i.value.peopleType.children)+a,i.value.people=Number(i.value.peopleType.adults)+Number(i.value.peopleType.children);return}}const E=te(),w=()=>{E.require({message:s("tablesPage.clearMsg.1")+i.value.id+s("tablesPage.clearMsg.2"),header:s("tablesPage.confirmClear"),icon:"pi pi-info-circle",rejectLabel:s("common.cancel"),rejectProps:{label:s("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:s("common.confirm"),severity:"danger"},accept:()=>{T("cleanTable",i.value.id,e=>{(e==null?void 0:e.success)===!1?v.add({severity:"error",summary:s("common.error"),detail:e.message,life:3e3}):(e==null?void 0:e.success)===!0&&v.add({severity:"success",summary:s("common.success"),detail:`${s("tablesPage.clearSucMsg.1")}${i.value.id}${s("tablesPage.clearSucMsg.2")}`,life:3e3})})},reject:()=>{v.add({severity:"error",summary:s("common.operation"),detail:`${s("tablesPage.clearCancelMsg.1")}${i.value.id}${s("tablesPage.clearCancelMsg.2")}`,life:3e3})}})},U=C(null);function A(){window.open(window.env.QR_ADDR+X.SimpleEncode(d.selectedTable.id),"_blank")}const z=async()=>{if(U.value)try{await he.toCanvas(U.value,window.env.QR_ADDR+X.SimpleEncode(d.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(e){console.error("生成二维码失败:",e)}};return le(()=>{z()}),ce(()=>window.env.QR_ADDR+X.SimpleEncode(d.selectedTable.id),z),(e,t)=>{var Q,Y;const a=ge,n=ye,u=G,N=fe,W=ee;return c(),P(L,null,[l("div",it,[l("div",null,[r(n,{class:"m-2",variant:"on"},{default:p(()=>[r(a,{id:"Total",modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=h=>V.value=h),autocomplete:"off",disabled:""},null,8,["modelValue"]),l("label",rt,f(k(s)("tablesPage.totalPeople")),1)]),_:1})]),y.value?(c(),P("div",dt,[r(u,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:t[1]||(t[1]=h=>o("Adult",-1))}),r(n,{class:"m-2",variant:"on"},{default:p(()=>[r(a,{id:"Adult",modelValue:i.value.peopleType.adults,"onUpdate:modelValue":t[2]||(t[2]=h=>i.value.peopleType.adults=h),autocomplete:"off"},null,8,["modelValue"]),l("label",ut,f(k(s)("tablesPage.adult")),1)]),_:1}),r(u,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:t[3]||(t[3]=h=>o("Adult",1))})])):M("",!0),y.value?(c(),P("div",ct,[r(u,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:t[4]||(t[4]=h=>o("Children",-1))}),r(n,{class:"m-2",variant:"on"},{default:p(()=>[r(a,{id:"Children",modelValue:i.value.peopleType.children,"onUpdate:modelValue":t[5]||(t[5]=h=>i.value.peopleType.children=h),autocomplete:"off"},null,8,["modelValue"]),l("label",pt,f(k(s)("tablesPage.child")),1)]),_:1}),r(u,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:t[6]||(t[6]=h=>o("Children",1))})])):M("",!0)]),l("div",mt,[y.value?M("",!0):(c(),q(u,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:(Q=m())==null?void 0:Q.label,severity:(Y=m())==null?void 0:Y.severity,onClick:R},null,8,["label","severity"])),y.value?(c(),q(N,{key:1,modelValue:i.value.status,"onUpdate:modelValue":t[7]||(t[7]=h=>i.value.status=h),options:$.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:i.value.status===null},null,8,["modelValue","options","invalid"])):M("",!0)]),l("div",bt,[l("canvas",{ref_key:"qrCanvas",ref:U,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:A},null,512)]),l("div",vt,[y.value?M("",!0):(c(),P("div",ft,[r(u,{label:e.$t("tablesPage.orderDetails"),severity:"success",onClick:t[8]||(t[8]=()=>e.$emit("showTableOrders"))},null,8,["label"]),r(u,{label:e.$t("tablesPage.clear"),onClick:w,severity:"danger",class:"m-1"},null,8,["label"]),r(u,{label:e.$t("tablesPage.edit"),onClick:O,class:"m-1"},null,8,["label"])])),y.value?(c(),P("div",yt,[r(u,{label:e.$t("tablesPage.cancelEdit"),severity:"danger",raised:"",class:"m-2",onClick:H},null,8,["label"]),r(u,{label:e.$t("tablesPage.saveEdit"),severity:"success",raised:"",class:"m-2",onClick:j},null,8,["label"])])):M("",!0)]),r(W,{visible:g.value,"onUpdate:visible":t[10]||(t[10]=h=>g.value=h),modal:"",header:e.$t("tablesPage.editState"),closable:!0,dismissableMask:!0,onHide:x},{default:p(()=>[l("div",gt,[r(N,{modelValue:i.value.status,"onUpdate:modelValue":t[9]||(t[9]=h=>i.value.status=h),options:$.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:i.value.status===null},null,8,["modelValue","options","invalid"]),r(u,{label:e.$t("common.confirm"),class:"mt-3",onClick:j},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},_t=ue(ht,[["__scopeId","data-v-fd40c96d"]]);function xt(S){const b=new Date(S),s=i=>String(i).padStart(2,"0"),_=new Date(b.toLocaleString("en-US",{timeZone:"Europe/Lisbon"})),v=_.getFullYear(),y=s(_.getMonth()+1),g=s(_.getDate()),d=s(_.getHours()),T=s(_.getMinutes()),O=s(_.getSeconds());return`${v}-${y}-${g} ${d}:${T}:${O}`}const Tt={class:"font-bold",style:{"min-width":"100px"}},$t={__name:"TableOrderTimeLine",props:{table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},setup(S){const b=S,s=C([]),_=F(()=>{const d=b.table.order;return Array.isArray(d)?Array.from(new Set(d.flatMap(T=>Array.isArray(T.orderIds)?T.orderIds:[]))):[]}),v=F(()=>{const d=D.orders.value,T=_.value;return Array.isArray(d)?d.filter(O=>T.includes(O.id)).sort((O,i)=>O.timestamp-i.timestamp):[]}),y=[{field:"id",header:"订单号"},{field:"table",header:"桌号"},{field:"status",header:"状态"},{field:"timestamp",header:"时间",body:d=>xt(d.timestamp)}],g=[{field:"dishid",header:"编号"},{field:"quantity",header:"数量"},{field:"name",header:"名称",body:d=>D.getDishName(d)}];return le(()=>{s.value=v.value.map(d=>d.id)}),(d,T)=>{const O=ie,i=re;return c(),q(i,{value:v.value,dataKey:"id",expandedRows:s.value,"onUpdate:expandedRows":T[0]||(T[0]=$=>s.value=$),expandableRows:""},{expansion:p($=>[(c(!0),P(L,null,Z($.data.items,x=>(c(),P("div",{key:x.dishid,class:"p-3 mb-2 border-round bg-gray-100"},[(c(),P(L,null,Z(g,V=>l("div",{key:V.field,class:"flex gap-2 mb-1"},[l("span",Tt,f(V.header)+":",1),l("span",null,f(typeof V.body=="function"?V.body(x):x[V.field]),1)])),64))]))),128))]),default:p(()=>[r(O,{expander:"",style:{width:"3rem"}}),(c(),P(L,null,Z(y,$=>r(O,{key:$.field,field:$.field,header:$.header,sortable:""},{body:p(x=>[B(f(typeof $.body=="function"?$.body(x.data):x.data[$.field]),1)]),_:2},1032,["field","header"])),64))]),_:1},8,["value","expandedRows"])}}},kt={key:0},wt={class:"flex flex-column"},Pt={key:0},Ct=["disabled","onClick"],St={class:"text-center py-5"},Nt={class:"text-gray-500"},Ot={key:1},Mt={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Dt={class:"font-bold"},Et={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(S,{emit:b}){var t;const{t:s}=K(),_=S,v=b,y=C((t=_.selectedTable.order)==null?void 0:t.sort((a,n)=>n.price-a.price).filter(a=>a.quantity!=0)),g=C(y.value.filter(a=>a.price!=0)),d=C([]),T=C(!1),O=C(!1),i=C(!1),$=C();le(()=>{x()});function x(){D.getPeoplePricesData($,_.selectedTable.id)}const V=F(()=>{const a=j(),n=y.value.reduce((u,N)=>u+N.price*N.quantity,0);return(a+n).toFixed(2)});function j(){if(!$.value)return 0;let a=0;for(const n in $.value)a+=Number($.value[n].totalPrice);return a}const R=F(()=>{for(const a in $.value)if($.value[a].price!=0)return!0;return!1});function H(a){let n=0;return a.forEach(u=>{n+=u.price*u.quantity}),n.toFixed(2)}function m(){T.value=!T.value,!T.value&&d.value.length>0&&e()}function o(a){if(d.value.find(n=>n.dishid===a.dishid))d.value.find(n=>n.dishid===a.dishid).quantity+=1;else{const n={...a,quantity:1};d.value.push(n)}a.quantity-=1}function E(){let a="| ";return d.value.forEach(n=>{const u=y.value.find(N=>N.dishid===n.dishid);u&&(a+=n.dishid+"-"+D.getDishName(n)+" "+(u.quantity+n.quantity)+" -> "+u.quantity+` | 
`)}),a}function w(a){v("cancelOrderEdit"),v("showToast","error",s("common.operation"),s("tablesPage.editCancelMsg")+`
`+a),d.value.forEach(n=>{y.value.find(u=>u.dishid===n.dishid).quantity+=n.quantity}),d.value=[]}function U(a){var n;v("saveOrder",d.value),v("showToast","info",s("common.operation"),s("tablesPage.ediSucMsg")+`
`+a),d.value=[],y.value=(n=_.selectedTable.order)==null?void 0:n.sort((u,N)=>N.price-u.price).filter(u=>u.quantity!=0)}const A=te();function z(a){return Array.isArray(a)?a.map(se):se(a)}const e=()=>{let a=!1;const n=z(E());A.require({message:n,escape:!0,header:s("tablesPage.editOrder"),rejectLabel:s("common.cancel"),rejectProps:{label:s("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:s("common.save"),severity:"danger"},accept:()=>{a=!0,U(n)},reject:()=>{a=!0,w(n)},onHide:()=>{a||w(n)}})};return(a,n)=>{const u=ie,N=re,W=de,Q=_e,Y=G;return c(),P(L,null,[i.value?(c(),P("div",Ot,[r($t,{table:S.selectedTable},null,8,["table"])])):(c(),P("div",kt,[l("div",wt,[R.value?(c(),q(N,{key:0,value:$.value},{default:p(()=>[r(u,{field:"peopleType",header:k(s)("tablesPage.peopleType")},{body:p(({data:h})=>[B(f(k(s)("tablesPage."+(h.peopleType.toLowerCase().includes("adult")?"adult":"child"))),1)]),_:1},8,["header"]),r(u,{field:"price",header:k(s)("tablesPage.price")},null,8,["header"]),r(u,{field:"quantity",header:k(s)("tablesPage.quantity")},null,8,["header"]),r(u,{field:"totalPrice",header:k(s)("tablesPage.totalPrice")},null,8,["header"])]),_:1},8,["value"])):M("",!0)]),r(N,{value:O.value?g.value:y.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:p(()=>[l("div",St,[l("p",Nt,f(a.$t("tablesPage.noOrder")),1)])]),default:p(()=>[r(u,{field:"dishid",header:"ID"}),r(u,{header:a.$t("tablesPage.name")},{body:p(h=>[B(f(k(D).getDishName(h.data)),1)]),default:p(()=>[n[3]||(n[3]=B(" > ",-1))]),_:1,__:[3]},8,["header"]),r(u,{field:"price",header:a.$t("tablesPage.price")},null,8,["header"]),r(u,{field:"quantity",header:a.$t("tablesPage.quantity")},{body:p(h=>[T.value?M("",!0):(c(),P("label",Pt,f(h.data.quantity),1)),T.value?(c(),q(W,{key:1,modelValue:h.data.quantity,"onUpdate:modelValue":ae=>h.data.quantity=ae,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:p(()=>n[4]||(n[4]=[l("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:p(()=>[l("span",{class:"p-inputnumber-button-icon",disabled:h.data.quantity<=0,onClick:ae=>o(h.data)},n[5]||(n[5]=[l("i",{class:"pi pi-angle-down"},null,-1)]),8,Ct)]),_:2},1032,["modelValue","onUpdate:modelValue"])):M("",!0)]),_:1},8,["header"]),r(u,{header:a.$t("tablesPage.totalPrice")},{body:p(h=>[B(f(H([h.data])),1)]),default:p(()=>[n[6]||(n[6]=B(" > ",-1))]),_:1,__:[6]},8,["header"])]),_:1},8,["value"])])),l("div",Mt,[l("label",Dt,f(a.$t("tablesPage.total")+": ")+" "+f(V.value),1),l("label",null,[r(Q,{modelValue:O.value,"onUpdate:modelValue":n[0]||(n[0]=h=>O.value=h)},null,8,["modelValue"]),B(" "+f(a.$t("tablesPage.showNonZero")),1)]),l("label",null,[r(Q,{modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=h=>i.value=h)},null,8,["modelValue"]),B(" "+f(a.$t("tablesPage.timeLine")),1)]),r(Y,{label:T.value?a.$t("common.save"):a.$t("common.edit"),onClick:n[2]||(n[2]=h=>m())},null,8,["label"])])],64)}}},Vt={class:"flex flex-wrap justify-content-between align-items-center m-1"},jt={class:""},qt={class:"m-2"},At={class:"hidden sm:block md:block lg:block"},Rt={class:"hidden sm:block md:block lg:block"},dl={__name:"TablesPage",setup(S){const{t:b}=K(),s=te(),_=C("Todos"),v=C(!1),y=C(!1),g=C({id:0}),d=C(!1),T=C({}),O=F(()=>_.value==="Todos"?D.tables.value:D.tables.value.filter(e=>e.status===_.value));function i(){v.value=!0}function $(){v.value==!0&&(v.value=!1)}function x(e){s.require({message:b("tablesPage.removeTableMsg.1")+e+b("tablesPage.removeTableMsg.2"),header:b("tablesPage.removeTableHeader"),icon:"pi pi-trash",rejectProps:{label:b("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:b("common.confirm"),severity:"danger"},accept:()=>{const t=D.deleteTable(e);t!=null?A.add({severity:"error",summary:t.title,detail:t.message,life:3e3}):A.add({severity:"info",summary:b("common.success"),detail:b("tablesPage.removeSucMsg.1")+e+b("tablesPage.removeSucMsg.2"),life:3e3})},reject:()=>{}})}async function V(e){e<10&&(e="0"+e);const t=await D.addNewTable(e);t!==void 0?A.add({severity:"error",summary:t.title,detail:t.message,life:3e3}):A.add({severity:"info",summary:b("common.success"),detail:b("tablesPage.createSucMsg.1")+e+b("tablesPage.createSucMsg.2"),life:3e3})}function j(e){const t=D.tables.value.find(a=>a.id===e);g.value={...t,order:(t==null?void 0:t.order)||[]}}function R(e,t){const a=D.tables.value.find(n=>n.id===e);g.value={...a,order:(a==null?void 0:a.order)||[]},t(g.value)}function H(e){j(e),y.value=!0}function m(e,t){const a={id:e.id,status:e.status,peopleType:{adults:e.peopleType.adults,children:e.peopleType.children}},n=D.updateTable(a);j(e.id),t(n?{success:!1,message:b("tablesPage.updateFailMsg")}:{success:!0,message:b("tablesPage.updateSucMsg")})}function o(e,t){const a=D.tableClean(e);a?(console.log("cleanTable Error:",a),t({success:!1,message:b("tablesPage.updateFailMsg")})):(y.value=!1,t({success:!0,message:b("tablesPage.updateSucMsg")}))}function E(){const e=g.value.id;j(e),d.value=!0}function w(e){D.deleteOrders(g.value.id,e),T.value.order&&(D.deleteOrder(T.value),T.value={})}function U(){D.refreshTables()}const A=oe();function z(e,t,a,n){A.add({severity:e||"",summary:t||"",detail:a||"",life:n||3e3})}return(e,t)=>{const a=G,n=ne,u=ee;return c(),P(L,null,[l("div",Vt,[l("div",jt,[r(we,{filterStatu:_.value,"onUpdate:filterStatu":t[0]||(t[0]=N=>_.value=N),style:{padding:"0"}},null,8,["filterStatu"])]),l("div",qt,[v.value?M("",!0):(c(),q(a,{key:0,class:"unchange_white_text_button",onClick:i},{default:p(()=>[t[6]||(t[6]=l("i",{class:"pi pi-pencil"},null,-1)),l("label",At,f(k(b)("tablesPage.editTables")),1)]),_:1,__:[6]})),v.value?(c(),q(a,{key:1,class:"unchange_white_text_button",onClick:$},{default:p(()=>[t[7]||(t[7]=l("i",{class:"pi pi-arrow-left"},null,-1)),l("label",Rt,f(k(b)("tablesPage.closeEdit")),1)]),_:1,__:[7]})):M("",!0)])]),r(n,{class:"m-0"}),r(ot,{filteredTables:O.value,"onUpdate:filteredTables":t[1]||(t[1]=N=>O.value=N),editMode:v.value,"onUpdate:editMode":t[2]||(t[2]=N=>v.value=N),onOpenTableDetail:H,onRemoveTable:x,onAddNewTable:V},null,8,["filteredTables","editMode"]),r(u,{visible:y.value,"onUpdate:visible":t[3]||(t[3]=N=>y.value=N),header:k(b)("tablesPage.tableNum")+": "+g.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:p(()=>[r(_t,{selectedTable:g.value,onTableEditConfirm:m,onCleanTable:o,onShowTableOrders:E,onOnEdit:R},null,8,["selectedTable"])]),_:1},8,["visible","header"]),r(u,{visible:d.value,"onUpdate:visible":t[4]||(t[4]=N=>d.value=N),modal:!0,dismissableMask:!0,header:k(b)("tablesPage.orderDetails"),style:{"min-width":"350px","max-width":"550px"},onHide:t[5]||(t[5]=N=>U())},{default:p(()=>[r(Et,{selectedTable:g.value,onSaveOrder:w,onCancelOrderEdit:U,onShowToast:z},null,8,["selectedTable"])]),_:1},8,["visible","header"])],64)}}};export{dl as default};
