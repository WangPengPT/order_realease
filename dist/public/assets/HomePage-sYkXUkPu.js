import{g as lt,b as at}from"./vendor-BwD4SF-p.js";import{Q as ce,b as x,e as we,f as r,o as n,h as e,v as m,F as z,y as te,a as N,B as fe,t as o,M as t,s as M,E as Ne,c as J,A as ye,U as Qe,w as ie,C as le,p as nt,I as ot,J as it,R as Je,n as ze,S as ut}from"./vue-BLaX11bV.js";import{k as Te,b as R,e as ge,l as rt,m as Fe,j as Ae,n as Be,u as ct,f as Re,g as Ge,h as Ve,d as Ee,o as _e,c as je,p as dt,q as mt,r as ft,i as vt,v as ht,w as pt}from"./primevue-Dz75K8ui.js";import{c as s,m as Y,a as Se,g as gt,l as He}from"./index-C9_-_DFL.js";import{D as X,c as oe}from"./CartItems-De9WOW_G.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ke}from"./LoginDialog-CyXkp9Op.js";import{a as bt,S as yt}from"./pagination-B9SZp5Mn.js";var _t=at();const Pe=lt(_t),wt={class:"grid"},xt={key:0,class:"col-12 sm:col-12 md:col-6 lg:col-4 border-round surface-section shadow-1 p-2"},kt={class:"flex flex-column"},$t=["onClick"],Dt={class:"p-1 flex-shrink-0 w-7rem h-7rem flex align-items-center justify-content-center overflow-hidden"},It=["src","alt"],Ct={class:"flex flex-column justify-content-center"},Tt={class:"font-bold"},Nt={class:"flex flex-wrap gap-2"},St={class:"flex gap-1 align-items-center"},At={class:"text-color-secondary line2"},Lt={key:0,class:"text-xl font-bold text-primary"},qt={key:1,class:"flex align-items-center gap-1"},Mt={class:"text-l font-bold text-color-secondary"},Ot={class:"text-sm line-through text-500"},jt={key:2,class:"flex gap-2 mr-2",id:"card-quantity"},Pt={class:"w-2rem text-xl text-center"},Rt={key:3,class:"flex gap-2 mr-2"},Gt={key:0,class:"m-2 mt-0"},Vt={class:"flex flex-row justify-content-between align-content-center"},Et={class:"flex flex-column"},Ut={class:"text-l font-bold"},Wt={key:0,class:"text-l font-bold text-color-secondary"},zt={key:1,class:"flex align-items-center gap-1"},Ft={class:"text-l font-bold text-color-secondary"},Bt={class:"text-sm line-through text-500"},Ht={key:0,class:"flex ml-2 mr-2"},Qt={class:"w-2rem text-xl text-center"},Jt={key:1,class:"flex gap-2 mr-3 pt-2 pb-2"},Kt={class:"mb-2 flex justify-content-center"},Xt={class:"font-bold text-center"},Yt={class:"mb-2"},Zt={class:"text-color-secondary m-0 line-height-3 line2 text-center"},es={class:"mb-2"},ts={class:"flex justify-content-center"},ss=["src","alt"],ls={class:"flex align-items-center gap-2"},as=["src","alt"],ns={class:"flex align-items-center gap-3 ml-auto"},os={__name:"DishList",props:{rateDish:{type:Function,required:!0},likedItemsRef:Array,dislikedItemsRef:Array,tabIndex:Number,onlyVeg:Boolean},setup(A){const{t:Q}=ce(),S=X.dishDatas,O=x(null),w=A,I=(u,L=!0)=>{if(!w.onlyVeg)return!0;if(L)return u.vegetable;if(u.subItems.length>0){for(const f of u.subItems)if(f.vegetable)return!0}else return u.dish.vegetable;return!1};we(()=>{let u=s.getOrderMenuTab()[w.tabIndex];if(s.customDishAPI.customDishes.value.map(c=>c.name),s.getMenu().length==0){console.log("exit");return}O.value=S.value[f(S.value,u)].mainDishes,X.showDishList(O.value);function f(c,_){for(const v in c)if(c[v].name==_)return v;console.error("Can not find tab index in menu")}});let a={rated:!1,id:null,like:0,rate:0};const j=u=>X.dishDatas.value[u]?X.dishDatas.value[u].quantity:0,C=u=>{if(!G())return!1;const L=u.quantity;let f=3;if(u.price>0&&(f=9),u.limit){const c=u.id,_=G(),v=(_.peopleType.adults+_.peopleType.children)*u.limit,q=_.order.find(d=>d.dishid==c);let p=0;if(u.subitem)for(const d of u.subitem){p+=j(d);const y=_.order.find(H=>H.dishid==F(d));y&&(p+=y.quantity)}else p+=u.quantity,q&&(p+=q.quantity);return L>=f||v&&p>=v}return L>=f},F=u=>X.dishDatas.value[u]?X.dishDatas.value[u].id:0,G=()=>s.getTableValue(),W=u=>{let L="absolute origin-top-left mt-1 ml-1 border-round-lg pl-1 pr-1 text-xs text-white font-bold ";switch(u){case"new":L+="bg-red-600";break;case"recommended":case"special":L+="bg-orange-600";break;default:L+="bg-blue-600"}return L};function b(u){w.rateDish(a.id,a.like,a.rate,a.rated),U(u,a.rate,a.like),a.id=null,a.like=0,a.rate=0,a.rated=!1}const $=u=>{const L=w.likedItemsRef.indexOf(u);if(a.id=u.id,L!==-1)w.likedItemsRef.splice(L,1),a.like+=-1,a.rate+=-1,a.rated=!1;else{a.rated=!0,w.likedItemsRef.push(u);const f=w.dislikedItemsRef.indexOf(u);f!==-1?(w.dislikedItemsRef.splice(f,1),a.like+=1):(a.like+=1,a.rate+=1)}b(u)};function U(u,L=0,f=0){u.rates=(u.rates||0)+L,u.likes=(u.likes||0)+f}const K=u=>{const L=w.dislikedItemsRef.indexOf(u);if(a.id=u.id,L!==-1)w.dislikedItemsRef.splice(L,1),a.rate+=-1,a.rated=!1;else{a.rated=!0,w.dislikedItemsRef.push(u);const f=w.likedItemsRef.indexOf(u);f!==-1?(w.likedItemsRef.splice(f,1),a.like+=-1):a.rate+=1}b(u)},Z=x(!1),B=x({}),de=u=>{Z.value=!0,B.value=u},ue=u=>{u.target.src="/images/default.png"};function me(u){ee(u.target,300)}function ae(u){ee(u.target,110)}function ee(u,L){const f=u.naturalWidth,c=u.naturalHeight,_=Math.min(f,L),v=_/f,q=c*v;u.style.width=`${_}px`,u.style.height=`${q}px`}return(u,L)=>(n(),r(z,null,[e("div",wt,[(n(!0),r(z,null,te(O.value,(f,c)=>{var _;return n(),r(z,{key:c},[I(f,!1)?(n(),r("div",xt,[e("div",kt,[e("div",{class:fe(["flex flex-row",f.subItems.length!==0?"flex-grow-1":""]),onClick:v=>de(f.dish)},[((_=f.dish.etiquette)==null?void 0:_.length)>0?(n(),r("div",{key:0,class:fe(W(f.dish.etiquette))},o(t(Q)("common.etiquette."+f.dish.etiquette)),3)):N("",!0),e("div",Dt,[e("img",{src:f.dish.image||"/images/default.png",alt:f.dish.name,class:"w-full h-full",style:{"object-fit":"cover"},onError:ue,onLoad:ae},null,40,It)]),e("div",Ct,[e("div",Tt,o(f.dish.name),1),e("div",null,[e("div",Nt,[e("div",St,[(n(),r(z,null,te(5,v=>e("i",{key:v,class:fe(["pi invert-star",v<=Math.floor(f.dish.likes/f.dish.rates*5)?"pi-star-fill":v-.5<=f.dish.likes/f.dish.rates*5?"pi-star-half-fill":"pi-star"]),style:{color:"black"}},null,2)),64)),e("p",null,"("+o(f.dish.rates?f.dish.rates:0)+")",1)])])]),e("div",null,[e("p",At,o(f.dish.note),1)])])],10,$t),f.subItems.length==0?(n(),r("div",{key:0,class:fe(["flex ml-2 mr-2 mb-2",Number(f.dish.price)>0?"justify-content-between":"justify-content-end"])},[!f.dish.discount&&Number(f.dish.price)>0?(n(),r("span",Lt,"â‚¬"+o(f.dish.price),1)):N("",!0),f.dish.discount?(n(),r("div",qt,[e("span",Mt,"â‚¬"+o(f.dish.dis_price),1),e("span",Ot,"â‚¬"+o(f.dish.price),1),m(t(Te),{severity:"danger",value:"-"+f.dish.discount+"%"},null,8,["value"])])):N("",!0),f.dish.soldout?N("",!0):(n(),r("div",jt,[m(t(R),{icon:"pi pi-minus",rounded:"",disabled:f.dish.quantity<=0,onClick:v=>f.dish.quantity--,class:"w-2rem h-2rem"},null,8,["disabled","onClick"]),e("span",Pt,o(f.dish.quantity),1),m(t(R),{icon:"pi pi-plus",rounded:"",disabled:C(f.dish),onClick:v=>f.dish.quantity++,class:"w-2rem h-2rem"},null,8,["disabled","onClick"])])),f.dish.soldout?(n(),r("div",Rt,[m(t(Te),{severity:"danger",value:u.$t("common.soldout")},null,8,["value"])])):N("",!0)],2)):N("",!0),f.subItems.length!==0?(n(!0),r(z,{key:1},te(f.subItems,(v,q)=>(n(),r(z,{key:"index"},[!v.disable&&I(v)?(n(),r("div",Gt,[e("div",Vt,[e("div",Et,[e("span",Ut,o(v.subname),1),!v.discount&&v.price!=="0.00"&&v.price!=="0"?(n(),r("span",Wt,"â‚¬"+o(v.price),1)):N("",!0),v.discount?(n(),r("div",zt,[e("span",Ft,"â‚¬"+o(v.dis_price),1),e("span",Bt,"â‚¬"+o(v.price),1),m(t(Te),{severity:"danger",value:"-"+v.discount+"%"},null,8,["value"])])):N("",!0)]),v.soldout?N("",!0):(n(),r("div",Ht,[m(t(R),{icon:"pi pi-minus",rounded:"",disabled:v.quantity<=0,onClick:p=>v.quantity--,class:"w-2rem h-2rem"},null,8,["disabled","onClick"]),e("span",Qt,o(v.quantity),1),m(t(R),{icon:"pi pi-plus",rounded:"",onClick:p=>v.quantity++,class:"w-2rem h-2rem",disabled:C(v)},null,8,["onClick","disabled"])])),v.soldout?(n(),r("div",Jt,[m(t(Te),{severity:"danger",value:u.$t("common.soldout")},null,8,["value"])])):N("",!0)])])):N("",!0)],64))),128)):N("",!0)])])):N("",!0)],64)}),128))]),m(t(ge),{visible:Z.value,"onUpdate:visible":L[2]||(L[2]=f=>Z.value=f),modal:"",header:" ",style:Ne([{width:"23rem"},{width:"80vw","max-width":"700px"}]),pt:{header:{class:"p-1"}}},{default:M(()=>[e("div",Kt,[e("span",Xt,o(B.value.name),1)]),e("div",Yt,[e("span",Zt,o(B.value.note),1)]),e("div",es,[e("div",ts,[e("img",{class:"w-full h-auto object-contain",src:B.value.image,alt:B.value.name,onError:ue,onLoad:me},null,40,ss)])]),e("div",ls,[(n(!0),r(z,null,te(B.value.allergies,(f,c)=>(n(),r("img",{src:"images/"+f+".png",alt:f,class:"w-2rem h-2rem border-round flex-shrink-0",style:{"object-fit":"cover","min-width":"2rem"}},null,8,as))),256)),e("div",ns,[e("button",{onClick:L[0]||(L[0]=f=>$(B.value)),class:"p-0 border-none bg-transparent cursor-pointer"},[e("i",{class:fe(["pi pi-thumbs-up text-xl",w.likedItemsRef.includes(B.value)?"text-green-500":"text-gray-400"])},null,2)]),e("button",{onClick:L[1]||(L[1]=f=>K(B.value)),class:"p-0 border-none bg-transparent cursor-pointer"},[e("i",{class:fe(["pi pi-thumbs-down text-xl",w.dislikedItemsRef.includes(B.value)?"text-red-500":"text-gray-400"])},null,2)])])])]),_:1},8,["visible"])],64))}},is=xe(os,[["__scopeId","data-v-704e6bd0"]]),us={key:0,class:"text-3xl font-bold"},rs={class:"flex flex-column gap-3 p-1"},cs={key:0,class:"flex flex-column gap-1"},ds={key:0,class:"m-0"},ms={key:0,class:"m-0"},fs={class:"flex justify-content-between gap-4 mt-1"},vs={class:"flex align-items-center gap-2"},hs=["src","alt"],ps={class:"flex-grow-1 min-width-0 max-w-18rem"},gs={class:"flex flex-column gap-1"},bs={class:"flex align-items-center gap-2"},ys={class:"text-xl font-bold line1 whitespace-nowrap overflow-hidden text-overflow-ellipsis",style:{"max-width":"20rem"}},_s={class:"flex align-items-end gap-1"},ws={key:0,class:"text-xl font-bold text-primary"},xs={key:1,class:"text-xl font-bold text-primary"},ks={key:2,class:"text-sm text-color-secondary"},$s={key:0,class:"text-xs text-primary"},Ds={class:"flex-shrink-0 flex flex-wrap justify-content-between align-items-center gap-1"},Is={class:"flex flex-wrap justify-content-between align-content-center"},Cs={class:"flex align-items-center gap-1"},Ts={class:"w-2rem text-center"},Ns={key:1,class:"flex flex-column gap-2 mt-2"},Ss={for:"in_label"},As={for:"in_label"},Ls={class:"bottom-0 left-0 mt-2"},qs={class:"text-2xl font-bold"},Ms={class:"text-2xl font-bold text-primary pl-2"},Os={class:"flex justify-content-between"},js={__name:"Cart",props:{checkout:{type:Function,required:!0},isTakeaway:Boolean},setup(A,{expose:Q}){const{locale:S}=ce(),O=Qe(),{t:w}=ce(),I=oe.cartDishs,a=x([]),j=x(),C=x(),F=x(!1),G=x(!1),W=x(!0),b=x(""),$=x("");function U(p,d,y){let H="";const T=S.value,g=s.customDishAPI.getCustomDishByName(p);for(const D of y){const re=g.types[d].dishes.find(E=>E.dishid===D.id)[`name_${T}`];H=H+re+"/"}return H}function K(p,d){const y=S.value;return s.customDishAPI.getCustomDishByName(p).types[d][`typeName_${y}`]}const Z=(p,d)=>{const y=a.value[p].quantity+d;y>=0&&(a.value[p].quantity=y)};function B(p){p&&j.value&&(j.value.dishNote=C.value?C.value:void 0),G.value=!1}function de(){C.value&&(C.value=void 0),j.value&&(j.value=void 0)}function ue(p){j.value=p,C.value=j.value.dishNote?j.value.dishNote:void 0,G.value=!0}const me=A;Q({showDishList:p=>{F.value=!0,a.value.length=0;for(let d=0;d<p.length;d++)a.value.push(p[d]);W.value=a.value.length==0&&I.length==0}});function ee(p){oe.removeItem(p)}function u(){me.isTakeaway?L():f()}function L(){const p=[];I.value.forEach(d=>{p.push(d)}),a.value.forEach(d=>{d.quantity>0&&p.push(d)}),p.length<=0?Y.show_warn(w("notification.select_at_least_one")):(F.value=!1,O.push({path:"/paymentPage"}))}function f(){me.checkout({name:b.value,note:$.value},p=>{p.success&&(I.value.forEach(d=>{d.dishNote=void 0}),a.value.forEach(d=>{d.dishNote=void 0}),$.value="",X.cleanDishDataQty(),Se.deleteCookie("cartDish_normal"),oe.cleanAll(),Se.deleteCookie("cartDish_custom"),F.value=!1)})}function c(p){return p.subname!=""&&p.subname!="Default Title"?p.name+" "+p.subname:p.name}function _(){let p=0;return I.value.forEach(d=>{p+=d.discount?(d.dis_price?d.dis_price:0)*d.count:(d.price?d.price:0)*d.count}),a.value.forEach(d=>{p+=d.discount?(d.dis_price?d.dis_price:0)*d.quantity:(d.price?d.price:0)*d.quantity}),"â‚¬"+p.toFixed(2)}const v=p=>{p.target.src="/images/default.png"},q=p=>{const d=p.quantity;let y=3;return p.price>0&&(y=9),d>=y};return(p,d)=>(n(),r(z,null,[m(t(ge),{class:"bg-primary-reverse text-sm md:text-lg lg:text-xl",visible:F.value,"onUpdate:visible":d[2]||(d[2]=y=>F.value=y),modal:"",header:p.$t("common.cart"),style:Ne([{backgroundColor:"rgba(250, 250, 250, 1)",height:"100%",minWidth:"24rem"},{width:"80vw","max-width":"700px"}]),dismissableMask:!0},{footer:M(()=>[e("div",Ls,[e("span",qs,o(p.$t("common.total"))+": ",1),e("span",Ms,o(_()),1),m(t(R),{icon:A.isTakeaway?"pi pi-wallet":"pi pi-plus",class:"p-button-success p-button-rounded ml-3",onClick:u,label:A.isTakeaway?t(w)("common.pay"):t(w)("common.send")},null,8,["icon","label"])])]),default:M(()=>[W.value?(n(),r("h2",us,"Cart is empty.")):N("",!0),e("div",rs,[(n(!0),r(z,null,te(t(I),(y,H)=>(n(),J(t(rt),{style:{overflow:"hidden"},key:H},{title:M(()=>[ye(o(p.$t(`common.${y.name}`)),1)]),subtitle:M(()=>[ye(o(p.$t("common.price"))+" : "+o(y.price)+"â‚¬",1)]),content:M(()=>[t(s).customDishAPI.customDishes.value.find(T=>T.name==y.name)?(n(),r("div",cs,[(n(!0),r(z,null,te(y.notesAndId,(T,g)=>(n(),r("div",null,[y.notesAndId[g].length!==0?(n(),r("span",ds,o(K(y.name,g))+": "+o(U(y.name,g,T)),1)):N("",!0)]))),256)),e("div",null,[y.dishNote?(n(),r("span",ms,o(p.$t("common.note"))+": "+o(y.dishNote),1)):N("",!0)])])):N("",!0)]),footer:M(()=>[e("div",fs,[A.isTakeaway?N("",!0):(n(),J(t(R),{key:0,label:t(w)("common.edit")+" "+t(w)("common.note"),severity:"contrast",onClick:T=>ue(y)},null,8,["label","onClick"])),m(t(R),{label:t(w)("common.remove"),severity:"danger",onClick:T=>ee(y)},null,8,["label","onClick"])])]),_:2},1024))),128)),(n(!0),r(z,null,te(a.value,(y,H)=>(n(),r("div",{key:H,class:"p-2 border-round shadow-1 transition-all transition-duration-200 hover:shadow-3 flex flex-column gap-1"},[e("div",vs,[e("img",{src:y.image,alt:y.name,class:"w-4rem h-4rem border-round flex-shrink-0",onError:v,style:{"object-fit":"cover","min-width":"4rem"}},null,40,hs),e("div",ps,[e("div",gs,[e("div",bs,[e("span",ys,o(c(y)),1)])]),e("div",_s,[y.discount?(n(),r("span",ws,"â‚¬"+o(Number(y.dis_price?y.dis_price:0).toFixed(2)),1)):N("",!0),y.discount?N("",!0):(n(),r("span",xs,"â‚¬"+o(Number(y.price?y.price:0).toFixed(2)),1)),y.price>0?(n(),r("span",ks,"/uni.")):N("",!0)])])]),e("div",null,[y.dishNote?(n(),r("span",$s,o(t(w)("common.note")+": "+y.dishNote),1)):N("",!0)]),e("div",Ds,[e("div",Is,[A.isTakeaway?N("",!0):(n(),J(t(R),{key:0,label:t(w)("common.edit")+" "+t(w)("common.note"),severity:"contrast",class:"w-3.5rem h-2rem",onClick:T=>ue(y)},null,8,["label","onClick"]))]),e("div",Cs,[m(t(R),{icon:"pi pi-minus",rounded:"",disabled:y.quantity<=0,onClick:T=>Z(H,-1),class:"w-2rem h-2rem"},null,8,["disabled","onClick"]),e("span",Ts,o(y.quantity),1),m(t(R),{icon:"pi pi-plus",rounded:"",disabled:q(y),onClick:T=>Z(H,1),class:"w-2rem h-2rem"},null,8,["disabled","onClick"])])])]))),128))]),A.isTakeaway?N("",!0):(n(),r("div",Ns,[m(t(Fe),{variant:"in"},{default:M(()=>[m(t(Ae),{id:"in_label",modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=y=>b.value=y),variant:"filled",maxlength:"20"},null,8,["modelValue"]),e("label",Ss,o(t(w)("common.name")),1)]),_:1}),m(t(Fe),{variant:"in"},{default:M(()=>[m(t(Be),{id:"in_label",class:"min-w-full",rows:"5",modelValue:$.value,"onUpdate:modelValue":d[1]||(d[1]=y=>$.value=y),variant:"filled",maxlength:"200"},null,8,["modelValue"]),e("label",As,o(t(w)("common.observation")),1)]),_:1})]))]),_:1},8,["visible","header"]),m(t(ge),{visible:G.value,"onUpdate:visible":d[6]||(d[6]=y=>G.value=y),header:t(w)("common.note"),onHide:d[7]||(d[7]=y=>de()),modal:"",dismissableMask:!0},{default:M(()=>[m(t(Be),{modelValue:C.value,"onUpdate:modelValue":d[3]||(d[3]=y=>C.value=y),rows:"5",cols:"30",placeholder:t(w)("common.edit")+" "+t(w)("common.note")+"...",maxlength:"100"},null,8,["modelValue","placeholder"]),e("div",Os,[m(t(R),{label:t(w)("common.cancel"),severity:"danger",onClick:d[4]||(d[4]=y=>B(!1))},null,8,["label"]),m(t(R),{label:t(w)("common.save"),severity:"primary",size:"sm",onClick:d[5]||(d[5]=y=>B(!0))},null,8,["label"])])]),_:1},8,["visible","header"])],64))}},Ps=xe(js,[["__scopeId","data-v-c63f1df5"]]);x([]);x("iniImages()");const Rs={class:"m-3"},Gs={class:"flex flex-column gap-2"},Vs={class:"w-full flex justify-content-center"},Es={key:0,class:"max-w-19rem"},Us=["src"],Ws={style:{width:"300px",height:"300px",background:"url(/boxImage/box.png)"}},zs={key:0,class:"flex align-items-center justify-content-center text-4xl font-bold text-white w-full h-full"},Fs={key:1,class:"grid m-0 p-2"},Bs=["onClick"],Hs={class:"flex align-items-center justify-content-center font-bold m-0 p-0",style:{width:"94px",height:"94px"}},Qs=["src"],Js={class:"flex flex-wrap justify-content-between align-items-center m-1"},Ks={class:"flex gap-1 align-items-center"},Xs={key:0},Ys={class:"font-bold mb-2"},Zs={key:1,class:"flex justify-content-between gap-2 mt-3"},el={class:"font-bold mb-2"},tl={class:"flex mr-2"},sl={class:"w-3rem text-xl text-center"},ll={class:"font-bold block mb-2"},al={class:"flex flex-wrap"},nl={key:2,class:"flex flex-wrap gap-2 mt-3"},ol={class:"font-bold block mb-2"},il={class:"font-bold block mb-2 text-center"},ul={class:"flex flex-wrap gap-2 mt-3"},rl={__name:"CustomDish",props:{currentCustomDish:Object,tabindex:Number},emits:["typeClick"],setup(A,{emit:Q}){const{locale:S}=ce(),O=A,w=ct(),{t:I}=ce(),a=x(null);ie(()=>O.currentCustomDish,c=>{c&&(a.value=c)},{immediate:!0,deep:!0});const j=le(()=>a.boxImages),C=x(0),F=le(()=>{var v,q,p,d,y;if(a.value==null)return 0;const c=s.isTakeaway();let _=c?((v=a.value)==null?void 0:v.initialDeliveryPrice)??((q=a.value)==null?void 0:q.initialPrice):(p=a.value)==null?void 0:p.initialPrice;!c&&((d=a.value)!=null&&d.discount)&&(_=_*(1-a.value.discount/100));for(const H of a.value.types??[])for(const T of H.dishes??[])if(T.selected){let g=c?T.deliveryPrice??T.price:T.price;!c&&((y=a.value)!=null&&y.discount)&&(g=g*(1-a.value.discount/100)),_+=g}return Number(_).toFixed(2)}),G=Q,W=x(null),b=le(()=>{const c=S.value,_=`title_${c}`,v=`description_${c}`;return a.value==null?{}:a.value.descriptions.map(q=>({title:q[_],descriptions:q.descriptions.map(p=>p[v]),image:q==null?void 0:q.image}))}),$=le(()=>{var v,q;const c=Number(((v=a.value)==null?void 0:v.like)??0),_=Number(((q=a.value)==null?void 0:q.rate)??0);return _?c/_*5:0});function U(c,_){const v=S.value;return c[`${_}_${v}`]}function K(c,_,v){const q=c[_];if(q.selected){q.selected=!1;return}else{const d=c.filter(y=>y.selected).length;if(v===1){u(c),q.selected=!0;return}d<v&&(q.selected=!0)}}function Z(c,_,v){const q=c.dishes;G("typeClick",c,_,q[_].selected),K(q,_,v)}function B(c){return c.selected}function de(){if(!L(a.value.types))return;const c=me(a.value.types),_=ae(a.value.types);oe.addItem({dishid:-1,name:a.value.name,category:O.currentCustomDish.category,count:C.value!==0?C.value:1,price:F.value,notes:c,notesAndId:_}),console.log("CART: ",oe.cartDishs),ee(a.value.types),Y.show({severity:"info",summary:"info",detail:I("customDishBibimbapVue.addToCartSuccessBibimbap")})}function ue(c){return!c||!c.dishes?"":c.dishes.filter(v=>v.selected).map(v=>v.name).join(",")}function me(c){return c?c.map(_=>ue(_)):[]}function ae(c){return c?c.map(_=>_.dishes?_.dishes.filter(v=>v.selected).map(v=>({id:v.dishid,name:v.name})):[]):[]}function ee(c){c&&c.forEach(_=>{_.dishes&&_.dishes.forEach(v=>{v.selected=!1})})}function u(c){c.forEach(_=>_.selected=!1)}function L(c){if(a.value.options.quantity&&C.value<=0)return Y.show({severity:"warn",detail:I("notification.quantity_must_be_positive")}),!1;for(const _ of c)if(_.dishes.filter(q=>q.selected).length<_.minQuantity){const q=_.typeName;return Y.show({severity:"warn",detail:I("notification.select_type_of",{name:q})}),!1}return!0}function f(c){c?s.customDishAPI.like(a.value.id)&&(W.value="like",w.add({severity:"success",summary:I("common.success"),detail:I("common.rate")+" "+I("common.success"),life:750})):s.customDishAPI.unLike(a.value.id)&&(W.value="unlike",w.add({severity:"success",summary:I("common.success"),detail:I("common.rate")+" "+I("common.success"),life:750}))}return(c,_)=>{var v,q,p,d,y,H;return n(),r("div",Rs,[e("div",Gs,[m(t(Ee),{class:"w-full max-w-xl mx-auto"},{default:M(()=>[(n(!0),r(z,null,te(b.value,(T,g)=>(n(),J(t(Re),{key:g,value:g},{default:M(()=>[m(t(Ge),null,{default:M(()=>[ye(o(T.title),1)]),_:2},1024),m(t(Ve),null,{default:M(()=>{var D;return[(n(!0),r(z,null,te(T.descriptions,(re,E)=>(n(),r("p",{key:E},o(re),1))),128)),e("div",Vs,[(D=T.image)!=null&&D.src?(n(),r("div",Es,[e("img",{src:T.image.src,class:"w-full"},null,8,Us)])):N("",!0)])]}),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),((q=(v=a.value)==null?void 0:v.value)==null?void 0:q.name)==="MY BOX"?(n(),J(t(Ee),{key:0,class:"w-full max-w-xl mx-auto"},{default:M(()=>[m(t(Re),{value:"0"},{default:M(()=>[m(t(Ge),null,{default:M(()=>[ye(" ðŸ¥© "+o(c.$t("common.showMybox")),1)]),_:1}),m(t(Ve),null,{default:M(()=>[e("div",Ws,[c.isEmptyArray(j.value)?(n(),r("div",zs,o(c.$t("common.myboxAlarm")),1)):N("",!0),c.isEmptyArray(j.value)?N("",!0):(n(),r("div",Fs,[(n(!0),r(z,null,te(j.value,T=>(n(),r("div",{class:"col-4 p-0",onClick:g=>c.imageSelectAction(T)},[e("div",Hs,[T?(n(),r("img",{key:0,class:"m-0 p-0",src:c.imagePath(T),style:{width:"82px",height:"82px"}},null,8,Qs)):N("",!0)])],8,Bs))),256))]))])]),_:1})]),_:1})]),_:1})):N("",!0)]),e("div",Js,[e("div",Ks,[(n(),r(z,null,te(5,T=>e("i",{key:T,class:fe(["pi invert-star",T<=Math.floor($.value)?"pi-star-fill":T-.5<=$.value?"pi-star-half":"pi-star"]),style:{color:"black"}},null,2)),64)),e("p",null,"("+o((p=a.value)!=null&&p.rate?a.value.rate:0)+")",1)]),e("div",null,[m(t(R),{text:"",icon:"pi pi-thumbs-up",severity:W.value==="like"?"success":"",onClick:_[0]||(_[0]=T=>f(!0))},null,8,["severity"]),m(t(R),{text:"",icon:"pi pi-thumbs-down",severity:W.value==="unlike"?"danger":"",onClick:_[1]||(_[1]=T=>f(!1))},null,8,["severity"])])]),(d=a.value)!=null&&d.options.extraInfo?(n(),r("div",Xs,[e("label",Ys,o(a.value.options.extraInfo),1)])):N("",!0),(y=a.value)!=null&&y.options.quantity?(n(),r("div",Zs,[e("div",null,[e("label",el,o(c.$t("common.quantity"))+" / "+o(c.$t("common.pieces")),1)]),e("div",tl,[m(t(R),{icon:"pi pi-minus",disabled:C.value<=0,onClick:_[2]||(_[2]=T=>{var g;return C.value-=(g=a.value)==null?void 0:g.options.quantitySetp}),class:"w-2rem h-2rem"},null,8,["disabled"]),e("span",sl,o(C.value),1),m(t(R),{icon:"pi pi-plus",disabled:C.value>=a.value.options.maxQuantity,onClick:_[3]||(_[3]=T=>{var g;return C.value+=(g=a.value)==null?void 0:g.options.quantitySetp}),class:"w-2rem h-2rem"},null,8,["disabled"])])])):N("",!0),(n(!0),r(z,null,te((H=a.value)==null?void 0:H.types,(T,g)=>(n(),r("div",{key:T.id},[nt(e("div",null,[e("label",ll,o(g+1)+". "+o(U(T,"typeName")),1),e("div",al,[(n(!0),r(z,null,te(T.dishes,(D,re)=>(n(),J(t(R),{key:re,onClick:E=>Z(T,re,C.value==0?T.maxQuantity:T.maxQuantity*C.value),class:fe([{"p-button-primary":B(D),"p-button-outlined":!B(D)},"m-1"])},{default:M(()=>[e("p",{class:fe({"text-gray-700":!B(D)})},o(U(D,"name")),3)]),_:2},1032,["onClick","class"]))),128))])],512),[[ot,T.enable]])]))),128)),A.currentCustomDish.initialPrice!==0||A.currentCustomDish.initialDeliveryPrice!==0?(n(),r("div",nl,[e("label",ol,o(c.$t("common.price"))+":",1),e("label",il,o(F.value+"â‚¬"),1)])):N("",!0),e("div",ul,[m(t(R),{icon:"pi pi-shopping-cart",onClick:_[4]||(_[4]=T=>de()),label:c.$t("common.addToCart"),class:"m-3",severity:"primary",raised:""},null,8,["label"])])])}}},cl=xe(rl,[["__scopeId","data-v-6aa72daf"]]),dl={key:0,class:"flex flex-column gap-4"},ml={class:"flex justify-content-center"},fl={class:"flex flex-column gap-3"},vl={class:"flex flex-column gap-1"},hl={class:"text-sm text-color-secondary"},pl={class:"text-lg font-semibold"},gl={class:"flex flex-column gap-1"},bl={class:"text-sm text-color-secondary"},yl={class:"text-lg"},_l={class:"flex flex-column gap-1"},wl={class:"text-sm text-color-secondary"},xl={class:"text-lg"},kl={key:0,class:"flex flex-column gap-1"},$l={class:"text-sm text-color-secondary"},Dl={class:"text-sm text-color-secondary"},Il={key:1,class:"flex flex-column gap-4"},Cl={class:"flex justify-content-center"},Tl={class:"flex flex-column gap-3"},Nl={class:"flex flex-column gap-2"},Sl={class:"text-sm text-color-secondary font-medium"},Al={class:"flex gap-2"},Ll={class:"mt-4 border-top-1 surface-border pt-4"},ql={class:"text-sm text-color-secondary mb-3"},Ml={__name:"UserInfoDialog",props:{visible:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["update:visible","open-login"],setup(A,{emit:Q}){const{t:S}=ce(),O=A,w=Q,I=x(!1),a=x(s.userName.value||"");ie(()=>O.visible,b=>{b&&(a.value=s.userName.value||"")});const j=le(()=>{var $;if(!(($=O.user)!=null&&$.avatar_url))return null;const b=O.user.avatar_url;return b&&(b.startsWith("http://")||b.startsWith("https://")||b.startsWith("/"))?b:null});ie(()=>O.user,b=>{if(I.value=!1,b!=null&&b.avatar_url&&j.value){const $=new Image;$.onload=()=>{I.value=!1},$.onerror=()=>{I.value=!0,console.warn("Avatar image failed to load:",b.avatar_url)},$.src=j.value}},{immediate:!0});function C(){var b,$;return(b=O.user)!=null&&b.display_name?O.user.display_name.charAt(0).toUpperCase():($=O.user)!=null&&$.email?O.user.email.charAt(0).toUpperCase():"U"}function F(){const b=s.userName.value;return b?b.charAt(0).toUpperCase():"G"}function G(){a.value&&a.value!==s.userName.value&&s.updateGuestName(a.value)}function W(){w("update:visible",!1),w("open-login")}return(b,$)=>(n(),J(t(ge),{visible:A.visible,"onUpdate:visible":$[1]||($[1]=U=>b.$emit("update:visible",U)),header:b.$t("common.auth.userInfo"),modal:!0,dismissableMask:!0,style:{width:"90vw",maxWidth:"30rem"}},{default:M(()=>[A.user?(n(),r("div",dl,[e("div",ml,[m(t(_e),{image:j.value&&!I.value?j.value:void 0,label:!j.value||I.value?C():void 0,shape:"circle",size:"xlarge",class:"mb-3"},null,8,["image","label"])]),e("div",fl,[e("div",vl,[e("label",hl,o(b.$t("common.auth.displayName")),1),e("div",pl,o(A.user.display_name||"-"),1)]),e("div",gl,[e("label",bl,o(b.$t("common.auth.email")),1),e("div",yl,o(A.user.email||"-"),1)]),e("div",_l,[e("label",wl,o(b.$t("common.auth.role")),1),e("div",xl,o(A.user.role||"-"),1)]),A.user.id?(n(),r("div",kl,[e("label",$l,o(b.$t("common.auth.userId")),1),e("div",Dl,o(A.user.id),1)])):N("",!0)])])):t(s).userName.value?(n(),r("div",Il,[e("div",Cl,[m(t(_e),{label:F(),shape:"circle",size:"xlarge",class:"mb-3",style:{"background-color":"var(--primary-color)",color:"var(--primary-color-text)"}},null,8,["label"])]),e("div",Tl,[e("div",Nl,[e("label",Sl,o(b.$t("common.auth.guestName")),1),e("div",Al,[m(t(Ae),{modelValue:a.value,"onUpdate:modelValue":$[0]||($[0]=U=>a.value=U),class:"flex-grow-1",placeholder:b.$t("common.auth.enterName")},null,8,["modelValue","placeholder"]),m(t(R),{label:b.$t("common.confirm"),icon:"pi pi-check",onClick:G,disabled:!a.value||a.value===t(s).userName.value},null,8,["label","disabled"])])]),e("div",Ll,[e("p",ql,o(b.$t("common.auth.memberLoginHint")||"Login to enjoy more member benefits"),1),m(t(R),{label:b.$t("common.auth.login"),icon:"pi pi-sign-in",class:"w-full",onClick:W},null,8,["label"])])])])):N("",!0)]),_:1},8,["visible","header"]))}},Ol={class:"flex flex-column gap-3"},jl={key:0,class:"text-center text-600 mb-3"},Pl={key:1,class:"flex flex-column gap-3"},Rl={class:"flex flex-column gap-2"},Gl={for:"guestName"},Vl={key:0,class:"flex justify-content-between w-full"},Xe={__name:"GuestLoginDialog",props:{visible:{type:Boolean,default:!1},waiting:{type:Boolean,default:!1},showLoginShortcut:{type:Boolean,default:!0}},emits:["join"],setup(A,{emit:Q}){const{t:S}=ce(),O=A,w=Q,I=x(s.userName.value||""),a=x(!1),j=x(!1);ie(()=>s.userName.value,b=>{b&&!I.value&&(I.value=b)}),ie(()=>O.waiting,b=>{a.value=b});function C(){I.value&&(a.value=!0,w("join",I.value))}function F(){I.value="Guest "+Math.floor(Math.random()*1e3),C()}function G(){j.value=!0}function W(){j.value=!1,s.showGuestLogin.value=!1}return(b,$)=>(n(),r(z,null,[m(t(ge),{visible:A.visible,header:b.$t("common.auth.guestLogin"),modal:!0,dismissableMask:!1,closable:!1,style:{width:"90vw",maxWidth:"25rem"}},{footer:M(()=>[a.value?N("",!0):(n(),r("div",Vl,[A.showLoginShortcut?(n(),J(t(R),{key:0,icon:"pi pi-user",label:b.$t("common.auth.login"),class:"p-button-text",onClick:G},null,8,["label"])):N("",!0),e("div",{class:fe(["flex gap-2",{"ml-auto":!A.showLoginShortcut}])},[m(t(R),{label:b.$t("common.skip"),severity:"secondary",onClick:F},null,8,["label"]),m(t(R),{label:b.$t("common.confirm"),onClick:C,disabled:!I.value},null,8,["label","disabled"])],2)]))]),default:M(()=>[e("div",Ol,[a.value?(n(),r("div",jl,[$[2]||($[2]=e("i",{class:"pi pi-spin pi-spinner text-4xl mb-3"},null,-1)),e("p",null,o(b.$t("common.auth.waitingAuthorization")),1)])):(n(),r("div",Pl,[e("div",Rl,[e("label",Gl,o(b.$t("common.auth.guestName")),1),m(t(Ae),{id:"guestName",modelValue:I.value,"onUpdate:modelValue":$[0]||($[0]=U=>I.value=U),placeholder:b.$t("common.auth.enterName"),class:"w-full",onKeyup:it(C,["enter"])},null,8,["modelValue","placeholder"])])]))])]),_:1},8,["visible","header"]),m(Ke,{visible:j.value,"onUpdate:visible":$[1]||($[1]=U=>j.value=U),showGuestShortcut:!1,onLoginSuccess:W},null,8,["visible"])],64))}},El={class:"fixed top-0 left-0 w-full bg-primary-reverse",style:{"z-index":"10"}},Ul={class:"grid mt-1 ml-1"},Wl={class:"h-3rem w-3rem flex align-items-center"},zl=["src"],Fl={class:"flex align-items-center"},Bl={key:0,class:"text-color font-bold p-1"},Hl={key:1,class:"text-color font-bold p-1"},Ql={class:"card flex mr-3 flex align-items-center gap-2",style:{"margin-left":"auto"}},Jl={key:0},Kl={key:1},Xl={style:{display:"flex","align-items":"center"}},Yl={style:{"flex-grow":"1",width:"0",overflow:"hidden"}},Zl={class:"mt-2"},ea={class:"flex justify-content-end mt-2"},ta={class:"flex inline-flex items-center justify-center gap-2"},sa={class:"flex align-items-center"},la={class:"flex flex-column"},aa={class:"text-sm p-2"},na={class:"text-sm p-2"},oa={class:"flex items-center gap-4 mb-4 p-2"},ia={class:"flex flex-column gap-3"},ua={__name:"HeaderTabs",props:{types:Array,typeIndex:Number,tableId:String,tabItems:Array},emits:["clickType","switchToWelcome"],setup(A,{emit:Q}){const{t:S}=ce(),O=x(!1),w=x(!1),I=x(!1),a=x(!1),j=x(""),C=x(),F=x(!1);function G(){a.value=!0,w.value=!0}function W(){w.value=!1,s.showGuestLoginShortcut.value=!1,s.showGuestLogin.value=!0}function b(g){s.joinTable(s.params.table,g),s.showGuestLogin.value=!1}const $=le(()=>s.isAuthenticated()),U=le(()=>s.authUser.value),K=le(()=>{var D;if(!((D=U.value)!=null&&D.avatar_url))return null;const g=U.value.avatar_url;return g&&(g.startsWith("http://")||g.startsWith("https://")||g.startsWith("/"))?g:null});ie(U,g=>{if(F.value=!1,g!=null&&g.avatar_url&&K.value){const D=new Image;D.onload=()=>{F.value=!1},D.onerror=()=>{F.value=!0,console.warn("Avatar image failed to load:",g.avatar_url)},D.src=K.value}},{immediate:!0});function Z(){return s.getTable()}we(async()=>{j.value=await gt()});const B=x(),de=le(()=>[{label:S("common.options"),items:[{label:S("common.pay"),icon:"pi pi-wallet",command:()=>{f()}},{label:S("common.call"),icon:"pi pi-user-plus",command:()=>{s.send_cmd(Z(),{cmd:"call"},g=>{g.success?Y.show_info(S("notification.call_msg")):Y.show_warn(g.data)})}}]}]),ue=g=>{B.value.toggle(g)},me=g=>{ae.value.toggle(g)},ae=x(),ee=x(!1),u=x(),L=x();function f(){ee.value=!0}function c(){g(u.value)?s.send_cmd(Z(),{cmd:"pay",nif:u.value,note:L.value},D=>{D.success?(Y.show_info(S("notification.pay_msg")),ee.value=!1):Y.show_error(S("common.failed"))}):Y.show_warn(S("notification.cancel_msg"));function g(D){return!D||D.toString().length===9||D.toString().length===0}}function _(){L.value&&(L.value=void 0)}function v(){O.value=!0}function q(){s.showGuestLoginShortcut.value=!0,w.value=!0}const p=le(()=>[{label:S("common.auth.userInfo"),icon:"pi pi-user",command:()=>{I.value=!0}},{separator:!0},{label:S("common.auth.logout"),icon:"pi pi-sign-out",command:()=>{s.logout(),Y.show_info(S("common.auth.logoutSuccess"))}}]);function d(g){C.value.toggle(g)}function y(){const g=U.value;return g!=null&&g.display_name?g.display_name.charAt(0).toUpperCase():g!=null&&g.email?g.email.charAt(0).toUpperCase():"U"}function H(){const g=s.userName.value;return g?g.charAt(0).toUpperCase():"G"}function T(){var g;w.value=!1,Y.show_info(S("common.auth.loginSuccess")),console.log("Login success, user:",s.authUser.value),console.log("Avatar URL:",(g=s.authUser.value)==null?void 0:g.avatar_url)}return(g,D)=>{var re;return n(),r(z,null,[e("div",El,[e("div",Ul,[e("div",Wl,[e("img",{src:j.value,class:"h-full w-full",onClick:D[0]||(D[0]=()=>g.$emit("switchToWelcome"))},null,8,zl)]),e("div",Fl,[A.tableId?(n(),r("p",Bl,o(g.$t("common.table"))+": "+o(A.tableId),1)):N("",!0),A.tableId?N("",!0):(n(),r("p",Hl,o(g.$t("common.takeAway")),1))]),e("div",Ql,[!$.value&&!t(s).userName.value?(n(),r("div",Jl,[m(t(R),{label:t(S)("common.auth.login"),icon:"pi pi-sign-in",onClick:q},null,8,["label"])])):(n(),r("div",Kl,[$.value?(n(),J(t(_e),{key:0,image:K.value,label:K.value?void 0:y(),shape:"circle",size:"large",onClick:d,style:{cursor:"pointer"}},null,8,["image","label"])):(n(),J(t(_e),{key:1,label:H(),shape:"circle",size:"large",onClick:d,style:{cursor:"pointer","background-color":"var(--primary-color)",color:"var(--primary-color-text)"}},null,8,["label"])),m(t(je),{ref_key:"userMenu",ref:C,id:"user_menu",model:p.value,popup:!0},null,8,["model"])])),A.tableId?(n(),J(t(R),{key:2,icon:"pi pi-bell",rounded:"","aria-label":"Filter",onClick:ue,"aria-haspopup":"true","aria-controls":"overlay_menu"})):(n(),J(t(R),{key:3,icon:"pi pi-question",rounded:"",onClick:v})),m(t(je),{ref_key:"menu",ref:B,id:"overlay_menu",model:de.value,popup:!0},null,8,["model"])])]),e("div",Xl,[e("div",null,[m(t(R),{icon:"pi pi-bars",variant:"text",rounded:"","aria-label":"Filter",onClick:me,"aria-haspopup":"true","aria-controls":"tab_menu"}),m(t(je),{ref_key:"tabMenu",ref:ae,id:"tab_menu",model:A.tabItems,popup:!0},null,8,["model"])]),e("div",Yl,[m(t(ft),{value:A.typeIndex,scrollable:"",showNavigators:!1},{default:M(()=>[m(t(dt),null,{default:M(()=>[(n(!0),r(z,null,te(A.types,(E,ke)=>(n(),J(t(mt),{value:ke,onClick:()=>g.$emit("clickType",ke),class:"text-sm md:text-lg lg:text-xl"},{default:M(()=>[ye(o(E),1)]),_:2},1032,["value","onClick"]))),256))]),_:1})]),_:1},8,["value"])])])]),m(t(ge),{visible:ee.value,"onUpdate:visible":D[4]||(D[4]=E=>ee.value=E),header:"ç»“è´¦",class:"flex flex-column",modal:!0,dismissableMask:!0,onHide:_},{default:M(()=>[e("div",null,[D[10]||(D[10]=e("label",null,"NIF:",-1)),m(t(vt),{modelValue:u.value,"onUpdate:modelValue":D[1]||(D[1]=E=>u.value=E),inputId:"withoutgrouping",useGrouping:!1,fluid:"",class:"w-full m-1"},null,8,["modelValue"])]),e("div",Zl,[e("label",null,o(g.$t("common.note"))+":",1),m(t(Ae),{type:"text",modelValue:L.value,"onUpdate:modelValue":D[2]||(D[2]=E=>L.value=E),class:"w-full m-1"},null,8,["modelValue"])]),e("div",ea,[m(t(R),{label:t(S)("common.send"),onClick:D[3]||(D[3]=E=>c())},null,8,["label"])])]),_:1},8,["visible"]),m(t(ge),{visible:O.value,"onUpdate:visible":D[5]||(D[5]=E=>O.value=E),modal:"",dismissableMask:"",class:"h-full",style:{width:"90vw",maxWidth:"40rem",minWidth:"20rem"},draggable:!1},{header:M(()=>[e("div",ta,[m(t(_e),{icon:"pi pi-question",shape:"circle"}),e("span",sa,o(t(S)("takeawayHelper.dialogTitle")),1)])]),default:M(()=>[e("div",la,[e("span",aa,o(t(S)("takeawayHelper.introduction")),1),e("span",na,o(t(S)("takeawayHelper.note_t"))+" "+o(t(S)("takeawayHelper.note_1")),1),e("div",oa,[m(t(Ee),{class:"w-full max-w-xl mx-auto"},{default:M(()=>[m(t(Re),{value:"0"},{default:M(()=>[m(t(Ge),{class:"text-sm"},{default:M(()=>[ye(o(t(S)("takeawayHelper.question_1")),1)]),_:1}),m(t(Ve),{class:"p-1"},{default:M(()=>[e("div",ia,[e("span",null,o(t(S)("takeawayHelper.q_1_request_1")),1),e("span",null,o(t(S)("takeawayHelper.q_1_request_2")),1),e("span",null,o(t(S)("takeawayHelper.q_1_request_3")),1),e("span",null,o(t(S)("takeawayHelper.q_1_request_4")),1),e("span",null,o(t(S)("takeawayHelper.q_1_request_5")),1)])]),_:1})]),_:1})]),_:1})])])]),_:1},8,["visible"]),m(Ke,{visible:w.value,"onUpdate:visible":D[6]||(D[6]=E=>w.value=E),showGuestShortcut:!a.value&&((re=t(s).settings.value)==null?void 0:re.qrcodeInfo),onLoginSuccess:T,onSwitchToGuest:W,onHide:D[7]||(D[7]=E=>a.value=!1)},null,8,["visible","showGuestShortcut"]),m(Xe,{visible:t(s).showGuestLogin.value,"onUpdate:visible":D[8]||(D[8]=E=>t(s).showGuestLogin.value=E),waiting:t(s).waitingAuthorization.value,showLoginShortcut:t(s).showGuestLoginShortcut.value,onJoin:b},null,8,["visible","waiting","showLoginShortcut"]),m(Ml,{visible:I.value,"onUpdate:visible":D[9]||(D[9]=E=>I.value=E),user:U.value,onOpenLogin:G},null,8,["visible","user"])],64)}}},ra={__name:"SwipeHint",props:{size:{type:String,default:"8rem"},duration:{type:Number,default:6e3},position:{type:String,default:"bottom"}},setup(A){const Q=A,S=x(!0);we(()=>{Q.duration>0&&setTimeout(()=>{S.value=!1},Q.duration);const w=()=>{S.value=!1,window.removeEventListener("touchstart",w)};window.addEventListener("touchstart",w)});const O=le(()=>{let w={left:"50%",transform:"translateX(-50%)",zIndex:99999,opacity:.5,pointerEvents:"none",textAlign:"center",position:"fixed"};return Q.position==="top"?w.top="15%":Q.position==="center"?(w.top="50%",w.transform="translate(-50%, -50%)"):w.bottom="15%",w});return(w,I)=>S.value?(n(),r("div",{key:0,class:"swipe-hint",style:Ne(O.value)},[e("div",{class:"hand",style:Ne({width:A.size,height:A.size,backgroundImages:"url(/images/hand_finger.png)"})},null,4)],4)):N("",!0)}},ca=xe(ra,[["__scopeId","data-v-30a48de8"]]),da={class:"flex flex-column align-items-center text-center py-4"},ma={class:"text-xl font-bold mb-2"},fa={class:"text-600 mb-4"},va={key:0,class:"mt-2 p-3 bg-blue-50 border-round border-1 border-blue-100"},ha={class:"text-sm text-blue-700 mb-3"},pa={class:"flex justify-content-center w-full"},ga={__name:"OrderWaitAuthDialog",props:{visible:{type:Boolean,default:!1}},emits:["close"],setup(A,{emit:Q}){const{t:S}=ce(),O=A,w=Q,I=x(!1),a=x(!1);let j=null;ie(()=>O.visible,G=>{G?(I.value=!1,clearTimeout(j),j=setTimeout(()=>{I.value=!0},1e4)):clearTimeout(j)}),Je(()=>{clearTimeout(j)});function C(){w("close")}function F(){a.value=!0,s.send_cmd(s.getTable(),{cmd:"call"},G=>{a.value=!1,G.success?Y.show_success(S("common.call_msg")):Y.show_error(S("common.failed"))})}return(G,W)=>(n(),J(t(ge),{visible:A.visible,header:G.$t("common.auth.waitAuthorizationTitle"),modal:!0,dismissableMask:!1,closable:!1,style:{width:"90vw",maxWidth:"28rem"}},{footer:M(()=>[e("div",pa,[m(t(R),{label:G.$t("common.auth.backToMenu"),icon:"pi pi-arrow-left",class:"p-button-text p-button-secondary",onClick:C},null,8,["label"])])]),default:M(()=>[e("div",da,[W[0]||(W[0]=e("div",{class:"mb-4"},[e("i",{class:"pi pi-spin pi-spinner text-6xl text-primary"})],-1)),e("h3",ma,o(G.$t("common.auth.waitAuthorizationTitle")),1),e("p",fa,o(G.$t("common.auth.waitAuthorizationDesc")),1),I.value?(n(),r("div",va,[e("p",ha,o(G.$t("common.auth.tooLongWait")),1),m(t(R),{icon:"pi pi-bell",label:G.$t("common.auth.callStaff"),class:"p-button-raised p-button-primary w-full",onClick:F,loading:a.value},null,8,["label","loading"])])):N("",!0)])]),_:1},8,["visible","header"]))}},ba={class:"w-full h-full flex flex-column p-1"},ya={class:"swiper-container-wrapper"},_a={class:"fixed bottom-0 left-0 w-full h-3rem bg-primary-reverse p-3 z-[9999]"},wa={class:"h-full flex align-items-center justify-content-between w-full"},xa={class:"m-2"},ka={class:"m-2"},$a={class:"m-2"},Da={style:{"max-height":"60vh","overflow-y":"auto","padding-bottom":"60px"}},Ia={class:"flex flex-column border-bottom-1"},Ca={key:0,class:"flex justify-content-between"},Ta={class:"flex flex-column"},Na={class:"font-bold"},Sa={class:"text-right"},Aa={key:1,class:"flex justify-content-between"},La={class:"flex flex-column"},qa={class:"font-bold"},Ma={class:"text-right"},Oa={key:0},ja={key:1,class:"flex flex-column"},Pa={class:"flex flex-column"},Ra={class:"font-bold"},Ga={class:"text-right"},Va={class:"total-footer bg-primary-reverse"},Ea={__name:"HomePage",setup(A){const Q=Qe(),S=ut(),{t:O}=ce(),{locale:w}=ce(),I=x(0),a=x(!1),j=x([""]),C=x(0),F=oe.cartItemCount,G=x(!1),W=x([]),b=x(0),$=x({}),U=x(!1),K=X.dishDatas,Z=x(s.getOrderMenuTab()),B=x(null),de=x(null),ue=x([]),me=x([]),ae=x([]),ee=x(!1);let u=null;const L=l=>{C.value=l.activeIndex,qe()},f=le(()=>{var l;return s.isTakeaway()||s.isAuthorized.value||s.waitingAuthorization.value||s.isRejoining.value||s.showOrderWaitAuth.value||s.userName.value||s.isAuthenticated()?!1:!!((l=s.settings.value)!=null&&l.qrcodeInfo&&s.params.table)});ie(f,l=>{l&&(s.showGuestLoginShortcut.value=!0,s.showGuestLogin.value=!0)},{immediate:!0});function c(l){s.joinTable(s.params.table,l),s.showGuestLogin.value=!1}ie(()=>s.isAuthenticated(),l=>{l&&s.params.table&&!s.isAuthorized.value&&!s.waitingAuthorization.value&&s.joinTable(s.params.table)});const _=l=>{u=l};ie(C,l=>{u&&u.activeIndex!==l&&u.slideTo(l);let i=s.getOrderMenuTab()[l];const k=s.isTakeaway()?s.customDishAPI.customDishesTake.value:s.customDishAPI.customDishes.value;k.map(V=>V.name).includes(i)?(U.value=!0,$.value=JSON.parse(JSON.stringify(k.find(V=>V.name==i)))):U.value=!1});const v=(l,i,h,k)=>{s.rateDish(l,i,h),k&&Y.show_success(O("notification.rating_submitted"))},q=(l,i,h)=>{if($.value.name=="XIAOXIONGÂ® RAMEN"&&l.id===1){const k=l.dishes[i];let P;k.dishid==47?h?P=p(3,!0,1):P=p(3,!1,1):P=p(3,!0,1),P!==void 0&&d(P)}if($.value.name=="Menu AlmoÃ§o"&&l.id===3){const k=l.dishes[i];let P;[1427,41].includes(k.dishid)?h?P=p(4,!0,0):P=p(4,!1,0):P=p(4,!0,0),P!==void 0&&d(P)}};function p(l,i,h){if($.value={...$.value,types:$.value.types.map(k=>k.id===l?{...k,enable:i,minQuantity:i?h:0}:k)},i===!1)return l}function d(l){!$.value||!Array.isArray($.value.types)||($.value={...$.value,types:$.value.types.map(i=>i.id===l?{...i,dishes:i.dishes.map(h=>({...h,selected:!1}))}:i)})}function y(l){let i=s.getOrderMenuTab()[l];const k=s.isTakeaway()?s.customDishAPI.customDishesTake.value:s.customDishAPI.customDishes.value;if(k.map(ve=>ve.name).includes(i)?(U.value=!0,$.value=JSON.parse(JSON.stringify(k.find(ve=>ve.name==i)))):U.value=!1,s.getMenu().length==0){console.log("exit");return}let be=K.value[l].mainDishes;X.showDishList(be)}const H=()=>{s.refreshTableFromServer(),s.getTableTotalAmount(b),G.value=!0},T=l=>{let i=l.id;l.org_id&&(i=l.org_id);for(let h=0;h<K.value.length;h++)if(K.value[h].id==i)for(const k in l){let P=k;k.startsWith("note")&&(P=P.replace("note","description")),K.value[h][P]=l[k]}};function g(){return new Promise(l=>{let i=()=>{const h=s.formatedMenu.value;h.length>0?l(h):setTimeout(i,200)};i()})}function D(){return new Promise(l=>{let i=()=>{const h=s.getOrderMenuTab();h.length>0?l(h):setTimeout(i,200)};i()})}const re=le(()=>l=>{const i=s.dictinaryAPI.dictinary.value.find(h=>h.refName===l);return i?i[`text_${w.value.toLowerCase()}`]:l});ie([()=>s.formatedMenu.value,()=>w.value],([l,i])=>{if(!l||l.length===0){ae.value=[];return}const h={};s.orderMenuTab.value;const k=l.map(be=>({...be,mainDishes:be.dishes.map(ve=>{const ne=ve.dish;if(h[ne.id])return h[ne.id];const se={...ne,defaultName:ne.name,defaultSubname:ne.subname,name:E(ne,"name",i),note:E(ne,"note",i),subname:E(ne,"subname",i),quantity:0},he=ve.subItems.map(Ie=>{const Ce=Ie;return{...Ie,defaultName:ne.name,defaultSubname:Ce.subname,name:E(Ce,"name",i),note:E(Ce,"note",i),subname:E(Ce,"subname",i),quantity:0}}),pe={...ve,dish:se,subItems:he};return h[pe.id]=pe,pe})}));K.value.length;const P=X.getAllIncrementedDish();X.getIdsAndQuantity(P);const V=oe.cartDishs.value;Pe.compressToEncodedURIComponent(JSON.stringify(V)),ae.value=k,K.value=ae.value,j.value=s.orderMenuTab.value,(P.length>0||V.length>0)&&(X.cleanDishDataQty(),X.updateDishDataQty(P)),s.filterMenuTabs(ee.value),console.log("languagedMenu updated via watch:",ae.value),ze(()=>{I.value++,u&&typeof u.updateDictionaryWord=="function"&&(u.updateDictionaryWord(),u.slideTo(C.value))})},{immediate:!0,deep:!0}),ie(()=>s.orderMenuTab.value,l=>{Z.value=l.map(i=>{const h=s.dictinaryAPI.dictinary.value.find(k=>k.refName===i);return h?h[`text_${w.value.toLowerCase()}`]:i}),W.value=Le(l),C.value=0}),we(()=>{const l=s.orderMenuTab.value;Z.value=l.map(i=>{const h=s.dictinaryAPI.dictinary.value.find(k=>k.refName===i);return h?h[`text_${w.value.toLowerCase()}`]:i}),W.value=Le(l),C.value=0});function E(l,i,h){return l?h==="en"?l[`${i}_en`]||l[i]:h==="zh"&&l[`${i}_cn`]||l[i]:""}async function ke(){await g();const l=await D();s.onMenuItemChanged=T,st(),W.value=Le(l)}function Le(l){const i=[];for(let h=0;h<l.length;h++){const k=h;i.push({label:re.value(l[h]),command:()=>{Ue(k),qe()}})}return i}const qe=()=>{ze(()=>{const l=document.querySelector(".p-tablist-viewport"),i=document.querySelector(".p-tab.p-tab-active");if(l&&i){const h=i.offsetLeft-l.offsetWidth/2+i.offsetWidth/2;l.scrollTo({left:h,behavior:"smooth"})}window.scrollTo({top:0,behavior:"smooth"})})},Ue=l=>{y(l),C.value=l,qe()},Ye=()=>{var l=X.getAllIncrementedDish();de.value.showDishList(l)};function Me(){return s.getTable()}s.params.port,B.value=s.table.value.order;const Ze=(l,i)=>{var ne;if((ne=s.settings.value)!=null&&ne.qrcodeInfo){if(!s.userId.value||!s.userName.value)return s.showGuestLogin.value=!0,!1;if(s.isAuthenticated()&&!s.isAuthorized.value)return s.showOrderWaitAuth.value=!0,!1}const h=localStorage.getItem("lastOrderTime"),k=s.getShopInfo("orderCoolingTime")||0;if(h&&k>0){const he=(Date.now()-parseInt(h))/1e3;if(he<k){const pe=Math.ceil(k-he);return Y.show_warn(O("notification.too_fast",{remainTime:pe})),!1}}const P=[];for(let se=0;se<oe.cartDishs.value.length;se++){var V=oe.cartDishs.value[se];const he=s.formateCustomDishNotes(V),pe=V.dis_count?V.dis_price:V.price;P.push({dishid:V.dishid,name:V.name,quantity:V.count,notes:he,limit:V.limit,price:pe,dishNote:V.dishNote,category:V.category})}const be=X.getAllIncrementedDish();for(let se=0;se<be.length;se++){var V=be[se];if(V.quantity>0){const pe=V.dis_count?V.dis_price:V.price,Ie=s.getDishNameDefaultName(V);P.push({dishid:V.id,name:Ie,quantity:V.quantity,limit:V.limit,price:pe,dishNote:V.dishNote})}}if(P.length===0)return Y.show_warn(O("notification.select_at_least_one")),!1;console.log("cart item:",P);const ve=Date.now().toString(36)+Math.random().toString(36).substring(2,5);return a.value=!0,s.submit_order({uniCode:ve,name:l.name,note:l.note,table:Me(),items:P},se=>{var he;if(!se.success&&(s.showGuestLogin.value=!1,(he=s.settings.value)!=null&&he.qrcodeInfo&&(s.userId.value||s.userName.value||s.isAuthenticated()))){s.showOrderWaitAuth.value=!0,a.value=!1;return}i(se)}),!0};function et(){const l=Se.getCookie("language");l&&(w.value=l)}function We(){for(let l=0;l<K.value.length;l++){const i=K.value[l];i.quantity=0}a.value=!1,oe.cleanAll()}we(async()=>{et(),await ke(),y(C.value),s.clear_order_data=()=>{We()},s.setOnOrderConfirmed(l=>{localStorage.setItem("lastOrderTime",Date.now()),We();const i=l;Y.show_success(O("notification.order_submitted",{id:i}))}),s.setOnShowError(l=>{a.value=!1;let i=l;if(typeof l=="string"&&l.startsWith("COOLING_LIMIT:")){const h=l.split(":");h.length===3&&(i=O("notification.order_cooling_wait",{coolingTime:h[1],remaining:h[2]}))}Y.show_error(O("notification.order_failed")+": "+i)})});function tt(){Se.deleteCookie("login_time");const l=S.query.table;l?Q.push({path:"/",query:{table:l}}):Q.push({path:"/takeReserve"})}async function $e(l,i=!0){const h=i?oe.cartDishs.value:X.getIdsAndQuantity(X.getAllIncrementedDish()),k=Pe.compressToEncodedURIComponent(JSON.stringify(h));try{await He.setItem(l,k)}catch(P){console.error("ä¿å­˜åˆ° localForage å¤±è´¥:",P)}}function Oe(){s.isTakeaway()?($e("take_cartDish_normal",!1),$e("take_cartDish_custom",!0)):($e("cartDish_normal",!1),$e("cartDish_custom",!0))}async function De(l,i=!0){try{const h=await He.getItem(l);if(!h)return;const k=JSON.parse(Pe.decompressFromEncodedURIComponent(h));k&&k!=="undefined"&&(i?oe.cartDishs.value=k:X.updateDishDataQty(k))}catch(h){console.error("ä»Ž localForage è¯»å–å¤±è´¥æˆ–è§£æžå¤±è´¥:",h)}}function st(){s.isTakeaway()?(De("take_cartDish_normal",!1),De("take_cartDish_custom")):(De("cartDish_normal",!1),De("cartDish_custom"))}return Je(()=>{Oe()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&Oe()}),window.addEventListener("beforeunload",l=>{Oe(),s.cleanup()}),(l,i)=>(n(),r(z,null,[e("div",ba,[(n(),J(ua,{key:I.value,types:Z.value,typeIndex:C.value,tabItems:W.value,tableId:Me(),onClickType:Ue,onSwitchToWelcome:tt},null,8,["types","typeIndex","tabItems","tableId"])),i[5]||(i[5]=e("div",{class:"pb-8"},null,-1)),i[6]||(i[6]=e("div",{class:"pb-4 sm:pb-5 md:pb-5 lg:pb-5"},null,-1)),m(ca,{duration:3e3,position:"center",size:"3rem"}),e("div",ya,[(n(),J(t(bt),{key:`swiper-${Z.value.length}-${I.value}`,"space-between":20,"centered-slides":"","grab-cursor":!0,class:"w-full",autoHeight:!0,onSlideChange:L,onSwiper:_,"initial-slide":C.value},{default:M(()=>[(n(!0),r(z,null,te(Z.value,(h,k)=>(n(),J(t(yt),{key:k},{default:M(()=>[Math.abs(C.value-k)<=1&&(!U.value||C.value!==k)?(n(),J(is,{key:0,rateDish:v,likedItemsRef:ue.value,dislikedItemsRef:me.value,tabIndex:k,onlyVeg:ee.value},null,8,["likedItemsRef","dislikedItemsRef","tabIndex","onlyVeg"])):Math.abs(C.value-k)<=1&&U.value&&C.value===k?(n(),J(cl,{key:1,currentCustomDish:$.value,onTypeClick:q,tabindex:k},null,8,["currentCustomDish","tabindex"])):N("",!0)]),_:2},1024))),128))]),_:1},8,["initial-slide"]))]),i[7]||(i[7]=e("div",{style:{height:"60px"}},null,-1)),e("div",_a,[e("div",wa,[e("div",xa,[t(s).isTakeaway()?N("",!0):(n(),J(t(R),{key:0,label:l.$t("common.orders"),icon:"pi pi-list",class:"p-button-secondary",onClick:H},null,8,["label"]))]),e("div",ka,[m(t(ht),{class:"text-sm",modelValue:ee.value,"onUpdate:modelValue":i[0]||(i[0]=h=>ee.value=h),onLabel:t(O)("common.showAll"),offLabel:t(O)("common.showOnlyVegetables"),onClick:i[1]||(i[1]=h=>t(s).filterMenuTabs(ee.value))},null,8,["modelValue","onLabel","offLabel"])]),e("div",$a,[m(t(pt),{value:t(F),severity:"danger",onClick:Ye},{default:M(()=>i[4]||(i[4]=[e("i",{class:"pi pi-shopping-cart",style:{"font-size":"2rem"}},null,-1)])),_:1,__:[4]},8,["value"])])])])]),m(Ps,{ref_key:"cartRef",ref:de,checkout:Ze,isTakeaway:!Me()},null,8,["isTakeaway"]),m(t(ge),{visible:G.value,"onUpdate:visible":i[2]||(i[2]=h=>G.value=h),header:l.$t("common.completedOrders"),modal:"",style:{width:"80vw","max-width":"700px"}},{default:M(()=>{var h,k;return[e("div",Da,[e("div",Ia,[(h=b.value.adultPrice)!=null&&h.quantity&&b.value.adultPrice.quantity!=0?(n(),r("div",Ca,[e("div",Ta,[e("span",Na,o(l.$t("common.adult")),1),e("small",null,o(l.$t("common.quantity"))+": "+o(b.value.adultPrice.quantity),1)]),e("div",Sa,[e("span",null,"â‚¬"+o((Number(b.value.adultPrice.price)*b.value.adultPrice.quantity).toFixed(2)),1)])])):N("",!0),(k=b.value.childrenPrice)!=null&&k.quantity&&b.value.childrenPrice.quantity!=0?(n(),r("div",Aa,[e("div",La,[e("span",qa,o(l.$t("common.children")),1),e("small",null,o(l.$t("common.quantity"))+": "+o(b.value.childrenPrice.quantity),1)]),e("div",Ma,[e("span",null,"â‚¬"+o((Number(b.value.childrenPrice.price)*b.value.childrenPrice.quantity).toFixed(2)),1)])])):N("",!0)]),t(s).table.value.order.length===0?(n(),r("div",Oa,o(l.$t("common.noOrders")),1)):(n(),r("div",ja,[(n(!0),r(z,null,te(t(s).table.value.order,(P,V)=>(n(),r("div",{key:V,class:"flex justify-content-between border-bottom-1 pb-2"},[e("div",Pa,[e("span",Ra,o(t(s).getDishName(P)),1),e("small",null,o(l.$t("common.quantity"))+": "+o(P.quantity),1)]),e("div",Ga,[e("span",null,"â‚¬"+o((P.price*P.quantity).toFixed(2)),1)])]))),128))]))]),e("div",Va,o(l.$t("common.total"))+": â‚¬"+o(b.value.total),1)]}),_:1},8,["visible","header"]),m(Xe,{visible:t(s).showGuestLogin.value,waiting:t(s).waitingAuthorization.value,showLoginShortcut:t(s).showGuestLoginShortcut.value,onJoin:c},null,8,["visible","waiting","showLoginShortcut"]),m(ga,{visible:t(s).showOrderWaitAuth.value,onClose:i[3]||(i[3]=h=>t(s).showOrderWaitAuth.value=!1)},null,8,["visible"])],64))}},Ka=xe(Ea,[["__scopeId","data-v-49e31b86"]]);export{Ka as default};
