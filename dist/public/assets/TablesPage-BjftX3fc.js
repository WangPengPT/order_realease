import{s as oe}from"./index-DwBlPRBA.js";import{s as ve}from"./index-B0bcSa-t.js";import{a as le,c as _e,f as Te}from"./index-BNnB8zR1.js";import{q as ae,h as D,s as H,c as P,o as m,a as t,b as n,w as v,t as y,C as L,F,n as N,f as A,e as M,E as X,l as b,z as Z,A as K,B as ke,d as $e,m as se,g as we,u as fe,x as ie,i as re,H as Pe,J as be}from"./index-BaOLiNlJ.js";import{b as Ce,s as de,a as ee}from"./index-Chnes_lj.js";import{s as Se}from"./index-COF-r6tc.js";import{s as Ne}from"./index-zFXz7NAW.js";import{a as ge}from"./index-CEmFYd-G.js";import{s as Oe}from"./index-ZWZMLxOI.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Me}from"./index-C3IDyQvW.js";import{s as De}from"./index-DCrL-pT5.js";import{s as Ee}from"./index-DvrhARgE.js";import{Q as je,C as ne}from"./CodeMaker-IOgtdCDu.js";import{s as Ve}from"./index-CCVhUwoQ.js";import"./index-DXI-5WHD.js";import"./index-K0TuGyWR.js";import"./index-DNRZQHoa.js";import"./index-CHqtfDyr.js";import"./index-CrB6UqKx.js";import"./index-CTWxDVLN.js";import"./index-BOJmkNZc.js";import"./index-2YY9ZNb5.js";import"./_commonjsHelpers-gnU0ypJ3.js";const ze={class:"hidden sm:block md:block lg:block"},Ae={class:"p-menuitem-content"},qe={class:"text-center"},Ue={class:"block sm:hidden md:hidden lg:hidden w-full ml-2"},Be={__name:"TableMenuBar",props:{filterStatu:String},setup(o){const{t:i}=ae(),x=D(o.filterStatu),f=H(()=>[{label:i("tablesPage.all"),value:"Todos",icon:"pi pi-circle-fill",severity:"contrast",message_severity:"contrast"},{label:i("tablesPage.available"),value:"Livre",icon:"pi pi-circle-fill",severity:"success",message_severity:"success"},{label:i("tablesPage.dining"),value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger",message_severity:"error"},{label:i("tablesPage.reserved"),value:"Reservado",icon:"pi pi-circle-fill",severity:"info",message_severity:"info"},{label:i("tablesPage.paid"),value:"Pago",icon:"pi pi-circle-fill",severity:"help",message_severity:"secondary"}]);function _(T){return f.value.find(u=>u.value===T)}return(T,u)=>{const C=le,E=Ne,V=Se,S=Ce;return m(),P(F,null,[t("div",ze,[n(E,{model:f.value,breakpoint:"319px",class:"border-0"},{item:v(({item:k})=>[t("div",Ae,[n(C,{label:k.label,icon:k.icon,severity:k.severity,variant:"outlined",raised:"",class:"border-round-lg p-2",onClick:U=>T.$emit("update:filterStatu",k.value)},{default:v(()=>[t("label",qe,"● "+y(k.label),1)]),_:2},1032,["label","icon","severity","onClick"])])]),_:1},8,["model"])]),t("div",Ue,[n(S,{modelValue:x.value,"onUpdate:modelValue":[u[0]||(u[0]=k=>x.value=k),u[1]||(u[1]=k=>T.$emit("update:filterStatu",x.value))],options:f.value,optionValue:"value",checkmark:"",highlightOnSelect:!1,class:"flex align-items-center",size:"small",style:{width:"200px",height:"40px"}},{value:v(k=>[n(V,{class:"text-center",severity:_(k.value).message_severity,variant:"simple"},{default:v(()=>[L("● "+y(_(k.value).label),1)]),_:2},1032,["severity"])]),option:v(k=>[n(V,{class:"text-center",severity:k.option.message_severity,variant:"simple"},{default:v(()=>[L(y(k.option.label),1)]),_:2},1032,["severity"])]),_:1},8,["modelValue","options"])])],64)}}},Re={class:"overflow-auto",style:{height:"calc(100vh - 200px)"}},Le={class:"hidden sm:block md:block lg:block"},Fe={class:"grid m-2"},Ie={class:"relative"},He={class:"flex flex-column justify-content-center align-items-center",style:{height:"144px"}},Je={class:"flex justify-content-center align-items-center",style:{height:"30%"}},Qe={class:"text-2xl font-bold"},Ge={key:0,class:"flex flex-column align-items-center",style:{height:"70%"}},Ze={class:"text-center text-lg"},Ke={class:"text-center text-2xl font-bold"},Ye=["onClick"],We={class:"block sm:hidden md:hidden lg:hidden"},Xe={class:"grid m-2"},et={class:"col-12"},tt={class:"col-12"},lt={class:"relative"},at={class:"flex flex-row p-0"},st={class:"flex justify-content-center align-items-center relative",style:{width:"30%",height:"74px"}},nt={class:"absolute top-0 left-0 pl-1 text-xs"},ot={class:"font-bold text-4xl"},it={key:0,class:"flex flex-row justify-content-center align-items-center",style:{width:"70%",height:"74px"}},rt={class:"flex relative",style:{width:"30%",height:"74px"}},dt={class:"absolute top-0 left-0 pl-1 text-xs"},ut={class:"flex justify-content-center align-items-center w-full"},ct={class:"font-bold text-2xl"},pt={class:"flex relative",style:{width:"70%",height:"74px"}},mt={class:"absolute top-0 left-0 pl-1 text-xs"},bt={class:"flex justify-content-center align-items-center w-full"},vt={class:"font-bold text-2xl"},ft=["onClick"],gt={class:"font-bold text-xl"},yt={class:"ont-bold"},ht={class:"flex flex-wrap justify-content-end mt-3"},xt={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(o,{emit:i}){const{t:e}=ae(),x=D(!1),f=D(),_=D(!1),T=D({}),u=H(()=>[{label:e("tablesPage.available"),value:"Livre"},{label:e("tablesPage.dining"),value:"Ocupado"},{label:e("tablesPage.reserved"),value:"Reservado"},{label:e("tablesPage.paid"),value:"Pago"}]);function C(h){return u.value.find(c=>c.value===h)}function E(h){return Number(h.peopleType.children)+Number(h.peopleType.adults)}function V(h){return!h||!Array.isArray(h)?0:parseFloat(h.reduce((c,z)=>c+z.price*z.quantity,0).toFixed(2))}function S(h){const c=N.getCurrentPeoplePrice();return Number(h.peopleType.children)*c.children+Number(h.peopleType.adults)*c.adults}function k(h){return(V(h.order)+S(h)).toFixed(2)}function U(h,c){let O="";switch(h){case"Livre":O="text-green-600";break;case"Ocupado":O="text-red-600";break;case"Reservado":O="text-blue-700";break;case"Pago":O="text-purple-600";break;default:O="text-gray-600"}return""+O}function p(h,c=3){const z="border-"+c+" border-gray-500 ";let O="";switch(h){case"Livre":break;case"Ocupado":O="border-red-300 bg-red-50";break;case"Reservado":O="border-blue-300 bg-blue-50";break;case"Pago":O="border-purple-300 bg-purple-50";break;default:O="border-gray-500"}return z+O}function B(h,c){c=="pay"?(T.value=h.nif_note,_.value=!0):h["msg_"+c]=!1,N.socket.emit("click_msg",h.id,c)}function J(){document.getElementById("tipsAudio").play()}return N.playSoundFun=J,(h,c)=>{const z=Oe,O=le,I=ve,q=oe,Q=ge;return m(),P(F,null,[t("div",Re,[c[12]||(c[12]=t("audio",{id:"tipsAudio",src:"/sound/tips.mp3",preload:"auto"},null,-1)),t("div",Le,[t("div",Fe,[o.editMode?(m(),A(z,{key:0,class:"m-1 border-3 border-gray-500 border-round-3xl flex justify-content-center align-items-center",style:{width:"150px",height:"150px"},onClick:c[0]||(c[0]=l=>x.value=!0)},{content:v(()=>c[8]||(c[8]=[t("div",{class:"flex justify-content-center align-items-center"},[t("i",{class:"pi pi-plus text-3xl text-gray-600"})],-1)])),_:1})):M("",!0),(m(!0),P(F,null,X(o.filteredTables,l=>(m(),A(z,{class:Z([p(l.status),"m-1 border-round-3xl flex flex-column justify-content-center align-items-center"]),style:{width:"150px",height:"150px"},onClick:r=>o.editMode?"":h.$emit("openTableDetail",l.id)},{header:v(()=>[t("div",Ie,[l.msg_pay?(m(),A(O,{key:0,icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"0px","z-index":"10"},onClick:K(r=>B(l,"pay"),["stop"])},null,8,["onClick"])):M("",!0),l.msg_call?(m(),A(O,{key:1,icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"30px","z-index":"10"},onClick:K(r=>B(l,"call"),["stop"])},null,8,["onClick"])):M("",!0)])]),content:v(()=>[t("div",He,[t("div",Je,[t("label",Qe,y(b(e)("tablesPage.tableNum"))+": "+y(l.id),1)]),o.editMode?M("",!0):(m(),P("div",Ge,[t("label",{class:Z(["text-center text-sm",U(l.status)])},y(C(l.status).label),3),t("p",Ze,y(E(l)+" "+b(e)("tablesPage.people")),1),t("p",Ke,y(k(l))+"€",1)])),o.editMode?(m(),P("div",{key:1,class:Z(p(l.status,1)),style:{width:"144px"}},null,2)):M("",!0),o.editMode?(m(),P("div",{key:2,class:"flex flex-wrap justify-content-center align-items-center w-full",style:{height:"70%"},onClick:K(r=>h.$emit("removeTable",l.id),["stop"])},c[9]||(c[9]=[t("i",{class:"pi pi-trash text-3xl text-red-400"},null,-1)]),8,Ye)):M("",!0)])]),_:2},1032,["class","onClick"]))),256))])]),t("div",We,[t("div",Xe,[t("div",et,[o.editMode?(m(),A(z,{key:0,class:"border-3 border-gray-500 flex align-items-center justify-content-center",onClick:c[1]||(c[1]=l=>x.value=!0),style:{height:"80px"}},{content:v(()=>c[10]||(c[10]=[t("div",{class:"flex justify-content-center align-items-center"},[t("i",{class:"pi pi-plus text-2xl text-gray-600",size:"large"})],-1)])),_:1})):M("",!0)]),(m(!0),P(F,null,X(o.filteredTables,l=>(m(),P("div",tt,[n(z,{class:Z([p(l.status),"flex justify-content-center border-round-2xl"]),style:{height:"80px"},onClick:r=>o.editMode?"":h.$emit("openTableDetail",l.id)},{header:v(()=>[t("div",lt,[l.msg_pay?(m(),A(O,{key:0,icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"},onClick:K(r=>B(l,"pay"),["stop"])},null,8,["onClick"])):M("",!0),l.msg_call?(m(),A(O,{key:1,icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"},onClick:K(r=>B(l,"call"),["stop"])},null,8,["onClick"])):M("",!0)])]),content:v(()=>[t("div",at,[t("div",st,[t("small",nt,y(b(e)("tablesPage.tableNum")),1),t("label",ot,y(l.id),1)]),t("div",{class:Z(p(l.status,1))},null,2),o.editMode?M("",!0):(m(),P("div",it,[t("div",rt,[t("small",dt,y(b(e)("tablesPage.peopleNum")),1),t("div",ut,[t("label",ct,y(E(l)),1)])]),t("div",{class:Z([p(l.status,1),"h-full"])},null,2),t("div",pt,[t("small",mt,y(b(e)("tablesPage.costNum")),1),t("div",bt,[t("label",vt,y(k(l))+" €",1)])])])),o.editMode?(m(),P("div",{key:1,class:"flex flex-row justify-content-center align-items-center",style:{width:"70%",height:"74px"},onClick:K(r=>h.$emit("removeTable",l.id),["stop"])},c[11]||(c[11]=[t("i",{class:"pi pi-trash text-2xl text-gray-600",size:"large"},null,-1)]),8,ft)):M("",!0)])]),_:2},1032,["class","onClick"])]))),256))])])]),n(q,{visible:_.value,"onUpdate:visible":c[2]||(c[2]=l=>_.value=l),modal:!0,dismissableMask:!0,header:b(e)("tablesPage.payInfo"),style:{"min-width":"300px","max-width":"450px"},onHide:c[3]||(c[3]=l=>T.value={nif:void 0,note:void 0})},{default:v(()=>{var l,r;return[t("label",gt,"NIF:"+y((l=T.value)!=null&&l.nif?T.value.nif:b(e)("tablesPage.noNif")),1),n(I),t("label",yt,y(b(e)("tablesPage.note"))+": "+y((r=T.value)!=null&&r.note?T.value.note:b(e)("tablesPage.noNote")),1)]}),_:1},8,["visible","header"]),n(q,{visible:x.value,"onUpdate:visible":c[6]||(c[6]=l=>x.value=l),modal:!0,dismissableMask:!0,header:b(e)("tablesPage.addTable"),onHide:c[7]||(c[7]=l=>f.value=void 0)},{default:v(()=>[n(Q,{modelValue:f.value,"onUpdate:modelValue":c[4]||(c[4]=l=>f.value=l),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:`${b(e)("tablesPage.tableNum")}：${f.value<10?"0":""}`,step:1,min:1,max:9999,placeholder:b(e)("tablesPage.enterTable"),fluid:""},{incrementbuttonicon:v(()=>c[13]||(c[13]=[t("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:v(()=>c[14]||(c[14]=[t("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix","placeholder"]),t("div",ht,[n(O,{label:b(e)("tablesPage.createTable"),onClick:c[5]||(c[5]=l=>{h.$emit("addNewTable",f.value),x.value=!1})},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},_t=ye(xt,[["__scopeId","data-v-3714826b"]]);var Tt=`
    .p-tag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: dt('tag.primary.background');
        color: dt('tag.primary.color');
        font-size: dt('tag.font.size');
        font-weight: dt('tag.font.weight');
        padding: dt('tag.padding');
        border-radius: dt('tag.border.radius');
        gap: dt('tag.gap');
    }

    .p-tag-icon {
        font-size: dt('tag.icon.size');
        width: dt('tag.icon.size');
        height: dt('tag.icon.size');
    }

    .p-tag-rounded {
        border-radius: dt('tag.rounded.border.radius');
    }

    .p-tag-success {
        background: dt('tag.success.background');
        color: dt('tag.success.color');
    }

    .p-tag-info {
        background: dt('tag.info.background');
        color: dt('tag.info.color');
    }

    .p-tag-warn {
        background: dt('tag.warn.background');
        color: dt('tag.warn.color');
    }

    .p-tag-danger {
        background: dt('tag.danger.background');
        color: dt('tag.danger.color');
    }

    .p-tag-secondary {
        background: dt('tag.secondary.background');
        color: dt('tag.secondary.color');
    }

    .p-tag-contrast {
        background: dt('tag.contrast.background');
        color: dt('tag.contrast.color');
    }
`,kt={root:function(i){var e=i.props;return["p-tag p-component",{"p-tag-info":e.severity==="info","p-tag-success":e.severity==="success","p-tag-warn":e.severity==="warn","p-tag-danger":e.severity==="danger","p-tag-secondary":e.severity==="secondary","p-tag-contrast":e.severity==="contrast","p-tag-rounded":e.rounded}]},icon:"p-tag-icon",label:"p-tag-label"},$t=ke.extend({name:"tag",style:Tt,classes:kt}),wt={name:"BaseTag",extends:_e,props:{value:null,severity:null,rounded:Boolean,icon:String},style:$t,provide:function(){return{$pcTag:this,$parentInstance:this}}};function te(o){"@babel/helpers - typeof";return te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},te(o)}function Pt(o,i,e){return(i=Ct(i))in o?Object.defineProperty(o,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[i]=e,o}function Ct(o){var i=St(o,"string");return te(i)=="symbol"?i:i+""}function St(o,i){if(te(o)!="object"||!o)return o;var e=o[Symbol.toPrimitive];if(e!==void 0){var x=e.call(o,i);if(te(x)!="object")return x;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(o)}var he={name:"Tag",extends:wt,inheritAttrs:!1,computed:{dataP:function(){return Te(Pt({rounded:this.rounded},this.severity,this.severity))}}},Nt=["data-p"];function Ot(o,i,e,x,f,_){return m(),P("span",se({class:o.cx("root"),"data-p":_.dataP},o.ptmi("root")),[o.$slots.icon?(m(),A(we(o.$slots.icon),se({key:0,class:o.cx("icon")},o.ptm("icon")),null,16,["class"])):o.icon?(m(),P("span",se({key:1,class:[o.cx("icon"),o.icon]},o.ptm("icon")),null,16)):M("",!0),o.value!=null||o.$slots.default?$e(o.$slots,"default",{key:2},function(){return[t("span",se({class:o.cx("label")},o.ptm("label")),y(o.value),17)]}):M("",!0)],16,Nt)}he.render=Ot;const Mt={class:"flex flex-column justify-content-center align-items-center"},Dt={for:"Total"},Et={key:0,class:"flex flex-wrap justify-content-center align-items-center"},jt={for:"Adult"},Vt={key:1,class:"flex flex-wrap justify-content-center align-items-center"},zt={for:"Children"},At={class:"flex flex-wrap justify-content-center align-items-center m-2"},qt={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},Ut={key:0,class:"flex flex-column gap-2 m-2"},Bt={key:0,class:"flex flex-column gap-3 mt-3"},Rt={class:"flex justify-content-between align-items-center"},Lt={class:"text-500"},Ft={key:1,class:"text-center p-5 text-500"},It={class:"m-2"},Ht={key:0,class:"flex flex-wrap justify-content-between align-items-center"},Jt={key:1,class:"flex flex-wrap justify-content-between align-items-center"},Qt={class:"flex flex-column"},Gt={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(o,{emit:i}){const{t:e}=ae();let x=!1;const f=fe(),_=D(!1),T=D(!1),u=o,C=H(()=>N.tables.value.find(s=>s.id===u.selectedTable.id)||u.selectedTable);function E(s){N.authorizeUser(u.selectedTable.id,s).then(g=>{g.success?f.add({severity:"success",summary:e("common.success"),detail:"Authorized",life:3e3}):f.add({severity:"error",summary:e("common.error"),detail:g.message,life:3e3})})}function V(s){N.revokeUser(u.selectedTable.id,s).then(g=>{g.success?f.add({severity:"success",summary:e("common.success"),detail:"Revoked",life:3e3}):f.add({severity:"error",summary:e("common.error"),detail:g.message,life:3e3})})}function S(){N.authorizeAll(u.selectedTable.id).then(s=>{s.success?f.add({severity:"success",summary:e("common.success"),detail:"All Authorized",life:3e3}):f.add({severity:"error",summary:e("common.error"),detail:s.message,life:3e3})})}const k=i;function U(){k("onEdit",u.selectedTable.id,s=>{p.value=JSON.parse(JSON.stringify(s)),_.value=!0})}const p=D(JSON.parse(JSON.stringify(u.selectedTable))),B=D([{label:e("tablesPage.available"),value:"Livre",severity:"success"},{label:e("tablesPage.dining"),value:"Ocupado",severity:"danger"},{label:e("tablesPage.reserved"),value:"Reservado",severity:"info"},{label:e("tablesPage.paid"),value:"Pago",severity:"help"}]);function J(){x||(T.value=!1,p.value=JSON.parse(JSON.stringify(u.selectedTable))),x=!1}const h=H(()=>Number(p.value.peopleType.children)+Number(p.value.peopleType.adults));function c(){p.value.status?(k("tableEditConfirm",p.value,s=>{(s==null?void 0:s.success)==!0?(f.add({severity:"success",summary:e("common.success"),detail:s.message,life:3e3}),_.value=!1):f.add({severity:"error",summary:e("common.error"),detail:s.message,life:3e3})}),T.value=!1,x=!0):f.add({severity:"error",summary:e("common.error"),detail:e("tablesPage.stateError"),life:3e3})}function z(){T.value=!0}function O(){_.value=!1,p.value=JSON.parse(JSON.stringify(u.selectedTable))}function I(){return B.value.find(s=>s.value===p.value.status)}function q(s,g){const R=Number(g);if(s==="Adult"){Number(p.value.peopleType.adults)+R<=0?p.value.peopleType.adults=0:p.value.peopleType.adults=Number(p.value.peopleType.adults)+R,p.value.people=Number(p.value.peopleType.adults)+Number(p.value.peopleType.children);return}if(s==="Children"){p.value.peopleType.children+R<=0?p.value.peopleType.children=0:p.value.peopleType.children=Number(p.value.peopleType.children)+R,p.value.people=Number(p.value.peopleType.adults)+Number(p.value.peopleType.children);return}}const Q=ie(),l=()=>{Q.require({message:e("tablesPage.clearMsg.1")+p.value.id+e("tablesPage.clearMsg.2"),header:e("tablesPage.confirmClear"),icon:"pi pi-info-circle",rejectLabel:e("common.cancel"),rejectProps:{label:e("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:e("common.confirm"),severity:"danger"},accept:()=>{k("cleanTable",p.value.id,s=>{(s==null?void 0:s.success)===!1?f.add({severity:"error",summary:e("common.error"),detail:s.message,life:3e3}):(s==null?void 0:s.success)===!0&&f.add({severity:"success",summary:e("common.success"),detail:`${e("tablesPage.clearSucMsg.1")}${p.value.id}${e("tablesPage.clearSucMsg.2")}`,life:3e3})})},reject:()=>{f.add({severity:"error",summary:e("common.operation"),detail:`${e("tablesPage.clearCancelMsg.1")}${p.value.id}${e("tablesPage.clearCancelMsg.2")}`,life:3e3})}})},r=D(null),a=D(!1);function d(){window.open(window.env.QR_ADDR+ne.SimpleEncode(u.selectedTable.id),"_blank")}const w=async()=>{if(r.value)try{await je.toCanvas(r.value,window.env.QR_ADDR+ne.SimpleEncode(u.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(s){console.error("生成二维码失败:",s)}};return re(()=>{w(),N.socket.emit("manager_get_table_users",u.selectedTable.id,s=>{s.success&&N.onUpdateTableUsers({tableId:u.selectedTable.id,users:s.data})})}),Pe(()=>window.env.QR_ADDR+ne.SimpleEncode(u.selectedTable.id),w),(s,g)=>{var ce,pe,me;const R=Ee,Y=De,$=le,W=Me,ue=oe;return m(),P(F,null,[t("div",Mt,[t("div",null,[n(Y,{class:"m-2",variant:"on"},{default:v(()=>[n(R,{id:"Total",modelValue:h.value,"onUpdate:modelValue":g[0]||(g[0]=j=>h.value=j),autocomplete:"off",disabled:""},null,8,["modelValue"]),t("label",Dt,y(b(e)("tablesPage.totalPeople")),1)]),_:1})]),_.value?(m(),P("div",Et,[n($,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:g[1]||(g[1]=j=>q("Adult",-1))}),n(Y,{class:"m-2",variant:"on"},{default:v(()=>[n(R,{id:"Adult",modelValue:p.value.peopleType.adults,"onUpdate:modelValue":g[2]||(g[2]=j=>p.value.peopleType.adults=j),autocomplete:"off"},null,8,["modelValue"]),t("label",jt,y(b(e)("tablesPage.adult")),1)]),_:1}),n($,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:g[3]||(g[3]=j=>q("Adult",1))})])):M("",!0),_.value?(m(),P("div",Vt,[n($,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:g[4]||(g[4]=j=>q("Children",-1))}),n(Y,{class:"m-2",variant:"on"},{default:v(()=>[n(R,{id:"Children",modelValue:p.value.peopleType.children,"onUpdate:modelValue":g[5]||(g[5]=j=>p.value.peopleType.children=j),autocomplete:"off"},null,8,["modelValue"]),t("label",zt,y(b(e)("tablesPage.child")),1)]),_:1}),n($,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:g[6]||(g[6]=j=>q("Children",1))})])):M("",!0)]),t("div",At,[_.value?M("",!0):(m(),A($,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:(ce=I())==null?void 0:ce.label,severity:(pe=I())==null?void 0:pe.severity,onClick:z},null,8,["label","severity"])),_.value?(m(),A(W,{key:1,modelValue:p.value.status,"onUpdate:modelValue":g[7]||(g[7]=j=>p.value.status=j),options:B.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:p.value.status===null},null,8,["modelValue","options","invalid"])):M("",!0)]),t("div",qt,[t("canvas",{ref_key:"qrCanvas",ref:r,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:d},null,512)]),(me=b(N).settings.value)!=null&&me.qrcodeInfo?(m(),P("div",Ut,[n($,{label:b(e)("tablesPage.guests"),icon:"pi pi-users",severity:"secondary",outlined:"",onClick:g[8]||(g[8]=j=>a.value=!0)},null,8,["label"])])):M("",!0),n(ue,{visible:a.value,"onUpdate:visible":g[9]||(g[9]=j=>a.value=j),header:b(e)("tablesPage.guests"),modal:!0,dismissableMask:!0,style:{width:"90%","max-width":"600px"}},{default:v(()=>{var j;return[(j=C.value)!=null&&j.users&&C.value.users.length>0?(m(),P("div",Bt,[t("div",Rt,[t("span",Lt,y(b(e)("tablesPage.guestListDesc")||"Manage guest access"),1),n($,{label:b(e)("tablesPage.authorizeAll"),size:"small",onClick:S},null,8,["label"])]),n(b(de),{value:C.value.users,size:"small",stripedRows:"",scrollable:"",scrollHeight:"400px"},{default:v(()=>[n(b(ee),{field:"name",header:b(e)("tablesPage.name")},null,8,["header"]),n(b(ee),{header:b(e)("tablesPage.status")},{body:v(({data:G})=>[n(b(he),{severity:G.authorized?"success":"warning",value:G.authorized?b(e)("tablesPage.authorized"):b(e)("tablesPage.pending")},null,8,["severity","value"])]),_:1},8,["header"]),n(b(ee),{header:b(e)("tablesPage.actions")},{body:v(({data:G})=>[G.authorized?(m(),A($,{key:1,icon:"pi pi-times",severity:"danger",rounded:"",text:"",onClick:xe=>V(G.userId)},null,8,["onClick"])):(m(),A($,{key:0,icon:"pi pi-check",severity:"success",rounded:"",text:"",onClick:xe=>E(G.userId)},null,8,["onClick"]))]),_:1},8,["header"])]),_:1},8,["value"])])):(m(),P("div",Ft,[g[13]||(g[13]=t("i",{class:"pi pi-users text-4xl mb-3"},null,-1)),t("p",null,y(b(e)("tablesPage.noGuests")||"No guests connected yet"),1)]))]}),_:1},8,["visible","header"]),t("div",It,[_.value?M("",!0):(m(),P("div",Ht,[n($,{label:s.$t("tablesPage.orderDetails"),severity:"success",onClick:g[10]||(g[10]=()=>s.$emit("showTableOrders"))},null,8,["label"]),n($,{label:s.$t("tablesPage.clear"),onClick:l,severity:"danger",class:"m-1"},null,8,["label"]),n($,{label:s.$t("tablesPage.edit"),onClick:U,class:"m-1"},null,8,["label"])])),_.value?(m(),P("div",Jt,[n($,{label:s.$t("tablesPage.cancelEdit"),severity:"danger",raised:"",class:"m-2",onClick:O},null,8,["label"]),n($,{label:s.$t("tablesPage.saveEdit"),severity:"success",raised:"",class:"m-2",onClick:c},null,8,["label"])])):M("",!0)]),n(ue,{visible:T.value,"onUpdate:visible":g[12]||(g[12]=j=>T.value=j),modal:"",header:s.$t("tablesPage.editState"),closable:!0,dismissableMask:!0,onHide:J},{default:v(()=>[t("div",Qt,[n(W,{modelValue:p.value.status,"onUpdate:modelValue":g[11]||(g[11]=j=>p.value.status=j),options:B.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:p.value.status===null},null,8,["modelValue","options","invalid"]),n($,{label:s.$t("common.confirm"),class:"mt-3",onClick:c},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},Zt=ye(Gt,[["__scopeId","data-v-57683cf7"]]);function Kt(o){const i=new Date(o),e=V=>String(V).padStart(2,"0"),x=new Date(i.toLocaleString("en-US",{timeZone:"Europe/Lisbon"})),f=x.getFullYear(),_=e(x.getMonth()+1),T=e(x.getDate()),u=e(x.getHours()),C=e(x.getMinutes()),E=e(x.getSeconds());return`${f}-${_}-${T} ${u}:${C}:${E}`}const Yt={class:"font-bold",style:{"min-width":"100px"}},Wt={__name:"TableOrderTimeLine",props:{table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},setup(o){const i=o,e=D([]),x=H(()=>{const u=i.table.order;return Array.isArray(u)?Array.from(new Set(u.flatMap(C=>Array.isArray(C.orderIds)?C.orderIds:[]))):[]}),f=H(()=>{const u=N.orders.value,C=x.value;return Array.isArray(u)?u.filter(E=>C.includes(E.id)).sort((E,V)=>E.timestamp-V.timestamp):[]}),_=[{field:"id",header:"订单号"},{field:"table",header:"桌号"},{field:"status",header:"状态"},{field:"timestamp",header:"时间",body:u=>Kt(u.timestamp)}],T=[{field:"dishid",header:"编号"},{field:"quantity",header:"数量"},{field:"name",header:"名称",body:u=>N.getDishName(u)}];return re(()=>{e.value=f.value.map(u=>u.id)}),(u,C)=>{const E=ee,V=de;return m(),A(V,{value:f.value,dataKey:"id",expandedRows:e.value,"onUpdate:expandedRows":C[0]||(C[0]=S=>e.value=S),expandableRows:""},{expansion:v(S=>[(m(!0),P(F,null,X(S.data.items,k=>(m(),P("div",{key:k.dishid,class:"p-3 mb-2 border-round bg-gray-100"},[(m(),P(F,null,X(T,U=>t("div",{key:U.field,class:"flex gap-2 mb-1"},[t("span",Yt,y(U.header)+":",1),t("span",null,y(typeof U.body=="function"?U.body(k):k[U.field]),1)])),64))]))),128))]),default:v(()=>[n(E,{expander:"",style:{width:"3rem"}}),(m(),P(F,null,X(_,S=>n(E,{key:S.field,field:S.field,header:S.header,sortable:""},{body:v(k=>[L(y(typeof S.body=="function"?S.body(k.data):k.data[S.field]),1)]),_:2},1032,["field","header"])),64))]),_:1},8,["value","expandedRows"])}}},Xt={key:0},el={class:"flex flex-column"},tl={key:0},ll=["disabled","onClick"],al={class:"text-center py-5"},sl={class:"text-gray-500"},nl={key:1},ol={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},il={class:"font-bold"},rl={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(o,{emit:i}){var r;const{t:e}=ae(),x=o,f=i,_=D((r=x.selectedTable.order)==null?void 0:r.sort((a,d)=>d.price-a.price).filter(a=>a.quantity!=0)),T=D(_.value.filter(a=>a.price!=0)),u=D([]),C=D(!1),E=D(!1),V=D(!1),S=D();re(()=>{k()});function k(){N.getPeoplePricesData(S,x.selectedTable.id)}const U=H(()=>{const a=p(),d=_.value.reduce((w,s)=>w+s.price*s.quantity,0);return(a+d).toFixed(2)});function p(){if(!S.value)return 0;let a=0;for(const d in S.value)a+=Number(S.value[d].totalPrice);return a}const B=H(()=>{for(const a in S.value)if(S.value[a].price!=0)return!0;return!1});function J(a){let d=0;return a.forEach(w=>{d+=w.price*w.quantity}),d.toFixed(2)}function h(){C.value=!C.value,!C.value&&u.value.length>0&&l()}function c(a){if(u.value.find(d=>d.dishid===a.dishid))u.value.find(d=>d.dishid===a.dishid).quantity+=1;else{const d={...a,quantity:1};u.value.push(d)}a.quantity-=1}function z(){let a="| ";return u.value.forEach(d=>{const w=_.value.find(s=>s.dishid===d.dishid);w&&(a+=d.dishid+"-"+N.getDishName(d)+" "+(w.quantity+d.quantity)+" -> "+w.quantity+` | 
`)}),a}function O(a){f("cancelOrderEdit"),f("showToast","error",e("common.operation"),e("tablesPage.editCancelMsg")+`
`+a),u.value.forEach(d=>{_.value.find(w=>w.dishid===d.dishid).quantity+=d.quantity}),u.value=[]}function I(a){var d;f("saveOrder",u.value),f("showToast","info",e("common.operation"),e("tablesPage.ediSucMsg")+`
`+a),u.value=[],_.value=(d=x.selectedTable.order)==null?void 0:d.sort((w,s)=>s.price-w.price).filter(w=>w.quantity!=0)}const q=ie();function Q(a){return Array.isArray(a)?a.map(be):be(a)}const l=()=>{let a=!1;const d=Q(z());q.require({message:d,escape:!0,header:e("tablesPage.editOrder"),rejectLabel:e("common.cancel"),rejectProps:{label:e("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:e("common.save"),severity:"danger"},accept:()=>{a=!0,I(d)},reject:()=>{a=!0,O(d)},onHide:()=>{a||O(d)}})};return(a,d)=>{const w=ee,s=de,g=ge,R=Ve,Y=le;return m(),P(F,null,[V.value?(m(),P("div",nl,[n(Wt,{table:o.selectedTable},null,8,["table"])])):(m(),P("div",Xt,[t("div",el,[B.value?(m(),A(s,{key:0,value:S.value},{default:v(()=>[n(w,{field:"peopleType",header:b(e)("tablesPage.peopleType")},{body:v(({data:$})=>[L(y(b(e)("tablesPage."+($.peopleType.toLowerCase().includes("adult")?"adult":"child"))),1)]),_:1},8,["header"]),n(w,{field:"price",header:b(e)("tablesPage.price")},null,8,["header"]),n(w,{field:"quantity",header:b(e)("tablesPage.quantity")},null,8,["header"]),n(w,{field:"totalPrice",header:b(e)("tablesPage.totalPrice")},null,8,["header"])]),_:1},8,["value"])):M("",!0)]),n(s,{value:E.value?T.value:_.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:v(()=>[t("div",al,[t("p",sl,y(a.$t("tablesPage.noOrder")),1)])]),default:v(()=>[n(w,{field:"dishid",header:"ID"}),n(w,{header:a.$t("tablesPage.name")},{body:v($=>[L(y(b(N).getDishName($.data)),1)]),default:v(()=>[d[3]||(d[3]=L(" > ",-1))]),_:1,__:[3]},8,["header"]),n(w,{field:"price",header:a.$t("tablesPage.price")},null,8,["header"]),n(w,{field:"quantity",header:a.$t("tablesPage.quantity")},{body:v($=>[C.value?M("",!0):(m(),P("label",tl,y($.data.quantity),1)),C.value?(m(),A(g,{key:1,modelValue:$.data.quantity,"onUpdate:modelValue":W=>$.data.quantity=W,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:v(()=>d[4]||(d[4]=[t("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:v(()=>[t("span",{class:"p-inputnumber-button-icon",disabled:$.data.quantity<=0,onClick:W=>c($.data)},d[5]||(d[5]=[t("i",{class:"pi pi-angle-down"},null,-1)]),8,ll)]),_:2},1032,["modelValue","onUpdate:modelValue"])):M("",!0)]),_:1},8,["header"]),n(w,{header:a.$t("tablesPage.totalPrice")},{body:v($=>[L(y(J([$.data])),1)]),default:v(()=>[d[6]||(d[6]=L(" > ",-1))]),_:1,__:[6]},8,["header"])]),_:1},8,["value"])])),t("div",ol,[t("label",il,y(a.$t("tablesPage.total")+": ")+" "+y(U.value),1),t("label",null,[n(R,{modelValue:E.value,"onUpdate:modelValue":d[0]||(d[0]=$=>E.value=$)},null,8,["modelValue"]),L(" "+y(a.$t("tablesPage.showNonZero")),1)]),t("label",null,[n(R,{modelValue:V.value,"onUpdate:modelValue":d[1]||(d[1]=$=>V.value=$)},null,8,["modelValue"]),L(" "+y(a.$t("tablesPage.timeLine")),1)]),n(Y,{label:C.value?a.$t("common.save"):a.$t("common.edit"),onClick:d[2]||(d[2]=$=>h())},null,8,["label"])])],64)}}},dl={class:"flex flex-wrap justify-content-between align-items-center m-1"},ul={class:""},cl={class:"m-2"},pl={class:"hidden sm:block md:block lg:block"},ml={class:"hidden sm:block md:block lg:block"},ql={__name:"TablesPage",setup(o){const{t:i}=ae(),e=ie(),x=D("Todos"),f=D(!1),_=D(!1),T=D({id:0}),u=D(!1),C=D({}),E=H(()=>x.value==="Todos"?N.tables.value:N.tables.value.filter(l=>l.status===x.value));function V(){f.value=!0}function S(){f.value==!0&&(f.value=!1)}function k(l){e.require({message:i("tablesPage.removeTableMsg.1")+l+i("tablesPage.removeTableMsg.2"),header:i("tablesPage.removeTableHeader"),icon:"pi pi-trash",rejectProps:{label:i("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:i("common.confirm"),severity:"danger"},accept:async()=>{const r=await N.deleteTable(l);r.success?q.add({severity:"info",summary:i("common.success"),detail:i("tablesPage.removeSucMsg.1")+l+i("tablesPage.removeSucMsg.2"),life:3e3}):q.add({severity:"error",summary:i("common.error"),detail:r.message,life:3e3})},reject:()=>{}})}async function U(l){l<10&&(l="0"+l);const r=await N.addNewTable(l);r!==void 0?q.add({severity:"error",summary:r.title,detail:r.message,life:3e3}):q.add({severity:"info",summary:i("common.success"),detail:i("tablesPage.createSucMsg.1")+l+i("tablesPage.createSucMsg.2"),life:3e3})}function p(l){const r=N.tables.value.find(a=>a.id===l);T.value={...r,order:(r==null?void 0:r.order)||[]}}function B(l,r){const a=N.tables.value.find(d=>d.id===l);T.value={...a,order:(a==null?void 0:a.order)||[]},r(T.value)}function J(l){p(l),_.value=!0}async function h(l,r){const a={id:l.id,status:l.status,peopleType:{adults:l.peopleType.adults,children:l.peopleType.children}},d=await N.updateTable(a);p(l.id),d.success?r({success:!0,message:i("tablesPage.updateSucMsg")}):r({success:!1,message:d.message||i("tablesPage.updateFailMsg")})}async function c(l,r){const a=await N.tableClean(l);a.success?(_.value=!1,r({success:!0,message:i("tablesPage.updateSucMsg")})):(console.log("cleanTable Error:",a),r({success:!1,message:a.message||i("tablesPage.updateFailMsg")}))}function z(){const l=T.value.id;p(l),u.value=!0}function O(l){N.deleteOrders(T.value.id,l),C.value.order&&(N.deleteOrder(C.value),C.value={})}function I(){N.refreshTables()}const q=fe();function Q(l,r,a,d){q.add({severity:l||"",summary:r||"",detail:a||"",life:d||3e3})}return(l,r)=>{const a=le,d=ve,w=oe;return m(),P(F,null,[t("div",dl,[t("div",ul,[n(Be,{filterStatu:x.value,"onUpdate:filterStatu":r[0]||(r[0]=s=>x.value=s),style:{padding:"0"}},null,8,["filterStatu"])]),t("div",cl,[f.value?M("",!0):(m(),A(a,{key:0,class:"unchange_white_text_button",onClick:V},{default:v(()=>[r[6]||(r[6]=t("i",{class:"pi pi-pencil"},null,-1)),t("label",pl,y(b(i)("tablesPage.editTables")),1)]),_:1,__:[6]})),f.value?(m(),A(a,{key:1,class:"unchange_white_text_button",onClick:S},{default:v(()=>[r[7]||(r[7]=t("i",{class:"pi pi-arrow-left"},null,-1)),t("label",ml,y(b(i)("tablesPage.closeEdit")),1)]),_:1,__:[7]})):M("",!0)])]),n(d,{class:"m-0"}),n(_t,{filteredTables:E.value,"onUpdate:filteredTables":r[1]||(r[1]=s=>E.value=s),editMode:f.value,"onUpdate:editMode":r[2]||(r[2]=s=>f.value=s),onOpenTableDetail:J,onRemoveTable:k,onAddNewTable:U},null,8,["filteredTables","editMode"]),n(w,{visible:_.value,"onUpdate:visible":r[3]||(r[3]=s=>_.value=s),header:b(i)("tablesPage.tableNum")+": "+T.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:v(()=>[n(Zt,{selectedTable:T.value,onTableEditConfirm:h,onCleanTable:c,onShowTableOrders:z,onOnEdit:B},null,8,["selectedTable"])]),_:1},8,["visible","header"]),n(w,{visible:u.value,"onUpdate:visible":r[4]||(r[4]=s=>u.value=s),modal:!0,dismissableMask:!0,header:b(i)("tablesPage.orderDetails"),style:{"min-width":"350px","max-width":"550px"},onHide:r[5]||(r[5]=s=>I())},{default:v(()=>[n(rl,{selectedTable:T.value,onSaveOrder:O,onCancelOrderEdit:I,onShowToast:Q},null,8,["selectedTable"])]),_:1},8,["visible","header"])],64)}}};export{ql as default};
