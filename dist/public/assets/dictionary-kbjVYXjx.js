import{u as le,b as oe,s as se}from"./index-D9LdP60m.js";import{s as ne}from"./index-Cqc5NAhc.js";import{B as ie,c as T,o as C,d as de,m as ue,W as re,au as ce,av as O,q as me,u as fe,n as D,h as c,s as pe,H as ve,i as he,a as u,b as a,w as i,F as ke,e as F,t as x,G as _}from"./index-BxEdevYS.js";import{x as W}from"./index-H5xuy8zQ.js";import{c as be,a as ye}from"./index-JqOmmvEi.js";import{s as ge,a as xe}from"./index-PTtqGRtu.js";import{s as _e,a as we}from"./index-BfaWA40Q.js";import{s as Ne}from"./index-B4ua0aJA.js";import{s as Ve}from"./index-Bue2rB_w.js";import"./index-BtEo18XN.js";import"./index-cE0vUSAY.js";import"./index-CxvKVNLu.js";import"./index-rNVk0xqq.js";import"./index-BDQoDvHq.js";import"./index-B2GqmfrV.js";var Se=`
    .p-blockui {
        position: relative;
    }

    .p-blockui-mask {
        border-radius: dt('blockui.border.radius');
    }

    .p-blockui-mask.p-overlay-mask {
        position: absolute;
    }

    .p-blockui-mask-document.p-overlay-mask {
        position: fixed;
    }
`,Ie={root:"p-blockui"},$e=ie.extend({name:"blockui",style:Se,classes:Ie}),Ue={name:"BaseBlockUI",extends:be,props:{blocked:{type:Boolean,default:!1},fullScreen:{type:Boolean,default:!1},baseZIndex:{type:Number,default:0},autoZIndex:{type:Boolean,default:!0}},style:$e,provide:function(){return{$pcBlockUI:this,$parentInstance:this}}},j={name:"BlockUI",extends:Ue,inheritAttrs:!1,emits:["block","unblock"],mask:null,data:function(){return{isBlocked:!1}},watch:{blocked:function(o){o===!0?this.block():this.unblock()}},mounted:function(){this.blocked&&this.block()},methods:{block:function(){var o="p-blockui-mask p-overlay-mask p-overlay-mask-enter";this.fullScreen?(o+=" p-blockui-mask-document",this.mask=O("div",{style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%"},class:!this.isUnstyled&&o,"p-bind":this.ptm("mask")}),document.body.appendChild(this.mask),oe(),document.activeElement.blur()):(this.mask=O("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},class:!this.isUnstyled&&o,"p-bind":this.ptm("mask")}),this.$refs.container.appendChild(this.mask)),this.autoZIndex&&W.set("modal",this.mask,this.baseZIndex+this.$primevue.config.zIndex.modal),this.isBlocked=!0,this.$emit("block")},unblock:function(){var o=this;if(this.mask){!this.isUnstyled&&re(this.mask,"p-overlay-mask-leave");var p=function(){clearTimeout(w),o.mask.removeEventListener("animationend",p),o.mask.removeEventListener("webkitAnimationEnd",p)},w=setTimeout(function(){o.removeMask()},10);ce(this.mask)>0&&(this.mask.addEventListener("animationend",p),this.mask.addEventListener("webkitAnimationEnd",p))}else this.removeMask()},removeMask:function(){if(W.clear(this.mask),this.fullScreen)document.body.removeChild(this.mask),le();else{var o;(o=this.$refs.container)===null||o===void 0||o.removeChild(this.mask)}this.isBlocked=!1,this.$emit("unblock")}}},Be=["aria-busy"];function Te(m,o,p,w,b,y){return C(),T("div",ue({ref:"container",class:m.cx("root"),"aria-busy":b.isBlocked},m.ptmi("root")),[de(m.$slots,"default")],16,Be)}j.render=Te;const Ce={class:"w-full h-full flex flex-column"},Pe={key:0,class:"absolute w-full h-full flex flex-column align-items-center justify-content-center gap-3 z-1"},Me={class:"flex flex-row w-full justify-content-between"},De={class:"flex flex-row gap-1"},Re={key:0,class:"flex flex-row gap-1"},Ae={class:"flex justify-end"},Ee={class:"flex flex-column gap-2"},ze={class:"flex flex-row gap-2"},tt={__name:"dictionary",setup(m){const{t:o}=me(),p=fe(),w=D.dictionarApi.dictinary,b=c(),y=c(""),N=c(""),V=c(""),S=c(""),I=c(!1),R=c(!1),P=c([]),g=c([]),$=c(!1),U=c({global:{value:null,matchMode:_.CONTAINS},refName:{value:null,matchMode:_.STARTS_WITH},text_en:{value:null,matchMode:_.STARTS_WITH},text_pt:{value:null,matchMode:_.STARTS_WITH},text_zh:{value:null,matchMode:_.STARTS_WITH}}),n=c({add:[],update:[],delete:[]});async function A(){const e=await L(5e3);P.value=JSON.parse(JSON.stringify(e)),g.value=JSON.parse(JSON.stringify(e))}function L(e){return new Promise(t=>{const d=Date.now(),s=setInterval(()=>{const h=w.value;h&&Object.keys(h).length>0&&(clearInterval(s),t(h)),Date.now()-d>=e&&(clearInterval(s),t({}))},100)})}function M(e){n.value.add.find(t=>t.refName===e.refName)||n.value.add.push({...e})}function H(e,t){if(t!==e.refName){E({refName:t}),M(e);return}!n.value.add.find(d=>d.refName===e.refName)&&!n.value.update.find(d=>d.refName===e.refName)&&n.value.update.push({...e})}function Z(){$.value=!0}function E(e){const t=n.value.add.findIndex(s=>s.refName===e.refName);if(t!==-1){n.value.add.splice(t,1);return}n.value.delete.includes(e.refName)||n.value.delete.push(e.refName);const d=n.value.update.findIndex(s=>s.refName===e.refName);d!==-1&&n.value.update.splice(d,1)}function J(e){const{newData:t,index:d}=e,s=P.value.find(v=>v.refName===t.refName)||g.value[d],h=s.refName,r=t.refName;!P.value.some(v=>v.refName===r)?(M(t),E(s)):h===r&&s.text_zh===t.text_zh&&s.text_en===t.text_en&&s.text_pt===t.text_pt||H(t,h),g.value[d]=t}const G=pe(()=>g.value);function q(e){return Object.keys(e.add).length||Object.keys(e.update).length||Object.keys(e.delete).length}ve(n,e=>{console.log("has change: ",e),R.value=!!q(e)},{immediate:!0,deep:!0}),he(A);function K(){const e={refName:y.value,text_zh:N.value,text_en:S.value,text_pt:V.value};M(e),g.value.push({...e}),y.value="",N.value="",V.value="",S.value="",$.value=!1}async function Q(){I.value=!0,await D.dictionarApi.updateDictionary(n.value,e=>{const t=e;t===!0&&p.add({severity:"success",summary:"success",detail:o("notification.updateSuccess")}),t===!1&&p.add({severity:"warn",summary:"warn",detail:o("notification.updateFailed")}),I.value=!1,n.value={add:[],update:[],delete:[]}})}function X(){A(),n.value={add:[],update:[],delete:[]}}function Y(){D.dictionarApi.refresh(e=>{e?p.add({severity:"success",summary:"success",detail:o("dictionaryPage.refreshSucMsg")}):p.add({severity:"warn",summary:"warn",detail:o("dictionaryPage.refreshFailMsg")})})}return(e,t)=>{const d=Ve,s=ye,h=we,r=Ne,z=_e,v=xe,ee=ge,te=j,B=ne,ae=se;return C(),T(ke,null,[u("div",Ce,[a(te,{blocked:I.value,class:"w-full h-full relative"},{default:i(()=>[I.value?(C(),T("div",Pe,[a(d)])):F("",!0),a(ee,{editingRows:b.value,"onUpdate:editingRows":t[1]||(t[1]=l=>b.value=l),class:"p-1 m-1 h-full",filters:U.value,"onUpdate:filters":t[2]||(t[2]=l=>U.value=l),value:G.value,showGridlines:"",virtualScrollerOptions:{itemSize:44},scrollable:"",scrollHeight:"flex",editMode:"row",globalFilterFields:["refName","text_en","text_pt","text_zh"],onRowEditSave:J},{header:i(()=>[u("div",Me,[u("div",null,[u("h1",null,x(e.$t("dictionaryPage.title")),1)]),u("div",De,[R.value?(C(),T("div",Re,[a(s,{icon:"pi pi-check",severity:"success",onClick:Q}),a(s,{icon:"pi pi-times",severity:"danger",onClick:X})])):F("",!0),a(s,{icon:"pi pi-refresh",text:"",onClick:Y}),u("div",Ae,[a(z,null,{default:i(()=>[a(h,null,{default:i(()=>t[8]||(t[8]=[u("i",{class:"pi pi-search"},null,-1)])),_:1,__:[8]}),a(r,{modelValue:U.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=l=>U.value.global.value=l),placeholder:e.$t("dictionaryPage.searchPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})]),a(s,{icon:"pi pi-plus",onClick:Z})])])]),default:i(()=>[a(v,{field:"refName",sortable:"",header:e.$t("dictionaryPage.refName")},{editor:i(({data:l,field:f})=>[a(r,{modelValue:l[f],"onUpdate:modelValue":k=>l[f]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),a(v,{field:"text_en",header:e.$t("dictionaryPage.textEn")},{editor:i(({data:l,field:f})=>[a(r,{modelValue:l[f],"onUpdate:modelValue":k=>l[f]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),a(v,{field:"text_pt",header:e.$t("dictionaryPage.textPt")},{editor:i(({data:l,field:f})=>[a(r,{modelValue:l[f],"onUpdate:modelValue":k=>l[f]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),a(v,{field:"text_zh",header:e.$t("dictionaryPage.textZh")},{editor:i(({data:l,field:f})=>[a(r,{modelValue:l[f],"onUpdate:modelValue":k=>l[f]=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),a(v,{rowEditor:!0,style:{width:"10%","min-width":"8rem"}})]),_:1},8,["editingRows","filters","value"])]),_:1},8,["blocked"])]),a(ae,{visible:$.value,"onUpdate:visible":t[7]||(t[7]=l=>$.value=l)},{default:i(()=>[u("div",Ee,[u("div",ze,[a(B,null,{default:i(()=>[a(r,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=l=>y.value=l)},null,8,["modelValue"]),u("label",null,x(e.$t("dictionaryPage.refName")),1)]),_:1}),a(B,null,{default:i(()=>[a(r,{modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=l=>V.value=l)},null,8,["modelValue"]),u("label",null,x(e.$t("dictionaryPage.textPt")),1)]),_:1}),a(B,null,{default:i(()=>[a(r,{modelValue:S.value,"onUpdate:modelValue":t[5]||(t[5]=l=>S.value=l)},null,8,["modelValue"]),u("label",null,x(e.$t("dictionaryPage.textEn")),1)]),_:1}),a(B,null,{default:i(()=>[a(r,{modelValue:N.value,"onUpdate:modelValue":t[6]||(t[6]=l=>N.value=l)},null,8,["modelValue"]),u("label",null,x(e.$t("dictionaryPage.textZh")),1)]),_:1})]),a(s,{label:e.$t("dictionaryPage.addWord"),onClick:K},null,8,["label"])])]),_:1},8,["visible"])],64)}}};export{tt as default};
