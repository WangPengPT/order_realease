import{s as H}from"./index-dyLvjyAf.js";import{a as W,s as X}from"./index-FpU5k1BN.js";import{b as F}from"./index-BeWRmeLW.js";import{h as w,f as N,o as T,w as y,a as o,d as i,c as S,e as C,F as L,C as Y,t as A,z as P,x as ee,u as I,q as Q,i as le,G as te,A as z,l as ae,n as O,H as Z,E as se}from"./index-8e4Ry_AO.js";import{s as ie}from"./index-CWiX4HoK.js";import{d as K,a as ne,s as oe}from"./index-DKNpkO3v.js";import{s as re}from"./index-CxtCL_zq.js";import{s as de}from"./index-B7Htx0VG.js";import{s as ue}from"./index-DH0NF3bm.js";import{Q as ce,C as J}from"./CodeMaker-IOgtdCDu.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as ve}from"./index-XtSJyL6c.js";import"./index-BgeDdJF5.js";import"./index-JTM_VJHI.js";import"./index-BWIdXj8j.js";import"./index-BoLiIVCw.js";import"./index-B4pTg8QU.js";import"./index-VPdE4t52.js";import"./index-DLSbRAnb.js";import"./_commonjsHelpers-gnU0ypJ3.js";const fe={class:"p-menuitem-content"},me={__name:"TableMenuBar",props:{filterStatu:String},setup(E){const j=w([{label:"全部",value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:"空闲",value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:"用餐",value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:"预定",value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:"已付",value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(g,u)=>{const x=F,v=ie;return T(),N(v,{model:j.value,breakpoint:"355px",class:"border-0"},{item:y(({item:f})=>[o("div",fe,[i(x,{label:f.label,icon:f.icon,severity:f.severity,variant:"outlined",raised:"",onClick:h=>g.$emit("update:filterStatu",f.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},be={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},ye={class:"grid m-2"},Te={class:"flex justify-content-center align-items-center w-100"},ge={class:"relative"},_e={class:"text-center text-2xl font-bold"},xe={key:0},we={class:"text-center"},he={class:"text-center text-lg"},ke={class:"text-center text-lg font-bold"},Ce={key:1,class:"flex flex-wrap justify-content-center"},$e={class:"flex flex-wrap justify-content-end mt-3"},Oe={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(E,{emit:j}){const g=w(!1),u=w(),x=w([{label:"空闲",value:"Livre"},{label:"用餐",value:"Ocupado"},{label:"预定",value:"Reservado"},{label:"已付",value:"Pago"}]);function v(m){return x.value.find(c=>c.value===m)}function f(m){return!m||!Array.isArray(m)?0:parseFloat(m.reduce((c,_)=>c+_.price*_.quantity,0).toFixed(2))}function h(m){const c="m-1 border-3 border-gray-500 ";let _="";switch(m){case"Livre":break;case"Ocupado":_="border-red-300 bg-red-100";break;case"Reservado":_="border-blue-300 bg-blue-100";break;case"Pago":_="border-purple-300 bg-purple-100";break;default:_="border-gray-500 bg-gray-100"}return c+_}function t(m,c){m["msg_"+c]=!1,client.socket.emit("click_msg",m.id,c)}return(m,c)=>{const _=F,q=re,V=K,M=H;return T(),S(L,null,[o("div",be,[o("div",ye,[E.editMode?(T(),N(q,{key:0,class:"m-1 border-3 border-gray-500 flex justify-content-center align-items-center",style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:c[0]||(c[0]=p=>g.value=!0)},{content:y(()=>[o("div",Te,[i(_,{text:"",icon:"pi pi-plus",severity:"contrast",size:"large"})])]),_:1})):C("",!0),(T(!0),S(L,null,Y(E.filteredTables,p=>(T(),N(q,{class:ee(h(p.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:D=>E.editMode?"":m.$emit("openTableDetail",p.id)},{header:y(()=>[o("div",ge,[p.msg_pay?(T(),N(_,{key:0,onClick:P(D=>t(p,"pay"),["stop"]),icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"}},null,8,["onClick"])):C("",!0),p.msg_call?(T(),N(_,{key:1,onClick:P(D=>t(p,"call"),["stop"]),icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"}},null,8,["onClick"])):C("",!0)])]),content:y(()=>[o("p",_e,"桌号: "+A(p.id),1),E.editMode?C("",!0):(T(),S("div",xe,[o("p",we,A(v(p.status).label),1),o("p",he,A(p.people)+"人",1),o("p",ke,A(f(p.order))+"€",1)])),E.editMode?(T(),S("div",Ce,[i(_,{icon:"pi pi-trash",severity:"danger",outlined:"",raised:"",class:"m-2",onClick:P(D=>m.$emit("removeTable",p.id),["stop"])},null,8,["onClick"])])):C("",!0)]),_:2},1032,["class","onClick"]))),256))])]),i(M,{visible:g.value,"onUpdate:visible":c[3]||(c[3]=p=>g.value=p),modal:!0,dismissableMask:!0,header:"添加桌子",onHide:c[4]||(c[4]=p=>u.value=void 0)},{default:y(()=>[i(V,{modelValue:u.value,"onUpdate:modelValue":c[1]||(c[1]=p=>u.value=p),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:u.value<10?"桌号：0":"桌号：",step:1,min:"1",max:"9999",placeholder:"输入桌号",fluid:""},{incrementbuttonicon:y(()=>c[5]||(c[5]=[o("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:y(()=>c[6]||(c[6]=[o("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix"]),o("div",$e,[i(_,{label:"创建桌子",onClick:c[2]||(c[2]=p=>{m.$emit("addNewTable",u.value),g.value=!1})})])]),_:1},8,["visible"])],64)}}},Se={class:"flex flex-column justify-content-center align-items-center"},Ee={key:0,class:"flex flex-wrap justify-content-center align-items-center"},Ve={key:1,class:"flex flex-wrap justify-content-center align-items-center"},Ne={class:"flex flex-wrap justify-content-center align-items-center m-2"},De={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},je={class:"m-2"},qe={key:0,class:"flex flex-wrap justify-content-between align-items-center"},Me={key:1,class:"flex flex-wrap justify-content-between align-items-center"},Be={class:"flex flex-column"},Ae={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(E,{emit:j}){const g=I(),u=w(!1),x=w(!1),v=E,f=j;function h(){f("onEdit",v.selectedTable.id,e=>{t.value=JSON.parse(JSON.stringify(e)),u.value=!0})}const t=w(JSON.parse(JSON.stringify(v.selectedTable))),m=w([{label:"空闲",value:"Livre",severity:"success"},{label:"用餐",value:"Ocupado",severity:"danger"},{label:"预定",value:"Reservado",severity:"info"},{label:"已付",value:"Pago",severity:"help"}]);function c(){x.value=!1,t.value=JSON.parse(JSON.stringify(v.selectedTable))}function _(){t.value.status?(f("tableEditConfirm",t.value,e=>{(e==null?void 0:e.success)==!0?(g.add({severity:"success",summary:"成功",detail:e.message,life:3e3}),u.value=!1):g.add({severity:"error",summary:"失败",detail:e.message,life:3e3})}),x.value=!1):g.add({severity:"error",summary:"失败",detail:"未输入桌子状态",life:3e3})}function q(){x.value=!0}function V(){u.value=!1,t.value=JSON.parse(JSON.stringify(v.selectedTable))}function M(){return m.value.find(e=>e.value===t.value.status)}function p(e,n){const a=Number(n);if(e==="Adult"){t.value.peopleType.adults+a<=0?t.value.peopleType.adults=0:t.value.peopleType.adults=t.value.peopleType.adults+a,t.value.people=t.value.peopleType.adults+t.value.peopleType.children;return}if(e==="Children"){t.value.peopleType.children+a<=0?t.value.peopleType.children=0:t.value.peopleType.children=t.value.peopleType.children+a,t.value.people=t.value.peopleType.adults+t.value.peopleType.children;return}}const D=Q(),R=()=>{D.require({message:"是否清空"+t.value.id+"号桌",header:"确认清台",icon:"pi pi-info-circle",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{f("cleanTable",t.value.id,e=>{(e==null?void 0:e.success)===!1?g.add({severity:"error",summary:"操作",detail:e.message,life:3e3}):(e==null?void 0:e.success)===!0&&g.add({severity:"success",summary:"操作",detail:`桌号${t.value.id}，清台`,life:3e3})})},reject:()=>{g.add({severity:"error",summary:"操作",detail:`取消${t.value.id}号桌清台`,life:3e3})}})},B=w(null);function r(){window.open(window.env.QR_ADDR+J.SimpleEncode(v.selectedTable.id),"_blank")}const l=async()=>{if(B.value)try{await ce.toCanvas(B.value,window.env.QR_ADDR+J.SimpleEncode(v.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(e){console.error("生成二维码失败:",e)}};return le(()=>{l()}),te(()=>window.env.QR_ADDR+J.SimpleEncode(v.selectedTable.id),l),(e,n)=>{var $,G;const a=ue,s=de,d=F,b=W,U=H;return T(),S(L,null,[o("div",Se,[o("div",null,[i(s,{class:"m-2",variant:"on"},{default:y(()=>[i(a,{id:"Total",modelValue:t.value.people,"onUpdate:modelValue":n[0]||(n[0]=k=>t.value.people=k),autocomplete:"off",disabled:""},null,8,["modelValue"]),n[11]||(n[11]=o("label",{for:"Total"},"总人数",-1))]),_:1,__:[11]})]),u.value?(T(),S("div",Ee,[i(d,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:n[1]||(n[1]=k=>p("Adult",-1))}),i(s,{class:"m-2",variant:"on"},{default:y(()=>[i(a,{id:"Adult",modelValue:t.value.peopleType.adults,"onUpdate:modelValue":n[2]||(n[2]=k=>t.value.peopleType.adults=k),autocomplete:"off"},null,8,["modelValue"]),n[12]||(n[12]=o("label",{for:"Adult"},"大人",-1))]),_:1,__:[12]}),i(d,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:n[3]||(n[3]=k=>p("Adult",1))})])):C("",!0),u.value?(T(),S("div",Ve,[i(d,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:n[4]||(n[4]=k=>p("Children",-1))}),i(s,{class:"m-2",variant:"on"},{default:y(()=>[i(a,{id:"Children",modelValue:t.value.peopleType.children,"onUpdate:modelValue":n[5]||(n[5]=k=>t.value.peopleType.children=k),autocomplete:"off"},null,8,["modelValue"]),n[13]||(n[13]=o("label",{for:"Children"},"小孩",-1))]),_:1,__:[13]}),i(d,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:n[6]||(n[6]=k=>p("Children",1))})])):C("",!0)]),o("div",Ne,[u.value?C("",!0):(T(),N(d,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:($=M())==null?void 0:$.label,severity:(G=M())==null?void 0:G.severity,onClick:q},null,8,["label","severity"])),u.value?(T(),N(b,{key:1,modelValue:t.value.status,"onUpdate:modelValue":n[7]||(n[7]=k=>t.value.status=k),options:m.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:t.value.status===null},null,8,["modelValue","options","invalid"])):C("",!0)]),o("div",De,[o("canvas",{ref_key:"qrCanvas",ref:B,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:r},null,512)]),o("div",je,[u.value?C("",!0):(T(),S("div",qe,[i(d,{label:"订单详情",severity:"success",onClick:n[8]||(n[8]=()=>e.$emit("showTableOrders"))}),i(d,{label:"清台",onClick:R,severity:"danger",class:"m-1"}),i(d,{label:"编辑",onClick:h,class:"m-1"})])),u.value?(T(),S("div",Me,[i(d,{label:"取消编辑",severity:"danger",raised:"",class:"m-2",onClick:V}),i(d,{label:"保存编辑",severity:"success",raised:"",class:"m-2",onClick:_})])):C("",!0)]),i(U,{visible:x.value,"onUpdate:visible":n[10]||(n[10]=k=>x.value=k),modal:"",header:"修改桌子状态",closable:!0,dismissableMask:!0,onHide:c},{default:y(()=>[o("div",Be,[i(b,{modelValue:t.value.status,"onUpdate:modelValue":n[9]||(n[9]=k=>t.value.status=k),options:m.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:t.value.status===null},null,8,["modelValue","options","invalid"]),i(d,{label:"确认",class:"mt-3",onClick:_})])]),_:1},8,["visible"])],64)}}},Ue=pe(Ae,[["__scopeId","data-v-a790956e"]]),Re={key:0},ze=["disabled","onClick"],Le={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Fe={class:"font-bold"},Pe={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(E,{emit:j}){var B;const g=E,u=j,x=w((B=g.selectedTable.order)==null?void 0:B.sort((r,l)=>l.price-r.price).filter(r=>r.quantity!=0)),v=w(x.value.filter(r=>r.price!=0)),f=w([]),h=w(!1),t=w(!1);function m(r){let l=0;return r.forEach(e=>{l+=e.price*e.quantity}),l.toFixed(2)}function c(){h.value=!h.value,!h.value&&f.value.length>0&&R()}function _(r){if(f.value.find(l=>l.dishid===r.dishid))f.value.find(l=>l.dishid===r.dishid).quantity+=1;else{const l={...r,quantity:1};f.value.push(l)}r.quantity-=1}function q(){let r="| ";return f.value.forEach(l=>{const e=x.value.find(n=>n.dishid===l.dishid);e&&(r+=l.dishid+"-"+O.getDishName(l)+" "+(e.quantity+l.quantity)+" -> "+e.quantity+` | 
`)}),r}function V(r){u("cancelOrderEdit"),u("showToast","error","操作",`取消菜品删除
`+r),f.value.forEach(l=>{x.value.find(e=>e.dishid===l.dishid).quantity+=l.quantity}),f.value=[]}function M(r){var l;u("saveOrder",f.value),u("showToast","info","操作","桌号1，清台"),f.value=[],x.value=(l=g.selectedTable.order)==null?void 0:l.sort((e,n)=>n.price-e.price).filter(e=>e.quantity!=0)}const p=Q();function D(r){return Array.isArray(r)?r.map(Z):Z(r)}const R=()=>{let r=!1;const l=D(q());p.require({message:l,escape:!0,header:"是否修改以下订单",rejectLabel:"取消",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认",severity:"danger"},accept:()=>{r=!0,M()},reject:()=>{r=!0,V(l)},onHide:()=>{r||V(l)}})};return(r,l)=>{const e=ne,n=K,a=oe,s=ve,d=F;return T(),S(L,null,[o("div",null,[i(a,{value:t.value?v.value:x.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:y(()=>l[6]||(l[6]=[o("div",{class:"text-center py-5"},[o("p",{class:"text-gray-500"},"该桌子还没有菜品")],-1)])),default:y(()=>[i(e,{field:"dishid",header:"号码"}),i(e,{header:"菜名"},{body:y(b=>[z(A(ae(O).getDishName(b.data)),1)]),default:y(()=>[l[2]||(l[2]=z(" > ",-1))]),_:1,__:[2]}),i(e,{field:"price",header:"单价"}),i(e,{field:"quantity",header:"数量"},{body:y(b=>[h.value?C("",!0):(T(),S("label",Re,A(b.data.quantity),1)),h.value?(T(),N(n,{key:1,modelValue:b.data.quantity,"onUpdate:modelValue":U=>b.data.quantity=U,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:y(()=>l[3]||(l[3]=[o("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:y(()=>[o("span",{class:"p-inputnumber-button-icon",disabled:b.data.quantity<=0,onClick:U=>_(b.data)},l[4]||(l[4]=[o("i",{class:"pi pi-angle-down"},null,-1)]),8,ze)]),_:2},1032,["modelValue","onUpdate:modelValue"])):C("",!0)]),_:1}),i(e,{header:"总价"},{body:y(b=>[z(A(m([b.data])),1)]),default:y(()=>[l[5]||(l[5]=z(" > ",-1))]),_:1,__:[5]})]),_:1},8,["value"])]),o("div",Le,[o("label",Fe," 合计："+A(v.value.length>0?m(v.value):"0"),1),o("label",null,[i(s,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=b=>t.value=b)},null,8,["modelValue"]),l[7]||(l[7]=z(" 不显示价格为0 ",-1))]),i(d,{label:h.value?"保存":"编辑",onClick:l[1]||(l[1]=b=>c())},null,8,["label"])])],64)}}},Je={class:"flex flex-wrap justify-content-between align-items-center m-1"},cl={__name:"TablesPage",setup(E){const j=Q(),g=w("Todos"),u=w(!1),x=w(!1),v=w({id:0}),f=w(!1),h=w({}),t=se(()=>g.value==="Todos"?O.tables.value:O.tables.value.filter(a=>a.status===g.value));function m(){u.value=!0}function c(){u.value==!0&&(u.value=!1)}function _(a){j.require({message:"确认删除"+a+`号桌子？
(注意：删除后不能撤回)`,header:"删除桌子",icon:"pi pi-trash",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确认删除",severity:"danger"},accept:()=>{const s=O.deleteTable(a);s!=null?e.add({severity:"error",summary:s.title,detail:s.message,life:3e3}):e.add({severity:"info",summary:"删除成功",detail:"成功删除桌号："+a,life:3e3})},reject:()=>{}})}async function q(a){a<10&&(a="0"+a);const s=await O.addNewTable(a);s!==void 0?e.add({severity:"error",summary:s.title,detail:s.message,life:3e3}):e.add({severity:"info",summary:"创建成功",detail:"成功创建桌号："+a,life:3e3})}function V(a){const s=O.tables.value.find(d=>d.id===a);v.value={...s,order:(s==null?void 0:s.order)||[]}}function M(a,s){const d=O.tables.value.find(b=>b.id===a);v.value={...d,order:(d==null?void 0:d.order)||[]},s(v.value)}function p(a){V(a),x.value=!0}function D(a,s){const d={id:a.id,status:a.status,peopleType:{adults:a.peopleType.adults,children:a.peopleType.children}},b=O.updateTable(d);V(a.id),s(b?{success:!1,message:"更新失败"}:{success:!0,message:"更新成功"})}function R(a,s){const d=O.tableClean(a);d?(console.log("cleanTable Error:",d),s({success:!1,message:"更新失败"})):(x.value=!1,s({success:!0,message:"更新成功"}))}function B(){const a=v.value.id;V(a),f.value=!0}function r(a){O.deleteOrders(v.value.id,a),h.value.order&&(O.deleteOrder(h.value),h.value={})}function l(){O.refreshTables()}const e=I();function n(a,s,d,b){e.add({severity:a||"",summary:s||"",detail:d||"",life:b||3e3})}return(a,s)=>{const d=F,b=X,U=H;return T(),S(L,null,[o("div",Je,[i(me,{filterStatu:g.value,"onUpdate:filterStatu":s[0]||(s[0]=$=>g.value=$)},null,8,["filterStatu"]),u.value?C("",!0):(T(),N(d,{key:0,icon:"pi pi-pencil",label:"编辑桌子",class:"mr-3",onClick:m})),u.value?(T(),N(d,{key:1,label:"关闭编辑模式",class:"mr-3",onClick:c})):C("",!0)]),i(b,{class:"m-0"}),i(Oe,{filteredTables:t.value,"onUpdate:filteredTables":s[1]||(s[1]=$=>t.value=$),editMode:u.value,"onUpdate:editMode":s[2]||(s[2]=$=>u.value=$),onOpenTableDetail:p,onRemoveTable:_,onAddNewTable:q},null,8,["filteredTables","editMode"]),i(U,{visible:x.value,"onUpdate:visible":s[3]||(s[3]=$=>x.value=$),header:"桌号: "+v.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:y(()=>[i(Ue,{selectedTable:v.value,onTableEditConfirm:D,onCleanTable:R,onShowTableOrders:B,onOnEdit:M},null,8,["selectedTable"])]),_:1},8,["visible","header"]),i(U,{visible:f.value,"onUpdate:visible":s[4]||(s[4]=$=>f.value=$),modal:!0,dismissableMask:!0,header:"菜品详情",style:{"min-width":"350px","max-width":"550px"},onHide:s[5]||(s[5]=$=>l())},{default:y(()=>[i(Pe,{selectedTable:v.value,onSaveOrder:r,onCancelOrderEdit:l,onShowToast:n},null,8,["selectedTable"])]),_:1},8,["visible"])],64)}}};export{cl as default};
